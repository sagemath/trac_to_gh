# Issue 11462: Base Polyhedron on PPL (by default)

archive/issues_011462.json:
```json
{
    "body": "Assignee: mhampton\n\nCC:  @novoselt @dimpase\n\nRewrite the `Polyhedron` class to allow different backends for the computation and make PPL the default for polyhedra over `QQ`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11634\n\n",
    "created_at": "2011-07-29T10:01:23Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Base Polyhedron on PPL (by default)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11462",
    "user": "https://github.com/vbraun"
}
```
Assignee: mhampton

CC:  @novoselt @dimpase

Rewrite the `Polyhedron` class to allow different backends for the computation and make PPL the default for polyhedra over `QQ`.

Issue created by migration from https://trac.sagemath.org/ticket/11634





---

archive/issue_comments_127723.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-08-01T08:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127723",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_127724.json:
```json
{
    "body": "Attachment [trac_11634_pickling_for_PPL.patch](tarball://root/attachments/some-uuid/ticket11634/trac_11634_pickling_for_PPL.patch) by @vbraun created at 2011-08-31 01:39:44\n\nInitial patch",
    "created_at": "2011-08-31T01:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127724",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_11634_pickling_for_PPL.patch](tarball://root/attachments/some-uuid/ticket11634/trac_11634_pickling_for_PPL.patch) by @vbraun created at 2011-08-31 01:39:44

Initial patch



---

archive/issue_comments_127725.json:
```json
{
    "body": "I've added pickling support to PPL, this is now part of this ticket.",
    "created_at": "2011-08-31T01:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127725",
    "user": "https://github.com/vbraun"
}
```

I've added pickling support to PPL, this is now part of this ticket.



---

archive/issue_comments_127726.json:
```json
{
    "body": "Updated patch",
    "created_at": "2011-12-19T22:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127726",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_127727.json:
```json
{
    "body": "Attachment [trac_11634_ppl_backend.patch](tarball://root/attachments/some-uuid/ticket11634/trac_11634_ppl_backend.patch) by @vbraun created at 2011-12-19 22:02:05\n\nThrough the triangulation of polytopes, this depends on #12159",
    "created_at": "2011-12-19T22:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127727",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_11634_ppl_backend.patch](tarball://root/attachments/some-uuid/ticket11634/trac_11634_ppl_backend.patch) by @vbraun created at 2011-12-19 22:02:05

Through the triangulation of polytopes, this depends on #12159



---

archive/issue_comments_127728.json:
```json
{
    "body": "Volker, I'll try to review this this week if I can.  If I forget feel free to ping me about it.",
    "created_at": "2012-01-08T19:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127728",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

Volker, I'll try to review this this week if I can.  If I forget feel free to ping me about it.



---

archive/issue_comments_127729.json:
```json
{
    "body": "I'm having trouble applying your patches, it looks like this also depends on #11429.",
    "created_at": "2012-01-09T16:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127729",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

I'm having trouble applying your patches, it looks like this also depends on #11429.



---

archive/issue_comments_127730.json:
```json
{
    "body": "Yes, that one needs to be reviewed as well.",
    "created_at": "2012-01-09T16:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127730",
    "user": "https://github.com/vbraun"
}
```

Yes, that one needs to be reviewed as well.



---

archive/issue_comments_127731.json:
```json
{
    "body": "I tried applying #11429, and then #12159, both of which worked fine, but I am unable to apply the patches from this ticket after that.",
    "created_at": "2012-01-09T16:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127731",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

I tried applying #11429, and then #12159, both of which worked fine, but I am unable to apply the patches from this ticket after that.



---

archive/issue_comments_127732.json:
```json
{
    "body": "I have the following patches applied on top of sage-4.8.alpha6 without problems:\n\n```\n[vbraun@volker-laptop-two hg]$ hg qseries\ntrac_11429_native_enumeration_of_lattice_polytope_points.patch\ntrac_11429_cythonize_lattice_points.patch\ntrac_11429_fix_doctests.patch\ntrac_12159_separate_triangulation_file.patch\ntrac_12159_placing_triangulation.patch\ntrac_12159_normal_cone.patch\ntrac_11634_refactor_polyhedron.patch\ntrac_11634_pickling_for_PPL.patch\ntrac_11634_ppl_backend.patch\n```\n\nThe patches might not apply cleanly older sage versions.",
    "created_at": "2012-01-09T19:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127732",
    "user": "https://github.com/vbraun"
}
```

I have the following patches applied on top of sage-4.8.alpha6 without problems:

```
[vbraun@volker-laptop-two hg]$ hg qseries
trac_11429_native_enumeration_of_lattice_polytope_points.patch
trac_11429_cythonize_lattice_points.patch
trac_11429_fix_doctests.patch
trac_12159_separate_triangulation_file.patch
trac_12159_placing_triangulation.patch
trac_12159_normal_cone.patch
trac_11634_refactor_polyhedron.patch
trac_11634_pickling_for_PPL.patch
trac_11634_ppl_backend.patch
```

The patches might not apply cleanly older sage versions.



---

archive/issue_comments_127733.json:
```json
{
    "body": "Thanks; I was working with an unoffical sage-4.8.rc1, I will switch to 4.8.alpha6 and try again in case that is the problem.",
    "created_at": "2012-01-09T20:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127733",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

Thanks; I was working with an unoffical sage-4.8.rc1, I will switch to 4.8.alpha6 and try again in case that is the problem.



---

archive/issue_comments_127734.json:
```json
{
    "body": "OK, I got it working now.  Clearly PPL is much faster on some of my test examples, wow.",
    "created_at": "2012-01-09T20:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127734",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

OK, I got it working now.  Clearly PPL is much faster on some of my test examples, wow.



---

archive/issue_comments_127735.json:
```json
{
    "body": "Replying to [comment:11 mhampton]:\n> OK, I got it working now.  Clearly PPL is much faster on some of my test examples, wow.\n\nOh yeah, working with toric varieties got much better once most basic operations were switched to PPL!\n\nI am also the offending reviewer on #11429, dropping off the radar half-way. Will try to remedy it shortly, without forgetting #11599.",
    "created_at": "2012-01-09T20:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127735",
    "user": "https://github.com/novoselt"
}
```

Replying to [comment:11 mhampton]:
> OK, I got it working now.  Clearly PPL is much faster on some of my test examples, wow.

Oh yeah, working with toric varieties got much better once most basic operations were switched to PPL!

I am also the offending reviewer on #11429, dropping off the radar half-way. Will try to remedy it shortly, without forgetting #11599.



---

archive/issue_comments_127736.json:
```json
{
    "body": "For sage-5.0.beta1, the numerial noise fix from #9958 changes one line of polyhedra.py, which causes trac_11634_refactor_polyhedron.patch to fail to apply.  \n\n\n```\n5866c5866\n<             0.8\n---\n>             0.8000...\n```\n",
    "created_at": "2012-01-23T14:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127736",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

For sage-5.0.beta1, the numerial noise fix from #9958 changes one line of polyhedra.py, which causes trac_11634_refactor_polyhedron.patch to fail to apply.  


```
5866c5866
<             0.8
---
>             0.8000...
```




---

archive/issue_comments_127737.json:
```json
{
    "body": "I'm a little confused by the above numerical noise issue.  After changing so that the patch would apply, the doctest failed.  If I switch it to \n\n```\n            sage: filled_poly.axes_width()\n            0.8...\n```\n\nthen it works.  I'm not sure if the \"0.800...\" makes sense on some other system or not.\n\nApart from that I think this all looks good.  There is one other doctest failure in integral_points.pyx resulting from the Python switch to 2.7, line 688 needs to be changed to\n\n```\n        OverflowError: Python int too large to convert to C long\n```\n\ninstead of\n\n```\n        OverflowError: long int too large to convert to int\n```\n\n\nWith those changes I would be happy to give a positive review.\n\nI haven't looked at #11429 and #12159 by themselves, but it would be nice to get this ticket into sage-5.0.  I don't have a lot of time in the coming weeks but if Andrey can't review those I would try to check them out too.",
    "created_at": "2012-01-24T02:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127737",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

I'm a little confused by the above numerical noise issue.  After changing so that the patch would apply, the doctest failed.  If I switch it to 

```
            sage: filled_poly.axes_width()
            0.8...
```

then it works.  I'm not sure if the "0.800..." makes sense on some other system or not.

Apart from that I think this all looks good.  There is one other doctest failure in integral_points.pyx resulting from the Python switch to 2.7, line 688 needs to be changed to

```
        OverflowError: Python int too large to convert to C long
```

instead of

```
        OverflowError: long int too large to convert to int
```


With those changes I would be happy to give a positive review.

I haven't looked at #11429 and #12159 by themselves, but it would be nice to get this ticket into sage-5.0.  I don't have a lot of time in the coming weeks but if Andrey can't review those I would try to check them out too.



---

archive/issue_comments_127738.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2012-01-24T02:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127738",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_127739.json:
```json
{
    "body": "I already fixed the `OverflowError` error message in #11429. What output do you get for\n\n```\nfilled_poly.axes_width()\n```\n\nthe doctest works for me with `0.8`.",
    "created_at": "2012-01-24T02:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127739",
    "user": "https://github.com/vbraun"
}
```

I already fixed the `OverflowError` error message in #11429. What output do you get for

```
filled_poly.axes_width()
```

the doctest works for me with `0.8`.



---

archive/issue_comments_127740.json:
```json
{
    "body": "Updated patch",
    "created_at": "2012-01-24T02:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127740",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_127741.json:
```json
{
    "body": "Attachment [trac_11634_refactor_polyhedron.2.patch](tarball://root/attachments/some-uuid/ticket11634/trac_11634_refactor_polyhedron.2.patch) by @vbraun created at 2012-01-24 02:40:41\n\nPS: #11429 is already reviewed ;-)",
    "created_at": "2012-01-24T02:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127741",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_11634_refactor_polyhedron.2.patch](tarball://root/attachments/some-uuid/ticket11634/trac_11634_refactor_polyhedron.2.patch) by @vbraun created at 2012-01-24 02:40:41

PS: #11429 is already reviewed ;-)



---

archive/issue_comments_127742.json:
```json
{
    "body": "I get 0.8 as well on my mac (10.6.8).  Its just that I am not sure what happens on other systems (solaris, mac ppc, whatever) so maybe leaving it as 0.8... is safer?\n\nThat's good that #11429 is done, I'll try to look at #12159 if I can find the time.",
    "created_at": "2012-01-24T03:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127742",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

I get 0.8 as well on my mac (10.6.8).  Its just that I am not sure what happens on other systems (solaris, mac ppc, whatever) so maybe leaving it as 0.8... is safer?

That's good that #11429 is done, I'll try to look at #12159 if I can find the time.



---

archive/issue_comments_127743.json:
```json
{
    "body": "The way I understad it, #9958 changes the float printing to do the fuzzy zero automatically so its no longer necessary to add ellipsis.",
    "created_at": "2012-01-24T05:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127743",
    "user": "https://github.com/vbraun"
}
```

The way I understad it, #9958 changes the float printing to do the fuzzy zero automatically so its no longer necessary to add ellipsis.



---

archive/issue_comments_127744.json:
```json
{
    "body": "OK, I guess its fine to change it back to a 0.8 then.",
    "created_at": "2012-01-24T12:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127744",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

OK, I guess its fine to change it back to a 0.8 then.



---

archive/issue_comments_127745.json:
```json
{
    "body": "Attachment [trac_11634_refactor_polyhedron.patch](tarball://root/attachments/some-uuid/ticket11634/trac_11634_refactor_polyhedron.patch) by @vbraun created at 2012-02-19 01:17:47\n\nUpdated patch",
    "created_at": "2012-02-19T01:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127745",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_11634_refactor_polyhedron.patch](tarball://root/attachments/some-uuid/ticket11634/trac_11634_refactor_polyhedron.patch) by @vbraun created at 2012-02-19 01:17:47

Updated patch



---

archive/issue_comments_127746.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-02-19T01:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127746",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_127747.json:
```json
{
    "body": "Updated patch for sage-5.0.beta4. I'm switching this back to \"needs review\" unless you think I haven't given enough info yet ;-)",
    "created_at": "2012-02-19T01:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127747",
    "user": "https://github.com/vbraun"
}
```

Updated patch for sage-5.0.beta4. I'm switching this back to "needs review" unless you think I haven't given enough info yet ;-)



---

archive/issue_comments_127748.json:
```json
{
    "body": "Apply trac_11634_refactor_polyhedron.patch, trac_11634_pickling_for_PPL.patch, trac_11634_ppl_backend.patch\n\n(for the patchbot)",
    "created_at": "2012-03-11T11:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127748",
    "user": "https://github.com/loefflerd"
}
```

Apply trac_11634_refactor_polyhedron.patch, trac_11634_pickling_for_PPL.patch, trac_11634_ppl_backend.patch

(for the patchbot)



---

archive/issue_comments_127749.json:
```json
{
    "body": "Apply trac_11634_refactor_polyhedron.patch,trac_11634_pickling_for_PPL.patch,trac_11634_ppl_backend.patch\n\n(for the patchbot, which is still not getting it)",
    "created_at": "2012-03-11T11:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127749",
    "user": "https://github.com/loefflerd"
}
```

Apply trac_11634_refactor_polyhedron.patch,trac_11634_pickling_for_PPL.patch,trac_11634_ppl_backend.patch

(for the patchbot, which is still not getting it)



---

archive/issue_comments_127750.json:
```json
{
    "body": "Apply trac_11634_refactor_polyhedron.patch trac_11634_pickling_for_PPL.patch trac_11634_ppl_backend.patch\n\n(it still doesn't seem to pick up the 2nd patch in the series)",
    "created_at": "2012-03-11T11:42:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127750",
    "user": "https://github.com/loefflerd"
}
```

Apply trac_11634_refactor_polyhedron.patch trac_11634_pickling_for_PPL.patch trac_11634_ppl_backend.patch

(it still doesn't seem to pick up the 2nd patch in the series)



---

archive/issue_comments_127751.json:
```json
{
    "body": "\n```\nApply trac_11634_refactor_polyhedron.patch trac_11634_pickling_for_ppl.patch trac_11634_ppl_backend.patch \n```\n",
    "created_at": "2012-03-11T11:43:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127751",
    "user": "https://github.com/loefflerd"
}
```


```
Apply trac_11634_refactor_polyhedron.patch trac_11634_pickling_for_ppl.patch trac_11634_ppl_backend.patch 
```




---

archive/issue_comments_127752.json:
```json
{
    "body": "Apply only this patch. Patch against 5.0.beta7",
    "created_at": "2012-03-11T12:10:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127752",
    "user": "https://github.com/loefflerd"
}
```

Apply only this patch. Patch against 5.0.beta7



---

archive/issue_comments_127753.json:
```json
{
    "body": "Attachment [trac_11634-folded.patch](tarball://root/attachments/some-uuid/ticket11634/trac_11634-folded.patch) by @loefflerd created at 2012-03-11 12:14:19\n\nI couldn't get the patchbot to apply the three patches. Also, there seems to now be a consensus that code lines with trailing whitespace are a Bad Thing. So I've done a single qfolded patch which is equivalent to Volker's three patches but with all trailing whitespace removed.\n\nApply trac_11634-folded.patch",
    "created_at": "2012-03-11T12:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127753",
    "user": "https://github.com/loefflerd"
}
```

Attachment [trac_11634-folded.patch](tarball://root/attachments/some-uuid/ticket11634/trac_11634-folded.patch) by @loefflerd created at 2012-03-11 12:14:19

I couldn't get the patchbot to apply the three patches. Also, there seems to now be a consensus that code lines with trailing whitespace are a Bad Thing. So I've done a single qfolded patch which is equivalent to Volker's three patches but with all trailing whitespace removed.

Apply trac_11634-folded.patch



---

archive/issue_comments_127754.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-11T21:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127754",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_127755.json:
```json
{
    "body": "Thanks David, that made things simpler for me to look at.  Volker, my apologies for taking so long on reviewing this.  I think this should be a great addition to sage-5.0.",
    "created_at": "2012-03-11T21:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127755",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

Thanks David, that made things simpler for me to look at.  Volker, my apologies for taking so long on reviewing this.  I think this should be a great addition to sage-5.0.



---

archive/issue_comments_127756.json:
```json
{
    "body": "I am not entirely sure if something is wrong on my end, but when I apply the following patches to Sage-5.0.beta8\n\n```\nnovoselt@sage ~/sage/devel/sage-main $ hg qapplied\ntrac_11599_no_circular_imports.patch\ntrac_11599_homset_new_coercion_model.patch\ntrac_11599_rename_morphisms.patch\ntrac_11599_toric_morphisms.patch\ntrac_11599_reviewer.patch\ntrac_11599_remove_class_suffix.patch\ntrac_11599_remaining_fixes.patch\ntrac_11599_numerical_noise.patch\ntrac_12159_separate_triangulation_file.patch\ntrac_12159_placing_triangulation.patch\ntrac_12159_normal_cone.patch\ntrac_11634-folded.patch\n```\n\nI get after trying to start Sage\n\n```\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\n/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/sage/combinat/root_system/associahedron.py:22: DeprecationWarning: (Since Sage Version 4.8) The module sage.geometry.polyhedra has been removed, use sage.geometry.polyhedron instead.\n  from sage.geometry.polyhedra import Polyhedron\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n| Sage Version 5.0.beta8, Release Date: 2012-03-13                   |\n| Type notebook() for the GUI, and license() for information.        |\n/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/IPython/ipmaker.pyc in force_import(modname, force_reload)\n     61         reload(sys.modules[modname])\n     62     else:\n---> 63         __import__(modname)\n     64         \n     65 \n\n/home/novoselt/sage-5.0.beta8/local/bin/ipy_profile_sage.py in <module>()\n      5     preparser(True)\n      6     \n----> 7     import sage.all_cmdline\n      8     sage.all_cmdline._init_cmdline(globals())\n      9     \n\n/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/sage/all_cmdline.py in <module>()\n     12 try:\n     13 \n---> 14     from sage.all import *\n     15     from sage.calculus.predefined import x\n     16     preparser(on=True)\n\n/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/sage/all.py in <module>()\n     80 from sage.modules.all    import *\n     81 from sage.monoids.all    import *\n---> 82 from sage.algebras.all   import *\n     83 from sage.modular.all    import *\n     84 from sage.schemes.all    import *\n\n/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/sage/algebras/all.py in <module>()\n     34 from group_algebra_new import GroupAlgebra\n     35 \n---> 36 from iwahori_hecke_algebra import IwahoriHeckeAlgebraT\n     37 from affine_nil_temperley_lieb import AffineNilTemperleyLiebTypeA\n     38 from nil_coxeter_algebra import NilCoxeterAlgebra\n\n/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/sage/algebras/iwahori_hecke_algebra.py in <module>()\n     10 #*****************************************************************************\n     11 from sage.categories.all import AlgebrasWithBasis, FiniteDimensionalAlgebrasWithBasis, CoxeterGroups\n---> 12 import sage.combinat.root_system.cartan_type\n     13 from sage.combinat.root_system.weyl_group import WeylGroup\n     14 from sage.combinat.family import Family\n\n/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/sage/combinat/root_system/__init__.py in <module>()\n     11 import type_G\n     12 \n---> 13 import all\n     14 \n     15 \n\n/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/sage/combinat/root_system/all.py in <module>()\n----> 1 \n      2 \n      3 from associahedron import Associahedron\n      4 from cartan_type import CartanType\n      5 from dynkin_diagram import DynkinDiagram, dynkin_diagram\n      6 from cartan_matrix import cartan_matrix\n      7 from coxeter_matrix import coxeter_matrix\n\n/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/sage/combinat/root_system/associahedron.py in <module>()\n     24 from sage.modules.free_module_element import vector\n     25 \n---> 26 class Associahedron(Polyhedron):\n     27     r\"\"\"\n     28     The generalized associahedron is a polytopal complex with vertices in one-to-one correspondence\n\nTypeError: Error when calling the metaclass bases\n    function() argument 1 must be code, not str\nError importing ipy_profile_sage - perhaps you should run %upgrade?\nWARNING: Loading of ipy_profile_sage failed.\n```\n\nIs it because some new stuff merged in alpha8 uses old polyhedra code and was not converted?",
    "created_at": "2012-03-13T17:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127756",
    "user": "https://github.com/novoselt"
}
```

I am not entirely sure if something is wrong on my end, but when I apply the following patches to Sage-5.0.beta8

```
novoselt@sage ~/sage/devel/sage-main $ hg qapplied
trac_11599_no_circular_imports.patch
trac_11599_homset_new_coercion_model.patch
trac_11599_rename_morphisms.patch
trac_11599_toric_morphisms.patch
trac_11599_reviewer.patch
trac_11599_remove_class_suffix.patch
trac_11599_remaining_fixes.patch
trac_11599_numerical_noise.patch
trac_12159_separate_triangulation_file.patch
trac_12159_placing_triangulation.patch
trac_12159_normal_cone.patch
trac_11634-folded.patch
```

I get after trying to start Sage

```
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/sage/combinat/root_system/associahedron.py:22: DeprecationWarning: (Since Sage Version 4.8) The module sage.geometry.polyhedra has been removed, use sage.geometry.polyhedron instead.
  from sage.geometry.polyhedra import Polyhedron
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
| Sage Version 5.0.beta8, Release Date: 2012-03-13                   |
| Type notebook() for the GUI, and license() for information.        |
/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/IPython/ipmaker.pyc in force_import(modname, force_reload)
     61         reload(sys.modules[modname])
     62     else:
---> 63         __import__(modname)
     64         
     65 

/home/novoselt/sage-5.0.beta8/local/bin/ipy_profile_sage.py in <module>()
      5     preparser(True)
      6     
----> 7     import sage.all_cmdline
      8     sage.all_cmdline._init_cmdline(globals())
      9     

/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/sage/all_cmdline.py in <module>()
     12 try:
     13 
---> 14     from sage.all import *
     15     from sage.calculus.predefined import x
     16     preparser(on=True)

/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/sage/all.py in <module>()
     80 from sage.modules.all    import *
     81 from sage.monoids.all    import *
---> 82 from sage.algebras.all   import *
     83 from sage.modular.all    import *
     84 from sage.schemes.all    import *

/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/sage/algebras/all.py in <module>()
     34 from group_algebra_new import GroupAlgebra
     35 
---> 36 from iwahori_hecke_algebra import IwahoriHeckeAlgebraT
     37 from affine_nil_temperley_lieb import AffineNilTemperleyLiebTypeA
     38 from nil_coxeter_algebra import NilCoxeterAlgebra

/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/sage/algebras/iwahori_hecke_algebra.py in <module>()
     10 #*****************************************************************************
     11 from sage.categories.all import AlgebrasWithBasis, FiniteDimensionalAlgebrasWithBasis, CoxeterGroups
---> 12 import sage.combinat.root_system.cartan_type
     13 from sage.combinat.root_system.weyl_group import WeylGroup
     14 from sage.combinat.family import Family

/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/sage/combinat/root_system/__init__.py in <module>()
     11 import type_G
     12 
---> 13 import all
     14 
     15 

/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/sage/combinat/root_system/all.py in <module>()
----> 1 
      2 
      3 from associahedron import Associahedron
      4 from cartan_type import CartanType
      5 from dynkin_diagram import DynkinDiagram, dynkin_diagram
      6 from cartan_matrix import cartan_matrix
      7 from coxeter_matrix import coxeter_matrix

/home/novoselt/sage-5.0.beta8/local/lib/python2.7/site-packages/sage/combinat/root_system/associahedron.py in <module>()
     24 from sage.modules.free_module_element import vector
     25 
---> 26 class Associahedron(Polyhedron):
     27     r"""
     28     The generalized associahedron is a polytopal complex with vertices in one-to-one correspondence

TypeError: Error when calling the metaclass bases
    function() argument 1 must be code, not str
Error importing ipy_profile_sage - perhaps you should run %upgrade?
WARNING: Loading of ipy_profile_sage failed.
```

Is it because some new stuff merged in alpha8 uses old polyhedra code and was not converted?



---

archive/issue_comments_127757.json:
```json
{
    "body": "That must be new stuff that was merged in beta8",
    "created_at": "2012-03-13T17:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127757",
    "user": "https://github.com/vbraun"
}
```

That must be new stuff that was merged in beta8



---

archive/issue_comments_127758.json:
```json
{
    "body": "Needs to be rebased",
    "created_at": "2012-03-13T17:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127758",
    "user": "https://github.com/vbraun"
}
```

Needs to be rebased



---

archive/issue_comments_127759.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-03-13T17:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127759",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_127760.json:
```json
{
    "body": "I think this must be from \nhttp://trac.sagemath.org/sage_trac/ticket/10817",
    "created_at": "2012-03-13T17:25:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127760",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

I think this must be from 
http://trac.sagemath.org/sage_trac/ticket/10817



---

archive/issue_comments_127761.json:
```json
{
    "body": "Initial patch",
    "created_at": "2012-03-18T15:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127761",
    "user": "https://github.com/vbraun"
}
```

Initial patch



---

archive/issue_comments_127762.json:
```json
{
    "body": "Attachment [trac_11634_fix_sage_5_beta8.patch](tarball://root/attachments/some-uuid/ticket11634/trac_11634_fix_sage_5_beta8.patch) by @vbraun created at 2012-03-18 15:07:07\n\nI've added a patch that converts the new !Associahedron class to a PPL-based polyhedron",
    "created_at": "2012-03-18T15:07:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127762",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_11634_fix_sage_5_beta8.patch](tarball://root/attachments/some-uuid/ticket11634/trac_11634_fix_sage_5_beta8.patch) by @vbraun created at 2012-03-18 15:07:07

I've added a patch that converts the new !Associahedron class to a PPL-based polyhedron



---

archive/issue_comments_127763.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-18T15:07:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127763",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_127764.json:
```json
{
    "body": "Positive review to the new patch!",
    "created_at": "2012-03-19T21:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127764",
    "user": "https://github.com/novoselt"
}
```

Positive review to the new patch!



---

archive/issue_comments_127765.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-19T21:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127765",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_127766.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-03-23T15:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127766",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_011546.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-23T15:19:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11462#event-11546"
}
```



---

archive/issue_comments_127767.json:
```json
{
    "body": "Question (likely dumb): could the behavior at [this ask.sagemath question](http://ask.sagemath.org/question/23223/projection_direction-broken-for-polytopes/) be related to this change (or #14175)?  Thanks!",
    "created_at": "2014-07-06T01:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11462",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11462#issuecomment-127767",
    "user": "https://github.com/kcrisman"
}
```

Question (likely dumb): could the behavior at [this ask.sagemath question](http://ask.sagemath.org/question/23223/projection_direction-broken-for-polytopes/) be related to this change (or #14175)?  Thanks!
