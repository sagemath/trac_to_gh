# Issue 10348: Implementation of mutations for matrices

archive/issues_010348.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  hthomas@unb.ca\n\nKeywords: matrix mutation\n\nThis patch implements a method to mutate matrices. This method is needed for the cluster algebra and quiver package, see Ticket #10298.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10349\n\n",
    "created_at": "2010-11-27T23:13:35Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Implementation of mutations for matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10348",
    "user": "stumpc5"
}
```
Assignee: tbd

CC:  hthomas@unb.ca

Keywords: matrix mutation

This patch implements a method to mutate matrices. This method is needed for the cluster algebra and quiver package, see Ticket #10298.

Issue created by migration from https://trac.sagemath.org/ticket/10349





---

archive/issue_comments_106249.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-02-08T16:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106249",
    "user": "stumpc5"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_106250.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2011-02-08T16:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106250",
    "user": "stumpc5"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_106251.json:
```json
{
    "body": "For the buildbot:\n\nDepends on #10347.",
    "created_at": "2011-02-24T17:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106251",
    "user": "stumpc5"
}
```

For the buildbot:

Depends on #10347.



---

archive/issue_comments_106252.json:
```json
{
    "body": "Remove assignee tbd.",
    "created_at": "2011-06-10T14:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106252",
    "user": "stumpc5"
}
```

Remove assignee tbd.



---

archive/issue_comments_106253.json:
```json
{
    "body": "Hi Christian--\n\nWhat do you think about the idea of checking that 0 <= k < min(ncols,nrows)?  Your code is very nicely written to be safe even if someone tries to mutate a 2x2 matrix at row 15, but they shouldn't be doing that.  More importantly, they shouldn't be trying to mutate a 2n x n matrix at row j for n<= j < 2n -- for such a parameter, mutation is *undefined*.  Returning what looks like meaningful output in such a case is potentially deceptive.  (That's my view, at any rate, though if you disagree, I could be convinced otherwise.)  \n\nIt's also true that the principal part of B should be skew-symmetrizable, but I don't think it's necessary to check that -- though maybe it would be good to mention this in the documentation?  (The legit range of k values should also go in the documentation, I guess.)\n\nAnd, Zelevinsky :)\n\nOtherwise, though, it looks good.\n\ncheers,\n\nHugh",
    "created_at": "2011-06-12T09:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106253",
    "user": "@hughrthomas"
}
```

Hi Christian--

What do you think about the idea of checking that 0 <= k < min(ncols,nrows)?  Your code is very nicely written to be safe even if someone tries to mutate a 2x2 matrix at row 15, but they shouldn't be doing that.  More importantly, they shouldn't be trying to mutate a 2n x n matrix at row j for n<= j < 2n -- for such a parameter, mutation is *undefined*.  Returning what looks like meaningful output in such a case is potentially deceptive.  (That's my view, at any rate, though if you disagree, I could be convinced otherwise.)  

It's also true that the principal part of B should be skew-symmetrizable, but I don't think it's necessary to check that -- though maybe it would be good to mention this in the documentation?  (The legit range of k values should also go in the documentation, I guess.)

And, Zelevinsky :)

Otherwise, though, it looks good.

cheers,

Hugh



---

archive/issue_comments_106254.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-12T09:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106254",
    "user": "@hughrthomas"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_106255.json:
```json
{
    "body": "Oh, one more comment, in the doc-string, you have \"b-matrix\"; I'd prefer \"B-matrix\".    \n\ncheers\n\nHugh",
    "created_at": "2011-06-12T09:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106255",
    "user": "@hughrthomas"
}
```

Oh, one more comment, in the doc-string, you have "b-matrix"; I'd prefer "B-matrix".    

cheers

Hugh



---

archive/issue_comments_106256.json:
```json
{
    "body": "Dear Hugh,\n\nI added the changes you suggested -- thanks a lot for looking at it!\n\nChristian",
    "created_at": "2011-06-12T12:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106256",
    "user": "stumpc5"
}
```

Dear Hugh,

I added the changes you suggested -- thanks a lot for looking at it!

Christian



---

archive/issue_comments_106257.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-15T13:30:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106257",
    "user": "stumpc5"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_106258.json:
```json
{
    "body": "Replying to [comment:8 stumpc5]:\n\nI just pushed a new version which should be compatible with the #10347, if you also wanna have a look here...\n\nBest, Christian",
    "created_at": "2012-02-15T08:05:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106258",
    "user": "stumpc5"
}
```

Replying to [comment:8 stumpc5]:

I just pushed a new version which should be compatible with the #10347, if you also wanna have a look here...

Best, Christian



---

archive/issue_comments_106259.json:
```json
{
    "body": "I'll take a look.\n\ncheers,\n\nHugh",
    "created_at": "2012-02-15T12:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106259",
    "user": "@hughrthomas"
}
```

I'll take a look.

cheers,

Hugh



---

archive/issue_comments_106260.json:
```json
{
    "body": "Hi Christian--\n\nWhat's the point of declaring k to be of type Py_ssize_t?  I thought the point was that this would allow k to be huge, but in that case, it seems that you would get overflows when you run into the fact that i and j are declared to be integers.  \n\ncheers,\n\nHugh",
    "created_at": "2012-02-18T14:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106260",
    "user": "@hughrthomas"
}
```

Hi Christian--

What's the point of declaring k to be of type Py_ssize_t?  I thought the point was that this would allow k to be huge, but in that case, it seems that you would get overflows when you run into the fact that i and j are declared to be integers.  

cheers,

Hugh



---

archive/issue_comments_106261.json:
```json
{
    "body": "Otherwise, I am happy.  The patchbot was happy with this patch before, right?  So I assume that its present unhappiness (?) is unrelated to the patch itself, so I guess all that's left is the question in my previous comment.",
    "created_at": "2012-02-18T14:47:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106261",
    "user": "@hughrthomas"
}
```

Otherwise, I am happy.  The patchbot was happy with this patch before, right?  So I assume that its present unhappiness (?) is unrelated to the patch itself, so I guess all that's left is the question in my previous comment.



---

archive/issue_comments_106262.json:
```json
{
    "body": "Replying to [comment:13 hthomas]:\n> Hi Christian--\n> \n> What's the point of declaring k to be of type Py_ssize_t?  I thought the point was that this would allow k to be huge, but in that case, it seems that you would get overflows when you run into the fact that i and j are declared to be integers.  \n\nHi Hugh,\n\n`Py_ssize_t` is the recommended integer type for cython, see http://www.python.org/dev/peps/pep-0353/. In fact, in our current situation there is no advantage of using this type over using `int`. It is used all over in the code for matrices, see for example the method `get_unsafe` - that's why I also used it.",
    "created_at": "2012-02-18T15:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106262",
    "user": "stumpc5"
}
```

Replying to [comment:13 hthomas]:
> Hi Christian--
> 
> What's the point of declaring k to be of type Py_ssize_t?  I thought the point was that this would allow k to be huge, but in that case, it seems that you would get overflows when you run into the fact that i and j are declared to be integers.  

Hi Hugh,

`Py_ssize_t` is the recommended integer type for cython, see http://www.python.org/dev/peps/pep-0353/. In fact, in our current situation there is no advantage of using this type over using `int`. It is used all over in the code for matrices, see for example the method `get_unsafe` - that's why I also used it.



---

archive/issue_comments_106263.json:
```json
{
    "body": "Replying to [comment:16 stumpc5]:\n\nThen why not declare i,j,_ also to be the same type?  It seems to me that if it's ever useful to have chosen that type, you would also have needed i,j,_ to have been of that type.",
    "created_at": "2012-02-18T21:08:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106263",
    "user": "@hughrthomas"
}
```

Replying to [comment:16 stumpc5]:

Then why not declare i,j,_ also to be the same type?  It seems to me that if it's ever useful to have chosen that type, you would also have needed i,j,_ to have been of that type.



---

archive/issue_comments_106264.json:
```json
{
    "body": "Attachment [trac_10349_matrix_mutation-cs.patch](tarball://root/attachments/some-uuid/ticket10349/trac_10349_matrix_mutation-cs.patch) by stumpc5 created at 2012-02-19 13:51:54\n\ncontains matrix method mutate",
    "created_at": "2012-02-19T13:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106264",
    "user": "stumpc5"
}
```

Attachment [trac_10349_matrix_mutation-cs.patch](tarball://root/attachments/some-uuid/ticket10349/trac_10349_matrix_mutation-cs.patch) by stumpc5 created at 2012-02-19 13:51:54

contains matrix method mutate



---

archive/issue_comments_106265.json:
```json
{
    "body": "Replying to [comment:17 hthomas]:\n> Replying to [comment:16 stumpc5]:\n> \n> Then why not declare i,j,_ also to be the same type?  It seems to me that if it's ever useful to have chosen that type, you would also have needed i,j,_ to have been of that type.  \n\nDone!",
    "created_at": "2012-02-19T13:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106265",
    "user": "stumpc5"
}
```

Replying to [comment:17 hthomas]:
> Replying to [comment:16 stumpc5]:
> 
> Then why not declare i,j,_ also to be the same type?  It seems to me that if it's ever useful to have chosen that type, you would also have needed i,j,_ to have been of that type.  

Done!



---

archive/issue_comments_106266.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-22T01:42:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106266",
    "user": "@hughrthomas"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_106267.json:
```json
{
    "body": "Okay, then, I think it's ready.  \n\ncheers,\n\nHugh",
    "created_at": "2012-02-22T01:42:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106267",
    "user": "@hughrthomas"
}
```

Okay, then, I think it's ready.  

cheers,

Hugh



---

archive/issue_comments_106268.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-02-27T11:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106268",
    "user": "@jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_106269.json:
```json
{
    "body": "Hi!\n\nThis patch is merged in, and we want the cluster algebra material to get in. So this comment is for the future.\n\nThe functionality implemented in this ticket is rather specific to the context of cluster algebras. The average matrix user will have no clue what this is about, and might get confused with the unrelated concept of mutability (as in set_immutable). So I would recommend, in a later ticket, to:\n\n- Rename this method to something more specific like cluster_algebra_mutate\n  Maybe even move it into the cluster algebra library\n- Add a minimal description of what the method actually does\n- Add links to the cluster algebra library / tutorial (when it exists)\n- Add link to the _check_symmetrizability",
    "created_at": "2012-03-06T08:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10348",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10348#issuecomment-106269",
    "user": "@nthiery"
}
```

Hi!

This patch is merged in, and we want the cluster algebra material to get in. So this comment is for the future.

The functionality implemented in this ticket is rather specific to the context of cluster algebras. The average matrix user will have no clue what this is about, and might get confused with the unrelated concept of mutability (as in set_immutable). So I would recommend, in a later ticket, to:

- Rename this method to something more specific like cluster_algebra_mutate
  Maybe even move it into the cluster algebra library
- Add a minimal description of what the method actually does
- Add links to the cluster algebra library / tutorial (when it exists)
- Add link to the _check_symmetrizability
