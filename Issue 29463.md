# Issue 29463: ValueError raised when computing numerical approx of a matrix on QQbar

Issue created by migration from https://trac.sagemath.org/ticket/29700

Original creator: slabbe

Original creation time: 2020-05-17 13:43:43


```
sage: M = matrix(3,[1,1,1,1,0,0,0,1,0])
sage: A,B = M.diagonalization(QQbar)
sage: A.n()
```


gives


```python
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-122-26e33bb2b8a5> in <module>()
----> 1 A.n()

/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/structure/element.pyx in sage.structure.element.Element.n (build/cythonized/sage/structure/element.c:8037)()
    857             0.666666666666667
    858         """
--> 859         return self.numerical_approx(prec, digits, algorithm)
    860 
    861     def _mpmath_(self, prec=53, rounding=None):

/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/matrix/matrix2.pyx in sage.matrix.matrix2.Matrix.numerical_approx (build/cythonized/sage/matrix/matrix2.c:90568)()
  13685 
  13686         try:
> 13687             return self.change_ring(sage.rings.real_mpfr.RealField(prec))
  13688         except TypeError:
  13689             # try to return a complex result

...

/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/rings/qqbar.py in _element_constructor_(self, x)
   1067                 return x.real()
   1068             else:
-> 1069                 raise ValueError("Cannot coerce algebraic number with non-zero imaginary part to algebraic real")
   1070         elif hasattr(x, '_algebraic_'):
   1071             return x._algebraic_(AA)

ValueError: Cannot coerce algebraic number with non-zero imaginary part to algebraic real
```


Maybe we should do

```diff
-  13688         except TypeError:
+  13688         except (TypeError,ValueError):
```

in the file `sage/matrix/matrix2.pyx` ?


---

Comment by slabbe created at 2020-05-17 14:23:06

Changing status from new to needs_review.


---

Comment by slabbe created at 2020-05-17 14:23:06

New commits:


---

Comment by chapoton created at 2020-05-17 16:12:01

ok


---

Comment by chapoton created at 2020-05-17 16:12:01

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-05-29 21:16:11

Resolution: fixed
