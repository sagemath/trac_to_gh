# Issue 21372: bug in inequality of words

Issue created by migration from Trac.

Original creator: mantepse

Original creation time: 2016-09-28 21:05:54

CC:  abergeron saliola slabbe amyglen

Using 7.4.beta 6:


```
sage: shape1 = Word([1,2], alphabet=[1,2])
sage: shape2 = Word([1,1], alphabet=[1,2])
sage: shape1 == shape2
False
sage: shape1 != shape2
False
```



---

Comment by mantepse created at 2016-09-28 21:08:10

However:

```
sage: Word([1,1], alphabet=[1,2]) != Word([1,2], alphabet=[1,2])
True
```

???


---

Comment by tscrim created at 2016-09-28 23:32:10

It seems to be an issue with `WordDatatype_char.__richcmp__` in that if the `cmp` is non-zero, it needs to include 3 (which is `!=`):

```diff
         cdef int test = (<WordDatatype_char> self)._lexico_cmp(other)
         if test < 0:
             return op < 2 or op == 3
         elif test > 0:
-           return op > 3
+           return op >= 3
         else:
             return op == 1 or op == 2 or op == 5
```



---

Comment by mantepse created at 2016-09-29 09:40:17

Thank you Travis!  This worked, but I must say that I hate python.


---

Comment by mantepse created at 2016-09-29 09:42:53

Can you explain why it fails only when assigning to a variable?


---

Comment by slabbe created at 2016-09-29 09:45:34

Looking at the fix suggested by Travis, I believe the problem is not the variable but what is on the left side vs right side: `A != B` versus `B != A`.

I guess the problem comes from the recent upgrade of cmp to richcmp for Python 3 support done in #21435.


---

Comment by slabbe created at 2016-09-29 10:19:54

Hmmm, looking at this further. I do not think this bug was included by #21435. It seems to come from the original implementation of `WordDatatype_char`.

I can confirm this using [sagecell](https://sagecell.sagemath.org/) which runs 7.3:


```
shape1 = Word([1,2], alphabet=[1,2])
shape2 = Word([1,1], alphabet=[1,2])
print shape1 == shape2, "should be False"
print shape2 == shape1, "should be False"
print shape1 != shape2, "should be True"
print shape2 != shape1, "should be True"
print shape2 == shape2, "should be True"
print shape2 != shape2, "should be False"
print version()
```


returns


```
False should be False
False should be False
False should be True
True should be True
True should be True
False should be False
SageMath version 7.3, Release Date: 2016-08-04
```



---

Comment by slabbe created at 2016-09-29 10:45:14

Changing status from new to needs_review.


---

Comment by slabbe created at 2016-09-29 10:45:14

New commits:


---

Comment by mantepse created at 2016-09-29 12:03:07

Thanks for fixing.  I have a very minor suggestion.  Wouldn't it be more readable to code

```
        if test < 0:
            return op == 0 or op == 1 or op == 3
        elif test > 0:
            return op == 3 or op == 4 or op == 5
        else:
            return op == 1 or op == 2 or op == 5
```



---

Comment by slabbe created at 2016-09-29 13:24:51

Yes, I agree.
But, a little bit less efficient if op == 5 when test >0 for instance...

I must leave now to take a train, I won't have acces to internet until monday.


---

Comment by tscrim created at 2016-09-29 14:14:04

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2016-09-29 14:14:04

I agree that it is a reasonable shortcut to sacrifice the slight bit of readability, but considering the comparison types are (arbitrarily) assigned integers, readability is already somewhat out the window...


---

Comment by vbraun created at 2016-10-05 22:41:46

Resolution: fixed
