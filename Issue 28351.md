# Issue 28351: Submultiset is broken

Issue created by migration from https://trac.sagemath.org/ticket/28588

Original creator: mantepse

Original creation time: 2019-10-10 16:48:36

CC:  chapoton

The documentation says:

    Finally the option ``submultiset`` allows one to deal with sets with
    repeated elements, usually called multisets. The method then
    returns the class of all multisets in which every element is
    contained at most as often as it is contained in ``s``. These
    multisets are encoded as lists.

However:

```
sage: Subsets([3,2,2], submultiset=True).list()
[[], [3], [2], [3, 3], [3, 2], [3, 3, 2]]
```



---

Comment by mantepse created at 2019-10-10 17:05:40

I think the problem is here (in `class SubMultiset_sk(SubMultiset_s)`):

```
    def __iter__(self):
        from sage.combinat.integer_vector import IntegerVectors
        elts = self._keys
        for iv in IntegerVectors(self._k, len(self._d),
                                 outer=list(self._d.values())):
            yield sum([[elts[i]] * iv[i] for i in range(len(iv))], [])
```

The list `self._keys` is produced by `list_to_dict` in the same file:

```
def list_to_dict(l):
    d = {}
    keys = []
    for elt in l:
        if elt not in d:
            d[elt] = 0
            keys.append(elt)
        d[elt] += 1
    return d, keys

```

In `__iter__` it is assumed that `keys()` of the dict returned here is the same as `keys`, which is not the case.

Should I simply change

```
        elts = self._keys
```

to

```
        elts = self._d.keys()
```

?


---

Comment by mantepse created at 2019-10-10 20:05:31

Changing status from new to needs_review.


---

Comment by mantepse created at 2019-10-10 20:05:31

New commits:


---

Comment by tscrim created at 2019-10-11 01:19:42

LGTM.


---

Comment by tscrim created at 2019-10-11 01:19:42

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-10-13 09:31:25

Resolution: fixed
