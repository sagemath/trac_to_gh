# Issue 18924: LatticePoset: faster is_complemented()

archive/issues_018924.json:
```json
{
    "body": "CC:  mlapointe @nadialafreniere\n\nAs playing with matrices is much faster than looping over elements, this patch makes `is_complemented()` much faster.\n\nLet `L10` bet the list of all lattices of 10 elements and `B10` be the Boolean lattice with `2^10` elements. Then without the patch it takes 7,76 seconds to run `len([L for L in L10 if L.is_complemented()])` and 101,84 seconds to run `L.is_complemented()`. With the patch the time reduces to 0,38 and 0,23 seconds.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19161\n\n",
    "created_at": "2015-09-08T07:56:36Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "LatticePoset: faster is_complemented()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18924",
    "user": "https://github.com/jm58660"
}
```
CC:  mlapointe @nadialafreniere

As playing with matrices is much faster than looping over elements, this patch makes `is_complemented()` much faster.

Let `L10` bet the list of all lattices of 10 elements and `B10` be the Boolean lattice with `2^10` elements. Then without the patch it takes 7,76 seconds to run `len([L for L in L10 if L.is_complemented()])` and 101,84 seconds to run `L.is_complemented()`. With the patch the time reduces to 0,38 and 0,23 seconds.

Issue created by migration from https://trac.sagemath.org/ticket/19161





---

archive/issue_comments_258981.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-08T07:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258981",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_258982.json:
```json
{
    "body": "Nathann, want an easy review?\n----\nNew commits:",
    "created_at": "2015-09-08T07:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258982",
    "user": "https://github.com/jm58660"
}
```

Nathann, want an easy review?
----
New commits:



---

archive/issue_comments_258983.json:
```json
{
    "body": "HMmmm... The speedup is cool, but the algorithm is slightly less clear. Is it slower to do it like that:\n\n\n```\nfrom itertools import izip\nfor row1,row2 in izip(meet,join):\n    for c1,c2 in izip(row1,row2):\n        if c1==0 and c2==n-1:\n            break\n    else:\n        retun False\nreturn True\n```\n\n\nSorry but it is a bit hard for me to try it today: I burned the two main fingers of my right hand while cooking, and I type mostly with my left hand `:-/`\n\nNathann",
    "created_at": "2015-09-08T09:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258983",
    "user": "https://github.com/nathanncohen"
}
```

HMmmm... The speedup is cool, but the algorithm is slightly less clear. Is it slower to do it like that:


```
from itertools import izip
for row1,row2 in izip(meet,join):
    for c1,c2 in izip(row1,row2):
        if c1==0 and c2==n-1:
            break
    else:
        retun False
return True
```


Sorry but it is a bit hard for me to try it today: I burned the two main fingers of my right hand while cooking, and I type mostly with my left hand `:-/`

Nathann



---

archive/issue_comments_258984.json:
```json
{
    "body": "Replying to [comment:4 ncohen]:\n\n>Is it slower to do it like that:\n\nIt depends. For `B10`-example your algorithm is clearly faster, it takes about half of the time of matrix-based algorithm. And for the `L10`-example it is twise slower. I guess that your is better, but I will check that with some more tests.\n \n> Sorry but it is a bit hard for me to try it today: I burned the two main fingers of my right hand while cooking, and I type mostly with my left hand `:-/`\n\nUse professionals. Eat at MacDonalds.",
    "created_at": "2015-09-08T10:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258984",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:4 ncohen]:

>Is it slower to do it like that:

It depends. For `B10`-example your algorithm is clearly faster, it takes about half of the time of matrix-based algorithm. And for the `L10`-example it is twise slower. I guess that your is better, but I will check that with some more tests.
 
> Sorry but it is a bit hard for me to try it today: I burned the two main fingers of my right hand while cooking, and I type mostly with my left hand `:-/`

Use professionals. Eat at MacDonalds.



---

archive/issue_comments_258985.json:
```json
{
    "body": "> It depends. For `B10`-example your algorithm is clearly faster, it takes about half of the time of matrix-based algorithm. And for the `L10`-example it is twise slower. I guess that your is better, but I will check that with some more tests.\n\nHmmmm.. I do not know what to think of it. It \"may\" answer \"no\" slightly faster, but then iterators are not free. Sigh. That would be straightforward in C with real arrays, and not those unreliable matrices `-_-`\n\n> Use professionals. Eat at MacDonalds.\n\nAhah.\n\nNathann",
    "created_at": "2015-09-08T10:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258985",
    "user": "https://github.com/nathanncohen"
}
```

> It depends. For `B10`-example your algorithm is clearly faster, it takes about half of the time of matrix-based algorithm. And for the `L10`-example it is twise slower. I guess that your is better, but I will check that with some more tests.

Hmmmm.. I do not know what to think of it. It "may" answer "no" slightly faster, but then iterators are not free. Sigh. That would be straightforward in C with real arrays, and not those unreliable matrices `-_-`

> Use professionals. Eat at MacDonalds.

Ahah.

Nathann



---

archive/issue_comments_258986.json:
```json
{
    "body": "That was fast to test. Matrix-based loses by factor of 6 when going through posets of size 11.\n\n(About food: When you want a car, do you go to mine to get some iron ore? Why should it be different with food? `:=)` (But my wife has different opinion on that...))",
    "created_at": "2015-09-08T10:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258986",
    "user": "https://github.com/jm58660"
}
```

That was fast to test. Matrix-based loses by factor of 6 when going through posets of size 11.

(About food: When you want a car, do you go to mine to get some iron ore? Why should it be different with food? `:=)` (But my wife has different opinion on that...))



---

archive/issue_comments_258987.json:
```json
{
    "body": "> That was fast to test. Matrix-based loses by factor of 6 when going through posets of size 11.\n\nBoth are matrix based, so I do not know what you have in mind. Keep the one that is the fastest, and if it is the current one then consider it in `positive_review`, provided that tests pass (the patchbot still silent).\n\n> (About food: When you want a car, do you go to mine to get some iron ore? Why should it be different with food? `:=)` (But my wife has different opinion on that...))\n\nShe has a different opinion about mining? Amazing.\n\nIn the case at hand (if I may say), I do not see the need to generalize to cooking in general. Let me just hope that I will not make the same mistake, with the same hand, tomorrow morning.\n\nNathann",
    "created_at": "2015-09-08T11:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258987",
    "user": "https://github.com/nathanncohen"
}
```

> That was fast to test. Matrix-based loses by factor of 6 when going through posets of size 11.

Both are matrix based, so I do not know what you have in mind. Keep the one that is the fastest, and if it is the current one then consider it in `positive_review`, provided that tests pass (the patchbot still silent).

> (About food: When you want a car, do you go to mine to get some iron ore? Why should it be different with food? `:=)` (But my wife has different opinion on that...))

She has a different opinion about mining? Amazing.

In the case at hand (if I may say), I do not see the need to generalize to cooking in general. Let me just hope that I will not make the same mistake, with the same hand, tomorrow morning.

Nathann



---

archive/issue_comments_258988.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-08T11:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258988",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258989.json:
```json
{
    "body": "Replying to [comment:8 ncohen]:\n\n> > That was fast to test. Matrix-based loses by factor of 6 when going through posets of size 11.\n> \n> Both are matrix based, so I do not know what you have in mind.\n\nI meant that mine was \"matrix-based\", i.e. the speed come from speed of matrix operations.\n\n> Keep the one that is the fastest\n\nYour implementation is faster.\n\nM\u00e9lodie, can you review this? The code is now mostly from Nathann, but if it does not work, it might also be that I have made a mistake.\n\n> She has a different opinion about mining? Amazing.\n\n`;=)`",
    "created_at": "2015-09-08T11:19:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258989",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:8 ncohen]:

> > That was fast to test. Matrix-based loses by factor of 6 when going through posets of size 11.
> 
> Both are matrix based, so I do not know what you have in mind.

I meant that mine was "matrix-based", i.e. the speed come from speed of matrix operations.

> Keep the one that is the fastest

Your implementation is faster.

Mélodie, can you review this? The code is now mostly from Nathann, but if it does not work, it might also be that I have made a mistake.

> She has a different opinion about mining? Amazing.

`;=)`



---

archive/issue_comments_258990.json:
```json
{
    "body": "HMmmmm... Factor 6?... `O_o`\n\nWeird, weird... `:-/`",
    "created_at": "2015-09-08T11:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258990",
    "user": "https://github.com/nathanncohen"
}
```

HMmmmm... Factor 6?... `O_o`

Weird, weird... `:-/`



---

archive/issue_comments_258991.json:
```json
{
    "body": "Replying to [comment:11 ncohen]:\n> HMmmmm... Factor 6?... `O_o`\n> \n> Weird, weird... `:-/`\n\nNot really. Original code checks ALL element pairs. My code takes one element, and kind of check it against all other elements, and stops when an element has no complement. Your code jumps to next element when it founds a complement and return `False` if it found an element without the complement.\n\nEven your code is not optimal, because meet and join are commutative operations. But it may be slower to optimize that, because the code would be more complicated.\n\nIn any case, this is now quite fast and IMO ready for review.",
    "created_at": "2015-09-08T12:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258991",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:11 ncohen]:
> HMmmmm... Factor 6?... `O_o`
> 
> Weird, weird... `:-/`

Not really. Original code checks ALL element pairs. My code takes one element, and kind of check it against all other elements, and stops when an element has no complement. Your code jumps to next element when it founds a complement and return `False` if it found an element without the complement.

Even your code is not optimal, because meet and join are commutative operations. But it may be slower to optimize that, because the code would be more complicated.

In any case, this is now quite fast and IMO ready for review.



---

archive/issue_comments_258992.json:
```json
{
    "body": "Hi Jori,\nI'm M\u00e9lodie's colleague and I reviewed the graph documentation ticket with her.\n\nAbout your new ticket, now.\n\n\n```diff\n+        n = self.cardinality()-1\n+        for row1,row2 in izip(mt, jn):\n+            for c1,c2 in izip(row1,row2):\n+                if c1==0 and c2==n:\n```\n\n\nYou should respect the Python / Sage conventions and add spaces before and after binary operators of the lowest priority : `self.cardinality() - 1`, `c1  == 0`, etc. This includes equality and assignments.\n\nAs well, there should be spaces after every coma sign:  `row1, row2`, `c1, c2`, `izip(row1, row2)`. For more info on these conventions, see http://doc.sagemath.org/html/en/developer/coding_basics.html#python-code-style",
    "created_at": "2015-09-08T17:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258992",
    "user": "https://github.com/nadialafreniere"
}
```

Hi Jori,
I'm Mélodie's colleague and I reviewed the graph documentation ticket with her.

About your new ticket, now.


```diff
+        n = self.cardinality()-1
+        for row1,row2 in izip(mt, jn):
+            for c1,c2 in izip(row1,row2):
+                if c1==0 and c2==n:
```


You should respect the Python / Sage conventions and add spaces before and after binary operators of the lowest priority : `self.cardinality() - 1`, `c1  == 0`, etc. This includes equality and assignments.

As well, there should be spaces after every coma sign:  `row1, row2`, `c1, c2`, `izip(row1, row2)`. For more info on these conventions, see http://doc.sagemath.org/html/en/developer/coding_basics.html#python-code-style



---

archive/issue_comments_258993.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-09-08T17:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258993",
    "user": "https://github.com/nadialafreniere"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_258994.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-08T18:32:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258994",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258995.json:
```json
{
    "body": "Replying to [comment:13 nadialafreniere]:\n\n> I'm M\u00e9lodie's colleague and I reviewed the graph documentation ticket with her.\n\nThanks! I did the changes.",
    "created_at": "2015-09-08T18:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258995",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:13 nadialafreniere]:

> I'm Mélodie's colleague and I reviewed the graph documentation ticket with her.

Thanks! I did the changes.



---

archive/issue_comments_258996.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-09-08T18:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258996",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_258997.json:
```json
{
    "body": "Most of the things look fine. One last thing: I know you didn't touch to this, but the examples should also respect the python conventions. Therefore, I'm hoping to see a space after each of the commas.\n\n\n```\nsage: L = LatticePoset({0:[1,2,3],1:[4],2:[4],3:[4]})\n```\n\n\n```\nsage: L = LatticePoset({0:[1,2],1:[3],2:[3],3:[4]})\n```\n\n\nshould look like\n\n```\nsage: L = LatticePoset({0:[1, 2, 3], 1:[4], 2:[4], 3:[4]})\n```\n",
    "created_at": "2015-09-08T21:36:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258997",
    "user": "https://github.com/nadialafreniere"
}
```

Most of the things look fine. One last thing: I know you didn't touch to this, but the examples should also respect the python conventions. Therefore, I'm hoping to see a space after each of the commas.


```
sage: L = LatticePoset({0:[1,2,3],1:[4],2:[4],3:[4]})
```


```
sage: L = LatticePoset({0:[1,2],1:[3],2:[3],3:[4]})
```


should look like

```
sage: L = LatticePoset({0:[1, 2, 3], 1:[4], 2:[4], 3:[4]})
```




---

archive/issue_comments_258998.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-09-08T21:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258998",
    "user": "https://github.com/nadialafreniere"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_258999.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-09T04:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-258999",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_259000.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-09-09T04:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-259000",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_259001.json:
```json
{
    "body": "Replying to [comment:16 nadialafreniere]:\n\n> - - but the examples should also respect the python conventions. Therefore, I'm hoping to see a space after each of the commas.\n\nDone this.",
    "created_at": "2015-09-09T04:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-259001",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:16 nadialafreniere]:

> - - but the examples should also respect the python conventions. Therefore, I'm hoping to see a space after each of the commas.

Done this.



---

archive/issue_comments_259002.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-09-09T05:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-259002",
    "user": "https://github.com/nadialafreniere"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_259003.json:
```json
{
    "body": "Replying to [comment:19 jmantysalo]:\n> Replying to [comment:16 nadialafreniere]:\n> \n> > - - but the examples should also respect the python conventions. Therefore, I'm hoping to see a space after each of the commas.\n> \n> Done this.\n\n\n\nEverything looks fine!",
    "created_at": "2015-09-09T05:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-259003",
    "user": "https://github.com/nadialafreniere"
}
```

Replying to [comment:19 jmantysalo]:
> Replying to [comment:16 nadialafreniere]:
> 
> > - - but the examples should also respect the python conventions. Therefore, I'm hoping to see a space after each of the commas.
> 
> Done this.



Everything looks fine!



---

archive/issue_comments_259004.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-09-09T22:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18924#issuecomment-259004",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_053223.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-09-09T22:14:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18924",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18924#event-53223"
}
```
