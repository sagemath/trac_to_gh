# Issue 16430: Random failure in polynomial_element.pyx

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2014-07-16 19:48:10

CC:  jpflori defeo pbruin sbesnier

This doctest was introduced in #16162. It fails quite reliably (maybe 80% of the runs) on the AIMS snapperkob (Ubuntu 14.04 x86_64) buildbot:

```
sage: K.<a> = GF(2**8) ## line 1416 ##
sage: x = polygen(K) ## line 1417 ##
sage: alarm(1) ## line 1418 ##
sage: (x**1000000+x+a).any_root() ## line 1419 ##

**********************************************************************
----------------------------------------------------------------------
sage -t --long src/sage/rings/polynomial/polynomial_element.pyx  # Timed out (and interrupt failed)
```



---

Comment by jpflori created at 2014-07-17 08:55:43

In fact such a test would have failed before #16162...
Not sure why the interrupt does not get caught here, maybe the code needs a little more sig_on/sig_off.


---

Comment by vbraun created at 2014-07-25 05:01:30

Changing keywords from "" to "random_fail".


---

Comment by rws created at 2014-07-25 06:12:06

On OpenSuSE 6.3beta6 these 4 lines make it go into nirvana with 0% CPU. Is this expected?


---

Comment by vbraun created at 2014-07-25 14:08:06

No, it should abort after 1 second due to the alarm. Can you debug it? "sage -gdb", press Ctrl-C after it is stuck, run "bt" and "cy bt".


---

Comment by rws created at 2014-07-25 15:01:54

Dang, can't reproduce, even without gdb.


---

Comment by leif created at 2014-08-05 15:09:29

Got exactly the same (in `ptestlong`) on Ubuntu 10.04.4 x86_64 (with GCC 4.9.1), kernel 3.0.0, Sage 6.3.rc0.

Passes when run separately (on a heavily-loaded machine).


---

Comment by jdemeyer created at 2014-08-18 19:54:04

I can reproduce this easily on my laptop with `alarm(0.1)` instead of `alarm(1)`. I will try to debug this...


---

Comment by jdemeyer created at 2014-08-18 19:56:08

Changing keywords from "random_fail" to "random_fail interrupt".


---

Comment by jdemeyer created at 2014-08-18 20:56:57

The bad interrupt happens in `malloc()`, which is hard to fix:

```
/usr/local/src/sage-config/local/lib/libcsage.so(print_backtrace+0x31)[0x7ff45666d805]
/usr/local/src/sage-config/local/lib/libcsage.so(sage_interrupt_handler+0x70)[0x7ff45666cea7]
/lib64/libpthread.so.0(+0x10bf0)[0x7ff45c1f4bf0]
/lib64/libc.so.6(+0x7f09e)[0x7ff45b7c609e]
/lib64/libc.so.6(__libc_malloc+0x75)[0x7ff45b7c84d5]
/usr/local/src/sage-config/local/lib/libntl.so.3(_ntl_gblock_construct_alloc+0x11c)[0x7ff456156bec]
/usr/local/src/sage-config/local/lib/libntl.so.3(_ZN3NTL14BlockConstructEPNS_4ZZ_pEl+0x46)[0x7ff4561b01b6]
/usr/local/src/sage-config/local/lib/libcsage.so(_ZN3NTL3VecINS_4ZZ_pEE11DoSetLengthEl+0x155)[0x7ff45667355b]
/usr/local/src/sage-config/local/lib/libntl.so.3(_ZN3NTL5ZZ_pEC1Ev+0x22)[0x7ff45611ac22]
/usr/local/src/sage-config/local/lib/libcsage.so(_ZN3NTL14BlockConstructINS_5ZZ_pEEEEvPT_l+0x43)[0x7ff4566741cf]
/usr/local/src/sage-config/local/lib/libcsage.so(_ZN3NTL3VecINS_5ZZ_pEEE11DoSetLengthEl+0x155)[0x7ff456673c67]
/usr/local/src/sage-config/local/lib/libntl.so.3(_ZN3NTL9LeftShiftERNS_6ZZ_pEXERKS0_l+0x79)[0x7ff456121099]
```



---

Comment by jdemeyer created at 2014-08-18 21:55:21

Changing status from new to needs_review.


---

Comment by pbruin created at 2014-08-19 12:26:31

So there were two "interruptability" problems: the fact that `any_root()` could not be interrupted (#16162) and the havoc caused by interrupting `malloc()` in the preceding computation of the polynomial (#16850).  This ticket nicely separates them in the doctest.
----
New commits:


---

Comment by pbruin created at 2014-08-19 12:26:31

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-08-20 08:35:55

Resolution: fixed
