# Issue 29435: spkg-configure.m4 for palp

archive/issues_029435.json:
```json
{
    "body": "CC:  @orlitzky @mkoeppe @enriqueartal @isuruf @vbraun\n\nit should be easy - it's a stable package, with just binary executables and data.\n\nIn debian it is called `palp`\n\nIssue created by migration from https://trac.sagemath.org/ticket/29672\n\n",
    "created_at": "2020-05-10T19:24:21Z",
    "labels": [
        "build: configure",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "spkg-configure.m4 for palp",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29435",
    "user": "@dimpase"
}
```
CC:  @orlitzky @mkoeppe @enriqueartal @isuruf @vbraun

it should be easy - it's a stable package, with just binary executables and data.

In debian it is called `palp`

Issue created by migration from https://trac.sagemath.org/ticket/29672





---

archive/issue_comments_417693.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-05-11T17:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417693",
    "user": "@dimpase"
}
```

New commits:



---

archive/issue_comments_417694.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-05-11T17:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417694",
    "user": "@dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_417695.json:
```json
{
    "body": "The reason I haven't included this in Gentoo yet is because sage builds optimized versions of the `class.x`, `cws.x`, `nef.x`, and `poly.x` executables -- and then installs them with nonstandard names.\n\nEditing `Global.h` to define `POLY_Dmax` is what upstream recommends, but the names of the resulting binaries are always e.g. `class.x` when you do that. Sage then renames them too e.g. `class-4d.x`. I don't want to include the nonstandard executables in a distro package just to make sage (which isn't even in the tree yet) happy.\n\nDoes anyone know if upstream is still interested in making source improvements? It might be easy to consolidate these into one executable by having each `foo.x` dispatch to one of several optimized functions rather than having the user (i.e. sage) dispatch to one of several different optimized executables. That depends it being easy to infer `POLY_Dmax` from the input, of course. Otherwise, we could at least ask that the build system standardize on these names and actually build the optimized executables.",
    "created_at": "2020-05-12T15:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417695",
    "user": "@orlitzky"
}
```

The reason I haven't included this in Gentoo yet is because sage builds optimized versions of the `class.x`, `cws.x`, `nef.x`, and `poly.x` executables -- and then installs them with nonstandard names.

Editing `Global.h` to define `POLY_Dmax` is what upstream recommends, but the names of the resulting binaries are always e.g. `class.x` when you do that. Sage then renames them too e.g. `class-4d.x`. I don't want to include the nonstandard executables in a distro package just to make sage (which isn't even in the tree yet) happy.

Does anyone know if upstream is still interested in making source improvements? It might be easy to consolidate these into one executable by having each `foo.x` dispatch to one of several optimized functions rather than having the user (i.e. sage) dispatch to one of several different optimized executables. That depends it being easy to infer `POLY_Dmax` from the input, of course. Otherwise, we could at least ask that the build system standardize on these names and actually build the optimized executables.



---

archive/issue_comments_417696.json:
```json
{
    "body": "I think I forgot to write this: in `sage/geometry/polyhedron/palp_database.py`, we have\n\n\n```\n        return Popen(['class-4d.x', '-He',\n```\n\n\nso Sage does use at least use *that* nonstandard name, and this script needs to check for it. I'm not sure if that will affect any of the other distros.",
    "created_at": "2020-05-12T16:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417696",
    "user": "@orlitzky"
}
```

I think I forgot to write this: in `sage/geometry/polyhedron/palp_database.py`, we have


```
        return Popen(['class-4d.x', '-He',
```


so Sage does use at least use *that* nonstandard name, and this script needs to check for it. I'm not sure if that will affect any of the other distros.



---

archive/issue_comments_417697.json:
```json
{
    "body": "Debian has essentially the same naming scheme for palp's programs in its package.\n\nFedora as well.",
    "created_at": "2020-05-12T21:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417697",
    "user": "@dimpase"
}
```

Debian has essentially the same naming scheme for palp's programs in its package.

Fedora as well.



---

archive/issue_comments_417698.json:
```json
{
    "body": "Replying to [comment:4 dimpase]:\n> Debian has essentially the same naming scheme for palp's programs in its package.\n> \n> Fedora as well.\n\nIf all of the major distros are using the same convoluted build process to achieve a consistent naming scheme, then to me that still suggests that we should upstream that build process. It's hard for me to justify building the same package four times and installing a bunch of executables with non-standard names just to make the test suite of another package that's not even in the tree pass.\n\nIn lieu of some agreement, I'll probably add a fallback to sagelib so that it uses `class.x` instead of `class-4d.x` when the latter isn't present (like we did with nauty). That will allow sage to keep working with the \"out of the box\" version of palp.",
    "created_at": "2020-05-19T14:00:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417698",
    "user": "@orlitzky"
}
```

Replying to [comment:4 dimpase]:
> Debian has essentially the same naming scheme for palp's programs in its package.
> 
> Fedora as well.

If all of the major distros are using the same convoluted build process to achieve a consistent naming scheme, then to me that still suggests that we should upstream that build process. It's hard for me to justify building the same package four times and installing a bunch of executables with non-standard names just to make the test suite of another package that's not even in the tree pass.

In lieu of some agreement, I'll probably add a fallback to sagelib so that it uses `class.x` instead of `class-4d.x` when the latter isn't present (like we did with nauty). That will allow sage to keep working with the "out of the box" version of palp.



---

archive/issue_comments_417699.json:
```json
{
    "body": "yes, assuming upstream is sensible. I spent a lot of time convincing upstreams to accept patches, it is often frustrating.",
    "created_at": "2020-05-19T15:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417699",
    "user": "@dimpase"
}
```

yes, assuming upstream is sensible. I spent a lot of time convincing upstreams to accept patches, it is often frustrating.



---

archive/issue_comments_417700.json:
```json
{
    "body": "I sent the maintainer a cleanup patch for the makefile, so I'll get some sort of impression soon enough.",
    "created_at": "2020-05-19T18:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417700",
    "user": "@orlitzky"
}
```

I sent the maintainer a cleanup patch for the makefile, so I'll get some sort of impression soon enough.



---

archive/issue_comments_417701.json:
```json
{
    "body": "It turns out that the only place class-4d.x is even used is in an optional test for a huge, old-style SPKG that hasn't been ported yet (#26029). The nonstandard names are thus quite likely to be completely unused.",
    "created_at": "2020-05-19T23:42:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417701",
    "user": "@orlitzky"
}
```

It turns out that the only place class-4d.x is even used is in an optional test for a huge, old-style SPKG that hasn't been ported yet (#26029). The nonstandard names are thus quite likely to be completely unused.



---

archive/issue_comments_417702.json:
```json
{
    "body": "Just kidding, the names of the executables are mangled on the fly. In `geometry/lattice_polytope.py`,\n\n\n```\ndef set_palp_dimension(d):\n    ...\n    global _palp_dimension\n    _palp_dimension = d\n\ndef _palp(command, polytopes, reduce_dimension=False):\n    ...\n    if _palp_dimension is not None:\n        dot = command.find(\".\")\n        command = command[:dot] + \"-%dd\" % _palp_dimension + command[dot:]\n```\n\n\nI give up.",
    "created_at": "2020-05-19T23:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417702",
    "user": "@orlitzky"
}
```

Just kidding, the names of the executables are mangled on the fly. In `geometry/lattice_polytope.py`,


```
def set_palp_dimension(d):
    ...
    global _palp_dimension
    _palp_dimension = d

def _palp(command, polytopes, reduce_dimension=False):
    ...
    if _palp_dimension is not None:
        dot = command.find(".")
        command = command[:dot] + "-%dd" % _palp_dimension + command[dot:]
```


I give up.



---

archive/issue_comments_417703.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-05-19T23:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417703",
    "user": "@orlitzky"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_417704.json:
```json
{
    "body": "In light of that, you should check all 16 combinations of executable names `(poly, class, nef cws) x (4,5,6 11)` in the spkg-configure.m4. I started a branch at u/mjo/ticket/29672 that checks for `class-4d.x` and substitutes `class.x` in its place, but I'm not going to spend three days doing it for the other 15 names.",
    "created_at": "2020-05-19T23:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417704",
    "user": "@orlitzky"
}
```

In light of that, you should check all 16 combinations of executable names `(poly, class, nef cws) x (4,5,6 11)` in the spkg-configure.m4. I started a branch at u/mjo/ticket/29672 that checks for `class-4d.x` and substitutes `class.x` in its place, but I'm not going to spend three days doing it for the other 15 names.



---

archive/issue_comments_417705.json:
```json
{
    "body": "Volker, you're a `palp` user - could you comment on the naming schemes for `palp` executables?",
    "created_at": "2020-05-20T09:42:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417705",
    "user": "@dimpase"
}
```

Volker, you're a `palp` user - could you comment on the naming schemes for `palp` executables?



---

archive/issue_comments_417706.json:
```json
{
    "body": "Replying to [comment:10 mjo]:\n> In light of that, you should check all 16 combinations of executable names `(poly, class, nef cws) x (4,5,6 11)` in the spkg-configure.m4. I started a branch at u/mjo/ticket/29672 that checks for `class-4d.x` and substitutes `class.x` in its place, but I'm not going to spend three days doing it for the other 15 names.\n\nOK, I'll try my hand in nested m4 loops :-)",
    "created_at": "2020-05-21T09:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417706",
    "user": "@dimpase"
}
```

Replying to [comment:10 mjo]:
> In light of that, you should check all 16 combinations of executable names `(poly, class, nef cws) x (4,5,6 11)` in the spkg-configure.m4. I started a branch at u/mjo/ticket/29672 that checks for `class-4d.x` and substitutes `class.x` in its place, but I'm not going to spend three days doing it for the other 15 names.

OK, I'll try my hand in nested m4 loops :-)



---

archive/issue_comments_417707.json:
```json
{
    "body": "Replying to [comment:7 mjo]:\n> I sent the maintainer a cleanup patch for the makefile, so I'll get some sort of impression soon enough.\n\nHarald Skarke just merged these patches. It probably wouldn't be hard to fix the naming issue if everyone can agree on a solution.\n\nI think having one executable (e.g. `class.x`) dispatch to the proper routine is clearly preferable, *if* the dimension can be determined quickly enough to do so. This avoids invalidating the examples in the paper (https://arxiv.org/abs/math/0204356) unnecessarily, and doesn't pollute `/usr/bin` with four copies of the same programs.",
    "created_at": "2020-05-21T13:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417707",
    "user": "@orlitzky"
}
```

Replying to [comment:7 mjo]:
> I sent the maintainer a cleanup patch for the makefile, so I'll get some sort of impression soon enough.

Harald Skarke just merged these patches. It probably wouldn't be hard to fix the naming issue if everyone can agree on a solution.

I think having one executable (e.g. `class.x`) dispatch to the proper routine is clearly preferable, *if* the dimension can be determined quickly enough to do so. This avoids invalidating the examples in the paper (https://arxiv.org/abs/math/0204356) unnecessarily, and doesn't pollute `/usr/bin` with four copies of the same programs.



---

archive/issue_comments_417708.json:
```json
{
    "body": "So, what's going to change once these merged upstream patches are in distros?",
    "created_at": "2020-05-25T10:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417708",
    "user": "@dimpase"
}
```

So, what's going to change once these merged upstream patches are in distros?



---

archive/issue_comments_417709.json:
```json
{
    "body": "Replying to [comment:15 dimpase]:\n> So, what's going to change once these merged upstream patches are in distros?\n\nProbably nothing, the series I sent only ensures that CC, LDFLAGS, CFLAGS, CPPFLAGS are supported out of the box.",
    "created_at": "2020-05-25T13:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417709",
    "user": "@orlitzky"
}
```

Replying to [comment:15 dimpase]:
> So, what's going to change once these merged upstream patches are in distros?

Probably nothing, the series I sent only ensures that CC, LDFLAGS, CFLAGS, CPPFLAGS are supported out of the box.



---

archive/issue_comments_417710.json:
```json
{
    "body": "I just made a port of palm for FreeBSD, based upon build/pkgs/palp/spkg-install.in, but I do not see any data in it. The resulting MANIFEST (relative to $PREFIX) is:\n\n\n\n```\nbin/class-11d.x\nbin/class-4d.x\nbin/class-5d.x\nbin/class-6d.x\nbin/class.x\nbin/cws-11d.x\nbin/cws-4d.x\nbin/cws-5d.x\nbin/cws-6d.x\nbin/cws.x\nbin/mori-11d.x\nbin/mori-4d.x\nbin/mori-5d.x\nbin/mori-6d.x\nbin/mori.x\nbin/nef-11d.x\nbin/nef-4d.x\nbin/nef-5d.x\nbin/nef-6d.x\nbin/nef.x\nbin/poly-11d.x\nbin/poly-4d.x\nbin/poly-5d.x\nbin/poly-6d.x\nbin/poly.x\n\n```\n",
    "created_at": "2020-05-28T20:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417710",
    "user": "@thierry-FreeBSD"
}
```

I just made a port of palm for FreeBSD, based upon build/pkgs/palp/spkg-install.in, but I do not see any data in it. The resulting MANIFEST (relative to $PREFIX) is:



```
bin/class-11d.x
bin/class-4d.x
bin/class-5d.x
bin/class-6d.x
bin/class.x
bin/cws-11d.x
bin/cws-4d.x
bin/cws-5d.x
bin/cws-6d.x
bin/cws.x
bin/mori-11d.x
bin/mori-4d.x
bin/mori-5d.x
bin/mori-6d.x
bin/mori.x
bin/nef-11d.x
bin/nef-4d.x
bin/nef-5d.x
bin/nef-6d.x
bin/nef.x
bin/poly-11d.x
bin/poly-4d.x
bin/poly-5d.x
bin/poly-6d.x
bin/poly.x

```




---

archive/issue_comments_417711.json:
```json
{
    "body": "one way to test palp executables is to look up examples in\nhttps://arxiv.org/abs/math/0204356",
    "created_at": "2020-05-29T14:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417711",
    "user": "@dimpase"
}
```

one way to test palp executables is to look up examples in
https://arxiv.org/abs/math/0204356



---

archive/issue_comments_417712.json:
```json
{
    "body": "Yes, it works!\n\nBut my question was about the description of this ticket \"it's a stable package, with just binary executables and data\", since I do not see any datafiles.",
    "created_at": "2020-05-29T14:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417712",
    "user": "@thierry-FreeBSD"
}
```

Yes, it works!

But my question was about the description of this ticket "it's a stable package, with just binary executables and data", since I do not see any datafiles.



---

archive/issue_comments_417713.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-04T09:51:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417713",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_417714.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-04T10:26:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417714",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417715.json:
```json
{
    "body": "OK, so as requested, checking that every executable is there. Needs review (you can just look in the `config.log` to see it does the right thing)",
    "created_at": "2020-06-04T10:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417715",
    "user": "@dimpase"
}
```

OK, so as requested, checking that every executable is there. Needs review (you can just look in the `config.log` to see it does the right thing)



---

archive/issue_comments_417716.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-04T10:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417716",
    "user": "@dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_417717.json:
```json
{
    "body": "The logic is OK but the variable tests need quotes otherwise they crash if I do something stupid like put the executables in `/home/mjo/My Programs`.",
    "created_at": "2020-06-11T00:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417717",
    "user": "@orlitzky"
}
```

The logic is OK but the variable tests need quotes otherwise they crash if I do something stupid like put the executables in `/home/mjo/My Programs`.



---

archive/issue_comments_417718.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-11T09:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417718",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417719.json:
```json
{
    "body": "Replying to [comment:23 mjo]:\n> The logic is OK but the variable tests need quotes otherwise they crash if I do something stupid like put the executables in `/home/mjo/My Programs`.\n\nOK, sure, done.",
    "created_at": "2020-06-11T09:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417719",
    "user": "@dimpase"
}
```

Replying to [comment:23 mjo]:
> The logic is OK but the variable tests need quotes otherwise they crash if I do something stupid like put the executables in `/home/mjo/My Programs`.

OK, sure, done.



---

archive/issue_comments_417720.json:
```json
{
    "body": "Ok, works now.",
    "created_at": "2020-06-11T14:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417720",
    "user": "@orlitzky"
}
```

Ok, works now.



---

archive/issue_comments_417721.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-11T14:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417721",
    "user": "@orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_417722.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-06-21T22:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29435#issuecomment-417722",
    "user": "@vbraun"
}
```

Resolution: fixed
