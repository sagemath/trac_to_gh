# Issue 13558: Implement k-bounded quotient space

archive/issues_013558.json:
```json
{
    "body": "Assignee: chrisjamesberg\n\nCC:  sage-combinat saliola zabrocki aschilling tscrim\n\nThis will implement the k-bounded quotient space, whose basis is indexed by monomial symmetric functions indexed by k-bounded partitions. It is the dual Hopf algebra to the k-bounded subspace where the k-Schur functions live.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13762\n\n",
    "created_at": "2012-11-27T02:43:12Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "title": "Implement k-bounded quotient space",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13558",
    "user": "chrisjamesberg"
}
```
Assignee: chrisjamesberg

CC:  sage-combinat saliola zabrocki aschilling tscrim

This will implement the k-bounded quotient space, whose basis is indexed by monomial symmetric functions indexed by k-bounded partitions. It is the dual Hopf algebra to the k-bounded subspace where the k-Schur functions live.

Issue created by migration from https://trac.sagemath.org/ticket/13762





---

archive/issue_comments_167628.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2012-11-27T02:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167628",
    "user": "chrisjamesberg"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_167629.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-11-29T15:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167629",
    "user": "chrisjamesberg"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_167630.json:
```json
{
    "body": "Apply: trac_13762_k_quotient.patch",
    "created_at": "2012-11-29T18:13:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167630",
    "user": "chrisjamesberg"
}
```

Apply: trac_13762_k_quotient.patch



---

archive/issue_comments_167631.json:
```json
{
    "body": "cc'ed since this conflicts with #13605.",
    "created_at": "2012-12-01T00:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167631",
    "user": "tscrim"
}
```

cc'ed since this conflicts with #13605.



---

archive/issue_comments_167632.json:
```json
{
    "body": "Apply: trac_13762_k_quotient.patch",
    "created_at": "2012-12-11T22:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167632",
    "user": "chrisjamesberg"
}
```

Apply: trac_13762_k_quotient.patch



---

archive/issue_comments_167633.json:
```json
{
    "body": "Hi Chris,\n\nThanks for the new patch. I assume this fixes the coercion bug? Did you also fold \n\n* trac_13762_addthis.patch\n* trac_13762_possiblefix.patch\n\nthat were passed around by e-mail, or should they go after this patch still?\n\nAnne",
    "created_at": "2012-12-11T23:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167633",
    "user": "aschilling"
}
```

Hi Chris,

Thanks for the new patch. I assume this fixes the coercion bug? Did you also fold 

* trac_13762_addthis.patch
* trac_13762_possiblefix.patch

that were passed around by e-mail, or should they go after this patch still?

Anne



---

archive/issue_comments_167634.json:
```json
{
    "body": "Changing keywords from \"\" to \"symmetric functions, partitions\".",
    "created_at": "2012-12-12T05:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167634",
    "user": "aschilling"
}
```

Changing keywords from "" to "symmetric functions, partitions".



---

archive/issue_comments_167635.json:
```json
{
    "body": "This patch implements the K-k-Schur functions and their duals. I tested this code my old private code and it gives the correct answers in the cases I checked.\n\nChris and Mike, here are a couple more comments I have:\n\n* When building the documentation I get an error\n\n```\nsage/combinat/sf/new_kschur                                                                  \nSphinx error:\n'ascii' codec can't decode byte 0xe2 in position 34698: ordinal not in range(128)\n```\n\n\n* Line 549 of the patch \"Returns the symmetric functions. Needed to make TestSuite work\" probably needs to be changed.\n\n* You need an extra line after 650.\n\n* In line 883 of new_kschur (in the patch) the dash is strange\n\n```\n.. [LamSchillingShimozono2010] T. Lam, A. Schilling, M.Shimozono, K-theory Schubert calculus of the affine Grassmannian, \n \t883\t        Compositio Math. 146 (2010), 811\u00e2\ufffd\ufffd852. \n```\n\nAlso, this reference should probably appear in def K_kschur(self) as well.\n\n* Line 887 \"\"\"r  should read r\"\"\" (or remove the r)\n\nSo much for now!\n\nAnne",
    "created_at": "2012-12-12T05:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167635",
    "user": "aschilling"
}
```

This patch implements the K-k-Schur functions and their duals. I tested this code my old private code and it gives the correct answers in the cases I checked.

Chris and Mike, here are a couple more comments I have:

* When building the documentation I get an error

```
sage/combinat/sf/new_kschur                                                                  
Sphinx error:
'ascii' codec can't decode byte 0xe2 in position 34698: ordinal not in range(128)
```


* Line 549 of the patch "Returns the symmetric functions. Needed to make TestSuite work" probably needs to be changed.

* You need an extra line after 650.

* In line 883 of new_kschur (in the patch) the dash is strange

```
.. [LamSchillingShimozono2010] T. Lam, A. Schilling, M.Shimozono, K-theory Schubert calculus of the affine Grassmannian, 
 	883	        Compositio Math. 146 (2010), 811â��852. 
```

Also, this reference should probably appear in def K_kschur(self) as well.

* Line 887 """r  should read r""" (or remove the r)

So much for now!

Anne



---

archive/issue_comments_167636.json:
```json
{
    "body": "Anne,\n\nAren't the documentation error and the dash error related? I replaced the dash and the documentation builds fine on my machine.\n\nBecause the patch had changed so much, I didn't know where to put a line after 650, because line 650 had probably changed.\n\nEverything else is fixed. Yes, all the other patches are folded into this.\n\nApply: trac_13762_k_quotient.patch",
    "created_at": "2012-12-12T16:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167636",
    "user": "chrisjamesberg"
}
```

Anne,

Aren't the documentation error and the dash error related? I replaced the dash and the documentation builds fine on my machine.

Because the patch had changed so much, I didn't know where to put a line after 650, because line 650 had probably changed.

Everything else is fixed. Yes, all the other patches are folded into this.

Apply: trac_13762_k_quotient.patch



---

archive/issue_comments_167637.json:
```json
{
    "body": "Hi Chris,\n\nThanks for the changes. The line that should be added is after line 807 in the current version.\nOther than that it looks good to me. If Mike is also happy, I'll let him set a positive review!\n\nAnne",
    "created_at": "2012-12-13T00:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167637",
    "user": "aschilling"
}
```

Hi Chris,

Thanks for the changes. The line that should be added is after line 807 in the current version.
Other than that it looks good to me. If Mike is also happy, I'll let him set a positive review!

Anne



---

archive/issue_comments_167638.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-12-13T04:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167638",
    "user": "zabrocki"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_167639.json:
```json
{
    "body": "Hi,\nI am happy with this version of the patch.  Chris, thanks for all the work and Anne thanks for the review.\n-Mike",
    "created_at": "2012-12-13T04:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167639",
    "user": "zabrocki"
}
```

Hi,
I am happy with this version of the patch.  Chris, thanks for all the work and Anne thanks for the review.
-Mike



---

archive/issue_comments_167640.json:
```json
{
    "body": "There is a problem with the building of the documentation introduced by this patch\n\n```\nreading sources... [100%] structure                                                                                                                                    \n/Applications/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/combinat/sf/new_kschur.py:docstring of sage.combinat.sf.new_kschur.K_kSchur:9: WARNING: Duplicate explicit target name: \"lamschillingshimozono2010\".\n/Applications/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/combinat/sf/new_kschur.py:docstring of sage.combinat.sf.new_kschur.K_kSchur:9: WARNING: duplicate citation LamSchillingShimozono2010, other instance in /Applications/sage-5.5.rc0/devel/sage/doc/en/reference/sage/combinat/sf/new_kschur.rst\n```\n\nI think this needs to be fixed!\n\nAnne",
    "created_at": "2012-12-20T19:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167640",
    "user": "aschilling"
}
```

There is a problem with the building of the documentation introduced by this patch

```
reading sources... [100%] structure                                                                                                                                    
/Applications/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/combinat/sf/new_kschur.py:docstring of sage.combinat.sf.new_kschur.K_kSchur:9: WARNING: Duplicate explicit target name: "lamschillingshimozono2010".
/Applications/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/combinat/sf/new_kschur.py:docstring of sage.combinat.sf.new_kschur.K_kSchur:9: WARNING: duplicate citation LamSchillingShimozono2010, other instance in /Applications/sage-5.5.rc0/devel/sage/doc/en/reference/sage/combinat/sf/new_kschur.rst
```

I think this needs to be fixed!

Anne



---

archive/issue_comments_167641.json:
```json
{
    "body": "There was a repeated reference.  It should be fixed now.\n\nApply: trac_13762_k_quotient-2.patch",
    "created_at": "2012-12-20T21:52:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167641",
    "user": "zabrocki"
}
```

There was a repeated reference.  It should be fixed now.

Apply: trac_13762_k_quotient-2.patch



---

archive/issue_comments_167642.json:
```json
{
    "body": "Replying to [comment:18 zabrocki]:\n> There was a repeated reference.  It should be fixed now.\n> \n> Apply: trac_13762_k_quotient-2.patch\n\nLooks good now! I leave the positive review.\n\nAnne",
    "created_at": "2012-12-20T23:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167642",
    "user": "aschilling"
}
```

Replying to [comment:18 zabrocki]:
> There was a repeated reference.  It should be fixed now.
> 
> Apply: trac_13762_k_quotient-2.patch

Looks good now! I leave the positive review.

Anne



---

archive/issue_comments_167643.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-12-23T21:20:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167643",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_167644.json:
```json
{
    "body": "There has been a discussion about the usage of \"assert\" and you should not use \"assert\" for bad user input, only to check for actual bugs. Bad input should probably give a `ValueError` instead.\n\nIf there is any way at all to reproduce an `AssertionError` using documented public functions, that is by definition a bug.",
    "created_at": "2012-12-23T21:20:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167644",
    "user": "jdemeyer"
}
```

There has been a discussion about the usage of "assert" and you should not use "assert" for bad user input, only to check for actual bugs. Bad input should probably give a `ValueError` instead.

If there is any way at all to reproduce an `AssertionError` using documented public functions, that is by definition a bug.



---

archive/issue_comments_167645.json:
```json
{
    "body": "Also, the commit message should not be one long line. You should wrap the message in multiple lines, but make sure the first line (which appears in `hg log`) makes sense by itself.",
    "created_at": "2012-12-26T13:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167645",
    "user": "jdemeyer"
}
```

Also, the commit message should not be one long line. You should wrap the message in multiple lines, but make sure the first line (which appears in `hg log`) makes sense by itself.



---

archive/issue_comments_167646.json:
```json
{
    "body": "Hi Jeroen,\nThere are a few '`assert`' lines that we can clearly remove and change to `ValueError`, but there is one I am unsure about.  Around line 599 in k_dual.py we have\n\n```\nif isinstance(c, Partition_class): \n      assert len(rest) == 0 \n```\n\nI don't see how to trigger this.  Is it ok to leave it as is?\n\nSome of our assertion errors that appear are triggered in code in free_module.py.  Should I change that code here or open a new ticket?",
    "created_at": "2012-12-27T06:19:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167646",
    "user": "zabrocki"
}
```

Hi Jeroen,
There are a few '`assert`' lines that we can clearly remove and change to `ValueError`, but there is one I am unsure about.  Around line 599 in k_dual.py we have

```
if isinstance(c, Partition_class): 
      assert len(rest) == 0 
```

I don't see how to trigger this.  Is it ok to leave it as is?

Some of our assertion errors that appear are triggered in code in free_module.py.  Should I change that code here or open a new ticket?



---

archive/issue_comments_167647.json:
```json
{
    "body": "Replying to [comment:22 zabrocki]:\n> {{{\n> if isinstance(c, Partition_class): \n>       assert len(rest) == 0 \n> }}}\n> I don't see how to trigger this.  Is it ok to leave it as is?\nAbsolutely. This is how `assert` should be used: to say \"this condition is always true, without any further assumptions\".\n\n> Some of our assertion errors that appear are triggered in code in free_module.py.  Should I change that code here or open a new ticket?\nI don't think you have to change it here, but at least make sure you don't introduce any new wrongly-used asserts.",
    "created_at": "2012-12-27T10:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167647",
    "user": "jdemeyer"
}
```

Replying to [comment:22 zabrocki]:
> {{{
> if isinstance(c, Partition_class): 
>       assert len(rest) == 0 
> }}}
> I don't see how to trigger this.  Is it ok to leave it as is?
Absolutely. This is how `assert` should be used: to say "this condition is always true, without any further assumptions".

> Some of our assertion errors that appear are triggered in code in free_module.py.  Should I change that code here or open a new ticket?
I don't think you have to change it here, but at least make sure you don't introduce any new wrongly-used asserts.



---

archive/issue_comments_167648.json:
```json
{
    "body": "Attachment [trac_13762_k_quotient.2.patch](tarball://root/attachments/some-uuid/ticket13762/trac_13762_k_quotient.2.patch) by zabrocki created at 2012-12-27 13:27:17",
    "created_at": "2012-12-27T13:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167648",
    "user": "zabrocki"
}
```

Attachment [trac_13762_k_quotient.2.patch](tarball://root/attachments/some-uuid/ticket13762/trac_13762_k_quotient.2.patch) by zabrocki created at 2012-12-27 13:27:17



---

archive/issue_comments_167649.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-12-27T13:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167649",
    "user": "zabrocki"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_167650.json:
```json
{
    "body": "OK.  Our doctests still raise two assertion errors for calling '`coefficient`' in free_module.py.",
    "created_at": "2012-12-27T13:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167650",
    "user": "zabrocki"
}
```

OK.  Our doctests still raise two assertion errors for calling '`coefficient`' in free_module.py.



---

archive/issue_comments_167651.json:
```json
{
    "body": "Apply:  trac_13762_k_quotient.2.patch",
    "created_at": "2012-12-27T17:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167651",
    "user": "aschilling"
}
```

Apply:  trac_13762_k_quotient.2.patch



---

archive/issue_comments_167652.json:
```json
{
    "body": "Looks good to me now! I set it back to positive review.\n\nAnne",
    "created_at": "2012-12-27T17:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167652",
    "user": "aschilling"
}
```

Looks good to me now! I set it back to positive review.

Anne



---

archive/issue_comments_167653.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-12-27T17:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167653",
    "user": "aschilling"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_167654.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-01-01T11:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167654",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_167655.json:
```json
{
    "body": "Please read some comments from #12313, which apply to this code:\n\n(tl;dr: your code is badly written and #12313 will make it much slower)\n\n> Had a quick look. To simplify and speed up the tests a little bit, you can concentrate on one of the tests that's slow:\n> {{{\n> sage: cmd='dks4._test_associativity()'\n> sage: import cProfile,pstats\n> sage: s=pstats.Stats(cProfile.Profile().runctx(cmd,globals(),{}))\n> sage: S=s.sort_stats('cumulative')\n> sage: S.print_stats()\n> ...\n> sage: S.print_callers()\n> ...\n> }}}\n> the latter one essentially gives you the call graph, weighted by time contributed.\n> \n> In fact it shows you pretty quickly that ShurFunctions were apparently VERY heavily relying on parents being cached:\n> {{{\n> X=dks4[0]+ 2*dks4[1] + 3*dks4[2]\n> (X*X)*X #wait quite a long time\n> }}}\n> This mainly uses `dks4.product` and you can follow the code from there to see this has not been written with runtime optimization in mind. Probably if you make some things cached the way there, you'll regain the original performance.\n> \n> My first impression is that this code indeed will make a concrete realization of some structure, perform the operation, and throw away the concrete realization. Elements on the way basically ARE homs, hence all the homsets.\n\n> I think the normal behaviour of a CAS should be that a structure S is considered garbage and can be collected, unless the user has constructed some object O and keeps a reference to it, and O keeps a chain of references to S. Sadly, that was not the case for Sage, but this ticket is part of an attempt to make Sage behave \"normally\" in that department.\n> \n> Hence, if the same structure is needed repeatedly during a computation, then the programmer should keep a reference to it locally, rather than relying on an external cache. And if different methods of an object O will use the same structure S, then it makes sense to store S as an attribute of O, in order to prevent S from being garbage collected as long as O is alive (but not longer than that).\n> \n> I think what Nils wanted to say is: If other parts of the Sage library do not obey the general rules formulated in the preceding paragraph, but rely on an infinite external cache, then they need to be fixed. But the need to fix them should not prevent us from changing the infinite external cache to a finite external cache, because that is of benefit for all parts in the Sage library that follow the general rules.",
    "created_at": "2013-01-23T11:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167655",
    "user": "jdemeyer"
}
```

Please read some comments from #12313, which apply to this code:

(tl;dr: your code is badly written and #12313 will make it much slower)

> Had a quick look. To simplify and speed up the tests a little bit, you can concentrate on one of the tests that's slow:
> {{{
> sage: cmd='dks4._test_associativity()'
> sage: import cProfile,pstats
> sage: s=pstats.Stats(cProfile.Profile().runctx(cmd,globals(),{}))
> sage: S=s.sort_stats('cumulative')
> sage: S.print_stats()
> ...
> sage: S.print_callers()
> ...
> }}}
> the latter one essentially gives you the call graph, weighted by time contributed.
> 
> In fact it shows you pretty quickly that ShurFunctions were apparently VERY heavily relying on parents being cached:
> {{{
> X=dks4[0]+ 2*dks4[1] + 3*dks4[2]
> (X*X)*X #wait quite a long time
> }}}
> This mainly uses `dks4.product` and you can follow the code from there to see this has not been written with runtime optimization in mind. Probably if you make some things cached the way there, you'll regain the original performance.
> 
> My first impression is that this code indeed will make a concrete realization of some structure, perform the operation, and throw away the concrete realization. Elements on the way basically ARE homs, hence all the homsets.

> I think the normal behaviour of a CAS should be that a structure S is considered garbage and can be collected, unless the user has constructed some object O and keeps a reference to it, and O keeps a chain of references to S. Sadly, that was not the case for Sage, but this ticket is part of an attempt to make Sage behave "normally" in that department.
> 
> Hence, if the same structure is needed repeatedly during a computation, then the programmer should keep a reference to it locally, rather than relying on an external cache. And if different methods of an object O will use the same structure S, then it makes sense to store S as an attribute of O, in order to prevent S from being garbage collected as long as O is alive (but not longer than that).
> 
> I think what Nils wanted to say is: If other parts of the Sage library do not obey the general rules formulated in the preceding paragraph, but rely on an infinite external cache, then they need to be fixed. But the need to fix them should not prevent us from changing the infinite external cache to a finite external cache, because that is of benefit for all parts in the Sage library that follow the general rules.



---

archive/issue_comments_167656.json:
```json
{
    "body": "See #13991 for a follow-up.",
    "created_at": "2013-01-23T11:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13558",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13558#issuecomment-167656",
    "user": "jdemeyer"
}
```

See #13991 for a follow-up.
