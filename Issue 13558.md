# Issue 13558: Implement k-bounded quotient space

Issue created by migration from https://trac.sagemath.org/ticket/13762

Original creator: chrisjamesberg

Original creation time: 2012-11-27 02:43:12

Assignee: chrisjamesberg

CC:  sage-combinat saliola zabrocki aschilling tscrim

This will implement the k-bounded quotient space, whose basis is indexed by monomial symmetric functions indexed by k-bounded partitions. It is the dual Hopf algebra to the k-bounded subspace where the k-Schur functions live.


---

Comment by chrisjamesberg created at 2012-11-27 02:53:12

Changing status from new to needs_info.


---

Comment by chrisjamesberg created at 2012-11-29 15:31:20

Changing status from needs_info to needs_review.


---

Comment by chrisjamesberg created at 2012-11-29 18:13:47

Apply: trac_13762_k_quotient.patch


---

Comment by tscrim created at 2012-12-01 00:45:05

cc'ed since this conflicts with #13605.


---

Comment by chrisjamesberg created at 2012-12-11 22:15:58

Apply: trac_13762_k_quotient.patch


---

Comment by aschilling created at 2012-12-11 23:59:02

Hi Chris,

Thanks for the new patch. I assume this fixes the coercion bug? Did you also fold 

 * trac_13762_addthis.patch
 * trac_13762_possiblefix.patch

that were passed around by e-mail, or should they go after this patch still?

Anne


---

Comment by aschilling created at 2012-12-12 05:46:00

Changing keywords from "" to "symmetric functions, partitions".


---

Comment by aschilling created at 2012-12-12 05:59:37

This patch implements the K-k-Schur functions and their duals. I tested this code my old private code and it gives the correct answers in the cases I checked.

Chris and Mike, here are a couple more comments I have:

* When building the documentation I get an error

```
sage/combinat/sf/new_kschur                                                                  
Sphinx error:
'ascii' codec can't decode byte 0xe2 in position 34698: ordinal not in range(128)
```


* Line 549 of the patch "Returns the symmetric functions. Needed to make TestSuite work" probably needs to be changed.

* You need an extra line after 650.

* In line 883 of new_kschur (in the patch) the dash is strange

```
.. [LamSchillingShimozono2010] T. Lam, A. Schilling, M.Shimozono, K-theory Schubert calculus of the affine Grassmannian, 
 	883	        Compositio Math. 146 (2010), 811â��852. 
```

Also, this reference should probably appear in def K_kschur(self) as well.

* Line 887 """r  should read r""" (or remove the r)

So much for now!

Anne


---

Comment by chrisjamesberg created at 2012-12-12 16:02:52

Anne,

Aren't the documentation error and the dash error related? I replaced the dash and the documentation builds fine on my machine.

Because the patch had changed so much, I didn't know where to put a line after 650, because line 650 had probably changed.

Everything else is fixed. Yes, all the other patches are folded into this.

Apply: trac_13762_k_quotient.patch


---

Comment by aschilling created at 2012-12-13 00:09:59

Hi Chris,

Thanks for the changes. The line that should be added is after line 807 in the current version.
Other than that it looks good to me. If Mike is also happy, I'll let him set a positive review!

Anne


---

Comment by zabrocki created at 2012-12-13 04:02:25

Changing status from needs_review to positive_review.


---

Comment by zabrocki created at 2012-12-13 04:02:25

Hi,
I am happy with this version of the patch.  Chris, thanks for all the work and Anne thanks for the review.
-Mike


---

Comment by aschilling created at 2012-12-20 19:29:07

There is a problem with the building of the documentation introduced by this patch

```
reading sources... [100%] structure                                                                                                                                    
/Applications/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/combinat/sf/new_kschur.py:docstring of sage.combinat.sf.new_kschur.K_kSchur:9: WARNING: Duplicate explicit target name: "lamschillingshimozono2010".
/Applications/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/combinat/sf/new_kschur.py:docstring of sage.combinat.sf.new_kschur.K_kSchur:9: WARNING: duplicate citation LamSchillingShimozono2010, other instance in /Applications/sage-5.5.rc0/devel/sage/doc/en/reference/sage/combinat/sf/new_kschur.rst
```

I think this needs to be fixed!

Anne


---

Comment by zabrocki created at 2012-12-20 21:52:07

There was a repeated reference.  It should be fixed now.

Apply: trac_13762_k_quotient-2.patch


---

Comment by aschilling created at 2012-12-20 23:48:13

Replying to [comment:18 zabrocki]:
> There was a repeated reference.  It should be fixed now.
> 
> Apply: trac_13762_k_quotient-2.patch

Looks good now! I leave the positive review.

Anne


---

Comment by jdemeyer created at 2012-12-23 21:20:56

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2012-12-23 21:20:56

There has been a discussion about the usage of "assert" and you should not use "assert" for bad user input, only to check for actual bugs. Bad input should probably give a `ValueError` instead.

If there is any way at all to reproduce an `AssertionError` using documented public functions, that is by definition a bug.


---

Comment by jdemeyer created at 2012-12-26 13:17:49

Also, the commit message should not be one long line. You should wrap the message in multiple lines, but make sure the first line (which appears in `hg log`) makes sense by itself.


---

Comment by zabrocki created at 2012-12-27 06:19:52

Hi Jeroen,
There are a few '`assert`' lines that we can clearly remove and change to `ValueError`, but there is one I am unsure about.  Around line 599 in k_dual.py we have

```
if isinstance(c, Partition_class): 
      assert len(rest) == 0 
```

I don't see how to trigger this.  Is it ok to leave it as is?

Some of our assertion errors that appear are triggered in code in free_module.py.  Should I change that code here or open a new ticket?


---

Comment by jdemeyer created at 2012-12-27 10:15:18

Replying to [comment:22 zabrocki]:
> {{{
> if isinstance(c, Partition_class): 
>       assert len(rest) == 0 
> }}}
> I don't see how to trigger this.  Is it ok to leave it as is?
Absolutely. This is how `assert` should be used: to say "this condition is always true, without any further assumptions".

> Some of our assertion errors that appear are triggered in code in free_module.py.  Should I change that code here or open a new ticket?
I don't think you have to change it here, but at least make sure you don't introduce any new wrongly-used asserts.


---

Attachment


---

Comment by zabrocki created at 2012-12-27 13:36:10

Changing status from needs_work to needs_review.


---

Comment by zabrocki created at 2012-12-27 13:36:10

OK.  Our doctests still raise two assertion errors for calling '`coefficient`' in free_module.py.


---

Comment by aschilling created at 2012-12-27 17:28:58

Apply:  trac_13762_k_quotient.2.patch


---

Comment by aschilling created at 2012-12-27 17:58:36

Looks good to me now! I set it back to positive review.

Anne


---

Comment by aschilling created at 2012-12-27 17:59:02

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-01-01 11:37:53

Resolution: fixed


---

Comment by jdemeyer created at 2013-01-23 11:20:50

Please read some comments from #12313, which apply to this code:

(tl;dr: your code is badly written and #12313 will make it much slower)

> Had a quick look. To simplify and speed up the tests a little bit, you can concentrate on one of the tests that's slow:
> {{{
> sage: cmd='dks4._test_associativity()'
> sage: import cProfile,pstats
> sage: s=pstats.Stats(cProfile.Profile().runctx(cmd,globals(),{}))
> sage: S=s.sort_stats('cumulative')
> sage: S.print_stats()
> ...
> sage: S.print_callers()
> ...
> }}}
> the latter one essentially gives you the call graph, weighted by time contributed.
> 
> In fact it shows you pretty quickly that ShurFunctions were apparently VERY heavily relying on parents being cached:
> {{{
> X=dks4[0]+ 2*dks4[1] + 3*dks4[2]
> (X*X)*X #wait quite a long time
> }}}
> This mainly uses `dks4.product` and you can follow the code from there to see this has not been written with runtime optimization in mind. Probably if you make some things cached the way there, you'll regain the original performance.
> 
> My first impression is that this code indeed will make a concrete realization of some structure, perform the operation, and throw away the concrete realization. Elements on the way basically ARE homs, hence all the homsets.

> I think the normal behaviour of a CAS should be that a structure S is considered garbage and can be collected, unless the user has constructed some object O and keeps a reference to it, and O keeps a chain of references to S. Sadly, that was not the case for Sage, but this ticket is part of an attempt to make Sage behave "normally" in that department.
> 
> Hence, if the same structure is needed repeatedly during a computation, then the programmer should keep a reference to it locally, rather than relying on an external cache. And if different methods of an object O will use the same structure S, then it makes sense to store S as an attribute of O, in order to prevent S from being garbage collected as long as O is alive (but not longer than that).
> 
> I think what Nils wanted to say is: If other parts of the Sage library do not obey the general rules formulated in the preceding paragraph, but rely on an infinite external cache, then they need to be fixed. But the need to fix them should not prevent us from changing the infinite external cache to a finite external cache, because that is of benefit for all parts in the Sage library that follow the general rules.


---

Comment by jdemeyer created at 2013-01-23 11:23:15

See #13991 for a follow-up.
