# Issue 28349: broken solving a linear system over GF(3)

Issue created by migration from https://trac.sagemath.org/ticket/28586

Original creator: dimpase

Original creation time: 2019-10-10 01:30:01

In Sage 8.5, the following got broken

```
B=matrix(GF(3), 2,2,[1,0,1,0], sparse=True)
v=vector(F, [1,1])
B.solve_right(v)
```

raises

```
TypeError: Cannot convert sage.matrix.matrix_modn_sparse.Matrix_modn_sparse to sage.matrix.matrix_integer_sparse.Matrix_integer_sparse
```


as [reported on sage-support](https://groups.google.com/d/msg/sage-support/5o8ZMqZG5cw/Dt-cg25GCwAJ)

This still works in 8.4, as tested on cocalc, but is broken in later Sage versions


---

Comment by @DaveWitteMorris created at 2019-10-10 03:25:02

Corrected a typo in the sage code.


---

Comment by @DaveWitteMorris created at 2019-10-10 05:56:49

Ticket [ticket:24544] has a commit called "fix matrix_modn_sparse" (and this commit is also mentioned in ticket [ticket:23214]). To a naive observer, it seems that this could be related.


---

Comment by dimpase created at 2019-10-10 19:04:11

#24544 got into 8.4, which is still OK (I tested on cocalc).


---

Comment by dimpase created at 2019-10-10 19:18:11

however, #23214 is a prime suspect. Doing git bisect now, I reckon 8.5.beta2 should still be OK.


---

Comment by dimpase created at 2019-10-10 22:25:05

OK, this got in in Sage 8.5.beta3 (no error in beta2, but the error in beta3).

So this is most likely #23214.


---

Comment by vdelecroix created at 2019-10-11 05:34:53

The code for solving linear systems in `matrix_modn_sparse` is an exact copy/paste of the one in `matrix_integer_sparse`. Even the tests! This is the reason why it is a complete (untested) failure.

To make it works it is some work...
- write the appropriate declarations for dense modular vectors and the solve interface in `libs/linbox/linbox.pxd`
- write sage-linbox converters for dense modular vectors in `libs/linbox/conversion.pxd`
- rewrite the solve interface to linbox in `matrix/matrix_modn_sparse.pyx`


---

Comment by dimpase created at 2019-10-11 12:55:39

Hmm, what does this have to do with dense matrices/vectors?
For dense matrices solving still works, for any A in [True,False]:

```
sage: B=matrix(GF(3), 2,2,[1,0,1,0], sparse=False)
....: v=vector(GF(3), [1,1], sparse=A)
....: B.solve_right(v)
....: 
....: 
(1, 0)
```


(as well as sparse and dense matrices over non-prime fields)


---

Comment by vdelecroix created at 2019-10-11 15:40:17

The dense matrix is the solution to the linear system not the equations. When you solve a linear system you rarely expect a sparse solution. This is why you need an interface to dense vector and matrices.


---

Comment by dimpase created at 2019-10-11 16:43:15

so the error happens in conversion of the answer obtained from the backend?


---

Comment by vdelecroix created at 2019-10-11 17:01:29

No. Just read [comment:7]. The backend is never called.


---

Comment by dimpase created at 2019-10-11 17:11:11

Thanks. Do we actually have a specialised backend for solving sparse linear systems over GF(p), p prime?


---

Comment by vdelecroix created at 2019-10-11 17:15:09

linbox does that. Sage used to have a dirty linbox interface in Cython (in Sage) and C++ (directly implemented in linbox) that was rewritten using Cython only (everything in Sage). There is a bunch of tickets about that. The solving of sparse systems over GF(p) was overlooked. That is my fault.


---

Comment by embray created at 2020-01-06 14:10:03

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2021-05-10 17:42:09

Moving to 9.4, as 9.3 has been released.
