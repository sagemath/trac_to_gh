# Issue 20772: Fix symbolic GCD to accept any expression

Issue created by migration from https://trac.sagemath.org/ticket/21009

Original creator: rws

Original creation time: 2016-07-12 14:52:24

Visible already in sage-7.1v, difficult to get a good minimal test case.

```
sage: (1/24*((sqrt(3)*2^(2/3)*gamma(1/3) + I*2^(2/3)*gamma(1/3))/pi + 4*2^(2/3)*gamma(1/3)/(pi*(sqrt(3) + I)))/x^(1/3)).collect_common_factors()
1/24*2^(2/3)*(sqrt(3) + 4/(sqrt(3) + I) + I)*gamma(1/3)/(pi*x^(1/3))
sage: (1/24*((I*2^(2/3)*gamma(1/3))/pi + 4*2^(2/3)*gamma(1/3)/(pi*(sqrt(3) + I)))/x^(1/3)).collect_common_factors()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-6-c25fe41fc3c2> in <module>()
----> 1 _.collect_common_factors()

/home/ralf/sage-7.1v/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.collect_common_factors (/home/ralf/sage-7.1v/src/build/cythonized/sage/symbolic/expression.cpp:37782)()
   6649         sig_on()
   6650         try:
-> 6651             x = g_collect_common_factors(self._gobj)
   6652         finally:
   6653             sig_off()

ValueError: gcd: arguments must be polynomials over the rationals
```

It is not difficult to fix the symbolic gcd to accept any expression. The method is already implemented in Pynac's giac interface.


---

Comment by rws created at 2017-08-11 07:33:50

We now get with Sage-8.0

```
sage: (1/24*((I*2^(2/3)*gamma(1/3))/pi + 4*2^(2/3)*gamma(1/3)/(pi*(sqrt(3) + I))
....: )/x^(1/3)).collect_common_factors()
....: 
1/24*2^(2/3)*(4/(sqrt(3) + I) + I)*gamma(1/3)/(pi*x^(1/3))
```



---

Comment by rws created at 2017-08-11 07:33:50

Changing status from new to needs_review.


---

Comment by rws created at 2017-08-11 07:49:01

Actually the fix was unintentional and is in Pynac-0.7.10. This will add doctests.


---

Comment by rws created at 2017-08-11 07:49:01

Changing status from needs_review to needs_work.


---

Comment by rws created at 2017-08-11 07:51:07

Sorry.


---

Comment by rws created at 2017-11-26 14:05:29

New commits:


---

Comment by rws created at 2017-11-26 14:05:29

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2019-01-18 17:27:00

If you rebase the branch, I will review this.


---

Comment by chapoton created at 2021-01-31 08:38:16

red branch => needs work


---

Comment by chapoton created at 2021-01-31 08:38:16

Changing status from needs_review to needs_work.
