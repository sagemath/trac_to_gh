# Issue 15211: cartesian products of projective space

Issue created by migration from Trac.

Original creator: bhutz

Original creation time: 2013-11-23 16:29:10

While there is some functionality for cartesian products of projective space in Toric Varieties, it does not mesh well with the functionality of Projective Space. This ticket is to implement a general notion of cartesian products of projective space building off of the projective space functionality.

My main interest in this is dynamical systems on products of projective space and subvarieties of products of projective space.


---

Comment by bhutz created at 2013-11-23 16:31:16

Set assignee to bhutz.


---

Attachment

The current patch is still needs work, mainly lacking in more testing. However, it does implement the majority of what is needed for cartesian products of projective space and their subschemes.


---

Comment by nbruin created at 2013-11-23 18:35:24

Have you tried working with multiply graded rings instead? Computing with bihomogeneous polynomials in
`k[x0,x1,x2,y0,y1,y2]` tends to be MUCH more efficient than working in the Segre embedding, because the rationality is much better expressed in the bihomogeneous case. Having some functionality to obtain the Segre embedding is of course useful, but I suspect that people having to work in products of projective spaces would be better off with multiply graded coordinate rings most of the time.


---

Comment by bhutz created at 2013-11-23 18:46:47

As far as I'm aware there is no native way to use multiply graded rings in Sage. I'd be happy to look into another way to do things, that's why I've put this up here as 'mostly done'.

Currently, everything but the subscheme dimension computation does just use `K[x,y]` and ensure multi-homgeneity. For the dimension, it seemed simpler to just use the Segre-embedding since I had already implemented that.


---

Comment by nbruin created at 2013-11-23 20:02:37

Replying to [comment:3 bhutz]:
> As far as I'm aware there is no native way to use multiply graded rings in Sage. I'd be happy to look into another way to do things, that's why I've put this up here as 'mostly done'.

The arithmetic in a multiply graded ring only depends on the ring structure, so in that respect nothing extra is necessary. You just need to interpret the results properly, i.e., that the ideal
(x-y,u-v) in k[x,y,u,v] describes a point in P1xP1 and not a line in P3. I guess knowing you're working with bihomogeneously generated ideals might affect your choice of term ordering if you need to compute groebner bases.

Basically what I expect is that it's possible to use/adapt the toric variety framework for dynamic purposes as well. I haven't looked into it myself. I'm just sharing my experience that in cases where I needed products of projective varieties, I found using multiple gradings initially daunting but eventually not bad at all and much more convenient and efficient.


---

Comment by git created at 2014-09-08 19:33:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-09-12 13:03:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2014-09-12 13:06:19

Changing status from new to needs_review.


---

Comment by vbraun created at 2014-09-15 16:10:26

Just found your ticket... I've been working on products of projective spaces, mostly for complete intersections in them. See #16987...

We should think about how to merge the two branches. I would prefer to have a separate directory and not use mixed camelcase / underscores in the global namespace (inside of modules its fine). Which is why I used `ProductProjectiveSpaces` and `sage.schemes.product_projective`.


---

Comment by bhutz created at 2014-09-15 18:02:56

hmm...yes I looked through your branch some and it seems like most of our basic premises are the same in how we are implementing the products although I seem to be using the underlying structures from projective_space a little bit more. However, the two branches do seem reasonably compatible.

I have no issue with your naming conventions and separate directory, but I'm not sure the best way to go about merging these two sets of changes. You have more experience on the workflow side of things, so I'm happy to entertain suggestions.


---

Comment by bhutz created at 2014-09-15 18:30:52

After some more looking, the biggest difference is that I've based everything off of projective_space functionality. I really do prefer that approach (this makes affine patches, morphisms, etc. much easier to work with) and I don't think it will have much, if any, affect on how you've done complete intersections.

Here is what I'd like to do in an ideal world:

- take your first commit and basically move it into my branch. However, I'd still like to build off of projective space. I can integrate any of your additional functionality and merge the differences in our approaches.

- then you could have your ticket be just the complete intersection portion with this ticket as a dependency. You'll probably have to make a few minor adjustments, but I don't think it will be too much.

As I said above, I'm also open to other suggestions.


---

Comment by vbraun created at 2014-09-15 18:36:00

Sounds good to me. Can you also adjust your docstrings to always have `OUTPUT:` on a single line? See http://www.sagemath.org/doc/developer/coding_basics.html#docstring-markup-with-rest-and-sphinx


---

Comment by bhutz created at 2014-09-15 18:40:07

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2014-09-15 18:40:07

ok. I won't get to it today or tomorrow, but will asap after that.


---

Comment by git created at 2014-09-19 13:25:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2014-09-19 13:28:29

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2014-09-19 13:28:29

All right. See what you think of this version. I changed to your name and directory structure and added some of your functions, but not all of them, as some are probably not needed with how I've implemented the product.


---

Comment by git created at 2014-09-19 13:33:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdefaria created at 2014-10-22 16:51:36

A couple of issues....
The following need better error messages

```
PP.<x0,x1,y0,y1> = ProductProjectiveSpaces([1,1],QQ)
H = Hom(PP,PP)
f = H([x0*x1*y1^3,x0*x1*y1*y0^2])
```


```
Proj.<x0,x1,y0,y1> = ProductProjectiveSpaces(1,QQ)
```

One should not be able to define a product with only one projective space

```
Prod.<x0,x1> = ProductProjectiveSpaces([1],QQ)
Prod
```

Have an extra input for the gens of the new PS, following error highlights why:

```
PP=ProductProjectiveSpaces([1,2],QQ,'u')
PP.segre_embedding()
```

Not as big a deal, but when return_embedding == True, it should return only the embedding instead of a tuple

```
PP=ProductProjectiveSpaces([1,2],QQ,'u')
PP.affine_patch([1,0],True) 
```


Saw some small spacing issues scattered throughout the documentation as well, make sure to go back and double check


---

Comment by jdefaria created at 2014-10-22 16:51:36

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-11-02 17:16:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2014-11-02 17:18:54

Fixes the issues mentioned. With a quick look through the documentation I wasn't sure what spacing issues you were referring to. Could you be more specific.


---

Comment by bhutz created at 2014-11-02 17:18:54

Changing status from needs_work to needs_review.


---

Comment by jdefaria created at 2014-11-05 17:11:31

Changing status from needs_review to positive_review.


---

Comment by jdefaria created at 2014-11-05 17:11:31

Looked over the code, everything looks fine now, setting to positive review


---

Comment by jdefaria created at 2014-11-05 18:08:05

Changing status from positive_review to needs_review.


---

Comment by jdefaria created at 2014-11-05 18:08:05

After speaking to the author, I am switching back to needs review so that the other reviewer can also look over it


---

Comment by vbraun created at 2014-11-05 19:29:36

Looks good to me. Sorry, don't have much time this semester. It would be nice if you could follow the docstring style guide a little bit closer:

http://www.sagemath.org/doc/developer/coding_basics.html#docstring-markup-with-rest-and-sphinx

* always capitalize EXAMPLES::
* always newline after OUTPUT: (no "OUTPUT: foo" in a single line), EXAMPLES::, ...


---

Comment by chapoton created at 2014-11-05 20:38:17

I cleaned the doc a little bit.

And also a few things in the code. There remains a pyflakes warning about an used variables "dims" in the morphism.py file.

----
New commits:


---

Comment by bhutz created at 2014-11-08 15:37:58

yes, sorry, those docs could have been cleaner. Thanks Frederic for fixing them. I've now removed the `dims` variable in morphism.py as it became unnecessary after I implemented `_factors()`, but didn't get removed at that time.
----
New commits:


---

Comment by jdefaria created at 2014-11-11 14:28:35

Changing status from needs_review to positive_review.


---

Comment by jdefaria created at 2014-11-11 14:28:35

Looked at everything once more, doc test came back clean, setting to positive review


---

Comment by vbraun created at 2014-11-14 21:01:35

Resolution: fixed
