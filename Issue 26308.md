# Issue 26308: Py3: Many python3 fixes in categories

archive/issues_026308.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/26545\n\n",
    "created_at": "2018-10-24T07:36:32Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "Py3: Many python3 fixes in categories",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26308",
    "user": "@vinklein"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/26545





---

archive/issue_comments_370577.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-24T14:04:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370577",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370578.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-25T07:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370578",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370579.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-10-25T12:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370579",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_370580.json:
```json
{
    "body": "Changing keywords from \"\" to \"thursdaybdx\".",
    "created_at": "2018-10-25T12:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370580",
    "user": "@vinklein"
}
```

Changing keywords from "" to "thursdaybdx".



---

archive/issue_comments_370581.json:
```json
{
    "body": "Changing keywords from \"thursdaybdx\" to \"thursdaysbdx\".",
    "created_at": "2018-10-25T12:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370581",
    "user": "@vinklein"
}
```

Changing keywords from "thursdaybdx" to "thursdaysbdx".



---

archive/issue_comments_370582.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-25T15:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370582",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370583.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-10-25T15:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370583",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_370584.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-10-25T15:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370584",
    "user": "@vinklein"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_370585.json:
```json
{
    "body": "New commits:\n----\nNew commits:",
    "created_at": "2018-10-25T15:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370585",
    "user": "@vinklein"
}
```

New commits:
----
New commits:



---

archive/issue_comments_370586.json:
```json
{
    "body": "I am not convinced by the changes involving adding the tags `# py2` and `#py3`.\n\nMaybe these changes should be corrected in a better way.",
    "created_at": "2018-10-25T17:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370586",
    "user": "@fchapoton"
}
```

I am not convinced by the changes involving adding the tags `# py2` and `#py3`.

Maybe these changes should be corrected in a better way.



---

archive/issue_comments_370587.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-10-29T08:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370587",
    "user": "@vinklein"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_370588.json:
```json
{
    "body": "Replying to [comment:10 chapoton]:\n> I am not convinced by the changes involving adding the tags `# py2` and `#py3`.\n> \n> Maybe these changes should be corrected in a better way.\n\nI am open to any suggestion.\n\nAutomerge failed => need_work.",
    "created_at": "2018-10-29T08:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370588",
    "user": "@vinklein"
}
```

Replying to [comment:10 chapoton]:
> I am not convinced by the changes involving adding the tags `# py2` and `#py3`.
> 
> Maybe these changes should be corrected in a better way.

I am open to any suggestion.

Automerge failed => need_work.



---

archive/issue_comments_370589.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-10-29T10:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370589",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_370590.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-10-29T10:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370590",
    "user": "@vinklein"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_370591.json:
```json
{
    "body": "Rebased on 8.5.beta1.",
    "created_at": "2018-10-29T10:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370591",
    "user": "@vinklein"
}
```

Rebased on 8.5.beta1.



---

archive/issue_comments_370592.json:
```json
{
    "body": "I would suggest to undo the changes involving #py2 / #py3 and keep them for later.",
    "created_at": "2018-10-29T10:32:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370592",
    "user": "@fchapoton"
}
```

I would suggest to undo the changes involving #py2 / #py3 and keep them for later.



---

archive/issue_comments_370593.json:
```json
{
    "body": "To be accurate are you talking about all the cases with `#py2/#py3` or only the ones in `additive_magmas.py` and `additive_semigroups.py` ?\n\nThe other case in category.py is quite different by nature :\n\n\n```\n-            sage: Algebras(QQ).required_methods()\n+            sage: Algebras(QQ).required_methods() # py2\n             {'element': {'optional': ['_add_', '_mul_'], 'required': ['__nonzero__']},\n              'parent': {'optional': ['algebra_generators'], 'required': ['__contains__']}}\n+            sage: Algebras(QQ).required_methods() # py3\n+            {'element': {'optional': ['_add_', '_mul_'], 'required': ['__bool__']},\n+             'parent': {'optional': ['algebra_generators'], 'required': ['__contains__']}}\n```\n\nthe only other ways to fix that i can think of is not testing `__nonzero__/__bool__` presence or modify the doctest framework ( and i think the later is not worth it for one case).",
    "created_at": "2018-10-29T10:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370593",
    "user": "@vinklein"
}
```

To be accurate are you talking about all the cases with `#py2/#py3` or only the ones in `additive_magmas.py` and `additive_semigroups.py` ?

The other case in category.py is quite different by nature :


```
-            sage: Algebras(QQ).required_methods()
+            sage: Algebras(QQ).required_methods() # py2
             {'element': {'optional': ['_add_', '_mul_'], 'required': ['__nonzero__']},
              'parent': {'optional': ['algebra_generators'], 'required': ['__contains__']}}
+            sage: Algebras(QQ).required_methods() # py3
+            {'element': {'optional': ['_add_', '_mul_'], 'required': ['__bool__']},
+             'parent': {'optional': ['algebra_generators'], 'required': ['__contains__']}}
```

the only other ways to fix that i can think of is not testing `__nonzero__/__bool__` presence or modify the doctest framework ( and i think the later is not worth it for one case).



---

archive/issue_comments_370594.json:
```json
{
    "body": "yes, I am just talking about undoing changes in \n\n```\nsrc/sage/categories/additive_magmas.py\nsrc/sage/categories/additive_semigroups.py\n```\n\n\nAlso, in src/sage/categories/morphism.pyx, one should not `import six` in pyx files.",
    "created_at": "2018-10-29T12:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370594",
    "user": "@fchapoton"
}
```

yes, I am just talking about undoing changes in 

```
src/sage/categories/additive_magmas.py
src/sage/categories/additive_semigroups.py
```


Also, in src/sage/categories/morphism.pyx, one should not `import six` in pyx files.



---

archive/issue_comments_370595.json:
```json
{
    "body": "Replying to [comment:17 chapoton]:\n> ...\n> Also, in src/sage/categories/morphism.pyx, one should not `import six` in pyx files.\n\nWhat should one use instead ? \n\nSide Note : currently `weak_dict.pyx` and `fpickle.pyx` use `import six`",
    "created_at": "2018-10-29T13:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370595",
    "user": "@vinklein"
}
```

Replying to [comment:17 chapoton]:
> ...
> Also, in src/sage/categories/morphism.pyx, one should not `import six` in pyx files.

What should one use instead ? 

Side Note : currently `weak_dict.pyx` and `fpickle.pyx` use `import six`



---

archive/issue_comments_370596.json:
```json
{
    "body": "Ok it's `IF PY_MAJOR_VERSION < 3:` syntax instead of `if six.PY2` i suppose.",
    "created_at": "2018-10-29T13:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370596",
    "user": "@vinklein"
}
```

Ok it's `IF PY_MAJOR_VERSION < 3:` syntax instead of `if six.PY2` i suppose.



---

archive/issue_comments_370597.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-29T13:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370597",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370598.json:
```json
{
    "body": "Required changes done.",
    "created_at": "2018-10-30T07:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370598",
    "user": "@vinklein"
}
```

Required changes done.



---

archive/issue_comments_370599.json:
```json
{
    "body": "no need to capitalize if and else here:\n\n```\n+            IF PY_MAJOR_VERSION < 3:\n+                return super(Morphism, self).__nonzero__()\n+            ELSE:\n+                return super().__bool__()\n```\n",
    "created_at": "2018-10-30T08:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370599",
    "user": "@fchapoton"
}
```

no need to capitalize if and else here:

```
+            IF PY_MAJOR_VERSION < 3:
+                return super(Morphism, self).__nonzero__()
+            ELSE:
+                return super().__bool__()
```




---

archive/issue_comments_370600.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-30T08:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370600",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370601.json:
```json
{
    "body": "Fixed with `\u200b07e7a7b`.",
    "created_at": "2018-10-30T08:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370601",
    "user": "@vinklein"
}
```

Fixed with `​07e7a7b`.



---

archive/issue_comments_370602.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-10-30T08:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370602",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_370603.json:
```json
{
    "body": "Bien, merci.",
    "created_at": "2018-10-30T10:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370603",
    "user": "@fchapoton"
}
```

Bien, merci.



---

archive/issue_comments_370604.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-30T10:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370604",
    "user": "@fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_370605.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-31T08:03:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26308#issuecomment-370605",
    "user": "@vbraun"
}
```

Resolution: fixed
