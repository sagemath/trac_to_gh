# Issue 26308: Py3: Many python3 fixes in categories

Issue created by migration from Trac.

Original creator: vklein

Original creation time: 2018-10-24 07:36:32




---

Comment by git created at 2018-10-24 14:04:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-25 07:45:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-25 12:14:45

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vklein created at 2018-10-25 12:37:46

Changing keywords from "" to "thursdaybdx".


---

Comment by vklein created at 2018-10-25 12:38:53

Changing keywords from "thursdaybdx" to "thursdaysbdx".


---

Comment by git created at 2018-10-25 15:02:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-10-25 15:23:31

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vklein created at 2018-10-25 15:52:03

Changing status from new to needs_review.


---

Comment by vklein created at 2018-10-25 15:52:03

New commits:
----
New commits:


---

Comment by chapoton created at 2018-10-25 17:09:22

I am not convinced by the changes involving adding the tags `# py2` and `#py3`.

Maybe these changes should be corrected in a better way.


---

Comment by vklein created at 2018-10-29 08:08:54

Changing status from needs_review to needs_work.


---

Comment by vklein created at 2018-10-29 08:08:54

Replying to [comment:10 chapoton]:
> I am not convinced by the changes involving adding the tags `# py2` and `#py3`.
> 
> Maybe these changes should be corrected in a better way.

I am open to any suggestion.

Automerge failed => need_work.


---

Comment by git created at 2018-10-29 10:21:49

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vklein created at 2018-10-29 10:23:20

Changing status from needs_work to needs_review.


---

Comment by vklein created at 2018-10-29 10:23:20

Rebased on 8.5.beta1.


---

Comment by chapoton created at 2018-10-29 10:32:41

I would suggest to undo the changes involving #py2 / #py3 and keep them for later.


---

Comment by vklein created at 2018-10-29 10:43:01

To be accurate are you talking about all the cases with `#py2/#py3` or only the ones in `additive_magmas.py` and `additive_semigroups.py` ?

The other case in category.py is quite different by nature :


```
-            sage: Algebras(QQ).required_methods()
+            sage: Algebras(QQ).required_methods() # py2
             {'element': {'optional': ['_add_', '_mul_'], 'required': ['__nonzero__']},
              'parent': {'optional': ['algebra_generators'], 'required': ['__contains__']}}
+            sage: Algebras(QQ).required_methods() # py3
+            {'element': {'optional': ['_add_', '_mul_'], 'required': ['__bool__']},
+             'parent': {'optional': ['algebra_generators'], 'required': ['__contains__']}}
```

the only other ways to fix that i can think of is not testing `__nonzero__/__bool__` presence or modify the doctest framework ( and i think the later is not worth it for one case).


---

Comment by chapoton created at 2018-10-29 12:30:44

yes, I am just talking about undoing changes in 

```
src/sage/categories/additive_magmas.py
src/sage/categories/additive_semigroups.py
```


Also, in src/sage/categories/morphism.pyx, one should not `import six` in pyx files.


---

Comment by vklein created at 2018-10-29 13:38:18

Replying to [comment:17 chapoton]:
> ...
> Also, in src/sage/categories/morphism.pyx, one should not `import six` in pyx files.

What should one use instead ? 

Side Note : currently `weak_dict.pyx` and `fpickle.pyx` use `import six`


---

Comment by vklein created at 2018-10-29 13:43:24

Ok it's `IF PY_MAJOR_VERSION < 3:` syntax instead of `if six.PY2` i suppose.


---

Comment by git created at 2018-10-29 13:51:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vklein created at 2018-10-30 07:12:52

Required changes done.


---

Comment by chapoton created at 2018-10-30 08:08:41

no need to capitalize if and else here:

```
+            IF PY_MAJOR_VERSION < 3:
+                return super(Morphism, self).__nonzero__()
+            ELSE:
+                return super().__bool__()
```



---

Comment by git created at 2018-10-30 08:20:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vklein created at 2018-10-30 08:21:40

Fixed with `â€‹07e7a7b`.


---

Comment by git created at 2018-10-30 08:28:02

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2018-10-30 10:08:25

Bien, merci.


---

Comment by chapoton created at 2018-10-30 10:08:25

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-10-31 08:03:37

Resolution: fixed
