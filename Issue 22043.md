# Issue 22043: Giac miscompiles on non-x86_64 platforms

archive/issues_022043.json:
```json
{
    "body": "CC:  rws frederichan vbraun\n\nOne can maybe cheat and pass  \"-D__x86_64__ -DSMARTPTR64\" in CPPFLAGS but that's dirty, see:\n* http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=19&t=1723\n\nIssue created by migration from https://trac.sagemath.org/ticket/22280\n\n",
    "created_at": "2017-01-31T14:41:49Z",
    "labels": [
        "packages: standard",
        "critical",
        "bug"
    ],
    "title": "Giac miscompiles on non-x86_64 platforms",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22043",
    "user": "jpflori"
}
```
CC:  rws frederichan vbraun

One can maybe cheat and pass  "-D__x86_64__ -DSMARTPTR64" in CPPFLAGS but that's dirty, see:
* http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=19&t=1723

Issue created by migration from https://trac.sagemath.org/ticket/22280





---

archive/issue_comments_306300.json:
```json
{
    "body": "I can confirm the issue. The trick fells very dirty but I can easily test it I think.",
    "created_at": "2017-02-01T00:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306300",
    "user": "fbissey"
}
```

I can confirm the issue. The trick fells very dirty but I can easily test it I think.



---

archive/issue_comments_306301.json:
```json
{
    "body": "Has expected passing `-D__x86_64__ -DSMARTPTR64` choke the build. Fails as soon as we load gmp headers which complain about the ABI being unsupported.\nNow by default the thing builds but fails in calling `pari`. We could temporarily disable building against `pari` on non x86 (`--disable-pari` in giac-1.2.3-13).\n\nMore fundamentally I suspect the way pari is called is what is really wrong here, as discussed on sage-packaging   https://groups.google.com/d/msgid/sage-packaging/ac9575ae-4dd3-4d29-97aa-a3ef785d3509%40googlegroups.com",
    "created_at": "2017-02-01T01:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306301",
    "user": "fbissey"
}
```

Has expected passing `-D__x86_64__ -DSMARTPTR64` choke the build. Fails as soon as we load gmp headers which complain about the ABI being unsupported.
Now by default the thing builds but fails in calling `pari`. We could temporarily disable building against `pari` on non x86 (`--disable-pari` in giac-1.2.3-13).

More fundamentally I suspect the way pari is called is what is really wrong here, as discussed on sage-packaging   https://groups.google.com/d/msgid/sage-packaging/ac9575ae-4dd3-4d29-97aa-a3ef785d3509%40googlegroups.com



---

archive/issue_comments_306302.json:
```json
{
    "body": "I don't know if it helps but the 1.2.3.25 version such as in #22101 contains the modifications for pari asked there:\n\nhttp://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=4&t=1776",
    "created_at": "2017-02-13T20:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306302",
    "user": "frederichan"
}
```

I don't know if it helps but the 1.2.3.25 version such as in #22101 contains the modifications for pari asked there:

http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=4&t=1776



---

archive/issue_comments_306303.json:
```json
{
    "body": "Still failing. Those changes are, I think are a progress but not the full changes that are needed - not that I would really be able to do them myself. The fact that we still have\n\n```\n#ifdef ENABLE_TLS\n  extern THREAD void *PARI_stack_limit;\n#else\n   extern void *PARI_stack_limit;\n#endif\n```\n\nwhich is a private function is a sign you are doing something wrong.",
    "created_at": "2017-02-16T10:22:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306303",
    "user": "fbissey"
}
```

Still failing. Those changes are, I think are a progress but not the full changes that are needed - not that I would really be able to do them myself. The fact that we still have

```
#ifdef ENABLE_TLS
  extern THREAD void *PARI_stack_limit;
#else
   extern void *PARI_stack_limit;
#endif
```

which is a private function is a sign you are doing something wrong.



---

archive/issue_comments_306304.json:
```json
{
    "body": "See http://pari.math.u-bordeaux.fr/archives/pari-users-1702/msg00002.html for a suggestion from the PARI developers on how this should be fixed.",
    "created_at": "2017-02-16T10:57:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306304",
    "user": "jdemeyer"
}
```

See http://pari.math.u-bordeaux.fr/archives/pari-users-1702/msg00002.html for a suggestion from the PARI developers on how this should be fixed.



---

archive/issue_comments_306305.json:
```json
{
    "body": "(1) What does this refer to:\n\n> One can maybe cheat and pass  `-D__x86_64__ -DSMARTPTR64` in CPPFLAGS but that's dirty, see:\n> * http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=19&t=1723\n\n(2) From the comments it seems that you think that there is a problem with PARI. Why do you think that?",
    "created_at": "2017-02-19T10:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306305",
    "user": "jdemeyer"
}
```

(1) What does this refer to:

> One can maybe cheat and pass  `-D__x86_64__ -DSMARTPTR64` in CPPFLAGS but that's dirty, see:
> * http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=19&t=1723

(2) From the comments it seems that you think that there is a problem with PARI. Why do you think that?



---

archive/issue_comments_306306.json:
```json
{
    "body": "Note that compiling with `-D__x86_64__` obviously does not work due to the use of inline assembly in `ifactor.cc`.",
    "created_at": "2017-02-19T11:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306306",
    "user": "jdemeyer"
}
```

Note that compiling with `-D__x86_64__` obviously does not work due to the use of inline assembly in `ifactor.cc`.



---

archive/issue_comments_306307.json:
```json
{
    "body": "And compiling with `-DSMARTPTR64` (whatever that means) does not change anything.",
    "created_at": "2017-02-19T11:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306307",
    "user": "jdemeyer"
}
```

And compiling with `-DSMARTPTR64` (whatever that means) does not change anything.



---

archive/issue_comments_306308.json:
```json
{
    "body": "There is a related topic (about SMARTPTR64 that should not be undefined by first.h)here:\nhttp://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=4&t=1785",
    "created_at": "2017-02-28T12:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306308",
    "user": "frederichan"
}
```

There is a related topic (about SMARTPTR64 that should not be undefined by first.h)here:
http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=4&t=1785



---

archive/issue_comments_306309.json:
```json
{
    "body": "I am not sure if it is the same error, but i cannot build+check `giac` on Debian Jessie 32bits, see the attached log. It fails at `chk_fhan1` and before there are tons of \"bug in PARI/GP (Segmentation Fault), please report.\"\n\nSince `giac` is a standard package, i set the priority to blocker.",
    "created_at": "2017-03-13T11:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306309",
    "user": "tmonteil"
}
```

I am not sure if it is the same error, but i cannot build+check `giac` on Debian Jessie 32bits, see the attached log. It fails at `chk_fhan1` and before there are tons of "bug in PARI/GP (Segmentation Fault), please report."

Since `giac` is a standard package, i set the priority to blocker.



---

archive/issue_comments_306310.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2017-03-13T11:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306310",
    "user": "tmonteil"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_306311.json:
```json
{
    "body": "Attachment [giac-1.2.2.103.log.7.6.rc0](tarball://root/attachments/some-uuid/ticket22280/giac-1.2.2.103.log.7.6.rc0) by frederichan created at 2017-03-13 11:55:45\n\nReplying to [comment:11 tmonteil]:\n> I am not sure if it is the same error, but i cannot build+check `giac` on Debian Jessie 32bits, see the attached log. It fails at `chk_fhan1` and before there are tons of \"bug in PARI/GP (Segmentation Fault), please report.\"\n> \n> Since `giac` is a standard package, i set the priority to blocker.\n> \nOn linux 32bits there is the following problem  #22101 and it should be already solved by giac-1.2.3.25 but I am waiting the next one to have a new config.guess as it was requested in #22101.",
    "created_at": "2017-03-13T11:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306311",
    "user": "frederichan"
}
```

Attachment [giac-1.2.2.103.log.7.6.rc0](tarball://root/attachments/some-uuid/ticket22280/giac-1.2.2.103.log.7.6.rc0) by frederichan created at 2017-03-13 11:55:45

Replying to [comment:11 tmonteil]:
> I am not sure if it is the same error, but i cannot build+check `giac` on Debian Jessie 32bits, see the attached log. It fails at `chk_fhan1` and before there are tons of "bug in PARI/GP (Segmentation Fault), please report."
> 
> Since `giac` is a standard package, i set the priority to blocker.
> 
On linux 32bits there is the following problem  #22101 and it should be already solved by giac-1.2.3.25 but I am waiting the next one to have a new config.guess as it was requested in #22101.



---

archive/issue_comments_306312.json:
```json
{
    "body": "Unless something happens real soon I'll ignore this for sage 7.6. If it isn't fixed we should think about downgrading giac to optional.\n\nThe snippet in the description is hopefully not repesentative of the giac code quality:\n* Randomly mixed French / English names for identifiers.\n* Use of reserved identifiers (starts with leading underscore + capital letter)",
    "created_at": "2017-03-15T19:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306312",
    "user": "vbraun"
}
```

Unless something happens real soon I'll ignore this for sage 7.6. If it isn't fixed we should think about downgrading giac to optional.

The snippet in the description is hopefully not repesentative of the giac code quality:
* Randomly mixed French / English names for identifiers.
* Use of reserved identifiers (starts with leading underscore + capital letter)



---

archive/issue_comments_306313.json:
```json
{
    "body": "If the upgrade can not be done soon (i hope it could!), another possibility would be to downgrade `giac/giacpy_sage` to a previously working version. Indeed, `pynac` is standard and depends on `giac`.",
    "created_at": "2017-03-16T09:29:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306313",
    "user": "tmonteil"
}
```

If the upgrade can not be done soon (i hope it could!), another possibility would be to downgrade `giac/giacpy_sage` to a previously working version. Indeed, `pynac` is standard and depends on `giac`.



---

archive/issue_comments_306314.json:
```json
{
    "body": "Replying to [comment:14 tmonteil]:\n> If the upgrade can not be done soon (i hope it could!), another possibility would be to downgrade `giac/giacpy_sage` to a previously working version. Indeed, `pynac` is standard and depends on `giac`.\n\n`pynac` doesn't currently depend on `giac`. Ralf wants it to happen, but things keep getting in the way. Enabling giac in pynac will cause at least two doctests to fail.",
    "created_at": "2017-03-16T09:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306314",
    "user": "fbissey"
}
```

Replying to [comment:14 tmonteil]:
> If the upgrade can not be done soon (i hope it could!), another possibility would be to downgrade `giac/giacpy_sage` to a previously working version. Indeed, `pynac` is standard and depends on `giac`.

`pynac` doesn't currently depend on `giac`. Ralf wants it to happen, but things keep getting in the way. Enabling giac in pynac will cause at least two doctests to fail.



---

archive/issue_comments_306315.json:
```json
{
    "body": "If people running powerpc and other platforms coudl check #22101, it seems to solve the issue.",
    "created_at": "2017-03-16T16:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306315",
    "user": "tmonteil"
}
```

If people running powerpc and other platforms coudl check #22101, it seems to solve the issue.



---

archive/issue_comments_306316.json:
```json
{
    "body": "Trying it on ppc64.",
    "created_at": "2017-03-16T16:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306316",
    "user": "jpflori"
}
```

Trying it on ppc64.



---

archive/issue_comments_306317.json:
```json
{
    "body": "Replying to [comment:17 tmonteil]:\n> If people running powerpc and other platforms coudl check #22101, it seems to solve the issue.\nReally? I thought it was only improving for i386. (cf comment4)\nThe only (small) news I have for other architecture are about \narm64 from this topic:\nhttp://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=4&t=1785\n\nwhere it seems that the static built of icas is functionnal while the original built crashes with 1+1",
    "created_at": "2017-03-16T18:32:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306317",
    "user": "frederichan"
}
```

Replying to [comment:17 tmonteil]:
> If people running powerpc and other platforms coudl check #22101, it seems to solve the issue.
Really? I thought it was only improving for i386. (cf comment4)
The only (small) news I have for other architecture are about 
arm64 from this topic:
http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=4&t=1785

where it seems that the static built of icas is functionnal while the original built crashes with 1+1



---

archive/issue_comments_306318.json:
```json
{
    "body": "I can confirm nothing changed on ppc64.",
    "created_at": "2017-03-16T19:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306318",
    "user": "jpflori"
}
```

I can confirm nothing changed on ppc64.



---

archive/issue_comments_306319.json:
```json
{
    "body": "I think `SMARTPTR64` is unrelated to our problems. It is added in some pre-made makefile, some of them for the debian package specifically. But there is no way I can see for it to make its way in the build system on a regular build - any system. Same story for `DOUBLEVAL` but this time with windows and OS X - it could be of interest since on OS X it included ppc.",
    "created_at": "2017-03-16T21:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306319",
    "user": "fbissey"
}
```

I think `SMARTPTR64` is unrelated to our problems. It is added in some pre-made makefile, some of them for the debian package specifically. But there is no way I can see for it to make its way in the build system on a regular build - any system. Same story for `DOUBLEVAL` but this time with windows and OS X - it could be of interest since on OS X it included ppc.



---

archive/issue_comments_306320.json:
```json
{
    "body": "does\n\n```\n./configure --enable-shared=no\n```\n\nchanges things?",
    "created_at": "2017-03-16T21:26:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306320",
    "user": "frederichan"
}
```

does

```
./configure --enable-shared=no
```

changes things?



---

archive/issue_comments_306321.json:
```json
{
    "body": "I cannot test right now - I am waiting for a world update to finish on the machine (this is a gentoo prefix, everything is compiled) but I am putting it on the things to try.",
    "created_at": "2017-03-16T21:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306321",
    "user": "fbissey"
}
```

I cannot test right now - I am waiting for a world update to finish on the machine (this is a gentoo prefix, everything is compiled) but I am putting it on the things to try.



---

archive/issue_comments_306322.json:
```json
{
    "body": "Replying to [comment:19 frederichan]:\n> Replying to [comment:17 tmonteil]:\n> > If people running powerpc and other platforms coudl check #22101, it seems to solve the issue.\n> Really? I thought it was only improving for i386. (cf comment4)\n\nSorry, i meant it solves the issue on i386.",
    "created_at": "2017-03-17T08:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306322",
    "user": "tmonteil"
}
```

Replying to [comment:19 frederichan]:
> Replying to [comment:17 tmonteil]:
> > If people running powerpc and other platforms coudl check #22101, it seems to solve the issue.
> Really? I thought it was only improving for i386. (cf comment4)

Sorry, i meant it solves the issue on i386.



---

archive/issue_comments_306323.json:
```json
{
    "body": "Currently for me every single tests fails (but I can do 1+1) on ppc64. Trying to run a test manually I get the following back trace which is slightly different from Jeroen\n\n```\n#7480 <signal handler called>\n#7481 0x00000400020258e0 in ?? () from /shared/work_no_backup/ppc64-prefix/usr/lib64/libpari-gmp-2.8.so.0\n#7482 0x00000400020258b0 in ?? () from /shared/work_no_backup/ppc64-prefix/usr/lib64/libpari-gmp-2.8.so.0\n#7483 0x00000400020274f8 in .pari_err () from /shared/work_no_backup/ppc64-prefix/usr/lib64/libpari-gmp-2.8.so.0\n#7484 0x0000040002028290 in .pari_sighandler () from /shared/work_no_backup/ppc64-prefix/usr/lib64/libpari-gmp-2.8.so.0\n#7485 <signal handler called>\n#7486 0x00000400005565ec in .std::vector<char const*, std::allocator<char const*> >::_M_insert_aux(__gnu_cxx::__normal_iterator<char const**, std::vector<char const*, std::allocator<char const*> > >, char const* const&) () from /dev/shm/portage/sci-mathematics/giac-1.2.2.105/work/giac-1.2.2/src/.libs/libgiac.so.0\n#7487 0x00000400005550bc in .giac::symbolic::eval(int, giac::context const*) const () from /dev/shm/portage/sci-mathematics/giac-1.2.2.105/work/giac-1.2.2/src/.libs/libgiac.so.0\n#7488 0x0000040000c8e158 in .giac::gen::in_eval(int, giac::gen&, giac::context const*) const ()\n   from /dev/shm/portage/sci-mathematics/giac-1.2.2.105/work/giac-1.2.2/src/.libs/libgiac.so.0\n#7489 0x0000040000c8fb58 in .giac::gen::eval(int, giac::context const*) const () from /dev/shm/portage/sci-mathematics/giac-1.2.2.105/work/giac-1.2.2/src/.libs/libgiac.so.0\n#7490 0x0000040000a35074 in .giac::protecteval(giac::gen const&, int, giac::context const*) ()\n   from /dev/shm/portage/sci-mathematics/giac-1.2.2.105/work/giac-1.2.2/src/.libs/libgiac.so.0\n#7491 0x000004000083d654 in .giac::in_thread_eval(void*) () from /dev/shm/portage/sci-mathematics/giac-1.2.2.105/work/giac-1.2.2/src/.libs/libgiac.so.0\n#7492 0x0000040002bbbb10 in .start_thread () from /shared/work_no_backup/ppc64-prefix/lib64/libpthread.so.0\n#7493 0x000004000170b268 in .__clone () from /shared/work_no_backup/ppc64-prefix/lib64/libc.so.6\n```\n\nI have cut all the extra repetition of the pari signal handler. This is 1.2.2-105, with 1.2.3 compiled \"statically\" (same \"test case\"):\n\n```\n#0  0x000000001029321c in .std::vector<char const*, std::allocator<char const*> >::_M_insert_aux(__gnu_cxx::__normal_iterator<char const**, std::vector<char const*, std::allocator<char const*> > >, char const* const&) ()\n#1  0x0000000010291eec in .giac::symbolic::eval(int, giac::context const*) const ()\n#2  0x000000001098e0c0 in .giac::gen::in_eval(int, giac::gen&, giac::context const*) const ()\n#3  0x0000000010291b64 in .giac::symbolic::eval(int, giac::context const*) const ()\n#4  0x000000001098e0c0 in .giac::gen::in_eval(int, giac::gen&, giac::context const*) const ()\n#5  0x000000001098f570 in .giac::gen::eval(int, giac::context const*) const ()\n#6  0x000000001070fe14 in .giac::protecteval(giac::gen const&, int, giac::context const*) ()\n#7  0x0000000010568324 in .giac::in_thread_eval(void*) ()\n#8  0x00000400017fbb10 in .start_thread () from /shared/work_no_backup/ppc64-prefix/lib64/libpthread.so.0\n#9  0x0000040001f0b268 in .__clone () from /shared/work_no_backup/ppc64-prefix/lib64/libc.so.6\n```\n",
    "created_at": "2017-03-20T04:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306323",
    "user": "fbissey"
}
```

Currently for me every single tests fails (but I can do 1+1) on ppc64. Trying to run a test manually I get the following back trace which is slightly different from Jeroen

```
#7480 <signal handler called>
#7481 0x00000400020258e0 in ?? () from /shared/work_no_backup/ppc64-prefix/usr/lib64/libpari-gmp-2.8.so.0
#7482 0x00000400020258b0 in ?? () from /shared/work_no_backup/ppc64-prefix/usr/lib64/libpari-gmp-2.8.so.0
#7483 0x00000400020274f8 in .pari_err () from /shared/work_no_backup/ppc64-prefix/usr/lib64/libpari-gmp-2.8.so.0
#7484 0x0000040002028290 in .pari_sighandler () from /shared/work_no_backup/ppc64-prefix/usr/lib64/libpari-gmp-2.8.so.0
#7485 <signal handler called>
#7486 0x00000400005565ec in .std::vector<char const*, std::allocator<char const*> >::_M_insert_aux(__gnu_cxx::__normal_iterator<char const**, std::vector<char const*, std::allocator<char const*> > >, char const* const&) () from /dev/shm/portage/sci-mathematics/giac-1.2.2.105/work/giac-1.2.2/src/.libs/libgiac.so.0
#7487 0x00000400005550bc in .giac::symbolic::eval(int, giac::context const*) const () from /dev/shm/portage/sci-mathematics/giac-1.2.2.105/work/giac-1.2.2/src/.libs/libgiac.so.0
#7488 0x0000040000c8e158 in .giac::gen::in_eval(int, giac::gen&, giac::context const*) const ()
   from /dev/shm/portage/sci-mathematics/giac-1.2.2.105/work/giac-1.2.2/src/.libs/libgiac.so.0
#7489 0x0000040000c8fb58 in .giac::gen::eval(int, giac::context const*) const () from /dev/shm/portage/sci-mathematics/giac-1.2.2.105/work/giac-1.2.2/src/.libs/libgiac.so.0
#7490 0x0000040000a35074 in .giac::protecteval(giac::gen const&, int, giac::context const*) ()
   from /dev/shm/portage/sci-mathematics/giac-1.2.2.105/work/giac-1.2.2/src/.libs/libgiac.so.0
#7491 0x000004000083d654 in .giac::in_thread_eval(void*) () from /dev/shm/portage/sci-mathematics/giac-1.2.2.105/work/giac-1.2.2/src/.libs/libgiac.so.0
#7492 0x0000040002bbbb10 in .start_thread () from /shared/work_no_backup/ppc64-prefix/lib64/libpthread.so.0
#7493 0x000004000170b268 in .__clone () from /shared/work_no_backup/ppc64-prefix/lib64/libc.so.6
```

I have cut all the extra repetition of the pari signal handler. This is 1.2.2-105, with 1.2.3 compiled "statically" (same "test case"):

```
#0  0x000000001029321c in .std::vector<char const*, std::allocator<char const*> >::_M_insert_aux(__gnu_cxx::__normal_iterator<char const**, std::vector<char const*, std::allocator<char const*> > >, char const* const&) ()
#1  0x0000000010291eec in .giac::symbolic::eval(int, giac::context const*) const ()
#2  0x000000001098e0c0 in .giac::gen::in_eval(int, giac::gen&, giac::context const*) const ()
#3  0x0000000010291b64 in .giac::symbolic::eval(int, giac::context const*) const ()
#4  0x000000001098e0c0 in .giac::gen::in_eval(int, giac::gen&, giac::context const*) const ()
#5  0x000000001098f570 in .giac::gen::eval(int, giac::context const*) const ()
#6  0x000000001070fe14 in .giac::protecteval(giac::gen const&, int, giac::context const*) ()
#7  0x0000000010568324 in .giac::in_thread_eval(void*) ()
#8  0x00000400017fbb10 in .start_thread () from /shared/work_no_backup/ppc64-prefix/lib64/libpthread.so.0
#9  0x0000040001f0b268 in .__clone () from /shared/work_no_backup/ppc64-prefix/lib64/libc.so.6
```




---

archive/issue_comments_306324.json:
```json
{
    "body": "(Sorry just small news)\nI have tried with qemu on the following:\n\n```\nLinux debianppc64 3.16.0-4-powerpc64le #1 SMP Debian 3.16.39-1+deb8u2 (2017-03-07) ppc64le GNU/Linux\n```\n\nto build giac on a basic debian (stable) system with just libgmp-dev and libmpfr-dev.\n\nWith the defaut compiler (gcc 4.9) I was able to built giac 1.2.3-31 and reproduce crashes with\n1+1  or also  just by evaluating: e     (it should answer exp(1))\n\ntrying with e it seems that the string giving the name of a fonction was not correctly stored.\n\n```\n(gdb) p sommet.ptr()\n$12 = (giac::unary_function_abstract *) 0xb7f71ee0\n(gdb) p sommet.ptr()->s\nCannot access memory at address 0xb7f71ee8\n```\n\n\nNB: as I am under qemu I have 1cpu and my threads value was 1. (yours may differ, I don't know if you are able to do: threads:=1)\n\n\n\nThen I tried to built with gcc 4.8 and I got a good version of giac.",
    "created_at": "2017-03-24T13:42:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306324",
    "user": "frederichan"
}
```

(Sorry just small news)
I have tried with qemu on the following:

```
Linux debianppc64 3.16.0-4-powerpc64le #1 SMP Debian 3.16.39-1+deb8u2 (2017-03-07) ppc64le GNU/Linux
```

to build giac on a basic debian (stable) system with just libgmp-dev and libmpfr-dev.

With the defaut compiler (gcc 4.9) I was able to built giac 1.2.3-31 and reproduce crashes with
1+1  or also  just by evaluating: e     (it should answer exp(1))

trying with e it seems that the string giving the name of a fonction was not correctly stored.

```
(gdb) p sommet.ptr()
$12 = (giac::unary_function_abstract *) 0xb7f71ee0
(gdb) p sommet.ptr()->s
Cannot access memory at address 0xb7f71ee8
```


NB: as I am under qemu I have 1cpu and my threads value was 1. (yours may differ, I don't know if you are able to do: threads:=1)



Then I tried to built with gcc 4.8 and I got a good version of giac.



---

archive/issue_comments_306325.json:
```json
{
    "body": "My latest experiment on ppc64 build with `-O0 -ggdb`, pari and ntl disabled to simplify things and rule them out.\n\n```\n#0  0x0000040000b1a068 in giac::add_print_symbolic (s=..., g=..., contextptr=0xffff075a590) at symbolic.cc:483\n483         if ( g.sommet.ptr()->printsommet && g.sommet!=at_plus && g.sommet!=at_prod && g.sommet!=at_pow){\n[Current thread is 1 (Thread 0x4000004d460 (LWP 13277))]\n(gdb) bt\n#0  0x0000040000b1a068 in giac::add_print_symbolic (s=\"\", g=..., contextptr=0xffff075a590) at symbolic.cc:483\n#1  0x0000040000b1b18c in giac::symbolic::print[abi:cxx11](giac::context const*) const (this=0x10094d18, contextptr=0xffff075a590) at symbolic.cc:599\n#2  0x00000400013ea160 in giac::gen::print[abi:cxx11](giac::context const*) const (this=0xffff0743918, contextptr=0xffff075a590) at gen.cc:12815\n#3  0x00000400013069d4 in giac::warn_implicit (a=..., b=..., contextptr=0xffff075a590) at usual.cc:4950\n#4  0x0000040001306cbc in giac::check_symb_of (a=..., b0=..., contextptr=0xffff075a590) at usual.cc:4960\n#5  0x0000040000afed78 in giac::giac_yyparse (scanner=0x1008bdd0) at input_parser.yy:232\n#6  0x00000400013d7784 in giac::try_parse (\n    s=\" restart;maple_mode(1);cas_setup(0,0,0,1,0,1e-10,10,[1,50,0,25],0,0,0); #radians,pas de cmplx, pas de  Sqrt\\n/* astuces, a retenir: sous xcas on utilise unapply qui est en general plus sur\\243que la metho\"..., contextptr=0xffff075a590) at gen.cc:11074\n#7  0x00000400013d9284 in giac::protected_giac_yyparse (\n    chaine=\" restart;maple_mode(1);cas_setup(0,0,0,1,0,1e-10,10,[1,50,0,25],0,0,0); #radians,pas de cmplx, pas de  Sqrt\\n/* astuces, a retenir: sous xcas on utilise unapply qui est en general plus sur\\243que la metho\"..., parse_result=..., contextptr=0xffff075a590) at gen.cc:11237\n#8  0x00000400013d95d0 in giac::gen::gen (this=0xffff0759f58, \n    s=\" restart;maple_mode(1);cas_setup(0,0,0,1,0,1e-10,10,[1,50,0,25],0,0,0); #radians,pas de cmplx, pas de  Sqrt\\n/* astuces, a retenir: sous xcas on utilise unapply qui est en general plus sur\\243que la metho\"..., contextptr=0xffff075a590) at gen.cc:11267\n#9  0x000004000076788c in giac::readargs_from_stream (inf=..., args=..., contextptr=0xffff075a590) at sym2poly.cc:3869\n#10 0x0000040000767cf8 in giac::readargs (ARGC=2, ARGV=0xffff075b5e8, args=..., contextptr=0xffff075a590) at sym2poly.cc:3920\n#11 0x0000000010011b60 in main (ARGC=2, ARGV=0xffff075b5e8) at icas.cc:1615\n```\n\nI also noticed this warning during the build, nothing bad happens because of it on x86_64 but who knows\n\n```\nusual.cc: In function 'giac::complex_long_double giac::lngamma(giac::complex_long_double)':\nusual.cc:7138:30: note: the ABI of passing aggregates with 16-byte alignment has changed in GCC 5\n   static complex_long_double lngamma(complex_long_double x){\n                              ^\n```\n",
    "created_at": "2017-05-11T03:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306325",
    "user": "fbissey"
}
```

My latest experiment on ppc64 build with `-O0 -ggdb`, pari and ntl disabled to simplify things and rule them out.

```
#0  0x0000040000b1a068 in giac::add_print_symbolic (s=..., g=..., contextptr=0xffff075a590) at symbolic.cc:483
483         if ( g.sommet.ptr()->printsommet && g.sommet!=at_plus && g.sommet!=at_prod && g.sommet!=at_pow){
[Current thread is 1 (Thread 0x4000004d460 (LWP 13277))]
(gdb) bt
#0  0x0000040000b1a068 in giac::add_print_symbolic (s="", g=..., contextptr=0xffff075a590) at symbolic.cc:483
#1  0x0000040000b1b18c in giac::symbolic::print[abi:cxx11](giac::context const*) const (this=0x10094d18, contextptr=0xffff075a590) at symbolic.cc:599
#2  0x00000400013ea160 in giac::gen::print[abi:cxx11](giac::context const*) const (this=0xffff0743918, contextptr=0xffff075a590) at gen.cc:12815
#3  0x00000400013069d4 in giac::warn_implicit (a=..., b=..., contextptr=0xffff075a590) at usual.cc:4950
#4  0x0000040001306cbc in giac::check_symb_of (a=..., b0=..., contextptr=0xffff075a590) at usual.cc:4960
#5  0x0000040000afed78 in giac::giac_yyparse (scanner=0x1008bdd0) at input_parser.yy:232
#6  0x00000400013d7784 in giac::try_parse (
    s=" restart;maple_mode(1);cas_setup(0,0,0,1,0,1e-10,10,[1,50,0,25],0,0,0); #radians,pas de cmplx, pas de  Sqrt\n/* astuces, a retenir: sous xcas on utilise unapply qui est en general plus sur\243que la metho"..., contextptr=0xffff075a590) at gen.cc:11074
#7  0x00000400013d9284 in giac::protected_giac_yyparse (
    chaine=" restart;maple_mode(1);cas_setup(0,0,0,1,0,1e-10,10,[1,50,0,25],0,0,0); #radians,pas de cmplx, pas de  Sqrt\n/* astuces, a retenir: sous xcas on utilise unapply qui est en general plus sur\243que la metho"..., parse_result=..., contextptr=0xffff075a590) at gen.cc:11237
#8  0x00000400013d95d0 in giac::gen::gen (this=0xffff0759f58, 
    s=" restart;maple_mode(1);cas_setup(0,0,0,1,0,1e-10,10,[1,50,0,25],0,0,0); #radians,pas de cmplx, pas de  Sqrt\n/* astuces, a retenir: sous xcas on utilise unapply qui est en general plus sur\243que la metho"..., contextptr=0xffff075a590) at gen.cc:11267
#9  0x000004000076788c in giac::readargs_from_stream (inf=..., args=..., contextptr=0xffff075a590) at sym2poly.cc:3869
#10 0x0000040000767cf8 in giac::readargs (ARGC=2, ARGV=0xffff075b5e8, args=..., contextptr=0xffff075a590) at sym2poly.cc:3920
#11 0x0000000010011b60 in main (ARGC=2, ARGV=0xffff075b5e8) at icas.cc:1615
```

I also noticed this warning during the build, nothing bad happens because of it on x86_64 but who knows

```
usual.cc: In function 'giac::complex_long_double giac::lngamma(giac::complex_long_double)':
usual.cc:7138:30: note: the ABI of passing aggregates with 16-byte alignment has changed in GCC 5
   static complex_long_double lngamma(complex_long_double x){
                              ^
```




---

archive/issue_comments_306326.json:
```json
{
    "body": "I guess that \n`g.sommet.ptr()->printsommet`\ntry to acces to the string representation of a usual symbol. so it looks similar to what I got.\nMay be the less confusing example is to just type: `e`  in icas, it should crash also for you  when trying to obtain the exp string while `d` should return d because it is not a reserved keyword. Could it be an loader ordering problem?",
    "created_at": "2017-05-11T13:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306326",
    "user": "frederichan"
}
```

I guess that 
`g.sommet.ptr()->printsommet`
try to acces to the string representation of a usual symbol. so it looks similar to what I got.
May be the less confusing example is to just type: `e`  in icas, it should crash also for you  when trying to obtain the exp string while `d` should return d because it is not a reserved keyword. Could it be an loader ordering problem?



---

archive/issue_comments_306327.json:
```json
{
    "body": "Typing `e` in `icas` segfault and that's what I get from the core dump\n\n```\nProgram terminated with signal SIGSEGV, Segmentation fault.\n#0  0x0000040000b28538 in __gnu_cxx::new_allocator<char const*>::construct<char const*, char const* const&> (this=0x1007fc00, __p=0x40054000940)\n    at /shared/work_no_backup/ppc64-prefix/usr/lib/gcc/powerpc64-unknown-linux-gnu/5.4.0/include/g++-v5/ext/new_allocator.h:120\n120             { ::new((void *)__p) _Up(std::forward<_Args>(__args)...); }\n[Current thread is 1 (Thread 0x4005228f080 (LWP 40544))]\n(gdb) bt\n#0  0x0000040000b28538 in __gnu_cxx::new_allocator<char const*>::construct<char const*, char const* const&> (this=0x1007fc00, __p=0x40054000940)\n    at /shared/work_no_backup/ppc64-prefix/usr/lib/gcc/powerpc64-unknown-linux-gnu/5.4.0/include/g++-v5/ext/new_allocator.h:120\n#1  0x0000040000b274fc in std::allocator_traits<std::allocator<char const*> >::construct<char const*, char const* const&> (__a=..., __p=0x40054000940)\n    at /shared/work_no_backup/ppc64-prefix/usr/lib/gcc/powerpc64-unknown-linux-gnu/5.4.0/include/g++-v5/bits/alloc_traits.h:530\n#2  0x0000040000b275cc in std::vector<char const*, std::allocator<char const*> >::_M_emplace_back_aux<char const* const&> (this=0x1007fc00)\n    at /shared/work_no_backup/ppc64-prefix/usr/lib/gcc/powerpc64-unknown-linux-gnu/5.4.0/include/g++-v5/bits/vector.tcc:416\n#3  0x0000040000b263c4 in std::vector<char const*, std::allocator<char const*> >::push_back (this=0x1007fc00, __x=<error reading variable>)\n    at /shared/work_no_backup/ppc64-prefix/usr/lib/gcc/powerpc64-unknown-linux-gnu/5.4.0/include/g++-v5/bits/stl_vector.h:923\n#4  0x0000040000b21ca4 in giac::symbolic::eval (this=0x1013a1a8, level=25, contextptr=0xfffc02556f0) at symbolic.cc:1371\n#5  0x0000040001368ccc in giac::gen::in_eval (this=0x4005228e5c8, level=25, evaled=..., contextptr=0xfffc02556f0) at gen.cc:2113\n#6  0x0000040001366268 in giac::gen::eval (this=0x4005228e5c8, level=25, contextptr=0xfffc02556f0) at gen.cc:1899\n#7  0x000004000106fd7c in giac::protecteval (g=..., level=25, contextptr=0xfffc02556f0) at prog.cc:6881\n#8  0x0000040000e4e50c in giac::in_thread_eval (arg=0x1007ff28) at global.cc:3463\n#9  0x000004000265bb10 in .start_thread () from /shared/work_no_backup/ppc64-prefix/lib64/libpthread.so.0\n#10 0x0000040002d6b268 in .__clone () from /shared/work_no_backup/ppc64-prefix/lib64/libc.so.6\n```\n",
    "created_at": "2017-05-12T03:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306327",
    "user": "fbissey"
}
```

Typing `e` in `icas` segfault and that's what I get from the core dump

```
Program terminated with signal SIGSEGV, Segmentation fault.
#0  0x0000040000b28538 in __gnu_cxx::new_allocator<char const*>::construct<char const*, char const* const&> (this=0x1007fc00, __p=0x40054000940)
    at /shared/work_no_backup/ppc64-prefix/usr/lib/gcc/powerpc64-unknown-linux-gnu/5.4.0/include/g++-v5/ext/new_allocator.h:120
120             { ::new((void *)__p) _Up(std::forward<_Args>(__args)...); }
[Current thread is 1 (Thread 0x4005228f080 (LWP 40544))]
(gdb) bt
#0  0x0000040000b28538 in __gnu_cxx::new_allocator<char const*>::construct<char const*, char const* const&> (this=0x1007fc00, __p=0x40054000940)
    at /shared/work_no_backup/ppc64-prefix/usr/lib/gcc/powerpc64-unknown-linux-gnu/5.4.0/include/g++-v5/ext/new_allocator.h:120
#1  0x0000040000b274fc in std::allocator_traits<std::allocator<char const*> >::construct<char const*, char const* const&> (__a=..., __p=0x40054000940)
    at /shared/work_no_backup/ppc64-prefix/usr/lib/gcc/powerpc64-unknown-linux-gnu/5.4.0/include/g++-v5/bits/alloc_traits.h:530
#2  0x0000040000b275cc in std::vector<char const*, std::allocator<char const*> >::_M_emplace_back_aux<char const* const&> (this=0x1007fc00)
    at /shared/work_no_backup/ppc64-prefix/usr/lib/gcc/powerpc64-unknown-linux-gnu/5.4.0/include/g++-v5/bits/vector.tcc:416
#3  0x0000040000b263c4 in std::vector<char const*, std::allocator<char const*> >::push_back (this=0x1007fc00, __x=<error reading variable>)
    at /shared/work_no_backup/ppc64-prefix/usr/lib/gcc/powerpc64-unknown-linux-gnu/5.4.0/include/g++-v5/bits/stl_vector.h:923
#4  0x0000040000b21ca4 in giac::symbolic::eval (this=0x1013a1a8, level=25, contextptr=0xfffc02556f0) at symbolic.cc:1371
#5  0x0000040001368ccc in giac::gen::in_eval (this=0x4005228e5c8, level=25, evaled=..., contextptr=0xfffc02556f0) at gen.cc:2113
#6  0x0000040001366268 in giac::gen::eval (this=0x4005228e5c8, level=25, contextptr=0xfffc02556f0) at gen.cc:1899
#7  0x000004000106fd7c in giac::protecteval (g=..., level=25, contextptr=0xfffc02556f0) at prog.cc:6881
#8  0x0000040000e4e50c in giac::in_thread_eval (arg=0x1007ff28) at global.cc:3463
#9  0x000004000265bb10 in .start_thread () from /shared/work_no_backup/ppc64-prefix/lib64/libpthread.so.0
#10 0x0000040002d6b268 in .__clone () from /shared/work_no_backup/ppc64-prefix/lib64/libc.so.6
```




---

archive/issue_comments_306328.json:
```json
{
    "body": "So you have the same debug as what I had with gcc4.9 in comment 26 where I put a break in symbolic.cc.\n\nBut for me, if after the built I rebuilt `icas` with `.libs/libgiac.a` instead of `.libs/libgiac.so` by doing in the src/ directory:\n\n\n```\nfred@debianppc64:~/giac-1.2.3-gcc49/src$ g++ -g -fno-strict-aliasing -DGIAC_GENERIC_CONSTANTS -o .libs/icas icas.o  ./.libs/libxcas.a /home/fred/giac-1.2.3-gcc49/src/.libs/libgiac.a -lreadline -ltermcap -lrt -lpthread -ldl -lm -lmpfr -lgmp\n```\n \nthen I can run `.libs/icas` without problems.",
    "created_at": "2017-05-12T12:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306328",
    "user": "frederichan"
}
```

So you have the same debug as what I had with gcc4.9 in comment 26 where I put a break in symbolic.cc.

But for me, if after the built I rebuilt `icas` with `.libs/libgiac.a` instead of `.libs/libgiac.so` by doing in the src/ directory:


```
fred@debianppc64:~/giac-1.2.3-gcc49/src$ g++ -g -fno-strict-aliasing -DGIAC_GENERIC_CONSTANTS -o .libs/icas icas.o  ./.libs/libxcas.a /home/fred/giac-1.2.3-gcc49/src/.libs/libgiac.a -lreadline -ltermcap -lrt -lpthread -ldl -lm -lmpfr -lgmp
```
 
then I can run `.libs/icas` without problems.



---

archive/issue_comments_306329.json:
```json
{
    "body": "Indeed, if I configure giac with disable-shared, I can ask e in icas without sefgault.",
    "created_at": "2017-05-19T09:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306329",
    "user": "jpflori"
}
```

Indeed, if I configure giac with disable-shared, I can ask e in icas without sefgault.



---

archive/issue_comments_306330.json:
```json
{
    "body": "But I still have similar failures:\n\n```\n0>> maple_mode(0);\n[New Thread 0x3fffaf10f1a0 (LWP 31223)]\n\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 0x3fffaf10f1a0 (LWP 31223)]\n0x000000001034c1a0 in __gnu_cxx::new_allocator<char const*>::construct (\n    this=0x1107a830, __p=0x3fffa8000940, \n    __val=@0xffffe3b0: <error reading variable>)\n    at /usr/include/c++/4.8.3/ext/new_allocator.h:130\n130           { ::new((void *)__p) _Tp(__val); }\nMissing separate debuginfos, use: debuginfo-install glibc-2.18-16.fc20.ppc64p7 libgcc-4.8.3-7.fc20.ppc64 libgfortran-4.8.3-7.fc20.ppc64 libstdc++-4.8.3-7.fc20.ppc64\n(gdb) bt\n#0  0x000000001034c1a0 in __gnu_cxx::new_allocator<char const*>::construct (\n    this=0x1107a830, __p=0x3fffa8000940, \n    __val=@0xffffe3b0: <error reading variable>)\n    at /usr/include/c++/4.8.3/ext/new_allocator.h:130\n#1  0x000000001034ae74 in __gnu_cxx::__alloc_traits<std::allocator<char const*> >::construct<char const*> (__a=..., __p=0x3fffa8000940, \n    __arg=@0xffffe3b0: <error reading variable>)\n    at /usr/include/c++/4.8.3/ext/alloc_traits.h:216\n#2  0x000000001034b024 in std::vector<char const*, std::allocator<char const*> >::_M_insert_aux (this=0x1107a830, \n    __position=<error reading variable: Cannot access memory at address 0x0>, \n    __x=@0xffffe3b0: <error reading variable>)\n    at /usr/include/c++/4.8.3/bits/vector.tcc:353\n#3  0x000000001034942c in std::vector<char const*, std::allocator<char const*> >::push_back (this=0x1107a830, __x=@0xffffe3b0: <error reading variable>)\n    at /usr/include/c++/4.8.3/bits/stl_vector.h:913\n#4  0x0000000010344af4 in giac::symbolic::eval (this=0x1119df98, level=25, \n    contextptr=0x3fffffffde10) at symbolic.cc:1372\n#5  0x0000000010b7f04c in giac::gen::in_eval (this=0x3fffaf10e6f8, level=25, \n    evaled=..., contextptr=0x3fffffffde10) at gen.cc:2109\n#6  0x0000000010b7c7f8 in giac::gen::eval (this=0x3fffaf10e6f8, level=25, \n    contextptr=0x3fffffffde10) at gen.cc:1893\n#7  0x0000000010887b2c in giac::protecteval (g=..., level=25, \n    contextptr=0x3fffffffde10) at prog.cc:7001\n#8  0x000000001068bb08 in giac::in_thread_eval (arg=0x1107aad8)\n    at global.cc:3467\n#9  0x00003fffb703c328 in .start_thread () from /lib64/libpthread.so.0\n#10 0x00003fffb6abdc70 in .__clone () from /lib64/libc.so.6\n```\n",
    "created_at": "2017-05-19T10:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306330",
    "user": "jpflori"
}
```

But I still have similar failures:

```
0>> maple_mode(0);
[New Thread 0x3fffaf10f1a0 (LWP 31223)]

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 0x3fffaf10f1a0 (LWP 31223)]
0x000000001034c1a0 in __gnu_cxx::new_allocator<char const*>::construct (
    this=0x1107a830, __p=0x3fffa8000940, 
    __val=@0xffffe3b0: <error reading variable>)
    at /usr/include/c++/4.8.3/ext/new_allocator.h:130
130           { ::new((void *)__p) _Tp(__val); }
Missing separate debuginfos, use: debuginfo-install glibc-2.18-16.fc20.ppc64p7 libgcc-4.8.3-7.fc20.ppc64 libgfortran-4.8.3-7.fc20.ppc64 libstdc++-4.8.3-7.fc20.ppc64
(gdb) bt
#0  0x000000001034c1a0 in __gnu_cxx::new_allocator<char const*>::construct (
    this=0x1107a830, __p=0x3fffa8000940, 
    __val=@0xffffe3b0: <error reading variable>)
    at /usr/include/c++/4.8.3/ext/new_allocator.h:130
#1  0x000000001034ae74 in __gnu_cxx::__alloc_traits<std::allocator<char const*> >::construct<char const*> (__a=..., __p=0x3fffa8000940, 
    __arg=@0xffffe3b0: <error reading variable>)
    at /usr/include/c++/4.8.3/ext/alloc_traits.h:216
#2  0x000000001034b024 in std::vector<char const*, std::allocator<char const*> >::_M_insert_aux (this=0x1107a830, 
    __position=<error reading variable: Cannot access memory at address 0x0>, 
    __x=@0xffffe3b0: <error reading variable>)
    at /usr/include/c++/4.8.3/bits/vector.tcc:353
#3  0x000000001034942c in std::vector<char const*, std::allocator<char const*> >::push_back (this=0x1107a830, __x=@0xffffe3b0: <error reading variable>)
    at /usr/include/c++/4.8.3/bits/stl_vector.h:913
#4  0x0000000010344af4 in giac::symbolic::eval (this=0x1119df98, level=25, 
    contextptr=0x3fffffffde10) at symbolic.cc:1372
#5  0x0000000010b7f04c in giac::gen::in_eval (this=0x3fffaf10e6f8, level=25, 
    evaled=..., contextptr=0x3fffffffde10) at gen.cc:2109
#6  0x0000000010b7c7f8 in giac::gen::eval (this=0x3fffaf10e6f8, level=25, 
    contextptr=0x3fffffffde10) at gen.cc:1893
#7  0x0000000010887b2c in giac::protecteval (g=..., level=25, 
    contextptr=0x3fffffffde10) at prog.cc:7001
#8  0x000000001068bb08 in giac::in_thread_eval (arg=0x1107aad8)
    at global.cc:3467
#9  0x00003fffb703c328 in .start_thread () from /lib64/libpthread.so.0
#10 0x00003fffb6abdc70 in .__clone () from /lib64/libc.so.6
```




---

archive/issue_comments_306331.json:
```json
{
    "body": "A shorter one:\n\n```\n0>> maple_mode\n[New Thread 0x3fffaf10f1a0 (LWP 35528)]\n[Thread 0x3fffaf10f1a0 (LWP 35528) exited]\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x0000000010bfc680 in giac::gen::print (this=0x3fffffffdb50, \n    contextptr=0x3fffffffde10) at gen.cc:12961\n12961         if (rpn_mode(contextptr) || _FUNCptr->ptr()->printsommet==&printastifunction || subtype==0) \n(gdb) bt\n#0  0x0000000010bfc680 in giac::gen::print (this=0x3fffffffdb50, \n    contextptr=0x3fffffffde10) at gen.cc:12961\n#1  0x00000000100174cc in main (ARGC=1, ARGV=0x3fffffffe398) at icas.cc:1536\n(gdb) \n```\n",
    "created_at": "2017-05-19T10:15:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306331",
    "user": "jpflori"
}
```

A shorter one:

```
0>> maple_mode
[New Thread 0x3fffaf10f1a0 (LWP 35528)]
[Thread 0x3fffaf10f1a0 (LWP 35528) exited]

Program received signal SIGSEGV, Segmentation fault.
0x0000000010bfc680 in giac::gen::print (this=0x3fffffffdb50, 
    contextptr=0x3fffffffde10) at gen.cc:12961
12961         if (rpn_mode(contextptr) || _FUNCptr->ptr()->printsommet==&printastifunction || subtype==0) 
(gdb) bt
#0  0x0000000010bfc680 in giac::gen::print (this=0x3fffffffdb50, 
    contextptr=0x3fffffffde10) at gen.cc:12961
#1  0x00000000100174cc in main (ARGC=1, ARGV=0x3fffffffe398) at icas.cc:1536
(gdb) 
```




---

archive/issue_comments_306332.json:
```json
{
    "body": "This looks bad:\n\n```\n(gdb) p this->ref_FUNCptr()->ptr()\n$8 = (giac::unary_function_abstract *) 0xffffe3a8\n```\n\nAddress has been cut.",
    "created_at": "2017-05-19T10:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306332",
    "user": "jpflori"
}
```

This looks bad:

```
(gdb) p this->ref_FUNCptr()->ptr()
$8 = (giac::unary_function_abstract *) 0xffffe3a8
```

Address has been cut.



---

archive/issue_comments_306333.json:
```json
{
    "body": "One can circumvent that by setting  `__x86_64__` but this automatically sets `SMARTPTR64` which might be broken on ppc64 because of endianness (vould work on ppc64le) and `_I386_` which includes assembly code.\n\nI'm now trying with proper 64 bits pointers but without \"smart\" pointers.",
    "created_at": "2017-05-19T13:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306333",
    "user": "jpflori"
}
```

One can circumvent that by setting  `__x86_64__` but this automatically sets `SMARTPTR64` which might be broken on ppc64 because of endianness (vould work on ppc64le) and `_I386_` which includes assembly code.

I'm now trying with proper 64 bits pointers but without "smart" pointers.



---

archive/issue_comments_306334.json:
```json
{
    "body": "Oh yeah and on 64 bits systems, not using `SMARTPTR64` is doomed to fail because C(++) types of different lengths are used to access the `_FUNC_` part of a `gen`.",
    "created_at": "2017-05-19T13:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306334",
    "user": "jpflori"
}
```

Oh yeah and on 64 bits systems, not using `SMARTPTR64` is doomed to fail because C(++) types of different lengths are used to access the `_FUNC_` part of a `gen`.



---

archive/issue_comments_306335.json:
```json
{
    "body": "And `double` storage trick fails because of byte order and is fixed when passing `-DDOUBLEVAL`.",
    "created_at": "2017-05-19T15:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306335",
    "user": "jpflori"
}
```

And `double` storage trick fails because of byte order and is fixed when passing `-DDOUBLEVAL`.



---

archive/issue_comments_306336.json:
```json
{
    "body": "Everything seems fine now, patches on their way.",
    "created_at": "2017-05-19T15:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306336",
    "user": "jpflori"
}
```

Everything seems fine now, patches on their way.



---

archive/issue_comments_306337.json:
```json
{
    "body": "Here you go.\nPlease report any success/failure with this branch.\n----\nNew commits:",
    "created_at": "2017-05-22T11:41:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306337",
    "user": "jpflori"
}
```

Here you go.
Please report any success/failure with this branch.
----
New commits:



---

archive/issue_comments_306338.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-05-22T13:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306338",
    "user": "jpflori"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_306339.json:
```json
{
    "body": "And let's even say it's needs_review...",
    "created_at": "2017-05-22T13:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306339",
    "user": "jpflori"
}
```

And let's even say it's needs_review...



---

archive/issue_comments_306340.json:
```json
{
    "body": "I've been in contact with Bernard (Parisse = upstream) and made some efforts have been made towards more portability but according to my experiments not enough at the moment.\nSee:\n* https://dev.geogebra.org/trac/browser/trunk/geogebra/giac/src/giac?rev=52930 and https://dev.geogebra.org/trac/browser/trunk/geogebra/giac/src/giac?rev=52967 to rename some `__x86_64__` to `x86_64` which is kind of a good move though I'd prefer a better macro name and why not just use `__LP64__`; and this does not prevent inclusion of x86_64 assembly on non-x86_64 and this change (as mine) covers at the same times part where we want pointers to be 64 bit but also long to be (or long long? which would make it more easy to deal with)...\n* https://dev.geogebra.org/trac/browser/trunk/geogebra/giac/src/giac?rev=53251 to fix the type of `_FUNC_`\n* https://dev.geogebra.org/trac/browser/trunk/geogebra/giac/src/giac?rev=52324 to use `SMARTPTR64` on (approximatively) `__LP64__` and `__LLP64__` archs; but there is still the endianness issue with smart pointers.\n* there is still an endianness issue when smart pointers are not used and `DOUBLEVAL` is not defined but that should not happen when `x86_64` is defined.",
    "created_at": "2017-05-24T13:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306340",
    "user": "jpflori"
}
```

I've been in contact with Bernard (Parisse = upstream) and made some efforts have been made towards more portability but according to my experiments not enough at the moment.
See:
* https://dev.geogebra.org/trac/browser/trunk/geogebra/giac/src/giac?rev=52930 and https://dev.geogebra.org/trac/browser/trunk/geogebra/giac/src/giac?rev=52967 to rename some `__x86_64__` to `x86_64` which is kind of a good move though I'd prefer a better macro name and why not just use `__LP64__`; and this does not prevent inclusion of x86_64 assembly on non-x86_64 and this change (as mine) covers at the same times part where we want pointers to be 64 bit but also long to be (or long long? which would make it more easy to deal with)...
* https://dev.geogebra.org/trac/browser/trunk/geogebra/giac/src/giac?rev=53251 to fix the type of `_FUNC_`
* https://dev.geogebra.org/trac/browser/trunk/geogebra/giac/src/giac?rev=52324 to use `SMARTPTR64` on (approximatively) `__LP64__` and `__LLP64__` archs; but there is still the endianness issue with smart pointers.
* there is still an endianness issue when smart pointers are not used and `DOUBLEVAL` is not defined but that should not happen when `x86_64` is defined.



---

archive/issue_comments_306341.json:
```json
{
    "body": "Did you suggest the fix for libpng/lpng1x too ([/22159#comment:29 suggested on this comment])?",
    "created_at": "2017-05-25T16:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306341",
    "user": "tmonteil"
}
```

Did you suggest the fix for libpng/lpng1x too ([/22159#comment:29 suggested on this comment])?



---

archive/issue_comments_306342.json:
```json
{
    "body": "Which version is your starting point? I am trying with 1.2.3-25 at the moment (because I have it handy on ppc64 right now) and while it is an improvement there are still failures, and I seem to be hanging at `chk_morley_demo` and a few others.",
    "created_at": "2017-05-25T23:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306342",
    "user": "fbissey"
}
```

Which version is your starting point? I am trying with 1.2.3-25 at the moment (because I have it handy on ppc64 right now) and while it is an improvement there are still failures, and I seem to be hanging at `chk_morley_demo` and a few others.



---

archive/issue_comments_306343.json:
```json
{
    "body": "Replying to [comment:44 tmonteil]:\n> Did you suggest the fix for libpng/lpng1x too ([/22159#comment:29 suggested on this comment])?\nNope, I did not...",
    "created_at": "2017-05-30T10:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306343",
    "user": "jpflori"
}
```

Replying to [comment:44 tmonteil]:
> Did you suggest the fix for libpng/lpng1x too ([/22159#comment:29 suggested on this comment])?
Nope, I did not...



---

archive/issue_comments_306344.json:
```json
{
    "body": "Replying to [comment:45 fbissey]:\n> Which version is your starting point? I am trying with 1.2.3-25 at the moment (because I have it handy on ppc64 right now) and while it is an improvement there are still failures, and I seem to be hanging at `chk_morley_demo` and a few others.\nHum, the one pointed in this ticket.\n\nThe latest \"unstable\" (which might have become stable) tarball should have equivalent fixes.\nSee:\n* https://dev.geogebra.org/trac/changeset/54223 for assembly and endianess issue.\n* https://dev.geogebra.org/trac/changeset/54269 for smart pointer tweaking.\n\nI guess you still have to pass `-Dx86_64` into `C[XX|PP]FLAGS` to make sure addresses are not cut at 32 bits.",
    "created_at": "2017-05-30T10:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306344",
    "user": "jpflori"
}
```

Replying to [comment:45 fbissey]:
> Which version is your starting point? I am trying with 1.2.3-25 at the moment (because I have it handy on ppc64 right now) and while it is an improvement there are still failures, and I seem to be hanging at `chk_morley_demo` and a few others.
Hum, the one pointed in this ticket.

The latest "unstable" (which might have become stable) tarball should have equivalent fixes.
See:
* https://dev.geogebra.org/trac/changeset/54223 for assembly and endianess issue.
* https://dev.geogebra.org/trac/changeset/54269 for smart pointer tweaking.

I guess you still have to pass `-Dx86_64` into `C[XX|PP]FLAGS` to make sure addresses are not cut at 32 bits.



---

archive/issue_comments_306345.json:
```json
{
    "body": "Note that using static or shared libraries makes no difference, both work well.",
    "created_at": "2017-05-30T10:17:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306345",
    "user": "jpflori"
}
```

Note that using static or shared libraries makes no difference, both work well.



---

archive/issue_comments_306346.json:
```json
{
    "body": "Thanks to Bernard and debian folk work the latest stable version seems ok.\nPass `-Dx86_64` into `CPPFLAGS`.",
    "created_at": "2017-05-31T08:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306346",
    "user": "jpflori"
}
```

Thanks to Bernard and debian folk work the latest stable version seems ok.
Pass `-Dx86_64` into `CPPFLAGS`.



---

archive/issue_comments_306347.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-31T21:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306347",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_306348.json:
```json
{
    "body": "If you want to add `arm64` support, please do so.\nBut I think this is ready to go now.",
    "created_at": "2017-05-31T21:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306348",
    "user": "jpflori"
}
```

If you want to add `arm64` support, please do so.
But I think this is ready to go now.



---

archive/issue_comments_306349.json:
```json
{
    "body": "Feel free to send this to the bots!",
    "created_at": "2017-06-02T15:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306349",
    "user": "jpflori"
}
```

Feel free to send this to the bots!



---

archive/issue_comments_306350.json:
```json
{
    "body": "I am sorry I haven't had time to test this fully yet. I will try to give it another go over the weekend.",
    "created_at": "2017-06-02T23:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306350",
    "user": "fbissey"
}
```

I am sorry I haven't had time to test this fully yet. I will try to give it another go over the weekend.



---

archive/issue_comments_306351.json:
```json
{
    "body": "\n```\nmake[3]: Entering directory '/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/check'\n*** stack smashing detected ***: /dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/icas terminated\n======= Backtrace: =========\n/shared/work_no_backup/ppc64-prefix/lib64/libc.so.6(+0xa3ba8)[0x400016e3ba8]\n/shared/work_no_backup/ppc64-prefix/lib64/libc.so.6(__fortify_fail-0x89548)[0x40001782480]\n/shared/work_no_backup/ppc64-prefix/lib64/libc.so.6(__stack_chk_fail-0x89598)[0x40001782418]\n/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZN4giac5substERKNS_3genERKNS_15dbgprint_vectorIS0_EES6_bPKNS_7contextE-0x836be0)[0x400007770d8]\n/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(+0x6dbcc0)[0x4000074bcc0]\n/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(+0x1ca518)[0x4000023a518]\n/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(+0x6e0834)[0x40000750834]\n/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZN4giac5limitERKNS_3genERKNS_14identificateurES2_iPKNS_7contextE-0x85b8e8)[0x40000751590]\n/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZN4giac11quotedlimitERKNS_3genERKNS_14identificateurES2_iPKNS_7contextE-0x85b498)[0x400007519f8]\n/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZN4giac6_limitERKNS_3genEPKNS_7contextE-0x85ab14)[0x40000752394]\n/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZNK4giac19unary_function_evalclERKNS_3genEPKNS_7contextE-0x3aa814)[0x40000c165b4]\n/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZNK4giac18unary_function_ptrclERKNS_3genEPKNS_7contextE-0x3b940c)[0x40000c07c5c]\n/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZNK4giac8symbolic4evalEiPKNS_7contextE-0xa07dd8)[0x4000059f9b8]\n/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZNK4giac3gen7in_evalEiRS0_PKNS_7contextE-0x2c80d0)[0x40000cfdc30]\n/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZNK4giac3gen4evalEiPKNS_7contextE-0x2c70d8)[0x40000cfec58]\n/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZN4giac11protectevalERKNS_3genEiPKNS_7contextE-0x54a214)[0x40000a6fe34]\n/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(+0x81b894)[0x4000088b894]\n/shared/work_no_backup/ppc64-prefix/lib64/libpthread.so.0(+0xbb10)[0x40002c1bb10]\n/shared/work_no_backup/ppc64-prefix/lib64/libc.so.6(clone-0x9e5b8)[0x4000176b268]\n======= Memory map: ========\n10000000-10020000 r-xp 00000000 00:10 13112212                           /dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/icas\n10020000-10030000 r--p 00010000 00:10 13112212                           /dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/icas\n10030000-10040000 rw-p 00020000 00:10 13112212                           /dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/icas\n10040000-100d0000 rw-p 00000000 00:00 0                                  [heap]\n40000000000-40000030000 r-xp 00000000 00:16 41936355                     /shared/work_no_backup/ppc64-prefix/lib64/ld-2.23.so\n40000030000-40000040000 r--p 00020000 00:16 41936355                     /shared/work_no_backup/ppc64-prefix/lib64/ld-2.23.so\n40000040000-40000050000 rw-p 00030000 00:16 41936355                     /shared/work_no_backup/ppc64-prefix/lib64/ld-2.23.so\n40000050000-40000070000 r-xp 00000000 00:00 0                            [vdso]\n40000070000-40000f60000 r-xp 00000000 00:10 13111890                     /dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0.0.0\n40000f60000-40000f70000 ---p 00ef0000 00:10 13111890                     /dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0.0.0\n40000f70000-40000fd0000 r--p 00ef0000 00:10 13111890                     /dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0.0.0\n40000fd0000-40000ff0000 rw-p 00f50000 00:10 13111890                     /dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0.0.0\n40000ff0000-40001020000 rw-p 00000000 00:00 0 \n40001020000-40001080000 r-xp 00000000 00:16 14674565                     /shared/work_no_backup/ppc64-prefix/usr/lib64/libreadline.so.7.0\n40001080000-40001090000 r--p 00050000 00:16 14674565                     /shared/work_no_backup/ppc64-prefix/usr/lib64/libreadline.so.7.0\n40001090000-400010a0000 rw-p 00060000 00:16 14674565                     /shared/work_no_backup/ppc64-prefix/usr/lib64/libreadline.so.7.0\n400010a0000-40001340000 r-xp 00000000 00:16 16553231                     /shared/work_no_backup/ppc64-prefix/usr/lib64/libgsl.so.19.3.0\n40001340000-40001370000 r--p 00290000 00:16 16553231                     /shared/work_no_backup/ppc64-prefix/usr/lib64/libgsl.so.19.3.0\n40001370000-40001390000 rw-p 002c0000 00:16 16553231                     /shared/work_no_backup/ppc64-prefix/usr/lib64/libgsl.so.19.3.0\n40001390000-400013a0000 rw-p 00000000 00:00 0 \n400013b0000-400015c0000 r-xp 00000000 00:16 15211125                     /shared/work_no_backup/ppc64-prefix/usr/lib64/gcc/powerpc64-unknown-linux-gnu/5.4.0/libstdc++.so.6.0.21\n400015c0000-400015f0000 r--p 00200000 00:16 15211125                     /shared/work_no_backup/ppc64-prefix/usr/lib64/gcc/powerpc64-unknown-linux-gnu/5.4.0/libstdc++.so.6.0.21\n400015f0000-40001600000 rw-p 00230000 00:16 15211125                     /shared/work_no_backup/ppc64-prefix/usr/lib64/gcc/powerpc64-unknown-linux-gnu/5.4.0/libstdc++.so.6.0.21\n40001600000-40001620000 r-xp 00000000 00:16 15211117                     /shared/work_no_backup/ppc64-prefix/usr/lib64/gcc/powerpc64-unknown-linux-gnu/5.4.0/libgcc_s.so.1\n40001620000-40001630000 r--p 00010000 00:16 15211117                     /shared/work_no_backup/ppc64-prefix/usr/lib64/gcc/powerpc64-unknown-linux-gnu/5.4.0/libgcc_s.so.1\n40001630000-40001640000 rw-p 00020000 00:16 15211117                     /shared/work_no_backup/ppc64-prefix/usr/lib64/gcc/powerpc64-unknown-linux-gnu/5.4.0/libgcc_s.so.1FAIL: chk_limit\nPASS: chk_partfrac\nFAIL: chk_fhan15\nPASS: chk_fhan13\nPASS: chk_factor\nPASS: chk_geo\nFAIL: chk_fhan0\nPASS: chk_fhan21\nPASS: chk_integrate\nFAIL: chk_fhan2\nFAIL: chk_cas\nPASS: chk_xavier\nFAIL: chk_fhan1\nPASS: chk_normalize\nFAIL: chk_morley_demo\nFAIL: chk_fhan18\nFAIL: chk_fhan12\nFAIL: chk_fhan7\nFAIL: chk_fhan20\nFAIL: chk_fhan16\nFAIL: chk_fhan9\nFAIL: chk_fhan17\nFAIL: chk_fhan8\nFAIL: chk_fhan5\nFAIL: chk_fhan3\nFAIL: chk_fhan4\nFAIL: chk_fhan6\nFAIL: chk_fhan19\nFAIL: chk_fhan14\nFAIL: chk_fhan11\n============================================================================\nTestsuite summary for giac 1.2.3\n============================================================================\n# TOTAL: 30\n# PASS:  8\n# SKIP:  0\n# XFAIL: 0\n# FAIL:  22\n# XPASS: 0\n# ERROR: 0\n```\n\nI am starting to think my g++ is at fault :(",
    "created_at": "2017-06-07T02:37:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306351",
    "user": "fbissey"
}
```


```
make[3]: Entering directory '/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/check'
*** stack smashing detected ***: /dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/icas terminated
======= Backtrace: =========
/shared/work_no_backup/ppc64-prefix/lib64/libc.so.6(+0xa3ba8)[0x400016e3ba8]
/shared/work_no_backup/ppc64-prefix/lib64/libc.so.6(__fortify_fail-0x89548)[0x40001782480]
/shared/work_no_backup/ppc64-prefix/lib64/libc.so.6(__stack_chk_fail-0x89598)[0x40001782418]
/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZN4giac5substERKNS_3genERKNS_15dbgprint_vectorIS0_EES6_bPKNS_7contextE-0x836be0)[0x400007770d8]
/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(+0x6dbcc0)[0x4000074bcc0]
/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(+0x1ca518)[0x4000023a518]
/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(+0x6e0834)[0x40000750834]
/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZN4giac5limitERKNS_3genERKNS_14identificateurES2_iPKNS_7contextE-0x85b8e8)[0x40000751590]
/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZN4giac11quotedlimitERKNS_3genERKNS_14identificateurES2_iPKNS_7contextE-0x85b498)[0x400007519f8]
/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZN4giac6_limitERKNS_3genEPKNS_7contextE-0x85ab14)[0x40000752394]
/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZNK4giac19unary_function_evalclERKNS_3genEPKNS_7contextE-0x3aa814)[0x40000c165b4]
/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZNK4giac18unary_function_ptrclERKNS_3genEPKNS_7contextE-0x3b940c)[0x40000c07c5c]
/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZNK4giac8symbolic4evalEiPKNS_7contextE-0xa07dd8)[0x4000059f9b8]
/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZNK4giac3gen7in_evalEiRS0_PKNS_7contextE-0x2c80d0)[0x40000cfdc30]
/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZNK4giac3gen4evalEiPKNS_7contextE-0x2c70d8)[0x40000cfec58]
/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(_ZN4giac11protectevalERKNS_3genEiPKNS_7contextE-0x54a214)[0x40000a6fe34]
/dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0(+0x81b894)[0x4000088b894]
/shared/work_no_backup/ppc64-prefix/lib64/libpthread.so.0(+0xbb10)[0x40002c1bb10]
/shared/work_no_backup/ppc64-prefix/lib64/libc.so.6(clone-0x9e5b8)[0x4000176b268]
======= Memory map: ========
10000000-10020000 r-xp 00000000 00:10 13112212                           /dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/icas
10020000-10030000 r--p 00010000 00:10 13112212                           /dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/icas
10030000-10040000 rw-p 00020000 00:10 13112212                           /dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/icas
10040000-100d0000 rw-p 00000000 00:00 0                                  [heap]
40000000000-40000030000 r-xp 00000000 00:16 41936355                     /shared/work_no_backup/ppc64-prefix/lib64/ld-2.23.so
40000030000-40000040000 r--p 00020000 00:16 41936355                     /shared/work_no_backup/ppc64-prefix/lib64/ld-2.23.so
40000040000-40000050000 rw-p 00030000 00:16 41936355                     /shared/work_no_backup/ppc64-prefix/lib64/ld-2.23.so
40000050000-40000070000 r-xp 00000000 00:00 0                            [vdso]
40000070000-40000f60000 r-xp 00000000 00:10 13111890                     /dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0.0.0
40000f60000-40000f70000 ---p 00ef0000 00:10 13111890                     /dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0.0.0
40000f70000-40000fd0000 r--p 00ef0000 00:10 13111890                     /dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0.0.0
40000fd0000-40000ff0000 rw-p 00f50000 00:10 13111890                     /dev/shm/portage/sci-mathematics/giac-1.2.3.47/work/giac-1.2.3/src/.libs/libgiac.so.0.0.0
40000ff0000-40001020000 rw-p 00000000 00:00 0 
40001020000-40001080000 r-xp 00000000 00:16 14674565                     /shared/work_no_backup/ppc64-prefix/usr/lib64/libreadline.so.7.0
40001080000-40001090000 r--p 00050000 00:16 14674565                     /shared/work_no_backup/ppc64-prefix/usr/lib64/libreadline.so.7.0
40001090000-400010a0000 rw-p 00060000 00:16 14674565                     /shared/work_no_backup/ppc64-prefix/usr/lib64/libreadline.so.7.0
400010a0000-40001340000 r-xp 00000000 00:16 16553231                     /shared/work_no_backup/ppc64-prefix/usr/lib64/libgsl.so.19.3.0
40001340000-40001370000 r--p 00290000 00:16 16553231                     /shared/work_no_backup/ppc64-prefix/usr/lib64/libgsl.so.19.3.0
40001370000-40001390000 rw-p 002c0000 00:16 16553231                     /shared/work_no_backup/ppc64-prefix/usr/lib64/libgsl.so.19.3.0
40001390000-400013a0000 rw-p 00000000 00:00 0 
400013b0000-400015c0000 r-xp 00000000 00:16 15211125                     /shared/work_no_backup/ppc64-prefix/usr/lib64/gcc/powerpc64-unknown-linux-gnu/5.4.0/libstdc++.so.6.0.21
400015c0000-400015f0000 r--p 00200000 00:16 15211125                     /shared/work_no_backup/ppc64-prefix/usr/lib64/gcc/powerpc64-unknown-linux-gnu/5.4.0/libstdc++.so.6.0.21
400015f0000-40001600000 rw-p 00230000 00:16 15211125                     /shared/work_no_backup/ppc64-prefix/usr/lib64/gcc/powerpc64-unknown-linux-gnu/5.4.0/libstdc++.so.6.0.21
40001600000-40001620000 r-xp 00000000 00:16 15211117                     /shared/work_no_backup/ppc64-prefix/usr/lib64/gcc/powerpc64-unknown-linux-gnu/5.4.0/libgcc_s.so.1
40001620000-40001630000 r--p 00010000 00:16 15211117                     /shared/work_no_backup/ppc64-prefix/usr/lib64/gcc/powerpc64-unknown-linux-gnu/5.4.0/libgcc_s.so.1
40001630000-40001640000 rw-p 00020000 00:16 15211117                     /shared/work_no_backup/ppc64-prefix/usr/lib64/gcc/powerpc64-unknown-linux-gnu/5.4.0/libgcc_s.so.1FAIL: chk_limit
PASS: chk_partfrac
FAIL: chk_fhan15
PASS: chk_fhan13
PASS: chk_factor
PASS: chk_geo
FAIL: chk_fhan0
PASS: chk_fhan21
PASS: chk_integrate
FAIL: chk_fhan2
FAIL: chk_cas
PASS: chk_xavier
FAIL: chk_fhan1
PASS: chk_normalize
FAIL: chk_morley_demo
FAIL: chk_fhan18
FAIL: chk_fhan12
FAIL: chk_fhan7
FAIL: chk_fhan20
FAIL: chk_fhan16
FAIL: chk_fhan9
FAIL: chk_fhan17
FAIL: chk_fhan8
FAIL: chk_fhan5
FAIL: chk_fhan3
FAIL: chk_fhan4
FAIL: chk_fhan6
FAIL: chk_fhan19
FAIL: chk_fhan14
FAIL: chk_fhan11
============================================================================
Testsuite summary for giac 1.2.3
============================================================================
# TOTAL: 30
# PASS:  8
# SKIP:  0
# XFAIL: 0
# FAIL:  22
# XPASS: 0
# ERROR: 0
```

I am starting to think my g++ is at fault :(



---

archive/issue_comments_306352.json:
```json
{
    "body": "`@` Jean-Pierre, what version of gcc did you test this with?",
    "created_at": "2017-06-08T00:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306352",
    "user": "fbissey"
}
```

`@` Jean-Pierre, what version of gcc did you test this with?



---

archive/issue_comments_306353.json:
```json
{
    "body": "An old one:\n\n```\ngcc -v\nUsing built-in specs.\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/usr/libexec/gcc/ppc64-redhat-linux/4.8.3/lto-wrapper\nTarget: ppc64-redhat-linux\nConfigured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-linker-hash-style=gnu --enable-languages=c,c++,objc,obj-c++,java,fortran,ada,go,lto --enable-plugin --enable-initfini-array --enable-java-awt=gtk --disable-dssi --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-1.5.0.0/jre --enable-libgcj-multifile --enable-java-maintainer-mode --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --disable-libjava-multilib --with-isl=/builddir/build/BUILD/gcc-4.8.3-20140911/obj-ppc64-redhat-linux/isl-install --with-cloog=/builddir/build/BUILD/gcc-4.8.3-20140911/obj-ppc64-redhat-linux/cloog-install --enable-secureplt --with-long-double-128 --build=ppc64-redhat-linux\nThread model: posix\ngcc version 4.8.3 20140911 (Red Hat 4.8.3-7) (GCC)\n```\n\nI did not run giac testsuite though.",
    "created_at": "2017-06-08T11:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306353",
    "user": "jpflori"
}
```

An old one:

```
gcc -v
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/libexec/gcc/ppc64-redhat-linux/4.8.3/lto-wrapper
Target: ppc64-redhat-linux
Configured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-linker-hash-style=gnu --enable-languages=c,c++,objc,obj-c++,java,fortran,ada,go,lto --enable-plugin --enable-initfini-array --enable-java-awt=gtk --disable-dssi --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-1.5.0.0/jre --enable-libgcj-multifile --enable-java-maintainer-mode --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --disable-libjava-multilib --with-isl=/builddir/build/BUILD/gcc-4.8.3-20140911/obj-ppc64-redhat-linux/isl-install --with-cloog=/builddir/build/BUILD/gcc-4.8.3-20140911/obj-ppc64-redhat-linux/cloog-install --enable-secureplt --with-long-double-128 --build=ppc64-redhat-linux
Thread model: posix
gcc version 4.8.3 20140911 (Red Hat 4.8.3-7) (GCC)
```

I did not run giac testsuite though.



---

archive/issue_comments_306354.json:
```json
{
    "body": "Replying to [comment:58 jpflori]:\n> An old one:\n> {{{\n> gcc -v\n> Using built-in specs.\n> COLLECT_GCC=gcc\n> COLLECT_LTO_WRAPPER=/usr/libexec/gcc/ppc64-redhat-linux/4.8.3/lto-wrapper\n> Target: ppc64-redhat-linux\n> Configured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-linker-hash-style=gnu --enable-languages=c,c++,objc,obj-c++,java,fortran,ada,go,lto --enable-plugin --enable-initfini-array --enable-java-awt=gtk --disable-dssi --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-1.5.0.0/jre --enable-libgcj-multifile --enable-java-maintainer-mode --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --disable-libjava-multilib --with-isl=/builddir/build/BUILD/gcc-4.8.3-20140911/obj-ppc64-redhat-linux/isl-install --with-cloog=/builddir/build/BUILD/gcc-4.8.3-20140911/obj-ppc64-redhat-linux/cloog-install --enable-secureplt --with-long-double-128 --build=ppc64-redhat-linux\n> Thread model: posix\n> gcc version 4.8.3 20140911 (Red Hat 4.8.3-7) (GCC)\n> }}}\n> I did not run giac testsuite though.\n\nAh, I never had trouble building it. Just running/testing it. It will be some work to get things to build with gcc 4.8.x, will have to find all the C++ dependencies before building.",
    "created_at": "2017-06-08T11:33:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306354",
    "user": "fbissey"
}
```

Replying to [comment:58 jpflori]:
> An old one:
> {{{
> gcc -v
> Using built-in specs.
> COLLECT_GCC=gcc
> COLLECT_LTO_WRAPPER=/usr/libexec/gcc/ppc64-redhat-linux/4.8.3/lto-wrapper
> Target: ppc64-redhat-linux
> Configured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-bootstrap --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-linker-hash-style=gnu --enable-languages=c,c++,objc,obj-c++,java,fortran,ada,go,lto --enable-plugin --enable-initfini-array --enable-java-awt=gtk --disable-dssi --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-1.5.0.0/jre --enable-libgcj-multifile --enable-java-maintainer-mode --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --disable-libjava-multilib --with-isl=/builddir/build/BUILD/gcc-4.8.3-20140911/obj-ppc64-redhat-linux/isl-install --with-cloog=/builddir/build/BUILD/gcc-4.8.3-20140911/obj-ppc64-redhat-linux/cloog-install --enable-secureplt --with-long-double-128 --build=ppc64-redhat-linux
> Thread model: posix
> gcc version 4.8.3 20140911 (Red Hat 4.8.3-7) (GCC)
> }}}
> I did not run giac testsuite though.

Ah, I never had trouble building it. Just running/testing it. It will be some work to get things to build with gcc 4.8.x, will have to find all the C++ dependencies before building.



---

archive/issue_comments_306355.json:
```json
{
    "body": "Most tests seem to pass on my machine except for some numerical noise and some very long or looping tests I killed.",
    "created_at": "2017-06-08T12:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306355",
    "user": "jpflori"
}
```

Most tests seem to pass on my machine except for some numerical noise and some very long or looping tests I killed.



---

archive/issue_comments_306356.json:
```json
{
    "body": "Replying to [comment:46 jpflori]:\n> Replying to [comment:44 tmonteil]:\n> > Did you suggest the fix for libpng/lpng1x too ([/22159#comment:29 suggested on this comment])?\n> Nope, I did not...\n\n\nCould you please give me some hints on how to achieve this (which file to modify, and how) ?\n\n(sorry for not being able to help on the review, i do not have any ppc machine, my intel 32bit VM is trying it right now, just in case)",
    "created_at": "2017-06-15T12:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306356",
    "user": "tmonteil"
}
```

Replying to [comment:46 jpflori]:
> Replying to [comment:44 tmonteil]:
> > Did you suggest the fix for libpng/lpng1x too ([/22159#comment:29 suggested on this comment])?
> Nope, I did not...


Could you please give me some hints on how to achieve this (which file to modify, and how) ?

(sorry for not being able to help on the review, i do not have any ppc machine, my intel 32bit VM is trying it right now, just in case)



---

archive/issue_comments_306357.json:
```json
{
    "body": "Just patch the `Makefile` to use `-lpng16` rather than `-lpng`.",
    "created_at": "2017-06-15T12:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306357",
    "user": "jpflori"
}
```

Just patch the `Makefile` to use `-lpng16` rather than `-lpng`.



---

archive/issue_comments_306358.json:
```json
{
    "body": "Currently `giac` configure png with\n\n```\nCONFIG_PNG=\"yes\"\nAC_ARG_ENABLE(png,\n        [AS_HELP_STRING([--enable-png], [Enable PNG library])],\n        [ if test \"x$enableval\" = \"xno\"; then CONFIG_PNG=\"no\"; fi], [])\n  \nif test \"x$CONFIG_PNG\" = \"xyes\"; then\n   AC_CHECK_HEADERS(png.h, AC_CHECK_LIB(png,main))\nfi\n```\n\nin `configure.in`. An option is to use `AC_CHECK_LIBS(main,[png16,png14,png12,png])` instead of `AC_CHECK_LIB`. For Jean-Pierre suggestion you have to do the replacement after configure is run. Because `AC_CHECK_LIB` is used `-lpng` is added to `LIBS` by configure.",
    "created_at": "2017-06-15T12:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306358",
    "user": "fbissey"
}
```

Currently `giac` configure png with

```
CONFIG_PNG="yes"
AC_ARG_ENABLE(png,
        [AS_HELP_STRING([--enable-png], [Enable PNG library])],
        [ if test "x$enableval" = "xno"; then CONFIG_PNG="no"; fi], [])
  
if test "x$CONFIG_PNG" = "xyes"; then
   AC_CHECK_HEADERS(png.h, AC_CHECK_LIB(png,main))
fi
```

in `configure.in`. An option is to use `AC_CHECK_LIBS(main,[png16,png14,png12,png])` instead of `AC_CHECK_LIB`. For Jean-Pierre suggestion you have to do the replacement after configure is run. Because `AC_CHECK_LIB` is used `-lpng` is added to `LIBS` by configure.



---

archive/issue_comments_306359.json:
```json
{
    "body": "Replying to [comment:61 tmonteil]:\n> (sorry for not being able to help on the review, i do not have any ppc machine, my intel 32bit VM is trying it right now, just in case)\n\nFor what it worth, giac-1.2.3.47 from this ticket compiles and pass self-tests on both my 64bit laptop and 32bit VM (both running Debian GNU/Linux jessie).",
    "created_at": "2017-06-17T09:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306359",
    "user": "tmonteil"
}
```

Replying to [comment:61 tmonteil]:
> (sorry for not being able to help on the review, i do not have any ppc machine, my intel 32bit VM is trying it right now, just in case)

For what it worth, giac-1.2.3.47 from this ticket compiles and pass self-tests on both my 64bit laptop and 32bit VM (both running Debian GNU/Linux jessie).



---

archive/issue_comments_306360.json:
```json
{
    "body": "Ragarding building giac with png support, thanks Jean-Pierre and Fran\u00e7ois for your hints, i opened #23262.",
    "created_at": "2017-06-17T09:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306360",
    "user": "tmonteil"
}
```

Ragarding building giac with png support, thanks Jean-Pierre and Franois for your hints, i opened #23262.



---

archive/issue_comments_306361.json:
```json
{
    "body": "Unfortunately, I still have no luck on ppc64 with gcc-5.4.0. It is better than before in that some tests are now succeeding. But things seems to get stuck in a C++ allocator for a number of them.",
    "created_at": "2017-06-17T09:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306361",
    "user": "fbissey"
}
```

Unfortunately, I still have no luck on ppc64 with gcc-5.4.0. It is better than before in that some tests are now succeeding. But things seems to get stuck in a C++ allocator for a number of them.



---

archive/issue_comments_306362.json:
```json
{
    "body": "Is `giac` itself functional?\nThat is: is it only failing its testsuite or is it completely broken as well?",
    "created_at": "2017-06-19T09:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306362",
    "user": "jpflori"
}
```

Is `giac` itself functional?
That is: is it only failing its testsuite or is it completely broken as well?



---

archive/issue_comments_306363.json:
```json
{
    "body": "Fair question. \"1+1\" works, the fact that some tests work means that it is working up to a point. I haven't tried to run the sage testsuite with it. Any tests I should run?",
    "created_at": "2017-06-19T09:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306363",
    "user": "fbissey"
}
```

Fair question. "1+1" works, the fact that some tests work means that it is working up to a point. I haven't tried to run the sage testsuite with it. Any tests I should run?



---

archive/issue_comments_306364.json:
```json
{
    "body": "Maybe `sage -t src/sage/interfaces/giac.py` and `rings` and `symbolic` would tell you if it looks functional or not.\n\nOn my side, `giac` also fails a lot of its own testsuite, inlcuding bunch of numerical noise, but also more worrying stuff i did not investigate, but running tests as above seems to indicate it is good enough for sage.",
    "created_at": "2017-06-19T09:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306364",
    "user": "jpflori"
}
```

Maybe `sage -t src/sage/interfaces/giac.py` and `rings` and `symbolic` would tell you if it looks functional or not.

On my side, `giac` also fails a lot of its own testsuite, inlcuding bunch of numerical noise, but also more worrying stuff i did not investigate, but running tests as above seems to indicate it is good enough for sage.



---

archive/issue_comments_306365.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-19T12:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306365",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_306366.json:
```json
{
    "body": "OK, I did run those tests and the few failures I have are unrelated to `giac` (I'll have to investigate some of them more deeply but they are definitely not `giac`). I guess we can go ahead with this.",
    "created_at": "2017-06-19T12:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306366",
    "user": "fbissey"
}
```

OK, I did run those tests and the few failures I have are unrelated to `giac` (I'll have to investigate some of them more deeply but they are definitely not `giac`). I guess we can go ahead with this.



---

archive/issue_comments_306367.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-22T07:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306367",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_306368.json:
```json
{
    "body": "Do you guys know *why* the `-Dx86_64` is needed on ppc64? That is still a bug that should be fixed upstream. In theory upstream should [now be detecting](http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?p=8877#p8877) 64-bit in a cross-platform way so I'm confused why it fails on ppc64.",
    "created_at": "2017-06-24T13:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306368",
    "user": "infinity0"
}
```

Do you guys know *why* the `-Dx86_64` is needed on ppc64? That is still a bug that should be fixed upstream. In theory upstream should [now be detecting](http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?p=8877#p8877) 64-bit in a cross-platform way so I'm confused why it fails on ppc64.



---

archive/issue_comments_306369.json:
```json
{
    "body": "(sorry, I have no idea why my comment there deleted the commit field)\n\n(I can't seem to fix it either, even by Modifying the ticket with that commit)",
    "created_at": "2017-06-24T13:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306369",
    "user": "infinity0"
}
```

(sorry, I have no idea why my comment there deleted the commit field)

(I can't seem to fix it either, even by Modifying the ticket with that commit)



---

archive/issue_comments_306370.json:
```json
{
    "body": "All tests pass for me for 1.2.3-51 on arm64 on Debian without further changes or extra flags, btw.",
    "created_at": "2017-06-24T13:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306370",
    "user": "infinity0"
}
```

All tests pass for me for 1.2.3-51 on arm64 on Debian without further changes or extra flags, btw.



---

archive/issue_comments_306371.json:
```json
{
    "body": "I'll have to try 1.2.3-51 on ppc64 without extra flags then. 1.2.3-47 builds but a lot of tests fail for me. We may want to consider a further upgrade.\n\nThe removal of the commit when you comment further is a \"feature\" of track. It is annoying but not harmfull.",
    "created_at": "2017-06-24T20:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306371",
    "user": "fbissey"
}
```

I'll have to try 1.2.3-51 on ppc64 without extra flags then. 1.2.3-47 builds but a lot of tests fail for me. We may want to consider a further upgrade.

The removal of the commit when you comment further is a "feature" of track. It is annoying but not harmfull.



---

archive/issue_comments_306372.json:
```json
{
    "body": "Well, you probably don't have that problem but I allow compilation without gui, and sage itself doesn't depend on fltk\n\n```\n  bool has_graph3d(Fl_Widget * widget){\n#ifdef HAVE_LIBFLTK\n    Fl_Group * g=dynamic_cast<Fl_Group *>(widget);\n```\n\nOooops! in src/Xcas.cc (line 3360) there goes your compilation failure if you don't have fltk.",
    "created_at": "2017-06-24T21:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306372",
    "user": "fbissey"
}
```

Well, you probably don't have that problem but I allow compilation without gui, and sage itself doesn't depend on fltk

```
  bool has_graph3d(Fl_Widget * widget){
#ifdef HAVE_LIBFLTK
    Fl_Group * g=dynamic_cast<Fl_Group *>(widget);
```

Oooops! in src/Xcas.cc (line 3360) there goes your compilation failure if you don't have fltk.



---

archive/issue_comments_306373.json:
```json
{
    "body": "I have found that annoying too, in Debian I am forced to ship the non-GUI icas program (which is what Sage actually wants) together with the GUI xcas program, and it even links against X libraries. I've [filed a bug](http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=4&t=1812) about it upstream, hopefully they can fix it.",
    "created_at": "2017-06-25T13:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306373",
    "user": "infinity0"
}
```

I have found that annoying too, in Debian I am forced to ship the non-GUI icas program (which is what Sage actually wants) together with the GUI xcas program, and it even links against X libraries. I've [filed a bug](http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=4&t=1812) about it upstream, hopefully they can fix it.



---

archive/issue_comments_306374.json:
```json
{
    "body": "Well, I pilled up some more in http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=4&t=1814 because your request, I felt, was much broader than mine (but yes something should be done about all that X stuff).",
    "created_at": "2017-06-25T22:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306374",
    "user": "fbissey"
}
```

Well, I pilled up some more in http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=4&t=1814 because your request, I felt, was much broader than mine (but yes something should be done about all that X stuff).



---

archive/issue_comments_306375.json:
```json
{
    "body": "Unfortunately giac fails to compile for me on a arm64 (aarch64) 4.9 Linux kernel:\n\nhttp://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?p=8941#p8941\n\nIt succeeded on a 3.16 Linux kernel though, as I reported above. Could someone reproduce this and if so re-open this ticket or open another one?",
    "created_at": "2017-07-19T12:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306375",
    "user": "infinity0"
}
```

Unfortunately giac fails to compile for me on a arm64 (aarch64) 4.9 Linux kernel:

http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?p=8941#p8941

It succeeded on a 3.16 Linux kernel though, as I reported above. Could someone reproduce this and if so re-open this ticket or open another one?



---

archive/issue_comments_306376.json:
```json
{
    "body": "A potential solution to this has been suggested on the Debian bug tracker: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=855078#29\n\nI'll try to test it next week, in the meantime feel free to jump in ahead.",
    "created_at": "2017-07-19T12:14:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22043",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22043#issuecomment-306376",
    "user": "infinity0"
}
```

A potential solution to this has been suggested on the Debian bug tracker: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=855078#29

I'll try to test it next week, in the meantime feel free to jump in ahead.
