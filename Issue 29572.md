# Issue 29572: Three.js: Upgrade to r117

Issue created by migration from https://trac.sagemath.org/ticket/29809

Original creator: paulmasson

Original creation time: 2020-06-05 22:10:26

CC:  â€‹egourgoulhon @jcamp0x2a fbissey

Keywords: threejs

The change to the template avoids a console warning that is new for this version.

The other console warning about OrbitControls cannot be removed because it represents a major change to the Three.js library that will take some effort to work around, but that does not need to be addressed until the beginning of next year.


---

Attachment


---

Comment by paulmasson created at 2020-06-05 22:14:55

Changing status from new to needs_review.


---

Comment by paulmasson created at 2020-06-05 22:14:55

New commits:


---

Comment by chapoton created at 2020-06-07 08:42:54

maybe you should add the new "upstream_url" field in checksums.ini ?

Something like this, adapted :

upstream_url=https://github.com/numpy/numpy/releases/download/vVERSION/numpy-VERSION.tar.gz


---

Comment by paulmasson created at 2020-06-07 21:34:10

Replying to [comment:5 chapoton]:
> maybe you should add the new "upstream_url" field in checksums.ini ?
> 
> Something like this, adapted :
> 
> upstream_url=https://github.com/numpy/numpy/releases/download/vVERSION/numpy-VERSION.tar.gz

The upstream zip file includes the entire project. We are only using a small fraction of it.


---

Comment by @jcamp0x2a created at 2020-06-08 20:52:44

Please forgive my ignorance of the process of updating a sage package, but I ran into build errors due to the zip file not existing on the mirrors (like the patch bot is currently reporting). Is this expected until the ticket gets merged or some other step is taken to sync them up? I was able to get it to build correctly by manually moving the zip into the `upstream/` directory.

I verified that the two files within the zip (`three.min.js` and `OrbitControls.js`) are indeed from the r117 release and that the listed checksums match. 

I had a collection of Jupyter notebooks on hand from prior work containing all of the examples in the plot3d reference documentation, so I did a quick side-by-side comparison with the old and new Three.js versions. I didn't observe any visual discrepancies, and the camera controls function the same as before. 

I also noticed the new console warning regarding `OrbitControls.js` as expected.

Was the other console warning you mentioned due to Three.js expecting a boolean value but  `json.useFlatShading` being null/undefined? I think `!!json.useFlatShading` would also work to coerce it to be boolean, but that's a minor nitpick.


---

Comment by paulmasson created at 2020-06-08 21:00:32

Joshua, copying the zip file to `upstream` is exactly what is needed in this circumstance, since it won't be copied to the mirrors until the ticket is approved. If you don't notice any problems in your notebooks then we're good to go.


---

Comment by @jcamp0x2a created at 2020-06-08 21:04:47

Ok, thank you. Just wanted to make sure that was expected. I've given a positive review.


---

Comment by @jcamp0x2a created at 2020-06-08 21:04:47

Changing status from needs_review to positive_review.


---

Comment by paulmasson created at 2020-06-08 21:30:15

Replying to [comment:9 gh-jcamp0x2a]:
> Ok, thank you. Just wanted to make sure that was expected. I've given a positive review.
Thanks!


---

Comment by vbraun created at 2020-06-27 09:26:08

Resolution: fixed
