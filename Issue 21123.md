# Issue 21123: Numerics in nested symbolic powers not combined

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2016-08-29 13:03:34

Numerics in power towers are not combined if nonnumerics present:

```
sage: ((x^(1/2) + 1)^2).expand()
x + 2*sqrt(x) + 1
sage: ((x^(x/2) + 1)^2).expand()
(x^(1/2*x))^2 + 2*x^(1/2*x) + 1
sage: ((x^(1/2*x))^2).expand()
(x^(1/2*x))^2
```


Also in GiNaC:

```
ginsh - GiNaC Interactive Shell (GiNaC V1.7.0)
  __,  _______  Copyright (C) 1999-2016 Johannes Gutenberg University Mainz,
 (__) *       | Germany.  This is free software with ABSOLUTELY NO WARRANTY.
  ._) i N a C | You are welcome to redistribute it under certain conditions.
<-------------' For details type `warranty;'.

Type ?? for a list of help topics.
> expand((x^(x/2)+1)^2);
1+2*x^(1/2*x)+(x^(1/2*x))^2
> expand((x^(x/2))^2);
(x^(1/2*x))^2
```


Sympy does it as expected:

```
In [5]: ((x**(x/2) + 1)**2).expand()
Out[5]:
   x
   ─
   2    x
2⋅x  + x  + 1

In [1]: ((x**(x/2))**2).expand()
Out[1]:
 x
x
```




---

Comment by rws created at 2016-08-29 14:17:37

The ticket is questioning this GiNaC code snippet (power.cpp:566):

```
        // Turn (x^c)^d into x^(c*d) in the case that x is positive and c is real.
        if (is_exactly_a<power>(ebasis) && ebasis.op(0).info(info_flags::positive) && ebasis.op(1).info(info_flags::real))
                return power(ebasis.op(0), ebasis.op(1) * eexponent);
```



---

Comment by rws created at 2016-08-29 14:37:11

Note there are two parts to this. If the outer exponent is a fraction then branches play a role and the discussion in #14305, which makes the GiNaC code in this case correct. This does not apply to the `sqrt(x)^2` case and even less to:

```
sage: ((x^(2*x))^2)
(x^(2*x))^2
```



---

Comment by rws created at 2016-08-29 14:56:08

This is now implemented in Pynac for the outer exponent a positive integer.


---

Comment by git created at 2016-09-18 06:35:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2016-09-18 06:36:53

Changing status from new to needs_review.


---

Comment by rws created at 2016-09-18 06:36:53

Changing priority from major to minor.


---

Comment by chapoton created at 2016-09-18 06:43:40

looks good. Please fill the Author field


---

Comment by chapoton created at 2016-09-18 06:43:40

Changing status from needs_review to positive_review.


---

Comment by rws created at 2016-09-18 06:59:31

Thanks.


---

Comment by vbraun created at 2016-09-19 23:12:06

Resolution: fixed
