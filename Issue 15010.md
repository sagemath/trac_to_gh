# Issue 15010: Introduce a baseclass for singletons

archive/issues_015010.json:
```json
{
    "body": "CC:  @nthiery @nbruin @novoselt\n\nSince some while, we have `sage.categories.category_singleton.Category_singleton`. A singleton is a class that allows the creation of exactly one instance (of any subclass). The technical implementa\ntion of `Category_singleton` is roughly like this: In some static `__classcall__`, test that the given class is a direct subclass of `Category_singleton`; then create a (the) instance of the class;\nthen set the override the classcall of this class and of the class of the instance (which might be a subclass) by a constant function returning the instance.\n\nI suggest to provide this construction scheme generally, in `sage.misc.fast_methods.SingletonClass`. The idea is: If one write a class inheriting from `SingletonClass` then one does not need to think about caching the unique instance or writing a fast hash or writing fast comparison, since this will all be inherited from `SingletonClass`.\n\nI suggest to use it at least on the rational field, which currently has a custom cache, and its hash method is written in Python.\n\nWith the branch that I am going to add, I get\n\n```\nsage: %timeit RationalField()\n1000000 loops, best of 3: 269 ns per loop\nsage: %timeit hash(QQ)\n10000000 loops, best of 3: 134 ns per loop\nsage: %timeit QQ==ZZ\n10000000 loops, best of 3: 144 ns per loop\n```\n\nWith vanilla sage-5.12.b5, it is a lot slower:\n\n```\nsage: %timeit RationalField()\n10000 loops, best of 3: 82.4 us per loop\nsage: %timeit hash(QQ)\n1000000 loops, best of 3: 496 ns per loop\nsage: %timeit QQ==ZZ\n1000000 loops, best of 3: 878 ns per loop\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/15247\n\n",
    "created_at": "2013-10-01T22:42:26Z",
    "labels": [
        "component: performance"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Introduce a baseclass for singletons",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15010",
    "user": "https://github.com/simon-king-jena"
}
```
CC:  @nthiery @nbruin @novoselt

Since some while, we have `sage.categories.category_singleton.Category_singleton`. A singleton is a class that allows the creation of exactly one instance (of any subclass). The technical implementa
tion of `Category_singleton` is roughly like this: In some static `__classcall__`, test that the given class is a direct subclass of `Category_singleton`; then create a (the) instance of the class;
then set the override the classcall of this class and of the class of the instance (which might be a subclass) by a constant function returning the instance.

I suggest to provide this construction scheme generally, in `sage.misc.fast_methods.SingletonClass`. The idea is: If one write a class inheriting from `SingletonClass` then one does not need to think about caching the unique instance or writing a fast hash or writing fast comparison, since this will all be inherited from `SingletonClass`.

I suggest to use it at least on the rational field, which currently has a custom cache, and its hash method is written in Python.

With the branch that I am going to add, I get

```
sage: %timeit RationalField()
1000000 loops, best of 3: 269 ns per loop
sage: %timeit hash(QQ)
10000000 loops, best of 3: 134 ns per loop
sage: %timeit QQ==ZZ
10000000 loops, best of 3: 144 ns per loop
```

With vanilla sage-5.12.b5, it is a lot slower:

```
sage: %timeit RationalField()
10000 loops, best of 3: 82.4 us per loop
sage: %timeit hash(QQ)
1000000 loops, best of 3: 496 ns per loop
sage: %timeit QQ==ZZ
1000000 loops, best of 3: 878 ns per loop
```

Issue created by migration from https://trac.sagemath.org/ticket/15247





---

archive/issue_comments_191622.json:
```json
{
    "body": "It is not \"needs review\" yet, but I guess it only needs test coverage for the new class.",
    "created_at": "2013-10-01T22:44:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191622",
    "user": "https://github.com/simon-king-jena"
}
```

It is not "needs review" yet, but I guess it only needs test coverage for the new class.



---

archive/issue_comments_191623.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-02T10:06:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191623",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191624.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-10-02T10:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191624",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_191625.json:
```json
{
    "body": "I did not run make ptest yet, but I have added tests for the new `SingletonClass` and hence change the ticket into \"needs review\".",
    "created_at": "2013-10-02T10:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191625",
    "user": "https://github.com/simon-king-jena"
}
```

I did not run make ptest yet, but I have added tests for the new `SingletonClass` and hence change the ticket into "needs review".



---

archive/issue_comments_191626.json:
```json
{
    "body": "It will be needed to change the expected output of several hash functions in the tests, as the hash of QQ is changed `object.__hash__(QQ)` with my branch.",
    "created_at": "2013-10-02T11:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191626",
    "user": "https://github.com/simon-king-jena"
}
```

It will be needed to change the expected output of several hash functions in the tests, as the hash of QQ is changed `object.__hash__(QQ)` with my branch.



---

archive/issue_comments_191627.json:
```json
{
    "body": "Oops, and much worse: It seems that I forgot to think about unpickling old pickles of QQ!",
    "created_at": "2013-10-02T11:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191627",
    "user": "https://github.com/simon-king-jena"
}
```

Oops, and much worse: It seems that I forgot to think about unpickling old pickles of QQ!



---

archive/issue_comments_191628.json:
```json
{
    "body": "Replying to [comment:6 SimonKing]:\n> Oops, and much worse: It seems that I forgot to think about unpickling old pickles of QQ!\n\n\nI stand corrected: THIS seems to work. But the pickle jar broke.",
    "created_at": "2013-10-02T11:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191628",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:6 SimonKing]:
> Oops, and much worse: It seems that I forgot to think about unpickling old pickles of QQ!


I stand corrected: THIS seems to work. But the pickle jar broke.



---

archive/issue_comments_191629.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-10-02T13:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191629",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_191630.json:
```json
{
    "body": "I have now clue what is going wrong here.\n\nI tested saving a rational number in vanilla sage, and I could read the pickle after rebuilding Sage with my branch. However, it seems that some old pickles in the pickle jar manage to create a version of the integer ring without calling its `__init__`. This could be accomplished by directly calling `__new__`. But is this really done somewhere?",
    "created_at": "2013-10-02T13:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191630",
    "user": "https://github.com/simon-king-jena"
}
```

I have now clue what is going wrong here.

I tested saving a rational number in vanilla sage, and I could read the pickle after rebuilding Sage with my branch. However, it seems that some old pickles in the pickle jar manage to create a version of the integer ring without calling its `__init__`. This could be accomplished by directly calling `__new__`. But is this really done somewhere?



---

archive/issue_comments_191631.json:
```json
{
    "body": "I won't have time to review this ticket, but I am all +1 on progress on this direction. Just one thing: the priority is not as high than #10963, and the two patches are likely to conflict with each other, so I'd recommend basing this one on top of #10963.\n\nCheers,\n                             Nicolas",
    "created_at": "2013-10-02T13:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191631",
    "user": "https://github.com/nthiery"
}
```

I won't have time to review this ticket, but I am all +1 on progress on this direction. Just one thing: the priority is not as high than #10963, and the two patches are likely to conflict with each other, so I'd recommend basing this one on top of #10963.

Cheers,
                             Nicolas



---

archive/issue_comments_191632.json:
```json
{
    "body": "Replying to [comment:9 nthiery]:\n> I won't have time to review this ticket, but I am all +1 on progress on this direction. Just one thing: the priority is not as high than #10963, and the two patches are likely to conflict with each other,\n\n\nWhy? My branch touches `sage.misc.fast_methods` and `sage.rings.rational_field` and nothing else. I do not aim (yet!) at changing `Category_singleton`, although it would make sense in the long run (i.e., after #10963.",
    "created_at": "2013-10-02T14:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191632",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:9 nthiery]:
> I won't have time to review this ticket, but I am all +1 on progress on this direction. Just one thing: the priority is not as high than #10963, and the two patches are likely to conflict with each other,


Why? My branch touches `sage.misc.fast_methods` and `sage.rings.rational_field` and nothing else. I do not aim (yet!) at changing `Category_singleton`, although it would make sense in the long run (i.e., after #10963.



---

archive/issue_comments_191633.json:
```json
{
    "body": "Replying to [comment:10 SimonKing]:\n> Why? My branch touches `sage.misc.fast_methods` and `sage.rings.rational_field` and nothing else. I do not aim (yet!) at changing `Category_singleton`, although it would make sense in the long run (i.e., after #10963.\n\n\nAh, ok, perfect! Double +1 on this ticket then. Well, as long as it does not eat up review time from you on #10963 :-)",
    "created_at": "2013-10-02T14:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191633",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:10 SimonKing]:
> Why? My branch touches `sage.misc.fast_methods` and `sage.rings.rational_field` and nothing else. I do not aim (yet!) at changing `Category_singleton`, although it would make sense in the long run (i.e., after #10963.


Ah, ok, perfect! Double +1 on this ticket then. Well, as long as it does not eat up review time from you on #10963 :-)



---

archive/issue_comments_191634.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-02T14:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191634",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191635.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-10-02T14:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191635",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_191636.json:
```json
{
    "body": "I did not run make ptest yet, but at least the new commit makes unpickle_all() work.",
    "created_at": "2013-10-02T14:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191636",
    "user": "https://github.com/simon-king-jena"
}
```

I did not run make ptest yet, but at least the new commit makes unpickle_all() work.



---

archive/issue_comments_191637.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-10-02T15:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191637",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_191638.json:
```json
{
    "body": "Oops, I forgot: Some hash values are to be updated as well.",
    "created_at": "2013-10-02T15:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191638",
    "user": "https://github.com/simon-king-jena"
}
```

Oops, I forgot: Some hash values are to be updated as well.



---

archive/issue_comments_191639.json:
```json
{
    "body": "Nice finding: One of the hash tests was in fact wrong, because it was a test for the hash of a *different* class!\n\nI am about to fix this now, by testing against the definition of the respective hash functions. So, I am not testing against the result on 64bit and 32 bit machines, since such tests don't seem meaningful to me.",
    "created_at": "2013-10-02T15:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191639",
    "user": "https://github.com/simon-king-jena"
}
```

Nice finding: One of the hash tests was in fact wrong, because it was a test for the hash of a *different* class!

I am about to fix this now, by testing against the definition of the respective hash functions. So, I am not testing against the result on 64bit and 32 bit machines, since such tests don't seem meaningful to me.



---

archive/issue_comments_191640.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-02T16:06:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191640",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191641.json:
```json
{
    "body": "Now I am confident that the tests will work, and that the branch is ready for review.",
    "created_at": "2013-10-02T16:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191641",
    "user": "https://github.com/simon-king-jena"
}
```

Now I am confident that the tests will work, and that the branch is ready for review.



---

archive/issue_comments_191642.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-10-02T16:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191642",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_191643.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-10-02T19:34:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191643",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_191644.json:
```json
{
    "body": "There are even more tests that test against the hash value of an instance of the wrong class!",
    "created_at": "2013-10-02T19:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191644",
    "user": "https://github.com/simon-king-jena"
}
```

There are even more tests that test against the hash value of an instance of the wrong class!



---

archive/issue_comments_191645.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-02T20:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191645",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191646.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-10-02T20:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191646",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_191647.json:
```json
{
    "body": "There were several hash tests to fix. In all cases, I stopped comparing against a particular number, because\n1. the number depends on the architecture (32- versus 64-bit)\n2. the number does not show how the hash function works\n3. one should test the result of `hash` against the hash function of the class being tested---otherwise (and this happened in at least three examples) one might test an instance of the wrong class.\n\nThe tests should work now.",
    "created_at": "2013-10-02T20:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191647",
    "user": "https://github.com/simon-king-jena"
}
```

There were several hash tests to fix. In all cases, I stopped comparing against a particular number, because
1. the number depends on the architecture (32- versus 64-bit)
2. the number does not show how the hash function works
3. one should test the result of `hash` against the hash function of the class being tested---otherwise (and this happened in at least three examples) one might test an instance of the wrong class.

The tests should work now.



---

archive/issue_comments_191648.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-02T21:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191648",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191649.json:
```json
{
    "body": "Replying to [comment:21 SimonKing]:\n> The tests should work now.\n\n\nAll but one test worked. The failing test was testing against the order of elements of a set. The obvious solution was to use \"sorted\" in the example. Hence, with the branch that I updated a minute ago, all tests pass for me.",
    "created_at": "2013-10-02T21:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191649",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:21 SimonKing]:
> The tests should work now.


All but one test worked. The failing test was testing against the order of elements of a set. The obvious solution was to use "sorted" in the example. Hence, with the branch that I updated a minute ago, all tests pass for me.



---

archive/issue_comments_191650.json:
```json
{
    "body": "Replying to [comment:8 SimonKing]:\n> However, it seems that some old pickles in the pickle jar manage to create a version of the integer ring without calling its `__init__`. This could be accomplished by directly calling `__new__`. But is this really done somewhere?\n\n\nI'm not sure I understand what you mean: isn't that (calling `__new__` but not `__init__`) how unpickling works in general?",
    "created_at": "2014-01-28T17:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191650",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:8 SimonKing]:
> However, it seems that some old pickles in the pickle jar manage to create a version of the integer ring without calling its `__init__`. This could be accomplished by directly calling `__new__`. But is this really done somewhere?


I'm not sure I understand what you mean: isn't that (calling `__new__` but not `__init__`) how unpickling works in general?



---

archive/issue_comments_191651.json:
```json
{
    "body": "* I am a little bit skeptical about tying the singleton behaviour to comparison by identity if `SingletonClass` is meant to be *the* way to implement singleton classes. Indeed, this makes it virtually unusable for Elements as long as sage keeps abusing `==` to implement semantic (as opposed to syntaxic) equality. And singleton classes descending from Element have at leat one natural use case, namely well-known constants (infinities, pi...). Could you please comment on this choice?\n* I don't like having the same explanations and/or tests repeated in several docstrings. I tried to remove redundancies in c5acb88a and 949b7b2aa. But feel free to revert these commits if you disagree!\n* The same goes for 207f6b72, where I applied `SingletonClass` to other parents (initially to check how usable it was in practice, but since it's done...).\n* Finally, I made a few minor changes in  d9ca799c. Could you please check that none of the things I \"fixed\" was intentional?\n \n---\nNew commits:",
    "created_at": "2014-01-28T19:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191651",
    "user": "https://github.com/mezzarobba"
}
```

* I am a little bit skeptical about tying the singleton behaviour to comparison by identity if `SingletonClass` is meant to be *the* way to implement singleton classes. Indeed, this makes it virtually unusable for Elements as long as sage keeps abusing `==` to implement semantic (as opposed to syntaxic) equality. And singleton classes descending from Element have at leat one natural use case, namely well-known constants (infinities, pi...). Could you please comment on this choice?
* I don't like having the same explanations and/or tests repeated in several docstrings. I tried to remove redundancies in c5acb88a and 949b7b2aa. But feel free to revert these commits if you disagree!
* The same goes for 207f6b72, where I applied `SingletonClass` to other parents (initially to check how usable it was in practice, but since it's done...).
* Finally, I made a few minor changes in  d9ca799c. Could you please check that none of the things I "fixed" was intentional?
 
---
New commits:



---

archive/issue_events_044115.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15010#event-44115"
}
```



---

archive/issue_events_044116.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15010#event-44116"
}
```



---

archive/issue_events_044117.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15010#event-44117"
}
```



---

archive/issue_comments_191652.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-11T08:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191652",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_191653.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2014-05-22T15:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191653",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_191654.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-05-22T15:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191654",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_191655.json:
```json
{
    "body": "rebased (not fully tested yet, but seems to work)\n\n---\nLast 10 new commits:",
    "created_at": "2014-05-22T15:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191655",
    "user": "https://github.com/mezzarobba"
}
```

rebased (not fully tested yet, but seems to work)

---
Last 10 new commits:



---

archive/issue_comments_191656.json:
```json
{
    "body": "Perhaps Simon can comment at some point, but here are my thoughts.\n\nReplying to [comment:25 mmezzarobba]:\n> * I am a little bit skeptical about tying the singleton behaviour to comparison by identity if `SingletonClass` is meant to be *the* way to implement singleton classes. Indeed, this makes it virtually unusable for Elements as long as sage keeps abusing `==` to implement semantic (as opposed to syntaxic) equality. And singleton classes descending from Element have at leat one natural use case, namely well-known constants (infinities, pi...). Could you please comment on this choice?\n\n\nI would say this is okay as you can always override `__eq__` as necessary, and python's default is to do equality check by id.\n\n> * I don't like having the same explanations and/or tests repeated in several docstrings. I tried to remove redundancies in c5acb88a and 949b7b2aa. But feel free to revert these commits if you disagree!\n\n\nI moved the pickling test to the class-level doc in order to make it more visible.\n\n> * The same goes for 207f6b72, where I applied `SingletonClass` to other parents (initially to check how usable it was in practice, but since it's done...).\n> * Finally, I made a few minor changes in  d9ca799c. Could you please check that none of the things I \"fixed\" was intentional?\n\n\nI think they were typos.\n\nI've also made some other misc review changes. However I have a question, should this be in `sage/misc` or in `sage/structure` since it feels more like a structural piece of Sage? Otherwise I'm happy with the current state of things (and found similar speedups).\n\n---\nNew commits:",
    "created_at": "2014-06-19T19:09:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191656",
    "user": "https://github.com/tscrim"
}
```

Perhaps Simon can comment at some point, but here are my thoughts.

Replying to [comment:25 mmezzarobba]:
> * I am a little bit skeptical about tying the singleton behaviour to comparison by identity if `SingletonClass` is meant to be *the* way to implement singleton classes. Indeed, this makes it virtually unusable for Elements as long as sage keeps abusing `==` to implement semantic (as opposed to syntaxic) equality. And singleton classes descending from Element have at leat one natural use case, namely well-known constants (infinities, pi...). Could you please comment on this choice?


I would say this is okay as you can always override `__eq__` as necessary, and python's default is to do equality check by id.

> * I don't like having the same explanations and/or tests repeated in several docstrings. I tried to remove redundancies in c5acb88a and 949b7b2aa. But feel free to revert these commits if you disagree!


I moved the pickling test to the class-level doc in order to make it more visible.

> * The same goes for 207f6b72, where I applied `SingletonClass` to other parents (initially to check how usable it was in practice, but since it's done...).
> * Finally, I made a few minor changes in  d9ca799c. Could you please check that none of the things I "fixed" was intentional?


I think they were typos.

I've also made some other misc review changes. However I have a question, should this be in `sage/misc` or in `sage/structure` since it feels more like a structural piece of Sage? Otherwise I'm happy with the current state of things (and found similar speedups).

---
New commits:



---

archive/issue_comments_191657.json:
```json
{
    "body": "Replying to [comment:32 tscrim]:\n> Perhaps Simon can comment at some point, but here are my thoughts.\n\n\nWell, at some point I should perhaps look at the code/doc again...\n\n> I've also made some other misc review changes. However I have a question, should this be in `sage/misc` or in `sage/structure` since it feels more like a structural piece of Sage?\n\n\nAt #15820 we had a similar discussion, and Nicolas has convinced me with the following: If the structure being implemented is Sage-specific (examples: elements, parents) then it goes into sage.structure. If the structure being implemented would make sense outside of Sage, then it goes into sage.misc (examples: classcall metaclass, sequences of bounded integers as in #15820).\n\nAnd I'd say that a singleton baseclass makes sense outside of Sage, hence, should go into sage.misc.",
    "created_at": "2014-06-19T20:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191657",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:32 tscrim]:
> Perhaps Simon can comment at some point, but here are my thoughts.


Well, at some point I should perhaps look at the code/doc again...

> I've also made some other misc review changes. However I have a question, should this be in `sage/misc` or in `sage/structure` since it feels more like a structural piece of Sage?


At #15820 we had a similar discussion, and Nicolas has convinced me with the following: If the structure being implemented is Sage-specific (examples: elements, parents) then it goes into sage.structure. If the structure being implemented would make sense outside of Sage, then it goes into sage.misc (examples: classcall metaclass, sequences of bounded integers as in #15820).

And I'd say that a singleton baseclass makes sense outside of Sage, hence, should go into sage.misc.



---

archive/issue_comments_191658.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-24T07:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191658",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191659.json:
```json
{
    "body": "Replying to [comment:33 SimonKing]:\n> At #15820 we had a similar discussion, and Nicolas has convinced me with the following: If the structure being implemented is Sage-specific (examples: elements, parents) then it goes into sage.structure. If the structure being implemented would make sense outside of Sage, then it goes into sage.misc (examples: classcall metaclass, sequences of bounded integers as in #15820).\n\n\nThanks for reminding me of that (and sorry, I let this ticket slip of my radar); Nicolas told me at one time but I couldn't remember which when where.\n \n> And I'd say that a singleton baseclass makes sense outside of Sage, hence, should go into sage.misc.\n\n\nI agree.\n\n---\n\nRebased and we just need a little bit more review.",
    "created_at": "2014-07-24T07:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191659",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:33 SimonKing]:
> At #15820 we had a similar discussion, and Nicolas has convinced me with the following: If the structure being implemented is Sage-specific (examples: elements, parents) then it goes into sage.structure. If the structure being implemented would make sense outside of Sage, then it goes into sage.misc (examples: classcall metaclass, sequences of bounded integers as in #15820).


Thanks for reminding me of that (and sorry, I let this ticket slip of my radar); Nicolas told me at one time but I couldn't remember which when where.
 
> And I'd say that a singleton baseclass makes sense outside of Sage, hence, should go into sage.misc.


I agree.

---

Rebased and we just need a little bit more review.



---

archive/issue_comments_191660.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-29T10:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191660",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_044118.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15010#event-44118"
}
```



---

archive/issue_events_044119.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15010#event-44119"
}
```



---

archive/issue_comments_191661.json:
```json
{
    "body": "**ping**\n\nCould someone just review my change `0d78737`? I've given a positive review to everything else.",
    "created_at": "2014-11-24T02:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191661",
    "user": "https://github.com/tscrim"
}
```

**ping**

Could someone just review my change `0d78737`? I've given a positive review to everything else.



---

archive/issue_comments_191662.json:
```json
{
    "body": "I just had a look at 0d78737, and it looks good to me.\n\nI would have two semi-unrelated suggestions though:\n\n- Maybe rename the class to `Singleton` rather than `SingletonClass`: then the name of the class will describe, as is usual, what its instances are, rather than the class itself.\n\n- For the test that is modified in 0d78737: make the inheritance explicit by creating a subclasss rather than trigerring such an inheritance through a call to _refine_category.\n\nThanks!\n\nCheers,\n                                  Nicolas",
    "created_at": "2014-11-24T12:41:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191662",
    "user": "https://github.com/nthiery"
}
```

I just had a look at 0d78737, and it looks good to me.

I would have two semi-unrelated suggestions though:

- Maybe rename the class to `Singleton` rather than `SingletonClass`: then the name of the class will describe, as is usual, what its instances are, rather than the class itself.

- For the test that is modified in 0d78737: make the inheritance explicit by creating a subclasss rather than trigerring such an inheritance through a call to _refine_category.

Thanks!

Cheers,
                                  Nicolas



---

archive/issue_comments_191663.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-25T01:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191663",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191664.json:
```json
{
    "body": "Done and done.",
    "created_at": "2014-11-25T01:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191664",
    "user": "https://github.com/tscrim"
}
```

Done and done.



---

archive/issue_comments_191665.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-25T04:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191665",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191666.json:
```json
{
    "body": "Thank you Travis! I double checked your changes, hence positive review.",
    "created_at": "2014-11-25T09:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191666",
    "user": "https://github.com/nthiery"
}
```

Thank you Travis! I double checked your changes, hence positive review.



---

archive/issue_comments_191667.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-25T09:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191667",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_191668.json:
```json
{
    "body": "Thank you Nicolas. Also thank you Simon and Marc for your work on this.",
    "created_at": "2014-11-25T15:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191668",
    "user": "https://github.com/tscrim"
}
```

Thank you Nicolas. Also thank you Simon and Marc for your work on this.



---

archive/issue_events_044120.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-27T15:33:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15010#event-44120"
}
```



---

archive/issue_comments_191669.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-11-27T15:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15010#issuecomment-191669",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
