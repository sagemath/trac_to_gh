# Issue 24712: Bug in p-adic expansion over ramified extensions

archive/issues_024712.json:
```json
{
    "body": "CC:  @roed314 @saraedum\n\nKeywords: expansion normalize\n\n\n```\nsage: R.<a> = Zp(2).extension(x^10 + 2)\nsage: x = R(a^4 + a^5)\nsage: y = R(a^2 + a^3)\nsage: z = x - y^2\nsage: z.expansion(4)\nTraceback (most recent call last):\n...\nPrecisionError:\n\nsage: z\na^5 + a^6 + a^15 + a^16 + O(a^204)\nsage: z.expansion(4)\n0\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24949\n\n",
    "created_at": "2018-03-11T17:12:40Z",
    "labels": [
        "padics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Bug in p-adic expansion over ramified extensions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24712",
    "user": "@xcaruso"
}
```
CC:  @roed314 @saraedum

Keywords: expansion normalize


```
sage: R.<a> = Zp(2).extension(x^10 + 2)
sage: x = R(a^4 + a^5)
sage: y = R(a^2 + a^3)
sage: z = x - y^2
sage: z.expansion(4)
Traceback (most recent call last):
...
PrecisionError:

sage: z
a^5 + a^6 + a^15 + a^16 + O(a^204)
sage: z.expansion(4)
0
```


Issue created by migration from https://trac.sagemath.org/ticket/24949





---

archive/issue_comments_346864.json:
```json
{
    "body": "Changing keywords from \"expansion normalize\" to \"expansion normalize, padicIMA\".",
    "created_at": "2018-07-22T20:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24712#issuecomment-346864",
    "user": "@roed314"
}
```

Changing keywords from "expansion normalize" to "expansion normalize, padicIMA".



---

archive/issue_comments_346865.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-06-02T20:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24712#issuecomment-346865",
    "user": "@xcaruso"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_346866.json:
```json
{
    "body": "Adding a call to `_normalize()' seems to fix the bug.\n----\nNew commits:",
    "created_at": "2022-06-02T20:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24712#issuecomment-346866",
    "user": "@xcaruso"
}
```

Adding a call to `_normalize()' seems to fix the bug.
----
New commits:



---

archive/issue_comments_346867.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-02T20:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24712#issuecomment-346867",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346868.json:
```json
{
    "body": "Positive review once tests pass.",
    "created_at": "2022-06-02T21:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24712#issuecomment-346868",
    "user": "@roed314"
}
```

Positive review once tests pass.



---

archive/issue_comments_346869.json:
```json
{
    "body": "It looks like there's an infinite recursion test failure....",
    "created_at": "2022-06-03T00:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24712#issuecomment-346869",
    "user": "@roed314"
}
```

It looks like there's an infinite recursion test failure....



---

archive/issue_comments_346870.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-03T14:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24712#issuecomment-346870",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_346871.json:
```json
{
    "body": "The problem comes from conversion between padic when p changes:\n\n\n```\nsage: Zp(2)(Zp(5)(1))\nTraceback (most recent call last):\n...\nRecursionError\n```\n\n\nIt is fixed by the latest commit.\n----\nNew commits:",
    "created_at": "2022-06-03T14:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24712#issuecomment-346871",
    "user": "@xcaruso"
}
```

The problem comes from conversion between padic when p changes:


```
sage: Zp(2)(Zp(5)(1))
Traceback (most recent call last):
...
RecursionError
```


It is fixed by the latest commit.
----
New commits:



---

archive/issue_comments_346872.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-06-03T18:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24712#issuecomment-346872",
    "user": "@roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_346873.json:
```json
{
    "body": "The docbuild error is `/home/sagemath/sage/src/doc/en/reference/spkg/libspatialindex.rst: WARNING: document isn't included in any toctree`, which has nothing to do with this ticket.",
    "created_at": "2022-06-03T18:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24712#issuecomment-346873",
    "user": "@roed314"
}
```

The docbuild error is `/home/sagemath/sage/src/doc/en/reference/spkg/libspatialindex.rst: WARNING: document isn't included in any toctree`, which has nothing to do with this ticket.



---

archive/issue_comments_346874.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-06-12T12:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24712",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24712#issuecomment-346874",
    "user": "@vbraun"
}
```

Resolution: fixed
