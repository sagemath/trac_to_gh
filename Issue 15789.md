# Issue 15789: Unable to view graph of small A2 odd KR crystal

Issue created by migration from https://trac.sagemath.org/ticket/16026

Original creator: tscrim

Original creation time: 2014-03-27 21:26:49

Assignee: sage-combinat

CC:  sage-combinat aschilling vbraun nthiery ncohen leif bsalisbury1

On a clean 6.2.beta5:

```
sage: C = KirillovReshetikhinCrystal(['A',5,2], 1,1)
sage: view(C, tightpage=True) # Latex error

sage: C = KirillovReshetikhinCrystal(['A',5,2], 2,1)
sage: view(C, tightpage=True) # Latex error

sage: C = KirillovReshetikhinCrystal(['A',7,2], 1,1)
sage: view(C, tightpage=True) # Latex error
```

But these all work:

```
sage: C = KirillovReshetikhinCrystal(['A',5,2], 3,1)
sage: C = KirillovReshetikhinCrystal(['A',5,2], 1,2)
sage: C = KirillovReshetikhinCrystal(['A',5,2], 2,2)
sage: C = KirillovReshetikhinCrystal(['A',4,2], 1,1)
```

Same for KR tableaux as well.


---

Comment by tscrim created at 2014-03-27 23:13:02

Also fails for D,B affine as well. So maybe it has something to do with the `KR_type_vertical`? But it also fails for the D spinors...and works for digraphs on restricted index sets:

```
sage: C = KirillovReshetikhinCrystal(['A',5,2], 1,1)
sage: G = C.digraph(index_set=[1,2,3])
sage: G = C.digraph(index_set=[0,1,2])
```

I'm quite puzzled right now about this...


---

Comment by aschilling created at 2014-03-27 23:25:03

Actually, for me none of the above work with the new development version

```
d184:sage anne$ sage -i dot2tex
Attempting to download package dot2tex
>>> Checking online list of optional packages.
[.]
>>> Found dot2tex-2.8.7.p2
Package dot2tex-2.8.7.p2 is already installed.
Use 'sage -f http://www.sagemath.org/spkg/optional/dot2tex-2.8.7.p2.spkg' to force a reinstallation.
d184:sage anne$ sage
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 6.2.beta5, Release Date: 2014-03-23                   │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: C = KirillovReshetikhinCrystal(['A',5,2], 3,1)
sage: view(C)
dot2tex not available.  Install after running 'sage -sh'
```

This is terrible! How did this happen??


---

Comment by aschilling created at 2014-03-27 23:34:46

This might be more helpful

```
sage: C = KirillovReshetikhinCrystal(['A',5,2], 1,1)
sage: view_anne(C)
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-2-8553f374adee> in <module>()
----> 1 view_anne(C)

<ipython-input-1-667d302d2adc> in view_anne(x, **options)
     18         x = copy(x)
     19         x.set_latex_options(**latex_options)
---> 20     view(x, **options)
     21 
     22 

/Applications/sage/local/lib/python2.7/site-packages/sage/misc/latex.pyc in view(objects, title, debug, sep, tiny, pdflatex, engine, viewer, tightpage, mode, combine_all, **kwds)
   2144     else:
   2145         latex_options = {}
-> 2146     s = _latex_file_(objects, title=title, sep=sep, tiny=tiny, debug=debug, **latex_options)
   2147     if engine is None:
   2148         engine = _Latex_prefs._option["engine"]

/Applications/sage/local/lib/python2.7/site-packages/sage/misc/latex.pyc in _latex_file_(objects, title, debug, sep, tiny, math_left, math_right, extra_preamble)
   1753         for i in range(len(objects)):
   1754             x = objects[i]
-> 1755             L = latex(x)
   1756             if not '\\begin{verbatim}' in L:
   1757                 s += '%s%s%s'%(math_left, L, math_right)

/Applications/sage/local/lib/python2.7/site-packages/sage/misc/latex.pyc in __call__(self, x, combine_all)
    912         """
    913         if has_latex_attr(x):
--> 914             return LatexExpr(x._latex_())
    915         try:
    916             f = latex_table[type(x)]

/Applications/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in _latex_(self)
    651         setup_latex_preamble()
    652 
--> 653         return self.latex_options().latex()
    654 
    655     def _matrix_(self, R=None):

/Applications/sage/local/lib/python2.7/site-packages/sage/graphs/graph_latex.pyc in latex(self)
   1312             return self.tkz_picture()
   1313         elif format == "dot2tex":
-> 1314             return self.dot2tex_picture()
   1315 
   1316     def dot2tex_picture(self):

/Applications/sage/local/lib/python2.7/site-packages/sage/graphs/graph_latex.pyc in dot2tex_picture(self)
   1344         """
   1345         from sage.graphs.dot2tex_utils import assert_have_dot2tex
-> 1346         assert_have_dot2tex()
   1347 
   1348         options = self.__graphlatex_options.copy()

/Applications/sage/local/lib/python2.7/site-packages/sage/graphs/dot2tex_utils.pyc in assert_have_dot2tex()
     60             raise RuntimeError(check_error_string)
     61     except ImportError:
---> 62         raise RuntimeError(missing_error_string)
     63 
     64 def quoted_latex(x):

RuntimeError: 
dot2tex not available.

Please see :meth:`sage.graphs.generic_graph.GenericGraph.layout_graphviz`
for installation instructions.
```



---

Comment by tscrim created at 2014-03-27 23:39:24

Okay the problem is in that the latex produced, one of the controls is very small. In fact I get a `2.8588e-15`, and pdflatex errors out saying (ironically)

> ! Dimension too large.

If I set that value to 0, I'm able to compile. So I'm just going to replace them out.


---

Comment by tscrim created at 2014-03-27 23:44:38

Changing status from new to needs_info.


---

Comment by tscrim created at 2014-03-27 23:44:38

Okay, I've pushed my (hack) fix, but IDK of a good way to put in a test for it. I also can't say what's going on for you Anne as dot2tex works fine for me (on my ubuntu home machine).
----
New commits:


---

Comment by aschilling created at 2014-03-28 02:58:51

Well, for me all viewing worked until I upgraded to sage-6.2.beta5 to check this ticket. And now for some reason Sage thinks that dot2tex is not installed even though it is.


---

Comment by ncohen created at 2014-03-28 06:46:36

Hmmmm... Instead of working on regexp, couldn't we convert them to float and round them ?....


---

Comment by tscrim created at 2014-03-28 15:21:57

Wouldn't that involve patching the `dot2tex` spkg? Perhaps we should do #14408 and see what happens too?

`@`Anne, perhaps with the recent upgrade of matplotlib (which I didn't do because it errored out for me) is breaking dot2tex similar to #14594.

Leif, do you have any thoughts on this?


---

Comment by tscrim created at 2014-03-29 15:18:49

FTR, the matplotlib update ticket is #14993.


---

Comment by bsalisbury1 created at 2014-03-29 16:21:17

Hi all,

I would like to reiterate that this does not seem to be restricted to KR crystals.  Standard crystals of tableaux yields the same error.


```
sage: C = crystals.Tableaux("B2",shape=[2,1])
sage: view(C)
dot2tex not available.  Install after running 'sage -sh'
```


I tried to force the install of dot2tex via `sage -i -f dot2tex` (with no reported errors), but the Sage output is still the same error.


---

Comment by aschilling created at 2014-03-29 16:37:22

Replying to [comment:11 tscrim]:
> FTR, the matplotlib update ticket is #14993.

Ok, thanks! I posted a message there! I think this is a major problem if none of the viewing tools work any longer (especially finalizing the k-Schur book and trying to make sure that all commands still work)!


---

Comment by vbraun created at 2014-03-29 17:04:32

First of all, whats up with the that catch-all "dot2tex not available" error message. If you can't be helpful then don't catch errors, just let the exception propagate so we can see what is wrong. And, as usual, if you want a feature to work then you need to doctest it.

You need to remove patches/use-matplotlib-pyparsing.patch from the dot2tex spkg. Whose idea was it to import internals of matplotlib? Did you think that it is not going to break with the next matplotlib update?


---

Comment by aschilling created at 2014-03-29 19:32:18

Hi Volker,

Who do you mean by you? I did not write the dot2tex package. See comment 4 for a perhaps more useful error message!

I do not understand your comment about removing patches/use-matplotlib-pyparsing.patch from the dot2tex spkg. Where should I remove this? I went to 

```
sage/local/lib/python2.7/site-packages/dot2tex
```

When I search both files dot2tex.py and dotparsing.py for .patch there is nothing found. So where do I remove this?

Anne


---

Comment by aschilling created at 2014-03-29 19:36:10

Hi Volker again,

Also, how do you recommend to add doctests? There are lots of doctests using view, but they
are optional, first of all since not everyone has dot2tex installed and second of all, how do you doc test view??

Best,

Anne


---

Comment by tscrim created at 2014-03-29 19:49:58

Hey Anne,

He means in the corresponding spkg folder (I think it this case it's the upstream tarball since dot2tex hasn't been converted to the new spkg layout yet).

Volker,

Leif did this in #14594 in order to get dot2tex to work because dot2tex needs pyparsing, which newer versions of matplotlib doesn't contain. Instead it has pyparsing_2/3, which needs to be imported. Or something like that.


---

Comment by vbraun created at 2014-03-29 20:11:30

The whole drawing stuff also used invalid node labels that newer dot2tex barfs about...
----
New commits:


---

Comment by vbraun created at 2014-03-29 20:14:14

Also, you can doctest the latex generation. And if you need dot2tex all the time then work towards making it a standard package.


---

Comment by jhpalmieri created at 2014-03-29 20:19:20

Try this spkg: http://sage.math.washington.edu/home/palmieri/SPKG/dot2tex-2.8.7.p3.spkg. It should fix at least some of the problems, I think. (It's not ready for review: it has uncommitted changes, and someone should convert it to a new style package.)


---

Comment by jhpalmieri created at 2014-03-29 20:21:58

Sorry, Volker, I didn't notice your branch. It's pretty similar to my spkg, except that I also added this line (maybe unnecessary):

```
_noncomma = "".join( [ c for c in printables if c != "," ] )
```

to compensate for not importing it.


---

Comment by tscrim created at 2014-03-29 20:37:12

Replying to [comment:21 vbraun]:
> Also, you can doctest the latex generation. And if you need dot2tex all the time then work towards making it a standard package. 

We had a discussion about that, and I remember the result being not to do so because it requires graphviz, which we cannot make a standard spkg due to the license.


---

Comment by vbraun created at 2014-03-29 20:40:36

Maybe you should use something else to draw your figures, then


---

Comment by git created at 2014-03-29 20:46:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2014-03-29 20:48:41

John, nothing in dot2tex refers to `_noncomma`.


---

Comment by jhpalmieri created at 2014-03-29 21:29:47

Replying to [comment:27 vbraun]:
> John, nothing in dot2tex refers to `_noncomma`.

Great, so it was just a useless (or old) import on their part.


---

Comment by tscrim created at 2014-03-29 21:57:38

Changing status from needs_info to needs_work.


---

Comment by aschilling created at 2014-03-29 22:02:41

Hi Volker,

Thanks for the fixes! However, when I run make on the new branch, I get an error

```
++ -bundle -undefined dynamic_lookup -L/Applications/sage/local/lib build/temp.macosx-10.6-x86_64-2.7/sage/symbolic/pynac.o -L/Applications/sage/local/lib -lgsl -lpynac -lgmp -lcsage -lstdc++ -lntl -o build/lib.macosx-10.6-x86_64-2.7/sage/symbolic/pynac.so
g++ -bundle -undefined dynamic_lookup -L/Applications/sage/local/lib build/temp.macosx-10.6-x86_64-2.7/sage/symbolic/expression.o -L/Applications/sage/local/lib -lpynac -lgmp -lcsage -lstdc++ -lntl -o build/lib.macosx-10.6-x86_64-2.7/sage/symbolic/expression.so
Time to execute 4 commands: 3.07225799561 seconds
Total time spent compiling C/C++ extensions:  3.22448396683 seconds.
running install_lib
copying build/lib.macosx-10.6-x86_64-2.7/sage/symbolic/constants_c.so -> /Applications/sage/local/lib/python2.7/site-packages/sage/symbolic
copying build/lib.macosx-10.6-x86_64-2.7/sage/symbolic/expression.so -> /Applications/sage/local/lib/python2.7/site-packages/sage/symbolic
copying build/lib.macosx-10.6-x86_64-2.7/sage/symbolic/getitem.so -> /Applications/sage/local/lib/python2.7/site-packages/sage/symbolic
copying build/lib.macosx-10.6-x86_64-2.7/sage/symbolic/pynac.so -> /Applications/sage/local/lib/python2.7/site-packages/sage/symbolic
running install_egg_info
Removing /Applications/sage/local/lib/python2.7/site-packages/sage-6.2.beta5-py2.7.egg-info
Writing /Applications/sage/local/lib/python2.7/site-packages/sage-6.2.beta5-py2.7.egg-info

real	0m8.791s
user	0m4.133s
sys	0m1.572s
[ -f local/etc/sage-started.txt ] || local/bin/sage-starts
build/pipestatus "./sage --docbuild --no-pdf-links all html  2>&1" "tee -a logs/dochtml.log"
Traceback (most recent call last):
  File "/Applications/sage/src/doc/common/builder.py", line 1465, in <module>
    import sage.all
  File "/Applications/sage/local/lib/python2.7/site-packages/sage/all.py", line 106, in <module>
    from sage.algebras.all   import *
  File "/Applications/sage/local/lib/python2.7/site-packages/sage/algebras/all.py", line 39, in <module>
    from iwahori_hecke_algebra import IwahoriHeckeAlgebra, IwahoriHeckeAlgebraT
  File "/Applications/sage/local/lib/python2.7/site-packages/sage/algebras/iwahori_hecke_algebra.py", line 33, in <module>
    from sage.combinat.root_system.weyl_group import WeylGroup
  File "/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/__init__.py", line 13, in <module>
    import all
  File "/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/all.py", line 9, in <module>
    from weyl_group import WeylGroup, WeylGroupElement
  File "/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/weyl_group.py", line 54, in <module>
    from sage.graphs.graph import DiGraph
  File "/Applications/sage/local/lib/python2.7/site-packages/sage/graphs/graph.py", line 6412, in <module>
    import sage.graphs.cliquer
ImportError: dlopen(/Applications/sage/local/lib/python2.7/site-packages/sage/graphs/cliquer.so, 2): Symbol not found: 	"#
  Referenced from: /Applications/sage/local/lib/libcliquer.so
  Expected in: flat namespace

make: *** [doc-html] Error 1
```


Anne


---

Comment by vbraun created at 2014-03-29 23:51:02

Replying to [comment:30 aschilling]:
> ImportError: dlopen(/Applications/sage/local/lib/python2.7/site-packages/sage/graphs/cliquer.so, 2): Symbol not found: 	"#
>   Referenced from: /Applications/sage/local/lib/libcliquer.so
>   Expected in: flat namespace

Does a "make distclean && make" fix it?


---

Comment by vbraun created at 2014-03-29 23:51:26

Changing status from needs_work to needs_review.


---

Comment by leif created at 2014-03-30 00:00:31

Sorry, commented on the wrong ticket (#14594, http://trac.sagemath.org/ticket/14594#comment:62).

Yes, `_noncomma` isn't used by dot2tex, so we can remove it from the import statement.

But I'd keep the patch trying to use (some version of) `pyparsing` from matplotlib, just adding yet another import fallback:

```diff
--- local/lib/python2.7/site-packages/dot2tex/dotparsing.py	2014-03-29 12:34:13.000000000 -0700
+++ local/lib/python2.7/site-packages/dot2tex/dotparsing.py	2014-03-29 14:35:53.000000000 -0700
@@ -23,8 +23,11 @@
     # Newer MPL now ships with pyparsing_py2 and pyparsing_py3:
     import matplotlib.pyparsing_py2 as pyparsing
 except ImportError:
-    import matplotlib.pyparsing as pyparsing
-    # just raise if that failed, too
+    try:
+        import matplotlib.pyparsing as pyparsing
+    except ImportError:
+        import pyparsing # shipped separately with newer Sage versions (>= 6.2.beta5)
+        # just raise if that failed, too
 
 exec(
 """
```


`dot2tex` is still an optional spkg, so is likely to get used with older Sage versions as well (and not just the latest _development_ version) -- and that should just work.

Another issue is the odd error message currently given, and dot2tex's `spkg-install` should probably contain some minimal test to avoid such things in the future.


---

Comment by aschilling created at 2014-03-30 03:09:41

> Does a "make distclean && make" fix it?

That gives me another error

```
...
ranlib libsingfac_g.a
./mkinstalldirs /Applications/sage/local/include
./mkinstalldirs /Applications/sage/local/lib
./install-sh -c -m 644 factor.h /Applications/sage/local/include
./install-sh -c -m 644 libsingfac.a /Applications/sage/local/lib
./install-sh -c -m 644 libsingfac_g.a /Applications/sage/local/lib
ranlib /Applications/sage/local/lib/libsingfac.a
ranlib /Applications/sage/local/lib/libsingfac_g.a
### Singular spkg-install: create_singular_script ###
### Singular spkg-install: install_docs ###

real	19m2.627s
user	21m52.169s
sys	1m34.576s
Successfully installed singular-3.1.6.p1
Deleting temporary build directory
/Applications/sage/local/var/tmp/sage/build/singular-3.1.6.p1
Finished installing singular-3.1.6.p1.spkg
make[1]: *** [all] Error 2

real	104m43.353s
user	248m14.206s
sys	27m39.625s
***************************************************************
Error building Sage.

The following package(s) may have failed to build:

package: pycrypto-2.6.1.p0
log file: /Applications/sage/logs/pkgs/pycrypto-2.6.1.p0.log
build directory: /Applications/sage/local/var/tmp/sage/build/pycrypto-2.6.1.p0

The build directory may contain configuration files and other potentially
helpful information. WARNING: if you now run 'make' again, the build
directory will, by default, be deleted. Set the environment variable
SAGE_KEEP_BUILT_SPKGS to 'yes' to prevent this.

make: *** [build] Error 1
```



---

Comment by git created at 2014-03-30 10:40:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2014-03-30 10:42:51

Anne: so whats in the pycrypto log?


---

Comment by vbraun created at 2014-03-30 10:45:35

Leif: You can't go around and import stuff from package internals, that will break with the next update in exactly the way we saw here. Also you can't use the git branch with old versions.


---

Comment by git created at 2014-03-30 12:05:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2014-03-30 12:20:38

Upstream bug report for the `_noncomma` import:

* https://code.google.com/p/dot2tex/issues/detail?id=38

Bug reports for the `DeprecationWarning: Operator '<<' is deprecated, use '<<=' instead` issue:
* https://sourceforge.net/p/pyparsing/bugs/69/        
* https://code.google.com/p/dot2tex/issues/detail?id=39


---

Comment by aschilling created at 2014-03-30 15:17:26

Replying to [comment:39 vbraun]:
> Anne: so whats in the pycrypto log?

Here it is. But I cannot even compile the stable version of sage any longer. What is going on?

```
Found local metadata for pycrypto-2.6.1.p0
Found local sources at /Applications/sage/upstream/pycrypto-2.6.1.tar.gz
Checksum: aeda3ed41caf1766409d4efc689b9ca30ad6aeb2 vs aeda3ed41caf1766409d4efc689b9ca30ad6aeb2
pycrypto-2.6.1.p0
====================================================
Setting up build directory for pycrypto-2.6.1.p0
Finished set up
****************************************************
Host system:
Darwin lolita-4.local 10.8.0 Darwin Kernel Version 10.8.0: Tue Jun  7 16:33:36 PDT 2011; root:xnu-1504.15.3~1/RELEASE_I386 i386
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/Applications/sage/local/libexec/gcc/x86_64-apple-darwin10.8.0/4.7.3/lto-wrapper
Target: x86_64-apple-darwin10.8.0
Configured with: ../src/configure --prefix=/Applications/sage/local --with-local-prefix=/Applications/sage/local --with-gmp=/Applications/sage/local --with-mpfr=/Applications/sage/local --with-mpc=/Applications/sage/local --with-system-zlib --disable-multilib --disable-nls  
Thread model: posix
gcc version 4.7.3 (GCC) 
****************************************************
patching file src/libtom/tomcrypt_pk.h
running install
running build
running build_py
creating build
creating build/lib.macosx-10.6-x86_64-2.7
creating build/lib.macosx-10.6-x86_64-2.7/Crypto
copying lib/Crypto/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto
copying lib/Crypto/pct_warnings.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto
creating build/lib.macosx-10.6-x86_64-2.7/Crypto/Hash
copying lib/Crypto/Hash/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Hash
copying lib/Crypto/Hash/hashalgo.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Hash
copying lib/Crypto/Hash/HMAC.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Hash
copying lib/Crypto/Hash/MD2.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Hash
copying lib/Crypto/Hash/MD4.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Hash
copying lib/Crypto/Hash/MD5.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Hash
copying lib/Crypto/Hash/RIPEMD.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Hash
copying lib/Crypto/Hash/SHA.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Hash
copying lib/Crypto/Hash/SHA224.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Hash
copying lib/Crypto/Hash/SHA256.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Hash
copying lib/Crypto/Hash/SHA384.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Hash
copying lib/Crypto/Hash/SHA512.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Hash
creating build/lib.macosx-10.6-x86_64-2.7/Crypto/Cipher
copying lib/Crypto/Cipher/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Cipher
copying lib/Crypto/Cipher/AES.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Cipher
copying lib/Crypto/Cipher/ARC2.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Cipher
copying lib/Crypto/Cipher/ARC4.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Cipher
copying lib/Crypto/Cipher/blockalgo.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Cipher
copying lib/Crypto/Cipher/Blowfish.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Cipher
copying lib/Crypto/Cipher/CAST.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Cipher
copying lib/Crypto/Cipher/DES.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Cipher
copying lib/Crypto/Cipher/DES3.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Cipher
copying lib/Crypto/Cipher/PKCS1_OAEP.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Cipher
copying lib/Crypto/Cipher/PKCS1_v1_5.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Cipher
copying lib/Crypto/Cipher/XOR.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Cipher
creating build/lib.macosx-10.6-x86_64-2.7/Crypto/Util
copying lib/Crypto/Util/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Util
copying lib/Crypto/Util/_number_new.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Util
copying lib/Crypto/Util/asn1.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Util
copying lib/Crypto/Util/Counter.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Util
copying lib/Crypto/Util/number.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Util
copying lib/Crypto/Util/py21compat.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Util
copying lib/Crypto/Util/py3compat.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Util
copying lib/Crypto/Util/randpool.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Util
copying lib/Crypto/Util/RFC1751.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Util
copying lib/Crypto/Util/winrandom.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Util
creating build/lib.macosx-10.6-x86_64-2.7/Crypto/Random
copying lib/Crypto/Random/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Random
copying lib/Crypto/Random/_UserFriendlyRNG.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Random
copying lib/Crypto/Random/random.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Random
creating build/lib.macosx-10.6-x86_64-2.7/Crypto/Random/Fortuna
copying lib/Crypto/Random/Fortuna/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Random/Fortuna
copying lib/Crypto/Random/Fortuna/FortunaAccumulator.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Random/Fortuna
copying lib/Crypto/Random/Fortuna/FortunaGenerator.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Random/Fortuna
copying lib/Crypto/Random/Fortuna/SHAd256.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Random/Fortuna
creating build/lib.macosx-10.6-x86_64-2.7/Crypto/Random/OSRNG
copying lib/Crypto/Random/OSRNG/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Random/OSRNG
copying lib/Crypto/Random/OSRNG/fallback.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Random/OSRNG
copying lib/Crypto/Random/OSRNG/nt.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Random/OSRNG
copying lib/Crypto/Random/OSRNG/posix.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Random/OSRNG
copying lib/Crypto/Random/OSRNG/rng_base.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Random/OSRNG
creating build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest
copying lib/Crypto/SelfTest/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest
copying lib/Crypto/SelfTest/st_common.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest
creating build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Cipher
copying lib/Crypto/SelfTest/Cipher/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Cipher
copying lib/Crypto/SelfTest/Cipher/common.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Cipher
copying lib/Crypto/SelfTest/Cipher/test_AES.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Cipher
copying lib/Crypto/SelfTest/Cipher/test_ARC2.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Cipher
copying lib/Crypto/SelfTest/Cipher/test_ARC4.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Cipher
copying lib/Crypto/SelfTest/Cipher/test_Blowfish.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Cipher
copying lib/Crypto/SelfTest/Cipher/test_CAST.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Cipher
copying lib/Crypto/SelfTest/Cipher/test_DES.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Cipher
copying lib/Crypto/SelfTest/Cipher/test_DES3.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Cipher
copying lib/Crypto/SelfTest/Cipher/test_pkcs1_15.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Cipher
copying lib/Crypto/SelfTest/Cipher/test_pkcs1_oaep.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Cipher
copying lib/Crypto/SelfTest/Cipher/test_XOR.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Cipher
creating build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Hash
copying lib/Crypto/SelfTest/Hash/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Hash
copying lib/Crypto/SelfTest/Hash/common.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Hash
copying lib/Crypto/SelfTest/Hash/test_HMAC.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Hash
copying lib/Crypto/SelfTest/Hash/test_MD2.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Hash
copying lib/Crypto/SelfTest/Hash/test_MD4.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Hash
copying lib/Crypto/SelfTest/Hash/test_MD5.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Hash
copying lib/Crypto/SelfTest/Hash/test_RIPEMD.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Hash
copying lib/Crypto/SelfTest/Hash/test_SHA.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Hash
copying lib/Crypto/SelfTest/Hash/test_SHA224.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Hash
copying lib/Crypto/SelfTest/Hash/test_SHA256.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Hash
copying lib/Crypto/SelfTest/Hash/test_SHA384.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Hash
copying lib/Crypto/SelfTest/Hash/test_SHA512.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Hash
creating build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Protocol
copying lib/Crypto/SelfTest/Protocol/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Protocol
copying lib/Crypto/SelfTest/Protocol/test_AllOrNothing.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Protocol
copying lib/Crypto/SelfTest/Protocol/test_chaffing.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Protocol
copying lib/Crypto/SelfTest/Protocol/test_KDF.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Protocol
copying lib/Crypto/SelfTest/Protocol/test_rfc1751.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Protocol
creating build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/PublicKey
copying lib/Crypto/SelfTest/PublicKey/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/PublicKey
copying lib/Crypto/SelfTest/PublicKey/test_DSA.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/PublicKey
copying lib/Crypto/SelfTest/PublicKey/test_ElGamal.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/PublicKey
copying lib/Crypto/SelfTest/PublicKey/test_importKey.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/PublicKey
copying lib/Crypto/SelfTest/PublicKey/test_RSA.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/PublicKey
creating build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Random
copying lib/Crypto/SelfTest/Random/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Random
copying lib/Crypto/SelfTest/Random/test__UserFriendlyRNG.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Random
copying lib/Crypto/SelfTest/Random/test_random.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Random
copying lib/Crypto/SelfTest/Random/test_rpoolcompat.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Random
creating build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Random/Fortuna
copying lib/Crypto/SelfTest/Random/Fortuna/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Random/Fortuna
copying lib/Crypto/SelfTest/Random/Fortuna/test_FortunaAccumulator.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Random/Fortuna
copying lib/Crypto/SelfTest/Random/Fortuna/test_FortunaGenerator.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Random/Fortuna
copying lib/Crypto/SelfTest/Random/Fortuna/test_SHAd256.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Random/Fortuna
creating build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Random/OSRNG
copying lib/Crypto/SelfTest/Random/OSRNG/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Random/OSRNG
copying lib/Crypto/SelfTest/Random/OSRNG/test_fallback.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Random/OSRNG
copying lib/Crypto/SelfTest/Random/OSRNG/test_generic.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Random/OSRNG
copying lib/Crypto/SelfTest/Random/OSRNG/test_nt.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Random/OSRNG
copying lib/Crypto/SelfTest/Random/OSRNG/test_posix.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Random/OSRNG
copying lib/Crypto/SelfTest/Random/OSRNG/test_winrandom.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Random/OSRNG
creating build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Util
copying lib/Crypto/SelfTest/Util/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Util
copying lib/Crypto/SelfTest/Util/test_asn1.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Util
copying lib/Crypto/SelfTest/Util/test_Counter.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Util
copying lib/Crypto/SelfTest/Util/test_number.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Util
copying lib/Crypto/SelfTest/Util/test_winrandom.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Util
creating build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Signature
copying lib/Crypto/SelfTest/Signature/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Signature
copying lib/Crypto/SelfTest/Signature/test_pkcs1_15.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Signature
copying lib/Crypto/SelfTest/Signature/test_pkcs1_pss.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/SelfTest/Signature
creating build/lib.macosx-10.6-x86_64-2.7/Crypto/Protocol
copying lib/Crypto/Protocol/__init__.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Protocol
copying lib/Crypto/Protocol/AllOrNothing.py -> build/lib.macosx-10.6-x86_64-2.7/Crypto/Protocol
Traceback (most recent call last):
  File "setup.py", line 456, in <module>
    core.setup(**kw)
  File "/Applications/sage/local/lib/python/distutils/core.py", line 152, in setup
    dist.run_commands()
  File "/Applications/sage/local/lib/python/distutils/dist.py", line 953, in run_commands
    self.run_command(cmd)
  File "/Applications/sage/local/lib/python/distutils/dist.py", line 972, in run_command
    cmd_obj.run()
  File "/Applications/sage/local/lib/python/distutils/command/install.py", line 563, in run
    self.run_command('build')
  File "/Applications/sage/local/lib/python/distutils/cmd.py", line 326, in run_command
    self.distribution.run_command(command)
  File "/Applications/sage/local/lib/python/distutils/dist.py", line 972, in run_command
    cmd_obj.run()
  File "/Applications/sage/local/lib/python/distutils/command/build.py", line 127, in run
    self.run_command(cmd_name)
  File "/Applications/sage/local/lib/python/distutils/cmd.py", line 326, in run_command
    self.distribution.run_command(command)
  File "/Applications/sage/local/lib/python/distutils/dist.py", line 972, in run_command
    cmd_obj.run()
  File "setup.py", line 251, in run
    self.run_command(cmd_name)
  File "/Applications/sage/local/lib/python/distutils/cmd.py", line 326, in run_command
    self.distribution.run_command(command)
  File "/Applications/sage/local/lib/python/distutils/dist.py", line 972, in run_command
    cmd_obj.run()
  File "setup.py", line 278, in run
    raise RuntimeError("autoconf error")
RuntimeError: autoconf error
Error: Failed to install PyCrypto.

real    0m0.460s
user    0m0.137s
sys     0m0.148s
************************************************************************
Error installing package pycrypto-2.6.1.p0
************************************************************************
Please email sage-devel (http://groups.google.com/group/sage-devel)
explaining the problem and including the relevant part of the log file
  /Applications/sage/logs/pkgs/pycrypto-2.6.1.p0.log
Describe your computer, operating system, etc.
If you want to try to fix the problem yourself, *don't* just cd to
/Applications/sage/local/var/tmp/sage/build/pycrypto-2.6.1.p0 and type 'make' or whatever is appropriate.
Instead, the following commands setup all environment variables
correctly and load a subshell for you to debug the error:
  (cd '/Applications/sage/local/var/tmp/sage/build/pycrypto-2.6.1.p0' && '/Applications/sage/sage' --sh)
When you are done debugging, you can type "exit" to leave the subshell.
************************************************************************
```



---

Comment by vbraun created at 2014-03-30 15:43:08

Sounds like an unrelated failure. You can use `git fsck` to check that the git repository is undamaged (ignore dangling blobs, those are fine)...


---

Comment by aschilling created at 2014-03-30 16:06:39

Replying to [comment:44 vbraun]:
> Sounds like an unrelated failure. You can use `git fsck` to check that the git repository is undamaged (ignore dangling blobs, those are fine)...

```
d184:sage anne$ git fsck
Checking object directories: 100% (256/256), done.
Checking objects: 100% (242102/242102), done.
Checking connectivity: 240019, done.
```



---

Comment by aschilling created at 2014-03-30 16:56:40

How do I uninstall my previous installation of dot2tex? Do I just delete the corresponding files in sage/build/pkgs? And then unpack dot2tex-20120520 there?


---

Comment by vbraun created at 2014-03-30 18:47:53

You can delete `local/lib/python/site-packages/dot2tex`. Or run `make distclean && make`, of course.


---

Comment by aschilling created at 2014-03-30 22:48:28

Replying to [comment:47 vbraun]:
> You can delete `local/lib/python/site-packages/dot2tex`. Or run `make distclean && make`, of course.

I do not have any dot2tex in local/lib/python/site-packages/. Also, I keep getting the error above regarding pycrypto-2.6.1.p0, even after `make distclean && make`. How is this unrelated to this branch? I literally ran `make` on the master branch just before switching to this branch, everything compiled fine. Then I ran `make distclean && make` on this branch and got the pycrypto-2.6.1.p0 error and now it even get it for the master branch. So I cannot run sage at all. What am I supposed to do? Just install sage from scratch?


---

Comment by vbraun created at 2014-03-31 00:21:34

Running "make distclean && make" is equivalent to installing Sage from scratch.

If you get the same problem on a fresh install then it is unrelated to this ticket. Post to sage-devel. A google search finds this: https://groups.google.com/forum/#!topic/sage-devel/pcBPs9aRH6w


---

Comment by aschilling created at 2014-03-31 06:46:47

Replying to [comment:49 vbraun]:
> Running "make distclean && make" is equivalent to installing Sage from scratch.
> 
> If you get the same problem on a fresh install then it is unrelated to this ticket. Post to sage-devel. A google search finds this: https://groups.google.com/forum/#!topic/sage-devel/pcBPs9aRH6w

Ok, great! This link helped and I finally got sage to install again. I put your dot2tex-20120520.tar.bz2 in my upstream folder and ran `sage -i dot2tex`. But after that I still get 

```
sage: C = KirillovReshetikhinCrystal(['A',5,2], 1,1)
sage: view(C)
dot2tex not available.  Install after running 'sage -sh'
```



---

Comment by aschilling created at 2014-03-31 15:57:51

Ok, I installed John's spkg and it indeed fixed the viewing problem! I do not know how to install Volker's file

```
sage anne$ sage -f /Applications/sage/upstream/dot2tex-20120520.tar.bz2 
dot2tex-20120520.tar.bz2
====================================================
Extracting package /Applications/sage/upstream/dot2tex-20120520.tar.bz2
-rw-------@ 1 anne  staff  1731531 Mar 31 08:42 /Applications/sage/upstream/dot2tex-20120520.tar.bz2
Finished extraction
/Applications/sage/src/bin/sage-spkg: line 594: cd: dot2tex-20120520.tar.bz2: No such file or directory
Error: after extracting, the directory dot2tex-20120520.tar.bz2 does not exist
```

Or do I need to unpack it by hand somewhere? But where? I tried to put it into /Applications/sage/local/lib/python2.7/site-packages but that did not seem to do the trick.


---

Comment by jhpalmieri created at 2014-03-31 16:15:09

Two comments: first, I agree with Leif's remarks that it would be best to have a package which will also work with older versions of Sage. Second, if I first install the old (2.8.7) spkg and then install the new one from Volker's branch, it says that the new one has been installed correctly, but the files in `local/lib/python/site-packages/dot2tex` are still the old ones. Do we need to delete the old installation before doing `python setup.py install` in the `spkg-install` script?

A third comment: Anne, you need to put the tarball (no need to unpack it) in `sage/upstream`.


---

Comment by aschilling created at 2014-03-31 16:17:11

> A third comment: Anne, you need to put the tarball (no need to unpack it) in `sage/upstream`.

That is what I did, but then I got an error message (see above).


---

Comment by vbraun created at 2014-03-31 16:30:54

Run `sage -f dot2tex`. You can't specify file names.

John: Feel free to open another ticket for a legacy spkg update.


---

Comment by git created at 2014-03-31 16:36:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aschilling created at 2014-03-31 19:03:50

Replying to [comment:54 vbraun]:
> Run `sage -f dot2tex`. You can't specify file names.

This installs dot2tex-2.8.7.p2.spkg even if it is not in upstream and if dot2tex-20120520.tar.bz2 is the only dot2tex in upstream. At least for me.


---

Comment by jhpalmieri created at 2014-03-31 19:18:36

Replying to [comment:56 aschilling]:
> Replying to [comment:54 vbraun]:
> > Run `sage -f dot2tex`. You can't specify file names.
> 
> This installs dot2tex-2.8.7.p2.spkg even if it is not in upstream and if dot2tex-20120520.tar.bz2 is the only dot2tex in upstream. At least for me.

Are you using Volker's branch? What are the contents of `build/pkgs/dot2tex`?


---

Comment by aschilling created at 2014-03-31 20:33:15

> Are you using Volker's branch? 

Yes

```
anne$ git branch
  develop
  master
  origin
  ...
* u/vbraun/dot2tex
```


This is what I get with only dot2tex-20120520.tar.bz2 in upstream

```
lolita-4:sage anne$ git pull
Updating 0c5b4f8..ad62d43
Fast-forward
 build/pkgs/dot2tex/spkg-install | 3 +++
 1 file changed, 3 insertions(+)
lolita-4:sage anne$ sage -b
scons: `install' is up to date.
Updating Cython code....
Finished compiling Cython code (time = 3.14192295074 seconds)
running install
running build
running build_py
running build_ext
Executing 0 commands (using 1 thread)
Time to execute 0 commands: 0.00505900382996 seconds
Total time spent compiling C/C++ extensions:  0.157021045685 seconds.
running install_lib
running install_egg_info
Removing /Applications/sage/local/lib/python2.7/site-packages/sage-6.2.beta5-py2.7.egg-info
Writing /Applications/sage/local/lib/python2.7/site-packages/sage-6.2.beta5-py2.7.egg-info

real	0m4.803s
user	0m3.570s
sys	0m1.069s
lolita-4:sage anne$ sage -f dot2tex
Attempting to download package dot2tex
>>> Checking online list of optional packages.
[.]
>>> Found dot2tex-2.8.7.p2
>>> Trying to download http://www.sagemath.org/spkg/optional/dot2tex-2.8.7.p2.spkg
[............................................................]
dot2tex-2.8.7.p2
====================================================
Extracting package /Applications/sage/upstream/dot2tex-2.8.7.p2.spkg
-rw-r--r--  1 anne  admin  971669 Mar 31 13:24 /Applications/sage/upstream/dot2tex-2.8.7.p2.spkg
Finished extraction
****************************************************
Host system:
Darwin d161.math.ucdavis.edu 10.8.0 Darwin Kernel Version 10.8.0: Tue Jun  7 16:33:36 PDT 2011; root:xnu-1504.15.3~1/RELEASE_I386 i386
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/Applications/sage/local/libexec/gcc/x86_64-apple-darwin10.8.0/4.7.3/lto-wrapper
Target: x86_64-apple-darwin10.8.0
Configured with: ../src/configure --prefix=/Applications/sage/local --with-local-prefix=/Applications/sage/local --with-gmp=/Applications/sage/local --with-mpfr=/Applications/sage/local --with-mpc=/Applications/sage/local --with-system-zlib --disable-multilib --disable-nls  
Thread model: posix
gcc version 4.7.3 (GCC) 
****************************************************
patching file dot2tex/dotparsing.py
patching file setup.py
patching file dot2tex/dot2tex.py
patching file tests/test_comparedotparsing.py
patching file tests/test_buildexamples.py
/Applications/sage/local/lib/python/distutils/dist.py:267: UserWarning: Unknown distribution option: 'dependency_links'
  warnings.warn(msg)
/Applications/sage/local/lib/python/distutils/dist.py:267: UserWarning: Unknown distribution option: 'entry_points'
  warnings.warn(msg)
/Applications/sage/local/lib/python/distutils/dist.py:267: UserWarning: Unknown distribution option: 'install_requires'
  warnings.warn(msg)
running build
running build_py
creating build
creating build/lib
creating build/lib/dot2tex
copying dot2tex/__init__.py -> build/lib/dot2tex
copying dot2tex/dot2tex.py -> build/lib/dot2tex
copying dot2tex/dotparsing.py -> build/lib/dot2tex
running build_scripts
creating build/scripts-2.7
copying and adjusting dot2tex/dot2tex -> build/scripts-2.7
changing mode of build/scripts-2.7/dot2tex from 644 to 755
/Applications/sage/local/lib/python/distutils/dist.py:267: UserWarning: Unknown distribution option: 'dependency_links'
  warnings.warn(msg)
/Applications/sage/local/lib/python/distutils/dist.py:267: UserWarning: Unknown distribution option: 'entry_points'
  warnings.warn(msg)
/Applications/sage/local/lib/python/distutils/dist.py:267: UserWarning: Unknown distribution option: 'install_requires'
  warnings.warn(msg)
running install
running build
running build_py
running build_scripts
running install_lib
copying build/lib/dot2tex/dot2tex.py -> /Applications/sage/local/lib/python2.7/site-packages/dot2tex
copying build/lib/dot2tex/dotparsing.py -> /Applications/sage/local/lib/python2.7/site-packages/dot2tex
byte-compiling /Applications/sage/local/lib/python2.7/site-packages/dot2tex/dot2tex.py to dot2tex.pyc
byte-compiling /Applications/sage/local/lib/python2.7/site-packages/dot2tex/dotparsing.py to dotparsing.pyc
running install_scripts
copying build/scripts-2.7/dot2tex -> /Applications/sage/local/bin
changing mode of /Applications/sage/local/bin/dot2tex to 755
running install_egg_info
Removing /Applications/sage/local/lib/python2.7/site-packages/dot2tex-2.8.7-py2.7.egg-info
Writing /Applications/sage/local/lib/python2.7/site-packages/dot2tex-2.8.7-py2.7.egg-info

real	0m0.725s
user	0m0.315s
sys	0m0.209s
Successfully installed dot2tex-2.8.7.p2
Deleting temporary build directory
/Applications/sage/local/var/tmp/sage/build/dot2tex-2.8.7.p2
Finished installing dot2tex-2.8.7.p2.spkg
```


Afterwards, dot2tex-2.8.7.p2.spkg is again in upstream (even though I deleted it there first).

> What are the contents of `build/pkgs/dot2tex`?


```
lolita-4:sage anne$ cd build/pkgs/dot2tex
lolita-4:dot2tex anne$ ls
spkg-install
```

and

```
lolita-4:dot2tex anne$ more spkg-install 
#!/usr/bin/env bash

if [ -z "$SAGE_LOCAL" ]; then
    echo >&2 "Error: SAGE_LOCAL undefined - exiting..."
    echo >&2 "Maybe run 'sage -sh'?"
    exit 1
fi

# Delete any old version or setup.py refuses to overwrite it
rm -rf "$SAGE_LOCAL/lib/python/site-packages/dot2tex"

ls -al
cd src

for patch in ../patches/*.patch; do
    [ -f "$patch" ] || continue
    patch -p1 <"$patch"
    if [ $? -ne 0 ]; then
        echo >&2 "Error applying '$patch'"
        exit 1
    fi
done

python setup.py build
if [ $? -ne 0 ]; then
    echo >&2 "Error building dot2tex."
    exit 1
fi

python setup.py install
if [ $? -ne 0 ]; then
    echo >&2 "Error installing dot2tex."
    exit 1
fi
```



---

Comment by jhpalmieri created at 2014-03-31 20:59:15

Here's what you should see:

```
$ ls build/pkgs/dot2tex
SPKG.txt             package-version.txt  spkg-check
checksums.ini        patches              spkg-install
```

In particular, `package-version.txt` should contain `20120520`, so it knows which file to use. (It's funny because your `spkg-install` looks current. What happened to the rest of the files?)

Maybe try getting the branch again? I would do

```
$ git fetch trac u/vbraun/dot2tex
$ git checkout -b dot2tex-new FETCH_HEAD
```

to create and switch to a new branch `dot2tex-new`. If you do that, does `build/pkgs/dot2tex` have the right contents?


---

Comment by aschilling created at 2014-03-31 20:59:59

Ok, Travis and I figured out the problem. There was a spurious folder dot2tex-20... in build/pkgs/ which I removed and now everything seems to work!


---

Comment by tscrim created at 2014-04-01 19:58:12

The new skpg works (with matplotlib-1.2.something), but it doesn't fix my original problem of numerical instability. So I've merged in my old branch.


---

Comment by git created at 2014-04-01 19:59:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2014-04-01 20:12:26

Did you try the patch from https://code.google.com/p/dot2tex/issues/detail?id=29, that would be a much better fix imho.


---

Comment by vbraun created at 2014-04-01 20:13:26

PS: I can't reproduce it with graphviz-2.34.0, which I think is responsible for the scientific notation output.


---

Comment by aschilling created at 2014-04-01 20:29:37

For me it also worked without Travis' fix (just using the new spkg from Volker).


---

Comment by git created at 2014-04-01 20:58:30

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2014-04-01 21:01:42

It probably only happens with certain computers. Anyways, I've added the patch from the link (with some rebasing) and reverted my other change (albeit not in the best git way). Now I can view all the pretty crystals. So if my changes are good, then I believe this is a positive review.


---

Comment by aschilling created at 2014-04-02 20:18:32

I am happy to set a positive review on Volker's branch, but as John ad Leif mention it might be good to have it work also with older versions of sage. I did not seem to require Travis' changes to make all pictures work.


---

Comment by jhpalmieri created at 2014-04-02 20:20:28

I don't actually use dot2tex, so I have nothing invested in this. I am happy to leave it as is and put off compatibility with older versions to another ticket (or indefinitely, hoping that it will sort itself out).


---

Comment by tscrim created at 2014-04-02 20:26:08

[comment:61 Like I mentioned before], it did work with my matplotlib 1.2.x, so it might still work with older versions too. However, I'm okay with putting backwards compatibility off to another ticket (if anyone actually runs into a problem).


---

Comment by aschilling created at 2014-04-03 06:37:03

Changing keywords from "" to "dot2tex".


---

Comment by aschilling created at 2014-04-03 06:37:03

Changing status from needs_review to positive_review.


---

Comment by aschilling created at 2014-04-03 06:40:38

Travis and I reviewed the patch and everything seems to work well.


---

Comment by vbraun created at 2014-04-04 15:55:43

Resolution: fixed


---

Comment by slabbe created at 2014-05-02 08:21:26

Replying to [comment:15 vbraun]:
> First of all, whats up with the that catch-all "dot2tex not available" error message. If you can't be helpful then don't catch errors, just let the exception propagate so we can see what is wrong.

I created a ticket for this at #16242. It needs review.

Sébastien


---

Comment by jhpalmieri created at 2015-01-08 16:08:32

The tarball is not available at http://www.sagemath.org/packages/optional/. Or am I missing something?
