# Issue 28501: Docker SageMath install fails

Issue created by migration from https://trac.sagemath.org/ticket/28738

Original creator: saraedum

Original creation time: 2019-11-14 18:41:27

CC:  embray slelievre

See https://gitlab.com/sagemath/sage/-/jobs/346689490#L2328

```
2328 Step 61/66 : RUN sudo $SAGE_ROOT/sage --nodotsage -c "install_scripts('/usr/bin')"
2329  ---> Running in 1751eed7188f
2330 /home/sage/sage/build/bin/sage-system-python: line 24: exec: : not found
```



---

Comment by saraedum created at 2019-11-14 18:42:09

I have not checked what's causing this but Python 2 builds fail with this error.


---

Comment by embray created at 2019-11-15 11:53:50

It would appear that `sage-system-python` is, well, not finding the system python.  Far less clear is why that command would seem to be invoking `sage-system-python` in the first place...


---

Comment by embray created at 2019-11-15 16:18:50

FWIW I was able to reproduce the problem locally, no problem.  But I haven't looked into what's causing it yet.


---

Comment by embray created at 2019-11-15 16:32:22

I see now.  Just recently (which is why I didn't see this at first; I hadn't pulled this update locally) in #28657 the `sage-location` script was changed to use `sage-system-python`, and `sage-location` is called by the main `sage` script.

I'm not sure yet exactly why this change was made but it should be perfectly possible to work around.


---

Comment by saraedum created at 2019-11-17 21:41:06

Changing keywords from "" to "docker, ci".


---

Comment by saraedum created at 2019-11-17 22:03:27

I'm now installing Python as a runtime dependency. Not sure that's the best way to fix this; I asked on #28657.
----
New commits:


---

Comment by jhpalmieri created at 2019-11-18 01:08:34

Replying to [comment:4 embray]:
> I see now.  Just recently (which is why I didn't see this at first; I hadn't pulled this update locally) in #28657 the `sage-location` script was changed to use `sage-system-python`, and `sage-location` is called by the main `sage` script.
> 
> I'm not sure yet exactly why this change was made but it should be perfectly possible to work around.

The change is explained in #28657: on some systems, for example the latest releases of Ubuntu, there is no `python` executable, just `python3`. On top of that, in a Python 3 build of Sage, we don't create a `python` executable. So we shouldn't expect `#!/usr/bin/env python` to work.

It sounds like `sage-system-python` is not robust enough, if it's not handling this situation.


---

Comment by jhpalmieri created at 2019-11-18 01:10:27

Or `sage-location` should be able to use Sage's Python, if that's the only one available. Are there really systems with neither `python` nor `python3` on which Sage is expected to run?


---

Comment by saraedum created at 2019-11-18 11:05:59

Replying to [comment:9 jhpalmieri]:
> Or `sage-location` should be able to use Sage's Python, if that's the only one available. Are there really systems with neither `python` nor `python3` on which Sage is expected to run?

The [SageMath](SageMath) download page at least does not say that you need Python.

Is Python pre-installed on Windows these days?

It comes pre-installed on macOS, but that's bound to change I think:

> Scripting language runtimes such as Python, Ruby, and Perl are included in macOS for compatibility with legacy software. In future versions of macOS, scripting language runtimes won’t be available by default, and may require you to install an additional package. If your software depends on scripting languages, it’s recommended that you bundle the runtime within the app. (49764202)


---

Comment by embray created at 2020-01-06 14:10:03

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-03-17 23:18:41

See also #29090 - "configure forgets to check whether ANY Python is available on the system"


---

Comment by mkoeppe created at 2020-03-18 01:44:34

Fixed by #29090.


---

Comment by mkoeppe created at 2020-05-07 02:57:56

Changing status from new to needs_review.


---

Comment by chapoton created at 2020-09-15 16:00:52

Resolution: duplicate
