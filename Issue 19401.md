# Issue 19401: upgrade rpy2 to 2.7.4

archive/issues_019401.json:
```json
{
    "body": "CC:  @kiwifb\n\nKeywords: r-project jupyter\n\nThe current version (2.3.8) of `rpy2` packaged in Sage is too old to work with the current version of the Jupyter notebook\n\nManually upgrading to 7.7.8 (via `sage -pip install --upgrade rpy2` seems to work. However in also upgrades `six` (to `1.10.0-py2.py3-non-any.whl` (???) and `singledispatch` (but seems to use the current (cached) version).\n\nI also get the following warning :\n\n`    DEPRECATION: Uninstalling a distutils installed project (rpy2) has been deprecated and will be removed in a future version. This is due to the fact that uninstalling a distutils project will only partially uninstall the project.`\n\nwhich I do not really understand....\n\nIssue created by migration from https://trac.sagemath.org/ticket/19638\n\n",
    "created_at": "2015-11-29T08:30:59Z",
    "labels": [
        "packages: standard",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "upgrade rpy2 to 2.7.4",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19401",
    "user": "@EmmanuelCharpentier"
}
```
CC:  @kiwifb

Keywords: r-project jupyter

The current version (2.3.8) of `rpy2` packaged in Sage is too old to work with the current version of the Jupyter notebook

Manually upgrading to 7.7.8 (via `sage -pip install --upgrade rpy2` seems to work. However in also upgrades `six` (to `1.10.0-py2.py3-non-any.whl` (???) and `singledispatch` (but seems to use the current (cached) version).

I also get the following warning :

`    DEPRECATION: Uninstalling a distutils installed project (rpy2) has been deprecated and will be removed in a future version. This is due to the fact that uninstalling a distutils project will only partially uninstall the project.`

which I do not really understand....

Issue created by migration from https://trac.sagemath.org/ticket/19638





---

archive/issue_comments_266712.json:
```json
{
    "body": "Extract from [this question](https://groups.google.com/forum/#!topic/sage-devel/p2l0EUkSsOo) on sage-devel :\n\nMy pip upgrade showed me that this upgrade entails :\n\n* an upgrade to `six`, which is already packaged in Sagemath (no problem)\n* installing the `singledispatch` package, which is **NOT** packaged.\n\nISTR that, on sage-devel, it has been decided that a new package should remain optional for at least a year before becoming a standard package. If we follow this policy, the standard package rpy2 would depend on the optional package singledispatch. This seems a bit incoherent...\n\nAnother solution would be to keep the standard rpy2 package at 2.3.8, and have a rpy2-newer optional, depending on `singledispatch`. This seems a bit contrived, to say the least. Furthermore, I do not know how to proceed...\n\nA third solution would be to silently include singledispatch in the source to rpy2. This \"solution\" seems to *guarantee* future incompatibilities.\n\nWhat should I do ?\n\nBonus question : how to package rpy2 to signal that it depends on singledispatch ?",
    "created_at": "2015-11-30T23:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266712",
    "user": "@EmmanuelCharpentier"
}
```

Extract from [this question](https://groups.google.com/forum/#!topic/sage-devel/p2l0EUkSsOo) on sage-devel :

My pip upgrade showed me that this upgrade entails :

* an upgrade to `six`, which is already packaged in Sagemath (no problem)
* installing the `singledispatch` package, which is **NOT** packaged.

ISTR that, on sage-devel, it has been decided that a new package should remain optional for at least a year before becoming a standard package. If we follow this policy, the standard package rpy2 would depend on the optional package singledispatch. This seems a bit incoherent...

Another solution would be to keep the standard rpy2 package at 2.3.8, and have a rpy2-newer optional, depending on `singledispatch`. This seems a bit contrived, to say the least. Furthermore, I do not know how to proceed...

A third solution would be to silently include singledispatch in the source to rpy2. This "solution" seems to *guarantee* future incompatibilities.

What should I do ?

Bonus question : how to package rpy2 to signal that it depends on singledispatch ?



---

archive/issue_comments_266713.json:
```json
{
    "body": "This version does the job (`%R` and `%%R` run OK in the Jupyter notebook).\n\nNot yet ready for review, because :\n* No documentation (yet) of this new interface\n* not yet `ptestlong`'ed (and won't be until late tonight)...\n\nAny suggestion on how to document the Jupyter interface ?",
    "created_at": "2015-12-01T12:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266713",
    "user": "@EmmanuelCharpentier"
}
```

This version does the job (`%R` and `%%R` run OK in the Jupyter notebook).

Not yet ready for review, because :
* No documentation (yet) of this new interface
* not yet `ptestlong`'ed (and won't be until late tonight)...

Any suggestion on how to document the Jupyter interface ?



---

archive/issue_comments_266714.json:
```json
{
    "body": "Attachment [singledispatch-3.4.0.3.tar.gz](tarball://root/attachments/some-uuid/ticket19638/singledispatch-3.4.0.3.tar.gz) by @EmmanuelCharpentier created at 2015-12-01 17:32:00\n\nTarball for the new sigledispatch package",
    "created_at": "2015-12-01T17:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266714",
    "user": "@EmmanuelCharpentier"
}
```

Attachment [singledispatch-3.4.0.3.tar.gz](tarball://root/attachments/some-uuid/ticket19638/singledispatch-3.4.0.3.tar.gz) by @EmmanuelCharpentier created at 2015-12-01 17:32:00

Tarball for the new sigledispatch package



---

archive/issue_comments_266715.json:
```json
{
    "body": "Attachment [six-1.10.0.tar.gz](tarball://root/attachments/some-uuid/ticket19638/six-1.10.0.tar.gz) by @EmmanuelCharpentier created at 2015-12-01 17:32:21\n\nNew tarball for six",
    "created_at": "2015-12-01T17:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266715",
    "user": "@EmmanuelCharpentier"
}
```

Attachment [six-1.10.0.tar.gz](tarball://root/attachments/some-uuid/ticket19638/six-1.10.0.tar.gz) by @EmmanuelCharpentier created at 2015-12-01 17:32:21

New tarball for six



---

archive/issue_comments_266716.json:
```json
{
    "body": "New tarball for rpy2",
    "created_at": "2015-12-01T17:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266716",
    "user": "@EmmanuelCharpentier"
}
```

New tarball for rpy2



---

archive/issue_comments_266717.json:
```json
{
    "body": "Attachment [rpy2-2.7.4.tar.gz](tarball://root/attachments/some-uuid/ticket19638/rpy2-2.7.4.tar.gz) by @EmmanuelCharpentier created at 2015-12-01 17:34:05\n\nOur damn \"corporate\" firewall mangled the upload of new tarballs...",
    "created_at": "2015-12-01T17:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266717",
    "user": "@EmmanuelCharpentier"
}
```

Attachment [rpy2-2.7.4.tar.gz](tarball://root/attachments/some-uuid/ticket19638/rpy2-2.7.4.tar.gz) by @EmmanuelCharpentier created at 2015-12-01 17:34:05

Our damn "corporate" firewall mangled the upload of new tarballs...



---

archive/issue_comments_266718.json:
```json
{
    "body": "Passes `ptestlong` with no error.\n\nI still haven't the foggiest idea about **where** to document the Jupyter interface. We need to mention four things at the very minimum :\n* Load it with `%load_ext rpy2.ipython`.\n* Line magic : `%R` (may take args to pass data from/to Sage).\n* Cell magic : {{{%%R}} (idem).\n* Help is available online.\n\nBy the way, the Jupyter notebook doesn't seem documented in the Sage documentation.",
    "created_at": "2015-12-01T18:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266718",
    "user": "@EmmanuelCharpentier"
}
```

Passes `ptestlong` with no error.

I still haven't the foggiest idea about **where** to document the Jupyter interface. We need to mention four things at the very minimum :
* Load it with `%load_ext rpy2.ipython`.
* Line magic : `%R` (may take args to pass data from/to Sage).
* Cell magic : {{{%%R}} (idem).
* Help is available online.

By the way, the Jupyter notebook doesn't seem documented in the Sage documentation.



---

archive/issue_comments_266719.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-12-01T18:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266719",
    "user": "@EmmanuelCharpentier"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_266720.json:
```json
{
    "body": "We don't put tarball in attachment anymore, we rarely put any attachment anymore actually. We usually put a pointer to where to download the source in the description, see for example #10295.",
    "created_at": "2015-12-01T21:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266720",
    "user": "@kiwifb"
}
```

We don't put tarball in attachment anymore, we rarely put any attachment anymore actually. We usually put a pointer to where to download the source in the description, see for example #10295.



---

archive/issue_comments_266721.json:
```json
{
    "body": "Links to the original tarballs added in the description.\n\nI'm still waiting for comments on the right place to add documentation.",
    "created_at": "2015-12-02T06:08:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266721",
    "user": "@EmmanuelCharpentier"
}
```

Links to the original tarballs added in the description.

I'm still waiting for comments on the right place to add documentation.



---

archive/issue_comments_266722.json:
```json
{
    "body": "I honestly don't know where to document it in this case. You may have to try to stir things up on sage-devel.\n\nThe warning you get from `pip` is nothing to worry about. If I am not mistaken it is just complaining that you are uninstalling/upgrading something that wasn't installed with `pip` and that support for this will be discontinued (and rightly so, there is no sane way for `pip` to know it is doing a good job with the removal. `pip` as a package manager actually tracks the file installed, not so for stuff that has been installed with plain `distutils`).",
    "created_at": "2015-12-03T02:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266722",
    "user": "@kiwifb"
}
```

I honestly don't know where to document it in this case. You may have to try to stir things up on sage-devel.

The warning you get from `pip` is nothing to worry about. If I am not mistaken it is just complaining that you are uninstalling/upgrading something that wasn't installed with `pip` and that support for this will be discontinued (and rightly so, there is no sane way for `pip` to know it is doing a good job with the removal. `pip` as a package manager actually tracks the file installed, not so for stuff that has been installed with plain `distutils`).



---

archive/issue_comments_266723.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-12T21:04:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266723",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_266724.json:
```json
{
    "body": "Passes ptestlong when added to a pristine 6.10rc0 git clone.\n\nEmbryonic documentation added as an addendum to the r interface documentation.\n\nIt appears that, while useful in its present state, this work should be extended to a (re-)implementation of the R interface (our present implementation uses expect).\n\nI shall question sage-devel and open another ticket for this.\n\nStill requiring review.",
    "created_at": "2015-12-12T21:17:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266724",
    "user": "@EmmanuelCharpentier"
}
```

Passes ptestlong when added to a pristine 6.10rc0 git clone.

Embryonic documentation added as an addendum to the r interface documentation.

It appears that, while useful in its present state, this work should be extended to a (re-)implementation of the R interface (our present implementation uses expect).

I shall question sage-devel and open another ticket for this.

Still requiring review.



---

archive/issue_comments_266725.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-13T20:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266725",
    "user": "@kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_266726.json:
```json
{
    "body": "Good enough for me. I have been using `rpy-2.7.x` since October in sage-on-gentoo without a hitch and 2.7.4 in particular since the end of November.",
    "created_at": "2015-12-13T20:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266726",
    "user": "@kiwifb"
}
```

Good enough for me. I have been using `rpy-2.7.x` since October in sage-on-gentoo without a hitch and 2.7.4 in particular since the end of November.



---

archive/issue_comments_266727.json:
```json
{
    "body": "`2.7.5` is out since we are now aiming for `sage-6.11` I am ok to re-review it after a revision bump.",
    "created_at": "2015-12-13T22:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266727",
    "user": "@kiwifb"
}
```

`2.7.5` is out since we are now aiming for `sage-6.11` I am ok to re-review it after a revision bump.



---

archive/issue_comments_266728.json:
```json
{
    "body": "New tarball for rpy2-2.7.5",
    "created_at": "2015-12-15T03:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266728",
    "user": "@EmmanuelCharpentier"
}
```

New tarball for rpy2-2.7.5



---

archive/issue_comments_266729.json:
```json
{
    "body": "Attachment [rpy2-2.7.5.tar.gz](tarball://root/attachments/some-uuid/ticket19638/rpy2-2.7.5.tar.gz) by git created at 2015-12-15 03:41:39\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2015-12-15T03:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266729",
    "user": "git"
}
```

Attachment [rpy2-2.7.5.tar.gz](tarball://root/attachments/some-uuid/ticket19638/rpy2-2.7.5.tar.gz) by git created at 2015-12-15 03:41:39

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_266730.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2015-12-15T03:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266730",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_266731.json:
```json
{
    "body": "Passes ptestlong.",
    "created_at": "2015-12-15T03:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266731",
    "user": "@EmmanuelCharpentier"
}
```

Passes ptestlong.



---

archive/issue_comments_266732.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-16T20:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266732",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_266733.json:
```json
{
    "body": "I have verified this.",
    "created_at": "2015-12-16T20:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266733",
    "user": "@tscrim"
}
```

I have verified this.



---

archive/issue_comments_266734.json:
```json
{
    "body": "Replying to [comment:16 tscrim]:\n> I have verified this.\n\nThanks. You should add your (real) name to the \"Reviewers\" field...",
    "created_at": "2015-12-16T21:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266734",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:16 tscrim]:
> I have verified this.

Thanks. You should add your (real) name to the "Reviewers" field...



---

archive/issue_comments_266735.json:
```json
{
    "body": "Please don't attach tarballs to trac tickets, they just end up in our trac database forever",
    "created_at": "2015-12-19T09:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266735",
    "user": "@vbraun"
}
```

Please don't attach tarballs to trac tickets, they just end up in our trac database forever



---

archive/issue_comments_266736.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-12-22T19:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19401#issuecomment-266736",
    "user": "@vbraun"
}
```

Resolution: fixed
