# Issue 19401: upgrade rpy2 to 2.7.4

Issue created by migration from Trac.

Original creator: charpent

Original creation time: 2015-11-29 08:30:59

CC:  fbissey

Keywords: r-project jupyter

The current version (2.3.8) of `rpy2` packaged in Sage is too old to work with the current version of the Jupyter notebook

Manually upgrading to 7.7.8 (via `sage -pip install --upgrade rpy2` seems to work. However in also upgrades `six` (to `1.10.0-py2.py3-non-any.whl` (???) and `singledispatch` (but seems to use the current (cached) version).

I also get the following warning :

`    DEPRECATION: Uninstalling a distutils installed project (rpy2) has been deprecated and will be removed in a future version. This is due to the fact that uninstalling a distutils project will only partially uninstall the project.`

which I do not really understand....


---

Comment by charpent created at 2015-11-30 23:09:16

Extract from [this question](https://groups.google.com/forum/#!topic/sage-devel/p2l0EUkSsOo) on sage-devel :

My pip upgrade showed me that this upgrade entails :

* an upgrade to `six`, which is already packaged in Sagemath (no problem)
* installing the `singledispatch` package, which is *NOT* packaged.

ISTR that, on sage-devel, it has been decided that a new package should remain optional for at least a year before becoming a standard package. If we follow this policy, the standard package rpy2 would depend on the optional package singledispatch. This seems a bit incoherent...

Another solution would be to keep the standard rpy2 package at 2.3.8, and have a rpy2-newer optional, depending on `singledispatch`. This seems a bit contrived, to say the least. Furthermore, I do not know how to proceed...

A third solution would be to silently include singledispatch in the source to rpy2. This "solution" seems to _guarantee_ future incompatibilities.

What should I do ?

Bonus question : how to package rpy2 to signal that it depends on singledispatch ?


---

Comment by charpent created at 2015-12-01 12:05:48

This version does the job (`%R` and `%%R` run OK in the Jupyter notebook).

Not yet ready for review, because :
* No documentation (yet) of this new interface
* not yet `ptestlong`'ed (and won't be until late tonight)...

Any suggestion on how to document the Jupyter interface ?


---

Attachment

Tarball for the new sigledispatch package


---

Attachment

New tarball for six


---

Comment by charpent created at 2015-12-01 17:32:58

New tarball for rpy2


---

Attachment

Our damn "corporate" firewall mangled the upload of new tarballs...


---

Comment by charpent created at 2015-12-01 18:17:24

Passes `ptestlong` with no error.

I still haven't the foggiest idea about *where* to document the Jupyter interface. We need to mention four things at the very minimum :
* Load it with `%load_ext rpy2.ipython`.
* Line magic : `%R` (may take args to pass data from/to Sage).
* Cell magic : {{{%%R}} (idem).
* Help is available online.

By the way, the Jupyter notebook doesn't seem documented in the Sage documentation.


---

Comment by charpent created at 2015-12-01 18:17:24

Changing status from new to needs_review.


---

Comment by fbissey created at 2015-12-01 21:58:50

We don't put tarball in attachment anymore, we rarely put any attachment anymore actually. We usually put a pointer to where to download the source in the description, see for example #10295.


---

Comment by charpent created at 2015-12-02 06:08:40

Links to the original tarballs added in the description.

I'm still waiting for comments on the right place to add documentation.


---

Comment by fbissey created at 2015-12-03 02:09:44

I honestly don't know where to document it in this case. You may have to try to stir things up on sage-devel.

The warning you get from `pip` is nothing to worry about. If I am not mistaken it is just complaining that you are uninstalling/upgrading something that wasn't installed with `pip` and that support for this will be discontinued (and rightly so, there is no sane way for `pip` to know it is doing a good job with the removal. `pip` as a package manager actually tracks the file installed, not so for stuff that has been installed with plain `distutils`).


---

Comment by git created at 2015-12-12 21:04:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by charpent created at 2015-12-12 21:17:32

Passes ptestlong when added to a pristine 6.10rc0 git clone.

Embryonic documentation added as an addendum to the r interface documentation.

It appears that, while useful in its present state, this work should be extended to a (re-)implementation of the R interface (our present implementation uses expect).

I shall question sage-devel and open another ticket for this.

Still requiring review.


---

Comment by fbissey created at 2015-12-13 20:27:20

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2015-12-13 20:27:20

Good enough for me. I have been using `rpy-2.7.x` since October in sage-on-gentoo without a hitch and 2.7.4 in particular since the end of November.


---

Comment by fbissey created at 2015-12-13 22:23:06

`2.7.5` is out since we are now aiming for `sage-6.11` I am ok to re-review it after a revision bump.


---

Comment by charpent created at 2015-12-15 03:39:58

New tarball for rpy2-2.7.5


---

Attachment

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2015-12-15 03:41:39

Changing status from positive_review to needs_review.


---

Comment by charpent created at 2015-12-15 03:46:31

Passes ptestlong.


---

Comment by tscrim created at 2015-12-16 20:55:25

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2015-12-16 20:55:25

I have verified this.


---

Comment by charpent created at 2015-12-16 21:02:55

Replying to [comment:16 tscrim]:
> I have verified this.

Thanks. You should add your (real) name to the "Reviewers" field...


---

Comment by vbraun created at 2015-12-19 09:45:01

Please don't attach tarballs to trac tickets, they just end up in our trac database forever


---

Comment by vbraun created at 2015-12-22 19:50:01

Resolution: fixed
