# Issue 32819: conda-forge-standard: Runtime error in sage.libs.giac

Issue created by migration from https://trac.sagemath.org/ticket/33056

Original creator: mkoeppe

Original creation time: 2021-12-21 05:06:12

CC:  isuruf fbissey dimpase vdelecroix

... while docbuilding


```
[sagemath_doc_html-none] Traceback (most recent call last):
[sagemath_doc_html-none]   File "sage/libs/giac/giac.pyx", line 1121, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143102)
[sagemath_doc_html-none]     result=GIAC_protecteval(self.gptr[0],giacsettings.eval_level,context_ptr)
[sagemath_doc_html-none]   File "sage/libs/giac/giac.pyx", line 739, in sage.libs.giac.giac.GiacSetting.eval_level.__get__ (build/cythonized/sage/libs/giac/giac.cpp:10554)
[sagemath_doc_html-none]     return (self.cas_setup()[7][3])._val
[sagemath_doc_html-none]   File "sage/libs/giac/giac.pyx", line 1036, in sage.libs.giac.giac.Pygen.__getitem__ (build/cythonized/sage/libs/giac/giac.cpp:142533)
[sagemath_doc_html-none]     ans=Pygen(cmd).eval()
[sagemath_doc_html-none]   File "sage/libs/giac/giac.pyx", line 1125, in sage.libs.giac.giac.Pygen.eval (build/cythonized/sage/libs/giac/giac.cpp:143178)
[sagemath_doc_html-none]     raise RuntimeError
[sagemath_doc_html-none] RuntimeError
[sagemath_doc_html-none] 
[sagemath_doc_html-none] During handling of the above exception, another exception occurred:
[sagemath_doc_html-none] 
```



(Previously reported in #32087#comment:33)


---

Comment by fbissey created at 2021-12-21 06:38:27

Does `giac` even start and work on that machine - without going through sage.


---

Comment by mkoeppe created at 2021-12-21 06:42:09

No, it looks it's broken

```
(base) root@a22492f2faa5:/sage# which giac
/opt/conda/bin/giac
(base) root@a22492f2faa5:/sage# giac
// Maximum number of parallel threads 10
Warning adding 1 ) at end of input
Segmentation fault
```


(This is an image built with `tox -e docker-conda-forge-standard`)


---

Comment by fbissey created at 2021-12-21 06:49:01

OK, that's one suspicion correct from the doctest failure. It is still quite strange, it starts and then breaks down rather than just going straight to segfault. Multiple versions of some libraries trying to load?


---

Comment by chapoton created at 2022-01-29 08:58:50

bump to 9.6


---

Comment by isuruf created at 2022-02-16 20:23:16

Changing status from new to needs_review.


---

Comment by isuruf created at 2022-02-16 20:23:16

Fixed in https://github.com/conda-forge/giac-feedstock/pull/28

Giac was storing aide_cas location in the build machine in a C++
string and that failed with conda's relocation helper which only
works with C strings.

Fixed it by using dladdr to get the full path to lib/libgiac.so.0
and reconstructed the path.


---

Comment by dimpase created at 2022-02-17 16:55:34

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-02-20 14:33:43

Resolution: fixed
