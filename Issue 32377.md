# Issue 32377: Features and optional tags for sage subset distributions

Issue created by migration from https://trac.sagemath.org/ticket/32614

Original creator: mkoeppe

Original creation time: 2021-10-02 22:45:41

CC:  @kliem jhpalmieri

... so that we can start writing "# optional - sagemath-symbolics" and similar.


---

Comment by mkoeppe created at 2021-10-02 23:38:01

Currently optional tags can contain neither `.` nor `-`:

```
sage:         sage: from sage.doctest.parsing import parse_optional_tags
....: 
sage: parse_optional_tags("sage: #optional -- my.p.kg")
{'my'}
sage: parse_optional_tags("sage: #optional -- sagemath-symbolics")
{'sagemath'}
```

----
New commits:


---

Comment by git created at 2021-10-03 00:06:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-03 00:19:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-03 01:00:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-03 01:38:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-10-03 02:48:27

Changing status from new to needs_review.


---

Comment by git created at 2021-10-03 21:59:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2021-10-03 23:29:05

Next round of stupid questions: How is this going to work? Are we doing to have to add many such markers to a lot of doctests? How will we as developers test which ones we need to add?


---

Comment by tscrim created at 2021-10-03 23:30:29

Replying to [comment:11 tscrim]:
Are we doing to have to add many such markers to a lot of doctests?

I guess this part will be alleviated by #30778.


---

Comment by mkoeppe created at 2021-10-04 16:04:37

Replying to [comment:11 tscrim]:
> How will we as developers test which ones we need to add?

By running the test infrastructure of the subset distributions, such as the one added in #32432 (*sagemath-polyhedra*). This can be done locally, but we will also run this automatically on GH Actions


---

Comment by jhpalmieri created at 2021-10-04 22:15:56

Still no hyphens allowed in `# optional - keyword`? In any case, please also change the documentation in `developer/coding_basics.rst` to match the behavior (currently says "Any punctuation (periods, commas, hyphens, semicolons, ...) after the first word ends the list of packages."). I think we should have a clearly defined (and well-thought out, or is that too much to ask?) syntax for the keywords. This section of the documentation should ideally also provide examples in which tags are combined, as in `# optional - abc, long time`. And I guess that is why we chose to parse `# optional - abc, xyz` as `abc` rather than `abc` and `xyz`. It is a little odd that with the proposed changes, `# optional - abc. long time` will be treated very differently than `# optional - abc, long time`.


---

Comment by mkoeppe created at 2021-10-04 22:26:15

Replying to [comment:14 jhpalmieri]:
> Still no hyphens allowed in `# optional - keyword`?

That's right -- this reflects the fact that our tags for optional packages use the spkg names, which use underscore, not dash. 
Dashes appear in Python distribution package names (tools like `setuptools` normalize underscores to dashes).


---

Comment by mkoeppe created at 2021-10-04 22:29:17

Replying to [comment:14 jhpalmieri]:
> It is a little odd that with the proposed changes, `# optional - abc. long time` will be treated very differently than `# optional - abc, long time`.

Using `.` like this has not been observed in the wild, as can be checked with `git grep '#.*optional.*[.]'`


---

Comment by mkoeppe created at 2021-10-04 22:29:34

I'll update the documentation


---

Comment by git created at 2021-10-04 22:38:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-06 19:57:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-07 04:37:05

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2021-10-07 05:32:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-07 07:23:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2021-10-07 23:09:36

John, any other comments? I think I am ready to set a positive review.


---

Comment by jhpalmieri created at 2021-10-08 01:31:01

I am happy with it. Please go ahead with a positive review when you are ready.


---

Comment by tscrim created at 2021-10-08 01:32:59

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-10-08 01:47:12

Thanks for the review!


---

Comment by git created at 2021-10-11 22:04:42

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2021-10-11 22:04:42

Changing status from positive_review to needs_review.


---

Comment by mkoeppe created at 2021-10-11 22:04:57

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-10-13 22:50:10

Resolution: fixed
