# Issue 24003: R 3.4.2 has no graphics capabilities

Issue created by migration from Trac.

Original creator: charpent

Original creation time: 2017-11-19 10:37:41

Keywords: r-project graphics interfaces

in Sage 8.1.rc2 :

```
> capabilities()
       jpeg         png        tiff       tcltk         X11        aqua 
      FALSE       FALSE       FALSE        TRUE       FALSE       FALSE 
   http/ftp     sockets      libxml        fifo      cledit       iconv 
       TRUE        TRUE        TRUE        TRUE        TRUE        TRUE 
        NLS     profmem       cairo         ICU long.double     libcurl 
       TRUE       FALSE       FALSE        TRUE        TRUE        TRUE 
Warning message:
In doTryCatch(return(expr), name, parentenv, handler) :
  impossible de charger l'objet partagÃ© '/usr/local/sage-8/local/lib/R//modules//R_X11.so':
  /usr/lib/x86_64-linux-gnu/libharfbuzz.so.0: undefined symbol: FT_Get_Var_Blend_Coordinates
> q("no")
```


Contrast with the system's R :

```
> capabilities()
       jpeg         png        tiff       tcltk         X11        aqua 
       TRUE        TRUE        TRUE        TRUE        TRUE       FALSE 
   http/ftp     sockets      libxml        fifo      cledit       iconv 
       TRUE        TRUE        TRUE        TRUE        TRUE        TRUE 
        NLS     profmem       cairo         ICU long.double     libcurl 
       TRUE        TRUE        TRUE        TRUE        TRUE        TRUE 
> q("no")
```



---

Comment by jdemeyer created at 2017-11-19 16:27:15

"has no graphics capabilities" is pretty vague. What do you consider to be the bug precisely?


---

Comment by git created at 2017-11-19 17:47:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by charpent created at 2017-11-19 17:54:44

Replying to [comment:1 jdemeyer]:
> "has no graphics capabilities" is pretty vague. What do you consider to be the bug precisely?

Precisely what it means : `capabilities()` show that all the imaging engines of R(`jpeg, png, tiff, tcltk, X11, cairo`) are disabled. In a terminal, `plot(<something>)` does nothing and yelds an error mess`age from X11, which complaints of a missing function in a library called harfbuzz`. Similar results in the Jupyter notebook.

This might been due to recent changes in system's X11 (Debian now uses Wayland by default), which might have triggered an hitherto unknown bug.

It turns out that updating `freetype` to 2.8.1 fixes the problem.

The resulting Sage passes ptestlong without any error whatsoever ; R sirt-of-passing its own test suite as usual.

==>`needs_review`. I'll try to test it on Windows (but that means an overnight run...)


---

Comment by charpent created at 2017-11-19 17:54:44

Changing status from new to needs_review.


---

Comment by novoselt created at 2017-11-19 20:59:31

Shouldn't this be a blocker for 8.1?


---

Comment by charpent created at 2017-11-19 21:18:58

Replying to [comment:5 novoselt]:
> Shouldn't this be a blocker for 8.1?

It should. I considered it. But I doubt somehow that this opinion would be shared by the core developers, given the popularity of R among them...

Anyway, feel free to review my patch ;-).


---

Comment by novoselt created at 2017-11-19 23:06:08

Well, the patch works in terms of upgrading freetype, but on Debian Stretch I don't see the problem before or after. So I can give positive review to a ticket titled "Upgrade freetype".


---

Comment by charpent created at 2017-11-19 23:26:45

Replying to [comment:7 novoselt]:
> Well, the patch works in terms of upgrading freetype, but on Debian Stretch I don't see the problem before or after. So I can give positive review to a ticket titled "Upgrade freetype".

Do you run Xorg or Wayland ? I'm running testing, where X11 defaults to Wayland : that might be the source of the diffeernces in vbehaviour.

Can you plot from a terminal running "sage -R" ? For example, try "curve(sin(x), -pi, pi)".

Using graphics in the R librar interface from Sage is a bit more intricate. More on this later...


---

Comment by novoselt created at 2017-11-19 23:44:13

Replying to [comment:8 charpent]:
> Do you run Xorg or Wayland ? I'm running testing, where X11 defaults to Wayland : that might be the source of the diffeernces in vbehaviour.
I am on stable, so presumably Xorg.
> Can you plot from a terminal running "sage -R" ? For example, try "curve(sin(x), -pi, pi)".
I can as in it does not cause errors and there is a PDF file created with a plot. I am far from being an expert on the topic - my only interest in R graphics is to make sure that it keeps working for SageMathCell.


---

Comment by novoselt created at 2017-11-19 23:44:13

Changing status from needs_review to positive_review.


---

Comment by charpent created at 2017-11-21 08:24:31

Resetting to `needs_review` to grap patchbots' attention. I'll reset the state according to the results.


---

Comment by charpent created at 2017-11-21 08:24:31

Changing status from positive_review to needs_review.


---

Comment by novoselt created at 2017-11-22 01:09:37

How is it supposed to test this ticket that needs a new package placed into `upstream`?


---

Comment by jhpalmieri created at 2017-11-22 01:13:27

Replying to [comment:12 novoselt]:
> How is it supposed to test this ticket that needs a new package placed into `upstream`?

Download the tarball linked in the description and place it into `upstream`. Or is that not what you meant?

Edit: Oh, you mean the patchbots. I have heard that they are supposed to do this somehow, but I don't know if that's true.


---

Comment by novoselt created at 2017-11-22 01:16:32

Yes, I was curious how patchbot is supposed to guess it, although perhaps it reads the description and understands it sufficiently.


---

Comment by charpent created at 2017-11-22 10:49:09

Replying to [comment:13 jhpalmieri]:
> Replying to [comment:12 novoselt]:
> > How is it supposed to test this ticket that needs a new package placed into `upstream`?
> 
> Download the tarball linked in the description and place it into `upstream`. Or is that not what you meant?
> 
> Edit: Oh, you mean the patchbots. I have heard that they are supposed to do this somehow, but I don't know if that's true.

Apparently, one of them [did](https://patchbot.sagemath.org/ticket/24240/) early this morning. But it seems to have just patched the sources (successfully), but didn't try to rebuild Sage.


---

Comment by charpent created at 2017-11-24 08:31:38

Okay. This one has been (positively) checked by 5 patchbots (while none of them did much : this is considered as an SPKG).

I revert to the positive review given by Andrey Novoseltsev .


---

Comment by charpent created at 2017-11-24 08:31:38

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-12-11 01:01:56

Resolution: fixed
