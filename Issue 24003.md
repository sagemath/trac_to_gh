# Issue 24003: R 3.4.2 has no graphics capabilities

archive/issues_024003.json:
```json
{
    "body": "Keywords: r-project graphics interfaces\n\nin Sage 8.1.rc2 :\n\n```\n> capabilities()\n       jpeg         png        tiff       tcltk         X11        aqua \n      FALSE       FALSE       FALSE        TRUE       FALSE       FALSE \n   http/ftp     sockets      libxml        fifo      cledit       iconv \n       TRUE        TRUE        TRUE        TRUE        TRUE        TRUE \n        NLS     profmem       cairo         ICU long.double     libcurl \n       TRUE       FALSE       FALSE        TRUE        TRUE        TRUE \nWarning message:\nIn doTryCatch(return(expr), name, parentenv, handler) :\n  impossible de charger l'objet partag\u00e9 '/usr/local/sage-8/local/lib/R//modules//R_X11.so':\n  /usr/lib/x86_64-linux-gnu/libharfbuzz.so.0: undefined symbol: FT_Get_Var_Blend_Coordinates\n> q(\"no\")\n```\n\n\nContrast with the system's R :\n\n```\n> capabilities()\n       jpeg         png        tiff       tcltk         X11        aqua \n       TRUE        TRUE        TRUE        TRUE        TRUE       FALSE \n   http/ftp     sockets      libxml        fifo      cledit       iconv \n       TRUE        TRUE        TRUE        TRUE        TRUE        TRUE \n        NLS     profmem       cairo         ICU long.double     libcurl \n       TRUE        TRUE        TRUE        TRUE        TRUE        TRUE \n> q(\"no\")\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24240\n\n",
    "created_at": "2017-11-19T10:37:41Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "R 3.4.2 has no graphics capabilities",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24003",
    "user": "https://github.com/EmmanuelCharpentier"
}
```
Keywords: r-project graphics interfaces

in Sage 8.1.rc2 :

```
> capabilities()
       jpeg         png        tiff       tcltk         X11        aqua 
      FALSE       FALSE       FALSE        TRUE       FALSE       FALSE 
   http/ftp     sockets      libxml        fifo      cledit       iconv 
       TRUE        TRUE        TRUE        TRUE        TRUE        TRUE 
        NLS     profmem       cairo         ICU long.double     libcurl 
       TRUE       FALSE       FALSE        TRUE        TRUE        TRUE 
Warning message:
In doTryCatch(return(expr), name, parentenv, handler) :
  impossible de charger l'objet partagÃ© '/usr/local/sage-8/local/lib/R//modules//R_X11.so':
  /usr/lib/x86_64-linux-gnu/libharfbuzz.so.0: undefined symbol: FT_Get_Var_Blend_Coordinates
> q("no")
```


Contrast with the system's R :

```
> capabilities()
       jpeg         png        tiff       tcltk         X11        aqua 
       TRUE        TRUE        TRUE        TRUE        TRUE       FALSE 
   http/ftp     sockets      libxml        fifo      cledit       iconv 
       TRUE        TRUE        TRUE        TRUE        TRUE        TRUE 
        NLS     profmem       cairo         ICU long.double     libcurl 
       TRUE        TRUE        TRUE        TRUE        TRUE        TRUE 
> q("no")
```


Issue created by migration from https://trac.sagemath.org/ticket/24240





---

archive/issue_comments_336034.json:
```json
{
    "body": "\"has no graphics capabilities\" is pretty vague. What do you consider to be the bug precisely?",
    "created_at": "2017-11-19T16:27:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336034",
    "user": "https://github.com/jdemeyer"
}
```

"has no graphics capabilities" is pretty vague. What do you consider to be the bug precisely?



---

archive/issue_comments_336035.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-19T17:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336035",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_336036.json:
```json
{
    "body": "Replying to [comment:1 jdemeyer]:\n> \"has no graphics capabilities\" is pretty vague. What do you consider to be the bug precisely?\n\nPrecisely what it means : `capabilities()` show that all the imaging engines of R(`jpeg, png, tiff, tcltk, X11, cairo`) are disabled. In a terminal, `plot(<something>)` does nothing and yelds an error mess`age from X11, which complaints of a missing function in a library called harfbuzz`. Similar results in the Jupyter notebook.\n\nThis might been due to recent changes in system's X11 (Debian now uses Wayland by default), which might have triggered an hitherto unknown bug.\n\nIt turns out that updating `freetype` to 2.8.1 fixes the problem.\n\nThe resulting Sage passes ptestlong without any error whatsoever ; R sirt-of-passing its own test suite as usual.\n\n==>`needs_review`. I'll try to test it on Windows (but that means an overnight run...)",
    "created_at": "2017-11-19T17:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336036",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Replying to [comment:1 jdemeyer]:
> "has no graphics capabilities" is pretty vague. What do you consider to be the bug precisely?

Precisely what it means : `capabilities()` show that all the imaging engines of R(`jpeg, png, tiff, tcltk, X11, cairo`) are disabled. In a terminal, `plot(<something>)` does nothing and yelds an error mess`age from X11, which complaints of a missing function in a library called harfbuzz`. Similar results in the Jupyter notebook.

This might been due to recent changes in system's X11 (Debian now uses Wayland by default), which might have triggered an hitherto unknown bug.

It turns out that updating `freetype` to 2.8.1 fixes the problem.

The resulting Sage passes ptestlong without any error whatsoever ; R sirt-of-passing its own test suite as usual.

==>`needs_review`. I'll try to test it on Windows (but that means an overnight run...)



---

archive/issue_comments_336037.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-11-19T17:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336037",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_336038.json:
```json
{
    "body": "Shouldn't this be a blocker for 8.1?",
    "created_at": "2017-11-19T20:59:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336038",
    "user": "https://github.com/novoselt"
}
```

Shouldn't this be a blocker for 8.1?



---

archive/issue_comments_336039.json:
```json
{
    "body": "Replying to [comment:5 novoselt]:\n> Shouldn't this be a blocker for 8.1?\n\nIt should. I considered it. But I doubt somehow that this opinion would be shared by the core developers, given the popularity of R among them...\n\nAnyway, feel free to review my patch ;-).",
    "created_at": "2017-11-19T21:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336039",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Replying to [comment:5 novoselt]:
> Shouldn't this be a blocker for 8.1?

It should. I considered it. But I doubt somehow that this opinion would be shared by the core developers, given the popularity of R among them...

Anyway, feel free to review my patch ;-).



---

archive/issue_comments_336040.json:
```json
{
    "body": "Well, the patch works in terms of upgrading freetype, but on Debian Stretch I don't see the problem before or after. So I can give positive review to a ticket titled \"Upgrade freetype\".",
    "created_at": "2017-11-19T23:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336040",
    "user": "https://github.com/novoselt"
}
```

Well, the patch works in terms of upgrading freetype, but on Debian Stretch I don't see the problem before or after. So I can give positive review to a ticket titled "Upgrade freetype".



---

archive/issue_comments_336041.json:
```json
{
    "body": "Replying to [comment:7 novoselt]:\n> Well, the patch works in terms of upgrading freetype, but on Debian Stretch I don't see the problem before or after. So I can give positive review to a ticket titled \"Upgrade freetype\".\n\nDo you run Xorg or Wayland ? I'm running testing, where X11 defaults to Wayland : that might be the source of the diffeernces in vbehaviour.\n\nCan you plot from a terminal running \"sage -R\" ? For example, try \"curve(sin(x), -pi, pi)\".\n\nUsing graphics in the R librar interface from Sage is a bit more intricate. More on this later...",
    "created_at": "2017-11-19T23:26:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336041",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Replying to [comment:7 novoselt]:
> Well, the patch works in terms of upgrading freetype, but on Debian Stretch I don't see the problem before or after. So I can give positive review to a ticket titled "Upgrade freetype".

Do you run Xorg or Wayland ? I'm running testing, where X11 defaults to Wayland : that might be the source of the diffeernces in vbehaviour.

Can you plot from a terminal running "sage -R" ? For example, try "curve(sin(x), -pi, pi)".

Using graphics in the R librar interface from Sage is a bit more intricate. More on this later...



---

archive/issue_comments_336042.json:
```json
{
    "body": "Replying to [comment:8 charpent]:\n> Do you run Xorg or Wayland ? I'm running testing, where X11 defaults to Wayland : that might be the source of the diffeernces in vbehaviour.\nI am on stable, so presumably Xorg.\n> Can you plot from a terminal running \"sage -R\" ? For example, try \"curve(sin(x), -pi, pi)\".\nI can as in it does not cause errors and there is a PDF file created with a plot. I am far from being an expert on the topic - my only interest in R graphics is to make sure that it keeps working for SageMathCell.",
    "created_at": "2017-11-19T23:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336042",
    "user": "https://github.com/novoselt"
}
```

Replying to [comment:8 charpent]:
> Do you run Xorg or Wayland ? I'm running testing, where X11 defaults to Wayland : that might be the source of the diffeernces in vbehaviour.
I am on stable, so presumably Xorg.
> Can you plot from a terminal running "sage -R" ? For example, try "curve(sin(x), -pi, pi)".
I can as in it does not cause errors and there is a PDF file created with a plot. I am far from being an expert on the topic - my only interest in R graphics is to make sure that it keeps working for SageMathCell.



---

archive/issue_comments_336043.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-19T23:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336043",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_336044.json:
```json
{
    "body": "Resetting to `needs_review` to grap patchbots' attention. I'll reset the state according to the results.",
    "created_at": "2017-11-21T08:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336044",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Resetting to `needs_review` to grap patchbots' attention. I'll reset the state according to the results.



---

archive/issue_comments_336045.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-11-21T08:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336045",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_336046.json:
```json
{
    "body": "How is it supposed to test this ticket that needs a new package placed into `upstream`?",
    "created_at": "2017-11-22T01:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336046",
    "user": "https://github.com/novoselt"
}
```

How is it supposed to test this ticket that needs a new package placed into `upstream`?



---

archive/issue_comments_336047.json:
```json
{
    "body": "Replying to [comment:12 novoselt]:\n> How is it supposed to test this ticket that needs a new package placed into `upstream`?\n\nDownload the tarball linked in the description and place it into `upstream`. Or is that not what you meant?\n\nEdit: Oh, you mean the patchbots. I have heard that they are supposed to do this somehow, but I don't know if that's true.",
    "created_at": "2017-11-22T01:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336047",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:12 novoselt]:
> How is it supposed to test this ticket that needs a new package placed into `upstream`?

Download the tarball linked in the description and place it into `upstream`. Or is that not what you meant?

Edit: Oh, you mean the patchbots. I have heard that they are supposed to do this somehow, but I don't know if that's true.



---

archive/issue_comments_336048.json:
```json
{
    "body": "Yes, I was curious how patchbot is supposed to guess it, although perhaps it reads the description and understands it sufficiently.",
    "created_at": "2017-11-22T01:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336048",
    "user": "https://github.com/novoselt"
}
```

Yes, I was curious how patchbot is supposed to guess it, although perhaps it reads the description and understands it sufficiently.



---

archive/issue_comments_336049.json:
```json
{
    "body": "Replying to [comment:13 jhpalmieri]:\n> Replying to [comment:12 novoselt]:\n> > How is it supposed to test this ticket that needs a new package placed into `upstream`?\n> \n> Download the tarball linked in the description and place it into `upstream`. Or is that not what you meant?\n> \n> Edit: Oh, you mean the patchbots. I have heard that they are supposed to do this somehow, but I don't know if that's true.\n\nApparently, one of them [did](https://patchbot.sagemath.org/ticket/24240/) early this morning. But it seems to have just patched the sources (successfully), but didn't try to rebuild Sage.",
    "created_at": "2017-11-22T10:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336049",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Replying to [comment:13 jhpalmieri]:
> Replying to [comment:12 novoselt]:
> > How is it supposed to test this ticket that needs a new package placed into `upstream`?
> 
> Download the tarball linked in the description and place it into `upstream`. Or is that not what you meant?
> 
> Edit: Oh, you mean the patchbots. I have heard that they are supposed to do this somehow, but I don't know if that's true.

Apparently, one of them [did](https://patchbot.sagemath.org/ticket/24240/) early this morning. But it seems to have just patched the sources (successfully), but didn't try to rebuild Sage.



---

archive/issue_comments_336050.json:
```json
{
    "body": "Okay. This one has been (positively) checked by 5 patchbots (while none of them did much : this is considered as an SPKG).\n\nI revert to the positive review given by Andrey Novoseltsev .",
    "created_at": "2017-11-24T08:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336050",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Okay. This one has been (positively) checked by 5 patchbots (while none of them did much : this is considered as an SPKG).

I revert to the positive review given by Andrey Novoseltsev .



---

archive/issue_comments_336051.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-24T08:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336051",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_336052.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-12-11T01:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24003#issuecomment-336052",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_022452.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-11T01:01:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24003",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24003#event-22452"
}
```
