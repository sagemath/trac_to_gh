# Issue 17394: Auto-generate gen.pyx

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2015-01-14 12:45:43

CC:  vdelecroix




---

Comment by git created at 2015-01-20 06:56:26

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2015-01-20 13:42:49

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2015-02-26 10:11:58

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2015-02-26 10:17:17

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2015-02-26 20:33:19

Is it on purpose that `decl.pxi` and `declinl.pxi` not automatically generated as well from 'paridecl.h'? It seems that we even have a `parisage.h` in between! Is the following in `parisage.h` still true

```
#undef coeff  /* Conflicts with NTL */
```


I made some review commits. You can cherry-pick the one you want:

- commit 1 and 4 are trivial

- Don't we want to keep the order of the `pari.desc` file? It would be enough to make `read_pari_desc` an iterator and avoid the `sorted` in `PariFunctionGenerator.__call__`. (see commit 3)

- It is not very nice to hardcode the path of `pari.desc` since some distro might want to build with their own `pari`. The solution is not perfect but at least the pari source is only hardcoded in one place. (see commit 2)


---

Comment by jdemeyer created at 2015-02-26 21:44:18

Where are the review commits?


---

Comment by vdelecroix created at 2015-02-26 22:14:03

here they are


---

Comment by vdelecroix created at 2015-02-26 22:14:30

New commits:


---

Comment by jdemeyer created at 2015-02-27 07:28:06

Replying to [comment:9 vdelecroix]:
> - Don't we want to keep the order of the `pari.desc` file? It would be enough to make `read_pari_desc` an iterator and avoid the `sorted` in `PariFunctionGenerator.__call__`. (see commit 3)
I don't think the order really matters. When developing this code, I did find it nice that I could do `D["bnfinit"]`. So I prefer to not make this change.

I agree (modulo a few details) with the other commits.


---

Comment by jdemeyer created at 2015-02-27 09:17:52

New commits:


---

Comment by jdemeyer created at 2015-02-27 16:38:24

Replying to [comment:9 vdelecroix]:
> Is it on purpose that `decl.pxi` and `declinl.pxi` not automatically generated as well from 'paridecl.h'?
Doing that would be hard. Not impossible, but a highly non-trivial project.

> It seems that we even have a `parisage.h` in between! Is the following in `parisage.h` still true
> {{{
> #undef coeff  /* Conflicts with NTL */
> }}}
Yes, we should leave that.


---

Comment by git created at 2015-03-13 11:30:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2015-03-14 22:07:34

I am a bit worried since the auto generated files do not get any doctest in them...

What is that in `src/sage/libs/pari/pari_instance.pyx`?

```
+            #from sage.misc.superseded import deprecation
+            #deprecation(XXXXX, 'passing -1 as PARI variable is deprecated, use None instead')
```


Why did you keep so much methods in the `gen` class in `gen.pyx` (such as `List`, `Mat`, `sign`, `vecmin`, `vecmax`, etc)?

Where can I found the implementation and/or documentation of `pari_catch_sig_on` and co?


---

Comment by vdelecroix created at 2015-03-14 22:07:41

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2015-03-15 08:51:14

Replying to [comment:19 vdelecroix]:
> I am a bit worried since the auto generated files do not get any doctest in them...
That's true. On the other hand, I did not _remove_ any doctests either, so it's a least status quo. PARI itself has quite an extensive test suite (run if you install PARI with `SAGE_CHECK=yes` or with `./sage -i -c pari`).

> What is that in `src/sage/libs/pari/pari_instance.pyx`?
> {{{
> +            #from sage.misc.superseded import deprecation
> +            #deprecation(XXXXX, 'passing -1 as PARI variable is deprecated, use None instead')
> }}}
It's basically a reminder to myself that this really should be deprecated.

> Why did you keep so much methods in the `gen` class in `gen.pyx` (such as `List`, `Mat`, `sign`, `vecmin`, `vecmax`, etc)?
In any case, I didn't want to remove any doctests. I also didn't check very carefully which methods could be removed.

> Where can I found the implementation and/or documentation of `pari_catch_sig_on` and co?
See `src/sage/libs/pari/pari_err.pxi`. But `pari_catch_sig_on()` and `pari_catch_sig_off` are just `sig_on()` and `sig_off`. This used to be different before we had #14894.

Most of your comments are indeed good comments, but my first priority was to get the general framework (i.e. this ticket) reviewed, we can still improve things later. I prefer to split tickets in smaller pieces, I dislike these huge tickets which do everything.


---

Comment by vdelecroix created at 2015-03-15 09:04:00

Replying to [comment:21 jdemeyer]:
> Replying to [comment:19 vdelecroix]:
> > What is that in `src/sage/libs/pari/pari_instance.pyx`?
> > {{{
> > +            #from sage.misc.superseded import deprecation
> > +            #deprecation(XXXXX, 'passing -1 as PARI variable is deprecated, use None instead')
> > }}}
> It's basically a reminder to myself that this really should be deprecated.

The point is that if this ticket gets merged but not the follow-up (because you might stop doing Sage development or anything) we will end up with these two very strange lines.

Could you at least start with a comment

```
+            # # we should deprecate this because XYZ.
+            #from sage.misc.superseded import deprecation
+            #deprecation(XXXXX, 'passing -1 as PARI variable is deprecated, use None 
```


> > Why did you keep so much methods in the `gen` class in `gen.pyx` (such as `List`, `Mat`, `sign`, `vecmin`, `vecmax`, etc)?
> In any case, I didn't want to remove any doctests. I also didn't check very carefully which methods could be removed.

Right. Doctest are indeed important! What is your long term goal with those methods?

> > Where can I found the implementation and/or documentation of `pari_catch_sig_on` and co?
> See `src/sage/libs/pari/pari_err.pxi`. But `pari_catch_sig_on()` and `pari_catch_sig_off` are just `sig_on()` and `sig_off`. This used to be different before we had #14894.

Just for precision: is `pari_catch_sig_on` just an equivalent to `sig_on`? If so I really do not understand why there is so much `pari_catch_sig_on` without any `pari_catch_sig_off`!

> Most of your comments are indeed good comments, but my first priority was to get the general framework (i.e. this ticket) reviewed, we can still improve things later. I prefer to split tickets in smaller pieces, I dislike these huge tickets which do everything.

But I, as a reviewer, do not have your vision of the larger project. I just see one ticket (actually there is also the part 2 #17860).


---

Comment by jdemeyer created at 2015-03-15 09:48:15

Replying to [comment:22 vdelecroix]:
> > > Why did you keep so much methods in the `gen` class in `gen.pyx` (such as `List`, `Mat`, `sign`, `vecmin`, `vecmax`, etc)?
> > In any case, I didn't want to remove any doctests. I also didn't check very carefully which methods could be removed.
> 
> Right. Doctest are indeed important! What is your long term goal with those methods?
In the end, I think it's probably best to store all extra documentation and doctests in a separate file (I haven't thought about the exact mechanism). Then that extra documentation will be put together with the PARI documentation in the auto-generated file.

> Just for precision: is `pari_catch_sig_on` just an equivalent to `sig_on`?
Yes (although you're recommended to use `pari_catch_sig_on` in PARI code in case we want to change this).

> I really do not understand why there is so much `pari_catch_sig_on` without any `pari_catch_sig_off`!
Because the `new_gen()` method runs `pari_catch_sig_off()`.


---

Comment by jdemeyer created at 2015-03-16 20:22:40

About `vecmin` and `vecmax`: those have a pointer argument (a `&` in the prototype) which is currently not supported.


---

Comment by git created at 2015-03-16 20:23:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-03-16 20:23:53

Changing status from needs_info to needs_review.


---

Comment by vdelecroix created at 2015-03-16 21:24:46

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2015-03-16 21:24:46

Let it go and use it!


---

Comment by jdemeyer created at 2015-03-17 08:43:24

Thanks for the review!


---

Comment by vbraun created at 2015-03-19 03:17:33

Resolution: fixed


---

Comment by was created at 2015-03-21 23:53:59

Wow, I'm a little worried about doctests.  However, this whole approach is a major step forward!  Great work!!


---

Comment by jdemeyer created at 2015-03-22 08:53:12

About the doctests: this ticket is about a very direct interface with upstream PARI. That interface itself is doctested.

The wrapped functions indeed lack doctests, but PARI has quite an extensive test suite (which is run by Sage when installing with `SAGE_CHECK=yes`).
