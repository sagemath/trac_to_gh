# Issue 25234: sage -t --optional=sage,internet src/sage/databases/oeis.py has 34 doctests failed

archive/issues_025234.json:
```json
{
    "body": "This is great:\n\n```\nsage -t src/sage/databases/oeis.py \n```\n\n```\nRunning doctests with ID 2018-05-30-22-32-01-a785b24b.\nGit branch: 25305\nUsing --optional=bliss,ccache,mpir,python2,sage\nDoctesting 1 file.\nsage -t --warn-long 82.7 src/sage/databases/oeis.py\n    [118 tests, 0.99 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 1.0 seconds\n    cpu time: 1.3 seconds\n    cumulative wall time: 1.0 seconds\n```\n\nbut as reported on [sage-release 8.3.beta3](https://groups.google.com/d/msg/sage-release/l635YEuT7Hs/WkHCnmWhAQAJ), many doctests depending on internet are failing \n\n\n```\nsage -t --optional=sage,internet src/sage/databases/oeis.py \n```\n\ngives:\n\n```\nRunning doctests with ID 2018-05-30-22-32-15-89fb8007.\nGit branch: 25305\nUsing --optional=internet,sage\nDoctesting 1 file.\nsage -t --warn-long 82.7 src/sage/databases/oeis.py\n**********************************************************************\nFile \"src/sage/databases/oeis.py\", line 29, in sage.databases.oeis\nFailed example:\n    search = oeis([3, 7, 15, 1], max_results=4) ; search  # optional -- internet\nExpected:\n    0: A001203: Continued fraction expansion of Pi.\n    1: A082495: a(n) = (2^n - 1) mod n.\n    2: A165416: Irregular array read by rows: The n-th row contains those distinct positive integers that each, when written in binary, occurs as a substring in binary n.\n    3: A246674: Run Length Transform of A000225.\nGot:\n    0: A001203: Simple continued fraction expansion of Pi.\n    1: A082495: a(n) = (2^n - 1) mod n.\n    2: A165416: Irregular array read by rows: The n-th row contains those distinct positive integers that each, when written in binary, occurs as a substring in binary n.\n    3: A240698: Partial sums of divisors of n, cf. A027750.\n**********************************************************************\n\n...\n\n**********************************************************************\n17 items had failures:\n   5 of  26 in sage.databases.oeis\n   4 of  21 in sage.databases.oeis.OEIS\n   1 of   5 in sage.databases.oeis.OEIS.find_by_description\n   1 of   3 in sage.databases.oeis.OEIS.find_by_subsequence\n   5 of   8 in sage.databases.oeis.OEISSequence\n   3 of  13 in sage.databases.oeis.OEISSequence.__call__\n   2 of   8 in sage.databases.oeis.OEISSequence.__getitem__\n   1 of   4 in sage.databases.oeis.OEISSequence.__init__\n   1 of   5 in sage.databases.oeis.OEISSequence.author\n   2 of   7 in sage.databases.oeis.OEISSequence.cross_references\n   1 of   5 in sage.databases.oeis.OEISSequence.examples\n   2 of   5 in sage.databases.oeis.OEISSequence.extensions_or_errors\n   1 of  14 in sage.databases.oeis.OEISSequence.first_terms\n   1 of   5 in sage.databases.oeis.OEISSequence.formulas\n   2 of   9 in sage.databases.oeis.OEISSequence.links\n   1 of  22 in sage.databases.oeis.OEISSequence.natural_object\n   1 of   5 in sage.databases.oeis.OEISSequence.show\n    [266 tests, 34 failures, 83.18 s]\n----------------------------------------------------------------------\nsage -t --warn-long 82.7 src/sage/databases/oeis.py  # 34 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 83.3 seconds\n    cpu time: 1.8 seconds\n    cumulative wall time: 83.2 seconds\n```\n\nFull log is available on [framabin](https://framabin.org/?fd3d1939f986751b#rFxmYLviVoApcqKcKTqkbIeRZnxf6h7I9jKQ2zggVU8=).\n\nNote that, as Sloane writes this week on the [arxiv](https://arxiv.org/abs/1805.10343), the oeis is a now a Wiki which means that Sage doctests should depend as few as possible on the many modifications done on the OEIS database...\n\nIssue created by migration from https://trac.sagemath.org/ticket/25471\n\n",
    "created_at": "2018-05-30T20:41:49Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "sage -t --optional=sage,internet src/sage/databases/oeis.py has 34 doctests failed",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25234",
    "user": "https://github.com/seblabbe"
}
```
This is great:

```
sage -t src/sage/databases/oeis.py 
```

```
Running doctests with ID 2018-05-30-22-32-01-a785b24b.
Git branch: 25305
Using --optional=bliss,ccache,mpir,python2,sage
Doctesting 1 file.
sage -t --warn-long 82.7 src/sage/databases/oeis.py
    [118 tests, 0.99 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 1.0 seconds
    cpu time: 1.3 seconds
    cumulative wall time: 1.0 seconds
```

but as reported on [sage-release 8.3.beta3](https://groups.google.com/d/msg/sage-release/l635YEuT7Hs/WkHCnmWhAQAJ), many doctests depending on internet are failing 


```
sage -t --optional=sage,internet src/sage/databases/oeis.py 
```

gives:

```
Running doctests with ID 2018-05-30-22-32-15-89fb8007.
Git branch: 25305
Using --optional=internet,sage
Doctesting 1 file.
sage -t --warn-long 82.7 src/sage/databases/oeis.py
**********************************************************************
File "src/sage/databases/oeis.py", line 29, in sage.databases.oeis
Failed example:
    search = oeis([3, 7, 15, 1], max_results=4) ; search  # optional -- internet
Expected:
    0: A001203: Continued fraction expansion of Pi.
    1: A082495: a(n) = (2^n - 1) mod n.
    2: A165416: Irregular array read by rows: The n-th row contains those distinct positive integers that each, when written in binary, occurs as a substring in binary n.
    3: A246674: Run Length Transform of A000225.
Got:
    0: A001203: Simple continued fraction expansion of Pi.
    1: A082495: a(n) = (2^n - 1) mod n.
    2: A165416: Irregular array read by rows: The n-th row contains those distinct positive integers that each, when written in binary, occurs as a substring in binary n.
    3: A240698: Partial sums of divisors of n, cf. A027750.
**********************************************************************

...

**********************************************************************
17 items had failures:
   5 of  26 in sage.databases.oeis
   4 of  21 in sage.databases.oeis.OEIS
   1 of   5 in sage.databases.oeis.OEIS.find_by_description
   1 of   3 in sage.databases.oeis.OEIS.find_by_subsequence
   5 of   8 in sage.databases.oeis.OEISSequence
   3 of  13 in sage.databases.oeis.OEISSequence.__call__
   2 of   8 in sage.databases.oeis.OEISSequence.__getitem__
   1 of   4 in sage.databases.oeis.OEISSequence.__init__
   1 of   5 in sage.databases.oeis.OEISSequence.author
   2 of   7 in sage.databases.oeis.OEISSequence.cross_references
   1 of   5 in sage.databases.oeis.OEISSequence.examples
   2 of   5 in sage.databases.oeis.OEISSequence.extensions_or_errors
   1 of  14 in sage.databases.oeis.OEISSequence.first_terms
   1 of   5 in sage.databases.oeis.OEISSequence.formulas
   2 of   9 in sage.databases.oeis.OEISSequence.links
   1 of  22 in sage.databases.oeis.OEISSequence.natural_object
   1 of   5 in sage.databases.oeis.OEISSequence.show
    [266 tests, 34 failures, 83.18 s]
----------------------------------------------------------------------
sage -t --warn-long 82.7 src/sage/databases/oeis.py  # 34 doctests failed
----------------------------------------------------------------------
Total time for all tests: 83.3 seconds
    cpu time: 1.8 seconds
    cumulative wall time: 83.2 seconds
```

Full log is available on [framabin](https://framabin.org/?fd3d1939f986751b#rFxmYLviVoApcqKcKTqkbIeRZnxf6h7I9jKQ2zggVU8=).

Note that, as Sloane writes this week on the [arxiv](https://arxiv.org/abs/1805.10343), the oeis is a now a Wiki which means that Sage doctests should depend as few as possible on the many modifications done on the OEIS database...

Issue created by migration from https://trac.sagemath.org/ticket/25471





---

archive/issue_comments_355080.json:
```json
{
    "body": "shorter title",
    "created_at": "2018-05-30T21:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25234#issuecomment-355080",
    "user": "https://github.com/seblabbe"
}
```

shorter title



---

archive/issue_comments_355081.json:
```json
{
    "body": "Hi,\n\ni will be on this (some might be tricky, e.g. related to dead sequences).\n\nYou write:\n\n> Note that, as Sloane writes this week on the \u200barxiv, the oeis is a now a Wiki which means that Sage doctests should depend as few as possible on the many modifications done on the OEIS database... \n\n\nAre you suggesting to parse the wiki ???\n\nNote that the issue of the database changing was discussed in previous tickets. Still, we should show part of the answers for having meaningful examples (not only for testing purpose, but also for the user).",
    "created_at": "2018-06-03T12:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25234#issuecomment-355081",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Hi,

i will be on this (some might be tricky, e.g. related to dead sequences).

You write:

> Note that, as Sloane writes this week on the â€‹arxiv, the oeis is a now a Wiki which means that Sage doctests should depend as few as possible on the many modifications done on the OEIS database... 


Are you suggesting to parse the wiki ???

Note that the issue of the database changing was discussed in previous tickets. Still, we should show part of the answers for having meaningful examples (not only for testing purpose, but also for the user).



---

archive/issue_comments_355082.json:
```json
{
    "body": "By the way, several of us predicted this sort of situation (lots of broken doctests related to OEIS) in #16252.",
    "created_at": "2018-06-03T15:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25234#issuecomment-355082",
    "user": "https://github.com/jhpalmieri"
}
```

By the way, several of us predicted this sort of situation (lots of broken doctests related to OEIS) in #16252.



---

archive/issue_comments_355083.json:
```json
{
    "body": "Changing keywords from \"\" to \"days94\".",
    "created_at": "2018-06-15T10:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25234#issuecomment-355083",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing keywords from "" to "days94".



---

archive/issue_comments_355084.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-01T17:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25234#issuecomment-355084",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355085.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-07-01T22:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25234#issuecomment-355085",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

New commits:



---

archive/issue_comments_355086.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-07-01T22:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25234#issuecomment-355086",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_355087.json:
```json
{
    "body": "ok (but this will need to be done again and again...)",
    "created_at": "2018-07-02T18:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25234#issuecomment-355087",
    "user": "https://github.com/fchapoton"
}
```

ok (but this will need to be done again and again...)



---

archive/issue_comments_355088.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-07-02T18:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25234#issuecomment-355088",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_355089.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-07-08T13:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25234#issuecomment-355089",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_063905.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-07-08T13:05:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25234",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25234#event-63905"
}
```
