# Issue 13663: Fix Pynac spkg so that it builds on top of a debug build of python

archive/issues_013663.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  burcin vbraun simonking\n\nKeywords: pynac spkg debug\n\nThe problem is that the test used by the AX_PYTHON_DEVEL autoconf macro to check for distutils fails when Python is built with pydebug.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13867\n\n",
    "created_at": "2012-12-27T14:59:23Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "title": "Fix Pynac spkg so that it builds on top of a debug build of python",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13663",
    "user": "jpflori"
}
```
Assignee: tbd

CC:  burcin vbraun simonking

Keywords: pynac spkg debug

The problem is that the test used by the AX_PYTHON_DEVEL autoconf macro to check for distutils fails when Python is built with pydebug.

Issue created by migration from https://trac.sagemath.org/ticket/13867





---

archive/issue_comments_169221.json:
```json
{
    "body": "I'm thinking we should just patch Python to not print out extra crap. Otherwise we have basically no hope of running the Sage doctests, no?",
    "created_at": "2012-12-27T16:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169221",
    "user": "vbraun"
}
```

I'm thinking we should just patch Python to not print out extra crap. Otherwise we have basically no hope of running the Sage doctests, no?



---

archive/issue_comments_169222.json:
```json
{
    "body": "Good point.\nAnd that should be even easier.",
    "created_at": "2012-12-27T16:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169222",
    "user": "jpflori"
}
```

Good point.
And that should be even easier.



---

archive/issue_comments_169223.json:
```json
{
    "body": "In fact I do not really agree, especially now that I've checked that the crappy additional Python output does not pertub the doctest framework (surely because its spit on stderr and not stdout).",
    "created_at": "2012-12-27T16:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169223",
    "user": "jpflori"
}
```

In fact I do not really agree, especially now that I've checked that the crappy additional Python output does not pertub the doctest framework (surely because its spit on stderr and not stdout).



---

archive/issue_comments_169224.json:
```json
{
    "body": "Surely the sage pexpect interface to itself will not work. Or various checks in `sage.tests.cmdline` that check that stderr is empty.",
    "created_at": "2012-12-27T17:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169224",
    "user": "vbraun"
}
```

Surely the sage pexpect interface to itself will not work. Or various checks in `sage.tests.cmdline` that check that stderr is empty.



---

archive/issue_comments_169225.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-12-28T11:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169225",
    "user": "vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_169226.json:
```json
{
    "body": "I'm taking over this ticket to patch up python",
    "created_at": "2012-12-28T11:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169226",
    "user": "vbraun"
}
```

I'm taking over this ticket to patch up python



---

archive/issue_comments_169227.json:
```json
{
    "body": "Changing keywords from \"pynac spkg debug\" to \"python spkg debug\".",
    "created_at": "2012-12-28T11:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169227",
    "user": "vbraun"
}
```

Changing keywords from "pynac spkg debug" to "python spkg debug".



---

archive/issue_comments_169228.json:
```json
{
    "body": "Just to be on the safe side: To use this one with SAGE_DEBUG=yes on top of an existing Sage install, one needs to install this new python spkg, then (re-)install the new cython spkg from #13832, and then sage -ba, right?",
    "created_at": "2012-12-28T11:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169228",
    "user": "SimonKing"
}
```

Just to be on the safe side: To use this one with SAGE_DEBUG=yes on top of an existing Sage install, one needs to install this new python spkg, then (re-)install the new cython spkg from #13832, and then sage -ba, right?



---

archive/issue_comments_169229.json:
```json
{
    "body": "to get a working Sage you also need a patch to the Sage library (will post here soon) and a fixed Singular spkg... stay tuned ;-)",
    "created_at": "2012-12-28T11:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169229",
    "user": "vbraun"
}
```

to get a working Sage you also need a patch to the Sage library (will post here soon) and a fixed Singular spkg... stay tuned ;-)



---

archive/issue_comments_169230.json:
```json
{
    "body": "Patch to the Sage library is at #13868",
    "created_at": "2012-12-28T11:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169230",
    "user": "vbraun"
}
```

Patch to the Sage library is at #13868



---

archive/issue_comments_169231.json:
```json
{
    "body": "We now have an abundance of tickets needed to make SAGE_DEBUG work. Shouldn't there be a meta-ticket, listing all relevant single-purpose tickets (#13876, #13867, #13868, #13832, #13864, and what else)?",
    "created_at": "2012-12-28T12:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169231",
    "user": "SimonKing"
}
```

We now have an abundance of tickets needed to make SAGE_DEBUG work. Shouldn't there be a meta-ticket, listing all relevant single-purpose tickets (#13876, #13867, #13868, #13832, #13864, and what else)?



---

archive/issue_comments_169232.json:
```json
{
    "body": "#13864 is now the meta-ticket.",
    "created_at": "2012-12-28T13:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169232",
    "user": "vbraun"
}
```

#13864 is now the meta-ticket.



---

archive/issue_comments_169233.json:
```json
{
    "body": "Replying to [comment:10 SimonKing]:\n> We now have an abundance of tickets needed to make SAGE_DEBUG work. Shouldn't there be a meta-ticket, listing all relevant single-purpose tickets (#13876, #13867, #13868, #13832, #13864, and what else)?\n\nFWIW: I created a metaticket at #13877.",
    "created_at": "2012-12-28T13:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169233",
    "user": "SimonKing"
}
```

Replying to [comment:10 SimonKing]:
> We now have an abundance of tickets needed to make SAGE_DEBUG work. Shouldn't there be a meta-ticket, listing all relevant single-purpose tickets (#13876, #13867, #13868, #13832, #13864, and what else)?

FWIW: I created a metaticket at #13877.



---

archive/issue_comments_169234.json:
```json
{
    "body": "Replying to [comment:12 SimonKing]:\n> Replying to [comment:10 SimonKing]:\n> > We now have an abundance of tickets needed to make SAGE_DEBUG work. Shouldn't there be a meta-ticket, listing all relevant single-purpose tickets (#13876, #13867, #13868, #13832, #13864, and what else)?\n> \n> FWIW: I created a metaticket at #13877.\n\nOK, forget about that, Volker was faster with his change to #13864.",
    "created_at": "2012-12-28T13:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169234",
    "user": "SimonKing"
}
```

Replying to [comment:12 SimonKing]:
> Replying to [comment:10 SimonKing]:
> > We now have an abundance of tickets needed to make SAGE_DEBUG work. Shouldn't there be a meta-ticket, listing all relevant single-purpose tickets (#13876, #13867, #13868, #13832, #13864, and what else)?
> 
> FWIW: I created a metaticket at #13877.

OK, forget about that, Volker was faster with his change to #13864.



---

archive/issue_comments_169235.json:
```json
{
    "body": "In `spkg-install`, are you sure you don't mean `CFLAGS` and/or `CXXFLAGS` instead `CPPFLAGS`? Because `CPPFLAGS` normally means \"C preprocessor flags\".",
    "created_at": "2012-12-30T08:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169235",
    "user": "jdemeyer"
}
```

In `spkg-install`, are you sure you don't mean `CFLAGS` and/or `CXXFLAGS` instead `CPPFLAGS`? Because `CPPFLAGS` normally means "C preprocessor flags".



---

archive/issue_comments_169236.json:
```json
{
    "body": "The `spkg-install` already used `CPPFLAGS` before I edited it, so I stuck with it. It does get picked up on the gcc command line, fwiw.",
    "created_at": "2012-12-30T10:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169236",
    "user": "vbraun"
}
```

The `spkg-install` already used `CPPFLAGS` before I edited it, so I stuck with it. It does get picked up on the gcc command line, fwiw.



---

archive/issue_comments_169237.json:
```json
{
    "body": "Yes, it does use `CPPFLAGS` for its *intended purpose*. The `-I` option is related to preprocessing and belongs in `$CPPFLAGS`.  Flags like `-g` or `-O0` do not.\n\nNote that adding `-I$SAGE_LOCAL/include` to `CPPFLAGS` is actually unneeded since that path gets picked up automatically because of the `$CPATH` environment variable. So you might as well remove\n\n```\nCPPFLAGS=\"-I$SAGE_LOCAL/include $CPPFLAGS\"\nexport CPPFLAGS\n```\n",
    "created_at": "2012-12-30T10:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169237",
    "user": "jdemeyer"
}
```

Yes, it does use `CPPFLAGS` for its *intended purpose*. The `-I` option is related to preprocessing and belongs in `$CPPFLAGS`.  Flags like `-g` or `-O0` do not.

Note that adding `-I$SAGE_LOCAL/include` to `CPPFLAGS` is actually unneeded since that path gets picked up automatically because of the `$CPATH` environment variable. So you might as well remove

```
CPPFLAGS="-I$SAGE_LOCAL/include $CPPFLAGS"
export CPPFLAGS
```




---

archive/issue_comments_169238.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-12-30T10:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169238",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_169239.json:
```json
{
    "body": "Replying to [comment:17 vbraun]:\n> The `spkg-install` already used `CPPFLAGS` before I edited it\nIt also uses `CFLAGS` by the way:\n\n```\nexport CFLAGS=\"$CFLAGS `testcflags.sh -fwrapv`\"\n```\n",
    "created_at": "2012-12-30T10:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169239",
    "user": "jdemeyer"
}
```

Replying to [comment:17 vbraun]:
> The `spkg-install` already used `CPPFLAGS` before I edited it
It also uses `CFLAGS` by the way:

```
export CFLAGS="$CFLAGS `testcflags.sh -fwrapv`"
```




---

archive/issue_comments_169240.json:
```json
{
    "body": "I'm ok with the solution Volker proposes, we don't need that \"extra\" output, but I still think that Pynac should be able to deal with a vanilla Python debug build.\nSo I'm just posting that here so that Burcin can take notice (I'll post on pynac-devel as well).",
    "created_at": "2012-12-31T09:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169240",
    "user": "jpflori"
}
```

I'm ok with the solution Volker proposes, we don't need that "extra" output, but I still think that Pynac should be able to deal with a vanilla Python debug build.
So I'm just posting that here so that Burcin can take notice (I'll post on pynac-devel as well).



---

archive/issue_comments_169241.json:
```json
{
    "body": "Attachment [python-p5.patch](tarball://root/attachments/some-uuid/ticket13867/python-p5.patch) by vbraun created at 2012-12-31 10:54:30\n\ndiff for review only",
    "created_at": "2012-12-31T10:54:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169241",
    "user": "vbraun"
}
```

Attachment [python-p5.patch](tarball://root/attachments/some-uuid/ticket13867/python-p5.patch) by vbraun created at 2012-12-31 10:54:30

diff for review only



---

archive/issue_comments_169242.json:
```json
{
    "body": "I've removed the superfluous CPPFLAGS. Also `--with-pydebug` implies `-O0 -g` so we don't have to set it by hand.",
    "created_at": "2012-12-31T10:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169242",
    "user": "vbraun"
}
```

I've removed the superfluous CPPFLAGS. Also `--with-pydebug` implies `-O0 -g` so we don't have to set it by hand.



---

archive/issue_comments_169243.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-12-31T10:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169243",
    "user": "vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_169244.json:
```json
{
    "body": "I use the package successfully with SAGE_DEBUG=yes.\n\nSome criticism: SPKG.txt contains a section \"Patches\", but the new patch disable_print_refs_debug.patch is not mentioned.\n\nThe content of environment variables is sometimes tested like\n\n```\nif [\"x$SAGE_DEBUG\"=\"xyes\"]; then\n```\n\nif I am not mistaken, but here it is\n\n```\nif [\"$SAGE_DEBUG\"=\"yes\"]; then\n```\n\nIs that a problem?",
    "created_at": "2013-01-21T11:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169244",
    "user": "SimonKing"
}
```

I use the package successfully with SAGE_DEBUG=yes.

Some criticism: SPKG.txt contains a section "Patches", but the new patch disable_print_refs_debug.patch is not mentioned.

The content of environment variables is sometimes tested like

```
if ["x$SAGE_DEBUG"="xyes"]; then
```

if I am not mistaken, but here it is

```
if ["$SAGE_DEBUG"="yes"]; then
```

Is that a problem?



---

archive/issue_comments_169245.json:
```json
{
    "body": "I've added a line documenting the disable_print_refs_debug.patch\n\nThe `xyes` thing is a historical artifact.",
    "created_at": "2013-01-21T11:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169245",
    "user": "vbraun"
}
```

I've added a line documenting the disable_print_refs_debug.patch

The `xyes` thing is a historical artifact.



---

archive/issue_comments_169246.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-29T14:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169246",
    "user": "jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_169247.json:
```json
{
    "body": "Looks good.\n\nIf you really wants me to rant, I'd say:\n* first, there is a useless line at the end of the new patch for some emacs generated tmp file.\n* or even less problematic, you could remove the historical artifacts from spkg-install while you're at it.",
    "created_at": "2013-01-29T14:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169247",
    "user": "jpflori"
}
```

Looks good.

If you really wants me to rant, I'd say:
* first, there is a useless line at the end of the new patch for some emacs generated tmp file.
* or even less problematic, you could remove the historical artifacts from spkg-install while you're at it.



---

archive/issue_comments_169248.json:
```json
{
    "body": "Server down :-(",
    "created_at": "2013-01-30T07:41:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169248",
    "user": "jdemeyer"
}
```

Server down :-(



---

archive/issue_comments_169249.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-02-09T12:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13663",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13663#issuecomment-169249",
    "user": "jdemeyer"
}
```

Resolution: fixed
