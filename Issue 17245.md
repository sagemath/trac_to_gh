# Issue 17245: Fix load and save session in notebook

Issue created by migration from https://trac.sagemath.org/ticket/17482

Original creator: kcrisman

Original creation time: 2014-12-10 17:36:42

CC:  ppurka jdemeyer dimpase chapoton

See #9805, where we raised a warning.  It turns out that this can be done with a very minimal fix inside of Sage itself.  There is a symbolic link to `DATA` in each cell's temporary compute directory.


---

Comment by kcrisman created at 2014-12-10 17:45:05

Unfortunately, it turns out that practically all upstream tests (regular, not Selenium) are bogus if they involve evaluating cells, so there is no way to test this.  See also the related https://github.com/sagemath/sagenb/pull/291 which however does not affect this.
----
New commits:


---

Comment by kcrisman created at 2014-12-10 17:45:05

Changing status from new to needs_review.


---

Comment by kcrisman created at 2014-12-11 15:22:03

On a related note, see fixing load and save https://github.com/sagemath/sagenb/issues/107


---

Comment by jdemeyer created at 2014-12-14 15:20:43

Can you replace

```
'./data/' + name
```

by

```
os.path.join('data', name)
```



---

Comment by kcrisman created at 2014-12-15 13:14:17

Sure, that makes good sense.


---

Comment by git created at 2014-12-15 13:51:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2014-12-15 13:52:41

All set, I think; it still works for me, anyway, as it should.


---

Comment by jdemeyer created at 2014-12-24 09:55:41

Just to clarify: I do _not_ plan to fully review this ticket, mainly because `DATA` simply doesn't work properly (https://github.com/sagemath/sagenb/issues/260)


---

Comment by kcrisman created at 2015-01-08 14:43:14

> Just to clarify: I do not plan to fully review this ticket

I would argue that just because something is broken sometimes doesn't mean we shouldn't fix something else about it where it _would_ work properly.  Why not give this a positive review, since it improves things at least for single users?


---

Comment by jdemeyer created at 2015-01-08 14:51:35

Replying to [comment:9 kcrisman]:
> > Just to clarify: I do not plan to fully review this ticket
> 
> I would argue that just because something is broken sometimes doesn't mean we shouldn't fix something else about it where it _would_ work properly.

Let me rephrase then: given that `DATA` doesn't work for me, I never used it, so I don't know how it is supposed to work. Therefore, it is hard for me to review. And there is of course my subjective feeling that reviewing a small fix to a broken feature is pointless...


---

Comment by kcrisman created at 2015-01-08 15:54:36

No, this is actually easy to test and really has nothing to do with `DATA`.  And it's something a user definitely will want, it's not really that small of a bug, although the fix is very small.

Before, if a user in the (for the sake of argument, assume single-user via `sage -n`) notebook wanted to save a session

```
save_session('foo')
<boom>
```

The workaround was to tell the user exactly where to store it, but that is dumb.  Now,

```
save_session('foo')
```

'just works' in the notebook.   This is orthogonal to the `DATA` issue, because there isn't any other place one _could_ save the session that will automatically be visible to a given worksheet in any given cell one chooses to evaluate the loading from.


---

Comment by jdemeyer created at 2015-01-08 18:25:32

Why not just remove the `if embedded()` branches from `save_session` and `load_session`? Just use the filename that the user provided, instead of "guessing" that the user really wanted `os.path.join('data', name)`.


---

Comment by jdemeyer created at 2015-01-08 18:25:42

Changing status from needs_review to needs_info.


---

Comment by kcrisman created at 2015-01-08 19:24:43

On the `save_session` side, you'll note that it already _does_ save it there.  The problem is that this is *only accessible from that cell* unless they saved it to the filesystem in a known location (with full path, probably).  And, frankly, not every sagenb user is sophisticated enough to know what that means, and will just assume their file "is there".  Hence saving it somewhere universally accessible (in a given worksheet).  If one really had to, I guess if the path started with `/` one could decide not to save it in `data/`.

I think it is far more likely that someone would do

```
save_session('foo') # in cell xyz
<quit notebook, play frisbee, have lunch>
<open notebook again>
load_session('foo') # in some other cell, perhaps directly below xyz, with who knows what number
```

than that they will be asking for a specific filename on their computer.  And it's more convenient than having to remember some long path too - again, anyone who actually knows what they are doing will not have a problem with this anyway.  But I rarely assume users, or myself, know what they are doing.

I agree that one has to think about why the current code is there.  But given that the likely original author is the one who complained about it 'not working' in #9805, I am very reluctant not to consider this a bug!  And even William says there that the fix is just to figure out where `data/` lives.

Anyway, if you don't want to give it positive review and leave that to someone else, that's your prerogative, but I hope this clarifies why it's reasonable to try to deal with this in the current fashion.


---

Comment by kcrisman created at 2015-01-08 19:24:43

Changing status from needs_info to needs_review.


---

Comment by jdemeyer created at 2015-01-08 21:05:05

I actually think the current situation with the message is better then: it _educates_ the user about the fact that their file will not be universally accessible. It explains how to work around it (use `DATA`). This advice is useful in other situations besides `save_session()`.

In other words: I think it's better to _warn_ the user that they might be doing stupid instead of guessing that they wanted to do something else. What if I really wanted to save it just in the current cell? With this branch, I cannot do that.

Also: the current branch will break `save_session()` in cases where `data` is inaccessible (that could be solved with a `try/except`).


---

Comment by kcrisman created at 2015-01-08 21:11:00

> I actually think the current situation with the message is better then: it _educates_ the user about the fact that their file will not be universally accessible. It explains how to work around it (use `DATA`). This advice is useful in other situations besides `save_session()`.
But in the other cases, there _is_ no default.  This is how William designed it.  Perhaps that is dumb design.  I tend to think it is helpful to users.  The notebook 'feels like' the command line with this automatic usage of `DATA`.
> In other words: I think it's better to _warn_ the user that they might be doing stupid instead of guessing that they wanted to do something else. What if I really wanted to save it just in the current cell? With this branch, I cannot do that.
I hope you are not serious about wanting to save a _session_ in just the current cell.  Such a concept doesn't even make sense in the command line.
> Also: the current branch will break `save_session()` in cases where `data` is inaccessible (that could be solved with a `try/except`).
_That_ is a good point, since you have identified such cases.  Would you think it would be better to have it not save to `DATA` silently, or give a message, or ... ?  It should still already save in the cell directory, as noted.


---

Comment by jdemeyer created at 2015-01-08 22:15:05

Replying to [comment:16 kcrisman]:
> > I actually think the current situation with the message is better then: it _educates_ the user about the fact that their file will not be universally accessible. It explains how to work around it (use `DATA`). This advice is useful in other situations besides `save_session()`.
> But in the other cases, there _is_ no default.
My point is that there should never be a default directory. I would say it's surprising to users if `save_session()` uses `data` but `save` doesn't use `data`.

> Would you think it would be better to have it not save to DATA silently, or give a message, or ... ?
In any case not silently.


---

Comment by kcrisman created at 2015-01-09 14:54:05

> My point is that there should never be a default directory. I would say it's surprising to users if save_session() uses data but save doesn't use data.
In which case perhaps that should be added too.  The point is that in the notebook a new user will not know that everything is cell-specific, and will want to treat it like a Sage CL session.  In which case there _is_ a default directory, `pwd`, right?
> In any case not silently.
Okay, that can be worked on.  But not today.


---

Comment by kcrisman created at 2015-01-09 14:54:05

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2015-01-11 21:20:43

Replying to [comment:18 kcrisman]:
> The point is that in the notebook a new user will not know that everything is cell-specific
Perhaps _that_ is the part which should be reconsidered. If you find yourself in need of lots of work-arounds for a particular "feature", perhaps that "feature" was a bad idea...

I prefer the all-or-nothing approach: either use cell-specific directories for everything, or for nothing.


---

Comment by kcrisman created at 2015-01-12 14:30:10

> I prefer the all-or-nothing approach: either use cell-specific directories for everything, or for nothing.

Well, in that event this will just stay broken, because I obviously am not going to be able to completely rewrite the sagenb for this.


---

Comment by mkoeppe created at 2020-08-17 16:17:49

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2020-08-17 16:17:49

outdated, should be closed


---

Comment by dimpase created at 2020-08-18 22:18:21

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-08-19 07:19:26

Resolution: invalid
