# Issue 11803: Chow-Heegner points

archive/issues_011803.json:
```json
{
    "body": "Assignee: cremona\n\nCC:  pbruin\n\nInclude an implementation in Sage of the algorithm of [1] for computation of Chow-Heegner points on elliptic curves.  Assure that it can replicate the table of [1].\n\n[1] wstein.org/papers/chow_heegner/chowheeg1.pdf\n\nIssue created by migration from https://trac.sagemath.org/ticket/11975\n\n",
    "created_at": "2011-11-01T17:52:39Z",
    "labels": [
        "elliptic curves",
        "major",
        "enhancement"
    ],
    "title": "Chow-Heegner points",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11803",
    "user": "was"
}
```
Assignee: cremona

CC:  pbruin

Include an implementation in Sage of the algorithm of [1] for computation of Chow-Heegner points on elliptic curves.  Assure that it can replicate the table of [1].

[1] wstein.org/papers/chow_heegner/chowheeg1.pdf

Issue created by migration from https://trac.sagemath.org/ticket/11975





---

archive/issue_comments_134909.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134909",
    "user": "jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_comments_134910.json:
```json
{
    "body": "There is a lot of very useful stuff here, which could be moved elsewhere otherwise there's a danger that others might re-invent some of the wheels.  I am thinking of the SL2Z and Gamma0N-equivalence functions, and also the approximate-point class which could also be used for ordinary Heegner points, and also for points computed from a complex number modulo a period lattice (so-called elliptic exponential).  This is not a criticism.  And neither is it a review yet -- sorry!",
    "created_at": "2011-12-14T13:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134910",
    "user": "cremona"
}
```

There is a lot of very useful stuff here, which could be moved elsewhere otherwise there's a danger that others might re-invent some of the wheels.  I am thinking of the SL2Z and Gamma0N-equivalence functions, and also the approximate-point class which could also be used for ordinary Heegner points, and also for points computed from a complex number modulo a period lattice (so-called elliptic exponential).  This is not a criticism.  And neither is it a review yet -- sorry!



---

archive/issue_comments_134911.json:
```json
{
    "body": "Replying to [comment:3 cremona]:\n> There is a lot of very useful stuff here, which could be\n>  moved elsewhere otherwise there's a danger that others \n> might re-invent some of the wheels.  I am thinking of \n> the SL2Z and Gamma0N-equivalence functions, and also \n> the approximate-point class which could also be used \n> for ordinary Heegner points, and also for points \n> computed from a complex number modulo a period \n> lattice (so-called elliptic exponential). \n\nI realize that.  However, I didn't want a patch that would constantly bitrot, and at the same time, have to write way more code than necessary (e.g., if I do Gamma0N, then might as well do Gamma1N, etc.)  I think it would be good for this code to safely go in as a step 1, then in the future have small parts of it (the ones you list above) refactored and extended to more general cases.     I think it will be easier to referee now since it is fairly self contained and well documented (by a short paper).   The alternative might be 10 patches all over Sage with confusing dependencies....\n\n>  This is not a criticism.  And neither is it a review yet -- sorry!\n\nThe code isn't quite ready for review, but will be within a day or two.",
    "created_at": "2011-12-14T19:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134911",
    "user": "was"
}
```

Replying to [comment:3 cremona]:
> There is a lot of very useful stuff here, which could be
>  moved elsewhere otherwise there's a danger that others 
> might re-invent some of the wheels.  I am thinking of 
> the SL2Z and Gamma0N-equivalence functions, and also 
> the approximate-point class which could also be used 
> for ordinary Heegner points, and also for points 
> computed from a complex number modulo a period 
> lattice (so-called elliptic exponential). 

I realize that.  However, I didn't want a patch that would constantly bitrot, and at the same time, have to write way more code than necessary (e.g., if I do Gamma0N, then might as well do Gamma1N, etc.)  I think it would be good for this code to safely go in as a step 1, then in the future have small parts of it (the ones you list above) refactored and extended to more general cases.     I think it will be easier to referee now since it is fairly self contained and well documented (by a short paper).   The alternative might be 10 patches all over Sage with confusing dependencies....

>  This is not a criticism.  And neither is it a review yet -- sorry!

The code isn't quite ready for review, but will be within a day or two.



---

archive/issue_comments_134912.json:
```json
{
    "body": "Quick note: I'm going to post a new version of this patch soon that accounts for numerical noise issues.  I tried to use #10952 (the tolerance doctest framework patch), but -- much to my surprise -- it sadly seems totally useless when complex numbers are involved?!",
    "created_at": "2011-12-26T20:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134912",
    "user": "was"
}
```

Quick note: I'm going to post a new version of this patch soon that accounts for numerical noise issues.  I tried to use #10952 (the tolerance doctest framework patch), but -- much to my surprise -- it sadly seems totally useless when complex numbers are involved?!



---

archive/issue_comments_134913.json:
```json
{
    "body": "Attachment\n\nfixes all known numerical noise issues",
    "created_at": "2011-12-26T21:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134913",
    "user": "was"
}
```

Attachment

fixes all known numerical noise issues



---

archive/issue_comments_134914.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-12-26T21:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134914",
    "user": "was"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_134915.json:
```json
{
    "body": "OK, this is now ready for review.  My only concern is that it's very numerical, and I haven't tested it on any 32-bit Linux boxes.",
    "created_at": "2011-12-26T21:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134915",
    "user": "was"
}
```

OK, this is now ready for review.  My only concern is that it's very numerical, and I haven't tested it on any 32-bit Linux boxes.



---

archive/issue_comments_134916.json:
```json
{
    "body": "I am starting to review this now...",
    "created_at": "2012-01-18T15:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134916",
    "user": "cremona"
}
```

I am starting to review this now...



---

archive/issue_comments_134917.json:
```json
{
    "body": "Here is part 1 of a review which will take a while.\n\n1. Applies fine to 4.8.rc0;  two test failures (numerical noise, 64-bit):\n\n\n```\nsage -t -long devel/sage-main/sage/schemes/elliptic_curves/chow_heegner_fast.pyx\n**********************************************************************\nFile \"/home/jec/sage-4.8.rc0/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner_fast.pyx\", line 397:\n    sage: max([abs(v[i]-w[i]) for i in range(len(v))])\nExpected:\n    3...e-13\nGot:\n    2.96849663677e-13\n**********************************************************************\n```\n\n\n\n```\nsage -t -long devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py\n**********************************************************************\nFile \"/home/jec/sage-4.8.rc0/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py\", line 1587:\n    sage: phi(v[0]), phi(v[1])                          # long time\nExpected:\n    (-1.02140518266e-14 + 1.0*I, 5.55111512313e-16 + 1.0*I)\nGot:\n    (-5.44009282066e-15 + 1.0*I, 5.55111512313e-16 + 1.0*I)\n```\n\n\n2. No problems building docs since the new files are not added to the\nreference manual!  If they are (now or one day) there may well be\nissues with formatting, but I will not check for these now.\n\n3. Testing sl2z_rep_in_fundom(z):\n\n```\nsage: z=CDF(110.1,0.0000000001)   \nsage: zz,g = sl2z_rep_in_fundom(z)\nsage: g.acton(z)                  \n-5684.1 + 99999999.6275*I\nsage: zz                          \n0.341867712408 + 99999999.6769*I\nsage: g\n[ -56841 6258194]\n[     10   -1101]\n```\n\n\nThis suggests rounding problems -- which are always a problem with\nthis algorithm especially when the input point has very small\nimaginary part.  (And that does happen in practice!)  My own strategy\nhere (when Im(z) is very small) is to start by taking a good rational\napproximation to Re(z) and first use the SL(2,Z) element taking that\nrational to infinity; only then apply this algorithm.\n\n4. Gamma_0(N)-equivalence: very clever idea to check that (1) z1,z2\nand (2) Nz1,Nz2 are SL(2,Z)-equivalent!  I am still trying to prove to\nmyself that this works even when z1,z2 are elliptic, since in this\ncase the g taking z1 to z2 is not unique (in PSL(2,Z)).  So is it not\npossible for both pairs to be SL(2,Z)-equivalent but the matrix in\nSL(2,Z) taking Nz1 to Nz2 is not the conjugate by [N,0;0,1] of the one\ntaking z1 to z2?\n\n5. Typo: \nl.228 \"do\" --> \"due\"\n\n-- That's it as far as line 303.",
    "created_at": "2012-01-18T16:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134917",
    "user": "cremona"
}
```

Here is part 1 of a review which will take a while.

1. Applies fine to 4.8.rc0;  two test failures (numerical noise, 64-bit):


```
sage -t -long devel/sage-main/sage/schemes/elliptic_curves/chow_heegner_fast.pyx
**********************************************************************
File "/home/jec/sage-4.8.rc0/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner_fast.pyx", line 397:
    sage: max([abs(v[i]-w[i]) for i in range(len(v))])
Expected:
    3...e-13
Got:
    2.96849663677e-13
**********************************************************************
```



```
sage -t -long devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py
**********************************************************************
File "/home/jec/sage-4.8.rc0/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py", line 1587:
    sage: phi(v[0]), phi(v[1])                          # long time
Expected:
    (-1.02140518266e-14 + 1.0*I, 5.55111512313e-16 + 1.0*I)
Got:
    (-5.44009282066e-15 + 1.0*I, 5.55111512313e-16 + 1.0*I)
```


2. No problems building docs since the new files are not added to the
reference manual!  If they are (now or one day) there may well be
issues with formatting, but I will not check for these now.

3. Testing sl2z_rep_in_fundom(z):

```
sage: z=CDF(110.1,0.0000000001)   
sage: zz,g = sl2z_rep_in_fundom(z)
sage: g.acton(z)                  
-5684.1 + 99999999.6275*I
sage: zz                          
0.341867712408 + 99999999.6769*I
sage: g
[ -56841 6258194]
[     10   -1101]
```


This suggests rounding problems -- which are always a problem with
this algorithm especially when the input point has very small
imaginary part.  (And that does happen in practice!)  My own strategy
here (when Im(z) is very small) is to start by taking a good rational
approximation to Re(z) and first use the SL(2,Z) element taking that
rational to infinity; only then apply this algorithm.

4. Gamma_0(N)-equivalence: very clever idea to check that (1) z1,z2
and (2) Nz1,Nz2 are SL(2,Z)-equivalent!  I am still trying to prove to
myself that this works even when z1,z2 are elliptic, since in this
case the g taking z1 to z2 is not unique (in PSL(2,Z)).  So is it not
possible for both pairs to be SL(2,Z)-equivalent but the matrix in
SL(2,Z) taking Nz1 to Nz2 is not the conjugate by [N,0;0,1] of the one
taking z1 to z2?

5. Typo: 
l.228 "do" --> "due"

-- That's it as far as line 303.



---

archive/issue_comments_134918.json:
```json
{
    "body": "Attachment\n\npart 2 (apply trac_11975.patch, then this patch)",
    "created_at": "2012-01-18T20:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134918",
    "user": "was"
}
```

Attachment

part 2 (apply trac_11975.patch, then this patch)



---

archive/issue_comments_134919.json:
```json
{
    "body": "John,\n\nThe attached patch addresses (the hell out of?) all of your points.\n\n -- William",
    "created_at": "2012-01-18T20:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134919",
    "user": "was"
}
```

John,

The attached patch addresses (the hell out of?) all of your points.

 -- William



---

archive/issue_comments_134920.json:
```json
{
    "body": "This is John's second review, which he couldn't post because of a DB error.  I'm posting it for him:\n                                               \n                                             \n1. With the second patch, all tests pass except for one (see below) and\nthe docs build OK.  I have not yet actually looked at the ref-man\npages.  And the new files have 100% coverage.\n\n\n```\nsage -t  devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py\n**********************************************************************\nFile \"/home/jec/sage-4.8.rc0/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py\", line 236:\n    sage: sl2z_rep_in_fundom(complex(2.17,.19))\nException raised:\n    Traceback (most recent call last):\n      File \"/home/jec/sage-4.8.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/jec/sage-4.8.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/jec/sage-4.8.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_2[28]>\", line 1, in <module>\n        sl2z_rep_in_fundom(complex(RealNumber('2.17'),RealNumber('.19')))###line 236:\n    sage: sl2z_rep_in_fundom(complex(2.17,.19))\n      File \"/home/jec/sage-4.8.rc0/local/lib/python/site-packages/sage/schemes/elliptic_curves/chow_heegner.py\", line 240, in sl2z_rep_in_fundom\n        if isinstance(z, (float, int, long)) or z.imag() <= 0:\n    TypeError: 'float' object is not callable\n```\n\nThe problem is that when z has type complex, z.imag is not a function\nso z.imag() raises an error.  I don't know what to do: imag(z) works\nfor CDF and complex, but for complex it returns a complex number!!!\n\n```\nsage: imag(CDF(1,1))\n1.0\nsage: imag(complex(1,1))\n(1+0j)\n```\n\n\n2. In the comp method for X0NPoint you get an assertion error when the\nlevels are different.  Would it not be better to do something\ndifferent?\n\n3. Your Atkin-Lehner method for X0NPoint is more general than the doc\nsays: it says that q should be a prime power, but it works fine for\nany q|N coprime to N/q (as it should!).\n\n```\nsage: z = CDF(1,1)         \nsage: P = X0NPoint(z,90,30) # N = 90 = 10*9\nsage: P.atkin_lehner(10)                 \n[0.11049724 + 0.00055248619*I]\nsage: P.atkin_lehner(10).atkin_lehner(10)\n[0.10554020 + 0.000013888696*I]\nsage: P.atkin_lehner(10).atkin_lehner(10) == P\nTrue\n```\n\nSince you'll be editing the INPUT anyway, I suggest adding an example such as this.\n\n4. Function close_points: (1) missing explanation of the search_bound\ninput param. (2) I guess you mean to use this function only for rank1\ncurves?  You only use the first generator.  And it's inefficient to\ncompute n*Q for each n in the range [-k..k] separately, which is\n*precisely* why Iwrote this a few years ago:\n\n\n```\nsage: multiples?\nFile:           /home/jec/sage-4.8.rc0/local/lib/python2.6/site-packages/sage/groups/generic.py\nDocstring:\n       Return an iterator which runs through \"P0+i*P\" for \"i\" in\n       \"range(n)\".\n```\n\nFor example:\n\n```\nsage: P = EllipticCurve('389a1').gens()[0]\nsage: [Q[0] for Q in multiples(P,11,-5*P)]\n[-22625407/11397376, 47503/16641, 26/361, 10/9, -1, 0, -1, 10/9, 26/361, 47503/16641, -22625407/11397376]\n```\n\n\n5. The last example for the identify function calls point_exact() not\nidentify()!  And point_exact seems to be a methd of a different class.\nDid you mean to say c.numerical_approx().identify()?\n\n6. I checked that EllipticCurve([0,2011]) is still not in the database\n(no: it has conductor 1.7 billion).  I won't ask for this example to\nbe changed to [0,2012] (which has a smaller conductor!).\n\n7. check_optimal:  special case needed for 990h3.  sorry.....\n\n8. \"Return the elliptic curve that this is the modular parametrization of.\" \nshould be \n\"Return the elliptic curve of which this is the modular parametrization.\"\n(There are some lapses of grammar up with which I will not put!)\n\n--- reached line 1681 of the first patch, just before ChowHeegnerPoint class ---",
    "created_at": "2012-01-18T22:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134920",
    "user": "was"
}
```

This is John's second review, which he couldn't post because of a DB error.  I'm posting it for him:
                                               
                                             
1. With the second patch, all tests pass except for one (see below) and
the docs build OK.  I have not yet actually looked at the ref-man
pages.  And the new files have 100% coverage.


```
sage -t  devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py
**********************************************************************
File "/home/jec/sage-4.8.rc0/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py", line 236:
    sage: sl2z_rep_in_fundom(complex(2.17,.19))
Exception raised:
    Traceback (most recent call last):
      File "/home/jec/sage-4.8.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/jec/sage-4.8.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/jec/sage-4.8.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_2[28]>", line 1, in <module>
        sl2z_rep_in_fundom(complex(RealNumber('2.17'),RealNumber('.19')))###line 236:
    sage: sl2z_rep_in_fundom(complex(2.17,.19))
      File "/home/jec/sage-4.8.rc0/local/lib/python/site-packages/sage/schemes/elliptic_curves/chow_heegner.py", line 240, in sl2z_rep_in_fundom
        if isinstance(z, (float, int, long)) or z.imag() <= 0:
    TypeError: 'float' object is not callable
```

The problem is that when z has type complex, z.imag is not a function
so z.imag() raises an error.  I don't know what to do: imag(z) works
for CDF and complex, but for complex it returns a complex number!!!

```
sage: imag(CDF(1,1))
1.0
sage: imag(complex(1,1))
(1+0j)
```


2. In the comp method for X0NPoint you get an assertion error when the
levels are different.  Would it not be better to do something
different?

3. Your Atkin-Lehner method for X0NPoint is more general than the doc
says: it says that q should be a prime power, but it works fine for
any q|N coprime to N/q (as it should!).

```
sage: z = CDF(1,1)         
sage: P = X0NPoint(z,90,30) # N = 90 = 10*9
sage: P.atkin_lehner(10)                 
[0.11049724 + 0.00055248619*I]
sage: P.atkin_lehner(10).atkin_lehner(10)
[0.10554020 + 0.000013888696*I]
sage: P.atkin_lehner(10).atkin_lehner(10) == P
True
```

Since you'll be editing the INPUT anyway, I suggest adding an example such as this.

4. Function close_points: (1) missing explanation of the search_bound
input param. (2) I guess you mean to use this function only for rank1
curves?  You only use the first generator.  And it's inefficient to
compute n*Q for each n in the range [-k..k] separately, which is
*precisely* why Iwrote this a few years ago:


```
sage: multiples?
File:           /home/jec/sage-4.8.rc0/local/lib/python2.6/site-packages/sage/groups/generic.py
Docstring:
       Return an iterator which runs through "P0+i*P" for "i" in
       "range(n)".
```

For example:

```
sage: P = EllipticCurve('389a1').gens()[0]
sage: [Q[0] for Q in multiples(P,11,-5*P)]
[-22625407/11397376, 47503/16641, 26/361, 10/9, -1, 0, -1, 10/9, 26/361, 47503/16641, -22625407/11397376]
```


5. The last example for the identify function calls point_exact() not
identify()!  And point_exact seems to be a methd of a different class.
Did you mean to say c.numerical_approx().identify()?

6. I checked that EllipticCurve([0,2011]) is still not in the database
(no: it has conductor 1.7 billion).  I won't ask for this example to
be changed to [0,2012] (which has a smaller conductor!).

7. check_optimal:  special case needed for 990h3.  sorry.....

8. "Return the elliptic curve that this is the modular parametrization of." 
should be 
"Return the elliptic curve of which this is the modular parametrization."
(There are some lapses of grammar up with which I will not put!)

--- reached line 1681 of the first patch, just before ChowHeegnerPoint class ---



---

archive/issue_comments_134921.json:
```json
{
    "body": "apply trac_11975.patch, trac_11975-part2.patch, and this patch",
    "created_at": "2012-01-18T23:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134921",
    "user": "was"
}
```

apply trac_11975.patch, trac_11975-part2.patch, and this patch



---

archive/issue_comments_134922.json:
```json
{
    "body": "Attachment\n\nThe story so far:   patches part2 and part3 address all the points Imade in the frist two parts of my review, with one exception.  As I emailed William independently the test for Gamma0(N)-equivalence of points in the upper half-plane is incorrect and can return True when it should be False, for example:\n\n```\nsage: N=5                                 \nsage: z1=CDF(-2,1)/5                      \nsage: z2=CDF(2,1)/5                       \nsage: is_gamma0N_equivalent(z1,z2,5,1e-10)\nTrue\n```\n\nThis is wrong since (up to sign) the only matrices in SL(2,Z) taking z1 to z2 are\n`[[1,0],[-4,1]]` and `[[2,-1],[-3,2]]`, neither of which is in Gamma0(5):\n\n```\nsage: g1=SL2Z([1,0,-4,1])\nsage: g2=SL2Z([2,-1,-3,2])\nsage: abs(g1.acton(z2) -z1)\n6.20633538312e-17\nsage: abs(g2.acton(z2) -z1)\n2.00148302124e-16\n```\n\n\nI'll now continue the review...",
    "created_at": "2012-01-19T13:32:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134922",
    "user": "cremona"
}
```

Attachment

The story so far:   patches part2 and part3 address all the points Imade in the frist two parts of my review, with one exception.  As I emailed William independently the test for Gamma0(N)-equivalence of points in the upper half-plane is incorrect and can return True when it should be False, for example:

```
sage: N=5                                 
sage: z1=CDF(-2,1)/5                      
sage: z2=CDF(2,1)/5                       
sage: is_gamma0N_equivalent(z1,z2,5,1e-10)
True
```

This is wrong since (up to sign) the only matrices in SL(2,Z) taking z1 to z2 are
`[[1,0],[-4,1]]` and `[[2,-1],[-3,2]]`, neither of which is in Gamma0(5):

```
sage: g1=SL2Z([1,0,-4,1])
sage: g2=SL2Z([2,-1,-3,2])
sage: abs(g1.acton(z2) -z1)
6.20633538312e-17
sage: abs(g2.acton(z2) -z1)
2.00148302124e-16
```


I'll now continue the review...



---

archive/issue_comments_134923.json:
```json
{
    "body": "No more comments!  As soon as the Gamma0(N) equivalence test is fixed I'll give the triple of patches a combined positive review.",
    "created_at": "2012-01-19T14:19:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134923",
    "user": "cremona"
}
```

No more comments!  As soon as the Gamma0(N) equivalence test is fixed I'll give the triple of patches a combined positive review.



---

archive/issue_comments_134924.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-01-19T14:19:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134924",
    "user": "cremona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_134925.json:
```json
{
    "body": "part 4, addressing the major issue John Cremona found in equivalence checking.",
    "created_at": "2012-01-20T20:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134925",
    "user": "was"
}
```

part 4, addressing the major issue John Cremona found in equivalence checking.



---

archive/issue_comments_134926.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-01-20T20:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134926",
    "user": "was"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_134927.json:
```json
{
    "body": "Attachment\n\nI fixed the Gamma0(N) equivalence test mainly by taking old code I had already written for a previous version and putting it back in.  This ended up revealing some other issues, interesting examples, etc., which is why the patch is bigger than expected.",
    "created_at": "2012-01-20T20:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134927",
    "user": "was"
}
```

Attachment

I fixed the Gamma0(N) equivalence test mainly by taking old code I had already written for a previous version and putting it back in.  This ended up revealing some other issues, interesting examples, etc., which is why the patch is bigger than expected.



---

archive/issue_comments_134928.json:
```json
{
    "body": "Replying to [comment:13 was]:\n> I fixed the Gamma0(N) equivalence test mainly by taking old code I had already written for a previous version and putting it back in.  This ended up revealing some other issues, interesting examples, etc., which is why the patch is bigger than expected. \n\nI'll look at it as soon as I can.",
    "created_at": "2012-01-21T12:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134928",
    "user": "cremona"
}
```

Replying to [comment:13 was]:
> I fixed the Gamma0(N) equivalence test mainly by taking old code I had already written for a previous version and putting it back in.  This ended up revealing some other issues, interesting examples, etc., which is why the patch is bigger than expected. 

I'll look at it as soon as I can.



---

archive/issue_comments_134929.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2012-01-21T14:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134929",
    "user": "cremona"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_134930.json:
```json
{
    "body": "The fix looks good to me.  I am testing now (done & fine).  I am slightly worried that the equality tests for i and rho using == would be better done using equality up to some precision?\n\nOne could cache the \"constants\" i, rho and their stabilisers, but it is hardly worth while since it will only be rare that these last lines of code are used in practice.\n\nLastly, do you need to test for both rho and rhobar given that you have normalised the fund.dom.reps.?  If so, the third of your special cases will not happen.\n\n```\nsage: z = (2*CC(pi)*CC(I)/6).exp()\nsage: z\n0.500000000000000 + 0.866025403784439*I\nsage: canonicalize_sl2z(z)\n(-0.500000000000000 + 0.866025403784439*I, None)\n```\n",
    "created_at": "2012-01-21T14:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134930",
    "user": "cremona"
}
```

The fix looks good to me.  I am testing now (done & fine).  I am slightly worried that the equality tests for i and rho using == would be better done using equality up to some precision?

One could cache the "constants" i, rho and their stabilisers, but it is hardly worth while since it will only be rare that these last lines of code are used in practice.

Lastly, do you need to test for both rho and rhobar given that you have normalised the fund.dom.reps.?  If so, the third of your special cases will not happen.

```
sage: z = (2*CC(pi)*CC(I)/6).exp()
sage: z
0.500000000000000 + 0.866025403784439*I
sage: canonicalize_sl2z(z)
(-0.500000000000000 + 0.866025403784439*I, None)
```




---

archive/issue_comments_134931.json:
```json
{
    "body": "Replying to [comment:15 cremona]:\n> The fix looks good to me.  I am testing now (done & fine).  I am slightly worried that the equality tests for i and rho using == would be better done using equality up to some precision?\n\nIt is, in a sense, because it happens in `C=ComplexField(prec)`, where prec is the parameter that gets passed in.\n\n> One could cache the \"constants\" i, rho and their stabilisers, but it is hardly worth while since it will only \n> be rare that these last lines of code are used in practice.\n\nSince the precision changes a lot, this might not be worth it, given how much other work happens and how rare this case is. \n\n> Lastly, do you need to test for both rho and rhobar given that you have normalised the fund.dom.reps.? \n\nNope -- very good point. I've removed that. \n\nIs there anything else you want me to change? \n\n- William",
    "created_at": "2012-02-04T06:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134931",
    "user": "was"
}
```

Replying to [comment:15 cremona]:
> The fix looks good to me.  I am testing now (done & fine).  I am slightly worried that the equality tests for i and rho using == would be better done using equality up to some precision?

It is, in a sense, because it happens in `C=ComplexField(prec)`, where prec is the parameter that gets passed in.

> One could cache the "constants" i, rho and their stabilisers, but it is hardly worth while since it will only 
> be rare that these last lines of code are used in practice.

Since the precision changes a lot, this might not be worth it, given how much other work happens and how rare this case is. 

> Lastly, do you need to test for both rho and rhobar given that you have normalised the fund.dom.reps.? 

Nope -- very good point. I've removed that. 

Is there anything else you want me to change? 

- William



---

archive/issue_comments_134932.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-02-04T06:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134932",
    "user": "was"
}
```

Attachment



---

archive/issue_comments_134933.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-02-04T06:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134933",
    "user": "was"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_134934.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-04T16:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134934",
    "user": "cremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_134935.json:
```json
{
    "body": "Replying to [comment:16 was]:\n\n> \n> Is there anything else you want me to change? \n\nNo!  Here comes a positive review.  You'll need to list the patches to be applied in the description (easy: all of them).  I did fold them into one patch, but that made me the owner so I have not uploaded it.\n\n\n> \n>  - William",
    "created_at": "2012-02-04T16:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134935",
    "user": "cremona"
}
```

Replying to [comment:16 was]:

> 
> Is there anything else you want me to change? 

No!  Here comes a positive review.  You'll need to list the patches to be applied in the description (easy: all of them).  I did fold them into one patch, but that made me the owner so I have not uploaded it.


> 
>  - William



---

archive/issue_comments_134936.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-02-07T08:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134936",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_134937.json:
```json
{
    "body": "Administrative note: [attachment:trac_11975-part2.patch] needs a commit message.",
    "created_at": "2012-02-07T08:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134937",
    "user": "jdemeyer"
}
```

Administrative note: [attachment:trac_11975-part2.patch] needs a commit message.



---

archive/issue_comments_134938.json:
```json
{
    "body": "There is numerical noise and a 32/64-bit issue on hawk (OpenSolaris 06.2009-32):\n\n```\nsage -t  --long -force_lib devel/sage/sage/schemes/elliptic_curves/chow_heegner_fast.pyx\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner_fast.pyx\", line 469:\n    sage: s.newton(-.6*I)\nExpected:\n    [(-0.0720852069059 - 0.638326735148*I, 6, 1.3877787807814457e-17)]\nGot:\n    [(-0.0720852069059 - 0.638326735148*I, 6, 0.0)]\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner_fast.pyx\", line 473:\n    sage: s.newton([0, -.6*I])\nExpected:\n    [(-0.605829586188, 7, 0.0), (-0.0720852069059 - 0.638326735148*I, 6, 1.3877787807814457e-17)]\nGot:\n    [(-0.605829586188, 7, 0.0), (-0.0720852069059 - 0.638326735148*I, 6, 0.0)]\n**********************************************************************\nsage -t  --long -force_lib devel/sage/sage/schemes/elliptic_curves/chow_heegner.py\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py\", line 86:\n    sage: zz\nExpected:\n    0.341867712408 + 99999999.6769*I\nGot:\n    0.34186771241 + 99999999.6769*I\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py\", line 207:\n    sage: sl2z_rep_in_fundom(CC(1+I), eps=1)   # must be small\nExpected:\n    Traceback (most recent call last):\n    ...\n    ValueError: prec (=0) must be >= 2 and <= 9223372036854775807.\nGot:\n    Traceback (most recent call last):\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_2[22]>\", line 1, in <module>\n        sl2z_rep_in_fundom(CC(Integer(1)+I), eps=Integer(1))   # must be small###line 207:\n    sage: sl2z_rep_in_fundom(CC(1+I), eps=1)   # must be small\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/local/lib/python/site-packages/sage/schemes/elliptic_curves/chow_heegner.py\", line 265, in sl2z_rep_in_fundom\n        w = ComplexIntervalField(prec)(z)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/local/lib/python/site-packages/sage/rings/complex_interval_field.py\", line 70, in ComplexIntervalField\n        C = ComplexIntervalField_class(prec)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/local/lib/python/site-packages/sage/rings/complex_interval_field.py\", line 144, in __init__\n        ParentWithGens.__init__(self, self._real_field(), ('I',), False, category = Fields())\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/local/lib/python/site-packages/sage/rings/complex_interval_field.py\", line 246, in _real_field\n        self.__real_field = real_mpfi.RealIntervalField(self._prec)\n      File \"real_mpfi.pyx\", line 277, in sage.rings.real_mpfi.RealIntervalField (sage/rings/real_mpfi.c:3097)\n      File \"real_mpfi.pyx\", line 443, in sage.rings.real_mpfi.RealIntervalField_class.__init__ (sage/rings/real_mpfi.c:3302)\n    ValueError: prec (=0) must be >= 2 and <= 2147483647.\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py\", line 949:\n    sage: f(t[0][0])\nExpected:\n    4.4408920985e-16 - 1.11022302463e-16*I\nGot:\n    4.4408920985e-16 - 8.66548586359e-17*I\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py\", line 1524:\n    sage: phi(v[1])\nExpected:\n    1.0\nGot:\n    1.0 - 8.49472402142e-17*I\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py\", line 2011:\n    sage: P.numerical_approx()\nExpected:\n    (1.44444444444440...: -1.03703703703... : 1.00000000000000)\nGot:\n    (1.44444444444447 + 2.74248939530208e-15*I : -1.03703703703708 - 3.49918222885543e-15*I : 1.00000000000000)\n**********************************************************************\n```\n",
    "created_at": "2012-02-07T12:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134938",
    "user": "jdemeyer"
}
```

There is numerical noise and a 32/64-bit issue on hawk (OpenSolaris 06.2009-32):

```
sage -t  --long -force_lib devel/sage/sage/schemes/elliptic_curves/chow_heegner_fast.pyx
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner_fast.pyx", line 469:
    sage: s.newton(-.6*I)
Expected:
    [(-0.0720852069059 - 0.638326735148*I, 6, 1.3877787807814457e-17)]
Got:
    [(-0.0720852069059 - 0.638326735148*I, 6, 0.0)]
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner_fast.pyx", line 473:
    sage: s.newton([0, -.6*I])
Expected:
    [(-0.605829586188, 7, 0.0), (-0.0720852069059 - 0.638326735148*I, 6, 1.3877787807814457e-17)]
Got:
    [(-0.605829586188, 7, 0.0), (-0.0720852069059 - 0.638326735148*I, 6, 0.0)]
**********************************************************************
sage -t  --long -force_lib devel/sage/sage/schemes/elliptic_curves/chow_heegner.py
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py", line 86:
    sage: zz
Expected:
    0.341867712408 + 99999999.6769*I
Got:
    0.34186771241 + 99999999.6769*I
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py", line 207:
    sage: sl2z_rep_in_fundom(CC(1+I), eps=1)   # must be small
Expected:
    Traceback (most recent call last):
    ...
    ValueError: prec (=0) must be >= 2 and <= 9223372036854775807.
Got:
    Traceback (most recent call last):
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_2[22]>", line 1, in <module>
        sl2z_rep_in_fundom(CC(Integer(1)+I), eps=Integer(1))   # must be small###line 207:
    sage: sl2z_rep_in_fundom(CC(1+I), eps=1)   # must be small
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/local/lib/python/site-packages/sage/schemes/elliptic_curves/chow_heegner.py", line 265, in sl2z_rep_in_fundom
        w = ComplexIntervalField(prec)(z)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/local/lib/python/site-packages/sage/rings/complex_interval_field.py", line 70, in ComplexIntervalField
        C = ComplexIntervalField_class(prec)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/local/lib/python/site-packages/sage/rings/complex_interval_field.py", line 144, in __init__
        ParentWithGens.__init__(self, self._real_field(), ('I',), False, category = Fields())
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/local/lib/python/site-packages/sage/rings/complex_interval_field.py", line 246, in _real_field
        self.__real_field = real_mpfi.RealIntervalField(self._prec)
      File "real_mpfi.pyx", line 277, in sage.rings.real_mpfi.RealIntervalField (sage/rings/real_mpfi.c:3097)
      File "real_mpfi.pyx", line 443, in sage.rings.real_mpfi.RealIntervalField_class.__init__ (sage/rings/real_mpfi.c:3302)
    ValueError: prec (=0) must be >= 2 and <= 2147483647.
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py", line 949:
    sage: f(t[0][0])
Expected:
    4.4408920985e-16 - 1.11022302463e-16*I
Got:
    4.4408920985e-16 - 8.66548586359e-17*I
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py", line 1524:
    sage: phi(v[1])
Expected:
    1.0
Got:
    1.0 - 8.49472402142e-17*I
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py", line 2011:
    sage: P.numerical_approx()
Expected:
    (1.44444444444440...: -1.03703703703... : 1.00000000000000)
Got:
    (1.44444444444447 + 2.74248939530208e-15*I : -1.03703703703708 - 3.49918222885543e-15*I : 1.00000000000000)
**********************************************************************
```




---

archive/issue_comments_134939.json:
```json
{
    "body": "Could you also change the headings of the newly added files to be compliant with [http://sagemath.org/doc/developer/conventions.html#headings-of-sage-library-code-files](http://sagemath.org/doc/developer/conventions.html#headings-of-sage-library-code-files)",
    "created_at": "2012-02-07T12:29:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134939",
    "user": "jdemeyer"
}
```

Could you also change the headings of the newly added files to be compliant with [http://sagemath.org/doc/developer/conventions.html#headings-of-sage-library-code-files](http://sagemath.org/doc/developer/conventions.html#headings-of-sage-library-code-files)



---

archive/issue_comments_134940.json:
```json
{
    "body": "In `module_list.py`, you should not use `cblas` but the variables BLAS, BLAS2.",
    "created_at": "2012-02-07T21:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134940",
    "user": "jdemeyer"
}
```

In `module_list.py`, you should not use `cblas` but the variables BLAS, BLAS2.



---

archive/issue_comments_134941.json:
```json
{
    "body": "On cleo (RHEL 5.3 ia64):\n\n```\nsage -t  --long -force_lib devel/sage/sage/schemes/elliptic_curves/chow_heegner.py\n**********************************************************************\nFile \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py\", line 949:\n    sage: f(t[0][0])\nExpected:\n    4.4408920985e-16 - 1.11022302463e-16*I\nGot:\n    4.4408920985e-16 - 8.97307024383e-17*I\n**********************************************************************\nFile \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py\", line 395:\n    sage: is_sl2z_equivalent(z1, z2, 40)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py\", line 1524:\n    sage: phi(v[1])\nExpected:\n    1.0\nGot:\n    1.0 - 1.00505377226e-16*I\n**********************************************************************\n```\n",
    "created_at": "2012-02-07T21:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134941",
    "user": "jdemeyer"
}
```

On cleo (RHEL 5.3 ia64):

```
sage -t  --long -force_lib devel/sage/sage/schemes/elliptic_curves/chow_heegner.py
**********************************************************************
File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py", line 949:
    sage: f(t[0][0])
Expected:
    4.4408920985e-16 - 1.11022302463e-16*I
Got:
    4.4408920985e-16 - 8.97307024383e-17*I
**********************************************************************
File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py", line 395:
    sage: is_sl2z_equivalent(z1, z2, 40)
Expected:
    True
Got:
    False
**********************************************************************
File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta3/devel/sage-main/sage/schemes/elliptic_curves/chow_heegner.py", line 1524:
    sage: phi(v[1])
Expected:
    1.0
Got:
    1.0 - 1.00505377226e-16*I
**********************************************************************
```




---

archive/issue_comments_134942.json:
```json
{
    "body": "Sorry but I am now confused about what to apply.  Presumably the 5 patches on githhub in the order part1,...,part5, but the last of those still does not address Jeroen's points?\n\nI am really hoping that I can give this another positive review without having to read all except one last patch!  I had completely forgotten that this never made it.  SO as soon as you tag it \"needs review\" I'll look at it.",
    "created_at": "2013-07-09T18:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134942",
    "user": "cremona"
}
```

Sorry but I am now confused about what to apply.  Presumably the 5 patches on githhub in the order part1,...,part5, but the last of those still does not address Jeroen's points?

I am really hoping that I can give this another positive review without having to read all except one last patch!  I had completely forgotten that this never made it.  SO as soon as you tag it "needs review" I'll look at it.



---

archive/issue_comments_134943.json:
```json
{
    "body": "Replying to [comment:27 cremona]:\n> Sorry but I am now confused about what to apply.  \n> Presumably the 5 patches on githhub in the order part1,...,part5,\n\nYes.\n\n>  but the last of those still does not address Jeroen's points?\n\nYes. \n\n\n> I am really hoping that I can give this another positive review without having to read all except one last patch!  I had completely forgotten that this never made it.  SO as soon as you tag it \"needs review\" I'll look at it.\n> \n\nIt's not \"needs review\" yet.  The issues are just some numerical noise, and I'm just updating the patches so people can use them (not so that they can get into sage, just yet).",
    "created_at": "2013-07-09T18:49:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134943",
    "user": "was"
}
```

Replying to [comment:27 cremona]:
> Sorry but I am now confused about what to apply.  
> Presumably the 5 patches on githhub in the order part1,...,part5,

Yes.

>  but the last of those still does not address Jeroen's points?

Yes. 


> I am really hoping that I can give this another positive review without having to read all except one last patch!  I had completely forgotten that this never made it.  SO as soon as you tag it "needs review" I'll look at it.
> 

It's not "needs review" yet.  The issues are just some numerical noise, and I'm just updating the patches so people can use them (not so that they can get into sage, just yet).



---

archive/issue_comments_134944.json:
```json
{
    "body": "works with git sage-6.2-beta8...",
    "created_at": "2014-04-18T17:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134944",
    "user": "was"
}
```

works with git sage-6.2-beta8...



---

archive/issue_comments_134945.json:
```json
{
    "body": "Attachment",
    "created_at": "2014-04-22T20:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134945",
    "user": "was"
}
```

Attachment



---

archive/issue_comments_134946.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-22T20:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134946",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134947.json:
```json
{
    "body": "Changing keywords from \"\" to \"chow heegner\".",
    "created_at": "2015-08-21T17:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134947",
    "user": "chapoton"
}
```

Changing keywords from "" to "chow heegner".



---

archive/issue_comments_134948.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-21T17:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134948",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134949.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-21T18:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134949",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134950.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-22T08:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134950",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134951.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-05T12:24:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134951",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134952.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-05T12:26:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134952",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134953.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-05T12:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134953",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134954.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-14T19:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134954",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134955.json:
```json
{
    "body": "I made an attempt to fix some errors and bring this up to date as I was curious.\n----\nNew commits:",
    "created_at": "2020-01-14T12:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134955",
    "user": "alexjbest"
}
```

I made an attempt to fix some errors and bring this up to date as I was curious.
----
New commits:



---

archive/issue_comments_134956.json:
```json
{
    "body": "branch refreshed and squashed, but this does not compile\n----\nNew commits:",
    "created_at": "2021-06-08T19:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134956",
    "user": "chapoton"
}
```

branch refreshed and squashed, but this does not compile
----
New commits:



---

archive/issue_comments_134957.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-08T19:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134957",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134958.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-08T19:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134958",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134959.json:
```json
{
    "body": "now the doctests timeout, somewhere",
    "created_at": "2021-06-09T07:20:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134959",
    "user": "chapoton"
}
```

now the doctests timeout, somewhere



---

archive/issue_comments_134960.json:
```json
{
    "body": "Remove assignee cremona.",
    "created_at": "2021-06-09T08:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134960",
    "user": "cremona"
}
```

Remove assignee cremona.



---

archive/issue_comments_134961.json:
```json
{
    "body": "I clearly spent some time on this in 2011 and 2012 but do not intend to spend any more.  It makes no sense for me to \"own\" this ticket, especially as the concept of owning tickets was discontinuted years ago, so I have disowned it.",
    "created_at": "2021-06-09T08:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134961",
    "user": "cremona"
}
```

I clearly spent some time on this in 2011 and 2012 but do not intend to spend any more.  It makes no sense for me to "own" this ticket, especially as the concept of owning tickets was discontinuted years ago, so I have disowned it.



---

archive/issue_comments_134962.json:
```json
{
    "body": "Probably a stupid question from a complete outsider, but how is this related to the content of\n\nsrc/sage/schemes/elliptic_curves/heegner.py ?\n\nIn other, do we have Chow-Heegner point = Heegner point ?",
    "created_at": "2021-06-10T15:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134962",
    "user": "chapoton"
}
```

Probably a stupid question from a complete outsider, but how is this related to the content of

src/sage/schemes/elliptic_curves/heegner.py ?

In other, do we have Chow-Heegner point = Heegner point ?



---

archive/issue_comments_134963.json:
```json
{
    "body": "Replying to [comment:50 chapoton]:\n> Probably a stupid question from a complete outsider, but how is this related to the content of\n> \n> src/sage/schemes/elliptic_curves/heegner.py ?\n> \n> In other, do we have Chow-Heegner point = Heegner point ?\n\nNo. Chow-Heegner points are higher-dimnsional analogues of \"classical\" Heegner points.  Both are constructions of rational or algebraic points on elliptic curves over Q as images of algebraic points on some other object; in the usual Heegner setting these are points on the modular curve, while in the Chow-Heegner case they are points on higher Chow groups.  I am not an expert, but William is (or used to be!).",
    "created_at": "2021-06-10T16:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134963",
    "user": "cremona"
}
```

Replying to [comment:50 chapoton]:
> Probably a stupid question from a complete outsider, but how is this related to the content of
> 
> src/sage/schemes/elliptic_curves/heegner.py ?
> 
> In other, do we have Chow-Heegner point = Heegner point ?

No. Chow-Heegner points are higher-dimnsional analogues of "classical" Heegner points.  Both are constructions of rational or algebraic points on elliptic curves over Q as images of algebraic points on some other object; in the usual Heegner setting these are points on the modular curve, while in the Chow-Heegner case they are points on higher Chow groups.  I am not an expert, but William is (or used to be!).



---

archive/issue_comments_134964.json:
```json
{
    "body": "> but William is (or used to be!).\n\nHeh!  Indeed, I haven't thought about these in 5 years.   John's right about the difference; the paper I wrote linked to at the top of this ticket describes the Chow-Heegner construction for elliptic curves.  It's completely different than the classical Heegner points in heegner.py.  There's also a chapter in Hao Chen's thesis about the same thing, with some further provable error bounds and a theorem: https://digital.lib.washington.edu/researchworks/handle/1773/36754",
    "created_at": "2021-06-10T17:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134964",
    "user": "was"
}
```

> but William is (or used to be!).

Heh!  Indeed, I haven't thought about these in 5 years.   John's right about the difference; the paper I wrote linked to at the top of this ticket describes the Chow-Heegner construction for elliptic curves.  It's completely different than the classical Heegner points in heegner.py.  There's also a chapter in Hao Chen's thesis about the same thing, with some further provable error bounds and a theorem: https://digital.lib.washington.edu/researchworks/handle/1773/36754



---

archive/issue_comments_134965.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11803#issuecomment-134965",
    "user": "mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.
