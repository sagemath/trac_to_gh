# Issue 13438: Modular exponentiation of polynomials

archive/issues_013438.json:
```json
{
    "body": "Assignee: @aghitza\n\nKeywords: modular exponentiation, polynomials\n\nA faster implementation of modular exponentiation of polynomials.\n\nThis implementation is used to improve speed in factorisation of skew polynomials (see ticket #13215).\n\nIssue created by migration from https://trac.sagemath.org/ticket/13642\n\n",
    "created_at": "2012-10-22T14:18:40Z",
    "labels": [
        "algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Modular exponentiation of polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13438",
    "user": "@xcaruso"
}
```
Assignee: @aghitza

Keywords: modular exponentiation, polynomials

A faster implementation of modular exponentiation of polynomials.

This implementation is used to improve speed in factorisation of skew polynomials (see ticket #13215).

Issue created by migration from https://trac.sagemath.org/ticket/13642





---

archive/issue_comments_165679.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-10-22T14:19:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165679",
    "user": "@xcaruso"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_165680.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-01-26T07:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165680",
    "user": "@burcin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_165681.json:
```json
{
    "body": "Thanks for the patch. There are some minor issues, so I'm switching to needs_work. Here is a short review:\n\n* The patch lacks doctests or a commit message.\n\n* The call to `_pow_modulus` should be of the form `self._pow_modulus(right, modulus)` instead of `Polynomial._pow_modulus(self, right, modulus)`. If Cython does not recognize that `self` is a `Polynomial`, you can declare that in the function definition, e.g. use `def __pow__(Polynomial self, right, modulus)`.\n\n* To extract maximum performance, I suggest replacing calls to `self.parent()` by direct attribute access (`self._parent`) and declaring the type of the `n` in the `_pow_modulus()` function to be an `int`, and `pow` to be `Polynomial`.",
    "created_at": "2013-01-26T07:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165681",
    "user": "@burcin"
}
```

Thanks for the patch. There are some minor issues, so I'm switching to needs_work. Here is a short review:

* The patch lacks doctests or a commit message.

* The call to `_pow_modulus` should be of the form `self._pow_modulus(right, modulus)` instead of `Polynomial._pow_modulus(self, right, modulus)`. If Cython does not recognize that `self` is a `Polynomial`, you can declare that in the function definition, e.g. use `def __pow__(Polynomial self, right, modulus)`.

* To extract maximum performance, I suggest replacing calls to `self.parent()` by direct attribute access (`self._parent`) and declaring the type of the `n` in the `_pow_modulus()` function to be an `int`, and `pow` to be `Polynomial`.



---

archive/issue_comments_165682.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-01-27T21:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165682",
    "user": "@xcaruso"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_165683.json:
```json
{
    "body": "Thanks for you review. I've updated my patch.\n\n- I added doctesta dn a commit message\n\n- I replaced `Polynomial._pow_modulus(self, right, modulus)` by `self._pow_modulus(right, modulus)`\n\n- It seems that I can't use `self._parent`\u00a0in a def function and I don't want to assume that `n` fits in a `int` (e.g. for applications to skew polynomials where I need this function for very large `n`). I declared the variables `pow` and `r`.",
    "created_at": "2013-01-27T21:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165683",
    "user": "@xcaruso"
}
```

Thanks for you review. I've updated my patch.

- I added doctesta dn a commit message

- I replaced `Polynomial._pow_modulus(self, right, modulus)` by `self._pow_modulus(right, modulus)`

- It seems that I can't use `self._parent`Â in a def function and I don't want to assume that `n` fits in a `int` (e.g. for applications to skew polynomials where I need this function for very large `n`). I declared the variables `pow` and `r`.



---

archive/issue_comments_165684.json:
```json
{
    "body": "Some remarks (maybe useless, I am no Cython expert)\n\nMaybe you could declare modulus to be a Polynomial ?\n\nMaybe you could declare right to be an Integer (instead of an int) ?\n\nCan you post here some timings to show how much this improves things ?",
    "created_at": "2013-04-04T10:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165684",
    "user": "@fchapoton"
}
```

Some remarks (maybe useless, I am no Cython expert)

Maybe you could declare modulus to be a Polynomial ?

Maybe you could declare right to be an Integer (instead of an int) ?

Can you post here some timings to show how much this improves things ?



---

archive/issue_comments_165685.json:
```json
{
    "body": "I declared right to be an Integer but not modulus to be a Polynomial because I guess that it could be also an Integer (or even something else).\n\nHere are timings you are asking for:\n\n\n```\nsage: k = GF(5)\nsage: l = k.extension(x^2 + 2)\nsage: R.<x> = l[]\nsage: f = R.random_element(5)\nsage: h = R.random_element(5)\n\n# Without the patch\nsage: timeit(\"g=pow(f,50,h)\")\n5 loops, best of 3: 2.43 s per loop\n\n# With the patch\nsage: timeit(\"g=pow(f,50,h)\")\n5 loops, best of 3: 68.8 ms per loop\nsage: timeit(\"g=pow(f,10000000,h)\")\n5 loops, best of 3: 276 ms per loop\n```\n",
    "created_at": "2013-06-26T10:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165685",
    "user": "@xcaruso"
}
```

I declared right to be an Integer but not modulus to be a Polynomial because I guess that it could be also an Integer (or even something else).

Here are timings you are asking for:


```
sage: k = GF(5)
sage: l = k.extension(x^2 + 2)
sage: R.<x> = l[]
sage: f = R.random_element(5)
sage: h = R.random_element(5)

# Without the patch
sage: timeit("g=pow(f,50,h)")
5 loops, best of 3: 2.43 s per loop

# With the patch
sage: timeit("g=pow(f,50,h)")
5 loops, best of 3: 68.8 ms per loop
sage: timeit("g=pow(f,10000000,h)")
5 loops, best of 3: 276 ms per loop
```




---

archive/issue_comments_165686.json:
```json
{
    "body": "Attachment [trac_13642_modular_exp_polynomial.patch](tarball://root/attachments/some-uuid/ticket13642/trac_13642_modular_exp_polynomial.patch) by @xcaruso created at 2013-06-26 10:14:11",
    "created_at": "2013-06-26T10:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165686",
    "user": "@xcaruso"
}
```

Attachment [trac_13642_modular_exp_polynomial.patch](tarball://root/attachments/some-uuid/ticket13642/trac_13642_modular_exp_polynomial.patch) by @xcaruso created at 2013-06-26 10:14:11



---

archive/issue_comments_165687.json:
```json
{
    "body": "There are doctests failing in `sage/rings/polynomial/polynomial_element.pyx`.\n\nIt seems that the `_pow_modulus()` function is duplicating code from `sage.rings.arith.power_mod`. Isn't there a way to use that function? Does the speed increase justify copying the code here? If we are going to copy it, shouldn't we put it higher in the class hierarchy?",
    "created_at": "2013-07-01T00:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165687",
    "user": "@burcin"
}
```

There are doctests failing in `sage/rings/polynomial/polynomial_element.pyx`.

It seems that the `_pow_modulus()` function is duplicating code from `sage.rings.arith.power_mod`. Isn't there a way to use that function? Does the speed increase justify copying the code here? If we are going to copy it, shouldn't we put it higher in the class hierarchy?



---

archive/issue_comments_165688.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-07-01T00:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165688",
    "user": "@burcin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_165689.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-07-06T11:47:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165689",
    "user": "@xcaruso"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_165690.json:
```json
{
    "body": "Actually, I did not know the function `power_mod` (I duplicated and adapted the code from `sage.rings.polynomial.polynomial_element.__pow__`). I attach a new patch where I just call `power_mod` instead of `_pow_modulus`. Timings are comparable. I don't know if it's better this way. I let you judge.",
    "created_at": "2013-07-06T11:47:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165690",
    "user": "@xcaruso"
}
```

Actually, I did not know the function `power_mod` (I duplicated and adapted the code from `sage.rings.polynomial.polynomial_element.__pow__`). I attach a new patch where I just call `power_mod` instead of `_pow_modulus`. Timings are comparable. I don't know if it's better this way. I let you judge.



---

archive/issue_comments_165691.json:
```json
{
    "body": "Attachment [trac_13642_modular_exp_polynomial-2.patch](tarball://root/attachments/some-uuid/ticket13642/trac_13642_modular_exp_polynomial-2.patch) by @jdemeyer created at 2013-08-13 15:35:53",
    "created_at": "2013-08-13T15:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165691",
    "user": "@jdemeyer"
}
```

Attachment [trac_13642_modular_exp_polynomial-2.patch](tarball://root/attachments/some-uuid/ticket13642/trac_13642_modular_exp_polynomial-2.patch) by @jdemeyer created at 2013-08-13 15:35:53



---

archive/issue_comments_165692.json:
```json
{
    "body": "patchbot:\n\napply trac_13642_modular_exp_polynomial-2.patch",
    "created_at": "2013-09-12T13:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165692",
    "user": "@darijgr"
}
```

patchbot:

apply trac_13642_modular_exp_polynomial-2.patch



---

archive/issue_comments_165693.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-10-27T16:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165693",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_165694.json:
```json
{
    "body": "some doctests are failing, see **patchbot** report",
    "created_at": "2013-10-27T16:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165694",
    "user": "@fchapoton"
}
```

some doctests are failing, see **patchbot** report



---

archive/issue_comments_165695.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-02-02T07:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165695",
    "user": "@tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_165696.json:
```json
{
    "body": "git version where I marked the new tests as \"not tested\" which is now #15777. I believe we should merge this in and not make it depend on #15777.\n----\nNew commits:",
    "created_at": "2014-02-02T07:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165696",
    "user": "@tscrim"
}
```

git version where I marked the new tests as "not tested" which is now #15777. I believe we should merge this in and not make it depend on #15777.
----
New commits:



---

archive/issue_comments_165697.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-02-26T19:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165697",
    "user": "jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_165698.json:
```json
{
    "body": "Let's get this merged.\n\nAbout the previously failing doctests: they were already failing before this ticket; therefore I agree with the decision to fix them in #15777.",
    "created_at": "2014-02-26T19:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165698",
    "user": "jpflori"
}
```

Let's get this merged.

About the previously failing doctests: they were already failing before this ticket; therefore I agree with the decision to fix them in #15777.



---

archive/issue_comments_165699.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-03-01T08:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13438#issuecomment-165699",
    "user": "@vbraun"
}
```

Resolution: fixed
