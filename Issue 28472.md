# Issue 28472: Python executable in doctest/control.py

Issue created by migration from https://trac.sagemath.org/ticket/28709

Original creator: jhpalmieri

Original creation time: 2019-11-08 18:37:59

CC:  fbissey

We don't need to specify the Python executable as `sage-python` in `doctest/control.py`, and it's better for distros and in general to not do so.

This is a followup to #28657.



---

Comment by jhpalmieri created at 2019-11-08 18:39:33

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2019-11-08 18:39:33

New commits:


---

Comment by fbissey created at 2019-11-08 18:52:30

I was intending to do that. Nevermind, I am happy you think the idea is worthwhile.


---

Comment by jhpalmieri created at 2019-11-08 18:59:41

It would be good to test this on a machine with no `python` executable. I have a virtual machine for which I get failures in `calculus/riemann.pyx` with or without this branch: without this branch, I get numerical noise (which I always get with this virtual machine setup), and with this branch I get a segmentation fault instead. So it would be good to test on a more reliable machine.


---

Comment by fbissey created at 2019-11-08 19:02:59

That's curious to say the least. I thought you needed a system python to start the sage build from scratch?

Also can you share the segfault? There may be interesting clues in there.


---

Comment by jhpalmieri created at 2019-11-08 20:19:07

Replying to [comment:6 fbissey]:
> That's curious to say the least. I thought you needed a system python to start the sage build from scratch?

Not with #28657. (There is a `python3` but no `python`.)
 
> Also can you share the segfault? There may be interesting clues in there.

It's curious. If I do `./sage -t src/sage/calculus/riemann.pyx > TEST.log`, there is no segfault, but if I don't redirect output, there is. It looks like this:

```
sage -t --warn-long 55.3 src/sage/calculus/riemann.pyx
    Killed due to segmentation fault
**********************************************************************
Tests run before process (pid=2038) failed:
sage: f(t) = e^(I*t) ## line 135 ##
sage: fprime(t) = I*e^(I*t) ## line 136 ##
sage: f(t) = e^(I*t) ## line 150 ##
sage: fprime(t) = I*e^(I*t) ## line 151 ##
sage: hf(t) = 0.5*e^(-I*t) ## line 152 ##
sage: hfprime(t) = 0.5*-I*e^(-I*t) ## line 153 ##
sage: m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I) ## line 154 ##
------------------------------------------------------------------------
/home/john/Sage/sage-9.0.beta4/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x9a64)[0x7f914669ba64]
/home/john/Sage/sage-9.0.beta4/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0x9b19)[0x7f914669bb19]
/home/john/Sage/sage-9.0.beta4/local/lib/python3.7/site-packages/cysignals/signals.cpython-37m-x86_64-linux-gnu.so(+0xd57f)[0x7f914669f57f]
/lib/x86_64-linux-gnu/libc.so.6(+0x46470)[0x7f9147bf2470]
/home/john/Sage/sage-9.0.beta4/local/lib/libopenblas.so.0(zgemm_kernel_n+0x5467)[0x7f9144493467]
------------------------------------------------------------------------
Attaching gdb to process id 2038.
...
[snip]
...
Saved trace to /home/john/.sage/crash_logs/crash_ybgn81ga.log
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
```

I'm attaching `/home/john/.sage/crash_logs/crash_ybgn81ga.log`.


---

Attachment


---

Comment by fbissey created at 2019-11-11 08:15:35

Needs rebasing with 9.0.beta5. Just when I was ready to test :(


---

Comment by fbissey created at 2019-11-11 08:18:58

The segfaulting behavior is most curious. From what you say it sounds like some memory context may be at play. Much more complex than just this ticket.


---

Comment by git created at 2019-11-11 17:41:00

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jhpalmieri created at 2019-11-11 17:41:32

Okay, rebased.


---

Comment by jhpalmieri created at 2019-11-11 20:44:58

Replying to [comment:9 fbissey]:
> The segfaulting behavior is most curious. From what you say it sounds like some memory context may be at play. Much more complex than just this ticket.

By the way, on a virtual machine on a different computer, I don't see the segfault, just the usual numerical noise failures.


---

Comment by fbissey created at 2019-11-12 01:05:10

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2019-11-12 01:05:10

Basic testing with python2 and python3 OK. I believe the segfault mentioned here is unrelated and may deserve wider scrutiny on sage-devel because it is definitely on the weirder side of things.


---

Comment by jhpalmieri created at 2019-11-12 01:37:33

I agree it's weird, but since it's on a virtual machine that's a little flaky already, I don't know how seriously to take it.


---

Comment by vbraun created at 2019-11-16 20:15:38

Resolution: fixed
