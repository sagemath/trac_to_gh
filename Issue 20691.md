# Issue 20691: eclib fails to build with gcc6 / c++11

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2016-07-03 11:14:54

CC:  cremona

Keywords: gcc6 c++11

Errors start with 

```
libtool: compile:  g++ -DPACKAGE_NAME=\"eclib\" -DPACKAGE_TARNAME=\"eclib\" -DPACKAGE_VERSION=\"20150827\" "-DPACKAGE_STRING=\"eclib 20150827\"" -DPACKAGE_BUGREPORT=\"john.cremona`@`gmail.com\" -DPACKAGE_URL=\"\" -DPACKAGE=\"eclib\" -DVERSION=\"20150827\" -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\".libs/\" -DHAVE_STDCXX_0X=1 -DHAVE_TR1_UNORDERED_MAP=1 -DHAVE_STDCXX_0X=1 -DHAVE_UNORDERED_MAP=1 -DHAVE_ALLOCA_H=1 -DHAVE_ALLOCA=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_UNISTD_H=1 -DHAVE__BOOL=1 -DHAVE_STDBOOL_H=1 -Drestrict=__restrict -DHAVE_MEMMOVE=1 -DHAVE_MEMSET=1 -DHAVE_STRCHR=1 -I. -DFLINT_LEVEL=1 -I/home/vbraun/Code/sage/local/include -I/home/vbraun/Code/sage/local/include -I/home/vbraun/Code/sage/local/include -DNTL_ALL -DUSE_PARI_FACTORING -DNEW_OP_ORDER -g -O3 -MT timer.lo -MD -MP -MF .deps/timer.Tpo -c timer.cc  -fPIC -DPIC -o .libs/timer.o
timer.cc: In destructor 'timer::~timer()':
timer.cc:77:13: error: no match for 'operator!=' (operand types are 'std::ofstream {aka std::basic_ofstream<char>}' and 'long int')
   if( file_ != NULL ) {
              
timer.cc:77:13: note: candidate: operator!=(int, long int) <built-in>
timer.cc:77:13: note:   no known conversion for argument 1 from 'std::ofstream {aka std::basic_ofstream<char>}' to 'int'
In file included from ../../../../../../../include/NTL/ZZ.h:20:0,
                 from ./eclib/interface.h:70,
                 from timer.cc:27:
../../../../../../../include/NTL/vector.h:778:6: note: candidate: template<class T> long int NTL::operator!=(const NTL::Vec<T>&, const NTL::Vec<T>&)
 long operator!=(const Vec<T>& a, const Vec<T>& b)
      ^~~~~~~~
../../../../../../../include/NTL/vector.h:778:6: note:   template argument deduction/substitution failed:
timer.cc:77:15: note:   'std::ofstream {aka std::basic_ofstream<char>}' is not derived from 'const NTL::Vec<T>'
   if( file_ != NULL ) {
               ^~~~~~
In file included from ../../../../../../../include/NTL/ZZ.h:21:0,
                 from ./eclib/interface.h:70,
                 from timer.cc:27:
../../../../../../../include/NTL/SmartPtr.h:308:6: note: candidate: template<class X, class Y> bool NTL::operator!=(const NTL::SmartPtr<T>&, const NTL::SmartPtr<Y>&)
 bool operator!=(const SmartPtr<X>& a, const SmartPtr<Y>& b)
      ^~~~~~~~
```



---

Comment by vbraun created at 2016-07-03 11:17:50

Workaround at #20926


---

Comment by vbraun created at 2016-07-03 17:38:06

From https://gcc.gnu.org/gcc-6/porting_to.html 

```
Cannot convert 'std::ostream' to 'bool'

As of C++11, iostream classes are no longer implicitly convertible to void* so it is no longer valid to do something like:


  bool valid(std::ostream& os) { return os; }
Such code must be changed to convert the iostream object to bool explicitly, e.g. return (bool)os; or return static_cast<bool>(os);
```



---

Comment by aapitzsch created at 2016-07-19 18:29:16

Upgrading eclib to it's latest [release (v20160206)](https://github.com/JohnCremona/eclib/releases) should fix the issue.


---

Comment by fbissey created at 2016-07-20 08:27:53

OK, it looks like the upgrade won't require any change sage side so it should be easy.


---

Comment by fbissey created at 2016-07-20 09:15:06

There will be a delay https://github.com/JohnCremona/eclib/issues/15 version 20160206 has a minor defect when creating tarballs, it think it is version 20160101...


---

Comment by cremona created at 2016-07-20 11:11:55

Apologies for not doing eclib releases very consistently, hopefully we can sort this out today.


---

Comment by cremona created at 2016-07-20 11:54:46

There is now a new eclib release v20160720 which should keep everyone happy for a while.


---

Comment by fbissey created at 2016-07-21 11:11:31

Changing status from new to needs_review.


---

Comment by fbissey created at 2016-07-21 11:11:31

And now with a tarball in the description and a branch for the upgrade.
----
New commits:


---

Comment by aapitzsch created at 2016-07-23 22:15:13

Changing status from needs_review to needs_work.


---

Comment by aapitzsch created at 2016-07-23 22:15:13

Remove the related workaround flags added in #20926.


---

Comment by git created at 2016-07-24 04:19:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2016-07-24 04:21:05

Yes, I missed it. Thank you for pointing it out. Back to need review.


---

Comment by fbissey created at 2016-07-24 04:21:05

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2016-07-24 09:07:17

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-07-24 20:44:50

Resolution: fixed
