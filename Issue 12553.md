# Issue 12553: termcap: copy libtermcap.a to libncurses.a

archive/issues_012553.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  jpflori\n\nThe install scripts for PARI and Python automatically link with `-lncurses` if `/usr/lib/libncurses.so` **exists**, even though the mere existence of that file doesn't guarantee that it actually can be linked.  This can happen in particular when \"cross-compiling\" a 32-bit Sage on a 64-bit operating system.\n\nThe build of the readline interface of PARI and Python might therefore fail for no good reason.  A solution is to copy Sage's `libtermcap.a` to `libncurses.a`, such that `-lncurses` will always succeed.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12725\n\n",
    "created_at": "2012-03-22T09:45:57Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "title": "termcap: copy libtermcap.a to libncurses.a",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12553",
    "user": "jdemeyer"
}
```
Assignee: tbd

CC:  jpflori

The install scripts for PARI and Python automatically link with `-lncurses` if `/usr/lib/libncurses.so` **exists**, even though the mere existence of that file doesn't guarantee that it actually can be linked.  This can happen in particular when "cross-compiling" a 32-bit Sage on a 64-bit operating system.

The build of the readline interface of PARI and Python might therefore fail for no good reason.  A solution is to copy Sage's `libtermcap.a` to `libncurses.a`, such that `-lncurses` will always succeed.

Issue created by migration from https://trac.sagemath.org/ticket/12725





---

archive/issue_comments_149136.json:
```json
{
    "body": "The usual way to address the problem is to install the corresponding\ndevelopment package (for ncurses).  Overwriting the shared library\nwill break various programs that are linked against the existing\nlibrary.",
    "created_at": "2012-03-23T14:30:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149136",
    "user": "tdickey"
}
```

The usual way to address the problem is to install the corresponding
development package (for ncurses).  Overwriting the shared library
will break various programs that are linked against the existing
library.



---

archive/issue_comments_149137.json:
```json
{
    "body": "Replying to [comment:3 tdickey]:\n> Overwriting the shared library\n> will break various programs that are linked against the existing\n> library.\nI'm only talking about the *static* library archive (`libncurses.a`).  This cannot break existing programs.",
    "created_at": "2012-03-23T14:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149137",
    "user": "jdemeyer"
}
```

Replying to [comment:3 tdickey]:
> Overwriting the shared library
> will break various programs that are linked against the existing
> library.
I'm only talking about the *static* library archive (`libncurses.a`).  This cannot break existing programs.



---

archive/issue_comments_149138.json:
```json
{
    "body": "But that would break builds of other applications which used the static library.\nAlso, applications using the bundled termcap library would behave differently\nfrom those which use the ncurses library (unless Sage happened to update its\ntermcap source file - last I recalled it was more than ten years out of date).",
    "created_at": "2012-03-24T00:30:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149138",
    "user": "tdickey"
}
```

But that would break builds of other applications which used the static library.
Also, applications using the bundled termcap library would behave differently
from those which use the ncurses library (unless Sage happened to update its
termcap source file - last I recalled it was more than ten years out of date).



---

archive/issue_comments_149139.json:
```json
{
    "body": "Okay, a new proposal: we try to link a test program with `-lncurses` and only if that fails, we do the copying.",
    "created_at": "2012-03-24T09:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149139",
    "user": "jdemeyer"
}
```

Okay, a new proposal: we try to link a test program with `-lncurses` and only if that fails, we do the copying.



---

archive/issue_comments_149140.json:
```json
{
    "body": "That's an improvement, but if the copy happened to be put in a different location\nthan the ncurses development package, it would still be a problem.",
    "created_at": "2012-03-24T11:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149140",
    "user": "tdickey"
}
```

That's an improvement, but if the copy happened to be put in a different location
than the ncurses development package, it would still be a problem.



---

archive/issue_comments_149141.json:
```json
{
    "body": "Replying to [comment:7 tdickey]:\n> That's an improvement, but if the copy happened to be put in a different location\n> than the ncurses development package, it would still be a problem.\n??? Please explain what you mean.  The copy would be put in `$SAGE_ROOT/local/lib`.",
    "created_at": "2012-03-24T15:56:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149141",
    "user": "jdemeyer"
}
```

Replying to [comment:7 tdickey]:
> That's an improvement, but if the copy happened to be put in a different location
> than the ncurses development package, it would still be a problem.
??? Please explain what you mean.  The copy would be put in `$SAGE_ROOT/local/lib`.



---

archive/issue_comments_149142.json:
```json
{
    "body": "I see - at the end of the patch.  The discussion above did not make that clear.",
    "created_at": "2012-03-24T15:58:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149142",
    "user": "tdickey"
}
```

I see - at the end of the patch.  The discussion above did not make that clear.



---

archive/issue_comments_149143.json:
```json
{
    "body": "Diff for the termcap spkg, for review only",
    "created_at": "2012-03-28T09:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149143",
    "user": "jdemeyer"
}
```

Diff for the termcap spkg, for review only



---

archive/issue_comments_149144.json:
```json
{
    "body": "Attachment [termcap-1.3.1.p3.diff](tarball://root/attachments/some-uuid/ticket12725/termcap-1.3.1.p3.diff) by jdemeyer created at 2012-03-28 09:16:09\n\nThe new spkg is more clever: it only makes the symbolic link for `libncurses.a` if linking against `-lncurses` doesn't work.\n\nNeeds review.",
    "created_at": "2012-03-28T09:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149144",
    "user": "jdemeyer"
}
```

Attachment [termcap-1.3.1.p3.diff](tarball://root/attachments/some-uuid/ticket12725/termcap-1.3.1.p3.diff) by jdemeyer created at 2012-03-28 09:16:09

The new spkg is more clever: it only makes the symbolic link for `libncurses.a` if linking against `-lncurses` doesn't work.

Needs review.



---

archive/issue_comments_149145.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2012-03-28T09:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149145",
    "user": "jdemeyer"
}
```

Changing priority from major to minor.



---

archive/issue_comments_149146.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-03-28T09:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149146",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_149147.json:
```json
{
    "body": "`@`tdickey: could you review this spkg please?",
    "created_at": "2012-03-31T20:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149147",
    "user": "jdemeyer"
}
```

`@`tdickey: could you review this spkg please?



---

archive/issue_comments_149148.json:
```json
{
    "body": "We should get rid of the termcap spkg anyway, really.\n\nBesides that, the errors mentioned in the description should certainly get fixed (or at least reported) upstream.",
    "created_at": "2012-05-25T10:52:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149148",
    "user": "leif"
}
```

We should get rid of the termcap spkg anyway, really.

Besides that, the errors mentioned in the description should certainly get fixed (or at least reported) upstream.



---

archive/issue_comments_149149.json:
```json
{
    "body": "Replying to [comment:12 leif]:\n> Besides that, the errors mentioned in the description should certainly get fixed (or at least reported) upstream.\nI don't think upstream still exists, actually.",
    "created_at": "2012-06-25T12:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149149",
    "user": "jdemeyer"
}
```

Replying to [comment:12 leif]:
> Besides that, the errors mentioned in the description should certainly get fixed (or at least reported) upstream.
I don't think upstream still exists, actually.



---

archive/issue_comments_149150.json:
```json
{
    "body": "Replying to [comment:13 jdemeyer]:\n> Replying to [comment:12 leif]:\n> > Besides that, the errors mentioned in the description should certainly get fixed (or at least reported) upstream.\n> I don't think upstream still exists, actually.\nWhich upstream are you referring to?",
    "created_at": "2012-06-25T21:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149150",
    "user": "tdickey"
}
```

Replying to [comment:13 jdemeyer]:
> Replying to [comment:12 leif]:
> > Besides that, the errors mentioned in the description should certainly get fixed (or at least reported) upstream.
> I don't think upstream still exists, actually.
Which upstream are you referring to?



---

archive/issue_comments_149151.json:
```json
{
    "body": "Replying to [comment:11 jdemeyer]:\n> `@`tdickey: could you review this spkg please?\nGenerically ok (given the explanation that it would only be used in a build-tree, not updating the system area).\n\nHowever, 1.3.1.p3 is dated, and its termcap.src file is a nuisance due to the large number of differences versus ncurses.  I've noticed that Redhat's equivalent package for termcap uses the termcap.src file which I generate from ncurses.  See http://invisible-island.net/datafiles/current/termcap.src.gz for comparison.",
    "created_at": "2012-06-25T21:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149151",
    "user": "tdickey"
}
```

Replying to [comment:11 jdemeyer]:
> `@`tdickey: could you review this spkg please?
Generically ok (given the explanation that it would only be used in a build-tree, not updating the system area).

However, 1.3.1.p3 is dated, and its termcap.src file is a nuisance due to the large number of differences versus ncurses.  I've noticed that Redhat's equivalent package for termcap uses the termcap.src file which I generate from ncurses.  See http://invisible-island.net/datafiles/current/termcap.src.gz for comparison.



---

archive/issue_comments_149152.json:
```json
{
    "body": "Replying to [comment:17 tdickey]:\n> Replying to [comment:11 jdemeyer]:\n> > `@`tdickey: could you review this spkg please?\n> Generically ok (given the explanation that it would only be used in a build-tree, not updating the system area).\n> \n> However, 1.3.1.p3 is dated, and its termcap.src file is a nuisance due to the large number of differences versus ncurses.\nPerhaps, but that's not the subject of this ticket.",
    "created_at": "2012-06-26T06:40:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149152",
    "user": "jdemeyer"
}
```

Replying to [comment:17 tdickey]:
> Replying to [comment:11 jdemeyer]:
> > `@`tdickey: could you review this spkg please?
> Generically ok (given the explanation that it would only be used in a build-tree, not updating the system area).
> 
> However, 1.3.1.p3 is dated, and its termcap.src file is a nuisance due to the large number of differences versus ncurses.
Perhaps, but that's not the subject of this ticket.



---

archive/issue_comments_149153.json:
```json
{
    "body": "Wouldn't a proper solution be to fix Pyton rather than hacking around?",
    "created_at": "2013-01-29T22:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149153",
    "user": "jpflori"
}
```

Wouldn't a proper solution be to fix Pyton rather than hacking around?



---

archive/issue_comments_149154.json:
```json
{
    "body": "Replying to [comment:19 jpflori]:\n> Wouldn't a proper solution be to fix Pyton rather than hacking around?\nSure, but that's not a realistic solution I'm afraid.  It would require some redesign of the Python build system.",
    "created_at": "2013-01-29T22:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149154",
    "user": "jdemeyer"
}
```

Replying to [comment:19 jpflori]:
> Wouldn't a proper solution be to fix Pyton rather than hacking around?
Sure, but that's not a realistic solution I'm afraid.  It would require some redesign of the Python build system.



---

archive/issue_comments_149155.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-30T15:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149155",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_149156.json:
```json
{
    "body": "ugly workaround, but then it should never happen on a sensible install...",
    "created_at": "2013-01-30T15:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149156",
    "user": "vbraun"
}
```

ugly workaround, but then it should never happen on a sensible install...



---

archive/issue_comments_149157.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-02-05T08:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149157",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_149158.json:
```json
{
    "body": "This breaks readline in Python, see #14405 for details.",
    "created_at": "2013-04-03T11:36:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12553",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12553#issuecomment-149158",
    "user": "vbraun"
}
```

This breaks readline in Python, see #14405 for details.
