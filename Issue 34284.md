# Issue 34284: Bernoulli(1) = +1/2

Issue created by migration from https://trac.sagemath.org/ticket/34521

Original creator: @Parcly-Taxel

Original creation time: 2022-09-11 21:18:15

CC:  fredrik.johansson @davidayotte pluschny edgarcosta asmeurer

Keywords: bernoulli numbers

Peter Luschny's Bernoulli Manifesto (http://luschny.de/math/zeta/The-Bernoulli-Manifesto.html) makes a very convincing argument that `bernoulli(1)` should be `+1/2`, not `-1/2`. Knuth's books now use `+1/2`, SymPy now uses `+1/2` (and I made the PRs implementing that, see https://github.com/sympy/sympy/pull/23926), and so this ticket sets `bernoulli(1) = +1/2` here too.

Well not quite; this ticket merely _deprecates_ `bernoulli(1) = -1/2` by providing a flag enforcing `+1/2` behaviour by default. The intention is to make the default behaviour permanent later on, so as to give time for end-users to update their code.

This is a continuation of the sage-devel thread at https://groups.google.com/g/sage-devel/c/G4sbKoibXK4.


---

Comment by @DavidAyotte created at 2022-09-12 01:38:54

What I think would be a good way to go in this ticket would be to follow the [one year deprecation policy](https://doc.sagemath.org/html/en/developer/coding_in_python.html#deprecation) of Sage. Therefore, the default value of the parameter `plus` would be `False` so that `Bernoulli(1)` still returns `-1/2`, but this option would return a warning message saying that this default value will change to `True` in a subsequent release of [SageMath](SageMath). This will give time to the user to adapt their code accordingly.

Also, if `plus=False` I would make the code return `Bernoulli(1)=-1/2` (instead of letting the algorithm decides). In my opinion, this would give the user the choice of its prefered value and avoid some possible confusions.

Here's a list of all the files with failed doctests:


```
sage -t --random-seed=261341029976424338880876638067744409976 doc/en/thematic_tutorials/explicit_methods_in_number_theory/generators_for_rings.rst  # 1 doctest failed
sage -t --random-seed=261341029976424338880876638067744409976 sage/combinat/q_bernoulli.pyx  # 1 doctest failed
sage -t --random-seed=261341029976424338880876638067744409976 sage/modular/dirichlet.py  # 3 doctests failed
sage -t --random-seed=261341029976424338880876638067744409976 sage/modular/modform/ambient.py  # 1 doctest failed
sage -t --random-seed=261341029976424338880876638067744409976 sage/modular/modform/constructor.py  # 1 doctest failed
sage -t --random-seed=261341029976424338880876638067744409976 sage/modular/modform/ambient_g1.py  # 1 doctest failed
sage -t --random-seed=261341029976424338880876638067744409976 sage/modular/modform/eisenstein_submodule.py  # 4 doctests failed
sage -t --random-seed=261341029976424338880876638067744409976 sage/modular/modform/element.py  # 11 doctests failed
sage -t --random-seed=261341029976424338880876638067744409976 sage/modular/modform/ring.py  # 3 doctests failed
sage -t --random-seed=261341029976424338880876638067744409976 sage/modular/overconvergent/genus0.py  # 28 doctests failed
sage -t --random-seed=261341029976424338880876638067744409976 sage/modular/overconvergent/weightspace.py  # 5 doctests failed
sage -t --random-seed=261341029976424338880876638067744409976 sage/modular/quasimodform/element.py  # 1 doctest failed
sage -t --random-seed=261341029976424338880876638067744409976 sage/modular/quasimodform/ring.py  # 1 doctest failed
sage -t --random-seed=261341029976424338880876638067744409976 sage/rings/bernmm.pyx  # 1 doctest failed
sage -t --random-seed=261341029976424338880876638067744409976 sage/tests/book_stein_modform.py  # 1 doctest failed
```



---

Comment by git created at 2022-09-12 02:41:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2022-09-12 06:43:25

**NO**.

We are not going to change this convention, which is the standard one. Live with it.


---

Comment by git created at 2022-09-12 07:59:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Parcly-Taxel created at 2022-09-12 08:00:14

How can you say `B_1 = -1/2` is standard when Knuth uses `B_1 = +1/2`?

How can you say `B_1 = -1/2` is even a "convention" when Luschny has analysed the historical development of the Bernoulli numbers and found that Bernoulli himself and virtually all mathematicians before the 20th century used `B_1 = +1/2`?

Have you read the manifesto? Luschny's argument has two main thrusts: the historical side as above, and the simplification of many formulae with `B_1 = +1/2`, including Euler–Maclaurin. He eventually finds that the Hasse–Worpitzky representation of the generalised Bernoulli function frees the numbers from all conventions – `B_1 = +1/2` is not another convention, it is the only logical value.


---

Comment by chapoton created at 2022-09-12 08:10:24

Mr Luschny has not published any mathematical article. We have more serious things to do, so I will now close this ticket.


---

Comment by chapoton created at 2022-09-12 08:10:24

Resolution: invalid


---

Comment by @Parcly-Taxel created at 2022-09-12 08:12:41

Set assignee to @Parcly-Taxel.


---

Comment by dimpase created at 2022-09-12 13:44:52

Replying to [comment:9 Frédéric Chapoton]:
> Mr Luschny has not published any mathematical article. We have more serious things to do, so I will now close this ticket.

Frederic, really? Knuth (does this name rings a bell :-)), mentioned in the ticket description, has published maths articles, and books, and if he uses +1/2 then this should have a merit.

And there was a tentative agreement on sage-devel that this change can go forward.


---

Comment by dimpase created at 2022-09-12 13:44:52

Changing assignee from @Parcly-Taxel to dimpase.


---

Comment by dimpase created at 2022-09-12 13:45:57

Don't create extra work for other people by closing tickets without a review.


---

Comment by @DavidAyotte created at 2022-09-12 14:26:11

Hello Frédéric, you clearly did not read the thread on [sage-devel](https://groups.google.com/g/sage-devel/c/G4sbKoibXK4/m/nruZdm9xBwAJ). I **strongly** think that something should be done about this in someway because FLINT is the default system for computing small Bernoulli numbers, otherwise we are just waiting for many bugs to appear once this system gets updated (see comment:3).

I'm sorry Jeremy that you had to undergo this authoritarian outcome.


---

Comment by was created at 2022-09-12 18:57:33

I'm re-opening this.  I have no opinion on which definition we settle on (having not read the cited paper), and according to the test suite this change mainly impacts code that I wrote.    That said, I am definitely OK with making the change following the 1-year deprecation policy, in order to avoid breaking code out there in the wild that depends on this.


---

Comment by was created at 2022-09-12 18:57:33

Changing status from closed to new.


---

Comment by was created at 2022-09-12 18:57:33

Resolution changed from invalid to 


---

Comment by edgarcosta created at 2022-09-13 02:14:58

Replying to [comment:11 Dima Pasechnik]:
> And there was a tentative agreement on sage-devel that this change can go forward.

I don't think so. Most people said if to be done, would need to be done with 1 year deprecation warning.
Apart from the OP, I don't think anyone is excited about this change. Including me.

Replying to [comment:13 David Ayotte]:
> I **strongly** think that something should be done about this in someway because FLINT is the default system for computing small Bernoulli numbers, otherwise we are just waiting for many bugs to appear once this system gets updated (see comment:3).

Why do you think the PR will be merged?


---

Comment by @DavidAyotte created at 2022-09-13 02:17:48

Replying to [comment:15 Edgar Costa]:
> Why do you think the PR will be merged?

Someone indeed pointed this out on sage-devel. This is a mistake from my part as I thougth that is was already closed. Sorry! It can indeed never be merged...


---

Comment by was created at 2022-09-13 02:35:23

>  Apart from the OP, I don't think anyone is excited about this change. 

I personally am.  And, I think all code in Sage that is broken by this is code that I wrote, so I'm not just a completely random opinion.   I also like that it fixes that annoying special cases regarding generalized Bernoulli numbers.  I also find Knuth's opinion compelling.


---

Comment by was created at 2022-09-13 02:40:44

>  It can indeed never be merged...

It might or might not be merged.  We have a voting policy for contentious changes to Sage, which we carefully thought through and designed many years ago.  The weird thing is that I would link to the policy, but I just did some google searches and can't even find it!


---

Comment by @dimpase created at 2022-09-15 13:09:59

I added a link to Knuth's take on it, e.g. https://www-cs-faculty.stanford.edu/~knuth/gkp34.pdf (replacement pages for CM), see also https://www-cs-faculty.stanford.edu/~knuth/news22.html


---

Comment by @DavidAyotte created at 2022-09-16 00:22:14

Hello Jeremy, thank you for working on this ticket and fixing the failing doctests.

A small suggestion:

```diff
+    - ``plus`` (Boolean) - ``bernoulli(1)`` gives `1/2` if this is ``True`` and `-1/2` otherwise
-    - ``plus`` - bernoulli(1) gives +1/2 if this is True and -1/2 otherwise
```

Also, I think that a more descriptive depreciation message could be useful for the user:

```diff
         else:
+            deprecation(34521, ("bernoulli(1) will return +1/2 by default in" +
+            "the future. In order to keep the original behavior, please set" +
+            "the option ``plus`` to ``False`` (bernoulli(n, plus=False))"))
-            deprecation(34521, "bernoulli(1) will always return +1/2 in the future")
```

(or something else)

I still support this change and I don't understand the convention argument against it.


---

Comment by git created at 2022-09-16 00:49:33

Branch pushed to git repo; I updated commit sha1. New commits:
