# Issue 26404: Repackage sagenb

Issue created by migration from https://trac.sagemath.org/ticket/26641

Original creator: jdemeyer

Original creation time: 2018-11-05 12:45:14

CC:  fbissey jhpalmieri dimpase

Since a while, sagenb is not supposed to contain a bundled mathjax. In particular, the [github repo](https://github.com/sagemath/sagenb) of sagenb does not contain mathjax.

Mysteriously, the sagenb packaged in #26499 *does* contain mathjax, but it's not at all clear where this comes from.


---

Comment by dimpase created at 2018-11-05 13:04:41

Please fix this in sagenb repo.


---

Comment by jdemeyer created at 2018-11-05 13:06:26

Replying to [comment:1 dimpase]:
> Please fix this in sagenb repo.

The problem is not in the sagenb repo, it's in the *packaging* of the sagenb repo. So in order to make sure that this doesn't happen again, it would be good to know how you created the sagenb package on #26499.

I will release sagenb-1.1.1 from essentially the same sources as 1.1.0, packaged from a clean checkout of the sagenb repo, using the `dist.sh` script.


---

Comment by dimpase created at 2018-11-05 13:08:11

Sagenb's [GitHub](GitHub) repo contains a script to build the release. please fix it so that it doesn't do what you find wrong.


---

Comment by jdemeyer created at 2018-11-05 13:18:47

Replying to [comment:3 dimpase]:
> Sagenb's [GitHub](GitHub) repo contains a script to build the release. please fix it so that it doesn't do what you find wrong.

That's hard to say since I don't know the exact steps to reproduce the bad sources at #26499. But I'll try: https://github.com/sagemath/sagenb/pull/462


---

Comment by jdemeyer created at 2018-11-05 13:32:23

Replying to [comment:4 jdemeyer]:
> That's hard to say since I don't know the exact steps to reproduce the bad sources at #26499.

Do you still have the sagenb checkout that you used for #26499? If so, could you run `git status` and `git clean -n -x -d` there and show the output?


---

Comment by dimpase created at 2018-11-05 14:09:38

No, I don't have a directory I packaged 1.1.0 in, anymore.

Can't one add an appropriate call to `git clean` to `./dist.sh` to avoid such a mess in the future? 

------------

Where is the new tarball?
----
New commits:


---

Comment by jdemeyer created at 2018-11-05 14:11:35

Replying to [comment:7 dimpase]:
> No, I don't have a directory I packaged 1.1.0 in, anymore.
> 
> Can't one add an appropriate call to `git clean` to `./dist.sh` to avoid such a mess in the future?

Yes, that is what I did in https://github.com/sagemath/sagenb/pull/462


---

Comment by git created at 2018-11-05 14:17:01

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-11-05 14:18:56

This seems to be working now, but I'll wait on feedback about ​https://github.com/sagemath/sagenb/pull/462 before creating the final tarball.


---

Comment by git created at 2018-11-05 15:58:13

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-11-05 16:04:25

Changing status from new to needs_review.


---

Comment by dimpase created at 2018-11-05 16:09:24

How does one deal with mathjax after this?
Have you tested it works with sagenb and Jupiter (after installing something?)

I can't test it now myself, sitting in a ready to depart plane...


---

Comment by jdemeyer created at 2018-11-05 16:14:36

Replying to [comment:15 dimpase]:
> How does one deal with mathjax after this?

The same way as we dealt with mathjax before #26499. In other words, we don't need to do anything special.


---

Comment by chapoton created at 2018-11-05 20:22:31

NOTE: the section of spkg-install for sagenb that builds sagenb documentation is very fragile, and is breaking the build of sage from scratch (not an incremental build).

I would rather remove that part.


---

Comment by jhpalmieri created at 2018-11-05 20:54:07

Replying to [comment:17 chapoton]:
> NOTE: the section of spkg-install for sagenb that builds sagenb documentation is very fragile, and is breaking the build of sage from scratch (not an incremental build).
> 
> I would rather remove that part.

That should probably be a separate ticket. I would like to see more details.


---

Comment by jhpalmieri created at 2018-11-05 20:57:46

This works for me: I get the correct behavior with `sage -n`, `sage -n sagenb`, and `sage -n jupyter`. Both notebooks work for simple calculations – I didn't try anything very complicated.


---

Comment by jhpalmieri created at 2018-11-06 00:02:38

I'm willing to give this a positive review. Any objections?


---

Comment by dimpase created at 2018-11-06 01:37:05

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2018-11-06 01:37:05

Lgtm


---

Comment by vbraun created at 2018-11-08 17:41:54

Resolution: fixed


---

Comment by jhpalmieri created at 2018-11-12 22:42:12

Replying to [comment:17 chapoton]:
> NOTE: the section of spkg-install for sagenb that builds sagenb documentation is very fragile, and is breaking the build of sage from scratch (not an incremental build).
> 
> I would rather remove that part.

There is now #26686. Do you think that is the same problem you are having?


---

Comment by dimpase created at 2018-11-12 23:41:50

It should be the same, just missing dependencies in sagenb. Mea culpa - I think #26686 fixes this.
