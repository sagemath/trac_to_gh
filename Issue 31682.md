# Issue 31682: ABC for convex sets

archive/issues_031682.json:
```json
{
    "body": "CC:  @kliem @yuan-zhou @jplab @tscrim @novoselt @orlitzky\n\nWe create a base class `ConvexSet_base` with abstract methods to define an API for convex sets (convex subsets of a finite dimensional topological R-vector space such as `R^n`).\n\nWe use it to test/unify the API of `Polyhedron`, `ConvexRationalPolyhedralCone`, `LatticePolytope`, `RelativeInterior` (#31916)\n\nIssue created by migration from https://trac.sagemath.org/ticket/31919\n\n",
    "created_at": "2021-06-06T21:57:32Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "ABC for convex sets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31682",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @kliem @yuan-zhou @jplab @tscrim @novoselt @orlitzky

We create a base class `ConvexSet_base` with abstract methods to define an API for convex sets (convex subsets of a finite dimensional topological R-vector space such as `R^n`).

We use it to test/unify the API of `Polyhedron`, `ConvexRationalPolyhedralCone`, `LatticePolytope`, `RelativeInterior` (#31916)

Issue created by migration from https://trac.sagemath.org/ticket/31919





---

archive/issue_comments_452005.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-07T05:56:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452005",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452006.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-06-07T19:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452006",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_452007.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-07T20:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452007",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452008.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-07T23:26:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452008",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452009.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-07T23:47:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452009",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452010.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-07T23:48:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452010",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_452011.json:
```json
{
    "body": "Missing doctest.\n\n\n```\n+    def is_empty(self):\n+        \"\"\"\n+        Return whether ``self`` is the empty set.\n+\n+        Because a cone always contains the origin, this method returns ``False``.\n+        \"\"\"\n+        return False\n```\n",
    "created_at": "2021-06-08T18:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452011",
    "user": "https://github.com/kliem"
}
```

Missing doctest.


```
+    def is_empty(self):
+        """
+        Return whether ``self`` is the empty set.
+
+        Because a cone always contains the origin, this method returns ``False``.
+        """
+        return False
```




---

archive/issue_comments_452012.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-06-08T18:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452012",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_452013.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-08T20:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452013",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452014.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-06-09T06:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452014",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_452015.json:
```json
{
    "body": "I guess it is back on needs review.",
    "created_at": "2021-06-09T06:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452015",
    "user": "https://github.com/kliem"
}
```

I guess it is back on needs review.



---

archive/issue_comments_452016.json:
```json
{
    "body": "Can you please add doctests for `src/sage/geometry/convex_set.py` yet.",
    "created_at": "2021-06-09T17:49:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452016",
    "user": "https://github.com/kliem"
}
```

Can you please add doctests for `src/sage/geometry/convex_set.py` yet.



---

archive/issue_comments_452017.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-10T18:53:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452017",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452018.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-06-10T19:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452018",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_452019.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-11T00:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452019",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452020.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-06-11T00:24:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452020",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_452021.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-11T01:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452021",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452022.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-11T04:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452022",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452023.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-06-12T12:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452023",
    "user": "https://github.com/kliem"
}
```

New commits:



---

archive/issue_comments_452024.json:
```json
{
    "body": "- I don't think `ambient_dimension` should return the dimension of ``self``.\n\n```diff\n+    def ambient_dimension(self):\n+        Return the dimension of ``self``.\n+\n+        This is the same as :meth:`ambient_dim`.\n```\n\n- That `codim` is an alias of `codimension` should be doctested I think. \n- Why have you removed the test suite on the relative interior of the empty polyhedron?\n\n```diff\n-            sage: P = Polyhedron()\n+            sage: P = Polyhedron([[1, 2], [3, 4]])\n             sage: from sage.geometry.relative_interior import RelativeInterior\n             sage: TestSuite(RelativeInterior(P)).run()\n```\n\n  Would it make sense to run the test suite on relative interior of polyhedra as part of the standard polyhedron test suite? Just like in #31821.\n- Cartesian product is now a new alias of product. This should be doctested with a tiny doctest I think.",
    "created_at": "2021-06-12T13:01:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452024",
    "user": "https://github.com/kliem"
}
```

- I don't think `ambient_dimension` should return the dimension of ``self``.

```diff
+    def ambient_dimension(self):
+        Return the dimension of ``self``.
+
+        This is the same as :meth:`ambient_dim`.
```

- That `codim` is an alias of `codimension` should be doctested I think. 
- Why have you removed the test suite on the relative interior of the empty polyhedron?

```diff
-            sage: P = Polyhedron()
+            sage: P = Polyhedron([[1, 2], [3, 4]])
             sage: from sage.geometry.relative_interior import RelativeInterior
             sage: TestSuite(RelativeInterior(P)).run()
```

  Would it make sense to run the test suite on relative interior of polyhedra as part of the standard polyhedron test suite? Just like in #31821.
- Cartesian product is now a new alias of product. This should be doctested with a tiny doctest I think.



---

archive/issue_comments_452025.json:
```json
{
    "body": "Thanks for these fixes and suggestions!",
    "created_at": "2021-06-12T13:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452025",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for these fixes and suggestions!



---

archive/issue_comments_452026.json:
```json
{
    "body": "Replying to [comment:25 gh-kliem]:\n> - Why have you removed the test suite on the relative interior of the empty polyhedron?\n\nThe reason for this is the assumption in `is_closed`",
    "created_at": "2021-06-12T13:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452026",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:25 gh-kliem]:
> - Why have you removed the test suite on the relative interior of the empty polyhedron?

The reason for this is the assumption in `is_closed`



---

archive/issue_comments_452027.json:
```json
{
    "body": "Replying to [comment:28 mkoeppe]:\n> Replying to [comment:25 gh-kliem]:\n> > - Why have you removed the test suite on the relative interior of the empty polyhedron?\n> \n> The reason for this is the assumption in `is_closed`\n\nI see. I think it should be fixed then. Either we drop the requirement of being identical in the test suite or we add another clause for `Polyhedron_base.relative_interior`:\n\n\n```diff\n    if not self.is_full_dimensional():\n+       if self.is_empty():\n+           return self\n        return self.parent().element_class(self.parent(), None, None)\n    return self.relative_interior()\n```\n\n----\nNew commits:",
    "created_at": "2021-06-12T15:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452027",
    "user": "https://github.com/kliem"
}
```

Replying to [comment:28 mkoeppe]:
> Replying to [comment:25 gh-kliem]:
> > - Why have you removed the test suite on the relative interior of the empty polyhedron?
> 
> The reason for this is the assumption in `is_closed`

I see. I think it should be fixed then. Either we drop the requirement of being identical in the test suite or we add another clause for `Polyhedron_base.relative_interior`:


```diff
    if not self.is_full_dimensional():
+       if self.is_empty():
+           return self
        return self.parent().element_class(self.parent(), None, None)
    return self.relative_interior()
```

----
New commits:



---

archive/issue_comments_452028.json:
```json
{
    "body": "Replying to [comment:24 gh-kliem]:\n> New commits:\n> ||[c75ba42](https://git.sagemath.org/sage.git/commit?id=c75ba428cd91e71a8b237602a3529b936eb6d965)||`fix coverage`||\n\nPlease fix coverage or cherry-pick the above commit.\n\nIt's trivial, I see no need to add me as an author. Of course this case is trivial. But if we allow people to not test trivial things, where do we draw the line?\n\nThis is one reason why I improved `sage --fixdoctests` to work for error messages as well.",
    "created_at": "2021-06-12T16:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452028",
    "user": "https://github.com/kliem"
}
```

Replying to [comment:24 gh-kliem]:
> New commits:
> ||[c75ba42](https://git.sagemath.org/sage.git/commit?id=c75ba428cd91e71a8b237602a3529b936eb6d965)||`fix coverage`||

Please fix coverage or cherry-pick the above commit.

It's trivial, I see no need to add me as an author. Of course this case is trivial. But if we allow people to not test trivial things, where do we draw the line?

This is one reason why I improved `sage --fixdoctests` to work for error messages as well.



---

archive/issue_comments_452029.json:
```json
{
    "body": "Sorry, forgot to pull in your changes",
    "created_at": "2021-06-12T16:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452029",
    "user": "https://github.com/mkoeppe"
}
```

Sorry, forgot to pull in your changes



---

archive/issue_comments_452030.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-12T16:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452030",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452031.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-12T16:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452031",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452032.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-12T16:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452032",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452033.json:
```json
{
    "body": "Replying to [comment:30 gh-kliem]:\n> Replying to [comment:28 mkoeppe]:\n> > Replying to [comment:25 gh-kliem]:\n> > > - Why have you removed the test suite on the relative interior of the empty polyhedron?\n> > \n> > The reason for this is the assumption in `is_closed`\n> \n> I see. I think it should be fixed then. Either we drop the requirement of being identical in the test suite or we add another clause for `Polyhedron_base.relative_interior`:\n> \n> {{{#!diff\n>     if not self.is_full_dimensional():\n> +       if self.is_empty():\n> +           return self\n>         return self.parent().element_class(self.parent(), None, None)\n>     return self.relative_interior()\n> }}}\n\nI have made a similar fix",
    "created_at": "2021-06-12T16:34:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452033",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:30 gh-kliem]:
> Replying to [comment:28 mkoeppe]:
> > Replying to [comment:25 gh-kliem]:
> > > - Why have you removed the test suite on the relative interior of the empty polyhedron?
> > 
> > The reason for this is the assumption in `is_closed`
> 
> I see. I think it should be fixed then. Either we drop the requirement of being identical in the test suite or we add another clause for `Polyhedron_base.relative_interior`:
> 
> {{{#!diff
>     if not self.is_full_dimensional():
> +       if self.is_empty():
> +           return self
>         return self.parent().element_class(self.parent(), None, None)
>     return self.relative_interior()
> }}}

I have made a similar fix



---

archive/issue_comments_452034.json:
```json
{
    "body": "Replying to [comment:31 gh-kliem]:\n> This is one reason why I improved `sage --fixdoctests` to work for error messages as well.\n\nYes, this was a great improvement!",
    "created_at": "2021-06-12T16:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452034",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:31 gh-kliem]:
> This is one reason why I improved `sage --fixdoctests` to work for error messages as well.

Yes, this was a great improvement!



---

archive/issue_comments_452035.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-12T16:40:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452035",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452036.json:
```json
{
    "body": "\n```\nsage -t --long --warn-long 111.1 --random-seed=0 relative_interior.py\n**********************************************************************\nFile \"relative_interior.py\", line 82, in sage.geometry.relative_interior.RelativeInterior.ambient\nFailed example:\n    ri_segment.ambient()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.geometry.relative_interior.RelativeInterior.ambient[2]>\", line 1, in <module>\n        ri_segment.ambient()\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/geometry/relative_interior.py\", line 84, in ambient\n        return self._polyhedron.ambient()\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/base_ZZ.py\", line 51, in __getattribute__\n        return super(Polyhedron_ZZ, self).__getattribute__(name)\n      File \"sage/structure/element.pyx\", line 493, in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4708)\n        return self.getattr_from_category(name)\n      File \"sage/structure/element.pyx\", line 506, in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4820)\n        return getattr_from_other_class(self, cls, name)\n      File \"sage/cpython/getattr.pyx\", line 367, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2551)\n        raise AttributeError(dummy_error_message)\n    AttributeError: 'Polyhedra_ZZ_ppl_with_category.element_class' object has no attribute 'ambient'\n**********************************************************************\nFile \"relative_interior.py\", line 96, in sage.geometry.relative_interior.RelativeInterior.ambient_vector_space\nFailed example:\n    ri_segment.ambient_vector_space()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.geometry.relative_interior.RelativeInterior.ambient_vector_space[2]>\", line 1, in <module>\n        ri_segment.ambient_vector_space()\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/geometry/relative_interior.py\", line 98, in ambient_vector_space\n        return self._polyhedron.ambient_vector_space(base_field=base_field)\n      File \"/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/base_ZZ.py\", line 51, in __getattribute__\n        return super(Polyhedron_ZZ, self).__getattribute__(name)\n      File \"sage/structure/element.pyx\", line 493, in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4708)\n        return self.getattr_from_category(name)\n      File \"sage/structure/element.pyx\", line 506, in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4820)\n        return getattr_from_other_class(self, cls, name)\n      File \"sage/cpython/getattr.pyx\", line 367, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2551)\n        raise AttributeError(dummy_error_message)\n    AttributeError: 'Polyhedra_ZZ_ppl_with_category.element_class' object has no attribute 'ambient_vector_space'\n**********************************************************************\n2 items had failures:\n   1 of   4 in sage.geometry.relative_interior.RelativeInterior.ambient\n   1 of   4 in sage.geometry.relative_interior.RelativeInterior.ambient_vector_space\n    [59 tests, 2 failures, 0.13 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 111.1 --random-seed=0 relative_interior.py  # 2 doctests failed\n```\n",
    "created_at": "2021-06-12T18:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452036",
    "user": "https://github.com/kliem"
}
```


```
sage -t --long --warn-long 111.1 --random-seed=0 relative_interior.py
**********************************************************************
File "relative_interior.py", line 82, in sage.geometry.relative_interior.RelativeInterior.ambient
Failed example:
    ri_segment.ambient()
Exception raised:
    Traceback (most recent call last):
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.relative_interior.RelativeInterior.ambient[2]>", line 1, in <module>
        ri_segment.ambient()
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/geometry/relative_interior.py", line 84, in ambient
        return self._polyhedron.ambient()
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/base_ZZ.py", line 51, in __getattribute__
        return super(Polyhedron_ZZ, self).__getattribute__(name)
      File "sage/structure/element.pyx", line 493, in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4708)
        return self.getattr_from_category(name)
      File "sage/structure/element.pyx", line 506, in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4820)
        return getattr_from_other_class(self, cls, name)
      File "sage/cpython/getattr.pyx", line 367, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2551)
        raise AttributeError(dummy_error_message)
    AttributeError: 'Polyhedra_ZZ_ppl_with_category.element_class' object has no attribute 'ambient'
**********************************************************************
File "relative_interior.py", line 96, in sage.geometry.relative_interior.RelativeInterior.ambient_vector_space
Failed example:
    ri_segment.ambient_vector_space()
Exception raised:
    Traceback (most recent call last):
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.relative_interior.RelativeInterior.ambient_vector_space[2]>", line 1, in <module>
        ri_segment.ambient_vector_space()
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/geometry/relative_interior.py", line 98, in ambient_vector_space
        return self._polyhedron.ambient_vector_space(base_field=base_field)
      File "/home/jonathan/Applications/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/base_ZZ.py", line 51, in __getattribute__
        return super(Polyhedron_ZZ, self).__getattribute__(name)
      File "sage/structure/element.pyx", line 493, in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4708)
        return self.getattr_from_category(name)
      File "sage/structure/element.pyx", line 506, in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4820)
        return getattr_from_other_class(self, cls, name)
      File "sage/cpython/getattr.pyx", line 367, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2551)
        raise AttributeError(dummy_error_message)
    AttributeError: 'Polyhedra_ZZ_ppl_with_category.element_class' object has no attribute 'ambient_vector_space'
**********************************************************************
2 items had failures:
   1 of   4 in sage.geometry.relative_interior.RelativeInterior.ambient
   1 of   4 in sage.geometry.relative_interior.RelativeInterior.ambient_vector_space
    [59 tests, 2 failures, 0.13 s]
----------------------------------------------------------------------
sage -t --long --warn-long 111.1 --random-seed=0 relative_interior.py  # 2 doctests failed
```




---

archive/issue_comments_452037.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-06-12T18:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452037",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_452038.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-06-12T19:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452038",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_452039.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-06-12T19:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452039",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_452040.json:
```json
{
    "body": "Cherry-picking 1448835 from #31959 was a mistake, thanks for catching this.\nLet's see what the patchbot thinks now",
    "created_at": "2021-06-12T19:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452040",
    "user": "https://github.com/mkoeppe"
}
```

Cherry-picking 1448835 from #31959 was a mistake, thanks for catching this.
Let's see what the patchbot thinks now



---

archive/issue_comments_452041.json:
```json
{
    "body": "Patchbot is green modulo the unrelated `src/sage/misc/package.py` failure",
    "created_at": "2021-06-13T02:48:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452041",
    "user": "https://github.com/mkoeppe"
}
```

Patchbot is green modulo the unrelated `src/sage/misc/package.py` failure



---

archive/issue_comments_452042.json:
```json
{
    "body": "We could replace the imports in `lattice_polytope.py` and `cone.py` by lazy imports:\n\n\n```\n========== startup_modules ==========\n\n--- 9.4.beta1\n\n+++ 9.4.beta1 + #31919\n\n\n-Total count: 1762\n+Total count: 1764\n+New:\n+sage.geometry.convex_set\n+    sage.geometry.relative_interior\n+====================\n\n+sage.geometry.convex_set\n\n+sage.geometry.relative_interior\n\n-startup_modules Passed\n+startup_modules Failed\n```\n",
    "created_at": "2021-06-13T06:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452042",
    "user": "https://github.com/kliem"
}
```

We could replace the imports in `lattice_polytope.py` and `cone.py` by lazy imports:


```
========== startup_modules ==========

--- 9.4.beta1

+++ 9.4.beta1 + #31919


-Total count: 1762
+Total count: 1764
+New:
+sage.geometry.convex_set
+    sage.geometry.relative_interior
+====================

+sage.geometry.convex_set

+sage.geometry.relative_interior

-startup_modules Passed
+startup_modules Failed
```




---

archive/issue_comments_452043.json:
```json
{
    "body": "Fine with me if you want to make this change",
    "created_at": "2021-06-13T06:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452043",
    "user": "https://github.com/mkoeppe"
}
```

Fine with me if you want to make this change



---

archive/issue_comments_452044.json:
```json
{
    "body": "Actually I think after #31705 this won't matter",
    "created_at": "2021-06-13T14:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452044",
    "user": "https://github.com/mkoeppe"
}
```

Actually I think after #31705 this won't matter



---

archive/issue_comments_452045.json:
```json
{
    "body": "Replying to [comment:45 mkoeppe]:\n> Actually I think after #31705 this won't matter\n\nYes, that's right.",
    "created_at": "2021-06-14T06:24:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452045",
    "user": "https://github.com/kliem"
}
```

Replying to [comment:45 mkoeppe]:
> Actually I think after #31705 this won't matter

Yes, that's right.



---

archive/issue_comments_452046.json:
```json
{
    "body": "One tiny thing about `RelativeInterior.interior`: It should return `self`, if the relative interior is full-dimensional. This is currently the case, because the method `relative_interior` is cached for polyhedra and cones. Maybe it is cleaner to immediately catch the case. But it is not really needed.\n\nEither way, LGTM.",
    "created_at": "2021-06-14T07:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452046",
    "user": "https://github.com/kliem"
}
```

One tiny thing about `RelativeInterior.interior`: It should return `self`, if the relative interior is full-dimensional. This is currently the case, because the method `relative_interior` is cached for polyhedra and cones. Maybe it is cleaner to immediately catch the case. But it is not really needed.

Either way, LGTM.



---

archive/issue_comments_452047.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-14T07:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452047",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_452048.json:
```json
{
    "body": "Thank you!\n\nWe can make refinements to `RelativeInterior` in a later ticket. For now I prefer the version as is.",
    "created_at": "2021-06-14T07:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452048",
    "user": "https://github.com/mkoeppe"
}
```

Thank you!

We can make refinements to `RelativeInterior` in a later ticket. For now I prefer the version as is.



---

archive/issue_comments_452049.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-06-29T17:40:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31682#issuecomment-452049",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
