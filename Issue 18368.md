# Issue 18368: Faster coclosure for BinaryMatroid, TernaryMatroid, QuaternaryMatroid

archive/issues_018368.json:
```json
{
    "body": "Assignee: Rudi\n\nCC:  chaoxu stefan\n\nThe efficiency of the internal function _fundamental_cocircuit is far better than that of its dual _fundamental_circuit for BinaryMatroid, TernaryMatroid, and QuaternaryMatroid, due to the way these matroids are represented internally. The parent class BasesExchangeMatroid does not assume or use this asymmetry. As a result  there is a substantial difference between between the efficiency of dual operations such as closure and coclosure, and indirectly is_simple and is_cosimple, etc.\n\nOverride _coclosure for BinaryMatroid, TernaryMatroid, and QuaternaryMatroid by a function that exploits the asymmetry by calling _fundamental_cocircuit rather than _fundamental_circuit.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18605\n\n",
    "created_at": "2015-06-04T08:18:57Z",
    "labels": [
        "matroid theory",
        "major",
        "enhancement"
    ],
    "title": "Faster coclosure for BinaryMatroid, TernaryMatroid, QuaternaryMatroid",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18368",
    "user": "Rudi"
}
```
Assignee: Rudi

CC:  chaoxu stefan

The efficiency of the internal function _fundamental_cocircuit is far better than that of its dual _fundamental_circuit for BinaryMatroid, TernaryMatroid, and QuaternaryMatroid, due to the way these matroids are represented internally. The parent class BasesExchangeMatroid does not assume or use this asymmetry. As a result  there is a substantial difference between between the efficiency of dual operations such as closure and coclosure, and indirectly is_simple and is_cosimple, etc.

Override _coclosure for BinaryMatroid, TernaryMatroid, and QuaternaryMatroid by a function that exploits the asymmetry by calling _fundamental_cocircuit rather than _fundamental_circuit.

Issue created by migration from https://trac.sagemath.org/ticket/18605





---

archive/issue_comments_249360.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-04T15:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18368#issuecomment-249360",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249361.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-06-04T15:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18368#issuecomment-249361",
    "user": "Rudi"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_249362.json:
```json
{
    "body": "Without this patch coclosure is far slower than closure on a BinaryMatroid:\n\n```\nsage: A =MatrixSpace(GF(2), 500,1000).random_element()\nsage: M=Matroid(A)\nsage: timeit(\"M.closure([0])\")\n625 loops, best of 3: 25 \u00b5s per loop\nsage: timeit(\"M.coclosure([0])\")\n125 loops, best of 3: 4.06 ms per loop\n```\n\nWith the patch, coclosure actually beats closure:\n\n```\nsage: A =MatrixSpace(GF(2), 500,1000).random_element()\nsage: M=Matroid(A)\nsage: timeit(\"M.closure([0])\")\n625 loops, best of 3: 25.1 \u00b5s per loop\nsage: timeit(\"M.coclosure([0])\")\n625 loops, best of 3: 14.7 \u00b5s per loop\n```\n\nFor correctness of the patch I tried:\n\n```\nsage: for i in range(10000):\n    A =MatrixSpace(GF(2), 5,2000).random_element()\n    M = Matroid(A)\n    if M.closure([0]) != M.dual().coclosure([0]):\n        print '!!'\n```\n\nThat worked out fine.\n\nNeeds review!",
    "created_at": "2015-06-04T15:32:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18368#issuecomment-249362",
    "user": "Rudi"
}
```

Without this patch coclosure is far slower than closure on a BinaryMatroid:

```
sage: A =MatrixSpace(GF(2), 500,1000).random_element()
sage: M=Matroid(A)
sage: timeit("M.closure([0])")
625 loops, best of 3: 25 µs per loop
sage: timeit("M.coclosure([0])")
125 loops, best of 3: 4.06 ms per loop
```

With the patch, coclosure actually beats closure:

```
sage: A =MatrixSpace(GF(2), 500,1000).random_element()
sage: M=Matroid(A)
sage: timeit("M.closure([0])")
625 loops, best of 3: 25.1 µs per loop
sage: timeit("M.coclosure([0])")
625 loops, best of 3: 14.7 µs per loop
```

For correctness of the patch I tried:

```
sage: for i in range(10000):
    A =MatrixSpace(GF(2), 5,2000).random_element()
    M = Matroid(A)
    if M.closure([0]) != M.dual().coclosure([0]):
        print '!!'
```

That worked out fine.

Needs review!



---

archive/issue_comments_249363.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-10T07:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18368#issuecomment-249363",
    "user": "chaoxu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_249364.json:
```json
{
    "body": "Testing: Passed all tests and works for all small matroids.  \n\nThanks, this is much faster!",
    "created_at": "2015-06-10T07:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18368#issuecomment-249364",
    "user": "chaoxu"
}
```

Testing: Passed all tests and works for all small matroids.  

Thanks, this is much faster!



---

archive/issue_comments_249365.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-11T13:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18368#issuecomment-249365",
    "user": "vbraun"
}
```

Resolution: fixed
