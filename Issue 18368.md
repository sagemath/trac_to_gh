# Issue 18368: Faster coclosure for BinaryMatroid, TernaryMatroid, QuaternaryMatroid

Issue created by migration from Trac.

Original creator: Rudi

Original creation time: 2015-06-04 08:18:57

Assignee: Rudi

CC:  chaoxu stefan

The efficiency of the internal function _fundamental_cocircuit is far better than that of its dual _fundamental_circuit for BinaryMatroid, TernaryMatroid, and QuaternaryMatroid, due to the way these matroids are represented internally. The parent class BasesExchangeMatroid does not assume or use this asymmetry. As a result  there is a substantial difference between between the efficiency of dual operations such as closure and coclosure, and indirectly is_simple and is_cosimple, etc.

Override _coclosure for BinaryMatroid, TernaryMatroid, and QuaternaryMatroid by a function that exploits the asymmetry by calling _fundamental_cocircuit rather than _fundamental_circuit.


---

Comment by git created at 2015-06-04 15:18:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-06-04 15:32:38

Changing status from new to needs_review.


---

Comment by Rudi created at 2015-06-04 15:32:38

Without this patch coclosure is far slower than closure on a BinaryMatroid:

```
sage: A =MatrixSpace(GF(2), 500,1000).random_element()
sage: M=Matroid(A)
sage: timeit("M.closure([0])")
625 loops, best of 3: 25 µs per loop
sage: timeit("M.coclosure([0])")
125 loops, best of 3: 4.06 ms per loop
```

With the patch, coclosure actually beats closure:

```
sage: A =MatrixSpace(GF(2), 500,1000).random_element()
sage: M=Matroid(A)
sage: timeit("M.closure([0])")
625 loops, best of 3: 25.1 µs per loop
sage: timeit("M.coclosure([0])")
625 loops, best of 3: 14.7 µs per loop
```

For correctness of the patch I tried:

```
sage: for i in range(10000):
    A =MatrixSpace(GF(2), 5,2000).random_element()
    M = Matroid(A)
    if M.closure([0]) != M.dual().coclosure([0]):
        print '!!'
```

That worked out fine.

Needs review!


---

Comment by chaoxu created at 2015-06-10 07:56:39

Changing status from needs_review to positive_review.


---

Comment by chaoxu created at 2015-06-10 07:56:39

Testing: Passed all tests and works for all small matroids.  

Thanks, this is much faster!


---

Comment by vbraun created at 2015-06-11 13:50:50

Resolution: fixed
