# Issue 19236: FiniteDimensionalAlgebra.is_unitary is not sufficient

archive/issues_019236.json:
```json
{
    "body": "CC:  sage-combinat tscrim nthiery\n\nKeywords: finite-dimensional algebra, linear algebra\n\nHere is the semigroup algebra (over `QQ`) of the semigroup with two elements whose product is given by `x*y == y`:\n\n\n```\nsage: A = FiniteDimensionalAlgebra(QQ, [Matrix([[1,0],[1,0]]), Matrix([[0,1],[0,1]])])\nsage: for x in A.basis():\n    for y in A.basis():\n        print x*y == y\n....:         \nTrue\nTrue\nTrue\nTrue\n```\n\n\nSage claims that it is unitary:\n\n```\nsage: A.is_unitary()\nTrue\n```\n\nbased on the following wrong concept:\n\n```\n        .. NOTE::\n\n            If a finite-dimensional algebra over a field admits a left identity,\n            then this is the unique left identity, and it is also a\n            right identity.\n```\n\n\nOn a slightly related note, the `table` method on `FiniteDimensionalAlgebra` returns mutable matrices, and mutating them corrupts the algebra.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19473\n\n",
    "created_at": "2015-10-24T20:01:08Z",
    "labels": [
        "algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "FiniteDimensionalAlgebra.is_unitary is not sufficient",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19236",
    "user": "darij"
}
```
CC:  sage-combinat tscrim nthiery

Keywords: finite-dimensional algebra, linear algebra

Here is the semigroup algebra (over `QQ`) of the semigroup with two elements whose product is given by `x*y == y`:


```
sage: A = FiniteDimensionalAlgebra(QQ, [Matrix([[1,0],[1,0]]), Matrix([[0,1],[0,1]])])
sage: for x in A.basis():
    for y in A.basis():
        print x*y == y
....:         
True
True
True
True
```


Sage claims that it is unitary:

```
sage: A.is_unitary()
True
```

based on the following wrong concept:

```
        .. NOTE::

            If a finite-dimensional algebra over a field admits a left identity,
            then this is the unique left identity, and it is also a
            right identity.
```


On a slightly related note, the `table` method on `FiniteDimensionalAlgebra` returns mutable matrices, and mutating them corrupts the algebra.

Issue created by migration from https://trac.sagemath.org/ticket/19473





---

archive/issue_comments_263942.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-10-27T17:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263942",
    "user": "darij"
}
```

New commits:



---

archive/issue_comments_263943.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-27T17:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263943",
    "user": "darij"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_263944.json:
```json
{
    "body": "The wrong claim \"If a finite-dimensional algebra over a field admits a left identity, then this is the unique left identity, and it is also a right identity\" is my fault (introduced in trac_12141_finite_algebras.patch\u200b at #12141).  I have no idea what I was thinking...\n\nAbout the mutability: can't we just make the matrices in the table immutable using the `set_immutable()` method?",
    "created_at": "2015-10-27T17:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263944",
    "user": "pbruin"
}
```

The wrong claim "If a finite-dimensional algebra over a field admits a left identity, then this is the unique left identity, and it is also a right identity" is my fault (introduced in trac_12141_finite_algebras.patchâ€‹ at #12141).  I have no idea what I was thinking...

About the mutability: can't we just make the matrices in the table immutable using the `set_immutable()` method?



---

archive/issue_comments_263945.json:
```json
{
    "body": "Maybe (I don't see a downside to this, but I know little of matrices in Sage...). But we'd have to make the list immutable too.",
    "created_at": "2015-10-27T17:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263945",
    "user": "darij"
}
```

Maybe (I don't see a downside to this, but I know little of matrices in Sage...). But we'd have to make the list immutable too.



---

archive/issue_comments_263946.json:
```json
{
    "body": "Replying to [comment:3 darij]:\n> Maybe (I don't see a downside to this, but I know little of matrices in Sage...).\nAs far as I know there is no downside, but I'm not an expert either.\n> But we'd have to make the list immutable too.\nInstead of a list, we could return a tuple (or an immutable sequence).",
    "created_at": "2015-10-27T17:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263946",
    "user": "pbruin"
}
```

Replying to [comment:3 darij]:
> Maybe (I don't see a downside to this, but I know little of matrices in Sage...).
As far as I know there is no downside, but I'm not an expert either.
> But we'd have to make the list immutable too.
Instead of a list, we could return a tuple (or an immutable sequence).



---

archive/issue_comments_263947.json:
```json
{
    "body": "I would get rid of the `copy` attribute, instead make this a `UniqueRepresentation` (or perhaps a `UniqueFactory` so we can better control the cache key), and make the table a tuple of immutable matrices that gets set by the `__classcall_private__`.\n\nWe also need to fix the category, which is wrong for non-associative, non-unital cases.",
    "created_at": "2015-10-27T17:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263947",
    "user": "tscrim"
}
```

I would get rid of the `copy` attribute, instead make this a `UniqueRepresentation` (or perhaps a `UniqueFactory` so we can better control the cache key), and make the table a tuple of immutable matrices that gets set by the `__classcall_private__`.

We also need to fix the category, which is wrong for non-associative, non-unital cases.



---

archive/issue_comments_263948.json:
```json
{
    "body": "OK, feel free to rollback my 2nd commit, which as I see just now is broken anyway. I'm all for immutability, though I am not sure if we want `UniqueRepresentation` (didn't we agree at some point that it is a pain in the ass?).",
    "created_at": "2015-10-27T17:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263948",
    "user": "darij"
}
```

OK, feel free to rollback my 2nd commit, which as I see just now is broken anyway. I'm all for immutability, though I am not sure if we want `UniqueRepresentation` (didn't we agree at some point that it is a pain in the ass?).



---

archive/issue_comments_263949.json:
```json
{
    "body": "Some things with `UniqueRepresentation` are annoying, but overall that isn't so big here IMO. Here's my proposal with `UniqueRepresentation` and also changing the default category to be `MagmaticAlgebras`. I would like to check during construction if the algebra is associative/unital/commutative but this is too expensive. Also refining the category after the fact can lead to subtle bugs, mainly the elements don't know the could have more methods from the refined category. So I'm leaving it to the user to pass the correct category (but I left the `assume_associative`).\n----\nNew commits:",
    "created_at": "2015-10-27T20:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263949",
    "user": "tscrim"
}
```

Some things with `UniqueRepresentation` are annoying, but overall that isn't so big here IMO. Here's my proposal with `UniqueRepresentation` and also changing the default category to be `MagmaticAlgebras`. I would like to check during construction if the algebra is associative/unital/commutative but this is too expensive. Also refining the category after the fact can lead to subtle bugs, mainly the elements don't know the could have more methods from the refined category. So I'm leaving it to the user to pass the correct category (but I left the `assume_associative`).
----
New commits:



---

archive/issue_comments_263950.json:
```json
{
    "body": "BTW, the previous branch had doctest failures noted on the patchbot.",
    "created_at": "2015-10-27T20:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263950",
    "user": "tscrim"
}
```

BTW, the previous branch had doctest failures noted on the patchbot.



---

archive/issue_comments_263951.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-10-27T21:56:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263951",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_263952.json:
```json
{
    "body": "Actually my fix for the unitality assumed associativity. I need to fix it again to work in the magmatic case...",
    "created_at": "2015-10-28T00:04:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263952",
    "user": "darij"
}
```

Actually my fix for the unitality assumed associativity. I need to fix it again to work in the magmatic case...



---

archive/issue_comments_263953.json:
```json
{
    "body": "OK, now I am lost. `FiniteDimensionalAlgebra` inherits from `Algebra`, which in turn inherits from `Ring`. The test suite of `Ring` has associativity, which makes me suspect that rings are supposed to be associative. But the design of `FiniteDimensionalAlgebra` makes it clear that associativity is optional, and the docstrings contain examples of non-associative algebras (which still pass their test suites since `some_element` returns just a 1-element list). So should they be associative or not?",
    "created_at": "2015-10-28T00:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263953",
    "user": "darij"
}
```

OK, now I am lost. `FiniteDimensionalAlgebra` inherits from `Algebra`, which in turn inherits from `Ring`. The test suite of `Ring` has associativity, which makes me suspect that rings are supposed to be associative. But the design of `FiniteDimensionalAlgebra` makes it clear that associativity is optional, and the docstrings contain examples of non-associative algebras (which still pass their test suites since `some_element` returns just a 1-element list). So should they be associative or not?



---

archive/issue_comments_263954.json:
```json
{
    "body": "From what I see, there are no additional tests in `Ring`. Instead these come from the category of `Rings`, which is not in the supercategories. However I think we are okay because the class doesn't necessarily assume the parent is associative and unital.",
    "created_at": "2015-10-28T03:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263954",
    "user": "tscrim"
}
```

From what I see, there are no additional tests in `Ring`. Instead these come from the category of `Rings`, which is not in the supercategories. However I think we are okay because the class doesn't necessarily assume the parent is associative and unital.



---

archive/issue_comments_263955.json:
```json
{
    "body": "Replying to [comment:5 tscrim]:\n> I would get rid of the `copy` attribute, instead make this a `UniqueRepresentation` (or perhaps a `UniqueFactory` so we can better control the cache key), and make the table a tuple of immutable matrices that gets set by the `__classcall_private__`.\nHow does introducing `UniqueRepresentation` help in solving this ticket?  Wouldn't it be better to do that on a separate ticket?\n> We also need to fix the category, which is wrong for non-associative, non-unital cases.\nI agree.  It is unfortunate that refining the category after initialisation is possibly problematic.",
    "created_at": "2015-10-28T08:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263955",
    "user": "pbruin"
}
```

Replying to [comment:5 tscrim]:
> I would get rid of the `copy` attribute, instead make this a `UniqueRepresentation` (or perhaps a `UniqueFactory` so we can better control the cache key), and make the table a tuple of immutable matrices that gets set by the `__classcall_private__`.
How does introducing `UniqueRepresentation` help in solving this ticket?  Wouldn't it be better to do that on a separate ticket?
> We also need to fix the category, which is wrong for non-associative, non-unital cases.
I agree.  It is unfortunate that refining the category after initialisation is possibly problematic.



---

archive/issue_comments_263956.json:
```json
{
    "body": "Here is Johan Bosman's implementation of `is_unitary()` from #12141 before my wrong rewrite (and after some editing and simplification):\n\n```python\n@cached_method\ndef is_unitary(self):\n    \"\"\"\n    Return True if ``self`` is unitary.\n\n    EXAMPLES::\n\n        sage: B = FiniteDimensionalAlgebra(QQ, [Matrix([[1,0],[0,1]]), Matrix([[0,1],[-1,0]])])\n        sage: B.is_unitary()\n        True\n        sage: C = FiniteDimensionalAlgebra(QQ, [Matrix([[0,0],[0,0]]), Matrix([[0,0],[0,0]])])\n        sage: C.is_unitary()\n        False\n    \"\"\"\n    n = self._degree\n    k = self.base_ring()\n    if n == 0:\n        self._one = vector(k, [])\n        return True\n    B1 = reduce(lambda x, y: x.augment(y),\n                self._table, Matrix(k, n, 0))\n    B2 = reduce(lambda x, y: x.augment(y),\n                self.left_table(), Matrix(k, n, 0))\n    # This is the vector obtained by concatenating the rows of the\n    # n times n identity matrix:\n    v = vector(k, (n - 1) * ([1] + n * [0]) + [1])\n    try:\n        sol1 = B1.solve_left(v)\n        sol2 = B2.solve_left(v)\n    except ValueError:\n        return False\n    if sol1 == sol2:\n        self._one = sol1\n        return True\n    else:\n        return False\n```\n\nIf this is correct, we can just re-use it.",
    "created_at": "2015-10-28T09:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263956",
    "user": "pbruin"
}
```

Here is Johan Bosman's implementation of `is_unitary()` from #12141 before my wrong rewrite (and after some editing and simplification):

```python
@cached_method
def is_unitary(self):
    """
    Return True if ``self`` is unitary.

    EXAMPLES::

        sage: B = FiniteDimensionalAlgebra(QQ, [Matrix([[1,0],[0,1]]), Matrix([[0,1],[-1,0]])])
        sage: B.is_unitary()
        True
        sage: C = FiniteDimensionalAlgebra(QQ, [Matrix([[0,0],[0,0]]), Matrix([[0,0],[0,0]])])
        sage: C.is_unitary()
        False
    """
    n = self._degree
    k = self.base_ring()
    if n == 0:
        self._one = vector(k, [])
        return True
    B1 = reduce(lambda x, y: x.augment(y),
                self._table, Matrix(k, n, 0))
    B2 = reduce(lambda x, y: x.augment(y),
                self.left_table(), Matrix(k, n, 0))
    # This is the vector obtained by concatenating the rows of the
    # n times n identity matrix:
    v = vector(k, (n - 1) * ([1] + n * [0]) + [1])
    try:
        sol1 = B1.solve_left(v)
        sol2 = B2.solve_left(v)
    except ValueError:
        return False
    if sol1 == sol2:
        self._one = sol1
        return True
    else:
        return False
```

If this is correct, we can just re-use it.



---

archive/issue_comments_263957.json:
```json
{
    "body": "Replying to [comment:13 pbruin]:\n> Replying to [comment:5 tscrim]:\n> > I would get rid of the `copy` attribute, instead make this a `UniqueRepresentation` (or perhaps a `UniqueFactory` so we can better control the cache key), and make the table a tuple of immutable matrices that gets set by the `__classcall_private__`.\n> How does introducing `UniqueRepresentation` help in solving this ticket?  Wouldn't it be better to do that on a separate ticket?\n\nWe can separate off the table issues into a separate ticket, that is okay with me. Want me to do that?\n\n> > We also need to fix the category, which is wrong for non-associative, non-unital cases.\n> I agree.  It is unfortunate that refining the category after initialisation is possibly problematic.\n\nThe other option would be to add boolean parameters that do checks in the initialization (which would require some minor refactoring if we wanted to go the `UniqueRepresentaion` route and would mean we do that on this ticket).",
    "created_at": "2015-10-28T13:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263957",
    "user": "tscrim"
}
```

Replying to [comment:13 pbruin]:
> Replying to [comment:5 tscrim]:
> > I would get rid of the `copy` attribute, instead make this a `UniqueRepresentation` (or perhaps a `UniqueFactory` so we can better control the cache key), and make the table a tuple of immutable matrices that gets set by the `__classcall_private__`.
> How does introducing `UniqueRepresentation` help in solving this ticket?  Wouldn't it be better to do that on a separate ticket?

We can separate off the table issues into a separate ticket, that is okay with me. Want me to do that?

> > We also need to fix the category, which is wrong for non-associative, non-unital cases.
> I agree.  It is unfortunate that refining the category after initialisation is possibly problematic.

The other option would be to add boolean parameters that do checks in the initialization (which would require some minor refactoring if we wanted to go the `UniqueRepresentaion` route and would mean we do that on this ticket).



---

archive/issue_comments_263958.json:
```json
{
    "body": "Replying to [comment:15 tscrim]:\n> Replying to [comment:13 pbruin]:\n> > Replying to [comment:5 tscrim]:\n> > > I would get rid of the `copy` attribute, instead make this a `UniqueRepresentation` (or perhaps a `UniqueFactory` so we can better control the cache key), and make the table a tuple of immutable matrices that gets set by the `__classcall_private__`.\n> > How does introducing `UniqueRepresentation` help in solving this ticket?  Wouldn't it be better to do that on a separate ticket?\n> \n> We can separate off the table issues into a separate ticket, that is okay with me. Want me to do that?\n> > > We also need to fix the category, which is wrong for non-associative, non-unital cases.\n> > I agree.  It is unfortunate that refining the category after initialisation is possibly problematic.\n> \n> The other option would be to add boolean parameters that do checks in the initialization (which would require some minor refactoring if we wanted to go the `UniqueRepresentaion` route and would mean we do that on this ticket).\nIt seems to me that there are four mostly independent issues:\n1. the wrong `is_unitary()` method;\n2. the fact that the multiplication table is mutable;\n3. determining the correct category;\n4. implementing unique representation.\nWe could possibly fix issue 2 on this ticket (assuming it just takes a few lines), but also doing 3 and 4 on this ticket would be way too much in my opinion.  I would prefer just solving issue 1 on this ticket and opening separate tickets (possibly with dependencies) for issues 2, 3 and 4.",
    "created_at": "2015-10-28T13:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263958",
    "user": "pbruin"
}
```

Replying to [comment:15 tscrim]:
> Replying to [comment:13 pbruin]:
> > Replying to [comment:5 tscrim]:
> > > I would get rid of the `copy` attribute, instead make this a `UniqueRepresentation` (or perhaps a `UniqueFactory` so we can better control the cache key), and make the table a tuple of immutable matrices that gets set by the `__classcall_private__`.
> > How does introducing `UniqueRepresentation` help in solving this ticket?  Wouldn't it be better to do that on a separate ticket?
> 
> We can separate off the table issues into a separate ticket, that is okay with me. Want me to do that?
> > > We also need to fix the category, which is wrong for non-associative, non-unital cases.
> > I agree.  It is unfortunate that refining the category after initialisation is possibly problematic.
> 
> The other option would be to add boolean parameters that do checks in the initialization (which would require some minor refactoring if we wanted to go the `UniqueRepresentaion` route and would mean we do that on this ticket).
It seems to me that there are four mostly independent issues:
1. the wrong `is_unitary()` method;
2. the fact that the multiplication table is mutable;
3. determining the correct category;
4. implementing unique representation.
We could possibly fix issue 2 on this ticket (assuming it just takes a few lines), but also doing 3 and 4 on this ticket would be way too much in my opinion.  I would prefer just solving issue 1 on this ticket and opening separate tickets (possibly with dependencies) for issues 2, 3 and 4.



---

archive/issue_comments_263959.json:
```json
{
    "body": "Replying to [comment:16 pbruin]:\n> It seems to me that there are four mostly independent issues:\n> 1. the wrong `is_unitary()` method;\n> 2. the fact that the multiplication table is mutable;\n> 3. determining the correct category;\n> 4. implementing unique representation.\n> We could possibly fix issue 2 on this ticket (assuming it just takes a few lines), but also doing 3 and 4 on this ticket would be way too much in my opinion.  I would prefer just solving issue 1 on this ticket and opening separate tickets (possibly with dependencies) for issues 2, 3 and 4.\n\nThen let us just fix 1 here and use the changes on the current branch as a followup ticket.",
    "created_at": "2015-10-28T14:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263959",
    "user": "tscrim"
}
```

Replying to [comment:16 pbruin]:
> It seems to me that there are four mostly independent issues:
> 1. the wrong `is_unitary()` method;
> 2. the fact that the multiplication table is mutable;
> 3. determining the correct category;
> 4. implementing unique representation.
> We could possibly fix issue 2 on this ticket (assuming it just takes a few lines), but also doing 3 and 4 on this ticket would be way too much in my opinion.  I would prefer just solving issue 1 on this ticket and opening separate tickets (possibly with dependencies) for issues 2, 3 and 4.

Then let us just fix 1 here and use the changes on the current branch as a followup ticket.



---

archive/issue_comments_263960.json:
```json
{
    "body": "+1 for splitting 1&2 | 3&4. This is particularly helpful to me, as I am fairly sure I can review 1&2, but probably not 3&4 these days.\n\nJohan Bosman's approach looks correct (mathematically -- haven't checked the programming). It isn't even necessary to check that the two identities are equal, since their existence already yields their equality.",
    "created_at": "2015-10-28T14:44:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263960",
    "user": "darij"
}
```

+1 for splitting 1&2 | 3&4. This is particularly helpful to me, as I am fairly sure I can review 1&2, but probably not 3&4 these days.

Johan Bosman's approach looks correct (mathematically -- haven't checked the programming). It isn't even necessary to check that the two identities are equal, since their existence already yields their equality.



---

archive/issue_comments_263961.json:
```json
{
    "body": "Replying to [comment:18 darij]:\n> Johan Bosman's approach looks correct (mathematically -- haven't checked the programming). It isn't even necessary to check that the two identities are equal, since their existence already yields their equality.\nIndeed, I have now also convinced myself of this.  This means that we can replace\n\n```python\n    if sol1 == sol2:\n        self._one = sol1\n        return True\n    else:\n        return False\n```\n\nby\n\n```python\n    assert sol1 == sol2\n    return True\n```\n\n(note that at this point the fact that `sol1` and `sol2` have been computed implies that left and right identity elements exist).",
    "created_at": "2015-10-28T15:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263961",
    "user": "pbruin"
}
```

Replying to [comment:18 darij]:
> Johan Bosman's approach looks correct (mathematically -- haven't checked the programming). It isn't even necessary to check that the two identities are equal, since their existence already yields their equality.
Indeed, I have now also convinced myself of this.  This means that we can replace

```python
    if sol1 == sol2:
        self._one = sol1
        return True
    else:
        return False
```

by

```python
    assert sol1 == sol2
    return True
```

(note that at this point the fact that `sol1` and `sol2` have been computed implies that left and right identity elements exist).



---

archive/issue_comments_263962.json:
```json
{
    "body": "One more thing. The definition\n\n```\nv = vector(k, (n - 1) * ([1] + n * [0]) + [1])\n```\n\nof `v` is one step back from the currently present definition\n\n```\nv = vector(Matrix.identity(k, n).list())\n```\n\nbecause it is far better for the entries of `v` to be defined as the zero/one elements of `R` rather than the ints `0` and `1`. There are, after all, rings whose zero/one elements are distinct from `0` and `1`. (So far we probably don't have fields like that, but it could be imaginable. More importantly, coercions like `R(0)` take time, particularly when they are cast on each entry of the vector separately.",
    "created_at": "2015-10-28T17:12:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263962",
    "user": "darij"
}
```

One more thing. The definition

```
v = vector(k, (n - 1) * ([1] + n * [0]) + [1])
```

of `v` is one step back from the currently present definition

```
v = vector(Matrix.identity(k, n).list())
```

because it is far better for the entries of `v` to be defined as the zero/one elements of `R` rather than the ints `0` and `1`. There are, after all, rings whose zero/one elements are distinct from `0` and `1`. (So far we probably don't have fields like that, but it could be imaginable. More importantly, coercions like `R(0)` take time, particularly when they are cast on each entry of the vector separately.



---

archive/issue_comments_263963.json:
```json
{
    "body": "Okay, here is 1. The rest will be handled on #19507.\n----\nNew commits:",
    "created_at": "2015-10-31T15:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263963",
    "user": "tscrim"
}
```

Okay, here is 1. The rest will be handled on #19507.
----
New commits:



---

archive/issue_comments_263964.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-31T23:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263964",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_263965.json:
```json
{
    "body": "LGTM, but I've added some doctests to make sure this doesn't regress. Positive review, if you agree.",
    "created_at": "2015-10-31T23:36:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263965",
    "user": "darij"
}
```

LGTM, but I've added some doctests to make sure this doesn't regress. Positive review, if you agree.



---

archive/issue_comments_263966.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-11-01T01:33:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263966",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_263967.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-11-01T19:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19236#issuecomment-263967",
    "user": "vbraun"
}
```

Resolution: fixed
