# Issue 13941: Problems with contains for Tableau, TableauTuples and PartitionTuples

Issue created by migration from https://trac.sagemath.org/ticket/14145

Original creator: andrew.mathas

Original creation time: 2013-02-18 02:30:09

Assignee: sage-combinat

CC:  andrew.mathas

Keywords: sage45

The following three commands all lead to errors:


```
sage: 1 in Tableaux()
sage: 1 in TableauTuples()
sage: 1 in PartitionTuples()
```


In all cases, sage reports

```
TypeError: 'sage.rings.integer.Integer' object is not iterable
```

The place where sage is failing is in CombinatorialObject.__init__ where we have:


```python

        if isinstance(l, list):
            self._list = l
        else:
            self._list = list(l)
```


The error arises because l==1 is not a list. The discussion on [sage combinat](https://groups.google.com/forum/?fromgroups=#!topic/sage-combinat-devel/J22BDid0sZw) concluded that this was more a bug in the __contains__ methods of these classes rather than in CombinatorialObject.__init__ -- although, I do think that CombinatorialObject should trap this error and print a more informative error message.

Anyway, contains should never give rise to an error, so the contains methods of these classes need to be fixed.


---

Comment by andrew.mathas created at 2013-02-18 02:32:05

Changing keywords from "sage45" to "days45".


---

Comment by tscrim created at 2013-02-23 19:38:06

I've gone through and also caught all `TypeError` exceptions in the `__contains__()` methods. At the end of the day, I'd rather this to not try to create the element class, but this would likely require some major refactoring at best. Actually, in an ideal world I would like anytime a call to `in` throws an error, it returns `False`...I think I've probably said more than enough. Anyways, this patch fixes the problem at hand and is ready for review.

Best,

Travis


---

Comment by tscrim created at 2013-02-23 19:38:06

Changing status from new to needs_review.


---

Comment by andrew.mathas created at 2013-02-27 06:51:56

I will upload a "review" patch shortly which tests containment without creating an object in the element class.


---

Comment by tscrim created at 2013-03-27 14:52:54

Hey Andrew,

Just wondering what the status of the review patch is.

Thanks,

Travis


---

Comment by andrew.mathas created at 2013-03-27 22:14:29

Hi Travis,

I had it almost finished -- one class left to do -- and then teaching started and some other urgent projects got in the way. Will try and finalise soon, although it is going to be more of a replacement patch than a review patch I'm afraid...

Andrew


---

Comment by tscrim created at 2013-03-27 23:46:07

Hey Andrew,

No worries on both accounts, I completely understand and there's not any rush on this. Hope everything is going well.

Best,

Travis


---

Comment by andrew.mathas created at 2013-04-29 02:44:32

Hi Travis,

I finally got back to this. I looked more closely at the changes in timing before and after the patch and I think that they are not in fact due to element creation but instead are caused by the lazy imports. For example, the biggest slowdown (from 0s to 6.51s) occurs with the lines

```python
G = SymmetricGroup(8)
g = G([(1,2,3,4,5),(6,7,8)])
```


I have just pushed a slight modification to the patch to the combinat queue which changes the sanity checking in Partition.__init__. I ran a few tests and the new code is slightly faster than the old code.

Finally, as my first review patch was more 4 times bigger than your patch I have made us both authors and reviewers.

If you are happy with it then let's make this a positive review.

Andrew


---

Comment by tscrim created at 2013-04-29 18:33:12

Thanks for checking on the timings Andrew (I ended up forgetting about looking deeper into it, sorry). I've uploaded the patch from the queue. Looks good to me.

Thanks,

Travis


---

Comment by tscrim created at 2013-04-29 18:33:12

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-04-30 11:34:55

Why the change from

```
except StandardError:
```

to

```
except:
```



---

Comment by jdemeyer created at 2013-04-30 11:34:55

Changing status from positive_review to needs_info.


---

Comment by tscrim created at 2013-04-30 14:25:18

Changing status from needs_info to needs_review.


---

Comment by tscrim created at 2013-04-30 14:25:18

Sorry missed that one.


---

Comment by tscrim created at 2013-04-30 14:25:26

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-04-30 15:33:14

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2013-04-30 15:33:14


```
sage -t --long devel/sage/sage/combinat/combinat.py
**********************************************************************
File "devel/sage/sage/combinat/combinat.py", line 1365, in sage.combinat.combinat.CombinatorialClass.__call__
Failed example:
    p5([2,1])
Expected:
    Traceback (most recent call last):
    ...
    ValueError: [2, 1] is not in Partitions of the integer 5
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 454, in _run
        self.execute(example, compiled, test.globs)
      File "/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 813, in execute
        exec compiled in globs
      File "<doctest sage.combinat.combinat.CombinatorialClass.__call__[5]>", line 1, in <module>
        p5([Integer(2),Integer(1)])
      File "parent.pyx", line 930, in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8064)
      File "coerce_maps.pyx", line 82, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3815)
      File "coerce_maps.pyx", line 77, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3717)
      File "/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/combinat/partition.py", line 4043, in _element_constructor_
        raise ValueError('%s is not an element of %s'%(lst, self))
    ValueError: [2, 1] is not an element of Partitions of the integer 5
**********************************************************************
```


```
sage -t --long devel/sage/sage/combinat/sf/sf.py
**********************************************************************
File "devel/sage/sage/combinat/sf/sf.py", line 129, in sage.combinat.sf.sf.SymmetricFunctions
Failed example:
    p['something']
Expected:
    Traceback (most recent call last):
    ...
    ValueError: ['s', 'o', 'm', 'e', 't', 'h', 'i', 'n', 'g'] is not a valid partition
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 454, in _run
        self.execute(example, compiled, test.globs)
      File "/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 813, in execute
        exec compiled in globs
      File "<doctest sage.combinat.sf.sf.SymmetricFunctions[13]>", line 1, in <module>
        p['something']
      File "/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/combinat/sf/sfa.py", line 845, in __getitem__
        c = C(list(c))
      File "parent.pyx", line 930, in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8064)
      File "coerce_maps.pyx", line 82, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3815)
      File "coerce_maps.pyx", line 77, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3717)
      File "/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/combinat/partition.py", line 4043, in _element_constructor_
        raise ValueError('%s is not an element of %s'%(lst, self))
    ValueError: ['s', 'o', 'm', 'e', 't', 'h', 'i', 'n', 'g'] is not an element of Partitions
**********************************************************************
```



---

Attachment

Fixed. Sorry about that Jeroen.


---

Comment by tscrim created at 2013-04-30 16:43:35

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2013-05-07 09:05:04

Resolution: fixed
