# Issue 13941: Problems with contains for Tableau, TableauTuples and PartitionTuples

archive/issues_013941.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  @AndrewAtLarge\n\nKeywords: sage45\n\nThe following three commands all lead to errors:\n\n\n```\nsage: 1 in Tableaux()\nsage: 1 in TableauTuples()\nsage: 1 in PartitionTuples()\n```\n\n\nIn all cases, sage reports\n\n```\nTypeError: 'sage.rings.integer.Integer' object is not iterable\n```\n\nThe place where sage is failing is in CombinatorialObject.__init__ where we have:\n\n\n```python\n\n        if isinstance(l, list):\n            self._list = l\n        else:\n            self._list = list(l)\n```\n\n\nThe error arises because l==1 is not a list. The discussion on [sage combinat](https://groups.google.com/forum/?fromgroups=#!topic/sage-combinat-devel/J22BDid0sZw) concluded that this was more a bug in the __contains__ methods of these classes rather than in CombinatorialObject.__init__ -- although, I do think that CombinatorialObject should trap this error and print a more informative error message.\n\nAnyway, contains should never give rise to an error, so the contains methods of these classes need to be fixed.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14145\n\n",
    "created_at": "2013-02-18T02:30:09Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "Problems with contains for Tableau, TableauTuples and PartitionTuples",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13941",
    "user": "https://github.com/AndrewAtLarge"
}
```
Assignee: sage-combinat

CC:  @AndrewAtLarge

Keywords: sage45

The following three commands all lead to errors:


```
sage: 1 in Tableaux()
sage: 1 in TableauTuples()
sage: 1 in PartitionTuples()
```


In all cases, sage reports

```
TypeError: 'sage.rings.integer.Integer' object is not iterable
```

The place where sage is failing is in CombinatorialObject.__init__ where we have:


```python

        if isinstance(l, list):
            self._list = l
        else:
            self._list = list(l)
```


The error arises because l==1 is not a list. The discussion on [sage combinat](https://groups.google.com/forum/?fromgroups=#!topic/sage-combinat-devel/J22BDid0sZw) concluded that this was more a bug in the __contains__ methods of these classes rather than in CombinatorialObject.__init__ -- although, I do think that CombinatorialObject should trap this error and print a more informative error message.

Anyway, contains should never give rise to an error, so the contains methods of these classes need to be fixed.

Issue created by migration from https://trac.sagemath.org/ticket/14145





---

archive/issue_comments_173586.json:
```json
{
    "body": "Changing keywords from \"sage45\" to \"days45\".",
    "created_at": "2013-02-18T02:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173586",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing keywords from "sage45" to "days45".



---

archive/issue_comments_173587.json:
```json
{
    "body": "I've gone through and also caught all `TypeError` exceptions in the `__contains__()` methods. At the end of the day, I'd rather this to not try to create the element class, but this would likely require some major refactoring at best. Actually, in an ideal world I would like anytime a call to `in` throws an error, it returns `False`...I think I've probably said more than enough. Anyways, this patch fixes the problem at hand and is ready for review.\n\nBest,\n\nTravis",
    "created_at": "2013-02-23T19:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173587",
    "user": "https://github.com/tscrim"
}
```

I've gone through and also caught all `TypeError` exceptions in the `__contains__()` methods. At the end of the day, I'd rather this to not try to create the element class, but this would likely require some major refactoring at best. Actually, in an ideal world I would like anytime a call to `in` throws an error, it returns `False`...I think I've probably said more than enough. Anyways, this patch fixes the problem at hand and is ready for review.

Best,

Travis



---

archive/issue_comments_173588.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-02-23T19:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173588",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_173589.json:
```json
{
    "body": "I will upload a \"review\" patch shortly which tests containment without creating an object in the element class.",
    "created_at": "2013-02-27T06:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173589",
    "user": "https://github.com/AndrewAtLarge"
}
```

I will upload a "review" patch shortly which tests containment without creating an object in the element class.



---

archive/issue_comments_173590.json:
```json
{
    "body": "Hey Andrew,\n\nJust wondering what the status of the review patch is.\n\nThanks,\n\nTravis",
    "created_at": "2013-03-27T14:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173590",
    "user": "https://github.com/tscrim"
}
```

Hey Andrew,

Just wondering what the status of the review patch is.

Thanks,

Travis



---

archive/issue_comments_173591.json:
```json
{
    "body": "Hi Travis,\n\nI had it almost finished -- one class left to do -- and then teaching started and some other urgent projects got in the way. Will try and finalise soon, although it is going to be more of a replacement patch than a review patch I'm afraid...\n\nAndrew",
    "created_at": "2013-03-27T22:14:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173591",
    "user": "https://github.com/AndrewAtLarge"
}
```

Hi Travis,

I had it almost finished -- one class left to do -- and then teaching started and some other urgent projects got in the way. Will try and finalise soon, although it is going to be more of a replacement patch than a review patch I'm afraid...

Andrew



---

archive/issue_comments_173592.json:
```json
{
    "body": "Hey Andrew,\n\nNo worries on both accounts, I completely understand and there's not any rush on this. Hope everything is going well.\n\nBest,\n\nTravis",
    "created_at": "2013-03-27T23:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173592",
    "user": "https://github.com/tscrim"
}
```

Hey Andrew,

No worries on both accounts, I completely understand and there's not any rush on this. Hope everything is going well.

Best,

Travis



---

archive/issue_comments_173593.json:
```json
{
    "body": "Hi Travis,\n\nI finally got back to this. I looked more closely at the changes in timing before and after the patch and I think that they are not in fact due to element creation but instead are caused by the lazy imports. For example, the biggest slowdown (from 0s to 6.51s) occurs with the lines\n\n```python\nG = SymmetricGroup(8)\ng = G([(1,2,3,4,5),(6,7,8)])\n```\n\n\nI have just pushed a slight modification to the patch to the combinat queue which changes the sanity checking in Partition.__init__. I ran a few tests and the new code is slightly faster than the old code.\n\nFinally, as my first review patch was more 4 times bigger than your patch I have made us both authors and reviewers.\n\nIf you are happy with it then let's make this a positive review.\n\nAndrew",
    "created_at": "2013-04-29T02:44:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173593",
    "user": "https://github.com/AndrewAtLarge"
}
```

Hi Travis,

I finally got back to this. I looked more closely at the changes in timing before and after the patch and I think that they are not in fact due to element creation but instead are caused by the lazy imports. For example, the biggest slowdown (from 0s to 6.51s) occurs with the lines

```python
G = SymmetricGroup(8)
g = G([(1,2,3,4,5),(6,7,8)])
```


I have just pushed a slight modification to the patch to the combinat queue which changes the sanity checking in Partition.__init__. I ran a few tests and the new code is slightly faster than the old code.

Finally, as my first review patch was more 4 times bigger than your patch I have made us both authors and reviewers.

If you are happy with it then let's make this a positive review.

Andrew



---

archive/issue_comments_173594.json:
```json
{
    "body": "Thanks for checking on the timings Andrew (I ended up forgetting about looking deeper into it, sorry). I've uploaded the patch from the queue. Looks good to me.\n\nThanks,\n\nTravis",
    "created_at": "2013-04-29T18:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173594",
    "user": "https://github.com/tscrim"
}
```

Thanks for checking on the timings Andrew (I ended up forgetting about looking deeper into it, sorry). I've uploaded the patch from the queue. Looks good to me.

Thanks,

Travis



---

archive/issue_comments_173595.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-04-29T18:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173595",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_173596.json:
```json
{
    "body": "Why the change from\n\n```\nexcept StandardError:\n```\n\nto\n\n```\nexcept:\n```\n",
    "created_at": "2013-04-30T11:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173596",
    "user": "https://github.com/jdemeyer"
}
```

Why the change from

```
except StandardError:
```

to

```
except:
```




---

archive/issue_comments_173597.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2013-04-30T11:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173597",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_173598.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2013-04-30T14:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173598",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_173599.json:
```json
{
    "body": "Sorry missed that one.",
    "created_at": "2013-04-30T14:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173599",
    "user": "https://github.com/tscrim"
}
```

Sorry missed that one.



---

archive/issue_comments_173600.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-04-30T14:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173600",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_173601.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-04-30T15:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173601",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_173602.json:
```json
{
    "body": "\n```\nsage -t --long devel/sage/sage/combinat/combinat.py\n**********************************************************************\nFile \"devel/sage/sage/combinat/combinat.py\", line 1365, in sage.combinat.combinat.CombinatorialClass.__call__\nFailed example:\n    p5([2,1])\nExpected:\n    Traceback (most recent call last):\n    ...\n    ValueError: [2, 1] is not in Partitions of the integer 5\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 454, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 813, in execute\n        exec compiled in globs\n      File \"<doctest sage.combinat.combinat.CombinatorialClass.__call__[5]>\", line 1, in <module>\n        p5([Integer(2),Integer(1)])\n      File \"parent.pyx\", line 930, in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8064)\n      File \"coerce_maps.pyx\", line 82, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3815)\n      File \"coerce_maps.pyx\", line 77, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3717)\n      File \"/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/combinat/partition.py\", line 4043, in _element_constructor_\n        raise ValueError('%s is not an element of %s'%(lst, self))\n    ValueError: [2, 1] is not an element of Partitions of the integer 5\n**********************************************************************\n```\n\n\n```\nsage -t --long devel/sage/sage/combinat/sf/sf.py\n**********************************************************************\nFile \"devel/sage/sage/combinat/sf/sf.py\", line 129, in sage.combinat.sf.sf.SymmetricFunctions\nFailed example:\n    p['something']\nExpected:\n    Traceback (most recent call last):\n    ...\n    ValueError: ['s', 'o', 'm', 'e', 't', 'h', 'i', 'n', 'g'] is not a valid partition\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 454, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 813, in execute\n        exec compiled in globs\n      File \"<doctest sage.combinat.sf.sf.SymmetricFunctions[13]>\", line 1, in <module>\n        p['something']\n      File \"/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/combinat/sf/sfa.py\", line 845, in __getitem__\n        c = C(list(c))\n      File \"parent.pyx\", line 930, in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8064)\n      File \"coerce_maps.pyx\", line 82, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3815)\n      File \"coerce_maps.pyx\", line 77, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3717)\n      File \"/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/combinat/partition.py\", line 4043, in _element_constructor_\n        raise ValueError('%s is not an element of %s'%(lst, self))\n    ValueError: ['s', 'o', 'm', 'e', 't', 'h', 'i', 'n', 'g'] is not an element of Partitions\n**********************************************************************\n```\n",
    "created_at": "2013-04-30T15:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173602",
    "user": "https://github.com/jdemeyer"
}
```


```
sage -t --long devel/sage/sage/combinat/combinat.py
**********************************************************************
File "devel/sage/sage/combinat/combinat.py", line 1365, in sage.combinat.combinat.CombinatorialClass.__call__
Failed example:
    p5([2,1])
Expected:
    Traceback (most recent call last):
    ...
    ValueError: [2, 1] is not in Partitions of the integer 5
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 454, in _run
        self.execute(example, compiled, test.globs)
      File "/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 813, in execute
        exec compiled in globs
      File "<doctest sage.combinat.combinat.CombinatorialClass.__call__[5]>", line 1, in <module>
        p5([Integer(2),Integer(1)])
      File "parent.pyx", line 930, in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8064)
      File "coerce_maps.pyx", line 82, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3815)
      File "coerce_maps.pyx", line 77, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3717)
      File "/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/combinat/partition.py", line 4043, in _element_constructor_
        raise ValueError('%s is not an element of %s'%(lst, self))
    ValueError: [2, 1] is not an element of Partitions of the integer 5
**********************************************************************
```


```
sage -t --long devel/sage/sage/combinat/sf/sf.py
**********************************************************************
File "devel/sage/sage/combinat/sf/sf.py", line 129, in sage.combinat.sf.sf.SymmetricFunctions
Failed example:
    p['something']
Expected:
    Traceback (most recent call last):
    ...
    ValueError: ['s', 'o', 'm', 'e', 't', 'h', 'i', 'n', 'g'] is not a valid partition
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 454, in _run
        self.execute(example, compiled, test.globs)
      File "/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 813, in execute
        exec compiled in globs
      File "<doctest sage.combinat.sf.sf.SymmetricFunctions[13]>", line 1, in <module>
        p['something']
      File "/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/combinat/sf/sfa.py", line 845, in __getitem__
        c = C(list(c))
      File "parent.pyx", line 930, in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8064)
      File "coerce_maps.pyx", line 82, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3815)
      File "coerce_maps.pyx", line 77, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3717)
      File "/mazur/release/merger/sage-5.10.beta2/local/lib/python2.7/site-packages/sage/combinat/partition.py", line 4043, in _element_constructor_
        raise ValueError('%s is not an element of %s'%(lst, self))
    ValueError: ['s', 'o', 'm', 'e', 't', 'h', 'i', 'n', 'g'] is not an element of Partitions
**********************************************************************
```




---

archive/issue_comments_173603.json:
```json
{
    "body": "Attachment [trac_14145-fix_contains_tableau-ts.patch](tarball://root/attachments/some-uuid/ticket14145/trac_14145-fix_contains_tableau-ts.patch) by @tscrim created at 2013-04-30 16:43:35\n\nFixed. Sorry about that Jeroen.",
    "created_at": "2013-04-30T16:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173603",
    "user": "https://github.com/tscrim"
}
```

Attachment [trac_14145-fix_contains_tableau-ts.patch](tarball://root/attachments/some-uuid/ticket14145/trac_14145-fix_contains_tableau-ts.patch) by @tscrim created at 2013-04-30 16:43:35

Fixed. Sorry about that Jeroen.



---

archive/issue_comments_173604.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-04-30T16:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173604",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_173605.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-05-07T09:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13941#issuecomment-173605",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
