# Issue 27689: Preserve backend for polytopal constructions

archive/issues_027689.json:
```json
{
    "body": "CC:  @jplab @videlec\n\nKeywords: polytopes, backend, normaliz\n\nCurrently constructions of new polyhedra in `Polyhedron_base` do not preserve the backend:\n\n\n```\nsage: Polyhedron(vertices=[[0]], backend='field').pyramid().backend()\n'ppl'\n```\n\n\nThis ticket fixes this.\n\nThis respects the users intentions, who might have chosen a specific backend for a good reason. Also, once #25097 is merged, this is needed to have the constructions work for polyhedra over number fields.\n\nMore precisely the constructions are:\n\n- `minkowski_sum` (seems to respect backend already)\n- `minkowski_difference` (seems to respect backend already)\n- `translation`,\n- `product`,\n- `join`,\n- `subdirect_sum`,\n- `direct_sum`,\n- `dilation`,\n- `convex_hull` (seems to respect backend already),\n- `intersection` (seems to respect backend),\n- `truncation`,\n- `face_truncation`,\n- `stack`,\n- `lawrence_extension`,\n- `lawrence_polytope`,\n- `polar` (respects backend, but in a different way),\n- `pyramid`,\n- `bipyramid`,\n- `prism`,\n- `face_split`,\n- `affine_hull`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27926\n\n",
    "created_at": "2019-06-04T12:42:08Z",
    "labels": [
        "geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Preserve backend for polytopal constructions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27689",
    "user": "@kliem"
}
```
CC:  @jplab @videlec

Keywords: polytopes, backend, normaliz

Currently constructions of new polyhedra in `Polyhedron_base` do not preserve the backend:


```
sage: Polyhedron(vertices=[[0]], backend='field').pyramid().backend()
'ppl'
```


This ticket fixes this.

This respects the users intentions, who might have chosen a specific backend for a good reason. Also, once #25097 is merged, this is needed to have the constructions work for polyhedra over number fields.

More precisely the constructions are:

- `minkowski_sum` (seems to respect backend already)
- `minkowski_difference` (seems to respect backend already)
- `translation`,
- `product`,
- `join`,
- `subdirect_sum`,
- `direct_sum`,
- `dilation`,
- `convex_hull` (seems to respect backend already),
- `intersection` (seems to respect backend),
- `truncation`,
- `face_truncation`,
- `stack`,
- `lawrence_extension`,
- `lawrence_polytope`,
- `polar` (respects backend, but in a different way),
- `pyramid`,
- `bipyramid`,
- `prism`,
- `face_split`,
- `affine_hull`.

Issue created by migration from https://trac.sagemath.org/ticket/27926





---

archive/issue_comments_390879.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-04T20:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390879",
    "user": "@kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_390880.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-04T21:01:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390880",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390881.json:
```json
{
    "body": "This is not likely to be a good idea\n\n```\n+        return Polyhedron(vertices=new_vertices, rays=new_rays, lines=new_lines, base_ring=new_ring, backend=self.backend())\n```\n\nBackends do not support all base rings. For example if you have a polytope with backend PPL and then translate with `sqrt(2)` that would not work.",
    "created_at": "2019-06-05T06:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390881",
    "user": "@videlec"
}
```

This is not likely to be a good idea

```
+        return Polyhedron(vertices=new_vertices, rays=new_rays, lines=new_lines, base_ring=new_ring, backend=self.backend())
```

Backends do not support all base rings. For example if you have a polytope with backend PPL and then translate with `sqrt(2)` that would not work.



---

archive/issue_comments_390882.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-06-05T06:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390882",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_390883.json:
```json
{
    "body": "You should add `backend=self.backend()` only if the base ring is identical.",
    "created_at": "2019-06-05T06:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390883",
    "user": "@videlec"
}
```

You should add `backend=self.backend()` only if the base ring is identical.



---

archive/issue_comments_390884.json:
```json
{
    "body": "I missed this instance. I'll fix it like the other methods.\nThere is a new function `test_backend` that tests if a combination of `backend` and `base_ring` will work.\n\nReplying to [comment:5 vdelecroix]:\n> You should add `backend=self.backend()` only if the base ring is identical.",
    "created_at": "2019-06-05T07:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390884",
    "user": "@kliem"
}
```

I missed this instance. I'll fix it like the other methods.
There is a new function `test_backend` that tests if a combination of `backend` and `base_ring` will work.

Replying to [comment:5 vdelecroix]:
> You should add `backend=self.backend()` only if the base ring is identical.



---

archive/issue_comments_390885.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-05T09:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390885",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390886.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-06-05T09:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390886",
    "user": "@kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_390887.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-06-06T09:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390887",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_390888.json:
```json
{
    "body": "`test_backend` is a terrible name. This function does not test the backend. It would better be `does_backend_handle_base_ring`.\n\nThe result of `test_backend` must be cached (with the decorator ``@`cached_function`).\n\nIf the `new_ring` is actually the same as before, you should avoid going through `does_backend_handle_base_ring`.",
    "created_at": "2019-06-06T09:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390888",
    "user": "@videlec"
}
```

`test_backend` is a terrible name. This function does not test the backend. It would better be `does_backend_handle_base_ring`.

The result of `test_backend` must be cached (with the decorator ``@`cached_function`).

If the `new_ring` is actually the same as before, you should avoid going through `does_backend_handle_base_ring`.



---

archive/issue_comments_390889.json:
```json
{
    "body": "I am not sure this is the right approach. The same code is copied in each single function. I think what is done with matrices is more sensible and the information about the backend is actually stored into the parents\n\n```\nsage: M1 = MatrixSpace(ZZ, 3, implementation='gap')\nsage: M1\nFull MatrixSpace of 3 by 3 dense matrices over Integer Ring (using Matrix_gap)\nsage: M2 = MatrixSpace(ZZ, 3, implementation='generic')\nsage: M2\nFull MatrixSpace of 3 by 3 dense matrices over Integer Ring (using Matrix_generic_dense)\n```\n\nThe rules about promotions such as\n\n```\nsage: parent(M1.an_element() * M2.an_element())\nFull MatrixSpace of 3 by 3 dense matrices over Integer Ring\n```\n\nare handled by the parents and this is what it should be done for polyhedra as well.",
    "created_at": "2019-06-06T09:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390889",
    "user": "@videlec"
}
```

I am not sure this is the right approach. The same code is copied in each single function. I think what is done with matrices is more sensible and the information about the backend is actually stored into the parents

```
sage: M1 = MatrixSpace(ZZ, 3, implementation='gap')
sage: M1
Full MatrixSpace of 3 by 3 dense matrices over Integer Ring (using Matrix_gap)
sage: M2 = MatrixSpace(ZZ, 3, implementation='generic')
sage: M2
Full MatrixSpace of 3 by 3 dense matrices over Integer Ring (using Matrix_generic_dense)
```

The rules about promotions such as

```
sage: parent(M1.an_element() * M2.an_element())
Full MatrixSpace of 3 by 3 dense matrices over Integer Ring
```

are handled by the parents and this is what it should be done for polyhedra as well.



---

archive/issue_comments_390890.json:
```json
{
    "body": "I guess I should work with `Polyhedra_base.base_extend`.\n\nEither I introduce a new option for `backend`, such as `keep` or a change the default behavior to attempt to keep the backend, if possible.\n\nWhat do you think?\n\nI find the default behavior to be strange at the moment. I have a Polyhedron, change the base ring and all the sudden I use a different backend, even though the old one would have worked.\n\nReplying to [comment:10 vdelecroix]:\n> I am not sure this is the right approach. The same code is copied in each single function. I think what is done with matrices is more sensible and the information about the backend is actually stored into the parents\n> {{{\n> sage: M1 = MatrixSpace(ZZ, 3, implementation='gap')\n> sage: M1\n> Full MatrixSpace of 3 by 3 dense matrices over Integer Ring (using Matrix_gap)\n> sage: M2 = MatrixSpace(ZZ, 3, implementation='generic')\n> sage: M2\n> Full MatrixSpace of 3 by 3 dense matrices over Integer Ring (using Matrix_generic_dense)\n> }}}\n> The rules about promotions such as\n> {{{\n> sage: parent(M1.an_element() * M2.an_element())\n> Full MatrixSpace of 3 by 3 dense matrices over Integer Ring\n> }}}\n> are handled by the parents and this is what it should be done for polyhedra as well.",
    "created_at": "2019-06-06T11:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390890",
    "user": "@kliem"
}
```

I guess I should work with `Polyhedra_base.base_extend`.

Either I introduce a new option for `backend`, such as `keep` or a change the default behavior to attempt to keep the backend, if possible.

What do you think?

I find the default behavior to be strange at the moment. I have a Polyhedron, change the base ring and all the sudden I use a different backend, even though the old one would have worked.

Replying to [comment:10 vdelecroix]:
> I am not sure this is the right approach. The same code is copied in each single function. I think what is done with matrices is more sensible and the information about the backend is actually stored into the parents
> {{{
> sage: M1 = MatrixSpace(ZZ, 3, implementation='gap')
> sage: M1
> Full MatrixSpace of 3 by 3 dense matrices over Integer Ring (using Matrix_gap)
> sage: M2 = MatrixSpace(ZZ, 3, implementation='generic')
> sage: M2
> Full MatrixSpace of 3 by 3 dense matrices over Integer Ring (using Matrix_generic_dense)
> }}}
> The rules about promotions such as
> {{{
> sage: parent(M1.an_element() * M2.an_element())
> Full MatrixSpace of 3 by 3 dense matrices over Integer Ring
> }}}
> are handled by the parents and this is what it should be done for polyhedra as well.



---

archive/issue_comments_390891.json:
```json
{
    "body": "There is no discussion about the fact that the current behavior is wrong. I tried to argue that your initial solution was not optimal. Namely, the parents already carry the backend information (`Polyhedra_QQ_ppl`, `Polyhedra_ZZ_ppl`, ...). Anytime a new polyhedra is constructed inside a method, the new parent should be chosen via a query to the parent.\n\nModifying `Polyhedra_base.base_extend` is a good idea. If the new `base_ring` supports the current backend, it should be kept.\n\nThough at this point, I don't quite understand the difference between `base_extend` and `change_ring`... that would better be clarified.\n\nReplying to [comment:11 gh-kliem]:\n> I guess I should work with `Polyhedra_base.base_extend`.\n> \n> Either I introduce a new option for `backend`, such as `keep` or a change the default behavior to attempt to keep the backend, if possible.\n> \n> What do you think?\n> \n> I find the default behavior to be strange at the moment. I have a Polyhedron, change the base ring and all the sudden I use a different backend, even though the old one would have worked.\n> \n> Replying to [comment:10 vdelecroix]:\n> > I am not sure this is the right approach. The same code is copied in each single function. I think what is done with matrices is more sensible and the information about the backend is actually stored into the parents\n> > {{{\n> > sage: M1 = MatrixSpace(ZZ, 3, implementation='gap')\n> > sage: M1\n> > Full MatrixSpace of 3 by 3 dense matrices over Integer Ring (using Matrix_gap)\n> > sage: M2 = MatrixSpace(ZZ, 3, implementation='generic')\n> > sage: M2\n> > Full MatrixSpace of 3 by 3 dense matrices over Integer Ring (using Matrix_generic_dense)\n> > }}}\n> > The rules about promotions such as\n> > {{{\n> > sage: parent(M1.an_element() * M2.an_element())\n> > Full MatrixSpace of 3 by 3 dense matrices over Integer Ring\n> > }}}\n> > are handled by the parents and this is what it should be done for polyhedra as well.",
    "created_at": "2019-06-06T11:44:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390891",
    "user": "@videlec"
}
```

There is no discussion about the fact that the current behavior is wrong. I tried to argue that your initial solution was not optimal. Namely, the parents already carry the backend information (`Polyhedra_QQ_ppl`, `Polyhedra_ZZ_ppl`, ...). Anytime a new polyhedra is constructed inside a method, the new parent should be chosen via a query to the parent.

Modifying `Polyhedra_base.base_extend` is a good idea. If the new `base_ring` supports the current backend, it should be kept.

Though at this point, I don't quite understand the difference between `base_extend` and `change_ring`... that would better be clarified.

Replying to [comment:11 gh-kliem]:
> I guess I should work with `Polyhedra_base.base_extend`.
> 
> Either I introduce a new option for `backend`, such as `keep` or a change the default behavior to attempt to keep the backend, if possible.
> 
> What do you think?
> 
> I find the default behavior to be strange at the moment. I have a Polyhedron, change the base ring and all the sudden I use a different backend, even though the old one would have worked.
> 
> Replying to [comment:10 vdelecroix]:
> > I am not sure this is the right approach. The same code is copied in each single function. I think what is done with matrices is more sensible and the information about the backend is actually stored into the parents
> > {{{
> > sage: M1 = MatrixSpace(ZZ, 3, implementation='gap')
> > sage: M1
> > Full MatrixSpace of 3 by 3 dense matrices over Integer Ring (using Matrix_gap)
> > sage: M2 = MatrixSpace(ZZ, 3, implementation='generic')
> > sage: M2
> > Full MatrixSpace of 3 by 3 dense matrices over Integer Ring (using Matrix_generic_dense)
> > }}}
> > The rules about promotions such as
> > {{{
> > sage: parent(M1.an_element() * M2.an_element())
> > Full MatrixSpace of 3 by 3 dense matrices over Integer Ring
> > }}}
> > are handled by the parents and this is what it should be done for polyhedra as well.



---

archive/issue_comments_390892.json:
```json
{
    "body": "I believe `change_ring` was created after `base_extend` as `base_extend` doesn't allow the ring to become smaller. Either way `base_extend` should just call `change_ring` with the coerced ring (and `change_ring` should return `self` if possible).\n\nOk. I will now proceed as follows:\n\n1. Let `change_ring` call `base_extend`. (Btw. the error checking with regard to inexact rings in `Polyhedron_base.change_ring` really should be left to parent as well.)\n\n2. Create a new parent only if needed.\n\n3. Change default behavior of `None` in `change_ring` to leave `backend` if possible.\n\n4. Simplify all the methods to obtain a parent with `base_extend` and then initialize from that parent.\n\nReplying to [comment:12 vdelecroix]:\n> There is no discussion about the fact that the current behavior is wrong. I tried to argue that your initial solution was not optimal. Namely, the parents already carry the backend information (`Polyhedra_QQ_ppl`, `Polyhedra_ZZ_ppl`, ...). Anytime a new polyhedra is constructed inside a method, the new parent should be chosen via a query to the parent.\n> \n> Modifying `Polyhedra_base.base_extend` is a good idea. If the new `base_ring` supports the current backend, it should be kept.\n> \n> Though at this point, I don't quite understand the difference between `base_extend` and `change_ring`... that would better be clarified.\n> \n> Replying to [comment:11 gh-kliem]:\n> > I guess I should work with `Polyhedra_base.base_extend`.\n> > \n> > Either I introduce a new option for `backend`, such as `keep` or a change the default behavior to attempt to keep the backend, if possible.\n> > \n> > What do you think?\n> > \n> > I find the default behavior to be strange at the moment. I have a Polyhedron, change the base ring and all the sudden I use a different backend, even though the old one would have worked.\n> > \n> > Replying to [comment:10 vdelecroix]:\n> > > I am not sure this is the right approach. The same code is copied in each single function. I think what is done with matrices is more sensible and the information about the backend is actually stored into the parents\n> > > {{{\n> > > sage: M1 = MatrixSpace(ZZ, 3, implementation='gap')\n> > > sage: M1\n> > > Full MatrixSpace of 3 by 3 dense matrices over Integer Ring (using Matrix_gap)\n> > > sage: M2 = MatrixSpace(ZZ, 3, implementation='generic')\n> > > sage: M2\n> > > Full MatrixSpace of 3 by 3 dense matrices over Integer Ring (using Matrix_generic_dense)\n> > > }}}\n> > > The rules about promotions such as\n> > > {{{\n> > > sage: parent(M1.an_element() * M2.an_element())\n> > > Full MatrixSpace of 3 by 3 dense matrices over Integer Ring\n> > > }}}\n> > > are handled by the parents and this is what it should be done for polyhedra as well.",
    "created_at": "2019-06-06T12:13:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390892",
    "user": "@kliem"
}
```

I believe `change_ring` was created after `base_extend` as `base_extend` doesn't allow the ring to become smaller. Either way `base_extend` should just call `change_ring` with the coerced ring (and `change_ring` should return `self` if possible).

Ok. I will now proceed as follows:

1. Let `change_ring` call `base_extend`. (Btw. the error checking with regard to inexact rings in `Polyhedron_base.change_ring` really should be left to parent as well.)

2. Create a new parent only if needed.

3. Change default behavior of `None` in `change_ring` to leave `backend` if possible.

4. Simplify all the methods to obtain a parent with `base_extend` and then initialize from that parent.

Replying to [comment:12 vdelecroix]:
> There is no discussion about the fact that the current behavior is wrong. I tried to argue that your initial solution was not optimal. Namely, the parents already carry the backend information (`Polyhedra_QQ_ppl`, `Polyhedra_ZZ_ppl`, ...). Anytime a new polyhedra is constructed inside a method, the new parent should be chosen via a query to the parent.
> 
> Modifying `Polyhedra_base.base_extend` is a good idea. If the new `base_ring` supports the current backend, it should be kept.
> 
> Though at this point, I don't quite understand the difference between `base_extend` and `change_ring`... that would better be clarified.
> 
> Replying to [comment:11 gh-kliem]:
> > I guess I should work with `Polyhedra_base.base_extend`.
> > 
> > Either I introduce a new option for `backend`, such as `keep` or a change the default behavior to attempt to keep the backend, if possible.
> > 
> > What do you think?
> > 
> > I find the default behavior to be strange at the moment. I have a Polyhedron, change the base ring and all the sudden I use a different backend, even though the old one would have worked.
> > 
> > Replying to [comment:10 vdelecroix]:
> > > I am not sure this is the right approach. The same code is copied in each single function. I think what is done with matrices is more sensible and the information about the backend is actually stored into the parents
> > > {{{
> > > sage: M1 = MatrixSpace(ZZ, 3, implementation='gap')
> > > sage: M1
> > > Full MatrixSpace of 3 by 3 dense matrices over Integer Ring (using Matrix_gap)
> > > sage: M2 = MatrixSpace(ZZ, 3, implementation='generic')
> > > sage: M2
> > > Full MatrixSpace of 3 by 3 dense matrices over Integer Ring (using Matrix_generic_dense)
> > > }}}
> > > The rules about promotions such as
> > > {{{
> > > sage: parent(M1.an_element() * M2.an_element())
> > > Full MatrixSpace of 3 by 3 dense matrices over Integer Ring
> > > }}}
> > > are handled by the parents and this is what it should be done for polyhedra as well.



---

archive/issue_comments_390893.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-06T14:41:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390893",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390894.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-06T14:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390894",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390895.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-06-06T14:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390895",
    "user": "@kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_390896.json:
```json
{
    "body": "I think the logic in `change_ring` would better be simplified to\n\n```\n        if ambient_dim is None:\n            ambient_dim = self.ambient_dim()\n\n        if base_ring == self.base_ring() and \\\n           ambient_dim == self.ambient_dim() and \\\n           backend is None or backend == self.backend():\n                return self\n\n        # if not specified, try the same backend\n        if backend is None and does_backend_handle_base_ring(base_ring, self.backend()):\n            return Polyhedra(base_ring, ambient_dim, backend=self.backend())\n\n        return Polyhedra(base_ring, ambient_dim, backend=backend)\n```\n\n\nAlso, you should add more examples to `change_ring`. In particular when something has changed with respect to older versions such as\n\n```\nsage: Polyhedra(QQ, 3, backend='cdd').change_ring(RDF).backend()\n'cdd'\n```\n",
    "created_at": "2019-06-07T05:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390896",
    "user": "@videlec"
}
```

I think the logic in `change_ring` would better be simplified to

```
        if ambient_dim is None:
            ambient_dim = self.ambient_dim()

        if base_ring == self.base_ring() and \
           ambient_dim == self.ambient_dim() and \
           backend is None or backend == self.backend():
                return self

        # if not specified, try the same backend
        if backend is None and does_backend_handle_base_ring(base_ring, self.backend()):
            return Polyhedra(base_ring, ambient_dim, backend=self.backend())

        return Polyhedra(base_ring, ambient_dim, backend=backend)
```


Also, you should add more examples to `change_ring`. In particular when something has changed with respect to older versions such as

```
sage: Polyhedra(QQ, 3, backend='cdd').change_ring(RDF).backend()
'cdd'
```




---

archive/issue_comments_390897.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-06-07T05:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390897",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_390898.json:
```json
{
    "body": "Replying to [comment:12 vdelecroix]:\n> Though at this point, I don't quite understand the difference between `base_extend` and `change_ring`... that would better be clarified.\n\n`base_extend` is a calque from the same function for example for matrices, that creates a new parent with an extended ring and coerces `self` into this new parent and returns it.\n\nAs Jonathan said, this can only go in one direction and was not really adapted to polyhedra objects. This led to introduce `change_ring` to have all the flexibility possible (and perhaps a more intuitive name than `base_extend`) and because you can't really change ring without caring about the backend, `change_backend` and `change_ring` are bound to have fuzzy differences and may even call eachother (hopefully in only 1 direction!).\n\nSo yes, it is subtle and I am all in favor of rationalizing `base_extend`, `change_ring` and `change_backend` (which is not all there yet).",
    "created_at": "2019-06-07T07:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390898",
    "user": "@jplab"
}
```

Replying to [comment:12 vdelecroix]:
> Though at this point, I don't quite understand the difference between `base_extend` and `change_ring`... that would better be clarified.

`base_extend` is a calque from the same function for example for matrices, that creates a new parent with an extended ring and coerces `self` into this new parent and returns it.

As Jonathan said, this can only go in one direction and was not really adapted to polyhedra objects. This led to introduce `change_ring` to have all the flexibility possible (and perhaps a more intuitive name than `base_extend`) and because you can't really change ring without caring about the backend, `change_backend` and `change_ring` are bound to have fuzzy differences and may even call eachother (hopefully in only 1 direction!).

So yes, it is subtle and I am all in favor of rationalizing `base_extend`, `change_ring` and `change_backend` (which is not all there yet).



---

archive/issue_comments_390899.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-07T13:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390899",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390900.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-06-07T13:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390900",
    "user": "@kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_390901.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-08T12:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390901",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_390902.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-27T20:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390902",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_390903.json:
```json
{
    "body": "Not in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were *actually* included, especially when closing tickets.",
    "created_at": "2019-07-03T11:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390903",
    "user": "@embray"
}
```

Not in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were *actually* included, especially when closing tickets.



---

archive/issue_comments_390904.json:
```json
{
    "body": "Barycentric subdivision was forgotten... :-(",
    "created_at": "2019-08-30T13:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27689",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27689#issuecomment-390904",
    "user": "@jplab"
}
```

Barycentric subdivision was forgotten... :-(
