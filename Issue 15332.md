# Issue 15332: upgrade sagenb to version 0.10.7.3

Issue created by migration from https://trac.sagemath.org/ticket/15569

Original creator: ohanar

Original creation time: 2013-12-23 03:33:25

CC:  schilly

Includes a number of small bug fixes.

"Upstream" Tarball: [sagenb-0.10.7.3.tar](http://boxen.math.washington.edu/home/ohanar/upstream/sagenb-0.10.7.3.tar)


---

Comment by ohanar created at 2013-12-23 03:33:32

Changing status from new to needs_review.


---

Comment by git created at 2013-12-23 03:43:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2013-12-23 18:01:53

Changing status from needs_review to needs_work.


---

Comment by jhpalmieri created at 2013-12-23 18:01:53

On two different OS X machines, I get a doctest failure:

```
sage -t src/sage/all.py
**********************************************************************
File "src/sage/all.py", line 30, in sage.all
Failed example:
    for i in frames:
        filename, lineno, funcname, linelist, indx = inspect.getframeinfo(i)
        for nm in allowed:
            if nm in filename:
                break
        else:
            print filename
Expected nothing
Got:
    /Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/pytz-20\
13.8-py2.7.egg/pytz/__init__.py
**********************************************************************
```



---

Comment by jhpalmieri created at 2013-12-23 23:56:01

Downgrading `pytz` to the version in sagenb-0.10.7.2 seems to fix the problem. Can you put together a new tarball with that change?


---

Comment by git created at 2013-12-24 00:16:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ohanar created at 2013-12-24 00:18:34

Changing status from needs_work to needs_review.


---

Comment by ohanar created at 2013-12-24 00:18:34

Replying to [comment:4 jhpalmieri]:
> Downgrading `pytz` to the version in sagenb-0.10.7.2 seems to fix the problem.

sagenb's `dist.sh` script seems to just grab the most recent release of its dependencies.

> Can you put together a new tarball with that change?

Ok, done.


---

Comment by ohanar created at 2013-12-24 00:19:51

Changing status from needs_review to needs_work.


---

Comment by ohanar created at 2013-12-24 00:19:51

Actually, this seems to break the build. Will look at it later.


---

Comment by jhpalmieri created at 2013-12-24 01:14:08

I guess if you're using an older version of `pytz` so you're making the tarball manually, then you have to update (or regress) `install_order` by hand, too. Is that the problem?


---

Comment by ppurka created at 2013-12-24 02:45:19

I think if we want to install pytz within a range, we should use the following in `util/fetch_deps.py`:

```
                    , 'pytz >=2011n, <=2013b'
```



---

Comment by jhpalmieri created at 2013-12-24 02:47:47

Here's a new version.
----
New commits:


---

Comment by jhpalmieri created at 2013-12-24 02:58:43

I'm not sure why this included the changes from #15570, and I don't have time to figure out git well enough to fix it right now...


---

Comment by jhpalmieri created at 2013-12-24 05:17:29

New commits:


---

Comment by jhpalmieri created at 2013-12-24 05:17:29

Changing status from needs_work to needs_review.


---

Comment by ppurka created at 2013-12-25 08:24:51

Please check the [pull request 194](https://github.com/sagemath/sagenb/pull/194) which should fix openid logins. If possible, we should not release yet another broken sagenb.


---

Comment by ppurka created at 2013-12-25 08:28:59

I must add that I had no errors with the latest pytz on Linux x64 machine. So, the error seems MacOSX specific.

_Edit_ Sorry, I just now noticed that the error was not in sagenb but in sage.


---

Comment by ppurka created at 2013-12-29 16:38:10

I don't understand one thing. I ran the following commands

```
# Make the sagenb package
~/Installations/sagenb» ./dist.sh
~/Installations/sagenb» cp -a dist sagenb-0.10.8
~/Installations/sagenb» tar cf sagenb-0.10.8.tar sagenb-0.10.8
~/Installations/sagenb» mv sagenb-0.10.8.tar ~/Installations/sage/upstream/.

# Prepare the sagenb package in sage
~/Installations/sage» ./sage --dev checkout --ticket 15569
~/Installations/sage» echo "0.10.8" > build/pkgs/sagenb/package-version.txt
~/Installations/sage» mv upstream/sagenb-0.10.7.2.tar.bz2 /tmp
~/Installations/sage» sage -sh -c sage-fix-pkg-checksums

# Check the diff before committing
~/Installations/sage» git diff
diff --git a/build/pkgs/sagenb/checksums.ini b/build/pkgs/sagenb/checksums.ini
index 7843f0e..2f4e2e6 100644
--- a/build/pkgs/sagenb/checksums.ini
+++ b/build/pkgs/sagenb/checksums.ini
@@ -1,4 +1,4 @@
-tarball=sagenb-VERSION.tar
-sha1=7a822ca573748fcd2034a8cd887b813876ea036d
-md5=04af0903431905d9ac3e65d0e636a040
-cksum=624578127
+tarball=sagenb-VERSION.tar.sagenb-0.10.8.tar
+sha1=17ae39492a1176efbc62006315afb025c4b19d92
+md5=23b448c9d5207bfa017640d32a013b6f
+cksum=2809114274
diff --git a/build/pkgs/sagenb/package-version.txt b/build/pkgs/sagenb/package-version.txt
index e0ee8dd..1a46c7f 100644
--- a/build/pkgs/sagenb/package-version.txt
+++ b/build/pkgs/sagenb/package-version.txt
@@ -1 +1 @@
-0.10.7.3
+0.10.8
```


Why is the `tarball` line so weird. Should I fix it by hand?

```
+tarball=sagenb-VERSION.tar.sagenb-0.10.8.tar
```


I noticed that the branch in this ticket is very behind develop. Is the above weird tarball naming fixed in develop? If so, I can try to merge develop on to this ticket and then make changes from there.

```
~/Installations/sage» git diff --stat develop ticket/15569 | tail -n 1
 135 files changed, 3421 insertions(+), 10729 deletions(-)
```



---

Comment by ohanar created at 2013-12-29 20:29:12

You should fix it by hand, there is a bug in the `sage-fix-pkg-checksums` script that is fixed in #15570, but that won't be in develop until Volker releases the next beta.


---

Comment by ohanar created at 2013-12-29 20:29:12

Changing status from needs_review to needs_work.


---

Comment by ppurka created at 2013-12-30 03:33:15

Changing status from needs_work to needs_review.


---

Comment by ppurka created at 2013-12-30 03:33:15

New commits:


---

Comment by ohanar created at 2013-12-30 04:38:13

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-02-01 00:10:09

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2014-02-01 00:10:09

Our build system doesn't accept tar files, it must be .gz or .bz2.


---

Comment by vbraun created at 2014-02-01 00:11:55

Rather, the tarball mirror script (`/home/sagemath/www2-dev/mirror_upstream.py`) for the web page doesn't understand .tar. Harald, do you think that is fixable?


---

Comment by vbraun created at 2014-02-01 00:11:55

Changing status from needs_work to needs_info.


---

Comment by vbraun created at 2014-02-01 12:25:39

Harald says that this can be fixed ;-)


---

Comment by ppurka created at 2014-02-01 13:21:11

Replying to [comment:25 vbraun]:
> Harald says that this can be fixed ;-)
Great! It makes little sense to compress the sagenb tarball since it consists of compressed tarballs. :)


---

Comment by vbraun created at 2014-02-01 23:27:27

Changing status from needs_info to positive_review.


---

Comment by ppurka created at 2014-02-02 00:19:55

Changing status from positive_review to needs_work.


---

Comment by ppurka created at 2014-02-02 00:19:55

Better wait for 0.10.8.1; see https://github.com/sagemath/sagenb/issues/195


---

Comment by ppurka created at 2014-02-02 00:19:55

Changing keywords from "" to "merge #195".


---

Comment by jhpalmieri created at 2014-02-02 03:18:10

That pull request fixes the problem for me, so I would suggest getting 0.10.8.1 into Sage (and releasing maybe version 6.1.1 of Sage) as soon as possible. Having a broken notebook is bad...


---

Comment by vbraun created at 2014-02-02 11:04:54

I've made #15778 for the 0.10.8.1 upgrade. Ideally with a doctest in Sage so that it doesn't happen again...


---

Comment by vbraun created at 2014-02-02 11:04:54

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2014-02-02 11:55:17

Resolution: fixed
