# Issue 19022: subrings of the symbolic ring

Issue created by migration from https://trac.sagemath.org/ticket/19259

Original creator: dkrenn

Original creation time: 2015-09-20 17:40:33

CC:  behackl cheuberg

We create subrings of the symbolic ring, which allow or reject a given set of variables.


---

Comment by rws created at 2015-09-21 08:47:40

The (unregistered, yours?) patchbot seems to have problems, but probably not with this branch. I'm in favor of this enhancement as it allows some solutions to other tickets.
----
Last 10 new commits:


---

Comment by dkrenn created at 2015-09-21 11:54:07

Changing status from new to needs_review.


---

Comment by dkrenn created at 2015-09-21 11:54:07

Replying to [comment:2 rws]:
> The (unregistered, yours?) patchbot seems to have problems, but probably not with this branch. 

Yes, it is my patchbot. I think something related to the upgrade to beta7 ...

>I'm in favor of this enhancement as it allows some solutions to other tickets.

Good :)

(Which tickets are these?)


---

Comment by rws created at 2015-09-21 12:39:04

Replying to [comment:3 dkrenn]:
> Replying to [comment:2 rws]:
> >I'm in favor of this enhancement as it allows some solutions to other tickets.
> 
> Good :)
> 
> (Which tickets are these?)
See comment 57 of #12967 by vbraun: "The symbolic constants, like pi.pyobject(), should be elements in some parent set. The symbolic constants can then coerce into the infinity ring, solving the pi.pyobject() < oo == False issue."

Consequently this would be good for #19040.


---

Comment by novoselt created at 2015-09-21 17:18:22

This is fantastic! Don't plan to review it as I am not an expert on coersion stuff, but looks very good. I am only not quite sure that `only_constants` deserves to be a parameter: it can be implemented by accepting no variables and if `SR.subring(accepting_variables=())` looks bad and non-obvious, than perhaps there should be a shortcut for it `SR.subring_of_constants()`?


---

Comment by dkrenn created at 2015-09-22 07:17:24

Replying to [comment:6 novoselt]:
> This is fantastic!

Good to hear :)

> Don't plan to review it as I am not an expert on coersion stuff, but looks very good.

You could review the non-coercion part ;)

> I am only not quite sure that `only_constants` deserves to be a parameter: it can be implemented by accepting no variables and if `SR.subring(accepting_variables=())` looks bad and non-obvious, than perhaps there should be a shortcut for it `SR.subring_of_constants()`?

My feeling is that some kind of shortcut to this special ring is convenient to have (and it is also good to mention this subring explicitly somewhere). Thus, `+1` that there is some kind of explicit way to create the subring of symbolic constants.
However, I am open on how this should be achieved. My indention was having one method `subring` which can create all kind of subrings (cf. Unix philosophy: Do One Thing and Do It Well).


---

Comment by rws created at 2015-09-22 07:48:27

Ah, with constant you mean no symbols (maybe better clarify). Yeah I make that distinction in #19040 often enough so it seems very natural.


---

Comment by dkrenn created at 2015-09-22 08:04:23

Replying to [comment:8 rws]:
> Ah, with constant you mean no symbols (maybe better clarify). Yeah I make that distinction in #19040 often enough so it seems very natural.

Keyword `only_constants` --> `no_symbols` ? (And maybe all occurrences of `variable` --> `symbol`? What is the best terminology?)


---

Comment by rws created at 2015-09-22 08:25:47

Replying to [comment:9 dkrenn]:
> Replying to [comment:8 rws]:
> > Ah, with constant you mean no symbols (maybe better clarify). Yeah I make that distinction in #19040 often enough so it seems very natural.
> 
> Keyword `only_constants` --> `no_symbols` ?
Or `no_variables`.

> (And maybe all occurrences of `variable` --> `symbol`?
Not necessary IMO.


---

Comment by git created at 2015-09-22 09:04:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2015-09-22 09:05:51

Replying to [comment:10 rws]:
> > Keyword `only_constants` --> `no_symbols` ?
> Or `no_variables`.

Fits good; renamed.


---

Comment by git created at 2015-10-19 13:05:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2015-10-19 13:17:51

Replying to [comment:13 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[e4837e9](http://git.sagemath.org/sage.git/commit/?id=e4837e9b4f2e9edff62ae0bb192a406c44cba561)||`correct parent of result of an_element`||

Small commit to correct the parent. Needs_review.


---

Comment by behackl created at 2016-01-22 01:59:57

Hello! I started reviewing this ticket, and for now, I have the following comments:

- `is_variable_valid` --> `has_valid_variable` or `allows_variable`? This would be a semantic improvement as the current version does not really fit to the other `parent.is_*`-methods, IMHO.
- While it is OK that the subring factory checks that every element in the `vars`-tuple can be thrown into `SR` in `SymbolicSubringFactory.create_key_and_extra_args`, the elements are not checked for being valid identifiers. I'd suggest to do so either in the factory, or directly in `GenericSymbolicSubring.__init__`. Otherwise, this is possible:

```
sage: SR.subring(accepting_variables=(0, pi, sqrt(2), I))
Symbolic Subring accepting the variables 0, I, pi, sqrt(2)
```


I also have some minor changes (language etc.) which I will push as soon as I am done with my review.


---

Comment by git created at 2016-01-23 09:05:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-01-23 09:06:59

Replying to [comment:15 behackl]:
> Hello! I started reviewing this ticket, and for now, I have the following comments:
> 
> - `is_variable_valid` --> `has_valid_variable` or `allows_variable`? This would be a semantic improvement as the current version does not really fit to the other `parent.is_*`-methods, IMHO.

I agree; changed.

> - While it is OK that the subring factory checks that every element in the `vars`-tuple can be thrown into `SR` in `SymbolicSubringFactory.create_key_and_extra_args`, the elements are not checked for being valid identifiers. I'd suggest to do so either in the factory, or directly in `GenericSymbolicSubring.__init__`. 

Added check.

> Otherwise, this is possible:
> {{{
> sage: SR.subring(accepting_variables=(0, pi, sqrt(2), I))
> Symbolic Subring accepting the variables 0, I, pi, sqrt(2)
> }}}

Doctest added.


---

Comment by behackl created at 2016-01-23 11:42:55

Thanks, this resolves these two issues.

Besides some minor changes to the code and documentation, I noticed that the `merge` methods for the functors were doing the wrong thing:
- merging two accepting functors should give an accepting functor with the intersection of the variables,
- merging two rejecting functors should give a rejecting functor with the union of the variables,
- when merging a rejecting and an accepting functor, the result has to to be an accepting functor with all accepted variables, but without the rejected ones.

I adapted the code accordingly.

In principle, this would be a `positive_review` from my side, however, I'd like to rewrite your code some more such that subrings of subrings can be constructed as well. The easiest way to do so (probably), is to let the functors do everything.
----
Last 10 new commits:


---

Comment by cheuberg created at 2016-01-23 13:54:27

Replying to [comment:18 behackl]:
>> In principle, this would be a `positive_review` from my side, however, I'd like to rewrite your code some more such that subrings of subrings can be constructed as well. The easiest way to do so (probably), is to let the functors do everything.

The question is whether to postpone the rewriting to a follow-up ticket (i.e., does your planned rewriting affect the interface or is it just internal rewriting which will then allow new things to be done?) This also in view of several tickets depending on this ticket here.


---

Comment by dkrenn created at 2016-01-23 16:11:03

Replying to [comment:18 behackl]:
> Besides some minor changes to the code and documentation,

Cross-review of the minor things positive, but ...

> I noticed that the `merge` methods for the functors were doing the wrong thing:
> - merging two accepting functors should give an accepting functor with the intersection of the variables,
> - merging two rejecting functors should give a rejecting functor with the union of the variables,
> - when merging a rejecting and an accepting functor, the result has to to be an accepting functor with all accepted variables, but without the rejected ones.

No, `merge` is correct. Composition means creating a larger subring, which contains both the corresonding rings (it is used in pushout).
So please `git revert` 

> ||[8cc884a](http://git.sagemath.org/sage.git/commit/?id=8cc884a527e7d72fe125509c8f1cfa556ee83773)||`fix merge of functors`||

and

> ||[c4a0e22](http://git.sagemath.org/sage.git/commit/?id=c4a0e226b7fa34959d990be3bb768d270fd7f9a5)||`merge accepting and rejecting functors in all cases`||


---

Comment by dkrenn created at 2016-01-23 16:11:45

Replying to [comment:19 cheuberg]:
> Replying to [comment:18 behackl]:
> >> In principle, this would be a `positive_review` from my side, however, I'd like to rewrite your code some more such that subrings of subrings can be constructed as well. The easiest way to do so (probably), is to let the functors do everything.
> 
> The question is whether to postpone the rewriting to a follow-up ticket (i.e., does your planned rewriting affect the interface or is it just internal rewriting which will then allow new things to be done?) This also in view of several tickets depending on this ticket here.

+1 for postpone to follow-up ticket.


---

Comment by git created at 2016-01-23 16:29:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by behackl created at 2016-01-23 16:37:05

Replying to [comment:20 dkrenn]:
> No, `merge` is correct. Composition means creating a larger subring, which contains both the corresonding rings (it is used in pushout).
> So please `git revert` 

Done. I thought of composition instead of something that is used in the construction of the pushout, sorry.

My approach requires an implemented compoisiton of functors; I'll take care of that in a follow-up ticket.

As you have reviewed my changes, I'll set this to `positive_review` after building and checking the documentation again.


---

Comment by behackl created at 2016-01-23 16:47:14

Changing status from needs_review to positive_review.


---

Comment by dkrenn created at 2016-01-23 17:54:03

Reviewer(s), please insert your name(s) in the corresponding field of the ticket.


---

Comment by vbraun created at 2016-01-24 12:52:50

Resolution: fixed
