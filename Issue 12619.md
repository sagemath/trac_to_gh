# Issue 12619: Running time improvements of some (di)graphs products

Issue created by migration from https://trac.sagemath.org/ticket/12791

Original creator: dcoudert

Original creation time: 2012-04-02 12:10:27

Assignee: jason, ncohen, rlm

Keywords: graph, digraph, product

This patch improves the running time of: !`tensor_product`, !`lexicographic_product`, !`strong_product`, !`disjunctive_product`.

The !`cartesian_product` function is part of patch #12770 (solving a bug).


---

Comment by dcoudert created at 2012-04-02 12:23:25

Some running time examples.

** Digraphs Before this patch 

```
sage: G = digraphs.DeBruijn(2,4)
sage: H = digraphs.Kautz(3,3)
sage: %timeit G.tensor_product(H)
5 loops, best of 3: 848 ms per loop
sage: %timeit G.lexicographic_product(H)
5 loops, best of 3: 955 ms per loop
sage: %timeit G.strong_product(H)
5 loops, best of 3: 2.29 s per loop
sage: %timeit G.disjunctive_product(H)
5 loops, best of 3: 1.62 s per loop
```


** Digraphs With this patch 

```
sage: G = digraphs.DeBruijn(2,4)
sage: H = digraphs.Kautz(3,3)
sage: %timeit G.tensor_product(H)
25 loops, best of 3: 34.7 ms per loop
sage: %timeit G.lexicographic_product(H)
5 loops, best of 3: 327 ms per loop
sage: %timeit G.strong_product(H)
5 loops, best of 3: 55.8 ms per loop
sage: %timeit G.disjunctive_product(H)
5 loops, best of 3: 522 ms per loop
```


** Graphs Before this patch 

```
sage: G = graphs.GridGraph([5,5])
sage: H = graphs.PappusGraph()
sage: %timeit G.tensor_product(H)
5 loops, best of 3: 550 ms per loop
sage: %timeit G.lexicographic_product(H)
5 loops, best of 3: 605 ms per loop
sage: %timeit G.strong_product(H)
5 loops, best of 3: 1.44 s per loop
sage: %timeit G.disjunctive_product(H)
5 loops, best of 3: 1.07 s per loop
```


** Graphs With this patch

```
sage: G = graphs.GridGraph([5,5])
sage: H = graphs.PappusGraph()
sage: %timeit G.tensor_product(H)
25 loops, best of 3: 15.2 ms per loop
sage: %timeit G.lexicographic_product(H)
5 loops, best of 3: 111 ms per loop
sage: %timeit G.strong_product(H)
25 loops, best of 3: 26.4 ms per loop
sage: %timeit G.disjunctive_product(H)
5 loops, best of 3: 237 ms per loop
```



---

Comment by dcoudert created at 2012-04-02 12:23:25

Changing status from new to needs_review.


---

Comment by dcoudert created at 2012-04-02 22:36:32

Minor change to allow loops in directed graphs.


---

Comment by dcoudert created at 2012-04-03 12:27:55

Addition of a more interesting test on the tensor product: DeBruijn(d1, D) product DeBruijn(d2, D) = DeBruijn( d1*d2, D). It allows to test digraphs with loops.


---

Attachment

change of error message.


---

Comment by ncohen created at 2012-04-07 11:14:22

My GOD ! This code really needed to be rewritten `:-D`

Ok, the patch is good to go, but I just add a few modifications so that the math in the documentation appear as maths in the HTML file.

Nathann


---

Attachment


---

Comment by dcoudert created at 2012-04-07 11:50:29

Yes, the code was... to be fully rewritten. It was the same for patch #12770 in which the example I gave was impossible to run with original code. 

With your review patch the doc is well displayed. So the patch is also good to go for me.

However, I don't understand the dependency with patch #12770 since I can install this patch independently of patch #12770.

I let you conclude on this patch.


---

Comment by ncohen created at 2012-04-07 11:52:58

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2012-04-07 11:52:58

> However, I don't understand the dependency with patch #12770 since I can install this patch independently of patch #12770.

Oh well, you mentionned it in the ticket and I thought it was better to apply this patch after the other one (can the other one be applied after this one, though ?) 

Anyway it does not change much, as both of them are now... reviewed `:-)`

Nathann


---

Comment by dcoudert created at 2012-04-07 11:59:02

Yes, I'm able to install patch #12770 after this one. But it makes no difference, so you can let it as it is.

Thanks for the review. Now we have an elegant test with DeBruijn digraphs products ;-)


---

Comment by dcoudert created at 2012-04-17 11:47:52

Changing status from positive_review to needs_work.


---

Attachment

This additional patch uses edge_iterator instead of edges(). This is slightly faster.


---

Comment by dcoudert created at 2012-04-17 11:49:36

I'm removing the dependency on patch #12770 since the patchs are independents.


---

Comment by dcoudert created at 2012-04-17 11:49:36

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2012-04-17 13:02:11

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2012-04-17 13:02:11

Well... As tests still pass `:-)`

Nathann


---

Comment by dcoudert created at 2012-04-17 13:08:15

Thanks Nathann ;-)


---

Comment by jdemeyer created at 2012-04-19 06:41:06

Resolution: fixed


---

Comment by ncohen created at 2012-11-11 10:38:54

For some reason trac_12791-edge-iterator.patch has not been added to Sage with the other patches from this ticket. This is fixed in #13699.

Nathann
