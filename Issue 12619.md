# Issue 12619: Running time improvements of some (di)graphs products

archive/issues_012619.json:
```json
{
    "body": "Assignee: jason, ncohen, rlm\n\nKeywords: graph, digraph, product\n\nThis patch improves the running time of: !`tensor_product`, !`lexicographic_product`, !`strong_product`, !`disjunctive_product`.\n\nThe !`cartesian_product` function is part of patch #12770 (solving a bug).\n\nIssue created by migration from https://trac.sagemath.org/ticket/12791\n\n",
    "created_at": "2012-04-02T12:10:27Z",
    "labels": [
        "graph theory",
        "major",
        "enhancement"
    ],
    "title": "Running time improvements of some (di)graphs products",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12619",
    "user": "dcoudert"
}
```
Assignee: jason, ncohen, rlm

Keywords: graph, digraph, product

This patch improves the running time of: !`tensor_product`, !`lexicographic_product`, !`strong_product`, !`disjunctive_product`.

The !`cartesian_product` function is part of patch #12770 (solving a bug).

Issue created by migration from https://trac.sagemath.org/ticket/12791





---

archive/issue_comments_150066.json:
```json
{
    "body": "Some running time examples.\n\n** Digraphs Before this patch \n\n```\nsage: G = digraphs.DeBruijn(2,4)\nsage: H = digraphs.Kautz(3,3)\nsage: %timeit G.tensor_product(H)\n5 loops, best of 3: 848 ms per loop\nsage: %timeit G.lexicographic_product(H)\n5 loops, best of 3: 955 ms per loop\nsage: %timeit G.strong_product(H)\n5 loops, best of 3: 2.29 s per loop\nsage: %timeit G.disjunctive_product(H)\n5 loops, best of 3: 1.62 s per loop\n```\n\n\n** Digraphs With this patch \n\n```\nsage: G = digraphs.DeBruijn(2,4)\nsage: H = digraphs.Kautz(3,3)\nsage: %timeit G.tensor_product(H)\n25 loops, best of 3: 34.7 ms per loop\nsage: %timeit G.lexicographic_product(H)\n5 loops, best of 3: 327 ms per loop\nsage: %timeit G.strong_product(H)\n5 loops, best of 3: 55.8 ms per loop\nsage: %timeit G.disjunctive_product(H)\n5 loops, best of 3: 522 ms per loop\n```\n\n\n** Graphs Before this patch \n\n```\nsage: G = graphs.GridGraph([5,5])\nsage: H = graphs.PappusGraph()\nsage: %timeit G.tensor_product(H)\n5 loops, best of 3: 550 ms per loop\nsage: %timeit G.lexicographic_product(H)\n5 loops, best of 3: 605 ms per loop\nsage: %timeit G.strong_product(H)\n5 loops, best of 3: 1.44 s per loop\nsage: %timeit G.disjunctive_product(H)\n5 loops, best of 3: 1.07 s per loop\n```\n\n\n** Graphs With this patch\n\n```\nsage: G = graphs.GridGraph([5,5])\nsage: H = graphs.PappusGraph()\nsage: %timeit G.tensor_product(H)\n25 loops, best of 3: 15.2 ms per loop\nsage: %timeit G.lexicographic_product(H)\n5 loops, best of 3: 111 ms per loop\nsage: %timeit G.strong_product(H)\n25 loops, best of 3: 26.4 ms per loop\nsage: %timeit G.disjunctive_product(H)\n5 loops, best of 3: 237 ms per loop\n```\n",
    "created_at": "2012-04-02T12:23:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150066",
    "user": "dcoudert"
}
```

Some running time examples.

** Digraphs Before this patch 

```
sage: G = digraphs.DeBruijn(2,4)
sage: H = digraphs.Kautz(3,3)
sage: %timeit G.tensor_product(H)
5 loops, best of 3: 848 ms per loop
sage: %timeit G.lexicographic_product(H)
5 loops, best of 3: 955 ms per loop
sage: %timeit G.strong_product(H)
5 loops, best of 3: 2.29 s per loop
sage: %timeit G.disjunctive_product(H)
5 loops, best of 3: 1.62 s per loop
```


** Digraphs With this patch 

```
sage: G = digraphs.DeBruijn(2,4)
sage: H = digraphs.Kautz(3,3)
sage: %timeit G.tensor_product(H)
25 loops, best of 3: 34.7 ms per loop
sage: %timeit G.lexicographic_product(H)
5 loops, best of 3: 327 ms per loop
sage: %timeit G.strong_product(H)
5 loops, best of 3: 55.8 ms per loop
sage: %timeit G.disjunctive_product(H)
5 loops, best of 3: 522 ms per loop
```


** Graphs Before this patch 

```
sage: G = graphs.GridGraph([5,5])
sage: H = graphs.PappusGraph()
sage: %timeit G.tensor_product(H)
5 loops, best of 3: 550 ms per loop
sage: %timeit G.lexicographic_product(H)
5 loops, best of 3: 605 ms per loop
sage: %timeit G.strong_product(H)
5 loops, best of 3: 1.44 s per loop
sage: %timeit G.disjunctive_product(H)
5 loops, best of 3: 1.07 s per loop
```


** Graphs With this patch

```
sage: G = graphs.GridGraph([5,5])
sage: H = graphs.PappusGraph()
sage: %timeit G.tensor_product(H)
25 loops, best of 3: 15.2 ms per loop
sage: %timeit G.lexicographic_product(H)
5 loops, best of 3: 111 ms per loop
sage: %timeit G.strong_product(H)
25 loops, best of 3: 26.4 ms per loop
sage: %timeit G.disjunctive_product(H)
5 loops, best of 3: 237 ms per loop
```




---

archive/issue_comments_150067.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-02T12:23:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150067",
    "user": "dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_150068.json:
```json
{
    "body": "Minor change to allow loops in directed graphs.",
    "created_at": "2012-04-02T22:36:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150068",
    "user": "dcoudert"
}
```

Minor change to allow loops in directed graphs.



---

archive/issue_comments_150069.json:
```json
{
    "body": "Addition of a more interesting test on the tensor product: DeBruijn(d1, D) product DeBruijn(d2, D) = DeBruijn( d1*d2, D). It allows to test digraphs with loops.",
    "created_at": "2012-04-03T12:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150069",
    "user": "dcoudert"
}
```

Addition of a more interesting test on the tensor product: DeBruijn(d1, D) product DeBruijn(d2, D) = DeBruijn( d1*d2, D). It allows to test digraphs with loops.



---

archive/issue_comments_150070.json:
```json
{
    "body": "Attachment\n\nchange of error message.",
    "created_at": "2012-04-05T13:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150070",
    "user": "dcoudert"
}
```

Attachment

change of error message.



---

archive/issue_comments_150071.json:
```json
{
    "body": "My GOD ! This code really needed to be rewritten `:-D`\n\nOk, the patch is good to go, but I just add a few modifications so that the math in the documentation appear as maths in the HTML file.\n\nNathann",
    "created_at": "2012-04-07T11:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150071",
    "user": "ncohen"
}
```

My GOD ! This code really needed to be rewritten `:-D`

Ok, the patch is good to go, but I just add a few modifications so that the math in the documentation appear as maths in the HTML file.

Nathann



---

archive/issue_comments_150072.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-04-07T11:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150072",
    "user": "ncohen"
}
```

Attachment



---

archive/issue_comments_150073.json:
```json
{
    "body": "Yes, the code was... to be fully rewritten. It was the same for patch #12770 in which the example I gave was impossible to run with original code. \n\nWith your review patch the doc is well displayed. So the patch is also good to go for me.\n\nHowever, I don't understand the dependency with patch #12770 since I can install this patch independently of patch #12770.\n\nI let you conclude on this patch.",
    "created_at": "2012-04-07T11:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150073",
    "user": "dcoudert"
}
```

Yes, the code was... to be fully rewritten. It was the same for patch #12770 in which the example I gave was impossible to run with original code. 

With your review patch the doc is well displayed. So the patch is also good to go for me.

However, I don't understand the dependency with patch #12770 since I can install this patch independently of patch #12770.

I let you conclude on this patch.



---

archive/issue_comments_150074.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-04-07T11:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150074",
    "user": "ncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_150075.json:
```json
{
    "body": "> However, I don't understand the dependency with patch #12770 since I can install this patch independently of patch #12770.\n\nOh well, you mentionned it in the ticket and I thought it was better to apply this patch after the other one (can the other one be applied after this one, though ?) \n\nAnyway it does not change much, as both of them are now... reviewed `:-)`\n\nNathann",
    "created_at": "2012-04-07T11:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150075",
    "user": "ncohen"
}
```

> However, I don't understand the dependency with patch #12770 since I can install this patch independently of patch #12770.

Oh well, you mentionned it in the ticket and I thought it was better to apply this patch after the other one (can the other one be applied after this one, though ?) 

Anyway it does not change much, as both of them are now... reviewed `:-)`

Nathann



---

archive/issue_comments_150076.json:
```json
{
    "body": "Yes, I'm able to install patch #12770 after this one. But it makes no difference, so you can let it as it is.\n\nThanks for the review. Now we have an elegant test with DeBruijn digraphs products ;-)",
    "created_at": "2012-04-07T11:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150076",
    "user": "dcoudert"
}
```

Yes, I'm able to install patch #12770 after this one. But it makes no difference, so you can let it as it is.

Thanks for the review. Now we have an elegant test with DeBruijn digraphs products ;-)



---

archive/issue_comments_150077.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-04-17T11:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150077",
    "user": "dcoudert"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_150078.json:
```json
{
    "body": "Attachment\n\nThis additional patch uses edge_iterator instead of edges(). This is slightly faster.",
    "created_at": "2012-04-17T11:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150078",
    "user": "dcoudert"
}
```

Attachment

This additional patch uses edge_iterator instead of edges(). This is slightly faster.



---

archive/issue_comments_150079.json:
```json
{
    "body": "I'm removing the dependency on patch #12770 since the patchs are independents.",
    "created_at": "2012-04-17T11:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150079",
    "user": "dcoudert"
}
```

I'm removing the dependency on patch #12770 since the patchs are independents.



---

archive/issue_comments_150080.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-04-17T11:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150080",
    "user": "dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_150081.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-04-17T13:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150081",
    "user": "ncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_150082.json:
```json
{
    "body": "Well... As tests still pass `:-)`\n\nNathann",
    "created_at": "2012-04-17T13:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150082",
    "user": "ncohen"
}
```

Well... As tests still pass `:-)`

Nathann



---

archive/issue_comments_150083.json:
```json
{
    "body": "Thanks Nathann ;-)",
    "created_at": "2012-04-17T13:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150083",
    "user": "dcoudert"
}
```

Thanks Nathann ;-)



---

archive/issue_comments_150084.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-04-19T06:41:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150084",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_150085.json:
```json
{
    "body": "For some reason trac_12791-edge-iterator.patch has not been added to Sage with the other patches from this ticket. This is fixed in #13699.\n\nNathann",
    "created_at": "2012-11-11T10:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12619",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12619#issuecomment-150085",
    "user": "ncohen"
}
```

For some reason trac_12791-edge-iterator.patch has not been added to Sage with the other patches from this ticket. This is fixed in #13699.

Nathann
