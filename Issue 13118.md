# Issue 13118: Upgrade MPC to version 1.0

archive/issues_013118.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  jpflori zimmerma\n\nCurrently, Sage uses a development version of MPC (stable 0.9 had build issues on certain platforms).\n\nUpgrade to the just-released MPC-1.0: [http://www.multiprecision.org/index.php?prog=mpc](http://www.multiprecision.org/index.php?prog=mpc)\n\nAt the same time, why not import `MPComplexField` by default and add MPC to the reference manual.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13290\n\n",
    "created_at": "2012-07-25T13:54:56Z",
    "labels": [
        "packages: standard",
        "minor",
        "enhancement"
    ],
    "title": "Upgrade MPC to version 1.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13118",
    "user": "jdemeyer"
}
```
Assignee: tbd

CC:  jpflori zimmerma

Currently, Sage uses a development version of MPC (stable 0.9 had build issues on certain platforms).

Upgrade to the just-released MPC-1.0: [http://www.multiprecision.org/index.php?prog=mpc](http://www.multiprecision.org/index.php?prog=mpc)

At the same time, why not import `MPComplexField` by default and add MPC to the reference manual.

Issue created by migration from https://trac.sagemath.org/ticket/13290





---

archive/issue_comments_159635.json:
```json
{
    "body": "FWIW, MPFR 3.1.1 has also recently been released.  (Don't know whether there's already a ticket to upgrade to that version.)",
    "created_at": "2012-07-25T15:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159635",
    "user": "leif"
}
```

FWIW, MPFR 3.1.1 has also recently been released.  (Don't know whether there's already a ticket to upgrade to that version.)



---

archive/issue_comments_159636.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-07-27T11:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159636",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_159637.json:
```json
{
    "body": "`s/Gnu Mpc/GNU MPC/` in `SPKG.txt` ;-)  (The original has small caps.)\n\nFor consistency, I wouldn't remove the error check and message in `spkg-check`.\n\nI also wouldn't comment out the patch loop; in case there are no patches, simply no patch should get applied, without raising an error message (either because `patches/` doesn't exist, or because there's no patch in `patches/` such that `../patches/*.patch` \"expands\" to itself).  Otherwise we uselessly keep creating and deleting directories, and commenting code out or reversing that each time patches again appear or all previous patches vanish.  Prepending\n\n```sh\nls ../patches/*.patch &>/dev/null &&\n```\n\nto the `for` loop should be sufficient.",
    "created_at": "2012-07-27T13:29:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159637",
    "user": "leif"
}
```

`s/Gnu Mpc/GNU MPC/` in `SPKG.txt` ;-)  (The original has small caps.)

For consistency, I wouldn't remove the error check and message in `spkg-check`.

I also wouldn't comment out the patch loop; in case there are no patches, simply no patch should get applied, without raising an error message (either because `patches/` doesn't exist, or because there's no patch in `patches/` such that `../patches/*.patch` "expands" to itself).  Otherwise we uselessly keep creating and deleting directories, and commenting code out or reversing that each time patches again appear or all previous patches vanish.  Prepending

```sh
ls ../patches/*.patch &>/dev/null &&
```

to the `for` loop should be sufficient.



---

archive/issue_comments_159638.json:
```json
{
    "body": "leif, I made some minor corrections you suggested.  I changed the patch loop to:\n\n```sh\n# Apply patches.  See SPKG.txt for information about what each patch\n# does.\nfor patch in ../patches/*.patch; do\n    [ -r \"$patch\" ] || continue\n    patch -p1 <\"$patch\"\n    if [ $? -ne 0 ]; then\n        echo >&2 \"Error applying '$patch'\"\n        exit 1\n    fi\ndone\n```\n",
    "created_at": "2012-07-27T13:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159638",
    "user": "jdemeyer"
}
```

leif, I made some minor corrections you suggested.  I changed the patch loop to:

```sh
# Apply patches.  See SPKG.txt for information about what each patch
# does.
for patch in ../patches/*.patch; do
    [ -r "$patch" ] || continue
    patch -p1 <"$patch"
    if [ $? -ne 0 ]; then
        echo >&2 "Error applying '$patch'"
        exit 1
    fi
done
```




---

archive/issue_comments_159639.json:
```json
{
    "body": "I also changed the developer documentation to change the \"patch loop\" as I did for MPC.",
    "created_at": "2012-07-27T14:01:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159639",
    "user": "jdemeyer"
}
```

I also changed the developer documentation to change the "patch loop" as I did for MPC.



---

archive/issue_comments_159640.json:
```json
{
    "body": "Oh, just reviewed the previous patch to the Sage library, which looked good except that you removed the formulas for the conjugate and the square of a complex number ;-), and some instances of `self` not typeset monospaced.",
    "created_at": "2012-07-27T14:06:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159640",
    "user": "leif"
}
```

Oh, just reviewed the previous patch to the Sage library, which looked good except that you removed the formulas for the conjugate and the square of a complex number ;-), and some instances of `self` not typeset monospaced.



---

archive/issue_comments_159641.json:
```json
{
    "body": "Replying to [comment:9 jdemeyer]:\n> I also changed the developer documentation to change the \"patch loop\" as I did for MPC.\n\nIs that the only change you made to the Sage library patch?  (It should better be a separate patch.)\n\nI'd rather use `[ -f \"$patch\" ]` instead of `[ -r \"$patch\" ]`.\n\nWhile you're at it, `$SAGE_ROOT` should be quoted in the Developer Guide's template.",
    "created_at": "2012-07-27T14:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159641",
    "user": "leif"
}
```

Replying to [comment:9 jdemeyer]:
> I also changed the developer documentation to change the "patch loop" as I did for MPC.

Is that the only change you made to the Sage library patch?  (It should better be a separate patch.)

I'd rather use `[ -f "$patch" ]` instead of `[ -r "$patch" ]`.

While you're at it, `$SAGE_ROOT` should be quoted in the Developer Guide's template.



---

archive/issue_comments_159642.json:
```json
{
    "body": "Replying to [comment:11 leif]:\n> I'd rather use `[ -f \"$patch\" ]` instead of `[ -r \"$patch\" ]`.\nActually I like `-r`, because like this one can intentionally disable a patch by `chmod`ing it `000`.",
    "created_at": "2012-07-27T14:40:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159642",
    "user": "jdemeyer"
}
```

Replying to [comment:11 leif]:
> I'd rather use `[ -f "$patch" ]` instead of `[ -r "$patch" ]`.
Actually I like `-r`, because like this one can intentionally disable a patch by `chmod`ing it `000`.



---

archive/issue_comments_159643.json:
```json
{
    "body": "Replying to [comment:12 jdemeyer]:\n> Replying to [comment:11 leif]:\n> > I'd rather use `[ -f \"$patch\" ]` instead of `[ -r \"$patch\" ]`.\n> Actually I like `-r`, because like this one can intentionally disable a patch by `chmod`ing it `000`.\n\nI was thinking of the same, but it's also a potential pitfall I think, and not very appropriate from an educational perspective... (unless you add a comment on that; people might think `-r` tests for a **r**egular file, and `[ -r <some directory> ]` is usually true as well).\n\n----\n\n\n```\n...\nchecking for CC and CFLAGS in gmp.h... yes CC=gcc-4.7.0 -std=gnu99 CFLAGS=-O2 -m64 -march=btver1 -mtune=btver1  -g -march=native -O3 -fno-strict-aliasing -DHONORS_CFLAGS\nchecking for CC=gcc-4.7.0 -std=gnu99 and CFLAGS=-O2 -m64 -march=btver1 -mtune=btver1  -g -march=native -O3 -fno-strict-aliasing -DHONORS_CFLAGS... yes\nchecking for gcc... (cached) gcc\nchecking whether we are using the GNU C compiler... (cached) yes\nchecking whether gcc accepts -g... (cached) yes\nchecking for gcc option to accept ISO C89... (cached) none needed\nchecking dependency style of gcc... (cached) gcc3\nchecking how to print strings... printf\nchecking for a sed that does not truncate output... (cached) /bin/sed\nchecking for fgrep... /bin/grep -F\nchecking for ld used by gcc... ld\nchecking if the linker (ld) is GNU ld... yes\nchecking for BSD- or MS-compatible name lister (nm)... /usr/local/bin/nm -B\nchecking the name lister (/usr/local/bin/nm -B) interface... BSD nm\nchecking whether ln -s works... yes\nchecking the maximum length of command line arguments... 1572864\nchecking whether the shell understands some XSI constructs... yes\nchecking whether the shell understands \"+=\"... yes\nchecking how to convert x86_64-unknown-linux-gnu file names to x86_64-unknown-linux-gnu format... func_convert_file_noop\nchecking how to convert x86_64-unknown-linux-gnu file names to toolchain format... func_convert_file_noop\nchecking for ld option to reload object files... -r\nchecking for objdump... objdump\nchecking how to recognize dependent libraries... pass_all\nchecking for dlltool... dlltool\nchecking how to associate runtime and link libraries... printf %s\\n\nchecking for archiver @FILE support... no\nchecking for strip... strip\nchecking for ranlib... ranlib\nchecking command to parse /usr/local/bin/nm -B output from gcc object... failed\nchecking for sysroot... no\nchecking for mt... mt\nchecking if mt is a manifest tool... no\nchecking how to run the C preprocessor... cpp-4.7.0\nchecking for ANSI C header files... no\nchecking for sys/types.h... no\nchecking for sys/stat.h... no\nchecking for stdlib.h... no\nchecking for string.h... no\nchecking for memory.h... no\nchecking for strings.h... no\nchecking for inttypes.h... no\nchecking for stdint.h... no\nchecking for unistd.h... no\nchecking for dlfcn.h... no\nchecking for objdir... .libs\nchecking if gcc supports -fno-rtti -fno-exceptions... no\nchecking for gcc option to produce PIC... -fPIC -DPIC\nchecking if gcc PIC flag -fPIC -DPIC works... no\nchecking if gcc static flag -static works... no\nchecking if gcc supports -c -o file.o... no\nchecking if gcc supports -c -o file.o... (cached) no\nchecking if we can lock with hard links... yes\nchecking whether the gcc linker (ld) supports shared libraries... yes\nchecking whether -lc should be explicitly linked in... \nchecking dynamic linker characteristics... GNU/Linux ld.so\nchecking how to hardcode library paths into programs... immediate\nchecking whether stripping libraries is possible... yes\nchecking if libtool supports shared libraries... yes\nchecking whether to build shared libraries... yes\nchecking whether to build static libraries... yes\nchecking for gmp.h... no\nconfigure: error: gmp.h cannot be found or is unusable.\nError configuring MPC.\n\nreal\t0m7.518s\nuser\t0m0.780s\nsys\t0m0.700s\n************************************************************************\nError installing package mpc-1.0\n************************************************************************\n```\n\n\nOoops!?\n\n(`$SAGE_LOCAL/include/gmp.h` is of course present and sane as well, as you can also see since MPC found `__GMP_CC` and `__GMP_CFLAGS`.)",
    "created_at": "2012-07-27T14:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159643",
    "user": "leif"
}
```

Replying to [comment:12 jdemeyer]:
> Replying to [comment:11 leif]:
> > I'd rather use `[ -f "$patch" ]` instead of `[ -r "$patch" ]`.
> Actually I like `-r`, because like this one can intentionally disable a patch by `chmod`ing it `000`.

I was thinking of the same, but it's also a potential pitfall I think, and not very appropriate from an educational perspective... (unless you add a comment on that; people might think `-r` tests for a **r**egular file, and `[ -r <some directory> ]` is usually true as well).

----


```
...
checking for CC and CFLAGS in gmp.h... yes CC=gcc-4.7.0 -std=gnu99 CFLAGS=-O2 -m64 -march=btver1 -mtune=btver1  -g -march=native -O3 -fno-strict-aliasing -DHONORS_CFLAGS
checking for CC=gcc-4.7.0 -std=gnu99 and CFLAGS=-O2 -m64 -march=btver1 -mtune=btver1  -g -march=native -O3 -fno-strict-aliasing -DHONORS_CFLAGS... yes
checking for gcc... (cached) gcc
checking whether we are using the GNU C compiler... (cached) yes
checking whether gcc accepts -g... (cached) yes
checking for gcc option to accept ISO C89... (cached) none needed
checking dependency style of gcc... (cached) gcc3
checking how to print strings... printf
checking for a sed that does not truncate output... (cached) /bin/sed
checking for fgrep... /bin/grep -F
checking for ld used by gcc... ld
checking if the linker (ld) is GNU ld... yes
checking for BSD- or MS-compatible name lister (nm)... /usr/local/bin/nm -B
checking the name lister (/usr/local/bin/nm -B) interface... BSD nm
checking whether ln -s works... yes
checking the maximum length of command line arguments... 1572864
checking whether the shell understands some XSI constructs... yes
checking whether the shell understands "+="... yes
checking how to convert x86_64-unknown-linux-gnu file names to x86_64-unknown-linux-gnu format... func_convert_file_noop
checking how to convert x86_64-unknown-linux-gnu file names to toolchain format... func_convert_file_noop
checking for ld option to reload object files... -r
checking for objdump... objdump
checking how to recognize dependent libraries... pass_all
checking for dlltool... dlltool
checking how to associate runtime and link libraries... printf %s\n
checking for archiver @FILE support... no
checking for strip... strip
checking for ranlib... ranlib
checking command to parse /usr/local/bin/nm -B output from gcc object... failed
checking for sysroot... no
checking for mt... mt
checking if mt is a manifest tool... no
checking how to run the C preprocessor... cpp-4.7.0
checking for ANSI C header files... no
checking for sys/types.h... no
checking for sys/stat.h... no
checking for stdlib.h... no
checking for string.h... no
checking for memory.h... no
checking for strings.h... no
checking for inttypes.h... no
checking for stdint.h... no
checking for unistd.h... no
checking for dlfcn.h... no
checking for objdir... .libs
checking if gcc supports -fno-rtti -fno-exceptions... no
checking for gcc option to produce PIC... -fPIC -DPIC
checking if gcc PIC flag -fPIC -DPIC works... no
checking if gcc static flag -static works... no
checking if gcc supports -c -o file.o... no
checking if gcc supports -c -o file.o... (cached) no
checking if we can lock with hard links... yes
checking whether the gcc linker (ld) supports shared libraries... yes
checking whether -lc should be explicitly linked in... 
checking dynamic linker characteristics... GNU/Linux ld.so
checking how to hardcode library paths into programs... immediate
checking whether stripping libraries is possible... yes
checking if libtool supports shared libraries... yes
checking whether to build shared libraries... yes
checking whether to build static libraries... yes
checking for gmp.h... no
configure: error: gmp.h cannot be found or is unusable.
Error configuring MPC.

real	0m7.518s
user	0m0.780s
sys	0m0.700s
************************************************************************
Error installing package mpc-1.0
************************************************************************
```


Ooops!?

(`$SAGE_LOCAL/include/gmp.h` is of course present and sane as well, as you can also see since MPC found `__GMP_CC` and `__GMP_CFLAGS`.)



---

archive/issue_comments_159644.json:
```json
{
    "body": "Replying to [comment:13 leif]:\n> {{{\n> ************************************************************************\n> Error installing package mpc-1.0\n> ************************************************************************\n> }}}\n> \n> Ooops!?\n> \n> (`$SAGE_LOCAL/include/gmp.h` is of course present and sane as well, as you can also see since MPC found `__GMP_CC` and `__GMP_CFLAGS`.)\n\n... and my environment and my Sage installation are sane; just successfully reinstalled the previous MPC spkg.",
    "created_at": "2012-07-27T14:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159644",
    "user": "leif"
}
```

Replying to [comment:13 leif]:
> {{{
> ************************************************************************
> Error installing package mpc-1.0
> ************************************************************************
> }}}
> 
> Ooops!?
> 
> (`$SAGE_LOCAL/include/gmp.h` is of course present and sane as well, as you can also see since MPC found `__GMP_CC` and `__GMP_CFLAGS`.)

... and my environment and my Sage installation are sane; just successfully reinstalled the previous MPC spkg.



---

archive/issue_comments_159645.json:
```json
{
    "body": "Despite looking for GMP's `CC`, upstream's `configure` apparently uses `gcc` in almost all tests (which is GCC 4.4.3, and which e.g. doesn't understand `-march=btver1` from GMP's/MPIR's  `CFLAGS`)!",
    "created_at": "2012-07-27T15:04:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159645",
    "user": "leif"
}
```

Despite looking for GMP's `CC`, upstream's `configure` apparently uses `gcc` in almost all tests (which is GCC 4.4.3, and which e.g. doesn't understand `-march=btver1` from GMP's/MPIR's  `CFLAGS`)!



---

archive/issue_comments_159646.json:
```json
{
    "body": "Replying to [comment:15 leif]:\n> Despite looking for GMP's `CC`, upstream's `configure` apparently uses `gcc` in almost all tests (which is GCC 4.4.3, and which e.g. doesn't understand `-march=btver1` from GMP's/MPIR's  `CFLAGS`)!\n\nReally?  Could you attach the config.log from mpc-1.0?",
    "created_at": "2012-07-27T15:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159646",
    "user": "jdemeyer"
}
```

Replying to [comment:15 leif]:
> Despite looking for GMP's `CC`, upstream's `configure` apparently uses `gcc` in almost all tests (which is GCC 4.4.3, and which e.g. doesn't understand `-march=btver1` from GMP's/MPIR's  `CFLAGS`)!

Really?  Could you attach the config.log from mpc-1.0?



---

archive/issue_comments_159647.json:
```json
{
    "body": "Not clear to me what's causing this; the change to `configure.ac` looks harmless, but they're also using newer autotools.\n\n\n```diff\n\n--- mpc-1.0.0dev1126.p1/src/configure.ac\t2012-02-21 15:21:29.000000000 +0100\n+++ mpc-1.0/src/configure.ac\t2012-07-19 14:33:51.000000000 +0200\n@@ -1,4 +1,4 @@\n-# Copyright (C) 2008, 2009, 2010, 2011 INRIA\n+# Copyright (C) 2008, 2009, 2010, 2011, 2012 INRIA\n #\n # This file is part of GNU MPC.\n #\n@@ -20,16 +20,23 @@\n # Process this file with autoconf to produce a configure script.\n \n AC_PREREQ(2.61)\n-AC_INIT(mpc, 1.0.0dev, mpc-discuss@lists.gforge.inria.fr)\n+AC_INIT(mpc, 1.0, mpc-discuss@lists.gforge.inria.fr)\n AC_CONFIG_SRCDIR([src/mpc-impl.h])\n AC_CONFIG_HEADER([config.h])\n \n AM_INIT_AUTOMAKE([1.9 -Wall -Werror])\n AM_MAINTAINER_MODE\n \n+USER_CC=$CC\n+USER_CFLAGS=$CFLAGS\n+\n+# automake 1.12 seems to require this, but automake 1.11 doesn't recognize it\n+m4_ifdef([AM_PROG_AR], [AM_PROG_AR])\n+\n AC_CANONICAL_HOST\n AC_CONFIG_MACRO_DIR([m4])\n \n+\n # Extra arguments to configure\n AC_ARG_WITH([mpfr_include],\n             [AC_HELP_STRING([--with-mpfr-include=DIR],\n@@ -96,7 +103,7 @@\n # at http://lists.gforge.inria.fr/pipermail/mpc-discuss/2012-January/001056.html\n AC_PROG_EGREP\n AC_PROG_SED\n-if test -z \"$CC\" && test -z \"$CFLAGS\"; then\n+if test -z \"$USER_CC\" && test -z \"$USER_CFLAGS\"; then\n    MPC_GMP_CC_CFLAGS\n fi\n \n@@ -105,7 +112,7 @@\n AC_LANG(C)\n \n # Set up LibTool\n-AC_PROG_LIBTOOL\n+LT_INIT\n \n```\n",
    "created_at": "2012-07-27T15:32:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159647",
    "user": "leif"
}
```

Not clear to me what's causing this; the change to `configure.ac` looks harmless, but they're also using newer autotools.


```diff

--- mpc-1.0.0dev1126.p1/src/configure.ac	2012-02-21 15:21:29.000000000 +0100
+++ mpc-1.0/src/configure.ac	2012-07-19 14:33:51.000000000 +0200
@@ -1,4 +1,4 @@
-# Copyright (C) 2008, 2009, 2010, 2011 INRIA
+# Copyright (C) 2008, 2009, 2010, 2011, 2012 INRIA
 #
 # This file is part of GNU MPC.
 #
@@ -20,16 +20,23 @@
 # Process this file with autoconf to produce a configure script.
 
 AC_PREREQ(2.61)
-AC_INIT(mpc, 1.0.0dev, mpc-discuss@lists.gforge.inria.fr)
+AC_INIT(mpc, 1.0, mpc-discuss@lists.gforge.inria.fr)
 AC_CONFIG_SRCDIR([src/mpc-impl.h])
 AC_CONFIG_HEADER([config.h])
 
 AM_INIT_AUTOMAKE([1.9 -Wall -Werror])
 AM_MAINTAINER_MODE
 
+USER_CC=$CC
+USER_CFLAGS=$CFLAGS
+
+# automake 1.12 seems to require this, but automake 1.11 doesn't recognize it
+m4_ifdef([AM_PROG_AR], [AM_PROG_AR])
+
 AC_CANONICAL_HOST
 AC_CONFIG_MACRO_DIR([m4])
 
+
 # Extra arguments to configure
 AC_ARG_WITH([mpfr_include],
             [AC_HELP_STRING([--with-mpfr-include=DIR],
@@ -96,7 +103,7 @@
 # at http://lists.gforge.inria.fr/pipermail/mpc-discuss/2012-January/001056.html
 AC_PROG_EGREP
 AC_PROG_SED
-if test -z "$CC" && test -z "$CFLAGS"; then
+if test -z "$USER_CC" && test -z "$USER_CFLAGS"; then
    MPC_GMP_CC_CFLAGS
 fi
 
@@ -105,7 +112,7 @@
 AC_LANG(C)
 
 # Set up LibTool
-AC_PROG_LIBTOOL
+LT_INIT
 
```




---

archive/issue_comments_159648.json:
```json
{
    "body": "`config.log` from MPC 1.0 spkg showing use of `gcc` instead of `gmp.h`'s CC",
    "created_at": "2012-07-27T15:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159648",
    "user": "leif"
}
```

`config.log` from MPC 1.0 spkg showing use of `gcc` instead of `gmp.h`'s CC



---

archive/issue_comments_159649.json:
```json
{
    "body": "Attachment\n\nReplying to [comment:16 jdemeyer]:\n> Could you attach the config.log from mpc-1.0?\n\nDid so.  Quite long; the relevant parts seem\n\n```\nconfigure:2930: checking for gcc\nconfigure:2946: found /usr/bin/gcc\nconfigure:2957: result: gcc\nconfigure:3186: checking for C compiler version\nconfigure:3195: gcc --version >&5\ngcc (Ubuntu 4.4.3-4ubuntu5.1) 4.4.3\nCopyright (C) 2009 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n\nconfigure:3206: $? = 0\n\n...\n\nconfigure:4394: checking for CC and CFLAGS in gmp.h\nconfigure:4420: result: yes CC=gcc-4.7.0 -std=gnu99 CFLAGS=-O2 -m64 -march=btver1 -mtune=btver1  -g -march=native -O3 -fno-strict-aliasing -DHONORS_CFLAGS\nconfigure:4426: checking for CC=gcc-4.7.0 -std=gnu99 and CFLAGS=-O2 -m64 -march=btver1 -mtune=btver1  -g -march=native -O3 -fno-strict-aliasing -DHONORS_CFLAGS\nconfigure:4430: result: yes\nconfigure:4493: checking for gcc\nconfigure:4520: result: gcc\nconfigure:4749: checking for C compiler version\nconfigure:4758: gcc --version >&5\ngcc (Ubuntu 4.4.3-4ubuntu5.1) 4.4.3\nCopyright (C) 2009 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n\nconfigure:4769: $? = 0\n\n```\n\n\nSomehow the settings from `gmp.h` don't get \"propagated\".",
    "created_at": "2012-07-27T15:46:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159649",
    "user": "leif"
}
```

Attachment

Replying to [comment:16 jdemeyer]:
> Could you attach the config.log from mpc-1.0?

Did so.  Quite long; the relevant parts seem

```
configure:2930: checking for gcc
configure:2946: found /usr/bin/gcc
configure:2957: result: gcc
configure:3186: checking for C compiler version
configure:3195: gcc --version >&5
gcc (Ubuntu 4.4.3-4ubuntu5.1) 4.4.3
Copyright (C) 2009 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

configure:3206: $? = 0

...

configure:4394: checking for CC and CFLAGS in gmp.h
configure:4420: result: yes CC=gcc-4.7.0 -std=gnu99 CFLAGS=-O2 -m64 -march=btver1 -mtune=btver1  -g -march=native -O3 -fno-strict-aliasing -DHONORS_CFLAGS
configure:4426: checking for CC=gcc-4.7.0 -std=gnu99 and CFLAGS=-O2 -m64 -march=btver1 -mtune=btver1  -g -march=native -O3 -fno-strict-aliasing -DHONORS_CFLAGS
configure:4430: result: yes
configure:4493: checking for gcc
configure:4520: result: gcc
configure:4749: checking for C compiler version
configure:4758: gcc --version >&5
gcc (Ubuntu 4.4.3-4ubuntu5.1) 4.4.3
Copyright (C) 2009 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

configure:4769: $? = 0

```


Somehow the settings from `gmp.h` don't get "propagated".



---

archive/issue_comments_159650.json:
```json
{
    "body": "Interestingly, similar happens if I unset `CC`, `CPP`, `CFLAGS` and `CPPFLAGS`:  While `configure` definitely uses the `CFLAGS` from `gmp.h`, it doesn't use the `CC` setting.\n\nApparently because of inappropriate caching:\n\n```\n...\nchecking for CC and CFLAGS in gmp.h... yes CC=gcc-4.7.0 -std=gnu99 CFLAGS=-O2 -m64 -march=btver1 -mtune=btver1  -g -march=native -O3 -fno-strict-aliasing -DHONORS_CFLAGS\nchecking for CC=gcc-4.7.0 -std=gnu99 and CFLAGS=-O2 -m64 -march=btver1 -mtune=btver1  -g -march=native -O3 -fno-strict-aliasing -DHONORS_CFLAGS... yes\nchecking for gcc... (cached) gcc\n...\n```\n",
    "created_at": "2012-07-27T16:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159650",
    "user": "leif"
}
```

Interestingly, similar happens if I unset `CC`, `CPP`, `CFLAGS` and `CPPFLAGS`:  While `configure` definitely uses the `CFLAGS` from `gmp.h`, it doesn't use the `CC` setting.

Apparently because of inappropriate caching:

```
...
checking for CC and CFLAGS in gmp.h... yes CC=gcc-4.7.0 -std=gnu99 CFLAGS=-O2 -m64 -march=btver1 -mtune=btver1  -g -march=native -O3 -fno-strict-aliasing -DHONORS_CFLAGS
checking for CC=gcc-4.7.0 -std=gnu99 and CFLAGS=-O2 -m64 -march=btver1 -mtune=btver1  -g -march=native -O3 -fno-strict-aliasing -DHONORS_CFLAGS... yes
checking for gcc... (cached) gcc
...
```




---

archive/issue_comments_159651.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-07-27T16:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159651",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_159652.json:
```json
{
    "body": "I can confirm the regression regarding `$CC`.",
    "created_at": "2012-07-27T16:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159652",
    "user": "jdemeyer"
}
```

I can confirm the regression regarding `$CC`.



---

archive/issue_comments_159653.json:
```json
{
    "body": "Obviously the `CC` from `gmp.h` gets overwritten with `$ac_cv_prog_CC` (determined earlier), but I don't know the proper way to avoid that.  (One could of course \"manually\" unset it in the `MPC_GMP_CC_CFLAG` macro from `mpc.m4`, or set it to the new value if appropriate, but that appears very hackish to me.  There must be some other way to update or invalidate cached variables I think, but so far I haven't found one.)\n\nThe cause of the regression seems to simply be the use of newer autotools (generating a `configure` script that now checks for the compiler *before* `MPC_GMP_CC_CFLAG` is called).",
    "created_at": "2012-07-27T17:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159653",
    "user": "leif"
}
```

Obviously the `CC` from `gmp.h` gets overwritten with `$ac_cv_prog_CC` (determined earlier), but I don't know the proper way to avoid that.  (One could of course "manually" unset it in the `MPC_GMP_CC_CFLAG` macro from `mpc.m4`, or set it to the new value if appropriate, but that appears very hackish to me.  There must be some other way to update or invalidate cached variables I think, but so far I haven't found one.)

The cause of the regression seems to simply be the use of newer autotools (generating a `configure` script that now checks for the compiler *before* `MPC_GMP_CC_CFLAG` is called).



---

archive/issue_comments_159654.json:
```json
{
    "body": "Replying to [comment:21 leif]:\n> The cause of the regression seems to simply be the use of newer autotools (generating a `configure` script that now checks for the compiler *before* `MPC_GMP_CC_CFLAG` is called).\n\nNot really, or at least not directly.  The culprit is `AM_PROG_AR`, which pulls in a lot of crap, or more precisely triggers the compiler tests too early.\n\nIf I move\n\n```\n# automake 1.12 seems to require this, but automake 1.11 doesn't recognize it\nm4_ifdef([AM_PROG_AR], [AM_PROG_AR])\n```\n\npast the call to `MPC_GMP_CC_CFLAGS`, the spkg installs and passes its test suite.",
    "created_at": "2012-07-27T19:54:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159654",
    "user": "leif"
}
```

Replying to [comment:21 leif]:
> The cause of the regression seems to simply be the use of newer autotools (generating a `configure` script that now checks for the compiler *before* `MPC_GMP_CC_CFLAG` is called).

Not really, or at least not directly.  The culprit is `AM_PROG_AR`, which pulls in a lot of crap, or more precisely triggers the compiler tests too early.

If I move

```
# automake 1.12 seems to require this, but automake 1.11 doesn't recognize it
m4_ifdef([AM_PROG_AR], [AM_PROG_AR])
```

past the call to `MPC_GMP_CC_CFLAGS`, the spkg installs and passes its test suite.



---

archive/issue_comments_159655.json:
```json
{
    "body": "P.S.:\n\nSince I don't have Automake 1.12 installed, perhaps someone else should `autoreconf` the spkg; patching `configure` IMHO doesn't make much sense.\n\nAnybody going to report this upstream?  Paul...? :P",
    "created_at": "2012-07-27T20:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159655",
    "user": "leif"
}
```

P.S.:

Since I don't have Automake 1.12 installed, perhaps someone else should `autoreconf` the spkg; patching `configure` IMHO doesn't make much sense.

Anybody going to report this upstream?  Paul...? :P



---

archive/issue_comments_159656.json:
```json
{
    "body": "Attachment\n\n\"Upstream\" patch to `configure.ac` to fix `CC` not being taken from `gmp.h`.",
    "created_at": "2012-07-27T20:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159656",
    "user": "leif"
}
```

Attachment

"Upstream" patch to `configure.ac` to fix `CC` not being taken from `gmp.h`.



---

archive/issue_comments_159657.json:
```json
{
    "body": "I've attached a patch to `src/configure.ac`.",
    "created_at": "2012-07-27T20:29:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159657",
    "user": "leif"
}
```

I've attached a patch to `src/configure.ac`.



---

archive/issue_comments_159658.json:
```json
{
    "body": "Replying to [comment:23 leif]:\n> Since I don't have Automake 1.12 installed, perhaps someone else should `autoreconf` the spkg; patching `configure` IMHO doesn't make much sense.\n> \n> Anybody going to report this upstream?\n\nOk, [reported upstream](https://gforge.inria.fr/tracker/?func=detail&group_id=131&aid=14669&atid=607) (patch included).",
    "created_at": "2012-07-27T21:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159658",
    "user": "leif"
}
```

Replying to [comment:23 leif]:
> Since I don't have Automake 1.12 installed, perhaps someone else should `autoreconf` the spkg; patching `configure` IMHO doesn't make much sense.
> 
> Anybody going to report this upstream?

Ok, [reported upstream](https://gforge.inria.fr/tracker/?func=detail&group_id=131&aid=14669&atid=607) (patch included).



---

archive/issue_comments_159659.json:
```json
{
    "body": "Replying to [comment:25 leif]:\n> Ok, [reported upstream](https://gforge.inria.fr/tracker/?func=detail&group_id=131&aid=14669&atid=607) (patch included).\n\n\n```\nComment By: Andreas Enge (enge)\nDate: 2012-07-27 21:39\n\nMessage:\nI confirm the problem and admit I tested only the propagation of the CFLAGS, which seems to work. This part of the configuration is really tricky.\n\nThanks for working this out. I applied the patch to the trunk and the 1.0 branch. A bug fix release 1.0.1 is planned for the end of August.\n```\n\n\nThat's quick... :-)",
    "created_at": "2012-07-27T21:46:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159659",
    "user": "leif"
}
```

Replying to [comment:25 leif]:
> Ok, [reported upstream](https://gforge.inria.fr/tracker/?func=detail&group_id=131&aid=14669&atid=607) (patch included).


```
Comment By: Andreas Enge (enge)
Date: 2012-07-27 21:39

Message:
I confirm the problem and admit I tested only the propagation of the CFLAGS, which seems to work. This part of the configuration is really tricky.

Thanks for working this out. I applied the patch to the trunk and the 1.0 branch. A bug fix release 1.0.1 is planned for the end of August.
```


That's quick... :-)



---

archive/issue_comments_159660.json:
```json
{
    "body": "Patch for the Sage library",
    "created_at": "2012-08-01T14:16:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159660",
    "user": "jdemeyer"
}
```

Patch for the Sage library



---

archive/issue_comments_159661.json:
```json
{
    "body": "Attachment\n\nPatch for the mpc spkg, for review only",
    "created_at": "2012-08-01T14:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159661",
    "user": "jdemeyer"
}
```

Attachment

Patch for the mpc spkg, for review only



---

archive/issue_comments_159662.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-08-01T14:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159662",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_159663.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-08-01T14:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159663",
    "user": "jdemeyer"
}
```

Attachment



---

archive/issue_comments_159664.json:
```json
{
    "body": "Tested on the buildbots, no problems.",
    "created_at": "2012-08-12T18:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159664",
    "user": "jdemeyer"
}
```

Tested on the buildbots, no problems.



---

archive/issue_comments_159665.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2012-08-12T19:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159665",
    "user": "vbraun"
}
```

Looks good to me.



---

archive/issue_comments_159666.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-08-12T19:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159666",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_159667.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-08-14T07:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159667",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_159668.json:
```json
{
    "body": "MPC-1.0.1 just got released.",
    "created_at": "2012-09-07T07:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13118#issuecomment-159668",
    "user": "jdemeyer"
}
```

MPC-1.0.1 just got released.
