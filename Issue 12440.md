# Issue 12440: Fix is_unit() in padics so that it is mathematically correct

Issue created by migration from Trac.

Original creator: mmasdeu

Original creation time: 2012-02-29 17:53:13

Assignee: roed

CC:  roed

Keywords: padics is_unit

Consider the following code:

```
sage: R = Qp(5,5)
sage: S.<x> = PowerSeriesRing(R,3)
sage: f=5+x
sage: f**(-1)
5^-1 + O(5^4) + (4*5^-2 + 4*5^-1 + 4 + 4*5 + 4*5^2 + O(5^3))*x + (5^-3 + O(5^2))*x^2 + O(x^3)
sage: f.is_unit()
False
```


This does not make mathematical sense, and the reason for this behavior is that is_unit() in `p`-adics does not return whether a given element can be inverted in its parent ring. Instead, it returns whether the element has valuation zero. Since the function is_unit() is used in generic algorithms (for instance when trying to invert a power series) it should return what its name promises.

I attach a patch with corrected output and doctests.


---

Comment by roed created at 2012-02-29 18:51:17

I think you need to add an explanation in the docstring of `is_unit` explaining why the change has been made, and pointing at the `is_padic_unit` function as a replacement for the old behavior.  Other than that, the patch looks fine in principle, though I need to run the doctests.


---

Comment by roed created at 2012-02-29 18:51:17

Changing status from new to needs_review.


---

Comment by roed created at 2012-02-29 18:51:21

Changing status from needs_review to needs_work.


---

Comment by mmasdeu created at 2012-02-29 19:06:26

OK. Done.


---

Comment by mmasdeu created at 2012-02-29 19:06:26

Changing status from needs_work to needs_review.


---

Comment by roed created at 2012-02-29 23:43:53

Changing status from needs_review to needs_work.


---

Comment by roed created at 2012-02-29 23:43:53

There's a failing test in `sage/rings/padics/tests.py` coming from the implementation of `log()` in `sage/rings/padics/padic_base_generic_element.pyx` that calls `is_unit`.  You should either change that test to `is_padic_unit()` or make this ticket depend on 12575.


---

Comment by mmasdeu created at 2012-03-01 03:24:39

I changed the log to use is_padic_unit() and it passes the tests in tests.py. I guess this would have disappeared anyway when the logs and exps get the new implementation...which hopefully will be reviewed soon (hint, hint).


---

Comment by mmasdeu created at 2012-03-01 03:24:39

Changing status from needs_work to needs_review.


---

Attachment


---

Comment by roed created at 2012-03-01 06:36:49

I've been looking at it.  I'll probably be able to review it on Friday: I'm giving a talk tomorrow that I need to prepare for.

I'll also review this on Friday, but I don't anticipate it needing any more changes.


---

Comment by robertwb created at 2012-06-02 00:26:11

Wow, nice catch. I'm surprised there's not more code using this function (though I guess a lot of the internal p-adic code is manipulating things at a lower level). 

I hope we don't break other users--I'm tempted to put in a warning, but this should be fixed. Thoughts? Otherwise, positive review.


---

Comment by klee created at 2012-07-11 07:21:20

Looks nice. Why wait?


---

Comment by klee created at 2012-07-11 07:21:20

Changing status from needs_review to positive_review.


---

Comment by roed created at 2012-07-11 08:11:20

Fine with me.


---

Comment by jdemeyer created at 2012-07-11 09:18:36

mmasdeu: please fill in the author field with your real name.


---

Comment by jdemeyer created at 2012-08-01 12:10:31

Resolution: fixed
