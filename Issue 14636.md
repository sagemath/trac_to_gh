# Issue 14636: notebook package contains many packages

Issue created by migration from https://trac.sagemath.org/ticket/14840

Original creator: felixs

Original creation time: 2013-06-29 15:18:03

Assignee: felixs

CC:  jondo kcrisman

Keywords: toplevel build system notebook

The top-level build system should decide whether or not a package needs to be installed (#14796). Currently the notebook pakage contains multiple packages the toplevel build system doesn't even know about.


---

Comment by vbraun created at 2014-09-02 10:52:46

Changing priority from critical to major.


---

Comment by jdemeyer created at 2016-04-06 18:46:58

Changing component from notebook to packages: standard.


---

Comment by jdemeyer created at 2016-04-06 18:46:58

Changing keywords from "toplevel build system notebook" to "notebook".


---

Comment by jdemeyer created at 2016-04-06 18:49:01

Changing keywords from "notebook" to "notebook, days77".


---

Comment by git created at 2016-04-07 10:54:53

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-04-07 10:58:08

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-04-07 12:06:25

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by kcrisman created at 2016-04-07 13:03:24

This is really good, Jeroen, though I'm surprised you have time for it, I always thought this was lower priority :)   See also #17306, would there need to be any followup to remove whatever was done there?  See also https://github.com/sagemath/sagenb/issues/258 which could hopefully be dealt with at this time too.


---

Comment by jdemeyer created at 2016-04-07 13:36:27

I'm just removing mathjax from the sagenb package. I don't think that more changes are needed regarding mathjax in sagenb.


---

Comment by jdemeyer created at 2016-04-07 13:51:32

Changing status from new to needs_review.


---

Comment by etn40ff created at 2016-04-07 20:12:28

Looks good to me.

The only minor doubt I have is about using a non released version of sagenb.
This being a stopgap solution I do not see it as being an issue though.


---

Comment by jdemeyer created at 2016-04-07 20:25:16

Replying to [comment:31 etn40ff]:
> The only minor doubt I have is about using a non released version of sagenb.

Let's hope that upstream sagenb can accept it.


---

Comment by kcrisman created at 2016-04-08 11:45:19

> > The only minor doubt I have is about using a non released version of sagenb.
> 
> Let's hope that upstream sagenb can accept it.

That shouldn't be a problem as long as we can verify that installation and use of sagenb is still smooth with this - indeed, it would simplify things rather substantially for upstream sagenb.


---

Comment by jdemeyer created at 2016-04-08 12:07:32

So, `@`kcrisman, would you give positive review?


---

Comment by kcrisman created at 2016-04-08 18:03:36

> So, `@`kcrisman, would you give positive review?
Yes when I can try it - or someone else can try it and make sure everything works okay.


---

Comment by etn40ff created at 2016-04-08 20:38:20

I did few testing and it looks like it should be ok for me. Shall we wait for `@`kcrisman to give it a spin?


---

Comment by kcrisman created at 2016-04-08 20:46:18

> I'm just removing mathjax from the sagenb package. I don't think that more changes are needed regarding mathjax in sagenb.
I found what I was looking for, awesome:

```
-# the following line can be removed once sagenb does not ship mathjax anymore.
-rm -rf mathjax
```



---

Comment by kcrisman created at 2016-04-08 20:49:25

> I did few testing and it looks like it should be ok for me. Shall we wait for `@`kcrisman to give it a spin?
That won't happen for some time (e.g. not until at least after the weekend).  I think what is most needed here is for someone to try building Sage from scratch using this and making sure everything does indeed get put in the right places, and then that all the usual sagenb functionality (jsmol, translations, etc.) still work.  I have no doubt that it _will_ work but I just don't have the time to do it; if Salvatore (is that etn40ff?) can vouch for this then it's good.

Only one thing; if there is then an "official" sagenb 0.12 will that complicate matters later, would it have to be 0.12.1 for everything to build properly?


---

Comment by etn40ff created at 2016-04-08 21:10:07

I did recompile sage from scratch and run complete doctest on it. Stupidly I did not run the notebook tough: I got distracted then forgot. 

Reasonably I will not be able to recompile again before the end of the weekend either but I will gladly take care of this on Monday if nobody beats me to it.

(yes, I am Salvatore, sorry for the weird username)


---

Comment by jdemeyer created at 2016-04-08 21:31:37

Replying to [comment:40 kcrisman]:
> Only one thing; if there is then an "official" sagenb 0.12

Is there actually a place where the "official" sagenb tarballs are hosted? If not, then we can just define my tarball as the official one.


---

Comment by kcrisman created at 2016-04-09 01:26:48

> > Only one thing; if there is then an "official" sagenb 0.12
> 
> Is there actually a place where the "official" sagenb tarballs are hosted? If not, then we can just define my tarball as the official one.

Oh, I don't think I saw that this was 0.12 even in [this commit](https://github.com/sagemath/sagenb/pull/371/commits/1f37bfc8195ebdf481def9e292b6914d06e46ba5).  How would I (eventually) merge that in the github master branch without creating the extra merge commit?


---

Comment by jdemeyer created at 2016-04-11 08:23:23

Replying to [comment:43 kcrisman]:
> Oh, I don't think I saw that this was 0.12 even in [this commit](https://github.com/sagemath/sagenb/pull/371/commits/1f37bfc8195ebdf481def9e292b6914d06e46ba5).  How would I (eventually) merge that in the github master branch without creating the extra merge commit?

I don't have enough experience managing a github project to answer this _using github_. But it should be possible to do the merge using the standard `git merge` command line.


---

Comment by dimpase created at 2016-04-12 00:55:19

I'd rather see all this becoming a bunch of optional packages, rather than standard packages.


---

Comment by kcrisman created at 2016-04-12 01:18:26

> But it should be possible to do the merge using the standard git merge command line.
True.
> I'd rather see all this becoming a bunch of optional packages, rather than standard packages.
Is that possible without making sagenb optional, though?  Otherwise we might as well stick with the previous situation.


---

Comment by jdemeyer created at 2016-04-12 08:02:02

Replying to [comment:45 dimpase]:
> I'd rather see all this becoming a bunch of optional packages, rather than standard packages.

But sagenb itself is still standard, so I don't see the point of marking those other packages optional. In any case, this ticket here will make it possible to make sagenb and its dependencies optional in the future.


---

Comment by dimpase created at 2016-04-12 10:39:59

I was suggesting to make all of sagenb optional. Surely it's not used too much nowadays, as many people would use jupyther notebook instead. (I am seldom using any of these, I don't know how small such a minority is).


---

Comment by dimpase created at 2016-04-12 10:43:16

Replying to [comment:44 jdemeyer]:
> Replying to [comment:43 kcrisman]:
> > Oh, I don't think I saw that this was 0.12 even in [this commit](https://github.com/sagemath/sagenb/pull/371/commits/1f37bfc8195ebdf481def9e292b6914d06e46ba5).  How would I (eventually) merge that in the github master branch without creating the extra merge commit?

turn merge squashing on, then merge as you'd normally merge a PR on github.
https://help.github.com/articles/about-pull-request-merge-squashing/

> 
> I don't have enough experience managing a github project to answer this _using github_. But it should be possible to do the merge using the standard `git merge` command line.

With subsequent `git rebase`?


---

Comment by jdemeyer created at 2016-04-12 11:03:11

Replying to [comment:48 dimpase]:
> I was suggesting to make all of sagenb optional.

That's certainly not a decision to be taken on this ticket. SageNB is still the default notebook in Sage.


---

Comment by kcrisman created at 2016-04-12 12:51:50

> > I was suggesting to make all of sagenb optional.
> 
> That's certainly not a decision to be taken on this ticket. SageNB is still the default notebook in Sage.
Given the support requests that still come in, and the fact that sage-devel is (like any other developer list) notoriously populated by early adopters, I'd say it's unlikely we should make sagenb optional.  Early in my work with Sage I had so many questions from people who wanted to use it but we didn't have an automatic Maple or Mma translator, so they were not interested - sunk effort.  I'm pretty sure there is a sizable (not on the order of Maple or Mma users, of course) contingent of people with the same sunk effort in sagenb.  I do plan to look at the converter to ipynb ticket this summer, since I see the way things are going, but removing sagenb as standard makes no sense, because the people most likely to use it are the people least likely to have the infrastructure to add it back in (Windows and Mac binary users).  (A "personal" version of SMC would not be amiss in that discussion either, so people don't always have to be online to use their Sage, but that isn't for this ticket.)


---

Comment by jdemeyer created at 2016-04-14 07:53:56

Regarding the comment

Replying to [comment:40 kcrisman]:
> Only one thing; if there is then an "official" sagenb 0.12 will that complicate matters later, would it have to be 0.12.1 for everything to build properly?

can you please answer this important question:

Replying to [comment:42 jdemeyer]:
> Is there actually a place where the "official" sagenb tarballs are hosted? If not, then we can just define my tarball as the official one.

My impression was that, whenever you made a new SageNB release, you just host it somewhere on a personal website. So then I don't see why my sagenb-0.12 on this ticket would be less official than your previous sagenb releases.

But please tell me if I'm wrong...


---

Comment by dimpase created at 2016-04-14 10:14:38

well, the upstream lives on github. I suggest we merge the corresponding pull requests there, before creating a release, so that the tarball does come from the "official" repo.


---

Comment by jdemeyer created at 2016-04-14 10:19:37

Replying to [comment:53 dimpase]:
> well, the upstream lives on github. I suggest we merge the corresponding pull requests there, before creating a release, so that the tarball does come from the "official" repo. 

If kcrisman merges just this one pull request and nothing else, then my tarball and the "official" will have exactly the same sources (they might even be the same git commit if a fast-forward merge is done), so they are effectively indistinguishable.


---

Comment by kcrisman created at 2016-04-14 14:05:25

> > well, the upstream lives on github. I suggest we merge the corresponding pull requests there, before creating a release, so that the tarball does come from the "official" repo. 
> 
> If kcrisman merges just this one pull request and nothing else, then my tarball and the "official" will have exactly the same sources (they might even be the same git commit if a fast-forward merge is done), so they are effectively indistinguishable.

Yeah, as long as I don't have to create an extra merge commit (which is not possible on GH but should be possible command line, as you say) then that is fine.

In fact, without the weird packaging thing, the "official" tarball would indeed be the ones on Github now; the reason they aren't currently is because of the subpackage stuff, I believe.  I'm only concerned about the repos looking the same, not where some "official" package lives.

I'm sorry I can't do anything "officially" on GH now regarding this (I mean merging, because then I feel responsible and have to do testing etc.).  But this solution is fine with me, and I am one of the few people who cares about this, so no worries.


---

Comment by dimpase created at 2016-04-14 14:10:20

Replying to [comment:55 kcrisman]:
> > > well, the upstream lives on github. I suggest we merge the corresponding pull requests there, before creating a release, so that the tarball does come from the "official" repo. 
> > 
> > If kcrisman merges just this one pull request and nothing else, then my tarball and the "official" will have exactly the same sources (they might even be the same git commit if a fast-forward merge is done), so they are effectively indistinguishable.
> 
> Yeah, as long as I don't have to create an extra merge commit (which is not possible on GH

why? did you look at the link I posted?
https://help.github.com/articles/about-pull-request-merge-squashing/

> but should be possible command line, as you say) then that is fine.
> 
> In fact, without the weird packaging thing, the "official" tarball would indeed be the ones on Github now; the reason they aren't currently is because of the subpackage stuff, I believe.  I'm only concerned about the repos looking the same, not where some "official" package lives.
> 
> I'm sorry I can't do anything "officially" on GH now regarding this (I mean merging, because then I feel responsible and have to do testing etc.). 

I presume one just has to look that it builds and runs. It's merely re-packaging of the same thing, right?



> But this solution is fine with me, and I am one of the few people who cares about this, so no worries.


---

Comment by kcrisman created at 2016-04-14 15:51:38

> > Yeah, as long as I don't have to create an extra merge commit (which is not possible on GH
> 
> why? did you look at the link I posted?
> https://help.github.com/articles/about-pull-request-merge-squashing/

Sorry, no I didn't see that update to this ticket, my apologies (surely not the only thing I've missed).  I don't see a way to add commits without a merge and without squashing, maybe that's if one unchecks both buttons?

> I presume one just has to look that it builds and runs. It's merely re-packaging of the same thing, right?

Well, I tend to want to slowly confirm all that myself, check weird edge cases, etc.  Which is perhaps unnecessary and my downfall, but anyway it's as it is.  The situation here can be back-read into sagenb one way or another once my semester ends.  I can't do more right now.


---

Comment by kcrisman created at 2016-04-14 21:56:03

PS with respect to the "modularization" sagenb thread, the sooner sagenb gets back in Sage proper, the better!  Also, I am indeed interested in maintaining it, but just have very little time for it.  I'm sorry about that, but that's just how it is. :-(


---

Comment by dimpase created at 2016-04-15 21:33:43

IMHO sagenb should not drag all of its dependencies into sage. Why can't the installation script simply run 
`sage --pip`?


---

Comment by jhpalmieri created at 2016-04-15 21:48:19

Sage policy is to not require internet access to build Sage: you should be able to download a complete tarball and build from that. So we have to include tarballs for all of these dependencies, at which point why not make them Sage packages? Then we know they are available if they are needed elsewhere in Sage, and we can make any other dependencies explicit.


---

Comment by dimpase created at 2016-04-15 21:57:01

Replying to [comment:60 jhpalmieri]:
> Sage policy is to not require internet access to build Sage: you should be able to download a complete tarball and build from that. 

perhaps it's time for it to change; after all we tell users to install ssl support via pip, creating a lot of pain and confusion along the way, as we don't package the corresponding script thanks to exactly this prohibition. If we changed this policy we would only improve the nb-related procedures here.


>So we have to include tarballs for all of these dependencies, at which point why not make them Sage packages? Then we know they are available if they are needed elsewhere in Sage, and we can make any other dependencies explicit.

well, in this case they are not needed anywhere else in sage.


---

Comment by vbraun created at 2016-04-15 22:24:14

I tend to agree that we should just exclude web-based UIs (SageNB + Jupyter) from the "self-contained tarball" and make them pip-type optional packages instead. If you don't have internet access then how come you have a browser installed? Also the whole OpenSSL can of worms if you really want to run a server.

But this should be changed at a major release, not now.


---

Comment by jhpalmieri created at 2016-04-15 22:35:34

Replying to [comment:62 vbraun]:
> I tend to agree that we should just exclude web-based UIs (SageNB + Jupyter) from the "self-contained tarball" and make them pip-type optional packages instead. If you don't have internet access then how come you have a browser installed?

Because you live in a third world country and have inconsistent access? Because you're traveling and want to build Sage while on an airplane (and without paying the wifi fees)? You can come up with plenty of reasons.


---

Comment by dimpase created at 2016-04-15 22:48:30

Replying to [comment:63 jhpalmieri]:
> Replying to [comment:62 vbraun]:
> > I tend to agree that we should just exclude web-based UIs (SageNB + Jupyter) from the "self-contained tarball" and make them pip-type optional packages instead. If you don't have internet access then how come you have a browser installed?
> 
> Because you live in a third world country and have inconsistent access? Because you're traveling and want to build Sage while on an airplane (and without paying the wifi fees)? You can come up with plenty of reasons.

Inconsistent access is a nightmare if you need to get a large file (e.g. current Sage source tarball), as opposed to several small files.

Besides, mind you, much more popular than Sage software distribution systems, e.g. ones for Python, Haskell, OCaml do require internet access, by default. Convenience for the majority (and for developers) ought to come before exotic usage cases.


---

Comment by vbraun created at 2016-04-15 23:01:45

IMHO those use cases are better served by having a script that downloads all standard+optional packages. I already have a script where you just have to 

```
sage-package download :standard: :optional:
```

to grab them all in one go.


---

Comment by jhpalmieri created at 2016-04-15 23:04:25

Replying to [comment:64 dimpase]:
> Replying to [comment:63 jhpalmieri]:
> > Replying to [comment:62 vbraun]:
> > > I tend to agree that we should just exclude web-based UIs (SageNB + Jupyter) from the "self-contained tarball" and make them pip-type optional packages instead. If you don't have internet access then how come you have a browser installed?
> > 
> > Because you live in a third world country and have inconsistent access? Because you're traveling and want to build Sage while on an airplane (and without paying the wifi fees)? You can come up with plenty of reasons.
> 
> Inconsistent access is a nightmare if you need to get a large file (e.g. current Sage source tarball), as opposed to several small files.

Hence tarballs on thumb drives.

> Besides, mind you, much more popular than Sage software distribution systems, e.g. ones for Python, Haskell, OCaml do require internet access, by default. Convenience for the majority (and for developers) ought to come before exotic usage cases.

If/when we make sagenb into an optional or experimental package, I have no objections to doing the same with these dependencies. But until then, in what way is including a dozen packages an inconvenience? It doesn't take up any extra disk space or extra time building Sage since we're already including them, it just adds a few directories in `build/pkgs`. How is this more of an inconvenience than requiring internet access during compilation of Sage?

Replying to [comment:65 vbraun]:
> IMHO those use cases are better served by having a script that downloads all standard+optional packages. I already have a script where you just have to 
> {{{
> sage-package download :standard: :optional:
> }}}
> to grab them all in one go.

And how are Sage developers supposed to know about this, if they are going to be traveling and without good internet access for a while? It sounds like a good idea, but I still don't see what it saves vs. making these standard Sage packages (for as long as sagenb is a standard Sage package, but no longer).


---

Comment by vbraun created at 2016-04-15 23:16:13

As I said above, I do agree that we should make the packages standard now. But in the future we should probably reevaluate the wisdom for why we are making source tarballs with two separate web-based notebooks.


---

Comment by kcrisman created at 2016-04-16 01:24:08

> As I said above, I do agree that we should make the packages standard now. But in the future we should probably reevaluate the wisdom for why we are making source tarballs with two separate web-based notebooks.

I'm not quite sure why the "web-based" is relevant here; why not say "browser-based" instead?  I use my browser all the time without being on the internet - primarily as a Sage GUI, but most browsers now save things for later reading, I often save pages to show to students in situations where wireless isn't working and it opens in the browser, etc.  After all, most people aren't running their local sagenb or Jupyter as a web service.

Anyway, this solution seems to me like a good intermediate solution.


---

Comment by dimpase created at 2016-04-16 08:28:35

OK, I'll be happy to review this; I just merged your pull request. Could you perhaps make an official tarball, based off https://github.com/sagemath/sagenb ?


---

Comment by jdemeyer created at 2016-04-16 12:09:05

No need for a new tarball, just define the one already on this ticket as the official one.


---

Comment by git created at 2016-04-16 15:30:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-04-16 15:35:30

Volker just reminded me that we cannot use `pip install .` currently, since that needs SSL.


---

Comment by dimpase created at 2016-04-16 15:39:39

Replying to [comment:72 jdemeyer]:
> Volker just reminded me that we cannot use `pip install .` currently, since that needs SSL.

pip is a standard Sage package. Are you saying that it is broken, generally speaking?
Probably if you build everything without ssl then it would work too, no?


---

Comment by jdemeyer created at 2016-04-16 15:44:32

Replying to [comment:73 dimpase]:
> Replying to [comment:72 jdemeyer]:
> > Volker just reminded me that we cannot use `pip install .` currently, since that needs SSL.
> 
> pip is a standard Sage package. Are you saying that it is broken, generally speaking?
Sort of: it always requires SSL even if you don't make any internet connection.

> Probably if you build everything without ssl then it would work too, no?
Apparently not.


---

Comment by dimpase created at 2016-04-16 22:52:52

looks OK on linux. let me see if it's also OK on OSX, just in case.


---

Comment by dimpase created at 2016-04-16 23:03:53

OK.lightly tested on few random worksheets, old and new, on OSX too.


---

Comment by dimpase created at 2016-04-16 23:03:53

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2016-04-17 07:48:54

Thanks!


---

Comment by vbraun created at 2016-04-17 19:10:49

Resolution: fixed
