# Issue 15750: Python 3 preparation: Change syntax of long and octal integer literals

Issue created by migration from Trac.

Original creator: wluebbe

Original creation time: 2014-03-20 15:25:24

Keywords: python3

The deprecated syntax is not accepted by Python 3.

Changes according to `lib2to3/fixes/fix_numliterals.py`:

```
turns 1L into 1, 0755 into 0o755
```


This ticket is tracked as a dependency of meta-ticket ticket:15980.


---

Comment by wluebbe created at 2014-03-22 13:50:17

search result for integer literals with suffix "L" (type long)


---

Comment by wluebbe created at 2014-03-22 14:19:56

Changing status from new to needs_review.


---

Attachment

The changes for the new octal literal format should be complete: 2 modules were fixed by the 2to3 tool and another case was manually fixed in a doc-test.

2to3 has found nothing for the long integer literal (suffix "L").

13 modules were found with regexp search (r"\s (0\d+) [\s)]"). The result file is attached.
* 6 pyx modules from `sage/rings/padics` contain code like `(1L << (sizeof(long) * 8 - 2)) - 1`. I do not whether these should be changed.
* 4 modules had doc-test with stuff like `4561L   # 32-bit`. Perhaps these test can be made more tolerant.
* The module `sage/interfaces/r.py` had strings like
 "rel_re_integer.sub(a._subs_integer, ' 1L 2L')". Maybe this could / should be changed.
* 2 modules in `sage/combinat` had the text "ValueError: R10L is not a correct map". Nothing to change.

----
New commits:


---

Comment by wluebbe created at 2014-03-27 14:18:45

I did 

```
git merge u/chapoton/15991 u/wluebbe/ticket/15986 u/wluebbe/ticket/15987
}}} 
on top of `u/wluebbe/ticket/15992` (which is rebased on `6.2.beta5`)

Test report:
{{{
./sage -t -p --all --long --logfile=logs/ptestlong-alle4.log
...
All tests passed!
}}}


---

Comment by ohanar created at 2014-04-02 17:18:15

Replying to [comment:1 wluebbe]:
> 2to3 has found nothing for the long integer literal (suffix "L").

> 13 modules were found with regexp search (r"\s (0\d+) [\s)]"). The result file is attached.
> * 6 pyx modules from `sage/rings/padics` contain code like `(1L << (sizeof(long) * 8 - 2)) - 1`. I do not whether these should be changed.

These should be fine, long integer literals are important to C and hence you cannot always drop them in Cython code (even for Cython written specifically written for Python 3).

> * 4 modules had doc-test with stuff like `4561L   # 32-bit`. Perhaps these test can be made more tolerant.

How do you propose? The issue is that the Cython code is likely written with 64-bit integers, which on 32-bit platforms cannot always be placed into a Python2 int (since they are just a simple wrapper for the underlying platforms C long). In general you will get this issue when dealing with large integers, it is just mostly avoid in sage since we usually return Sage integers instead of Python ints or longs.


---

Comment by wluebbe created at 2014-04-03 12:36:55

I was thinking about `#doctest: +ELLIPSIS` and replacing `4561L # 32-bit` by `4561... # 32-bit`.

I hope this would not run counter the purpose of the test :-)


---

Comment by ohanar created at 2014-04-03 16:05:30

Replying to [comment:4 wluebbe]:
> I was thinking about `#doctest: +ELLIPSIS` and replacing `4561L # 32-bit` by `4561... # 32-bit`.

I think `...` is too liberal, e.g. the follow function would pass this doctest:

```python
def foo():
    print("4561"+"lots of other text"*1000)
```



---

Comment by wluebbe created at 2014-04-03 18:47:50

How about adding some magic number as a sentinel after `4561L`?

E.g change

```
            sage: mm[1]
            10009             # 64-bit
            10009L            # 32-bit
```

into 

```
            sage: mm[1], 314159
            (10009, 314159)             # 64-bit
            (10009L, 314159)            # 32-bit
```



---

Comment by wluebbe created at 2014-04-03 18:52:58

Of course I meant ` (10009..., 314159)   # 32-bit`  :-/


---

Comment by ohanar created at 2014-04-03 19:04:13

I would rather just wrapping the offending doctests with `Integer` and providing a comment on why the seemingly unnecessary `Integer` wrap is there.


---

Comment by wluebbe created at 2014-04-08 08:53:28

Changing status from needs_review to needs_work.


---

Comment by wluebbe created at 2014-04-11 15:01:06

More complete search result for `long` integer literals


---

Attachment

The first search was incomplete. A lot more `\d+L` instances found (see new attachment).

I guess "fix_long" ticket:16072 (stage 2) should be solved first. That will clarify the approach to be selected here.

Move to stage 2?


---

Comment by jdemeyer created at 2014-10-12 20:26:45

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2014-10-12 20:38:49

author name


---

Comment by vbraun created at 2014-10-12 20:38:49

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2014-10-13 18:21:57

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2014-10-14 10:41:25

Resolution: fixed
