# Issue 15750: Python 3 preparation: Change syntax of long and octal integer literals

archive/issues_015750.json:
```json
{
    "body": "Keywords: python3\n\nThe deprecated syntax is not accepted by Python 3.\n\nChanges according to `lib2to3/fixes/fix_numliterals.py`:\n\n```\nturns 1L into 1, 0755 into 0o755\n```\n\n\nThis ticket is tracked as a dependency of meta-ticket ticket:15980.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15987\n\n",
    "created_at": "2014-03-20T15:25:24Z",
    "labels": [
        "component: distribution"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Python 3 preparation: Change syntax of long and octal integer literals",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15750",
    "user": "https://github.com/wluebbe"
}
```
Keywords: python3

The deprecated syntax is not accepted by Python 3.

Changes according to `lib2to3/fixes/fix_numliterals.py`:

```
turns 1L into 1, 0755 into 0o755
```


This ticket is tracked as a dependency of meta-ticket ticket:15980.

Issue created by migration from https://trac.sagemath.org/ticket/15987





---

archive/issue_comments_203650.json:
```json
{
    "body": "search result for integer literals with suffix \"L\" (type long)",
    "created_at": "2014-03-22T13:50:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203650",
    "user": "https://github.com/wluebbe"
}
```

search result for integer literals with suffix "L" (type long)



---

archive/issue_comments_203651.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-03-22T14:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203651",
    "user": "https://github.com/wluebbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_203652.json:
```json
{
    "body": "Attachment [long-literal.warn](tarball://root/attachments/some-uuid/ticket15987/long-literal.warn) by @wluebbe created at 2014-03-22 14:19:56\n\nThe changes for the new octal literal format should be complete: 2 modules were fixed by the 2to3 tool and another case was manually fixed in a doc-test.\n\n2to3 has found nothing for the long integer literal (suffix \"L\").\n\n13 modules were found with regexp search (r\"\\s (0\\d+) [\\s)]\"). The result file is attached.\n* 6 pyx modules from `sage/rings/padics` contain code like `(1L << (sizeof(long) * 8 - 2)) - 1`. I do not whether these should be changed.\n* 4 modules had doc-test with stuff like `4561L   # 32-bit`. Perhaps these test can be made more tolerant.\n* The module `sage/interfaces/r.py` had strings like\n  \"rel_re_integer.sub(a._subs_integer, ' 1L 2L')\". Maybe this could / should be changed.\n* 2 modules in `sage/combinat` had the text \"ValueError: R10L is not a correct map\". Nothing to change.\n\n----\nNew commits:",
    "created_at": "2014-03-22T14:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203652",
    "user": "https://github.com/wluebbe"
}
```

Attachment [long-literal.warn](tarball://root/attachments/some-uuid/ticket15987/long-literal.warn) by @wluebbe created at 2014-03-22 14:19:56

The changes for the new octal literal format should be complete: 2 modules were fixed by the 2to3 tool and another case was manually fixed in a doc-test.

2to3 has found nothing for the long integer literal (suffix "L").

13 modules were found with regexp search (r"\s (0\d+) [\s)]"). The result file is attached.
* 6 pyx modules from `sage/rings/padics` contain code like `(1L << (sizeof(long) * 8 - 2)) - 1`. I do not whether these should be changed.
* 4 modules had doc-test with stuff like `4561L   # 32-bit`. Perhaps these test can be made more tolerant.
* The module `sage/interfaces/r.py` had strings like
  "rel_re_integer.sub(a._subs_integer, ' 1L 2L')". Maybe this could / should be changed.
* 2 modules in `sage/combinat` had the text "ValueError: R10L is not a correct map". Nothing to change.

----
New commits:



---

archive/issue_comments_203653.json:
```json
{
    "body": "I did \n\n```\ngit merge u/chapoton/15991 u/wluebbe/ticket/15986 u/wluebbe/ticket/15987\n```\n \non top of `u/wluebbe/ticket/15992` (which is rebased on `6.2.beta5`)\n\nTest report:\n\n```\n./sage -t -p --all --long --logfile=logs/ptestlong-alle4.log\n...\nAll tests passed!\n```\n",
    "created_at": "2014-03-27T14:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203653",
    "user": "https://github.com/wluebbe"
}
```

I did 

```
git merge u/chapoton/15991 u/wluebbe/ticket/15986 u/wluebbe/ticket/15987
```
 
on top of `u/wluebbe/ticket/15992` (which is rebased on `6.2.beta5`)

Test report:

```
./sage -t -p --all --long --logfile=logs/ptestlong-alle4.log
...
All tests passed!
```




---

archive/issue_comments_203654.json:
```json
{
    "body": "Replying to [comment:1 wluebbe]:\n> 2to3 has found nothing for the long integer literal (suffix \"L\").\n\n> 13 modules were found with regexp search (r\"\\s (0\\d+) [\\s)]\"). The result file is attached.\n> * 6 pyx modules from `sage/rings/padics` contain code like `(1L << (sizeof(long) * 8 - 2)) - 1`. I do not whether these should be changed.\n\nThese should be fine, long integer literals are important to C and hence you cannot always drop them in Cython code (even for Cython written specifically written for Python 3).\n\n> * 4 modules had doc-test with stuff like `4561L   # 32-bit`. Perhaps these test can be made more tolerant.\n\nHow do you propose? The issue is that the Cython code is likely written with 64-bit integers, which on 32-bit platforms cannot always be placed into a Python2 int (since they are just a simple wrapper for the underlying platforms C long). In general you will get this issue when dealing with large integers, it is just mostly avoid in sage since we usually return Sage integers instead of Python ints or longs.",
    "created_at": "2014-04-02T17:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203654",
    "user": "https://github.com/ohanar"
}
```

Replying to [comment:1 wluebbe]:
> 2to3 has found nothing for the long integer literal (suffix "L").

> 13 modules were found with regexp search (r"\s (0\d+) [\s)]"). The result file is attached.
> * 6 pyx modules from `sage/rings/padics` contain code like `(1L << (sizeof(long) * 8 - 2)) - 1`. I do not whether these should be changed.

These should be fine, long integer literals are important to C and hence you cannot always drop them in Cython code (even for Cython written specifically written for Python 3).

> * 4 modules had doc-test with stuff like `4561L   # 32-bit`. Perhaps these test can be made more tolerant.

How do you propose? The issue is that the Cython code is likely written with 64-bit integers, which on 32-bit platforms cannot always be placed into a Python2 int (since they are just a simple wrapper for the underlying platforms C long). In general you will get this issue when dealing with large integers, it is just mostly avoid in sage since we usually return Sage integers instead of Python ints or longs.



---

archive/issue_comments_203655.json:
```json
{
    "body": "I was thinking about `#doctest: +ELLIPSIS` and replacing `4561L # 32-bit` by `4561... # 32-bit`.\n\nI hope this would not run counter the purpose of the test :-)",
    "created_at": "2014-04-03T12:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203655",
    "user": "https://github.com/wluebbe"
}
```

I was thinking about `#doctest: +ELLIPSIS` and replacing `4561L # 32-bit` by `4561... # 32-bit`.

I hope this would not run counter the purpose of the test :-)



---

archive/issue_comments_203656.json:
```json
{
    "body": "Replying to [comment:4 wluebbe]:\n> I was thinking about `#doctest: +ELLIPSIS` and replacing `4561L # 32-bit` by `4561... # 32-bit`.\n\nI think `...` is too liberal, e.g. the follow function would pass this doctest:\n\n```python\ndef foo():\n    print(\"4561\"+\"lots of other text\"*1000)\n```\n",
    "created_at": "2014-04-03T16:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203656",
    "user": "https://github.com/ohanar"
}
```

Replying to [comment:4 wluebbe]:
> I was thinking about `#doctest: +ELLIPSIS` and replacing `4561L # 32-bit` by `4561... # 32-bit`.

I think `...` is too liberal, e.g. the follow function would pass this doctest:

```python
def foo():
    print("4561"+"lots of other text"*1000)
```




---

archive/issue_comments_203657.json:
```json
{
    "body": "How about adding some magic number as a sentinel after `4561L`?\n\nE.g change\n\n```\n            sage: mm[1]\n            10009             # 64-bit\n            10009L            # 32-bit\n```\n\ninto \n\n```\n            sage: mm[1], 314159\n            (10009, 314159)             # 64-bit\n            (10009L, 314159)            # 32-bit\n```\n",
    "created_at": "2014-04-03T18:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203657",
    "user": "https://github.com/wluebbe"
}
```

How about adding some magic number as a sentinel after `4561L`?

E.g change

```
            sage: mm[1]
            10009             # 64-bit
            10009L            # 32-bit
```

into 

```
            sage: mm[1], 314159
            (10009, 314159)             # 64-bit
            (10009L, 314159)            # 32-bit
```




---

archive/issue_comments_203658.json:
```json
{
    "body": "Of course I meant ` (10009..., 314159)   # 32-bit`  :-/",
    "created_at": "2014-04-03T18:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203658",
    "user": "https://github.com/wluebbe"
}
```

Of course I meant ` (10009..., 314159)   # 32-bit`  :-/



---

archive/issue_comments_203659.json:
```json
{
    "body": "I would rather just wrapping the offending doctests with `Integer` and providing a comment on why the seemingly unnecessary `Integer` wrap is there.",
    "created_at": "2014-04-03T19:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203659",
    "user": "https://github.com/ohanar"
}
```

I would rather just wrapping the offending doctests with `Integer` and providing a comment on why the seemingly unnecessary `Integer` wrap is there.



---

archive/issue_comments_203660.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-04-08T08:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203660",
    "user": "https://github.com/wluebbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_203661.json:
```json
{
    "body": "More complete search result for `long` integer literals",
    "created_at": "2014-04-11T15:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203661",
    "user": "https://github.com/wluebbe"
}
```

More complete search result for `long` integer literals



---

archive/issue_comments_203662.json:
```json
{
    "body": "Attachment [long-literal.warn-details-both](tarball://root/attachments/some-uuid/ticket15987/long-literal.warn-details-both) by @wluebbe created at 2014-04-11 15:07:25\n\nThe first search was incomplete. A lot more `\\d+L` instances found (see new attachment).\n\nI guess \"fix_long\" ticket:16072 (stage 2) should be solved first. That will clarify the approach to be selected here.\n\nMove to stage 2?",
    "created_at": "2014-04-11T15:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203662",
    "user": "https://github.com/wluebbe"
}
```

Attachment [long-literal.warn-details-both](tarball://root/attachments/some-uuid/ticket15987/long-literal.warn-details-both) by @wluebbe created at 2014-04-11 15:07:25

The first search was incomplete. A lot more `\d+L` instances found (see new attachment).

I guess "fix_long" ticket:16072 (stage 2) should be solved first. That will clarify the approach to be selected here.

Move to stage 2?



---

archive/issue_comments_203663.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-10-12T20:26:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203663",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_203664.json:
```json
{
    "body": "author name",
    "created_at": "2014-10-12T20:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203664",
    "user": "https://github.com/vbraun"
}
```

author name



---

archive/issue_comments_203665.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-10-12T20:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203665",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_203666.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-10-13T18:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203666",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_203667.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-14T10:41:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15750#issuecomment-203667",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_015359.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-10-14T10:41:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15750",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15750#event-15359"
}
```
