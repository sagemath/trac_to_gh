# Issue 30393: findstat error handling

archive/issues_030393.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/30630\n\n",
    "created_at": "2020-09-22T02:37:17Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "findstat error handling",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30393",
    "user": "mantepse"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/30630





---

archive/issue_comments_433523.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-22T03:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433523",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433524.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2020-09-22T07:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433524",
    "user": "mantepse"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_433525.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2020-09-22T07:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433525",
    "user": "mantepse"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_433526.json:
```json
{
    "body": "Changing keywords from \"\" to \"findstat\".",
    "created_at": "2020-09-22T07:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433526",
    "user": "mantepse"
}
```

Changing keywords from "" to "findstat".



---

archive/issue_comments_433527.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2020-09-22T07:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433527",
    "user": "mantepse"
}
```

Changing priority from major to minor.



---

archive/issue_comments_433528.json:
```json
{
    "body": "Use an url at `example.com` so nobody can play a trick? Check if that works.\n\n```\n-        sage: _get_json(\"https://nonexistingfindstaturl.org\")\n+        sage: _get_json(\"https://not-findstat.example.com\")\n         Traceback (most recent call last):\n         ...\n-        ConnectionError: HTTPSConnectionPool(host='nonexistingfindstaturl.org', port=443): Max retries exceeded with url: / (Caused by NewConnectionError('...Failed to establish a new connection: [Errno -2] Name or service not known'))\n+        ConnectionError: HTTPSConnectionPool(host='not-findstat.example.com', port=443): Max retries exceeded with url: / (Caused by NewConnectionError('...Failed to establish a new connection: [Errno -2] Name or service not known'))\n```\n\n\nDon't forget to set to `needs_review` when ready.",
    "created_at": "2020-09-24T02:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433528",
    "user": "slelievre"
}
```

Use an url at `example.com` so nobody can play a trick? Check if that works.

```
-        sage: _get_json("https://nonexistingfindstaturl.org")
+        sage: _get_json("https://not-findstat.example.com")
         Traceback (most recent call last):
         ...
-        ConnectionError: HTTPSConnectionPool(host='nonexistingfindstaturl.org', port=443): Max retries exceeded with url: / (Caused by NewConnectionError('...Failed to establish a new connection: [Errno -2] Name or service not known'))
+        ConnectionError: HTTPSConnectionPool(host='not-findstat.example.com', port=443): Max retries exceeded with url: / (Caused by NewConnectionError('...Failed to establish a new connection: [Errno -2] Name or service not known'))
```


Don't forget to set to `needs_review` when ready.



---

archive/issue_comments_433529.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-24T08:33:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433529",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433530.json:
```json
{
    "body": "It turns out that testing what I really want to test is tricky:\n\n* I originally wanted to test that an error is raised when findstat is down.\n\n* using `badurl.example.com` or the like does not test this, because the domain does not exist.  In this case `request` also throws nested errors, which are hard to catch.\n\nTherefore, I test something else, which makes more sense to test anyway.",
    "created_at": "2020-09-24T08:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433530",
    "user": "mantepse"
}
```

It turns out that testing what I really want to test is tricky:

* I originally wanted to test that an error is raised when findstat is down.

* using `badurl.example.com` or the like does not test this, because the domain does not exist.  In this case `request` also throws nested errors, which are hard to catch.

Therefore, I test something else, which makes more sense to test anyway.



---

archive/issue_comments_433531.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-24T08:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433531",
    "user": "mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_433532.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-26T10:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433532",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433533.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-27T16:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433533",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433534.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-27T18:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433534",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433535.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-28T10:06:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433535",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433536.json:
```json
{
    "body": "Can you please modify the ticket description so that you see that the support for new collections is added.",
    "created_at": "2020-10-08T11:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433536",
    "user": "@kliem"
}
```

Can you please modify the ticket description so that you see that the support for new collections is added.



---

archive/issue_comments_433537.json:
```json
{
    "body": "Why are you turning the `JSONDecodeError` into a `ValueError`?",
    "created_at": "2020-10-10T19:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433537",
    "user": "vdelecroix"
}
```

Why are you turning the `JSONDecodeError` into a `ValueError`?



---

archive/issue_comments_433538.json:
```json
{
    "body": "Because the reason for the error is (most likely) an inappropriate value `response.text`, due to (most likely) a bad url or a new but on the findstat server.  I felt that a `ValueError` would then be more correct.\n\nFor example, upon\n\n```\nsage: findstat()\nThe Combinatorial Statistic Finder (https://www.findstat.org/)\nsage: sage.databases.findstat._get_json(\"https://www.findstat.org/\")\n```\n\nif I only threw the `JSONDecodeError`, the message would simply be\n\n```\nJSONDecodeError: Expecting value: line 1 column 1 (char 0)\n```\n\nwhich wouldn't be helpful at all.\n\nThus I want to provide the `response.text`, which in this example would be the html of the frontpage of findstat.  Seeing this, I would immediately know that I forgot `api` in the url, which is a `ValueError`, I think.",
    "created_at": "2020-10-10T20:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433538",
    "user": "mantepse"
}
```

Because the reason for the error is (most likely) an inappropriate value `response.text`, due to (most likely) a bad url or a new but on the findstat server.  I felt that a `ValueError` would then be more correct.

For example, upon

```
sage: findstat()
The Combinatorial Statistic Finder (https://www.findstat.org/)
sage: sage.databases.findstat._get_json("https://www.findstat.org/")
```

if I only threw the `JSONDecodeError`, the message would simply be

```
JSONDecodeError: Expecting value: line 1 column 1 (char 0)
```

which wouldn't be helpful at all.

Thus I want to provide the `response.text`, which in this example would be the html of the frontpage of findstat.  Seeing this, I would immediately know that I forgot `api` in the url, which is a `ValueError`, I think.



---

archive/issue_comments_433539.json:
```json
{
    "body": "green bot + works for me",
    "created_at": "2020-10-22T09:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433539",
    "user": "slabbe"
}
```

green bot + works for me



---

archive/issue_comments_433540.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-10-22T09:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433540",
    "user": "slabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_433541.json:
```json
{
    "body": "Thank you!",
    "created_at": "2020-10-22T10:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433541",
    "user": "mantepse"
}
```

Thank you!



---

archive/issue_comments_433542.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-11-07T16:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30393#issuecomment-433542",
    "user": "vbraun"
}
```

Resolution: fixed
