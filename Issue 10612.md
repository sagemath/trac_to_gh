# Issue 10612: bug in elliptic curve two_descent command

Issue created by migration from Trac.

Original creator: was

Original creation time: 2011-01-20 22:36:34

Assignee: cremona

Don't do it twice:

```

sage: E = EllipticCurve([1,1,0,0,528])
sage: E.two_descent(verbose=False)
True
sage: E.two_descent(verbose=False)
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)

/Users/wstein/<ipython console> in <module>()

/Users/wstein/sage/install/sage-4.6.1/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in two_descent(self, verbose, selmer_only, first_limit, second_limit, n_aux, second_descent)
    868                         n_aux, second_descent)
    869         if C.certain():
--> 870             self.__gens[True] = [self.point(x, check=True) for x in C.gens()]
    871             self.__gens[True].sort()
    872             self.__rank[True] = len(self.__gens[True])

/Users/wstein/sage/install/sage-4.6.1/local/lib/python2.6/site-packages/sage/libs/mwrank/interface.pyc in gens(self)
    598         from sage.misc.all import preparse
    599         from sage.rings.all import Integer
--> 600         return eval(preparse(self.__two_descent_data().getbasis().replace(":",",")))
    601 
    602     def certain(self):

RuntimeError: 
```



---

Comment by weigandt created at 2011-03-23 02:04:01

This is probably explained by Cremona's comment at #10108:

"I think I can explain this. The problem to be solved for this ticket was that if mwrank is given incomplete but otherwise correct input, it just waits for the rest of the input, making Sage appear to hang. To fix this I made sure that the input provided by Sage always has some other stuff appended to it, so mwrank never has insufficient input. But then, the *next* time input is sent to mwrank, there is likely to be still some of that extra stuff in its input buffer. To get around that (I thought) I made sure that mwrank was restarted at every call.

Clearly what I did was insufficient, but this does explain who the order of executing commands does matter."


---

Comment by cremona created at 2011-03-23 04:02:15

And there are patches at #10108 which represent a lot of work which have been lying about unused and unmerged just because they are not perfect, even if Sage is better with them than without.


---

Comment by wuthrich created at 2014-03-31 12:07:47

Even after #10108, this is still a problem !


---

Comment by pbruin created at 2014-06-23 17:45:10

The cause is that each time you call `mwrank_EllipticCurve.two_descent()`, it creates a new `__descent` (the 2-descent data) but does not reset the `__saturate` bound.  Therefore no saturation is done on the new `__descent` data, which is bad because `getbasis()` depends on the saturation having been done.  I'm now testing a patch.


---

Comment by pbruin created at 2014-06-23 18:12:06

Changing status from new to needs_review.


---

Comment by pbruin created at 2014-06-23 18:12:06

(Note: the change to `if not self.__descent.ok()` is just a trivial simplification, the important line is `self.__saturate = -2`.)


---

Comment by chapoton created at 2014-06-26 07:11:52

ok, the patchbot is green, and the patch looks simple enough to me.

So let me give a positive review.


---

Comment by chapoton created at 2014-06-26 07:11:52

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-06-26 19:37:37

Resolution: fixed
