# Issue 18471: update normaliz to 2.12.2

archive/issues_018471.json:
```json
{
    "body": "CC:  novoselt dimpase\n\nNormaliz needs updating to bugfix release 2.12.2\n\nFrom normaliz website:\nVersion 2.12.2: bug fix in volume computation with -v and change max_rank_submatrix back to pre2.12 version which avoids some overflows\n\n(Upstream provides the distribution in a zip file; why does sage use a repackaged .tar.bz2?)\n\nhttp://www.home.uni-osnabrueck.de/wbruns/normaliz/Normaliz2.12.2/Normaliz2.12.2.zip\n\nIssue created by migration from https://trac.sagemath.org/ticket/18708\n\n",
    "created_at": "2015-06-16T06:25:30Z",
    "labels": [
        "packages: optional",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "update normaliz to 2.12.2",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18471",
    "user": "mkoeppe"
}
```
CC:  novoselt dimpase

Normaliz needs updating to bugfix release 2.12.2

From normaliz website:
Version 2.12.2: bug fix in volume computation with -v and change max_rank_submatrix back to pre2.12 version which avoids some overflows

(Upstream provides the distribution in a zip file; why does sage use a repackaged .tar.bz2?)

http://www.home.uni-osnabrueck.de/wbruns/normaliz/Normaliz2.12.2/Normaliz2.12.2.zip

Issue created by migration from https://trac.sagemath.org/ticket/18708





---

archive/issue_comments_251006.json:
```json
{
    "body": "IMHO Sage's \"sage -i\" cannot use zip archives, it needs a tar.",
    "created_at": "2015-06-16T07:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251006",
    "user": "dimpase"
}
```

IMHO Sage's "sage -i" cannot use zip archives, it needs a tar.



---

archive/issue_comments_251007.json:
```json
{
    "body": "Replying to [comment:1 dimpase]:\n> IMHO Sage's \"sage -i\" cannot use zip archives, it needs a tar.\n\nzip would be yet another dependency to have; e.g. I'm not sure whether OSX without Xcode does have (un)zip installed; ditto for \na typical Linux distro...",
    "created_at": "2015-06-16T07:57:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251007",
    "user": "dimpase"
}
```

Replying to [comment:1 dimpase]:
> IMHO Sage's "sage -i" cannot use zip archives, it needs a tar.

zip would be yet another dependency to have; e.g. I'm not sure whether OSX without Xcode does have (un)zip installed; ditto for 
a typical Linux distro...



---

archive/issue_comments_251008.json:
```json
{
    "body": "Python comes with the standard zipfile module that can easily be used to unzip, e.g.: http://opendata.stackexchange.com/questions/1208/a-python-guide-for-open-data-file-formats/1928#1928",
    "created_at": "2015-06-24T16:59:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251008",
    "user": "vbraun"
}
```

Python comes with the standard zipfile module that can easily be used to unzip, e.g.: http://opendata.stackexchange.com/questions/1208/a-python-guide-for-open-data-file-formats/1928#1928



---

archive/issue_comments_251009.json:
```json
{
    "body": "Replying to [comment:3 vbraun]:\n> Python comes with the standard zipfile module that can easily be used to unzip, e.g.: http://opendata.stackexchange.com/questions/1208/a-python-guide-for-open-data-file-formats/1928#1928\n\nDo you mean to say that `sage-spkg` ought to get extended to support this? In #18748?",
    "created_at": "2015-06-29T10:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251009",
    "user": "dimpase"
}
```

Replying to [comment:3 vbraun]:
> Python comes with the standard zipfile module that can easily be used to unzip, e.g.: http://opendata.stackexchange.com/questions/1208/a-python-guide-for-open-data-file-formats/1928#1928

Do you mean to say that `sage-spkg` ought to get extended to support this? In #18748?



---

archive/issue_comments_251010.json:
```json
{
    "body": "oops, we now have 3.0: http://www.home.uni-osnabrueck.de/wbruns/normaliz/Normaliz3.0/",
    "created_at": "2015-12-17T22:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251010",
    "user": "dimpase"
}
```

oops, we now have 3.0: http://www.home.uni-osnabrueck.de/wbruns/normaliz/Normaliz3.0/



---

archive/issue_comments_251011.json:
```json
{
    "body": "let me try this upgrade...",
    "created_at": "2015-12-17T22:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251011",
    "user": "dimpase"
}
```

let me try this upgrade...



---

archive/issue_comments_251012.json:
```json
{
    "body": "upstream [says](https://github.com/Normaliz/Normaliz/issues/83) that 3.1 will be available in January.\n\n(yes, they host the code here now: https://github.com/Normaliz/Normaliz/)\n\nAm I correct that there is no exposure of normaliz in Sage, apart from normaliz lib in Singular?",
    "created_at": "2015-12-21T18:42:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251012",
    "user": "dimpase"
}
```

upstream [says](https://github.com/Normaliz/Normaliz/issues/83) that 3.1 will be available in January.

(yes, they host the code here now: https://github.com/Normaliz/Normaliz/)

Am I correct that there is no exposure of normaliz in Sage, apart from normaliz lib in Singular?



---

archive/issue_comments_251013.json:
```json
{
    "body": "Replying to [comment:8 dimpase]:\n> Am I correct that there is no exposure of normaliz in Sage, apart from normaliz lib in Singular?\nI think so!",
    "created_at": "2015-12-27T20:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251013",
    "user": "novoselt"
}
```

Replying to [comment:8 dimpase]:
> Am I correct that there is no exposure of normaliz in Sage, apart from normaliz lib in Singular?
I think so!



---

archive/issue_comments_251014.json:
```json
{
    "body": "version 3.1 is released",
    "created_at": "2016-02-06T09:00:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251014",
    "user": "dimpase"
}
```

version 3.1 is released



---

archive/issue_comments_251015.json:
```json
{
    "body": "without LD_LIBRARY_PATH, normaliz fails to find GMP/MPIR libs at runtime. Of course, without a configure script it is a pain to configure.",
    "created_at": "2016-03-06T10:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251015",
    "user": "dimpase"
}
```

without LD_LIBRARY_PATH, normaliz fails to find GMP/MPIR libs at runtime. Of course, without a configure script it is a pain to configure.



---

archive/issue_comments_251016.json:
```json
{
    "body": "The normaliz \"buildsystem\" is a joke, imho a serious red flag. Once again we see that handcrafted makefiles do not work. In this case, not passing through LDFLAGS to the linker. But really thats just the tip of the iceberg: Not able to build a shared library, not even an install target.",
    "created_at": "2016-03-06T11:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251016",
    "user": "vbraun"
}
```

The normaliz "buildsystem" is a joke, imho a serious red flag. Once again we see that handcrafted makefiles do not work. In this case, not passing through LDFLAGS to the linker. But really thats just the tip of the iceberg: Not able to build a shared library, not even an install target.



---

archive/issue_comments_251017.json:
```json
{
    "body": "A hackish workaround is probably to add LDFLAGS to CXXFLAGS.",
    "created_at": "2016-03-06T11:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251017",
    "user": "vbraun"
}
```

A hackish workaround is probably to add LDFLAGS to CXXFLAGS.



---

archive/issue_comments_251018.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-03-06T15:46:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251018",
    "user": "dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_251019.json:
```json
{
    "body": "tested on Linux and OSX, via normaliz.lib in Singular, as was done on #13234.\nAll seems to work.",
    "created_at": "2016-03-06T15:46:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251019",
    "user": "dimpase"
}
```

tested on Linux and OSX, via normaliz.lib in Singular, as was done on #13234.
All seems to work.



---

archive/issue_comments_251020.json:
```json
{
    "body": "Replying to [comment:13 vbraun]:\n> The normaliz \"buildsystem\" is a joke, imho a serious red flag.\n\nthey actually have cmake support, as I was told just now: https://github.com/Normaliz/Normaliz/issues/88\nI haven't tried this with Sage.",
    "created_at": "2016-03-06T16:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251020",
    "user": "dimpase"
}
```

Replying to [comment:13 vbraun]:
> The normaliz "buildsystem" is a joke, imho a serious red flag.

they actually have cmake support, as I was told just now: https://github.com/Normaliz/Normaliz/issues/88
I haven't tried this with Sage.



---

archive/issue_comments_251021.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-06T18:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251021",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_251022.json:
```json
{
    "body": "BTW Sage can now use zip files as \"tarballs\"",
    "created_at": "2016-03-06T18:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251022",
    "user": "vbraun"
}
```

BTW Sage can now use zip files as "tarballs"



---

archive/issue_comments_251023.json:
```json
{
    "body": "Replying to [comment:20 vbraun]:\n> BTW Sage can now use zip files as \"tarballs\"\n\nI did have to re-pack anyway. Before I discovered this, I noticed a bug that I fixed.\nPerhaps I should have added it to this branch:\n\n```\ndiff --git a/build/bin/sage-uncompress-spkg b/build/bin/sage-uncompress-spkg\nindex 0f88a21..f2d8f21 100755\n--- a/build/bin/sage-uncompress-spkg\n+++ b/build/bin/sage-uncompress-spkg\n@@ -32,7 +32,7 @@ if __name__ == '__main__':\n     if zipfile.is_zipfile(filename):\n         # zip file:\n         with zipfile.ZipFile(filename, 'r') as archive:\n-            if len(sys.argv) == 1:\n+            if len(sys.argv) == 2:\n                 archive.extractall()\n             else:\n                 member = sys.argv[2]\n```\n",
    "created_at": "2016-03-06T19:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251023",
    "user": "dimpase"
}
```

Replying to [comment:20 vbraun]:
> BTW Sage can now use zip files as "tarballs"

I did have to re-pack anyway. Before I discovered this, I noticed a bug that I fixed.
Perhaps I should have added it to this branch:

```
diff --git a/build/bin/sage-uncompress-spkg b/build/bin/sage-uncompress-spkg
index 0f88a21..f2d8f21 100755
--- a/build/bin/sage-uncompress-spkg
+++ b/build/bin/sage-uncompress-spkg
@@ -32,7 +32,7 @@ if __name__ == '__main__':
     if zipfile.is_zipfile(filename):
         # zip file:
         with zipfile.ZipFile(filename, 'r') as archive:
-            if len(sys.argv) == 1:
+            if len(sys.argv) == 2:
                 archive.extractall()
             else:
                 member = sys.argv[2]
```




---

archive/issue_comments_251024.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-06T23:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18471",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18471#issuecomment-251024",
    "user": "vbraun"
}
```

Resolution: fixed
