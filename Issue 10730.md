# Issue 10730: Fix and upgrade double dense matrix QR decomposition

archive/issues_010730.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  @jasongrout @dandrake\n\nKeywords: beginner\n\nThe Q matrix of a QR decomposition should be unitary, hence invertible.  For zero-column trivial cases, this is broken.\n\n\n```\nsage: A = zero_matrix(CDF, 5, 0)\nsage: Q, R = A.QR()\nsage: Q\n[0 0 0 0 0]\n[0 0 0 0 0]\n[0 0 0 0 0]\n[0 0 0 0 0]\n[0 0 0 0 0]\n```\n\n\nBesides a bugfix this patch will upgrade the documentation to make it clear how this routine works over the complex numbers.  In particular, `SciPy` routines are using a Hermitian inner product - documentation upgrade will reflect that.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10795\n\n",
    "created_at": "2011-02-17T22:24:40Z",
    "labels": [
        "component: linear algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.2",
    "title": "Fix and upgrade double dense matrix QR decomposition",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10730",
    "user": "https://github.com/rbeezer"
}
```
Assignee: jason, was

CC:  @jasongrout @dandrake

Keywords: beginner

The Q matrix of a QR decomposition should be unitary, hence invertible.  For zero-column trivial cases, this is broken.


```
sage: A = zero_matrix(CDF, 5, 0)
sage: Q, R = A.QR()
sage: Q
[0 0 0 0 0]
[0 0 0 0 0]
[0 0 0 0 0]
[0 0 0 0 0]
[0 0 0 0 0]
```


Besides a bugfix this patch will upgrade the documentation to make it clear how this routine works over the complex numbers.  In particular, `SciPy` routines are using a Hermitian inner product - documentation upgrade will reflect that.

Issue created by migration from https://trac.sagemath.org/ticket/10795





---

archive/issue_comments_112897.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-02-17T23:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112897",
    "user": "https://github.com/rbeezer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_112898.json:
```json
{
    "body": "Just one change to the code, to return an identity matrix in a trivial case.  Everything else is documentation.  Unfortunately, this file is not included in the documentation (yet).  You can check that it builds without warnings, then look at it in the notebook to verify the contents and appearance.",
    "created_at": "2011-02-17T23:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112898",
    "user": "https://github.com/rbeezer"
}
```

Just one change to the code, to return an identity matrix in a trivial case.  Everything else is documentation.  Unfortunately, this file is not included in the documentation (yet).  You can check that it builds without warnings, then look at it in the notebook to verify the contents and appearance.



---

archive/issue_comments_112899.json:
```json
{
    "body": "Everything is OK with this patch.",
    "created_at": "2011-08-06T16:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112899",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Everything is OK with this patch.



---

archive/issue_comments_112900.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-08-06T16:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112900",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_112901.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-08-18T22:02:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112901",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_010835.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2011-08-18T22:02:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10730#event-10835"
}
```



---

archive/issue_comments_112902.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2011-08-24T08:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112902",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from closed to new.



---

archive/issue_events_010836.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2011-08-24T08:22:17Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10730#event-10836"
}
```



---

archive/issue_comments_112903.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2011-08-24T08:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112903",
    "user": "https://github.com/jdemeyer"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_112904.json:
```json
{
    "body": "On various systems, there are doctest failures:\n\nhawk (OpenSolaris 06/2009 i86pc Xeon W3580):\n\n```\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.2.alpha2/devel/sage-main/sage/matrix/matrix_double_dense.pyx\", line 1766:\n    sage: Q\nExpected:\n    [ -0.359210604054   0.569326179705   0.368048420509   0.641385845805]\n    [  0.179605302027  -0.144590775798   0.925041158846  -0.301884576418]\n    [  0.179605302027  -0.704880032016  0.0774617736597   0.681825307224]\n    [  0.898026510134   0.397624633445 -0.0532812182975   0.180566192161]\nGot:\n    [-0.359210604054  0.569326179705  0.409076682956  0.616028985113]\n    [ 0.179605302027 -0.144590775798 -0.683704756325   0.69237507842]\n    [ 0.179605302027 -0.704880032016  0.575201135981  0.374205463771]\n    [ 0.898026510134  0.397624633445  0.185331397251 0.0330954856071]\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.2.alpha2/devel/sage-main/sage/matrix/matrix_double_dense.pyx\", line 1771:\n    sage: R\nExpected:\n    [    -5.56776436283       2.6940795304      -2.6940795304]\n    [                 0     -3.56958477752      3.56958477752]\n    [                 0                  0 -9.93013661299e-16]\n    [                 0                  0                  0]\nGot:\n    [   -5.56776436283      2.6940795304     -2.6940795304]\n    [                0    -3.56958477752     3.56958477752]\n    [                0                 0 -4.4408920985e-16]\n    [                0                 0                 0]\n**********************************************************************\n```\n\n\nbsd (OS X 10.8.0 x86_64) 64-bit:\n\n```\n**********************************************************************\nFile \"/Users/buildbot/build/sage/bsd-1/bsd_64_full/build/sage-4.7.2.alpha2/devel/sage-main/sage/matrix/matrix_double_dense.pyx\", line 1766:\n    sage: Q\nExpected:\n    [ -0.359210604054   0.569326179705   0.368048420509   0.641385845805]\n    [  0.179605302027  -0.144590775798   0.925041158846  -0.301884576418]\n    [  0.179605302027  -0.704880032016  0.0774617736597   0.681825307224]\n    [  0.898026510134   0.397624633445 -0.0532812182975   0.180566192161]\nGot:\n    [ -0.359210604054   0.569326179705   0.146337376237   0.724859169325]\n    [  0.179605302027  -0.144590775798   0.973035382602 0.00613084354877]\n    [  0.179605302027  -0.704880032016  -0.142125402809   0.671331844787]\n    [  0.898026510134   0.397624633445  -0.107647045464   0.154451130063]\n**********************************************************************\nFile \"/Users/buildbot/build/sage/bsd-1/bsd_64_full/build/sage-4.7.2.alpha2/devel/sage-main/sage/matrix/matrix_double_dense.pyx\", line 1771:\n    sage: R\nExpected:\n    [    -5.56776436283       2.6940795304      -2.6940795304]\n    [                 0     -3.56958477752      3.56958477752]\n    [                 0                  0 -9.93013661299e-16]\n    [                 0                  0                  0]\nGot:\n    [   -5.56776436283      2.6940795304     -2.6940795304]\n    [                0    -3.56958477752     3.56958477752]\n    [                0                 0 6.28036983474e-16]\n    [                0                 0                 0]\n**********************************************************************\n```\n\n\ncleo (RHEL 5.3 ia64 Itanium 2):\n\n```\n**********************************************************************\nFile \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.2.alpha2/devel/sage-main/sage/matrix/matrix_double_dense.pyx\", line 1766:\n    sage: Q\nExpected:\n    [ -0.359210604054   0.569326179705   0.368048420509   0.641385845805]\n    [  0.179605302027  -0.144590775798   0.925041158846  -0.301884576418]\n    [  0.179605302027  -0.704880032016  0.0774617736597   0.681825307224]\n    [  0.898026510134   0.397624633445 -0.0532812182975   0.180566192161]\nGot:\n    [ -0.359210604054   0.569326179705   0.146859067236   0.724753652911]\n    [  0.179605302027  -0.144590775798   0.973039543327 0.00543048428303]\n    [  0.179605302027  -0.704880032016  -0.141642164231   0.671433967908]\n    [  0.898026510134   0.397624633445  -0.107535848925   0.154528570726]\n**********************************************************************\nFile \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.2.alpha2/devel/sage-main/sage/matrix/matrix_double_dense.pyx\", line 1771:\n    sage: R\nExpected:\n    [    -5.56776436283       2.6940795304      -2.6940795304]\n    [                 0     -3.56958477752      3.56958477752]\n    [                 0                  0 -9.93013661299e-16]\n    [                 0                  0                  0]\nGot:\n    [   -5.56776436283      2.6940795304     -2.6940795304]\n    [                0    -3.56958477752     3.56958477752]\n    [                0                 0 9.81879219451e-16]\n    [                0                 0                 0]\n**********************************************************************\n```\n",
    "created_at": "2011-08-24T08:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112904",
    "user": "https://github.com/jdemeyer"
}
```

On various systems, there are doctest failures:

hawk (OpenSolaris 06/2009 i86pc Xeon W3580):

```
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.2.alpha2/devel/sage-main/sage/matrix/matrix_double_dense.pyx", line 1766:
    sage: Q
Expected:
    [ -0.359210604054   0.569326179705   0.368048420509   0.641385845805]
    [  0.179605302027  -0.144590775798   0.925041158846  -0.301884576418]
    [  0.179605302027  -0.704880032016  0.0774617736597   0.681825307224]
    [  0.898026510134   0.397624633445 -0.0532812182975   0.180566192161]
Got:
    [-0.359210604054  0.569326179705  0.409076682956  0.616028985113]
    [ 0.179605302027 -0.144590775798 -0.683704756325   0.69237507842]
    [ 0.179605302027 -0.704880032016  0.575201135981  0.374205463771]
    [ 0.898026510134  0.397624633445  0.185331397251 0.0330954856071]
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.2.alpha2/devel/sage-main/sage/matrix/matrix_double_dense.pyx", line 1771:
    sage: R
Expected:
    [    -5.56776436283       2.6940795304      -2.6940795304]
    [                 0     -3.56958477752      3.56958477752]
    [                 0                  0 -9.93013661299e-16]
    [                 0                  0                  0]
Got:
    [   -5.56776436283      2.6940795304     -2.6940795304]
    [                0    -3.56958477752     3.56958477752]
    [                0                 0 -4.4408920985e-16]
    [                0                 0                 0]
**********************************************************************
```


bsd (OS X 10.8.0 x86_64) 64-bit:

```
**********************************************************************
File "/Users/buildbot/build/sage/bsd-1/bsd_64_full/build/sage-4.7.2.alpha2/devel/sage-main/sage/matrix/matrix_double_dense.pyx", line 1766:
    sage: Q
Expected:
    [ -0.359210604054   0.569326179705   0.368048420509   0.641385845805]
    [  0.179605302027  -0.144590775798   0.925041158846  -0.301884576418]
    [  0.179605302027  -0.704880032016  0.0774617736597   0.681825307224]
    [  0.898026510134   0.397624633445 -0.0532812182975   0.180566192161]
Got:
    [ -0.359210604054   0.569326179705   0.146337376237   0.724859169325]
    [  0.179605302027  -0.144590775798   0.973035382602 0.00613084354877]
    [  0.179605302027  -0.704880032016  -0.142125402809   0.671331844787]
    [  0.898026510134   0.397624633445  -0.107647045464   0.154451130063]
**********************************************************************
File "/Users/buildbot/build/sage/bsd-1/bsd_64_full/build/sage-4.7.2.alpha2/devel/sage-main/sage/matrix/matrix_double_dense.pyx", line 1771:
    sage: R
Expected:
    [    -5.56776436283       2.6940795304      -2.6940795304]
    [                 0     -3.56958477752      3.56958477752]
    [                 0                  0 -9.93013661299e-16]
    [                 0                  0                  0]
Got:
    [   -5.56776436283      2.6940795304     -2.6940795304]
    [                0    -3.56958477752     3.56958477752]
    [                0                 0 6.28036983474e-16]
    [                0                 0                 0]
**********************************************************************
```


cleo (RHEL 5.3 ia64 Itanium 2):

```
**********************************************************************
File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.2.alpha2/devel/sage-main/sage/matrix/matrix_double_dense.pyx", line 1766:
    sage: Q
Expected:
    [ -0.359210604054   0.569326179705   0.368048420509   0.641385845805]
    [  0.179605302027  -0.144590775798   0.925041158846  -0.301884576418]
    [  0.179605302027  -0.704880032016  0.0774617736597   0.681825307224]
    [  0.898026510134   0.397624633445 -0.0532812182975   0.180566192161]
Got:
    [ -0.359210604054   0.569326179705   0.146859067236   0.724753652911]
    [  0.179605302027  -0.144590775798   0.973039543327 0.00543048428303]
    [  0.179605302027  -0.704880032016  -0.141642164231   0.671433967908]
    [  0.898026510134   0.397624633445  -0.107535848925   0.154528570726]
**********************************************************************
File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.2.alpha2/devel/sage-main/sage/matrix/matrix_double_dense.pyx", line 1771:
    sage: R
Expected:
    [    -5.56776436283       2.6940795304      -2.6940795304]
    [                 0     -3.56958477752      3.56958477752]
    [                 0                  0 -9.93013661299e-16]
    [                 0                  0                  0]
Got:
    [   -5.56776436283      2.6940795304     -2.6940795304]
    [                0    -3.56958477752     3.56958477752]
    [                0                 0 9.81879219451e-16]
    [                0                 0                 0]
**********************************************************************
```




---

archive/issue_comments_112905.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-08-24T21:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112905",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_112906.json:
```json
{
    "body": "It seems that this patch causes failures in a\nnon-reproducible way.  Is there some randomness in the algorithm?\nFor example, I just got this failure on sage.math.washington.edu (a\nmachine on which I remember the test succeeding):\n\n```\nsage -t -long  -force_lib devel/sage/sage/matrix/matrix_double_dense.pyx\n**********************************************************************\nFile\n\"/mnt/usb1/scratch/buildbot/sage/sage-1/sage_binary/build/sage-4.7.2.alpha2/devel/sage-main/sage/matrix/matrix_double_dense.pyx\",\nline 1766:\n    sage: Q\nExpected:\n    [ -0.359210604054   0.569326179705   0.368048420509   0.641385845805]\n    [  0.179605302027  -0.144590775798   0.925041158846  -0.301884576418]\n    [  0.179605302027  -0.704880032016  0.0774617736597   0.681825307224]\n    [  0.898026510134   0.397624633445 -0.0532812182975   0.180566192161]\nGot:\n    [-0.359210604054  0.569326179705  0.616028985113  0.409076682956]\n    [ 0.179605302027 -0.144590775798   0.69237507842 -0.683704756325]\n    [ 0.179605302027 -0.704880032016  0.374205463771  0.575201135981]\n    [ 0.898026510134  0.397624633445 0.0330954856071  0.185331397251]\n**********************************************************************\nFile\n\"/mnt/usb1/scratch/buildbot/sage/sage-1/sage_binary/build/sage-4.7.2.alpha2/devel/sage-main/sage/matrix/matrix_double_dense.pyx\",\nline 1771:\n    sage: R\nExpected:\n    [    -5.56776436283       2.6940795304      -2.6940795304]\n    [                 0     -3.56958477752      3.56958477752]\n    [                 0                  0 -9.93013661299e-16]\n    [                 0                  0                  0]\nGot:\n    [   -5.56776436283      2.6940795304     -2.6940795304]\n    [                0    -3.56958477752     3.56958477752]\n    [                0                 0 -4.4408920985e-16]\n    [                0                 0                 0]\n**********************************************************************\n```\n",
    "created_at": "2011-08-24T21:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112906",
    "user": "https://github.com/jdemeyer"
}
```

It seems that this patch causes failures in a
non-reproducible way.  Is there some randomness in the algorithm?
For example, I just got this failure on sage.math.washington.edu (a
machine on which I remember the test succeeding):

```
sage -t -long  -force_lib devel/sage/sage/matrix/matrix_double_dense.pyx
**********************************************************************
File
"/mnt/usb1/scratch/buildbot/sage/sage-1/sage_binary/build/sage-4.7.2.alpha2/devel/sage-main/sage/matrix/matrix_double_dense.pyx",
line 1766:
    sage: Q
Expected:
    [ -0.359210604054   0.569326179705   0.368048420509   0.641385845805]
    [  0.179605302027  -0.144590775798   0.925041158846  -0.301884576418]
    [  0.179605302027  -0.704880032016  0.0774617736597   0.681825307224]
    [  0.898026510134   0.397624633445 -0.0532812182975   0.180566192161]
Got:
    [-0.359210604054  0.569326179705  0.616028985113  0.409076682956]
    [ 0.179605302027 -0.144590775798   0.69237507842 -0.683704756325]
    [ 0.179605302027 -0.704880032016  0.374205463771  0.575201135981]
    [ 0.898026510134  0.397624633445 0.0330954856071  0.185331397251]
**********************************************************************
File
"/mnt/usb1/scratch/buildbot/sage/sage-1/sage_binary/build/sage-4.7.2.alpha2/devel/sage-main/sage/matrix/matrix_double_dense.pyx",
line 1771:
    sage: R
Expected:
    [    -5.56776436283       2.6940795304      -2.6940795304]
    [                 0     -3.56958477752      3.56958477752]
    [                 0                  0 -9.93013661299e-16]
    [                 0                  0                  0]
Got:
    [   -5.56776436283      2.6940795304     -2.6940795304]
    [                0    -3.56958477752     3.56958477752]
    [                0                 0 -4.4408920985e-16]
    [                0                 0                 0]
**********************************************************************
```




---

archive/issue_comments_112907.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-08-24T21:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112907",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_112908.json:
```json
{
    "body": "Changing keywords from \"beginner\" to \"\".",
    "created_at": "2011-09-19T03:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112908",
    "user": "https://github.com/rbeezer"
}
```

Changing keywords from "beginner" to "".



---

archive/issue_comments_112909.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-09-19T03:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112909",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_112910.json:
```json
{
    "body": "\"numerical\" patch applies accumulated techniques for these numerical computations and should address the doctest failures.",
    "created_at": "2011-09-19T03:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112910",
    "user": "https://github.com/rbeezer"
}
```

"numerical" patch applies accumulated techniques for these numerical computations and should address the doctest failures.



---

archive/issue_comments_112911.json:
```json
{
    "body": "Same question on here as on #10791 -- is it appropriate to set this back to positive review (assuming the tests still pass on Rob's machine)?",
    "created_at": "2011-12-04T00:15:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112911",
    "user": "https://github.com/jasongrout"
}
```

Same question on here as on #10791 -- is it appropriate to set this back to positive review (assuming the tests still pass on Rob's machine)?



---

archive/issue_comments_112912.json:
```json
{
    "body": "Applies and passes all tests on 4.8.alpha3.",
    "created_at": "2011-12-05T05:45:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112912",
    "user": "https://github.com/rbeezer"
}
```

Applies and passes all tests on 4.8.alpha3.



---

archive/issue_comments_112913.json:
```json
{
    "body": "Based on jdmeyer's response to my question on #10791: the fixing patch looks reasonable and Rob tested it.  I'd test it as well, except I'm currently building python 2.7 and testing it.",
    "created_at": "2011-12-14T04:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112913",
    "user": "https://github.com/jasongrout"
}
```

Based on jdmeyer's response to my question on #10791: the fixing patch looks reasonable and Rob tested it.  I'd test it as well, except I'm currently building python 2.7 and testing it.



---

archive/issue_comments_112914.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-12-14T04:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112914",
    "user": "https://github.com/jasongrout"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_112915.json:
```json
{
    "body": "Sorry, I meant jdemeyer's response...",
    "created_at": "2011-12-14T04:20:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112915",
    "user": "https://github.com/jasongrout"
}
```

Sorry, I meant jdemeyer's response...



---

archive/issue_events_010837.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2011-12-17T09:11:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10730#event-10837"
}
```



---

archive/issue_comments_112916.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-12-17T09:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112916",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_112917.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2011-12-19T21:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112917",
    "user": "https://github.com/jdemeyer"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_112918.json:
```json
{
    "body": "This sometimes gives a doctest failure:\n\n```\nsage -t -long  -force_lib devel/sage/sage/matrix/matrix_double_dense.pyx\n**********************************************************************\nFile \"/mnt/usb1/scratch/buildbot/sage/sage-1/sage_binary/build/sage-4.8.alpha5/devel/sage-main/sage/matrix/matrix_double_dense.pyx\", line 2243:\n    sage: Q.round(6).zero_at(10^-6)\nExpected:\n    [-0.359211  0.569326  0.368048  0.641386]\n    [ 0.179605 -0.144591  0.925041 -0.301885]\n    [ 0.179605  -0.70488  0.077462  0.681825]\n    [ 0.898027  0.397625 -0.053281  0.180566]\nGot:\n    [-0.359211  0.569326 -0.631992 -0.383955]\n    [ 0.179605 -0.144591   -0.6643  0.711014]\n    [ 0.179605  -0.70488  -0.39705 -0.559676]\n    [ 0.898027  0.397625 -0.040527 -0.183849]\n**********************************************************************\n```\n\n\nIt's not clear why it happens.  Because on the same machine I have one Sage build where it works, one where it doesn't with the exact same source, but different gcc version.\n\nDoes this code use any external libraries (ATLAS comes to mind)?",
    "created_at": "2011-12-19T21:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112918",
    "user": "https://github.com/jdemeyer"
}
```

This sometimes gives a doctest failure:

```
sage -t -long  -force_lib devel/sage/sage/matrix/matrix_double_dense.pyx
**********************************************************************
File "/mnt/usb1/scratch/buildbot/sage/sage-1/sage_binary/build/sage-4.8.alpha5/devel/sage-main/sage/matrix/matrix_double_dense.pyx", line 2243:
    sage: Q.round(6).zero_at(10^-6)
Expected:
    [-0.359211  0.569326  0.368048  0.641386]
    [ 0.179605 -0.144591  0.925041 -0.301885]
    [ 0.179605  -0.70488  0.077462  0.681825]
    [ 0.898027  0.397625 -0.053281  0.180566]
Got:
    [-0.359211  0.569326 -0.631992 -0.383955]
    [ 0.179605 -0.144591   -0.6643  0.711014]
    [ 0.179605  -0.70488  -0.39705 -0.559676]
    [ 0.898027  0.397625 -0.040527 -0.183849]
**********************************************************************
```


It's not clear why it happens.  Because on the same machine I have one Sage build where it works, one where it doesn't with the exact same source, but different gcc version.

Does this code use any external libraries (ATLAS comes to mind)?



---

archive/issue_comments_112919.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2011-12-19T21:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112919",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from closed to new.



---

archive/issue_events_010838.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2011-12-19T21:30:46Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10730#event-10838"
}
```



---

archive/issue_comments_112920.json:
```json
{
    "body": "On Fedora 15-64 (flavius):\n\n```\nsage -t -long  -force_lib devel/sage/sage/matrix/matrix_double_dense.pyx\n**********************************************************************\nFile \"/home/buildbot/build/sage/flavius-1/flavius_full/build/sage-4.8.alpha5/devel/sage-main/sage/matrix/matrix_double_dense.pyx\", line 2243:\n    sage: Q.round(6).zero_at(10^-6)\nExpected:\n    [-0.359211  0.569326  0.368048  0.641386]\n    [ 0.179605 -0.144591  0.925041 -0.301885]\n    [ 0.179605  -0.70488  0.077462  0.681825]\n    [ 0.898027  0.397625 -0.053281  0.180566]\nGot:\n    [-0.359211  0.569326  0.616029  0.409077]\n    [ 0.179605 -0.144591  0.692375 -0.683705]\n    [ 0.179605  -0.70488  0.374205  0.575201]\n    [ 0.898027  0.397625  0.033095  0.185331]\n**********************************************************************\n```\n",
    "created_at": "2011-12-21T09:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112920",
    "user": "https://github.com/jdemeyer"
}
```

On Fedora 15-64 (flavius):

```
sage -t -long  -force_lib devel/sage/sage/matrix/matrix_double_dense.pyx
**********************************************************************
File "/home/buildbot/build/sage/flavius-1/flavius_full/build/sage-4.8.alpha5/devel/sage-main/sage/matrix/matrix_double_dense.pyx", line 2243:
    sage: Q.round(6).zero_at(10^-6)
Expected:
    [-0.359211  0.569326  0.368048  0.641386]
    [ 0.179605 -0.144591  0.925041 -0.301885]
    [ 0.179605  -0.70488  0.077462  0.681825]
    [ 0.898027  0.397625 -0.053281  0.180566]
Got:
    [-0.359211  0.569326  0.616029  0.409077]
    [ 0.179605 -0.144591  0.692375 -0.683705]
    [ 0.179605  -0.70488  0.374205  0.575201]
    [ 0.898027  0.397625  0.033095  0.185331]
**********************************************************************
```




---

archive/issue_comments_112921.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-12-21T09:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112921",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_112922.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-12-21T09:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112922",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_112923.json:
```json
{
    "body": "Thanks, Jeroen.  Sorry for the delay in getting back to this one.\n\nYes, this uses SciPy, which in turn will use ATLAS.  It seems a 2-dimensional eigenspace is being returned with different basis vectors.\n\nThis is mostly a documentation patch, so I think it would be best to make the tests more functional - checking that returned matrices have the desired properties - and less about the actual entries of the matrices.  I'll put that on my list.\n\nRob",
    "created_at": "2011-12-21T19:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112923",
    "user": "https://github.com/rbeezer"
}
```

Thanks, Jeroen.  Sorry for the delay in getting back to this one.

Yes, this uses SciPy, which in turn will use ATLAS.  It seems a 2-dimensional eigenspace is being returned with different basis vectors.

This is mostly a documentation patch, so I think it would be best to make the tests more functional - checking that returned matrices have the desired properties - and less about the actual entries of the matrices.  I'll put that on my list.

Rob



---

archive/issue_comments_112924.json:
```json
{
    "body": "*** bump ***",
    "created_at": "2012-01-24T09:15:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112924",
    "user": "https://github.com/jdemeyer"
}
```

*** bump ***



---

archive/issue_comments_112925.json:
```json
{
    "body": "Attachment [trac_10795-QR-decomposition-double-dense-v2.patch](tarball://root/attachments/some-uuid/ticket10795/trac_10795-QR-decomposition-double-dense-v2.patch) by @rbeezer created at 2012-05-28 02:43:58\n\n* Jeroen - thanks for the bump.\n* Needed a rebase, so did that and also tidied up a few things. Almost entirely documentation, with one code change.  Will need a new review since the documentation has changed.\n* Doctest failures.  Seems different platforms give different bases for the dimension 2 left kernel of the matrix.  No harm in just removing it and explaining the situation, along with definitive evidence that the result behaves as expected.",
    "created_at": "2012-05-28T02:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112925",
    "user": "https://github.com/rbeezer"
}
```

Attachment [trac_10795-QR-decomposition-double-dense-v2.patch](tarball://root/attachments/some-uuid/ticket10795/trac_10795-QR-decomposition-double-dense-v2.patch) by @rbeezer created at 2012-05-28 02:43:58

* Jeroen - thanks for the bump.
* Needed a rebase, so did that and also tidied up a few things. Almost entirely documentation, with one code change.  Will need a new review since the documentation has changed.
* Doctest failures.  Seems different platforms give different bases for the dimension 2 left kernel of the matrix.  No harm in just removing it and explaining the situation, along with definitive evidence that the result behaves as expected.



---

archive/issue_comments_112926.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-28T02:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112926",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_112927.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd40.5\".",
    "created_at": "2012-05-28T02:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112927",
    "user": "https://github.com/rbeezer"
}
```

Changing keywords from "" to "sd40.5".



---

archive/issue_comments_112928.json:
```json
{
    "body": "This looks good, and I think it is reasonable to use the Q as it is.\n\nCould you please go over the patch and correct the ``Q`` and Q to `Q` (and I think in some places R is missing the quotes also). Then I can give this a positive review.",
    "created_at": "2012-05-28T08:24:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112928",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

This looks good, and I think it is reasonable to use the Q as it is.

Could you please go over the patch and correct the ``Q`` and Q to `Q` (and I think in some places R is missing the quotes also). Then I can give this a positive review.



---

archive/issue_comments_112929.json:
```json
{
    "body": "Attachment [trac_10795-QR-decomposition-formatting.patch](tarball://root/attachments/some-uuid/ticket10795/trac_10795-QR-decomposition-formatting.patch) by @rbeezer created at 2012-05-28 16:14:26",
    "created_at": "2012-05-28T16:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112929",
    "user": "https://github.com/rbeezer"
}
```

Attachment [trac_10795-QR-decomposition-formatting.patch](tarball://root/attachments/some-uuid/ticket10795/trac_10795-QR-decomposition-formatting.patch) by @rbeezer created at 2012-05-28 16:14:26



---

archive/issue_comments_112930.json:
```json
{
    "body": "Dear Martin,\n\nThanks for participating remotely in Sage Days 40.5.  ;-)\n\n\"formatting\" patch is an add-on, so you can see the changes.  I did the \"OUTPUT\" section entirely with math quotes, other than the result objects.  The rest is in code quotes.\n\nUpdated the output description, which needed work.  Added some left kernel explanation for Dan Drake, who was also looking at this here at SD 40.5.\n\nThanks again,\nRob",
    "created_at": "2012-05-28T16:20:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112930",
    "user": "https://github.com/rbeezer"
}
```

Dear Martin,

Thanks for participating remotely in Sage Days 40.5.  ;-)

"formatting" patch is an add-on, so you can see the changes.  I did the "OUTPUT" section entirely with math quotes, other than the result objects.  The rest is in code quotes.

Updated the output description, which needed work.  Added some left kernel explanation for Dan Drake, who was also looking at this here at SD 40.5.

Thanks again,
Rob



---

archive/issue_comments_112931.json:
```json
{
    "body": "This is a big improvement over what we previously had. Positive review.\n\nJust for the patchbot: apply \ntrac_10795-QR-decomposition-double-dense-v2.patch \ntrac_10795-QR-decomposition-formatting.patch",
    "created_at": "2012-05-28T17:02:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112931",
    "user": "https://github.com/dandrake"
}
```

This is a big improvement over what we previously had. Positive review.

Just for the patchbot: apply 
trac_10795-QR-decomposition-double-dense-v2.patch 
trac_10795-QR-decomposition-formatting.patch



---

archive/issue_comments_112932.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-28T17:02:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112932",
    "user": "https://github.com/dandrake"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_010839.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2012-06-18T10:22:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10730#event-10839"
}
```



---

archive/issue_comments_112933.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-18T10:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112933",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_112934.json:
```json
{
    "body": "As reported on sage-devel, this gives doctest failures on OS X Lion, see #13140.",
    "created_at": "2012-06-20T06:50:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112934",
    "user": "https://github.com/jdemeyer"
}
```

As reported on sage-devel, this gives doctest failures on OS X Lion, see #13140.



---

archive/issue_comments_112935.json:
```json
{
    "body": "Unmerging due to #13140.",
    "created_at": "2012-06-26T06:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112935",
    "user": "https://github.com/jdemeyer"
}
```

Unmerging due to #13140.



---

archive/issue_comments_112936.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2012-06-26T06:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112936",
    "user": "https://github.com/jdemeyer"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_112937.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2012-06-26T06:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112937",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from closed to new.



---

archive/issue_events_010840.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2012-06-26T06:50:15Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10730#event-10840"
}
```



---

archive/issue_comments_112938.json:
```json
{
    "body": "Should this be marked \"positive review\" again, since #13140 is ready?",
    "created_at": "2012-07-11T13:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112938",
    "user": "https://github.com/jhpalmieri"
}
```

Should this be marked "positive review" again, since #13140 is ready?



---

archive/issue_comments_112939.json:
```json
{
    "body": "Replying to [comment:27 jhpalmieri]:\n> Should this be marked \"positive review\" again, since #13140 is ready?\n\nI think so. If that was the only reason this got unmerged, and that ticket is now fixed, this should again be ready.",
    "created_at": "2012-07-11T14:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112939",
    "user": "https://github.com/dandrake"
}
```

Replying to [comment:27 jhpalmieri]:
> Should this be marked "positive review" again, since #13140 is ready?

I think so. If that was the only reason this got unmerged, and that ticket is now fixed, this should again be ready.



---

archive/issue_comments_112940.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-07-11T14:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112940",
    "user": "https://github.com/dandrake"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_112941.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-07-11T14:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112941",
    "user": "https://github.com/dandrake"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_112942.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-07-13T11:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10730#issuecomment-112942",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_010841.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2012-07-13T11:43:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10730",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10730#event-10841"
}
```
