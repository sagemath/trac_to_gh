# Issue 22506: little cleanup of Wehler K3

Issue created by migration from https://trac.sagemath.org/ticket/22743

Original creator: chapoton

Original creation time: 2017-04-02 19:17:49

in particular to make that all elements of orbits belong to the K3 itself.

plus a general pyflakes cleanup


---

Comment by chapoton created at 2017-04-02 19:18:27

Changing status from new to needs_review.


---

Comment by chapoton created at 2017-04-02 19:18:27

New commits:


---

Comment by chapoton created at 2017-04-02 19:23:39

needed for #22649, please review


---

Comment by bhutz created at 2017-04-02 19:48:03

It's building now so I can run some tests. But one question from looking through the code.

In a couple places you've changed


```
copy(Q)
```

to

```
self(copy(Q))
```

When copying a subscheme point it preserves the codomain, so is there a particular reason you're adding that extra coercion to the subscheme?

Everything else seems like standard clean-up.


---

Comment by chapoton created at 2017-04-02 19:50:32

yes, this is the main reason for this ticket.

I want all members of an orbit to belong to the same parent. If the given input is returned in the orbit, it does not belong to the K3, but to the ambient projective space. Try something like

[u.parent() for u in orbit]


---

Comment by bhutz created at 2017-04-02 20:12:19

With correct input, that works just fine for me.  The problem looks to me like it lies in the doctest not in the code:


```
sage: X = WehlerK3Surface([Z, Y])
sage: T = PP(0, 0, 1, 1, 0, 0)
```


Notice that the doctest is mistakenly defining the initial point on the ambient space and not the K3 surface.


Your fix does prevent this bad input problem. That is what you're trying to fix?


---

Comment by chapoton created at 2017-04-02 20:16:11

Well, in #22649, I am painfuly trying to modernize (for python3) the comparison of scheme morphisms. This triggered a doctest failure in WehlerK3, that I tracked to the fact the the parent of orbit[0] was not the same as the parent of the last element of the orbit.

So I guess I do not mind the way we fix it here : either by fixing the initial point in the doctest or by using this self(copy(Q)) in the code (or even both..)


---

Comment by bhutz created at 2017-04-02 20:23:21

I see. Then I say we should fix it both ways. Well, at least change the doctest in one of the two orbit functions. That way both the 'good' and 'bad' inputs are checked.

There is no way a user would call that function with a point not on the K3 surface, so adding the coercion should not cause any problems other than some extra computation. Since the function does succeed with the 'bad' input, those points should all have the same parent.


---

Comment by bhutz created at 2017-04-02 21:14:58

Changing status from needs_review to positive_review.


---

Comment by bhutz created at 2017-04-02 21:14:58

all tests pass.

I also made the small tweak to the one doc test.
----
New commits:


---

Comment by vbraun created at 2017-04-05 19:37:51

Resolution: fixed
