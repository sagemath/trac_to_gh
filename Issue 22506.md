# Issue 22506: little cleanup of Wehler K3

archive/issues_022506.json:
```json
{
    "body": "in particular to make that all elements of orbits belong to the K3 itself.\n\nplus a general pyflakes cleanup\n\nIssue created by migration from https://trac.sagemath.org/ticket/22743\n\n",
    "created_at": "2017-04-02T19:17:49Z",
    "labels": [
        "geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "little cleanup of Wehler K3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22506",
    "user": "@fchapoton"
}
```
in particular to make that all elements of orbits belong to the K3 itself.

plus a general pyflakes cleanup

Issue created by migration from https://trac.sagemath.org/ticket/22743





---

archive/issue_comments_313555.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-02T19:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22506#issuecomment-313555",
    "user": "@fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_313556.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-04-02T19:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22506#issuecomment-313556",
    "user": "@fchapoton"
}
```

New commits:



---

archive/issue_comments_313557.json:
```json
{
    "body": "needed for #22649, please review",
    "created_at": "2017-04-02T19:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22506#issuecomment-313557",
    "user": "@fchapoton"
}
```

needed for #22649, please review



---

archive/issue_comments_313558.json:
```json
{
    "body": "It's building now so I can run some tests. But one question from looking through the code.\n\nIn a couple places you've changed\n\n\n```\ncopy(Q)\n```\n\nto\n\n```\nself(copy(Q))\n```\n\nWhen copying a subscheme point it preserves the codomain, so is there a particular reason you're adding that extra coercion to the subscheme?\n\nEverything else seems like standard clean-up.",
    "created_at": "2017-04-02T19:48:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22506#issuecomment-313558",
    "user": "@bhutz"
}
```

It's building now so I can run some tests. But one question from looking through the code.

In a couple places you've changed


```
copy(Q)
```

to

```
self(copy(Q))
```

When copying a subscheme point it preserves the codomain, so is there a particular reason you're adding that extra coercion to the subscheme?

Everything else seems like standard clean-up.



---

archive/issue_comments_313559.json:
```json
{
    "body": "yes, this is the main reason for this ticket.\n\nI want all members of an orbit to belong to the same parent. If the given input is returned in the orbit, it does not belong to the K3, but to the ambient projective space. Try something like\n\n[u.parent() for u in orbit]",
    "created_at": "2017-04-02T19:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22506#issuecomment-313559",
    "user": "@fchapoton"
}
```

yes, this is the main reason for this ticket.

I want all members of an orbit to belong to the same parent. If the given input is returned in the orbit, it does not belong to the K3, but to the ambient projective space. Try something like

[u.parent() for u in orbit]



---

archive/issue_comments_313560.json:
```json
{
    "body": "With correct input, that works just fine for me.  The problem looks to me like it lies in the doctest not in the code:\n\n\n```\nsage: X = WehlerK3Surface([Z, Y])\nsage: T = PP(0, 0, 1, 1, 0, 0)\n```\n\n\nNotice that the doctest is mistakenly defining the initial point on the ambient space and not the K3 surface.\n\n\nYour fix does prevent this bad input problem. That is what you're trying to fix?",
    "created_at": "2017-04-02T20:12:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22506#issuecomment-313560",
    "user": "@bhutz"
}
```

With correct input, that works just fine for me.  The problem looks to me like it lies in the doctest not in the code:


```
sage: X = WehlerK3Surface([Z, Y])
sage: T = PP(0, 0, 1, 1, 0, 0)
```


Notice that the doctest is mistakenly defining the initial point on the ambient space and not the K3 surface.


Your fix does prevent this bad input problem. That is what you're trying to fix?



---

archive/issue_comments_313561.json:
```json
{
    "body": "Well, in #22649, I am painfuly trying to modernize (for python3) the comparison of scheme morphisms. This triggered a doctest failure in WehlerK3, that I tracked to the fact the the parent of orbit[0] was not the same as the parent of the last element of the orbit.\n\nSo I guess I do not mind the way we fix it here : either by fixing the initial point in the doctest or by using this self(copy(Q)) in the code (or even both..)",
    "created_at": "2017-04-02T20:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22506#issuecomment-313561",
    "user": "@fchapoton"
}
```

Well, in #22649, I am painfuly trying to modernize (for python3) the comparison of scheme morphisms. This triggered a doctest failure in WehlerK3, that I tracked to the fact the the parent of orbit[0] was not the same as the parent of the last element of the orbit.

So I guess I do not mind the way we fix it here : either by fixing the initial point in the doctest or by using this self(copy(Q)) in the code (or even both..)



---

archive/issue_comments_313562.json:
```json
{
    "body": "I see. Then I say we should fix it both ways. Well, at least change the doctest in one of the two orbit functions. That way both the 'good' and 'bad' inputs are checked.\n\nThere is no way a user would call that function with a point not on the K3 surface, so adding the coercion should not cause any problems other than some extra computation. Since the function does succeed with the 'bad' input, those points should all have the same parent.",
    "created_at": "2017-04-02T20:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22506#issuecomment-313562",
    "user": "@bhutz"
}
```

I see. Then I say we should fix it both ways. Well, at least change the doctest in one of the two orbit functions. That way both the 'good' and 'bad' inputs are checked.

There is no way a user would call that function with a point not on the K3 surface, so adding the coercion should not cause any problems other than some extra computation. Since the function does succeed with the 'bad' input, those points should all have the same parent.



---

archive/issue_comments_313563.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-02T21:14:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22506#issuecomment-313563",
    "user": "@bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_313564.json:
```json
{
    "body": "all tests pass.\n\nI also made the small tweak to the one doc test.\n----\nNew commits:",
    "created_at": "2017-04-02T21:14:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22506#issuecomment-313564",
    "user": "@bhutz"
}
```

all tests pass.

I also made the small tweak to the one doc test.
----
New commits:



---

archive/issue_comments_313565.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-05T19:37:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22506",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22506#issuecomment-313565",
    "user": "@vbraun"
}
```

Resolution: fixed
