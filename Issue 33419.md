# Issue 33419: Implement solid angle measure for two-dimensional simplicial cones

Issue created by migration from https://trac.sagemath.org/ticket/33656

Original creator: @allisonfitisone

Original creation time: 2022-04-07 19:11:21

CC:  yzh mkoeppe

Keywords: solid angle

Implement the solid angle measure (the plane angle) of a two-dimensional cone, using the dot-product formula. Later we will add methods for three-dimensional and higher-dimensional cones.

Examples to be added.


---

Comment by yzh created at 2022-04-22 18:07:04

a typo in the file description: qudrant --> quadrant


---

Comment by git created at 2022-04-22 18:17:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-04-22 18:39:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-04-22 18:57:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-04-22 19:14:30

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-04-22 19:37:59

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by yzh created at 2022-04-22 21:46:35

Changing status from new to needs_review.


---

Comment by tscrim created at 2022-04-25 00:19:42

Two comments:

- This should be lazily imported.
- Error messages should not end with a period (we follow Python's convention for this).

Otherwise LGTM.


---

Comment by mkoeppe created at 2022-04-25 00:22:51

I don't think `solid_angle_simplicial_2d` should really be imported in the global namespace.

It would be better to expose it to the user only via a method of `ConvexRationalPolyhedralCone`.


---

Comment by mkoeppe created at 2022-04-25 00:23:55

(as suggested in https://groups.google.com/g/sage-devel/c/K6Cd81dpbPA/m/Q44JFzI5AwAJ)


---

Comment by git created at 2022-04-25 02:38:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yzh created at 2022-04-25 02:54:52

Thanks for the feedback! Revised accordingly.
I don't think that `ConvexRationalPolyhedralCone` is the main use case for solid angle computations. It would be pretty useless to go through the `ToricLattice` but not able to compute the angle of a equilateral triangle.


---

Comment by mkoeppe created at 2022-04-25 03:19:36

I agree, it would not be good to restrict to the case of rational cones. 
In https://groups.google.com/g/sage-devel/c/K6Cd81dpbPA/m/Q44JFzI5AwAJ, I also suggest to create methods such as `tangent_cone_solid_angle` and `normal_cone_solid_angle` in the class `PolyhedronFace` (defined in `src/sage/geometry/polyhedron/face.py`).


---

Comment by @allisonfitisone created at 2022-05-10 19:44:17

changed output to match parent of input
----
New commits:


---

Comment by yzh created at 2022-05-12 17:30:09

When `P.is_exact() or isinstance(P, sage.rings.abc.SymbolicRing)`, the return type should be `SymbolicConstantsSubring` element


---

Comment by yzh created at 2022-05-12 17:30:35

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-05-12 20:24:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @allisonfitisone created at 2022-05-13 14:36:03

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2022-05-18 17:24:26


```
+        sage: solid_angle_simplicial_2d(A).parent()
+        Symbolic Ring
+
+        sage: A = matrix([[0, sqrt(18)], [0, -sqrt(pi)]])
+        sage: solid_angle_simplicial_2d(A)
+        0
+        sage: solid_angle_simplicial_2d(A).parent()
+        Symbolic Constants Subring
```


If the input is in a symbolic ring, like `sqrt(18)` is, then the output should be in the same symbolic ring, I think, not the Symbolic Constants Subring.

Symbolic Constants Subring is the right choice when the inputs in an exact ring.


---

Comment by mkoeppe created at 2022-05-18 17:25:50

Also this:

```
+    P = A[0][0].parent()
```

can be replaced by `P = A.base_ring()`.


---

Comment by git created at 2022-05-19 19:15:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @allisonfitisone created at 2022-05-19 19:16:17

Thanks for the feedback. Please see the recent changes.


---

Comment by tkarn created at 2022-06-02 15:41:41

The patchbot is showing the following: `src/sage/geometry/solid_angle.py:194:9 'sage.rings.abc' imported but unused`. Does that seem right?


---

Comment by git created at 2022-06-03 14:49:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-06-11 19:27:50

The parent of the result should only depend on the parent of the input, not the value of the input. So because `solid_angle_simplicial_2d(matrix([[0, sqrt(18)], [0, -sqrt(pi)]])` is the 0 of Symbolic Constants Subring, also `solid_angle_simplicial_2d(matrix([[0, sqrt(18)], [1, -sqrt(pi)]])` should return a value of Symbolic Constants Subring.


---

Comment by mkoeppe created at 2022-06-11 19:27:50

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-07-07 16:16:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yzh created at 2022-07-29 18:12:02

New commits:


---

Comment by yzh created at 2022-07-29 18:12:02

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2022-07-29 18:16:15

How about regrouping the doctests for A and B like this:

```
sage: [solid_angle_simplicial_2d(matrix(QQ, M)).parent() for M in [A, B]]
[Symbolic Constants Subring, Symbolic Constants Subring]
```



---

Comment by git created at 2022-07-29 18:49:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-07-29 18:54:24


```
+    on the parent of the input, but not the value of the input.
```

This needs `::`


---

Comment by git created at 2022-07-29 18:57:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yzh created at 2022-07-29 18:58:23

Thanks! I'm waiting for the patchbot to run the tests for me :P

Replying to [comment:36 mkoeppe]:
> {{{
> +    on the parent of the input, but not the value of the input.
> }}}
> This needs `::`
