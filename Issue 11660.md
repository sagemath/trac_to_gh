# Issue 11660: bug fixes for profile functions for the Steenrod algebra

Issue created by migration from Trac.

Original creator: jhpalmieri

Original creation time: 2011-09-22 18:33:27

Assignee: AlexGhitza

Profile functions for the Steenrod algebra, especially at odd primes, are a little buggy: 

```
sage: P3 = SteenrodAlgebra(p=3, profile=(lambda n: Infinity, lambda n: 1))
sage: P3._has_nontrivial_profile()
False
```

This should be `True`.

```
sage: P3._profile
((+Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity, +Infinity), (1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1))
```

All of the "Infinity"s should be omitted.

```
sage: SteenrodAlgebra(p=3, profile=((3,2,1), lambda n: 1))
Traceback (most recent call last)
...
TypeError: unsupported operand type(s) for -: 'NoneType' and 'int'
```

This error shouldn't happen.

These bugs are in the function `steenrod_algebra_misc.normalize_profile_function` and in the method `_has_nontrivial_profile` in `steenrod_algebra.SteenrodAlgebra_generic`.  The attached patch fixes these, and it also speeds up `steenrod_algebra_misc.is_valid_profile:

```
sage: sage: from sage.algebras.steenrod.steenrod_algebra_misc import is_valid_profile, normalize_profile
sage: pro = normalize_profile(lambda n: n)
sage: timeit('is_valid_profile(pro[0], pro[1], p=2)') # before
5 loops, best of 3: 334 ms per loop

sage: timeit('is_valid_profile(pro[0], pro[1], p=2)') # after
125 loops, best of 3: 3.99 ms per loop
```




---

Comment by jhpalmieri created at 2011-09-22 18:35:37

Changing status from new to needs_review.


---

Attachment


---

Comment by jhpalmieri created at 2012-03-19 18:34:30

Changing priority from minor to critical.


---

Comment by was created at 2012-03-29 12:40:08

Changing status from needs_review to positive_review.


---

Comment by was created at 2012-03-29 12:40:08

I don't know what a "profile" is, and maybe no other Sage developers do.  But the code looks good and works.   I think it makes sense to just trust our resident algebraic topologist in this case.


---

Comment by jdemeyer created at 2012-04-02 15:24:21

Resolution: fixed
