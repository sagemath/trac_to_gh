# Issue 33864: cutwidth_dyn use after free

archive/issues_033864.json:
```json
{
    "body": "CC:  dcoudert dimpase\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/34101\n\n",
    "created_at": "2022-06-30T22:22:12Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "cutwidth_dyn use after free",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33864",
    "user": "@jamesjer"
}
```
CC:  dcoudert dimpase



Issue created by migration from https://trac.sagemath.org/ticket/34101





---

archive/issue_comments_480919.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2022-06-30T22:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480919",
    "user": "@jamesjer"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_480920.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to graph theory.",
    "created_at": "2022-06-30T22:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480920",
    "user": "@jamesjer"
}
```

Changing component from PLEASE CHANGE to graph theory.



---

archive/issue_comments_480921.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2022-06-30T22:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480921",
    "user": "@jamesjer"
}
```

Changing priority from major to minor.



---

archive/issue_comments_480922.json:
```json
{
    "body": "Changing keywords from \"\" to \"use-after-free cutwidth\".",
    "created_at": "2022-06-30T22:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480922",
    "user": "@jamesjer"
}
```

Changing keywords from "" to "use-after-free cutwidth".



---

archive/issue_comments_480923.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-06-30T22:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480923",
    "user": "@jamesjer"
}
```

New commits:



---

archive/issue_comments_480924.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-06-30T22:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480924",
    "user": "@jamesjer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_480925.json:
```json
{
    "body": "Good catch. With the current code, I can get\n\n```\nsage: from sage.graphs.graph_decompositions.cutwidth import cutwidth_dyn\nsage: G = Graph()\nsage: cutwidth_dyn(G, lower_bound=1)\n(164935984, [])\nsage: cutwidth_dyn(G, lower_bound=10)\n(164935984, [])\nsage: G = graphs.PetersenGraph()\nsage: cutwidth_dyn(G, lower_bound=20)\n(164936464, [0, 1, 2, 3, 4, 5, 6, 7, 8, 9])\n```\n\n\nIf I'm not mistaken, these 2 lines are used only for trivial cases (`lower_boud >= G.size()`, `G.order() == 0`), right ? so may be it's best to remove the 2 lines and deal with the trivial cases before.",
    "created_at": "2022-06-30T23:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480925",
    "user": "dcoudert"
}
```

Good catch. With the current code, I can get

```
sage: from sage.graphs.graph_decompositions.cutwidth import cutwidth_dyn
sage: G = Graph()
sage: cutwidth_dyn(G, lower_bound=1)
(164935984, [])
sage: cutwidth_dyn(G, lower_bound=10)
(164935984, [])
sage: G = graphs.PetersenGraph()
sage: cutwidth_dyn(G, lower_bound=20)
(164936464, [0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
```


If I'm not mistaken, these 2 lines are used only for trivial cases (`lower_boud >= G.size()`, `G.order() == 0`), right ? so may be it's best to remove the 2 lines and deal with the trivial cases before.



---

archive/issue_comments_480926.json:
```json
{
    "body": "Does this patch do the job? If yes, let's accept it, and improve on another ticket.",
    "created_at": "2022-07-06T12:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480926",
    "user": "dimpase"
}
```

Does this patch do the job? If yes, let's accept it, and improve on another ticket.



---

archive/issue_comments_480927.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-07-06T14:40:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480927",
    "user": "dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_480928.json:
```json
{
    "body": "This patch fixes the issue => positive review\n\nNote that I recommend users to call method `cutwidth` and not directly method `cutwidth_dyn`.",
    "created_at": "2022-07-06T14:40:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480928",
    "user": "dcoudert"
}
```

This patch fixes the issue => positive review

Note that I recommend users to call method `cutwidth` and not directly method `cutwidth_dyn`.



---

archive/issue_comments_480929.json:
```json
{
    "body": "Replying to [comment:7 dcoudert]:\n> This patch fixes the issue => positive review\n> \n> Note that I recommend users to call method `cutwidth` and not directly method `cutwidth_dyn`.\n\nOK. Just in case, Jerry James (`gh-jamesjer`) is a RedHat/Fedora maintainer of hundreds of science-related packages, so this is a genuine downstream patch provided to us.",
    "created_at": "2022-07-07T09:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480929",
    "user": "dimpase"
}
```

Replying to [comment:7 dcoudert]:
> This patch fixes the issue => positive review
> 
> Note that I recommend users to call method `cutwidth` and not directly method `cutwidth_dyn`.

OK. Just in case, Jerry James (`gh-jamesjer`) is a RedHat/Fedora maintainer of hundreds of science-related packages, so this is a genuine downstream patch provided to us.



---

archive/issue_comments_480930.json:
```json
{
    "body": "Thank you Jerry for reporting and fixing this issue.",
    "created_at": "2022-07-07T11:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480930",
    "user": "dcoudert"
}
```

Thank you Jerry for reporting and fixing this issue.



---

archive/issue_comments_480931.json:
```json
{
    "body": "My pleasure.  Thanks for making and sharing such a great piece of mathematical software.",
    "created_at": "2022-07-09T14:48:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480931",
    "user": "@jamesjer"
}
```

My pleasure.  Thanks for making and sharing such a great piece of mathematical software.



---

archive/issue_comments_480932.json:
```json
{
    "body": "Merge failure on top of:\n\n802aaa1c95 Trac #34093: Wrong evaluation of elements of CBF[x] on polynomials from other rings\n\n98ea60b6cc Trac #10980: Make sure symbolic gridline values are okay\n\n73d7bb0aae Trac #34122: Bug in is_planar() method for directed graphs\n\nb9b73ce665 Trac #33160: update Singular to 4.3.1\n\n1dd3b4819f Trac #33134: doctest failure in hilbert_poincare_series with singular 4.2.1\n\nc9cfb5395f Trac #34087: inverse reciprocal trig functions not (back)translated to/from Mathematica\n\n1d6d055563 Trac #34076: pycodestyle cleanup in src/sage/graphs/genus.pyx\n\n043d862b5d Trac #34071: pycodestyle cleanup in asteroidal_triples.pyx, chrompoly.pyx, cliquer.pyx, convexity_properties.pyx\n\nb9b25dc735 Trac #34070: pycodestyle cleanup in src/sage/graphs/centrality.pyx\n\n4ef2c6597d Trac #34069: pycodestyle cleanup in src/sage/graphs/comparability.pyx\n\n5b1146766b Trac #34066: Tachyon help message\n\n798adaa5a3 Trac #34065: pycodestyle cleanup in src/sage/graphs/bliss.pyx\n\nce62be23a2 Trac #34063: pycodestyle cleanup in src/sage/graphs/base/\n\na0eadb3e40 Trac #34059: Fix trivial case in conversion of list to number field element\n\nfea0ac50a6 Trac #34057: changes about avoiding double dieses\n\n9eefd5c27e Trac #34145: modernize super in geometry/\n\n01e117dfd8 Trac #34137: modernize super in categories/\n\n6c79334402 Trac #33819: build.yml: In workflow_dispatch, make container and base tag selectable; add doc\n\n6a64ab8d00 Trac #33760: do not update _pos, _pos3d, _embedding on vertex/edge deletions\n\ndbf091dbbb Trac #34139: fix the linter\n\n625ac58151 Updated [SageMath](SageMath) version to 9.7.beta5\n\n\n\nmerge was not clean: conflicts in src/sage/graphs/graph_decompositions/cutwidth.pyx",
    "created_at": "2022-07-11T22:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480932",
    "user": "vbraun"
}
```

Merge failure on top of:

802aaa1c95 Trac #34093: Wrong evaluation of elements of CBF[x] on polynomials from other rings

98ea60b6cc Trac #10980: Make sure symbolic gridline values are okay

73d7bb0aae Trac #34122: Bug in is_planar() method for directed graphs

b9b73ce665 Trac #33160: update Singular to 4.3.1

1dd3b4819f Trac #33134: doctest failure in hilbert_poincare_series with singular 4.2.1

c9cfb5395f Trac #34087: inverse reciprocal trig functions not (back)translated to/from Mathematica

1d6d055563 Trac #34076: pycodestyle cleanup in src/sage/graphs/genus.pyx

043d862b5d Trac #34071: pycodestyle cleanup in asteroidal_triples.pyx, chrompoly.pyx, cliquer.pyx, convexity_properties.pyx

b9b25dc735 Trac #34070: pycodestyle cleanup in src/sage/graphs/centrality.pyx

4ef2c6597d Trac #34069: pycodestyle cleanup in src/sage/graphs/comparability.pyx

5b1146766b Trac #34066: Tachyon help message

798adaa5a3 Trac #34065: pycodestyle cleanup in src/sage/graphs/bliss.pyx

ce62be23a2 Trac #34063: pycodestyle cleanup in src/sage/graphs/base/

a0eadb3e40 Trac #34059: Fix trivial case in conversion of list to number field element

fea0ac50a6 Trac #34057: changes about avoiding double dieses

9eefd5c27e Trac #34145: modernize super in geometry/

01e117dfd8 Trac #34137: modernize super in categories/

6c79334402 Trac #33819: build.yml: In workflow_dispatch, make container and base tag selectable; add doc

6a64ab8d00 Trac #33760: do not update _pos, _pos3d, _embedding on vertex/edge deletions

dbf091dbbb Trac #34139: fix the linter

625ac58151 Updated [SageMath](SageMath) version to 9.7.beta5



merge was not clean: conflicts in src/sage/graphs/graph_decompositions/cutwidth.pyx



---

archive/issue_comments_480933.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-07-11T22:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480933",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_480934.json:
```json
{
    "body": "rebased on 9.7.beta5\n----\nNew commits:",
    "created_at": "2022-07-11T23:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480934",
    "user": "mkoeppe"
}
```

rebased on 9.7.beta5
----
New commits:



---

archive/issue_comments_480935.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-07-11T23:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480935",
    "user": "mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_480936.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-01T20:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33864",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33864#issuecomment-480936",
    "user": "vbraun"
}
```

Resolution: fixed
