# Issue 33864: cutwidth_dyn use after free

Issue created by migration from https://trac.sagemath.org/ticket/34101

Original creator: @jamesjer

Original creation time: 2022-06-30 22:22:12

CC:  dcoudert dimpase




---

Comment by @jamesjer created at 2022-06-30 22:30:47

Changing type from PLEASE CHANGE to defect.


---

Comment by @jamesjer created at 2022-06-30 22:30:47

Changing component from PLEASE CHANGE to graph theory.


---

Comment by @jamesjer created at 2022-06-30 22:30:47

Changing priority from major to minor.


---

Comment by @jamesjer created at 2022-06-30 22:30:47

Changing keywords from "" to "use-after-free cutwidth".


---

Comment by @jamesjer created at 2022-06-30 22:37:56

New commits:


---

Comment by @jamesjer created at 2022-06-30 22:37:56

Changing status from new to needs_review.


---

Comment by dcoudert created at 2022-06-30 23:03:36

Good catch. With the current code, I can get

```
sage: from sage.graphs.graph_decompositions.cutwidth import cutwidth_dyn
sage: G = Graph()
sage: cutwidth_dyn(G, lower_bound=1)
(164935984, [])
sage: cutwidth_dyn(G, lower_bound=10)
(164935984, [])
sage: G = graphs.PetersenGraph()
sage: cutwidth_dyn(G, lower_bound=20)
(164936464, [0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
```


If I'm not mistaken, these 2 lines are used only for trivial cases (`lower_boud >= G.size()`, `G.order() == 0`), right ? so may be it's best to remove the 2 lines and deal with the trivial cases before.


---

Comment by dimpase created at 2022-07-06 12:40:14

Does this patch do the job? If yes, let's accept it, and improve on another ticket.


---

Comment by dcoudert created at 2022-07-06 14:40:07

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2022-07-06 14:40:07

This patch fixes the issue => positive review

Note that I recommend users to call method `cutwidth` and not directly method `cutwidth_dyn`.


---

Comment by dimpase created at 2022-07-07 09:15:46

Replying to [comment:7 dcoudert]:
> This patch fixes the issue => positive review
> 
> Note that I recommend users to call method `cutwidth` and not directly method `cutwidth_dyn`.

OK. Just in case, Jerry James (`gh-jamesjer`) is a RedHat/Fedora maintainer of hundreds of science-related packages, so this is a genuine downstream patch provided to us.


---

Comment by dcoudert created at 2022-07-07 11:06:08

Thank you Jerry for reporting and fixing this issue.


---

Comment by @jamesjer created at 2022-07-09 14:48:36

My pleasure.  Thanks for making and sharing such a great piece of mathematical software.


---

Comment by vbraun created at 2022-07-11 22:30:52

Merge failure on top of:

802aaa1c95 Trac #34093: Wrong evaluation of elements of CBF[x] on polynomials from other rings

98ea60b6cc Trac #10980: Make sure symbolic gridline values are okay

73d7bb0aae Trac #34122: Bug in is_planar() method for directed graphs

b9b73ce665 Trac #33160: update Singular to 4.3.1

1dd3b4819f Trac #33134: doctest failure in hilbert_poincare_series with singular 4.2.1

c9cfb5395f Trac #34087: inverse reciprocal trig functions not (back)translated to/from Mathematica

1d6d055563 Trac #34076: pycodestyle cleanup in src/sage/graphs/genus.pyx

043d862b5d Trac #34071: pycodestyle cleanup in asteroidal_triples.pyx, chrompoly.pyx, cliquer.pyx, convexity_properties.pyx

b9b25dc735 Trac #34070: pycodestyle cleanup in src/sage/graphs/centrality.pyx

4ef2c6597d Trac #34069: pycodestyle cleanup in src/sage/graphs/comparability.pyx

5b1146766b Trac #34066: Tachyon help message

798adaa5a3 Trac #34065: pycodestyle cleanup in src/sage/graphs/bliss.pyx

ce62be23a2 Trac #34063: pycodestyle cleanup in src/sage/graphs/base/

a0eadb3e40 Trac #34059: Fix trivial case in conversion of list to number field element

fea0ac50a6 Trac #34057: changes about avoiding double dieses

9eefd5c27e Trac #34145: modernize super in geometry/

01e117dfd8 Trac #34137: modernize super in categories/

6c79334402 Trac #33819: build.yml: In workflow_dispatch, make container and base tag selectable; add doc

6a64ab8d00 Trac #33760: do not update _pos, _pos3d, _embedding on vertex/edge deletions

dbf091dbbb Trac #34139: fix the linter

625ac58151 Updated [SageMath](SageMath) version to 9.7.beta5



merge was not clean: conflicts in src/sage/graphs/graph_decompositions/cutwidth.pyx


---

Comment by vbraun created at 2022-07-11 22:30:52

Changing status from positive_review to needs_work.


---

Comment by mkoeppe created at 2022-07-11 23:33:47

rebased on 9.7.beta5
----
New commits:


---

Comment by mkoeppe created at 2022-07-11 23:33:55

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2022-08-01 20:20:27

Resolution: fixed
