# Issue 17810: help

Issue created by migration from https://trac.sagemath.org/ticket/18047

Original creator: mmarco

Original creation time: 2015-03-24 19:17:40

CC:  vbraun kcrisman amitjamadagni fugelde tscrim




---

Comment by mmarco created at 2015-03-24 19:28:24

Changing component from PLEASE CHANGE to packages: optional.


---

Comment by mmarco created at 2015-03-24 19:28:24

Changing priority from major to minor.


---

Comment by kcrisman created at 2015-03-24 19:33:19

Changing type from PLEASE CHANGE to enhancement.


---

Comment by kcrisman created at 2015-03-24 19:33:19

New commits:


---

Comment by vbraun created at 2015-03-24 19:35:39

Nice. Pretty sure that doesn't work on OSX. Basically there is no way to build a shared libray without libtool in a portable manner. Also, I would be very opposed to make a library standard that doesn't do the standard autotools + libtool process.


---

Comment by jdemeyer created at 2015-03-25 22:30:13

Replying to [ticket:18047 mmarco]:
> I would like to add it as standard package so we can use it in #17030
You can use it in #17030 even if it's an optional package. Just make sure you provide a good error message in case the package is needed but not installed.


---

Comment by git created at 2015-03-27 10:52:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Attachment

I moved the package to libtools. Also uploaded the new tarball (please ignore libhomflt-1.0.tar.2.gz)


---

Comment by vbraun created at 2015-03-27 11:08:15

Looks good. Newer autoconf gives one warning, can you add `AM_PROG_AR` to fix it?

```
diff --git a/configure.ac b/configure.ac
index 6c5f369..103e585 100644
--- a/configure.ac
+++ b/configure.ac
@@ -2,8 +2,9 @@ AC_INIT([libhomfly], [1.0], [mmarco@unizar.es])
 AC_CONFIG_AUX_DIR([build-aux])
 AC_CONFIG_MACRO_DIR([m4])
 AM_INIT_AUTOMAKE([foreign -Wall])
-LT_INIT
 AC_PROG_CC
+AM_PROG_AR
+LT_INIT
 AC_CONFIG_FILES([Makefile lib/Makefile])
 AC_OUTPUT
```

Also, I take it you have a testcase (a minimal C program to link to your library to see if it works?) That would be nice to add, can save you quite a bit of debugging headache later.


---

Comment by git created at 2015-03-27 23:54:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2015-03-27 23:54:53

Made the change and added a little test


---

Comment by git created at 2015-03-28 20:53:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-03-28 21:40:12

The library uses Bohm GC, but the test program does not. Hence you shoudl link the library to libgc, and not the test program. In other words, programmers using your library shouldn't have to know what your private library dependencies are:

```
diff --git a/lib/Makefile.am b/lib/Makefile.am
index 5aa6416..b4341c4 100644
--- a/lib/Makefile.am
+++ b/lib/Makefile.am
@@ -1,3 +1,4 @@
 lib_LTLIBRARIES = libhomfly.la
 libhomfly_la_SOURCES = bound.c  control.c  dllink.c  knot.c  model.c  order.c  poly.c standard.h order.h bound.h  control.h  dllink.h knot.h model.h order.h poly.h standard.h
+libhomfly_la_LDFLAGS = -lgc
 include_HEADERS = homfly.h
diff --git a/test/Makefile.am b/test/Makefile.am
index 0394f0a..b564b7e 100644
--- a/test/Makefile.am
+++ b/test/Makefile.am
@@ -2,5 +2,4 @@ bin_PROGRAMS = test_example
 test_example_SOURCES = test_example.c homfly.h
 test_example_LDADD = @top_builddir@/lib/libhomfly.la
 test_example_DEPENDENCIES = @top_builddir@/lib/libhomfly.la
-test_example_LDFLAGS = -lgc
 TESTS = test_example
```

Apart from that it looks good. 

There are some global variables and all symbols are exported, so there is a reasonable chance that you'll run into global state or symbol name colissions when you link it into Sage. It would probably be better to hide all symbols that you are not going to use. Possibly later when you have a better idea of what you actually want to call from Sage.


---

Comment by mmarco created at 2015-03-30 11:23:08

The cython interface is being done in #18057


---

Comment by mmarco created at 2015-03-30 11:39:42

Uploaded new tarball


---

Comment by mmarco created at 2016-05-30 14:21:14

Changing keywords from "" to "days74".


---

Comment by mmarco created at 2016-05-30 14:31:59

The new tarball should expose only the homfly symbol, which is the one used by the cython interface.


---

Comment by git created at 2016-05-30 14:48:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2016-05-30 14:48:53

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2016-05-30 16:04:50

Author name missing


---

Comment by vdelecroix created at 2016-05-31 04:52:45

Hey,

sided comment: Why do you want it a standard package? You are free to use whatever optional package into Sage source code. I am very against having one more rather marginal package as a standard package. On the other hand, I am very much for a better test/integration of optional packages.

Vincent


---

Comment by mmarco created at 2016-05-31 06:43:30

Right now i am only proposing it to be optional. I would like to become standard in the future because it provides an important functionality for the knot theory module. The homfly polynomial is one of the "must have" invariants of a link nowadays. If we want our module to be more or less feature complete, we need to provide this functionality out of the box. So we either write our own implementation or integrate one that is available.


---

Comment by tscrim created at 2016-05-31 06:45:02

I'm going through the pkg source code right now trying to see if I can make it so we can interface with it better.


---

Comment by jdemeyer created at 2016-05-31 07:21:28

Tarball???


---

Comment by jdemeyer created at 2016-05-31 07:21:28

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-05-31 07:22:28

A `dependencies` file is missing.


---

Comment by git created at 2016-05-31 07:54:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-05-31 07:56:29

Changing status from needs_work to needs_review.


---

Comment by git created at 2016-05-31 07:57:29

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2016-05-31 07:58:18

For me, this is good.


---

Comment by mmarco created at 2016-05-31 08:02:43

Is the dependencies file really necessary?


---

Comment by mmarco created at 2016-05-31 08:03:51

Also, I don't see any code in spkg-test. Did you really paste the code from spkg-build?


---

Comment by jdemeyer created at 2016-05-31 08:21:36

Replying to [comment:34 mmarco]:
> Is the dependencies file really necessary?

Unfortunately not.


---

Comment by jdemeyer created at 2016-05-31 08:22:26

Replying to [comment:35 mmarco]:
> Also, I don't see any code in spkg-test. Did you really paste the code from spkg-build?

I guess you mean `spkg-check`. There already was code to run `$MAKE check` there, so I didn't need to add anything. I just deleting the running of the testsuite from `spkg-install`.


---

Comment by mmarco created at 2016-05-31 08:24:05

Ok then. Fine for me.


---

Comment by jdemeyer created at 2016-05-31 08:25:15

Changing status from needs_review to positive_review.


---

Comment by mmarco created at 2016-05-31 14:58:13

We are still working with Travis in improving the library.


---

Comment by mmarco created at 2016-05-31 14:58:13

Changing status from positive_review to needs_work.


---

Comment by git created at 2016-05-31 15:20:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-06-01 07:00:44

Changing status from needs_work to positive_review.


---

Comment by git created at 2016-06-01 10:02:49

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2016-06-01 10:02:49

Changing status from positive_review to needs_review.


---

Comment by tscrim created at 2016-06-01 10:05:21

Changing status from needs_review to positive_review.


---

Comment by git created at 2016-06-01 10:10:03

Changing status from positive_review to needs_review.


---

Comment by git created at 2016-06-01 10:10:03

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by tscrim created at 2016-06-01 10:23:03

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2016-06-01 10:23:03

You have forgotten the `test/data.txt` file in the tarball, which is needed to run the tests.


---

Comment by tscrim created at 2016-06-01 10:24:59

Replying to [comment:47 tscrim]:
> You have forgotten the `test/data.txt` file in the tarball, which is needed to run the tests.

Actually, this is my fault for not having the autotools including it.


---

Comment by mmarco created at 2016-06-01 10:27:21

Ok, I will handle it. Give me a few minutes.


---

Comment by tscrim created at 2016-06-01 10:28:58

I've already done it, see [PR #4](https://github.com/miguelmarco/libhomfly/pull/4) on github.


---

Attachment

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2016-06-01 10:32:59

It should be included now.
----
New commits:


---

Comment by tscrim created at 2016-06-01 10:37:39

Changing status from needs_work to needs_info.


---

Comment by tscrim created at 2016-06-01 10:37:39

Thank you. `sage -i -c libhomfly` now passes. I feel that we should have a release tag on github and use the corresponding tarball for that here. I think it is as easy as adding a tag to the git repo, but I've not used that functionality yet.


---

Comment by mmarco created at 2016-06-01 10:41:19

Does github automate the "autoreconf-configure-make dist" cycle?


---

Comment by tscrim created at 2016-06-01 10:45:31

IDK. From what I understand, the release tab on github looks for a (annotated?) tag of the form `v1.0`. I will look into it today.


---

Comment by tscrim created at 2016-06-01 10:47:03

See perhaps: https://help.github.com/articles/creating-releases/ but IDK about autocreation of tarballs.


---

Comment by mmarco created at 2016-06-01 10:52:41

I created one tag and release, but it just gives a tarball with the content of the repo. So the actual tarball for distribution should be created by the full autotools cycle from there


---

Comment by tscrim created at 2016-06-01 10:53:15

Changing status from needs_info to positive_review.


---

Comment by tscrim created at 2016-06-01 10:53:15

Okay, so the created tarball will be just of the source code on github (but it will do that automatically). So we could either just do the hosting ourselves or have a `spkg-src`. Well for now, this works (as this might be the only release) and to add the tag.

Thank you for your work on this.


---

Comment by vbraun created at 2016-06-02 04:13:51

Resolution: fixed


---

Comment by kcrisman created at 2016-06-16 15:42:18

When I do `L.homfly_polynomial()` I just get `ImportError: No module named homfly` - should that give me a message to do the optional package instead?  (This is on 7.3.beta3 so it's "in" otherwise.)


---

Comment by mmarco created at 2016-06-16 15:51:41

The functionality requires to have the optional package installed. Since these tickets are already closed, could you please open a new ticket for improving the error message?


---

Comment by kcrisman created at 2016-06-16 17:41:43

That's exactly what I figured, but wanted to confirm.  See #20838.


---

Comment by jdemeyer created at 2016-06-23 11:47:02

`@`vbraun: the tarball on the mirrors in not the one from this ticket ([attachment:libhomfly-1.0.tar.gz]). Can you please fix this?
