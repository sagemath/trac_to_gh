# Issue 13051: Implement Poset.is_graded using a polynomial time (linear?) algorithm.

archive/issues_013051.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  sage-combinat mcco0489@math.umn.edu ncohen\n\nKeywords: sd40\n\nTitle says it all. See also #13222.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13223\n\n",
    "created_at": "2012-07-10T17:36:56Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "title": "Implement Poset.is_graded using a polynomial time (linear?) algorithm.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13051",
    "user": "nthiery"
}
```
Assignee: sage-combinat

CC:  sage-combinat mcco0489@math.umn.edu ncohen

Keywords: sd40

Title says it all. See also #13222.

Issue created by migration from https://trac.sagemath.org/ticket/13223





---

archive/issue_comments_158471.json:
```json
{
    "body": "Thomas McConville will be implementing this",
    "created_at": "2012-09-05T20:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158471",
    "user": "gmoose05"
}
```

Thomas McConville will be implementing this



---

archive/issue_comments_158472.json:
```json
{
    "body": "I've improved the situation in #13240; the algorithm is now polynomial time. Wouldn't hurt to improve it nevertheless.",
    "created_at": "2013-10-21T02:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158472",
    "user": "darij"
}
```

I've improved the situation in #13240; the algorithm is now polynomial time. Wouldn't hurt to improve it nevertheless.



---

archive/issue_comments_158473.json:
```json
{
    "body": "Attachment",
    "created_at": "2014-10-06T13:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158473",
    "user": "jmantysalo"
}
```

Attachment



---

archive/issue_comments_158474.json:
```json
{
    "body": "I attached an example code. Before integrating to Sage it must be changed so that rank list is saved, or should it? For now `is_graded()` starts with `is_ranked()`, and it saves rank of every element to internal variable.",
    "created_at": "2014-10-06T13:45:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158474",
    "user": "jmantysalo"
}
```

I attached an example code. Before integrating to Sage it must be changed so that rank list is saved, or should it? For now `is_graded()` starts with `is_ranked()`, and it saves rank of every element to internal variable.



---

archive/issue_comments_158475.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-07T10:34:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158475",
    "user": "jmantysalo"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_158476.json:
```json
{
    "body": "I should now be O(n). (Where `n` if number of cover relations, not number of elements.\n----\nNew commits:",
    "created_at": "2014-10-07T10:34:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158476",
    "user": "jmantysalo"
}
```

I should now be O(n). (Where `n` if number of cover relations, not number of elements.
----
New commits:



---

archive/issue_comments_158477.json:
```json
{
    "body": "Duh, must to do more timings. This is somewhat faster when going throught Posets(8), but much slower with bigger random posets. Algorithm should probably be selected by number of elements and cover relations.",
    "created_at": "2014-10-07T12:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158477",
    "user": "jmantysalo"
}
```

Duh, must to do more timings. This is somewhat faster when going throught Posets(8), but much slower with bigger random posets. Algorithm should probably be selected by number of elements and cover relations.



---

archive/issue_comments_158478.json:
```json
{
    "body": "I do not understand. According to Wikipedia, isn't this poset graded by the function which associates to every element the length of its label ?\n\nhttp://en.wikipedia.org/wiki/Graded_poset\n\n```\nsage: d=DiGraph(); d.add_path([\"aaaa\",\"aaa\",\"aa\",\"a\"]); d.add_path([\"bbb\",\"aa\"])\nsage: Poset(d).is_graded()\nFalse\n```\n\n\n(same result with or without your branch applied)\n\nNathann",
    "created_at": "2014-10-07T19:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158478",
    "user": "ncohen"
}
```

I do not understand. According to Wikipedia, isn't this poset graded by the function which associates to every element the length of its label ?

http://en.wikipedia.org/wiki/Graded_poset

```
sage: d=DiGraph(); d.add_path(["aaaa","aaa","aa","a"]); d.add_path(["bbb","aa"])
sage: Poset(d).is_graded()
False
```


(same result with or without your branch applied)

Nathann



---

archive/issue_comments_158479.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2014-10-07T19:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158479",
    "user": "ncohen"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_158480.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2014-10-08T04:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158480",
    "user": "jmantysalo"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_158481.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2014-10-08T04:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158481",
    "user": "jmantysalo"
}
```

Changing priority from major to minor.



---

archive/issue_comments_158482.json:
```json
{
    "body": "Some sources define graded poset like what Sage define ranked. For that see #16998 and doc for `is_graded` on `posets.py`.\n\nMy code lacked one `set()` function. But after that also `minimal_elements()` takes more time that I thinked, hence this code is still slower than original in many (most?) cases.\n\nAlso, original code is O(n). Hence I dropped this to minor priority.",
    "created_at": "2014-10-08T04:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158482",
    "user": "jmantysalo"
}
```

Some sources define graded poset like what Sage define ranked. For that see #16998 and doc for `is_graded` on `posets.py`.

My code lacked one `set()` function. But after that also `minimal_elements()` takes more time that I thinked, hence this code is still slower than original in many (most?) cases.

Also, original code is O(n). Hence I dropped this to minor priority.



---

archive/issue_comments_158483.json:
```json
{
    "body": "A side note about #17002: It makes `minimal_elements` slightly slower. Must modify functions `sinks()` and `sources()` on `digraph.py`.",
    "created_at": "2014-10-08T13:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158483",
    "user": "jmantysalo"
}
```

A side note about #17002: It makes `minimal_elements` slightly slower. Must modify functions `sinks()` and `sources()` on `digraph.py`.



---

archive/issue_comments_158484.json:
```json
{
    "body": "Oh. I thought that it would go unnoticed.\n\nWell, try replacing the code of sinks/source from\n\n```\nreturn [x for x in self if self.out_degree(x)==0]\n```\n\n\nto\n\n\n```\nreturn [x for x,d in self.out_degree(labels=True).iteritems() if d==0]\n```\n\n\nIt means less calls to `out_degree`. Perhaps that's what you detected ?\n\nNathann",
    "created_at": "2014-10-08T13:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158484",
    "user": "ncohen"
}
```

Oh. I thought that it would go unnoticed.

Well, try replacing the code of sinks/source from

```
return [x for x in self if self.out_degree(x)==0]
```


to


```
return [x for x,d in self.out_degree(labels=True).iteritems() if d==0]
```


It means less calls to `out_degree`. Perhaps that's what you detected ?

Nathann



---

archive/issue_comments_158485.json:
```json
{
    "body": "I'll try that.\n\nWhole question is irrelevant, but interesting. It should be clear that checking if a poset is graded is faster when doing it \"directly\" and not throught rank function. Rank should need both in- ja out-edges of underlying graph, direct method just out-edges; and out-edges are just picked up from memory, not searched in any way.\n\nHowever, many timinigs say against this.",
    "created_at": "2014-10-08T17:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158485",
    "user": "jmantysalo"
}
```

I'll try that.

Whole question is irrelevant, but interesting. It should be clear that checking if a poset is graded is faster when doing it "directly" and not throught rank function. Rank should need both in- ja out-edges of underlying graph, direct method just out-edges; and out-edges are just picked up from memory, not searched in any way.

However, many timinigs say against this.



---

archive/issue_comments_158486.json:
```json
{
    "body": "Hello !\n\nJust looked at the code again, but I do not see what possible improvement you expect. Algorithmically, things are done correctly. Now, if you really need to save some time on this function you can change a couple of lines to avoid creating lists unnecessarily, turn the Python list into a C arrays, things like that. But I think that the Poset code still needs other improvements before this kind of things begin to be the critical costs.\n\nAbout definitions, though: what is implemented is not equivalent to `return all(rf(i) == rank for i in maxes)`, for you need to do the same with mins. This `Poset` is not graded according to the definition involving \"all maximal chains\":\n\n`Poset(DiGraph({1:[2],3:[2],4:[3]})).show()`\n\nIt would be interesting to compare the speed of `rank_dict` and `is_graded` though, as their code is very similar.\n\nNathann",
    "created_at": "2014-10-12T14:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158486",
    "user": "ncohen"
}
```

Hello !

Just looked at the code again, but I do not see what possible improvement you expect. Algorithmically, things are done correctly. Now, if you really need to save some time on this function you can change a couple of lines to avoid creating lists unnecessarily, turn the Python list into a C arrays, things like that. But I think that the Poset code still needs other improvements before this kind of things begin to be the critical costs.

About definitions, though: what is implemented is not equivalent to `return all(rf(i) == rank for i in maxes)`, for you need to do the same with mins. This `Poset` is not graded according to the definition involving "all maximal chains":

`Poset(DiGraph({1:[2],3:[2],4:[3]})).show()`

It would be interesting to compare the speed of `rank_dict` and `is_graded` though, as their code is very similar.

Nathann



---

archive/issue_comments_158487.json:
```json
{
    "body": "Replying to [comment:17 ncohen]:\n\n> Now, if you really need to save some time on this function you can change a couple of lines to avoid creating lists unnecessarily, turn the Python list into a C arrays, things like that. But I think that the Poset code still needs other improvements before this kind of things begin to be the critical costs.\n\nYep. Should this one be marked as positive_review and moved to wontfix-milestone?\n\n> About definitions, though: what is implemented is not equivalent to `return all(rf(i) == rank for i in maxes)`, for you need to do the same with mins.\n\nTrue.\n\n> It would be interesting to compare the speed of `rank_dict` and `is_graded` though, as their code is very similar.\n\nI made a code that was slightly faster when calculating how many of `Posets(8)` are graded (assuming that ranks were not already computed). IF \"going up\" is cheaper than going down, i.e. poset is internally saved as digraph of upper covers, then in principle current implementation would be `O(n^2)` and my implementation `O(n)`. But in reality this sppedup is not happening.",
    "created_at": "2014-10-13T05:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158487",
    "user": "jmantysalo"
}
```

Replying to [comment:17 ncohen]:

> Now, if you really need to save some time on this function you can change a couple of lines to avoid creating lists unnecessarily, turn the Python list into a C arrays, things like that. But I think that the Poset code still needs other improvements before this kind of things begin to be the critical costs.

Yep. Should this one be marked as positive_review and moved to wontfix-milestone?

> About definitions, though: what is implemented is not equivalent to `return all(rf(i) == rank for i in maxes)`, for you need to do the same with mins.

True.

> It would be interesting to compare the speed of `rank_dict` and `is_graded` though, as their code is very similar.

I made a code that was slightly faster when calculating how many of `Posets(8)` are graded (assuming that ranks were not already computed). IF "going up" is cheaper than going down, i.e. poset is internally saved as digraph of upper covers, then in principle current implementation would be `O(n^2)` and my implementation `O(n)`. But in reality this sppedup is not happening.



---

archive/issue_comments_158488.json:
```json
{
    "body": "Yooooooo !\n\n> Yep. Should this one be marked as positive_review and moved to wontfix-milestone?\n\n+1 to that\n\n> I made a code that was slightly faster when calculating how many of `Posets(8)` are graded (assuming that ranks were not already computed). IF \"going up\" is cheaper than going down, i.e. poset is internally saved as digraph of upper covers, then in principle current implementation would be `O(n^2)` and my implementation `O(n)`. But in reality this sppedup is not happening.\n\nWell, going up or down should be the same cost. The edges are stored twice (in each direction) in digraphs.\n\nNathann",
    "created_at": "2014-10-13T09:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158488",
    "user": "ncohen"
}
```

Yooooooo !

> Yep. Should this one be marked as positive_review and moved to wontfix-milestone?

+1 to that

> I made a code that was slightly faster when calculating how many of `Posets(8)` are graded (assuming that ranks were not already computed). IF "going up" is cheaper than going down, i.e. poset is internally saved as digraph of upper covers, then in principle current implementation would be `O(n^2)` and my implementation `O(n)`. But in reality this sppedup is not happening.

Well, going up or down should be the same cost. The edges are stored twice (in each direction) in digraphs.

Nathann



---

archive/issue_comments_158489.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-10-13T10:45:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158489",
    "user": "jmantysalo"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_158490.json:
```json
{
    "body": "As current algorithm already is `O(n)` with small constant factor, and Nathann also suggest closing this, I mark this ticket as dontfix-positive_review.\n\nTodo-note from `posets.py` must also be removed. However, I can do that on #16998.",
    "created_at": "2014-10-13T10:45:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158490",
    "user": "jmantysalo"
}
```

As current algorithm already is `O(n)` with small constant factor, and Nathann also suggest closing this, I mark this ticket as dontfix-positive_review.

Todo-note from `posets.py` must also be removed. However, I can do that on #16998.



---

archive/issue_comments_158491.json:
```json
{
    "body": "Sorry for the confusion that came from me. When I said that \"Wouldn't hurt to improve it nevertheless\", I didn't have any particular improvements in mind, just an impression that I wasn't being very thorough. And I think it wasn't exactly my algorithm that got implemented in Sage, but rather an improved version by Anne(?) and Nicolas(?).",
    "created_at": "2014-10-13T13:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158491",
    "user": "darij"
}
```

Sorry for the confusion that came from me. When I said that "Wouldn't hurt to improve it nevertheless", I didn't have any particular improvements in mind, just an impression that I wasn't being very thorough. And I think it wasn't exactly my algorithm that got implemented in Sage, but rather an improved version by Anne(?) and Nicolas(?).



---

archive/issue_comments_158492.json:
```json
{
    "body": "Okay. Well, for sure I do not know any algorithmic way to compute that which would be better than the current one.\n\nNathann",
    "created_at": "2014-10-13T13:42:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158492",
    "user": "ncohen"
}
```

Okay. Well, for sure I do not know any algorithmic way to compute that which would be better than the current one.

Nathann



---

archive/issue_comments_158493.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2014-10-13T15:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13051#issuecomment-158493",
    "user": "vbraun"
}
```

Resolution: wontfix
