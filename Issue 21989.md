# Issue 21989: Make minimal Three.js a standard package

Issue created by migration from Trac.

Original creator: paulmasson

Original creation time: 2017-01-22 00:03:21

CC:  novoselt

The current implementation of Three.js only needs two files to function. In order to lessen the download time for all users, only these two files plus the license will be included in the standard package.


---

Comment by paulmasson created at 2017-01-23 01:15:18

New commits:


---

Comment by paulmasson created at 2017-01-23 01:15:18

Changing component from graphics to packages: standard.


---

Comment by paulmasson created at 2017-01-23 01:15:18

Changing status from new to needs_review.


---

Comment by paulmasson created at 2017-01-23 01:23:12

Andrey, the final tarball is only 130KB. I can provide a copy on GitHub if you like, but I assume you'll want to generate it yourself to be sure the `spkg-src` file works as expected.

It took me some time to realize I had to generate the tarball manually. I initially assumed that would happen automatically, so maybe I should add something to the documentation. How does the tarball get to the mirrors after someone generates it?

In `spkg-install` I simply remove any existing target and recreate the directory. I figured this would be safest for future upgrades, but feel free to give feedback on that.


---

Comment by novoselt created at 2017-01-29 00:49:29

I don't see the point in modifying `spkg-install` to copy only necessary files - there should be no unnecessary files, so copying the whole `src` as before should be fine. My understanding is that the only file skipped at the moment is the license and it seems small and important enough to include.

Regarding URLs - why use CDN for a one-time download? To me straight pull from github.com seems more suitable.

Also URL1/2/3 kind of ask to be put in some cycle but I am not a fan of shell programming so will not insist on it ;-)

Regarding getting tarballs to mirrors - there should be one attached to the ticket and when it is positively reviewed and merged that file goes to the mirrors, it is a manual process by the release manager.


---

Comment by git created at 2017-01-29 02:13:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Attachment


---

Comment by paulmasson created at 2017-01-29 02:24:56

With respect to URLs, when you're viewing the file on GitHub and click the "Raw" button, these are the URLs that GitHub returns. As far as I can tell, this is the official way to access files for download from GitHub. The domain appears in the [documentation](https://developer.github.com/v3/repos/contents/) in the `download_url`. If you know a better way then let me know.


---

Comment by novoselt created at 2017-01-29 02:33:42

My bad, after seeing `raw` I thought it is `rawgit`! No more complains, will now test it in action.


---

Comment by novoselt created at 2017-01-29 02:46:25

OK, looking closer at what [SageMathCell](SageMathCell) is doing with threejs, we need https://github.com/mrdoob/three.js/blob/dev/examples/js/Detector.js as well - it may be useful for the new implementation in the long run as well since as I understand canvas allows saving static graphics files. Can you please add it to the new package?


---

Comment by paulmasson created at 2017-01-29 03:40:01

The code in Detector.js is used to determine if the user's environment supports WebGL or not. That information is typically used to fall back to a canvas renderer rather than a WebGL renderer as necessary. I haven't included that test in the template because I tend to look forward and current versions of major browsers support WebGL.

Regardless of the renderer used, there will always be a `canvas` element in the HTML from which data can be extracted. That process is separate from the detector test and was a planned feature.

Still want the file?


---

Comment by novoselt created at 2017-01-29 03:54:43

Well, the current implementation of threejs in [SageMathCell](SageMathCell) uses it, and while browsers support WebGL there may be hardware (or software environment) that does not support it - my old notebook had to fall back to canvas and I believe Windows in VM had to do it as well when it at all worked.

If you think it is completely useless, I can just as well download it for [SageMathCell](SageMathCell) during build (there are other files pulled directly from github, so another one is not a problem). The plan is to drop current threejs function anyway.


---

Comment by novoselt created at 2017-01-29 17:50:00

Changing status from needs_review to positive_review.


---

Comment by novoselt created at 2017-01-29 17:50:00

Let's get it in to move on and add extra files later if we really need them!


---

Comment by vbraun created at 2017-01-31 20:47:13

Resolution: fixed
