# Issue 21989: Make minimal Three.js a standard package

archive/issues_021989.json:
```json
{
    "body": "CC:  novoselt\n\nThe current implementation of Three.js only needs two files to function. In order to lessen the download time for all users, only these two files plus the license will be included in the standard package.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22226\n\n",
    "created_at": "2017-01-22T00:03:21Z",
    "labels": [
        "graphics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Make minimal Three.js a standard package",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21989",
    "user": "paulmasson"
}
```
CC:  novoselt

The current implementation of Three.js only needs two files to function. In order to lessen the download time for all users, only these two files plus the license will be included in the standard package.

Issue created by migration from https://trac.sagemath.org/ticket/22226





---

archive/issue_comments_305652.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-01-23T01:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21989#issuecomment-305652",
    "user": "paulmasson"
}
```

New commits:



---

archive/issue_comments_305653.json:
```json
{
    "body": "Changing component from graphics to packages: standard.",
    "created_at": "2017-01-23T01:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21989#issuecomment-305653",
    "user": "paulmasson"
}
```

Changing component from graphics to packages: standard.



---

archive/issue_comments_305654.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-01-23T01:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21989#issuecomment-305654",
    "user": "paulmasson"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_305655.json:
```json
{
    "body": "Andrey, the final tarball is only 130KB. I can provide a copy on GitHub if you like, but I assume you'll want to generate it yourself to be sure the `spkg-src` file works as expected.\n\nIt took me some time to realize I had to generate the tarball manually. I initially assumed that would happen automatically, so maybe I should add something to the documentation. How does the tarball get to the mirrors after someone generates it?\n\nIn `spkg-install` I simply remove any existing target and recreate the directory. I figured this would be safest for future upgrades, but feel free to give feedback on that.",
    "created_at": "2017-01-23T01:23:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21989#issuecomment-305655",
    "user": "paulmasson"
}
```

Andrey, the final tarball is only 130KB. I can provide a copy on GitHub if you like, but I assume you'll want to generate it yourself to be sure the `spkg-src` file works as expected.

It took me some time to realize I had to generate the tarball manually. I initially assumed that would happen automatically, so maybe I should add something to the documentation. How does the tarball get to the mirrors after someone generates it?

In `spkg-install` I simply remove any existing target and recreate the directory. I figured this would be safest for future upgrades, but feel free to give feedback on that.



---

archive/issue_comments_305656.json:
```json
{
    "body": "I don't see the point in modifying `spkg-install` to copy only necessary files - there should be no unnecessary files, so copying the whole `src` as before should be fine. My understanding is that the only file skipped at the moment is the license and it seems small and important enough to include.\n\nRegarding URLs - why use CDN for a one-time download? To me straight pull from github.com seems more suitable.\n\nAlso URL1/2/3 kind of ask to be put in some cycle but I am not a fan of shell programming so will not insist on it ;-)\n\nRegarding getting tarballs to mirrors - there should be one attached to the ticket and when it is positively reviewed and merged that file goes to the mirrors, it is a manual process by the release manager.",
    "created_at": "2017-01-29T00:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21989#issuecomment-305656",
    "user": "novoselt"
}
```

I don't see the point in modifying `spkg-install` to copy only necessary files - there should be no unnecessary files, so copying the whole `src` as before should be fine. My understanding is that the only file skipped at the moment is the license and it seems small and important enough to include.

Regarding URLs - why use CDN for a one-time download? To me straight pull from github.com seems more suitable.

Also URL1/2/3 kind of ask to be put in some cycle but I am not a fan of shell programming so will not insist on it ;-)

Regarding getting tarballs to mirrors - there should be one attached to the ticket and when it is positively reviewed and merged that file goes to the mirrors, it is a manual process by the release manager.



---

archive/issue_comments_305657.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-29T02:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21989#issuecomment-305657",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305658.json:
```json
{
    "body": "Attachment [threejs-r80.tar.gz](tarball://root/attachments/some-uuid/ticket22226/threejs-r80.tar.gz) by paulmasson created at 2017-01-29 02:18:54",
    "created_at": "2017-01-29T02:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21989#issuecomment-305658",
    "user": "paulmasson"
}
```

Attachment [threejs-r80.tar.gz](tarball://root/attachments/some-uuid/ticket22226/threejs-r80.tar.gz) by paulmasson created at 2017-01-29 02:18:54



---

archive/issue_comments_305659.json:
```json
{
    "body": "With respect to URLs, when you're viewing the file on GitHub and click the \"Raw\" button, these are the URLs that GitHub returns. As far as I can tell, this is the official way to access files for download from GitHub. The domain appears in the [documentation](https://developer.github.com/v3/repos/contents/) in the `download_url`. If you know a better way then let me know.",
    "created_at": "2017-01-29T02:24:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21989#issuecomment-305659",
    "user": "paulmasson"
}
```

With respect to URLs, when you're viewing the file on GitHub and click the "Raw" button, these are the URLs that GitHub returns. As far as I can tell, this is the official way to access files for download from GitHub. The domain appears in the [documentation](https://developer.github.com/v3/repos/contents/) in the `download_url`. If you know a better way then let me know.



---

archive/issue_comments_305660.json:
```json
{
    "body": "My bad, after seeing `raw` I thought it is `rawgit`! No more complains, will now test it in action.",
    "created_at": "2017-01-29T02:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21989#issuecomment-305660",
    "user": "novoselt"
}
```

My bad, after seeing `raw` I thought it is `rawgit`! No more complains, will now test it in action.



---

archive/issue_comments_305661.json:
```json
{
    "body": "OK, looking closer at what [SageMathCell](SageMathCell) is doing with threejs, we need https://github.com/mrdoob/three.js/blob/dev/examples/js/Detector.js as well - it may be useful for the new implementation in the long run as well since as I understand canvas allows saving static graphics files. Can you please add it to the new package?",
    "created_at": "2017-01-29T02:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21989#issuecomment-305661",
    "user": "novoselt"
}
```

OK, looking closer at what [SageMathCell](SageMathCell) is doing with threejs, we need https://github.com/mrdoob/three.js/blob/dev/examples/js/Detector.js as well - it may be useful for the new implementation in the long run as well since as I understand canvas allows saving static graphics files. Can you please add it to the new package?



---

archive/issue_comments_305662.json:
```json
{
    "body": "The code in Detector.js is used to determine if the user's environment supports WebGL or not. That information is typically used to fall back to a canvas renderer rather than a WebGL renderer as necessary. I haven't included that test in the template because I tend to look forward and current versions of major browsers support WebGL.\n\nRegardless of the renderer used, there will always be a `canvas` element in the HTML from which data can be extracted. That process is separate from the detector test and was a planned feature.\n\nStill want the file?",
    "created_at": "2017-01-29T03:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21989#issuecomment-305662",
    "user": "paulmasson"
}
```

The code in Detector.js is used to determine if the user's environment supports WebGL or not. That information is typically used to fall back to a canvas renderer rather than a WebGL renderer as necessary. I haven't included that test in the template because I tend to look forward and current versions of major browsers support WebGL.

Regardless of the renderer used, there will always be a `canvas` element in the HTML from which data can be extracted. That process is separate from the detector test and was a planned feature.

Still want the file?



---

archive/issue_comments_305663.json:
```json
{
    "body": "Well, the current implementation of threejs in [SageMathCell](SageMathCell) uses it, and while browsers support WebGL there may be hardware (or software environment) that does not support it - my old notebook had to fall back to canvas and I believe Windows in VM had to do it as well when it at all worked.\n\nIf you think it is completely useless, I can just as well download it for [SageMathCell](SageMathCell) during build (there are other files pulled directly from github, so another one is not a problem). The plan is to drop current threejs function anyway.",
    "created_at": "2017-01-29T03:54:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21989#issuecomment-305663",
    "user": "novoselt"
}
```

Well, the current implementation of threejs in [SageMathCell](SageMathCell) uses it, and while browsers support WebGL there may be hardware (or software environment) that does not support it - my old notebook had to fall back to canvas and I believe Windows in VM had to do it as well when it at all worked.

If you think it is completely useless, I can just as well download it for [SageMathCell](SageMathCell) during build (there are other files pulled directly from github, so another one is not a problem). The plan is to drop current threejs function anyway.



---

archive/issue_comments_305664.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-29T17:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21989#issuecomment-305664",
    "user": "novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_305665.json:
```json
{
    "body": "Let's get it in to move on and add extra files later if we really need them!",
    "created_at": "2017-01-29T17:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21989#issuecomment-305665",
    "user": "novoselt"
}
```

Let's get it in to move on and add extra files later if we really need them!



---

archive/issue_comments_305666.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-01-31T20:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21989#issuecomment-305666",
    "user": "vbraun"
}
```

Resolution: fixed
