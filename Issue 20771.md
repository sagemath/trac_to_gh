# Issue 20771: Allow non-ascii labels in graph vertices (at least for plotting)

Issue created by migration from Trac.

Original creator: kcrisman

Original creation time: 2016-07-12 14:08:42

Apparently graph vertex labels have to be ASCII.

```
Graph({'Б':[1,2]}).plot()
```

See [here](http://stackoverflow.com/questions/38330144/how-to-plot-a-graph-in-sage-using-non-english-symbols) and the duplicate [here](http://ask.sagemath.org/question/34071/is-there-a-way-to-use-non-english-symbols/).


---

Comment by chapoton created at 2016-07-12 19:17:47

Here is a tentative. Sometimes the character is not available in the usual font. At least
this works for the more common utf8 characters.

http://stackoverflow.com/questions/10960463/non-ascii-characters-in-matplotlib
----
New commits:


---

Comment by chapoton created at 2016-07-12 19:17:47

Changing status from new to needs_review.


---

Comment by jmantysalo created at 2016-07-12 19:36:45

Mäntysalo can review this patch made by Frédéric.


---

Comment by kcrisman created at 2016-07-12 20:10:56

I take it that would create some self-referential directed graph of review with Unicode vertices :-) just make sure it doesn't break any current graph plots!


---

Comment by paulmasson created at 2016-07-13 04:02:57

Documentation doesn't build with this fix. See #13161 for similar problem.

Also, the Russian character displays as a square box on Mac OS X El Capitan. Local Unicode fonts do not get incorporated into matplotlib output. Shouldn't there be some simple way to use local fonts?


---

Comment by git created at 2016-07-13 06:59:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2016-07-13 12:00:21

I don't understand. This works:


```
DiGraph({u'Mäntysalo':[u'Frédéric']}).plot()
```


but this does not:


```
D = DiGraph()
D.add_edge(u'Mäntysalo', u'Frédéric')
G.show()
```



---

Comment by jmantysalo created at 2016-07-13 12:02:15

Also `src/sage/combinat/posets/posets.py` fails some test.


---

Comment by jmantysalo created at 2016-07-13 12:02:15

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2016-07-13 12:03:52

Replying to [comment:6 jmantysalo]:
> I don't understand. This works:
> 
> {{{
> DiGraph({u'Mäntysalo':[u'Frédéric']}).plot()
> }}}
> 
> but this does not:
> 
> {{{
> D = DiGraph()
> D.add_edge(u'Mäntysalo', u'Frédéric')
> G.show()
> }}}

It should be D.show(), and it works for me.


---

Comment by git created at 2016-07-13 12:05:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-07-13 12:05:35

Changing status from needs_work to needs_review.


---

Comment by jmantysalo created at 2016-07-13 12:18:17

My mistake. Now it works and also


```
D = DiGraph()
D.add_edge(u'Frédéric', 'review', u'Mäntysalo')
D.show(edge_labels=True)
```


works.


---

Comment by jmantysalo created at 2016-07-13 12:18:17

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2016-07-13 13:34:25

Do we want all vertex labels to be unicode automatically?  (I'm not sure if that is what is happening with the changed doctest in posets.)


---

Comment by chapoton created at 2016-07-13 13:35:57

labels are converted to unicode in the plot, not in the graphs themselves.


---

Comment by kcrisman created at 2016-07-13 13:39:44

Got it, thanks.


---

Comment by vbraun created at 2016-07-13 23:36:46

Resolution: fixed


---

Comment by tmonteil created at 2016-08-24 08:10:50

On my machine (7.4.beta1), the example given in the ticket description does not work:


```
sage: Graph({'Б':[1,2]}).plot()
...
UnicodeDecodeError: 'ascii' codec can't decode byte 0xd0 in position 0: ordinal not in range(128)
```


Probably due to:


```
sage: type('Б')
<type 'str'>
sage: type(u'Б')
<type 'unicode'>
```



---

Comment by chapoton created at 2016-08-24 08:15:51

you forgot the `u`. Ths is not an ascii string. As long as nobody cares about py3, we have to add a `u` for unicode strings.


---

Comment by tmonteil created at 2016-08-24 08:20:35

The point was that 'Б' is a valid string (through not unicode), which is not handled by plot. If it will automatically be fixed by Python 3, it is probably better not to add artificial noise into the source code.
