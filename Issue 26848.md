# Issue 26848: documentation: Improve sphinx_plot to create scalable graphics

archive/issues_026848.json:
```json
{
    "body": "CC:  @vbraun @videlec tmonteil @jm58660 @fredrik-johansson @jdemeyer @jhpalmieri\n\nThe function `sphinx_plot`, introduced in #17498 to support the `.. PLOT::` directive provided by the matplotlib sphinx extension, creates all graphics by saving to a temporary PNG file first.\n\nThis ticket improves this function so that 2d graphics (including `GraphicsArray`s) are shipped out directly via matplotlib. In this way, proper SVG graphics can be generated for the HTML documentation.\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27085\n\n",
    "created_at": "2019-01-21T00:25:29Z",
    "labels": [
        "component: documentation"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "documentation: Improve sphinx_plot to create scalable graphics",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26848",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @vbraun @videlec tmonteil @jm58660 @fredrik-johansson @jdemeyer @jhpalmieri

The function `sphinx_plot`, introduced in #17498 to support the `.. PLOT::` directive provided by the matplotlib sphinx extension, creates all graphics by saving to a temporary PNG file first.

This ticket improves this function so that 2d graphics (including `GraphicsArray`s) are shipped out directly via matplotlib. In this way, proper SVG graphics can be generated for the HTML documentation.



Issue created by migration from https://trac.sagemath.org/ticket/27085





---

archive/issue_comments_377253.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-01-21T00:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377253",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_377254.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-01-21T00:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377254",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_377255.json:
```json
{
    "body": "The individual plots look good. It's a little quicker than the current way of building the documentation, and it takes up a little less disk space.",
    "created_at": "2019-01-22T23:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377255",
    "user": "https://github.com/jhpalmieri"
}
```

The individual plots look good. It's a little quicker than the current way of building the documentation, and it takes up a little less disk space.



---

archive/issue_comments_377256.json:
```json
{
    "body": "I think this looks okay, but I would like more opinions.",
    "created_at": "2019-01-23T05:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377256",
    "user": "https://github.com/jhpalmieri"
}
```

I think this looks okay, but I would like more opinions.



---

archive/issue_comments_377257.json:
```json
{
    "body": "I checked the once case where I remember using a Sphinx plot in my documentation (Fully Packed Loops), and it works fine there. Is there a good place to check to see how the GraphicsArray works?",
    "created_at": "2019-01-24T23:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377257",
    "user": "https://github.com/kevindilks"
}
```

I checked the once case where I remember using a Sphinx plot in my documentation (Fully Packed Loops), and it works fine there. Is there a good place to check to see how the GraphicsArray works?



---

archive/issue_comments_377258.json:
```json
{
    "body": "Replying to [comment:6 kdilks]:\n> I checked the once case where I remember using a Sphinx plot in my documentation (Fully Packed Loops), and it works fine there. Is there a good place to check to see how the GraphicsArray works?\n\nThe documentation for `sage.plot.plot.graphics_array` has an example plot.",
    "created_at": "2019-01-25T00:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377258",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:6 kdilks]:
> I checked the once case where I remember using a Sphinx plot in my documentation (Fully Packed Loops), and it works fine there. Is there a good place to check to see how the GraphicsArray works?

The documentation for `sage.plot.plot.graphics_array` has an example plot.



---

archive/issue_comments_377259.json:
```json
{
    "body": "Checked those, everything looks good to me. The svg files are taking up marginally more space than the original png files for me, but not enough to be concerning (71 vs 63 kb for plot-24, 45 vs 34 kb for plot-25 in the `sage.plot.plot.graphics_array` documentation).",
    "created_at": "2019-01-25T01:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377259",
    "user": "https://github.com/kevindilks"
}
```

Checked those, everything looks good to me. The svg files are taking up marginally more space than the original png files for me, but not enough to be concerning (71 vs 63 kb for plot-24, 45 vs 34 kb for plot-25 in the `sage.plot.plot.graphics_array` documentation).



---

archive/issue_comments_377260.json:
```json
{
    "body": "The advantage, disk-space wise, is I see a bunch of PDF files in the old version but smaller svg files in the new version. I also see two versions of png files in the old version and only one in the new.",
    "created_at": "2019-01-25T02:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377260",
    "user": "https://github.com/jhpalmieri"
}
```

The advantage, disk-space wise, is I see a bunch of PDF files in the old version but smaller svg files in the new version. I also see two versions of png files in the old version and only one in the new.



---

archive/issue_comments_377261.json:
```json
{
    "body": "I have only tested generating HTML documentation. I don't know what other formats are expected to work. In particular I haven't tried to build the PDF documentation.",
    "created_at": "2019-01-25T03:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377261",
    "user": "https://github.com/mkoeppe"
}
```

I have only tested generating HTML documentation. I don't know what other formats are expected to work. In particular I haven't tried to build the PDF documentation.



---

archive/issue_comments_377262.json:
```json
{
    "body": "With vanilla Sage, I get PDF files in `local/share/doc/sage/inventory/en/reference/plotting/sage/graphs/` when I'm building the html docs. For example:\n\n```\n  -rw-r--r--  1 palmieri staff 254903 Jan 24 19:51 graph_plot-1.hires.png\n  -rw-r--r--  1 palmieri staff 215503 Jan 24 19:51 graph_plot-1.pdf\n  -rw-r--r--  1 palmieri staff  60166 Jan 24 19:51 graph_plot-1.png\n  -rw-r--r--  1 palmieri staff     34 Jan 24 19:51 graph_plot-1.py\n  ...\n```\n\nWith the branch here:\n\n```\n  -rw-r--r--  1 palmieri staff  38735 Jan 24 20:03 graph_plot-1.png\n  -rw-r--r--  1 palmieri staff     34 Jan 24 20:03 graph_plot-1.py\n  -rw-r--r--  1 palmieri staff  18445 Jan 24 20:03 graph_plot-1.svg\n```\n",
    "created_at": "2019-01-25T04:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377262",
    "user": "https://github.com/jhpalmieri"
}
```

With vanilla Sage, I get PDF files in `local/share/doc/sage/inventory/en/reference/plotting/sage/graphs/` when I'm building the html docs. For example:

```
  -rw-r--r--  1 palmieri staff 254903 Jan 24 19:51 graph_plot-1.hires.png
  -rw-r--r--  1 palmieri staff 215503 Jan 24 19:51 graph_plot-1.pdf
  -rw-r--r--  1 palmieri staff  60166 Jan 24 19:51 graph_plot-1.png
  -rw-r--r--  1 palmieri staff     34 Jan 24 19:51 graph_plot-1.py
  ...
```

With the branch here:

```
  -rw-r--r--  1 palmieri staff  38735 Jan 24 20:03 graph_plot-1.png
  -rw-r--r--  1 palmieri staff     34 Jan 24 20:03 graph_plot-1.py
  -rw-r--r--  1 palmieri staff  18445 Jan 24 20:03 graph_plot-1.svg
```




---

archive/issue_comments_377263.json:
```json
{
    "body": "I was also only checking the HTML documentation, and in a not-so-thorough way. I'll look a little more closely to double check on all the files that get created, and also try building the pdf documentation.",
    "created_at": "2019-01-25T04:46:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377263",
    "user": "https://github.com/kevindilks"
}
```

I was also only checking the HTML documentation, and in a not-so-thorough way. I'll look a little more closely to double check on all the files that get created, and also try building the pdf documentation.



---

archive/issue_comments_377264.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-26T22:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377264",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377265.json:
```json
{
    "body": "With this fix, also the PDF documentation now has the scalable graphics.\nNeeds review...",
    "created_at": "2019-01-29T18:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377265",
    "user": "https://github.com/mkoeppe"
}
```

With this fix, also the PDF documentation now has the scalable graphics.
Needs review...



---

archive/issue_comments_377266.json:
```json
{
    "body": "Regarding the change\n\n```diff\n-def sphinx_plot(plot):\n+def sphinx_plot(graphics, **kwds)\n```\n\nis `sphinx_plot` called with extra arguments anywhere (yet)?\n\nIt all works for me, but I don't have time to look carefully at the rest of the code. At a glance it looks okay, but if someone else is willing to take a closer look, that would be great.",
    "created_at": "2019-01-30T21:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377266",
    "user": "https://github.com/jhpalmieri"
}
```

Regarding the change

```diff
-def sphinx_plot(plot):
+def sphinx_plot(graphics, **kwds)
```

is `sphinx_plot` called with extra arguments anywhere (yet)?

It all works for me, but I don't have time to look carefully at the rest of the code. At a glance it looks okay, but if someone else is willing to take a closer look, that would be great.



---

archive/issue_comments_377267.json:
```json
{
    "body": "Replying to [comment:15 jhpalmieri]:\n> Regarding the change\n> {{{\n> #!diff\n> -def sphinx_plot(plot):\n> +def sphinx_plot(graphics, **kwds)\n> }}}\n> is `sphinx_plot` called with extra arguments anywhere (yet)?\n\nIt is not yet used in the sage documentation, but is crucial for `GraphicsArray`s, which do not have a way to store show options. (One of many defects of `GraphicsArray`s.)\nI use it in my package to make graphics array plots with particular figure sizes.\nExample: http://mkoeppe.github.io/cutgeneratingfunctionology/doc/html/procedures.html",
    "created_at": "2019-01-30T21:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377267",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:15 jhpalmieri]:
> Regarding the change
> {{{
> #!diff
> -def sphinx_plot(plot):
> +def sphinx_plot(graphics, **kwds)
> }}}
> is `sphinx_plot` called with extra arguments anywhere (yet)?

It is not yet used in the sage documentation, but is crucial for `GraphicsArray`s, which do not have a way to store show options. (One of many defects of `GraphicsArray`s.)
I use it in my package to make graphics array plots with particular figure sizes.
Example: http://mkoeppe.github.io/cutgeneratingfunctionology/doc/html/procedures.html



---

archive/issue_comments_377268.json:
```json
{
    "body": "At some point (not necessarily on this ticket), would it be a good idea to move `sphinx_plot` into the Sage library, along with a docstring, examples, and doctests, and then essentially just import it in `conf.py`? So change `plot_pre_code` to equal\n\n```\nfrom sage.all_cmdline import *\nfrom sage.plot.sphinx_plot import sphinx_plot\n```\n\nOr is there some good reason to keep it where it is?",
    "created_at": "2019-01-30T21:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377268",
    "user": "https://github.com/jhpalmieri"
}
```

At some point (not necessarily on this ticket), would it be a good idea to move `sphinx_plot` into the Sage library, along with a docstring, examples, and doctests, and then essentially just import it in `conf.py`? So change `plot_pre_code` to equal

```
from sage.all_cmdline import *
from sage.plot.sphinx_plot import sphinx_plot
```

Or is there some good reason to keep it where it is?



---

archive/issue_comments_377269.json:
```json
{
    "body": "Replying to [comment:17 jhpalmieri]:\n> At some point (not necessarily on this ticket), would it be a good idea to move `sphinx_plot` into the Sage library, along with a docstring, examples, and doctests, and then essentially just import it in `conf.py`? So change `plot_pre_code` to equal\n> {{{\n> from sage.all_cmdline import *\n> from sage.plot.sphinx_plot import sphinx_plot\n> }}}\n> Or is there some good reason to keep it where it is?\n\nIn a follow-up ticket, it could be good to refactor it as follows: Remove the `sphinx_plot` function completely and instead giving every graphics object (including `GraphicsArray`s and the 3D graphics objects) a method `to_pyplot` (or similar) that will put the object in a pyplot figure. \n\nThis would be useful for interoperating sage graphics with pure `matplotlib.pyplot` code, not just for Sphinx.",
    "created_at": "2019-01-30T21:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377269",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:17 jhpalmieri]:
> At some point (not necessarily on this ticket), would it be a good idea to move `sphinx_plot` into the Sage library, along with a docstring, examples, and doctests, and then essentially just import it in `conf.py`? So change `plot_pre_code` to equal
> {{{
> from sage.all_cmdline import *
> from sage.plot.sphinx_plot import sphinx_plot
> }}}
> Or is there some good reason to keep it where it is?

In a follow-up ticket, it could be good to refactor it as follows: Remove the `sphinx_plot` function completely and instead giving every graphics object (including `GraphicsArray`s and the 3D graphics objects) a method `to_pyplot` (or similar) that will put the object in a pyplot figure. 

This would be useful for interoperating sage graphics with pure `matplotlib.pyplot` code, not just for Sphinx.



---

archive/issue_comments_377270.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-13T18:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377270",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_377271.json:
```json
{
    "body": "Okay, I'm happy with this.",
    "created_at": "2019-02-13T18:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377271",
    "user": "https://github.com/jhpalmieri"
}
```

Okay, I'm happy with this.



---

archive/issue_comments_377272.json:
```json
{
    "body": "Thank you!",
    "created_at": "2019-02-13T18:56:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377272",
    "user": "https://github.com/mkoeppe"
}
```

Thank you!



---

archive/issue_comments_377273.json:
```json
{
    "body": "Replying to [comment:18 mkoeppe]:\n> In a follow-up ticket, it could be good to refactor it as follows: Remove the `sphinx_plot` function completely and instead giving every graphics object (including `GraphicsArray`s and the 3D graphics objects) a method `to_pyplot` (or similar) that will put the object in a pyplot figure. \n> \n> This would be useful for interoperating sage graphics with pure `matplotlib.pyplot` code, not just for Sphinx.\n\nFollow-up ticket for this: #27276",
    "created_at": "2019-02-13T19:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377273",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:18 mkoeppe]:
> In a follow-up ticket, it could be good to refactor it as follows: Remove the `sphinx_plot` function completely and instead giving every graphics object (including `GraphicsArray`s and the 3D graphics objects) a method `to_pyplot` (or similar) that will put the object in a pyplot figure. 
> 
> This would be useful for interoperating sage graphics with pure `matplotlib.pyplot` code, not just for Sphinx.

Follow-up ticket for this: #27276



---

archive/issue_comments_377274.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-14T19:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377274",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_024925.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2019-02-14T19:45:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26848#event-24925"
}
```



---

archive/issue_comments_377275.json:
```json
{
    "body": "Follow-up: #27481",
    "created_at": "2019-03-14T02:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26848#issuecomment-377275",
    "user": "https://github.com/mkoeppe"
}
```

Follow-up: #27481
