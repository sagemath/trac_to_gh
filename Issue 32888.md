# Issue 32888: 'make -n TARGET' is broken

Issue created by migration from https://trac.sagemath.org/ticket/33125

Original creator: mkoeppe

Original creation time: 2022-01-06 21:58:01

CC:  mjo

`make -n sagelib` should only print, not run, commands.

Broken by #32759 by using `+` in `build/make/Makefile.in` `*-*-no-deps` rules


---

Comment by mkoeppe created at 2022-01-06 22:30:12

Changing priority from major to critical.


---

Comment by mkoeppe created at 2022-01-06 22:36:22

Changing priority from critical to blocker.


---

Comment by mkoeppe created at 2022-01-07 20:25:07

A solution is to do a bit of `MAKEFLAGS` parsing - see e.g. https://stackoverflow.com/questions/19521438/how-to-access-make-options-in-makefile


---

Comment by mjo created at 2022-01-07 22:47:24

Isn't this just because invoking `build/make/install` interrupts the `$MAKE` and `$MAKEFLAGS` magic that normally gets applied to sub-_make_s?

For example, this fixes `make -n sagelib` for me:


```patch
diff --git a/Makefile b/Makefile
index 444e4f9e4a..9505152830 100644
--- a/Makefile
+++ b/Makefile
@@ -37,7 +37,7 @@ sageruntime: base-toolchain
 	@if [ -x relocate-once.py ]; then ./relocate-once.py; fi
 	$(MAKE) build/make/Makefile --stop
 	+build/bin/sage-logger \
-		"cd build/make && ./install '$@'" logs/install.log
+		"cd build/make && MAKE=\"$(MAKE)\" MAKEFLAGS=\"$(MAKEFLAGS)\" ./install '$@'" logs/install.log
 
 # CONFIG_FILES lists all files that appear in AC_CONFIG_FILES in configure.ac;
 # except for build/make/Makefile-auto, which is unused by the build system
```



---

Comment by mkoeppe created at 2022-01-07 22:49:41

Did you test this on top of #32759?


---

Comment by mkoeppe created at 2022-01-07 22:50:51

No, the problem is that we want to pass jobserver flags to something that is not `make` (and therefore does not handle `-n` etc.), namely the `spkg-install` script.


---

Comment by mjo created at 2022-01-07 23:04:35

Replying to [comment:7 mkoeppe]:
> Did you test this on top of #32759?

No, but the problem with `make -n sagelib` already exists in beta9.


---

Comment by mkoeppe created at 2022-01-08 06:51:46

OK, you are right, there is broader breakage regarding `-n` etc. that has been around for a long time.

But there's a more specific problem (of blocker quality) caused by #32759. I've opened #33130 for it.

Let's address the broader problem in Sage 9.6.


---

Comment by mkoeppe created at 2022-01-08 06:51:46

Changing priority from blocker to major.
