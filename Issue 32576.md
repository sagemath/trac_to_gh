# Issue 32576: improved error message 'unknown file extension' provided by sage -t

Issue created by migration from https://trac.sagemath.org/ticket/32813

Original creator: slabbe

Original creation time: 2021-11-02 14:26:40

CC:  @tobiasdiez

As reported on [sage-devel](https://groups.google.com/g/sage-devel/c/Jki-RKOaLmY/m/VPwhGAC4AAAJ), with

```
$ sage -v
SageMath version 9.5.beta5, Release Date: 2021-10-28
```


This works okay:

```
$ sage -t src/sage/rings/integer.pyx
sage -t --random-seed=71352052423083427285276605183088217936 src/sage/rings/integer.pyx
    [1145 tests, 3.32 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```


But the following does not work anymore:

```
$ sage -t src/sage/rings/integer.pyx --log=a.log
Traceback (most recent call last):
  File "/home/slabbe/GitBox/sage/src/bin/sage-runtests", line 151, in <module>
    err = DC.run()
  File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/doctest/control.py", line 1251, in run
    self.expand_files_into_sources()
  File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/doctest/control.py", line 835, in expand_files_into_sources
    self.sources = [FileDocTestSource(path, self.options) for path in expand()]
  File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/doctest/control.py", line 835, in <listcomp>
    self.sources = [FileDocTestSource(path, self.options) for path in expand()]
  File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/doctest/sources.py", line 527, in __init__
    raise ValueError("unknown file extension %r"%ext)
ValueError: unknown file extension '.log'
```


Indeed, since #32332, "**all arguments must go before the file name now**".

The current error message fails to indicate the user how to fix the problem. The current ticket aims at improving the error message.


---

Comment by slabbe created at 2021-11-02 14:51:01

New commits:


---

Comment by slabbe created at 2021-11-02 14:51:01

Changing status from new to needs_review.


---

Comment by chapoton created at 2021-11-02 16:55:29

You may want to fix also here the annoying issue that appears after a successful doctest:

```
Traceback (most recent call last):
  File "/home/chapoton/sage/src/bin/sage-runtests", line 159, in <module>
    exit_code_pytest = pytest.main(pytest_options + args)
TypeError: can only concatenate list (not "Namespace") to list
```

I have not idea how to fix that, and what this line is supposed to achieve. Pytest experts should explain.


---

Comment by chapoton created at 2021-11-02 17:11:08

see also #31924


---

Comment by slabbe created at 2021-11-02 19:12:16

Replying to [comment:2 chapoton]:
> You may want to fix also here the annoying issue that appears after a successful doctest:
> {{{
> Traceback (most recent call last):
>   File "/home/chapoton/sage/src/bin/sage-runtests", line 159, in <module>
>     exit_code_pytest = pytest.main(pytest_options + args)
> TypeError: can only concatenate list (not "Namespace") to list
> }}}
> I have not idea how to fix that, and what this line is supposed to achieve. Pytest experts should explain.

I do not have such failure on my side. Only the line:

```
Pytest is not installed, skip checking tests that rely on it.
```

How can I reproduce the typeerror you mention?


---

Comment by chapoton created at 2021-11-02 19:18:58

Ah, alors ca doit venir du fait que j'ai installÃ© pytest.

`pip install pytest`

Dans la ligne

```
exit_code_pytest = pytest.main(pytest_options + args)
```

il faut remplacer args (une sorte de dictionnaire, en fait un `NameSpace`) par sa partie "nom de fichiers".

EDIT: `args.filenames`


---

Comment by git created at 2021-11-03 11:07:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slabbe created at 2021-11-03 11:08:56

Inspired by the description of #31352, I did one more commit to also provide the filename in the error message, not only the wrong extension.


---

Comment by slabbe created at 2021-11-03 11:22:15

Replying to [comment:6 chapoton]:
> Dans la ligne
> {{{
> exit_code_pytest = pytest.main(pytest_options + args)
> }}}
> il faut remplacer args (une sorte de dictionnaire, en fait un `NameSpace`) par sa partie "nom de fichiers".
> 
> EDIT: `args.filenames`

I prefer to do it in another ticket: see #32818 (needs review).


---

Comment by chapoton created at 2021-11-03 15:46:34

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2021-11-03 15:46:34

ok, alors allons-y


---

Comment by vbraun created at 2021-11-14 17:05:33

Resolution: fixed
