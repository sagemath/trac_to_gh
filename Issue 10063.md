# Issue 10063: -1 in expression "is_positive".

Issue created by migration from Trac.

Original creator: fmaltey

Original creation time: 2010-10-03 18:04:13

Assignee: burcin

CC:  robertwb kcrisman

I test :


```
y = I*I*x / x # so y is the expression -1
y._is_positive()  # the answer is True (and I dislike)
z = -x / x 
z._is_positive()   # the answer is False 
bool (z == y) # the answer is True
```



---

Comment by burcin created at 2010-10-16 20:45:26

Simpler example:


```
sage: (I*I)._is_positive()
True
sage: I*I
-1
```


The `is_positive()` test in pynac is at line 923 in numeric.cpp:


```
    case PYOBJECT:
      n = is_real() && (PyObject_Compare(v._pyobject, ZERO) > 0);
      if (PyErr_Occurred()) 
	py_error("is_positive");
      return n;
```


We use the python comparison. Unfortunately, this doesn't work as expected for number field elements:


```
sage: m = (I*I).pyobject()
sage: m.parent()
Number Field in I with defining polynomial x^2 + 1
sage: m > 0
True
sage: m
-1
```



---

Comment by burcin created at 2010-10-16 20:55:21

Changing status from new to needs_review.


---

Comment by burcin created at 2010-10-16 20:55:21

attachment:trac_10064-compare_I.patch changes the quadratic number field element comparison code to return a more sensible result. Now we have:


```
sage: m = (I*I).pyobject()
sage: m > 0
False
sage: m < 0
True
```


This also fixes #10062.


---

Comment by burcin created at 2010-10-16 20:55:21

Changing priority from major to critical.


---

Comment by jgaski created at 2010-11-02 06:43:22

Here is a small bit of code that breaks (in 4.5.3) with trac_10064-compare_I.patch applied:


```
K.<a> = QuadraticField(5)
E = EllipticCurve(K,[-1, -1, 1/2*a + 1/2, -1/2*a - 1/2, 1/2*a + 1/2])
E.torsion_subgroup()
```



---

Comment by jgaski created at 2010-11-02 06:43:22

Changing status from needs_review to needs_work.


---

Comment by jgaski created at 2010-11-03 20:06:32

Please see http://tinypaste.com/3f27d for the error from the above code snippet.


---

Comment by kcrisman created at 2011-02-07 15:43:27

Apparently related to #7160 and #6132, see [this sage-devel discussion](http://groups.google.com/group/sage-support/browse_thread/thread/28bbd04a78dadb57/01168722573ff736).


---

Attachment


---

Comment by mhansen created at 2011-12-19 10:38:30

Changing status from needs_work to needs_review.


---

Comment by mhansen created at 2011-12-19 10:38:30

I've added a patch which verifies that is fixed by #7160.

Apply trac_10064.patch


---

Comment by mhansen created at 2011-12-20 12:33:20

Changing keywords from "" to "sd35".


---

Comment by burcin created at 2012-01-10 05:59:01

Looks good to me.


---

Comment by burcin created at 2012-01-10 05:59:01

Changing status from needs_review to positive_review.


---

Attachment

Now that #7160 is fixed (by way of #13213), this can be merged.


---

Comment by jdemeyer created at 2013-06-10 08:41:51

Resolution: fixed
