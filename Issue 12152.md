# Issue 12152: Fix upgrading of root repository

Issue created by migration from Trac.

Original creator: jhpalmieri

Original creation time: 2012-01-18 22:55:59

Assignee: tbd

CC:  kini

Keywords: root upgrade

On sage-devel, there are occasional complaints about the failure to upgrade because of uncommitted files in the root repository.  We should address these.  The culprit is in the script sage-update, and in particular the lines

```python
    if root_repo_intact:
        P = subprocess.Popen('hg status', shell=True,
                             stdout=subprocess.PIPE)
        output = P.communicate()[0]
        if len(output) > 0: # uncommitted changes
            print ("There are uncommitted changes in the "
                   + "Sage root repository. Aborting.")
            sys.exit(2)
```

We could delete these lines altogether, or change 'hg status' to 'hg status -m' or something like that.  If we delete this altogether, perhaps the root repo's spkg-install file (SAGE_ROOT/spkg/root-spkg-install) should deal with uncommitted changes.


---

Attachment


---

Comment by jdemeyer created at 2012-08-31 19:18:53

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2012-08-31 19:18:53

"critical" because this annoys me terribly.


---

Comment by jdemeyer created at 2012-08-31 19:18:53

Changing priority from major to critical.


---

Comment by jdemeyer created at 2012-08-31 19:18:53

Changing component from packages to scripts.


---

Comment by jhpalmieri created at 2012-09-01 19:05:57

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2012-09-01 19:05:57

Looks okay to me. It allows upgrading when there are stray files in the root repo.


---

Comment by jdemeyer created at 2012-09-02 21:29:20

Resolution: fixed
