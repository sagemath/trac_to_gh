# Issue 29013: Three.js: Cleanup in preparation for adding camera viewpoint option

Issue created by migration from https://trac.sagemath.org/ticket/29250

Original creator: paulmasson

Original creation time: 2020-02-27 01:16:15

CC:  egourgoulhon @jcamp0x2a

Keywords: threejs

Before commandeering #29192 to add a new option to set the camera viewpoint, there are several points of cleanup that should be addressed:

1) In the file plot3d/base.pyx the dictionary `js_options` is created a number of lines distant from where options are actually set. This struck me as double maintenance of lists, so I moved creation of this dictionary up in the file and set its entries immediately. This also makes explicit in one spot which options are being sent to the Three.js template.

2) The variable names `aspect_ratio` and `axes_labels` are currently carried over into the Three.js template. Since camel case is more common for JavaScript people, I renamed these in the template.

3) A couple CSS improvements inspired by the current branch of #29192 are included here

4) The data for the viewpoint is overly precise: no one needs ten decimal places to set orientations in a graphic. The numerical values have been rounded to sufficient values.

This cleanup should be merged separately from #29192 for clarity.


---

Comment by paulmasson created at 2020-02-27 01:22:44

Eric, if you have a notebook that stress-test overall options, then please test this ticket with it. I'm quite sure I caught all the options, but a second set of eyes is always useful.

Joshua, after this ticket is merged I'll push a branch to #29192 to add the camera viewpoint setting. Please make sure you have all of your original code before I overwrite the public branch!
----
New commits:


---

Comment by paulmasson created at 2020-02-27 01:22:44

Changing status from new to needs_review.


---

Comment by @jcamp0x2a created at 2020-02-27 01:37:00

Much appreciated, Paul; the `viewpoint` option will be quite nice to have. I've got the original code for the branch so no worries. I'm almost 100% sure I'll have a conflict in plot3d/base.pyx and perhaps elsewhere with my animation work, so I'll rebase off your work before requesting the animation stuff get merged in.


---

Comment by @jcamp0x2a created at 2020-03-02 21:56:27

Just finished testing these changes myself without issue so you have my vote. :) 

One question I do have, though: you added some rounding with the "get viewpoint" data and also removed a space in the resulting string. I'm wondering if maybe someone is feeding this info into a script, program, or database and the formatting changes might break that?


---

Comment by paulmasson created at 2020-03-02 23:12:38

Replying to [comment:4 gh-jcamp0x2a]:
> One question I do have, though: you added some rounding with the "get viewpoint" data and also removed a space in the resulting string. I'm wondering if maybe someone is feeding this info into a script, program, or database and the formatting changes might break that?
The format of the viewpoint data is set by this [tutorial](http://doc.sagemath.org/html/en/thematic_tutorials/geometry/polytope_tikz.html) using tikz. It's all copy and paste right now.


---

Comment by paulmasson created at 2020-03-02 23:20:02

Changing status from needs_review to needs_work.


---

Comment by paulmasson created at 2020-03-02 23:20:02

Need to redo ticket thanks to #21785


---

Comment by git created at 2020-03-03 01:19:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by paulmasson created at 2020-03-03 01:20:31

Changing status from needs_work to needs_review.


---

Comment by paulmasson created at 2020-03-03 01:20:31

Should now be good to go, gentlemen. Please review!


---

Comment by @jcamp0x2a created at 2020-03-03 04:41:12

I went through and tested the various viewer options and the "get viewpoint" menu button again and didn't run into any issues.


---

Comment by paulmasson created at 2020-03-03 23:01:41

Joshua, if you are satisfied with this ticket then enter your full name as a reviewer and set it to positive review.


---

Comment by @jcamp0x2a created at 2020-03-03 23:22:17

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-03-05 23:23:06

Resolution: fixed
