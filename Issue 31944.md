# Issue 31944: RealSet: Faster operations by scan-line (merging) techniques

archive/issues_031944.json:
```json
{
    "body": "CC:  @yuan-zhou\n\nAdapt from:\n- https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/intervals.py\n- https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/fast_piecewise.py\n\nIssue created by migration from https://trac.sagemath.org/ticket/32181\n\n",
    "created_at": "2021-07-11T18:10:41Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "RealSet: Faster operations by scan-line (merging) techniques",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31944",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @yuan-zhou

Adapt from:
- https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/intervals.py
- https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/fast_piecewise.py

Issue created by migration from https://trac.sagemath.org/ticket/32181





---

archive/issue_events_085224.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T02:58:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31944#event-85224"
}
```



---

archive/issue_events_085225.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31944#event-85225"
}
```



---

archive/issue_events_085226.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31944#event-85226"
}
```



---

archive/issue_events_085227.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31944#event-85227"
}
```



---

archive/issue_events_085228.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31944#event-85228"
}
```



---

archive/issue_comments_455879.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-18T21:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455879",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455880.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-26T19:56:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455880",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455881.json:
```json
{
    "body": "If you merge the most current beta (9.7.beta6), you can use https://trac.sagemath.org/wiki/ReleaseTours/sage-9.7#Validatingdocstringwith.sage-tox-erst",
    "created_at": "2022-07-27T07:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455881",
    "user": "https://github.com/mkoeppe"
}
```

If you merge the most current beta (9.7.beta6), you can use https://trac.sagemath.org/wiki/ReleaseTours/sage-9.7#Validatingdocstringwith.sage-tox-erst



---

archive/issue_comments_455882.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-28T19:54:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455882",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455883.json:
```json
{
    "body": "`tox -e relint` will tell you that `EXAMPLE::` should be `EXAMPLES::` according to our style guide (whether there is a single or there are multiple examples)",
    "created_at": "2022-07-28T20:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455883",
    "user": "https://github.com/mkoeppe"
}
```

`tox -e relint` will tell you that `EXAMPLE::` should be `EXAMPLES::` according to our style guide (whether there is a single or there are multiple examples)



---

archive/issue_comments_455884.json:
```json
{
    "body": "The current code does not pass the doc-tests.\nAlso, please follow https://doc.sagemath.org/html/en/developer/coding_basics.html. For example, in the text part, `convex_hull` should be fully-referenced so that it is clickable after build, i.e. :meth:`~sage.sets.real_set.RealSet.convex_hull`",
    "created_at": "2022-07-29T18:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455884",
    "user": "https://github.com/yuan-zhou"
}
```

The current code does not pass the doc-tests.
Also, please follow https://doc.sagemath.org/html/en/developer/coding_basics.html. For example, in the text part, `convex_hull` should be fully-referenced so that it is clickable after build, i.e. :meth:`~sage.sets.real_set.RealSet.convex_hull`



---

archive/issue_comments_455885.json:
```json
{
    "body": "I took a look through the code, but didn't run the code. \nI have some first comments.\n- The patchbot currently shows 31 doctests failures and 4 lint errors. To be fixed!\n- In the docstrings of `_scan_left_endpoint` and `_scan_right_endpoint`: What does an event mean. Reformat the text after output. Describe the value of delta. Include example(s) where tag is given.\n- `RealSet` constructor with option normalized=True. What does this assume? Describe it in the docstring of `__classcall__`  or that of `RealSet`. Mention that is does not apply to the manifold case. Include doctests/tests where normalized=True is given, and examples where arguments are of type `InternalRealInterval`. \n- I have doubts about where `if not normalized` is treated. (But of course, this depends on how you define normalized=True). I thought if normalized=True and it's not of the manifold case (lines 1267-1283), one can just return `UniqueRepresentation.__classcall__(cls, *intervals)` before line 1199 `intervals = []`, which skips all treatments on args. \n- When normalized is not True, may simplify and insert the code in def normalize here, then remove the normalize function as it is only used once here. Alternatively, keep def normalize and move all treatment of args from `__classcall__` to normalize.\n- `RealSet.__classcall__`: Line 1188-1190 change to just: normalized = kwds.pop('normalized', False). L1194: \"... take no keyword arguments other than 'normalized'.\"\" \n- `RealSet._prep`: L1710 elif. L1717 elif\n- `RealSet` doesn't need methods `_scan_left_endpoint` and `_scan_right_endpoint`. These are methods of the class `InternalRealInterval`. \n- `RealSet._scan_interval` Rename the function, to something like `_scan`, or `_scan_intervals`, or `_generate_events`. Rewrite the function: for i in self._intervals: yield i._scan_left_endpoint(tag); yield i._scan_right_endpoint(tag). No more merge/sorting needed.\n- Ideally, all scan methods are generators. Currently, some are generators, some return lists.\n- In `_scan_line_union`, lines 2104-2122, the two while loops look very suspicious to me. I think they do not belong here. Moreover, the lines 2118-2119 in the second while loop might be wrong. You claimed that these two while loops take care of the special cases RealSet(x=-infinity) and RealSet(x<=-infinity), but the input scan to this function should never be in such form. Such empty (nonsense) special cases should already been eliminated in around line 1209 in `__classcall__`\n- In `union_of_realsets` and other similar functions: Lines 2175 to 2178 can be simplified to `scan = merge(RealSet(s)._scan() for s in real_set_collection)`\n- `_scan_line_intersection`. Add more special examples to doctest to cover the cases where intersection is just one point, or just empty. For example:  `[1,2] \u2229 [2,3]`, `[2,3] \u2229 (3,4)`, `(3,4) \u2229 [4,5)`, `[4,5) \u2229 (5,6)`. Lines 2252-2261 (and other similar places) can be simplified to\n\n```\nif now_on:\n  (on_x, on_epsilon) = (x, epsilon) \nelse: \n  if was_on and (on_x, on_epsilon) < (x, epsilon): \n    yield InternalRealInterval(...)\n  (on_x, on_epsilon) = (None, None)\n```\n\n- Questions about 'tag'. It is said to be a real number in the docstrings of many function, but is used as True or False for the difference function only. I think tag can be eliminated throughout the code (and do some special treatment for the difference.) Also, why is it called index at some places? That's not used either, so can be removed as well. On a related note, given a collection of real sets, after generating and merging the their scan, you can no longer match the list of events back to the original real sets, because index was not passed to tag in the events. I do not like the current design. \n- `_scan_line_union`, `_scan_line_intersection`, `_scan_line_symmetric_difference` (and part of `are_pairwise_disjoint`) all look redundant. They all can be replaced by a new method `RealSet._scan_to_intervals(scan, indicator)` that takes scan as a generator of sorted events and indicator as a number 1 or n (or perhaps as a lambda function for `are_pairwise_disjoint`), and outputs a tuple intervals of type InternalRealInterval.\n- According to your ticket description, the old union method is slower than the new one. Is this true for the union of two real sets? If so, why is the old one kept in the code? If not, please update the description of the ticket, and include comments in the code. In general, are there examples where the original method is faster? Please specify the examples, and change the code to choose strategically between the two versions according to the input.\n- `def convex_hull`: correct but wasteful. One does not to sort all intervals, only the left most and right most intervals of each real set matter.\n- `def is_connected` docstring: Return whether ``self`` is a connected set. OUTPUT: Boolean. ``True`` if ``self`` is a single interval.\n- `def are_pairwise_disjoint`: Revise.\n- Throughout the code, (for example in `_scan_line_union` and `_scan_line_intersection` and many other functions,) the docstrings need significant improvements! The current ones make little sense. They are often copy-pasted from other places which do not correspond to the function. Input and output descriptions are not exact, variable undefined, variable mistaken (eg. realsets v.s `real_set_collection`) type not specified, code-style incorrect. Often bad and incomplete examples. `EXAMPLES::` plural. At the beginning of the file, \"Yueqi Li (2022-06-27): ...\" Rephrase to one or two lines. Some places in the docstrings \":meth:`~sage.sets.real_set.RealSet.convex_hull`\"\n- Please make sure that your docstrings follow https://doc.sagemath.org/html/en/developer/coding_basics.html.  \n- Throughout the code: clean up the commented-out code.\n- Throughout the code: :class:`RealInterval` should be :class:`InternalRealInterval`\n- New method: relative closure in a superset?",
    "created_at": "2022-07-30T03:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455885",
    "user": "https://github.com/yuan-zhou"
}
```

I took a look through the code, but didn't run the code. 
I have some first comments.
- The patchbot currently shows 31 doctests failures and 4 lint errors. To be fixed!
- In the docstrings of `_scan_left_endpoint` and `_scan_right_endpoint`: What does an event mean. Reformat the text after output. Describe the value of delta. Include example(s) where tag is given.
- `RealSet` constructor with option normalized=True. What does this assume? Describe it in the docstring of `__classcall__`  or that of `RealSet`. Mention that is does not apply to the manifold case. Include doctests/tests where normalized=True is given, and examples where arguments are of type `InternalRealInterval`. 
- I have doubts about where `if not normalized` is treated. (But of course, this depends on how you define normalized=True). I thought if normalized=True and it's not of the manifold case (lines 1267-1283), one can just return `UniqueRepresentation.__classcall__(cls, *intervals)` before line 1199 `intervals = []`, which skips all treatments on args. 
- When normalized is not True, may simplify and insert the code in def normalize here, then remove the normalize function as it is only used once here. Alternatively, keep def normalize and move all treatment of args from `__classcall__` to normalize.
- `RealSet.__classcall__`: Line 1188-1190 change to just: normalized = kwds.pop('normalized', False). L1194: "... take no keyword arguments other than 'normalized'."" 
- `RealSet._prep`: L1710 elif. L1717 elif
- `RealSet` doesn't need methods `_scan_left_endpoint` and `_scan_right_endpoint`. These are methods of the class `InternalRealInterval`. 
- `RealSet._scan_interval` Rename the function, to something like `_scan`, or `_scan_intervals`, or `_generate_events`. Rewrite the function: for i in self._intervals: yield i._scan_left_endpoint(tag); yield i._scan_right_endpoint(tag). No more merge/sorting needed.
- Ideally, all scan methods are generators. Currently, some are generators, some return lists.
- In `_scan_line_union`, lines 2104-2122, the two while loops look very suspicious to me. I think they do not belong here. Moreover, the lines 2118-2119 in the second while loop might be wrong. You claimed that these two while loops take care of the special cases RealSet(x=-infinity) and RealSet(x<=-infinity), but the input scan to this function should never be in such form. Such empty (nonsense) special cases should already been eliminated in around line 1209 in `__classcall__`
- In `union_of_realsets` and other similar functions: Lines 2175 to 2178 can be simplified to `scan = merge(RealSet(s)._scan() for s in real_set_collection)`
- `_scan_line_intersection`. Add more special examples to doctest to cover the cases where intersection is just one point, or just empty. For example:  `[1,2] ∩ [2,3]`, `[2,3] ∩ (3,4)`, `(3,4) ∩ [4,5)`, `[4,5) ∩ (5,6)`. Lines 2252-2261 (and other similar places) can be simplified to

```
if now_on:
  (on_x, on_epsilon) = (x, epsilon) 
else: 
  if was_on and (on_x, on_epsilon) < (x, epsilon): 
    yield InternalRealInterval(...)
  (on_x, on_epsilon) = (None, None)
```

- Questions about 'tag'. It is said to be a real number in the docstrings of many function, but is used as True or False for the difference function only. I think tag can be eliminated throughout the code (and do some special treatment for the difference.) Also, why is it called index at some places? That's not used either, so can be removed as well. On a related note, given a collection of real sets, after generating and merging the their scan, you can no longer match the list of events back to the original real sets, because index was not passed to tag in the events. I do not like the current design. 
- `_scan_line_union`, `_scan_line_intersection`, `_scan_line_symmetric_difference` (and part of `are_pairwise_disjoint`) all look redundant. They all can be replaced by a new method `RealSet._scan_to_intervals(scan, indicator)` that takes scan as a generator of sorted events and indicator as a number 1 or n (or perhaps as a lambda function for `are_pairwise_disjoint`), and outputs a tuple intervals of type InternalRealInterval.
- According to your ticket description, the old union method is slower than the new one. Is this true for the union of two real sets? If so, why is the old one kept in the code? If not, please update the description of the ticket, and include comments in the code. In general, are there examples where the original method is faster? Please specify the examples, and change the code to choose strategically between the two versions according to the input.
- `def convex_hull`: correct but wasteful. One does not to sort all intervals, only the left most and right most intervals of each real set matter.
- `def is_connected` docstring: Return whether ``self`` is a connected set. OUTPUT: Boolean. ``True`` if ``self`` is a single interval.
- `def are_pairwise_disjoint`: Revise.
- Throughout the code, (for example in `_scan_line_union` and `_scan_line_intersection` and many other functions,) the docstrings need significant improvements! The current ones make little sense. They are often copy-pasted from other places which do not correspond to the function. Input and output descriptions are not exact, variable undefined, variable mistaken (eg. realsets v.s `real_set_collection`) type not specified, code-style incorrect. Often bad and incomplete examples. `EXAMPLES::` plural. At the beginning of the file, "Yueqi Li (2022-06-27): ..." Rephrase to one or two lines. Some places in the docstrings ":meth:`~sage.sets.real_set.RealSet.convex_hull`"
- Please make sure that your docstrings follow https://doc.sagemath.org/html/en/developer/coding_basics.html.  
- Throughout the code: clean up the commented-out code.
- Throughout the code: :class:`RealInterval` should be :class:`InternalRealInterval`
- New method: relative closure in a superset?



---

archive/issue_comments_455886.json:
```json
{
    "body": "Merge-in [SageMath](SageMath) version to 9.7.beta6.\n----\nNew commits:",
    "created_at": "2022-07-30T04:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455886",
    "user": "https://github.com/yuan-zhou"
}
```

Merge-in [SageMath](SageMath) version to 9.7.beta6.
----
New commits:



---

archive/issue_comments_455887.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-31T06:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455887",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455888.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-31T07:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455888",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455889.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-31T13:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455889",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455890.json:
```json
{
    "body": "Replying to [comment:6 gh-NicoleYueqiLi]:\nI rewrote your code according to the remarks in comment:12. Yet to update the docstrings.",
    "created_at": "2022-07-31T13:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455890",
    "user": "https://github.com/yuan-zhou"
}
```

Replying to [comment:6 gh-NicoleYueqiLi]:
I rewrote your code according to the remarks in comment:12. Yet to update the docstrings.



---

archive/issue_comments_455891.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-01T09:58:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455891",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455892.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2022-08-01T10:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455892",
    "user": "https://github.com/yuan-zhou"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_455893.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-01T10:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455893",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455894.json:
```json
{
    "body": "Try merging #34252 to fix the docbuild errors.",
    "created_at": "2022-08-01T10:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455894",
    "user": "https://github.com/yuan-zhou"
}
```

Try merging #34252 to fix the docbuild errors.



---

archive/issue_comments_455895.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2022-08-01T10:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455895",
    "user": "https://github.com/yuan-zhou"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_455896.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-01T10:33:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455896",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455897.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-01T13:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455897",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455898.json:
```json
{
    "body": "As you merged #34252 here, add it to Dependencies in the ticket box",
    "created_at": "2022-08-01T17:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455898",
    "user": "https://github.com/mkoeppe"
}
```

As you merged #34252 here, add it to Dependencies in the ticket box



---

archive/issue_comments_455899.json:
```json
{
    "body": "I think you can unify `RealSet.intersection` and `RealSet.intersection_of_realsets` to just one (non-static) method `RealSet.intersection`.",
    "created_at": "2022-08-01T18:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455899",
    "user": "https://github.com/mkoeppe"
}
```

I think you can unify `RealSet.intersection` and `RealSet.intersection_of_realsets` to just one (non-static) method `RealSet.intersection`.



---

archive/issue_comments_455900.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-01T21:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455900",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455901.json:
```json
{
    "body": "\n```\n-    @staticmethod\n-    def normalize(intervals):\n-        r\"\"\"\n```\n\nThis function is part of the public API, can't just remove",
    "created_at": "2022-08-04T17:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455901",
    "user": "https://github.com/mkoeppe"
}
```


```
-    @staticmethod
-    def normalize(intervals):
-        r"""
```

This function is part of the public API, can't just remove



---

archive/issue_comments_455902.json:
```json
{
    "body": "\n```\n+            # Fastpass: The input is already normalized: Args is a list of\n```\n\nThat should be \"Fast path\"",
    "created_at": "2022-08-04T17:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455902",
    "user": "https://github.com/mkoeppe"
}
```


```
+            # Fastpass: The input is already normalized: Args is a list of
```

That should be "Fast path"



---

archive/issue_comments_455903.json:
```json
{
    "body": "\n```\n+    def is_connected(self):\n+        \"\"\"\n+        Return whether ``self`` is a connected set.\n+\n+        OUTPUT:\n+\n+        Boolean. Whether the normalized form of ``self``\n+        has a single connected component.\n+\n```\n\n\nIn this description, you are mixing talking about ``self`` as a set and its representation as a list of intervals",
    "created_at": "2022-08-04T17:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455903",
    "user": "https://github.com/mkoeppe"
}
```


```
+    def is_connected(self):
+        """
+        Return whether ``self`` is a connected set.
+
+        OUTPUT:
+
+        Boolean. Whether the normalized form of ``self``
+        has a single connected component.
+
```


In this description, you are mixing talking about ``self`` as a set and its representation as a list of intervals



---

archive/issue_comments_455904.json:
```json
{
    "body": "\n```\n             sage: s1.symmetric_difference(s2)\n             (0, 1] \u222a [2, +oo)\n         \"\"\"\n-        other = RealSet(*other)\n-        return self.difference(other).union(other.difference(self))\n+        scan = merge(self._scan(), RealSet(*other)._scan())\n+        intervals = tuple(RealSet._scan_to_intervals(scan, lambda i: bool(i == 1)))\n+        return RealSet(*intervals, normalized=True)\n \n     def contains(self, x):\n```\n\nIs the explicit conversion to `bool` necessary here?",
    "created_at": "2022-08-04T17:27:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455904",
    "user": "https://github.com/mkoeppe"
}
```


```
             sage: s1.symmetric_difference(s2)
             (0, 1] ∪ [2, +oo)
         """
-        other = RealSet(*other)
-        return self.difference(other).union(other.difference(self))
+        scan = merge(self._scan(), RealSet(*other)._scan())
+        intervals = tuple(RealSet._scan_to_intervals(scan, lambda i: bool(i == 1)))
+        return RealSet(*intervals, normalized=True)
 
     def contains(self, x):
```

Is the explicit conversion to `bool` necessary here?



---

archive/issue_comments_455905.json:
```json
{
    "body": "Would it make sense to add the benchmarks mentioned in the ticket description as doctests (can be marked `# not tested` so it does not run automatically)?\n\nThe benchmarks are for complicated real sets with many intervals.\n\nDoes the new implementation have an overhead over the previous implementation that becomes noticeable for simple real sets with 0, 1, 2, or 5 intervals? That's probably the most common case how this class is used. It would be good to include a benchmark for this.",
    "created_at": "2022-08-04T17:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455905",
    "user": "https://github.com/mkoeppe"
}
```

Would it make sense to add the benchmarks mentioned in the ticket description as doctests (can be marked `# not tested` so it does not run automatically)?

The benchmarks are for complicated real sets with many intervals.

Does the new implementation have an overhead over the previous implementation that becomes noticeable for simple real sets with 0, 1, 2, or 5 intervals? That's probably the most common case how this class is used. It would be good to include a benchmark for this.



---

archive/issue_comments_455906.json:
```json
{
    "body": "Thanks for reviewing the ticket! I don't think that the benchmark in the current ticket description makes much sense. I was hoping that Yueqi would be able to provide an updated version and more details soon. \nReplying to [comment:35 mkoeppe]:\n> Would it make sense to add the benchmarks mentioned in the ticket description as doctests (can be marked `# not tested` so it does not run automatically)?\n> \n> The benchmarks are for complicated real sets with many intervals.\n> \n> Does the new implementation have an overhead over the previous implementation that becomes noticeable for simple real sets with 0, 1, 2, or 5 intervals? That's probably the most common case how this class is used. It would be good to include a benchmark for this.\n>",
    "created_at": "2022-08-04T17:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455906",
    "user": "https://github.com/yuan-zhou"
}
```

Thanks for reviewing the ticket! I don't think that the benchmark in the current ticket description makes much sense. I was hoping that Yueqi would be able to provide an updated version and more details soon. 
Replying to [comment:35 mkoeppe]:
> Would it make sense to add the benchmarks mentioned in the ticket description as doctests (can be marked `# not tested` so it does not run automatically)?
> 
> The benchmarks are for complicated real sets with many intervals.
> 
> Does the new implementation have an overhead over the previous implementation that becomes noticeable for simple real sets with 0, 1, 2, or 5 intervals? That's probably the most common case how this class is used. It would be good to include a benchmark for this.
>



---

archive/issue_comments_455907.json:
```json
{
    "body": "I don't quite get it. I thought that a real set is connected iff its normalized form has only one connected component (interval or singleton).\n\nReplying to [comment:33 mkoeppe]:\n> {{{\n> +    def is_connected(self):\n> +        \"\"\"\n> +        Return whether ``self`` is a connected set.\n> +\n> +        OUTPUT:\n> +\n> +        Boolean. Whether the normalized form of ``self``\n> +        has a single connected component.\n> +\n> }}}\n> \n> In this description, you are mixing talking about ``self`` as a set and its representation as a list of intervals\n>",
    "created_at": "2022-08-04T17:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455907",
    "user": "https://github.com/yuan-zhou"
}
```

I don't quite get it. I thought that a real set is connected iff its normalized form has only one connected component (interval or singleton).

Replying to [comment:33 mkoeppe]:
> {{{
> +    def is_connected(self):
> +        """
> +        Return whether ``self`` is a connected set.
> +
> +        OUTPUT:
> +
> +        Boolean. Whether the normalized form of ``self``
> +        has a single connected component.
> +
> }}}
> 
> In this description, you are mixing talking about ``self`` as a set and its representation as a list of intervals
>



---

archive/issue_comments_455908.json:
```json
{
    "body": "Do you mean bool(i==1)? I don't know if it's always needed, but I thought there is nothing wrong to add it.\nReplying to [comment:34 mkoeppe]:\n> {{{\n>              sage: s1.symmetric_difference(s2)\n>              (0, 1] \u222a [2, +oo)\n>          \"\"\"\n> -        other = RealSet(*other)\n> -        return self.difference(other).union(other.difference(self))\n> +        scan = merge(self._scan(), RealSet(*other)._scan())\n> +        intervals = tuple(RealSet._scan_to_intervals(scan, lambda i: bool(i == 1)))\n> +        return RealSet(*intervals, normalized=True)\n>  \n>      def contains(self, x):\n> }}}\n> Is the explicit conversion to `bool` necessary here?",
    "created_at": "2022-08-04T17:47:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455908",
    "user": "https://github.com/yuan-zhou"
}
```

Do you mean bool(i==1)? I don't know if it's always needed, but I thought there is nothing wrong to add it.
Replying to [comment:34 mkoeppe]:
> {{{
>              sage: s1.symmetric_difference(s2)
>              (0, 1] ∪ [2, +oo)
>          """
> -        other = RealSet(*other)
> -        return self.difference(other).union(other.difference(self))
> +        scan = merge(self._scan(), RealSet(*other)._scan())
> +        intervals = tuple(RealSet._scan_to_intervals(scan, lambda i: bool(i == 1)))
> +        return RealSet(*intervals, normalized=True)
>  
>      def contains(self, x):
> }}}
> Is the explicit conversion to `bool` necessary here?



---

archive/issue_comments_455909.json:
```json
{
    "body": "Replying to [comment:37 yzh]:\n> I don't quite get it. I thought that a real set is connected iff its normalized form has only one connected component (interval or singleton).\n\n\"Connected component\" is a property of the set (topological space).\n\n\"Normalized form\" is a list of intervals. There's no such thing as a connected component of a list.",
    "created_at": "2022-08-04T17:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455909",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:37 yzh]:
> I don't quite get it. I thought that a real set is connected iff its normalized form has only one connected component (interval or singleton).

"Connected component" is a property of the set (topological space).

"Normalized form" is a list of intervals. There's no such thing as a connected component of a list.



---

archive/issue_comments_455910.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-04T17:59:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455910",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455911.json:
```json
{
    "body": "Replying to [comment:38 yzh]:\n> Do you mean bool(i==1)? I don't know if it's always needed, but I thought there is nothing wrong to add it.\n\n`i` is just an integer, right? Converting to `bool` is only needed in comparison when you are comparing `SR` elements, which have overloaded comparison operators for forming relational expressions.",
    "created_at": "2022-08-04T18:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455911",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:38 yzh]:
> Do you mean bool(i==1)? I don't know if it's always needed, but I thought there is nothing wrong to add it.

`i` is just an integer, right? Converting to `bool` is only needed in comparison when you are comparing `SR` elements, which have overloaded comparison operators for forming relational expressions.



---

archive/issue_comments_455912.json:
```json
{
    "body": "If you want, you can add a deprecation for the `normalize` method",
    "created_at": "2022-08-04T18:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455912",
    "user": "https://github.com/mkoeppe"
}
```

If you want, you can add a deprecation for the `normalize` method



---

archive/issue_comments_455913.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-04T18:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455913",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455914.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-04T18:08:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455914",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455915.json:
```json
{
    "body": "Here's a microbenchmark:\n\nBefore:\n\n```\nsage: from itertools import count\nsage: c = count()\nsage: %timeit RealSet((0, next(c)))\n82.9 \u00b5s \u00b1 3.75 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10,000 loops each)\nsage: %timeit RealSet((0, next(c))).union([next(c), next(c)])\n210 \u00b5s \u00b1 7.86 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1,000 loops each)\n```\n\n\nWith this ticket:\n\n```\nsage: from itertools import count\nsage: c = count()\nsage: %timeit RealSet((0, next(c)))\n86.2 \u00b5s \u00b1 3.43 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10,000 loops each)\nsage: %timeit RealSet((0, next(c))).union([next(c), next(c)])\n257 \u00b5s \u00b1 18.9 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1,000 loops each)\n```\n",
    "created_at": "2022-08-04T19:04:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455915",
    "user": "https://github.com/mkoeppe"
}
```

Here's a microbenchmark:

Before:

```
sage: from itertools import count
sage: c = count()
sage: %timeit RealSet((0, next(c)))
82.9 µs ± 3.75 µs per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
sage: %timeit RealSet((0, next(c))).union([next(c), next(c)])
210 µs ± 7.86 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
```


With this ticket:

```
sage: from itertools import count
sage: c = count()
sage: %timeit RealSet((0, next(c)))
86.2 µs ± 3.43 µs per loop (mean ± std. dev. of 7 runs, 10,000 loops each)
sage: %timeit RealSet((0, next(c))).union([next(c), next(c)])
257 µs ± 18.9 µs per loop (mean ± std. dev. of 7 runs, 1,000 loops each)
```




---

archive/issue_comments_455916.json:
```json
{
    "body": "Does the overhead look acceptable on the above examples?",
    "created_at": "2022-08-04T19:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455916",
    "user": "https://github.com/yuan-zhou"
}
```

Does the overhead look acceptable on the above examples?



---

archive/issue_comments_455917.json:
```json
{
    "body": "\n```\n     def __init__(self, lower, lower_closed, upper, upper_closed, check=True):\n         \"\"\"\n         Initialize ``self``.\n[...]\n             if (upper_closed and upper == infinity):\n                 raise ValueError('interval cannot be closed at +oo')\n+            # TODO: take care of the empty set case.\n```\n\n\nWhat do you have in mind there?",
    "created_at": "2022-08-04T19:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455917",
    "user": "https://github.com/mkoeppe"
}
```


```
     def __init__(self, lower, lower_closed, upper, upper_closed, check=True):
         """
         Initialize ``self``.
[...]
             if (upper_closed and upper == infinity):
                 raise ValueError('interval cannot be closed at +oo')
+            # TODO: take care of the empty set case.
```


What do you have in mind there?



---

archive/issue_comments_455918.json:
```json
{
    "body": "Somewhere in the original code (__mul__ ?), the empty interval is set to (0, 0)\nReplying to [comment:47 mkoeppe]:\n> {{{\n>      def __init__(self, lower, lower_closed, upper, upper_closed, check=True):\n>          \"\"\"\n>          Initialize ``self``.\n> [...]\n>              if (upper_closed and upper == infinity):\n>                  raise ValueError('interval cannot be closed at +oo')\n> +            # TODO: take care of the empty set case.\n> }}}\n> \n> What do you have in mind there?",
    "created_at": "2022-08-04T19:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455918",
    "user": "https://github.com/yuan-zhou"
}
```

Somewhere in the original code (__mul__ ?), the empty interval is set to (0, 0)
Replying to [comment:47 mkoeppe]:
> {{{
>      def __init__(self, lower, lower_closed, upper, upper_closed, check=True):
>          """
>          Initialize ``self``.
> [...]
>              if (upper_closed and upper == infinity):
>                  raise ValueError('interval cannot be closed at +oo')
> +            # TODO: take care of the empty set case.
> }}}
> 
> What do you have in mind there?



---

archive/issue_comments_455919.json:
```json
{
    "body": "Is this syntax `self.intersection(0,1)` new? Is it really needed?\n\n```\n+        elif len(real_set_collection) == 2:\n+            a, b = real_set_collection\n+            # allow self.intersection(0,1) syntax\n+            try:\n+                a.n()\n+                b.n()\n+                sets.append(RealSet(a, b))\n+            except (AttributeError, ValueError, TypeError):\n+                sets.append(RealSet(a))\n+                sets.append(RealSet(b))\n+        else:\n```\n",
    "created_at": "2022-08-04T21:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455919",
    "user": "https://github.com/mkoeppe"
}
```

Is this syntax `self.intersection(0,1)` new? Is it really needed?

```
+        elif len(real_set_collection) == 2:
+            a, b = real_set_collection
+            # allow self.intersection(0,1) syntax
+            try:
+                a.n()
+                b.n()
+                sets.append(RealSet(a, b))
+            except (AttributeError, ValueError, TypeError):
+                sets.append(RealSet(a))
+                sets.append(RealSet(b))
+        else:
```




---

archive/issue_comments_455920.json:
```json
{
    "body": "I didn't like it either, since the new code spends a lot of effect to take care of that. I wanted to eliminate that. However, the original code allowed for it (contained doctests of that kind).\nReplying to [comment:51 mkoeppe]:\n> Is this syntax `self.intersection(0,1)` new? Is it really needed?\n> {{{\n> +        elif len(real_set_collection) == 2:\n> +            a, b = real_set_collection\n> +            # allow self.intersection(0,1) syntax\n> +            try:\n> +                a.n()\n> +                b.n()\n> +                sets.append(RealSet(a, b))\n> +            except (AttributeError, ValueError, TypeError):\n> +                sets.append(RealSet(a))\n> +                sets.append(RealSet(b))\n> +        else:\n> }}}",
    "created_at": "2022-08-04T21:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455920",
    "user": "https://github.com/yuan-zhou"
}
```

I didn't like it either, since the new code spends a lot of effect to take care of that. I wanted to eliminate that. However, the original code allowed for it (contained doctests of that kind).
Replying to [comment:51 mkoeppe]:
> Is this syntax `self.intersection(0,1)` new? Is it really needed?
> {{{
> +        elif len(real_set_collection) == 2:
> +            a, b = real_set_collection
> +            # allow self.intersection(0,1) syntax
> +            try:
> +                a.n()
> +                b.n()
> +                sets.append(RealSet(a, b))
> +            except (AttributeError, ValueError, TypeError):
> +                sets.append(RealSet(a))
> +                sets.append(RealSet(b))
> +        else:
> }}}



---

archive/issue_comments_455921.json:
```json
{
    "body": "OK, you are right, the old code did allow it. So we have to keep it.",
    "created_at": "2022-08-04T21:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455921",
    "user": "https://github.com/mkoeppe"
}
```

OK, you are right, the old code did allow it. So we have to keep it.



---

archive/issue_comments_455922.json:
```json
{
    "body": "\n``` \n-    def intersection(self, *other):\n+    def intersection(self, *real_set_collection):\n         \"\"\"\n```\n\n\nI think you can simplify it further by making it \n\n```\n     def intersection(*real_set_collection)\n```\n\n\nWhen used as a bound method, `RealSet(1, 3).intersection(RealSet(2, 4))`, the ``self`` would just be the first element of ``real_set_collection``.\n\nBut it could also be used as an unbound method `RealSet.intersection(RealSet(1, 3), RealSet(2,4))`, and you could also handle the case `RealSet.intersection()`, which should give the real line as the intersection over an empty family",
    "created_at": "2022-08-04T21:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455922",
    "user": "https://github.com/mkoeppe"
}
```


``` 
-    def intersection(self, *other):
+    def intersection(self, *real_set_collection):
         """
```


I think you can simplify it further by making it 

```
     def intersection(*real_set_collection)
```


When used as a bound method, `RealSet(1, 3).intersection(RealSet(2, 4))`, the ``self`` would just be the first element of ``real_set_collection``.

But it could also be used as an unbound method `RealSet.intersection(RealSet(1, 3), RealSet(2,4))`, and you could also handle the case `RealSet.intersection()`, which should give the real line as the intersection over an empty family



---

archive/issue_comments_455923.json:
```json
{
    "body": "(Just a suggestion, it's fine as it)",
    "created_at": "2022-08-04T21:44:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455923",
    "user": "https://github.com/mkoeppe"
}
```

(Just a suggestion, it's fine as it)



---

archive/issue_comments_455924.json:
```json
{
    "body": "Replying to [comment:46 yzh]:\n> Does the overhead look acceptable on the above examples?\n\nYes, I think it's fine.\n\nMy guess is that it could be improved by a custom version of heapq with a fast path for near-trivial cases, or even cythonized.\n\nLet's keep this for a possible follow-up ticket.",
    "created_at": "2022-08-04T21:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455924",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:46 yzh]:
> Does the overhead look acceptable on the above examples?

Yes, I think it's fine.

My guess is that it could be improved by a custom version of heapq with a fast path for near-trivial cases, or even cythonized.

Let's keep this for a possible follow-up ticket.



---

archive/issue_comments_455925.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-04T21:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455925",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_455926.json:
```json
{
    "body": "That's a good suggestion, but I incline to leave it as is on this ticket. The reason is the treatments for special cases such as `RealSet.union(RealSet(0,1)), RealSet.union((0,1)), RealSet.union(0, 1), and RealSet(0,1).union(1, 3)==RealSet.union(RealSet(0,1), 1, 3)` could be too complicated at the moment. Will discuss the deprecation of the use of `RealSet(0,1).union(1, 3)` on another ticket later.\nReplying to [comment:54 mkoeppe]:\n> {{{ \n> -    def intersection(self, *other):\n> +    def intersection(self, *real_set_collection):\n>          \"\"\"\n> }}}\n> \n> I think you can simplify it further by making it \n> {{{\n>      def intersection(*real_set_collection)\n> }}}\n> \n> When used as a bound method, `RealSet(1, 3).intersection(RealSet(2, 4))`, the ``self`` would just be the first element of ``real_set_collection``.\n> \n> But it could also be used as an unbound method `RealSet.intersection(RealSet(1, 3), RealSet(2,4))`, and you could also handle the case `RealSet.intersection()`, which should give the real line as the intersection over an empty family \n> \n>",
    "created_at": "2022-08-04T21:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455926",
    "user": "https://github.com/yuan-zhou"
}
```

That's a good suggestion, but I incline to leave it as is on this ticket. The reason is the treatments for special cases such as `RealSet.union(RealSet(0,1)), RealSet.union((0,1)), RealSet.union(0, 1), and RealSet(0,1).union(1, 3)==RealSet.union(RealSet(0,1), 1, 3)` could be too complicated at the moment. Will discuss the deprecation of the use of `RealSet(0,1).union(1, 3)` on another ticket later.
Replying to [comment:54 mkoeppe]:
> {{{ 
> -    def intersection(self, *other):
> +    def intersection(self, *real_set_collection):
>          """
> }}}
> 
> I think you can simplify it further by making it 
> {{{
>      def intersection(*real_set_collection)
> }}}
> 
> When used as a bound method, `RealSet(1, 3).intersection(RealSet(2, 4))`, the ``self`` would just be the first element of ``real_set_collection``.
> 
> But it could also be used as an unbound method `RealSet.intersection(RealSet(1, 3), RealSet(2,4))`, and you could also handle the case `RealSet.intersection()`, which should give the real line as the intersection over an empty family 
> 
>



---

archive/issue_comments_455927.json:
```json
{
    "body": "Thank you! Replying to [comment:57 mkoeppe]:",
    "created_at": "2022-08-04T21:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455927",
    "user": "https://github.com/yuan-zhou"
}
```

Thank you! Replying to [comment:57 mkoeppe]:



---

archive/issue_comments_455928.json:
```json
{
    "body": "Should `def normalize(intervals)` be `@`staticmethod",
    "created_at": "2022-08-05T16:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455928",
    "user": "https://github.com/yuan-zhou"
}
```

Should `def normalize(intervals)` be `@`staticmethod



---

archive/issue_comments_455929.json:
```json
{
    "body": "Never mind. Without `@`staticmethod, the following can apply.\n\n```\nsage: r = RealSet(RealSet(2, 6)[0], RealSet(4, 10)[0], normalized=True)\nsage: r\n(2, 6) \u222a (4, 10)\nsage: r.normalize()\n((2, 10),)\n```\n\n\nReplying to [comment:60 yzh]:\n> Should `def normalize(intervals)` be `@`staticmethod",
    "created_at": "2022-08-05T16:51:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455929",
    "user": "https://github.com/yuan-zhou"
}
```

Never mind. Without `@`staticmethod, the following can apply.

```
sage: r = RealSet(RealSet(2, 6)[0], RealSet(4, 10)[0], normalized=True)
sage: r
(2, 6) ∪ (4, 10)
sage: r.normalize()
((2, 10),)
```


Replying to [comment:60 yzh]:
> Should `def normalize(intervals)` be `@`staticmethod



---

archive/issue_events_085229.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-08-06T07:44:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31944#event-85229"
}
```



---

archive/issue_comments_455930.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-06T07:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31944",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31944#issuecomment-455930",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
