# Issue 21657: Do not compare dictionaries which might contain caches

archive/issues_021657.json:
```json
{
    "body": "The following is a common pattern in implementations of `__cmp__` or `__eq__`:\n\n```\nsage: search_src(\"cmp\\(self.__dict__,\")\ndoctest/control.py:139:        return cmp(self.__dict__,other.__dict__)\ndoctest/parsing.py:458:        return cmp(self.__dict__, other.__dict__)\ndoctest/sources.py:152:        return cmp(self.__dict__, other.__dict__)\ndoctest/util.py:193:        return cmp(self.__dict__, other.__dict__)\nsage: search_src(\"__dict__ == \")\ncategories/poor_man_map.py:93:        return self.__class__ is other.__class__ and self.__dict__ == other.__dict__\ncombinat/dlx.py:142:        return self.__dict__ == other.__dict__\ncombinat/knutson_tao_puzzles.py:586:            return self.__dict__ == other.__dict__\ngeometry/toric_plotter.py:264:        return type(self) is type(other) and self.__dict__ == other.__dict__\nmisc/misc.py:1611:        return self.__class__ == other.__class__ and self.__dict__ == other.__dict__\nmodules/with_basis/morphism.py:334:        return self.__class__ is other.__class__ and parent(self) == parent(other) and self.__dict__ == other.__dict__\nmodules/with_basis/morphism.py:1474:        return self.__class__ is other.__class__ and self.__dict__ == other.__dict__\n```\n\nThis fails as soon as `self` has a ``@`cached_method`:\n\n* Instances that would be considered equal but have different elements in their cache are not detected as being equal anymore.\n* A pickle contains a `PickledMethod` which is not considered the same as the `CachedMethodCaller(NoArgs)` in the original object.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21894\n\n",
    "created_at": "2016-11-18T04:29:57Z",
    "labels": [
        "component: pickling",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Do not compare dictionaries which might contain caches",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21657",
    "user": "https://github.com/saraedum"
}
```
The following is a common pattern in implementations of `__cmp__` or `__eq__`:

```
sage: search_src("cmp\(self.__dict__,")
doctest/control.py:139:        return cmp(self.__dict__,other.__dict__)
doctest/parsing.py:458:        return cmp(self.__dict__, other.__dict__)
doctest/sources.py:152:        return cmp(self.__dict__, other.__dict__)
doctest/util.py:193:        return cmp(self.__dict__, other.__dict__)
sage: search_src("__dict__ == ")
categories/poor_man_map.py:93:        return self.__class__ is other.__class__ and self.__dict__ == other.__dict__
combinat/dlx.py:142:        return self.__dict__ == other.__dict__
combinat/knutson_tao_puzzles.py:586:            return self.__dict__ == other.__dict__
geometry/toric_plotter.py:264:        return type(self) is type(other) and self.__dict__ == other.__dict__
misc/misc.py:1611:        return self.__class__ == other.__class__ and self.__dict__ == other.__dict__
modules/with_basis/morphism.py:334:        return self.__class__ is other.__class__ and parent(self) == parent(other) and self.__dict__ == other.__dict__
modules/with_basis/morphism.py:1474:        return self.__class__ is other.__class__ and self.__dict__ == other.__dict__
```

This fails as soon as `self` has a ``@`cached_method`:

* Instances that would be considered equal but have different elements in their cache are not detected as being equal anymore.
* A pickle contains a `PickledMethod` which is not considered the same as the `CachedMethodCaller(NoArgs)` in the original object.

Issue created by migration from https://trac.sagemath.org/ticket/21894





---

archive/issue_comments_300453.json:
```json
{
    "body": "See #19820 for the module morphism.",
    "created_at": "2016-11-18T06:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21657#issuecomment-300453",
    "user": "https://github.com/tscrim"
}
```

See #19820 for the module morphism.



---

archive/issue_comments_300454.json:
```json
{
    "body": "Thanks for pointing that one out.",
    "created_at": "2016-11-18T21:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21657#issuecomment-300454",
    "user": "https://github.com/saraedum"
}
```

Thanks for pointing that one out.
