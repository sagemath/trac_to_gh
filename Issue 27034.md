# Issue 27034: spkg-configure.m4 for ecm

Issue created by migration from https://trac.sagemath.org/ticket/27271

Original creator: dimpase

Original creation time: 2019-02-13 10:22:53

CC:  embray fbissey

Keywords: spkg-configure

it needs gmp, and is not a dependency of anything (besides sagelib)


---

Comment by embray created at 2019-03-25 10:56:15

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)


---

Comment by dimpase created at 2019-03-28 11:34:30

Changing status from new to needs_review.


---

Comment by dimpase created at 2019-03-28 11:34:30

checking the version by grepping the header, duh...
----
Last 10 new commits:


---

Comment by embray created at 2019-03-29 16:23:11

Does this really depend on #27212?  I ask just because it's not clear to me exactly how, and this might be useful on its own as well.


---

Comment by dimpase created at 2019-03-29 16:31:21

Replying to [comment:3 embray]:
> Does this really depend on #27212?  I ask just because it's not clear to me exactly how, and this might be useful on its own as well.

gmp/mpir is a dependency of ecm! (and so not using system's gmp/mpir and using the system's gmp/mpir for ecm would lead to a lot of linking/loading "fun" with sagelib)


---

Comment by embray created at 2019-03-29 16:34:21

As for the contents of the `ecm/spkg-configure.m4` itself, it looks fine to me at first glance, an I trust you've tested it.

A slightly more "sophisticated" approach might be build a test program which prints the value of the version, but in this case it's simple enough that just grepping for it should be good enough.


---

Comment by dimpase created at 2019-03-29 16:36:39

I am going to submit an upstream patch to get a pkg-config configuration for ecm
(more or less the same INRIA upstream accepted such patch for gf2x, so this will make this much easier, once in).


---

Comment by embray created at 2019-03-29 16:36:52

Replying to [comment:4 dimpase]:
> Replying to [comment:3 embray]:
> > Does this really depend on #27212?  I ask just because it's not clear to me exactly how, and this might be useful on its own as well.
> 
> gmp/mpir is a dependency of ecm! (and so not using system's gmp/mpir and using the system's gmp/mpir for ecm would lead to a lot of linking/loading "fun" with sagelib)

I see.  In that case (and we still need a generic way to do this but I think it's tricky), the `ecm/spkg-configure.m4` should do


```
AC_REQUIRE([SAGE_SPKG_CONFIGURE_GMP])
```


and then refuse to use the system package if `sage_spkg_install_mpir = yes` or `sage_spkg_install_gmp = yes`.


---

Comment by dimpase created at 2019-03-29 19:32:47

OK, so the latter applies to other tickets that have #27212 as a dependence.


---

Comment by git created at 2019-05-19 09:01:08

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2019-05-19 09:05:39

rebased over 8.8.beta5 and added the missing test. Can be reviewed now.


---

Comment by dimpase created at 2019-05-26 07:04:17

also need to check for `ecm` executable. Something like

```
$ echo 121 | ecm  4 | grep "GMP-ECM"
GMP-ECM 7.0.4 [configured with GMP 6.1.2, --enable-asm-redc] [ECM]
```



---

Comment by dimpase created at 2019-05-26 07:04:17

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-05-28 12:37:10

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2019-05-28 12:38:32

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2019-05-28 12:38:32

needs review again.


---

Comment by embray created at 2019-05-31 15:36:49

Not sure if it's related to this ticket or not (it wouldn't be caused by it as it hasn't had positive_review yet, but I mean it might be relevant), but I'm seeing some problems on Cygwin with the ECM `make check` test suite, which I don't think I had problems with before (I did not list ECM in #22866).

I think I might still need to go ahead and make building MPIR a requirement on Cygwin for now anyways.  I'll try to investigate this once I can to a state where everything else isn't broken :(


---

Comment by git created at 2019-06-11 11:37:16

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2019-06-11 11:37:41

rebased oved 8.8.rc0


---

Comment by embray created at 2019-07-03 11:37:56

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).


---

Comment by isuruf created at 2019-07-21 04:33:34

Picks up the conda package correctly.


---

Comment by isuruf created at 2019-07-21 04:33:34

Changing status from needs_review to positive_review.


---

Comment by git created at 2019-07-22 18:40:16

Changing status from positive_review to needs_review.


---

Comment by git created at 2019-07-22 18:40:16

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:


---

Comment by dimpase created at 2019-07-22 18:41:01

rebased over Sage 8.9.beta3, just in case.


---

Comment by dimpase created at 2019-07-22 18:41:01

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-07-26 20:27:30

Resolution: fixed
