# Issue 12707: TestSuite failures for HeckeModule Homsets

archive/issues_012707.json:
```json
{
    "body": "Assignee: craigcitro\n\nCC:  tscrim mderickx cremona davidloeffler jonhanke\n\nAdding a Testsuite run in #12876 in the documentation of\nsage.categories.hecke_modules.HeckeModules.ParentMethods._Hom_\nrevealed the following bug:\n\n```\nsage: M = ModularForms(Gamma0(7), 4)\nsage: H = Hom(M); H\nsage: H.zero()\nTraceback (most recent call last):\n  File \"<ipython console>\", line 1, in <module>\n  File \"cachefunc.pyx\", line 1397, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (sage/misc/cachefunc.c:7026)\n  File \"/opt/sage-5.0.beta11/local/lib/python2.7/site-packages/sage/categories/modules.py\", line 221, in zero\n    From: Free module generated by {1, 2, 3} over Integer Ring\n  File \"/opt/sage-5.0.beta11/local/lib/python2.7/site-packages/sage/modular/hecke/homspace.py\", line 111, in __call__\n    return morphism.HeckeModuleMorphism_matrix(self, A, name)\n  File \"/opt/sage-5.0.beta11/local/lib/python2.7/site-packages/sage/modular/hecke/morphism.py\", line 116, in __init__\n    MatrixMorphism.__init__(self, parent, A)\n  File \"/opt/sage-5.0.beta11/local/lib/python2.7/site-packages/sage/modules/matrix_morphism.py\", line 1191, in __init__\n    parent.codomain().rank())(A)\n  File \"/opt/sage-5.0.beta11/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py\", line 543, in __call__\n    return self.matrix(entries, copy=copy, coerce=coerce, rows=rows)\n  File \"/opt/sage-5.0.beta11/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py\", line 1372, in matrix\n    return self.__matrix_class(self, entries=x, copy=copy, coerce=coerce)\n  File \"matrix_rational_dense.pyx\", line 205, in sage.matrix.matrix_rational_dense.Matrix_rational_dense.__init__ (sage/matrix/matrix_rational_dense.c:5788)\nTypeError: entries must be coercible to a list or integer\n```\n\n\n`TestSuite(H).run()` also fails for \"_test_elements\".\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12879\n\n",
    "created_at": "2012-04-25T00:25:30Z",
    "labels": [
        "modular forms",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "TestSuite failures for HeckeModule Homsets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12707",
    "user": "nthiery"
}
```
Assignee: craigcitro

CC:  tscrim mderickx cremona davidloeffler jonhanke

Adding a Testsuite run in #12876 in the documentation of
sage.categories.hecke_modules.HeckeModules.ParentMethods._Hom_
revealed the following bug:

```
sage: M = ModularForms(Gamma0(7), 4)
sage: H = Hom(M); H
sage: H.zero()
Traceback (most recent call last):
  File "<ipython console>", line 1, in <module>
  File "cachefunc.pyx", line 1397, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (sage/misc/cachefunc.c:7026)
  File "/opt/sage-5.0.beta11/local/lib/python2.7/site-packages/sage/categories/modules.py", line 221, in zero
    From: Free module generated by {1, 2, 3} over Integer Ring
  File "/opt/sage-5.0.beta11/local/lib/python2.7/site-packages/sage/modular/hecke/homspace.py", line 111, in __call__
    return morphism.HeckeModuleMorphism_matrix(self, A, name)
  File "/opt/sage-5.0.beta11/local/lib/python2.7/site-packages/sage/modular/hecke/morphism.py", line 116, in __init__
    MatrixMorphism.__init__(self, parent, A)
  File "/opt/sage-5.0.beta11/local/lib/python2.7/site-packages/sage/modules/matrix_morphism.py", line 1191, in __init__
    parent.codomain().rank())(A)
  File "/opt/sage-5.0.beta11/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py", line 543, in __call__
    return self.matrix(entries, copy=copy, coerce=coerce, rows=rows)
  File "/opt/sage-5.0.beta11/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py", line 1372, in matrix
    return self.__matrix_class(self, entries=x, copy=copy, coerce=coerce)
  File "matrix_rational_dense.pyx", line 205, in sage.matrix.matrix_rational_dense.Matrix_rational_dense.__init__ (sage/matrix/matrix_rational_dense.c:5788)
TypeError: entries must be coercible to a list or integer
```


`TestSuite(H).run()` also fails for "_test_elements".


Issue created by migration from https://trac.sagemath.org/ticket/12879





---

archive/issue_comments_152027.json:
```json
{
    "body": "Nicolas suggested to me to move this from #12876 to here. I found the following steps needed:\n\n* Make `HeckeModule_generic` inherit from `UniqueRepresentation`. I guess it was for a reason that William did not always want modular forms being cached (there *is* a cache, but it isn't always used). Since nowadays the cache has weak keys, it shouldn't be so bad. I'll ask on sage-nt.\n* Provide the Hecke homsets with a `__reduce__` method, so that (after the Hecke modules being unique) the homsets are identical.\n* Provide the Hecke homsets with an `Element` attribute, and let the constructors return instances of the `element_class`. Note that there is only *one* type of morphisms being returned, hence, having a default element class absolutely makes sense.\n* It was impossible to override the custom `__call__` method of Hecke homsets by a proper `_element_construtor_`, since there is yet another custon `__call__` method up in the class hierarchy.\n* Provide the Hecke homsets with a `zero()` method - the default one wouldn't work.\n* Provide the Hecke homsets with an `_an_element_` method. The idea is: Domain and codomain have a known dimension, and the morphisms are given by matrices anyway. Hence, I construct the corresponding matrix space (which I made a lazy attribute to the Hecke homsets), take `an_element` from the matrix space, and return the corresponding morphism.\n\nWith that approach, I get\n\n```\n        sage -t  -force_lib devel/sage/sage/modular/modsym/ambient.py # 1 doctests failed\n        sage -t  -force_lib devel/sage/sage/modular/abvar/homspace.py # 1 doctests failed\n        sage -t  -force_lib devel/sage/sage/modular/modform/constructor.py # 3 doctests failed\n        sage -t  -force_lib devel/sage/sage/modular/quatalg/brandt.py # 3 doctests failed\n        sage -t  -force_lib devel/sage/sage/modular/hecke/ambient_module.py # 2 doctests failed\n        sage -t  -force_lib devel/sage/sage/modular/modsym/modsym.py # 2 doctests failed\n        sage -t  -force_lib devel/sage/sage/modular/abvar/homology.py # 9 doctests failed\n        sage -t  -force_lib devel/sage/sage/modular/modform/hecke_operator_on_qexp.py # 2 doctests failed\n```\n\nwhich isn't so bad, because most of them fail due to new class names from the category framework.\n\nSuggestion: I provide a small reviewer patch at #12876 making the `TestSuite` skip more tests, and then a proper solution will be dealt with here.",
    "created_at": "2012-08-29T07:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152027",
    "user": "SimonKing"
}
```

Nicolas suggested to me to move this from #12876 to here. I found the following steps needed:

* Make `HeckeModule_generic` inherit from `UniqueRepresentation`. I guess it was for a reason that William did not always want modular forms being cached (there *is* a cache, but it isn't always used). Since nowadays the cache has weak keys, it shouldn't be so bad. I'll ask on sage-nt.
* Provide the Hecke homsets with a `__reduce__` method, so that (after the Hecke modules being unique) the homsets are identical.
* Provide the Hecke homsets with an `Element` attribute, and let the constructors return instances of the `element_class`. Note that there is only *one* type of morphisms being returned, hence, having a default element class absolutely makes sense.
* It was impossible to override the custom `__call__` method of Hecke homsets by a proper `_element_construtor_`, since there is yet another custon `__call__` method up in the class hierarchy.
* Provide the Hecke homsets with a `zero()` method - the default one wouldn't work.
* Provide the Hecke homsets with an `_an_element_` method. The idea is: Domain and codomain have a known dimension, and the morphisms are given by matrices anyway. Hence, I construct the corresponding matrix space (which I made a lazy attribute to the Hecke homsets), take `an_element` from the matrix space, and return the corresponding morphism.

With that approach, I get

```
        sage -t  -force_lib devel/sage/sage/modular/modsym/ambient.py # 1 doctests failed
        sage -t  -force_lib devel/sage/sage/modular/abvar/homspace.py # 1 doctests failed
        sage -t  -force_lib devel/sage/sage/modular/modform/constructor.py # 3 doctests failed
        sage -t  -force_lib devel/sage/sage/modular/quatalg/brandt.py # 3 doctests failed
        sage -t  -force_lib devel/sage/sage/modular/hecke/ambient_module.py # 2 doctests failed
        sage -t  -force_lib devel/sage/sage/modular/modsym/modsym.py # 2 doctests failed
        sage -t  -force_lib devel/sage/sage/modular/abvar/homology.py # 9 doctests failed
        sage -t  -force_lib devel/sage/sage/modular/modform/hecke_operator_on_qexp.py # 2 doctests failed
```

which isn't so bad, because most of them fail due to new class names from the category framework.

Suggestion: I provide a small reviewer patch at #12876 making the `TestSuite` skip more tests, and then a proper solution will be dealt with here.



---

archive/issue_comments_152028.json:
```json
{
    "body": "Replying to [comment:1 SimonKing]:\n> which isn't so bad, because most of them fail due to new class names from the category framework.\n\nSorry, that was wrong. More nasty errors happen as well.",
    "created_at": "2012-08-29T07:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152028",
    "user": "SimonKing"
}
```

Replying to [comment:1 SimonKing]:
> which isn't so bad, because most of them fail due to new class names from the category framework.

Sorry, that was wrong. More nasty errors happen as well.



---

archive/issue_comments_152029.json:
```json
{
    "body": "Here is one particularly nasty thing. I stored some objects involved in errors. Reloading them, I find the following in a patched version (as suggested above):\n\n```\nsage: A = load(\"/home/king/SAGE/work/categories/modformA\")\nsage: B = load(\"/home/king/SAGE/work/categories/modformB\")\nsage: A\nModular Symbols space of dimension 3 and level 5, weight 7, character [i], sign 1, over Number Field in c with defining polynomial x^2 - 402*i over its base field\nsage: B\nModular Symbols space of dimension 3 and level 5, weight 7, character [i], sign 1, over Number Field in i with defining polynomial x^2 + 1\nsage: A.boundary_space().dimension()\n0\nsage: K.<i> = QuadraticField(-1)\nsage: x = polygen(K); L.<c> = K.extension(x^2 - 402*i)\nsage: chi = DirichletGroup(5, K).gen(0)\nsage: N = Newforms(chi, 7, base_ring = L)\nsage: Newforms(chi, 7, names='a')\nTraceback (most recent call last):\n...\nTypeError: Unable to coerce x (=[-1]\n[-1]  \n[-1]) to a morphism in Set of Morphisms from Modular Symbols space of dimension 3 and level 5, weight 7, character [i], sign 1, over Number Field in i with defining polynomial x^2 + 1 to Boundary Modular Symbols space of level 5, weight 7, character [i] and dimension 1 over Number Field in c with defining polynomial x^2 - 402*i over its base field in Category of commutative additive groups\nsage: A.boundary_space().dimension()\n1\n```\n\nHence, `A.boundary_space()` used to be of dimension zero, but during the computation, it is turned into dimension one!\n\nThat does not happen without the patch:\n\n```\nsage: A = load(\"/home/king/SAGE/work/categories/modformA\")\nsage: B = load(\"/home/king/SAGE/work/categories/modformB\")\nsage: A.boundary_space().dimension()\n0\nsage: K.<i> = QuadraticField(-1)\nsage: x = polygen(K); L.<c> = K.extension(x^2 - 402*i)\nsage: chi = DirichletGroup(5, K).gen(0)\nsage: N = Newforms(chi, 7, base_ring = L)\nsage: Newforms(chi, 7, names='a')\n[q + a0*q^2 + (i*a0 - 5*i + 5)*q^3 + ((-5*i - 5)*a0 + 24*i)*q^4 + ((10*i - 5)*a0 - 40*i - 55)*q^5 + O(q^6)]\nsage: A.boundary_space().dimension()\n0\n```\n\n\nFurther digging reveals: `A.boundary_space().dimension()` is indeed *not* constant! It relies on a list of known generators, that may grow. But with my patch, the homset assumes that the dimensions are constant. Bad me.",
    "created_at": "2012-08-29T12:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152029",
    "user": "SimonKing"
}
```

Here is one particularly nasty thing. I stored some objects involved in errors. Reloading them, I find the following in a patched version (as suggested above):

```
sage: A = load("/home/king/SAGE/work/categories/modformA")
sage: B = load("/home/king/SAGE/work/categories/modformB")
sage: A
Modular Symbols space of dimension 3 and level 5, weight 7, character [i], sign 1, over Number Field in c with defining polynomial x^2 - 402*i over its base field
sage: B
Modular Symbols space of dimension 3 and level 5, weight 7, character [i], sign 1, over Number Field in i with defining polynomial x^2 + 1
sage: A.boundary_space().dimension()
0
sage: K.<i> = QuadraticField(-1)
sage: x = polygen(K); L.<c> = K.extension(x^2 - 402*i)
sage: chi = DirichletGroup(5, K).gen(0)
sage: N = Newforms(chi, 7, base_ring = L)
sage: Newforms(chi, 7, names='a')
Traceback (most recent call last):
...
TypeError: Unable to coerce x (=[-1]
[-1]  
[-1]) to a morphism in Set of Morphisms from Modular Symbols space of dimension 3 and level 5, weight 7, character [i], sign 1, over Number Field in i with defining polynomial x^2 + 1 to Boundary Modular Symbols space of level 5, weight 7, character [i] and dimension 1 over Number Field in c with defining polynomial x^2 - 402*i over its base field in Category of commutative additive groups
sage: A.boundary_space().dimension()
1
```

Hence, `A.boundary_space()` used to be of dimension zero, but during the computation, it is turned into dimension one!

That does not happen without the patch:

```
sage: A = load("/home/king/SAGE/work/categories/modformA")
sage: B = load("/home/king/SAGE/work/categories/modformB")
sage: A.boundary_space().dimension()
0
sage: K.<i> = QuadraticField(-1)
sage: x = polygen(K); L.<c> = K.extension(x^2 - 402*i)
sage: chi = DirichletGroup(5, K).gen(0)
sage: N = Newforms(chi, 7, base_ring = L)
sage: Newforms(chi, 7, names='a')
[q + a0*q^2 + (i*a0 - 5*i + 5)*q^3 + ((-5*i - 5)*a0 + 24*i)*q^4 + ((10*i - 5)*a0 - 40*i - 55)*q^5 + O(q^6)]
sage: A.boundary_space().dimension()
0
```


Further digging reveals: `A.boundary_space().dimension()` is indeed *not* constant! It relies on a list of known generators, that may grow. But with my patch, the homset assumes that the dimensions are constant. Bad me.



---

archive/issue_comments_152030.json:
```json
{
    "body": "No, that didn't help.",
    "created_at": "2012-08-29T12:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152030",
    "user": "SimonKing"
}
```

No, that didn't help.



---

archive/issue_comments_152031.json:
```json
{
    "body": "Replying to [comment:4 SimonKing]:\n> No, that didn't help.\n\nBah, unless you personnaly need this ticket to be fixed, you can just leave it to the number theory people. That's their problem :-)\n\n+1 on the short reviewer patch on #12876\n\nCheers,\n                                    Nicolas",
    "created_at": "2012-08-29T12:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152031",
    "user": "nthiery"
}
```

Replying to [comment:4 SimonKing]:
> No, that didn't help.

Bah, unless you personnaly need this ticket to be fixed, you can just leave it to the number theory people. That's their problem :-)

+1 on the short reviewer patch on #12876

Cheers,
                                    Nicolas



---

archive/issue_comments_152032.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-27T08:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152032",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_152033.json:
```json
{
    "body": "Here is a try. Not perfect, but better than right now.\n----\nNew commits:",
    "created_at": "2017-07-27T08:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152033",
    "user": "chapoton"
}
```

Here is a try. Not perfect, but better than right now.
----
New commits:



---

archive/issue_comments_152034.json:
```json
{
    "body": "bot is morally green, please review",
    "created_at": "2017-07-27T17:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152034",
    "user": "chapoton"
}
```

bot is morally green, please review



---

archive/issue_comments_152035.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-28T17:00:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152035",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_152036.json:
```json
{
    "body": "LGTM. At least there is nothing in the documentation that seems to put a restriction on what the matrices could be.",
    "created_at": "2017-07-28T17:00:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152036",
    "user": "tscrim"
}
```

LGTM. At least there is nothing in the documentation that seems to put a restriction on what the matrices could be.



---

archive/issue_comments_152037.json:
```json
{
    "body": "Oh, I did not think about that. Indeed, these Hecke modules are modules, so there are some operators that should act in a compatible way on both domain and codomain. Maybe we should not implement this \"naive\" version of an_element, which is probably not correct.",
    "created_at": "2017-07-28T18:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152037",
    "user": "chapoton"
}
```

Oh, I did not think about that. Indeed, these Hecke modules are modules, so there are some operators that should act in a compatible way on both domain and codomain. Maybe we should not implement this "naive" version of an_element, which is probably not correct.



---

archive/issue_comments_152038.json:
```json
{
    "body": "Well, there is no real documentation or checks in the code on this AFAICS. So as far as it is specified, any matrix will work. Perhaps also cc some number theory people to get their opinion?",
    "created_at": "2017-07-29T06:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152038",
    "user": "tscrim"
}
```

Well, there is no real documentation or checks in the code on this AFAICS. So as far as it is specified, any matrix will work. Perhaps also cc some number theory people to get their opinion?



---

archive/issue_comments_152039.json:
```json
{
    "body": "To specialists of modular forms and symbols, do you agree with the proposed implementation of \"an_element\" for the space of Hecke module morphisms ? In short, we just take a random matrix, and declare that it is a morphism, which seems dubious.",
    "created_at": "2017-07-29T06:45:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152039",
    "user": "chapoton"
}
```

To specialists of modular forms and symbols, do you agree with the proposed implementation of "an_element" for the space of Hecke module morphisms ? In short, we just take a random matrix, and declare that it is a morphism, which seems dubious.



---

archive/issue_comments_152040.json:
```json
{
    "body": "No, since it does not take into account that Hecke module are modules over some Hecke algebra. So indeed as you say earlier, morphisms should commute with the action of the Hecke operators on both sides. I think creating a valid nonzero element (if it exists, which is very often not the case) is something that is not trivial to implement. So I would maybe always just return the zero morphism. If domain and codomain are equal you could do something like `_.hecke_operator(2)` if you want a more typical element.",
    "created_at": "2017-07-29T09:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152040",
    "user": "mderickx"
}
```

No, since it does not take into account that Hecke module are modules over some Hecke algebra. So indeed as you say earlier, morphisms should commute with the action of the Hecke operators on both sides. I think creating a valid nonzero element (if it exists, which is very often not the case) is something that is not trivial to implement. So I would maybe always just return the zero morphism. If domain and codomain are equal you could do something like `_.hecke_operator(2)` if you want a more typical element.



---

archive/issue_comments_152041.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-07-29T09:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152041",
    "user": "chapoton"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_152042.json:
```json
{
    "body": "ok, thanks",
    "created_at": "2017-07-29T09:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152042",
    "user": "chapoton"
}
```

ok, thanks



---

archive/issue_comments_152043.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-29T09:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152043",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_152044.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-29T09:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152044",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_152045.json:
```json
{
    "body": "done, please review.\n----\nNew commits:",
    "created_at": "2017-07-29T09:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152045",
    "user": "chapoton"
}
```

done, please review.
----
New commits:



---

archive/issue_comments_152046.json:
```json
{
    "body": "I also looked at the code in `__call__`, and the part that handles the case that A is an element of the basing only makes sense if the domain and codomain are actually the same space! If A is in the base ring but the domain and the codomain are unequal we should throw an Error.\n----\nNew commits:",
    "created_at": "2017-07-29T09:58:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152046",
    "user": "mderickx"
}
```

I also looked at the code in `__call__`, and the part that handles the case that A is an element of the basing only makes sense if the domain and codomain are actually the same space! If A is in the base ring but the domain and the codomain are unequal we should throw an Error.
----
New commits:



---

archive/issue_comments_152047.json:
```json
{
    "body": "The call of identity matrix will raise an error if the dimensions are not the same. Do you want an explicit check that domain == codomain ?",
    "created_at": "2017-07-29T10:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152047",
    "user": "chapoton"
}
```

The call of identity matrix will raise an error if the dimensions are not the same. Do you want an explicit check that domain == codomain ?



---

archive/issue_comments_152048.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-29T11:22:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152048",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_152049.json:
```json
{
    "body": "`@`vbraun Why the bump to 8.2?",
    "created_at": "2017-07-30T17:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152049",
    "user": "tscrim"
}
```

`@`vbraun Why the bump to 8.2?



---

archive/issue_comments_152050.json:
```json
{
    "body": "Hi Sorry for not reacting earlier. I see that you added the explicit check for `domain == codomain` which is good! It is possible to construct hecke modules which have noting to do with each other that still have the same rank. And then asking for the identity matrix makes no sense, since it is a linear map that sends whichever basis we computed for the first space to a basis we computed for the second space, and since the basis are quite random so is the map. In particular it will rarely be a hecke module morphism.",
    "created_at": "2017-08-13T21:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152050",
    "user": "mderickx"
}
```

Hi Sorry for not reacting earlier. I see that you added the explicit check for `domain == codomain` which is good! It is possible to construct hecke modules which have noting to do with each other that still have the same rank. And then asking for the identity matrix makes no sense, since it is a linear map that sends whichever basis we computed for the first space to a basis we computed for the second space, and since the basis are quite random so is the map. In particular it will rarely be a hecke module morphism.



---

archive/issue_comments_152051.json:
```json
{
    "body": "I've looked at the code and I can give a positive review on the mathematical content of this ticket. I have no Idea what all the `TestSuite` stuff is about. So is there someone else who can say that that part makes sense?",
    "created_at": "2017-08-13T21:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152051",
    "user": "mderickx"
}
```

I've looked at the code and I can give a positive review on the mathematical content of this ticket. I have no Idea what all the `TestSuite` stuff is about. So is there someone else who can say that that part makes sense?



---

archive/issue_comments_152052.json:
```json
{
    "body": "`@`mderickx `TestSuite` runs a bunch of \"standard\" tests on the object (i.e., all of the `_test_*` methods of an object) as a consistency check. Also, if you add your (real) name to the reviewers.\n\n`@`chapoton I believe we are now claiming it passes the `TestSuite`, so I think we should explicitly add that as a doctest.",
    "created_at": "2017-08-14T01:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152052",
    "user": "tscrim"
}
```

`@`mderickx `TestSuite` runs a bunch of "standard" tests on the object (i.e., all of the `_test_*` methods of an object) as a consistency check. Also, if you add your (real) name to the reviewers.

`@`chapoton I believe we are now claiming it passes the `TestSuite`, so I think we should explicitly add that as a doctest.



---

archive/issue_comments_152053.json:
```json
{
    "body": "no, the TestSuite still does not pass:\n\n```\n  The following tests failed: _test_category\nFailure in _test_elements\nThe following tests failed: _test_elements\n```\n",
    "created_at": "2017-08-20T06:48:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152053",
    "user": "chapoton"
}
```

no, the TestSuite still does not pass:

```
  The following tests failed: _test_category
Failure in _test_elements
The following tests failed: _test_elements
```




---

archive/issue_comments_152054.json:
```json
{
    "body": "Is it possible to get more verbose output?",
    "created_at": "2017-08-20T12:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152054",
    "user": "mderickx"
}
```

Is it possible to get more verbose output?



---

archive/issue_comments_152055.json:
```json
{
    "body": "oh, well, this says\n\n```\n  Running the test suite of self.an_element()\n  running ._test_category() . . . fail\n  Traceback (most recent call last):\n    File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py\", line 293, in run\n      test_method(tester = tester)\n    File \"sage/structure/element.pyx\", line 687, in sage.structure.element.Element._test_category (/home/chapoton/sage/src/build/cythonized/sage/structure/element.c:6380)\n      tester.assert_(isinstance(self, self.parent().category().element_class))\n    File \"/home/chapoton/sage/local/lib/python2.7/unittest/case.py\", line 422, in assertTrue\n      raise self.failureException(msg)\n  AssertionError: False is not true\n```\n",
    "created_at": "2017-08-20T13:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152055",
    "user": "chapoton"
}
```

oh, well, this says

```
  Running the test suite of self.an_element()
  running ._test_category() . . . fail
  Traceback (most recent call last):
    File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py", line 293, in run
      test_method(tester = tester)
    File "sage/structure/element.pyx", line 687, in sage.structure.element.Element._test_category (/home/chapoton/sage/src/build/cythonized/sage/structure/element.c:6380)
      tester.assert_(isinstance(self, self.parent().category().element_class))
    File "/home/chapoton/sage/local/lib/python2.7/unittest/case.py", line 422, in assertTrue
      raise self.failureException(msg)
  AssertionError: False is not true
```




---

archive/issue_comments_152056.json:
```json
{
    "body": "That is a common issue for Homsets because of it creating elements that are not specifically an instance of its unique `Element` class. Currently, we don't have the infastructure to really work around this.\n\nCould we add a `TestSuite` that skips the `_test_elements` (this is done for other Homsets too)?",
    "created_at": "2017-08-20T16:40:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152056",
    "user": "tscrim"
}
```

That is a common issue for Homsets because of it creating elements that are not specifically an instance of its unique `Element` class. Currently, we don't have the infastructure to really work around this.

Could we add a `TestSuite` that skips the `_test_elements` (this is done for other Homsets too)?



---

archive/issue_comments_152057.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-20T17:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152057",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_152058.json:
```json
{
    "body": "done",
    "created_at": "2017-08-20T17:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152058",
    "user": "chapoton"
}
```

done



---

archive/issue_comments_152059.json:
```json
{
    "body": "Thank you.",
    "created_at": "2017-08-20T18:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152059",
    "user": "tscrim"
}
```

Thank you.



---

archive/issue_comments_152060.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-20T18:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152060",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_152061.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-08-26T09:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12707#issuecomment-152061",
    "user": "vbraun"
}
```

Resolution: fixed
