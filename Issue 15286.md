# Issue 15286: Clean up interface to the PARI library, III

Issue created by migration from https://trac.sagemath.org/ticket/15523

Original creator: jdemeyer

Original creation time: 2013-12-16 10:58:48

CC:  pbruin




---

Comment by git created at 2013-12-16 16:46:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pbruin created at 2013-12-16 19:06:04

With a terminal size of 80 columns, one doctest fails (PARI inserts a line break and the next line is filtered out because it does not contain "syntax error"):

```
File "src/sage/libs/pari/gen_py.py", line 63, in sage.libs.pari.gen_py.pari
Failed example:
    pari(v)
Expected:
    Traceback (most recent call last):
    ...
    PariError: syntax error, unexpected ')', expecting )-> or ',': ...00000000,5.60000000000000)
Got:
    <BLANKLINE>
    Traceback (most recent call last):
    ...
    PariError: syntax error, unexpected ')', expecting )-> or ',':
```



---

Comment by jdemeyer created at 2013-12-16 19:58:23

Agreed. Perhaps we should set flag `gpd_TEST` in `GPDATA->flags`.


---

Comment by pbruin created at 2013-12-16 21:23:46

That seems to be the easiest solution for now.  Is is possible/useful to do this only when doctesting?

Anyway, once we move to PARI >= 2.6, we can use the new function `pari_err2str()`, which should give us a nicer (terminal-independent) way to get the error message than parsing `stderr`.


---

Comment by jdemeyer created at 2013-12-17 11:26:29

Replying to [comment:11 pbruin]:
> That seems to be the easiest solution for now.  Is is possible/useful to do this only when doctesting?
Possible, yes. Useful, I doubt it. I prefer code to not behave differently when doctesting.


---

Comment by git created at 2013-12-17 11:26:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-12-17 14:57:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-12-17 15:22:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2013-12-17 15:25:35

Changing status from new to needs_review.


---

Comment by pbruin created at 2013-12-18 15:36:23

Looks good.  There is one point where I don't understand your patch and where I would make the following change:

```diff
diff --git a/src/sage/libs/pari/gen_py.py b/src/sage/libs/pari/gen_py.py
index 29aae82..c0efe22 100644
--- a/src/sage/libs/pari/gen_py.py
+++ b/src/sage/libs/pari/gen_py.py
@@ -53,8 +53,8 @@ def pari(x):
         sage: pari.set_real_precision(15)
         35
 
-    Conversion from matrices is supported, but not from vectors or tuples;
-    use lists instead::
+    Conversion from matrices is supported, but not from vectors;
+    use lists or tuples instead::
 
         sage: a = pari(matrix(2,3,[1,2,3,4,5,6])); a, a.type()
         ([1, 2, 3; 4, 5, 6], 't_MAT')
@@ -66,6 +66,8 @@ def pari(x):
         PariError: syntax error, unexpected ')', expecting )-> or ','
         sage: b = pari(list(v)); b,b.type()
         ([1.20000000000000, 3.40000000000000, 5.60000000000000], 't_VEC')
+        sage: b = pari(tuple(v)); b, b.type()
+        ([1.20000000000000, 3.40000000000000, 5.60000000000000], 't_VEC')
 
     Some more exotic examples::
 
```

Or are there other tuples that aren't converted correctly?

Apart from that, positive review.


---

Comment by git created at 2013-12-18 16:17:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2013-12-18 16:23:01

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2013-12-20 22:52:27

Resolution: fixed
