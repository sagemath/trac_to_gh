# Issue 15286: Clean up interface to the PARI library, III

archive/issues_015286.json:
```json
{
    "body": "CC:  @pjbruin\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/15523\n\n",
    "created_at": "2013-12-16T10:58:48Z",
    "labels": [
        "component: interfaces"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "Clean up interface to the PARI library, III",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15286",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @pjbruin



Issue created by migration from https://trac.sagemath.org/ticket/15523





---

archive/issue_comments_196375.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-16T16:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15286#issuecomment-196375",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_196376.json:
```json
{
    "body": "With a terminal size of 80 columns, one doctest fails (PARI inserts a line break and the next line is filtered out because it does not contain \"syntax error\"):\n\n```\nFile \"src/sage/libs/pari/gen_py.py\", line 63, in sage.libs.pari.gen_py.pari\nFailed example:\n    pari(v)\nExpected:\n    Traceback (most recent call last):\n    ...\n    PariError: syntax error, unexpected ')', expecting )-> or ',': ...00000000,5.60000000000000)\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n    ...\n    PariError: syntax error, unexpected ')', expecting )-> or ',':\n```\n",
    "created_at": "2013-12-16T19:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15286#issuecomment-196376",
    "user": "https://github.com/pjbruin"
}
```

With a terminal size of 80 columns, one doctest fails (PARI inserts a line break and the next line is filtered out because it does not contain "syntax error"):

```
File "src/sage/libs/pari/gen_py.py", line 63, in sage.libs.pari.gen_py.pari
Failed example:
    pari(v)
Expected:
    Traceback (most recent call last):
    ...
    PariError: syntax error, unexpected ')', expecting )-> or ',': ...00000000,5.60000000000000)
Got:
    <BLANKLINE>
    Traceback (most recent call last):
    ...
    PariError: syntax error, unexpected ')', expecting )-> or ',':
```




---

archive/issue_comments_196377.json:
```json
{
    "body": "Agreed. Perhaps we should set flag `gpd_TEST` in `GPDATA->flags`.",
    "created_at": "2013-12-16T19:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15286#issuecomment-196377",
    "user": "https://github.com/jdemeyer"
}
```

Agreed. Perhaps we should set flag `gpd_TEST` in `GPDATA->flags`.



---

archive/issue_comments_196378.json:
```json
{
    "body": "That seems to be the easiest solution for now.  Is is possible/useful to do this only when doctesting?\n\nAnyway, once we move to PARI >= 2.6, we can use the new function `pari_err2str()`, which should give us a nicer (terminal-independent) way to get the error message than parsing `stderr`.",
    "created_at": "2013-12-16T21:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15286#issuecomment-196378",
    "user": "https://github.com/pjbruin"
}
```

That seems to be the easiest solution for now.  Is is possible/useful to do this only when doctesting?

Anyway, once we move to PARI >= 2.6, we can use the new function `pari_err2str()`, which should give us a nicer (terminal-independent) way to get the error message than parsing `stderr`.



---

archive/issue_comments_196379.json:
```json
{
    "body": "Replying to [comment:11 pbruin]:\n> That seems to be the easiest solution for now.  Is is possible/useful to do this only when doctesting?\nPossible, yes. Useful, I doubt it. I prefer code to not behave differently when doctesting.",
    "created_at": "2013-12-17T11:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15286#issuecomment-196379",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 pbruin]:
> That seems to be the easiest solution for now.  Is is possible/useful to do this only when doctesting?
Possible, yes. Useful, I doubt it. I prefer code to not behave differently when doctesting.



---

archive/issue_comments_196380.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-17T11:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15286#issuecomment-196380",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_196381.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-17T14:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15286#issuecomment-196381",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_196382.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-17T15:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15286#issuecomment-196382",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_196383.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-17T15:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15286#issuecomment-196383",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_196384.json:
```json
{
    "body": "Looks good.  There is one point where I don't understand your patch and where I would make the following change:\n\n```diff\ndiff --git a/src/sage/libs/pari/gen_py.py b/src/sage/libs/pari/gen_py.py\nindex 29aae82..c0efe22 100644\n--- a/src/sage/libs/pari/gen_py.py\n+++ b/src/sage/libs/pari/gen_py.py\n@@ -53,8 +53,8 @@ def pari(x):\n         sage: pari.set_real_precision(15)\n         35\n \n-    Conversion from matrices is supported, but not from vectors or tuples;\n-    use lists instead::\n+    Conversion from matrices is supported, but not from vectors;\n+    use lists or tuples instead::\n \n         sage: a = pari(matrix(2,3,[1,2,3,4,5,6])); a, a.type()\n         ([1, 2, 3; 4, 5, 6], 't_MAT')\n@@ -66,6 +66,8 @@ def pari(x):\n         PariError: syntax error, unexpected ')', expecting )-> or ','\n         sage: b = pari(list(v)); b,b.type()\n         ([1.20000000000000, 3.40000000000000, 5.60000000000000], 't_VEC')\n+        sage: b = pari(tuple(v)); b, b.type()\n+        ([1.20000000000000, 3.40000000000000, 5.60000000000000], 't_VEC')\n \n     Some more exotic examples::\n \n```\n\nOr are there other tuples that aren't converted correctly?\n\nApart from that, positive review.",
    "created_at": "2013-12-18T15:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15286#issuecomment-196384",
    "user": "https://github.com/pjbruin"
}
```

Looks good.  There is one point where I don't understand your patch and where I would make the following change:

```diff
diff --git a/src/sage/libs/pari/gen_py.py b/src/sage/libs/pari/gen_py.py
index 29aae82..c0efe22 100644
--- a/src/sage/libs/pari/gen_py.py
+++ b/src/sage/libs/pari/gen_py.py
@@ -53,8 +53,8 @@ def pari(x):
         sage: pari.set_real_precision(15)
         35
 
-    Conversion from matrices is supported, but not from vectors or tuples;
-    use lists instead::
+    Conversion from matrices is supported, but not from vectors;
+    use lists or tuples instead::
 
         sage: a = pari(matrix(2,3,[1,2,3,4,5,6])); a, a.type()
         ([1, 2, 3; 4, 5, 6], 't_MAT')
@@ -66,6 +66,8 @@ def pari(x):
         PariError: syntax error, unexpected ')', expecting )-> or ','
         sage: b = pari(list(v)); b,b.type()
         ([1.20000000000000, 3.40000000000000, 5.60000000000000], 't_VEC')
+        sage: b = pari(tuple(v)); b, b.type()
+        ([1.20000000000000, 3.40000000000000, 5.60000000000000], 't_VEC')
 
     Some more exotic examples::
 
```

Or are there other tuples that aren't converted correctly?

Apart from that, positive review.



---

archive/issue_comments_196385.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-18T16:17:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15286#issuecomment-196385",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_196386.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-18T16:23:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15286#issuecomment-196386",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_196387.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-20T22:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15286#issuecomment-196387",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_045346.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-12-20T22:52:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15286",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15286#event-45346"
}
```
