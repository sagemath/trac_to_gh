# Issue 13895: Adding Method for testing avoidance in posets

Issue created by migration from Trac.

Original creator: chrisjamesberg

Original creation time: 2013-02-12 01:43:51

Assignee: rowland

CC:  chrisjamesberg ahmorales saliola ncohen nthiery hivert

Keywords: posets

This is a test for finite posets to check if the do not have induced posets each of which isomorphic to two disjoint chains. Example 3+1 free, 2+2 free.


---

Comment by ncohen created at 2013-02-13 12:53:23

Could you be interested in running this method on the transitive closure of your poset ? 

http://www.sagemath.org/doc/reference/sage/graphs/generic_graph.html#sage.graphs.generic_graph.GenericGraph.subgraph_search

Nathann


---

Comment by chrisjamesberg created at 2013-02-13 15:46:12

apply: poset_functionality_14099_er.patch


---

Comment by rowland created at 2013-02-13 16:22:11

Is the transitive closure + subgraph_search fast enough to make it worthwhile?


---

Comment by ncohen created at 2013-02-13 16:24:32

> Is the transitive closure + subgraph_search fast enough to make it worthwhile?

Well... It is sligthly smarter than what you do (it would not enumerate all chains of length 'n' beginning with an element v, if this element v is comparable with an element of the chain of length 'm' you already picked) and it is implemented in Cython.

I'd say that it's definitely worth a try.

Nathann


---

Comment by rowland created at 2013-02-13 20:47:46

apply: poset_functionality_14099_er.patch


---

Comment by rowland created at 2013-02-14 01:26:40

I don't think subgraph_search answers the same question....

Using induced=True results in the poset Poset({0 : [], 1 : [2], 2 : [3]}) which is 3+1 being (3+1)-free:


```
# g is the transitive closure
sage: g = DiGraph({0 : [], 1 : [2, 3], 2 : [3]})
sage: g.subgraph_search(DiGraph({0 : [1], 1 : [2]}) + DiGraph({0 : []}), induced=True)
```


Using induced=False results in the poset Poset({0 : [1, 2], 2 : [3]}) which is (3+1)-free containing (3+1):


```
# g is the transitive closure
sage: g = DiGraph({0 : [1, 2, 3], 2 : [3]})
sage: g.subgraph_search(DiGraph({0 : [1], 1 : [2]}) + DiGraph({0 : []}), induced=False)
Subgraph of (): Digraph on 4 vertices
```



---

Comment by ncohen created at 2013-02-14 08:10:15

you definitely need to use `induced = True`, but not on the digraphs. As I said you need to work on their transitive closure :


```
def test(g,n,m):
    n = 3
    m = 1
    pattern = digraphs.Circuit(n+1); pattern.delete_vertex(n)
    pattern += digraphs.Circuit(m+1); pattern.delete_vertex(n+m-1)
    c = g.transitive_closure().subgraph_search(pattern.transitive_closure(), induced = True)
    if c:
      print "Pattern found with chains", c.connected_components()
    else:
      print "No pattern in this graph"

g = DiGraph({0 : [], 1 : [2, 3], 2 : [3]})
test(g,3,1)
```


Nathann


---

Comment by rowland created at 2013-02-14 16:06:24

Yes, you are right; it seems to work.  It doesn't seem to be any faster for posets on 7 elements, but perhaps it's worth having both options available.


```
sage: def test1(poset, m, n):
....:     for mchain in poset.chains().elements_of_depth_iterator(m):
....:         for nchain in poset.chains().elements_of_depth_iterator(n):
....:             if all(poset.compare_elements(x, y) is None for x in mchain for y in nchain):
....:                 return False
....:     return True
....: 
sage: %time len([p for p in Posets(7) if test1(p, 3, 1)])
CPU times: user 22.46 s, sys: 0.03 s, total: 22.49 s
Wall time: 22.49 s
639
```



```
sage: def test2(poset, m, n):
....:     relations = poset.relations()
....:     g = DiGraph([rel for rel in relations if rel[0] != rel[1]])
....:     g.add_vertices([rel[0] for rel in relations if rel[0] == rel[1]])
....:     mchain = digraphs.Circuit(m+1)
....:     mchain.delete_vertex(m)
....:     nchain = digraphs.Circuit(n+1)
....:     nchain.delete_vertex(n)
....:     return g.transitive_closure().subgraph_search((mchain + nchain).transitive_closure(), induced = True) is None
....: 
sage: %time len([p for p in Posets(7) if test2(p, 3, 1)])
CPU times: user 23.47 s, sys: 0.01 s, total: 23.48 s
Wall time: 23.48 s
639
```



---

Comment by rowland created at 2013-02-14 16:21:06

On the other hand, for larger posets using the graph search does much better:


```
sage: posets = [Posets.RandomPoset(30, .5) for x in range(10)]
sage: %time len([p for p in posets if test1(p, 3, 1)])
CPU times: user 20.69 s, sys: 0.00 s, total: 20.69 s
Wall time: 20.69 s
6
sage: %time len([p for p in posets if test2(p, 3, 1)])
CPU times: user 0.19 s, sys: 0.00 s, total: 0.19 s
Wall time: 0.19 s
6
```



---

Comment by rowland created at 2013-02-14 16:21:06

Changing keywords from "posets" to "posets, days45".


---

Comment by ncohen created at 2013-02-14 19:27:34

I just created ticket #14122 because of this ticket.

With that ticket, the following code 

```
mchain = digraphs.Circuit(m+1)
mchain.delete_vertex(m)
nchain = digraphs.Circuit(n+1)
nchain.delete_vertex(n)
return g.transitive_closure().subgraph_search((mchain + nchain).transitive_closure(), induced = True) is None
```

can be replaced by 

```
twochains = digraphs.Tournament(n) + digraphs.Tournament(m)
return g.transitive_closure().subgraph_search(twochains, induced = True) is None
```


Nathann


---

Comment by rowland created at 2013-02-14 22:29:21

Changing status from new to needs_review.


---

Attachment


---

Comment by ncohen created at 2013-02-15 09:31:41

As #14122 just got reviewed, could you rebase your patch on top of it and use the Tournament cnstructor ? `:-)`

By the way, could your merge your two functions into only one ? It would accept a list as a parameter and run the "real code" if the list has length one, and call itself on each pair of the list when it has a larger length.


Nathann


---

Comment by rowland created at 2013-02-15 14:26:49

What is the advantage of merging them into one?  The disadvantage is a decrease in clarity.


---

Comment by ncohen created at 2013-02-15 14:47:56

> What is the advantage of merging them into one?  The disadvantage is a decrease in clarity.

One advantage is that you only have to write documentation and doctests for only one function instead of two, and documentation and doctests are actually the largest part of this patch. Then 50% of the actual code is only there to deal with the input and not actual computations. If you want to improve clarity, you can also dramatically decrease the tests you do at the beginning. Something like that :


```
def i_take_lists_of_pairs_or_just_a_pair_as_input(u,v=None):
    if v is None:
        return all(i_take_lists_of_pairs_or_just_a_pair_as_input(*x) for x in u)
    u,v = Integer(u), Integer(v)
    if u<0 or v<0:
        raise ValueError("Both elements of a pair must be positive integers") 
    # No I can do some actual computations
    print u,v
    return True
```


But honestly I think that only one method (taking a pair as input) should exist in Sage. To me the rest is "personal code".

Nathann


---

Comment by ncohen created at 2013-02-24 16:21:13

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2013-02-24 16:21:13

#14122 has been merged into beta1.

Nathann


---

Comment by rowland created at 2013-05-29 20:57:05

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2013-05-31 18:36:23

instruction for the bot:

Apply poset_functionality_14099-er.patch


---

Comment by chapoton created at 2013-05-31 19:02:06

I also think that only the method taking a pair of numbers should go into sage.

You can now use the TransitiveTournament method, it works for n=1.


---

Comment by rowland created at 2013-06-17 08:10:11

This is now rebased on #14536.

Awaiting review.


---

Comment by rowland created at 2013-06-17 15:00:45

Changing keywords from "posets, days45" to "posets, days45, days49".


---

Comment by ncohen created at 2013-06-19 07:35:04

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2013-06-19 07:35:04

Helloooooooooooooooooooooo !!

* Could you add your new method to the index of methods at the top of the file ? This way we have a nice list of everything that the posets can do
  http://www.sagemath.org/doc/reference/combinat/sage/combinat/posets/posets.html
* Could you rewrite your reference so that Sphinx understands it ? You have an example there :
  {{{
  sage: Graph.average_distance??
  }}}
* Why do you build the digraph from the relations, instead of using the Hasse Diagram ? I thought that this is how it was done in an earlier version of the patch `O_o`

Nathann


---

Comment by rowland created at 2013-06-19 09:37:49

Changing status from needs_work to needs_review.


---

Comment by rowland created at 2013-06-19 09:37:49

I have no idea what Sphinx is.


---

Comment by ncohen created at 2013-06-19 09:43:05

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2013-06-19 09:43:05

It is the piece of code that generates the html documentation of Sage.


```
sage -b && sage -docbuild reference/combinat html
```


Nathann


---

Comment by rowland created at 2013-06-19 10:18:43

Changing status from needs_work to needs_review.


---

Comment by chrisjamesberg created at 2013-06-19 10:21:28

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2013-06-19 12:47:46

Changing status from positive_review to needs_work.


---

Comment by ncohen created at 2013-06-19 12:47:46

`O_o`

Nathann


---

Comment by ncohen created at 2013-06-19 12:53:08

Could you please rewrite the reference to `[Stanley, Enumerative Combinatorics Volume 1, 2nd edition]` in the usual Sphinx format, or explain why you think that it is a bad idea ?

Nathann


---

Comment by rowland created at 2013-06-19 13:59:07

Anything else?


---

Comment by rowland created at 2013-06-19 13:59:07

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2013-06-19 14:00:18

`O_O`


---

Comment by ncohen created at 2013-06-19 14:00:56

Okayyyyyyyyyyyyyyyyyyyyyyyy I see ......


---

Comment by rowland created at 2013-06-19 14:04:58

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2013-06-19 14:06:02

No way.


---

Comment by ncohen created at 2013-06-19 14:06:28

I am currently writing an additional patch for this bibliographical reference.

I will upload it shortly.

Nathann


---

Comment by ncohen created at 2013-06-19 14:06:39

Changing status from positive_review to needs_work.


---

Comment by ncohen created at 2013-06-19 14:16:15

Here is a patch that rewrites the reference to Stanley's book as we usually do in Sphinx, and as it is done in ``Graph.average_distance??`` and other functions.

I don't know why you set the ticket to `positive_review` twice even though the guy who was doing the review (=me) never said that he agreed with it. I don't get why Chris set it to positive review while there was a comment which had not been fixed either. Anyway, I think that this small [attachment:trac_14099-rev.patch] patch has to be added to this ticket too, unless you can explain why you prefer it to be left out.

Nathann


---

Comment by ncohen created at 2013-06-19 14:16:15

Changing status from needs_work to needs_review.


---

Comment by rowland created at 2013-06-19 14:37:48

I set the ticket to positive review, once, after I asked if there was anything else and you said "Okayyyyyyyyyyyyyyyyyyyyyyyy I see ......" which I took to mean that everything was okay.

Chris set it to positive review after I addressed your latest comment, which was not specific at all.  I improved the typesetting of the variables.  Apparently this was not what you had in mind, but you hadn't said that.

You need to be more clear in your communication with people who are learning how to contribute.  At this point I am tired of making point modifications every time you think something should be changed, so please just finish the patch up yourself as you want it.


---

Comment by chrisjamesberg created at 2013-06-20 12:38:23

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-06-20 14:59:18

The patches need proper commit messages (use `hg qrefresh -e` for that).


---

Attachment


---

Comment by jdemeyer created at 2013-07-24 07:31:35

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2013-07-24 07:31:35

The reviewer patch needs a proper commit message, use `hg qrefresh -e` for this.


---

Attachment


---

Comment by ncohen created at 2013-07-24 07:39:04

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2013-07-31 12:54:50

Resolution: fixed
