# Issue 20460: Inheritance structure of generic projective/affine curves

Issue created by migration from https://trac.sagemath.org/ticket/20697

Original creator: gjorgenson

Original creation time: 2016-05-27 19:41:16

CC:  mmarco bhutz

Currently there exist classes for generic projective/affine space and plane curves, but the plane curve classes do not inherit from the respective space curve classes. Adding this inheritance will facilitate the implementation of future generic curve functionality.


---

Comment by git created at 2016-05-28 04:04:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by gjorgenson created at 2016-05-28 04:18:39

Changing status from new to needs_review.


---

Comment by bhutz created at 2016-05-29 13:14:25

Changing status from needs_review to needs_info.


---

Comment by bhutz created at 2016-05-29 13:14:25

I do not see anything wrong with the new inheritance structure, but I don't really understand the naming conventions of the classes.  Here is what I see

AffineSpaceCurve, ProjectiveSpaceCurve = the generic curves classes

AffineCurve_generic, ProjectiveCurve_generic - the curves that must lie in the plane (A2 or P2).

That seems somewhat odd to me. If I've understood this correctly doesn't some naming convention like

AffineCurve_generic, ProjectiveCurve_generic -> XXXXCurve_plane

AffineSpaceCurve, ProjectiveSpaceCurve -? XXXXCurve_generic

make more sense. Then the special class inherits from the 'generic' class instead of the other way around.

Also, it seems like some description should be added to the documentation for all of these classes.


---

Comment by gjorgenson created at 2016-05-29 16:32:44

Replying to [comment:4 bhutz]:

I think that would be a good renaming. I didn't try to implement a name change earlier because changing the ProjectiveCurve_generic class name would require changing it when referenced in the elliptic curve, conic, and hyperelliptic curve classes. I actually don't think that would be so bad; I'll try changing the names and see how much needs to be done.

Perhaps at some point it would be good to change the folder name as well, since the eventually the generic curve classes will have more functionality for general curves.


---

Comment by mmarco created at 2016-05-29 17:41:34

We should discuss this change of names in sage-devel too, since it might affect the public interface (i.e. it could break user's code).


---

Comment by bhutz created at 2016-05-29 20:34:06

If we're changing names, I'd rather change them all at once, so include the folder in the post to sage-devel. Perhaps either curves or curves_generic?


---

Comment by git created at 2016-05-31 04:13:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-05-31 07:25:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by gjorgenson created at 2016-05-31 07:34:45

Okay, I've made an attempt to change the class names and folder name. I think I've changed all occurrences of the names, and so far everything seems to be working properly.


---

Comment by gjorgenson created at 2016-05-31 07:34:45

Changing status from needs_info to needs_review.


---

Comment by bhutz created at 2016-05-31 22:30:18

functionality seems fine, but I'd like to see a description of the classes and some examples in each of the files

- affine_curve
- projective_curve
- curve

For example look at the beginning of the projective_space.py file.


---

Comment by bhutz created at 2016-05-31 22:30:18

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-06-01 21:39:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by gjorgenson created at 2016-06-01 21:44:30

I added some documentation to the beginning of affine_curve and projective_curve, and to the `__init__` functions. The string labels for the curves no longer matched the class names, so I changed that as well (I had to change some examples in a few other files in the scheme folder to do this).


---

Comment by gjorgenson created at 2016-06-01 21:44:30

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2016-06-02 01:00:26

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2016-06-02 01:00:26

minor: notice that it is possible to define curves over general rings since the init just calls the suscheme init. So you should remove the "over fields" part of the class title for projective and affine curves.


from src/sage/structure/sage_object.pyx
pickle failure: It looks like you are going to need to do a register_unpickle_override for projective curves.

```
    ImportError: cannot import ProjectiveCurve_generic from sage.schemes.plane_curves.projective_curve, call register_unpickle_override('sage.schemes.plane_curves.projective_curve', 'ProjectiveCurve_generic', ...) to fix this
    Failed:
    _class__sage_schemes_jacobians_abstract_jacobian_Jacobian_generic__.sobj
    ----------------------------------------------------------------------
    ** This error is probably due to an old pickle failing to unpickle.
    ** See sage.structure.sage_object.register_unpickle_override for
    ** how to override the default unpickling methods for (old) pickles.
    ** NOTE: pickles should never be removed from the pickle_jar! 
    ----------------------------------------------------------------------
    Successfully unpickled 585 objects.
    Failed to unpickle 1 objects.
```



---

Comment by git created at 2016-06-02 02:09:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by gjorgenson created at 2016-06-02 02:12:48

Changing status from needs_work to needs_review.


---

Comment by gjorgenson created at 2016-06-02 02:12:48

Alright, I followed what was done in `affine_space.py` for addressing the pickle issue, and I think it worked.


---

Comment by git created at 2016-06-02 06:01:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by gjorgenson created at 2016-06-02 06:03:48

Oops, I neglected to do a full doctest until now, and found a few examples I missed in the tutorials that were broken because of the string representation changes for curves. Everything else seems to be okay.


---

Comment by bhutz created at 2016-06-02 14:40:56

make ptestlong now passes


---

Comment by bhutz created at 2016-06-02 14:40:56

Changing keywords from "" to "gsoc2016".


---

Comment by bhutz created at 2016-06-02 14:40:56

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-06-03 17:52:43

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-06-03 17:52:43


```
sage -t --long src/sage/schemes/projective/projective_morphism.py
**********************************************************************
File "src/sage/schemes/projective/projective_morphism.py", line 835, in sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.dynatomic_polynomial
Failed example:
    f.dynatomic_polynomial(2)
Exception raised:
    Traceback (most recent call last):
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.dynatomic_polynomial[69]>", line 1, in <module>
        f.dynatomic_polynomial(Integer(2))
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/schemes/projective/projective_morphism.py", line 928, in dynatomic_polynomial
        PHI = PHI.numerator()._maxima_().divide(PHI.denominator())[0].sage()
      File "sage/structure/sage_object.pyx", line 795, in sage.structure.sage_object.SageObject._maxima_ (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/structure/sage_object.c:8292)
        return self._interface_(G)
      File "sage/structure/sage_object.pyx", line 707, in sage.structure.sage_object.SageObject._interface_ (/Users/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/structure/sage_object.c:5981)
        X = I(s)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 243, in __call__
        return cls(self, x, name=name)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/maxima.py", line 1159, in __init__
        ExpectElement.__init__(self, parent, value, is_name=False, name=None)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1376, in __init__
        self._name = parent._create(value, name=name)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 433, in _create
        self.set(name, value)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/maxima.py", line 1004, in set
        self._eval_line(cmd)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/maxima.py", line 791, in _eval_line
        assert line_echo.strip().endswith(line.strip()), 'mismatch:\n' + line_echo + line
    AssertionError: mismatch:
    

    sage11 : x^4*y + (-0.666666666666667*I)*x^2*y^3 - x*y^4 + (-0.111111111111111 - 0.333333333333333*I)*y^5$
```



---

Comment by bhutz created at 2016-06-04 13:04:13

Could you add some more information about the machine this is failing on. I just tested it again based on 7.3.beta2 Ubuntu 64-bit and it passes for me.


---

Comment by vbraun created at 2016-06-04 20:49:21

Can you just wait for the next beta and merge it in?


---

Comment by git created at 2016-06-07 21:11:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by gjorgenson created at 2016-06-07 21:13:22

Okay, this should now be based on sage 7.3 beta3.


---

Comment by gjorgenson created at 2016-06-07 21:13:22

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2016-06-08 01:39:06

Changing status from needs_review to positive_review.


---

Comment by bhutz created at 2016-06-08 01:39:06

all passes for me


---

Comment by vbraun created at 2016-06-09 16:14:17

Resolution: fixed
