# Issue 18179: UniqueRepresentation issue with PowerSeriesRing

archive/issues_018179.json:
```json
{
    "body": "CC:  @nilesjohnson simonking @tscrim @slel\n\nThe power series ring (`sage.rings.power_series_ring.PowerSeriesRing`) inherits from `UniqueRepresentation`. In the argument of the constructor there is the precision (`prec`) but it can be modified! Which leads to wrong behavior\n\n```\nsage: R1 = PowerSeriesRing(QQ, 'x', 3)\nsage: R2 = PowerSeriesRing(QQ, 'x', 3)\nsage: R1 is R2\nTrue\nsage: R2 = PowerSeriesRing(QQ, 'x', 4)\nsage: R1 is R2\nFalse\nsage: R2.set_default_prec(3)\nsage: R1 == R2\nFalse\n```\n\nMoreover, a function can modify a power series in use\n\n```\nsage: def haha()\n....:     PowerSeriesRing(QQ, 'x').set_default_prec(1)\nsage: R = PowerSeriesRing(QQ, 'x')\nsage: R.default_prec()\n20\nsage: haha()\nsage: R.default_prec()\n1\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/18416\n\n",
    "created_at": "2015-05-14T06:28:53Z",
    "labels": [
        "algebra",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "UniqueRepresentation issue with PowerSeriesRing",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18179",
    "user": "@videlec"
}
```
CC:  @nilesjohnson simonking @tscrim @slel

The power series ring (`sage.rings.power_series_ring.PowerSeriesRing`) inherits from `UniqueRepresentation`. In the argument of the constructor there is the precision (`prec`) but it can be modified! Which leads to wrong behavior

```
sage: R1 = PowerSeriesRing(QQ, 'x', 3)
sage: R2 = PowerSeriesRing(QQ, 'x', 3)
sage: R1 is R2
True
sage: R2 = PowerSeriesRing(QQ, 'x', 4)
sage: R1 is R2
False
sage: R2.set_default_prec(3)
sage: R1 == R2
False
```

Moreover, a function can modify a power series in use

```
sage: def haha()
....:     PowerSeriesRing(QQ, 'x').set_default_prec(1)
sage: R = PowerSeriesRing(QQ, 'x')
sage: R.default_prec()
20
sage: haha()
sage: R.default_prec()
1
```


Issue created by migration from https://trac.sagemath.org/ticket/18416





---

archive/issue_comments_245237.json:
```json
{
    "body": "Does anyone know the status of this?\n\nThe corresponding behavior for LaurentSeries was deprecated in #16201 (which also mentions power series) and finally removed in #26915 .\n\n\nSo now we are in the situation where PowerSeries and LaurentSeries work quite differently here, I can't see any real reason for this.",
    "created_at": "2019-03-09T08:03:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245237",
    "user": "@alexjbest"
}
```

Does anyone know the status of this?

The corresponding behavior for LaurentSeries was deprecated in #16201 (which also mentions power series) and finally removed in #26915 .


So now we are in the situation where PowerSeries and LaurentSeries work quite differently here, I can't see any real reason for this.



---

archive/issue_comments_245238.json:
```json
{
    "body": "+1 on deprecating the `set_default_prec` for `PowerSeriesRing` for the same reasons as for `LaurentSeriesRing`.",
    "created_at": "2019-03-09T21:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245238",
    "user": "@tscrim"
}
```

+1 on deprecating the `set_default_prec` for `PowerSeriesRing` for the same reasons as for `LaurentSeriesRing`.



---

archive/issue_comments_245239.json:
```json
{
    "body": "Even worse in terms of hidden side effects:\n\n```\nsage: R.<x> = LaurentSeriesRing(QQ,50)\nsage: R.default_prec()\n50\nsage: S = PowerSeriesRing(QQ,50,names='x')\nsage: S.set_default_prec(10)\nsage: R.default_prec()\n10\n```\n",
    "created_at": "2019-03-09T21:36:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245239",
    "user": "@tscrim"
}
```

Even worse in terms of hidden side effects:

```
sage: R.<x> = LaurentSeriesRing(QQ,50)
sage: R.default_prec()
50
sage: S = PowerSeriesRing(QQ,50,names='x')
sage: S.set_default_prec(10)
sage: R.default_prec()
10
```




---

archive/issue_comments_245240.json:
```json
{
    "body": "yes, this should definitely be changed",
    "created_at": "2019-03-11T15:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245240",
    "user": "@nilesjohnson"
}
```

yes, this should definitely be changed



---

archive/issue_comments_245241.json:
```json
{
    "body": "Moving all blocker/critical issues from 8.7 to 8.8.",
    "created_at": "2019-03-25T10:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245241",
    "user": "@embray"
}
```

Moving all blocker/critical issues from 8.7 to 8.8.



---

archive/issue_comments_245242.json:
```json
{
    "body": "Moving open critical and blocker issues to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245242",
    "user": "@embray"
}
```

Moving open critical and blocker issues to the next release milestone (optimistically).



---

archive/issue_comments_245243.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245243",
    "user": "@embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_245244.json:
```json
{
    "body": "I propose to go back to the idea from #16201. In particular, we should handle the whole precision business using a global variable. If desired, one could introduce several global variables (e.g. one for univariate power series and another for multivariate).\n\nI'll upload a branch soon.",
    "created_at": "2021-01-20T13:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245244",
    "user": "@mjungmath"
}
```

I propose to go back to the idea from #16201. In particular, we should handle the whole precision business using a global variable. If desired, one could introduce several global variables (e.g. one for univariate power series and another for multivariate).

I'll upload a branch soon.



---

archive/issue_comments_245245.json:
```json
{
    "body": "Okay, this is tricky: mostly all doctests heavily rely on the `default_prec` syntax, which is actually bad. Either we add after each example where the precision has been changed a\n\n\n```\nsage: set_series_precision(20)  # reset to default\n```\n\n\nor we have to establish each example with the default precision.\n\nAt least, this behavior would be expected with the proposed changes, whereas now it is entirely random to the user.\n\nAlternatively, we come up with an entirely different solution. I am open for suggestions.",
    "created_at": "2021-01-20T15:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245245",
    "user": "@mjungmath"
}
```

Okay, this is tricky: mostly all doctests heavily rely on the `default_prec` syntax, which is actually bad. Either we add after each example where the precision has been changed a


```
sage: set_series_precision(20)  # reset to default
```


or we have to establish each example with the default precision.

At least, this behavior would be expected with the proposed changes, whereas now it is entirely random to the user.

Alternatively, we come up with an entirely different solution. I am open for suggestions.



---

archive/issue_comments_245246.json:
```json
{
    "body": "So, this my first approach. Since the global variable `series_prec` keeps track of the multivariate case too (otherwise one runs into problems with the background power series ring), I set the default to 15, as a compromise for now.\n\nIf this meets your approval, we have to think what we should do with the failed doctests.\n\nI know, this is a big change. But the current behavior should not be further promoted either.\n----\nNew commits:",
    "created_at": "2021-01-20T21:56:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245246",
    "user": "@mjungmath"
}
```

So, this my first approach. Since the global variable `series_prec` keeps track of the multivariate case too (otherwise one runs into problems with the background power series ring), I set the default to 15, as a compromise for now.

If this meets your approval, we have to think what we should do with the failed doctests.

I know, this is a big change. But the current behavior should not be further promoted either.
----
New commits:



---

archive/issue_comments_245247.json:
```json
{
    "body": "Changing keywords from \"\" to \"power_series\".",
    "created_at": "2021-01-20T21:56:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245247",
    "user": "@mjungmath"
}
```

Changing keywords from "" to "power_series".



---

archive/issue_comments_245248.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-20T21:58:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245248",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245249.json:
```json
{
    "body": "Replying to [comment:12 gh-mjungmath]:\n> I propose to go back to the idea from #16201. In particular, we should handle the whole precision business using a global variable. If desired, one could introduce several global variables (e.g. one for univariate power series and another for multivariate).\n\nI am a very strong -1 on having a global variable for default precision. This would have far too many unintended side effects where code could seemingly-randomly change because you changed the default precision. This is something that should be strongly associated to the ring. I think the idea on #16201 of removing the ability to set the default precision is the correct one. If you want to change the precision, you need a new ring. This would be in line with real numbers.",
    "created_at": "2021-01-21T00:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245249",
    "user": "@tscrim"
}
```

Replying to [comment:12 gh-mjungmath]:
> I propose to go back to the idea from #16201. In particular, we should handle the whole precision business using a global variable. If desired, one could introduce several global variables (e.g. one for univariate power series and another for multivariate).

I am a very strong -1 on having a global variable for default precision. This would have far too many unintended side effects where code could seemingly-randomly change because you changed the default precision. This is something that should be strongly associated to the ring. I think the idea on #16201 of removing the ability to set the default precision is the correct one. If you want to change the precision, you need a new ring. This would be in line with real numbers.



---

archive/issue_comments_245250.json:
```json
{
    "body": "Replying to [comment:18 tscrim]:\n> Replying to [comment:12 gh-mjungmath]:\n> > I propose to go back to the idea from #16201. In particular, we should handle the whole precision business using a global variable. If desired, one could introduce several global variables (e.g. one for univariate power series and another for multivariate).\n> \n> I am a very strong -1 on having a global variable for default precision. This would have far too many unintended side effects where code could seemingly-randomly change because you changed the default precision. This is something that should be strongly associated to the ring. I think the idea on #16201 of removing the ability to set the default precision is the correct one. If you want to change the precision, you need a new ring. This would be in line with real numbers.\n\nI totally agree: no precision should be handled by global variables. We have parents exactly for that purpose.",
    "created_at": "2021-01-21T07:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245250",
    "user": "@videlec"
}
```

Replying to [comment:18 tscrim]:
> Replying to [comment:12 gh-mjungmath]:
> > I propose to go back to the idea from #16201. In particular, we should handle the whole precision business using a global variable. If desired, one could introduce several global variables (e.g. one for univariate power series and another for multivariate).
> 
> I am a very strong -1 on having a global variable for default precision. This would have far too many unintended side effects where code could seemingly-randomly change because you changed the default precision. This is something that should be strongly associated to the ring. I think the idea on #16201 of removing the ability to set the default precision is the correct one. If you want to change the precision, you need a new ring. This would be in line with real numbers.

I totally agree: no precision should be handled by global variables. We have parents exactly for that purpose.



---

archive/issue_comments_245251.json:
```json
{
    "body": "Watching how unpredictable the doctest behaves after this change, I totally agree. To be honest, I wasn't so convinced of this idea either.\n\nSo, remove all doctest related to `set_default_prec` and deprecate that function?",
    "created_at": "2021-01-21T08:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245251",
    "user": "@mjungmath"
}
```

Watching how unpredictable the doctest behaves after this change, I totally agree. To be honest, I wasn't so convinced of this idea either.

So, remove all doctest related to `set_default_prec` and deprecate that function?



---

archive/issue_comments_245252.json:
```json
{
    "body": "What about the current global variable? I think that should be deprecated as well if we don't pursue that behavior.",
    "created_at": "2021-01-21T08:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245252",
    "user": "@mjungmath"
}
```

What about the current global variable? I think that should be deprecated as well if we don't pursue that behavior.



---

archive/issue_comments_245253.json:
```json
{
    "body": "For some reason, both the Laurent series ring and power series ring refer to the global series precision in the documentation even though they just use the locally defined default precision\n\nHowever, effectively, the global series precision is only used in `expression.pyx`.\n\nHow do we treat elements of a power series ring with different precision than its parent? I tend to say that the element's precision should be fixed and linked to the parent. But this would change the entire behavior of power series.",
    "created_at": "2021-01-21T13:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245253",
    "user": "@mjungmath"
}
```

For some reason, both the Laurent series ring and power series ring refer to the global series precision in the documentation even though they just use the locally defined default precision

However, effectively, the global series precision is only used in `expression.pyx`.

How do we treat elements of a power series ring with different precision than its parent? I tend to say that the element's precision should be fixed and linked to the parent. But this would change the entire behavior of power series.



---

archive/issue_comments_245254.json:
```json
{
    "body": "Yes, we should deprecate `set_default_prec`.\n\nThere is some use for that global variable, that is to ensure consistency across implementations in Sage as it is not exposed to the user. It can also be used by an expert who knows what they are doing.\n\nThere should be a coercion from a parent with more (default) precision to one with less precision (over the same variables and base ring). (Of course, conversions should clearly be allowed.) This is in agreement with real numbers and if you create one with less precision, you are expecting to have less precision in the future. On the other hand, there is an argument that would say that because of how the precision is used, we should go the other way because we hold onto the cutoff and we should be as accurate as possible.\n\nI doubt for most people there will be any practical change.",
    "created_at": "2021-01-21T22:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245254",
    "user": "@tscrim"
}
```

Yes, we should deprecate `set_default_prec`.

There is some use for that global variable, that is to ensure consistency across implementations in Sage as it is not exposed to the user. It can also be used by an expert who knows what they are doing.

There should be a coercion from a parent with more (default) precision to one with less precision (over the same variables and base ring). (Of course, conversions should clearly be allowed.) This is in agreement with real numbers and if you create one with less precision, you are expecting to have less precision in the future. On the other hand, there is an argument that would say that because of how the precision is used, we should go the other way because we hold onto the cutoff and we should be as accurate as possible.

I doubt for most people there will be any practical change.



---

archive/issue_comments_245255.json:
```json
{
    "body": "Replying to [comment:23 tscrim]:\n> Yes, we should deprecate `set_default_prec`.\n> \n> There is some use for that global variable, that is to ensure consistency across implementations in Sage as it is not exposed to the user. It can also be used by an expert who knows what they are doing.\n> \n> There should be a coercion from a parent with more (default) precision to one with less precision (over the same variables and base ring). (Of course, conversions should clearly be allowed.) This is in agreement with real numbers and if you create one with less precision, you are expecting to have less precision in the future. On the other hand, there is an argument that would say that because of how the precision is used, we should go the other way because we hold onto the cutoff and we should be as accurate as possible.\n> \n> I doubt for most people there will be any practical change.\n\nThen, this needs a change of the current behavior, which is that the element's precision and precision of its parent are independent:\n\n\n```\nsage: R.<x> = PowerSeriesRing(QQ, default_prec=10)\nsage: p = R(x, prec=20); p\nx + O(x^20)\nsage: p.sin()\nx - 1/6*x^3 + 1/120*x^5 - 1/5040*x^7 + 1/362880*x^9 - 1/39916800*x^11 + 1/6227020800*x^13 - 1/1307674368000*x^15 + 1/355687428096000*x^17 - 1/121645100408832000*x^19 + O(x^20)\nsage: p.sin() in R\nTrue\n```\n",
    "created_at": "2021-01-22T11:23:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245255",
    "user": "@mjungmath"
}
```

Replying to [comment:23 tscrim]:
> Yes, we should deprecate `set_default_prec`.
> 
> There is some use for that global variable, that is to ensure consistency across implementations in Sage as it is not exposed to the user. It can also be used by an expert who knows what they are doing.
> 
> There should be a coercion from a parent with more (default) precision to one with less precision (over the same variables and base ring). (Of course, conversions should clearly be allowed.) This is in agreement with real numbers and if you create one with less precision, you are expecting to have less precision in the future. On the other hand, there is an argument that would say that because of how the precision is used, we should go the other way because we hold onto the cutoff and we should be as accurate as possible.
> 
> I doubt for most people there will be any practical change.

Then, this needs a change of the current behavior, which is that the element's precision and precision of its parent are independent:


```
sage: R.<x> = PowerSeriesRing(QQ, default_prec=10)
sage: p = R(x, prec=20); p
x + O(x^20)
sage: p.sin()
x - 1/6*x^3 + 1/120*x^5 - 1/5040*x^7 + 1/362880*x^9 - 1/39916800*x^11 + 1/6227020800*x^13 - 1/1307674368000*x^15 + 1/355687428096000*x^17 - 1/121645100408832000*x^19 + O(x^20)
sage: p.sin() in R
True
```




---

archive/issue_comments_245256.json:
```json
{
    "body": "Replying to [comment:24 gh-mjungmath]:\n> Then, this needs a change of the current behavior, which is that the element's precision and precision of its parent are independent\n\nThere's no particular problem with that: it's a default precision. If you explicitly want, you can ask for more precision. The issue arises because some operations (like coercing 1/(1+x) into a power series ring) need to choose a finite precision. In those cases, the default precision comes in.\n\nThere are other models; see the p-adics: for computational efficiency you may want to ensure you're never carrying around *more* than a certain number of terms. That would lead to a \"capped precision\" ring. But then you probably still want to allow for elements with less precision, because cancellation may mean that you simply can't determine more than a certain number of terms.",
    "created_at": "2021-01-23T05:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245256",
    "user": "@nbruin"
}
```

Replying to [comment:24 gh-mjungmath]:
> Then, this needs a change of the current behavior, which is that the element's precision and precision of its parent are independent

There's no particular problem with that: it's a default precision. If you explicitly want, you can ask for more precision. The issue arises because some operations (like coercing 1/(1+x) into a power series ring) need to choose a finite precision. In those cases, the default precision comes in.

There are other models; see the p-adics: for computational efficiency you may want to ensure you're never carrying around *more* than a certain number of terms. That would lead to a "capped precision" ring. But then you probably still want to allow for elements with less precision, because cancellation may mean that you simply can't determine more than a certain number of terms.



---

archive/issue_comments_245257.json:
```json
{
    "body": "I agree in so far as currently there's no particular problem with that behavior. In fact, the term `default_prec` and especially the method `set_defeault_prec` even promote it.\n\nHowever, if we want to *fix* the (default) precision of a power series ring instance, as Travis suggested in line with the real numbers, wouldn't it be confusing if its elements can still adopt higher (or lower) precision? This could also lead to unexpected and unwanted behavior when you try to coerce elements into elements of rings with higher/lower precision. This is in line with the real numbers, where you choose a precision and cannot increase the precision afterwards, and this makes perfect sense for power series, too. Increasing the precision (however that shall be possible after we've fixed the default precision and cannot be changed anymore), should then lead to another parent with corresponding higher precision.\n\nOne exception could be an element with infinite precision (i.e. a polynomial).",
    "created_at": "2021-01-23T10:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245257",
    "user": "@mjungmath"
}
```

I agree in so far as currently there's no particular problem with that behavior. In fact, the term `default_prec` and especially the method `set_defeault_prec` even promote it.

However, if we want to *fix* the (default) precision of a power series ring instance, as Travis suggested in line with the real numbers, wouldn't it be confusing if its elements can still adopt higher (or lower) precision? This could also lead to unexpected and unwanted behavior when you try to coerce elements into elements of rings with higher/lower precision. This is in line with the real numbers, where you choose a precision and cannot increase the precision afterwards, and this makes perfect sense for power series, too. Increasing the precision (however that shall be possible after we've fixed the default precision and cannot be changed anymore), should then lead to another parent with corresponding higher precision.

One exception could be an element with infinite precision (i.e. a polynomial).



---

archive/issue_comments_245258.json:
```json
{
    "body": "I think you are again confusing the precision of the element and the default precision of the ring. The former doesn't change no matter the default precision of the ring you are in. The latter only comes into play when you are doing a computation that requires a cutoff, such as division. The reality is I doubt anyone will be making a bunch of different power series rings with different precisions and mixing them together. The analog I made with the real numbers is not an exact comparison, but merely to point out the precedence for having a precision value set in the parent construction.",
    "created_at": "2021-01-23T22:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245258",
    "user": "@tscrim"
}
```

I think you are again confusing the precision of the element and the default precision of the ring. The former doesn't change no matter the default precision of the ring you are in. The latter only comes into play when you are doing a computation that requires a cutoff, such as division. The reality is I doubt anyone will be making a bunch of different power series rings with different precisions and mixing them together. The analog I made with the real numbers is not an exact comparison, but merely to point out the precedence for having a precision value set in the parent construction.



---

archive/issue_comments_245259.json:
```json
{
    "body": "Replying to [comment:26 gh-mjungmath]:\n> This is in line with the real numbers, where you choose a precision and cannot increase the precision afterwards, and this makes perfect sense for power series, too.\n\nThe analogue of floating point numbers would be a laurent polynomial ring where you just chop after a fixed number of terms. Power series rings and p-adics actually more resemble the `RealIntervalField` and `RealBallField`, where elements carry precision information with it, so that you can actually PROVE that two elements are distinct (you can only do that with floating point if you analyze the computation that you have used to arrive at those numbers).",
    "created_at": "2021-01-24T02:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245259",
    "user": "@nbruin"
}
```

Replying to [comment:26 gh-mjungmath]:
> This is in line with the real numbers, where you choose a precision and cannot increase the precision afterwards, and this makes perfect sense for power series, too.

The analogue of floating point numbers would be a laurent polynomial ring where you just chop after a fixed number of terms. Power series rings and p-adics actually more resemble the `RealIntervalField` and `RealBallField`, where elements carry precision information with it, so that you can actually PROVE that two elements are distinct (you can only do that with floating point if you analyze the computation that you have used to arrive at those numbers).



---

archive/issue_comments_245260.json:
```json
{
    "body": "Okay, I obviously misunderstood Travis' comparison with the real numbers. Thank you both for your thorough explaination.\n\nSo, the idea is then simply to deprecate `set_default_prec`, remove its use in the documentation and provide a coercion (and keep the precision for elements)? Then add some examples like\n\n\n```\nsage: R.<x> = PowerSeriesRing(QQ, default_prec=10)\nsage: f = sin(x); f\nx - 1/6*x^3 + 1/120*x^5 - 1/5040*x^7 + 1/362880*x^9 + O(x^10)\nsage: P.<x> = PowerSeriesRing(QQ, default_prec=5)\nsage. P(f)\nx - 1/6*x^3 + O(x^5)\n```\n",
    "created_at": "2021-01-24T10:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245260",
    "user": "@mjungmath"
}
```

Okay, I obviously misunderstood Travis' comparison with the real numbers. Thank you both for your thorough explaination.

So, the idea is then simply to deprecate `set_default_prec`, remove its use in the documentation and provide a coercion (and keep the precision for elements)? Then add some examples like


```
sage: R.<x> = PowerSeriesRing(QQ, default_prec=10)
sage: f = sin(x); f
x - 1/6*x^3 + 1/120*x^5 - 1/5040*x^7 + 1/362880*x^9 + O(x^10)
sage: P.<x> = PowerSeriesRing(QQ, default_prec=5)
sage. P(f)
x - 1/6*x^3 + O(x^5)
```




---

archive/issue_comments_245261.json:
```json
{
    "body": "Yes, that is correct other than the example, where the result of `P(f)` will be the same `f`. However, a good illustration of the difference is doing the exact same computation but in `P` (which will yield the output you have).",
    "created_at": "2021-02-01T03:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245261",
    "user": "@tscrim"
}
```

Yes, that is correct other than the example, where the result of `P(f)` will be the same `f`. However, a good illustration of the difference is doing the exact same computation but in `P` (which will yield the output you have).



---

archive/issue_comments_245262.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-02-01T17:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245262",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_245263.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-02-01T17:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245263",
    "user": "@mjungmath"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_245264.json:
```json
{
    "body": "Something like this?",
    "created_at": "2021-02-01T18:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245264",
    "user": "@mjungmath"
}
```

Something like this?



---

archive/issue_comments_245265.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-01T19:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245265",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245266.json:
```json
{
    "body": "Overall yes, but I think it would be better to deprecate the `set_default_prec` in `Nonexact` and continue to use that mix-in class. It is a nice indicator class that might be useful. Plus it would fix both types of power series rings in one place and make future maintenance easier.",
    "created_at": "2021-02-02T06:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245266",
    "user": "@tscrim"
}
```

Overall yes, but I think it would be better to deprecate the `set_default_prec` in `Nonexact` and continue to use that mix-in class. It is a nice indicator class that might be useful. Plus it would fix both types of power series rings in one place and make future maintenance easier.



---

archive/issue_comments_245267.json:
```json
{
    "body": "Are you sure this is a good idea? I mean, this method only causes trouble when you mix-in the class together with `UniqueRepresentation`. What if one still wants to use `Nonexact` and the feature `set_default_prec`?",
    "created_at": "2021-02-02T07:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245267",
    "user": "@mjungmath"
}
```

Are you sure this is a good idea? I mean, this method only causes trouble when you mix-in the class together with `UniqueRepresentation`. What if one still wants to use `Nonexact` and the feature `set_default_prec`?



---

archive/issue_comments_245268.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-02T08:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245268",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245269.json:
```json
{
    "body": "Okay, this class is used nowhere else. Instead, I have deprecated the method in `Nonexact` and improved its documentation to clarify the proper usage.",
    "created_at": "2021-02-02T08:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245269",
    "user": "@mjungmath"
}
```

Okay, this class is used nowhere else. Instead, I have deprecated the method in `Nonexact` and improved its documentation to clarify the proper usage.



---

archive/issue_comments_245270.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-02T08:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245270",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245271.json:
```json
{
    "body": "The only things I would change before giving a positive review (with a green patchbot) are the deprecation message to\n\n```\nThe method set_default_prec() is deprecated and will be removed in a future version of Sage. The default precision is set during construction.\n```\n\nand this\n\n```diff\n-The default precision of a power series ring instance stays fixed and\n-cannot be changed. To work with different default precisions, we must\n-establish new instances instead::\n+The default precision of a power series ring stays fixed and\n+cannot be changed. To work with different default precision, create\n+a new power series ring::\n```\n",
    "created_at": "2021-02-04T05:23:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245271",
    "user": "@tscrim"
}
```

The only things I would change before giving a positive review (with a green patchbot) are the deprecation message to

```
The method set_default_prec() is deprecated and will be removed in a future version of Sage. The default precision is set during construction.
```

and this

```diff
-The default precision of a power series ring instance stays fixed and
-cannot be changed. To work with different default precisions, we must
-establish new instances instead::
+The default precision of a power series ring stays fixed and
+cannot be changed. To work with different default precision, create
+a new power series ring::
```




---

archive/issue_comments_245272.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-02-05T09:34:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245272",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_245273.json:
```json
{
    "body": "There we go. :)",
    "created_at": "2021-02-05T09:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245273",
    "user": "@mjungmath"
}
```

There we go. :)



---

archive/issue_comments_245274.json:
```json
{
    "body": "changing src/bin/sage is not a thing to do",
    "created_at": "2021-02-05T19:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245274",
    "user": "@fchapoton"
}
```

changing src/bin/sage is not a thing to do



---

archive/issue_comments_245275.json:
```json
{
    "body": "I merged #31263 to use the `sage -b` command...\n\nRebase?",
    "created_at": "2021-02-05T19:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245275",
    "user": "@mjungmath"
}
```

I merged #31263 to use the `sage -b` command...

Rebase?



---

archive/issue_comments_245276.json:
```json
{
    "body": "* you could have used \"make build\" instead of \"sage -b\", until this is repaired\n\n* do not rebase, but add #31263 in the dependency field here above (I did that for you)\n\n* changing the src/bin/sage file make your ticket \"unsafe\", so patchbots do not test it",
    "created_at": "2021-02-05T20:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245276",
    "user": "@fchapoton"
}
```

* you could have used "make build" instead of "sage -b", until this is repaired

* do not rebase, but add #31263 in the dependency field here above (I did that for you)

* changing the src/bin/sage file make your ticket "unsafe", so patchbots do not test it



---

archive/issue_comments_245277.json:
```json
{
    "body": "That is good to know. Thank you for pointing this out.\n\nTravis, are you satisfied?",
    "created_at": "2021-02-05T22:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245277",
    "user": "@mjungmath"
}
```

That is good to know. Thank you for pointing this out.

Travis, are you satisfied?



---

archive/issue_comments_245278.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-08T23:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245278",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_245279.json:
```json
{
    "body": "Yep. LGTM. Thank you.",
    "created_at": "2021-02-08T23:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245279",
    "user": "@tscrim"
}
```

Yep. LGTM. Thank you.



---

archive/issue_comments_245280.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-02-28T12:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245280",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_245281.json:
```json
{
    "body": "\n```\n[dochtml] Traceback (most recent call last):\n[dochtml]   File \"/usr/lib64/python3.9/runpy.py\", line 197, in _run_module_as_main\n[dochtml]     return _run_code(code, main_globals, None,\n[dochtml]   File \"/usr/lib64/python3.9/runpy.py\", line 87, in _run_code\n[dochtml]     exec(code, run_globals)\n[dochtml]   File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/__main__.py\", line 2, in <module>\n[dochtml]     main()\n[dochtml]   File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/__init__.py\", line 1738, in main\n[dochtml]     builder()\n[dochtml]   File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/__init__.py\", line 345, in _wrapper\n[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)\n[dochtml]   File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/__init__.py\", line 577, in _wrapper\n[dochtml]     self._build_everything_except_bibliography(lang, format, *args, **kwds)\n[dochtml]   File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/__init__.py\", line 563, in _build_everything_except_bibliography\n[dochtml]     build_many(build_ref_doc, non_references)\n[dochtml]   File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/__init__.py\", line 297, in build_many\n[dochtml]     _build_many(target, args, processes=processes)\n[dochtml]   File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/utils.py\", line 289, in build_many\n[dochtml]     raise worker_exc.original_exception\n[dochtml] OSError: /home/release/Sage/local/lib64/python3.9/site-packages/sage/structure/nonexact.py:docstring of sage.structure.nonexact.Nonexact:6: WARNING: Bullet list ends without a blank line; unexpected unindent.\n[dochtml] \n[dochtml]     Note: incremental documentation builds sometimes cause spurious\n[dochtml]     error messages. To be certain that these are real errors, run\n[dochtml]     \"make doc-clean\" first and try again.\nmake[3]: *** [Makefile:1916: doc-html] Error 1\n```\n",
    "created_at": "2021-02-28T12:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245281",
    "user": "@vbraun"
}
```


```
[dochtml] Traceback (most recent call last):
[dochtml]   File "/usr/lib64/python3.9/runpy.py", line 197, in _run_module_as_main
[dochtml]     return _run_code(code, main_globals, None,
[dochtml]   File "/usr/lib64/python3.9/runpy.py", line 87, in _run_code
[dochtml]     exec(code, run_globals)
[dochtml]   File "/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[dochtml]     main()
[dochtml]   File "/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/__init__.py", line 1738, in main
[dochtml]     builder()
[dochtml]   File "/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/__init__.py", line 345, in _wrapper
[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
[dochtml]   File "/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/__init__.py", line 577, in _wrapper
[dochtml]     self._build_everything_except_bibliography(lang, format, *args, **kwds)
[dochtml]   File "/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/__init__.py", line 563, in _build_everything_except_bibliography
[dochtml]     build_many(build_ref_doc, non_references)
[dochtml]   File "/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/__init__.py", line 297, in build_many
[dochtml]     _build_many(target, args, processes=processes)
[dochtml]   File "/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/utils.py", line 289, in build_many
[dochtml]     raise worker_exc.original_exception
[dochtml] OSError: /home/release/Sage/local/lib64/python3.9/site-packages/sage/structure/nonexact.py:docstring of sage.structure.nonexact.Nonexact:6: WARNING: Bullet list ends without a blank line; unexpected unindent.
[dochtml] 
[dochtml]     Note: incremental documentation builds sometimes cause spurious
[dochtml]     error messages. To be certain that these are real errors, run
[dochtml]     "make doc-clean" first and try again.
make[3]: *** [Makefile:1916: doc-html] Error 1
```




---

archive/issue_comments_245282.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-28T14:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245282",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245283.json:
```json
{
    "body": "Just one character missing...here we go.",
    "created_at": "2021-02-28T14:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245283",
    "user": "@mjungmath"
}
```

Just one character missing...here we go.



---

archive/issue_comments_245284.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-02-28T14:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245284",
    "user": "@mjungmath"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_245285.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-28T22:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245285",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_245286.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-03-07T17:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18179#issuecomment-245286",
    "user": "@vbraun"
}
```

Resolution: fixed
