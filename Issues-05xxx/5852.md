# Issue 5852: Properly canonicalize $SAGE_ROOT

archive/issues_005852.json:
```json
{
    "assignees": [
        "https://github.com/jdemeyer"
    ],
    "body": "Currently, `$SAGE_ROOT/sage` uses (first among other alternate methods) `readlink -n` to detect the directory where the script lives (that's $SAGE_ROOT), but that is broken because\n- It only works when `$0` (the sage executable itself) is a symbolic link\n- If the sage executable is a symbolic link, then `readlink -n` returns the link itself, not the canonicalized name.  Example: if `/usr/local/sage-4.7.1/sage` is a symbolic link to `sagefoo`, then `SAGE_ROOT` would become `sagefoo` when `'/usr/local/sage-4.7.1/sagefoo` is intended.\n- The symlink expansion may not be completely done, and `$SAGE_ROOT` could end up with a non-canonical dirname, which leads to issues with testing.\n- The code to detect `SAGE_ROOT` inside `sage-env` does not canonicalize the pathname at all.  This should be fixed as well. (The only case where `sage-env` is run without `SAGE_ROOT` being set is when testing Sage from the `Makefile`, i.e. when running `make ptest` or similar.)\n\nNote that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.\n\nSee also #11704, which solves the same problem for `DOT_SAGE`.\n\nApply:\n1. [attachment: 5852_sage_root.patch](https://github.com/sagemath/sage/files/ticket5852/5852_sage_root.patch.gz) to `SAGE_ROOT`\n2. [attachment: 5852_scripts.patch](https://github.com/sagemath/sage/files/ticket5852/5852_scripts.patch.gz) to `local/bin`\n3. [attachment: 5852_doc.patch](https://github.com/sagemath/sage/files/ticket5852/5852_doc.patch.gz) and [attachment: trac_5852-doc-referee.patch](https://github.com/sagemath/sage/files/ticket5852/trac_5852-doc-referee.patch.gz) to `devel/sage`\n\nDepends on #11926\nDepends on #11959\n\nCC:  @nexttime @kini\n\nComponent: **scripts**\n\nAuthor: **Jeroen Demeyer**\n\nReviewer: **John Palmieri, Leif Leonhardy**\n\nMerged: **sage-4.8.alpha3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/5852_\n\n",
    "closed_at": "2011-11-26T10:31:33Z",
    "created_at": "2009-04-22T12:39:58Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20scripts",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Properly canonicalize $SAGE_ROOT",
    "type": "issue",
    "updated_at": "2011-11-26T10:31:33Z",
    "url": "https://github.com/sagemath/sage/issues/5852",
    "user": "https://github.com/tornaria"
}
```
Currently, `$SAGE_ROOT/sage` uses (first among other alternate methods) `readlink -n` to detect the directory where the script lives (that's $SAGE_ROOT), but that is broken because
- It only works when `$0` (the sage executable itself) is a symbolic link
- If the sage executable is a symbolic link, then `readlink -n` returns the link itself, not the canonicalized name.  Example: if `/usr/local/sage-4.7.1/sage` is a symbolic link to `sagefoo`, then `SAGE_ROOT` would become `sagefoo` when `'/usr/local/sage-4.7.1/sagefoo` is intended.
- The symlink expansion may not be completely done, and `$SAGE_ROOT` could end up with a non-canonical dirname, which leads to issues with testing.
- The code to detect `SAGE_ROOT` inside `sage-env` does not canonicalize the pathname at all.  This should be fixed as well. (The only case where `sage-env` is run without `SAGE_ROOT` being set is when testing Sage from the `Makefile`, i.e. when running `make ptest` or similar.)

Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.

See also #11704, which solves the same problem for `DOT_SAGE`.

Apply:
1. [attachment: 5852_sage_root.patch](https://github.com/sagemath/sage/files/ticket5852/5852_sage_root.patch.gz) to `SAGE_ROOT`
2. [attachment: 5852_scripts.patch](https://github.com/sagemath/sage/files/ticket5852/5852_scripts.patch.gz) to `local/bin`
3. [attachment: 5852_doc.patch](https://github.com/sagemath/sage/files/ticket5852/5852_doc.patch.gz) and [attachment: trac_5852-doc-referee.patch](https://github.com/sagemath/sage/files/ticket5852/trac_5852-doc-referee.patch.gz) to `devel/sage`

Depends on #11926
Depends on #11959

CC:  @nexttime @kini

Component: **scripts**

Author: **Jeroen Demeyer**

Reviewer: **John Palmieri, Leif Leonhardy**

Merged: **sage-4.8.alpha3**

_Issue created by migration from https://trac.sagemath.org/ticket/5852_





---

archive/issue_events_069308.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2009-04-22T12:39:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "c: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69308"
}
```



---

archive/issue_events_069309.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2009-04-22T12:39:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69309"
}
```



---

archive/issue_events_069310.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2009-04-22T12:39:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69310"
}
```



---

archive/issue_events_069311.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2009-04-22T12:39:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69311"
}
```



---

archive/issue_events_069312.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2009-04-22T12:46:06Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "subject": "https://github.com/tornaria",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69312"
}
```



---

archive/issue_events_069313.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2009-04-22T12:46:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "c: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69313"
}
```



---

archive/issue_comments_037598.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nPatching `$SAGE_ROOT/sage` with this:\n\n```\n--- sage-3.4/sage.orig\t2009-04-22 01:45:48.000000000 -0300\n+++ sage-3.4/sage\t2009-04-22 09:37:27.000000000 -0300\n@@ -14,6 +14,7 @@\n fi\n \n if [ \"$SAGE_ROOT\" = \".....\" ];  then\n+    SAGE_ROOT=`readlink -nf \"$0\" 2> /dev/null` || \\\n     SAGE_ROOT=`readlink -n \"$0\" 2> /dev/null` || \\\n     SAGE_ROOT=`realpath    \"$0\" 2> /dev/null` || \\\n     SAGE_ROOT=\"$0\"\n```\nfixes the issue, since now `$SAGE_ROOT` is correct.\n\nAccording to mabshoff, `readlink -f` doesn't work on some BSD; that's why I left the `readlink -n` test in the second line, but this should of course be tested on those BSD to make sure it doesn't cause a regression.",
    "created_at": "2009-04-22T12:46:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37598",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:1" align="right">comment:1</div>

Patching `$SAGE_ROOT/sage` with this:

```
--- sage-3.4/sage.orig	2009-04-22 01:45:48.000000000 -0300
+++ sage-3.4/sage	2009-04-22 09:37:27.000000000 -0300
@@ -14,6 +14,7 @@
 fi
 
 if [ "$SAGE_ROOT" = "....." ];  then
+    SAGE_ROOT=`readlink -nf "$0" 2> /dev/null` || \
     SAGE_ROOT=`readlink -n "$0" 2> /dev/null` || \
     SAGE_ROOT=`realpath    "$0" 2> /dev/null` || \
     SAGE_ROOT="$0"
```
fixes the issue, since now `$SAGE_ROOT` is correct.

According to mabshoff, `readlink -f` doesn't work on some BSD; that's why I left the `readlink -n` test in the second line, but this should of course be tested on those BSD to make sure it doesn't cause a regression.



---

archive/issue_events_069314.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2009-04-22T12:46:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "milestone_number": null,
    "milestone_title": "sage-3.4.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69314"
}
```



---

archive/issue_comments_037599.json:
```json
{
    "body": "On systems where \"readlink -f\" is supported, use that so the path for $SAGE_ROOT is fully canonicalized",
    "created_at": "2009-04-25T02:02:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37599",
    "user": "https://github.com/tornaria"
}
```

On systems where "readlink -f" is supported, use that so the path for $SAGE_ROOT is fully canonicalized



---

archive/issue_comments_037600.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAttachment: **[trac_5852.patch.gz](https://github.com/sagemath/sage/files/ticket5852/trac_5852.patch.gz)**\n\nReplying to [@tornaria](#comment%3A1):\n> Patching `$SAGE_ROOT/sage` with this:\n> \n> ```\n> --- sage-3.4/sage.orig\t2009-04-22 01:45:48.000000000 -0300\n> +++ sage-3.4/sage\t2009-04-22 09:37:27.000000000 -0300\n> @@ -14,6 +14,7 @@\n>  fi\n>  \n>  if [ \"$SAGE_ROOT\" = \".....\" ];  then\n> +    SAGE_ROOT=`readlink -nf \"$0\" 2> /dev/null` || \\\n>      SAGE_ROOT=`readlink -n \"$0\" 2> /dev/null` || \\\n>      SAGE_ROOT=`realpath    \"$0\" 2> /dev/null` || \\\n>      SAGE_ROOT=\"$0\"\n> ```\n> fixes the issue, since now `$SAGE_ROOT` is correct.\n> \n> According to mabshoff, `readlink -f` doesn't work on some BSD; that's why I left the `readlink -n` test in the second line, but this should of course be tested on those BSD to make sure it doesn't cause a regression.\n\nI can confirm that it does not work on MacOS X.10.4.11 (e.g. Anne Schilling's machine)\n\nA fix would be most welcome, as this makes sage -t make false reports of broken test files.",
    "created_at": "2009-04-28T00:18:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37600",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:2" align="right">comment:2</div>

Attachment: **[trac_5852.patch.gz](https://github.com/sagemath/sage/files/ticket5852/trac_5852.patch.gz)**

Replying to [@tornaria](#comment%3A1):
> Patching `$SAGE_ROOT/sage` with this:
> 
> ```
> --- sage-3.4/sage.orig	2009-04-22 01:45:48.000000000 -0300
> +++ sage-3.4/sage	2009-04-22 09:37:27.000000000 -0300
> @@ -14,6 +14,7 @@
>  fi
>  
>  if [ "$SAGE_ROOT" = "....." ];  then
> +    SAGE_ROOT=`readlink -nf "$0" 2> /dev/null` || \
>      SAGE_ROOT=`readlink -n "$0" 2> /dev/null` || \
>      SAGE_ROOT=`realpath    "$0" 2> /dev/null` || \
>      SAGE_ROOT="$0"
> ```
> fixes the issue, since now `$SAGE_ROOT` is correct.
> 
> According to mabshoff, `readlink -f` doesn't work on some BSD; that's why I left the `readlink -n` test in the second line, but this should of course be tested on those BSD to make sure it doesn't cause a regression.

I can confirm that it does not work on MacOS X.10.4.11 (e.g. Anne Schilling's machine)

A fix would be most welcome, as this makes sage -t make false reports of broken test files.



---

archive/issue_comments_037601.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThe readlink -f workaround is better than nothing, and should not make things worst for systems like BSD. I would vote for including it now, in waiting for a better solution.\nShould I set a positive review?\n\nBesides, what about adding a switch to sage -t to specify manually that the given file is inside or outside the sage source tree?\n\nThis would make a workaround for MacOX X, and also be occasionally be useful. For example, I often run tests from one sage source tree with another sage to compare the results.",
    "created_at": "2009-05-04T16:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37601",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:3" align="right">comment:3</div>

The readlink -f workaround is better than nothing, and should not make things worst for systems like BSD. I would vote for including it now, in waiting for a better solution.
Should I set a positive review?

Besides, what about adding a switch to sage -t to specify manually that the given file is inside or outside the sage source tree?

This would make a workaround for MacOX X, and also be occasionally be useful. For example, I often run tests from one sage source tree with another sage to compare the results.



---

archive/issue_comments_037602.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIs there some equivalent of `readlink -f` that works in MacOS X?",
    "created_at": "2009-05-17T03:02:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37602",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:4" align="right">comment:4</div>

Is there some equivalent of `readlink -f` that works in MacOS X?



---

archive/issue_events_069315.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2009-05-17T03:02:28Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "milestone_number": null,
    "milestone_title": "sage-4.0.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69315"
}
```



---

archive/issue_events_069316.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2009-05-17T03:02:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "milestone_number": null,
    "milestone_title": "sage-4.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69316"
}
```



---

archive/issue_comments_037603.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nNote that the version of `readlink` which is included in fink (in package `debianutils`) supports the `-f` switch, so a mac with fink doesn't suffer from this issue (asuming `/sw/sbin` is before `/usr/bin` in the search PATH).",
    "created_at": "2009-05-17T03:17:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37603",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:5" align="right">comment:5</div>

Note that the version of `readlink` which is included in fink (in package `debianutils`) supports the `-f` switch, so a mac with fink doesn't suffer from this issue (asuming `/sw/sbin` is before `/usr/bin` in the search PATH).



---

archive/issue_comments_037604.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nSee #6146 for fixing this on systems that don't support readlink -f.",
    "created_at": "2009-05-28T07:00:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37604",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:6" align="right">comment:6</div>

See #6146 for fixing this on systems that don't support readlink -f.



---

archive/issue_events_069317.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-05-28T07:00:31Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "title_is": "the detection of SAGE_ROOT in $SAGE_ROOT/sage script should expand symlinks recursively (fix this on systems that support readlink -f)",
    "title_was": "the detection of SAGE_ROOT in $SAGE_ROOT/sage script should expand symlinks recursively",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69317"
}
```



---

archive/issue_events_069318.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-05-28T07:00:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69318"
}
```



---

archive/issue_comments_037605.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nMerged in 4.0.rc1.",
    "created_at": "2009-05-28T07:04:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37605",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:7" align="right">comment:7</div>

Merged in 4.0.rc1.



---

archive/issue_events_069319.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-05-28T07:04:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69319"
}
```



---

archive/issue_events_069320.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-05-28T07:04:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69320"
}
```



---

archive/issue_comments_037606.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nQuestion.  Does \n\n```\nreadlink -n sage\n```\nwork on any platform?!  It gives an error on *both* OS X and Linux.  Why is it even there?!\n\n```\nOS X\nub243101:s wstein$ readlink -n sage\nub243101:s wstein$ echo $?\n1\n\nLinux:\nwstein@boxen:~/sage$ readlink -n sage\nwstein@boxen:~/sage$ echo $?\n1\n```\n\nI wonder who wrote this weird SAGE_ROOT code in the first place?  I wrote something a long time ago, but it bears no resemblance to the current code.\n\n\nBy the way, I've had reports of major failures caused by using `readlink -nf` by one user who has a symlink + nfs mount setup.  Their problems are solved by deleting the `readlink -nf` line.   Why don't we use realpath first and only if that doesn't work use something else?  It seems like realpath is the right choice, since it's supposed to \" converts each filename argument to an absolute pathname, which has no components that are symbolic links or the special\n       .  or ..  directory entries...  Please note that mostly the same functionality is provided by the \u2018-f\u2019 option.\"\n\nThere is no realpath on OS X, but that is ok since readlink doesn't work ever on OS X anyways, so no loss. \n\n -- William",
    "created_at": "2009-07-01T11:25:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37606",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:8" align="right">comment:8</div>

Question.  Does 

```
readlink -n sage
```
work on any platform?!  It gives an error on *both* OS X and Linux.  Why is it even there?!

```
OS X
ub243101:s wstein$ readlink -n sage
ub243101:s wstein$ echo $?
1

Linux:
wstein@boxen:~/sage$ readlink -n sage
wstein@boxen:~/sage$ echo $?
1
```

I wonder who wrote this weird SAGE_ROOT code in the first place?  I wrote something a long time ago, but it bears no resemblance to the current code.


By the way, I've had reports of major failures caused by using `readlink -nf` by one user who has a symlink + nfs mount setup.  Their problems are solved by deleting the `readlink -nf` line.   Why don't we use realpath first and only if that doesn't work use something else?  It seems like realpath is the right choice, since it's supposed to " converts each filename argument to an absolute pathname, which has no components that are symbolic links or the special
       .  or ..  directory entries...  Please note that mostly the same functionality is provided by the ‘-f’ option."

There is no realpath on OS X, but that is ok since readlink doesn't work ever on OS X anyways, so no loss. 

 -- William



---

archive/issue_comments_037607.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@williamstein](#comment%3A8):\n> Question.  Does \n> \n> ```\n> readlink -n sage\n> ```\n> work on any platform?!\n\nYes it does: it reads the content of a symbolic link. It succeeds if and only if the argument is actually a symbolic link, e.g.\n\n```\n~/sandbox$ ls -l\ntotal 0\n~/sandbox$ mkdir sage1\n~/sandbox$ readlink sage1 ; echo $?  ## fails b/c sage1 is not a symlink\n1\n~/sandbox$ ln -s sage1 sage2\n~/sandbox$ readlink sage2 ; echo $?  ## ok b/c sage2 is actually a symlink\nsage1\n0\n```\nThe option `-n` means to not print a trainling newline character; I don't think it really make a difference due to bash usual escaping rules.\n\n>  It gives an error on *both* OS X and Linux.  Why is it even there?!\n\nIt was there before the patch in this ticket, so that if `$0` (the path to the script one is running) is actually a symlink to the real path of the sage script, the detection of `SAGE_ROOT` works. On systems that support `-f`, that is a more complete solution, but the fallback was left for the benefit of systems where `readlink -f` does not work (e.g. OS X).\n\nFollowing my example above, here's an example where `-f` is needed:\n\n```\n~/sandbox$ ln -s sage2 sage3\ntornaria@bip:~/sandbox$ readlink -n sage3\nsage2tornaria@bip:~/sandbox$ readlink sage3\nsage2\ntornaria@bip:~/sandbox$ readlink -f sage3\n/home/tornaria/sandbox/sage1\n```\n\nThe other major case is when there are symlinks in some of the components of the path, those get canonicalized by `readlink -f`, but not by plain `readlink` (this leads to failures as shown in the description).\n\n\n> By the way, I've had reports of major failures caused by using `readlink -nf` by one user who has a symlink + nfs mount setup.  Their problems are solved by deleting the `readlink -nf` line.   Why don't we use realpath first and only if that doesn't work use something else?  It seems like realpath is the right choice, since it's supposed to \" converts each filename argument to an absolute pathname, which has no components that are symbolic links or the special\n>        .  or ..  directory entries...  Please note that mostly the same functionality is provided by the \u2018-f\u2019 option.\"\n\nCan you give a pointer to those? Not using `readlink -f` leads to major failures in testing, as described in the description of the ticket.\n\nDo you actually know that in those cases `realpath` works? It seems to me that both are implemented using `realpath(3)`, so they should be the same unless I'm missing something.\n\n> There is no realpath on OS X, but that is ok since readlink doesn't work ever on OS X anyways, so no loss. \n\nThere is no `realpath` in most systems I have access to (other than sage.math). In fact, `readlink` is pretty much standard (possibly POSIX), although `-f` option is not (a GNUism?). For GNU systems (e.g. linux), it comes bundled in coreutils, which means it will be available everywhere. OTOH, `realpath` comes in *optional* package `realpath`. Do you know of a system where `readlink -f` doesn't work but `realpath(1)` is available?\n\nOTOH, realpath(3) seems to be a POSIX standard, and it seems to be available on OS X:\n\n```\n$ nm /usr/lib/libc.dylib | grep realpath\n/usr/lib/libc.dylib(realpath.So):\n9003f1f0 T _realpath\n```\nso an alternative would be to compile our own `realpath` binary and somehow use it from the startup script. But we need a path to SAGE_ROOT so we can find SAGE_ROOT/local/bin/realpath... auch... (doesn't need to be canonical, though.... so we could use readlink a few times to get a path to the actual sage script, and then run `realpath` from there).",
    "created_at": "2009-07-01T13:00:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37607",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@williamstein](#comment%3A8):
> Question.  Does 
> 
> ```
> readlink -n sage
> ```
> work on any platform?!

Yes it does: it reads the content of a symbolic link. It succeeds if and only if the argument is actually a symbolic link, e.g.

```
~/sandbox$ ls -l
total 0
~/sandbox$ mkdir sage1
~/sandbox$ readlink sage1 ; echo $?  ## fails b/c sage1 is not a symlink
1
~/sandbox$ ln -s sage1 sage2
~/sandbox$ readlink sage2 ; echo $?  ## ok b/c sage2 is actually a symlink
sage1
0
```
The option `-n` means to not print a trainling newline character; I don't think it really make a difference due to bash usual escaping rules.

>  It gives an error on *both* OS X and Linux.  Why is it even there?!

It was there before the patch in this ticket, so that if `$0` (the path to the script one is running) is actually a symlink to the real path of the sage script, the detection of `SAGE_ROOT` works. On systems that support `-f`, that is a more complete solution, but the fallback was left for the benefit of systems where `readlink -f` does not work (e.g. OS X).

Following my example above, here's an example where `-f` is needed:

```
~/sandbox$ ln -s sage2 sage3
tornaria@bip:~/sandbox$ readlink -n sage3
sage2tornaria@bip:~/sandbox$ readlink sage3
sage2
tornaria@bip:~/sandbox$ readlink -f sage3
/home/tornaria/sandbox/sage1
```

The other major case is when there are symlinks in some of the components of the path, those get canonicalized by `readlink -f`, but not by plain `readlink` (this leads to failures as shown in the description).


> By the way, I've had reports of major failures caused by using `readlink -nf` by one user who has a symlink + nfs mount setup.  Their problems are solved by deleting the `readlink -nf` line.   Why don't we use realpath first and only if that doesn't work use something else?  It seems like realpath is the right choice, since it's supposed to " converts each filename argument to an absolute pathname, which has no components that are symbolic links or the special
>        .  or ..  directory entries...  Please note that mostly the same functionality is provided by the ‘-f’ option."

Can you give a pointer to those? Not using `readlink -f` leads to major failures in testing, as described in the description of the ticket.

Do you actually know that in those cases `realpath` works? It seems to me that both are implemented using `realpath(3)`, so they should be the same unless I'm missing something.

> There is no realpath on OS X, but that is ok since readlink doesn't work ever on OS X anyways, so no loss. 

There is no `realpath` in most systems I have access to (other than sage.math). In fact, `readlink` is pretty much standard (possibly POSIX), although `-f` option is not (a GNUism?). For GNU systems (e.g. linux), it comes bundled in coreutils, which means it will be available everywhere. OTOH, `realpath` comes in *optional* package `realpath`. Do you know of a system where `readlink -f` doesn't work but `realpath(1)` is available?

OTOH, realpath(3) seems to be a POSIX standard, and it seems to be available on OS X:

```
$ nm /usr/lib/libc.dylib | grep realpath
/usr/lib/libc.dylib(realpath.So):
9003f1f0 T _realpath
```
so an alternative would be to compile our own `realpath` binary and somehow use it from the startup script. But we need a path to SAGE_ROOT so we can find SAGE_ROOT/local/bin/realpath... auch... (doesn't need to be canonical, though.... so we could use readlink a few times to get a path to the actual sage script, and then run `realpath` from there).



---

archive/issue_comments_037608.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nIt's possible that this ticket should be reverted until a major bug it causes is fixed.   \n\nThe reason for this ticket in the first place was the following, as given in the ticket description:\n\n```\n/home/sage$ md5sum sage-3.4/sage\n4153919efe1edcd34ad7fa193122d679  sage-3.4/sage\n/home/sage$ ln -s sage-3.4 sage-3.4-symlink\n/home/sage$ ln -sf /home/sage/sage-3.4-symlink/sage /home/tornaria/bin/sage\n/home/sage$ type sage\n```\n\nNotice the symlink of the Sage script\n\n```\n/home/sage$ ln -sf /home/sage/sage-3.4-symlink/sage /home/tornaria/bin/sage\n```\n\nFor the record, this is *not* how I meant the sage script is meant to be used.  I bet this isn't documented, but it should be.  The script should never be used that way.  Instead one should do\n\n```\n/home/sage$ cp /home/sage/sage-3.4-symlink/sage /home/tornaria/bin/sage\n```\nand then edit the copied script to explicitly point to the ROOT.   It was never my intention for somebody to run the sage script unmodified outside of SAGE_ROOT.    Me not intending this means that elsewhere in the Sage build/test system this assumption is made, and the workaround on this ticket actually seriously breaks things for some users. \n\nThe change in this ticket causes serious breakage for people whose home directory is NFS mounted, and for which their Sage build is on another volume that is symlinked from their home directory. i.e., this sort of setup:\n\n```\n    cd ~wstein    # my home directory is NFS mounted.\n    mkdir /tmp/wstein       # /tmp is a local disk\n    ln -s /tmp/wstein sage-build\n    cd sage-build    # \n    # build sage here, doctesting fails completely\n```\n\nI'm doing a test build for myself to confirm that this happens, and if so and I can't figure out how to fix this promptly (maybe I will be able to), then we have to revert this change, and document that one can't just symlink the sage script out.",
    "created_at": "2009-07-01T23:32:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37608",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:10" align="right">comment:10</div>

It's possible that this ticket should be reverted until a major bug it causes is fixed.   

The reason for this ticket in the first place was the following, as given in the ticket description:

```
/home/sage$ md5sum sage-3.4/sage
4153919efe1edcd34ad7fa193122d679  sage-3.4/sage
/home/sage$ ln -s sage-3.4 sage-3.4-symlink
/home/sage$ ln -sf /home/sage/sage-3.4-symlink/sage /home/tornaria/bin/sage
/home/sage$ type sage
```

Notice the symlink of the Sage script

```
/home/sage$ ln -sf /home/sage/sage-3.4-symlink/sage /home/tornaria/bin/sage
```

For the record, this is *not* how I meant the sage script is meant to be used.  I bet this isn't documented, but it should be.  The script should never be used that way.  Instead one should do

```
/home/sage$ cp /home/sage/sage-3.4-symlink/sage /home/tornaria/bin/sage
```
and then edit the copied script to explicitly point to the ROOT.   It was never my intention for somebody to run the sage script unmodified outside of SAGE_ROOT.    Me not intending this means that elsewhere in the Sage build/test system this assumption is made, and the workaround on this ticket actually seriously breaks things for some users. 

The change in this ticket causes serious breakage for people whose home directory is NFS mounted, and for which their Sage build is on another volume that is symlinked from their home directory. i.e., this sort of setup:

```
    cd ~wstein    # my home directory is NFS mounted.
    mkdir /tmp/wstein       # /tmp is a local disk
    ln -s /tmp/wstein sage-build
    cd sage-build    # 
    # build sage here, doctesting fails completely
```

I'm doing a test build for myself to confirm that this happens, and if so and I can't figure out how to fix this promptly (maybe I will be able to), then we have to revert this change, and document that one can't just symlink the sage script out.



---

archive/issue_comments_037609.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@williamstein](#comment%3A10):\n> It's possible that this ticket should be reverted until a major bug it causes is fixed.\n> [...]\n> For the record, this is *not* how I meant the sage script is meant to be used.  I bet this isn't documented, but it should be.  The script should never be used that way.  Instead one should do\n> \n> ```\n> /home/sage$ cp /home/sage/sage-3.4-symlink/sage /home/tornaria/bin/sage\n> ```\n> and then edit the copied script to explicitly point to the ROOT.   It was never my intention for somebody to run the sage script unmodified outside of SAGE_ROOT.    Me not intending this means that elsewhere in the Sage build/test system this assumption is made, and the workaround on this ticket actually seriously breaks things for some users. \n\nIf you only use the script in *that* way, then the\n\n```\nif [ \"$SAGE_ROOT\" = \".....\" ];  then\n```\nbranch would never be taken, and as the patch in this ticket only touches this branch, it can't break anything.\n\nIn practice, it is much more convenient to just use a symlink to the script, if it can be worked out. Before this patch, it turned out that the real, canonical path for SAGE_ROOT could be identified incorrectly, and *this* causes doctesting to fail.\n\n> The change in this ticket causes serious breakage for people whose home directory is NFS mounted, and for which their Sage build is on another volume that is symlinked from their home directory. i.e., this sort of setup:\n> \n> ```\n>     cd ~wstein    # my home directory is NFS mounted.\n>     mkdir /tmp/wstein       # /tmp is a local disk\n>     ln -s /tmp/wstein sage-build\n>     cd sage-build    # \n>     # build sage here, doctesting fails completely\n> ```\n> \n> I'm doing a test build for myself to confirm that this happens, and if so and I can't figure out how to fix this promptly (maybe I will be able to), then we have to revert this change, and document that one can't just symlink the sage script out. \n\nThis sort of setup is *exactly* what used to cause breakage for me, because the `SAGE_ROOT` was incorrectly computed (to a non-canonical path). What would you expect `SAGE_ROOT` to be computed to, other than the canonical path? e.g., continuing your example above:\n\n```\n    cd ~wstein/sage-build\n    tar xvf sage-nnn.tar\n    cd sage-nnn\n    ./sage -sh\n    echo \"$SAGE_ROOT\"\n```\nAre you expecting SAGE_ROOT above to be \"/home/wstein/sage-build/sage-nnn/\", or \"/tmp/wstein/sage-nnn\" ?\n\nBefore the patch, it was the former, non canonical path; after the patch, it is the latter, which is IMO the correct canonical path. When SAGE_ROOT is non-canonical, running doctests for files in the sage library fails b/c they are not recognized as part of the sage library, etc.\n    \nI don't see how the fact that this is NFS mounted could be relevant to the issue.",
    "created_at": "2009-07-01T23:58:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37609",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@williamstein](#comment%3A10):
> It's possible that this ticket should be reverted until a major bug it causes is fixed.
> [...]
> For the record, this is *not* how I meant the sage script is meant to be used.  I bet this isn't documented, but it should be.  The script should never be used that way.  Instead one should do
> 
> ```
> /home/sage$ cp /home/sage/sage-3.4-symlink/sage /home/tornaria/bin/sage
> ```
> and then edit the copied script to explicitly point to the ROOT.   It was never my intention for somebody to run the sage script unmodified outside of SAGE_ROOT.    Me not intending this means that elsewhere in the Sage build/test system this assumption is made, and the workaround on this ticket actually seriously breaks things for some users. 

If you only use the script in *that* way, then the

```
if [ "$SAGE_ROOT" = "....." ];  then
```
branch would never be taken, and as the patch in this ticket only touches this branch, it can't break anything.

In practice, it is much more convenient to just use a symlink to the script, if it can be worked out. Before this patch, it turned out that the real, canonical path for SAGE_ROOT could be identified incorrectly, and *this* causes doctesting to fail.

> The change in this ticket causes serious breakage for people whose home directory is NFS mounted, and for which their Sage build is on another volume that is symlinked from their home directory. i.e., this sort of setup:
> 
> ```
>     cd ~wstein    # my home directory is NFS mounted.
>     mkdir /tmp/wstein       # /tmp is a local disk
>     ln -s /tmp/wstein sage-build
>     cd sage-build    # 
>     # build sage here, doctesting fails completely
> ```
> 
> I'm doing a test build for myself to confirm that this happens, and if so and I can't figure out how to fix this promptly (maybe I will be able to), then we have to revert this change, and document that one can't just symlink the sage script out. 

This sort of setup is *exactly* what used to cause breakage for me, because the `SAGE_ROOT` was incorrectly computed (to a non-canonical path). What would you expect `SAGE_ROOT` to be computed to, other than the canonical path? e.g., continuing your example above:

```
    cd ~wstein/sage-build
    tar xvf sage-nnn.tar
    cd sage-nnn
    ./sage -sh
    echo "$SAGE_ROOT"
```
Are you expecting SAGE_ROOT above to be "/home/wstein/sage-build/sage-nnn/", or "/tmp/wstein/sage-nnn" ?

Before the patch, it was the former, non canonical path; after the patch, it is the latter, which is IMO the correct canonical path. When SAGE_ROOT is non-canonical, running doctests for files in the sage library fails b/c they are not recognized as part of the sage library, etc.
    
I don't see how the fact that this is NFS mounted could be relevant to the issue.



---

archive/issue_comments_037610.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThe problem with this patch isn't that it is \"wrong\" (which is what you're arguing with me about above).  It is that it seriously breaks Sage, hence it must be reverted or the problem it causes must be fixed.  I had a look, and the problem is here in local/bin/sage-doctest:\n\n```\n        library_code = True\n        ext = os.path.splitext(argv[1])[1]\n        if ext in ['.spyx', '.sage'] or \\\n                 not (SAGE_ROOT.strip('/') + '/devel' in os.path.abspath(argv[1])):\n            library_code = False\n```\nThe problem is that the library_code variable is being set to False for all the code that *is* in the library.   It is being set to false because if one does\n\n```\n   sage -t \"/home/wstein/sage-build/sage-nnn/...\"\n```\nthen argv[1] is not first canonicalized, which messes everything up completely.\n\nSo for this ticket to be in (which I agree with at some point), one needs to factor out this path caonicalization, and make sure it is applied everywhere (e.g,. in sage-doctest).  There could be many other places where subtle problems arise -- I don't know. \n\nFor now, this needs to be reverted.",
    "created_at": "2009-07-04T11:43:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37610",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:12" align="right">comment:12</div>

The problem with this patch isn't that it is "wrong" (which is what you're arguing with me about above).  It is that it seriously breaks Sage, hence it must be reverted or the problem it causes must be fixed.  I had a look, and the problem is here in local/bin/sage-doctest:

```
        library_code = True
        ext = os.path.splitext(argv[1])[1]
        if ext in ['.spyx', '.sage'] or \
                 not (SAGE_ROOT.strip('/') + '/devel' in os.path.abspath(argv[1])):
            library_code = False
```
The problem is that the library_code variable is being set to False for all the code that *is* in the library.   It is being set to false because if one does

```
   sage -t "/home/wstein/sage-build/sage-nnn/..."
```
then argv[1] is not first canonicalized, which messes everything up completely.

So for this ticket to be in (which I agree with at some point), one needs to factor out this path caonicalization, and make sure it is applied everywhere (e.g,. in sage-doctest).  There could be many other places where subtle problems arise -- I don't know. 

For now, this needs to be reverted.



---

archive/issue_comments_037611.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI have reverted this patch in sage-4.1.rc0, and I'm reopening the ticket.",
    "created_at": "2009-07-04T19:57:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37611",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:13" align="right">comment:13</div>

I have reverted this patch in sage-4.1.rc0, and I'm reopening the ticket.



---

archive/issue_events_069321.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-07-04T19:57:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20distribution",
    "label_color": "0000b0",
    "label_name": "c: distribution",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69321"
}
```



---

archive/issue_events_069322.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-07-04T19:57:42Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69322"
}
```



---

archive/issue_events_069323.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-07-04T19:57:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69323"
}
```



---

archive/issue_events_069324.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2010-04-16T15:50:22Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "milestone_number": null,
    "milestone_title": "sage-4.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69324"
}
```



---

archive/issue_events_069325.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2010-04-16T15:50:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "milestone_number": null,
    "milestone_title": "sage-4.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69325"
}
```



---

archive/issue_comments_037612.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nHas the issue with `sage-doctest` been resolved?  The code now says\n\n```python\n        dev_path = os.path.realpath(os.path.join(SAGE_ROOT, 'devel'))\n        our_path = os.path.realpath(argv[1])\n\n        if not force_lib and (ext in ['.spyx', '.sage'] or\n                              not dev_path in our_path):\n            library_code = False\n```\nSince `os.path.realpath` is used twice, shouldn't this be okay?  If not, another option is to use [os.path.samefile](http://docs.python.org/library/os.path.html#os.path.samefile).",
    "created_at": "2011-08-19T03:46:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37612",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:15" align="right">comment:15</div>

Has the issue with `sage-doctest` been resolved?  The code now says

```python
        dev_path = os.path.realpath(os.path.join(SAGE_ROOT, 'devel'))
        our_path = os.path.realpath(argv[1])

        if not force_lib and (ext in ['.spyx', '.sage'] or
                              not dev_path in our_path):
            library_code = False
```
Since `os.path.realpath` is used twice, shouldn't this be okay?  If not, another option is to use [os.path.samefile](http://docs.python.org/library/os.path.html#os.path.samefile).



---

archive/issue_comments_037613.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -37,3 +37,5 @@\n \tsage -t  \"sage-3.4/devel/sage-main/sage/all.py\"\n Total time for all tests: 0.3 seconds\n ```\n+\n+Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.  See either #6146 or #11707 for a script which could be used for this.\n``````\n",
    "created_at": "2011-08-19T17:29:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37613",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -37,3 +37,5 @@
 	sage -t  "sage-3.4/devel/sage-main/sage/all.py"
 Total time for all tests: 0.3 seconds
 ```
+
+Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.  See either #6146 or #11707 for a script which could be used for this.
``````




---

archive/issue_events_069326.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-19T17:29:30Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "title_is": "The detection of SAGE_ROOT in $SAGE_ROOT/sage script should expand symlinks recursively",
    "title_was": "the detection of SAGE_ROOT in $SAGE_ROOT/sage script should expand symlinks recursively (fix this on systems that support readlink -f)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69326"
}
```



---

archive/issue_comments_037614.json:
```json
{
    "body": "Attachment: **[realpath_bash.sh.gz](https://github.com/sagemath/sage/files/ticket5852/realpath_bash.sh.gz)**\n\nShell script replacement for \"readlink -f\"",
    "created_at": "2011-08-19T17:31:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37614",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[realpath_bash.sh.gz](https://github.com/sagemath/sage/files/ticket5852/realpath_bash.sh.gz)**

Shell script replacement for "readlink -f"



---

archive/issue_comments_037615.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,7 @@\n-Currently, `$SAGE_ROOT/sage` uses (first among other alternate methods) `readlink -n` to detect the directory where the script lives (that's $SAGE_ROOT), but it should use `readlink -nf` to expand symlinks recursively.\n-\n-Otherwise, the symlink expansion may not be completely done, and `$SAGE_ROOT` could end up with a non-canonical dirname, which leads to issues with testing.\n+Currently, `$SAGE_ROOT/sage` uses (first among other alternate methods) `readlink -n` to detect the directory where the script lives (that's $SAGE_ROOT), but that is broken because\n+- It only works when `$0` (the sage executable itself) is a symbolic link\n+- If the sage executable is a symbolic link, then `readlink -n` returns the link itself, not the canonicalized name.  Example: if `/usr/local/sage-4.7.1/sage` is a symbolic link to `sagefoo`, then `SAGE_ROOT` would become `sagefoo` when `'/usr/local/sage-4.7.1/sagefoo` is intended.\n+- The symlink expansion may not be completely done, and `$SAGE_ROOT` could end up with a non-canonical dirname, which leads to issues with testing.\n \n Here's a way to reproduce an issue with the current script. For the example, my sage-3.4 installation lives in `/home/sage/sage-3.4`, and here's what happened to me:\n \n@@ -38,4 +39,4 @@\n Total time for all tests: 0.3 seconds\n ```\n \n-Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.  See either #6146 or #11707 for a script which could be used for this.\n+Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.  See attachments for two bash scripts to solve this problem (either of them should suffice).\n``````\n",
    "created_at": "2011-08-19T17:34:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37615",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,7 @@
-Currently, `$SAGE_ROOT/sage` uses (first among other alternate methods) `readlink -n` to detect the directory where the script lives (that's $SAGE_ROOT), but it should use `readlink -nf` to expand symlinks recursively.
-
-Otherwise, the symlink expansion may not be completely done, and `$SAGE_ROOT` could end up with a non-canonical dirname, which leads to issues with testing.
+Currently, `$SAGE_ROOT/sage` uses (first among other alternate methods) `readlink -n` to detect the directory where the script lives (that's $SAGE_ROOT), but that is broken because
+- It only works when `$0` (the sage executable itself) is a symbolic link
+- If the sage executable is a symbolic link, then `readlink -n` returns the link itself, not the canonicalized name.  Example: if `/usr/local/sage-4.7.1/sage` is a symbolic link to `sagefoo`, then `SAGE_ROOT` would become `sagefoo` when `'/usr/local/sage-4.7.1/sagefoo` is intended.
+- The symlink expansion may not be completely done, and `$SAGE_ROOT` could end up with a non-canonical dirname, which leads to issues with testing.
 
 Here's a way to reproduce an issue with the current script. For the example, my sage-3.4 installation lives in `/home/sage/sage-3.4`, and here's what happened to me:
 
@@ -38,4 +39,4 @@
 Total time for all tests: 0.3 seconds
 ```
 
-Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.  See either #6146 or #11707 for a script which could be used for this.
+Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.  See attachments for two bash scripts to solve this problem (either of them should suffice).
``````




---

archive/issue_events_069327.json:
```json
{
    "actor": "https://github.com/tornaria",
    "created_at": "2011-08-23T09:14:28Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "subject": "https://github.com/jdemeyer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69327"
}
```



---

archive/issue_events_069328.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-23T09:14:28Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "subject": "https://github.com/jdemeyer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69328"
}
```



---

archive/issue_comments_037616.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nWhy do we set `SAGE_ROOT` inside `sage-env`?  Given that `sage-env` is only ever called when we already know `SAGE_ROOT` (i.e. we do `source $SAGE_ROOT/local/bin/sage-env`).",
    "created_at": "2011-08-23T09:14:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37616",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

Why do we set `SAGE_ROOT` inside `sage-env`?  Given that `sage-env` is only ever called when we already know `SAGE_ROOT` (i.e. we do `source $SAGE_ROOT/local/bin/sage-env`).



---

archive/issue_comments_037617.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@jdemeyer](#comment%3A19):\n> Why do we set `SAGE_ROOT` inside `sage-env`?  Given that `sage-env` is only ever called when we already know `SAGE_ROOT` (i.e. we do `source $SAGE_ROOT/local/bin/sage-env`).\n\nOkay, I did find one counterexamples (I only looked in local/bin before):\n- The top-level Makefile calls `sage-env` without first setting `SAGE_ROOT`.\n\nI also noticed that `data/extcode/sage/ext/mac-app/start-sage.sh` has its own `SAGE_ROOT`-detecting code but it probably shouldn't and should use `sage-env` instead.",
    "created_at": "2011-08-23T09:24:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37617",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@jdemeyer](#comment%3A19):
> Why do we set `SAGE_ROOT` inside `sage-env`?  Given that `sage-env` is only ever called when we already know `SAGE_ROOT` (i.e. we do `source $SAGE_ROOT/local/bin/sage-env`).

Okay, I did find one counterexamples (I only looked in local/bin before):
- The top-level Makefile calls `sage-env` without first setting `SAGE_ROOT`.

I also noticed that `data/extcode/sage/ext/mac-app/start-sage.sh` has its own `SAGE_ROOT`-detecting code but it probably shouldn't and should use `sage-env` instead.



---

archive/issue_events_069329.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-23T09:25:36Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "title_is": "The detection of SAGE_ROOT in $SAGE_ROOT/sage and local/bin/sage-env should expand symlinks recursively",
    "title_was": "The detection of SAGE_ROOT in $SAGE_ROOT/sage script should expand symlinks recursively",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69329"
}
```



---

archive/issue_comments_037618.json:
```json
{
    "body": "Attachment: **[resolvelinks.sh.gz](https://github.com/sagemath/sage/files/ticket5852/resolvelinks.sh.gz)**\n\nShell script replacement for \"readlink -f\"",
    "created_at": "2011-08-23T12:01:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37618",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[resolvelinks.sh.gz](https://github.com/sagemath/sage/files/ticket5852/resolvelinks.sh.gz)**

Shell script replacement for "readlink -f"



---

archive/issue_events_069330.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-23T13:15:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69330"
}
```



---

archive/issue_events_069331.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-23T13:15:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69331"
}
```



---

archive/issue_comments_037619.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2011-08-23T13:18:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37619",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_037620.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,40 +3,8 @@\n - If the sage executable is a symbolic link, then `readlink -n` returns the link itself, not the canonicalized name.  Example: if `/usr/local/sage-4.7.1/sage` is a symbolic link to `sagefoo`, then `SAGE_ROOT` would become `sagefoo` when `'/usr/local/sage-4.7.1/sagefoo` is intended.\n - The symlink expansion may not be completely done, and `$SAGE_ROOT` could end up with a non-canonical dirname, which leads to issues with testing.\n \n-Here's a way to reproduce an issue with the current script. For the example, my sage-3.4 installation lives in `/home/sage/sage-3.4`, and here's what happened to me:\n+Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.  See attachments for two bash scripts to solve this problem (either of them should suffice).\n \n-```\n-/home/sage$ md5sum sage-3.4/sage\n-4153919efe1edcd34ad7fa193122d679  sage-3.4/sage\n-/home/sage$ ln -s sage-3.4 sage-3.4-symlink\n-/home/sage$ ln -sf /home/sage/sage-3.4-symlink/sage /home/tornaria/bin/sage\n-/home/sage$ type sage\n-sage is hashed (/home/tornaria/bin/sage)\n-/home/sage$ readlink `type -p sage`\n-/home/sage/sage-3.4-symlink/sage\n-/home/sage$ readlink -f `type -p sage`\n-/home/sage/sage-3.4/sage\n-```\n-\n-As you can see, `readlink -n` expands once but doesn't cannonicalize the path to the `sage` script. And here's the symptom:\n-\n-```\n-/home/sage$ sage -t sage-3.4/devel/sage-main/sage/all.py\n-sage -t  \"sage-3.4/devel/sage-main/sage/all.py\"             \n-  File \"./all.py\", line 18\n-    from sage-3.4/devel/sage-main/sage/all import *\n-             ^\n-SyntaxError: invalid syntax\n-\n-\t [0.3 s]\n-exit code: 1024\n- \n-----------------------------------------------------------------------\n-The following tests failed:\n-\n-\n-\tsage -t  \"sage-3.4/devel/sage-main/sage/all.py\"\n-Total time for all tests: 0.3 seconds\n-```\n-\n-Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.  See attachments for two bash scripts to solve this problem (either of them should suffice).\n+Apply:\n+1. [attachment: 5852_sage_root.patch](https://github.com/sagemath/sage/files/ticket5852/5852_sage_root.patch.gz) to `SAGE_ROOT`\n+2. [attachment: 5852_scripts.patch](https://github.com/sagemath/sage/files/ticket5852/5852_scripts.patch.gz) to `local/bin`\n``````\n",
    "created_at": "2011-08-23T13:18:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37620",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,40 +3,8 @@
 - If the sage executable is a symbolic link, then `readlink -n` returns the link itself, not the canonicalized name.  Example: if `/usr/local/sage-4.7.1/sage` is a symbolic link to `sagefoo`, then `SAGE_ROOT` would become `sagefoo` when `'/usr/local/sage-4.7.1/sagefoo` is intended.
 - The symlink expansion may not be completely done, and `$SAGE_ROOT` could end up with a non-canonical dirname, which leads to issues with testing.
 
-Here's a way to reproduce an issue with the current script. For the example, my sage-3.4 installation lives in `/home/sage/sage-3.4`, and here's what happened to me:
+Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.  See attachments for two bash scripts to solve this problem (either of them should suffice).
 
-```
-/home/sage$ md5sum sage-3.4/sage
-4153919efe1edcd34ad7fa193122d679  sage-3.4/sage
-/home/sage$ ln -s sage-3.4 sage-3.4-symlink
-/home/sage$ ln -sf /home/sage/sage-3.4-symlink/sage /home/tornaria/bin/sage
-/home/sage$ type sage
-sage is hashed (/home/tornaria/bin/sage)
-/home/sage$ readlink `type -p sage`
-/home/sage/sage-3.4-symlink/sage
-/home/sage$ readlink -f `type -p sage`
-/home/sage/sage-3.4/sage
-```
-
-As you can see, `readlink -n` expands once but doesn't cannonicalize the path to the `sage` script. And here's the symptom:
-
-```
-/home/sage$ sage -t sage-3.4/devel/sage-main/sage/all.py
-sage -t  "sage-3.4/devel/sage-main/sage/all.py"             
-  File "./all.py", line 18
-    from sage-3.4/devel/sage-main/sage/all import *
-             ^
-SyntaxError: invalid syntax
-
-	 [0.3 s]
-exit code: 1024
- 
-----------------------------------------------------------------------
-The following tests failed:
-
-
-	sage -t  "sage-3.4/devel/sage-main/sage/all.py"
-Total time for all tests: 0.3 seconds
-```
-
-Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.  See attachments for two bash scripts to solve this problem (either of them should suffice).
+Apply:
+1. [attachment: 5852_sage_root.patch](https://github.com/sagemath/sage/files/ticket5852/5852_sage_root.patch.gz) to `SAGE_ROOT`
+2. [attachment: 5852_scripts.patch](https://github.com/sagemath/sage/files/ticket5852/5852_scripts.patch.gz) to `local/bin`
``````




---

archive/issue_comments_037621.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,6 +2,7 @@\n - It only works when `$0` (the sage executable itself) is a symbolic link\n - If the sage executable is a symbolic link, then `readlink -n` returns the link itself, not the canonicalized name.  Example: if `/usr/local/sage-4.7.1/sage` is a symbolic link to `sagefoo`, then `SAGE_ROOT` would become `sagefoo` when `'/usr/local/sage-4.7.1/sagefoo` is intended.\n - The symlink expansion may not be completely done, and `$SAGE_ROOT` could end up with a non-canonical dirname, which leads to issues with testing.\n+- The code to detect `SAGE_ROOT` inside `sage-env` does not canonicalize the pathname at all.  This should be fixed as well. (The only case where `sage-env` is run without `SAGE_ROOT` being set is when testing Sage from the `Makefile`, i.e. when running `make ptest` or similar.)\n \n Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.  See attachments for two bash scripts to solve this problem (either of them should suffice).\n \n``````\n",
    "created_at": "2011-08-23T13:22:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37621",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,6 +2,7 @@
 - It only works when `$0` (the sage executable itself) is a symbolic link
 - If the sage executable is a symbolic link, then `readlink -n` returns the link itself, not the canonicalized name.  Example: if `/usr/local/sage-4.7.1/sage` is a symbolic link to `sagefoo`, then `SAGE_ROOT` would become `sagefoo` when `'/usr/local/sage-4.7.1/sagefoo` is intended.
 - The symlink expansion may not be completely done, and `$SAGE_ROOT` could end up with a non-canonical dirname, which leads to issues with testing.
+- The code to detect `SAGE_ROOT` inside `sage-env` does not canonicalize the pathname at all.  This should be fixed as well. (The only case where `sage-env` is run without `SAGE_ROOT` being set is when testing Sage from the `Makefile`, i.e. when running `make ptest` or similar.)
 
 Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.  See attachments for two bash scripts to solve this problem (either of them should suffice).
 
``````




---

archive/issue_comments_037622.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@jdemeyer](#comment%3A20):\n> I also noticed that `data/extcode/sage/ext/mac-app/start-sage.sh` has its own `SAGE_ROOT`-detecting code but it probably shouldn't and should use `sage-env` instead.\n\nIt seems the MacOS X app wants just the opposite, i.e. to **not** resolve symbolic links, since the absolute, canonicalized path may frequently change.\n\nTherefore it always creates (on start-up) the same, \"constant\" symbolic link from `/tmp/sage-mac-app` to the current, volatile `$SAGE_ROOT`, which can only work if the application is also actually *always* built in (a real directory) `/tmp/sage-mac-app/` (such that no change of hardcoded paths is necessary).\n\nCf. #11755. In that case, the app should also define some special environment variable, such that `sage-env` (and perhaps also `sage`) can treat this specifically, namely not canonicalize `$SAGE_ROOT`.",
    "created_at": "2011-08-29T10:13:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37622",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@jdemeyer](#comment%3A20):
> I also noticed that `data/extcode/sage/ext/mac-app/start-sage.sh` has its own `SAGE_ROOT`-detecting code but it probably shouldn't and should use `sage-env` instead.

It seems the MacOS X app wants just the opposite, i.e. to **not** resolve symbolic links, since the absolute, canonicalized path may frequently change.

Therefore it always creates (on start-up) the same, "constant" symbolic link from `/tmp/sage-mac-app` to the current, volatile `$SAGE_ROOT`, which can only work if the application is also actually *always* built in (a real directory) `/tmp/sage-mac-app/` (such that no change of hardcoded paths is necessary).

Cf. #11755. In that case, the app should also define some special environment variable, such that `sage-env` (and perhaps also `sage`) can treat this specifically, namely not canonicalize `$SAGE_ROOT`.



---

archive/issue_comments_037623.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@nexttime](#comment%3A25):\n> Replying to [@jdemeyer](#comment%3A20):\n> > I also noticed that `data/extcode/sage/ext/mac-app/start-sage.sh` has its own `SAGE_ROOT`-detecting code but it probably shouldn't and should use `sage-env` instead.\n\n> \n> It seems the MacOS X app wants just the opposite, i.e. to **not** resolve symbolic links, since the absolute, canonicalized path may frequently change.\n> \n> Therefore it always creates (on start-up) the same, \"constant\" symbolic link from `/tmp/sage-mac-app` to the current, volatile `$SAGE_ROOT`, which can only work if the application is also actually *always* built in (a real directory) `/tmp/sage-mac-app/` (such that no change of hardcoded paths is necessary).\n\nThe question is: why are things done this way?  It seems to me that the `/tmp/sage-mac-app` symlink is an ugly hack around a problem which can probably be solved in a better way.",
    "created_at": "2011-09-19T08:52:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37623",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@nexttime](#comment%3A25):
> Replying to [@jdemeyer](#comment%3A20):
> > I also noticed that `data/extcode/sage/ext/mac-app/start-sage.sh` has its own `SAGE_ROOT`-detecting code but it probably shouldn't and should use `sage-env` instead.

> 
> It seems the MacOS X app wants just the opposite, i.e. to **not** resolve symbolic links, since the absolute, canonicalized path may frequently change.
> 
> Therefore it always creates (on start-up) the same, "constant" symbolic link from `/tmp/sage-mac-app` to the current, volatile `$SAGE_ROOT`, which can only work if the application is also actually *always* built in (a real directory) `/tmp/sage-mac-app/` (such that no change of hardcoded paths is necessary).

The question is: why are things done this way?  It seems to me that the `/tmp/sage-mac-app` symlink is an ugly hack around a problem which can probably be solved in a better way.



---

archive/issue_comments_037624.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,8 @@\n \n Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.  See attachments for two bash scripts to solve this problem (either of them should suffice).\n \n+See also #11704, which solves the same problem for `DOT_SAGE`.\n+\n Apply:\n 1. [attachment: 5852_sage_root.patch](https://github.com/sagemath/sage/files/ticket5852/5852_sage_root.patch.gz) to `SAGE_ROOT`\n 2. [attachment: 5852_scripts.patch](https://github.com/sagemath/sage/files/ticket5852/5852_scripts.patch.gz) to `local/bin`\n``````\n",
    "created_at": "2011-09-26T20:55:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37624",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,8 @@
 
 Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.  See attachments for two bash scripts to solve this problem (either of them should suffice).
 
+See also #11704, which solves the same problem for `DOT_SAGE`.
+
 Apply:
 1. [attachment: 5852_sage_root.patch](https://github.com/sagemath/sage/files/ticket5852/5852_sage_root.patch.gz) to `SAGE_ROOT`
 2. [attachment: 5852_scripts.patch](https://github.com/sagemath/sage/files/ticket5852/5852_scripts.patch.gz) to `local/bin`
``````




---

archive/issue_events_069332.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-29T18:43:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20distribution",
    "label_color": "0000b0",
    "label_name": "c: distribution",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69332"
}
```



---

archive/issue_events_069333.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-29T18:43:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20scripts",
    "label_color": "0000b0",
    "label_name": "c: scripts",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69333"
}
```



---

archive/issue_events_069334.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-29T18:43:34Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69334"
}
```



---

archive/issue_events_069335.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-29T18:43:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69335"
}
```



---

archive/issue_events_069336.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-29T18:44:31Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "title_is": "Properly canonicalize $SAGE_ROOT",
    "title_was": "The detection of SAGE_ROOT in $SAGE_ROOT/sage and local/bin/sage-env should expand symlinks recursively",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69336"
}
```



---

archive/issue_comments_037625.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nWhat sense does it make to first call `resolvelinks()` and then finally do\n\n```sh\nSAGE_ROOT=`cd \"$SAGE_ROOT\" && pwd -P`\n```\n?\n\nAlso, why use all of `[ \"x$foo\" != \"x\" ]` (causing eye cancer), `[ -n \"$foo\" ]` and `[ \"$foo\" != \"\" ]`?\n\nFor `sage` at least, or any script that's run by `bash`, `[This is the Trac macro *-n $foo * that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#-n $foo -macro)` or `[This is the Trac macro *$foo != \"\" * that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#$foo != \"\" -macro)` does the job, and is by the way both safer and faster.",
    "created_at": "2011-10-30T05:58:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37625",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:31" align="right">comment:31</div>

What sense does it make to first call `resolvelinks()` and then finally do

```sh
SAGE_ROOT=`cd "$SAGE_ROOT" && pwd -P`
```
?

Also, why use all of `[ "x$foo" != "x" ]` (causing eye cancer), `[ -n "$foo" ]` and `[ "$foo" != "" ]`?

For `sage` at least, or any script that's run by `bash`, `[This is the Trac macro *-n $foo * that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#-n $foo -macro)` or `[This is the Trac macro *$foo != "" * that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#$foo != "" -macro)` does the job, and is by the way both safer and faster.



---

archive/issue_comments_037626.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@nexttime](#comment%3A31):\n> What sense does it make to first call `resolvelinks()` and then finally do\n> \n> ```sh\n> SAGE_ROOT=`cd \"$SAGE_ROOT\" && pwd -P`\n> ```\n> ?\n\nBecause `resolvelinks` resolves symbolic links in the `sage` executable name, which is not a directory (so the `cd && pwd` trick does not work).",
    "created_at": "2011-10-30T13:00:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37626",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@nexttime](#comment%3A31):
> What sense does it make to first call `resolvelinks()` and then finally do
> 
> ```sh
> SAGE_ROOT=`cd "$SAGE_ROOT" && pwd -P`
> ```
> ?

Because `resolvelinks` resolves symbolic links in the `sage` executable name, which is not a directory (so the `cd && pwd` trick does not work).



---

archive/issue_comments_037627.json:
```json
{
    "body": "Attachment: **[5852_sage_root.patch.gz](https://github.com/sagemath/sage/files/ticket5852/5852_sage_root.patch.gz)**\n\nPatch for $SAGE_ROOT/sage, SAGE_ROOT repository",
    "created_at": "2011-10-30T13:08:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37627",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[5852_sage_root.patch.gz](https://github.com/sagemath/sage/files/ticket5852/5852_sage_root.patch.gz)**

Patch for $SAGE_ROOT/sage, SAGE_ROOT repository



---

archive/issue_comments_037628.json:
```json
{
    "body": "Attachment: **[5852_scripts.patch.gz](https://github.com/sagemath/sage/files/ticket5852/5852_scripts.patch.gz)**\n\nPatch for local/bin/sage-env, SCRIPTS repository",
    "created_at": "2011-10-30T13:08:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37628",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[5852_scripts.patch.gz](https://github.com/sagemath/sage/files/ticket5852/5852_scripts.patch.gz)**

Patch for local/bin/sage-env, SCRIPTS repository



---

archive/issue_comments_037629.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@jdemeyer](#comment%3A32):\n> Replying to [@nexttime](#comment%3A31):\n> > What sense does it make to first call `resolvelinks()` and then finally do\n\n\n```sh\nSAGE_ROOT=`cd \"$SAGE_ROOT\" && pwd -P`\n```\n> > ?\n\n> Because `resolvelinks` resolves symbolic links in the `sage` executable name, which is not a directory (so the `cd && pwd` trick does not work).\n\nOf course it does.  You just have to\n* strip the program name, and\n* if no path remains after that, it's the current working directory, i.e. path=\".\".\n* `cd` to that path and do `pwd -P`.  Doesn't matter whether the path was relative or absolute.",
    "created_at": "2011-10-30T15:19:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37629",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@jdemeyer](#comment%3A32):
> Replying to [@nexttime](#comment%3A31):
> > What sense does it make to first call `resolvelinks()` and then finally do


```sh
SAGE_ROOT=`cd "$SAGE_ROOT" && pwd -P`
```
> > ?

> Because `resolvelinks` resolves symbolic links in the `sage` executable name, which is not a directory (so the `cd && pwd` trick does not work).

Of course it does.  You just have to
* strip the program name, and
* if no path remains after that, it's the current working directory, i.e. path=".".
* `cd` to that path and do `pwd -P`.  Doesn't matter whether the path was relative or absolute.



---

archive/issue_comments_037630.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@nexttime](#comment%3A33):\n> You just have to\n> * strip the program name, and\n> * if no path remains after that, it's the current working directory, i.e. path=\".\".\n> * `cd` to that path and do `pwd -P`.  Doesn't matter whether the path was relative or absolute.\n\nAgain, this does not work if the executable itself is a symbolic link.\n\nIt could very well be that my solution is too complicated, but your solution is certainly too simple.",
    "created_at": "2011-10-30T17:03:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37630",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@nexttime](#comment%3A33):
> You just have to
> * strip the program name, and
> * if no path remains after that, it's the current working directory, i.e. path=".".
> * `cd` to that path and do `pwd -P`.  Doesn't matter whether the path was relative or absolute.

Again, this does not work if the executable itself is a symbolic link.

It could very well be that my solution is too complicated, but your solution is certainly too simple.



---

archive/issue_comments_037631.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37631",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_events_069337.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-03T16:14:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69337"
}
```



---

archive/issue_events_069338.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-15T09:57:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69338"
}
```



---

archive/issue_comments_037632.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n - The symlink expansion may not be completely done, and `$SAGE_ROOT` could end up with a non-canonical dirname, which leads to issues with testing.\n - The code to detect `SAGE_ROOT` inside `sage-env` does not canonicalize the pathname at all.  This should be fixed as well. (The only case where `sage-env` is run without `SAGE_ROOT` being set is when testing Sage from the `Makefile`, i.e. when running `make ptest` or similar.)\n \n-Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.  See attachments for two bash scripts to solve this problem (either of them should suffice).\n+Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.\n \n See also #11704, which solves the same problem for `DOT_SAGE`.\n \n``````\n",
    "created_at": "2011-11-15T09:57:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37632",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 - The symlink expansion may not be completely done, and `$SAGE_ROOT` could end up with a non-canonical dirname, which leads to issues with testing.
 - The code to detect `SAGE_ROOT` inside `sage-env` does not canonicalize the pathname at all.  This should be fixed as well. (The only case where `sage-env` is run without `SAGE_ROOT` being set is when testing Sage from the `Makefile`, i.e. when running `make ptest` or similar.)
 
-Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.  See attachments for two bash scripts to solve this problem (either of them should suffice).
+Note that we should do this in a portable way, without using `realpath`, `readlink -f` or the likes.
 
 See also #11704, which solves the same problem for `DOT_SAGE`.
 
``````




---

archive/issue_comments_037633.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nHow widely available is `pwd -P`?  The GNU version of `pwd` does not recognize the `-P` option, but its man page says\n\n```\n       NOTE:  your shell may have its own version of pwd, which usually super\u2010\n       sedes the version described here.  Please refer to your  shell\u2019s  docu\u2010\n       mentation for details about the options it supports.\n```\nThis is what it says on sage.math, for example.  I use bash there, and the built-in pwd supports the `-P` option.  But do we need to worry about systems where there is no built-in pwd, and it is relying on the GNU version?  I have access to one such machine, and `pwd -P` doesn't work there, but I've never tried to build Sage on it.",
    "created_at": "2011-11-17T18:18:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37633",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:37" align="right">comment:37</div>

How widely available is `pwd -P`?  The GNU version of `pwd` does not recognize the `-P` option, but its man page says

```
       NOTE:  your shell may have its own version of pwd, which usually super‐
       sedes the version described here.  Please refer to your  shell’s  docu‐
       mentation for details about the options it supports.
```
This is what it says on sage.math, for example.  I use bash there, and the built-in pwd supports the `-P` option.  But do we need to worry about systems where there is no built-in pwd, and it is relying on the GNU version?  I have access to one such machine, and `pwd -P` doesn't work there, but I've never tried to build Sage on it.



---

archive/issue_comments_037634.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\n(Part of the problem is that on that other machine, I'm using tcsh and it doesn't let me run 'chsh'.)",
    "created_at": "2011-11-17T18:19:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37634",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:38" align="right">comment:38</div>

(Part of the problem is that on that other machine, I'm using tcsh and it doesn't let me run 'chsh'.)



---

archive/issue_comments_037635.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nHas this been tested on OS X 10.4?  I believe that uses an older version of bash, and so we should make sure that it has the features used in the modifications to the `sage` shell script.",
    "created_at": "2011-11-17T20:00:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37635",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:39" align="right">comment:39</div>

Has this been tested on OS X 10.4?  I believe that uses an older version of bash, and so we should make sure that it has the features used in the modifications to the `sage` shell script.



---

archive/issue_comments_037636.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nThis seems to work for me on various platforms.  If someone can test on OS X 10.4, I think we can give it a positive review.  (The Changelog I saw for bash doesn't discuss changes for expansions like `${pattern%word}` between versions 2 and 3 of bash, so I think it should work.)",
    "created_at": "2011-11-17T23:11:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37636",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:40" align="right">comment:40</div>

This seems to work for me on various platforms.  If someone can test on OS X 10.4, I think we can give it a positive review.  (The Changelog I saw for bash doesn't discuss changes for expansions like `${pattern%word}` between versions 2 and 3 of bash, so I think it should work.)



---

archive/issue_comments_037637.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@jhpalmieri](#comment%3A39):\n> Has this been tested on OS X 10.4?\n\nYes, it works.\n\nYou are right that `/bin/pwd` does not always support `-P`, even on sage.math:\n\n```\njdemeyer@sage:~$ /bin/pwd -P\n/bin/pwd: invalid option -- P\nTry `/bin/pwd --help' for more information.\n```\n\nBut it seems `bash` always supports `pwd -P` as shell builtin, so we are safe.",
    "created_at": "2011-11-18T08:28:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37637",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@jhpalmieri](#comment%3A39):
> Has this been tested on OS X 10.4?

Yes, it works.

You are right that `/bin/pwd` does not always support `-P`, even on sage.math:

```
jdemeyer@sage:~$ /bin/pwd -P
/bin/pwd: invalid option -- P
Try `/bin/pwd --help' for more information.
```

But it seems `bash` always supports `pwd -P` as shell builtin, so we are safe.



---

archive/issue_comments_037638.json:
```json
{
    "body": "Attachment: **[5852_doc.patch.gz](https://github.com/sagemath/sage/files/ticket5852/5852_doc.patch.gz)**",
    "created_at": "2011-11-18T09:09:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37638",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[5852_doc.patch.gz](https://github.com/sagemath/sage/files/ticket5852/5852_doc.patch.gz)**



---

archive/issue_comments_037639.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,3 +11,4 @@\n Apply:\n 1. [attachment: 5852_sage_root.patch](https://github.com/sagemath/sage/files/ticket5852/5852_sage_root.patch.gz) to `SAGE_ROOT`\n 2. [attachment: 5852_scripts.patch](https://github.com/sagemath/sage/files/ticket5852/5852_scripts.patch.gz) to `local/bin`\n+3. [attachment: 5852_doc.patch](https://github.com/sagemath/sage/files/ticket5852/5852_doc.patch.gz) to `devel/sage`\n``````\n",
    "created_at": "2011-11-18T09:09:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37639",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,3 +11,4 @@
 Apply:
 1. [attachment: 5852_sage_root.patch](https://github.com/sagemath/sage/files/ticket5852/5852_sage_root.patch.gz) to `SAGE_ROOT`
 2. [attachment: 5852_scripts.patch](https://github.com/sagemath/sage/files/ticket5852/5852_scripts.patch.gz) to `local/bin`
+3. [attachment: 5852_doc.patch](https://github.com/sagemath/sage/files/ticket5852/5852_doc.patch.gz) to `devel/sage`
``````




---

archive/issue_comments_037640.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nAdded documentation patch [attachment: 5852_doc.patch](https://github.com/sagemath/sage/files/ticket5852/5852_doc.patch.gz)",
    "created_at": "2011-11-18T09:09:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37640",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:42" align="right">comment:42</div>

Added documentation patch [attachment: 5852_doc.patch](https://github.com/sagemath/sage/files/ticket5852/5852_doc.patch.gz)



---

archive/issue_comments_037641.json:
```json
{
    "body": "Dependencies: **#11926, #11959**",
    "created_at": "2011-11-18T09:13:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37641",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#11926, #11959**



---

archive/issue_comments_037642.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,4 +11,4 @@\n Apply:\n 1. [attachment: 5852_sage_root.patch](https://github.com/sagemath/sage/files/ticket5852/5852_sage_root.patch.gz) to `SAGE_ROOT`\n 2. [attachment: 5852_scripts.patch](https://github.com/sagemath/sage/files/ticket5852/5852_scripts.patch.gz) to `local/bin`\n-3. [attachment: 5852_doc.patch](https://github.com/sagemath/sage/files/ticket5852/5852_doc.patch.gz) to `devel/sage`\n+3. [attachment: 5852_doc.patch](https://github.com/sagemath/sage/files/ticket5852/5852_doc.patch.gz) and [attachment: trac_5852-doc-referee.patch](https://github.com/sagemath/sage/files/ticket5852/trac_5852-doc-referee.patch.gz) to `devel/sage`\n``````\n",
    "created_at": "2011-11-23T17:49:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37642",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,4 +11,4 @@
 Apply:
 1. [attachment: 5852_sage_root.patch](https://github.com/sagemath/sage/files/ticket5852/5852_sage_root.patch.gz) to `SAGE_ROOT`
 2. [attachment: 5852_scripts.patch](https://github.com/sagemath/sage/files/ticket5852/5852_scripts.patch.gz) to `local/bin`
-3. [attachment: 5852_doc.patch](https://github.com/sagemath/sage/files/ticket5852/5852_doc.patch.gz) to `devel/sage`
+3. [attachment: 5852_doc.patch](https://github.com/sagemath/sage/files/ticket5852/5852_doc.patch.gz) and [attachment: trac_5852-doc-referee.patch](https://github.com/sagemath/sage/files/ticket5852/trac_5852-doc-referee.patch.gz) to `devel/sage`
``````




---

archive/issue_comments_037643.json:
```json
{
    "body": "Reviewer: **John Palmieri, Leif Leonhardy**",
    "created_at": "2011-11-23T17:49:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37643",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri, Leif Leonhardy**



---

archive/issue_comments_037644.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nThis looks good to me.  I'm attaching a referee patch for the documentation part.  If that's okay, this can be changed to \"positive review\".",
    "created_at": "2011-11-23T17:49:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37644",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:44" align="right">comment:44</div>

This looks good to me.  I'm attaching a referee patch for the documentation part.  If that's okay, this can be changed to "positive review".



---

archive/issue_comments_037645.json:
```json
{
    "body": "Attachment: **[trac_5852-doc-referee.patch.gz](https://github.com/sagemath/sage/files/ticket5852/trac_5852-doc-referee.patch.gz)**\n\nmain sage repo",
    "created_at": "2011-11-23T17:50:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37645",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[trac_5852-doc-referee.patch.gz](https://github.com/sagemath/sage/files/ticket5852/trac_5852-doc-referee.patch.gz)**

main sage repo



---

archive/issue_events_069339.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-23T20:59:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69339"
}
```



---

archive/issue_events_069340.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-23T20:59:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69340"
}
```



---

archive/issue_comments_037646.json:
```json
{
    "body": "Merged: **sage-4.8.alpha3**",
    "created_at": "2011-11-26T09:34:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5852#issuecomment-37646",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.8.alpha3**



---

archive/issue_events_069341.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-26T10:31:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69341"
}
```



---

archive/issue_events_069342.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-26T10:31:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/5852",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5852#event-69342"
}
```
