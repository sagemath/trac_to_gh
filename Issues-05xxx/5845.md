# Issue 5845: Fix precision bug in hilbert_class_polynomial()

archive/issues_005845.json:
```json
{
    "body": "The code introduced in #4990 uses an incorrect precision bound in a paper of Enge.  Enge has supplied a corrected bound, and the code fixed to use it.  At the same time, \n* The code has been extended to non-fundamental discriminants\n* It has been moved to sage/schemes/elliptic_curves/cm.py which had a similar function requiring Magma;  the method for number fields now calls this.\n* The function elliptic_j has been added to sage/functions/special.py\n* A new method is_primitive() has been added for integral binary quadratic forms, as well as a primitive_only flag to the function `BinaryQF_reduced_representatives`.\n* Last but not least, sage/schemes/elliptic_curves/cm.py has been ReST-ified and added to the reference manual\n\nThis started out as just a conversion of one small file with only 3 functions in it to ReST!\n\n**Keywords:** hilbert class polynomial quadratic form\n\n**Author:** John Cremona\n\n**Reviewer:** Alex Ghitza, Jim Stankewicz\n\n**Merged:** 4.0.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/5845\n\n",
    "closed_at": "2009-06-13T21:12:28Z",
    "created_at": "2009-04-21T10:41:47Z",
    "labels": [
        "component: algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.0.2",
    "title": "Fix precision bug in hilbert_class_polynomial()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/5845",
    "user": "https://github.com/JohnCremona"
}
```
The code introduced in #4990 uses an incorrect precision bound in a paper of Enge.  Enge has supplied a corrected bound, and the code fixed to use it.  At the same time, 
* The code has been extended to non-fundamental discriminants
* It has been moved to sage/schemes/elliptic_curves/cm.py which had a similar function requiring Magma;  the method for number fields now calls this.
* The function elliptic_j has been added to sage/functions/special.py
* A new method is_primitive() has been added for integral binary quadratic forms, as well as a primitive_only flag to the function `BinaryQF_reduced_representatives`.
* Last but not least, sage/schemes/elliptic_curves/cm.py has been ReST-ified and added to the reference manual

This started out as just a conversion of one small file with only 3 functions in it to ReST!

**Keywords:** hilbert class polynomial quadratic form

**Author:** John Cremona

**Reviewer:** Alex Ghitza, Jim Stankewicz

**Merged:** 4.0.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/5845





---

archive/issue_comments_039628.json:
```json
{
    "body": "Applies to 3.4.1.rc4",
    "created_at": "2009-04-21T10:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5845#issuecomment-39628",
    "user": "https://github.com/JohnCremona"
}
```

Applies to 3.4.1.rc4



---

archive/issue_events_038308.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2009-04-21T10:47:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5845#event-38308"
}
```



---

archive/attachments_006737.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_5845.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket5845/trac_5845.patch",
    "created_at": "2009-04-21T10:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/JohnCremona"
}
```



---

archive/issue_comments_039629.json:
```json
{
    "body": "<a id='comment:1'></a>\n",
    "created_at": "2009-04-21T10:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5845#issuecomment-39629",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:1'></a>




---

archive/issue_events_038309.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-04-23T07:59:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "milestone": "sage-3.4.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5845#event-38309"
}
```



---

archive/issue_comments_039630.json:
```json
{
    "body": "<a id='comment:3'></a>\nAll doctests pass. It works very well and is a sorely needed addition to sage.\n\nOne minor point: In the patch the paper of Enge calls for a constant of log(2*10.163) while the code has a typo which sets this constant to log(2*10.63). This makes no difference whatsoever in the output of the program(indeed there's no difference in the operation of the code for h<~24) but it's worth noting.",
    "created_at": "2009-05-23T17:45:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5845#issuecomment-39630",
    "user": "https://trac.sagemath.org/admin/accounts/users/stankewicz"
}
```

<a id='comment:3'></a>
All doctests pass. It works very well and is a sorely needed addition to sage.

One minor point: In the patch the paper of Enge calls for a constant of log(2*10.163) while the code has a typo which sets this constant to log(2*10.63). This makes no difference whatsoever in the output of the program(indeed there's no difference in the operation of the code for h<~24) but it's worth noting.



---

archive/issue_events_038310.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/stankewicz",
    "created_at": "2009-05-23T17:45:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5845#event-38310"
}
```



---

archive/issue_events_038311.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/stankewicz",
    "created_at": "2009-05-23T17:45:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5845#event-38311"
}
```



---

archive/issue_comments_039631.json:
```json
{
    "body": "<a id='comment:4'></a>\nThanks for the report.  I don't have access to Enge's paper at the moment but I'll see him in person tomorrow so I can perhaps check up on that type (recall that one of his papers had a lot of typos in it, and I took the \"official\" bounds from correspondence with him).",
    "created_at": "2009-05-23T18:49:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5845#issuecomment-39631",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:4'></a>
Thanks for the report.  I don't have access to Enge's paper at the moment but I'll see him in person tomorrow so I can perhaps check up on that type (recall that one of his papers had a lot of typos in it, and I took the "official" bounds from correspondence with him).



---

archive/issue_events_038312.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-06-01T04:28:14Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "rename": {
        "from": "Fix precision bug in hilbert_class_polynomial()",
        "to": "[needs rebase] Fix precision bug in hilbert_class_polynomial()"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5845#event-38312"
}
```



---

archive/issue_comments_039632.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis needs to rebased against 4.0 since functions/special.py has changed.  The elliptic_j function should be written to match those.",
    "created_at": "2009-06-01T04:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5845#issuecomment-39632",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:5'></a>
This needs to rebased against 4.0 since functions/special.py has changed.  The elliptic_j function should be written to match those.



---

archive/issue_comments_039633.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [mhansen](#comment%3A5):\n> This needs to rebased against 4.0 since functions/special.py has changed.  The elliptic_j function should be written to match those.\n\nWill do -- John",
    "created_at": "2009-06-01T08:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5845#issuecomment-39633",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:6'></a>
Replying to [mhansen](#comment%3A5):
> This needs to rebased against 4.0 since functions/special.py has changed.  The elliptic_j function should be written to match those.

Will do -- John



---

archive/attachments_006738.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_5845_rebase.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket5845/trac_5845_rebase.patch",
    "created_at": "2009-06-01T08:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/JohnCremona"
}
```



---

archive/issue_comments_039634.json:
```json
{
    "body": "Rebased to 4.0 (replace previous)",
    "created_at": "2009-06-01T08:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5845#issuecomment-39634",
    "user": "https://github.com/JohnCremona"
}
```

Rebased to 4.0 (replace previous)



---

archive/issue_events_038313.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2009-06-01T08:22:45Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "rename": {
        "from": "[needs rebase] Fix precision bug in hilbert_class_polynomial()",
        "to": "[with rebased patch] Fix precision bug in hilbert_class_polynomial()"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5845#event-38313"
}
```



---

archive/issue_events_038314.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2009-06-01T08:22:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5845#event-38314"
}
```



---

archive/issue_events_038315.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2009-06-01T08:22:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5845#event-38315"
}
```



---

archive/issue_comments_039635.json:
```json
{
    "body": "<a id='comment:7'></a>\nI have done the rebasing -- not sure whether it's ok to put back \"with positive review\" to I have marked it \"needs review\" again.",
    "created_at": "2009-06-01T08:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5845#issuecomment-39635",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:7'></a>
I have done the rebasing -- not sure whether it's ok to put back "with positive review" to I have marked it "needs review" again.



---

archive/issue_events_038316.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-06-01T11:15:05Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "rename": {
        "from": "[with rebased patch] Fix precision bug in hilbert_class_polynomial()",
        "to": "Fix precision bug in hilbert_class_polynomial()"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5845#event-38316"
}
```



---

archive/issue_events_038317.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-06-01T11:15:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5845#event-38317"
}
```



---

archive/issue_events_038318.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-06-01T11:15:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5845#event-38318"
}
```



---

archive/issue_comments_039636.json:
```json
{
    "body": "<a id='comment:8'></a>\nGood.",
    "created_at": "2009-06-01T11:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5845#issuecomment-39636",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:8'></a>
Good.



---

archive/issue_events_038319.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-13T21:12:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5845#event-38319"
}
```



---

archive/issue_events_038320.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-13T21:12:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5845#event-38320"
}
```



---

archive/issue_comments_039637.json:
```json
{
    "body": "**Reviewer:** Alex Ghitza, Jim Stankewicz",
    "created_at": "2009-06-13T21:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5845#issuecomment-39637",
    "user": "https://github.com/ncalexan"
}
```

**Reviewer:** Alex Ghitza, Jim Stankewicz



---

archive/issue_comments_039638.json:
```json
{
    "body": "**Author:** John Cremona",
    "created_at": "2009-06-13T21:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5845#issuecomment-39638",
    "user": "https://github.com/ncalexan"
}
```

**Author:** John Cremona



---

archive/issue_comments_039639.json:
```json
{
    "body": "**Merged:** 4.0.2.alpha0",
    "created_at": "2009-06-13T21:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5845#issuecomment-39639",
    "user": "https://github.com/ncalexan"
}
```

**Merged:** 4.0.2.alpha0
