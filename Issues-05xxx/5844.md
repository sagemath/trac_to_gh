# Issue 5844: Improvement of PermutationGroup_generic.has_element() and is_subgroup

archive/issues_005844.json:
```json
{
    "body": "The old version of `PermutationGroup_generic.has_element(self,item)` is\n\n```\n        item = PermutationGroupElement(item, self, check=False)\n        return item in self.list()\n```\n\nHence, the whole list of elements must be created! Instead, I suggest to invoke `PermutationGroup_generic.__contains__()`, hence:\n\n```\n        item = PermutationGroupElement(item, self, check=False)\n        return item in self\n```\nThe only difference between `has_element` and `__contains__` then is that the former may raise an error if one can not make a `PermutationGroupElement` out of the item.\n\nThe performance considerably improves. The following are indirect examples, since the method `is_subgroup()` calls `has_element`.\nWith the patch, one has:\n\n```\nsage: G=SymmetricGroup(7)\nsage: H=SymmetricGroup(6)\nsage: H.is_subgroup(G)\nTrue\nsage: timeit('H.is_subgroup(G)')\n625 loops, best of 3: 50.5 \u00c2\u00b5s per loop\n```\n\nTo my surprise, Gap is slower:\n\n```\nsage: timeit('gap(H).IsSubgroup(gap(G))')\n5 loops, best of 3: 1.55 ms per loop\n```\n\nWithout the patch, the computation is *very* slow:\n\n```\nsage: time H.is_subgroup(G)\nCPU times: user 3.94 s, sys: 0.51 s, total: 4.45 s\nWall time: 4.80 s\nTrue\n```\n\nLast, I'd like to demonstrate the difference between `has_element()` and `__contains__()`:\n\n```\nsage: 1 in G\nTrue  # since G(1) is the trivial permutation\nsage: G.has_element(1) \nERROR: An unexpected error occurred while tokenizing input\n...\nTypeError: 'sage.rings.integer.Integer' object is not iterable\n```\nThe latter is what happens when trying conversion of 1 into a `PermutationGroupElement`.\n\n__Conclusion__:\n\nThe change that I made is very small but yields a huge improvement. However, what was the original reason to write `has_element` in that way? Does `g in G` sometimes return an answer different from `g in G.list()`, if g is a `PermutationGroupElement`?\n\n**Assignee:** @simon-king-jena\n\n**Keywords:** PermutationGroup has_element is_subgroup\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/5844\n\n",
    "closed_at": "2009-05-13T19:05:31Z",
    "created_at": "2009-04-21T09:29:03Z",
    "labels": [
        "component: group theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.0",
    "title": "Improvement of PermutationGroup_generic.has_element() and is_subgroup",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/5844",
    "user": "https://github.com/simon-king-jena"
}
```
The old version of `PermutationGroup_generic.has_element(self,item)` is

```
        item = PermutationGroupElement(item, self, check=False)
        return item in self.list()
```

Hence, the whole list of elements must be created! Instead, I suggest to invoke `PermutationGroup_generic.__contains__()`, hence:

```
        item = PermutationGroupElement(item, self, check=False)
        return item in self
```
The only difference between `has_element` and `__contains__` then is that the former may raise an error if one can not make a `PermutationGroupElement` out of the item.

The performance considerably improves. The following are indirect examples, since the method `is_subgroup()` calls `has_element`.
With the patch, one has:

```
sage: G=SymmetricGroup(7)
sage: H=SymmetricGroup(6)
sage: H.is_subgroup(G)
True
sage: timeit('H.is_subgroup(G)')
625 loops, best of 3: 50.5 Âµs per loop
```

To my surprise, Gap is slower:

```
sage: timeit('gap(H).IsSubgroup(gap(G))')
5 loops, best of 3: 1.55 ms per loop
```

Without the patch, the computation is *very* slow:

```
sage: time H.is_subgroup(G)
CPU times: user 3.94 s, sys: 0.51 s, total: 4.45 s
Wall time: 4.80 s
True
```

Last, I'd like to demonstrate the difference between `has_element()` and `__contains__()`:

```
sage: 1 in G
True  # since G(1) is the trivial permutation
sage: G.has_element(1) 
ERROR: An unexpected error occurred while tokenizing input
...
TypeError: 'sage.rings.integer.Integer' object is not iterable
```
The latter is what happens when trying conversion of 1 into a `PermutationGroupElement`.

__Conclusion__:

The change that I made is very small but yields a huge improvement. However, what was the original reason to write `has_element` in that way? Does `g in G` sometimes return an answer different from `g in G.list()`, if g is a `PermutationGroupElement`?

**Assignee:** @simon-king-jena

**Keywords:** PermutationGroup has_element is_subgroup

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/5844





---

archive/issue_comments_055498.json:
```json
{
    "body": "Improved performance of has_element and thus of is_subgroup",
    "created_at": "2009-04-21T09:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55498",
    "user": "https://github.com/simon-king-jena"
}
```

Improved performance of has_element and thus of is_subgroup



---

archive/issue_comments_055499.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -13,7 +13,7 @@\n ```\n The only difference between `has_element` and `__contains__` then is that the former may raise an error if one can not make a `PermutationGroupElement` out of the item.\n \n-The performance considerably improves. Here are indirect. The method `is_subgroup()` calls `has_element`.\n+The performance considerably improves. The following are indirect examples, since the method `is_subgroup()` calls `has_element`.\n With the patch, one has:\n \n ```\n``````\n",
    "created_at": "2009-04-21T09:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55499",
    "user": "https://github.com/simon-king-jena"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -13,7 +13,7 @@
 ```
 The only difference between `has_element` and `__contains__` then is that the former may raise an error if one can not make a `PermutationGroupElement` out of the item.
 
-The performance considerably improves. Here are indirect. The method `is_subgroup()` calls `has_element`.
+The performance considerably improves. The following are indirect examples, since the method `is_subgroup()` calls `has_element`.
 With the patch, one has:
 
 ```
``````




---

archive/issue_comments_055500.json:
```json
{
    "body": "<a id='comment:1'></a>\nAttachment [PermutationGroup_has_element.patch](tarball://root/attachments/some-uuid/ticket5844/PermutationGroup_has_element.patch) by @simon-king-jena created at 2009-04-21 09:45:02",
    "created_at": "2009-04-21T09:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55500",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:1'></a>
Attachment [PermutationGroup_has_element.patch](tarball://root/attachments/some-uuid/ticket5844/PermutationGroup_has_element.patch) by @simon-king-jena created at 2009-04-21 09:45:02



---

archive/issue_comments_055501.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2009-04-21T19:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55501",
    "user": "https://github.com/wdjoyner"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_055502.json:
```json
{
    "body": "<a id='comment:3'></a>\nI got doc-test failures in these modules:\n\n```\n        sage -t  \"devel/sage/sage/groups/perm_gps/permgroup.py\"\n        sage -t  \"devel/sage/sage/groups/abelian_gps/abelian_group.py\"\n        sage -t  \"devel/sage/sage/groups/abelian_gps/abelian_group_element.py\"\n        sage -t  \"devel/sage/sage/groups/class_function.py\"\n```\n\nI'm using gap4.4.10 but the error in permgroup.py seems to\nbe a result of this patch.",
    "created_at": "2009-04-21T19:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55502",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:3'></a>
I got doc-test failures in these modules:

```
        sage -t  "devel/sage/sage/groups/perm_gps/permgroup.py"
        sage -t  "devel/sage/sage/groups/abelian_gps/abelian_group.py"
        sage -t  "devel/sage/sage/groups/abelian_gps/abelian_group_element.py"
        sage -t  "devel/sage/sage/groups/class_function.py"
```

I'm using gap4.4.10 but the error in permgroup.py seems to
be a result of this patch.



---

archive/issue_events_017748.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "rename": {
        "from": "Improvement of {{{PermutationGroup_generic.has_element()}}} and {{{is_subgroup}}}",
        "to": "Improvement of PermutationGroup_generic.has_element() and is_subgroup"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5844#event-17748"
}
```



---

archive/issue_comments_055503.json:
```json
{
    "body": "**Changing status** from needs_work to needs_work.",
    "created_at": "2009-04-21T22:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55503",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing status** from needs_work to needs_work.



---

archive/issue_comments_055504.json:
```json
{
    "body": "<a id='comment:4'></a>\nWiki text has no effect in the summary, so change it.\n\nCheers,\n\nMichael",
    "created_at": "2009-04-21T22:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55504",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:4'></a>
Wiki text has no effect in the summary, so change it.

Cheers,

Michael



---

archive/issue_comments_055505.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [wdj](#comment%3A3):\n> I got doc-test failures in these modules:\n> ...\n\n\nHere is the reason:\n\n```\nG.has_element()}}} first turns the input {{{item}}} into a {{{PermutationGroupElement}}} with parent {{{G}}}, using {{{check=False}}}. So, from now on, the parent of {{{item}}} is {{{G}}}.\n\nThe old version then tests if it is contained in the list of elements. The new version tests whether {{{item in G}}}. The problem is that {{{item in G}}} just tries {{{PermutationGroupElement(item,G,check=True)}}} -- if there is an error then False is returned. \n\nBut at that point, the parent of {{{item}}} is {{{G}}}, hence, {{{PermutationGroupElement(item,G,check=True)}}} does not raise an error, and True is returned!\n\nAnyway. What was the reason to implement {{{has_element}}}? What is the purpose of it, in contrast to {{{__contains__}}}? \n\nIf both are just tests for containment then {{{has_element}}} should be removed, respectively should be an alias for {{{__contains__}}}.",
    "created_at": "2009-04-22T07:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55505",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>
Replying to [wdj](#comment%3A3):
> I got doc-test failures in these modules:
> ...


Here is the reason:

```
G.has_element()}}} first turns the input {{{item}}} into a {{{PermutationGroupElement}}} with parent {{{G}}}, using {{{check=False}}}. So, from now on, the parent of {{{item}}} is {{{G}}}.

The old version then tests if it is contained in the list of elements. The new version tests whether {{{item in G}}}. The problem is that {{{item in G}}} just tries {{{PermutationGroupElement(item,G,check=True)}}} -- if there is an error then False is returned. 

But at that point, the parent of {{{item}}} is {{{G}}}, hence, {{{PermutationGroupElement(item,G,check=True)}}} does not raise an error, and True is returned!

Anyway. What was the reason to implement {{{has_element}}}? What is the purpose of it, in contrast to {{{__contains__}}}? 

If both are just tests for containment then {{{has_element}}} should be removed, respectively should be an alias for {{{__contains__}}}.



---

archive/issue_comments_055506.json:
```json
{
    "body": "Attachment [PermutationGroup_has_element2.patch](tarball://root/attachments/some-uuid/ticket5844/PermutationGroup_has_element2.patch) by @simon-king-jena created at 2009-04-22 07:50:52\n\nReplace has_element by __contains__",
    "created_at": "2009-04-22T07:50:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55506",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment [PermutationGroup_has_element2.patch](tarball://root/attachments/some-uuid/ticket5844/PermutationGroup_has_element2.patch) by @simon-king-jena created at 2009-04-22 07:50:52

Replace has_element by __contains__



---

archive/issue_comments_055507.json:
```json
{
    "body": "<a id='comment:6'></a>\nOK, here is a second patch, to be applied after the first. With it, all above-mentioned doc tests pass. Now, `G.has_element(x)` just returns `x in G`\n\nNote that above I pointed out one difference between the old version of `has_element()` and `__contains__()`: In the old version, `G.has_element(1)` raised an error. Now, it does not, since `G.__contains__(1)` interpretes 1 as the trivial group element.\n\nBut, as much as I understand, this is the only mathematical difference between the old and the new version.",
    "created_at": "2009-04-22T07:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55507",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'></a>
OK, here is a second patch, to be applied after the first. With it, all above-mentioned doc tests pass. Now, `G.has_element(x)` just returns `x in G`

Note that above I pointed out one difference between the old version of `has_element()` and `__contains__()`: In the old version, `G.has_element(1)` raised an error. Now, it does not, since `G.__contains__(1)` interpretes 1 as the trivial group element.

But, as much as I understand, this is the only mathematical difference between the old and the new version.



---

archive/issue_comments_055508.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2009-04-22T07:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55508",
    "user": "https://github.com/simon-king-jena"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_055509.json:
```json
{
    "body": "<a id='comment:8'></a>\nApplies to 3.4.1.rc3 and seems to pass all tests (my copy has massive failures both due to the gap interface and the maxima interface, but these seem unrelated to these patches).\n\nPostive. Review. Thanks Simon and sorry for the delay - it's the end of the semester here...",
    "created_at": "2009-04-25T00:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55509",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:8'></a>
Applies to 3.4.1.rc3 and seems to pass all tests (my copy has massive failures both due to the gap interface and the maxima interface, but these seem unrelated to these patches).

Postive. Review. Thanks Simon and sorry for the delay - it's the end of the semester here...



---

archive/issue_comments_055510.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2009-04-25T00:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55510",
    "user": "https://github.com/wdjoyner"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_055511.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [wdj](#comment%3A8):\n\nHi David,\n\n> Applies to 3.4.1.rc3 and seems to pass all tests (my copy has massive failures both due to the gap interface and the maxima interface, but these seem unrelated to these patches).\n\n\nWhy don't you doctest on sage.math? You can do it in parallel, there is *always* a binary and it works unless otherwise noted in the release notes.\n\n> Postive. Review. Thanks Simon and sorry for the delay - it's the end of the semester here...\n\n\nDo not give positive reviews to any ticket that does not pass doctests, even if you assume it is unrelated to failures you see. The whole point of doctesting is to also verify that no side effects cause any trouble and given that you see GAP failures I cannot honestly see how this patch could not potentially cause trouble here. \n\nI am doctesting this patch against my current merge tree to see if there are any issues.\n\nCheers,\n\nMichael",
    "created_at": "2009-04-25T01:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55511",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:9'></a>
Replying to [wdj](#comment%3A8):

Hi David,

> Applies to 3.4.1.rc3 and seems to pass all tests (my copy has massive failures both due to the gap interface and the maxima interface, but these seem unrelated to these patches).


Why don't you doctest on sage.math? You can do it in parallel, there is *always* a binary and it works unless otherwise noted in the release notes.

> Postive. Review. Thanks Simon and sorry for the delay - it's the end of the semester here...


Do not give positive reviews to any ticket that does not pass doctests, even if you assume it is unrelated to failures you see. The whole point of doctesting is to also verify that no side effects cause any trouble and given that you see GAP failures I cannot honestly see how this patch could not potentially cause trouble here. 

I am doctesting this patch against my current merge tree to see if there are any issues.

Cheers,

Michael



---

archive/issue_comments_055512.json:
```json
{
    "body": "<a id='comment:10'></a>\nFor the record: The two patches merge in 3.4.2.a0 and pass all doctests on sage.math.\n\nCheers,\n\nMichael",
    "created_at": "2009-04-25T02:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55512",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:10'></a>
For the record: The two patches merge in 3.4.2.a0 and pass all doctests on sage.math.

Cheers,

Michael



---

archive/issue_comments_055513.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [mabshoff](#comment%3A10):\n> For the record: The two patches merge in 3.4.2.a0 and pass all doctests on sage.math.\n\n\nShouldn't the ticket be closed, then? \n\nCheers,\n Simon",
    "created_at": "2009-04-26T10:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55513",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:11'></a>
Replying to [mabshoff](#comment%3A10):
> For the record: The two patches merge in 3.4.2.a0 and pass all doctests on sage.math.


Shouldn't the ticket be closed, then? 

Cheers,
 Simon



---

archive/issue_comments_055514.json:
```json
{
    "body": "<a id='comment:12'></a>\n> Shouldn't the ticket be closed, then? \n\n\nWell, I did not merge the patches yet, so no.\n \n> Cheers,\n>  Simon\n\n\nCheers,\n\nMichael",
    "created_at": "2009-04-26T10:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55514",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:12'></a>
> Shouldn't the ticket be closed, then? 


Well, I did not merge the patches yet, so no.
 
> Cheers,
>  Simon


Cheers,

Michael



---

archive/issue_events_017749.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-05-13T19:05:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "milestone": "sage-4.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5844#event-17749"
}
```



---

archive/issue_events_017750.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-05-13T19:05:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5844#event-17750"
}
```



---

archive/issue_comments_055515.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2009-05-13T19:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55515",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Resolution:** fixed



---

archive/issue_comments_055516.json:
```json
{
    "body": "<a id='comment:13'></a>\nMerged both patches in Sage 4.0.alpha0.\n\nCheers,\n\nMichael",
    "created_at": "2009-05-13T19:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5844#issuecomment-55516",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:13'></a>
Merged both patches in Sage 4.0.alpha0.

Cheers,

Michael
