# Issue 5263: publishing a worksheet displays the URL without the hostname

archive/issues_005263.json:
```json
{
    "body": "When I publish a worksheet on sagenb.org, it says I can find the sheet at: http://:8000/home/pub/243\n\nOf course, this is silly nonsense.\n\nIt might have to do with starting the notebook with address='', maybe?\n\n**Assignee:** boothby\n\n**CC:**  @kcrisman @williamstein @qed777\n\n**Author:** Tim Dumol\n\n**Reviewer:** Mitesh Patel\n\n**Merged:** sagenb-0.7\n\nIssue created by migration from https://trac.sagemath.org/ticket/5263\n\n",
    "closed_at": "2010-01-25T00:52:12Z",
    "created_at": "2009-02-14T02:16:51Z",
    "labels": [
        "component: notebook",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3.2",
    "title": "publishing a worksheet displays the URL without the hostname",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/5263",
    "user": "https://github.com/jasongrout"
}
```
When I publish a worksheet on sagenb.org, it says I can find the sheet at: http://:8000/home/pub/243

Of course, this is silly nonsense.

It might have to do with starting the notebook with address='', maybe?

**Assignee:** boothby

**CC:**  @kcrisman @williamstein @qed777

**Author:** Tim Dumol

**Reviewer:** Mitesh Patel

**Merged:** sagenb-0.7

Issue created by migration from https://trac.sagemath.org/ticket/5263





---

archive/issue_comments_043213.json:
```json
{
    "body": "<a id='comment:1'></a>\nYes it does use address. I just discovered that on my computer if I set address='sagenb.org' then I can't start the notebook.",
    "created_at": "2009-02-14T12:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5263#issuecomment-43213",
    "user": "https://trac.sagemath.org/admin/accounts/users/TimothyClemans"
}
```

<a id='comment:1'></a>
Yes it does use address. I just discovered that on my computer if I set address='sagenb.org' then I can't start the notebook.



---

archive/issue_comments_043214.json:
```json
{
    "body": "<a id='comment:2'></a>\n#5675 appears to be a duplicate, but with wider scope.",
    "created_at": "2009-08-10T09:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5263#issuecomment-43214",
    "user": "https://github.com/qed777"
}
```

<a id='comment:2'></a>
#5675 appears to be a duplicate, but with wider scope.



---

archive/issue_comments_043215.json:
```json
{
    "body": "<a id='comment:3'></a>\nI agree that this will probably be closed when #5675 is closed.  I think that when #5675 is closed, this ought to be checked, and then closed if everything works.",
    "created_at": "2009-08-10T14:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5263#issuecomment-43215",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:3'></a>
I agree that this will probably be closed when #5675 is closed.  I think that when #5675 is closed, this ought to be checked, and then closed if everything works.



---

archive/issue_comments_043216.json:
```json
{
    "body": "**Upstream:** N/A",
    "created_at": "2009-12-21T11:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5263#issuecomment-43216",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

**Upstream:** N/A



---

archive/issue_comments_043217.json:
```json
{
    "body": "<a id='comment:4'></a>\nIt looks like this has been a long standing bug, which nobody has worked on. I would make two suggestion, though. \n\nFirstly, if this gets fixed, it would be sensible to detect the following range of IP addresses, and indicate they can not be routed over the internet. \n\n* 10.x.x.x\n* 172.16.x.x to 172.31.x.x\n* 192.168.x.x\n\nSecondly, perhaps a further reminder about the security risks would not go amiss either. \n\nDave",
    "created_at": "2009-12-21T11:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5263#issuecomment-43217",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:4'></a>
It looks like this has been a long standing bug, which nobody has worked on. I would make two suggestion, though. 

Firstly, if this gets fixed, it would be sensible to detect the following range of IP addresses, and indicate they can not be routed over the internet. 

* 10.x.x.x
* 172.16.x.x to 172.31.x.x
* 192.168.x.x

Secondly, perhaps a further reminder about the security risks would not go amiss either. 

Dave



---

archive/issue_comments_043218.json:
```json
{
    "body": "<a id='comment:6'></a>\nFollowing the suggestions [here](http://groups.google.com/group/comp.lang.python/browse_thread/thread/d931cdc326d7032b?hl=en) and [here](http://stackoverflow.com/questions/166545/finding-a-public-facing-ip-address-in-python), I get:\n\n```python\nsage: import socket\nsage: socket.gethostbyname(socket.gethostname())\n'127.0.0.1'\nsage: s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\nsage: s.connect(('google.com', 0))\nsage: s.getsockname()[0]\n'192.168.x.y'\nsage: import urllib\nsage: urllib.urlopen('http://whatismyip.org').read()\n'a.b.c.d'\n```\nI'm looking now for ways to iterate over the available interfaces in Twisted...\n\nBy the way, there are a few suggestions to the main problem at #5675.\n\nWhat is a good name for a keyword option that's inserted instead of the `interface` (post-#7639, `address` is deprecated) when `interface=''`?",
    "created_at": "2010-01-16T04:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5263#issuecomment-43218",
    "user": "https://github.com/qed777"
}
```

<a id='comment:6'></a>
Following the suggestions [here](http://groups.google.com/group/comp.lang.python/browse_thread/thread/d931cdc326d7032b?hl=en) and [here](http://stackoverflow.com/questions/166545/finding-a-public-facing-ip-address-in-python), I get:

```python
sage: import socket
sage: socket.gethostbyname(socket.gethostname())
'127.0.0.1'
sage: s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
sage: s.connect(('google.com', 0))
sage: s.getsockname()[0]
'192.168.x.y'
sage: import urllib
sage: urllib.urlopen('http://whatismyip.org').read()
'a.b.c.d'
```
I'm looking now for ways to iterate over the available interfaces in Twisted...

By the way, there are a few suggestions to the main problem at #5675.

What is a good name for a keyword option that's inserted instead of the `interface` (post-#7639, `address` is deprecated) when `interface=''`?



---

archive/issue_comments_043219.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [mpatel](#comment%3A6):\n> I'm looking now for ways to iterate over the available interfaces in Twisted...\n\nI *think* Twisted just uses [socket](http://docs.python.org/library/socket.html), which \nuses the underlying system's socket library.  I don't know if there is a local, cross-platform way to iterate over `'0.0.0.0'` (all interfaces) and map each to an IP address.",
    "created_at": "2010-01-16T06:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5263#issuecomment-43219",
    "user": "https://github.com/qed777"
}
```

<a id='comment:7'></a>
Replying to [mpatel](#comment%3A6):
> I'm looking now for ways to iterate over the available interfaces in Twisted...

I *think* Twisted just uses [socket](http://docs.python.org/library/socket.html), which 
uses the underlying system's socket library.  I don't know if there is a local, cross-platform way to iterate over `'0.0.0.0'` (all interfaces) and map each to an IP address.



---

archive/issue_comments_043220.json:
```json
{
    "body": "<a id='comment:8'></a>\nI think using the [HTTP-HOST](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.23) header will be easier and more reliable. Here's a patch implementing that. Feel free to comment.",
    "created_at": "2010-01-19T00:33:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5263#issuecomment-43220",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:8'></a>
I think using the [HTTP-HOST](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.23) header will be easier and more reliable. Here's a patch implementing that. Feel free to comment.



---

archive/issue_comments_043221.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2010-01-19T00:33:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5263#issuecomment-43221",
    "user": "https://github.com/TimDumol"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_043222.json:
```json
{
    "body": "Uses the HTTP-HOST header to attempt to get the host name.",
    "created_at": "2010-01-19T00:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5263#issuecomment-43222",
    "user": "https://github.com/TimDumol"
}
```

Uses the HTTP-HOST header to attempt to get the host name.



---

archive/issue_comments_043223.json:
```json
{
    "body": "**Author:** Tim Dumol",
    "created_at": "2010-01-20T03:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5263#issuecomment-43223",
    "user": "https://github.com/qed777"
}
```

**Author:** Tim Dumol



---

archive/attachments_005925.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_5263-publish-url.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket5263/trac_5263-publish-url.patch",
    "created_at": "2010-01-20T03:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5263",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/qed777"
}
```



---

archive/issue_comments_043224.json:
```json
{
    "body": "<a id='comment:9'></a>\nNice!",
    "created_at": "2010-01-20T03:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5263#issuecomment-43224",
    "user": "https://github.com/qed777"
}
```

<a id='comment:9'></a>
Nice!



---

archive/issue_comments_043225.json:
```json
{
    "body": "**Reviewer:** Mitesh Patel",
    "created_at": "2010-01-20T03:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5263#issuecomment-43225",
    "user": "https://github.com/qed777"
}
```

**Reviewer:** Mitesh Patel



---

archive/issue_comments_043226.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2010-01-20T03:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5263#issuecomment-43226",
    "user": "https://github.com/qed777"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_043227.json:
```json
{
    "body": "**Merged:** sagenb-0.7",
    "created_at": "2010-01-25T00:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5263#issuecomment-43227",
    "user": "https://github.com/qed777"
}
```

**Merged:** sagenb-0.7



---

archive/issue_events_015475.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-01-25T00:52:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/5263",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5263#event-15475"
}
```
