# Issue 5263: publishing a worksheet displays the URL without the hostname

archive/issues_005263.json:
```json
{
    "assignees": [
        "https://github.com/boothby"
    ],
    "body": "When I publish a worksheet on sagenb.org, it says I can find the sheet at: http://:8000/home/pub/243\n\nOf course, this is silly nonsense.\n\nIt might have to do with starting the notebook with address='', maybe?\n\nCC:  @kcrisman @williamstein @qed777\n\nComponent: **notebook**\n\nAuthor: **Tim Dumol**\n\nReviewer: **Mitesh Patel**\n\nMerged: **sagenb-0.7**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/5263_\n\n",
    "closed_at": "2010-01-25T00:52:12Z",
    "created_at": "2009-02-14T02:16:51Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20user%20interface",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "publishing a worksheet displays the URL without the hostname",
    "type": "issue",
    "updated_at": "2010-01-25T00:52:12Z",
    "url": "https://github.com/sagemath/sage/issues/5263",
    "user": "https://github.com/jasongrout"
}
```
When I publish a worksheet on sagenb.org, it says I can find the sheet at: http://:8000/home/pub/243

Of course, this is silly nonsense.

It might have to do with starting the notebook with address='', maybe?

CC:  @kcrisman @williamstein @qed777

Component: **notebook**

Author: **Tim Dumol**

Reviewer: **Mitesh Patel**

Merged: **sagenb-0.7**

_Issue created by migration from https://trac.sagemath.org/ticket/5263_





---

archive/issue_events_061654.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-02-14T02:16:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "milestone_number": null,
    "milestone_title": "sage-4.3.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5263#event-61654"
}
```



---

archive/issue_events_061655.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-02-14T02:16:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20user%20interface",
    "label_color": "000080",
    "label_name": "c: user interface",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5263#event-61655"
}
```



---

archive/issue_events_061656.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-02-14T02:16:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5263#event-61656"
}
```



---

archive/issue_events_061657.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-02-14T02:16:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5263#event-61657"
}
```



---

archive/issue_events_061658.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2009-02-14T02:16:51Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "subject": "https://github.com/jasongrout",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5263#event-61658"
}
```



---

archive/issue_comments_032339.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nYes it does use address. I just discovered that on my computer if I set address='sagenb.org' then I can't start the notebook.",
    "created_at": "2009-02-14T12:47:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5263#issuecomment-32339",
    "user": "https://github.com/TimothyClemans"
}
```

<div id="comment:1" align="right">comment:1</div>

Yes it does use address. I just discovered that on my computer if I set address='sagenb.org' then I can't start the notebook.



---

archive/issue_comments_032340.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\n#5675 appears to be a duplicate, but with wider scope.",
    "created_at": "2009-08-10T09:35:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5263#issuecomment-32340",
    "user": "https://github.com/qed777"
}
```

<div id="comment:2" align="right">comment:2</div>

#5675 appears to be a duplicate, but with wider scope.



---

archive/issue_comments_032341.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI agree that this will probably be closed when #5675 is closed.  I think that when #5675 is closed, this ought to be checked, and then closed if everything works.",
    "created_at": "2009-08-10T14:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5263#issuecomment-32341",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:3" align="right">comment:3</div>

I agree that this will probably be closed when #5675 is closed.  I think that when #5675 is closed, this ought to be checked, and then closed if everything works.



---

archive/issue_comments_032342.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIt looks like this has been a long standing bug, which nobody has worked on. I would make two suggestion, though. \n\nFirstly, if this gets fixed, it would be sensible to detect the following range of IP addresses, and indicate they can not be routed over the internet. \n\n* 10.x.x.x\n* 172.16.x.x to 172.31.x.x\n* 192.168.x.x\n\nSecondly, perhaps a further reminder about the security risks would not go amiss either. \n\nDave",
    "created_at": "2009-12-21T11:02:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5263#issuecomment-32342",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:4" align="right">comment:4</div>

It looks like this has been a long standing bug, which nobody has worked on. I would make two suggestion, though. 

Firstly, if this gets fixed, it would be sensible to detect the following range of IP addresses, and indicate they can not be routed over the internet. 

* 10.x.x.x
* 172.16.x.x to 172.31.x.x
* 192.168.x.x

Secondly, perhaps a further reminder about the security risks would not go amiss either. 

Dave



---

archive/issue_comments_032343.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nFollowing the suggestions [here](http://groups.google.com/group/comp.lang.python/browse_thread/thread/d931cdc326d7032b?hl=en) and [here](http://stackoverflow.com/questions/166545/finding-a-public-facing-ip-address-in-python), I get:\n\n```python\nsage: import socket\nsage: socket.gethostbyname(socket.gethostname())\n'127.0.0.1'\nsage: s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\nsage: s.connect(('google.com', 0))\nsage: s.getsockname()[0]\n'192.168.x.y'\nsage: import urllib\nsage: urllib.urlopen('http://whatismyip.org').read()\n'a.b.c.d'\n```\nI'm looking now for ways to iterate over the available interfaces in Twisted...\n\nBy the way, there are a few suggestions to the main problem at #5675.\n\nWhat is a good name for a keyword option that's inserted instead of the `interface` (post-#7639, `address` is deprecated) when `interface=''`?",
    "created_at": "2010-01-16T04:44:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5263#issuecomment-32343",
    "user": "https://github.com/qed777"
}
```

<div id="comment:6" align="right">comment:6</div>

Following the suggestions [here](http://groups.google.com/group/comp.lang.python/browse_thread/thread/d931cdc326d7032b?hl=en) and [here](http://stackoverflow.com/questions/166545/finding-a-public-facing-ip-address-in-python), I get:

```python
sage: import socket
sage: socket.gethostbyname(socket.gethostname())
'127.0.0.1'
sage: s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
sage: s.connect(('google.com', 0))
sage: s.getsockname()[0]
'192.168.x.y'
sage: import urllib
sage: urllib.urlopen('http://whatismyip.org').read()
'a.b.c.d'
```
I'm looking now for ways to iterate over the available interfaces in Twisted...

By the way, there are a few suggestions to the main problem at #5675.

What is a good name for a keyword option that's inserted instead of the `interface` (post-#7639, `address` is deprecated) when `interface=''`?



---

archive/issue_comments_032344.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@qed777](#comment:6):\n> I'm looking now for ways to iterate over the available interfaces in Twisted...\n\nI *think* Twisted just uses [socket](http://docs.python.org/library/socket.html), which \nuses the underlying system's socket library.  I don't know if there is a local, cross-platform way to iterate over `'0.0.0.0'` (all interfaces) and map each to an IP address.",
    "created_at": "2010-01-16T06:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5263#issuecomment-32344",
    "user": "https://github.com/qed777"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@qed777](#comment:6):
> I'm looking now for ways to iterate over the available interfaces in Twisted...

I *think* Twisted just uses [socket](http://docs.python.org/library/socket.html), which 
uses the underlying system's socket library.  I don't know if there is a local, cross-platform way to iterate over `'0.0.0.0'` (all interfaces) and map each to an IP address.



---

archive/issue_comments_032345.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI think using the [HTTP-HOST](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.23) header will be easier and more reliable. Here's a patch implementing that. Feel free to comment.",
    "created_at": "2010-01-19T00:33:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5263#issuecomment-32345",
    "user": "https://github.com/TimDumol"
}
```

<div id="comment:8" align="right">comment:8</div>

I think using the [HTTP-HOST](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.23) header will be easier and more reliable. Here's a patch implementing that. Feel free to comment.



---

archive/issue_events_061659.json:
```json
{
    "actor": "https://github.com/TimDumol",
    "created_at": "2010-01-19T00:33:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5263#event-61659"
}
```



---

archive/issue_comments_032346.json:
```json
{
    "body": "Uses the HTTP-HOST header to attempt to get the host name.",
    "created_at": "2010-01-19T00:34:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5263#issuecomment-32346",
    "user": "https://github.com/TimDumol"
}
```

Uses the HTTP-HOST header to attempt to get the host name.



---

archive/issue_comments_032347.json:
```json
{
    "body": "Author: **Tim Dumol**",
    "created_at": "2010-01-20T03:20:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5263#issuecomment-32347",
    "user": "https://github.com/qed777"
}
```

Author: **Tim Dumol**



---

archive/issue_comments_032348.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAttachment: **[trac_5263-publish-url.patch.gz](https://github.com/sagemath/sage/files/ticket5263/trac_5263-publish-url.patch.gz)**\n\nNice!",
    "created_at": "2010-01-20T03:20:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5263#issuecomment-32348",
    "user": "https://github.com/qed777"
}
```

<div id="comment:9" align="right">comment:9</div>

Attachment: **[trac_5263-publish-url.patch.gz](https://github.com/sagemath/sage/files/ticket5263/trac_5263-publish-url.patch.gz)**

Nice!



---

archive/issue_comments_032349.json:
```json
{
    "body": "Reviewer: **Mitesh Patel**",
    "created_at": "2010-01-20T03:20:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5263#issuecomment-32349",
    "user": "https://github.com/qed777"
}
```

Reviewer: **Mitesh Patel**



---

archive/issue_events_061660.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-01-20T03:20:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5263#event-61660"
}
```



---

archive/issue_events_061661.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-01-20T03:20:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5263#event-61661"
}
```



---

archive/issue_comments_032350.json:
```json
{
    "body": "Merged: **sagenb-0.7**",
    "created_at": "2010-01-25T00:52:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5263#issuecomment-32350",
    "user": "https://github.com/qed777"
}
```

Merged: **sagenb-0.7**



---

archive/issue_events_061662.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-01-25T00:52:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5263#event-61662"
}
```



---

archive/issue_events_061663.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-01-25T00:52:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/5263",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5263#event-61663"
}
```
