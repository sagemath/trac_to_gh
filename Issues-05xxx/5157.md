# Issue 5157: if the mwrank interface is interrupted from the notebook (!) it stays broken for the rest of the sage session

archive/issues_005157.json:
```json
{
    "body": "This has been driving me nuts for a while.  If you do \n\n```\nsage: EllipticCurve(997).gens(use_database=False)\n[[press control-c]]\nsage: EllipticCurve([1,3]).gens(use_database=False)\nTraceback (most recent call last):\n...\nRuntimeError: [Errno 9] Bad file descriptor\nError evaluating [0, 0, 0, 1, 3] in Mwrank\n```\n\nThis is from the notebook.  The same sequence works correctly from the command line (no bad file descriptor). \n\nI think the problem is that the notebook sends multiple control-c's and ends up killing sage properly restarting mwrank.  On the command line one has:\n\n```\nsage: EllipticCurve(997).gens(use_database=False)\n...\nKeyboardInterrupt: Restarting Mwrank (WARNING: all variables defined in previous session are now invalid)\nsage: EllipticCurve([1,3]).gens(use_database=False)\n[(-1 : 1 : 1)]\n```\n\nBUT, if you hit control-c twice in rapid succession, then mwrank gets broken even on the command line (I just verified this).\n\nThe fix is to make it so the mwrank interface recovers automatically if it gets left in this state. \n\n\n**Assignee:** @williamstein\n\nIssue created by migration from https://trac.sagemath.org/ticket/5157\n\n",
    "closed_at": "2009-02-02T18:53:21Z",
    "created_at": "2009-02-02T06:09:32Z",
    "labels": [
        "component: algebra",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.3",
    "title": "if the mwrank interface is interrupted from the notebook (!) it stays broken for the rest of the sage session",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/5157",
    "user": "https://github.com/williamstein"
}
```
This has been driving me nuts for a while.  If you do 

```
sage: EllipticCurve(997).gens(use_database=False)
[[press control-c]]
sage: EllipticCurve([1,3]).gens(use_database=False)
Traceback (most recent call last):
...
RuntimeError: [Errno 9] Bad file descriptor
Error evaluating [0, 0, 0, 1, 3] in Mwrank
```

This is from the notebook.  The same sequence works correctly from the command line (no bad file descriptor). 

I think the problem is that the notebook sends multiple control-c's and ends up killing sage properly restarting mwrank.  On the command line one has:

```
sage: EllipticCurve(997).gens(use_database=False)
...
KeyboardInterrupt: Restarting Mwrank (WARNING: all variables defined in previous session are now invalid)
sage: EllipticCurve([1,3]).gens(use_database=False)
[(-1 : 1 : 1)]
```

BUT, if you hit control-c twice in rapid succession, then mwrank gets broken even on the command line (I just verified this).

The fix is to make it so the mwrank interface recovers automatically if it gets left in this state. 


**Assignee:** @williamstein

Issue created by migration from https://trac.sagemath.org/ticket/5157





---

archive/issue_events_032591.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-02-02T06:15:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/5157",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5157#event-32591"
}
```



---

archive/issue_comments_033498.json:
```json
{
    "body": "<a id='comment:2'></a>\nIt seems to be okay, but do we really want the \"print '*'*1000\" in there?",
    "created_at": "2009-02-02T06:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5157#issuecomment-33498",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:2'></a>
It seems to be okay, but do we really want the "print '*'*1000" in there?



---

archive/attachments_005804.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_5157.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket5157/trac_5157.patch",
    "created_at": "2009-02-02T07:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5157",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/williamstein"
}
```



---

archive/issue_comments_033499.json:
```json
{
    "body": "",
    "created_at": "2009-02-02T07:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5157#issuecomment-33499",
    "user": "https://github.com/williamstein"
}
```





---

archive/issue_comments_033500.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis should be refereed by someone who knows pexpect!",
    "created_at": "2009-02-02T09:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5157#issuecomment-33500",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>
This should be refereed by someone who knows pexpect!



---

archive/issue_comments_033501.json:
```json
{
    "body": "<a id='comment:4'></a>\n> It seems to be okay, but do we really want the \"print '*'*1000\" in there? \n\n\nThat's debugging code -- I updated the patch to not have it. \n\n> This should be refereed by someone who knows pexpect! \n\n\nMhansen does, and he said \"it seems to be okay\".",
    "created_at": "2009-02-02T10:21:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5157#issuecomment-33501",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:4'></a>
> It seems to be okay, but do we really want the "print '*'*1000" in there? 


That's debugging code -- I updated the patch to not have it. 

> This should be refereed by someone who knows pexpect! 


Mhansen does, and he said "it seems to be okay".



---

archive/issue_comments_033502.json:
```json
{
    "body": "<a id='comment:5'></a>\nSince Mike gave this the heads up and William removed the debug print statement I am changing this to a positive review.\n\nCheers,\n\nMichael",
    "created_at": "2009-02-02T18:26:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5157#issuecomment-33502",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:5'></a>
Since Mike gave this the heads up and William removed the debug print statement I am changing this to a positive review.

Cheers,

Michael



---

archive/issue_events_032592.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-02-02T18:26:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/5157",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5157#event-32592"
}
```



---

archive/issue_events_032593.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-02-02T18:26:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/5157",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5157#event-32593"
}
```



---

archive/issue_comments_033503.json:
```json
{
    "body": "<a id='comment:6'></a>\nMerged in Sage 3.3.alpha4.\n\nCheers,\n\nMichael",
    "created_at": "2009-02-02T18:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5157",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5157#issuecomment-33503",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:6'></a>
Merged in Sage 3.3.alpha4.

Cheers,

Michael



---

archive/issue_events_032594.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-02-02T18:53:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/5157",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5157#event-32594"
}
```



---

archive/issue_events_032595.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-02-02T18:53:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/5157",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5157#event-32595"
}
```
