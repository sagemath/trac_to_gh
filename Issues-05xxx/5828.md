# Issue 5828: number fields -- serious bug in coercion to a relative extension of degree 1

archive/issues_005828.json:
```json
{
    "assignees": [
        "https://github.com/loefflerd"
    ],
    "body": "\n```\n\n\nOn Sun, Apr 19, 2009 at 10:16 AM, Utpal Sarkar <doetoe@gmail.com> wrote:\n>\n> Hi,\n>\n> I found some strange behaviour of the Hilbert class field of a\n> quadratic number field when the class number is 1, so the Hilbert\n> class field is equal to the ground field:\n> sage: K.<w> = QuadraticField(-5); KX.<X> = K[]; H.<h> =\n> K.hilbert_class_field()\n> sage: (X + w + 1).base_extend(H)\n> X + w + 1\n> No problem: the Hilbert class field is a proper extension, and the\n> polynomial remains the same.\n>\n> sage: K.<w> = QuadraticField(-1); KX.<X> = K[]; H.<h> =\n> K.hilbert_class_field()\n> sage: (X + w + 1).base_extend(H)\n> X + 1\n> In this case the Hilbert class field is equal to K, and the part of\n> the polynomial that is not in QQ disappears.\n\nYou've found a bug in the coercion in the special case of a relative extension of degree 1.\nHere's some simpler code to illustrate it:\n\nsage: K.<w> = QuadraticField(-1)\nsage: KX.<X> = K[]\nsage: H.<h> = K.extension(X-1)\nsage: H(w)\n0\n\nThe internal function responsible for the bug is:\n\nsage: H._NumberField_relative__base_inclusion(w)\n0\n```\n\nCC:  @robertwb @mstreng\n\nComponent: **number fields**\n\nAuthor: **Luis Felipe Tabera Alonso**\n\nReviewer: **Marco Streng**\n\nMerged: **sage-4.5.3.alpha0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/5828_\n\n",
    "closed_at": "2010-08-09T09:41:18Z",
    "created_at": "2009-04-20T03:58:47Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.5.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "number fields -- serious bug in coercion to a relative extension of degree 1",
    "type": "issue",
    "updated_at": "2010-08-09T09:41:18Z",
    "url": "https://github.com/sagemath/sage/issues/5828",
    "user": "https://github.com/williamstein"
}
```

```


On Sun, Apr 19, 2009 at 10:16 AM, Utpal Sarkar <doetoe@gmail.com> wrote:
>
> Hi,
>
> I found some strange behaviour of the Hilbert class field of a
> quadratic number field when the class number is 1, so the Hilbert
> class field is equal to the ground field:
> sage: K.<w> = QuadraticField(-5); KX.<X> = K[]; H.<h> =
> K.hilbert_class_field()
> sage: (X + w + 1).base_extend(H)
> X + w + 1
> No problem: the Hilbert class field is a proper extension, and the
> polynomial remains the same.
>
> sage: K.<w> = QuadraticField(-1); KX.<X> = K[]; H.<h> =
> K.hilbert_class_field()
> sage: (X + w + 1).base_extend(H)
> X + 1
> In this case the Hilbert class field is equal to K, and the part of
> the polynomial that is not in QQ disappears.

You've found a bug in the coercion in the special case of a relative extension of degree 1.
Here's some simpler code to illustrate it:

sage: K.<w> = QuadraticField(-1)
sage: KX.<X> = K[]
sage: H.<h> = K.extension(X-1)
sage: H(w)
0

The internal function responsible for the bug is:

sage: H._NumberField_relative__base_inclusion(w)
0
```

CC:  @robertwb @mstreng

Component: **number fields**

Author: **Luis Felipe Tabera Alonso**

Reviewer: **Marco Streng**

Merged: **sage-4.5.3.alpha0**

_Issue created by migration from https://trac.sagemath.org/ticket/5828_





---

archive/issue_events_069465.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-20T03:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "milestone_number": null,
    "milestone_title": "sage-4.5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69465"
}
```



---

archive/issue_events_069466.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-20T03:58:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69466"
}
```



---

archive/issue_events_069467.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-20T03:58:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69467"
}
```



---

archive/issue_events_069468.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-20T03:58:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69468"
}
```



---

archive/issue_events_069469.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-20T03:58:47Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "subject": "https://github.com/williamstein",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69469"
}
```



---

archive/issue_events_069470.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2009-07-21T08:04:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69470"
}
```



---

archive/issue_events_069471.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2009-07-21T08:04:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "c: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69471"
}
```



---

archive/issue_events_069472.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-07-21T08:04:40Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "subject": "https://github.com/loefflerd",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69472"
}
```



---

archive/issue_events_069473.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2009-07-21T08:04:40Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "subject": "https://github.com/loefflerd",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69473"
}
```



---

archive/issue_events_069474.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-07-02T13:27:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69474"
}
```



---

archive/issue_comments_037280.json:
```json
{
    "body": "Author: **Luis Felipe Tabera Alonso**",
    "created_at": "2010-07-02T13:27:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5828#issuecomment-37280",
    "user": "https://github.com/lftabera"
}
```

Author: **Luis Felipe Tabera Alonso**



---

archive/issue_comments_037281.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThis is solved now (4.4.4)\n\n```\nsage: K.<w> = QuadraticField(-1)\nsage: KX.<X> = K[]\nsage: H.<h> = K.extension(X-1)\nsage: H(w)\nw\nsage: H._NumberField_relative__base_inclusion(w)\nw\n```\n\n```\nsage: K.<w> = QuadraticField(-1);\nsage: KX.<X> = K[]\nsage: H.<h> =K.hilbert_class_field()\nsage: (X + w + 1).base_extend(H)\nX + w + 1\n```\n\nThe bug should be closed, at most add the attached doctest.",
    "created_at": "2010-07-02T13:27:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5828#issuecomment-37281",
    "user": "https://github.com/lftabera"
}
```

<div id="comment:3" align="right">comment:3</div>

This is solved now (4.4.4)

```
sage: K.<w> = QuadraticField(-1)
sage: KX.<X> = K[]
sage: H.<h> = K.extension(X-1)
sage: H(w)
w
sage: H._NumberField_relative__base_inclusion(w)
w
```

```
sage: K.<w> = QuadraticField(-1);
sage: KX.<X> = K[]
sage: H.<h> =K.hilbert_class_field()
sage: (X + w + 1).base_extend(H)
X + w + 1
```

The bug should be closed, at most add the attached doctest.



---

archive/issue_events_069475.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2010-07-22T17:54:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69475"
}
```



---

archive/issue_events_069476.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2010-07-22T17:54:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69476"
}
```



---

archive/issue_comments_037282.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThe tests should be indented, and you should only have \"::\" only on the last line before the test.\nThe patch now has\n\n```\n        TESTS::\n\n        Check that #5828 is solved::\n\n        sage: K.<w> = QuadraticField(-1)\n        sage: KX.<X> = K[]\n        sage: H.<h> = K.extension(X-1)\n        sage: H(w)\n        w\n```\nbut I think it should be\n\n```\n        TESTS:\n\n        Check that #5828 is solved::\n\n            sage: K.<w> = QuadraticField(-1)\n            sage: KX.<X> = K[]\n            sage: H.<h> = K.extension(X-1)\n            sage: H(w)\n            w\n```",
    "created_at": "2010-07-22T17:54:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5828#issuecomment-37282",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:4" align="right">comment:4</div>

The tests should be indented, and you should only have "::" only on the last line before the test.
The patch now has

```
        TESTS::

        Check that #5828 is solved::

        sage: K.<w> = QuadraticField(-1)
        sage: KX.<X> = K[]
        sage: H.<h> = K.extension(X-1)
        sage: H(w)
        w
```
but I think it should be

```
        TESTS:

        Check that #5828 is solved::

            sage: K.<w> = QuadraticField(-1)
            sage: KX.<X> = K[]
            sage: H.<h> = K.extension(X-1)
            sage: H(w)
            w
```



---

archive/issue_comments_037283.json:
```json
{
    "body": "Work Issues: **reST formatting**",
    "created_at": "2010-07-22T17:54:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5828#issuecomment-37283",
    "user": "https://github.com/mstreng"
}
```

Work Issues: **reST formatting**



---

archive/issue_comments_037284.json:
```json
{
    "body": "Reviewer: **Marco Streng**",
    "created_at": "2010-07-22T17:54:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5828#issuecomment-37284",
    "user": "https://github.com/mstreng"
}
```

Reviewer: **Marco Streng**



---

archive/issue_events_069477.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2010-07-22T17:54:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69477"
}
```



---

archive/issue_events_069478.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2010-07-22T17:54:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69478"
}
```



---

archive/issue_comments_037285.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAttachment: **[trac_5828_already_solved.patch.gz](https://github.com/sagemath/sage/files/ticket5828/trac_5828_already_solved.patch.gz)**\n\nYou are right, \n\nI have updated the patch accordingly.\n\nThanks",
    "created_at": "2010-07-26T12:52:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5828#issuecomment-37285",
    "user": "https://github.com/lftabera"
}
```

<div id="comment:5" align="right">comment:5</div>

Attachment: **[trac_5828_already_solved.patch.gz](https://github.com/sagemath/sage/files/ticket5828/trac_5828_already_solved.patch.gz)**

You are right, 

I have updated the patch accordingly.

Thanks



---

archive/issue_events_069479.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-07-26T12:52:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69479"
}
```



---

archive/issue_events_069480.json:
```json
{
    "actor": "https://github.com/lftabera",
    "created_at": "2010-07-26T12:52:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69480"
}
```



---

archive/issue_events_069481.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2010-07-31T13:29:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69481"
}
```



---

archive/issue_events_069482.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2010-07-31T13:29:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69482"
}
```



---

archive/issue_events_069483.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-08-09T09:41:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69483"
}
```



---

archive/issue_events_069484.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-08-09T09:41:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5828#event-69484"
}
```



---

archive/issue_comments_037286.json:
```json
{
    "body": "Changed work issues from **reST formatting** to none",
    "created_at": "2010-08-09T09:41:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5828#issuecomment-37286",
    "user": "https://github.com/qed777"
}
```

Changed work issues from **reST formatting** to none



---

archive/issue_comments_037287.json:
```json
{
    "body": "Merged: **sage-4.5.3.alpha0**",
    "created_at": "2010-08-09T09:41:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5828#issuecomment-37287",
    "user": "https://github.com/qed777"
}
```

Merged: **sage-4.5.3.alpha0**
