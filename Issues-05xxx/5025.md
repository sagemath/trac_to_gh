# Issue 5025: tinymce: fix creation of text cells to not cause duplicate ids and not be considered compute cells

archive/issues_005025.json:
```json
{
    "assignees": [],
    "body": "This was posted to the mailing list about #4705:\n\n```\nI have been using TinyMCE for about three weeks now. My ultimate goal\nwould be to to do something along the lines that David Joyner mentions\nin a previous message (have students create worksheets that have\ncomments/interpretation between the cells).\n\nTinyMCE works very well as far as editing goes, and I didn't test all\nbuttons available in the tool bar. I think it would be a nice edition\nto Sage. It does not seem to affect how responsively the code is\nexecuted, but what I am doing is not very demanding.\n\nHowever, I noticed the following: (I'm using it in Firefox 3.0.5 in\nUbuntu 10.2. The Sage version is 3.2.2.)\n\n(1)\nIf I click the menu Action-Evaluate All, exceptions are thrown in\ncertain situations. The following is the sequence that will trigger\nit:\n     - Execute the code in some cells\n     - Create text using TinyMCE and save it.\n     - Do Action-Evaluate All\nThe problem does not appear to happen with worksheets that had been\nsaved in a previous Sage session, and then are opened in a new\nsession. Quitting the worksheet and reopening it also seems to fix the\nproblem, as long as there were no previous exceptions thrown. I'm not\nincluding a worksheet reproducing the problem because it seems to be\n\"dynamic\", it only occurs as one is working on the worksheet. I am\nattaching a text file with the output of the sage session.\n\n(2)\nIf one creates a link in TinyMCE (highlight text, use the link\nbutton), save the changes in the TinyMCE editor and then follow the\nlink, when returning to the page with the worksheet (using the\nbrowser's back button), the text that has just been typed disappears.\nIt reappears if the reload button in the browser is used. (So, it\nseems to be a problem of refreshing the cached page). The same happens\nif the HTML is directly edited to create the link. In my opinion, the\ndefault behavior on clicking a link in a worksheet should be to open\nit in another tab/window in the browser. The idea is that the links\nmight have reference to documentation, math references, etc, and users\nwill want to continue to do their math in Sage.\n\n(3)\nThis is more in the \"weirdness\" department. I noticed that, sometimes,\neach time I reopen a worksheet, a new empty cell is created at the\nbottom. I was not able to reproduce it consistently.\n```\n\n\n**Assignee:** @mwhansen\n\n**CC:**  @mwhansen\n\nIssue created by migration from https://trac.sagemath.org/ticket/5025\n\n",
    "closed_at": "2009-01-29T06:50:26Z",
    "created_at": "2009-01-19T13:55:59Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20notebook",
        "https://github.com/sagemath/sage/labels/critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-3.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "tinymce: fix creation of text cells to not cause duplicate ids and not be considered compute cells",
    "type": "issue",
    "updated_at": "2009-01-29T12:49:28Z",
    "url": "https://github.com/sagemath/sage/issues/5025",
    "user": "https://github.com/jasongrout"
}
```
This was posted to the mailing list about #4705:

```
I have been using TinyMCE for about three weeks now. My ultimate goal
would be to to do something along the lines that David Joyner mentions
in a previous message (have students create worksheets that have
comments/interpretation between the cells).

TinyMCE works very well as far as editing goes, and I didn't test all
buttons available in the tool bar. I think it would be a nice edition
to Sage. It does not seem to affect how responsively the code is
executed, but what I am doing is not very demanding.

However, I noticed the following: (I'm using it in Firefox 3.0.5 in
Ubuntu 10.2. The Sage version is 3.2.2.)

(1)
If I click the menu Action-Evaluate All, exceptions are thrown in
certain situations. The following is the sequence that will trigger
it:
     - Execute the code in some cells
     - Create text using TinyMCE and save it.
     - Do Action-Evaluate All
The problem does not appear to happen with worksheets that had been
saved in a previous Sage session, and then are opened in a new
session. Quitting the worksheet and reopening it also seems to fix the
problem, as long as there were no previous exceptions thrown. I'm not
including a worksheet reproducing the problem because it seems to be
"dynamic", it only occurs as one is working on the worksheet. I am
attaching a text file with the output of the sage session.

(2)
If one creates a link in TinyMCE (highlight text, use the link
button), save the changes in the TinyMCE editor and then follow the
link, when returning to the page with the worksheet (using the
browser's back button), the text that has just been typed disappears.
It reappears if the reload button in the browser is used. (So, it
seems to be a problem of refreshing the cached page). The same happens
if the HTML is directly edited to create the link. In my opinion, the
default behavior on clicking a link in a worksheet should be to open
it in another tab/window in the browser. The idea is that the links
might have reference to documentation, math references, etc, and users
will want to continue to do their math in Sage.

(3)
This is more in the "weirdness" department. I noticed that, sometimes,
each time I reopen a worksheet, a new empty cell is created at the
bottom. I was not able to reproduce it consistently.
```


**Assignee:** @mwhansen

**CC:**  @mwhansen

Issue created by migration from https://trac.sagemath.org/ticket/5025





---

archive/issue_comments_031688.json:
```json
{
    "body": "<a id='comment:1'></a>\nI can reproduce (1) on sage-3.3.alpha0.  I think the new text cells have to have some additional properties, based on the server log's:\n\nline 1049, in render\n\t    new_input = cell.changed_input_text()\n\texceptions.AttributeError: TextCell instance has no attribute 'changed_input_text'",
    "created_at": "2009-01-19T15:16:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31688",
    "user": "https://github.com/sagetrac-mhampton"
}
```

<a id='comment:1'></a>
I can reproduce (1) on sage-3.3.alpha0.  I think the new text cells have to have some additional properties, based on the server log's:

line 1049, in render
	    new_input = cell.changed_input_text()
	exceptions.AttributeError: TextCell instance has no attribute 'changed_input_text'



---

archive/issue_comments_031689.json:
```json
{
    "body": "<a id='comment:2'></a>\nOkay, the (soon-to-be) attached patch fixes (1) and also fixes the bug mhampton pointed out a while ago that there are multiple cells with the same id.\n\n(2) This is how standard linking works in web browsers in general, and is just implemented in TinyMCE to be consistent with most other links on the internet.  I think I'd classify (2) as a wontfix, since there are standard mechanisms for opening a link in another tab that are widely known and understood.\n\n(3) This does seem weird, but we'd need some steps to reproduce the problem.\n\nHence, I'd say that this ticket is really concerned with the bug in (1), which is addressed in the patch.",
    "created_at": "2009-01-22T11:27:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31689",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:2'></a>
Okay, the (soon-to-be) attached patch fixes (1) and also fixes the bug mhampton pointed out a while ago that there are multiple cells with the same id.

(2) This is how standard linking works in web browsers in general, and is just implemented in TinyMCE to be consistent with most other links on the internet.  I think I'd classify (2) as a wontfix, since there are standard mechanisms for opening a link in another tab that are widely known and understood.

(3) This does seem weird, but we'd need some steps to reproduce the problem.

Hence, I'd say that this ticket is really concerned with the bug in (1), which is addressed in the patch.



---

archive/issue_comments_031690.json:
```json
{
    "body": "<a id='comment:3'></a>\nThese bugfixes also correct a number of small issues that were bugging people too.",
    "created_at": "2009-01-22T11:33:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31690",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:3'></a>
These bugfixes also correct a number of small issues that were bugging people too.



---

archive/issue_events_030745.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-01-22T11:33:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5025#event-30745"
}
```



---

archive/issue_comments_031691.json:
```json
{
    "body": "<a id='comment:5'></a>\n(I found one other small issue, which I corrected in the refreshed patch I just attached.)",
    "created_at": "2009-01-22T16:53:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31691",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:5'></a>
(I found one other small issue, which I corrected in the refreshed patch I just attached.)



---

archive/issue_events_030746.json:
```json
{
    "actor": "https://github.com/sagetrac-boothby",
    "created_at": "2009-01-24T10:32:32Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "rename": {
        "from": "tinymce issues",
        "to": "[negative review] tinymce issues"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5025#event-30746"
}
```



---

archive/issue_comments_031692.json:
```json
{
    "body": "<a id='comment:6'></a>\nI applied the patch, and got the following when I clicked on a worksheet:\n\n```\n\tTraceback (most recent call last):\n\t  File \"/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/internet/defer.py\", line 186, in addCallbacks\n\t    self._runCallbacks()\n\t  File \"/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/internet/defer.py\", line 328, in _runCallbacks\n\t    self.result = callback(self.result, *args, **kw)\n\t  File \"/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/internet/defer.py\", line 289, in _continue\n\t    self.unpause()\n\t  File \"/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/internet/defer.py\", line 285, in unpause\n\t    self._runCallbacks()\n\t--- <exception caught here> ---\n\t  File \"/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/internet/defer.py\", line 328, in _runCallbacks\n\t    self.result = callback(self.result, *args, **kw)\n\t  File \"/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/web2/server.py\", line 296, in <lambda>\n\t    d.addCallback(lambda res, req: res.renderHTTP(req), self)\n\t  File \"/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/web2/resource.py\", line 85, in renderHTTP\n\t    return method(request)\n\t  File \"/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/web2/resource.py\", line 202, in http_GET\n\t    return super(Resource, self).http_GET(request)\n\t  File \"/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/web2/resource.py\", line 128, in http_GET\n\t    return self.render(request)\n\t  File \"/scratch/boothby/sage/local/lib/python2.5/site-packages/sage/server/notebook/twist.py\", line 1333, in render\n\t    self.worksheet.sage()\n\t  File \"/scratch/boothby/sage/local/lib/python2.5/site-packages/sage/server/notebook/worksheet.py\", line 2547, in sage\n\t    self.initialize_sage()\n\t  File \"/scratch/boothby/sage/local/lib/python2.5/site-packages/sage/server/notebook/worksheet.py\", line 2523, in initialize_sage\n\t    self._enqueue_auto_cells()\n\t  File \"/scratch/boothby/sage/local/lib/python2.5/site-packages/sage/server/notebook/worksheet.py\", line 2917, in _enqueue_auto_cells\n\t    if c.is_auto_cell():\n\t  File \"/scratch/boothby/sage/local/lib/python2.5/site-packages/sage/server/notebook/cell.py\", line 1103, in is_auto_cell\n\t    return 'auto' in self.percent_directives()\n\t  File \"/scratch/boothby/sage/local/lib/python2.5/site-packages/sage/server/notebook/cell.py\", line 1064, in percent_directives\n\t    return self._percent_directives\n\texceptions.AttributeError: Cell instance has no attribute '_percent_directives'\n```",
    "created_at": "2009-01-24T10:32:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31692",
    "user": "https://github.com/sagetrac-boothby"
}
```

<a id='comment:6'></a>
I applied the patch, and got the following when I clicked on a worksheet:

```
	Traceback (most recent call last):
	  File "/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/internet/defer.py", line 186, in addCallbacks
	    self._runCallbacks()
	  File "/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/internet/defer.py", line 328, in _runCallbacks
	    self.result = callback(self.result, *args, **kw)
	  File "/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/internet/defer.py", line 289, in _continue
	    self.unpause()
	  File "/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/internet/defer.py", line 285, in unpause
	    self._runCallbacks()
	--- <exception caught here> ---
	  File "/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/internet/defer.py", line 328, in _runCallbacks
	    self.result = callback(self.result, *args, **kw)
	  File "/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/web2/server.py", line 296, in <lambda>
	    d.addCallback(lambda res, req: res.renderHTTP(req), self)
	  File "/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/web2/resource.py", line 85, in renderHTTP
	    return method(request)
	  File "/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/web2/resource.py", line 202, in http_GET
	    return super(Resource, self).http_GET(request)
	  File "/scratch/boothby/sage/local/lib/python2.5/site-packages/twisted/web2/resource.py", line 128, in http_GET
	    return self.render(request)
	  File "/scratch/boothby/sage/local/lib/python2.5/site-packages/sage/server/notebook/twist.py", line 1333, in render
	    self.worksheet.sage()
	  File "/scratch/boothby/sage/local/lib/python2.5/site-packages/sage/server/notebook/worksheet.py", line 2547, in sage
	    self.initialize_sage()
	  File "/scratch/boothby/sage/local/lib/python2.5/site-packages/sage/server/notebook/worksheet.py", line 2523, in initialize_sage
	    self._enqueue_auto_cells()
	  File "/scratch/boothby/sage/local/lib/python2.5/site-packages/sage/server/notebook/worksheet.py", line 2917, in _enqueue_auto_cells
	    if c.is_auto_cell():
	  File "/scratch/boothby/sage/local/lib/python2.5/site-packages/sage/server/notebook/cell.py", line 1103, in is_auto_cell
	    return 'auto' in self.percent_directives()
	  File "/scratch/boothby/sage/local/lib/python2.5/site-packages/sage/server/notebook/cell.py", line 1064, in percent_directives
	    return self._percent_directives
	exceptions.AttributeError: Cell instance has no attribute '_percent_directives'
```



---

archive/issue_events_030747.json:
```json
{
    "actor": "https://github.com/sagetrac-boothby",
    "created_at": "2009-01-24T23:03:39Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "rename": {
        "from": "[negative review] tinymce issues",
        "to": "tinymce issues"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5025#event-30747"
}
```



---

archive/issue_events_030748.json:
```json
{
    "actor": "https://github.com/sagetrac-boothby",
    "created_at": "2009-01-24T23:03:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5025#event-30748"
}
```



---

archive/issue_events_030749.json:
```json
{
    "actor": "https://github.com/sagetrac-boothby",
    "created_at": "2009-01-24T23:03:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5025#event-30749"
}
```



---

archive/issue_comments_031693.json:
```json
{
    "body": "<a id='comment:8'></a>\nOkay, this looks like a conflict with mhansen's new percent directive handling.  I'm CCing him to see if he knows what is going on here.",
    "created_at": "2009-01-25T00:22:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31693",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:8'></a>
Okay, this looks like a conflict with mhansen's new percent directive handling.  I'm CCing him to see if he knows what is going on here.



---

archive/issue_comments_031694.json:
```json
{
    "body": "<a id='comment:9'></a>\nActually, mhansen, is this a problem with your percent directive patch?  In particular, if you create a worksheet with a text cell, is it asked for percent directives, like appears what is happening above?",
    "created_at": "2009-01-25T00:26:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31694",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:9'></a>
Actually, mhansen, is this a problem with your percent directive patch?  In particular, if you create a worksheet with a text cell, is it asked for percent directives, like appears what is happening above?



---

archive/issue_comments_031695.json:
```json
{
    "body": "<a id='comment:10'></a>\nI'm having a hard time duplicating this problem with Sage 3.3.alpha2.",
    "created_at": "2009-01-25T11:24:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31695",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:10'></a>
I'm having a hard time duplicating this problem with Sage 3.3.alpha2.



---

archive/issue_comments_031696.json:
```json
{
    "body": "<a id='comment:11'></a>\nThis patch makes the tinymce text cells not break the navigation and evaluate-all functionalities of the notebook.  Without this patch, the navigation arrows stop at text cells and other things become frustratingly cumbersome, so I'm marking this as critical, since tinymce is already merged.\n\nBoothby, can you post the worksheet you had a problem with and confirm that the problem exists on 3.3alpha2?",
    "created_at": "2009-01-27T16:28:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31696",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:11'></a>
This patch makes the tinymce text cells not break the navigation and evaluate-all functionalities of the notebook.  Without this patch, the navigation arrows stop at text cells and other things become frustratingly cumbersome, so I'm marking this as critical, since tinymce is already merged.

Boothby, can you post the worksheet you had a problem with and confirm that the problem exists on 3.3alpha2?



---

archive/issue_events_030750.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-01-27T16:28:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "label": "https://github.com/sagemath/sage/labels/critical",
    "label_color": "ff0000",
    "label_name": "critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5025#event-30750"
}
```



---

archive/issue_comments_031697.json:
```json
{
    "body": "<a id='comment:12'></a>\nI can reproduce this on 3.3alpha2 by:\n\ncreating a new worksheet\n\nentering 1+1 and evaluating the first cell\n\ncreate a text cell below all other cells.  Save changes to text cell\n\ncreate a calculation cell below all other cells.  Enter 1+1 and evaluate\n\nSelect \"Evaluate All\" from the menu.",
    "created_at": "2009-01-27T16:42:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31697",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:12'></a>
I can reproduce this on 3.3alpha2 by:

creating a new worksheet

entering 1+1 and evaluating the first cell

create a text cell below all other cells.  Save changes to text cell

create a calculation cell below all other cells.  Enter 1+1 and evaluate

Select "Evaluate All" from the menu.



---

archive/issue_comments_031698.json:
```json
{
    "body": "<a id='comment:13'></a>\nOkay, I reproduced this with the above steps with a stock sage-3.3alpha2 (without this patch applied), so this patch is not at fault here.  Can we merge this patch and open up another (critical) ticket for the issue with Text cells above?\n\nIn other words, can someone change this to a positive review, since this patch isn't the one causing the problem?",
    "created_at": "2009-01-27T23:16:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31698",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:13'></a>
Okay, I reproduced this with the above steps with a stock sage-3.3alpha2 (without this patch applied), so this patch is not at fault here.  Can we merge this patch and open up another (critical) ticket for the issue with Text cells above?

In other words, can someone change this to a positive review, since this patch isn't the one causing the problem?



---

archive/issue_comments_031699.json:
```json
{
    "body": "<a id='comment:14'></a>\nI found one problem in the above patch.  I'm posting an updated patch soon.",
    "created_at": "2009-01-28T17:01:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31699",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:14'></a>
I found one problem in the above patch.  I'm posting an updated patch soon.



---

archive/issue_comments_031700.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Attachment:** [trac_5025-tinymce_bugfix.patch.gz](https://github.com/sagemath/sage/files/ticket5025/trac_5025-tinymce_bugfix.patch.gz)\n\nOkay, the bug should be fixed.  The only change is on line 3354 or so, where when inserting a text cell after all other cells, the previous patch called insert_new_cell_after, but should have called insert_new_text_cell_after.  The refreshed patch corrects this.",
    "created_at": "2009-01-28T17:09:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31700",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:15'></a>
**Attachment:** [trac_5025-tinymce_bugfix.patch.gz](https://github.com/sagemath/sage/files/ticket5025/trac_5025-tinymce_bugfix.patch.gz)

Okay, the bug should be fixed.  The only change is on line 3354 or so, where when inserting a text cell after all other cells, the previous patch called insert_new_cell_after, but should have called insert_new_text_cell_after.  The refreshed patch corrects this.



---

archive/issue_events_030751.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-01-28T17:09:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5025#event-30751"
}
```



---

archive/issue_events_030752.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-01-28T17:09:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5025#event-30752"
}
```



---

archive/issue_events_030753.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2009-01-29T03:51:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5025#event-30753"
}
```



---

archive/issue_events_030754.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2009-01-29T03:51:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5025#event-30754"
}
```



---

archive/issue_comments_031701.json:
```json
{
    "body": "<a id='comment:16'></a>\nMy testing gives that this mysteriously makes the Edit button non-functional, or rather that the Edit button gives the usual interface but without any actual text to edit, not even a blank box - nothing!  \n\nI also once or twice got a similar error to Boothby's where the cell instance was missing a different attribute, but couldn't get it to reproduce reliably. (BTW, I also occasionally get this mysterious addition of new cells, but it's extremely difficult to reproduce and of course it's unrelated to the current patch.)",
    "created_at": "2009-01-29T03:51:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31701",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:16'></a>
My testing gives that this mysteriously makes the Edit button non-functional, or rather that the Edit button gives the usual interface but without any actual text to edit, not even a blank box - nothing!  

I also once or twice got a similar error to Boothby's where the cell instance was missing a different attribute, but couldn't get it to reproduce reliably. (BTW, I also occasionally get this mysterious addition of new cells, but it's extremely difficult to reproduce and of course it's unrelated to the current patch.)



---

archive/issue_comments_031702.json:
```json
{
    "body": "<a id='comment:17'></a>\nThe edit button works fine for me.  I'm using FF 3.0.5 on Ubuntu Intrepid.\n\nJust to clarify, the edit button works fine for you without this patch applied.  You apply the patch, and the edit button no longer works.  Is that correct?  What browser and OS are you using?\n\nThe bug I fixed when I refreshed the patch a few hours ago should fix the cell instance missing an attribute problem.  What was the error message?",
    "created_at": "2009-01-29T04:20:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31702",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:17'></a>
The edit button works fine for me.  I'm using FF 3.0.5 on Ubuntu Intrepid.

Just to clarify, the edit button works fine for you without this patch applied.  You apply the patch, and the edit button no longer works.  Is that correct?  What browser and OS are you using?

The bug I fixed when I refreshed the patch a few hours ago should fix the cell instance missing an attribute problem.  What was the error message?



---

archive/issue_comments_031703.json:
```json
{
    "body": "<a id='comment:18'></a>\nkcrisman: also, are you using sage 3.3 alpha 2?  This patch depends on the alpha2 (that alpha contains, for example, the other tinymce patches)",
    "created_at": "2009-01-29T04:21:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31703",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:18'></a>
kcrisman: also, are you using sage 3.3 alpha 2?  This patch depends on the alpha2 (that alpha contains, for example, the other tinymce patches)



---

archive/issue_events_030755.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-01-29T06:39:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5025#event-30755"
}
```



---

archive/issue_events_030756.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-01-29T06:39:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5025#event-30756"
}
```



---

archive/issue_comments_031704.json:
```json
{
    "body": "<a id='comment:19'></a>\nHaving looked at the patch and tested it on alpha2 on Firefox on Linux and Safari on OS X.  I think it can go into alpha3 where it will get more widespread testing.\n\nI have no idea what is going on with kcrisman's system.  I'll dedicate some time to take care of all of this before 3.3.",
    "created_at": "2009-01-29T06:39:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31704",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:19'></a>
Having looked at the patch and tested it on alpha2 on Firefox on Linux and Safari on OS X.  I think it can go into alpha3 where it will get more widespread testing.

I have no idea what is going on with kcrisman's system.  I'll dedicate some time to take care of all of this before 3.3.



---

archive/issue_comments_031705.json:
```json
{
    "body": "**Changing assignee** from boothby to @mwhansen.",
    "created_at": "2009-01-29T06:39:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31705",
    "user": "https://github.com/mwhansen"
}
```

**Changing assignee** from boothby to @mwhansen.



---

archive/issue_events_030757.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-29T06:48:48Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "rename": {
        "from": "tinymce issues",
        "to": "tinymce: fix exceptions on Action-Evaluate All"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5025#event-30757"
}
```



---

archive/issue_events_030758.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-29T06:50:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5025#event-30758"
}
```



---

archive/issue_events_030759.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-29T06:50:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5025#event-30759"
}
```



---

archive/issue_comments_031706.json:
```json
{
    "body": "<a id='comment:21'></a>\nMerged in Sage 3.3.alpha3.\n\nCheers,\n\nMichael",
    "created_at": "2009-01-29T06:50:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31706",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:21'></a>
Merged in Sage 3.3.alpha3.

Cheers,

Michael



---

archive/issue_events_030760.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-01-29T06:52:22Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "rename": {
        "from": "tinymce: fix exceptions on Action-Evaluate All",
        "to": "tinymce: fix creation of text cells to not cause duplicate ids and not be considered compute cells"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5025#event-30760"
}
```



---

archive/issue_events_030761.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-01-29T06:52:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5025#event-30761"
}
```



---

archive/issue_comments_031707.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [@jasongrout](#comment%3A18):\n> kcrisman: also, are you using sage 3.3 alpha 2?  This patch depends on the alpha2 (that alpha contains, for example, the other tinymce patches)\n\nThat could be the problem.  I just don't know why Edit would work without this patch, then not work with the patch, as well as why this patch would even apply correctly!  Don't worry, I'll let you know if it happens in 3.3 proper - my sense is not, based on mhansen's review.",
    "created_at": "2009-01-29T12:49:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5025#issuecomment-31707",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:23'></a>
Replying to [@jasongrout](#comment%3A18):
> kcrisman: also, are you using sage 3.3 alpha 2?  This patch depends on the alpha2 (that alpha contains, for example, the other tinymce patches)

That could be the problem.  I just don't know why Edit would work without this patch, then not work with the patch, as well as why this patch would even apply correctly!  Don't worry, I'll let you know if it happens in 3.3 proper - my sense is not, based on mhansen's review.
