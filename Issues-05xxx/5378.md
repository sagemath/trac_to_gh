# Issue 5378: [with patch, positive review] Sage 3.3: numerical noise in rings/polynomial/complex_roots.py on cicero & fulvia

archive/issues_005378.json:
```json
{
    "body": "\n```\nsage -t  \"devel/sage/sage/rings/polynomial/complex_roots.py\"\n**********************************************************************\nFile \"/home/mariah/sage/sage-3.3-x86-Linux-fc-test/devel/sage/sage/rings/polynom\nial/complex_roots.py\", line 271:\n   sage: complex_roots(x^2 + 27*x + 181)\nExpected:\n   [(-14.61803398874990?..., 1), (-12.3819660112501...? + 0.?e-27*I, 1)]\nGot:\n   [(-12.3819660112501?, 1), (-14.61803398874990? + 0.?e-27*I, 1)]\n```\n\nAssignee: mabshoff\n\nCC:  cwitty\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/5378\n\n",
    "closed_at": "2009-04-19T02:10:25Z",
    "created_at": "2009-02-26T02:40:47Z",
    "labels": [
        "component: doctest coverage",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.4.1",
    "title": "[with patch, positive review] Sage 3.3: numerical noise in rings/polynomial/complex_roots.py on cicero & fulvia",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/5378",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

```
sage -t  "devel/sage/sage/rings/polynomial/complex_roots.py"
**********************************************************************
File "/home/mariah/sage/sage-3.3-x86-Linux-fc-test/devel/sage/sage/rings/polynom
ial/complex_roots.py", line 271:
   sage: complex_roots(x^2 + 27*x + 181)
Expected:
   [(-14.61803398874990?..., 1), (-12.3819660112501...? + 0.?e-27*I, 1)]
Got:
   [(-12.3819660112501?, 1), (-14.61803398874990? + 0.?e-27*I, 1)]
```

Assignee: mabshoff

CC:  cwitty

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/5378





---

archive/issue_comments_045127.json:
```json
{
    "body": "<a id='comment:1'></a>Hmm, the numerical noise of the imaginary part of the root causes the order of the roots for printing to be flipped. I am not sure what to do here except for picking another polynomial, but I have not looked into this in any detail since we might have this particular root for a good reason.\n\nCheers,\n\nMichael",
    "created_at": "2009-03-01T06:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5378#issuecomment-45127",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:1'></a>Hmm, the numerical noise of the imaginary part of the root causes the order of the roots for printing to be flipped. I am not sure what to do here except for picking another polynomial, but I have not looked into this in any detail since we might have this particular root for a good reason.

Cheers,

Michael



---

archive/issue_events_012533.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-03-01T06:02:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5378",
    "milestone": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5378#event-12533"
}
```



---

archive/issue_comments_045128.json:
```json
{
    "body": "<a id='comment:2'></a>I don't remember anything special about that polynomial, so I'm fine with changing it.\n\nOther possibilities would include changing the sorting.  One possibility would be to remove the code that puts real roots first; another possibility would be to special-case complex interval roots in the sorting, and say that if the imaginary part of a root is an interval that contains 0 then it should sort with the real roots.",
    "created_at": "2009-03-01T06:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5378#issuecomment-45128",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

<a id='comment:2'></a>I don't remember anything special about that polynomial, so I'm fine with changing it.

Other possibilities would include changing the sorting.  One possibility would be to remove the code that puts real roots first; another possibility would be to special-case complex interval roots in the sorting, and say that if the imaginary part of a root is an interval that contains 0 then it should sort with the real roots.



---

archive/issue_comments_045129.json:
```json
{
    "body": "<a id='comment:3'></a>Move this to 3.4.1 since I am closing this as dupe of #5559.\n\nCheers,\n\nMichael",
    "created_at": "2009-04-18T01:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5378#issuecomment-45129",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:3'></a>Move this to 3.4.1 since I am closing this as dupe of #5559.

Cheers,

Michael



---

archive/issue_events_012534.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-04-18T01:05:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5378",
    "milestone": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5378#event-12534"
}
```



---

archive/issue_events_012535.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-04-18T01:05:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5378",
    "milestone": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5378#event-12535"
}
```



---

archive/issue_comments_045130.json:
```json
{
    "body": "<a id='comment:4'></a>The following illustrates the problem and a potential solution:\n\n```\n----------------------------------------------------------------------\n----------------------------------------------------------------------\nLoading Sage library. Current Mercurial branch is: review\nsage: from sage.rings.polynomial.complex_roots import complex_roots\nsage: x = polygen(ZZ) \nsage: complex_roots(x^2 + 27*x + 181)\n[(-12.3819660112501?, 1), (-14.61803398874990? + 0.?e-27*I, 1)]\nsage: v=complex_roots(x^2 + 27*x + 181)\nsage: sorted((v[0][0].real(),v[1][0].real()))\n[-14.61803398874990?, -12.3819660112501?]\n```\nOn another machine we get:\n| Sage Version 3.4.1.rc3, Release Date: 2009-04-16                   |\n| Type notebook() for the GUI, and license() for information.        |\n```\nsage: from sage.rings.polynomial.complex_roots import complex_roots\nsage:  x = polygen(ZZ)  \nsage: complex_roots(x^2 + 27*x + 181)\n[(-14.61803398874990? + 0.?e-27*I, 1), (-12.38196601125010? + 0.?e-27*I, 1)]\nsage: v=complex_roots(x^2 + 27*x + 181)\nsage: sorted((v[0][0].real(),v[1][0].real()))\n[-14.61803398874990?, -12.38196601125010?]\n```\nPatch coming up.\n\nCheers,\n\nMichael",
    "created_at": "2009-04-19T01:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5378#issuecomment-45130",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:4'></a>The following illustrates the problem and a potential solution:

```
----------------------------------------------------------------------
----------------------------------------------------------------------
Loading Sage library. Current Mercurial branch is: review
sage: from sage.rings.polynomial.complex_roots import complex_roots
sage: x = polygen(ZZ) 
sage: complex_roots(x^2 + 27*x + 181)
[(-12.3819660112501?, 1), (-14.61803398874990? + 0.?e-27*I, 1)]
sage: v=complex_roots(x^2 + 27*x + 181)
sage: sorted((v[0][0].real(),v[1][0].real()))
[-14.61803398874990?, -12.3819660112501?]
```
On another machine we get:
| Sage Version 3.4.1.rc3, Release Date: 2009-04-16                   |
| Type notebook() for the GUI, and license() for information.        |
```
sage: from sage.rings.polynomial.complex_roots import complex_roots
sage:  x = polygen(ZZ)  
sage: complex_roots(x^2 + 27*x + 181)
[(-14.61803398874990? + 0.?e-27*I, 1), (-12.38196601125010? + 0.?e-27*I, 1)]
sage: v=complex_roots(x^2 + 27*x + 181)
sage: sorted((v[0][0].real(),v[1][0].real()))
[-14.61803398874990?, -12.38196601125010?]
```
Patch coming up.

Cheers,

Michael



---

archive/issue_comments_045131.json:
```json
{
    "body": "Attachment [trac_5378.patch](tarball://root/attachments/some-uuid/ticket5378/trac_5378.patch) by mabshoff created at 2009-04-19 01:45:21",
    "created_at": "2009-04-19T01:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5378#issuecomment-45131",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Attachment [trac_5378.patch](tarball://root/attachments/some-uuid/ticket5378/trac_5378.patch) by mabshoff created at 2009-04-19 01:45:21



---

archive/issue_comments_045132.json:
```json
{
    "body": "Changing status from new to assigned.",
    "created_at": "2009-04-19T01:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5378#issuecomment-45132",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Changing status from new to assigned.



---

archive/issue_comments_045133.json:
```json
{
    "body": "<a id='comment:6'></a>Builds and tests just fine.  Positive review.",
    "created_at": "2009-04-19T02:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5378#issuecomment-45133",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:6'></a>Builds and tests just fine.  Positive review.



---

archive/issue_comments_045134.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-04-19T02:10:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5378#issuecomment-45134",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Resolution: fixed



---

archive/issue_comments_045135.json:
```json
{
    "body": "<a id='comment:7'></a>Merged in Sage 3.4.1.rc4.\n\nCheers,\n\nMichael",
    "created_at": "2009-04-19T02:10:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5378#issuecomment-45135",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:7'></a>Merged in Sage 3.4.1.rc4.

Cheers,

Michael



---

archive/issue_events_012536.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-04-19T02:10:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/5378",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5378#event-12536"
}
```
