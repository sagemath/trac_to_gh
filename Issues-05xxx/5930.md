# Issue 5930: switch from maxima to pynac for core symbolic manipulation system

archive/issues_005930.json:
```json
{
    "assignees": [],
    "body": "SEE http://wiki.sagemath.org/symbolics/pynac_todo/push\n\nIf you want to try the code out do this:\n\n1. Apply symbolics_final1.patch from #5777\n\n2. Apply symbolics_final2.patch from this ticket.\n\n3. Build new pynac spkg:\n     http://sage.math.washington.edu/home/mhansen/pynac-0.1.7.spkg\n     \n\nAssignee: **@mwhansen**\n\nCC:  @burcin\n\n_Issue created by migration from https://trac.sagemath.org/ticket/5930_\n\n",
    "closed_at": "2009-05-21T02:46:34Z",
    "created_at": "2009-04-29T01:52:44Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "switch from maxima to pynac for core symbolic manipulation system",
    "type": "issue",
    "updated_at": "2017-06-07T13:00:42Z",
    "url": "https://github.com/sagemath/sage/issues/5930",
    "user": "https://github.com/williamstein"
}
```
SEE http://wiki.sagemath.org/symbolics/pynac_todo/push

If you want to try the code out do this:

1. Apply symbolics_final1.patch from #5777

2. Apply symbolics_final2.patch from this ticket.

3. Build new pynac spkg:
     http://sage.math.washington.edu/home/mhansen/pynac-0.1.7.spkg
     

Assignee: **@mwhansen**

CC:  @burcin

_Issue created by migration from https://trac.sagemath.org/ticket/5930_





---

archive/issue_events_063630.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-29T01:52:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "milestone_number": null,
    "milestone_title": "sage-4.0.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5930#event-63630"
}
```



---

archive/issue_events_063631.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-29T01:52:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5930#event-63631"
}
```



---

archive/issue_events_063632.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-29T01:52:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5930#event-63632"
}
```



---

archive/issue_events_063633.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-29T01:52:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5930#event-63633"
}
```



---

archive/issue_events_063634.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-05-05T09:57:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5930#event-63634"
}
```



---

archive/issue_events_063635.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-05-05T09:57:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "component: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5930#event-63635"
}
```



---

archive/issue_comments_039704.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nBug/Issue:  Control-C doesn't work in some cases. \n\n```\n----------------------------------------------------------------------\n| Sage Version 3.4.2, Release Date: 2009-05-05                       |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: var('x,y,z')\n(x, y, z)\nsage: time f = (x+y+z)^5\nCPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s\nWall time: 0.00 s\nsage: g = f*(f+1)\nsage: timeit('g.expand()')\n5 loops, best of 3: 53.2 ms per loop\nsage: %prun g.expand()\n         8890 function calls in 0.069 CPU seconds\n\n   Ordered by: internal time\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n        1    0.065    0.065    0.069    0.069 {method 'expand' of 'sage.symbolic.expression.Expression' objects}\n     8863    0.003    0.000    0.003    0.000 functional.py:393(imag)\n        1    0.000    0.000    0.069    0.069 <string>:1(<module>)\n        4    0.000    0.000    0.000    0.000 arith.py:1140(gcd)\n        4    0.000    0.000    0.000    0.000 {method 'lcm' of 'sage.structure.element.PrincipalIdealDomainElement' objects}\n        4    0.000    0.000    0.000    0.000 arith.py:1256(lcm)\n        4    0.000    0.000    0.000    0.000 {method 'gcd' of 'sage.rings.integer.Integer' objects}\n        8    0.000    0.000    0.000    0.000 {hasattr}\n        1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}\n\nsage: %prun v = [g.expand() for _ in range(1000)]\n^CException exceptions.KeyboardInterrupt: KeyboardInterrupt() in 'sage.symbolic.pynac.py_is_real' ignored\n^CException exceptions.KeyboardInterrupt: KeyboardInterrupt() in 'sage.symbolic.pynac.py_is_real' ignored\n^CException exceptions.KeyboardInterrupt: KeyboardInterrupt() in 'sage.symbolic.pynac.py_is_real' ignored\n```",
    "created_at": "2009-05-07T16:56:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39704",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:2" align="right">Comment 2</div>

Bug/Issue:  Control-C doesn't work in some cases. 

```
----------------------------------------------------------------------
| Sage Version 3.4.2, Release Date: 2009-05-05                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: var('x,y,z')
(x, y, z)
sage: time f = (x+y+z)^5
CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s
Wall time: 0.00 s
sage: g = f*(f+1)
sage: timeit('g.expand()')
5 loops, best of 3: 53.2 ms per loop
sage: %prun g.expand()
         8890 function calls in 0.069 CPU seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1    0.065    0.065    0.069    0.069 {method 'expand' of 'sage.symbolic.expression.Expression' objects}
     8863    0.003    0.000    0.003    0.000 functional.py:393(imag)
        1    0.000    0.000    0.069    0.069 <string>:1(<module>)
        4    0.000    0.000    0.000    0.000 arith.py:1140(gcd)
        4    0.000    0.000    0.000    0.000 {method 'lcm' of 'sage.structure.element.PrincipalIdealDomainElement' objects}
        4    0.000    0.000    0.000    0.000 arith.py:1256(lcm)
        4    0.000    0.000    0.000    0.000 {method 'gcd' of 'sage.rings.integer.Integer' objects}
        8    0.000    0.000    0.000    0.000 {hasattr}
        1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}

sage: %prun v = [g.expand() for _ in range(1000)]
^CException exceptions.KeyboardInterrupt: KeyboardInterrupt() in 'sage.symbolic.pynac.py_is_real' ignored
^CException exceptions.KeyboardInterrupt: KeyboardInterrupt() in 'sage.symbolic.pynac.py_is_real' ignored
^CException exceptions.KeyboardInterrupt: KeyboardInterrupt() in 'sage.symbolic.pynac.py_is_real' ignored
```



---

archive/issue_comments_039705.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,12 @@\n+If you want to try the code out, there is an spkg and two patches in\n \n+http://sage.math.washington.edu/home/mhansen/symbolics/.  \n+\n+These should install and apply cleanly to Sage 3.4.2.\n+Note that after applying all this you must delete all traces of constants.so:\n+\n+```\n+$ rm devel/sage/build/lib.macosx-10.3-i386-2.5/sage/symbolic/constants*\n+$ rm devel/sage/build/temp.macosx-10.3-i386-2.5/sage/symbolic/constants*\n+$ rm devel/sage/build/sage/symbolic/constants.so\n+```\n``````\n",
    "created_at": "2009-05-07T16:56:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39705",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,12 @@
+If you want to try the code out, there is an spkg and two patches in
 
+http://sage.math.washington.edu/home/mhansen/symbolics/.  
+
+These should install and apply cleanly to Sage 3.4.2.
+Note that after applying all this you must delete all traces of constants.so:
+
+```
+$ rm devel/sage/build/lib.macosx-10.3-i386-2.5/sage/symbolic/constants*
+$ rm devel/sage/build/temp.macosx-10.3-i386-2.5/sage/symbolic/constants*
+$ rm devel/sage/build/sage/symbolic/constants.so
+```
``````




---

archive/issue_comments_039706.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,12 +1,26 @@\n-If you want to try the code out, there is an spkg and two patches in\n+If you want to try the code out do this:\n \n-http://sage.math.washington.edu/home/mhansen/symbolics/.  \n+1. Install sage-3.4.2.\n \n-These should install and apply cleanly to Sage 3.4.2.\n-Note that after applying all this you must delete all traces of constants.so:\n+2. Build pynac (should take about 3-5 minutes):\n \n ```\n-$ rm devel/sage/build/lib.macosx-10.3-i386-2.5/sage/symbolic/constants*\n-$ rm devel/sage/build/temp.macosx-10.3-i386-2.5/sage/symbolic/constants*\n-$ rm devel/sage/build/sage/symbolic/constants.so\n+./sage -i http://sage.math.washington.edu/home/mhansen/symbolics/pynac-0.1.6-mh.spkg\n ```\n+\n+3. Apply the two patches at http://sage.math.washington.edu/home/mhansen/symbolics/  \n+\n+```\n+sage: hg_sage.apply('http://sage.math.washington.edu/home/mhansen/symbolics/symbolics_1.patch')\n+sage: hg_sage.apply('http://sage.math.washington.edu/home/mhansen/symbolics/symbolics_2.patch')\n+```\n+Just check in each with some random comment.\n+\n+4. Delete all traces of constants.so:\n+\n+```\n+rm devel/sage/build/*/sage/symbolic/constants*\n+rm devel/sage/build/sage/symbolic/constants.so\n+```\n+\n+5. Build with \"sage -br\", and it should work.  Building will take a while, since the patches touch many files. \n``````\n",
    "created_at": "2009-05-07T17:06:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39706",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,12 +1,26 @@
-If you want to try the code out, there is an spkg and two patches in
+If you want to try the code out do this:
 
-http://sage.math.washington.edu/home/mhansen/symbolics/.  
+1. Install sage-3.4.2.
 
-These should install and apply cleanly to Sage 3.4.2.
-Note that after applying all this you must delete all traces of constants.so:
+2. Build pynac (should take about 3-5 minutes):
 
 ```
-$ rm devel/sage/build/lib.macosx-10.3-i386-2.5/sage/symbolic/constants*
-$ rm devel/sage/build/temp.macosx-10.3-i386-2.5/sage/symbolic/constants*
-$ rm devel/sage/build/sage/symbolic/constants.so
+./sage -i http://sage.math.washington.edu/home/mhansen/symbolics/pynac-0.1.6-mh.spkg
 ```
+
+3. Apply the two patches at http://sage.math.washington.edu/home/mhansen/symbolics/  
+
+```
+sage: hg_sage.apply('http://sage.math.washington.edu/home/mhansen/symbolics/symbolics_1.patch')
+sage: hg_sage.apply('http://sage.math.washington.edu/home/mhansen/symbolics/symbolics_2.patch')
+```
+Just check in each with some random comment.
+
+4. Delete all traces of constants.so:
+
+```
+rm devel/sage/build/*/sage/symbolic/constants*
+rm devel/sage/build/sage/symbolic/constants.so
+```
+
+5. Build with "sage -br", and it should work.  Building will take a while, since the patches touch many files. 
``````




---

archive/issue_comments_039707.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nThere is a sequence of *serious* speed regressions that I think Burcin caused by changes to the pynac spkg:\n\nIN SAGE-3.2 we get OK timings for this benchmarks.  They aren't great, but I can live with them, since it is\"only\" 57 times slower than Singular:\n\n```\nsage: var('x,y,z', ns=1); f = (x+y+z)^6;\nsage: timeit('(f*(f+1)).expand()')\n125 loops, best of 3: 3.25 ms per loop\n```\n\nIn Singular:\n\n```\nsage: R.<x,y,z> = QQ[]\nsage: timeit('g=(x+y+z)^6*((x+y+z)^6+1)')\n625 loops, best of 3: 56.3 \u00b5s per loop\nsage: 3250/56.3\n57.7264653641208\n```\n\nIt's hard to tell, but Mathematica seems to take about 1.7ms, which is comparable to the above:\n\n```\nsage: timeit(\"s=mathematica('Expand[(x+y+z)^6*((x+y+z)^6+1)]')\")\n125 loops, best of 3: 1.81 ms per loop\nsage: timeit(\"s=mathematica('2+3')\")\n625 loops, best of 3: 125 \u00b5s per loop\n```\n\nMaxima via Sage takes about 61 ms, since I guess (c)lisp is slow, etc.:\n\n```\nsage: timeit(\"s=maxima('expand((x+y+z)^6*((x+y+z)^6+1))')\")\n5 loops, best of 3: 61.8 ms per loop\n```\n\nFirst there was a MAJOR unacceptable speed regression going to sage-3.3 (this is probably all caused by the pynac spkg).  The timing jumped all the way to 42ms, so now it's almost as bad as Maxima:\n\n```\nsage: var('x,y,z', ns=1); f = (x+y+z)^6\n(x, y, z)\nsage: timeit('(f*(f+1)).expand()')\n5 loops, best of 3: 42.1 ms per loop\n```\n\nIn fact, directly in sage-3.2 with old Maxima symbolics:\n\n```\nsage: var('x,y,z', ns=0); f = (x+y+z)^6\nsage: timeit('(f*(f+1)).expand()')\n5 loops, best of 3: 106 ms per loop\n```\n\n\nIN SAGE-3.4.2 with new symbolics:\n\n```\nsage: var('x,y,z', ns=1); f = (x+y+z)^6\n(x, y, z)\nsage: timeit('(f*(f+1)).expand()')\n5 loops, best of 3: 206 ms per loop\n```\n\nThis may be due to a change in the pynac layer, where it is calling out to Python for some reason, even though it shouldn't need to.   206ms is really unacceptable.  It's much slower than Maxima itself, it's 63 times slower than Pynac *was* just a few months ago, and it's 367 times slower than Singular.",
    "created_at": "2009-05-07T17:33:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39707",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:4" align="right">Comment 4</div>

There is a sequence of *serious* speed regressions that I think Burcin caused by changes to the pynac spkg:

IN SAGE-3.2 we get OK timings for this benchmarks.  They aren't great, but I can live with them, since it is"only" 57 times slower than Singular:

```
sage: var('x,y,z', ns=1); f = (x+y+z)^6;
sage: timeit('(f*(f+1)).expand()')
125 loops, best of 3: 3.25 ms per loop
```

In Singular:

```
sage: R.<x,y,z> = QQ[]
sage: timeit('g=(x+y+z)^6*((x+y+z)^6+1)')
625 loops, best of 3: 56.3 µs per loop
sage: 3250/56.3
57.7264653641208
```

It's hard to tell, but Mathematica seems to take about 1.7ms, which is comparable to the above:

```
sage: timeit("s=mathematica('Expand[(x+y+z)^6*((x+y+z)^6+1)]')")
125 loops, best of 3: 1.81 ms per loop
sage: timeit("s=mathematica('2+3')")
625 loops, best of 3: 125 µs per loop
```

Maxima via Sage takes about 61 ms, since I guess (c)lisp is slow, etc.:

```
sage: timeit("s=maxima('expand((x+y+z)^6*((x+y+z)^6+1))')")
5 loops, best of 3: 61.8 ms per loop
```

First there was a MAJOR unacceptable speed regression going to sage-3.3 (this is probably all caused by the pynac spkg).  The timing jumped all the way to 42ms, so now it's almost as bad as Maxima:

```
sage: var('x,y,z', ns=1); f = (x+y+z)^6
(x, y, z)
sage: timeit('(f*(f+1)).expand()')
5 loops, best of 3: 42.1 ms per loop
```

In fact, directly in sage-3.2 with old Maxima symbolics:

```
sage: var('x,y,z', ns=0); f = (x+y+z)^6
sage: timeit('(f*(f+1)).expand()')
5 loops, best of 3: 106 ms per loop
```


IN SAGE-3.4.2 with new symbolics:

```
sage: var('x,y,z', ns=1); f = (x+y+z)^6
(x, y, z)
sage: timeit('(f*(f+1)).expand()')
5 loops, best of 3: 206 ms per loop
```

This may be due to a change in the pynac layer, where it is calling out to Python for some reason, even though it shouldn't need to.   206ms is really unacceptable.  It's much slower than Maxima itself, it's 63 times slower than Pynac *was* just a few months ago, and it's 367 times slower than Singular.



---

archive/issue_comments_039708.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n+SEE http://wiki.sagemath.org/symbolics/pynac_todo/push\n+\n If you want to try the code out do this:\n \n 1. Install sage-3.4.2.\n``````\n",
    "created_at": "2009-05-07T23:25:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39708",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
+SEE http://wiki.sagemath.org/symbolics/pynac_todo/push
+
 If you want to try the code out do this:
 
 1. Install sage-3.4.2.
``````




---

archive/issue_comments_039709.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -26,3 +26,5 @@\n ```\n \n 5. Build with \"sage -br\", and it should work.  Building will take a while, since the patches touch many files. \n+\n+OTHER RELEVANT CODE: #6005\n``````\n",
    "created_at": "2009-05-08T00:44:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39709",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -26,3 +26,5 @@
 ```
 
 5. Build with "sage -br", and it should work.  Building will take a while, since the patches touch many files. 
+
+OTHER RELEVANT CODE: #6005
``````




---

archive/issue_events_063636.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-05-18T07:27:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "milestone_number": null,
    "milestone_title": "sage-4.0.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5930#event-63636"
}
```



---

archive/issue_events_063637.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-05-18T07:27:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "milestone_number": null,
    "milestone_title": "sage-4.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5930#event-63637"
}
```



---

archive/issue_comments_039710.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,6 @@\n+\n+\n+\n SEE http://wiki.sagemath.org/symbolics/pynac_todo/push\n \n If you want to try the code out do this:\n``````\n",
    "created_at": "2009-05-18T07:27:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39710",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,6 @@
+
+
+
 SEE http://wiki.sagemath.org/symbolics/pynac_todo/push
 
 If you want to try the code out do this:
``````




---

archive/issue_events_063638.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-05-19T04:11:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5930#event-63638"
}
```



---

archive/issue_comments_039711.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nI've attached symbolics_final2.patch which applies on top of #5777.  This patch also requires the Pynac 0.1.7 spkg at http://sage.math.washington.edu/home/mhansen/pynac-0.1.7.spkg",
    "created_at": "2009-05-19T04:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39711",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:8" align="right">Comment 8</div>

I've attached symbolics_final2.patch which applies on top of #5777.  This patch also requires the Pynac 0.1.7 spkg at http://sage.math.washington.edu/home/mhansen/pynac-0.1.7.spkg



---

archive/issue_comments_039712.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,3 @@\n-\n \n \n SEE http://wiki.sagemath.org/symbolics/pynac_todo/push\n``````\n",
    "created_at": "2009-05-19T04:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39712",
    "user": "https://github.com/mwhansen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,3 @@
-
 
 
 SEE http://wiki.sagemath.org/symbolics/pynac_todo/push
``````




---

archive/issue_events_063639.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-05-19T04:11:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5930#event-63639"
}
```



---

archive/issue_comments_039713.json:
```json
{
    "body": "Assignee: **@mwhansen**",
    "created_at": "2009-05-19T04:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39713",
    "user": "https://github.com/mwhansen"
}
```

Assignee: **@mwhansen**



---

archive/issue_comments_039714.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,32 +1,11 @@\n-\n \n SEE http://wiki.sagemath.org/symbolics/pynac_todo/push\n \n If you want to try the code out do this:\n \n-1. Install sage-3.4.2.\n+1. Apply symbolics_final1.patch from #5777\n \n-2. Build pynac (should take about 3-5 minutes):\n+2. Apply symbolics_final2.patch from this ticket.\n \n-```\n-./sage -i http://sage.math.washington.edu/home/mhansen/symbolics/pynac-0.1.6-mh.spkg\n-```\n-\n-3. Apply the two patches at http://sage.math.washington.edu/home/mhansen/symbolics/  \n-\n-```\n-sage: hg_sage.apply('http://sage.math.washington.edu/home/mhansen/symbolics/symbolics_1.patch')\n-sage: hg_sage.apply('http://sage.math.washington.edu/home/mhansen/symbolics/symbolics_2.patch')\n-```\n-Just check in each with some random comment.\n-\n-4. Delete all traces of constants.so:\n-\n-```\n-rm devel/sage/build/*/sage/symbolic/constants*\n-rm devel/sage/build/sage/symbolic/constants.so\n-```\n-\n-5. Build with \"sage -br\", and it should work.  Building will take a while, since the patches touch many files. \n-\n-OTHER RELEVANT CODE: #6005\n+3. Build new pynac spkg:\n+     http://sage.math.washington.edu/home/mhansen/pynac-0.1.6-mh.p11.spkg\n``````\n",
    "created_at": "2009-05-19T20:16:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39714",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,32 +1,11 @@
-
 
 SEE http://wiki.sagemath.org/symbolics/pynac_todo/push
 
 If you want to try the code out do this:
 
-1. Install sage-3.4.2.
+1. Apply symbolics_final1.patch from #5777
 
-2. Build pynac (should take about 3-5 minutes):
+2. Apply symbolics_final2.patch from this ticket.
 
-```
-./sage -i http://sage.math.washington.edu/home/mhansen/symbolics/pynac-0.1.6-mh.spkg
-```
-
-3. Apply the two patches at http://sage.math.washington.edu/home/mhansen/symbolics/  
-
-```
-sage: hg_sage.apply('http://sage.math.washington.edu/home/mhansen/symbolics/symbolics_1.patch')
-sage: hg_sage.apply('http://sage.math.washington.edu/home/mhansen/symbolics/symbolics_2.patch')
-```
-Just check in each with some random comment.
-
-4. Delete all traces of constants.so:
-
-```
-rm devel/sage/build/*/sage/symbolic/constants*
-rm devel/sage/build/sage/symbolic/constants.so
-```
-
-5. Build with "sage -br", and it should work.  Building will take a while, since the patches touch many files. 
-
-OTHER RELEVANT CODE: #6005
+3. Build new pynac spkg:
+     http://sage.math.washington.edu/home/mhansen/pynac-0.1.6-mh.p11.spkg
``````




---

archive/issue_comments_039715.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,3 @@\n-\n SEE http://wiki.sagemath.org/symbolics/pynac_todo/push\n \n If you want to try the code out do this:\n@@ -8,4 +7,5 @@\n 2. Apply symbolics_final2.patch from this ticket.\n \n 3. Build new pynac spkg:\n-     http://sage.math.washington.edu/home/mhansen/pynac-0.1.6-mh.p11.spkg\n+     http://sage.math.washington.edu/home/mhansen/pynac-0.1.7.spkg\n+     \n``````\n",
    "created_at": "2009-05-19T20:19:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39715",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,3 @@
-
 SEE http://wiki.sagemath.org/symbolics/pynac_todo/push
 
 If you want to try the code out do this:
@@ -8,4 +7,5 @@
 2. Apply symbolics_final2.patch from this ticket.
 
 3. Build new pynac spkg:
-     http://sage.math.washington.edu/home/mhansen/pynac-0.1.6-mh.p11.spkg
+     http://sage.math.washington.edu/home/mhansen/pynac-0.1.7.spkg
+     
``````




---

archive/issue_comments_039716.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nAfter applying the first patch, the second fails.  This is to clean 4.0.alpha0:\n\n```\nsage: hg_sage.apply('https://github.com/sagemath/sage/files/ticket5930/symbolics_final2.patch.gz')\nAttempting to load remote file: https://github.com/sagemath/sage/files/ticket5930/symbolics_final2.patch.gz\nLoading: [..................................................]\ncd \"/Users/wstein/build/sage-4.0.alpha0/devel/sage\" && hg status\ncd \"/Users/wstein/build/sage-4.0.alpha0/devel/sage\" && hg status\ncd \"/Users/wstein/build/sage-4.0.alpha0/devel/sage\" && hg import   \"/Users/wstein/.sage/temp/teragon.local/1113/tmp_2.patch\"\napplying /Users/wstein/.sage/temp/teragon.local/1113/tmp_2.patch\npatching file doc/en/constructions/calculus.rst\nHunk #5 FAILED at 141\n1 out of 10 hunks FAILED -- saving rejects to file doc/en/constructions/calculus.rst.rej\npatching file sage/calculus/calculus.py\nHunk #15 FAILED at 291\n1 out of 25 hunks FAILED -- saving rejects to file sage/calculus/calculus.py.rej\npatching file sage/quadratic_forms/quadratic_form__mass__Conway_Sloane_masses.py\nHunk #1 succeeded at 4 with fuzz 2 (offset 0 lines).\npatching file sage/symbolic/function.pyx\nHunk #9 FAILED at 206\n1 out of 25 hunks FAILED -- saving rejects to file sage/symbolic/function.pyx.rej\nabort: patch failed to apply\n```",
    "created_at": "2009-05-19T20:21:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39716",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:11" align="right">Comment 11</div>

After applying the first patch, the second fails.  This is to clean 4.0.alpha0:

```
sage: hg_sage.apply('https://github.com/sagemath/sage/files/ticket5930/symbolics_final2.patch.gz')
Attempting to load remote file: https://github.com/sagemath/sage/files/ticket5930/symbolics_final2.patch.gz
Loading: [..................................................]
cd "/Users/wstein/build/sage-4.0.alpha0/devel/sage" && hg status
cd "/Users/wstein/build/sage-4.0.alpha0/devel/sage" && hg status
cd "/Users/wstein/build/sage-4.0.alpha0/devel/sage" && hg import   "/Users/wstein/.sage/temp/teragon.local/1113/tmp_2.patch"
applying /Users/wstein/.sage/temp/teragon.local/1113/tmp_2.patch
patching file doc/en/constructions/calculus.rst
Hunk #5 FAILED at 141
1 out of 10 hunks FAILED -- saving rejects to file doc/en/constructions/calculus.rst.rej
patching file sage/calculus/calculus.py
Hunk #15 FAILED at 291
1 out of 25 hunks FAILED -- saving rejects to file sage/calculus/calculus.py.rej
patching file sage/quadratic_forms/quadratic_form__mass__Conway_Sloane_masses.py
Hunk #1 succeeded at 4 with fuzz 2 (offset 0 lines).
patching file sage/symbolic/function.pyx
Hunk #9 FAILED at 206
1 out of 25 hunks FAILED -- saving rejects to file sage/symbolic/function.pyx.rej
abort: patch failed to apply
```



---

archive/issue_comments_039717.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nReplying to [@williamstein](#comment%3A11):\n> After applying the first patch, the second fails.  This is to clean 4.0.alpha0:\n\nThis patch set is on top of last night's 4.0.rc0 merge tree and will not work with 4.0.a0.\n\nCheers,\n\nMichael",
    "created_at": "2009-05-19T20:23:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39717",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:12" align="right">Comment 12</div>

Replying to [@williamstein](#comment%3A11):
> After applying the first patch, the second fails.  This is to clean 4.0.alpha0:

This patch set is on top of last night's 4.0.rc0 merge tree and will not work with 4.0.a0.

Cheers,

Michael



---

archive/issue_comments_039718.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nsymbolics_final2.patch does not import:\n\n```\nmabshoff@sage:/scratch/mabshoff/sage-4.0.rc0/devel/sage$ hg import symbolics_final1.patch\napplying symbolics_final1.patch\nmabshoff@sage:/scratch/mabshoff/sage-4.0.rc0/devel/sage$ hg import symbolics_final2.patch\napplying symbolics_final2.patch\npatching file sage/symbolic/function.pyx\nHunk #9 FAILED at 206\n1 out of 25 hunks FAILED -- saving rejects to file sage/symbolic/function.pyx.rej\nabort: patch failed to apply\nmabshoff@sage:/scratch/mabshoff/sage-4.0.rc0/devel/sage$ less sage/symbolic/function.pyx.rej\n```\nI have not touched the file that sees rejects since Mike pulled it last night, so please fix this :)\n\nCheers,\n\nMichael",
    "created_at": "2009-05-19T20:59:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39718",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:13" align="right">Comment 13</div>

symbolics_final2.patch does not import:

```
mabshoff@sage:/scratch/mabshoff/sage-4.0.rc0/devel/sage$ hg import symbolics_final1.patch
applying symbolics_final1.patch
mabshoff@sage:/scratch/mabshoff/sage-4.0.rc0/devel/sage$ hg import symbolics_final2.patch
applying symbolics_final2.patch
patching file sage/symbolic/function.pyx
Hunk #9 FAILED at 206
1 out of 25 hunks FAILED -- saving rejects to file sage/symbolic/function.pyx.rej
abort: patch failed to apply
mabshoff@sage:/scratch/mabshoff/sage-4.0.rc0/devel/sage$ less sage/symbolic/function.pyx.rej
```
I have not touched the file that sees rejects since Mike pulled it last night, so please fix this :)

Cheers,

Michael



---

archive/issue_comments_039719.json:
```json
{
    "body": "Attachment: **[symbolics_final2.patch.gz](https://github.com/sagemath/sage/files/ticket5930/symbolics_final2.patch.gz)**",
    "created_at": "2009-05-19T23:02:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39719",
    "user": "https://github.com/mwhansen"
}
```

Attachment: **[symbolics_final2.patch.gz](https://github.com/sagemath/sage/files/ticket5930/symbolics_final2.patch.gz)**



---

archive/issue_comments_039720.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nOk, the latest patch applies, but lacks a commit message.\n\nCheers,\n\nMichael",
    "created_at": "2009-05-19T23:27:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39720",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:14" align="right">Comment 14</div>

Ok, the latest patch applies, but lacks a commit message.

Cheers,

Michael



---

archive/issue_events_063640.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-05-20T01:02:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5930#event-63640"
}
```



---

archive/issue_comments_039721.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nThe spkg needs work:\n\n```\nconfigure: creating ./config.statusConfiguration of GiNaC 0.1.5 done. Now type \"make\".\n /bin/sh ./config.status\nconfig.status: creating Makefileconfig.status: creating pynac.spec\nconfig.status: creating pynac.pcconfig.status: creating ginac/Makefile\nconfig.status: creating ginac/version.h\nconfig.status: creating config.hconfig.status: config.h is unchanged\nconfig.status: executing depfiles commandscd . && /bin/sh /home/mabshoff/build-4.0.alpha0/sage-4.0.alpha0-cleo-system/spkg/build/pynac-0.1.7/src/missing --run autoheader\naclocal.m4:20: warning: this file was generated for autoconf 2.61.\nYou have another version of autoconf.  It may work, but is not guaranteed to.If you have problems, you may need to regenerate the build system entirely.\nTo do so, use the procedure documented by the package, typically `autoreconf'.configure.ac:26: error: Autoconf version 2.60 or higher is required\naclocal.m4:7127: AM_INIT_AUTOMAKE is expanded from...\nconfigure.ac:26: the top levelautom4te: /usr/bin/m4 failed with exit status: 63\nautoheader: /usr/bin/autom4te failed with exit status: 63\n```\nAll this autocrap should never be run in the spkg. The version number as well as the name of the library is also wrong.\n\nCheers,\n\nMichael",
    "created_at": "2009-05-20T01:02:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39721",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:15" align="right">Comment 15</div>

The spkg needs work:

```
configure: creating ./config.statusConfiguration of GiNaC 0.1.5 done. Now type "make".
 /bin/sh ./config.status
config.status: creating Makefileconfig.status: creating pynac.spec
config.status: creating pynac.pcconfig.status: creating ginac/Makefile
config.status: creating ginac/version.h
config.status: creating config.hconfig.status: config.h is unchanged
config.status: executing depfiles commandscd . && /bin/sh /home/mabshoff/build-4.0.alpha0/sage-4.0.alpha0-cleo-system/spkg/build/pynac-0.1.7/src/missing --run autoheader
aclocal.m4:20: warning: this file was generated for autoconf 2.61.
You have another version of autoconf.  It may work, but is not guaranteed to.If you have problems, you may need to regenerate the build system entirely.
To do so, use the procedure documented by the package, typically `autoreconf'.configure.ac:26: error: Autoconf version 2.60 or higher is required
aclocal.m4:7127: AM_INIT_AUTOMAKE is expanded from...
configure.ac:26: the top levelautom4te: /usr/bin/m4 failed with exit status: 63
autoheader: /usr/bin/autom4te failed with exit status: 63
```
All this autocrap should never be run in the spkg. The version number as well as the name of the library is also wrong.

Cheers,

Michael



---

archive/issue_comments_039722.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nI've been reading through the megabyte patch, and testing every function that's been touched.  I'd estimate my coverage of the file to be about 20%, and I made sure to bounce around a bunch (that is, I didn't just read the top or bottom 20%).  I didn't look at many corner cases, because I was trying to test as much as I could, and it often takes thought to come up with good corner cases.  In the end, I found some things that Maxima crashed on when it tried to simplify, like \n\n```\n exp(sum([log(x^(1/n)) for n in range(1,1000)]))\n```\nbut other than that, I found the entire system to be stable and useful.  In a lot of easy cases, it's *much* faster than before, which makes me happy.",
    "created_at": "2009-05-20T04:50:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39722",
    "user": "https://github.com/sagetrac-boothby"
}
```

<div id="comment:16" align="right">Comment 16</div>

I've been reading through the megabyte patch, and testing every function that's been touched.  I'd estimate my coverage of the file to be about 20%, and I made sure to bounce around a bunch (that is, I didn't just read the top or bottom 20%).  I didn't look at many corner cases, because I was trying to test as much as I could, and it often takes thought to come up with good corner cases.  In the end, I found some things that Maxima crashed on when it tried to simplify, like 

```
 exp(sum([log(x^(1/n)) for n in range(1,1000)]))
```
but other than that, I found the entire system to be stable and useful.  In a lot of easy cases, it's *much* faster than before, which makes me happy.



---

archive/issue_comments_039723.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nI am doing the following\n\n* install pynac-1.0.17\n* pull in latest changes \n* sage -ba\n* install dsage\n* update pickle jar\n* run testlong\n\non \n\n* Linux x86, x86-64 and Itanium\n* some of the above with gcc 4.4\n* Solaris Sparc (32 bit)\n* OSX 10.4 (PPC)\n\nI am currently running `testlong`, so we should know more in the morning (local time)\n\nCheers,\n\nMichael",
    "created_at": "2009-05-20T10:49:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39723",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:17" align="right">Comment 17</div>

I am doing the following

* install pynac-1.0.17
* pull in latest changes 
* sage -ba
* install dsage
* update pickle jar
* run testlong

on 

* Linux x86, x86-64 and Itanium
* some of the above with gcc 4.4
* Solaris Sparc (32 bit)
* OSX 10.4 (PPC)

I am currently running `testlong`, so we should know more in the morning (local time)

Cheers,

Michael



---

archive/issue_comments_039724.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nOk, no joy: On Solaris/Sparc this patchset causes a hang in maxima.py. Mike told me that William and him allegedly fixed the underlying issue (see the discussion about the semicolon at #6054), but it causes the hang. All Maxima related doctests pass on that machine (modulo two tiny numerical noise problems), so the patch on this ticket is to blame.\n\nCheers,\n\nMichael",
    "created_at": "2009-05-20T13:45:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39724",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:18" align="right">Comment 18</div>

Ok, no joy: On Solaris/Sparc this patchset causes a hang in maxima.py. Mike told me that William and him allegedly fixed the underlying issue (see the discussion about the semicolon at #6054), but it causes the hang. All Maxima related doctests pass on that machine (modulo two tiny numerical noise problems), so the patch on this ticket is to blame.

Cheers,

Michael



---

archive/issue_comments_039725.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nAnd the failing doctest is this one:\n\n```\nTrying:\n    maxima('2+2')###line 751:_sage_    >>> maxima('2+2')\nExpecting:\n    4\n```\n\nCheers,\n\nMichael",
    "created_at": "2009-05-20T13:48:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39725",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:19" align="right">Comment 19</div>

And the failing doctest is this one:

```
Trying:
    maxima('2+2')###line 751:_sage_    >>> maxima('2+2')
Expecting:
    4
```

Cheers,

Michael



---

archive/issue_comments_039726.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nHmm, this looks suspicious, but reverting it does not fix the problem:\n\n```\n@@ -755,7 +755,7 @@\n         if self._expect is None: return\n         r = randrange(2147483647)\n         s = marker + str(r+1)\n-        cmd = ''';sconcat(\"%s\",(%s+1));\\n'''%(marker,r)\n+        cmd = '''0;sconcat(\"%s\",(%s+1));\\n'''%(marker,r)\n         self._sendstr(cmd)\n         try:\n             self._expect_expr(timeout=0.5)\n```\nRunning `maxima('2+2')` in a loop does work, so I am not sure what the problem is yet.\n\nCheers,\n\nMichael",
    "created_at": "2009-05-20T13:57:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39726",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:20" align="right">Comment 20</div>

Hmm, this looks suspicious, but reverting it does not fix the problem:

```
@@ -755,7 +755,7 @@
         if self._expect is None: return
         r = randrange(2147483647)
         s = marker + str(r+1)
-        cmd = ''';sconcat("%s",(%s+1));\n'''%(marker,r)
+        cmd = '''0;sconcat("%s",(%s+1));\n'''%(marker,r)
         self._sendstr(cmd)
         try:
             self._expect_expr(timeout=0.5)
```
Running `maxima('2+2')` in a loop does work, so I am not sure what the problem is yet.

Cheers,

Michael



---

archive/issue_comments_039727.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nHmm, another thing:\n\n```\n cdef class Matrix_symbolic_dense(matrix_dense.Matrix_dense):\n     r\"\"\"\n@@ -162,7 +161,7 @@\n             sage: cmp(m,m)\n             0\n             sage: cmp(m,3)\n-            -1\n+            1\n         \"\"\"\n         return self._richcmp(right, op)\n \n```\nis cmp() in this case deterministic? \n\nCheers,\n\nMichael",
    "created_at": "2009-05-20T14:03:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39727",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:21" align="right">Comment 21</div>

Hmm, another thing:

```
 cdef class Matrix_symbolic_dense(matrix_dense.Matrix_dense):
     r"""
@@ -162,7 +161,7 @@
             sage: cmp(m,m)
             0
             sage: cmp(m,3)
-            -1
+            1
         """
         return self._richcmp(right, op)
 
```
is cmp() in this case deterministic? 

Cheers,

Michael



---

archive/issue_comments_039728.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nFormal positive review by various other people not me. Followup should be directed to new tickets for 4.0 as long as it is open.\n\nCheers,\n\nMichael",
    "created_at": "2009-05-21T02:46:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39728",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:22" align="right">Comment 22</div>

Formal positive review by various other people not me. Followup should be directed to new tickets for 4.0 as long as it is open.

Cheers,

Michael



---

archive/issue_events_063641.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-05-21T02:46:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5930#event-63641"
}
```



---

archive/issue_events_063642.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-05-21T02:46:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5930#event-63642"
}
```



---

archive/issue_events_063643.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-05-21T02:46:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5930#event-63643"
}
```



---

archive/issue_events_063644.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-05-21T02:46:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5930#event-63644"
}
```



---

archive/issue_comments_039729.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nMerged in Sage 4.0.rc0.\n\nCheers,\n\nMichael",
    "created_at": "2009-05-21T02:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39729",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:23" align="right">Comment 23</div>

Merged in Sage 4.0.rc0.

Cheers,

Michael



---

archive/issue_comments_039730.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nSee #6111 for refereeing of symbolics.",
    "created_at": "2009-05-21T09:53:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39730",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:24" align="right">Comment 24</div>

See #6111 for refereeing of symbolics.



---

archive/issue_events_063645.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-05-21T09:53:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5930#event-63645"
}
```



---

archive/issue_comments_039731.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nDoes anybody happen to remember why there is this strange condition involving `inspect.ismethod`?\n\n```python\n            import inspect\n            if not hasattr(_the_element,'_fast_callable_') or not inspect.ismethod(_the_element._fast_callable_):\n                # only warn if _the_element is not dynamic\n                from sage.misc.superseded import deprecation\n                deprecation(5930, \"Substitution using function-call syntax and unnamed arguments is deprecated and will be removed from a future release of Sage; you ca\n```",
    "created_at": "2017-06-07T12:55:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39731",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">Comment 25</div>

Does anybody happen to remember why there is this strange condition involving `inspect.ismethod`?

```python
            import inspect
            if not hasattr(_the_element,'_fast_callable_') or not inspect.ismethod(_the_element._fast_callable_):
                # only warn if _the_element is not dynamic
                from sage.misc.superseded import deprecation
                deprecation(5930, "Substitution using function-call syntax and unnamed arguments is deprecated and will be removed from a future release of Sage; you ca
```



---

archive/issue_comments_039732.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nNever mind, that condition was actually added in #2516.",
    "created_at": "2017-06-07T13:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5930#issuecomment-39732",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">Comment 26</div>

Never mind, that condition was actually added in #2516.
