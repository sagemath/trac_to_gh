# Issue 5572: fast_callable improvements (followup for #5093)

archive/issues_005572.json:
```json
{
    "body": "The code at #5093 is very good and ready to go in, but there are several improvements that have been suggested and agreed work on at a later date. They are posted here so we can merge and close the other ticket. \n\nSpecifically, this ticket addresses these issues:\n\n* `fast_callable` on `list`, `tuple`, `vector`, `matrix` arguments\n\n* `fast_callable` on constant arguments\n\n* `fast_callable` of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments\n\n* in general replaces calls to `fast_float` with calls to `fast_callable`. \n\n* Carries out the deprecation in #5413 (removes the functionality deprecated there)\n\n* `fast_float` sometimes returns symbolic values instead of floating-point values (see #17684, which patches `density_plot` to work around this bug)\n\n\nBecause of some of the far-reaching changes, this should probably not be merged in a point-point release.\n\nWhat is not fixed:\n\n* Robert's suggestion: an option that uses a fast domain, if it's there, but ignores the domain parameter if it's not (I don't mind the idea, and the implementation is easy; what should the syntax be? Part of my problem picking a syntax is that I don't want to promise that a specialized interpreter is always faster than the Python-object interpreter, so I don't particularly want to use the word \"fast\" in any option names.)\n\n\n\n\n\nThe work on this ticket:\n\n* Makes #8450 easy, probably\n* Makes #7512 invalid, probably\n\nSee also\n* #10087\n* #7165\n* #11766 -- rewrite some of `fast_callable` to have its own recursion stack\n\n**Assignee:** cwitty\n\n**CC:**  @robertwb @TimDumol @eviatarbach @novoselt @orlitzky\n\n**Author:** Jason Grout\n\n**Status:** needs_work\n\nIssue created by migration from https://trac.sagemath.org/ticket/5572\n\n",
    "created_at": "2009-03-19T23:55:25Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "fast_callable improvements (followup for #5093)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/5572",
    "user": "https://github.com/robertwb"
}
```
The code at #5093 is very good and ready to go in, but there are several improvements that have been suggested and agreed work on at a later date. They are posted here so we can merge and close the other ticket. 

Specifically, this ticket addresses these issues:

* `fast_callable` on `list`, `tuple`, `vector`, `matrix` arguments

* `fast_callable` on constant arguments

* `fast_callable` of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments

* in general replaces calls to `fast_float` with calls to `fast_callable`. 

* Carries out the deprecation in #5413 (removes the functionality deprecated there)

* `fast_float` sometimes returns symbolic values instead of floating-point values (see #17684, which patches `density_plot` to work around this bug)


Because of some of the far-reaching changes, this should probably not be merged in a point-point release.

What is not fixed:

* Robert's suggestion: an option that uses a fast domain, if it's there, but ignores the domain parameter if it's not (I don't mind the idea, and the implementation is easy; what should the syntax be? Part of my problem picking a syntax is that I don't want to promise that a specialized interpreter is always faster than the Python-object interpreter, so I don't particularly want to use the word "fast" in any option names.)





The work on this ticket:

* Makes #8450 easy, probably
* Makes #7512 invalid, probably

See also
* #10087
* #7165
* #11766 -- rewrite some of `fast_callable` to have its own recursion stack

**Assignee:** cwitty

**CC:**  @robertwb @TimDumol @eviatarbach @novoselt @orlitzky

**Author:** Jason Grout

**Status:** needs_work

Issue created by migration from https://trac.sagemath.org/ticket/5572





---

archive/issue_comments_052041.json:
```json
{
    "body": "**Assignee:** cwitty",
    "created_at": "2009-03-26T02:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52041",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

**Assignee:** cwitty



---

archive/issue_comments_052042.json:
```json
{
    "body": "**Changing status** from new to assigned.",
    "created_at": "2009-03-26T02:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52042",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

**Changing status** from new to assigned.



---

archive/issue_comments_052043.json:
```json
{
    "body": "<a id='comment:2'></a>\nMore fast_callable improvements:\n\n* domain=float is the same as domain=RDF, but domain=complex is not the same as domain=CDF.  Make domain=complex use the same interpreter as domain=CDF\n\n* if g is a callable expression, then fast_callable(g) should use g.args() for the variables, not g.variables().  Hmm...or maybe return an error if g.args() is not equal to g.variables(), since every variable really does have to be satisfied.",
    "created_at": "2009-09-24T19:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52043",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:2'></a>
More fast_callable improvements:

* domain=float is the same as domain=RDF, but domain=complex is not the same as domain=CDF.  Make domain=complex use the same interpreter as domain=CDF

* if g is a callable expression, then fast_callable(g) should use g.args() for the variables, not g.variables().  Hmm...or maybe return an error if g.args() is not equal to g.variables(), since every variable really does have to be satisfied.



---

archive/issue_comments_052044.json:
```json
{
    "body": "<a id='comment:3'></a>\nBoth good points. At least g.variables() should be a subset of g.args().",
    "created_at": "2009-09-24T20:27:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52044",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:3'></a>
Both good points. At least g.variables() should be a subset of g.args().



---

archive/issue_comments_052045.json:
```json
{
    "body": "**Upstream:** N/A",
    "created_at": "2010-04-24T06:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52045",
    "user": "https://github.com/jasongrout"
}
```

**Upstream:** N/A



---

archive/issue_comments_052046.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [jason](#comment%3A2):\n\n>  * if g is a callable expression, then fast_callable(g) should use g.args() for the variables, not g.variables().  Hmm...or maybe return an error if g.args() is not equal to g.variables(), since every variable really does have to be satisfied.\n\n\n#7512 may take care of this.",
    "created_at": "2010-04-24T06:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52046",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:4'></a>
Replying to [jason](#comment%3A2):

>  * if g is a callable expression, then fast_callable(g) should use g.args() for the variables, not g.variables().  Hmm...or maybe return an error if g.args() is not equal to g.variables(), since every variable really does have to be satisfied.


#7512 may take care of this.



---

archive/attachments_006337.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "improve_fast_callable.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket5572/improve_fast_callable.patch",
    "created_at": "2010-04-24T11:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jasongrout"
}
```



---

archive/issue_comments_052047.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis is a big patch to fast_callable which \n\n* makes it work for lists/tuples like fast_float does\n* adds lots of _fast_callable_ methods to make it work on a lot of different constant objects (integers/rationals/RDF/RR/CDF/CC)\n* refactors the code a bit\n* in general replaces calls to fast_float with calls to fast_callable.\n \nThe patch also breaks some things---it's still a work in progress.",
    "created_at": "2010-04-24T11:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52047",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:5'></a>
This is a big patch to fast_callable which 

* makes it work for lists/tuples like fast_float does
* adds lots of _fast_callable_ methods to make it work on a lot of different constant objects (integers/rationals/RDF/RR/CDF/CC)
* refactors the code a bit
* in general replaces calls to fast_float with calls to fast_callable.
 
The patch also breaks some things---it's still a work in progress.



---

archive/issue_comments_052048.json:
```json
{
    "body": "apply on top of previous patch",
    "created_at": "2010-04-24T11:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52048",
    "user": "https://github.com/jasongrout"
}
```

apply on top of previous patch



---

archive/attachments_006338.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "fast_callable_complex.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket5572/fast_callable_complex.patch",
    "created_at": "2010-04-24T11:36:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jasongrout"
}
```



---

archive/issue_comments_052049.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe second patch is a broken attempt at streamlining the complex support since Cython now supports C99 complex numbers.",
    "created_at": "2010-04-24T11:36:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52049",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:6'></a>
The second patch is a broken attempt at streamlining the complex support since Cython now supports C99 complex numbers.



---

archive/issue_comments_052050.json:
```json
{
    "body": "**Changing status** from new to needs_work.",
    "created_at": "2010-04-24T11:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52050",
    "user": "https://github.com/jasongrout"
}
```

**Changing status** from new to needs_work.



---

archive/issue_comments_052051.json:
```json
{
    "body": "<a id='comment:8'></a>\nCCing: robertwb since fast_float was his idea originally\n\ntimdumol since he's expressed interest in working on this sort of thing.\n\nThe two patches need work at this point.  In particular, the improvements patch needs docs added/changed, and ptestlong needs to be run to check for breakage.\n\nThe complex number patch needs an overhaul, as I think it's completely broken at this point.  The complex number patch is not necessary for resolving the issues on this ticket.",
    "created_at": "2010-04-26T11:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52051",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:8'></a>
CCing: robertwb since fast_float was his idea originally

timdumol since he's expressed interest in working on this sort of thing.

The two patches need work at this point.  In particular, the improvements patch needs docs added/changed, and ptestlong needs to be run to check for breakage.

The complex number patch needs an overhaul, as I think it's completely broken at this point.  The complex number patch is not necessary for resolving the issues on this ticket.



---

archive/issue_comments_052052.json:
```json
{
    "body": "<a id='comment:9'></a>\n#8450 would be a good ticket to (trivially) fix after this ticket moves plotting solely over to fast_callable.",
    "created_at": "2010-04-26T12:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52052",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:9'></a>
#8450 would be a good ticket to (trivially) fix after this ticket moves plotting solely over to fast_callable.



---

archive/issue_comments_052053.json:
```json
{
    "body": "rebase to 4.4.1",
    "created_at": "2010-05-04T05:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52053",
    "user": "https://github.com/jasongrout"
}
```

rebase to 4.4.1



---

archive/attachments_006339.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "improve_fast_callable.2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket5572/improve_fast_callable.2.patch",
    "created_at": "2010-05-26T19:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jasongrout"
}
```



---

archive/issue_comments_052054.json:
```json
{
    "body": "<a id='comment:10'></a>\nI think it might be best just to fix #7512 in this ticket.",
    "created_at": "2010-05-26T19:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52054",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:10'></a>
I think it might be best just to fix #7512 in this ticket.



---

archive/attachments_006340.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "improve_fast_callable.3.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket5572/improve_fast_callable.3.patch",
    "created_at": "2010-05-27T07:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jasongrout"
}
```



---

archive/issue_comments_052055.json:
```json
{
    "body": "apply instead of previous patches",
    "created_at": "2010-05-27T07:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52055",
    "user": "https://github.com/jasongrout"
}
```

apply instead of previous patches



---

archive/issue_comments_052056.json:
```json
{
    "body": "<a id='comment:11'></a>\nStill not done.  A clean design still needs to happen for fast_callable on symbolics without specified variables, and the nvars option seems like a hack to make plotting work with lambda functions (since we now match the argument names of lambda functions by default).",
    "created_at": "2010-05-27T07:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52056",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:11'></a>
Still not done.  A clean design still needs to happen for fast_callable on symbolics without specified variables, and the nvars option seems like a hack to make plotting work with lambda functions (since we now match the argument names of lambda functions by default).



---

archive/issue_comments_052057.json:
```json
{
    "body": "<a id='comment:12'></a>\nAlso, something should be done to put fast_float back (and its file) as a convenience method.",
    "created_at": "2010-05-27T08:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52057",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:12'></a>
Also, something should be done to put fast_float back (and its file) as a convenience method.



---

archive/attachments_006341.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "improve_fast_callable.4.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket5572/improve_fast_callable.4.patch",
    "created_at": "2010-05-27T08:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jasongrout"
}
```



---

archive/issue_comments_052058.json:
```json
{
    "body": "apply instead of previous patches (now doctests in plot/*.py[x] pass)",
    "created_at": "2010-05-27T08:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52058",
    "user": "https://github.com/jasongrout"
}
```

apply instead of previous patches (now doctests in plot/*.py[x] pass)



---

archive/issue_comments_052059.json:
```json
{
    "body": "apply instead of previous patches (now almost all doctests in plot/plot3d/ pass)",
    "created_at": "2010-05-27T19:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52059",
    "user": "https://github.com/jasongrout"
}
```

apply instead of previous patches (now almost all doctests in plot/plot3d/ pass)



---

archive/attachments_006342.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "improve_fast_callable.5.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket5572/improve_fast_callable.5.patch",
    "created_at": "2010-05-27T19:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jasongrout"
}
```



---

archive/issue_comments_052060.json:
```json
{
    "body": "<a id='comment:13'></a>\nI had to rework some of the transformation code because the returned function often did not have the same keyword arguments as the original function, which throws off plotting.",
    "created_at": "2010-05-27T19:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52060",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:13'></a>
I had to rework some of the transformation code because the returned function often did not have the same keyword arguments as the original function, which throws off plotting.



---

archive/attachments_006343.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "improve_fast_callable.6.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket5572/improve_fast_callable.6.patch",
    "created_at": "2010-05-28T06:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jasongrout"
}
```



---

archive/issue_comments_052061.json:
```json
{
    "body": "apply instead of previous patches (fixed a bunch of stuff so even more doctests pass)",
    "created_at": "2010-05-28T06:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52061",
    "user": "https://github.com/jasongrout"
}
```

apply instead of previous patches (fixed a bunch of stuff so even more doctests pass)



---

archive/issue_comments_052062.json:
```json
{
    "body": "<a id='comment:14'></a>\nTo delete the fast_eval.so file from the build directory (necessary so that the cython fast_eval is eliminated when testing), do:\n\n```\ncd $SAGE_ROOT/devel/sage/build\nfind . -name fast_eval.so | xargs rm\n```",
    "created_at": "2010-09-05T01:47:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52062",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:14'></a>
To delete the fast_eval.so file from the build directory (necessary so that the cython fast_eval is eliminated when testing), do:

```
cd $SAGE_ROOT/devel/sage/build
find . -name fast_eval.so | xargs rm
```



---

archive/issue_comments_052063.json:
```json
{
    "body": "<a id='comment:15'></a>\nProgress report: my current patch queue has the following failures on `make ptestlong` on Sage 4.5.2:\n\n```\n\tsage -t  -long 4.5.2/devel/sage/sage/structure/sage_object.pyx # 1 doctests failed\n\tsage -t  -long 4.5.2/devel/sage/sage/ext/fast_callable.pyx # Exception from doctest framework\n\tsage -t  -long 4.5.2/devel/sage/sage/rings/polynomial/polynomial_element.pyx # 9 doctests failed\n\tsage -t  -long 4.5.2/devel/sage/sage/stats/hmm/distributions.pyx # 1 doctests failed\n\n```",
    "created_at": "2010-09-05T02:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52063",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:15'></a>
Progress report: my current patch queue has the following failures on `make ptestlong` on Sage 4.5.2:

```
	sage -t  -long 4.5.2/devel/sage/sage/structure/sage_object.pyx # 1 doctests failed
	sage -t  -long 4.5.2/devel/sage/sage/ext/fast_callable.pyx # Exception from doctest framework
	sage -t  -long 4.5.2/devel/sage/sage/rings/polynomial/polynomial_element.pyx # 9 doctests failed
	sage -t  -long 4.5.2/devel/sage/sage/stats/hmm/distributions.pyx # 1 doctests failed

```



---

archive/issue_comments_052064.json:
```json
{
    "body": "<a id='comment:16'></a>\n(my patch queue is up at http://sage.math.washington.edu/home/jason/sage-4.5.2-patches and this ticket involves patches up to pickling.patch)",
    "created_at": "2010-09-05T03:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52064",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:16'></a>
(my patch queue is up at http://sage.math.washington.edu/home/jason/sage-4.5.2-patches and this ticket involves patches up to pickling.patch)



---

archive/issue_comments_052065.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -14,4 +14,8 @@\n \n * fast_callable of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments\n \n+The work on this ticket:\n \n+* Makes #8450 easy, probably\n+* Makes #7512 invalid, probably\n+\n``````\n",
    "created_at": "2010-09-07T02:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52065",
    "user": "https://github.com/jasongrout"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -14,4 +14,8 @@
 
 * fast_callable of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments
 
+The work on this ticket:
 
+* Makes #8450 easy, probably
+* Makes #7512 invalid, probably
+
``````




---

archive/issue_comments_052066.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,18 +1,26 @@\n The code at #5093 is very good and ready to go in, but there are several improvements that have been suggested and agreed work on at a later date. They are posted here so we can merge and close the other ticket. \n \n-Specifically, \n+Specifically, this ticket addresses these issues:\n \n-Not fixed:\n+* fast_callable on list,tuple,vector,matrix arguments\n+\n+* fast_callable on constant arguments\n+\n+* fast_callable of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments\n+\n+* in general replaces calls to fast_float with calls to fast_callable. \n+\n+* Carries out the deprecation in #5413 (removes the functionality deprecated there)\n+\n+Because of some of the far-reaching changes, this should probably not be merged in a point-point release.\n+\n+What is not fixed:\n \n * Robert's suggestion: an option that uses a fast domain, if it's there, but ignores the domain parameter if it's not (I don't mind the idea, and the implementation is easy; what should the syntax be? Part of my problem picking a syntax is that I don't want to promise that a specialized interpreter is always faster than the Python-object interpreter, so I don't particularly want to use the word \"fast\" in any option names.)\n \n-* fast_callable on list,tuple,vector,matrix arguments\n \n-* any interaction with #5413 (my plan is to wait until either #5093 or #5413 gets a positive review, then fix the other one to match)\n \n-* fast_callable on constant arguments (waiting for a spec from Jason!)\n \n-* fast_callable of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments\n \n The work on this ticket:\n \n``````\n",
    "created_at": "2010-09-07T02:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52066",
    "user": "https://github.com/jasongrout"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,18 +1,26 @@
 The code at #5093 is very good and ready to go in, but there are several improvements that have been suggested and agreed work on at a later date. They are posted here so we can merge and close the other ticket. 
 
-Specifically, 
+Specifically, this ticket addresses these issues:
 
-Not fixed:
+* fast_callable on list,tuple,vector,matrix arguments
+
+* fast_callable on constant arguments
+
+* fast_callable of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments
+
+* in general replaces calls to fast_float with calls to fast_callable. 
+
+* Carries out the deprecation in #5413 (removes the functionality deprecated there)
+
+Because of some of the far-reaching changes, this should probably not be merged in a point-point release.
+
+What is not fixed:
 
 * Robert's suggestion: an option that uses a fast domain, if it's there, but ignores the domain parameter if it's not (I don't mind the idea, and the implementation is easy; what should the syntax be? Part of my problem picking a syntax is that I don't want to promise that a specialized interpreter is always faster than the Python-object interpreter, so I don't particularly want to use the word "fast" in any option names.)
 
-* fast_callable on list,tuple,vector,matrix arguments
 
-* any interaction with #5413 (my plan is to wait until either #5093 or #5413 gets a positive review, then fix the other one to match)
 
-* fast_callable on constant arguments (waiting for a spec from Jason!)
 
-* fast_callable of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments
 
 The work on this ticket:
 
``````




---

archive/issue_comments_052067.json:
```json
{
    "body": "**Author:** Jason Grout",
    "created_at": "2010-09-07T02:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52067",
    "user": "https://github.com/jasongrout"
}
```

**Author:** Jason Grout



---

archive/issue_comments_052068.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -27,3 +27,7 @@\n * Makes #8450 easy, probably\n * Makes #7512 invalid, probably\n \n+See also\n+* #10087\n+* #7165\n+\n``````\n",
    "created_at": "2010-10-06T17:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52068",
    "user": "https://github.com/jasongrout"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -27,3 +27,7 @@
 * Makes #8450 easy, probably
 * Makes #7512 invalid, probably
 
+See also
+* #10087
+* #7165
+
``````




---

archive/issue_comments_052069.json:
```json
{
    "body": "<a id='comment:20'></a>\nWhat is the status of switching to `fast_callable`?  There seem to be a number of tickets which would benefit, not to mention the fact that `fast_float` has old-style documentation which looks bad in the command line :)  Plus, if `fast_float` is to be deprecated (even though it seems to use `fast_callable` under the hood) it would be helpful to start that process.  \n\nAnyway, just curious.",
    "created_at": "2011-06-24T14:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52069",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:20'></a>
What is the status of switching to `fast_callable`?  There seem to be a number of tickets which would benefit, not to mention the fact that `fast_float` has old-style documentation which looks bad in the command line :)  Plus, if `fast_float` is to be deprecated (even though it seems to use `fast_callable` under the hood) it would be helpful to start that process.  

Anyway, just curious.



---

archive/issue_comments_052070.json:
```json
{
    "body": "<a id='comment:21'></a>\nA long time ago I worked on the patches you see here; I believe that all of my work is here, anyway.  I probably won't have time to work on this this summer, due to notebook enhancements.  I'd like to make this one of the projects for next summer if someone hasn't beaten me to it by then.",
    "created_at": "2011-06-24T16:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52070",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:21'></a>
A long time ago I worked on the patches you see here; I believe that all of my work is here, anyway.  I probably won't have time to work on this this summer, due to notebook enhancements.  I'd like to make this one of the projects for next summer if someone hasn't beaten me to it by then.



---

archive/issue_comments_052071.json:
```json
{
    "body": "<a id='comment:22'></a>\nThe problem is that I think my patch is too big and needs to be broken down into smaller patches that change less at each step.  It's been a long time, but I think I'm remembering that right.  Anyways, as noted above, my patch queue is up on sage.math and anyone is welcome to work on it.",
    "created_at": "2011-06-24T16:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52071",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:22'></a>
The problem is that I think my patch is too big and needs to be broken down into smaller patches that change less at each step.  It's been a long time, but I think I'm remembering that right.  Anyways, as noted above, my patch queue is up on sage.math and anyone is welcome to work on it.



---

archive/issue_comments_052072.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -30,4 +30,4 @@\n See also\n * #10087\n * #7165\n-\n+* #11766 -- rewrite some of fast_callable to have its own recursion stack\n``````\n",
    "created_at": "2011-11-07T21:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52072",
    "user": "https://github.com/jasongrout"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -30,4 +30,4 @@
 See also
 * #10087
 * #7165
-
+* #11766 -- rewrite some of fast_callable to have its own recursion stack
``````




---

archive/issue_comments_052073.json:
```json
{
    "body": "<a id='comment:25'></a>\nCan I just create a new patch to switch plotting to use `fast_callable`? Using `fast_float` causes big problems for plotting, namely that any point at which the function is complex at some value in the call stack fails to plot. For example, the plot of `abs(log(x))` will not show up for negative `x`, despite the output being guaranteed to be real, since `fast_float` will evaluate `log(x)` first and choke on the complex number.",
    "created_at": "2013-08-10T00:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52073",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:25'></a>
Can I just create a new patch to switch plotting to use `fast_callable`? Using `fast_float` causes big problems for plotting, namely that any point at which the function is complex at some value in the call stack fails to plot. For example, the plot of `abs(log(x))` will not show up for negative `x`, despite the output being guaranteed to be real, since `fast_float` will evaluate `log(x)` first and choke on the complex number.



---

archive/issue_comments_052074.json:
```json
{
    "body": "<a id='comment:26'></a>\nSounds fine to me.  Especially if all the doctests pass (including the new one or two that you write :).",
    "created_at": "2013-08-10T00:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52074",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:26'></a>
Sounds fine to me.  Especially if all the doctests pass (including the new one or two that you write :).



---

archive/issue_comments_052075.json:
```json
{
    "body": "<a id='comment:27'></a>\nOkay, thanks. This is now #15030, with a patch up.",
    "created_at": "2013-08-10T10:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52075",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:27'></a>
Okay, thanks. This is now #15030, with a patch up.



---

archive/issue_events_016940.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5572#event-16940"
}
```



---

archive/issue_events_016941.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5572#event-16941"
}
```



---

archive/issue_events_016942.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5572#event-16942"
}
```



---

archive/issue_comments_052076.json:
```json
{
    "body": "<a id='comment:30'></a>\nNote that #15030 is now merged.  How that does affect whatever else needs to happen here?",
    "created_at": "2014-04-21T13:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52076",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:30'></a>
Note that #15030 is now merged.  How that does affect whatever else needs to happen here?



---

archive/issue_events_016943.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5572#event-16943"
}
```



---

archive/issue_events_016944.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5572#event-16944"
}
```



---

archive/issue_events_016945.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5572#event-16945"
}
```



---

archive/issue_events_016946.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5572#event-16946"
}
```



---

archive/issue_comments_052077.json:
```json
{
    "body": "<a id='comment:34'></a>\nAnyone interested in the deprecation of `fast_float` can find relevant tickets at https://trac.sagemath.org/wiki/symbolics#fast_floatdeprecation",
    "created_at": "2018-01-14T08:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52077",
    "user": "https://github.com/rwst"
}
```

<a id='comment:34'></a>
Anyone interested in the deprecation of `fast_float` can find relevant tickets at https://trac.sagemath.org/wiki/symbolics#fast_floatdeprecation



---

archive/issue_comments_052078.json:
```json
{
    "body": "<a id='comment:35'></a>\nWithout looking in detail I'd guess that implementing https://github.com/pynac/pynac/issues/8 will make `ex.subs()` a much faster alternative to `fast_callable`.",
    "created_at": "2018-01-14T13:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52078",
    "user": "https://github.com/rwst"
}
```

<a id='comment:35'></a>
Without looking in detail I'd guess that implementing https://github.com/pynac/pynac/issues/8 will make `ex.subs()` a much faster alternative to `fast_callable`.



---

archive/issue_comments_052079.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,15 +2,18 @@\n \n Specifically, this ticket addresses these issues:\n \n-* fast_callable on list,tuple,vector,matrix arguments\n+* `fast_callable` on `list`, `tuple`, `vector`, `matrix` arguments\n \n-* fast_callable on constant arguments\n+* `fast_callable` on constant arguments\n \n-* fast_callable of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments\n+* `fast_callable` of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments\n \n-* in general replaces calls to fast_float with calls to fast_callable. \n+* in general replaces calls to `fast_float` with calls to `fast_callable`. \n \n * Carries out the deprecation in #5413 (removes the functionality deprecated there)\n+\n+* `fast_float` sometimes returns symbolic values instead of floating-point values (see #17684, which patches `density_plot` to work around this bug)\n+\n \n Because of some of the far-reaching changes, this should probably not be merged in a point-point release.\n \n@@ -30,4 +33,4 @@\n See also\n * #10087\n * #7165\n-* #11766 -- rewrite some of fast_callable to have its own recursion stack\n+* #11766 -- rewrite some of `fast_callable` to have its own recursion stack\n``````\n",
    "created_at": "2021-02-16T05:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5572#issuecomment-52079",
    "user": "https://github.com/DaveWitteMorris"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,15 +2,18 @@
 
 Specifically, this ticket addresses these issues:
 
-* fast_callable on list,tuple,vector,matrix arguments
+* `fast_callable` on `list`, `tuple`, `vector`, `matrix` arguments
 
-* fast_callable on constant arguments
+* `fast_callable` on constant arguments
 
-* fast_callable of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments
+* `fast_callable` of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments
 
-* in general replaces calls to fast_float with calls to fast_callable. 
+* in general replaces calls to `fast_float` with calls to `fast_callable`. 
 
 * Carries out the deprecation in #5413 (removes the functionality deprecated there)
+
+* `fast_float` sometimes returns symbolic values instead of floating-point values (see #17684, which patches `density_plot` to work around this bug)
+
 
 Because of some of the far-reaching changes, this should probably not be merged in a point-point release.
 
@@ -30,4 +33,4 @@
 See also
 * #10087
 * #7165
-* #11766 -- rewrite some of fast_callable to have its own recursion stack
+* #11766 -- rewrite some of `fast_callable` to have its own recursion stack
``````




---

archive/issue_events_016947.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-23T16:43:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5572#event-16947"
}
```



---

archive/issue_events_016948.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-23T16:43:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5572#event-16948"
}
```



---

archive/issue_events_016949.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5572#event-16949"
}
```



---

archive/issue_events_016950.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5572#event-16950"
}
```



---

archive/issue_events_016951.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5572#event-16951"
}
```



---

archive/issue_events_016952.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5572#event-16952"
}
```



---

archive/issue_events_016953.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5572#event-16953"
}
```



---

archive/issue_events_016954.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5572",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5572#event-16954"
}
```
