# Issue 5572: fast_callable improvements (followup for #5093)

archive/issues_005572.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-cwitty"
    ],
    "body": "The code at #5093 is very good and ready to go in, but there are several improvements that have been suggested and agreed work on at a later date. They are posted here so we can merge and close the other ticket. \n\nSpecifically, this ticket addresses these issues:\n\n* `fast_callable` on `list`, `tuple`, `vector`, `matrix` arguments\n\n* `fast_callable` on constant arguments\n\n* `fast_callable` of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments\n\n* in general replaces calls to `fast_float` with calls to `fast_callable`. \n\n* Carries out the deprecation in #5413 (removes the functionality deprecated there)\n\n* `fast_float` sometimes returns symbolic values instead of floating-point values (see #17684, which patches `density_plot` to work around this bug)\n\n\nBecause of some of the far-reaching changes, this should probably not be merged in a point-point release.\n\nWhat is not fixed:\n\n* Robert's suggestion: an option that uses a fast domain, if it's there, but ignores the domain parameter if it's not (I don't mind the idea, and the implementation is easy; what should the syntax be? Part of my problem picking a syntax is that I don't want to promise that a specialized interpreter is always faster than the Python-object interpreter, so I don't particularly want to use the word \"fast\" in any option names.)\n\n\n\n\n\nThe work on this ticket:\n\n* Makes #8450 easy, probably\n* Makes #7512 invalid, probably\n\nSee also\n* #10087\n* #7165\n* #11766 -- rewrite some of `fast_callable` to have its own recursion stack\n\nCC:  @robertwb @TimDumol @eviatarbach @novoselt @orlitzky\n\nAuthor: **Jason Grout**\n\nComponent: **basic arithmetic**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/5572_\n\n",
    "created_at": "2009-03-19T23:55:25Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "fast_callable improvements (followup for #5093)",
    "type": "issue",
    "updated_at": "2022-08-31T02:51:13Z",
    "url": "https://github.com/sagemath/sage/issues/5572",
    "user": "https://github.com/robertwb"
}
```
The code at #5093 is very good and ready to go in, but there are several improvements that have been suggested and agreed work on at a later date. They are posted here so we can merge and close the other ticket. 

Specifically, this ticket addresses these issues:

* `fast_callable` on `list`, `tuple`, `vector`, `matrix` arguments

* `fast_callable` on constant arguments

* `fast_callable` of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments

* in general replaces calls to `fast_float` with calls to `fast_callable`. 

* Carries out the deprecation in #5413 (removes the functionality deprecated there)

* `fast_float` sometimes returns symbolic values instead of floating-point values (see #17684, which patches `density_plot` to work around this bug)


Because of some of the far-reaching changes, this should probably not be merged in a point-point release.

What is not fixed:

* Robert's suggestion: an option that uses a fast domain, if it's there, but ignores the domain parameter if it's not (I don't mind the idea, and the implementation is easy; what should the syntax be? Part of my problem picking a syntax is that I don't want to promise that a specialized interpreter is always faster than the Python-object interpreter, so I don't particularly want to use the word "fast" in any option names.)





The work on this ticket:

* Makes #8450 easy, probably
* Makes #7512 invalid, probably

See also
* #10087
* #7165
* #11766 -- rewrite some of `fast_callable` to have its own recursion stack

CC:  @robertwb @TimDumol @eviatarbach @novoselt @orlitzky

Author: **Jason Grout**

Component: **basic arithmetic**

_Issue created by migration from https://trac.sagemath.org/ticket/5572_





---

archive/issue_events_065440.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-03-19T23:55:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65440"
}
```



---

archive/issue_events_065441.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-03-19T23:55:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "c: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65441"
}
```



---

archive/issue_events_065442.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-03-19T23:55:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65442"
}
```



---

archive/issue_events_065443.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-03-19T23:55:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65443"
}
```



---

archive/issue_events_065444.json:
```json
{
    "actor": "https://github.com/sagetrac-cwitty",
    "created_at": "2009-03-26T02:02:39Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "subject": "https://github.com/sagetrac-cwitty",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65444"
}
```



---

archive/issue_comments_035004.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nMore fast_callable improvements:\n\n* domain=float is the same as domain=RDF, but domain=complex is not the same as domain=CDF.  Make domain=complex use the same interpreter as domain=CDF\n\n* if g is a callable expression, then fast_callable(g) should use g.args() for the variables, not g.variables().  Hmm...or maybe return an error if g.args() is not equal to g.variables(), since every variable really does have to be satisfied.",
    "created_at": "2009-09-24T19:36:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35004",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:2" align="right">comment:2</div>

More fast_callable improvements:

* domain=float is the same as domain=RDF, but domain=complex is not the same as domain=CDF.  Make domain=complex use the same interpreter as domain=CDF

* if g is a callable expression, then fast_callable(g) should use g.args() for the variables, not g.variables().  Hmm...or maybe return an error if g.args() is not equal to g.variables(), since every variable really does have to be satisfied.



---

archive/issue_comments_035005.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nBoth good points. At least g.variables() should be a subset of g.args().",
    "created_at": "2009-09-24T20:27:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35005",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:3" align="right">comment:3</div>

Both good points. At least g.variables() should be a subset of g.args().



---

archive/issue_comments_035006.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@jasongrout](#comment%3A2):\n\n> * if g is a callable expression, then fast_callable(g) should use g.args() for the variables, not g.variables().  Hmm...or maybe return an error if g.args() is not equal to g.variables(), since every variable really does have to be satisfied.\n\n#7512 may take care of this.",
    "created_at": "2010-04-24T06:02:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35006",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@jasongrout](#comment%3A2):

> * if g is a callable expression, then fast_callable(g) should use g.args() for the variables, not g.variables().  Hmm...or maybe return an error if g.args() is not equal to g.variables(), since every variable really does have to be satisfied.

#7512 may take care of this.



---

archive/issue_comments_035007.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAttachment: **[improve_fast_callable.patch.gz](https://github.com/sagemath/sage/files/ticket5572/improve_fast_callable.patch.gz)**\n\nThis is a big patch to fast_callable which \n\n* makes it work for lists/tuples like fast_float does\n* adds lots of `_fast_callable_` methods to make it work on a lot of different constant objects (integers/rationals/RDF/RR/CDF/CC)\n* refactors the code a bit\n* in general replaces calls to fast_float with calls to fast_callable.\n \nThe patch also breaks some things---it's still a work in progress.",
    "created_at": "2010-04-24T11:35:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35007",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:5" align="right">comment:5</div>

Attachment: **[improve_fast_callable.patch.gz](https://github.com/sagemath/sage/files/ticket5572/improve_fast_callable.patch.gz)**

This is a big patch to fast_callable which 

* makes it work for lists/tuples like fast_float does
* adds lots of `_fast_callable_` methods to make it work on a lot of different constant objects (integers/rationals/RDF/RR/CDF/CC)
* refactors the code a bit
* in general replaces calls to fast_float with calls to fast_callable.
 
The patch also breaks some things---it's still a work in progress.



---

archive/issue_comments_035008.json:
```json
{
    "body": "apply on top of previous patch",
    "created_at": "2010-04-24T11:36:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35008",
    "user": "https://github.com/jasongrout"
}
```

apply on top of previous patch



---

archive/issue_comments_035009.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAttachment: **[fast_callable_complex.patch.gz](https://github.com/sagemath/sage/files/ticket5572/fast_callable_complex.patch.gz)**\n\nThe second patch is a broken attempt at streamlining the complex support since Cython now supports C99 complex numbers.",
    "created_at": "2010-04-24T11:36:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35009",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:6" align="right">comment:6</div>

Attachment: **[fast_callable_complex.patch.gz](https://github.com/sagemath/sage/files/ticket5572/fast_callable_complex.patch.gz)**

The second patch is a broken attempt at streamlining the complex support since Cython now supports C99 complex numbers.



---

archive/issue_events_065445.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-04-24T11:36:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65445"
}
```



---

archive/issue_comments_035010.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nCCing: robertwb since fast_float was his idea originally\n\ntimdumol since he's expressed interest in working on this sort of thing.\n\nThe two patches need work at this point.  In particular, the improvements patch needs docs added/changed, and ptestlong needs to be run to check for breakage.\n\nThe complex number patch needs an overhaul, as I think it's completely broken at this point.  The complex number patch is not necessary for resolving the issues on this ticket.",
    "created_at": "2010-04-26T11:57:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35010",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:8" align="right">comment:8</div>

CCing: robertwb since fast_float was his idea originally

timdumol since he's expressed interest in working on this sort of thing.

The two patches need work at this point.  In particular, the improvements patch needs docs added/changed, and ptestlong needs to be run to check for breakage.

The complex number patch needs an overhaul, as I think it's completely broken at this point.  The complex number patch is not necessary for resolving the issues on this ticket.



---

archive/issue_comments_035011.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n#8450 would be a good ticket to (trivially) fix after this ticket moves plotting solely over to fast_callable.",
    "created_at": "2010-04-26T12:00:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35011",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:9" align="right">comment:9</div>

#8450 would be a good ticket to (trivially) fix after this ticket moves plotting solely over to fast_callable.



---

archive/issue_comments_035012.json:
```json
{
    "body": "rebase to 4.4.1",
    "created_at": "2010-05-04T05:22:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35012",
    "user": "https://github.com/jasongrout"
}
```

rebase to 4.4.1



---

archive/issue_comments_035013.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAttachment: **[improve_fast_callable.2.patch.gz](https://github.com/sagemath/sage/files/ticket5572/improve_fast_callable.2.patch.gz)**\n\nI think it might be best just to fix #7512 in this ticket.",
    "created_at": "2010-05-26T19:36:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35013",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:10" align="right">comment:10</div>

Attachment: **[improve_fast_callable.2.patch.gz](https://github.com/sagemath/sage/files/ticket5572/improve_fast_callable.2.patch.gz)**

I think it might be best just to fix #7512 in this ticket.



---

archive/issue_comments_035014.json:
```json
{
    "body": "Attachment: **[improve_fast_callable.3.patch.gz](https://github.com/sagemath/sage/files/ticket5572/improve_fast_callable.3.patch.gz)**\n\napply instead of previous patches",
    "created_at": "2010-05-27T07:55:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35014",
    "user": "https://github.com/jasongrout"
}
```

Attachment: **[improve_fast_callable.3.patch.gz](https://github.com/sagemath/sage/files/ticket5572/improve_fast_callable.3.patch.gz)**

apply instead of previous patches



---

archive/issue_comments_035015.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nStill not done.  A clean design still needs to happen for fast_callable on symbolics without specified variables, and the nvars option seems like a hack to make plotting work with lambda functions (since we now match the argument names of lambda functions by default).",
    "created_at": "2010-05-27T07:56:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35015",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:11" align="right">comment:11</div>

Still not done.  A clean design still needs to happen for fast_callable on symbolics without specified variables, and the nvars option seems like a hack to make plotting work with lambda functions (since we now match the argument names of lambda functions by default).



---

archive/issue_comments_035016.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAlso, something should be done to put fast_float back (and its file) as a convenience method.",
    "created_at": "2010-05-27T08:09:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35016",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:12" align="right">comment:12</div>

Also, something should be done to put fast_float back (and its file) as a convenience method.



---

archive/issue_comments_035017.json:
```json
{
    "body": "Attachment: **[improve_fast_callable.4.patch.gz](https://github.com/sagemath/sage/files/ticket5572/improve_fast_callable.4.patch.gz)**\n\napply instead of previous patches (now doctests in plot/*.py[x] pass)",
    "created_at": "2010-05-27T08:27:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35017",
    "user": "https://github.com/jasongrout"
}
```

Attachment: **[improve_fast_callable.4.patch.gz](https://github.com/sagemath/sage/files/ticket5572/improve_fast_callable.4.patch.gz)**

apply instead of previous patches (now doctests in plot/*.py[x] pass)



---

archive/issue_comments_035018.json:
```json
{
    "body": "apply instead of previous patches (now almost all doctests in plot/plot3d/ pass)",
    "created_at": "2010-05-27T19:30:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35018",
    "user": "https://github.com/jasongrout"
}
```

apply instead of previous patches (now almost all doctests in plot/plot3d/ pass)



---

archive/issue_comments_035019.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAttachment: **[improve_fast_callable.5.patch.gz](https://github.com/sagemath/sage/files/ticket5572/improve_fast_callable.5.patch.gz)**\n\nI had to rework some of the transformation code because the returned function often did not have the same keyword arguments as the original function, which throws off plotting.",
    "created_at": "2010-05-27T19:31:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35019",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:13" align="right">comment:13</div>

Attachment: **[improve_fast_callable.5.patch.gz](https://github.com/sagemath/sage/files/ticket5572/improve_fast_callable.5.patch.gz)**

I had to rework some of the transformation code because the returned function often did not have the same keyword arguments as the original function, which throws off plotting.



---

archive/issue_comments_035020.json:
```json
{
    "body": "Attachment: **[improve_fast_callable.6.patch.gz](https://github.com/sagemath/sage/files/ticket5572/improve_fast_callable.6.patch.gz)**\n\napply instead of previous patches (fixed a bunch of stuff so even more doctests pass)",
    "created_at": "2010-05-28T06:20:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35020",
    "user": "https://github.com/jasongrout"
}
```

Attachment: **[improve_fast_callable.6.patch.gz](https://github.com/sagemath/sage/files/ticket5572/improve_fast_callable.6.patch.gz)**

apply instead of previous patches (fixed a bunch of stuff so even more doctests pass)



---

archive/issue_comments_035021.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nTo delete the fast_eval.so file from the build directory (necessary so that the cython fast_eval is eliminated when testing), do:\n\n```\ncd $SAGE_ROOT/devel/sage/build\nfind . -name fast_eval.so | xargs rm\n```",
    "created_at": "2010-09-05T01:47:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35021",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:14" align="right">comment:14</div>

To delete the fast_eval.so file from the build directory (necessary so that the cython fast_eval is eliminated when testing), do:

```
cd $SAGE_ROOT/devel/sage/build
find . -name fast_eval.so | xargs rm
```



---

archive/issue_comments_035022.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nProgress report: my current patch queue has the following failures on `make ptestlong` on Sage 4.5.2:\n\n```\n\tsage -t  -long 4.5.2/devel/sage/sage/structure/sage_object.pyx # 1 doctests failed\n\tsage -t  -long 4.5.2/devel/sage/sage/ext/fast_callable.pyx # Exception from doctest framework\n\tsage -t  -long 4.5.2/devel/sage/sage/rings/polynomial/polynomial_element.pyx # 9 doctests failed\n\tsage -t  -long 4.5.2/devel/sage/sage/stats/hmm/distributions.pyx # 1 doctests failed\n\n```",
    "created_at": "2010-09-05T02:59:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35022",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:15" align="right">comment:15</div>

Progress report: my current patch queue has the following failures on `make ptestlong` on Sage 4.5.2:

```
	sage -t  -long 4.5.2/devel/sage/sage/structure/sage_object.pyx # 1 doctests failed
	sage -t  -long 4.5.2/devel/sage/sage/ext/fast_callable.pyx # Exception from doctest framework
	sage -t  -long 4.5.2/devel/sage/sage/rings/polynomial/polynomial_element.pyx # 9 doctests failed
	sage -t  -long 4.5.2/devel/sage/sage/stats/hmm/distributions.pyx # 1 doctests failed

```



---

archive/issue_comments_035023.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\n(my patch queue is up at http://sage.math.washington.edu/home/jason/sage-4.5.2-patches and this ticket involves patches up to pickling.patch)",
    "created_at": "2010-09-05T03:19:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35023",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:16" align="right">comment:16</div>

(my patch queue is up at http://sage.math.washington.edu/home/jason/sage-4.5.2-patches and this ticket involves patches up to pickling.patch)



---

archive/issue_comments_035024.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,4 +14,8 @@\n \n * fast_callable of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments\n \n+The work on this ticket:\n \n+* Makes #8450 easy, probably\n+* Makes #7512 invalid, probably\n+\n``````\n",
    "created_at": "2010-09-07T02:45:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35024",
    "user": "https://github.com/jasongrout"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,4 +14,8 @@
 
 * fast_callable of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments
 
+The work on this ticket:
 
+* Makes #8450 easy, probably
+* Makes #7512 invalid, probably
+
``````




---

archive/issue_comments_035025.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,18 +1,26 @@\n The code at #5093 is very good and ready to go in, but there are several improvements that have been suggested and agreed work on at a later date. They are posted here so we can merge and close the other ticket. \n \n-Specifically, \n+Specifically, this ticket addresses these issues:\n \n-Not fixed:\n+* fast_callable on list,tuple,vector,matrix arguments\n+\n+* fast_callable on constant arguments\n+\n+* fast_callable of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments\n+\n+* in general replaces calls to fast_float with calls to fast_callable. \n+\n+* Carries out the deprecation in #5413 (removes the functionality deprecated there)\n+\n+Because of some of the far-reaching changes, this should probably not be merged in a point-point release.\n+\n+What is not fixed:\n \n * Robert's suggestion: an option that uses a fast domain, if it's there, but ignores the domain parameter if it's not (I don't mind the idea, and the implementation is easy; what should the syntax be? Part of my problem picking a syntax is that I don't want to promise that a specialized interpreter is always faster than the Python-object interpreter, so I don't particularly want to use the word \"fast\" in any option names.)\n \n-* fast_callable on list,tuple,vector,matrix arguments\n \n-* any interaction with #5413 (my plan is to wait until either #5093 or #5413 gets a positive review, then fix the other one to match)\n \n-* fast_callable on constant arguments (waiting for a spec from Jason!)\n \n-* fast_callable of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments\n \n The work on this ticket:\n \n``````\n",
    "created_at": "2010-09-07T02:49:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35025",
    "user": "https://github.com/jasongrout"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,18 +1,26 @@
 The code at #5093 is very good and ready to go in, but there are several improvements that have been suggested and agreed work on at a later date. They are posted here so we can merge and close the other ticket. 
 
-Specifically, 
+Specifically, this ticket addresses these issues:
 
-Not fixed:
+* fast_callable on list,tuple,vector,matrix arguments
+
+* fast_callable on constant arguments
+
+* fast_callable of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments
+
+* in general replaces calls to fast_float with calls to fast_callable. 
+
+* Carries out the deprecation in #5413 (removes the functionality deprecated there)
+
+Because of some of the far-reaching changes, this should probably not be merged in a point-point release.
+
+What is not fixed:
 
 * Robert's suggestion: an option that uses a fast domain, if it's there, but ignores the domain parameter if it's not (I don't mind the idea, and the implementation is easy; what should the syntax be? Part of my problem picking a syntax is that I don't want to promise that a specialized interpreter is always faster than the Python-object interpreter, so I don't particularly want to use the word "fast" in any option names.)
 
-* fast_callable on list,tuple,vector,matrix arguments
 
-* any interaction with #5413 (my plan is to wait until either #5093 or #5413 gets a positive review, then fix the other one to match)
 
-* fast_callable on constant arguments (waiting for a spec from Jason!)
 
-* fast_callable of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments
 
 The work on this ticket:
 
``````




---

archive/issue_comments_035026.json:
```json
{
    "body": "Author: **Jason Grout**",
    "created_at": "2010-09-07T02:49:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35026",
    "user": "https://github.com/jasongrout"
}
```

Author: **Jason Grout**



---

archive/issue_comments_035027.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -27,3 +27,7 @@\n * Makes #8450 easy, probably\n * Makes #7512 invalid, probably\n \n+See also\n+* #10087\n+* #7165\n+\n``````\n",
    "created_at": "2010-10-06T17:36:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35027",
    "user": "https://github.com/jasongrout"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -27,3 +27,7 @@
 * Makes #8450 easy, probably
 * Makes #7512 invalid, probably
 
+See also
+* #10087
+* #7165
+
``````




---

archive/issue_comments_035028.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nWhat is the status of switching to `fast_callable`?  There seem to be a number of tickets which would benefit, not to mention the fact that `fast_float` has old-style documentation which looks bad in the command line :)  Plus, if `fast_float` is to be deprecated (even though it seems to use `fast_callable` under the hood) it would be helpful to start that process.  \n\nAnyway, just curious.",
    "created_at": "2011-06-24T14:04:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35028",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:20" align="right">comment:20</div>

What is the status of switching to `fast_callable`?  There seem to be a number of tickets which would benefit, not to mention the fact that `fast_float` has old-style documentation which looks bad in the command line :)  Plus, if `fast_float` is to be deprecated (even though it seems to use `fast_callable` under the hood) it would be helpful to start that process.  

Anyway, just curious.



---

archive/issue_comments_035029.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nA long time ago I worked on the patches you see here; I believe that all of my work is here, anyway.  I probably won't have time to work on this this summer, due to notebook enhancements.  I'd like to make this one of the projects for next summer if someone hasn't beaten me to it by then.",
    "created_at": "2011-06-24T16:25:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35029",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:21" align="right">comment:21</div>

A long time ago I worked on the patches you see here; I believe that all of my work is here, anyway.  I probably won't have time to work on this this summer, due to notebook enhancements.  I'd like to make this one of the projects for next summer if someone hasn't beaten me to it by then.



---

archive/issue_comments_035030.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThe problem is that I think my patch is too big and needs to be broken down into smaller patches that change less at each step.  It's been a long time, but I think I'm remembering that right.  Anyways, as noted above, my patch queue is up on sage.math and anyone is welcome to work on it.",
    "created_at": "2011-06-24T16:27:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35030",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:22" align="right">comment:22</div>

The problem is that I think my patch is too big and needs to be broken down into smaller patches that change less at each step.  It's been a long time, but I think I'm remembering that right.  Anyways, as noted above, my patch queue is up on sage.math and anyone is welcome to work on it.



---

archive/issue_comments_035031.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,4 +30,4 @@\n See also\n * #10087\n * #7165\n-\n+* #11766 -- rewrite some of fast_callable to have its own recursion stack\n``````\n",
    "created_at": "2011-11-07T21:41:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35031",
    "user": "https://github.com/jasongrout"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,4 +30,4 @@
 See also
 * #10087
 * #7165
-
+* #11766 -- rewrite some of fast_callable to have its own recursion stack
``````




---

archive/issue_comments_035032.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nCan I just create a new patch to switch plotting to use `fast_callable`? Using `fast_float` causes big problems for plotting, namely that any point at which the function is complex at some value in the call stack fails to plot. For example, the plot of `abs(log(x))` will not show up for negative `x`, despite the output being guaranteed to be real, since `fast_float` will evaluate `log(x)` first and choke on the complex number.",
    "created_at": "2013-08-10T00:39:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35032",
    "user": "https://github.com/eviatarbach"
}
```

<div id="comment:25" align="right">comment:25</div>

Can I just create a new patch to switch plotting to use `fast_callable`? Using `fast_float` causes big problems for plotting, namely that any point at which the function is complex at some value in the call stack fails to plot. For example, the plot of `abs(log(x))` will not show up for negative `x`, despite the output being guaranteed to be real, since `fast_float` will evaluate `log(x)` first and choke on the complex number.



---

archive/issue_comments_035033.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nSounds fine to me.  Especially if all the doctests pass (including the new one or two that you write :).",
    "created_at": "2013-08-10T00:44:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35033",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:26" align="right">comment:26</div>

Sounds fine to me.  Especially if all the doctests pass (including the new one or two that you write :).



---

archive/issue_comments_035034.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nOkay, thanks. This is now #15030, with a patch up.",
    "created_at": "2013-08-10T10:05:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35034",
    "user": "https://github.com/eviatarbach"
}
```

<div id="comment:27" align="right">comment:27</div>

Okay, thanks. This is now #15030, with a patch up.



---

archive/issue_events_065446.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65446"
}
```



---

archive/issue_events_065447.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65447"
}
```



---

archive/issue_events_065448.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65448"
}
```



---

archive/issue_events_065449.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65449"
}
```



---

archive/issue_comments_035035.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nNote that #15030 is now merged.  How that does affect whatever else needs to happen here?",
    "created_at": "2014-04-21T13:38:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35035",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:30" align="right">comment:30</div>

Note that #15030 is now merged.  How that does affect whatever else needs to happen here?



---

archive/issue_events_065450.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65450"
}
```



---

archive/issue_events_065451.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65451"
}
```



---

archive/issue_events_065452.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65452"
}
```



---

archive/issue_events_065453.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65453"
}
```



---

archive/issue_comments_035036.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nAnyone interested in the deprecation of `fast_float` can find relevant tickets at https://trac.sagemath.org/wiki/symbolics#fast_floatdeprecation",
    "created_at": "2018-01-14T08:34:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35036",
    "user": "https://github.com/rwst"
}
```

<div id="comment:34" align="right">comment:34</div>

Anyone interested in the deprecation of `fast_float` can find relevant tickets at https://trac.sagemath.org/wiki/symbolics#fast_floatdeprecation



---

archive/issue_comments_035037.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nWithout looking in detail I'd guess that implementing https://github.com/pynac/pynac/issues/8 will make `ex.subs()` a much faster alternative to `fast_callable`.",
    "created_at": "2018-01-14T13:46:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35037",
    "user": "https://github.com/rwst"
}
```

<div id="comment:35" align="right">comment:35</div>

Without looking in detail I'd guess that implementing https://github.com/pynac/pynac/issues/8 will make `ex.subs()` a much faster alternative to `fast_callable`.



---

archive/issue_comments_035038.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,15 +2,18 @@\n \n Specifically, this ticket addresses these issues:\n \n-* fast_callable on list,tuple,vector,matrix arguments\n+* `fast_callable` on `list`, `tuple`, `vector`, `matrix` arguments\n \n-* fast_callable on constant arguments\n+* `fast_callable` on constant arguments\n \n-* fast_callable of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments\n+* `fast_callable` of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments\n \n-* in general replaces calls to fast_float with calls to fast_callable. \n+* in general replaces calls to `fast_float` with calls to `fast_callable`. \n \n * Carries out the deprecation in #5413 (removes the functionality deprecated there)\n+\n+* `fast_float` sometimes returns symbolic values instead of floating-point values (see #17684, which patches `density_plot` to work around this bug)\n+\n \n Because of some of the far-reaching changes, this should probably not be merged in a point-point release.\n \n@@ -30,4 +33,4 @@\n See also\n * #10087\n * #7165\n-* #11766 -- rewrite some of fast_callable to have its own recursion stack\n+* #11766 -- rewrite some of `fast_callable` to have its own recursion stack\n``````\n",
    "created_at": "2021-02-16T05:52:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5572#issuecomment-35038",
    "user": "https://github.com/DaveWitteMorris"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,15 +2,18 @@
 
 Specifically, this ticket addresses these issues:
 
-* fast_callable on list,tuple,vector,matrix arguments
+* `fast_callable` on `list`, `tuple`, `vector`, `matrix` arguments
 
-* fast_callable on constant arguments
+* `fast_callable` on constant arguments
 
-* fast_callable of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments
+* `fast_callable` of a zero multivariate polynomial returns a zero of the base ring, without paying attention to the types of the arguments
 
-* in general replaces calls to fast_float with calls to fast_callable. 
+* in general replaces calls to `fast_float` with calls to `fast_callable`. 
 
 * Carries out the deprecation in #5413 (removes the functionality deprecated there)
+
+* `fast_float` sometimes returns symbolic values instead of floating-point values (see #17684, which patches `density_plot` to work around this bug)
+
 
 Because of some of the far-reaching changes, this should probably not be merged in a point-point release.
 
@@ -30,4 +33,4 @@
 See also
 * #10087
 * #7165
-* #11766 -- rewrite some of fast_callable to have its own recursion stack
+* #11766 -- rewrite some of `fast_callable` to have its own recursion stack
``````




---

archive/issue_events_065454.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-23T16:43:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65454"
}
```



---

archive/issue_events_065455.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-23T16:43:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65455"
}
```



---

archive/issue_events_065456.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65456"
}
```



---

archive/issue_events_065457.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65457"
}
```



---

archive/issue_events_065458.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65458"
}
```



---

archive/issue_events_065459.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65459"
}
```



---

archive/issue_events_065460.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65460"
}
```



---

archive/issue_events_065461.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5572",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5572#event-65461"
}
```
