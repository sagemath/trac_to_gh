# Issue 5598: allow post-creation (pre-use) declaration of coercions

archive/issues_005598.json:
```json
{
    "assignees": [
        "https://github.com/robertwb"
    ],
    "body": "One can now do \n\n```\na = A()\nmor = [morphism from X to A]\nA.register_coercion(mor)\n```\n\nThis works as long as coercion has not yet been used (otherwise information cached (both here and elsewhere) becomes invalid). \n\nCC:  @nthiery\n\nComponent: **coercion**\n\nAuthor: **Robert Bradshaw**\n\nReviewer: **Nick Alexander**\n\nMerged: **sage-4.2.alpha1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/5598_\n\n",
    "closed_at": "2009-10-19T13:23:22Z",
    "created_at": "2009-03-24T05:12:18Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20coercion",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "allow post-creation (pre-use) declaration of coercions",
    "type": "issue",
    "updated_at": "2009-10-19T13:23:22Z",
    "url": "https://github.com/sagemath/sage/issues/5598",
    "user": "https://github.com/robertwb"
}
```
One can now do 

```
a = A()
mor = [morphism from X to A]
A.register_coercion(mor)
```

This works as long as coercion has not yet been used (otherwise information cached (both here and elsewhere) becomes invalid). 

CC:  @nthiery

Component: **coercion**

Author: **Robert Bradshaw**

Reviewer: **Nick Alexander**

Merged: **sage-4.2.alpha1**

_Issue created by migration from https://trac.sagemath.org/ticket/5598_





---

archive/issue_events_066542.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-03-24T05:12:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "milestone_number": null,
    "milestone_title": "sage-4.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66542"
}
```



---

archive/issue_events_066543.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-03-24T05:12:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20coercion",
    "label_color": "eeeeee",
    "label_name": "c: coercion",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66543"
}
```



---

archive/issue_events_066544.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-03-24T05:12:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66544"
}
```



---

archive/issue_events_066545.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-03-24T05:12:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66545"
}
```



---

archive/issue_events_066546.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-03-24T05:12:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66546"
}
```



---

archive/issue_events_066547.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-03-24T05:12:18Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "subject": "https://github.com/robertwb",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66547"
}
```



---

archive/issue_comments_035221.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[5598-coerce-declare.patch.gz](https://github.com/sagemath/sage/files/ticket5598/5598-coerce-declare.patch.gz)**\n\nDepends on #5597.",
    "created_at": "2009-03-24T05:20:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35221",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[5598-coerce-declare.patch.gz](https://github.com/sagemath/sage/files/ticket5598/5598-coerce-declare.patch.gz)**

Depends on #5597.



---

archive/issue_comments_035222.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nOne can now do \n\n```\nsage: A = SomeParent()\nsage: mor = [morphism from X to A]\nsage: A.register_coercion(mor)\n```\n\nThis works as long as coercion has not yet been used (otherwise information cached (both here and elsewhere) becomes invalid).",
    "created_at": "2009-03-24T05:21:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35222",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:2" align="right">comment:2</div>

One can now do 

```
sage: A = SomeParent()
sage: mor = [morphism from X to A]
sage: A.register_coercion(mor)
```

This works as long as coercion has not yet been used (otherwise information cached (both here and elsewhere) becomes invalid).



---

archive/issue_events_066548.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-03-24T05:21:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66548"
}
```



---

archive/issue_events_066549.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2009-03-24T05:21:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66549"
}
```



---

archive/issue_comments_035223.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,9 @@\n One can now do \n \n+```\n a = A()\n mor = [morphism from X to A]\n-a.register_coercion(mor)\n+A.register_coercion(mor)\n+```\n \n This works as long as coercion has not yet been used (otherwise information cached (both here and elsewhere) becomes invalid). \n``````\n",
    "created_at": "2009-03-24T05:24:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35223",
    "user": "https://github.com/robertwb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,9 @@
 One can now do 
 
+```
 a = A()
 mor = [morphism from X to A]
-a.register_coercion(mor)
+A.register_coercion(mor)
+```
 
 This works as long as coercion has not yet been used (otherwise information cached (both here and elsewhere) becomes invalid). 
``````




---

archive/issue_comments_035224.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nActually, though I wrote it on top of #5597, there's probably not a dependance. Note that I don't have any doctests yet (as it's completely unused functionality at this point).",
    "created_at": "2009-03-24T10:49:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35224",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:5" align="right">comment:5</div>

Actually, though I wrote it on top of #5597, there's probably not a dependance. Note that I don't have any doctests yet (as it's completely unused functionality at this point).



---

archive/issue_events_066550.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-12T05:04:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66550"
}
```



---

archive/issue_events_066551.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-12T05:04:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66551"
}
```



---

archive/issue_comments_035225.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n> Note that I don't have any doctests yet (as it's completely unused \n> functionality at this point). \n\nHence I'm physically incapable of giving this a positive review.  Sorry.",
    "created_at": "2009-04-12T05:04:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35225",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:6" align="right">comment:6</div>

> Note that I don't have any doctests yet (as it's completely unused 
> functionality at this point). 

Hence I'm physically incapable of giving this a positive review.  Sorry.



---

archive/issue_comments_035226.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAttachment: **[test-coercion.py.gz](https://github.com/sagemath/sage/files/ticket5598/test-coercion.py.gz)**\n\nI have been using this patch (or actually a plain python version of it; see the sage-combinat patch queue) relatively intensively, and it does its job well. However it's hard to extract any interesting unitary test from those uses, since they all rely on the rest of the category stuff.\n\nI have just attached a stupid test instead ... It just plays with register_coercion, but should be easy to adapt to the others.\n\nBtw: robert: would it be possible to have register_coercion just raise a warning if coercions have readily been used? There are cases where it can be handy to abuse the system a bit from the interpreter.",
    "created_at": "2009-04-14T00:35:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35226",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:7" align="right">comment:7</div>

Attachment: **[test-coercion.py.gz](https://github.com/sagemath/sage/files/ticket5598/test-coercion.py.gz)**

I have been using this patch (or actually a plain python version of it; see the sage-combinat patch queue) relatively intensively, and it does its job well. However it's hard to extract any interesting unitary test from those uses, since they all rely on the rest of the category stuff.

I have just attached a stupid test instead ... It just plays with register_coercion, but should be easy to adapt to the others.

Btw: robert: would it be possible to have register_coercion just raise a warning if coercions have readily been used? There are cases where it can be handy to abuse the system a bit from the interpreter.



---

archive/issue_comments_035227.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThanks for the tests. In retrospect, sometimes very simple tests like this are best at showing exactly what's going on. \n\nAs for warnings vs. errors, yes it's possible, but I am strongly against it. If you need to abuse it, you can do so from Cython (or even write a spyx file that allows you to do so from the interpreter). \n\nThere was talk about asserting coercions within contexts, but no one's gotten around to implementing them yet.",
    "created_at": "2009-04-14T11:09:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35227",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:8" align="right">comment:8</div>

Thanks for the tests. In retrospect, sometimes very simple tests like this are best at showing exactly what's going on. 

As for warnings vs. errors, yes it's possible, but I am strongly against it. If you need to abuse it, you can do so from Cython (or even write a spyx file that allows you to do so from the interpreter). 

There was talk about asserting coercions within contexts, but no one's gotten around to implementing them yet.



---

archive/issue_comments_035228.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHi Robert,\n\n> Thanks for the tests. In retrospect, sometimes very simple tests like this are best at showing exactly what's going on. \n\nYep.\n\nThe construction of the parents and morphisms in this test are still ugly, though. Both ought to be essentially one-liners. Hopefuly things will be nicer when the category patch will be in.\n\n> As for warnings vs. errors, yes it's possible, but I am strongly against it. If you need to abuse it, you can > do so from Cython (or even write a spyx file that allows you to do so from the interpreter). \n\nMy typical (ab)use case is someone constructing a couple parents in the interpreter, playing with them, and suddenly thinking \"oh, but wouldn't all be natural if I added a coercion there?\". The user will give it a try if this is trivial to do. Otherwise he won't and that's too bad.\n\nBtw: your patch changes the datastructure of parents to add the cython attribute `_coercions_used`. How does this work with unpickling old pickles? That is, will _coercions_used be set to an appropriate value?\n\n> \n> There was talk about asserting coercions within contexts, but no one's gotten around to implementing them yet.",
    "created_at": "2009-04-14T16:52:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35228",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:9" align="right">comment:9</div>

Hi Robert,

> Thanks for the tests. In retrospect, sometimes very simple tests like this are best at showing exactly what's going on. 

Yep.

The construction of the parents and morphisms in this test are still ugly, though. Both ought to be essentially one-liners. Hopefuly things will be nicer when the category patch will be in.

> As for warnings vs. errors, yes it's possible, but I am strongly against it. If you need to abuse it, you can > do so from Cython (or even write a spyx file that allows you to do so from the interpreter). 

My typical (ab)use case is someone constructing a couple parents in the interpreter, playing with them, and suddenly thinking "oh, but wouldn't all be natural if I added a coercion there?". The user will give it a try if this is trivial to do. Otherwise he won't and that's too bad.

Btw: your patch changes the datastructure of parents to add the cython attribute `_coercions_used`. How does this work with unpickling old pickles? That is, will _coercions_used be set to an appropriate value?

> 
> There was talk about asserting coercions within contexts, but no one's gotten around to implementing them yet.



---

archive/issue_comments_035229.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThis is all kinds of awesome, and yet totally useless.  For example, the following fails:\n\n```\nx = GF(3)['x'].0\nK.<a> = GF(3^2, 'a', modulus=x^2+1)\nL.<b> = GF(3^2, 'b', modulus=x^2 + x - 1)\n\nL_into_K = L.hom([a - 2], K, check=False)\nK.register_coercion(L_into_K)\n```\n\nWhy?  Because the `a-2` has used the coercion mechanism for K.  It will be essentially impossible to construct morphisms that are mathematically interesting without using coercion at some point.\n\nWhat is to be done?  I have no great ideas.  Personally I would be happy with a flag to `register_coercion` that \"broke the links\" of the coercion graph, or even tried to `reset_cache()` on the coercion_model.  Notice that I tried this, but it doesn't work, because `reset_cache` doesn't twiddle the flag on each parent.  (That's a bug, in my opinion.)",
    "created_at": "2009-05-06T03:15:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35229",
    "user": "https://github.com/ncalexan"
}
```

<div id="comment:10" align="right">comment:10</div>

This is all kinds of awesome, and yet totally useless.  For example, the following fails:

```
x = GF(3)['x'].0
K.<a> = GF(3^2, 'a', modulus=x^2+1)
L.<b> = GF(3^2, 'b', modulus=x^2 + x - 1)

L_into_K = L.hom([a - 2], K, check=False)
K.register_coercion(L_into_K)
```

Why?  Because the `a-2` has used the coercion mechanism for K.  It will be essentially impossible to construct morphisms that are mathematically interesting without using coercion at some point.

What is to be done?  I have no great ideas.  Personally I would be happy with a flag to `register_coercion` that "broke the links" of the coercion graph, or even tried to `reset_cache()` on the coercion_model.  Notice that I tried this, but it doesn't work, because `reset_cache` doesn't twiddle the flag on each parent.  (That's a bug, in my opinion.)



---

archive/issue_comments_035230.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nApply both `5598-` patches.  My fixes make actions work (they're still broken pretty hard in parent_old, but they work here) and test this code in a non-combinat tree.  In order to make this work I include an ugly hack.\n\nrobertwb, this badly needs documentation; it really can't be accepted without *something*.",
    "created_at": "2009-05-06T06:10:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35230",
    "user": "https://github.com/ncalexan"
}
```

<div id="comment:11" align="right">comment:11</div>

Apply both `5598-` patches.  My fixes make actions work (they're still broken pretty hard in parent_old, but they work here) and test this code in a non-combinat tree.  In order to make this work I include an ugly hack.

robertwb, this badly needs documentation; it really can't be accepted without *something*.



---

archive/issue_events_066552.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-05-06T06:10:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66552"
}
```



---

archive/issue_events_066553.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-05-06T06:10:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66553"
}
```



---

archive/issue_comments_035231.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nYes, I just haven't had time to work on any coercion-related stuff for a while. I'll be attacking issues like this during Sage days.",
    "created_at": "2009-05-06T06:14:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35231",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:12" align="right">comment:12</div>

Yes, I just haven't had time to work on any coercion-related stuff for a while. I'll be attacking issues like this during Sage days.



---

archive/issue_comments_035232.json:
```json
{
    "body": "Attachment: **[5598-ncalexan-fixes-and-tests.patch.gz](https://github.com/sagemath/sage/files/ticket5598/5598-ncalexan-fixes-and-tests.patch.gz)**",
    "created_at": "2009-05-08T23:04:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35232",
    "user": "https://github.com/ncalexan"
}
```

Attachment: **[5598-ncalexan-fixes-and-tests.patch.gz](https://github.com/sagemath/sage/files/ticket5598/5598-ncalexan-fixes-and-tests.patch.gz)**



---

archive/issue_comments_035233.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nUpdated `fixes` patch includes a few line of documentation.  robertwb, this is ready for you to review.",
    "created_at": "2009-05-08T23:05:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35233",
    "user": "https://github.com/ncalexan"
}
```

<div id="comment:13" align="right">comment:13</div>

Updated `fixes` patch includes a few line of documentation.  robertwb, this is ready for you to review.



---

archive/issue_comments_035234.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\n5598-ncalexan-fixes-and-tests.patch seems malformed, could you try recreating this patch?",
    "created_at": "2009-05-14T23:00:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35234",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:14" align="right">comment:14</div>

5598-ncalexan-fixes-and-tests.patch seems malformed, could you try recreating this patch?



---

archive/issue_comments_035235.json:
```json
{
    "body": "Attachment: **[5598-ncalexan-fixes-and-tests.2.patch.gz](https://github.com/sagemath/sage/files/ticket5598/5598-ncalexan-fixes-and-tests.2.patch.gz)**",
    "created_at": "2009-05-17T21:14:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35235",
    "user": "https://github.com/ncalexan"
}
```

Attachment: **[5598-ncalexan-fixes-and-tests.2.patch.gz](https://github.com/sagemath/sage/files/ticket5598/5598-ncalexan-fixes-and-tests.2.patch.gz)**



---

archive/issue_comments_035236.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAttachment: **[5598-ncalexan-fixes-and-tests.3.patch.gz](https://github.com/sagemath/sage/files/ticket5598/5598-ncalexan-fixes-and-tests.3.patch.gz)**\n\nAh, the mystery of the malformed patches.  hg export -o *DOESN'T* overwrite an existing file, it appends!  I think this is totally wrong, but I can work around it.  This has been biting me for weeks, I now realize.  Anyway, only tests.3.patch should be applied.",
    "created_at": "2009-05-17T21:21:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35236",
    "user": "https://github.com/ncalexan"
}
```

<div id="comment:15" align="right">comment:15</div>

Attachment: **[5598-ncalexan-fixes-and-tests.3.patch.gz](https://github.com/sagemath/sage/files/ticket5598/5598-ncalexan-fixes-and-tests.3.patch.gz)**

Ah, the mystery of the malformed patches.  hg export -o *DOESN'T* overwrite an existing file, it appends!  I think this is totally wrong, but I can work around it.  This has been biting me for weeks, I now realize.  Anyway, only tests.3.patch should be applied.



---

archive/issue_comments_035237.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAttachment: **[5598-test-coercion.patch.gz](https://github.com/sagemath/sage/files/ticket5598/5598-test-coercion.patch.gz)**\n\nI made a patch out of test-coercion. Apply, in order\n\n* 5598-coerce-declare.patch\n* 5598-ncalexan-fixes-and-tests.3.patch\n* 5598-test-coercion.patch (1.9 KB)\n\nI give the tests/documentation a positive review, if someone is willing to give a +1 on the original patch we can get this ticket in.",
    "created_at": "2009-05-23T06:47:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35237",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:16" align="right">comment:16</div>

Attachment: **[5598-test-coercion.patch.gz](https://github.com/sagemath/sage/files/ticket5598/5598-test-coercion.patch.gz)**

I made a patch out of test-coercion. Apply, in order

* 5598-coerce-declare.patch
* 5598-ncalexan-fixes-and-tests.3.patch
* 5598-test-coercion.patch (1.9 KB)

I give the tests/documentation a positive review, if someone is willing to give a +1 on the original patch we can get this ticket in.



---

archive/issue_events_066554.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-05-23T06:54:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66554"
}
```



---

archive/issue_events_066555.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-05-23T06:54:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66555"
}
```



---

archive/issue_comments_035238.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nIt's not perfect but it's better than what was there before -- and doctested more than it was before!",
    "created_at": "2009-05-23T06:54:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35238",
    "user": "https://github.com/ncalexan"
}
```

<div id="comment:17" align="right">comment:17</div>

It's not perfect but it's better than what was there before -- and doctested more than it was before!



---

archive/issue_comments_035239.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nJust a note: the added test adds a dependency on #5967. The later has a positive review, but Michael asked for a confirmation from a non sage-combinat person. Robert told me he would do this shortly.",
    "created_at": "2009-05-23T07:12:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35239",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:18" align="right">comment:18</div>

Just a note: the added test adds a dependency on #5967. The later has a positive review, but Michael asked for a confirmation from a non sage-combinat person. Robert told me he would do this shortly.



---

archive/issue_comments_035240.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI merged \n\n```\n5598-coerce-declare.patch\n5598-ncalexan-fixes-and-tests.3.patch\n5598-test-coercion.patch\n```\n\nand got the following failures:\n\n```\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 863:\n    sage: K.unset_coercions_used()\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_21[5]>\", line 1, in <module>\n        K.unset_coercions_used()###line 863:\n    sage: K.unset_coercions_used()\n    AttributeError: 'PolynomialRing_integral_domain' object has no attribute 'unset_coercions_used'\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 864:\n    sage: K.register_coercion(L_into_K)\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_21[6]>\", line 1, in <module>\n        K.register_coercion(L_into_K)###line 864:\n    sage: K.register_coercion(L_into_K)\n      File \"parent.pyx\", line 853, in sage.structure.parent.Parent.register_coercion (sage/structure/parent.c:7450)\n        cpdef register_coercion(self, mor):\n      File \"parent.pyx\", line 878, in sage.structure.parent.Parent.register_coercion (sage/structure/parent.c:7239)\n        assert not self._coercions_used, \"coercions must all be registered up before use\"\n    AssertionError: coercions must all be registered up before use\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 866:\n    sage: K(0) + b\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_21[7]>\", line 1, in <module>\n        K(Integer(0)) + b###line 866:\n    sage: K(0) + b\n      File \"element.pyx\", line 729, in sage.structure.element.ModuleElement.__add__ (sage/structure/element.c:6533)\n        return coercion_model.bin_op(left, right, add)\n      File \"coerce.pyx\", line 740, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6589)\n        raise TypeError, arith_error_message(x,y,op)\n    TypeError: unsupported operand parent(s) for '+': 'Univariate Polynomial Ring in a over Integer Ring' and 'Univariate Polynomial Ring in b over Integer Ring'\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 868:\n    sage: a + b\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_21[8]>\", line 1, in <module>\n        a + b###line 868:\n    sage: a + b\n      File \"element.pyx\", line 729, in sage.structure.element.ModuleElement.__add__ (sage/structure/element.c:6533)\n        return coercion_model.bin_op(left, right, add)\n      File \"coerce.pyx\", line 740, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6589)\n        raise TypeError, arith_error_message(x,y,op)\n    TypeError: unsupported operand parent(s) for '+': 'Univariate Polynomial Ring in a over Integer Ring' and 'Univariate Polynomial Ring in b over Integer Ring'\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 870:\n    sage: K(b) # check that convert calls coerce first; normally this is just a\nExpected:\n    -a\nGot:\n    a\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 873:\n    sage: L(0) + a in K # this goes through the coercion mechanism of K\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_21[10]>\", line 1, in <module>\n        L(Integer(0)) + a in K # this goes through the coercion mechanism of K###line 873:\n    sage: L(0) + a in K # this goes through the coercion mechanism of K\n      File \"element.pyx\", line 729, in sage.structure.element.ModuleElement.__add__ (sage/structure/element.c:6533)\n        return coercion_model.bin_op(left, right, add)\n      File \"coerce.pyx\", line 740, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6589)\n        raise TypeError, arith_error_message(x,y,op)\n    TypeError: unsupported operand parent(s) for '+': 'Univariate Polynomial Ring in b over Integer Ring' and 'Univariate Polynomial Ring in a over Integer Ring'\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 931:\n    sage: R.unset_coercions_used()\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_22[12]>\", line 1, in <module>\n        R.unset_coercions_used()###line 931:\n    sage: R.unset_coercions_used()\n    AttributeError: 'sage.rings.polynomial.multi_polynomial_libsingular' object has no attribute 'unset_coercions_used'\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 945:\n    sage: R.unset_coercions_used()\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_22[16]>\", line 1, in <module>\n        R.unset_coercions_used()###line 945:\n    sage: R.unset_coercions_used()\n    AttributeError: 'sage.rings.polynomial.multi_polynomial_libsingular' object has no attribute 'unset_coercions_used'\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 975:\n    sage: K.unset_coercions_used()\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_23[5]>\", line 1, in <module>\n        K.unset_coercions_used()###line 975:\n    sage: K.unset_coercions_used()\n    AttributeError: 'PolynomialRing_integral_domain' object has no attribute 'unset_coercions_used'\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 976:\n    sage: K.register_conversion(M_into_K)\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_23[6]>\", line 1, in <module>\n        K.register_conversion(M_into_K)###line 976:\n    sage: K.register_conversion(M_into_K)\n      File \"parent.pyx\", line 965, in sage.structure.parent.Parent.register_conversion (sage/structure/parent.c:8015)\n        cpdef register_conversion(self, mor):\n      File \"parent.pyx\", line 985, in sage.structure.parent.Parent.register_conversion (sage/structure/parent.c:7825)\n        assert not self._coercions_used, \"coercions must all be registered up before use\"\n    AssertionError: coercions must all be registered up before use\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 1016:\n    sage: K.unset_coercions_used()\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_24[7]>\", line 1, in <module>\n        K.unset_coercions_used()###line 1016:\n    sage: K.unset_coercions_used()\n    AttributeError: 'NumberField_quadratic' object has no attribute 'unset_coercions_used'\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 1017:\n    sage: K.register_embedding(K_into_MS)\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_24[8]>\", line 1, in <module>\n        K.register_embedding(K_into_MS)###line 1017:\n    sage: K.register_embedding(K_into_MS)\n      File \"parent.pyx\", line 1000, in sage.structure.parent.Parent.register_embedding (sage/structure/parent.c:8246)\n        cpdef register_embedding(self, embedding):\n      File \"parent.pyx\", line 1039, in sage.structure.parent.Parent.register_embedding (sage/structure/parent.c:8084)\n        assert not self._coercions_used, \"coercions must all be registered up before use\"\n    AssertionError: coercions must all be registered up before use\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 1022:\n    sage: L.unset_coercions_used()\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_24[12]>\", line 1, in <module>\n        L.unset_coercions_used()###line 1022:\n    sage: L.unset_coercions_used()\n    AttributeError: 'NumberField_quadratic' object has no attribute 'unset_coercions_used'\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 1023:\n    sage: L.register_embedding(L_into_MS)\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_24[13]>\", line 1, in <module>\n        L.register_embedding(L_into_MS)###line 1023:\n    sage: L.register_embedding(L_into_MS)\n      File \"parent.pyx\", line 1000, in sage.structure.parent.Parent.register_embedding (sage/structure/parent.c:8246)\n        cpdef register_embedding(self, embedding):\n      File \"parent.pyx\", line 1039, in sage.structure.parent.Parent.register_embedding (sage/structure/parent.c:8084)\n        assert not self._coercions_used, \"coercions must all be registered up before use\"\n    AssertionError: coercions must all be registered up before use\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 1025:\n    sage: K.coerce_embedding()(a)\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_24[14]>\", line 1, in <module>\n        K.coerce_embedding()(a)###line 1025:\n    sage: K.coerce_embedding()(a)\n    TypeError: 'NoneType' object is not callable\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 1028:\n    sage: L.coerce_embedding()(b)\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_24[15]>\", line 1, in <module>\n        L.coerce_embedding()(b)###line 1028:\n    sage: L.coerce_embedding()(b)\n    TypeError: 'NoneType' object is not callable\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 1032:\n    sage: a.matrix() * b\nExpected:\n    [-272118       0]\n    [      0    -462]\nGot:\n    [           0      b521155]\n    [-462*b521155            0]\n**********************************************************************\nFile \"/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx\", line 1035:\n    sage: a * b.matrix()\nExpected:\n    [-272118       0]\n    [      0    -462]\nGot:\n    [              0         a161099]\n    [-272118*a161099               0]\n**********************************************************************\n4 items had failures:\n   6 of  12 in __main__.example_21\n   2 of  19 in __main__.example_22\n   2 of   9 in __main__.example_23\n   8 of  18 in __main__.example_24\n***Test Failed*** 18 failures.\n```",
    "created_at": "2009-06-01T00:47:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35240",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:19" align="right">comment:19</div>

I merged 

```
5598-coerce-declare.patch
5598-ncalexan-fixes-and-tests.3.patch
5598-test-coercion.patch
```

and got the following failures:

```
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 863:
    sage: K.unset_coercions_used()
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_21[5]>", line 1, in <module>
        K.unset_coercions_used()###line 863:
    sage: K.unset_coercions_used()
    AttributeError: 'PolynomialRing_integral_domain' object has no attribute 'unset_coercions_used'
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 864:
    sage: K.register_coercion(L_into_K)
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_21[6]>", line 1, in <module>
        K.register_coercion(L_into_K)###line 864:
    sage: K.register_coercion(L_into_K)
      File "parent.pyx", line 853, in sage.structure.parent.Parent.register_coercion (sage/structure/parent.c:7450)
        cpdef register_coercion(self, mor):
      File "parent.pyx", line 878, in sage.structure.parent.Parent.register_coercion (sage/structure/parent.c:7239)
        assert not self._coercions_used, "coercions must all be registered up before use"
    AssertionError: coercions must all be registered up before use
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 866:
    sage: K(0) + b
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_21[7]>", line 1, in <module>
        K(Integer(0)) + b###line 866:
    sage: K(0) + b
      File "element.pyx", line 729, in sage.structure.element.ModuleElement.__add__ (sage/structure/element.c:6533)
        return coercion_model.bin_op(left, right, add)
      File "coerce.pyx", line 740, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6589)
        raise TypeError, arith_error_message(x,y,op)
    TypeError: unsupported operand parent(s) for '+': 'Univariate Polynomial Ring in a over Integer Ring' and 'Univariate Polynomial Ring in b over Integer Ring'
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 868:
    sage: a + b
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_21[8]>", line 1, in <module>
        a + b###line 868:
    sage: a + b
      File "element.pyx", line 729, in sage.structure.element.ModuleElement.__add__ (sage/structure/element.c:6533)
        return coercion_model.bin_op(left, right, add)
      File "coerce.pyx", line 740, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6589)
        raise TypeError, arith_error_message(x,y,op)
    TypeError: unsupported operand parent(s) for '+': 'Univariate Polynomial Ring in a over Integer Ring' and 'Univariate Polynomial Ring in b over Integer Ring'
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 870:
    sage: K(b) # check that convert calls coerce first; normally this is just a
Expected:
    -a
Got:
    a
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 873:
    sage: L(0) + a in K # this goes through the coercion mechanism of K
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_21[10]>", line 1, in <module>
        L(Integer(0)) + a in K # this goes through the coercion mechanism of K###line 873:
    sage: L(0) + a in K # this goes through the coercion mechanism of K
      File "element.pyx", line 729, in sage.structure.element.ModuleElement.__add__ (sage/structure/element.c:6533)
        return coercion_model.bin_op(left, right, add)
      File "coerce.pyx", line 740, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6589)
        raise TypeError, arith_error_message(x,y,op)
    TypeError: unsupported operand parent(s) for '+': 'Univariate Polynomial Ring in b over Integer Ring' and 'Univariate Polynomial Ring in a over Integer Ring'
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 931:
    sage: R.unset_coercions_used()
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_22[12]>", line 1, in <module>
        R.unset_coercions_used()###line 931:
    sage: R.unset_coercions_used()
    AttributeError: 'sage.rings.polynomial.multi_polynomial_libsingular' object has no attribute 'unset_coercions_used'
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 945:
    sage: R.unset_coercions_used()
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_22[16]>", line 1, in <module>
        R.unset_coercions_used()###line 945:
    sage: R.unset_coercions_used()
    AttributeError: 'sage.rings.polynomial.multi_polynomial_libsingular' object has no attribute 'unset_coercions_used'
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 975:
    sage: K.unset_coercions_used()
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_23[5]>", line 1, in <module>
        K.unset_coercions_used()###line 975:
    sage: K.unset_coercions_used()
    AttributeError: 'PolynomialRing_integral_domain' object has no attribute 'unset_coercions_used'
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 976:
    sage: K.register_conversion(M_into_K)
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_23[6]>", line 1, in <module>
        K.register_conversion(M_into_K)###line 976:
    sage: K.register_conversion(M_into_K)
      File "parent.pyx", line 965, in sage.structure.parent.Parent.register_conversion (sage/structure/parent.c:8015)
        cpdef register_conversion(self, mor):
      File "parent.pyx", line 985, in sage.structure.parent.Parent.register_conversion (sage/structure/parent.c:7825)
        assert not self._coercions_used, "coercions must all be registered up before use"
    AssertionError: coercions must all be registered up before use
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 1016:
    sage: K.unset_coercions_used()
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_24[7]>", line 1, in <module>
        K.unset_coercions_used()###line 1016:
    sage: K.unset_coercions_used()
    AttributeError: 'NumberField_quadratic' object has no attribute 'unset_coercions_used'
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 1017:
    sage: K.register_embedding(K_into_MS)
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_24[8]>", line 1, in <module>
        K.register_embedding(K_into_MS)###line 1017:
    sage: K.register_embedding(K_into_MS)
      File "parent.pyx", line 1000, in sage.structure.parent.Parent.register_embedding (sage/structure/parent.c:8246)
        cpdef register_embedding(self, embedding):
      File "parent.pyx", line 1039, in sage.structure.parent.Parent.register_embedding (sage/structure/parent.c:8084)
        assert not self._coercions_used, "coercions must all be registered up before use"
    AssertionError: coercions must all be registered up before use
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 1022:
    sage: L.unset_coercions_used()
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_24[12]>", line 1, in <module>
        L.unset_coercions_used()###line 1022:
    sage: L.unset_coercions_used()
    AttributeError: 'NumberField_quadratic' object has no attribute 'unset_coercions_used'
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 1023:
    sage: L.register_embedding(L_into_MS)
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_24[13]>", line 1, in <module>
        L.register_embedding(L_into_MS)###line 1023:
    sage: L.register_embedding(L_into_MS)
      File "parent.pyx", line 1000, in sage.structure.parent.Parent.register_embedding (sage/structure/parent.c:8246)
        cpdef register_embedding(self, embedding):
      File "parent.pyx", line 1039, in sage.structure.parent.Parent.register_embedding (sage/structure/parent.c:8084)
        assert not self._coercions_used, "coercions must all be registered up before use"
    AssertionError: coercions must all be registered up before use
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 1025:
    sage: K.coerce_embedding()(a)
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_24[14]>", line 1, in <module>
        K.coerce_embedding()(a)###line 1025:
    sage: K.coerce_embedding()(a)
    TypeError: 'NoneType' object is not callable
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 1028:
    sage: L.coerce_embedding()(b)
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_24[15]>", line 1, in <module>
        L.coerce_embedding()(b)###line 1028:
    sage: L.coerce_embedding()(b)
    TypeError: 'NoneType' object is not callable
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 1032:
    sage: a.matrix() * b
Expected:
    [-272118       0]
    [      0    -462]
Got:
    [           0      b521155]
    [-462*b521155            0]
**********************************************************************
File "/scratch/mhansen/release/4.0.1/alpha0/sage-4.0.1.alpha0/devel/sage-main/sage/structure/parent.pyx", line 1035:
    sage: a * b.matrix()
Expected:
    [-272118       0]
    [      0    -462]
Got:
    [              0         a161099]
    [-272118*a161099               0]
**********************************************************************
4 items had failures:
   6 of  12 in __main__.example_21
   2 of  19 in __main__.example_22
   2 of   9 in __main__.example_23
   8 of  18 in __main__.example_24
***Test Failed*** 18 failures.
```



---

archive/issue_events_066556.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-06-01T00:47:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66556"
}
```



---

archive/issue_events_066557.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-06-01T00:47:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66557"
}
```



---

archive/issue_comments_035241.json:
```json
{
    "body": "Reviewer: **Nick Alexander**",
    "created_at": "2009-10-19T13:20:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35241",
    "user": "https://github.com/mwhansen"
}
```

Reviewer: **Nick Alexander**



---

archive/issue_comments_035242.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nAttachment: **[trac_5598.patch.gz](https://github.com/sagemath/sage/files/ticket5598/trac_5598.patch.gz)**\n\nI've attached trac_5598.patch which folds the above three together and is rebased for 4.2.  I believe this should pass all tests.",
    "created_at": "2009-10-19T13:20:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35242",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:20" align="right">comment:20</div>

Attachment: **[trac_5598.patch.gz](https://github.com/sagemath/sage/files/ticket5598/trac_5598.patch.gz)**

I've attached trac_5598.patch which folds the above three together and is rebased for 4.2.  I believe this should pass all tests.



---

archive/issue_comments_035243.json:
```json
{
    "body": "Author: **Robert Bradshaw**",
    "created_at": "2009-10-19T13:20:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35243",
    "user": "https://github.com/mwhansen"
}
```

Author: **Robert Bradshaw**



---

archive/issue_events_066558.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-10-19T13:22:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66558"
}
```



---

archive/issue_events_066559.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-10-19T13:22:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66559"
}
```



---

archive/issue_events_066560.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-10-19T13:22:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66560"
}
```



---

archive/issue_events_066561.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-10-19T13:22:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66561"
}
```



---

archive/issue_comments_035244.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThe faliures above were just because in the tests \"unset_coercions_used\" should have been \"_unset_coercions_used\".\n\nAll tests pass with trac_5598.patch.",
    "created_at": "2009-10-19T13:22:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35244",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:22" align="right">comment:22</div>

The faliures above were just because in the tests "unset_coercions_used" should have been "_unset_coercions_used".

All tests pass with trac_5598.patch.



---

archive/issue_events_066562.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-10-19T13:23:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66562"
}
```



---

archive/issue_events_066563.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-10-19T13:23:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5598#event-66563"
}
```



---

archive/issue_comments_035245.json:
```json
{
    "body": "Merged: **sage-4.2.alpha1**",
    "created_at": "2009-10-19T13:23:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5598",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5598#issuecomment-35245",
    "user": "https://github.com/mwhansen"
}
```

Merged: **sage-4.2.alpha1**
