# Issue 5501: pickling high-precision intervals is broken

archive/issues_005501.json:
```json
{
    "body": "The following explodes in sage 3.4:\n\n```\nsage: R = RealIntervalField(4000)\nsage: s = 1/R(3)\nsage: t = loads(dumps(s))\nTraceback (most recent call last):\n  File \"pikltest.py\", line 6, in <module>\n    t = loads(dumps(s))\n  File \"sage_object.pyx\", line 623, in \nsage.structure.sage_object.loads (sage/structure/sage_object.c:6159)\nRuntimeError: ('Unable to convert number to real interval.',\n <built-in function __create__RealIntervalFieldElement_version0>, \n(Real Interval Field with 4000 bits of precision, \n'[a.lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalal0@-1 .. \na.lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala\nlalalalalalalalalalalalalalalalalalalalalalalalalalalg@-1]', 32))\ninvalid data stream\ninvalid load key, 'x'.\nUnable to load pickled data.\n```\n\nFurthermore, it dumps the contents of dumps(s) to the console, which I'm told is a no-no because when one uses ~20kbits of precision with 24 processes via `@`parallel, the error messages are ridiculously huge.\n\nOn a personal note, I'd prefer if my CAS didn't stick its fingers in its ears and chant \"lalalala...\" whenever it doesn't like what I'm doing.  This is *not* how a mature system should behave.\n\n\nAssignee: jkantor\n\nCC:  cwitty\n\nResolution: fixed\n\nAuthor: Robert Bradshaw\n\nReviewer: Tim Dumol\n\nUpstream: Workaround found; Bug reported upstream.\n\nMerged: sage-4.3.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/5501\n\n",
    "closed_at": "2010-01-24T10:58:47Z",
    "created_at": "2009-03-12T15:35:45Z",
    "labels": [
        "component: numerical",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3.2",
    "title": "pickling high-precision intervals is broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/5501",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```
The following explodes in sage 3.4:

```
sage: R = RealIntervalField(4000)
sage: s = 1/R(3)
sage: t = loads(dumps(s))
Traceback (most recent call last):
  File "pikltest.py", line 6, in <module>
    t = loads(dumps(s))
  File "sage_object.pyx", line 623, in 
sage.structure.sage_object.loads (sage/structure/sage_object.c:6159)
RuntimeError: ('Unable to convert number to real interval.',
 <built-in function __create__RealIntervalFieldElement_version0>, 
(Real Interval Field with 4000 bits of precision, 
'[a.lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalal0@-1 .. 
a.lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalalala
lalalalalalalalalalalalalalalalalalalalalalalalalalalg@-1]', 32))
invalid data stream
invalid load key, 'x'.
Unable to load pickled data.
```

Furthermore, it dumps the contents of dumps(s) to the console, which I'm told is a no-no because when one uses ~20kbits of precision with 24 processes via `@`parallel, the error messages are ridiculously huge.

On a personal note, I'd prefer if my CAS didn't stick its fingers in its ears and chant "lalalala..." whenever it doesn't like what I'm doing.  This is *not* how a mature system should behave.


Assignee: jkantor

CC:  cwitty

Resolution: fixed

Author: Robert Bradshaw

Reviewer: Tim Dumol

Upstream: Workaround found; Bug reported upstream.

Merged: sage-4.3.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/5501





---

archive/issue_comments_051143.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,7 +3,8 @@\n ```\n sage: R = RealIntervalField(4000)\n sage: s = 1/R(3)\n-sage: t = loads(dumps(s))Traceback (most recent call last):\n+sage: t = loads(dumps(s))\n+Traceback (most recent call last):\n   File \"pikltest.py\", line 6, in <module>\n     t = loads(dumps(s))\n   File \"sage_object.pyx\", line 623, in \n``````\n",
    "created_at": "2009-03-12T15:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5501#issuecomment-51143",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,7 +3,8 @@
 ```
 sage: R = RealIntervalField(4000)
 sage: s = 1/R(3)
-sage: t = loads(dumps(s))Traceback (most recent call last):
+sage: t = loads(dumps(s))
+Traceback (most recent call last):
   File "pikltest.py", line 6, in <module>
     t = loads(dumps(s))
   File "sage_object.pyx", line 623, in 
``````




---

archive/issue_comments_051144.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis is presumably due to these lines from mpfi_set_str, in mpfi_io.c (in the MPFI library):\n\n```\n  char tmp[1000];\n\n  /* bzero(tmp,1000); */\n  memset(tmp,0,1000);\n\n  slen= (int)strlen(s);\n  if(slen >=1000) return -1;\n```\n\nAs a workaround, instead of passing the `RealIntervalFieldElement` x, you could pass (x.parent(), x.lower(), x.upper()); then on the other side, given (parent, lower, upper), reconstruct the original element with parent(lower,upper).",
    "created_at": "2009-03-13T01:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5501#issuecomment-51144",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

<a id='comment:2'></a>
This is presumably due to these lines from mpfi_set_str, in mpfi_io.c (in the MPFI library):

```
  char tmp[1000];

  /* bzero(tmp,1000); */
  memset(tmp,0,1000);

  slen= (int)strlen(s);
  if(slen >=1000) return -1;
```

As a workaround, instead of passing the `RealIntervalFieldElement` x, you could pass (x.parent(), x.lower(), x.upper()); then on the other side, given (parent, lower, upper), reconstruct the original element with parent(lower,upper).



---

archive/issue_comments_051145.json:
```json
{
    "body": "<a id='comment:3'></a>\nWow.  I'll report this upstream.  Your proposed solution looks good to me.",
    "created_at": "2009-03-13T02:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5501#issuecomment-51145",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```

<a id='comment:3'></a>
Wow.  I'll report this upstream.  Your proposed solution looks good to me.



---

archive/issue_comments_051146.json:
```json
{
    "body": "Attachment [5501-RIF-pickle.patch](tarball://root/attachments/some-uuid/ticket5501/5501-RIF-pickle.patch) by @robertwb created at 2010-01-17 10:21:42",
    "created_at": "2010-01-17T10:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5501#issuecomment-51146",
    "user": "https://github.com/robertwb"
}
```

Attachment [5501-RIF-pickle.patch](tarball://root/attachments/some-uuid/ticket5501/5501-RIF-pickle.patch) by @robertwb created at 2010-01-17 10:21:42



---

archive/issue_comments_051147.json:
```json
{
    "body": "Upstream: N/A",
    "created_at": "2010-01-17T10:22:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5501#issuecomment-51147",
    "user": "https://github.com/robertwb"
}
```

Upstream: N/A



---

archive/issue_comments_051148.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-01-17T10:22:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5501#issuecomment-51148",
    "user": "https://github.com/robertwb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_051149.json:
```json
{
    "body": "<a id='comment:4'></a>\nYep, pickling the endpoints was the first thought I had as well.",
    "created_at": "2010-01-17T10:22:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5501#issuecomment-51149",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:4'></a>
Yep, pickling the endpoints was the first thought I had as well.



---

archive/issue_comments_051150.json:
```json
{
    "body": "Author: robertwb",
    "created_at": "2010-01-20T10:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5501#issuecomment-51150",
    "user": "https://github.com/TimDumol"
}
```

Author: robertwb



---

archive/issue_comments_051151.json:
```json
{
    "body": "<a id='comment:5'></a>\nLGTM. By the way, what's the upstream report status on this?",
    "created_at": "2010-01-20T10:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5501#issuecomment-51151",
    "user": "https://github.com/TimDumol"
}
```

<a id='comment:5'></a>
LGTM. By the way, what's the upstream report status on this?



---

archive/issue_comments_051152.json:
```json
{
    "body": "Reviewer: Tim Dumol",
    "created_at": "2010-01-20T10:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5501#issuecomment-51152",
    "user": "https://github.com/TimDumol"
}
```

Reviewer: Tim Dumol



---

archive/issue_comments_051153.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-01-20T10:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5501#issuecomment-51153",
    "user": "https://github.com/TimDumol"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_051154.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Workaround found; Bug reported upstream.\"",
    "created_at": "2010-01-20T19:54:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5501#issuecomment-51154",
    "user": "https://github.com/robertwb"
}
```

Changing upstream from "N/A" to "Workaround found; Bug reported upstream."



---

archive/issue_comments_051155.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-01-24T10:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5501#issuecomment-51155",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Resolution: fixed



---

archive/issue_comments_051156.json:
```json
{
    "body": "Changing author from \"robertwb\" to \"Robert Bradshaw\"",
    "created_at": "2010-01-24T10:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5501#issuecomment-51156",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing author from "robertwb" to "Robert Bradshaw"



---

archive/issue_events_016653.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2010-01-24T10:58:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/5501",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5501#event-16653"
}
```



---

archive/issue_comments_051157.json:
```json
{
    "body": "Merged: sage-4.3.2.alpha0",
    "created_at": "2010-01-24T10:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5501#issuecomment-51157",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Merged: sage-4.3.2.alpha0
