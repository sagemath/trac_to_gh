# Issue 5921: [with positive review] factoring integer polynomials does not factor the content

archive/issues_005921.json:
```json
{
    "body": "I think this is wrong:\n\n```\nsage: R.<x> = ZZ[]\nsage: f = 30*x\nsage: f.factor()\n30 * x\n```\nsince in the ring ZZ[] 30 is not irreducible;  it should return 2*3*5*x.\n\n\nAssignee: tbd\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/5921\n\n",
    "closed_at": "2009-04-30T09:20:52Z",
    "created_at": "2009-04-28T19:54:00Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.4.2",
    "title": "[with positive review] factoring integer polynomials does not factor the content",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/5921",
    "user": "https://github.com/JohnCremona"
}
```
I think this is wrong:

```
sage: R.<x> = ZZ[]
sage: f = 30*x
sage: f.factor()
30 * x
```
since in the ring ZZ[] 30 is not irreducible;  it should return 2*3*5*x.


Assignee: tbd

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/5921





---

archive/issue_comments_056671.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2009-04-28T20:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56671",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_056672.json:
```json
{
    "body": "<a id='comment:1'></a>\nAttachment [trac_5921.patch](tarball://root/attachments/some-uuid/ticket5921/trac_5921.patch) by @JohnCremona created at 2009-04-28 20:04:25",
    "created_at": "2009-04-28T20:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56672",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:1'></a>
Attachment [trac_5921.patch](tarball://root/attachments/some-uuid/ticket5921/trac_5921.patch) by @JohnCremona created at 2009-04-28 20:04:25



---

archive/issue_comments_056673.json:
```json
{
    "body": "<a id='comment:2'></a>\nHi John,\n\nThe changes in the patch look fine, but for some reason they make doctests fail in two places: `polynomial_zmod_flint.pyx` (with some errors) and `polynomial_modn_dense_ntl.pyx` (killed after timeout).  I'm rushing to teach right now, but I'll try to investigate afterward.",
    "created_at": "2009-04-28T22:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56673",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:2'></a>
Hi John,

The changes in the patch look fine, but for some reason they make doctests fail in two places: `polynomial_zmod_flint.pyx` (with some errors) and `polynomial_modn_dense_ntl.pyx` (killed after timeout).  I'm rushing to teach right now, but I'll try to investigate afterward.



---

archive/issue_comments_056674.json:
```json
{
    "body": "<a id='comment:3'></a>\nOK, I've found a very simple example where this bombs:\n\n```\nsage: P.<x> = ZZ[]\nsage: f = 2*x + 2\nsage: f.roots()\n...\nNotImplementedError:\n```",
    "created_at": "2009-04-29T00:53:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56674",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:3'></a>
OK, I've found a very simple example where this bombs:

```
sage: P.<x> = ZZ[]
sage: f = 2*x + 2
sage: f.roots()
...
NotImplementedError:
```



---

archive/issue_comments_056675.json:
```json
{
    "body": "<a id='comment:4'></a>\nHmmm.  We just had this situation happen on a different ticket: the code in this patch is fine but breaks something, which really exposes a pre-existing bug.\n\nIn this case, John's code factors the content and the \"normalised, content-free\" polynomial separately and multiplies the two factorisations.  The problem is the with the types: the first factorisation consists of integers, while the second one consists of polynomials.  Multiplying them together yields a factorisation where some factors are of type integer and the others of type polynomial, and then this breaks all sorts of things later on.\n\nI've made a new ticket at #5928 and will have a patch up there soon.  Then John's patch on this ticket will be good to go.",
    "created_at": "2009-04-29T01:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56675",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:4'></a>
Hmmm.  We just had this situation happen on a different ticket: the code in this patch is fine but breaks something, which really exposes a pre-existing bug.

In this case, John's code factors the content and the "normalised, content-free" polynomial separately and multiplies the two factorisations.  The problem is the with the types: the first factorisation consists of integers, while the second one consists of polynomials.  Multiplying them together yields a factorisation where some factors are of type integer and the others of type polynomial, and then this breaks all sorts of things later on.

I've made a new ticket at #5928 and will have a patch up there soon.  Then John's patch on this ticket will be good to go.



---

archive/issue_comments_056676.json:
```json
{
    "body": "<a id='comment:5'></a>\nThere's now a patch up at #5928.  I've tested again with John's patch applied and the `polynomial_zmod_flint.pyx` problems are gone, but I'm still getting timeouts in `polynomial_modn_dense_ntl.pyx`.  So there's more to this than I thought.",
    "created_at": "2009-04-29T05:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56676",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:5'></a>
There's now a patch up at #5928.  I've tested again with John's patch applied and the `polynomial_zmod_flint.pyx` problems are gone, but I'm still getting timeouts in `polynomial_modn_dense_ntl.pyx`.  So there's more to this than I thought.



---

archive/issue_comments_056677.json:
```json
{
    "body": "<a id='comment:6'></a>\nYes, the problem is in `f.roots()` for a polynomial f with integer coefficients.  The code used to just run `f.factor()`, but of course now if the content is a huge integer it's gonna take a while for the factoring to finish.  There's a doctest in the sage library that runs into precisely this problem now, since it's an illustration of RSA and has huge coefficients (and a huge content) floating around.  However, you don't care about the content if you just want the roots of the polynomial.\n\nSo the attached patch makes `roots()` divide by the content first, then call `factor()`.  It also adds a warning to this effect in the docstrings of the two `factor()` methods.\n\nI'm happy with John's patch, so if someone reviews my patch we're done.",
    "created_at": "2009-04-29T06:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56677",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:6'></a>
Yes, the problem is in `f.roots()` for a polynomial f with integer coefficients.  The code used to just run `f.factor()`, but of course now if the content is a huge integer it's gonna take a while for the factoring to finish.  There's a doctest in the sage library that runs into precisely this problem now, since it's an illustration of RSA and has huge coefficients (and a huge content) floating around.  However, you don't care about the content if you just want the roots of the polynomial.

So the attached patch makes `roots()` divide by the content first, then call `factor()`.  It also adds a warning to this effect in the docstrings of the two `factor()` methods.

I'm happy with John's patch, so if someone reviews my patch we're done.



---

archive/issue_comments_056678.json:
```json
{
    "body": "<a id='comment:7'></a>\nI forgot to mention this again: this ticket depends on the patch at #5928, so that should be applied first.",
    "created_at": "2009-04-29T06:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56678",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:7'></a>
I forgot to mention this again: this ticket depends on the patch at #5928, so that should be applied first.



---

archive/issue_comments_056679.json:
```json
{
    "body": "<a id='comment:8'></a>\nI am happy with Alex's patch.  I made mine a bit too quickly or I would have thought about the universes being different.  So I will give this a positive review as soon as I have gone to look at #5928.",
    "created_at": "2009-04-29T08:30:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56679",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:8'></a>
I am happy with Alex's patch.  I made mine a bit too quickly or I would have thought about the universes being different.  So I will give this a positive review as soon as I have gone to look at #5928.



---

archive/issue_events_017949.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "rename": {
        "from": "factoring integer polynomials does not factor the content",
        "to": "[with positive review] factoring integer polynomials does not factor the content"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5921#event-17949"
}
```



---

archive/issue_comments_056680.json:
```json
{
    "body": "<a id='comment:9'></a>\nI applied both patches after #5928 on top of 3.4.2.alpha0, fine.  Ran all tests in sage/rings/polynomial (all fine) and sage/rings/number_field (all fine).\n\nSo I have given this a positive review since Alex and I have reviewed eachothers' patches.",
    "created_at": "2009-04-29T09:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56680",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:9'></a>
I applied both patches after #5928 on top of 3.4.2.alpha0, fine.  Ran all tests in sage/rings/polynomial (all fine) and sage/rings/number_field (all fine).

So I have given this a positive review since Alex and I have reviewed eachothers' patches.



---

archive/issue_comments_056681.json:
```json
{
    "body": "<a id='comment:10'></a>\nThese two patches break\n\n```\nsage -t -long devel/sage/sage/modular/overconvergent/genus0.py\n```\n\nCheers,\n\nMichael",
    "created_at": "2009-04-30T02:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56681",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:10'></a>
These two patches break

```
sage -t -long devel/sage/sage/modular/overconvergent/genus0.py
```

Cheers,

Michael



---

archive/issue_events_017950.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "rename": {
        "from": "[with positive review] factoring integer polynomials does not factor the content",
        "to": "factoring integer polynomials does not factor the content"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5921#event-17950"
}
```



---

archive/issue_comments_056682.json:
```json
{
    "body": "Changing status from new to needs_work.",
    "created_at": "2009-04-30T02:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56682",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Changing status from new to needs_work.



---

archive/issue_comments_056683.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [mabshoff](#comment%3A10):\n> These two patches break\n> \n> ```\n> sage -t -long devel/sage/sage/modular/overconvergent/genus0.py\n> ```\n> \n\n\nThis is due to a bug in p-adics, more precisely in the content method for p-adic polynomials:\n\n```\nsage: P.<x> = ZZ[]\nsage: f = x + 2\nsage: f.content()\n1\nsage: fp = f.change_ring(pAdicField(2, 10))\nsage: fp\n(1 + O(2^10))*x + (2 + O(2^11))\nsage: fp.content()\n0\n```\n\nI have checked and the monster p-adic patch bomb at #5778 doesn't help with this.  I'll see what we can do.",
    "created_at": "2009-04-30T03:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56683",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:11'></a>
Replying to [mabshoff](#comment%3A10):
> These two patches break
> 
> ```
> sage -t -long devel/sage/sage/modular/overconvergent/genus0.py
> ```
> 


This is due to a bug in p-adics, more precisely in the content method for p-adic polynomials:

```
sage: P.<x> = ZZ[]
sage: f = x + 2
sage: f.content()
1
sage: fp = f.change_ring(pAdicField(2, 10))
sage: fp
(1 + O(2^10))*x + (2 + O(2^11))
sage: fp.content()
0
```

I have checked and the monster p-adic patch bomb at #5778 doesn't help with this.  I'll see what we can do.



---

archive/issue_comments_056684.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2009-04-30T06:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56684",
    "user": "https://github.com/aghitza"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_056685.json:
```json
{
    "body": "<a id='comment:12'></a>\nOK, I've made a simple modification in my patch that sidesteps the p-adic polynomial bug (for which there is now a new trac ticket #5946).\n\nI have replaced my patch with the new version, so one still needs to apply both patches.",
    "created_at": "2009-04-30T06:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56685",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:12'></a>
OK, I've made a simple modification in my patch that sidesteps the p-adic polynomial bug (for which there is now a new trac ticket #5946).

I have replaced my patch with the new version, so one still needs to apply both patches.



---

archive/issue_events_017951.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "rename": {
        "from": "factoring integer polynomials does not factor the content",
        "to": "[with positive review] factoring integer polynomials does not factor the content"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5921#event-17951"
}
```



---

archive/issue_comments_056686.json:
```json
{
    "body": "<a id='comment:13'></a>\nAttachment [trac_5921_fix.patch](tarball://root/attachments/some-uuid/ticket5921/trac_5921_fix.patch) by @JohnCremona created at 2009-04-30 08:29:02\n\nWith Alex's new patch (on top of mine all tests in modular/overconvergent/* pass  as well as all in rings/polynomial\n\nI reinstated Positive Review and am keeping my fingers crossed!",
    "created_at": "2009-04-30T08:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56686",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:13'></a>
Attachment [trac_5921_fix.patch](tarball://root/attachments/some-uuid/ticket5921/trac_5921_fix.patch) by @JohnCremona created at 2009-04-30 08:29:02

With Alex's new patch (on top of mine all tests in modular/overconvergent/* pass  as well as all in rings/polynomial

I reinstated Positive Review and am keeping my fingers crossed!



---

archive/issue_comments_056687.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-04-30T09:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56687",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Resolution: fixed



---

archive/issue_events_017952.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-04-30T09:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "milestone": "sage-3.4.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5921#event-17952"
}
```



---

archive/issue_comments_056688.json:
```json
{
    "body": "<a id='comment:14'></a>\nMerged both patches in Sage 3.4.2.rc0.\n\nCheers,\n\nMichael",
    "created_at": "2009-04-30T09:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5921#issuecomment-56688",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:14'></a>
Merged both patches in Sage 3.4.2.rc0.

Cheers,

Michael



---

archive/issue_events_017953.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-04-30T09:20:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/5921",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5921#event-17953"
}
```
