# Issue 5120: An alternative implementation of the Unique Representation design pattern

archive/issues_005120.json:
```json
{
    "assignees": [],
    "body": "Class deriving from sage.structure.UniqueRepresentation inherit a\nunique representation behavior for their instances (and consistent\ndefault implementations of equality testing, copying, pickling, ...).\n\nSee the documentation for a brief discussion of the relative merits of\nUniqueRepresentation? and UniqueFactory?.\n\nAs a prerequisite, this patch implements sage.misc.ClasscallMetaclass,\na (trivial) metaclass for customizing class calls via a static method\nof the class.\n\nThis class is used extensively in upcoming sage-combinat patches:\n- #5879 (crystals)\n- #5891 categories\n- free modules\n- automatic monoid\n\n~500 lines of doctest for 15 lines of code\n\nAssignee: **@nthiery**\n\nCC:  @sagetrac-sage-combinat\n\nKeywords: **unique representation**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/5120_\n\n",
    "closed_at": "2009-05-21T00:59:10Z",
    "created_at": "2009-01-28T19:47:27Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "An alternative implementation of the Unique Representation design pattern",
    "type": "issue",
    "updated_at": "2009-05-21T00:59:10Z",
    "url": "https://github.com/sagemath/sage/issues/5120",
    "user": "https://github.com/nthiery"
}
```
Class deriving from sage.structure.UniqueRepresentation inherit a
unique representation behavior for their instances (and consistent
default implementations of equality testing, copying, pickling, ...).

See the documentation for a brief discussion of the relative merits of
UniqueRepresentation? and UniqueFactory?.

As a prerequisite, this patch implements sage.misc.ClasscallMetaclass,
a (trivial) metaclass for customizing class calls via a static method
of the class.

This class is used extensively in upcoming sage-combinat patches:
- #5879 (crystals)
- #5891 categories
- free modules
- automatic monoid

~500 lines of doctest for 15 lines of code

Assignee: **@nthiery**

CC:  @sagetrac-sage-combinat

Keywords: **unique representation**

_Issue created by migration from https://trac.sagemath.org/ticket/5120_





---

archive/issue_events_053428.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2009-01-28T19:47:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53428"
}
```



---

archive/issue_events_053429.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2009-01-28T19:47:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53429"
}
```



---

archive/issue_events_053430.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2009-01-28T19:47:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "component: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53430"
}
```



---

archive/issue_events_053431.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-01-28T22:17:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53431"
}
```



---

archive/issue_events_053432.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-01-28T22:17:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "a6a6a6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53432"
}
```



---

archive/issue_comments_032431.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nDuplicate of #5119",
    "created_at": "2009-01-28T22:17:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32431",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:1" align="right">Comment 1</div>

Duplicate of #5119



---

archive/issue_events_053433.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-01-28T22:17:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53433"
}
```



---

archive/issue_events_053434.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-01-28T22:17:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "component: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53434"
}
```



---

archive/issue_comments_032432.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nWell, Nicolas closed #5119 as a dupe, so I am reopening this one since I assume one ticket ought to stay open :)\n\nCheers,\n\nMichael",
    "created_at": "2009-01-28T23:06:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32432",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:2" align="right">Comment 2</div>

Well, Nicolas closed #5119 as a dupe, so I am reopening this one since I assume one ticket ought to stay open :)

Cheers,

Michael



---

archive/issue_events_053435.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-28T23:06:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "a6a6a6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53435"
}
```



---

archive/issue_events_053436.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-01-28T23:06:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "milestone_number": null,
    "milestone_title": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53436"
}
```



---

archive/issue_comments_032433.json:
```json
{
    "body": "Changed assignee from **@sagetrac-cwitty** to **@nthiery**",
    "created_at": "2009-03-04T04:44:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32433",
    "user": "https://github.com/nthiery"
}
```

Changed assignee from **@sagetrac-cwitty** to **@nthiery**



---

archive/issue_events_053437.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2009-03-04T04:44:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53437"
}
```



---

archive/issue_comments_032434.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,3 @@\n-Implement a sage.structure.UniqueRepresentation class. \n-Subclasses inherit from it a unique representation behavior for its elements.\n+Implement sage.structure.UniqueRepresentation class. Derived classes inherit a unique representation behavior for their instances.\n \n-Patch under construction, starting from sage.categories.category.uniq.\n+This will be used extensively in upcoming patches\n``````\n",
    "created_at": "2009-03-04T04:44:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32434",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,3 @@
-Implement a sage.structure.UniqueRepresentation class. 
-Subclasses inherit from it a unique representation behavior for its elements.
+Implement sage.structure.UniqueRepresentation class. Derived classes inherit a unique representation behavior for their instances.
 
-Patch under construction, starting from sage.categories.category.uniq.
+This will be used extensively in upcoming patches
``````




---

archive/issue_events_053438.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2009-03-04T04:44:59Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "title_is": "abstract class for unique representation [with patch, needs review]",
    "title_was": "abstract class for unique representation",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53438"
}
```



---

archive/issue_comments_032435.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nI'm sure there are good reasons why this is needed, but I think it would be helpful to potential reviewers of you could give a real-life example where this class will be used!",
    "created_at": "2009-03-14T20:48:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32435",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:4" align="right">Comment 4</div>

I'm sure there are good reasons why this is needed, but I think it would be helpful to potential reviewers of you could give a real-life example where this class will be used!



---

archive/issue_events_053439.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-12T06:43:49Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "title_is": "abstract class for unique representation",
    "title_was": "abstract class for unique representation [with patch, needs review]",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53439"
}
```



---

archive/issue_events_053440.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-12T06:43:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53440"
}
```



---

archive/issue_comments_032436.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\n1) The first line of one of the files is:\n\n```\n\u00ef\u00bb\u00bfr\"\"\" \n```\nI.e., lots of weird corrupted characters.\n\n2) There are no doctests for any of the actual functions you defined.  Code can't go into sage without 100% doctest coverage of each new function.",
    "created_at": "2009-04-12T06:43:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32436",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:5" align="right">Comment 5</div>

1) The first line of one of the files is:

```
ï»¿r""" 
```
I.e., lots of weird corrupted characters.

2) There are no doctests for any of the actual functions you defined.  Code can't go into sage without 100% doctest coverage of each new function.



---

archive/issue_events_053441.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2009-04-13T19:26:16Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "title_is": "An alternative implementation of the Unique Representation design pattern",
    "title_was": "abstract class for unique representation",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53441"
}
```



---

archive/issue_events_053442.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2009-04-13T19:26:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53442"
}
```



---

archive/issue_events_053443.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2009-04-13T19:26:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53443"
}
```



---

archive/issue_comments_032437.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-Implement sage.structure.UniqueRepresentation class. Derived classes inherit a unique representation behavior for their instances.\n+Class deriving from sage.structure.UniqueRepresentation class inherit a unique representation behavior for their instances. See the documentation for a brief discussion of the relative merits of UniqueRepresentation and UniqueFactory.\n \n-This will be used extensively in upcoming patches\n+This class will be used extensively in upcoming patches (unique representation of categories, combinatorial free modules, ...)\n``````\n",
    "created_at": "2009-04-13T19:26:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32437",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-Implement sage.structure.UniqueRepresentation class. Derived classes inherit a unique representation behavior for their instances.
+Class deriving from sage.structure.UniqueRepresentation class inherit a unique representation behavior for their instances. See the documentation for a brief discussion of the relative merits of UniqueRepresentation and UniqueFactory.
 
-This will be used extensively in upcoming patches
+This class will be used extensively in upcoming patches (unique representation of categories, combinatorial free modules, ...)
``````




---

archive/issue_comments_032438.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nUploaded an updated patch which fixes 1) and 2)\n\nOk to abide to a rule, even in a corner case like this where the extra doc really does not add any strength to the test suite, while actually making the code less readable. But it's frustrating to get complained at about documentation for a patch which has a doc/code ratio of 15/1. Next time a please will work better than a gun. \n\n       Grumpy O' Pa :-)",
    "created_at": "2009-04-13T19:48:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32438",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:7" align="right">Comment 7</div>

Uploaded an updated patch which fixes 1) and 2)

Ok to abide to a rule, even in a corner case like this where the extra doc really does not add any strength to the test suite, while actually making the code less readable. But it's frustrating to get complained at about documentation for a patch which has a doc/code ratio of 15/1. Next time a please will work better than a gun. 

       Grumpy O' Pa :-)



---

archive/issue_comments_032439.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nThe patch doesn't apply cleanly to sage-3.4.1 since the hunk in\nsage/structure/all.py needs to be corrected by hand.",
    "created_at": "2009-04-24T20:56:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32439",
    "user": "https://github.com/dwbump"
}
```

<div id="comment:8" align="right">Comment 8</div>

The patch doesn't apply cleanly to sage-3.4.1 since the hunk in
sage/structure/all.py needs to be corrected by hand.



---

archive/issue_comments_032440.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nReplying to [@dwbump](#comment%3A8):\n> The patch doesn't apply cleanly to sage-3.4.1 since the hunk in\n> sage/structure/all.py needs to be corrected by hand.\n\nThanks for the notice. The patch on sage-combinat has been rebased. I'll try to upload it today, after folding in two\nlittle other improvements.",
    "created_at": "2009-04-24T21:28:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32440",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:9" align="right">Comment 9</div>

Replying to [@dwbump](#comment%3A8):
> The patch doesn't apply cleanly to sage-3.4.1 since the hunk in
> sage/structure/all.py needs to be corrected by hand.

Thanks for the notice. The patch on sage-combinat has been rebased. I'll try to upload it today, after folding in two
little other improvements.



---

archive/issue_comments_032441.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nReplying to [@nthiery](#comment%3A9):\n> Thanks for the notice. The patch on sage-combinat has been rebased. I'll try to upload it today, after folding in two\n> little other improvements.\n\nI just updated the patch, rebased for 3.4.1, with description header, default implementation of copy/deepcopy, and pickling by reduce rather than getnewargs.\n\nThis later change is debatable. For some reason the reduce way was preferable for some application to categories, but I badly enough did not take notes about why",
    "created_at": "2009-04-24T23:20:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32441",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:10" align="right">Comment 10</div>

Replying to [@nthiery](#comment%3A9):
> Thanks for the notice. The patch on sage-combinat has been rebased. I'll try to upload it today, after folding in two
> little other improvements.

I just updated the patch, rebased for 3.4.1, with description header, default implementation of copy/deepcopy, and pickling by reduce rather than getnewargs.

This later change is debatable. For some reason the reduce way was preferable for some application to categories, but I badly enough did not take notes about why



---

archive/issue_comments_032442.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nReplying to [@nthiery](#comment%3A10):\n> Replying to [@nthiery](#comment%3A9):\n> > Thanks for the notice. The patch on sage-combinat has been rebased. I'll try to upload it today, after folding in two\n> > little other improvements.\n\n> \n> I just updated the patch, rebased for 3.4.1, with description header, default implementation of copy/deepcopy, and pickling by reduce rather than getnewargs.\n> \n> This later change is debatable. For some reason the reduce way was preferable for some application to categories, but I badly enough did not take notes about why\n\nAh, I know why: keyword arguments. See updated, 100% doctested and proofread patch.",
    "created_at": "2009-04-25T07:48:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32442",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:11" align="right">Comment 11</div>

Replying to [@nthiery](#comment%3A10):
> Replying to [@nthiery](#comment%3A9):
> > Thanks for the notice. The patch on sage-combinat has been rebased. I'll try to upload it today, after folding in two
> > little other improvements.

> 
> I just updated the patch, rebased for 3.4.1, with description header, default implementation of copy/deepcopy, and pickling by reduce rather than getnewargs.
> 
> This later change is debatable. For some reason the reduce way was preferable for some application to categories, but I badly enough did not take notes about why

Ah, I know why: keyword arguments. See updated, 100% doctested and proofread patch.



---

archive/issue_comments_032443.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\n> Ah, I know why: keyword arguments. See updated, 100% doctested and proofread patch.\n\nOops trivial update to apply cleanly on 3.4.1. Thanks Dan for the notice.\n\nMichael: could we change the milestone to 3.4.2?",
    "created_at": "2009-04-25T15:45:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32443",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:12" align="right">Comment 12</div>

> Ah, I know why: keyword arguments. See updated, 100% doctested and proofread patch.

Oops trivial update to apply cleanly on 3.4.1. Thanks Dan for the notice.

Michael: could we change the milestone to 3.4.2?



---

archive/issue_comments_032444.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nReplying to [@nthiery](#comment%3A12):\n\nI deleted the old patch.\n\n> Michael: could we change the milestone to 3.4.2?\n\nThe assignment of milestones is generally insignificant (an exception is like right now when 3.4.2.rc0 was the last merge release and we are in blocker fixes only mode), but as long as this ticket would have gotten a positive review it would have had a chance to go into 3.4.2 regardless which milestone it would have been assigned to.\n\nThis patch is also a new design pattern which warrants to be mentioned on sage-devel. It seems to be very well documented and AFAIK it should be properly covered :)\n\nCheers,\n\nMichael",
    "created_at": "2009-04-30T22:10:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32444",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:13" align="right">Comment 13</div>

Replying to [@nthiery](#comment%3A12):

I deleted the old patch.

> Michael: could we change the milestone to 3.4.2?

The assignment of milestones is generally insignificant (an exception is like right now when 3.4.2.rc0 was the last merge release and we are in blocker fixes only mode), but as long as this ticket would have gotten a positive review it would have had a chance to go into 3.4.2 regardless which milestone it would have been assigned to.

This patch is also a new design pattern which warrants to be mentioned on sage-devel. It seems to be very well documented and AFAIK it should be properly covered :)

Cheers,

Michael



---

archive/issue_comments_032445.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,13 @@\n Class deriving from sage.structure.UniqueRepresentation class inherit a unique representation behavior for their instances. See the documentation for a brief discussion of the relative merits of UniqueRepresentation and UniqueFactory.\n+This is also a generalization of the already existing class sage.categories.category.uniq1, which it will eventually supersede in the category patch.\n \n This class will be used extensively in upcoming patches (unique representation of categories, combinatorial free modules, ...)\n+\n+Class deriving from sage.structure.UniqueRepresentation? inherit a\n+unique representation behavior for their instances (and consistent\n+default implementations of equality testing, copying, pickling, ...).\n+\n+This class is used extensively in upcoming sage-combinat patches:\n+- #5879 (crystals)\n+- categories\n+- free modules\n``````\n",
    "created_at": "2009-04-30T23:17:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32445",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,13 @@
 Class deriving from sage.structure.UniqueRepresentation class inherit a unique representation behavior for their instances. See the documentation for a brief discussion of the relative merits of UniqueRepresentation and UniqueFactory.
+This is also a generalization of the already existing class sage.categories.category.uniq1, which it will eventually supersede in the category patch.
 
 This class will be used extensively in upcoming patches (unique representation of categories, combinatorial free modules, ...)
+
+Class deriving from sage.structure.UniqueRepresentation? inherit a
+unique representation behavior for their instances (and consistent
+default implementations of equality testing, copying, pickling, ...).
+
+This class is used extensively in upcoming sage-combinat patches:
+- #5879 (crystals)
+- categories
+- free modules
``````




---

archive/issue_comments_032446.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nApplies cleanly to sage-3.4.2.rc0 and passes all tests.",
    "created_at": "2009-05-02T20:32:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32446",
    "user": "https://github.com/dwbump"
}
```

<div id="comment:15" align="right">Comment 15</div>

Applies cleanly to sage-3.4.2.rc0 and passes all tests.



---

archive/issue_events_053444.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-05-08T00:43:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53444"
}
```



---

archive/issue_events_053445.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-05-08T00:43:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53445"
}
```



---

archive/issue_comments_032447.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nNote that #5879 exposes a problem with this patch. To quote Anne:\n\n```\nI just talked to Nicolas about the pickling problem; this is a shortcoming \nof the current unique representation patch and he will try to find a solution \nto the problem in patch 5120.\n```\n\nI will mark this \"needs work\" until this issue is resolved. \n\nCheers,\n\nMichael",
    "created_at": "2009-05-08T00:43:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32447",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:16" align="right">Comment 16</div>

Note that #5879 exposes a problem with this patch. To quote Anne:

```
I just talked to Nicolas about the pickling problem; this is a shortcoming 
of the current unique representation patch and he will try to find a solution 
to the problem in patch 5120.
```

I will mark this "needs work" until this issue is resolved. 

Cheers,

Michael



---

archive/issue_events_053446.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2009-05-08T21:39:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53446"
}
```



---

archive/issue_events_053447.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2009-05-08T21:39:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53447"
}
```



---

archive/issue_comments_032448.json:
```json
{
    "body": "Changed keywords from **** to **unique representation**",
    "created_at": "2009-05-08T21:39:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32448",
    "user": "https://github.com/nthiery"
}
```

Changed keywords from **** to **unique representation**



---

archive/issue_comments_032449.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,18 @@\n-Class deriving from sage.structure.UniqueRepresentation class inherit a unique representation behavior for their instances. See the documentation for a brief discussion of the relative merits of UniqueRepresentation and UniqueFactory.\n-This is also a generalization of the already existing class sage.categories.category.uniq1, which it will eventually supersede in the category patch.\n-\n-This class will be used extensively in upcoming patches (unique representation of categories, combinatorial free modules, ...)\n-\n-Class deriving from sage.structure.UniqueRepresentation? inherit a\n+Class deriving from sage.structure.UniqueRepresentation inherit a\n unique representation behavior for their instances (and consistent\n default implementations of equality testing, copying, pickling, ...).\n \n+See the documentation for a brief discussion of the relative merits of\n+UniqueRepresentation? and UniqueFactory?.\n+\n+As a prerequisite, this patch implements sage.misc.ClasscallMetaclass,\n+a (trivial) metaclass for customizing class calls via a static method\n+of the class.\n+\n This class is used extensively in upcoming sage-combinat patches:\n - #5879 (crystals)\n-- categories\n+- #5891 categories\n - free modules\n+- automatic monoid\n+\n+~500 lines of doctest for 15 lines of code\n``````\n",
    "created_at": "2009-05-08T21:39:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32449",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,18 @@
-Class deriving from sage.structure.UniqueRepresentation class inherit a unique representation behavior for their instances. See the documentation for a brief discussion of the relative merits of UniqueRepresentation and UniqueFactory.
-This is also a generalization of the already existing class sage.categories.category.uniq1, which it will eventually supersede in the category patch.
-
-This class will be used extensively in upcoming patches (unique representation of categories, combinatorial free modules, ...)
-
-Class deriving from sage.structure.UniqueRepresentation? inherit a
+Class deriving from sage.structure.UniqueRepresentation inherit a
 unique representation behavior for their instances (and consistent
 default implementations of equality testing, copying, pickling, ...).
 
+See the documentation for a brief discussion of the relative merits of
+UniqueRepresentation? and UniqueFactory?.
+
+As a prerequisite, this patch implements sage.misc.ClasscallMetaclass,
+a (trivial) metaclass for customizing class calls via a static method
+of the class.
+
 This class is used extensively in upcoming sage-combinat patches:
 - #5879 (crystals)
-- categories
+- #5891 categories
 - free modules
+- automatic monoid
+
+~500 lines of doctest for 15 lines of code
``````




---

archive/issue_comments_032450.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nI changed a bit the underlying implementation which fixes the code and should be more robust.\nI also added 2 pages of doc, and extracted a trivial yet general purpose CallclassMetaclass (Florent will be interested).\nUpdated patch upload in a couple minutes.",
    "created_at": "2009-05-08T21:41:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32450",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:18" align="right">Comment 18</div>

I changed a bit the underlying implementation which fixes the code and should be more robust.
I also added 2 pages of doc, and extracted a trivial yet general purpose CallclassMetaclass (Florent will be interested).
Updated patch upload in a couple minutes.



---

archive/issue_comments_032451.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nUpdated patch includes ReST fixes suggested by David Roe, as well as an example on how to handle properly default arguments.",
    "created_at": "2009-05-19T06:15:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32451",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:19" align="right">Comment 19</div>

Updated patch includes ReST fixes suggested by David Roe, as well as an example on how to handle properly default arguments.



---

archive/issue_events_053448.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2009-05-19T06:23:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53448"
}
```



---

archive/issue_comments_032452.json:
```json
{
    "body": "Attachment: **[unique_representation-5120-submitted.patch.gz](https://github.com/sagemath/sage/files/ticket5120/unique_representation-5120-submitted.patch.gz)**",
    "created_at": "2009-05-19T07:10:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32452",
    "user": "https://github.com/nthiery"
}
```

Attachment: **[unique_representation-5120-submitted.patch.gz](https://github.com/sagemath/sage/files/ticket5120/unique_representation-5120-submitted.patch.gz)**



---

archive/issue_comments_032453.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nI'd like to see some more thought go into what use cases are best served by UniqueRepresentation and what by UniqueFactory.  But the code is well documented, does what it claims to do, and UniqueRepresentation is easier to use than UniqueFactory.  So positive review.",
    "created_at": "2009-05-19T07:57:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32453",
    "user": "https://github.com/roed314"
}
```

<div id="comment:21" align="right">Comment 21</div>

I'd like to see some more thought go into what use cases are best served by UniqueRepresentation and what by UniqueFactory.  But the code is well documented, does what it claims to do, and UniqueRepresentation is easier to use than UniqueFactory.  So positive review.



---

archive/issue_events_053449.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2009-05-19T07:57:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53449"
}
```



---

archive/issue_comments_032454.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nMerged in Sage 4.0.rc0.\n\nCheers,\n\nMichael",
    "created_at": "2009-05-21T00:59:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5120#issuecomment-32454",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:22" align="right">Comment 22</div>

Merged in Sage 4.0.rc0.

Cheers,

Michael



---

archive/issue_events_053450.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-05-21T00:59:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53450"
}
```



---

archive/issue_events_053451.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-05-21T00:59:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53451"
}
```



---

archive/issue_events_053452.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-05-21T00:59:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "milestone_number": null,
    "milestone_title": "sage-4.0.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53452"
}
```



---

archive/issue_events_053453.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2009-05-21T00:59:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5120",
    "milestone_number": null,
    "milestone_title": "sage-4.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5120#event-53453"
}
```
