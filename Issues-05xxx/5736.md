# Issue 5736: Improve doctest coverage for sage/modular/hecke

archive/issues_005736.json:
```json
{
    "body": "This patch adds many new doctests (mainly in sage/modular/hecke); adds new sections to the reference manual for the modules abvar.abvar_newform, abvar.morphism, abvar.lseries, ssmod.ssmod, and quatalg.brandt; and fixes several small bugs discovered in the process.\n\n**Assignee:** @loefflerd\n\n**Resolution:** fixed\n\n**Author:** David Loeffler\n\n**Reviewer:** William Stein\n\n**Merged:** 4.0.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/5736\n\n",
    "closed_at": "2009-05-04T17:57:43Z",
    "created_at": "2009-04-10T19:43:47Z",
    "labels": [
        "component: modular forms",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.0",
    "title": "Improve doctest coverage for sage/modular/hecke",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/5736",
    "user": "https://github.com/loefflerd"
}
```
This patch adds many new doctests (mainly in sage/modular/hecke); adds new sections to the reference manual for the modules abvar.abvar_newform, abvar.morphism, abvar.lseries, ssmod.ssmod, and quatalg.brandt; and fixes several small bugs discovered in the process.

**Assignee:** @loefflerd

**Resolution:** fixed

**Author:** David Loeffler

**Reviewer:** William Stein

**Merged:** 4.0.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/5736





---

archive/issue_comments_053978.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis patch does cause one doctest failure:\n\n```\nmabshoff@sage:/scratch/mabshoff/sage-3.4.1.rc2$ ./sage -t -long devel/sage/sage/tests/book_stein_modform.py\nsage -t -long \"devel/sage/sage/tests/book_stein_modform.py\" \n**********************************************************************\nFile \"/scratch/mabshoff/sage-3.4.1.rc2/devel/sage/sage/tests/book_stein_modform.py\", line 205:\n    : M.boundary_map()\nExpected:\n    Hecke module morphism boundary map defined by the matrix\n    [ 1 -1]\n    Domain: Modular Symbols space of dimension 1 for\n    Gamma_0(2) of weight ...\n    Codomain: Space of Boundary Modular Symbols for\n    Congruence Subgroup Gamma0(2) ...\nGot:\n    Hecke module morphism boundary map defined by the matrix\n    [ 1 -1]\n    Domain: 'Modular Symbols space of dimension 1 for Gamma_0(2) of weight ...'\n    Codomain: 'Space of Boundary Modular Symbols for Congruence Subgroup Gamma0(2) ...'\n**********************************************************************\n```\nI am not sure why the `'` was added in the first place, but it seems to be non-standard in Sage to add the quotes.\n\nWilliam might have the definite POV on this issue :)\n\nCheers,\n\nMichael",
    "created_at": "2009-04-10T23:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53978",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:1'></a>
This patch does cause one doctest failure:

```
mabshoff@sage:/scratch/mabshoff/sage-3.4.1.rc2$ ./sage -t -long devel/sage/sage/tests/book_stein_modform.py
sage -t -long "devel/sage/sage/tests/book_stein_modform.py" 
**********************************************************************
File "/scratch/mabshoff/sage-3.4.1.rc2/devel/sage/sage/tests/book_stein_modform.py", line 205:
    : M.boundary_map()
Expected:
    Hecke module morphism boundary map defined by the matrix
    [ 1 -1]
    Domain: Modular Symbols space of dimension 1 for
    Gamma_0(2) of weight ...
    Codomain: Space of Boundary Modular Symbols for
    Congruence Subgroup Gamma0(2) ...
Got:
    Hecke module morphism boundary map defined by the matrix
    [ 1 -1]
    Domain: 'Modular Symbols space of dimension 1 for Gamma_0(2) of weight ...'
    Codomain: 'Space of Boundary Modular Symbols for Congruence Subgroup Gamma0(2) ...'
**********************************************************************
```
I am not sure why the `'` was added in the first place, but it seems to be non-standard in Sage to add the quotes.

William might have the definite POV on this issue :)

Cheers,

Michael



---

archive/issue_comments_053979.json:
```json
{
    "body": "**Changing status** from new to needs_work.",
    "created_at": "2009-04-10T23:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53979",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing status** from new to needs_work.



---

archive/issue_comments_053980.json:
```json
{
    "body": "<a id='comment:2'></a>\nOops. Mea culpa. The quotes were added because I was trying to hunt down some funny behaviour in a doctest which I suspected was because the output of the doctest ended in \"...\", which I suspected conflicted with the use of ... as an abbreviation in example docstring output. It turned out to be something completely different causing the problems, but I forgot to take the quotes out again.\n\nHere is a new patch, without the quotes (and with one small additional change: the tests in bordeaux_2008/generators_for_rings now work, as a consequence of the work I did on find_generators.py, so I've removed the ..skip:: directives in that file.)",
    "created_at": "2009-04-13T09:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53980",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:2'></a>
Oops. Mea culpa. The quotes were added because I was trying to hunt down some funny behaviour in a doctest which I suspected was because the output of the doctest ended in "...", which I suspected conflicted with the use of ... as an abbreviation in example docstring output. It turned out to be something completely different causing the problems, but I forgot to take the quotes out again.

Here is a new patch, without the quotes (and with one small additional change: the tests in bordeaux_2008/generators_for_rings now work, as a consequence of the work I did on find_generators.py, so I've removed the ..skip:: directives in that file.)



---

archive/issue_comments_053981.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2009-04-13T09:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53981",
    "user": "https://github.com/loefflerd"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_053982.json:
```json
{
    "body": "**Changing status** from new to assigned.",
    "created_at": "2009-04-13T09:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53982",
    "user": "https://github.com/loefflerd"
}
```

**Changing status** from new to assigned.



---

archive/issue_comments_053983.json:
```json
{
    "body": "<a id='comment:3'></a>\nREFEREE REPORT:\n\n1. Where you have\n\n```\n \t623\t        elif self.__ambient != other.__ambient: \n \t624\t            return cmp(self.__ambient, other.__ambient)\n```\nI would typically write\n\n```\nc = cmp(self.__ambient, other.__ambient)\nif c: return c\n```\nsince that entails only one comparison instead of 2.\n\n2. This code makes me nervous\n\n```\n \t86\t                    verbose(\"Trying to copy over precomputed matrix...\") \n \t87\t                    y._HeckeOperator__matrix = x._HeckeOperator__matrix \n \t88\t                    verbose(\"...Succeeded\") \n```\nOne worry is that the basis might be different.   I think there is nothing a priori to guarantee that the basis are the same for two generic Hecke modules that compare as equal, so one should check not only that the parents are equal but that they have the same basis.  Second, why use the hidden _HeckeOperator__matrix attribute?  Could you just use the .matrix() method (assuming there is one)?  A similar comment also applies about basis in the next elif.\n\n3. In hecke_operator.py there is a spurious period in line 55 of your patch:\n\n```\n \t54\t    Return True if x is of type HeckeAlgebraElement. \n \t55\t    . \n \t56\t    EXAMPLES:: \n```\n\n4. In hecke_operator.py, there is a TypeError, which should be a RuntimeError:\n\n```\n        455\t            else: \n \t456\t                raise TypeError, \"Bug in coercion code\" # can't get here. \n```\nIt should be RuntimeError, since it's reporting a bug, so shouldn't just silently get absorbed by the coercion models exception catching.\n\n5. Here, I wonder if we could remove the 5x5 constraint, since now matrices have their own (I think 20x20) cutoff for printing:\n\n```\n347\t459\t    def _repr_(self): \n \t460\t        r\"\"\" \n \t461\t        String representation of self. The matrix is not printed if the number \n \t462\t        of rows or columns is > 5.  \n \t463\t \n \t464\t        EXAMPLES:: \n \t465\t \n \t466\t            sage: M = ModularSymbols(1,12) \n \t467\t            sage: M.hecke_operator(2).matrix_form()._repr_() \n \t468\t            'Hecke operator on Modular Symbols space of dimension 3 for Gamma_0(1) of weight 12 with sign 0 over Rational Field defined by:\\n[ -24    0    0]\\n[   0  -24    0]\\n[4860    0 2049]' \n \t469\t        \"\"\" \n348\t470\t        if max(self.__matrix.nrows(),self.__matrix.ncols()) > 5: \n349\t471\t            mat = \"(not printing %s x %s matrix)\"%(self.__matrix.nrows(), self.__matrix.ncols()) \n```\n\n6. I guess this should be RuntimeError too?\n\n```\n \t578\t            else: \n \t579\t                raise TypeError, \"Bug in coercion code\" # can't get here \n```\n\n7. A doctest for the __hash__() method is *wrong*:\n\n```\n340\t514\t    def __hash__(self): \n341\t \t        return hash((self.__weight, self.level(), self.base_ring(), str(self))) \n \t515\t        r\"\"\" \n \t516\t        Return a hash of self.  \n \t517\t \n \t518\t        EXAMPLES:: \n \t519\t             \n \t520\t            sage: ModularSymbols(22).__hash__ # random \n \t521\t        \"\"\" \n \t522\t        return hash((self.__weight, self.level(), self.base_ring())) \n```\n\nNote above you just print the function, not its value. Replace by `.__hash__()`\n\nMany thanks for doing such an amazing job documented all this code!!",
    "created_at": "2009-04-13T14:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53983",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:3'></a>
REFEREE REPORT:

1. Where you have

```
 	623	        elif self.__ambient != other.__ambient: 
 	624	            return cmp(self.__ambient, other.__ambient)
```
I would typically write

```
c = cmp(self.__ambient, other.__ambient)
if c: return c
```
since that entails only one comparison instead of 2.

2. This code makes me nervous

```
 	86	                    verbose("Trying to copy over precomputed matrix...") 
 	87	                    y._HeckeOperator__matrix = x._HeckeOperator__matrix 
 	88	                    verbose("...Succeeded") 
```
One worry is that the basis might be different.   I think there is nothing a priori to guarantee that the basis are the same for two generic Hecke modules that compare as equal, so one should check not only that the parents are equal but that they have the same basis.  Second, why use the hidden _HeckeOperator__matrix attribute?  Could you just use the .matrix() method (assuming there is one)?  A similar comment also applies about basis in the next elif.

3. In hecke_operator.py there is a spurious period in line 55 of your patch:

```
 	54	    Return True if x is of type HeckeAlgebraElement. 
 	55	    . 
 	56	    EXAMPLES:: 
```

4. In hecke_operator.py, there is a TypeError, which should be a RuntimeError:

```
        455	            else: 
 	456	                raise TypeError, "Bug in coercion code" # can't get here. 
```
It should be RuntimeError, since it's reporting a bug, so shouldn't just silently get absorbed by the coercion models exception catching.

5. Here, I wonder if we could remove the 5x5 constraint, since now matrices have their own (I think 20x20) cutoff for printing:

```
347	459	    def _repr_(self): 
 	460	        r""" 
 	461	        String representation of self. The matrix is not printed if the number 
 	462	        of rows or columns is > 5.  
 	463	 
 	464	        EXAMPLES:: 
 	465	 
 	466	            sage: M = ModularSymbols(1,12) 
 	467	            sage: M.hecke_operator(2).matrix_form()._repr_() 
 	468	            'Hecke operator on Modular Symbols space of dimension 3 for Gamma_0(1) of weight 12 with sign 0 over Rational Field defined by:\n[ -24    0    0]\n[   0  -24    0]\n[4860    0 2049]' 
 	469	        """ 
348	470	        if max(self.__matrix.nrows(),self.__matrix.ncols()) > 5: 
349	471	            mat = "(not printing %s x %s matrix)"%(self.__matrix.nrows(), self.__matrix.ncols()) 
```

6. I guess this should be RuntimeError too?

```
 	578	            else: 
 	579	                raise TypeError, "Bug in coercion code" # can't get here 
```

7. A doctest for the __hash__() method is *wrong*:

```
340	514	    def __hash__(self): 
341	 	        return hash((self.__weight, self.level(), self.base_ring(), str(self))) 
 	515	        r""" 
 	516	        Return a hash of self.  
 	517	 
 	518	        EXAMPLES:: 
 	519	             
 	520	            sage: ModularSymbols(22).__hash__ # random 
 	521	        """ 
 	522	        return hash((self.__weight, self.level(), self.base_ring())) 
```

Note above you just print the function, not its value. Replace by `.__hash__()`

Many thanks for doing such an amazing job documented all this code!!



---

archive/issue_comments_053984.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2009-04-13T14:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53984",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_053985.json:
```json
{
    "body": "<a id='comment:4'></a>\nWhat would you suggest for your point number 2 above? The scenario I had in mind was that one might be somehow using \"loads\" to read in a Hecke operator that had been precomputed at great expense, and it would make sense to avoid recomputing all that data when comparing it with / adding it to / whatever something else that had been computed afresh. E.g. in one session\n\n```\nsage: H = ModularForms(Gamma0(10), 12).hecke_operator(123456789)\nsage: H.matrix() # very long!\nsage: save(H, \"./bigheckeop.sobj\")\n```\n(let's assume this would actually terminate in some reasonable time)\nand later\n\n```\nsage: H = load(\"./bigheckeop.sobj\")\nsage: ModularForms(Gamma0(10), 12).hecke_operator(6) + H\n```\n\nAt present this will raise a RuntimeError, which is clearly bad. But doing the computation of the enormous Hecke operator's matrix again from scratch isn't ideal either. \n\nChecking that the bases are \"the same\" is a bit of a problem because what we really need to do is to check that the basis vectors have the same interpretation as a mathematical objects, rather than just that they're the same ones and zeros in memory. E.g. we might have changed the order in which modular symbol basis vectors were enumerated between versions, and then the second basis vector would still be (0,1,0,..), but it would correspond to a different mathematical object.\n\nIt's not a very likely use case, I suppose, so maybe it is safer just to force the recomputation. Let me know what you think, and I'll do a new patch.",
    "created_at": "2009-04-13T15:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53985",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:4'></a>
What would you suggest for your point number 2 above? The scenario I had in mind was that one might be somehow using "loads" to read in a Hecke operator that had been precomputed at great expense, and it would make sense to avoid recomputing all that data when comparing it with / adding it to / whatever something else that had been computed afresh. E.g. in one session

```
sage: H = ModularForms(Gamma0(10), 12).hecke_operator(123456789)
sage: H.matrix() # very long!
sage: save(H, "./bigheckeop.sobj")
```
(let's assume this would actually terminate in some reasonable time)
and later

```
sage: H = load("./bigheckeop.sobj")
sage: ModularForms(Gamma0(10), 12).hecke_operator(6) + H
```

At present this will raise a RuntimeError, which is clearly bad. But doing the computation of the enormous Hecke operator's matrix again from scratch isn't ideal either. 

Checking that the bases are "the same" is a bit of a problem because what we really need to do is to check that the basis vectors have the same interpretation as a mathematical objects, rather than just that they're the same ones and zeros in memory. E.g. we might have changed the order in which modular symbol basis vectors were enumerated between versions, and then the second basis vector would still be (0,1,0,..), but it would correspond to a different mathematical object.

It's not a very likely use case, I suppose, so maybe it is safer just to force the recomputation. Let me know what you think, and I'll do a new patch.



---

archive/issue_comments_053986.json:
```json
{
    "body": "<a id='comment:5'></a>\n> It's not a very likely use case, I suppose, so maybe it is safer \n> just to force the recomputation. Let me know what you think, and I'll do a new patch. \n\n\nYou have some good points.  The safest thing I can think of that also \"solves\" your problem (at least for a sufficiently diligent user!), would be to provide the option to set the n-th Hecke operator from a known matrix.   Something like\n\n```\nsage: M = ModularForms(Gamma0(10), 12)\nsage: M.unsafe_set_hecke_matrix(123456789, mat)\nsage: M.hecke_operator(123456789).matrix()\n# instant\n```\nThe documentation for the function would make the issues with bases clear.\n\nThis should be done as part of another patch, imho.   It could be useful in a lot of contexts, where for some reason one knows what the n-th hecke matrix is much more efficiently than Sage does, but doesn't want to dive into the guts of Sage's modular forms and code why one has this extra knowledge.",
    "created_at": "2009-04-13T18:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53986",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:5'></a>
> It's not a very likely use case, I suppose, so maybe it is safer 
> just to force the recomputation. Let me know what you think, and I'll do a new patch. 


You have some good points.  The safest thing I can think of that also "solves" your problem (at least for a sufficiently diligent user!), would be to provide the option to set the n-th Hecke operator from a known matrix.   Something like

```
sage: M = ModularForms(Gamma0(10), 12)
sage: M.unsafe_set_hecke_matrix(123456789, mat)
sage: M.hecke_operator(123456789).matrix()
# instant
```
The documentation for the function would make the issues with bases clear.

This should be done as part of another patch, imho.   It could be useful in a lot of contexts, where for some reason one knows what the n-th hecke matrix is much more efficiently than Sage does, but doesn't want to dive into the guts of Sage's modular forms and code why one has this extra knowledge.



---

archive/issue_comments_053987.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [was](#comment%3A3):\n> One worry is that the basis might be different.   I think there is nothing a priori to guarantee that the basis are the same for two generic Hecke modules that compare as equal, so one should check not only that the parents are equal but that they have the same basis.  Second, why use the hidden _HeckeOperator!__matrix attribute?  Could you just use the .matrix() method (assuming there is one)?  A similar comment also applies about basis in the next elif.\n\n\nInvestigation revealed several bugs related to this. If you create two submodules of the same ambient module which are equal as submodules but with different bases, then (since they compare as equal) the factory function caching machinery will return the same object as the Hecke algebra of both of them, despite the fact that this will be using the wrong basis matrix for one of them.\n\nI have fixed this, so the Hecke operators on submodules with custom bases are calculated correctly; and I've made it so the !__call!__ method of Hecke algebra objects, if asked to convert in a Hecke operator on a submodule that is equal to its own, will check that the basis matrices are the same, and if they're not it will apply the appropriate transformation. There is a long doctest in sage.modular.hecke.algebra.!__call!__ which checks that this is all OK.\n\nThe patch trac_5736-fixes.patch fixes this issue and the other issues 1-7 that you raised above.\n\nDavid",
    "created_at": "2009-04-14T10:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53987",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:6'></a>
Replying to [was](#comment%3A3):
> One worry is that the basis might be different.   I think there is nothing a priori to guarantee that the basis are the same for two generic Hecke modules that compare as equal, so one should check not only that the parents are equal but that they have the same basis.  Second, why use the hidden _HeckeOperator!__matrix attribute?  Could you just use the .matrix() method (assuming there is one)?  A similar comment also applies about basis in the next elif.


Investigation revealed several bugs related to this. If you create two submodules of the same ambient module which are equal as submodules but with different bases, then (since they compare as equal) the factory function caching machinery will return the same object as the Hecke algebra of both of them, despite the fact that this will be using the wrong basis matrix for one of them.

I have fixed this, so the Hecke operators on submodules with custom bases are calculated correctly; and I've made it so the !__call!__ method of Hecke algebra objects, if asked to convert in a Hecke operator on a submodule that is equal to its own, will check that the basis matrices are the same, and if they're not it will apply the appropriate transformation. There is a long doctest in sage.modular.hecke.algebra.!__call!__ which checks that this is all OK.

The patch trac_5736-fixes.patch fixes this issue and the other issues 1-7 that you raised above.

David



---

archive/issue_comments_053988.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2009-04-14T10:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53988",
    "user": "https://github.com/loefflerd"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_053989.json:
```json
{
    "body": "<a id='comment:8'></a>\nHold it, I accidentally introduced a bug (the doctests for supersingular modules fail).",
    "created_at": "2009-04-14T13:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53989",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:8'></a>
Hold it, I accidentally introduced a bug (the doctests for supersingular modules fail).



---

archive/issue_comments_053990.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2009-04-14T13:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53990",
    "user": "https://github.com/loefflerd"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_053991.json:
```json
{
    "body": "<a id='comment:9'></a>\nTurns out that the doctests fail as a knock-on effect of #4306: the basis_matrix method fails for SupersingularModules, and the changes I made to the HeckeAlgebra factory function exposed that. The tiny patch trac_5736-3.patch adds a workaround.",
    "created_at": "2009-04-14T14:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53991",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:9'></a>
Turns out that the doctests fail as a knock-on effect of #4306: the basis_matrix method fails for SupersingularModules, and the changes I made to the HeckeAlgebra factory function exposed that. The tiny patch trac_5736-3.patch adds a workaround.



---

archive/issue_comments_053992.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2009-04-14T14:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53992",
    "user": "https://github.com/loefflerd"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_053993.json:
```json
{
    "body": "Attachment [trac_5736-rebase.patch](tarball://root/attachments/some-uuid/ticket5736/trac_5736-rebase.patch) by @loefflerd created at 2009-04-26 09:07:56\n\nreplaces all previous patches, rebased to 3.4.2.alpha0",
    "created_at": "2009-04-26T09:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53993",
    "user": "https://github.com/loefflerd"
}
```

Attachment [trac_5736-rebase.patch](tarball://root/attachments/some-uuid/ticket5736/trac_5736-rebase.patch) by @loefflerd created at 2009-04-26 09:07:56

replaces all previous patches, rebased to 3.4.2.alpha0



---

archive/issue_comments_053994.json:
```json
{
    "body": "<a id='comment:10'></a>\nI have added a new patch that is equivalent to the three patches above combined, rebased to apply over 3.4.2.alpha0. (Isn't the Mercurial Queues add-on wonderful?)",
    "created_at": "2009-04-26T09:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53994",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:10'></a>
I have added a new patch that is equivalent to the three patches above combined, rebased to apply over 3.4.2.alpha0. (Isn't the Mercurial Queues add-on wonderful?)



---

archive/issue_comments_053995.json:
```json
{
    "body": "<a id='comment:11'></a>\nI applied this to 3.4.2.alpha0, and did \"make ptestlong\":\n\n```\nsage -t -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\n\t [181.8 s]\n \n----------------------------------------------------------------------\n\nThe following tests failed:\n\n\tsage -t -long devel/sage/sage/modular/modform/space.py # 2 doctests failed\n\tsage -t -long devel/sage/sage/modular/hecke/hecke_operator.py # 8 doctests failed\n\tsage -t -long devel/sage/sage/modular/hecke/algebra.py # 1 doctests failed\n\tsage -t -long devel/sage/sage/modular/hecke/module.py # 14 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 387.7 seconds\nwstein@sage:~/build/sage-3.4.2.alpha0$ \n```",
    "created_at": "2009-04-26T15:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53995",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:11'></a>
I applied this to 3.4.2.alpha0, and did "make ptestlong":

```
sage -t -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py
	 [181.8 s]
 
----------------------------------------------------------------------

The following tests failed:

	sage -t -long devel/sage/sage/modular/modform/space.py # 2 doctests failed
	sage -t -long devel/sage/sage/modular/hecke/hecke_operator.py # 8 doctests failed
	sage -t -long devel/sage/sage/modular/hecke/algebra.py # 1 doctests failed
	sage -t -long devel/sage/sage/modular/hecke/module.py # 14 doctests failed
----------------------------------------------------------------------
Total time for all tests: 387.7 seconds
wstein@sage:~/build/sage-3.4.2.alpha0$ 
```



---

archive/issue_comments_053996.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2009-04-26T15:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53996",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_053997.json:
```json
{
    "body": "<a id='comment:13'></a>\nI am unable to replicate these failures: it works fine for me both on my laptop (32-bit Linux) and on sage.math.washington.edu. Which system are you using? Could you tell me exactly which doctests are failing, and how?",
    "created_at": "2009-04-27T09:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53997",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:13'></a>
I am unable to replicate these failures: it works fine for me both on my laptop (32-bit Linux) and on sage.math.washington.edu. Which system are you using? Could you tell me exactly which doctests are failing, and how?



---

archive/issue_comments_053998.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-This patch adds many new doctests (mainly in sage/modular/hecke) and adds Brandt modules to the reference manual.\n+This patch adds many new doctests (mainly in sage/modular/hecke); adds new sections to the reference manual for the modules abvar.abvar_newform, abvar.morphism, abvar.lseries, ssmod.ssmod, and quatalg.brandt; and fixes several small bugs discovered in the process.\n``````\n",
    "created_at": "2009-04-30T10:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53998",
    "user": "https://github.com/loefflerd"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-This patch adds many new doctests (mainly in sage/modular/hecke) and adds Brandt modules to the reference manual.
+This patch adds many new doctests (mainly in sage/modular/hecke); adds new sections to the reference manual for the modules abvar.abvar_newform, abvar.morphism, abvar.lseries, ssmod.ssmod, and quatalg.brandt; and fixes several small bugs discovered in the process.
``````




---

archive/issue_comments_053999.json:
```json
{
    "body": "<a id='comment:14'></a>\nWilliam: any movement on this? It would be nice to get this into 4.0 at least (we seem to have missed the 3.4.2 deadline now), but I can't fix the problems you're having if I don't know what's broken. It works for me on 64-bit and 32-bit Linux so I'm guessing you're using a Mac, but I don't have access to a Mac for testing. \n\n(I have several other modular forms fixes + improvements ready that are dependent on this one.)",
    "created_at": "2009-04-30T10:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-53999",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:14'></a>
William: any movement on this? It would be nice to get this into 4.0 at least (we seem to have missed the 3.4.2 deadline now), but I can't fix the problems you're having if I don't know what's broken. It works for me on 64-bit and 32-bit Linux so I'm guessing you're using a Mac, but I don't have access to a Mac for testing. 

(I have several other modular forms fixes + improvements ready that are dependent on this one.)



---

archive/issue_comments_054000.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2009-04-30T21:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54000",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_054001.json:
```json
{
    "body": "<a id='comment:15'></a>\nI applied trac_5736-rebase.patch to 3.4.2.rc0 on sage.math and long doctests pass.\n\nWilliam: Any chances you had crap in your tree unrelated to this patch? While it is too late for 3.4.2 this patch raises coverage by 0.2% [aside from all the nice bug fixes :)], so it really ought to go into 4.0.\n\nChanging to \"needs review\" again.\n\nCheers,\n\nMichael",
    "created_at": "2009-04-30T21:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54001",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:15'></a>
I applied trac_5736-rebase.patch to 3.4.2.rc0 on sage.math and long doctests pass.

William: Any chances you had crap in your tree unrelated to this patch? While it is too late for 3.4.2 this patch raises coverage by 0.2% [aside from all the nice bug fixes :)], so it really ought to go into 4.0.

Changing to "needs review" again.

Cheers,

Michael



---

archive/issue_comments_054002.json:
```json
{
    "body": "<a id='comment:16'></a>\nHmm, skimming the patch:\n\n```\n \t519\t        EXAMPLES:: \n \t520\t             \n \t521\t            sage: ModularSymbols(22).__hash__() # random \n \t522\t            1471905187 \n```\nWhy on earth would the hash be random (there are two cases in the patch)? I assume there are 32 vs. 64 bit issues (which can be properly dealt with), but a hash should certainly not be random.\n\nCheers,\n\nMichael",
    "created_at": "2009-04-30T22:13:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54002",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:16'></a>
Hmm, skimming the patch:

```
 	519	        EXAMPLES:: 
 	520	             
 	521	            sage: ModularSymbols(22).__hash__() # random 
 	522	            1471905187 
```
Why on earth would the hash be random (there are two cases in the patch)? I assume there are 32 vs. 64 bit issues (which can be properly dealt with), but a hash should certainly not be random.

Cheers,

Michael



---

archive/issue_comments_054003.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2009-04-30T22:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54003",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_054004.json:
```json
{
    "body": "<a id='comment:17'></a>\nChanging back to \"needs work\" for the hashing issue. Just grep the Sage library tree for either `32-bit` or `64-bit` to see how to create 32 and 64 bit specific output.\n\nCheers,\n\nMichael",
    "created_at": "2009-04-30T22:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54004",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:17'></a>
Changing back to "needs work" for the hashing issue. Just grep the Sage library tree for either `32-bit` or `64-bit` to see how to create 32 and 64 bit specific output.

Cheers,

Michael



---

archive/issue_comments_054005.json:
```json
{
    "body": "<a id='comment:18'></a>\nAnother thing: This is wrong since the current LaTeX framework that will be in 3.4.2 uses macros like `\\QQ` to make the output customizable:\n\n```\n1158\t \t        NOTE: The base ring must be `\\QQ` or `\\ZZ`. \n \t1187\t        NOTE: The base ring must be `mathbb{Q}` or `mathbb{Z}`. \n```\n\nCheers,\n\nMichael",
    "created_at": "2009-04-30T22:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54005",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:18'></a>
Another thing: This is wrong since the current LaTeX framework that will be in 3.4.2 uses macros like `\QQ` to make the output customizable:

```
1158	 	        NOTE: The base ring must be `\QQ` or `\ZZ`. 
 	1187	        NOTE: The base ring must be `mathbb{Q}` or `mathbb{Z}`. 
```

Cheers,

Michael



---

archive/issue_comments_054006.json:
```json
{
    "body": "Attachment [trac_5736-more.patch](tarball://root/attachments/some-uuid/ticket5736/trac_5736-more.patch) by @loefflerd created at 2009-04-30 22:49:54\n\napply over previous patch",
    "created_at": "2009-04-30T22:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54006",
    "user": "https://github.com/loefflerd"
}
```

Attachment [trac_5736-more.patch](tarball://root/attachments/some-uuid/ticket5736/trac_5736-more.patch) by @loefflerd created at 2009-04-30 22:49:54

apply over previous patch



---

archive/issue_comments_054007.json:
```json
{
    "body": "<a id='comment:19'></a>\nHere's a tiny patch that addresses the two issues raised by mabshoff.",
    "created_at": "2009-04-30T22:50:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54007",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:19'></a>
Here's a tiny patch that addresses the two issues raised by mabshoff.



---

archive/issue_comments_054008.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2009-04-30T22:50:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54008",
    "user": "https://github.com/loefflerd"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_054009.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2009-05-03T21:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54009",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_054010.json:
```json
{
    "body": "<a id='comment:20'></a>\nI applied both patches to a clean 3.4.2.rc0 install and got:\n\n```\nmake ptestlong\n\n...\n\nThe following tests failed:\n\n        sage -t -long devel/sage/sage/modular/modsym/ambient.py # 4 doctests failed\n        sage -t -long devel/sage/sage/tests/book_stein_modform.py # 3 doctests failed\n        sage -t -long devel/sage/sage/modular/modsym/manin_symbols.py # 1 doctests failed\n        sage -t -long devel/sage/doc/en/bordeaux_2008/modular_symbols.rst # 1 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 312.6 seconds\nwstein@sage:~/build/sage-3.4.2.rc0$ \n```",
    "created_at": "2009-05-03T21:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54010",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:20'></a>
I applied both patches to a clean 3.4.2.rc0 install and got:

```
make ptestlong

...

The following tests failed:

        sage -t -long devel/sage/sage/modular/modsym/ambient.py # 4 doctests failed
        sage -t -long devel/sage/sage/tests/book_stein_modform.py # 3 doctests failed
        sage -t -long devel/sage/sage/modular/modsym/manin_symbols.py # 1 doctests failed
        sage -t -long devel/sage/doc/en/bordeaux_2008/modular_symbols.rst # 1 doctests failed
----------------------------------------------------------------------
Total time for all tests: 312.6 seconds
wstein@sage:~/build/sage-3.4.2.rc0$ 
```



---

archive/issue_comments_054011.json:
```json
{
    "body": "<a id='comment:21'></a>\nOk, I was surprised this patch did break things again, but there are two issues here:\n\nAn extra space has been inserted when printing the basis, for example:\n\n```\nFile \"/scratch/wstein/build/sage-3.4.2.rc0/devel/sage-0/sage/tests/book_stein_modform.py\", line 70:\n    : M.basis()\nExpected:\n    ({Infinity,0}, {-1/8,0}, {-1/9,0})\nGot:\n    ({Infinity, 0}, {-1/8, 0}, {-1/9, 0})\n```\nIn addition the printing order for modular_symbol_rep() is reversed:\n\n```\nage -t -long devel/sage/doc/en/bordeaux_2008/modular_symbols.rst\n**********************************************************************\nFile \"/scratch/wstein/build/sage-3.4.2.rc0/devel/sage-0/doc/en/bordeaux_2008/modular_symbols.rst\", line 124:\n    sage: a.modular_symbol_rep()\nExpected:\n    36*X^2*{-1/6,0} + 12*X*Y*{-1/6,0} + Y^2*{-1/6,0}\nGot:\n    Y^2*{-1/6, 0} + 12*X*Y*{-1/6, 0} + 36*X^2*{-1/6, 0}\n**********************************************************************\n```\n\nSo all those four doctests are simple to fix.\n\nCheers,\n\nMichael",
    "created_at": "2009-05-04T00:59:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54011",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:21'></a>
Ok, I was surprised this patch did break things again, but there are two issues here:

An extra space has been inserted when printing the basis, for example:

```
File "/scratch/wstein/build/sage-3.4.2.rc0/devel/sage-0/sage/tests/book_stein_modform.py", line 70:
    : M.basis()
Expected:
    ({Infinity,0}, {-1/8,0}, {-1/9,0})
Got:
    ({Infinity, 0}, {-1/8, 0}, {-1/9, 0})
```
In addition the printing order for modular_symbol_rep() is reversed:

```
age -t -long devel/sage/doc/en/bordeaux_2008/modular_symbols.rst
**********************************************************************
File "/scratch/wstein/build/sage-3.4.2.rc0/devel/sage-0/doc/en/bordeaux_2008/modular_symbols.rst", line 124:
    sage: a.modular_symbol_rep()
Expected:
    36*X^2*{-1/6,0} + 12*X*Y*{-1/6,0} + Y^2*{-1/6,0}
Got:
    Y^2*{-1/6, 0} + 12*X*Y*{-1/6, 0} + 36*X^2*{-1/6, 0}
**********************************************************************
```

So all those four doctests are simple to fix.

Cheers,

Michael



---

archive/issue_comments_054012.json:
```json
{
    "body": "<a id='comment:22'></a>\nNow the truly puzzling thing is this: \n\n* The above failures are in William's tree on sage.math - I ran them there.\n* When I take those two patches and import them into my clean 3.4.2.rc0 tree in /scratch on sage.math all doctests passs. \n\nWilliam's testing tree seems to be a clone from a tree that has the following patches in sage-main:\n\n```\nchangeset:   12151:e0257aa492ab\ntag:         tip\nuser:        William Stein <wstein@gmail.com>\ndate:        Sat May 02 22:56:24 2009 -0700\nsummary:     trac #5968 -- part 2 -- increase doctest coverage of sage/modular/modsym/modular_symbols.py from 0% to 100%\n\nchangeset:   12150:673cc9b82a7d\nuser:        William Stein <wstein@gmail.com>\ndate:        Sat May 02 22:46:52 2009 -0700\nsummary:     trac 5968 -- increase doctest coverage of sage/modular/modsym/modular_symbols.py from 0% to 100%\n\nchangeset:   12149:901f4946fd7e\nuser:        William Stein <wstein@gmail.com>\ndate:        Sat May 02 02:15:34 2009 -0700\nsummary:     trac #5882 -- part 4 -- mop up some issues with overzealous changes to matrix_morphism.\n\nchangeset:   12148:312499531bcb\nuser:        William Stein <wstein@gmail.com>\ndate:        Sat May 02 01:31:38 2009 -0700\nsummary:     trac #5882 -- part 3 of \"implement general package for finitely generated not-necessarily free R-modules\"\n\nchangeset:   12147:82b9ade5605a\nuser:        William Stein <wstein@gmail.com>\ndate:        Sat May 02 01:48:24 2009 -0700\nsummary:     trac #5882 (part 2) -- implement general package for finitely generated not-necessarily free R-modules\n\nchangeset:   12146:6023d9680d5e\nuser:        William Stein <wstein@gmail.com>\ndate:        Thu Apr 30 13:30:21 2009 -0700\nsummary:     trac #5882 -- part 1 of implementation of finitely generated modules over a PID\n\nchangeset:   12145:9ee83eda286e\nuser:        William Stein <wstein@gmail.com>\ndate:        Sat May 02 01:38:52 2009 -0700\nsummary:     trac #5887 -- major bugs in morphisms of R-modules (rebased against 3.4.2.rc0)\n```\nSo I assume that his build directory contains crap from those patches that cause these failures that a `sage -b` does not fix since there are no dependencies when cloning from the rc0 revision. A `sage -ba` while using the sage-0 clone would clear this up, but since this isn't my tree I will not do so :)\n\nIn the end this patch should be reviewed on a truly clean tree, so I am changing this patch to \"needs review\". \n\nThoughts?\n\nCheers,\n\nMichael",
    "created_at": "2009-05-04T01:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54012",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:22'></a>
Now the truly puzzling thing is this: 

* The above failures are in William's tree on sage.math - I ran them there.
* When I take those two patches and import them into my clean 3.4.2.rc0 tree in /scratch on sage.math all doctests passs. 

William's testing tree seems to be a clone from a tree that has the following patches in sage-main:

```
changeset:   12151:e0257aa492ab
tag:         tip
user:        William Stein <wstein@gmail.com>
date:        Sat May 02 22:56:24 2009 -0700
summary:     trac #5968 -- part 2 -- increase doctest coverage of sage/modular/modsym/modular_symbols.py from 0% to 100%

changeset:   12150:673cc9b82a7d
user:        William Stein <wstein@gmail.com>
date:        Sat May 02 22:46:52 2009 -0700
summary:     trac 5968 -- increase doctest coverage of sage/modular/modsym/modular_symbols.py from 0% to 100%

changeset:   12149:901f4946fd7e
user:        William Stein <wstein@gmail.com>
date:        Sat May 02 02:15:34 2009 -0700
summary:     trac #5882 -- part 4 -- mop up some issues with overzealous changes to matrix_morphism.

changeset:   12148:312499531bcb
user:        William Stein <wstein@gmail.com>
date:        Sat May 02 01:31:38 2009 -0700
summary:     trac #5882 -- part 3 of "implement general package for finitely generated not-necessarily free R-modules"

changeset:   12147:82b9ade5605a
user:        William Stein <wstein@gmail.com>
date:        Sat May 02 01:48:24 2009 -0700
summary:     trac #5882 (part 2) -- implement general package for finitely generated not-necessarily free R-modules

changeset:   12146:6023d9680d5e
user:        William Stein <wstein@gmail.com>
date:        Thu Apr 30 13:30:21 2009 -0700
summary:     trac #5882 -- part 1 of implementation of finitely generated modules over a PID

changeset:   12145:9ee83eda286e
user:        William Stein <wstein@gmail.com>
date:        Sat May 02 01:38:52 2009 -0700
summary:     trac #5887 -- major bugs in morphisms of R-modules (rebased against 3.4.2.rc0)
```
So I assume that his build directory contains crap from those patches that cause these failures that a `sage -b` does not fix since there are no dependencies when cloning from the rc0 revision. A `sage -ba` while using the sage-0 clone would clear this up, but since this isn't my tree I will not do so :)

In the end this patch should be reviewed on a truly clean tree, so I am changing this patch to "needs review". 

Thoughts?

Cheers,

Michael



---

archive/issue_comments_054013.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2009-05-04T01:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54013",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_054014.json:
```json
{
    "body": "<a id='comment:23'></a>\nIndeed, this was exactly caused by this issue mentioned above:\n\n```\nwstein@sage:~/build/sage-3.4.2.rc0$ ./sage -sh\n\nStarting subshell with Sage environment variables set.\nBe sure to exit when you are done and do not do anything\nwith other copies of Sage!\n\nwstein@sage:~/build/sage-3.4.2.rc0$ cd devel/sage\nwstein@sage:~/build/sage-3.4.2.rc0/devel/sage$ touch sage/modular/modsym/modular_symbols.py\nwstein@sage:~/build/sage-3.4.2.rc0/devel/sage$ cd ../..\nwstein@sage:~/build/sage-3.4.2.rc0$ ./sage -b\n\n----------------------------------------------------------\nsage: Building and installing modified Sage library files.\n\n\nInstalling c_lib\nscons: `install' is up to date.\nUpdating Cython code....\nTime to execute 0 commands: 1.38282775879e-05 seconds\nFinished compiling Cython code (time = 0.30867099762 seconds)\nrunning install\nrunning build\nrunning build_py\ncopying sage/modular/modsym/modular_symbols.py -> build/lib.linux-x86_64-2.5/sage/modular/modsym\nrunning build_ext\nrunning build_scripts\nrunning install_lib\ncopying build/lib.linux-x86_64-2.5/sage/modular/modsym/modular_symbols.py -> /scratch/wstein/build/sage-3.4.2.rc0/local/lib/python2.5/site-packages/sage/modular/modsym\nbyte-compiling /scratch/wstein/build/sage-3.4.2.rc0/local/lib/python2.5/site-packages/sage/modular/modsym/modular_symbols.py to modular_symbols.pyc\nrunning install_scripts\nchanging mode of /scratch/wstein/build/sage-3.4.2.rc0/local/bin/spkg-debian-maybe to 755\nrunning install_egg_info\nRemoving /scratch/wstein/build/sage-3.4.2.rc0/local/lib/python2.5/site-packages/sage-0.0.0-py2.5.egg-info\nWriting /scratch/wstein/build/sage-3.4.2.rc0/local/lib/python2.5/site-packages/sage-0.0.0-py2.5.egg-info\n\nreal\t0m1.006s\nuser\t0m0.810s\nsys\t0m0.190s\nwstein@sage:~/build/sage-3.4.2.rc0$        sage -t -long devel/sage/sage/modular/modsym/ambient.py # 4 doctests failed\nsage -t -long \"devel/sage/sage/modular/modsym/ambient.py\"   \n\t [5.8 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 5.8 seconds\nwstein@sage:~/build/sage-3.4.2.rc0$         sage -t -long devel/sage/sage/tests/book_stein_modform.py # 3 doctests failedsage -t -long \"devel/sage/sage/tests/book_stein_modform.py\" \n\t [3.3 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 3.3 seconds\nwstein@sage:~/build/sage-3.4.2.rc0$         sage -t -long devel/sage/sage/modular/modsym/manin_symbols.py # 1 doctests failed\nsage -t -long \"devel/sage/sage/modular/modsym/manin_symbols.py\"\n\t [1.5 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 1.5 seconds\nwstein@sage:~/build/sage-3.4.2.rc0$         sage -t -long devel/sage/doc/en/bordeaux_2008/modular_symbols.rst # 1 doctests failed\nsage -t -long \"devel/sage/doc/en/bordeaux_2008/modular_symbols.rst\"\n\t [1.1 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 1.1 seconds\nwstein@sage:~/build/sage-3.4.2.rc0$ \n```",
    "created_at": "2009-05-04T01:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54014",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:23'></a>
Indeed, this was exactly caused by this issue mentioned above:

```
wstein@sage:~/build/sage-3.4.2.rc0$ ./sage -sh

Starting subshell with Sage environment variables set.
Be sure to exit when you are done and do not do anything
with other copies of Sage!

wstein@sage:~/build/sage-3.4.2.rc0$ cd devel/sage
wstein@sage:~/build/sage-3.4.2.rc0/devel/sage$ touch sage/modular/modsym/modular_symbols.py
wstein@sage:~/build/sage-3.4.2.rc0/devel/sage$ cd ../..
wstein@sage:~/build/sage-3.4.2.rc0$ ./sage -b

----------------------------------------------------------
sage: Building and installing modified Sage library files.


Installing c_lib
scons: `install' is up to date.
Updating Cython code....
Time to execute 0 commands: 1.38282775879e-05 seconds
Finished compiling Cython code (time = 0.30867099762 seconds)
running install
running build
running build_py
copying sage/modular/modsym/modular_symbols.py -> build/lib.linux-x86_64-2.5/sage/modular/modsym
running build_ext
running build_scripts
running install_lib
copying build/lib.linux-x86_64-2.5/sage/modular/modsym/modular_symbols.py -> /scratch/wstein/build/sage-3.4.2.rc0/local/lib/python2.5/site-packages/sage/modular/modsym
byte-compiling /scratch/wstein/build/sage-3.4.2.rc0/local/lib/python2.5/site-packages/sage/modular/modsym/modular_symbols.py to modular_symbols.pyc
running install_scripts
changing mode of /scratch/wstein/build/sage-3.4.2.rc0/local/bin/spkg-debian-maybe to 755
running install_egg_info
Removing /scratch/wstein/build/sage-3.4.2.rc0/local/lib/python2.5/site-packages/sage-0.0.0-py2.5.egg-info
Writing /scratch/wstein/build/sage-3.4.2.rc0/local/lib/python2.5/site-packages/sage-0.0.0-py2.5.egg-info

real	0m1.006s
user	0m0.810s
sys	0m0.190s
wstein@sage:~/build/sage-3.4.2.rc0$        sage -t -long devel/sage/sage/modular/modsym/ambient.py # 4 doctests failed
sage -t -long "devel/sage/sage/modular/modsym/ambient.py"   
	 [5.8 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 5.8 seconds
wstein@sage:~/build/sage-3.4.2.rc0$         sage -t -long devel/sage/sage/tests/book_stein_modform.py # 3 doctests failedsage -t -long "devel/sage/sage/tests/book_stein_modform.py" 
	 [3.3 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 3.3 seconds
wstein@sage:~/build/sage-3.4.2.rc0$         sage -t -long devel/sage/sage/modular/modsym/manin_symbols.py # 1 doctests failed
sage -t -long "devel/sage/sage/modular/modsym/manin_symbols.py"
	 [1.5 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 1.5 seconds
wstein@sage:~/build/sage-3.4.2.rc0$         sage -t -long devel/sage/doc/en/bordeaux_2008/modular_symbols.rst # 1 doctests failed
sage -t -long "devel/sage/doc/en/bordeaux_2008/modular_symbols.rst"
	 [1.1 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 1.1 seconds
wstein@sage:~/build/sage-3.4.2.rc0$ 
```



---

archive/issue_comments_054015.json:
```json
{
    "body": "<a id='comment:24'></a>\nOK, you are right.  Positive review, since when reading the patches everything looks good to me.  Thanks!!",
    "created_at": "2009-05-04T03:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54015",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:24'></a>
OK, you are right.  Positive review, since when reading the patches everything looks good to me.  Thanks!!



---

archive/issue_comments_054016.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2009-05-04T03:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54016",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_054017.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2009-05-04T17:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54017",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Resolution:** fixed



---

archive/issue_comments_054018.json:
```json
{
    "body": "<a id='comment:25'></a>\nMerged both patches in Sage 4.0.alpha0.\n\nCheers,\n\nMichael",
    "created_at": "2009-05-04T17:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54018",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:25'></a>
Merged both patches in Sage 4.0.alpha0.

Cheers,

Michael



---

archive/issue_events_017379.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-05-04T17:57:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5736#event-17379"
}
```



---

archive/issue_comments_054019.json:
```json
{
    "body": "**Reviewer:** William Stein",
    "created_at": "2009-06-07T09:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54019",
    "user": "https://github.com/loefflerd"
}
```

**Reviewer:** William Stein



---

archive/issue_comments_054020.json:
```json
{
    "body": "**Author:** David Loeffler",
    "created_at": "2009-06-07T09:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54020",
    "user": "https://github.com/loefflerd"
}
```

**Author:** David Loeffler



---

archive/issue_comments_054021.json:
```json
{
    "body": "**Merged:** 4.0.alpha0",
    "created_at": "2009-06-07T09:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5736",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5736#issuecomment-54021",
    "user": "https://github.com/loefflerd"
}
```

**Merged:** 4.0.alpha0
