# Issue 5814: %prun doesn't work in the notebook

archive/issues_005814.json:
```json
{
    "assignees": [
        "https://github.com/tkluck"
    ],
    "body": "<div id=\"comment:0\"></div>\n\nIn ipython, one can use the %prun directive to use a profiler on cell contents. We can support the same in sage. The attached patches allow this.\n\nApply:\n\n* [attachment: trac_5814-prun_notebook-combined.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-combined.patch.gz)\n\nComponent: **notebook**\n\nAuthor: **Timo Kluck**\n\nReviewer: **Travis Scrimshaw**\n\nMerged: **sage-5.9.beta4**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/5814_\n\n",
    "closed_at": "2013-04-06T14:50:17Z",
    "created_at": "2009-04-17T21:50:36Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20user%20interface",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "%prun doesn't work in the notebook",
    "type": "issue",
    "updated_at": "2014-10-22T19:09:18Z",
    "url": "https://github.com/sagemath/sage/issues/5814",
    "user": "https://github.com/rlmill"
}
```
<div id="comment:0"></div>

In ipython, one can use the %prun directive to use a profiler on cell contents. We can support the same in sage. The attached patches allow this.

Apply:

* [attachment: trac_5814-prun_notebook-combined.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-combined.patch.gz)

Component: **notebook**

Author: **Timo Kluck**

Reviewer: **Travis Scrimshaw**

Merged: **sage-5.9.beta4**

_Issue created by migration from https://trac.sagemath.org/ticket/5814_





---

archive/issue_events_068705.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-04-17T21:50:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "milestone_number": null,
    "milestone_title": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68705"
}
```



---

archive/issue_events_068706.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-04-17T21:50:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20user%20interface",
    "label_color": "0000b0",
    "label_name": "c: user interface",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68706"
}
```



---

archive/issue_events_068707.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-04-17T21:50:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68707"
}
```



---

archive/issue_events_068708.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-04-17T21:50:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68708"
}
```



---

archive/issue_events_068709.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2009-04-17T21:50:36Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "subject": "https://github.com/rlmill",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68709"
}
```



---

archive/issue_events_068710.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-18T07:06:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68710"
}
```



---

archive/issue_events_068711.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-18T07:06:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68711"
}
```



---

archive/issue_comments_037108.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI'm changing this to an enhancement.  It's not a bug that \"random\" ipython features don't work in the notebook.  There's no reason they should until they get implemented.\n\nThe prun functionality -- which is really the python profiler -- could be used in the notebook by people who know enough about how the profiler works under the hood.  %prun is just IPython's wrapper around Python's standard profiler to make it easier to use.",
    "created_at": "2009-04-18T07:06:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37108",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:1" align="right">comment:1</div>

I'm changing this to an enhancement.  It's not a bug that "random" ipython features don't work in the notebook.  There's no reason they should until they get implemented.

The prun functionality -- which is really the python profiler -- could be used in the notebook by people who know enough about how the profiler works under the hood.  %prun is just IPython's wrapper around Python's standard profiler to make it easier to use.



---

archive/issue_comments_037109.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nHere's a branch that implements this feature. Feedback appreciated!\n\nhttps://github.com/tkluck/sagenb/commits/support_prun",
    "created_at": "2012-08-07T14:53:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37109",
    "user": "https://github.com/tkluck"
}
```

<div id="comment:2" align="right">comment:2</div>

Here's a branch that implements this feature. Feedback appreciated!

https://github.com/tkluck/sagenb/commits/support_prun



---

archive/issue_events_068712.json:
```json
{
    "actor": "https://github.com/tkluck",
    "created_at": "2012-08-07T14:53:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68712"
}
```



---

archive/issue_events_068713.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2012-08-10T09:17:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68713"
}
```



---

archive/issue_events_068714.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2012-08-10T09:17:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68714"
}
```



---

archive/issue_events_068715.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2012-08-10T09:17:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "milestone_number": null,
    "milestone_title": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68715"
}
```



---

archive/issue_comments_037110.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThanks, tkluck. I see you made a pull request at https://github.com/sagemath/sagenb/pull/91 . Please continue any review process there :)\n\nI'm marking this ticket as invalid.",
    "created_at": "2012-08-10T09:17:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37110",
    "user": "https://github.com/kini"
}
```

<div id="comment:3" align="right">comment:3</div>

Thanks, tkluck. I see you made a pull request at https://github.com/sagemath/sagenb/pull/91 . Please continue any review process there :)

I'm marking this ticket as invalid.



---

archive/issue_events_068716.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-15T07:56:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68716"
}
```



---

archive/issue_events_068717.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-15T07:56:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68717"
}
```



---

archive/issue_comments_037111.json:
```json
{
    "body": "Reviewer: **Keshav Kini**",
    "created_at": "2012-08-15T07:56:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37111",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Keshav Kini**



---

archive/issue_comments_037112.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAttachment: **[trac_5814_enable_prun_in_notebook.patch.gz](https://github.com/sagemath/sage/files/ticket5814/trac_5814_enable_prun_in_notebook.patch.gz)**\n\nIt turns out that this does need to be tackled in the sage library itself. It is possible to add a `prun` object there, which will be automatically used without having to do any special handling in the notebook. I've closed my pull request for the notebook and am reopening this ticket.",
    "created_at": "2012-09-05T12:58:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37112",
    "user": "https://github.com/tkluck"
}
```

<div id="comment:5" align="right">comment:5</div>

Attachment: **[trac_5814_enable_prun_in_notebook.patch.gz](https://github.com/sagemath/sage/files/ticket5814/trac_5814_enable_prun_in_notebook.patch.gz)**

It turns out that this does need to be tackled in the sage library itself. It is possible to add a `prun` object there, which will be automatically used without having to do any special handling in the notebook. I've closed my pull request for the notebook and am reopening this ticket.



---

archive/issue_events_068718.json:
```json
{
    "actor": "https://github.com/tkluck",
    "created_at": "2012-09-05T12:58:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/feature",
    "label_color": "008080",
    "label_name": "feature",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68718"
}
```



---

archive/issue_comments_037113.json:
```json
{
    "body": "Author: **Timo Kluck**",
    "created_at": "2012-09-05T12:58:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37113",
    "user": "https://github.com/tkluck"
}
```

Author: **Timo Kluck**



---

archive/issue_events_068719.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2012-09-05T12:58:16Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "subject": "https://github.com/tkluck",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68719"
}
```



---

archive/issue_events_068720.json:
```json
{
    "actor": "https://github.com/tkluck",
    "created_at": "2012-09-05T12:58:16Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "subject": "https://github.com/tkluck",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68720"
}
```



---

archive/issue_events_068721.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-11T11:58:14Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68721"
}
```



---

archive/issue_events_068722.json:
```json
{
    "actor": "https://github.com/tkluck",
    "created_at": "2012-09-11T14:43:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68722"
}
```



---

archive/issue_comments_037114.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nJust wanting to make sure that this patch ready for review, there are a few people here at Sage Days 45 that would like this feature. (Also do you know someone who would have the expertise to do a full review?)\n\nMy quick comment is that you'll need to give doctests to your functions.\n\nThanks,\n\nTravis",
    "created_at": "2013-02-12T00:46:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37114",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:8" align="right">comment:8</div>

Just wanting to make sure that this patch ready for review, there are a few people here at Sage Days 45 that would like this feature. (Also do you know someone who would have the expertise to do a full review?)

My quick comment is that you'll need to give doctests to your functions.

Thanks,

Travis



---

archive/issue_comments_037115.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,6 @@\n+In ipython, one can use the %prun directive to use a profiler on cell contents. We can support the same in sage. The attached patches allow this.\n \n+Apply:\n+\n+* [attachment: trac_5814_enable_prun_in_notebook.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_enable_prun_in_notebook.patch.gz)\n+* [attachment: trac_5814_add_doctests_to_prun_object.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_add_doctests_to_prun_object.patch.gz)\n``````\n",
    "created_at": "2013-03-11T15:49:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37115",
    "user": "https://github.com/tkluck"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,6 @@
+In ipython, one can use the %prun directive to use a profiler on cell contents. We can support the same in sage. The attached patches allow this.
 
+Apply:
+
+* [attachment: trac_5814_enable_prun_in_notebook.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_enable_prun_in_notebook.patch.gz)
+* [attachment: trac_5814_add_doctests_to_prun_object.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_add_doctests_to_prun_object.patch.gz)
``````




---

archive/issue_comments_037116.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAttachment: **[trac_5814_add_doctests_to_prun_object.patch.gz](https://github.com/sagemath/sage/files/ticket5814/trac_5814_add_doctests_to_prun_object.patch.gz)**",
    "created_at": "2013-03-11T15:49:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37116",
    "user": "https://github.com/tkluck"
}
```

<div id="comment:9" align="right">comment:9</div>

Attachment: **[trac_5814_add_doctests_to_prun_object.patch.gz](https://github.com/sagemath/sage/files/ticket5814/trac_5814_add_doctests_to_prun_object.patch.gz)**



---

archive/issue_comments_037117.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThanks for your comment, Travis. I just added the doctests. I'm not sure whether any special expertise is necessary, so please go ahead and give this a try.",
    "created_at": "2013-03-11T15:51:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37117",
    "user": "https://github.com/tkluck"
}
```

<div id="comment:10" align="right">comment:10</div>

Thanks for your comment, Travis. I just added the doctests. I'm not sure whether any special expertise is necessary, so please go ahead and give this a try.



---

archive/issue_comments_037118.json:
```json
{
    "body": "Attachment: **[trac_5814-prun_notebook-review-ts.patch.gz](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-review-ts.patch.gz)**",
    "created_at": "2013-04-01T18:03:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37118",
    "user": "https://github.com/tscrim"
}
```

Attachment: **[trac_5814-prun_notebook-review-ts.patch.gz](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-review-ts.patch.gz)**



---

archive/issue_events_068723.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-04-01T18:06:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68723"
}
```



---

archive/issue_events_068724.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-04-01T18:06:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68724"
}
```



---

archive/issue_comments_037119.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,3 +4,4 @@\n \n * [attachment: trac_5814_enable_prun_in_notebook.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_enable_prun_in_notebook.patch.gz)\n * [attachment: trac_5814_add_doctests_to_prun_object.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_add_doctests_to_prun_object.patch.gz)\n+* [attachment: trac_5814-prun_notebook-review-ts.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-review-ts.patch.gz)\n``````\n",
    "created_at": "2013-04-01T18:06:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37119",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,3 +4,4 @@
 
 * [attachment: trac_5814_enable_prun_in_notebook.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_enable_prun_in_notebook.patch.gz)
 * [attachment: trac_5814_add_doctests_to_prun_object.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_add_doctests_to_prun_object.patch.gz)
+* [attachment: trac_5814-prun_notebook-review-ts.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-review-ts.patch.gz)
``````




---

archive/issue_comments_037120.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nHey Timo,\n\nI've uploaded a small review patch which fixes the doctests and gives full coverage. Thank you for the patch.\n\nBest,\n\nTravis\n\n```\nsage -t ../misc/prun.py\n    [6 tests, 0.0 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 0.2 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\n```",
    "created_at": "2013-04-01T18:06:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37120",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">comment:11</div>

Hey Timo,

I've uploaded a small review patch which fixes the doctests and gives full coverage. Thank you for the patch.

Best,

Travis

```
sage -t ../misc/prun.py
    [6 tests, 0.0 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.2 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
```



---

archive/issue_comments_037121.json:
```json
{
    "body": "Changed reviewer from **Keshav Kini** to **Travis Scrimshaw**",
    "created_at": "2013-04-01T18:06:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37121",
    "user": "https://github.com/tscrim"
}
```

Changed reviewer from **Keshav Kini** to **Travis Scrimshaw**



---

archive/issue_comments_037122.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nIt's probably outside the scope of this ticket, but the *really* useful thing would be if `%prun ...` in the notebook would return an interactive browser for the `Stat` object that is returned by `cProfile().runctx(...)`. While a basic printout of profiling data gives some indication, one usually needs to dig around a little in the data to find what the real bottleneck is (see where most calls come from, switch between cumulative and proper time, etc.)\n\nWriting such a browser might be a nice exercise for a student who is interested in interface programming. I bet there are good profiler browsers around to get inspiration from.\n\nA tool I haven't used yet but looks like a decent effort is [runsnakerun](https://pypi.python.org/pypi/RunSnakeRun). Duplicating that effort for the sage notebook might not seem like such a smart idea. Perhaps we can make the tool more easily accessible from sage? Given that it uses wxPython that might not be so very easily done ... I ended up installing it using OS tools, meaning that I *have* to write the profile data to a file and analyse it separately.",
    "created_at": "2013-04-01T18:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37122",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:12" align="right">comment:12</div>

It's probably outside the scope of this ticket, but the *really* useful thing would be if `%prun ...` in the notebook would return an interactive browser for the `Stat` object that is returned by `cProfile().runctx(...)`. While a basic printout of profiling data gives some indication, one usually needs to dig around a little in the data to find what the real bottleneck is (see where most calls come from, switch between cumulative and proper time, etc.)

Writing such a browser might be a nice exercise for a student who is interested in interface programming. I bet there are good profiler browsers around to get inspiration from.

A tool I haven't used yet but looks like a decent effort is [runsnakerun](https://pypi.python.org/pypi/RunSnakeRun). Duplicating that effort for the sage notebook might not seem like such a smart idea. Perhaps we can make the tool more easily accessible from sage? Given that it uses wxPython that might not be so very easily done ... I ended up installing it using OS tools, meaning that I *have* to write the profile data to a file and analyse it separately.



---

archive/issue_events_068725.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-03T09:13:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "milestone_number": null,
    "milestone_title": "sage-5.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68725"
}
```



---

archive/issue_events_068726.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-03T09:13:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/feature",
    "label_color": "008080",
    "label_name": "feature",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68726"
}
```



---

archive/issue_comments_037123.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@nbruin](#comment%3A12):\n> It's probably outside the scope of this ticket, but the *really* useful thing would be if `%prun ...` in the notebook would return an interactive browser for the `Stat` object that is returned by `cProfile().runctx(...)`. While a basic printout of profiling data gives some indication, one usually needs to dig around a little in the data to find what the real bottleneck is (see where most calls come from, switch between cumulative and proper time, etc.)\n\n+1/2 since being able to read/interpret the raw data is a good skill to have IMO. However a graphical (or at least a tree structure) of the data is also very useful.\n> \n> Writing such a browser might be a nice exercise for a student who is interested in interface programming. I bet there are good profiler browsers around to get inspiration from.\n\n+1 here. I feel like we need a wiki page to keep a list of \"good student projects\"...\n\n> A tool I haven't used yet but looks like a decent effort is [runsnakerun](https://pypi.python.org/pypi/RunSnakeRun). Duplicating that effort for the sage notebook might not seem like such a smart idea. Perhaps we can make the tool more easily accessible from sage? Given that it uses wxPython that might not be so very easily done ... I ended up installing it using OS tools, meaning that I *have* to write the profile data to a file and analyse it separately.\n\nI've seen runsnakerun used in a few places (although I haven't used it myself), and instead of duplicating it in the notebook, perhaps we could link it into sage (notebook) as some type of package? Actually...perhaps what we should do is have a variable/function which calls your favorite profiler on the executed command(s), something like:\n\n```\n%profile\n2 + 2\n```",
    "created_at": "2013-04-03T12:59:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37123",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@nbruin](#comment%3A12):
> It's probably outside the scope of this ticket, but the *really* useful thing would be if `%prun ...` in the notebook would return an interactive browser for the `Stat` object that is returned by `cProfile().runctx(...)`. While a basic printout of profiling data gives some indication, one usually needs to dig around a little in the data to find what the real bottleneck is (see where most calls come from, switch between cumulative and proper time, etc.)

+1/2 since being able to read/interpret the raw data is a good skill to have IMO. However a graphical (or at least a tree structure) of the data is also very useful.
> 
> Writing such a browser might be a nice exercise for a student who is interested in interface programming. I bet there are good profiler browsers around to get inspiration from.

+1 here. I feel like we need a wiki page to keep a list of "good student projects"...

> A tool I haven't used yet but looks like a decent effort is [runsnakerun](https://pypi.python.org/pypi/RunSnakeRun). Duplicating that effort for the sage notebook might not seem like such a smart idea. Perhaps we can make the tool more easily accessible from sage? Given that it uses wxPython that might not be so very easily done ... I ended up installing it using OS tools, meaning that I *have* to write the profile data to a file and analyse it separately.

I've seen runsnakerun used in a few places (although I haven't used it myself), and instead of duplicating it in the notebook, perhaps we could link it into sage (notebook) as some type of package? Actually...perhaps what we should do is have a variable/function which calls your favorite profiler on the executed command(s), something like:

```
%profile
2 + 2
```



---

archive/issue_events_068727.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-04T11:46:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68727"
}
```



---

archive/issue_events_068728.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-04T11:46:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68728"
}
```



---

archive/issue_comments_037124.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThe first patch isn't a proper HG changeset (patches should be generated using `hg export`, the second patch is fine).",
    "created_at": "2013-04-04T11:46:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37124",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

The first patch isn't a proper HG changeset (patches should be generated using `hg export`, the second patch is fine).



---

archive/issue_comments_037125.json:
```json
{
    "body": "Attachment: **[trac_5814-prun_notebook-combined.patch.gz](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-combined.patch.gz)**",
    "created_at": "2013-04-04T16:25:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37125",
    "user": "https://github.com/tscrim"
}
```

Attachment: **[trac_5814-prun_notebook-combined.patch.gz](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-combined.patch.gz)**



---

archive/issue_events_068729.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-04-04T16:33:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68729"
}
```



---

archive/issue_events_068730.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-04-04T16:33:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68730"
}
```



---

archive/issue_comments_037126.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nFixed by combining all the patches into one. I hope that's okay.",
    "created_at": "2013-04-04T16:33:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37126",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

Fixed by combining all the patches into one. I hope that's okay.



---

archive/issue_comments_037127.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,6 +2,4 @@\n \n Apply:\n \n-* [attachment: trac_5814_enable_prun_in_notebook.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_enable_prun_in_notebook.patch.gz)\n-* [attachment: trac_5814_add_doctests_to_prun_object.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_add_doctests_to_prun_object.patch.gz)\n-* [attachment: trac_5814-prun_notebook-review-ts.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-review-ts.patch.gz)\n+* [attachment: trac_5814-prun_notebook-combined.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-combined.patch.gz)\n``````\n",
    "created_at": "2013-04-04T16:33:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37127",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,6 +2,4 @@
 
 Apply:
 
-* [attachment: trac_5814_enable_prun_in_notebook.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_enable_prun_in_notebook.patch.gz)
-* [attachment: trac_5814_add_doctests_to_prun_object.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_add_doctests_to_prun_object.patch.gz)
-* [attachment: trac_5814-prun_notebook-review-ts.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-review-ts.patch.gz)
+* [attachment: trac_5814-prun_notebook-combined.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-combined.patch.gz)
``````




---

archive/issue_comments_037128.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThanks for your work on this, Travis! Your changes look excellent.\n\nI'm kind of surprised that you found 20 function calls where I had 3. I'll try that again later, but I trust you on it.",
    "created_at": "2013-04-05T05:35:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37128",
    "user": "https://github.com/tkluck"
}
```

<div id="comment:17" align="right">comment:17</div>

Thanks for your work on this, Travis! Your changes look excellent.

I'm kind of surprised that you found 20 function calls where I had 3. I'll try that again later, but I trust you on it.



---

archive/issue_comments_037129.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThat also seemed to be what the patchbot was getting, but if you're still getting fewer function calls, then we will have to change the test slightly. I'm also running these from the command line where I know the preparser is replacing `1` with `Integer(1)` which is an extra function call. I'm guessing you were doing the testing from the notebook? I'm 99% certain the notebook is doing the same, but it might evaluating these *before* it actually executes the `%prun` test...I'll do some tests later today too.\n\nFor patchbot:\n\nApply: trac_5814-prun_notebook-combined.patch",
    "created_at": "2013-04-05T12:44:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37129",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:18" align="right">comment:18</div>

That also seemed to be what the patchbot was getting, but if you're still getting fewer function calls, then we will have to change the test slightly. I'm also running these from the command line where I know the preparser is replacing `1` with `Integer(1)` which is an extra function call. I'm guessing you were doing the testing from the notebook? I'm 99% certain the notebook is doing the same, but it might evaluating these *before* it actually executes the `%prun` test...I'll do some tests later today too.

For patchbot:

Apply: trac_5814-prun_notebook-combined.patch



---

archive/issue_comments_037130.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nIn the notebook I get 3 function calls\n\n```\n         3 function calls in 0.007 seconds\n\n   Ordered by: standard name\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n        1    0.007    0.007    0.007    0.007 <string>:1(<module>)\n        1    0.000    0.000    0.000    0.000 {len}\n        1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}\n```\nwith the command line:\n\n```\n         3 function calls in 0.000 seconds\n\n   Ordered by: standard name\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n        1    0.000    0.000    0.000    0.000 <string>:1(<module>)\n        1    0.000    0.000    0.000    0.000 {len}\n        1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}\n```\nSo it's something specific to the doctesting framework that's not reflected in sage while it's directly running (I've noticed this in a few other places before too).",
    "created_at": "2013-04-05T15:35:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37130",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

In the notebook I get 3 function calls

```
         3 function calls in 0.007 seconds

   Ordered by: standard name

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1    0.007    0.007    0.007    0.007 <string>:1(<module>)
        1    0.000    0.000    0.000    0.000 {len}
        1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}
```
with the command line:

```
         3 function calls in 0.000 seconds

   Ordered by: standard name

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1    0.000    0.000    0.000    0.000 <string>:1(<module>)
        1    0.000    0.000    0.000    0.000 {len}
        1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}
```
So it's something specific to the doctesting framework that's not reflected in sage while it's directly running (I've noticed this in a few other places before too).



---

archive/issue_events_068731.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-06T14:50:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68731"
}
```



---

archive/issue_events_068732.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-06T14:50:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-68732"
}
```



---

archive/issue_comments_037131.json:
```json
{
    "body": "Merged: **sage-5.9.beta4**",
    "created_at": "2013-04-06T14:50:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37131",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.9.beta4**



---

archive/issue_comments_037132.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nDoes this actually work in the notebook?  (Sometimes Ipython upgrades cause trouble with such magic.)  I just get\n\n```\nNameError: name 'prun' is not defined\n```\nin 6.3 and 6.4.beta6.",
    "created_at": "2014-10-22T16:24:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37132",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:21" align="right">comment:21</div>

Does this actually work in the notebook?  (Sometimes Ipython upgrades cause trouble with such magic.)  I just get

```
NameError: name 'prun' is not defined
```
in 6.3 and 6.4.beta6.



---

archive/issue_comments_037133.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI'm almost sure it did...but it's been so long that I can be certain. Considering we were using iPython 0.13 or something like that at the time, I wouldn't be surprised if something broke along the way.",
    "created_at": "2014-10-22T18:49:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37133",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:22" align="right">comment:22</div>

I'm almost sure it did...but it's been so long that I can be certain. Considering we were using iPython 0.13 or something like that at the time, I wouldn't be surprised if something broke along the way.



---

archive/issue_comments_037134.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nDoes it work for you now?",
    "created_at": "2014-10-22T19:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37134",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:23" align="right">comment:23</div>

Does it work for you now?



---

archive/issue_comments_037135.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nNope.",
    "created_at": "2014-10-22T19:09:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-37135",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

Nope.
