# Issue 5814: %prun doesn't work in the notebook

archive/issues_005814.json:
```json
{
    "body": "In ipython, one can use the %prun directive to use a profiler on cell contents. We can support the same in sage. The attached patches allow this.\n\nApply:\n\n* [attachment:trac_5814-prun_notebook-combined.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-combined.patch)\n\n**Assignee:** @tkluck\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Timo Kluck\n\n**Merged:** sage-5.9.beta4\n\nIssue created by migration from https://trac.sagemath.org/ticket/5814\n\n",
    "closed_at": "2013-04-06T14:50:17Z",
    "created_at": "2009-04-17T21:50:36Z",
    "labels": [
        "component: notebook",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.9",
    "title": "%prun doesn't work in the notebook",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/5814",
    "user": "https://github.com/rlmill"
}
```
In ipython, one can use the %prun directive to use a profiler on cell contents. We can support the same in sage. The attached patches allow this.

Apply:

* [attachment:trac_5814-prun_notebook-combined.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-combined.patch)

**Assignee:** @tkluck

**Reviewer:** Travis Scrimshaw

**Author:** Timo Kluck

**Merged:** sage-5.9.beta4

Issue created by migration from https://trac.sagemath.org/ticket/5814





---

archive/issue_events_037192.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-18T07:06:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37192"
}
```



---

archive/issue_events_037193.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-04-18T07:06:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "enhancement",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37193"
}
```



---

archive/issue_comments_038462.json:
```json
{
    "body": "<a id='comment:1'></a>\nI'm changing this to an enhancement.  It's not a bug that \"random\" ipython features don't work in the notebook.  There's no reason they should until they get implemented.\n\nThe prun functionality -- which is really the python profiler -- could be used in the notebook by people who know enough about how the profiler works under the hood.  %prun is just IPython's wrapper around Python's standard profiler to make it easier to use.",
    "created_at": "2009-04-18T07:06:55Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38462",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:1'></a>
I'm changing this to an enhancement.  It's not a bug that "random" ipython features don't work in the notebook.  There's no reason they should until they get implemented.

The prun functionality -- which is really the python profiler -- could be used in the notebook by people who know enough about how the profiler works under the hood.  %prun is just IPython's wrapper around Python's standard profiler to make it easier to use.



---

archive/issue_comments_038463.json:
```json
{
    "body": "<a id='comment:2'></a>\nHere's a branch that implements this feature. Feedback appreciated!\n\nhttps://github.com/tkluck/sagenb/commits/support_prun",
    "created_at": "2012-08-07T14:53:10Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38463",
    "user": "https://github.com/tkluck"
}
```

<a id='comment:2'></a>
Here's a branch that implements this feature. Feedback appreciated!

https://github.com/tkluck/sagenb/commits/support_prun



---

archive/issue_events_037194.json:
```json
{
    "actor": "https://github.com/tkluck",
    "created_at": "2012-08-07T14:53:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37194"
}
```



---

archive/issue_events_037195.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2012-08-10T09:17:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37195"
}
```



---

archive/issue_events_037196.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2012-08-10T09:17:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37196"
}
```



---

archive/issue_events_037197.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2012-08-10T09:17:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "milestone": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37197"
}
```



---

archive/issue_events_037198.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2012-08-10T09:17:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "invalid",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37198"
}
```



---

archive/issue_comments_038464.json:
```json
{
    "body": "<a id='comment:3'></a>\nThanks, tkluck. I see you made a pull request at https://github.com/sagemath/sagenb/pull/91 . Please continue any review process there :)\n\nI'm marking this ticket as invalid.",
    "created_at": "2012-08-10T09:17:41Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38464",
    "user": "https://github.com/kini"
}
```

<a id='comment:3'></a>
Thanks, tkluck. I see you made a pull request at https://github.com/sagemath/sagenb/pull/91 . Please continue any review process there :)

I'm marking this ticket as invalid.



---

archive/issue_events_037199.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-15T07:56:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37199"
}
```



---

archive/issue_events_037200.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-15T07:56:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37200"
}
```



---

archive/issue_comments_038465.json:
```json
{
    "body": "**Reviewer:** Keshav Kini",
    "created_at": "2012-08-15T07:56:37Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38465",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Keshav Kini



---

archive/attachments_006945.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_5814_enable_prun_in_notebook.patch",
    "asset_url": "tarball://root/attachments/ticket5814/trac_5814_enable_prun_in_notebook.patch",
    "created_at": "2012-09-05T12:58:16Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket5814/trac_5814_enable_prun_in_notebook.patch",
    "user": "https://github.com/tkluck"
}
```



---

archive/issue_comments_038466.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Attachment:** [trac_5814_enable_prun_in_notebook.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_enable_prun_in_notebook.patch)\n\nIt turns out that this does need to be tackled in the sage library itself. It is possible to add a `prun` object there, which will be automatically used without having to do any special handling in the notebook. I've closed my pull request for the notebook and am reopening this ticket.",
    "created_at": "2012-09-05T12:58:16Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38466",
    "user": "https://github.com/tkluck"
}
```

<a id='comment:5'></a>
**Attachment:** [trac_5814_enable_prun_in_notebook.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_enable_prun_in_notebook.patch)

It turns out that this does need to be tackled in the sage library itself. It is possible to add a `prun` object there, which will be automatically used without having to do any special handling in the notebook. I've closed my pull request for the notebook and am reopening this ticket.



---

archive/issue_events_037201.json:
```json
{
    "actor": "https://github.com/tkluck",
    "created_at": "2012-09-05T12:58:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "feature",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37201"
}
```



---

archive/issue_comments_038467.json:
```json
{
    "body": "**Author:** Timo Kluck",
    "created_at": "2012-09-05T12:58:16Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38467",
    "user": "https://github.com/tkluck"
}
```

**Author:** Timo Kluck



---

archive/issue_comments_038468.json:
```json
{
    "body": "**Changing assignee** from boothby to @tkluck.",
    "created_at": "2012-09-05T12:58:16Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38468",
    "user": "https://github.com/tkluck"
}
```

**Changing assignee** from boothby to @tkluck.



---

archive/issue_events_037202.json:
```json
{
    "actor": "https://github.com/tkluck",
    "created_at": "2012-09-11T14:43:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37202"
}
```



---

archive/issue_comments_038469.json:
```json
{
    "body": "<a id='comment:8'></a>\nJust wanting to make sure that this patch ready for review, there are a few people here at Sage Days 45 that would like this feature. (Also do you know someone who would have the expertise to do a full review?)\n\nMy quick comment is that you'll need to give doctests to your functions.\n\nThanks,\n\nTravis",
    "created_at": "2013-02-12T00:46:50Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38469",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
Just wanting to make sure that this patch ready for review, there are a few people here at Sage Days 45 that would like this feature. (Also do you know someone who would have the expertise to do a full review?)

My quick comment is that you'll need to give doctests to your functions.

Thanks,

Travis



---

archive/issue_comments_038470.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,6 @@\n+In ipython, one can use the %prun directive to use a profiler on cell contents. We can support the same in sage. The attached patches allow this.\n \n+Apply:\n+\n+* [attachment:trac_5814_enable_prun_in_notebook.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_enable_prun_in_notebook.patch)\n+* [attachment:trac_5814_add_doctests_to_prun_object.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_add_doctests_to_prun_object.patch)\n``````\n",
    "created_at": "2013-03-11T15:49:41Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38470",
    "user": "https://github.com/tkluck"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,6 @@
+In ipython, one can use the %prun directive to use a profiler on cell contents. We can support the same in sage. The attached patches allow this.
 
+Apply:
+
+* [attachment:trac_5814_enable_prun_in_notebook.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_enable_prun_in_notebook.patch)
+* [attachment:trac_5814_add_doctests_to_prun_object.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_add_doctests_to_prun_object.patch)
``````




---

archive/attachments_006946.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_5814_add_doctests_to_prun_object.patch",
    "asset_url": "tarball://root/attachments/ticket5814/trac_5814_add_doctests_to_prun_object.patch",
    "created_at": "2013-03-11T15:49:41Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket5814/trac_5814_add_doctests_to_prun_object.patch",
    "user": "https://github.com/tkluck"
}
```



---

archive/issue_comments_038471.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Attachment:** [trac_5814_add_doctests_to_prun_object.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_add_doctests_to_prun_object.patch)",
    "created_at": "2013-03-11T15:49:41Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38471",
    "user": "https://github.com/tkluck"
}
```

<a id='comment:9'></a>
**Attachment:** [trac_5814_add_doctests_to_prun_object.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_add_doctests_to_prun_object.patch)



---

archive/issue_comments_038472.json:
```json
{
    "body": "<a id='comment:10'></a>\nThanks for your comment, Travis. I just added the doctests. I'm not sure whether any special expertise is necessary, so please go ahead and give this a try.",
    "created_at": "2013-03-11T15:51:13Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38472",
    "user": "https://github.com/tkluck"
}
```

<a id='comment:10'></a>
Thanks for your comment, Travis. I just added the doctests. I'm not sure whether any special expertise is necessary, so please go ahead and give this a try.



---

archive/attachments_006947.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_5814-prun_notebook-review-ts.patch",
    "asset_url": "tarball://root/attachments/ticket5814/trac_5814-prun_notebook-review-ts.patch",
    "created_at": "2013-04-01T18:03:29Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-review-ts.patch",
    "user": "https://github.com/tscrim"
}
```



---

archive/issue_comments_038473.json:
```json
{
    "body": "**Attachment:** [trac_5814-prun_notebook-review-ts.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-review-ts.patch)",
    "created_at": "2013-04-01T18:03:29Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38473",
    "user": "https://github.com/tscrim"
}
```

**Attachment:** [trac_5814-prun_notebook-review-ts.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-review-ts.patch)



---

archive/issue_events_037203.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-04-01T18:06:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37203"
}
```



---

archive/issue_events_037204.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-04-01T18:06:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37204"
}
```



---

archive/issue_comments_038474.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,3 +4,4 @@\n \n * [attachment:trac_5814_enable_prun_in_notebook.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_enable_prun_in_notebook.patch)\n * [attachment:trac_5814_add_doctests_to_prun_object.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_add_doctests_to_prun_object.patch)\n+* [attachment:trac_5814-prun_notebook-review-ts.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-review-ts.patch)\n``````\n",
    "created_at": "2013-04-01T18:06:13Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38474",
    "user": "https://github.com/tscrim"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,3 +4,4 @@
 
 * [attachment:trac_5814_enable_prun_in_notebook.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_enable_prun_in_notebook.patch)
 * [attachment:trac_5814_add_doctests_to_prun_object.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_add_doctests_to_prun_object.patch)
+* [attachment:trac_5814-prun_notebook-review-ts.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-review-ts.patch)
``````




---

archive/issue_comments_038475.json:
```json
{
    "body": "<a id='comment:11'></a>\nHey Timo,\n\nI've uploaded a small review patch which fixes the doctests and gives full coverage. Thank you for the patch.\n\nBest,\n\nTravis\n\n```\nsage -t ../misc/prun.py\n    [6 tests, 0.0 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 0.2 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\n```",
    "created_at": "2013-04-01T18:06:13Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38475",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>
Hey Timo,

I've uploaded a small review patch which fixes the doctests and gives full coverage. Thank you for the patch.

Best,

Travis

```
sage -t ../misc/prun.py
    [6 tests, 0.0 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.2 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
```



---

archive/issue_comments_038476.json:
```json
{
    "body": "**Changing reviewer** from \"Keshav Kini\" to \"Travis Scrimshaw\".",
    "created_at": "2013-04-01T18:06:13Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38476",
    "user": "https://github.com/tscrim"
}
```

**Changing reviewer** from "Keshav Kini" to "Travis Scrimshaw".



---

archive/issue_comments_038477.json:
```json
{
    "body": "<a id='comment:12'></a>\nIt's probably outside the scope of this ticket, but the *really* useful thing would be if `%prun ...` in the notebook would return an interactive browser for the `Stat` object that is returned by `cProfile().runctx(...)`. While a basic printout of profiling data gives some indication, one usually needs to dig around a little in the data to find what the real bottleneck is (see where most calls come from, switch between cumulative and proper time, etc.)\n\nWriting such a browser might be a nice exercise for a student who is interested in interface programming. I bet there are good profiler browsers around to get inspiration from.\n\nA tool I haven't used yet but looks like a decent effort is [runsnakerun](https://pypi.python.org/pypi/RunSnakeRun). Duplicating that effort for the sage notebook might not seem like such a smart idea. Perhaps we can make the tool more easily accessible from sage? Given that it uses wxPython that might not be so very easily done ... I ended up installing it using OS tools, meaning that I *have* to write the profile data to a file and analyse it separately.",
    "created_at": "2013-04-01T18:44:02Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38477",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:12'></a>
It's probably outside the scope of this ticket, but the *really* useful thing would be if `%prun ...` in the notebook would return an interactive browser for the `Stat` object that is returned by `cProfile().runctx(...)`. While a basic printout of profiling data gives some indication, one usually needs to dig around a little in the data to find what the real bottleneck is (see where most calls come from, switch between cumulative and proper time, etc.)

Writing such a browser might be a nice exercise for a student who is interested in interface programming. I bet there are good profiler browsers around to get inspiration from.

A tool I haven't used yet but looks like a decent effort is [runsnakerun](https://pypi.python.org/pypi/RunSnakeRun). Duplicating that effort for the sage notebook might not seem like such a smart idea. Perhaps we can make the tool more easily accessible from sage? Given that it uses wxPython that might not be so very easily done ... I ended up installing it using OS tools, meaning that I *have* to write the profile data to a file and analyse it separately.



---

archive/issue_events_037205.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-03T09:13:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "milestone": "sage-5.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37205"
}
```



---

archive/issue_events_037206.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-03T09:13:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "feature",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37206"
}
```



---

archive/issue_comments_038478.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [nbruin](#comment%3A12):\n> It's probably outside the scope of this ticket, but the *really* useful thing would be if `%prun ...` in the notebook would return an interactive browser for the `Stat` object that is returned by `cProfile().runctx(...)`. While a basic printout of profiling data gives some indication, one usually needs to dig around a little in the data to find what the real bottleneck is (see where most calls come from, switch between cumulative and proper time, etc.)\n\n+1/2 since being able to read/interpret the raw data is a good skill to have IMO. However a graphical (or at least a tree structure) of the data is also very useful.\n> \n> Writing such a browser might be a nice exercise for a student who is interested in interface programming. I bet there are good profiler browsers around to get inspiration from.\n\n+1 here. I feel like we need a wiki page to keep a list of \"good student projects\"...\n\n> A tool I haven't used yet but looks like a decent effort is [runsnakerun](https://pypi.python.org/pypi/RunSnakeRun). Duplicating that effort for the sage notebook might not seem like such a smart idea. Perhaps we can make the tool more easily accessible from sage? Given that it uses wxPython that might not be so very easily done ... I ended up installing it using OS tools, meaning that I *have* to write the profile data to a file and analyse it separately.\n\nI've seen runsnakerun used in a few places (although I haven't used it myself), and instead of duplicating it in the notebook, perhaps we could link it into sage (notebook) as some type of package? Actually...perhaps what we should do is have a variable/function which calls your favorite profiler on the executed command(s), something like:\n\n```\n%profile\n2 + 2\n```",
    "created_at": "2013-04-03T12:59:59Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38478",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>
Replying to [nbruin](#comment%3A12):
> It's probably outside the scope of this ticket, but the *really* useful thing would be if `%prun ...` in the notebook would return an interactive browser for the `Stat` object that is returned by `cProfile().runctx(...)`. While a basic printout of profiling data gives some indication, one usually needs to dig around a little in the data to find what the real bottleneck is (see where most calls come from, switch between cumulative and proper time, etc.)

+1/2 since being able to read/interpret the raw data is a good skill to have IMO. However a graphical (or at least a tree structure) of the data is also very useful.
> 
> Writing such a browser might be a nice exercise for a student who is interested in interface programming. I bet there are good profiler browsers around to get inspiration from.

+1 here. I feel like we need a wiki page to keep a list of "good student projects"...

> A tool I haven't used yet but looks like a decent effort is [runsnakerun](https://pypi.python.org/pypi/RunSnakeRun). Duplicating that effort for the sage notebook might not seem like such a smart idea. Perhaps we can make the tool more easily accessible from sage? Given that it uses wxPython that might not be so very easily done ... I ended up installing it using OS tools, meaning that I *have* to write the profile data to a file and analyse it separately.

I've seen runsnakerun used in a few places (although I haven't used it myself), and instead of duplicating it in the notebook, perhaps we could link it into sage (notebook) as some type of package? Actually...perhaps what we should do is have a variable/function which calls your favorite profiler on the executed command(s), something like:

```
%profile
2 + 2
```



---

archive/issue_events_037207.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-04T11:46:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37207"
}
```



---

archive/issue_events_037208.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-04T11:46:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37208"
}
```



---

archive/issue_comments_038479.json:
```json
{
    "body": "<a id='comment:15'></a>\nThe first patch isn't a proper HG changeset (patches should be generated using `hg export`, the second patch is fine).",
    "created_at": "2013-04-04T11:46:18Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38479",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
The first patch isn't a proper HG changeset (patches should be generated using `hg export`, the second patch is fine).



---

archive/attachments_006948.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_5814-prun_notebook-combined.patch",
    "asset_url": "tarball://root/attachments/ticket5814/trac_5814-prun_notebook-combined.patch",
    "created_at": "2013-04-04T16:25:46Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-combined.patch",
    "user": "https://github.com/tscrim"
}
```



---

archive/issue_comments_038480.json:
```json
{
    "body": "**Attachment:** [trac_5814-prun_notebook-combined.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-combined.patch)",
    "created_at": "2013-04-04T16:25:46Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38480",
    "user": "https://github.com/tscrim"
}
```

**Attachment:** [trac_5814-prun_notebook-combined.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-combined.patch)



---

archive/issue_events_037209.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-04-04T16:33:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37209"
}
```



---

archive/issue_events_037210.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-04-04T16:33:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37210"
}
```



---

archive/issue_comments_038481.json:
```json
{
    "body": "<a id='comment:16'></a>\nFixed by combining all the patches into one. I hope that's okay.",
    "created_at": "2013-04-04T16:33:13Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38481",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>
Fixed by combining all the patches into one. I hope that's okay.



---

archive/issue_comments_038482.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,6 +2,4 @@\n \n Apply:\n \n-* [attachment:trac_5814_enable_prun_in_notebook.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_enable_prun_in_notebook.patch)\n-* [attachment:trac_5814_add_doctests_to_prun_object.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_add_doctests_to_prun_object.patch)\n-* [attachment:trac_5814-prun_notebook-review-ts.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-review-ts.patch)\n+* [attachment:trac_5814-prun_notebook-combined.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-combined.patch)\n``````\n",
    "created_at": "2013-04-04T16:33:13Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38482",
    "user": "https://github.com/tscrim"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,6 +2,4 @@
 
 Apply:
 
-* [attachment:trac_5814_enable_prun_in_notebook.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_enable_prun_in_notebook.patch)
-* [attachment:trac_5814_add_doctests_to_prun_object.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814_add_doctests_to_prun_object.patch)
-* [attachment:trac_5814-prun_notebook-review-ts.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-review-ts.patch)
+* [attachment:trac_5814-prun_notebook-combined.patch](https://github.com/sagemath/sage/files/ticket5814/trac_5814-prun_notebook-combined.patch)
``````




---

archive/issue_comments_038483.json:
```json
{
    "body": "<a id='comment:17'></a>\nThanks for your work on this, Travis! Your changes look excellent.\n\nI'm kind of surprised that you found 20 function calls where I had 3. I'll try that again later, but I trust you on it.",
    "created_at": "2013-04-05T05:35:34Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38483",
    "user": "https://github.com/tkluck"
}
```

<a id='comment:17'></a>
Thanks for your work on this, Travis! Your changes look excellent.

I'm kind of surprised that you found 20 function calls where I had 3. I'll try that again later, but I trust you on it.



---

archive/issue_comments_038484.json:
```json
{
    "body": "<a id='comment:18'></a>\nThat also seemed to be what the patchbot was getting, but if you're still getting fewer function calls, then we will have to change the test slightly. I'm also running these from the command line where I know the preparser is replacing `1` with `Integer(1)` which is an extra function call. I'm guessing you were doing the testing from the notebook? I'm 99% certain the notebook is doing the same, but it might evaluating these *before* it actually executes the `%prun` test...I'll do some tests later today too.\n\nFor patchbot:\n\nApply: trac_5814-prun_notebook-combined.patch",
    "created_at": "2013-04-05T12:44:12Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38484",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>
That also seemed to be what the patchbot was getting, but if you're still getting fewer function calls, then we will have to change the test slightly. I'm also running these from the command line where I know the preparser is replacing `1` with `Integer(1)` which is an extra function call. I'm guessing you were doing the testing from the notebook? I'm 99% certain the notebook is doing the same, but it might evaluating these *before* it actually executes the `%prun` test...I'll do some tests later today too.

For patchbot:

Apply: trac_5814-prun_notebook-combined.patch



---

archive/issue_comments_038485.json:
```json
{
    "body": "<a id='comment:19'></a>\nIn the notebook I get 3 function calls\n\n```\n         3 function calls in 0.007 seconds\n\n   Ordered by: standard name\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n        1    0.007    0.007    0.007    0.007 <string>:1(<module>)\n        1    0.000    0.000    0.000    0.000 {len}\n        1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}\n```\nwith the command line:\n\n```\n         3 function calls in 0.000 seconds\n\n   Ordered by: standard name\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n        1    0.000    0.000    0.000    0.000 <string>:1(<module>)\n        1    0.000    0.000    0.000    0.000 {len}\n        1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}\n```\nSo it's something specific to the doctesting framework that's not reflected in sage while it's directly running (I've noticed this in a few other places before too).",
    "created_at": "2013-04-05T15:35:59Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38485",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>
In the notebook I get 3 function calls

```
         3 function calls in 0.007 seconds

   Ordered by: standard name

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1    0.007    0.007    0.007    0.007 <string>:1(<module>)
        1    0.000    0.000    0.000    0.000 {len}
        1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}
```
with the command line:

```
         3 function calls in 0.000 seconds

   Ordered by: standard name

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1    0.000    0.000    0.000    0.000 <string>:1(<module>)
        1    0.000    0.000    0.000    0.000 {len}
        1    0.000    0.000    0.000    0.000 {method 'disable' of '_lsprof.Profiler' objects}
```
So it's something specific to the doctesting framework that's not reflected in sage while it's directly running (I've noticed this in a few other places before too).



---

archive/issue_events_037211.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-06T14:50:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37211"
}
```



---

archive/issue_events_037212.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-06T14:50:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/5814#event-37212"
}
```



---

archive/issue_comments_038486.json:
```json
{
    "body": "**Merged:** sage-5.9.beta4",
    "created_at": "2013-04-06T14:50:17Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38486",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.9.beta4



---

archive/issue_comments_038487.json:
```json
{
    "body": "<a id='comment:21'></a>\nDoes this actually work in the notebook?  (Sometimes Ipython upgrades cause trouble with such magic.)  I just get\n\n```\nNameError: name 'prun' is not defined\n```\nin 6.3 and 6.4.beta6.",
    "created_at": "2014-10-22T16:24:16Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38487",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:21'></a>
Does this actually work in the notebook?  (Sometimes Ipython upgrades cause trouble with such magic.)  I just get

```
NameError: name 'prun' is not defined
```
in 6.3 and 6.4.beta6.



---

archive/issue_comments_038488.json:
```json
{
    "body": "<a id='comment:22'></a>\nI'm almost sure it did...but it's been so long that I can be certain. Considering we were using iPython 0.13 or something like that at the time, I wouldn't be surprised if something broke along the way.",
    "created_at": "2014-10-22T18:49:12Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38488",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:22'></a>
I'm almost sure it did...but it's been so long that I can be certain. Considering we were using iPython 0.13 or something like that at the time, I wouldn't be surprised if something broke along the way.



---

archive/issue_comments_038489.json:
```json
{
    "body": "<a id='comment:23'></a>\nDoes it work for you now?",
    "created_at": "2014-10-22T19:00:42Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38489",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:23'></a>
Does it work for you now?



---

archive/issue_comments_038490.json:
```json
{
    "body": "<a id='comment:24'></a>\nNope.",
    "created_at": "2014-10-22T19:09:18Z",
    "issue": "https://github.com/sagemath/sage/issues/5814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/5814#issuecomment-38490",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'></a>
Nope.
