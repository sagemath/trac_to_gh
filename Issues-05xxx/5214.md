# Issue 5214: [fixed by #5508] coercion to orders in relative number fields is not implemented

archive/issues_005214.json:
```json
{
    "body": "\n```\nsage: t = OK.basis()[0]\nsage: x = ZZ['x'].0\nsage: K.<a,b> = NumberField([x^2 + 1, x^2 - 3])\nsage: OK = K.maximal_order(); OK.basis()                                                                                          \n[1, 1/2*a - 1/2*b, -1/2*b*a + 1/2, a]\nsage: OK(a)\nERROR: An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: ('EOF in multi-line statement', (363, 0))\n\nERROR: An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: ('EOF in multi-line statement', (1152, 0))\n\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/ncalexan/.sage/temp/sage.math.washington.edu/21534/_home_ncalexan__sage_init_sage_0.py in <module>()\n\n/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/order.pyc\\\n in `__call__`(self, x)\n   1192         if x.parent() is not self._K:\n   1193             x = self._K(x)\n-> 1194         x = self._absolute_order(x) # will test membership\n   1195         return OrderElement_relative(self, x)\n   1196\n\n/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/order.pyc\\\n in `__call__`(self, x)\n    900             return x\n    901         if not is_Element(x) or x.parent() is not self._K:\n--> 902             x = self._K(x)\n    903         V, _, embedding = self._K.vector_space()\n    904         if not embedding(x) in self._module_rep:\n\n/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/structure/parent.so in sage.\\\nstructure.parent.Parent.__call__ (sage/structure/parent.c:3653)()\n\n/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/structure/coerce_maps.so in \\\nsage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:2793)()\n\n/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/structure/coerce_maps.so in \\\nsage.structure.coerce_maps._call_ (sage/structure/coerce_maps.c:2700)()\n\n/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/number_fi\\\neld.pyc in `_element_constructor_`(self, x)\n    829                     return self._element_class(self, x)\n    830                 x = L(x)\n--> 831             return self._coerce_from_other_number_field(x)\n    832         elif isinstance(x,str):\n    833             return self._coerce_from_str(x)\n\n/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/number_fi\\\neld.pyc in `_coerce_from_other_number_`field(self, x)\n   3560             return self._element_class(self, f[0])\n   3561         # todo: more general coercion if embedding have been asserted\n-> 3562         raise TypeError, \"Cannot coerce element into this number field\"\n   3563\n   3564     def `_coerce_non_number_field_element_`in(self, x):\n\nTypeError: Cannot coerce element into this number field\nOK(b)\nERROR: An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: ('EOF in multi-line statement', (363, 0))\n\nERROR: An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: ('EOF in multi-line statement', (1152, 0))\n\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/ncalexan/.sage/temp/sage.math.washington.edu/21534/_home_ncalexan__sage_init_sage_0.py in <module>()\n\n/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/order.pyc\\\n in `__call__`(self, x)\n   1192         if x.parent() is not self._K:\n   1193             x = self._K(x)\n-> 1194         x = self._absolute_order(x) # will test membership\n   1195         return OrderElement_relative(self, x)\n   1196\n\n/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/order.pyc\\\n in `__call__`(self, x)\n    900             return x\n    901         if not is_Element(x) or x.parent() is not self._K:\n--> 902             x = self._K(x)\n    903         V, _, embedding = self._K.vector_space()\n    904         if not embedding(x) in self._module_rep:\n\n/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/structure/parent.so in sage.\\\nstructure.parent.Parent.__call__ (sage/structure/parent.c:3653)()\n\n/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/structure/coerce_maps.so in \\\nsage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:2793)()\n\n/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/structure/coerce_maps.so in \\\nsage.structure.coerce_maps._call_ (sage/structure/coerce_maps.c:2700)()\n\n/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/number_fi\\\neld.pyc in `_element_constructor_`(self, x)\n    829                     return self._element_class(self, x)\n    830                 x = L(x)\n--> 831             return self._coerce_from_other_number_field(x)\n    832         elif isinstance(x,str):\n    833             return self._coerce_from_str(x)\n\n/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/number_fi\\\neld.pyc in `_coerce_from_other_number_`field(self, x)\n/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/number_fi\\\neld.pyc in `_coerce_from_other_number_`field(self, x)\n   3560             return self._element_class(self, f[0])\n   3561         # todo: more general coercion if embedding have been asserted\n-> 3562         raise TypeError, \"Cannot coerce element into this number field\"\n   3563\n   3564     def `_coerce_non_number_field_element_`in(self, x):\n\nTypeError: Cannot coerce element into this number field\nsage: OK.basis()[3].list()\n[0, 1]\nsage: OK(OK.basis()[3].list())\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n\n/home/ncalexan/.sage/temp/sage.math.washington.edu/21534/_home_ncalexan__sage_init_sage_0.py in <module>()\n\n/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/order.pyc\\\n in `__call__`(self, x)\n   1190         Coerce an element into this relative order.\n   1191         \"\"\"                                                                                                               \n-> 1192         if x.parent() is not self._K:                                                                                     \n   1193             x = self._K(x)                                                                                                \n   1194         x = self._absolute_order(x) # will test membership                                                                \n                                                                                                                                  \nAttributeError: 'list' object has no attribute 'parent'                                      \n```                                    \n\n**Assignee:** @williamstein\n\n**CC:**  @robertwb\n\n**Keywords:** relative order number field coercion\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/5214\n\n",
    "closed_at": "2009-03-26T20:35:55Z",
    "created_at": "2009-02-09T05:34:51Z",
    "labels": [
        "component: number theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.4.1",
    "title": "[fixed by #5508] coercion to orders in relative number fields is not implemented",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/5214",
    "user": "https://github.com/ncalexan"
}
```

```
sage: t = OK.basis()[0]
sage: x = ZZ['x'].0
sage: K.<a,b> = NumberField([x^2 + 1, x^2 - 3])
sage: OK = K.maximal_order(); OK.basis()                                                                                          
[1, 1/2*a - 1/2*b, -1/2*b*a + 1/2, a]
sage: OK(a)
ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (363, 0))

ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (1152, 0))

---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/ncalexan/.sage/temp/sage.math.washington.edu/21534/_home_ncalexan__sage_init_sage_0.py in <module>()

/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/order.pyc\
 in `__call__`(self, x)
   1192         if x.parent() is not self._K:
   1193             x = self._K(x)
-> 1194         x = self._absolute_order(x) # will test membership
   1195         return OrderElement_relative(self, x)
   1196

/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/order.pyc\
 in `__call__`(self, x)
    900             return x
    901         if not is_Element(x) or x.parent() is not self._K:
--> 902             x = self._K(x)
    903         V, _, embedding = self._K.vector_space()
    904         if not embedding(x) in self._module_rep:

/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/structure/parent.so in sage.\
structure.parent.Parent.__call__ (sage/structure/parent.c:3653)()

/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/structure/coerce_maps.so in \
sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:2793)()

/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/structure/coerce_maps.so in \
sage.structure.coerce_maps._call_ (sage/structure/coerce_maps.c:2700)()

/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/number_fi\
eld.pyc in `_element_constructor_`(self, x)
    829                     return self._element_class(self, x)
    830                 x = L(x)
--> 831             return self._coerce_from_other_number_field(x)
    832         elif isinstance(x,str):
    833             return self._coerce_from_str(x)

/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/number_fi\
eld.pyc in `_coerce_from_other_number_`field(self, x)
   3560             return self._element_class(self, f[0])
   3561         # todo: more general coercion if embedding have been asserted
-> 3562         raise TypeError, "Cannot coerce element into this number field"
   3563
   3564     def `_coerce_non_number_field_element_`in(self, x):

TypeError: Cannot coerce element into this number field
OK(b)
ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (363, 0))

ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (1152, 0))

---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/ncalexan/.sage/temp/sage.math.washington.edu/21534/_home_ncalexan__sage_init_sage_0.py in <module>()

/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/order.pyc\
 in `__call__`(self, x)
   1192         if x.parent() is not self._K:
   1193             x = self._K(x)
-> 1194         x = self._absolute_order(x) # will test membership
   1195         return OrderElement_relative(self, x)
   1196

/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/order.pyc\
 in `__call__`(self, x)
    900             return x
    901         if not is_Element(x) or x.parent() is not self._K:
--> 902             x = self._K(x)
    903         V, _, embedding = self._K.vector_space()
    904         if not embedding(x) in self._module_rep:

/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/structure/parent.so in sage.\
structure.parent.Parent.__call__ (sage/structure/parent.c:3653)()

/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/structure/coerce_maps.so in \
sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:2793)()

/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/structure/coerce_maps.so in \
sage.structure.coerce_maps._call_ (sage/structure/coerce_maps.c:2700)()

/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/number_fi\
eld.pyc in `_element_constructor_`(self, x)
    829                     return self._element_class(self, x)
    830                 x = L(x)
--> 831             return self._coerce_from_other_number_field(x)
    832         elif isinstance(x,str):
    833             return self._coerce_from_str(x)

/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/number_fi\
eld.pyc in `_coerce_from_other_number_`field(self, x)
/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/number_fi\
eld.pyc in `_coerce_from_other_number_`field(self, x)
   3560             return self._element_class(self, f[0])
   3561         # todo: more general coercion if embedding have been asserted
-> 3562         raise TypeError, "Cannot coerce element into this number field"
   3563
   3564     def `_coerce_non_number_field_element_`in(self, x):

TypeError: Cannot coerce element into this number field
sage: OK.basis()[3].list()
[0, 1]
sage: OK(OK.basis()[3].list())
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/home/ncalexan/.sage/temp/sage.math.washington.edu/21534/_home_ncalexan__sage_init_sage_0.py in <module>()

/scratch/ncalexan/sage-3.3.alpha5-sage.math-only-x86_64-Linux/local/lib/python2.5/site-packages/sage/rings/number_field/order.pyc\
 in `__call__`(self, x)
   1190         Coerce an element into this relative order.
   1191         """                                                                                                               
-> 1192         if x.parent() is not self._K:                                                                                     
   1193             x = self._K(x)                                                                                                
   1194         x = self._absolute_order(x) # will test membership                                                                
                                                                                                                                  
AttributeError: 'list' object has no attribute 'parent'                                      
```                                    

**Assignee:** @williamstein

**CC:**  @robertwb

**Keywords:** relative order number field coercion

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/5214





---

archive/issue_comments_047543.json:
```json
{
    "body": "<a id='comment:1'></a>\n3.4 is mostly about the ReST patches. Once those are in we will likely cut 3.4 as a release and then quickly open 3.4.1 to merge fixes on top of the ReST code.\n\nCheers,\n\nMichael",
    "created_at": "2009-02-09T06:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5214#issuecomment-47543",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:1'></a>
3.4 is mostly about the ReST patches. Once those are in we will likely cut 3.4 as a release and then quickly open 3.4.1 to merge fixes on top of the ReST code.

Cheers,

Michael



---

archive/issue_events_015698.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-02-09T06:02:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5214",
    "milestone": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5214#event-15698"
}
```



---

archive/issue_events_015699.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/5214",
    "rename": {
        "from": "coercion to orders in relative number fields is not implemented",
        "to": "[fixed subject to review of #5508] coercion to orders in relative number fields is not implemented"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5214#event-15699"
}
```



---

archive/issue_comments_047544.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe problem is solved by changes to `__call__` for the class `RelativeOrder` in `sage/rings/number_theory/order.py` to be found in #5508.",
    "created_at": "2009-03-13T19:03:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5214#issuecomment-47544",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:2'></a>
The problem is solved by changes to `__call__` for the class `RelativeOrder` in `sage/rings/number_theory/order.py` to be found in #5508.



---

archive/issue_events_015700.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/5214",
    "rename": {
        "from": "[fixed subject to review of #5508] coercion to orders in relative number fields is not implemented",
        "to": "[fixed by #5508] coercion to orders in relative number fields is not implemented"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5214#event-15700"
}
```



---

archive/issue_comments_047545.json:
```json
{
    "body": "<a id='comment:3'></a>\nTo close this we would need a doctest.\n\nCheers,\n\nMichael",
    "created_at": "2009-03-25T08:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5214#issuecomment-47545",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:3'></a>
To close this we would need a doctest.

Cheers,

Michael



---

archive/issue_events_015701.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-03-25T08:56:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5214",
    "milestone": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5214#event-15701"
}
```



---

archive/issue_events_015702.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-03-25T08:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/5214",
    "milestone": "sage-3.4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5214#event-15702"
}
```



---

archive/issue_comments_047546.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [mabshoff](#comment%3A3):\n> To close this we would need a doctest.\n\n\nSee lines 1194 to 1199 of sage/rings/number_field/order.py as patched by \n#5508:\n\n```\n            sage: K.<a, b> = NumberField([x^2 + 2, x^2 + 1000*x + 1]) \n            sage: OK = K.ring_of_integers()\n            sage: OK(a)\n            sage: a\n            sage: OK([3, 4])\n            4*a + 3\n```",
    "created_at": "2009-03-26T08:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5214#issuecomment-47546",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:5'></a>
Replying to [mabshoff](#comment%3A3):
> To close this we would need a doctest.


See lines 1194 to 1199 of sage/rings/number_field/order.py as patched by 
#5508:

```
            sage: K.<a, b> = NumberField([x^2 + 2, x^2 + 1000*x + 1]) 
            sage: OK = K.ring_of_integers()
            sage: OK(a)
            sage: a
            sage: OK([3, 4])
            4*a + 3
```



---

archive/issue_comments_047547.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2009-03-26T20:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5214#issuecomment-47547",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Resolution:** fixed



---

archive/issue_events_015703.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-03-26T20:35:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/5214",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/5214#event-15703"
}
```



---

archive/issue_comments_047548.json:
```json
{
    "body": "<a id='comment:6'></a>\nFixed in Sage 3.4.1.alpha0 via #5508. Thanks Francis :)\n\nCheers,\n\nMichael",
    "created_at": "2009-03-26T20:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/5214",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/5214#issuecomment-47548",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:6'></a>
Fixed in Sage 3.4.1.alpha0 via #5508. Thanks Francis :)

Cheers,

Michael
