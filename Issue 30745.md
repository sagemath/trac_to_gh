# Issue 30745: Preparse `!` for factorial

Issue created by migration from https://trac.sagemath.org/ticket/30982

Original creator: slelievre

Original creation time: 2020-11-30 14:16:31

CC:  slelievre jipilab

Keywords: factorial

Other math software accept input such as `5!` for `factorial(5)`.

Tentatively `!` could be preparsed to `.factorial()`.

Thorny points: strings, f-strings.


```
sage: n = 5
sage: n!
120
sage: "n!"
'n!'
sage: f"{n}! equals {n!}"
'5! equals 120'
```


Discussion:

- [sage-support 2020-11 discussion on preparsing ! for factorial](https://groups.google.com/g/sage-support/c/z2ym6Bm4OzE)



---

Comment by slelievre created at 2020-11-30 14:23:44

Regarding `!=`, thankfully,

- equality is `==`
- non-equality is `!=`
- there is no `!==`
- one cannot assign to an expression

Example with `!=`:

- `x+3!=9` must mean `(x + 3) != 9`, i.e.,
  it must mean `x + 3` not equal to `9`
- writing `x + (3!) = 9` would be incorrect,
  as we cannot assign to `x + 6`
- no risk of confusion with `x + (3!) == 9`

Example with `!==`:

- `x+3!==9` must mean `x + (3!) == 9`, i.e.,
  it must mean `x + 6` equal to `9`
- writing `(x + 3) !== 9` would be incorrect
- writing `(x + 3) != = 9` would be incorrect


---

Comment by nbruin created at 2020-12-01 01:32:22

More concisely: Only preparse "!" in situations where it's a syntax error in python. As far as I can see, the only valid use of "!" in python presently is in "!=" (no space allowed in between). The problem with f-strings is more universally a problem in the preparser. I think our first approximation, which is consistent with an f-string-unaware preparser, is to NOT parse f"{3!}". In fact, f-strings are a general concern for the preparser, not an issue unique to "!". There's probably already a ticket for it.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.
