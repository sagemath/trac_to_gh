# Issue 21584: Do not hardcode location to pari.desc

Issue created by migration from https://trac.sagemath.org/ticket/21821

Original creator: jdemeyer

Original creation time: 2016-11-04 15:01:08

CC:  defeo




---

Comment by jdemeyer created at 2016-11-04 18:26:20

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2016-11-04 18:26:20

New commits:


---

Comment by git created at 2016-11-07 16:37:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-11-07 18:19:16

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-11-07 18:25:53

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-11-07 18:29:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2016-11-07 18:29:32

Changing status from needs_work to needs_review.


---

Comment by embray created at 2016-11-08 11:14:36

I think the `pari_share()` makes sense--I like that it uses whatever the appropriate `gp` is to get the right path.  Though I think this would make sense to have somewhere in sage itself, and be stored as a variable in `sage.env`, not just as a one-off in this code.

I don't think the change to `sage_src_pari()` makes sense because it makes the assumption that the code is being run directly from the sage source tree.  Of course, that's the typical case. But the code is not otherwise designed in such a way that that _must_ be the case, nor do I think it necessarily should be.  I like the way it was done better.


---

Comment by jdemeyer created at 2016-11-08 13:02:18

So, what is your solution for `sage_src_pari()` which would be compatible with #21613?


---

Comment by jdemeyer created at 2016-11-08 13:07:41

Replying to [comment:13 embray]:
> I don't think the change to `sage_src_pari()` makes sense because it makes the assumption that the code is being run directly from the sage source tree.

Let me clarify: that code is only meant to be run during the _build_ of Sage. And I do think it is a reasonable assumption that the current working directory at build time is the  source directory (*). Most `setup.py` files make that assumption, so if you see this `sage_setup` stuff as an extension of `setup.py`, it makes perfect sense.

(*) To be very precise, let's define the source directory as the directory containing `setup.py`, which is `$SAGE_SRC = $SAGE_ROOT/src` in Sage.


---

Comment by embray created at 2016-11-08 14:31:18

Hmm, I agree with you, but what bothers me then is that `sage_setup` is _installed_ at all, if it's only meant as a supplement to `setup.py` (and that being the case, we could also vastly simplify the `setup.py` by moving things like distutils commands into `sage_setup` as well, which wouldn't be a bad idea anyways).

To follow up, I feel like if `sage_setup` can be installed, then it should also in principle work outside a build context.  I think it would be better if it simply weren't installed at all, but I think there are reasons it is--especially for `sage_setup.docbuild` (but then maybe that should be moved either into the `sage` package itself, or into its own package).


---

Comment by embray created at 2016-11-08 14:36:09

Put another way, I'm not sure what the advantage is to _not_ using `SAGE_SRC` here unless everything in `sage_setup` is consistently designed to only be used at build time.


---

Comment by jdemeyer created at 2016-11-08 14:37:46

Maybe `sage_setup` is installed just for testing, such that it can be imported in doctests?


---

Comment by jdemeyer created at 2016-11-08 14:40:21

`sage_setup` was created in #16431. Already there, it was installed.


---

Comment by jdemeyer created at 2016-11-08 14:43:06

Replying to [comment:17 embray]:
> Put another way, I'm not sure what the advantage is to _not_ using `SAGE_SRC` here

I see it as part of push towards less Sage-specific things in the Sage build system, see also #15105 and #21507 in general.


---

Comment by embray created at 2016-11-08 14:59:50

Ok, I think I agree in general.  I _don't_ think `sage_setup` should be installed at all, at least not by default.  I'll open a new issue for that.


---

Comment by embray created at 2016-11-08 14:59:50

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-11-09 18:16:10

Resolution: fixed


---

Comment by chapoton created at 2016-11-13 18:30:53

The following line that was added here is apparently not compatible with python 3:

```
out = gp.communicate("print(default(datadir))")[0]
```

See https://groups.google.com/forum/#!topic/sage-devel/eSYPSfZOb9k


---

Comment by dimpase created at 2016-11-13 20:53:19

Replying to [comment:23 chapoton]:

yes, it should be bytes, not string, i.e. try this:

```
out = gp.communicate(b'print(default(datadir))')[0]
```


(don't know how to make this version-agnostic...)


---

Comment by defeo created at 2016-11-13 21:07:11

The `b""` syntax is supported in Python 2.7.


---

Comment by dimpase created at 2016-11-13 21:42:12

Replying to [comment:25 defeo]:
> The `b""` syntax is supported in Python 2.7.
Ah, OK, it has no effect in Python2. Yes, this would be the good fix then.


---

Comment by jdemeyer created at 2016-11-13 22:49:29

I created #21874.
