# Issue 16142: Compute Hasse invariant over number fields and fix current implementation

Issue created by migration from https://trac.sagemath.org/ticket/16379

Original creator: annahaensch

Original creation time: 2014-05-20 09:25:46

This patch will enhance the current functions hasse_invariant and hasse_invariant_OMeara to include computations of Hasse invariant for quadratic forms over number fields.  In addition, this patch fixes an indexing error in the original hasse_invariant_OMeara code, which currently reads

```
for j in range(n-1):
    for k in range(j, n):
```

but should read 

```
for j in range(n):
    for k in range(j, n):
```

to be consistent with OMeara's algorithm. 


---

Comment by git created at 2014-05-21 09:33:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by annahaensch created at 2014-05-21 09:44:26

Changing status from new to needs_review.


---

Comment by pbruin created at 2014-05-23 10:03:53

Looks good to me except for two minor points:
- it is best to keep existing doctests as far as possible; only add new ones, and fix old ones if necessary instead of replacing them;
- your patch introduces trailing whitespace on several lines (use e.g. `git diff --color develop...YOURBRANCH` to see this); this is discouraged, so could you remove it if and when you make another commit?
(The patchbot encountered a doctest failure on 6.3.beta1, but it seems to be unrelated to your patch.)


---

Comment by git created at 2014-05-23 11:48:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pbruin created at 2014-05-23 12:53:51

Coming back to this point:
> - it is best to keep existing doctests as far as possible; only add new ones, and fix old ones if necessary instead of replacing them;
I now see that there were two identical doctests (with `DiagonalQuadraticForm(ZZ, [1, -1, -1])`) and you changed `[1, -1, -1]` to `[1, -1, 5]` in both of them.  Could you change one of them back to `[1, -1, -1]`?  Then we get both your new doctest and the old one, instead of duplicates.


---

Comment by git created at 2014-05-23 13:45:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-05-23 13:49:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pbruin created at 2014-05-23 14:28:26

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-05-25 10:09:20

Resolution: fixed
