# Issue 25675: Infinite loop in pkg-config

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2018-07-24 09:42:28

CC:  embray

Under some circumstances, `pkg-config` ends up executing itself.

This is the file `/home/jdemeyer/sage-test/local/bin/pkg-config`:
{{{#!/usr/bin/env bash

if [ -z "$SAGE_LOCAL" ]; then
    echo >&2 "This script requires that SAGE_LOCAL is set."
    exit 1
fi

if [ -z "$PKG_CONFIG_PATH" ]; then
    export PKG_CONFIG_PATH="$SAGE_LOCAL/lib/pkgconfig:$SAGE_LOCAL/share/pkgconfig"
else
    export PKG_CONFIG_PATH="$SAGE_LOCAL/lib/pkgconfig:$SAGE_LOCAL/share/pkgconfig:$PKG_CONFIG_PATH"
fi



exec /home/jdemeyer/sage-test/local/bin/pkg-config "$`@`"
```



---

Comment by embray created at 2018-07-24 10:13:56

The problem is that the m4 template that generates `$SAGE_LOCAL/bin/pkg-config` uses `command -v pkg-config` to get the path to the "actual" `pkg-config`, which ends up being a self-reference if `$SAGE_LOCAL/bin/pkg-config` is already installed (which it shouldn't be, but it could be if something went wrong cleaning/upgrading the pkgconf spkg).

An easy workaround is to just make absolutely sure to remove `$SAGE_LOCAL/bin/pkg-config`.


---

Comment by embray created at 2018-07-24 10:18:18

New commits:


---

Comment by embray created at 2018-07-24 10:18:18

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-07-24 10:43:19

You should bump the version again...


---

Comment by jdemeyer created at 2018-07-24 10:43:19

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2018-07-24 10:45:09

Minor nitpick: why call the temporary file `pkg-config.out`? I would prefer the final name `pkg-config` there.


---

Comment by embray created at 2018-07-24 12:34:05

It's the way it's been for a long time.  I don't care either way.


---

Comment by embray created at 2018-07-24 12:40:09

Apparently this was done for a reason, in #16274.  I don't know if that reason still applies (I suspect not) but I'm not in a hurry to find out.


---

Comment by git created at 2018-07-24 12:42:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-07-24 12:42:41

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2018-07-24 20:51:16

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2018-07-24 20:53:43

I doubt that the milestone actually matters, but let's be safe.


---

Comment by embray created at 2018-07-25 13:27:57

I agree this should probably be fixed for 8.3.  I _think_ an incremental upgrade direct from 8.2 to 8.3.rc2 should go smoothly, although I have not tested this.  But if someone is upgrading from a random earlier 8.3 beta or something it might not.  Fixing this now would head off a lot of likely support requests / failure reports, I suspect.

But I don't consider it a total blocker either, so I leave that up to Volker.


---

Comment by vbraun created at 2018-07-27 23:06:02

Resolution: fixed
