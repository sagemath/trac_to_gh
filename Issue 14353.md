# Issue 14353: doctesting framework doesn't properly handle atexit

Issue created by migration from Trac.

Original creator: ohanar

Original creation time: 2013-05-09 00:03:19

Assignee: roed

CC:  jdemeyer roed

any commands that are registered through atexit are not run if they are called through a `DocTestWorker`.

For example

```python
sage: import atexit, shutil, tempfile
sage: atexit.register(shutil.rmtree, tempfile.mkdtemp())
```

leaves a temporary file behind when run through the doctesting framework when there shouldn't be (the behaviour that you get when you run the same commands through the sage command line).


---

Comment by jdemeyer created at 2013-05-09 07:42:53

I guess the bug is really that Python's `multiprocess.Process()` instances don't call atexit handlers when they die.


---

Comment by jdemeyer created at 2013-05-09 07:54:37

Working on a patch...


---

Comment by jdemeyer created at 2013-05-09 08:09:19

Changing status from new to needs_review.


---

Comment by ohanar created at 2013-05-09 19:09:45

Changing status from needs_review to needs_work.


---

Comment by ohanar created at 2013-05-09 19:09:45

when not running long doctests the second `os.path.isfile(F)` will fail, otherwise this looks good


---

Attachment


---

Comment by jdemeyer created at 2013-05-10 08:25:28

Changing status from needs_work to needs_review.


---

Comment by ohanar created at 2013-05-10 22:53:43

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-05-13 13:27:40

Resolution: fixed
