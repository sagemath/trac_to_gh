# Issue 12426: Change Sage process name

archive/issues_012426.json:
```json
{
    "body": "Assignee: tbd\n\nSage's process name should be changed (now \"python\") so that it can be identified and terminated separately from other Python instances, if needed. See https://groups.google.com/forum/?fromgroups#!topic/sage-devel/BVGHgi40OvA\n\nIssue created by migration from https://trac.sagemath.org/ticket/12598\n\n",
    "created_at": "2012-02-27T04:29:04Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "PLEASE CHANGE"
    ],
    "title": "Change Sage process name",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12426",
    "user": "eviatarbach"
}
```
Assignee: tbd

Sage's process name should be changed (now "python") so that it can be identified and terminated separately from other Python instances, if needed. See https://groups.google.com/forum/?fromgroups#!topic/sage-devel/BVGHgi40OvA

Issue created by migration from https://trac.sagemath.org/ticket/12598





---

archive/issue_comments_146789.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to scripts.",
    "created_at": "2012-02-27T06:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146789",
    "user": "ppurka"
}
```

Changing component from PLEASE CHANGE to scripts.



---

archive/issue_comments_146790.json:
```json
{
    "body": "This is not so simple. How would you ensure that the child processes are also cleaned up when you kill the Sage process?",
    "created_at": "2012-02-27T06:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146790",
    "user": "ppurka"
}
```

This is not so simple. How would you ensure that the child processes are also cleaned up when you kill the Sage process?



---

archive/issue_comments_146791.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2012-02-27T06:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146791",
    "user": "ppurka"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_146792.json:
```json
{
    "body": "Changing assignee from tbd to leif.",
    "created_at": "2012-02-27T06:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146792",
    "user": "ppurka"
}
```

Changing assignee from tbd to leif.



---

archive/issue_comments_146793.json:
```json
{
    "body": "How is that related to this ticket? If there is some problem with Sage not killing its child processes when it dies, then that will exist regardless of whether the Sage processes are named \"python\" or something else. No?",
    "created_at": "2012-02-27T06:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146793",
    "user": "kini"
}
```

How is that related to this ticket? If there is some problem with Sage not killing its child processes when it dies, then that will exist regardless of whether the Sage processes are named "python" or something else. No?



---

archive/issue_comments_146794.json:
```json
{
    "body": "Replying to [comment:2 kini]:\n> How is that related to this ticket? If there is some problem with Sage not killing its child processes when it dies, then that will exist regardless of whether the Sage processes are named \"python\" or something else. No?\n\nWell if the child processes are not killed, it defeats the main purpose of this ticket. The eventual use of this ticket is to be able to identify a Sage process and kill it remotely/automatically (as in from a command line) instead of having to go through a manual process.\n\nIf we only rename the Sage process, which shouldn't be too hard to do, then the user will be under a false impression when it is terminated but there are other child processes running amok.",
    "created_at": "2012-02-27T07:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146794",
    "user": "ppurka"
}
```

Replying to [comment:2 kini]:
> How is that related to this ticket? If there is some problem with Sage not killing its child processes when it dies, then that will exist regardless of whether the Sage processes are named "python" or something else. No?

Well if the child processes are not killed, it defeats the main purpose of this ticket. The eventual use of this ticket is to be able to identify a Sage process and kill it remotely/automatically (as in from a command line) instead of having to go through a manual process.

If we only rename the Sage process, which shouldn't be too hard to do, then the user will be under a false impression when it is terminated but there are other child processes running amok.



---

archive/issue_comments_146795.json:
```json
{
    "body": "It seems that renaming the process doesn't actually fool `killall` (on Linux): `killall sage` doesn't work, even if `argv[0]` of that process is `sage` and `ps` also shows `sage`. It seems that `killall` uses the actual filename of the executable.",
    "created_at": "2013-05-22T09:56:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146795",
    "user": "jdemeyer"
}
```

It seems that renaming the process doesn't actually fool `killall` (on Linux): `killall sage` doesn't work, even if `argv[0]` of that process is `sage` and `ps` also shows `sage`. It seems that `killall` uses the actual filename of the executable.



---

archive/issue_comments_146796.json:
```json
{
    "body": "Attachment [12598_argv0.patch](tarball://root/attachments/some-uuid/ticket12598/12598_argv0.patch) by jdemeyer created at 2013-05-22 09:56:53",
    "created_at": "2013-05-22T09:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146796",
    "user": "jdemeyer"
}
```

Attachment [12598_argv0.patch](tarball://root/attachments/some-uuid/ticket12598/12598_argv0.patch) by jdemeyer created at 2013-05-22 09:56:53



---

archive/issue_comments_146797.json:
```json
{
    "body": "Attachment [12598_notebook_no_banner.patch](tarball://root/attachments/some-uuid/ticket12598/12598_notebook_no_banner.patch) by jdemeyer created at 2013-05-22 09:57:02",
    "created_at": "2013-05-22T09:57:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146797",
    "user": "jdemeyer"
}
```

Attachment [12598_notebook_no_banner.patch](tarball://root/attachments/some-uuid/ticket12598/12598_notebook_no_banner.patch) by jdemeyer created at 2013-05-22 09:57:02



---

archive/issue_comments_146798.json:
```json
{
    "body": "Great! This [StackOverflow answer](http://stackoverflow.com/questions/564695/is-there-a-way-to-change-effective-process-name-in-python/923034#923034) claims that it should be possible to change a Python process name such that it works with `killall`; do you think this could be done with Sage as well? In any case, I think changing the name would be valuable anyway, so that it is distinguishable from other Python instances.",
    "created_at": "2013-05-22T18:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146798",
    "user": "eviatarbach"
}
```

Great! This [StackOverflow answer](http://stackoverflow.com/questions/564695/is-there-a-way-to-change-effective-process-name-in-python/923034#923034) claims that it should be possible to change a Python process name such that it works with `killall`; do you think this could be done with Sage as well? In any case, I think changing the name would be valuable anyway, so that it is distinguishable from other Python instances.



---

archive/issue_comments_146799.json:
```json
{
    "body": "Well, that stackoverflow answer is Linux-specific, so I guess it's useless for Sage.\n\nI have doubts that changing the name would be useful, if it doesn't work with `killall`.",
    "created_at": "2013-05-22T19:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146799",
    "user": "jdemeyer"
}
```

Well, that stackoverflow answer is Linux-specific, so I guess it's useless for Sage.

I have doubts that changing the name would be useful, if it doesn't work with `killall`.



---

archive/issue_comments_146800.json:
```json
{
    "body": "Replying to [comment:4 jdemeyer]:\n> It seems that renaming the process doesn't actually fool `killall` (on Linux): `killall sage` doesn't work, even if `argv[0]` of that process is `sage` and `ps` also shows `sage`. It seems that `killall` uses the actual filename of the executable.\n\nCorrect. According to [killall.c](http://sourceforge.net/p/psmisc/code/ci/master/tree/src/killall.c), it seems killall looks for the program name in `/proc/<PID>/stat`, and the name there apparently doesn't need to be the same as in `/proc/<PID>/cmdline`.\n\nThis actually causes nasty behaviour for `killall -e` (exist match, not just on first 15 characters), because that does go looking for confirmation in `/proc/<PID>/cmdline`, so if the first 15 characters there don't match then `killall -e` will never work.\n\nNote that `sh mylittlescript` does succeed in getting `mylittlescript` into `stat` so there is a way for executables to let the name in `stat` be different from the executable name. In those cases, `sh` is part of `cmdline`, so `killall -e` is smart enough to go looking in later parts of `cmdline` as well.",
    "created_at": "2013-05-22T19:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146800",
    "user": "nbruin"
}
```

Replying to [comment:4 jdemeyer]:
> It seems that renaming the process doesn't actually fool `killall` (on Linux): `killall sage` doesn't work, even if `argv[0]` of that process is `sage` and `ps` also shows `sage`. It seems that `killall` uses the actual filename of the executable.

Correct. According to [killall.c](http://sourceforge.net/p/psmisc/code/ci/master/tree/src/killall.c), it seems killall looks for the program name in `/proc/<PID>/stat`, and the name there apparently doesn't need to be the same as in `/proc/<PID>/cmdline`.

This actually causes nasty behaviour for `killall -e` (exist match, not just on first 15 characters), because that does go looking for confirmation in `/proc/<PID>/cmdline`, so if the first 15 characters there don't match then `killall -e` will never work.

Note that `sh mylittlescript` does succeed in getting `mylittlescript` into `stat` so there is a way for executables to let the name in `stat` be different from the executable name. In those cases, `sh` is part of `cmdline`, so `killall -e` is smart enough to go looking in later parts of `cmdline` as well.



---

archive/issue_comments_146801.json:
```json
{
    "body": "Since I really don't see a good solution for this, can we close this ticket as \"wontfix\"?",
    "created_at": "2013-08-12T07:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146801",
    "user": "jdemeyer"
}
```

Since I really don't see a good solution for this, can we close this ticket as "wontfix"?



---

archive/issue_comments_146802.json:
```json
{
    "body": "For linux there is [http://pythonhosted.org/python-prctl/](http://pythonhosted.org/python-prctl/) which provides both a `set_name` and a `set_proctitle`.\n\nThere is also [http://code.google.com/p/py-setproctitle/](http://code.google.com/p/py-setproctitle/) which claims to implement the approach that PostgreSQL uses to get the desired capability across several platforms.",
    "created_at": "2013-08-12T08:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146802",
    "user": "nbruin"
}
```

For linux there is [http://pythonhosted.org/python-prctl/](http://pythonhosted.org/python-prctl/) which provides both a `set_name` and a `set_proctitle`.

There is also [http://code.google.com/p/py-setproctitle/](http://code.google.com/p/py-setproctitle/) which claims to implement the approach that PostgreSQL uses to get the desired capability across several platforms.



---

archive/issue_comments_146803.json:
```json
{
    "body": "I have tried:\n\n```\n$ sage -sh easy_install setproctitle\n```\n\nafter which I can do:\n\n```\nsage: import setproctitle\nsage: setproctitle.setproctitle(\"mysage\")\n```\n\nwhich changes both `/proc/PID/stat` and `/proc/PID/cmdline` (it truncates the name to 15 characters for what `stat` gets set to), i.e., both `killall` and `killall -e` work.\n\nThis test was on linux, but [https://pypi.python.org/pypi/setproctitle/](https://pypi.python.org/pypi/setproctitle/) claims it works on\n\n```\n    GNU/Linux\n    BSD\n    MacOS X\n    Windows\n```\n\nso on SunOS we should probably make it a NoOp",
    "created_at": "2013-08-12T19:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146803",
    "user": "nbruin"
}
```

I have tried:

```
$ sage -sh easy_install setproctitle
```

after which I can do:

```
sage: import setproctitle
sage: setproctitle.setproctitle("mysage")
```

which changes both `/proc/PID/stat` and `/proc/PID/cmdline` (it truncates the name to 15 characters for what `stat` gets set to), i.e., both `killall` and `killall -e` work.

This test was on linux, but [https://pypi.python.org/pypi/setproctitle/](https://pypi.python.org/pypi/setproctitle/) claims it works on

```
    GNU/Linux
    BSD
    MacOS X
    Windows
```

so on SunOS we should probably make it a NoOp



---

archive/issue_comments_146804.json:
```json
{
    "body": "The py-setproctitle seems to be about changing the name shown in `ps`, not about `killall` (haven't tried it though)",
    "created_at": "2013-08-12T19:22:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146804",
    "user": "jdemeyer"
}
```

The py-setproctitle seems to be about changing the name shown in `ps`, not about `killall` (haven't tried it though)



---

archive/issue_comments_146805.json:
```json
{
    "body": "Replying to [comment:11 jdemeyer]:\n> The py-setproctitle seems to be about changing the name shown in `ps`, not about `killall` (haven't tried it though)\n\nI have tried (see above) and at least on linux, it changes both process title and name.",
    "created_at": "2013-08-12T23:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146805",
    "user": "nbruin"
}
```

Replying to [comment:11 jdemeyer]:
> The py-setproctitle seems to be about changing the name shown in `ps`, not about `killall` (haven't tried it though)

I have tried (see above) and at least on linux, it changes both process title and name.



---

archive/issue_comments_146806.json:
```json
{
    "body": "The easiest way to change the name of an executable on a proper OS (and filesystem) is to simply create a hard link and call/execute the synonym instead.  (Soft links work at least partially.)\n\nIMHO the main purpose of doing so would be to allow users to better **see** Sage instances in `top`, `ps` etc.",
    "created_at": "2015-04-25T03:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146806",
    "user": "leif"
}
```

The easiest way to change the name of an executable on a proper OS (and filesystem) is to simply create a hard link and call/execute the synonym instead.  (Soft links work at least partially.)

IMHO the main purpose of doing so would be to allow users to better **see** Sage instances in `top`, `ps` etc.



---

archive/issue_comments_146807.json:
```json
{
    "body": "> IMHO the main purpose of doing so would be to allow users to better **see** Sage instances in `top`, `ps` etc.\nYes, this is a problem as there are occasionally \"ghost\" Sage processes (whether from sagenb or elsewhere) and it's annoying to track them down.",
    "created_at": "2015-04-28T18:26:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146807",
    "user": "kcrisman"
}
```

> IMHO the main purpose of doing so would be to allow users to better **see** Sage instances in `top`, `ps` etc.
Yes, this is a problem as there are occasionally "ghost" Sage processes (whether from sagenb or elsewhere) and it's annoying to track them down.



---

archive/issue_comments_146808.json:
```json
{
    "body": "Replying to [comment:18 kcrisman]:\n> Yes, this is a problem as there are occasionally \"ghost\" Sage processes (whether from sagenb or elsewhere) and it's annoying to track them down.\n\nDo you know the `--forest` or `f` option of `ps`? That usually clears up a lot.",
    "created_at": "2015-04-29T07:26:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146808",
    "user": "jdemeyer"
}
```

Replying to [comment:18 kcrisman]:
> Yes, this is a problem as there are occasionally "ghost" Sage processes (whether from sagenb or elsewhere) and it's annoying to track them down.

Do you know the `--forest` or `f` option of `ps`? That usually clears up a lot.



---

archive/issue_comments_146809.json:
```json
{
    "body": "No, I usually use `top`, sometimes `ps -aux`.\n\nIn principle this ticket *could* be solved with an FAQ entry, though it would be nice for the process to say Sage.",
    "created_at": "2015-04-30T01:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12426#issuecomment-146809",
    "user": "kcrisman"
}
```

No, I usually use `top`, sometimes `ps -aux`.

In principle this ticket *could* be solved with an FAQ entry, though it would be nice for the process to say Sage.
