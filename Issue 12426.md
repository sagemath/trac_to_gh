# Issue 12426: Change Sage process name

Issue created by migration from Trac.

Original creator: eviatarbach

Original creation time: 2012-02-27 04:29:04

Assignee: tbd

Sage's process name should be changed (now "python") so that it can be identified and terminated separately from other Python instances, if needed. See https://groups.google.com/forum/?fromgroups#!topic/sage-devel/BVGHgi40OvA


---

Comment by ppurka created at 2012-02-27 06:07:13

Changing component from PLEASE CHANGE to scripts.


---

Comment by ppurka created at 2012-02-27 06:07:13

This is not so simple. How would you ensure that the child processes are also cleaned up when you kill the Sage process?


---

Comment by ppurka created at 2012-02-27 06:07:13

Changing type from PLEASE CHANGE to enhancement.


---

Comment by ppurka created at 2012-02-27 06:07:13

Changing assignee from tbd to leif.


---

Comment by kini created at 2012-02-27 06:53:21

How is that related to this ticket? If there is some problem with Sage not killing its child processes when it dies, then that will exist regardless of whether the Sage processes are named "python" or something else. No?


---

Comment by ppurka created at 2012-02-27 07:02:39

Replying to [comment:2 kini]:
> How is that related to this ticket? If there is some problem with Sage not killing its child processes when it dies, then that will exist regardless of whether the Sage processes are named "python" or something else. No?

Well if the child processes are not killed, it defeats the main purpose of this ticket. The eventual use of this ticket is to be able to identify a Sage process and kill it remotely/automatically (as in from a command line) instead of having to go through a manual process.

If we only rename the Sage process, which shouldn't be too hard to do, then the user will be under a false impression when it is terminated but there are other child processes running amok.


---

Comment by jdemeyer created at 2013-05-22 09:56:26

It seems that renaming the process doesn't actually fool `killall` (on Linux): `killall sage` doesn't work, even if `argv[0]` of that process is `sage` and `ps` also shows `sage`. It seems that `killall` uses the actual filename of the executable.


---

Attachment


---

Attachment


---

Comment by eviatarbach created at 2013-05-22 18:14:45

Great! This [StackOverflow answer](http://stackoverflow.com/questions/564695/is-there-a-way-to-change-effective-process-name-in-python/923034#923034) claims that it should be possible to change a Python process name such that it works with `killall`; do you think this could be done with Sage as well? In any case, I think changing the name would be valuable anyway, so that it is distinguishable from other Python instances.


---

Comment by jdemeyer created at 2013-05-22 19:01:57

Well, that stackoverflow answer is Linux-specific, so I guess it's useless for Sage.

I have doubts that changing the name would be useful, if it doesn't work with `killall`.


---

Comment by nbruin created at 2013-05-22 19:05:26

Replying to [comment:4 jdemeyer]:
> It seems that renaming the process doesn't actually fool `killall` (on Linux): `killall sage` doesn't work, even if `argv[0]` of that process is `sage` and `ps` also shows `sage`. It seems that `killall` uses the actual filename of the executable.

Correct. According to [killall.c](http://sourceforge.net/p/psmisc/code/ci/master/tree/src/killall.c), it seems killall looks for the program name in `/proc/<PID>/stat`, and the name there apparently doesn't need to be the same as in `/proc/<PID>/cmdline`.

This actually causes nasty behaviour for `killall -e` (exist match, not just on first 15 characters), because that does go looking for confirmation in `/proc/<PID>/cmdline`, so if the first 15 characters there don't match then `killall -e` will never work.

Note that `sh mylittlescript` does succeed in getting `mylittlescript` into `stat` so there is a way for executables to let the name in `stat` be different from the executable name. In those cases, `sh` is part of `cmdline`, so `killall -e` is smart enough to go looking in later parts of `cmdline` as well.


---

Comment by jdemeyer created at 2013-08-12 07:27:19

Since I really don't see a good solution for this, can we close this ticket as "wontfix"?


---

Comment by nbruin created at 2013-08-12 08:35:56

For linux there is [http://pythonhosted.org/python-prctl/](http://pythonhosted.org/python-prctl/) which provides both a `set_name` and a `set_proctitle`.

There is also [http://code.google.com/p/py-setproctitle/](http://code.google.com/p/py-setproctitle/) which claims to implement the approach that PostgreSQL uses to get the desired capability across several platforms.


---

Comment by nbruin created at 2013-08-12 19:21:56

I have tried:

```
$ sage -sh easy_install setproctitle
```

after which I can do:

```
sage: import setproctitle
sage: setproctitle.setproctitle("mysage")
```

which changes both `/proc/PID/stat` and `/proc/PID/cmdline` (it truncates the name to 15 characters for what `stat` gets set to), i.e., both `killall` and `killall -e` work.

This test was on linux, but [https://pypi.python.org/pypi/setproctitle/](https://pypi.python.org/pypi/setproctitle/) claims it works on

```
    GNU/Linux
    BSD
    MacOS X
    Windows
```

so on SunOS we should probably make it a NoOp


---

Comment by jdemeyer created at 2013-08-12 19:22:29

The py-setproctitle seems to be about changing the name shown in `ps`, not about `killall` (haven't tried it though)


---

Comment by nbruin created at 2013-08-12 23:52:33

Replying to [comment:11 jdemeyer]:
> The py-setproctitle seems to be about changing the name shown in `ps`, not about `killall` (haven't tried it though)

I have tried (see above) and at least on linux, it changes both process title and name.


---

Comment by leif created at 2015-04-25 03:29:34

The easiest way to change the name of an executable on a proper OS (and filesystem) is to simply create a hard link and call/execute the synonym instead.  (Soft links work at least partially.)

IMHO the main purpose of doing so would be to allow users to better *see* Sage instances in `top`, `ps` etc.


---

Comment by kcrisman created at 2015-04-28 18:26:20

> IMHO the main purpose of doing so would be to allow users to better *see* Sage instances in `top`, `ps` etc.
Yes, this is a problem as there are occasionally "ghost" Sage processes (whether from sagenb or elsewhere) and it's annoying to track them down.


---

Comment by jdemeyer created at 2015-04-29 07:26:59

Replying to [comment:18 kcrisman]:
> Yes, this is a problem as there are occasionally "ghost" Sage processes (whether from sagenb or elsewhere) and it's annoying to track them down.

Do you know the `--forest` or `f` option of `ps`? That usually clears up a lot.


---

Comment by kcrisman created at 2015-04-30 01:17:23

No, I usually use `top`, sometimes `ps -aux`.

In principle this ticket _could_ be solved with an FAQ entry, though it would be nice for the process to say Sage.
