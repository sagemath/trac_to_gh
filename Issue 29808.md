# Issue 29808: Bug in Reed-Solomon encoder and error-erasure decoder

Issue created by migration from https://trac.sagemath.org/ticket/30045

Original creator: jsrn

Original creation time: 2020-07-02 09:04:48

CC:  @kliem

Keywords: reed-solomon decoding

The following two snippets demonstrate two bugs when working with `GeneralizedReedSolomonCode`:


```
sage: F = GF(59)
sage: n, k = 40, 12
sage: C = codes.GeneralizedReedSolomonCode(F.list()[:n], k)
sage: D = codes.decoders.GRSErrorErasureDecoder(C)
sage: y = (vector(F, [0, 0, 10, 0, 0, 22, 0, 0, 38, 8, 34, 14, 33, 0, 0, 39, 0, 0, 0, 0, 17, 36, 43, 30, 10, 15, 0, 0, 21, 10, 37, 0, 0, 0, 0, 0, 0, 0, 0, 42]),
sage:      vector(GF(2), [1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0]))
sage: D.decode_to_code(y)
<BOOM>
```


Decoding to message works, but produces a vector of incorrect length (should equal the dimension, i.e. 12):


```
{
sage: m = D.decode_to_message(y)
sage: len(m)
11
```


(The bugs were found by introducing random seeding in #29945)


---

Comment by jsrn created at 2020-07-02 09:31:11

The second error seems to be due to `GeneralizedReedSolomonCode` having a `decode_to_message` implemented, which incorrectly converts between polynomials and vectors. I don't see why it should have this method implemented - it should be provided in the correct way by `AbstractCode`.


---

Comment by @kliem created at 2020-07-06 08:43:09

As posted already on #29945, I would propose to just fix the problem and don't worry about #29945.
----
New commits:


---

Comment by jsrn created at 2020-07-06 08:53:03

Changing status from new to needs_review.


---

Comment by jsrn created at 2020-07-06 08:53:03

OK, then this is up for review.


---

Comment by @kliem created at 2020-07-06 09:30:43

The bug fix should be tested with a doctest yet.


---

Comment by git created at 2020-07-06 09:54:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2020-07-06 09:55:23

Right you are.


---

Comment by @kliem created at 2020-07-08 13:39:53

Can you please add the doctest that was removed with the method somewhere.

Also


```diff
-    Test that the bug in #30045 is fixed::
+    Test that the bug in :trac:`30045` is fixed::
```



---

Comment by @kliem created at 2020-07-10 08:24:35

And missing author name. Otherwise this looks good.


---

Comment by git created at 2020-07-10 08:55:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-10 08:57:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2020-07-10 08:58:31

Thanks for the patience! It's been a while since I last fixed something in Sage ;-)


---

Comment by @kliem created at 2020-07-10 10:26:22

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2020-07-10 10:26:22

LGTM. Thanks for fixing this.


---

Comment by vbraun created at 2020-07-12 08:30:34

Resolution: fixed
