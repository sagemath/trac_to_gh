# Issue 11481: desolve failed to solve an ODE with a

archive/issues_011481.json:
```json
{
    "body": "Assignee: burcin\n\nCC:  kcrisman nbruin\n\nWhen trying to solve a simple ODE whose rhs contains a function, Sage fails to interpret the Maxima output.\n\nHere a minimal example is  #========================================================================= sage: x=var('x') # independent variable\n\nsage: v=function('v', x) # dependent variable\n\n# we define a custom square pulse function\n\ndef pulse(tonset, tdur, amp):\n\n  \"\"\" returns a square pulse as a function of x, f(x) the pulse is defined as follows:  tonset -- start of pulse  tdur   -- duration of pulse  amp    -- amplitude of pulse \"\"\"\n\n  f(x)= amp*(sign(x-tonset)/2-sign(x-tonset-tdur)/2)\n\n  return f\n\n# create my pulse function\n\nsage: mypulse = pulse(tonset=5, tdur=5, amp=2)\n\n# define differential equation s\n\nsage: dvdx = diff(v, x)-x -mypulse == 0 # mypulse(x) is function\n\n# get the evolution of v\n\nmyvolt = desolve(de=dvdx, ivar=x, dvar=v, ics=[0,0])\n\n#========================================================================= The error message is:\n\n*TypeError: unable to make sense of Maxima expression 'v(x)=-(2*(at(integrate(signum(x-5)-signum(x-13),x),[x=0,v(x)=0]))-2*int\\ egrate(signum(x-5)-signum(x-13),x)-x^2)/2' in Sage^*\n\ndesolve_laplace leads to similar error: \n\nsage: desolve(de=dvdx, ivar=x, dvar=v, ics=[0,0])\n\n*TypeError: unable to make sense of Maxima expression 'ilt(((laplace(signum(x-5),x,?g2733)-laplace(signum(x-13),x,?g2733)+v(0)\\ )*?g2733<sup>2+1)/?g2733</sup>3,?g2733,x)' in Sage*\n\nAccording to Nils Bruin, the problem is that Maxima 'at' function. As described in Ticket #385, this can be a problem with the implementation of 'at' for SR.\n\nDetailed information (and a real example) can be found here: http://groups.google.com/group/sage-support/browse_thread/thread/8cc67d39510faca2\n\nIssue created by migration from https://trac.sagemath.org/ticket/11653\n\n",
    "created_at": "2011-08-05T21:19:47Z",
    "labels": [
        "calculus",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "desolve failed to solve an ODE with a",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11481",
    "user": "JGuzman"
}
```
Assignee: burcin

CC:  kcrisman nbruin

When trying to solve a simple ODE whose rhs contains a function, Sage fails to interpret the Maxima output.

Here a minimal example is  #========================================================================= sage: x=var('x') # independent variable

sage: v=function('v', x) # dependent variable

# we define a custom square pulse function

def pulse(tonset, tdur, amp):

  """ returns a square pulse as a function of x, f(x) the pulse is defined as follows:  tonset -- start of pulse  tdur   -- duration of pulse  amp    -- amplitude of pulse """

  f(x)= amp*(sign(x-tonset)/2-sign(x-tonset-tdur)/2)

  return f

# create my pulse function

sage: mypulse = pulse(tonset=5, tdur=5, amp=2)

# define differential equation s

sage: dvdx = diff(v, x)-x -mypulse == 0 # mypulse(x) is function

# get the evolution of v

myvolt = desolve(de=dvdx, ivar=x, dvar=v, ics=[0,0])

#========================================================================= The error message is:

*TypeError: unable to make sense of Maxima expression 'v(x)=-(2*(at(integrate(signum(x-5)-signum(x-13),x),[x=0,v(x)=0]))-2*int\ egrate(signum(x-5)-signum(x-13),x)-x^2)/2' in Sage^*

desolve_laplace leads to similar error: 

sage: desolve(de=dvdx, ivar=x, dvar=v, ics=[0,0])

*TypeError: unable to make sense of Maxima expression 'ilt(((laplace(signum(x-5),x,?g2733)-laplace(signum(x-13),x,?g2733)+v(0)\ )*?g2733<sup>2+1)/?g2733</sup>3,?g2733,x)' in Sage*

According to Nils Bruin, the problem is that Maxima 'at' function. As described in Ticket #385, this can be a problem with the implementation of 'at' for SR.

Detailed information (and a real example) can be found here: http://groups.google.com/group/sage-support/browse_thread/thread/8cc67d39510faca2

Issue created by migration from https://trac.sagemath.org/ticket/11653





---

archive/issue_comments_128276.json:
```json
{
    "body": "Changing keywords from \"\" to \"maxima, at, desolve\".",
    "created_at": "2011-08-05T22:48:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11481#issuecomment-128276",
    "user": "JGuzman"
}
```

Changing keywords from "" to "maxima, at, desolve".



---

archive/issue_comments_128277.json:
```json
{
    "body": "Thanks, Jose!  Just a few pointers:\n\n* You can use some formatting to do stuff here.  There are links on the main Trac page, but the most useful one is putting code examples in triples { braces.\n* The 'author' is the author of the patch.  You are the reporter :) though perhaps also the eventual author as well!",
    "created_at": "2011-08-06T02:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11481#issuecomment-128277",
    "user": "kcrisman"
}
```

Thanks, Jose!  Just a few pointers:

* You can use some formatting to do stuff here.  There are links on the main Trac page, but the most useful one is putting code examples in triples { braces.
* The 'author' is the author of the patch.  You are the reporter :) though perhaps also the eventual author as well!



---

archive/issue_comments_128278.json:
```json
{
    "body": "As to the ticket, see the sage-support thread in question.  The essential problem is that in `laplace` and `taylor` we take the answer from Maxima and send it to SR, which does parse the `at` correctly via the Maxima string thingie in calculus/calculus.py, but in the `desolve_*` functions we just coerce to `.sage()`, which does not.  Probably changing this would fix it.",
    "created_at": "2011-08-06T02:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11481#issuecomment-128278",
    "user": "kcrisman"
}
```

As to the ticket, see the sage-support thread in question.  The essential problem is that in `laplace` and `taylor` we take the answer from Maxima and send it to SR, which does parse the `at` correctly via the Maxima string thingie in calculus/calculus.py, but in the `desolve_*` functions we just coerce to `.sage()`, which does not.  Probably changing this would fix it.



---

archive/issue_comments_128279.json:
```json
{
    "body": "I re-formatted the text according to kcrisman (thanks a lot for the suggestion!). I will have a look to the code soon. I am looking forward to implement it. If I understood correctly, the only thing to do is to make desolve_* take the answer from Maxima to SR.",
    "created_at": "2011-08-06T08:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11481#issuecomment-128279",
    "user": "JGuzman"
}
```

I re-formatted the text according to kcrisman (thanks a lot for the suggestion!). I will have a look to the code soon. I am looking forward to implement it. If I understood correctly, the only thing to do is to make desolve_* take the answer from Maxima to SR.



---

archive/issue_comments_128280.json:
```json
{
    "body": "Changing assignee from burcin to JGuzman.",
    "created_at": "2011-08-07T15:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11481#issuecomment-128280",
    "user": "JGuzman"
}
```

Changing assignee from burcin to JGuzman.



---

archive/issue_comments_128281.json:
```json
{
    "body": "I changed the summary to delimit the error more carefully. Additional,   a more detailed explanation is given of cases in which Sage is able to interpret Maxima output. I guess, the problem is that Sage is not able to interpret the integration limits prompted by the maxima expression.",
    "created_at": "2011-08-07T15:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11481#issuecomment-128281",
    "user": "JGuzman"
}
```

I changed the summary to delimit the error more carefully. Additional,   a more detailed explanation is given of cases in which Sage is able to interpret Maxima output. I guess, the problem is that Sage is not able to interpret the integration limits prompted by the maxima expression.



---

archive/issue_comments_128282.json:
```json
{
    "body": "Changing assignee from JGuzman to burcin.",
    "created_at": "2011-08-07T15:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11481#issuecomment-128282",
    "user": "JGuzman"
}
```

Changing assignee from JGuzman to burcin.



---

archive/issue_comments_128283.json:
```json
{
    "body": "Change owner to burcin (I do not know why it changed last time !), and change the typesetting of TypeError",
    "created_at": "2011-08-07T15:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11481#issuecomment-128283",
    "user": "JGuzman"
}
```

Change owner to burcin (I do not know why it changed last time !), and change the typesetting of TypeError



---

archive/issue_comments_128284.json:
```json
{
    "body": "There are several issues here, actually, so it may take a bit to solve this.  We are apparently translating several things wrongly by not going through SR, but then there is also the 'general' variable `?g2733` which I remember being still undealt with... probably won't be fixed immediately :( just because of time constraints.",
    "created_at": "2011-08-08T13:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11481#issuecomment-128284",
    "user": "kcrisman"
}
```

There are several issues here, actually, so it may take a bit to solve this.  We are apparently translating several things wrongly by not going through SR, but then there is also the 'general' variable `?g2733` which I remember being still undealt with... probably won't be fixed immediately :( just because of time constraints.
