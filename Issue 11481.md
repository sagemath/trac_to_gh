# Issue 11481: desolve failed to solve an ODE with a

Issue created by migration from https://trac.sagemath.org/ticket/11653

Original creator: JGuzman

Original creation time: 2011-08-05 21:19:47

Assignee: burcin

CC:  kcrisman nbruin

When trying to solve a simple ODE whose rhs contains a function, Sage fails to interpret the Maxima output.

Here a minimal example is  #========================================================================= sage: x=var('x') # independent variable

sage: v=function('v', x) # dependent variable

# we define a custom square pulse function

def pulse(tonset, tdur, amp):

  """ returns a square pulse as a function of x, f(x) the pulse is defined as follows:  tonset -- start of pulse  tdur   -- duration of pulse  amp    -- amplitude of pulse """

  f(x)= amp*(sign(x-tonset)/2-sign(x-tonset-tdur)/2)

  return f

# create my pulse function

sage: mypulse = pulse(tonset=5, tdur=5, amp=2)

# define differential equation s

sage: dvdx = diff(v, x)-x -mypulse == 0 # mypulse(x) is function

# get the evolution of v

myvolt = desolve(de=dvdx, ivar=x, dvar=v, ics=[0,0])

#========================================================================= The error message is:

_TypeError: unable to make sense of Maxima expression 'v(x)=-(2*(at(integrate(signum(x-5)-signum(x-13),x),[x=0,v(x)=0]))-2*int\ egrate(signum(x-5)-signum(x-13),x)-x^2)/2' in Sage^_

desolve_laplace leads to similar error: 

sage: desolve(de=dvdx, ivar=x, dvar=v, ics=[0,0])

_TypeError: unable to make sense of Maxima expression 'ilt(((laplace(signum(x-5),x,?g2733)-laplace(signum(x-13),x,?g2733)+v(0)\ )*?g2733<sup>2+1)/?g2733</sup>3,?g2733,x)' in Sage_

According to Nils Bruin, the problem is that Maxima 'at' function. As described in Ticket #385, this can be a problem with the implementation of 'at' for SR.

Detailed information (and a real example) can be found here: http://groups.google.com/group/sage-support/browse_thread/thread/8cc67d39510faca2


---

Comment by JGuzman created at 2011-08-05 22:48:27

Changing keywords from "" to "maxima, at, desolve".


---

Comment by kcrisman created at 2011-08-06 02:09:19

Thanks, Jose!  Just a few pointers:

 * You can use some formatting to do stuff here.  There are links on the main Trac page, but the most useful one is putting code examples in triples { braces.
 * The 'author' is the author of the patch.  You are the reporter :) though perhaps also the eventual author as well!


---

Comment by kcrisman created at 2011-08-06 02:14:16

As to the ticket, see the sage-support thread in question.  The essential problem is that in `laplace` and `taylor` we take the answer from Maxima and send it to SR, which does parse the `at` correctly via the Maxima string thingie in calculus/calculus.py, but in the `desolve_*` functions we just coerce to `.sage()`, which does not.  Probably changing this would fix it.


---

Comment by JGuzman created at 2011-08-06 08:15:33

I re-formatted the text according to kcrisman (thanks a lot for the suggestion!). I will have a look to the code soon. I am looking forward to implement it. If I understood correctly, the only thing to do is to make desolve_* take the answer from Maxima to SR.


---

Comment by JGuzman created at 2011-08-07 15:32:29

Changing assignee from burcin to JGuzman.


---

Comment by JGuzman created at 2011-08-07 15:32:29

I changed the summary to delimit the error more carefully. Additional,   a more detailed explanation is given of cases in which Sage is able to interpret Maxima output. I guess, the problem is that Sage is not able to interpret the integration limits prompted by the maxima expression.


---

Comment by JGuzman created at 2011-08-07 15:39:15

Changing assignee from JGuzman to burcin.


---

Comment by JGuzman created at 2011-08-07 15:39:15

Change owner to burcin (I do not know why it changed last time !), and change the typesetting of TypeError


---

Comment by kcrisman created at 2011-08-08 13:08:38

There are several issues here, actually, so it may take a bit to solve this.  We are apparently translating several things wrongly by not going through SR, but then there is also the 'general' variable `?g2733` which I remember being still undealt with... probably won't be fixed immediately :( just because of time constraints.
