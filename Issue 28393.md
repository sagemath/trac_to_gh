# Issue 28393: Wrong conversion from fricas

Issue created by migration from https://trac.sagemath.org/ticket/28630

Original creator: tmonteil

Original creation time: 2019-10-18 19:59:26

CC:  hemmecke whuss rws chapoton mantepse

As reported on [this ask question](https://ask.sagemath.org/question/48409/possible-invalid-latex-translation-from-fricas-result), we have:


```
sage: f = polylog(3, x)
sage: f.integral(x, algorithm='fricas')
-x*%iint(x, -log(-x + 1)/x) - (x - 1)*log(-x + 1) + x*polylog(3, x) + x
```


So, `fricas` produces something that is ill-interpreted as some `%iint` symbolic function.

Note that `maxima` produces the following answer:


```
sage: f.integral(x, algorithm='maxima')
-x*dilog(x) - (x - 1)*log(-x + 1) + x*polylog(3, x) + x
```




---

Comment by chapoton created at 2019-10-20 13:35:16

Changing keywords from "" to "FriCAS".


---

Comment by chapoton created at 2019-10-20 15:55:06

This seems to be some kind of bug in Fricas:

```
sage: f = fricas(polylog(3,x))
sage: f.integrate(x)
              log(- x + 1)
- x %iint(x,- ------------) + x polylog(3,x) + (- x + 1)log(- x + 1) + x
                    x
```

And the first term can be differentiated (inside Fricas) correctly.


---

Comment by mantepse created at 2019-11-23 07:10:05

More a reminder to myself: SageMath's `dilog(x)` is FriCAS' `dilog(1-x)`.  This is properly reflected in `sage.functions.log.py`, in class `Function_dilog`.

So FriCAS should simplify `%iint(x, -log(1-x)/x))` to FriCAS `dilog(1-x)`.


---

Comment by mantepse created at 2019-11-23 07:14:59

I reported this at

https://groups.google.com/forum/#!topic/fricas-devel/olmzqJ6IJsE


---

Comment by embray created at 2020-01-06 14:10:03

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-05-01 04:28:42

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.


---

Comment by mkoeppe created at 2020-08-29 19:30:30

Still the same in 9.2.beta10 after the update of FriCAS to 1.3.6 in #27309


---

Comment by dimpase created at 2021-01-09 11:04:01

Fricas devs say that `%iint` should have never appeared, it's a Fricas 
[bug](https://groups.google.com/g/fricas-devel/c/z5oRKlb8CFI/m/1W7PUExpBgAJ). So that's something for them to fix.


---

Comment by mkoeppe created at 2021-04-07 19:29:15

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.


---

Comment by mantepse created at 2021-06-02 11:49:10

Changing status from new to needs_review.


---

Comment by mantepse created at 2021-06-02 11:49:10

New commits:


---

Comment by chapoton created at 2021-06-06 06:56:33

First one does not work for me on 9.4.b0. We must wait for Fricas release containing the fix.


---

Comment by git created at 2021-07-07 09:00:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2021-07-08 08:23:05

this gives me

```
File "src/sage/symbolic/integration/external.py", line 418, in sage.symbolic.integration.external.fricas_integrator
Failed example:
    integrate(f, x, algorithm="fricas")                               # optional - fricas
Expected:
    1/315*(64512*I*a*e^(10*I*d*x + 10*I*c) + 53760*I*a*e^(8*I*d*x + 8*I*c) + 30720*I*a*e^(6*I*d*x + 6*I*c) + 11520*I*a*e^(4*I*d*x + 4*I*c) + 2560*I*a*e^(2*I*d*x + 2*I*c) + 256*I*a)/(d*e^(20*I*d*x + 20*I*c) + 10*d*e^(18*I*d*x + 18*I*c) + 45*d*e^(16*I*d*x + 16*I*c) + 120*d*e^(14*I*d*x + 14*I*c) + 210*d*e^(12*I*d*x + 12*I*c) + 252*d*e^(10*I*d*x + 10*I*c) + 210*d*e^(8*I*d*x + 8*I*c) + 120*d*e^(6*I*d*x + 6*I*c) + 45*d*e^(4*I*d*x + 4*I*c) + 10*d*e^(2*I*d*x + 2*I*c) + d)
Got:
    -256/315*(-252*I*a*e^(10*I*d*x + 10*I*c) - 210*I*a*e^(8*I*d*x + 8*I*c) - 120*I*a*e^(6*I*d*x + 6*I*c) - 45*I*a*e^(4*I*d*x + 4*I*c) - 10*I*a*e^(2*I*d*x + 2*I*c) - I*a)/(d*e^(20*I*d*x + 20*I*c) + 10*d*e^(18*I*d*x + 18*I*c) + 45*d*e^(16*I*d*x + 16*I*c) + 120*d*e^(14*I*d*x + 14*I*c) + 210*d*e^(12*I*d*x + 12*I*c) + 252*d*e^(10*I*d*x + 10*I*c) + 210*d*e^(8*I*d*x + 8*I*c) + 120*d*e^(6*I*d*x + 6*I*c) + 45*d*e^(4*I*d*x + 4*I*c) + 10*d*e^(2*I*d*x + 2*I*c) + d)
```


- a different formatting of the same expression.


---

Comment by dimpase created at 2021-07-08 08:28:13

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2021-07-08 08:28:13

how about making this doctest robust:

```
        sage: ii=integrate(f, x, algorithm="fricas")                    # optional - fricas
        sage: ii==1/315*(64512*I*a*e^(10*I*d*x + 10*I*c) +<the rest...> # optional - fricas
        True
```



---

Comment by dimpase created at 2021-07-08 08:38:51

OK, like this
----
New commits:


---

Comment by dimpase created at 2021-07-08 08:38:51

Changing status from needs_work to positive_review.


---

Comment by mantepse created at 2021-07-08 09:54:43

The final commit subsumes #29043, which I therefore set to duplicate.


---

Comment by vbraun created at 2021-07-23 20:11:35

Resolution: fixed
