# Issue 14714: tokenize() function in logic/logicparser.py infinite loop

Issue created by migration from Trac.

Original creator: pmscurek

Original creation time: 2013-07-22 18:07:46

Assignee: Paul Scurek

Keywords: logic, propcalc, logicparser

The tokenize() function in logic/logicparser.py is called when a new formula of propositional calculus is created using propcalc.formula(<formula_expression>).  The tokenize() function enters an infinite loop if the characters '<', '>', or '-', are used in <formula_expression> incorrectly (i.e. not as a part of one of the operators '<->' or '->').  The following code would cause an infinitely loop because of the '-':


```python
sage: import sage.logic.propcalc as propcalc

sage: f = propcalc.formula("a-b")
```


The BooleanFormula class located in logic/boolformula.py also needs a method that returns the full syntax parse tree of a boolean formula, so that each formula has a unique parse tree.  The BooleanFormula tree() method does not serve this purpose.


---

Comment by was created at 2013-07-24 19:10:27

It is OK that the docstrings are not formatted as in the reference manual, for *consistency* with the rest of this file.  We'll apply Mike Hansen's automatic old docstring --> new docstring conversion tool to the whole logic/ module later.

[ ] Rewrite polish_notation to use 

```
   ''.join(sage.misc.flatten(logicparser.polish_parse(repr(self))))
```


[ ] Move this comment (below) so it aligns correctly, and there is a space after #:

```
    tree = tree_parse(toks, polish = True)
        #special case where the formula s is a single variable
    if type(tree) is StringType and len([tree]) == 1:
```


[ ] This looks suspicious since it is always tautologically true -- see if you can figure out what's up with this craziness:

```
    len([tree]) == 1
```


[ ] The Python way to do this

```
type(tree) is StringType
```

is to do this:

```
isinstance(tree, StringType)
```


[ ] Clean up this comment:

```
 #check to see if '-', '<' or '>' are used incorretly 
```

to

```
 # check to see if '-', '<' or '>' are used incorrectly 
```


[ ] Typo: `When true, caues the function to produce the full `  (missing letter in "caues")

[ ] Mention the default values in docstrings.

[ ] In python replace `if polish == False:` by the more idomatic `if not polish`


---

Comment by was created at 2013-07-24 19:10:59

Changing status from new to needs_review.


---

Comment by was created at 2013-07-24 19:11:06

Changing status from needs_review to needs_work.


---

Attachment

fixes issues raised in ticket and issues raised by revewers


---

Comment by pmscurek created at 2013-07-29 00:36:59

The attachment trac_14951_tokenize_tree_fix.patch is large because it includes some changes to indentation, and hence I configured my .hgrc file to have Mercurial recognize whitespace.  Here are the files and functions that are relevant to the ticket:

in boolformula.py -- __init__(), polish_notation(), full_tree()

in logicparser.py -- parse(), polish_parse(), tokenize(), tree_parse(), parse_ltor()


---

Comment by pmscurek created at 2013-07-29 00:36:59

Changing status from needs_work to needs_review.


---

Comment by was created at 2013-07-31 19:01:53

Almost there:

 - typo "a boolean formlua".  

 - typo "incorretly" 

Positive review once you post another little patch to fix those two typos.

And yes, release manager, the docstrings are all scary -- there will be another ticket that uniformly modernizes the docstring formatting.


---

Comment by pmscurek created at 2013-08-03 22:55:08

I am currently working on a patch to update all of the docstrings in the logic module.  The typos "a boolean formlua" and "incorretly" will be addressed in that patch.


---

Comment by was created at 2013-08-14 19:20:31

Positive review since the typos are fixed as part of #15013.


---

Comment by was created at 2013-08-14 19:20:31

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-08-16 21:19:50

Resolution: fixed
