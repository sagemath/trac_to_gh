# Issue 14714: tokenize() function in logic/logicparser.py infinite loop

archive/issues_014714.json:
```json
{
    "body": "Assignee: Paul Scurek\n\nKeywords: logic, propcalc, logicparser\n\nThe tokenize() function in logic/logicparser.py is called when a new formula of propositional calculus is created using propcalc.formula(<formula_expression>).  The tokenize() function enters an infinite loop if the characters '<', '>', or '-', are used in <formula_expression> incorrectly (i.e. not as a part of one of the operators '<->' or '->').  The following code would cause an infinitely loop because of the '-':\n\n\n```python\nsage: import sage.logic.propcalc as propcalc\n\nsage: f = propcalc.formula(\"a-b\")\n```\n\n\nThe BooleanFormula class located in logic/boolformula.py also needs a method that returns the full syntax parse tree of a boolean formula, so that each formula has a unique parse tree.  The BooleanFormula tree() method does not serve this purpose.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14951\n\n",
    "created_at": "2013-07-22T18:07:46Z",
    "labels": [
        "misc",
        "major",
        "bug"
    ],
    "title": "tokenize() function in logic/logicparser.py infinite loop",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14714",
    "user": "pmscurek"
}
```
Assignee: Paul Scurek

Keywords: logic, propcalc, logicparser

The tokenize() function in logic/logicparser.py is called when a new formula of propositional calculus is created using propcalc.formula(<formula_expression>).  The tokenize() function enters an infinite loop if the characters '<', '>', or '-', are used in <formula_expression> incorrectly (i.e. not as a part of one of the operators '<->' or '->').  The following code would cause an infinitely loop because of the '-':


```python
sage: import sage.logic.propcalc as propcalc

sage: f = propcalc.formula("a-b")
```


The BooleanFormula class located in logic/boolformula.py also needs a method that returns the full syntax parse tree of a boolean formula, so that each formula has a unique parse tree.  The BooleanFormula tree() method does not serve this purpose.

Issue created by migration from https://trac.sagemath.org/ticket/14951





---

archive/issue_comments_187539.json:
```json
{
    "body": "It is OK that the docstrings are not formatted as in the reference manual, for *consistency* with the rest of this file.  We'll apply Mike Hansen's automatic old docstring --> new docstring conversion tool to the whole logic/ module later.\n\n[ ] Rewrite polish_notation to use \n\n```\n   ''.join(sage.misc.flatten(logicparser.polish_parse(repr(self))))\n```\n\n\n[ ] Move this comment (below) so it aligns correctly, and there is a space after #:\n\n```\n    tree = tree_parse(toks, polish = True)\n        #special case where the formula s is a single variable\n    if type(tree) is StringType and len([tree]) == 1:\n```\n\n\n[ ] This looks suspicious since it is always tautologically true -- see if you can figure out what's up with this craziness:\n\n```\n    len([tree]) == 1\n```\n\n\n[ ] The Python way to do this\n\n```\ntype(tree) is StringType\n```\n\nis to do this:\n\n```\nisinstance(tree, StringType)\n```\n\n\n[ ] Clean up this comment:\n\n```\n #check to see if '-', '<' or '>' are used incorretly \n```\n\nto\n\n```\n # check to see if '-', '<' or '>' are used incorrectly \n```\n\n\n[ ] Typo: `When true, caues the function to produce the full `  (missing letter in \"caues\")\n\n[ ] Mention the default values in docstrings.\n\n[ ] In python replace `if polish == False:` by the more idomatic `if not polish`",
    "created_at": "2013-07-24T19:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14714#issuecomment-187539",
    "user": "was"
}
```

It is OK that the docstrings are not formatted as in the reference manual, for *consistency* with the rest of this file.  We'll apply Mike Hansen's automatic old docstring --> new docstring conversion tool to the whole logic/ module later.

[ ] Rewrite polish_notation to use 

```
   ''.join(sage.misc.flatten(logicparser.polish_parse(repr(self))))
```


[ ] Move this comment (below) so it aligns correctly, and there is a space after #:

```
    tree = tree_parse(toks, polish = True)
        #special case where the formula s is a single variable
    if type(tree) is StringType and len([tree]) == 1:
```


[ ] This looks suspicious since it is always tautologically true -- see if you can figure out what's up with this craziness:

```
    len([tree]) == 1
```


[ ] The Python way to do this

```
type(tree) is StringType
```

is to do this:

```
isinstance(tree, StringType)
```


[ ] Clean up this comment:

```
 #check to see if '-', '<' or '>' are used incorretly 
```

to

```
 # check to see if '-', '<' or '>' are used incorrectly 
```


[ ] Typo: `When true, caues the function to produce the full `  (missing letter in "caues")

[ ] Mention the default values in docstrings.

[ ] In python replace `if polish == False:` by the more idomatic `if not polish`



---

archive/issue_comments_187540.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-07-24T19:10:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14714#issuecomment-187540",
    "user": "was"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_187541.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-07-24T19:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14714#issuecomment-187541",
    "user": "was"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_187542.json:
```json
{
    "body": "Attachment\n\nfixes issues raised in ticket and issues raised by revewers",
    "created_at": "2013-07-29T00:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14714#issuecomment-187542",
    "user": "pmscurek"
}
```

Attachment

fixes issues raised in ticket and issues raised by revewers



---

archive/issue_comments_187543.json:
```json
{
    "body": "The attachment trac_14951_tokenize_tree_fix.patch is large because it includes some changes to indentation, and hence I configured my .hgrc file to have Mercurial recognize whitespace.  Here are the files and functions that are relevant to the ticket:\n\nin boolformula.py -- __init__(), polish_notation(), full_tree()\n\nin logicparser.py -- parse(), polish_parse(), tokenize(), tree_parse(), parse_ltor()",
    "created_at": "2013-07-29T00:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14714#issuecomment-187543",
    "user": "pmscurek"
}
```

The attachment trac_14951_tokenize_tree_fix.patch is large because it includes some changes to indentation, and hence I configured my .hgrc file to have Mercurial recognize whitespace.  Here are the files and functions that are relevant to the ticket:

in boolformula.py -- __init__(), polish_notation(), full_tree()

in logicparser.py -- parse(), polish_parse(), tokenize(), tree_parse(), parse_ltor()



---

archive/issue_comments_187544.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-07-29T00:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14714#issuecomment-187544",
    "user": "pmscurek"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_187545.json:
```json
{
    "body": "Almost there:\n\n- typo \"a boolean formlua\".  \n\n- typo \"incorretly\" \n\nPositive review once you post another little patch to fix those two typos.\n\nAnd yes, release manager, the docstrings are all scary -- there will be another ticket that uniformly modernizes the docstring formatting.",
    "created_at": "2013-07-31T19:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14714#issuecomment-187545",
    "user": "was"
}
```

Almost there:

- typo "a boolean formlua".  

- typo "incorretly" 

Positive review once you post another little patch to fix those two typos.

And yes, release manager, the docstrings are all scary -- there will be another ticket that uniformly modernizes the docstring formatting.



---

archive/issue_comments_187546.json:
```json
{
    "body": "I am currently working on a patch to update all of the docstrings in the logic module.  The typos \"a boolean formlua\" and \"incorretly\" will be addressed in that patch.",
    "created_at": "2013-08-03T22:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14714#issuecomment-187546",
    "user": "pmscurek"
}
```

I am currently working on a patch to update all of the docstrings in the logic module.  The typos "a boolean formlua" and "incorretly" will be addressed in that patch.



---

archive/issue_comments_187547.json:
```json
{
    "body": "Positive review since the typos are fixed as part of #15013.",
    "created_at": "2013-08-14T19:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14714#issuecomment-187547",
    "user": "was"
}
```

Positive review since the typos are fixed as part of #15013.



---

archive/issue_comments_187548.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-08-14T19:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14714#issuecomment-187548",
    "user": "was"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_187549.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-08-16T21:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14714#issuecomment-187549",
    "user": "jdemeyer"
}
```

Resolution: fixed
