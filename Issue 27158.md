# Issue 27158: genus2red should do something with its second argument

archive/issues_027158.json:
```json
{
    "body": "CC:  @jdemeyer @slel\n\nCompare this in gp:\n\n```\n? genus2red(x^6+3)             \n%1 = [59049, [2, -1; 3, 10], x^6 + 3, [[2, [5, [Mod(0, 2), Mod(0, 2)]], []], [3, [5, [Mod(0, 3), Mod(0, 3)]], [\"[V] page 156\", [3]]]]]\n? genus2red(x^6+3,3)\n%2 = [59049, Mat([3, 10]), x^6 + 3, [3, [5, [Mod(0, 3), Mod(0, 3)]], [\"[V] page 156\", [3]]]]\n```\n\nwith sage:\n\n```\nsage: pari.genus2red(x^6+3)\n[59049, [2, -1; 3, 10], x^6 + 3, [[2, [5, [Mod(0, 2), Mod(0, 2)]], []], [3, [5, [Mod(0, 3), Mod(0, 3)]], [\"[V] page 156\", [3]]]]]\nsage: pari.genus2red(x^6+3,3)\n[59049, [2, -1; 3, 10], x^6 + 3, [[2, [5, [Mod(0, 2), Mod(0, 2)]], []], [3, [5, [Mod(0, 3), Mod(0, 3)]], [\"[V] page 156\", [3]]]]]\n```\n\nIt's obvious the second argument simply gets ignored.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27395\n\n",
    "created_at": "2019-03-01T23:28:50Z",
    "labels": [
        "interfaces",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "genus2red should do something with its second argument",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27158",
    "user": "@nbruin"
}
```
CC:  @jdemeyer @slel

Compare this in gp:

```
? genus2red(x^6+3)             
%1 = [59049, [2, -1; 3, 10], x^6 + 3, [[2, [5, [Mod(0, 2), Mod(0, 2)]], []], [3, [5, [Mod(0, 3), Mod(0, 3)]], ["[V] page 156", [3]]]]]
? genus2red(x^6+3,3)
%2 = [59049, Mat([3, 10]), x^6 + 3, [3, [5, [Mod(0, 3), Mod(0, 3)]], ["[V] page 156", [3]]]]
```

with sage:

```
sage: pari.genus2red(x^6+3)
[59049, [2, -1; 3, 10], x^6 + 3, [[2, [5, [Mod(0, 2), Mod(0, 2)]], []], [3, [5, [Mod(0, 3), Mod(0, 3)]], ["[V] page 156", [3]]]]]
sage: pari.genus2red(x^6+3,3)
[59049, [2, -1; 3, 10], x^6 + 3, [[2, [5, [Mod(0, 2), Mod(0, 2)]], []], [3, [5, [Mod(0, 3), Mod(0, 3)]], ["[V] page 156", [3]]]]]
```

It's obvious the second argument simply gets ignored.

Issue created by migration from https://trac.sagemath.org/ticket/27395





---

archive/issue_comments_382569.json:
```json
{
    "body": "This is of course for cypari. The required change should be something like:\n`t3m-cypari-59bfbf53e4b0/Version2/cypari_src/pari_instance.pyx`\n\n```diff\n@@ -1412,8 +1412,14 @@\n             [1416875, [2, -1; 5, 4; 2267, 1], x^6 - 240*x^4 - 2550*x^3 - 11400*x^2 - 24100*x - 19855, [[2, [2, [Mod(1, 2)]], []], [5, [1, []], [\"[V] page 156\", [3]]], [2267, [2, [Mod(432, 2267)]], [\"[I{1-0-0}] page 170\", []]]]]\n         \"\"\"\n         cdef Gen t0 = objtogen(P)\n-        sig_on()\n-        return new_gen(genus2red(t0.g, NULL))\n+        cdef Gen p\n+        if P0 is None:\n+            sig_on()\n+            return new_gen(genus2red(t0.g, NULL))\n+        else\n+            p = objtogen(P0)\n+            sig_on()\n+            return  new_gen(genus2red(t0.g, p.g))\n \n     def List(self, x=None):\n         \"\"\"\n```\n\nI would know how to make this change in sage. A big draw-back of having externalized cypari is that I don't know how to change or submit the change there.",
    "created_at": "2019-03-01T23:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27158#issuecomment-382569",
    "user": "@nbruin"
}
```

This is of course for cypari. The required change should be something like:
`t3m-cypari-59bfbf53e4b0/Version2/cypari_src/pari_instance.pyx`

```diff
@@ -1412,8 +1412,14 @@
             [1416875, [2, -1; 5, 4; 2267, 1], x^6 - 240*x^4 - 2550*x^3 - 11400*x^2 - 24100*x - 19855, [[2, [2, [Mod(1, 2)]], []], [5, [1, []], ["[V] page 156", [3]]], [2267, [2, [Mod(432, 2267)]], ["[I{1-0-0}] page 170", []]]]]
         """
         cdef Gen t0 = objtogen(P)
-        sig_on()
-        return new_gen(genus2red(t0.g, NULL))
+        cdef Gen p
+        if P0 is None:
+            sig_on()
+            return new_gen(genus2red(t0.g, NULL))
+        else
+            p = objtogen(P0)
+            sig_on()
+            return  new_gen(genus2red(t0.g, p.g))
 
     def List(self, x=None):
         """
```

I would know how to make this change in sage. A big draw-back of having externalized cypari is that I don't know how to change or submit the change there.



---

archive/issue_comments_382570.json:
```json
{
    "body": "See pull request https://github.com/sagemath/cypari2/pull/79",
    "created_at": "2019-03-01T23:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27158#issuecomment-382570",
    "user": "@nbruin"
}
```

See pull request https://github.com/sagemath/cypari2/pull/79



---

archive/issue_comments_382571.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2019-03-02T06:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27158#issuecomment-382571",
    "user": "@jdemeyer"
}
```

Resolution: invalid



---

archive/issue_comments_382572.json:
```json
{
    "body": "I'm closing this ticket, since this is just an upstream bug. I'm already planning a new cypari2 release anyway soon.",
    "created_at": "2019-03-02T06:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27158#issuecomment-382572",
    "user": "@jdemeyer"
}
```

I'm closing this ticket, since this is just an upstream bug. I'm already planning a new cypari2 release anyway soon.



---

archive/issue_comments_382573.json:
```json
{
    "body": "Changing keywords from \"\" to \"genus2red, cypari2\".",
    "created_at": "2019-03-04T16:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27158#issuecomment-382573",
    "user": "@slel"
}
```

Changing keywords from "" to "genus2red, cypari2".



---

archive/issue_comments_382574.json:
```json
{
    "body": "Note: we upgrade to cypari2 2.1.0 in #27420.",
    "created_at": "2019-03-04T17:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27158",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27158#issuecomment-382574",
    "user": "@slel"
}
```

Note: we upgrade to cypari2 2.1.0 in #27420.
