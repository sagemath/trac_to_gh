# Issue 31970: homebrew  llvm / clang - followup to #30835

Issue created by migration from https://trac.sagemath.org/ticket/32207

Original creator: dimpase

Original creation time: 2021-07-16 10:29:38

CC:  mkoeppe jhpalmieri

in #30835 problems with using clang(++) from Homebrew on macOS were found

* Pillow build broken
* PATH needs to be adjusted (?)


---

Comment by dimpase created at 2021-07-19 15:42:25

reported here: https://github.com/python-pillow/Pillow/issues/5622


---

Comment by dimpase created at 2021-07-20 14:03:25

the setup.py patch in Pillow is obsolete anyway, and should be removed.


---

Comment by dimpase created at 2021-07-21 15:46:38

https://github.com/python-pillow/Pillow/pull/5624 provides a fix. Will backport here.


---

Comment by dimpase created at 2021-07-21 16:00:18

New commits:


---

Comment by dimpase created at 2021-07-21 16:00:18

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-12-18 19:53:12

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.


---

Comment by mkoeppe created at 2022-03-03 07:17:41

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2022-03-03 18:17:31

hopefully pillow problem will be fixed by #33116


---

Comment by dimpase created at 2022-03-03 23:41:09

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2022-03-03 23:41:09

we need to remove this obsolete (?) workaround to let Homebrew's clang do the job. Apparently also OK for Xcode's clang.
----
New commits:


---

Comment by dimpase created at 2022-03-15 19:36:20

The only thing to review here is removal of the Darwin-only Pillow workaround, which is no longer necessary, according to my tests.

Please review.


---

Comment by dimpase created at 2022-03-16 09:51:21

Changing keywords from "" to "macOS, Darwin".


---

Comment by jhpalmieri created at 2022-03-16 17:08:57

Can someone remind me of why, in the pillow installation log file, it says toward the end

```
Successfully built Pillow
WARNING: Skipping Pillow as it is not installed.
```



---

Comment by dimpase created at 2022-03-16 17:27:24

I guess it's coming from `pip` ?

```
src/pip/_internal/req/req_install.py: logger.warning("Skipping %s as it is not installed.", self.name)
```


namely, before installing a newly built wheel, `pip` is called to uninstall the package.
But if it wasn't installed one gets this warning. Harmless.


---

Comment by dimpase created at 2022-03-16 18:08:58


```
$ pip uninstall foobar
WARNING: Skipping foobar as it is not installed.
```



---

Comment by jhpalmieri created at 2022-03-17 21:03:41

Pillow builds for me (with the standard gcc, not using homebrew's llvm etc.). Sage itself does not — see my recent post on sage-support — so I can't test further.


---

Comment by dimpase created at 2022-03-17 23:33:47

I understand that #33522 fixes the scipy error you're talking about. It has nothing to do with this ticket, I think.


---

Comment by jhpalmieri created at 2022-03-18 00:39:30

I think you're right, but I would like to see for myself that Sage builds with this branch (+#33522).


---

Comment by jhpalmieri created at 2022-03-18 04:44:53

I haven't checked llvm/clang, but it works with the standard OS X clang + homebrew's gfortran. Is this good enough?


---

Comment by dimpase created at 2022-03-18 08:28:02

Yes, that's good enough. Thanks.


---

Comment by dimpase created at 2022-03-18 09:19:20

in case, tests are running on #33512#comment:3


---

Comment by jhpalmieri created at 2022-03-18 14:58:19

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2022-03-18 14:58:19

Great, let's merge it.


---

Comment by @GMS103 created at 2022-03-20 19:24:15

FWIW, Positive review on Apple Silicon M1 Macs with Homebrew up to date, both macOS 11.6.5 (Big Sur) with Xcode 13.2.1 and macOS 12.3 (Monterey) with Xcode 13.3.


---

Comment by vbraun created at 2022-03-27 15:43:25

Resolution: fixed
