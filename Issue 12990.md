# Issue 12990: add experimental libfes package

Issue created by migration from https://trac.sagemath.org/ticket/13162

Original creator: Bouillaguet

Original creation time: 2012-06-25 16:36:43

Assignee: malb

CC:  malb

libfes is a library (under development) that solves systems of boolean equations by exhaustive search. It is dramatically than Groebner bases in general.


## Installation Guide

* Download the fes-0.1 spkg [here](http://www.di.ens.fr/~bouillaguet/fes-0.1.spkg)
* Apply the fes.patch to the sage library
* Test:

```

sage: from sage.rings.polynomial.fes import exhaustive_search
sage: R.<x,y,z> = BooleanPolynomialRing()
sage: f = [x*y + z + y + 1, x+y+z, x*y + y*z]
sage: ideal(f).variety()
sage: exhaustive_search(f)
```



---

Comment by malb created at 2012-06-25 16:57:32

Hi, I found a few small issues (so far) :)

*SPKG*

 * little error in SPKG.txt

```
  === mypackage-0.1 (Charles Bouillaguet, 25 June 2012) ===
```

 * `hg status` in the SPKG reports files that are not checked in.
 * please include the Trac ticket number in the SPKG.txt changelog (and the hg commit message of your SPKG)

*Patch*

 * since FES is a library its interface should live in sage.libs.fes and not sage.rings.polynomial.fes
 * `exhaustive_search` has neither documentation nor doctests


---

Comment by malb created at 2012-06-25 16:57:32

Changing status from new to needs_review.


---

Comment by malb created at 2012-06-25 16:57:41

Changing status from needs_review to needs_work.


---

Comment by Bouillaguet created at 2012-06-28 19:13:34

patch and spkg updated


---

Comment by malb created at 2012-06-28 19:41:59

Hi, almost there IMHO:

 * the docstring isn't properly formated:
   * INPUT shouldn't get a double ":" but a single one
   * AFAIK the argument list after input should look like

```
INPUT:

 - ``foo`` - description
```

   * There shouldn't be leading "#" in your comments between code blocks, indentation does take care of it
   * `sage:` blocks should be indented by four spaces wrt to the preceding block ending with `::` this includes the comments in between these code blocks
 * who frees `dense_rep_eqs`?


---

Comment by Bouillaguet created at 2012-06-29 09:06:31

Hi,

patch modified again (use the second one, not the first one). I updated the docstrings according to the standard. Also, *NOW*, ``dense_rep_eqs`` is freed :)


---

Comment by Bouillaguet created at 2012-06-29 10:01:31

Changing status from needs_work to needs_review.


---

Comment by malb created at 2012-07-02 14:26:27

Changing status from needs_review to needs_work.


---

Comment by malb created at 2012-07-02 14:26:27

*SPKG*

 * This looks bad:


```
wrapper.c: In function ‘exhaustive_search_wrapper’:
wrapper.c:17:5: warning: implicit declaration of function ‘exhaustive_ia32’ [-Wimplicit-function-declaration]
wrapper.c:23:5: warning: implicit declaration of function ‘exhaustive_simd’ [-Wimplicit-function-declaration]
```

 * You should add "-fPIC" to CFLAGS in spkg-install, it won't compile without it (on my machine)

*Patch*

 * Your patch was incorrectly indented, I fixed this in the updated patch attached to this ticket.


---

Comment by Bouillaguet created at 2012-07-02 18:14:14

spkg updated (-fPIC and no compilation warnings)


---

Comment by Bouillaguet created at 2012-07-02 18:14:47

Changing status from needs_work to needs_review.


---

Comment by malb created at 2012-07-03 13:37:18

I still get:


```
main_simd.c: In function ‘main’:
main_simd.c:58:3: warning: implicit declaration of function ‘exhaustive_simd’ [-Wimplicit-function-declaration]
```


Btw. is there an upstream repository/website?


---

Comment by Bouillaguet created at 2012-07-03 22:04:35

Replying to [comment:15 malb]:

> Btw. is there an upstream repository/website?

https://bitbucket.org/fes/fes

It's fresh :)


---

Comment by malb created at 2012-07-04 09:07:16

And it's private, i.e., I cannot access it :)


---

Comment by Bouillaguet created at 2012-07-04 14:42:44

Replying to [comment:17 malb]:
> And it's private, i.e., I cannot access it :)

fixed


---

Comment by malb created at 2012-07-06 09:57:21

Hi, can you reproduce the error I am seeing (above)?


---

Comment by Bouillaguet created at 2012-07-06 13:33:56

Yes, I could. I corrected it "upstream" :). I am currently in Taïwan, notably to develop this thing with my colleagues here, so that it should change a lot in the next days. I will tell you when it stabilizes a bit (i.e. when we stop spending consecutive whole days working on it...)


---

Comment by Bouillaguet created at 2012-07-22 21:26:59

`@`malb : you [c/s]hould download again the .spkg (which has changed), and apply the new patch, after applying Alexander's patch in #13202. You will see a notable performance improvement (and higher degrees are supported as well)


---

Comment by Bouillaguet created at 2012-07-28 13:05:49

Changing component from commutative algebra to optional packages.


---

Comment by Bouillaguet created at 2012-12-13 07:10:07

Changing priority from minor to major.


---

Comment by Bouillaguet created at 2012-12-13 07:10:07

Changing component from optional packages to experimental package.


---

Comment by Bouillaguet created at 2012-12-13 07:41:02

Hi martin,

ready for review :)


---

Comment by malb created at 2012-12-18 14:29:16

Changing status from needs_review to needs_work.


---

Comment by malb created at 2012-12-18 14:29:16

Hi Charles, sorry being so late in my reply:

 * line 2: Sage is spelled Sage not SAGE, in fact "Binding for the FES library" should be sufficient, that this is for Sage is kind of obvious
 * You define exhaustive_search as !`cpdef` but you don't specify input and output types, defeating the purpose of having it callable from C
 * If it that function ought to be a Python function then perhaps max_sols should accept infinity as a parameter for "no restriction". It's what the SAT solver interface in Sage does.
 * I'd swap !`verbose` and !`max_sols` because !`max_sols` changes the behaviour in a more fundamental way than !`verbose`.
 * One can also specify verbosity with !`set_verbose`, if you like !`verbose` as a parameter better for some reason, no strict need to change it, most people don't use !`set/get_verbose` in their code it seems.
 * "The order in which the solutions are returned is implementation dependent" if that's the case, then the doctests need to take that into account, i.e., they have the order hard coded at the moment. You could run sorted() on the output (in the doctests)
 * You can run PLE decomposition on your matrix (see sage.matrix.matrix_mod2_dense) which is a generalisation of LU and is very fast because it's implemented in M4RI
 * Isn't there some restriction for the number of variables?


---

Comment by Bouillaguet created at 2012-12-19 15:31:35

Hi Martin,

patch updated. Regarding the PLE decomposition, these functions are not used presently (the library would need to be updated first), but they were useful to develop the library...


---

Comment by Bouillaguet created at 2012-12-19 15:31:35

Changing status from needs_work to needs_review.


---

Comment by malb created at 2012-12-19 16:32:16

Changing status from needs_review to positive_review.


---

Comment by malb created at 2012-12-19 16:32:16

Looks good to me.


---

Comment by jdemeyer created at 2012-12-19 21:36:55

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2012-12-19 21:36:55

I know it's a detail, but better do it right: the indentation is sloppy. Sometimes, the indent is 4 spaces, other times 3 spaces. Please always use 4 spaces per indentation level.


---

Comment by Bouillaguet created at 2012-12-19 22:24:39

indentation has been fixed. Why does the emacs Pyrex-mode that ships with sage does this ?!? (I use TAB to indent...)


---

Comment by Bouillaguet created at 2012-12-19 22:24:39

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2012-12-19 22:53:57

The documentation doesn't build properly:

```
/release/merger/sage-5.6.beta1/devel/sage/doc/en/reference/sage/libs/fes.rst:11: WARNING: autodoc can't import/find module 'sage.libs.fes', it reported error: "No module named fes", please check your spelling and sys.path
```



---

Comment by jdemeyer created at 2012-12-19 22:53:57

Changing status from needs_review to needs_work.


---

Comment by Bouillaguet created at 2012-12-20 11:17:20

Martin, Jeroen,

My understanding is that this is caused by the conditional inclusion of the cython module to the Sage library, depending on whether the actual spkg has been installed. I thought that this was the way to go for experimental packages. But apparently, it prevents me from including stuff in the reference manual.

What should I do ? Unconditionally include the python code to the SAGE library and mark all the doctests as optional ?


---

Comment by jdemeyer created at 2012-12-20 11:22:29

I have no idea what to do, maybe ask sage-devel?


---

Comment by Bouillaguet created at 2012-12-21 07:44:56

Changing status from needs_work to needs_review.


---

Comment by Bouillaguet created at 2012-12-21 07:44:56

I gave up on modifying the reference manual. This will likely be accessible through martin's #13850, which makes me happy enough


---

Comment by Bouillaguet created at 2013-01-06 09:10:28

`@`malb : getting positively reviewed again ?


---

Comment by malb created at 2013-01-06 10:54:24

Yep


---

Comment by malb created at 2013-01-06 10:54:24

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-01-08 11:00:01

There are uncommitted changes in the spkg:

```
jdemeyer@sage:~/spkg/fes-0.1$ hg status
M spkg-install
```



---

Comment by jdemeyer created at 2013-01-08 11:02:10

The following can be removed from `spkg-install`:

```
unset RM

INCLUDES="-I$SAGE_LOCAL/include"
LIBDIRS="-L$SAGE_LOCAL/lib"
```


And if `$MAKE check` actually does something, it should be inside `spkg-check` and not in `spkg-install`.


---

Comment by jdemeyer created at 2013-01-08 11:02:17

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2013-01-08 12:21:43

All doctests in `fes.pyx` need to be marked

```
# optional - fes
```

such that doctests succeed when libFES is not installed.


---

Comment by Bouillaguet created at 2013-01-17 13:55:35

I updated the spkg (taking into account Jeroen's comments).

I don't think that marking the doctests as optional is necessary, as the .pyx file is NOT included in the source tree when the spkg is not installed (cf. magic in module_list.py).

However, the more I think about this, the more I am convinced that the right way to access this library from sage is through #13850. In that case, the doctest involving libFES in the documentation of ``.solve()`` would need to be marked optional, of course.


---

Comment by Bouillaguet created at 2013-01-17 13:55:35

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2013-01-17 14:03:04

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2013-01-17 14:03:04

Replying to [comment:42 Bouillaguet]:
> I updated the spkg (taking into account Jeroen's comments).
> 
> I don't think that marking the doctests as optional is necessary, as the .pyx file is NOT included in the source tree when the spkg is not installed (cf. magic in module_list.py).
That's not true.  The `module_list.py` magic is only about _compiling_ the Cython file, which is completely orthogonal to doctests.  The `fes.pyx` file is always there (regardless of whether it is compiled), so the doctests are there.


---

Comment by Bouillaguet created at 2013-01-18 16:35:39

new patch, because the library interface has changed


---

Comment by Bouillaguet created at 2013-01-18 16:38:16

Changing status from needs_work to needs_review.


---

Attachment

Hi malb & Jeroen. OK, I get it now, sorry for the noise. I marked the doctests as optional and fixed the spkg. 

Since I have installed the libFES package in my sage tree, I don't see how I could test without it? (how to uninstall a spkg ?).


---

Comment by malb created at 2013-01-20 16:14:14

I don't think you can (well, you can delete the files by hand of course).


---

Comment by Bouillaguet created at 2013-01-23 17:35:06

`@`malb : if you *don't* have the libFES spkg installed, can you check that this patch applies and passes the tests ?


---

Comment by malb created at 2013-01-23 18:42:23

Changing status from needs_review to positive_review.


---

Comment by malb created at 2013-01-23 18:42:23

Yep, all tests pass. Sorry for the delay!


---

Comment by schilly created at 2013-01-25 13:33:30

spkg is on the servers ...


---

Comment by jdemeyer created at 2013-01-26 09:53:41

Resolution: fixed
