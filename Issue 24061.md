# Issue 24061: Improve Morphism.is_identity()

archive/issues_024061.json:
```json
{
    "body": "CC:  @tscrim\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24298\n\n",
    "created_at": "2017-11-29T14:15:45Z",
    "labels": [
        "categories",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Improve Morphism.is_identity()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24061",
    "user": "@jdemeyer"
}
```
CC:  @tscrim



Issue created by migration from https://trac.sagemath.org/ticket/24298





---

archive/issue_comments_337210.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-11-29T14:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24061#issuecomment-337210",
    "user": "@jdemeyer"
}
```

New commits:



---

archive/issue_comments_337211.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-11-29T14:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24061#issuecomment-337211",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_337212.json:
```json
{
    "body": "What do you think about just having:\n\n```python\ndef is_identity(self):\n   return self._richcmp_(self._parent.identity(), Py_EQ)\n```\n\nand letting the parent handle the verification of being an endomorphism ring? IMO, this is more future-proof if we end up having a subclass `Endset` of `Homset`, where we could avoid the check. We might also want to cache the result of `identity` so we don't have to recreate a (simple) identity map on every call.\n\nOtherwise LGTM.",
    "created_at": "2017-11-30T01:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24061#issuecomment-337212",
    "user": "@tscrim"
}
```

What do you think about just having:

```python
def is_identity(self):
   return self._richcmp_(self._parent.identity(), Py_EQ)
```

and letting the parent handle the verification of being an endomorphism ring? IMO, this is more future-proof if we end up having a subclass `Endset` of `Homset`, where we could avoid the check. We might also want to cache the result of `identity` so we don't have to recreate a (simple) identity map on every call.

Otherwise LGTM.



---

archive/issue_comments_337213.json:
```json
{
    "body": "Replying to [comment:4 tscrim]:\n> What do you think about just having:\n> {{{#!python\n> def is_identity(self):\n>    return self._richcmp_(self._parent.identity(), Py_EQ)\n> }}}\n\nThat would be slightly less efficient because of the extra level of indirection. But you are right in principle.",
    "created_at": "2017-11-30T09:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24061#issuecomment-337213",
    "user": "@jdemeyer"
}
```

Replying to [comment:4 tscrim]:
> What do you think about just having:
> {{{#!python
> def is_identity(self):
>    return self._richcmp_(self._parent.identity(), Py_EQ)
> }}}

That would be slightly less efficient because of the extra level of indirection. But you are right in principle.



---

archive/issue_comments_337214.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-11-30T10:39:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24061#issuecomment-337214",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_337215.json:
```json
{
    "body": "Like this?",
    "created_at": "2017-11-30T10:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24061#issuecomment-337215",
    "user": "@jdemeyer"
}
```

Like this?



---

archive/issue_comments_337216.json:
```json
{
    "body": "There would be indirection until we have `identity` being a ``@`cached_method` (except for the first call of course). Yes, I do like that better (I forgot we do not want to propagate the error). Although it will always be slower in returning false because it needs to throw and catch the error. I guess there is a question of how much do we expect that users call this on non-endomorphism homsets? We should just override `is_endomorphism_set` to return `True` for the endset category, which is now #24304.",
    "created_at": "2017-11-30T11:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24061#issuecomment-337216",
    "user": "@tscrim"
}
```

There would be indirection until we have `identity` being a ``@`cached_method` (except for the first call of course). Yes, I do like that better (I forgot we do not want to propagate the error). Although it will always be slower in returning false because it needs to throw and catch the error. I guess there is a question of how much do we expect that users call this on non-endomorphism homsets? We should just override `is_endomorphism_set` to return `True` for the endset category, which is now #24304.



---

archive/issue_comments_337217.json:
```json
{
    "body": "What I am asking if you are okay with a speed penalty here for when a user doesn't realize that they are trying to check if it is the identity morphism over something that is not an endomorphism ring.\n\nI do plan on going further with #24304 and moving stuff from #24277 up to the category level (but at least for tonight I do not want to watch `morphism.pyx` and all the things that depend on it recompile `^^;;` ).",
    "created_at": "2017-11-30T11:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24061#issuecomment-337217",
    "user": "@tscrim"
}
```

What I am asking if you are okay with a speed penalty here for when a user doesn't realize that they are trying to check if it is the identity morphism over something that is not an endomorphism ring.

I do plan on going further with #24304 and moving stuff from #24277 up to the category level (but at least for tonight I do not want to watch `morphism.pyx` and all the things that depend on it recompile `^^;;` ).



---

archive/issue_comments_337218.json:
```json
{
    "body": "Replying to [comment:9 tscrim]:\n> What I am asking if you are okay with a speed penalty here for when a user doesn't realize that they are trying to check if it is the identity morphism over something that is not an endomorphism ring.\n\nI think so. Calling `is_identity()` is pretty meaningless on a non-Endset so I hope that it doesn't happen often in serious code.",
    "created_at": "2017-11-30T12:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24061#issuecomment-337218",
    "user": "@jdemeyer"
}
```

Replying to [comment:9 tscrim]:
> What I am asking if you are okay with a speed penalty here for when a user doesn't realize that they are trying to check if it is the identity morphism over something that is not an endomorphism ring.

I think so. Calling `is_identity()` is pretty meaningless on a non-Endset so I hope that it doesn't happen often in serious code.



---

archive/issue_comments_337219.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-30T12:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24061#issuecomment-337219",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_337220.json:
```json
{
    "body": "Then positive review. Thank you.",
    "created_at": "2017-11-30T12:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24061#issuecomment-337220",
    "user": "@tscrim"
}
```

Then positive review. Thank you.



---

archive/issue_comments_337221.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-12-13T17:37:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24061#issuecomment-337221",
    "user": "@vbraun"
}
```

Resolution: fixed
