# Issue 24061: Improve Morphism.is_identity()

Issue created by migration from https://trac.sagemath.org/ticket/24298

Original creator: jdemeyer

Original creation time: 2017-11-29 14:15:45

CC:  tscrim




---

Comment by jdemeyer created at 2017-11-29 14:35:02

New commits:


---

Comment by jdemeyer created at 2017-11-29 14:35:02

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-11-30 01:19:35

What do you think about just having:

```python
def is_identity(self):
   return self._richcmp_(self._parent.identity(), Py_EQ)
```

and letting the parent handle the verification of being an endomorphism ring? IMO, this is more future-proof if we end up having a subclass `Endset` of `Homset`, where we could avoid the check. We might also want to cache the result of `identity` so we don't have to recreate a (simple) identity map on every call.

Otherwise LGTM.


---

Comment by jdemeyer created at 2017-11-30 09:43:11

Replying to [comment:4 tscrim]:
> What do you think about just having:
> {{{#!python
> def is_identity(self):
>    return self._richcmp_(self._parent.identity(), Py_EQ)
> }}}

That would be slightly less efficient because of the extra level of indirection. But you are right in principle.


---

Comment by git created at 2017-11-30 10:39:13

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2017-11-30 10:43:17

Like this?


---

Comment by tscrim created at 2017-11-30 11:44:47

There would be indirection until we have `identity` being a ``@`cached_method` (except for the first call of course). Yes, I do like that better (I forgot we do not want to propagate the error). Although it will always be slower in returning false because it needs to throw and catch the error. I guess there is a question of how much do we expect that users call this on non-endomorphism homsets? We should just override `is_endomorphism_set` to return `True` for the endset category, which is now #24304.


---

Comment by tscrim created at 2017-11-30 11:49:19

What I am asking if you are okay with a speed penalty here for when a user doesn't realize that they are trying to check if it is the identity morphism over something that is not an endomorphism ring.

I do plan on going further with #24304 and moving stuff from #24277 up to the category level (but at least for tonight I do not want to watch `morphism.pyx` and all the things that depend on it recompile `^^;;` ).


---

Comment by jdemeyer created at 2017-11-30 12:37:46

Replying to [comment:9 tscrim]:
> What I am asking if you are okay with a speed penalty here for when a user doesn't realize that they are trying to check if it is the identity morphism over something that is not an endomorphism ring.

I think so. Calling `is_identity()` is pretty meaningless on a non-Endset so I hope that it doesn't happen often in serious code.


---

Comment by tscrim created at 2017-11-30 12:46:30

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-11-30 12:46:30

Then positive review. Thank you.


---

Comment by vbraun created at 2017-12-13 17:37:42

Resolution: fixed
