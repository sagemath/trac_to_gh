# Issue 31928: One failing doctest in src/sage/rings/number_field/number_field_ideal.py

Issue created by migration from https://trac.sagemath.org/ticket/32165

Original creator: @DavidAyotte

Original creation time: 2021-07-08 19:34:01

CC:  vdelecroix

Keywords: failing doctest number field

While reviewing a ticket (see ticket:31414#comment:3), I found a failing doctest:


```
Running doctests with ID 2021-07-08-06-41-40-38e24fd4.
Git branch: develop
Using --optional=build,debian,dochtml,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --random-seed=0 src/sage/rings/number_field/number_field_ideal.py
**********************************************************************
File "src/sage/rings/number_field/number_field_ideal.py", line 2199, in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.invertible_residues
Failed example:
    list(K.ideal(8).invertible_residues())[:5]
Expected:
    [1, a - 1, -3*a, -2*a + 3, -a - 1]
Got:
    [1, a + 2, 3*a + 3, -2*a + 3, a]
**********************************************************************
1 item had failures:
   1 of  17 in sage.rings.number_field.number_field_ideal.NumberFieldFractionalIdeal.invertible_residues
    [685 tests, 1 failure, 6.16 s]
----------------------------------------------------------------------
sage -t --random-seed=0 src/sage/rings/number_field/number_field_ideal.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 6.4 seconds
    cpu time: 5.8 seconds
    cumulative wall time: 6.2 seconds
```


It was also mentionned in ticket:31443#comment:119. This failing test was produced while running [SageMath](SageMath) version 9.4.beta4 on Ubuntu 20.04.1.

I could not find any specific ticket for this issue, but if there is one already, please tell me and close this ticket.


---

Comment by cremona created at 2021-07-09 08:36:59

I'll fix the test to not rely on the order of the elements of the list, as I suggested on #31443.


---

Comment by cremona created at 2021-07-09 10:19:57

On second thoughts, I see that this test was introduced recently (in #30801) just to test that the numbers returned are all integral, so I am going to change the test to

```
sage: K.<a> = NumberField(x^2 + x + 1)                                                                                                                
sage: all(x.is_integral() for x in K.ideal(8).invertible_residues())                                                                                  
True
```



---

Comment by cremona created at 2021-07-09 10:38:20

Changing status from new to needs_review.


---

Comment by cremona created at 2021-07-09 10:38:20

New commits:


---

Comment by @DavidAyotte created at 2021-07-09 13:04:09

Thank you very much John for quickly fixing this!


---

Comment by @DavidAyotte created at 2021-07-09 13:04:09

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-07-19 00:13:59

Changing priority from major to critical.


---

Comment by vbraun created at 2021-07-23 20:11:43

Resolution: fixed
