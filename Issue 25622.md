# Issue 25622: Package uninstallation should happen before upgrading packages

archive/issues_025622.json:
```json
{
    "body": "I thought I did make this change in an earlier ticket, but maybe that ticket hasn't been merged yet, and now I can't find reference to it.\n\nFor \"old-style\" package installations that don't have a file manifest, it doesn't make sense to run `sage-spkg-uninstall` *after* running its `spkg-install`, since that can have the effect of *removing* files from `$SAGE_LOCAL` that were just installed.\n\nIt also makes sense to uninstall first even for \"new-style\" packages, since some packages don't build correctly unless the previous version of that package is removed first (e.g. Python).  See the commit message for more details.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25859\n\n",
    "created_at": "2018-07-13T15:34:24Z",
    "labels": [
        "build",
        "blocker",
        "bug"
    ],
    "title": "Package uninstallation should happen before upgrading packages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25622",
    "user": "embray"
}
```
I thought I did make this change in an earlier ticket, but maybe that ticket hasn't been merged yet, and now I can't find reference to it.

For "old-style" package installations that don't have a file manifest, it doesn't make sense to run `sage-spkg-uninstall` *after* running its `spkg-install`, since that can have the effect of *removing* files from `$SAGE_LOCAL` that were just installed.

It also makes sense to uninstall first even for "new-style" packages, since some packages don't build correctly unless the previous version of that package is removed first (e.g. Python).  See the commit message for more details.

Issue created by migration from https://trac.sagemath.org/ticket/25859





---

archive/issue_comments_361346.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-07-13T15:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25622#issuecomment-361346",
    "user": "embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_361347.json:
```json
{
    "body": "Confirmed that this fixes the issue reported in #25856, and likely similar issues.",
    "created_at": "2018-07-13T15:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25622#issuecomment-361347",
    "user": "embray"
}
```

Confirmed that this fixes the issue reported in #25856, and likely similar issues.



---

archive/issue_comments_361348.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-07-13T18:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25622#issuecomment-361348",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_361349.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-07-14T19:23:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25622#issuecomment-361349",
    "user": "vbraun"
}
```

Resolution: fixed
