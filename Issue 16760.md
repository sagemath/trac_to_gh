# Issue 16760: Upgrade PARI to git master

archive/issues_016760.json:
```json
{
    "body": "CC:  pbruin fbissey\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/16997\n\n",
    "created_at": "2014-09-17T08:28:46Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "title": "Upgrade PARI to git master",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16760",
    "user": "jdemeyer"
}
```
CC:  pbruin fbissey



Issue created by migration from https://trac.sagemath.org/ticket/16997





---

archive/issue_comments_221582.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-09-17T13:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221582",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_221583.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-19T13:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221583",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221584.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-23T14:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221584",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221585.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-23T16:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221585",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221586.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-23T16:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221586",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221587.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-23T19:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221587",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221588.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-23T20:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221588",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221589.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-24T06:40:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221589",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221590.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-24T10:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221590",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221591.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-24T11:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221591",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221592.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-24T11:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221592",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_221593.json:
```json
{
    "body": "This patch changes a French book doctest.",
    "created_at": "2014-09-24T11:42:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221593",
    "user": "jdemeyer"
}
```

This patch changes a French book doctest.



---

archive/issue_comments_221594.json:
```json
{
    "body": "Attachment\n\nRemoved patch",
    "created_at": "2014-10-08T13:58:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221594",
    "user": "jdemeyer"
}
```

Attachment

Removed patch



---

archive/issue_comments_221595.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-10-08T14:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221595",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221596.json:
```json
{
    "body": "I removed my name in the cc list, since it makes no sense to try to maintain coherence of the french\ndoctests with our book: there are now too many changes which break the examples from the book.\n\nPaul",
    "created_at": "2014-10-08T14:56:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221596",
    "user": "zimmerma"
}
```

I removed my name in the cc list, since it makes no sense to try to maintain coherence of the french
doctests with our book: there are now too many changes which break the examples from the book.

Paul



---

archive/issue_comments_221597.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-10-08T15:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221597",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221598.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-10-08T15:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221598",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221599.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-10-08T16:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221599",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221600.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-10-08T20:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221600",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221601.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-10-09T08:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221601",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221602.json:
```json
{
    "body": "I have removed the controversial patches, it now needs review again.",
    "created_at": "2014-10-09T09:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221602",
    "user": "jdemeyer"
}
```

I have removed the controversial patches, it now needs review again.



---

archive/issue_comments_221603.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-10-13T06:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221603",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221604.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-10-13T06:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221604",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221605.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-12-03T14:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221605",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_221606.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-12-03T14:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221606",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221607.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-12-03T15:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221607",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221608.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-12-03T15:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221608",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221609.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-12-03T20:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221609",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_221610.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-01-12T13:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221610",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_221611.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-01-12T14:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221611",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221612.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-01-12T16:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221612",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221613.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-01-12T16:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221613",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_221614.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-01-15T09:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221614",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221615.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-07T21:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221615",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_221616.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-08T07:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221616",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221617.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-08T07:42:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221617",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_221618.json:
```json
{
    "body": "Do we change the package name to `sage-pari` as it was discussed on sage-devel?",
    "created_at": "2015-02-24T10:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221618",
    "user": "vdelecroix"
}
```

Do we change the package name to `sage-pari` as it was discussed on sage-devel?



---

archive/issue_comments_221619.json:
```json
{
    "body": "After my long rant (and mostly getting stuff out of my chest) I no longer think it is necessary. Let me explain:\n* it is not just giving a name to the tarball. You would want a distinct name for the library and the executable.\n* for sanity reason you don't want to carry 2 versions of pari, one for the package and one for the library. So you get to change all the packages that link to pari at least.\n* Last but not least. There are not that many packages using pari that are not in sage and a lot of them depend on ancient pari (2.3). So unless someone pulls a list of software using pari from under their beds i think the point on maintaining the stack is moot.\n\nI did some homework on the last point in Gentoo I am not sure what it would hold for debian but I am willing to bet it will be about the same.",
    "created_at": "2015-02-24T10:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221619",
    "user": "fbissey"
}
```

After my long rant (and mostly getting stuff out of my chest) I no longer think it is necessary. Let me explain:
* it is not just giving a name to the tarball. You would want a distinct name for the library and the executable.
* for sanity reason you don't want to carry 2 versions of pari, one for the package and one for the library. So you get to change all the packages that link to pari at least.
* Last but not least. There are not that many packages using pari that are not in sage and a lot of them depend on ancient pari (2.3). So unless someone pulls a list of software using pari from under their beds i think the point on maintaining the stack is moot.

I did some homework on the last point in Gentoo I am not sure what it would hold for debian but I am willing to bet it will be about the same.



---

archive/issue_comments_221620.json:
```json
{
    "body": "By the way: if somebody actually feels like reviewing this, let me know. Then I will update the branch.",
    "created_at": "2015-02-24T11:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221620",
    "user": "jdemeyer"
}
```

By the way: if somebody actually feels like reviewing this, let me know. Then I will update the branch.



---

archive/issue_comments_221621.json:
```json
{
    "body": "I'll need a little bit of time to get over all the dependency but once I get there I may review this.\nOne question however: is the new patch public_memory_functions.patch something waiting for inclusion upstream? As of this morning it would probably still apply (I now have a live ebuild for pari and this morning master is not *broken*, not like 2 days ago).",
    "created_at": "2015-02-24T20:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221621",
    "user": "fbissey"
}
```

I'll need a little bit of time to get over all the dependency but once I get there I may review this.
One question however: is the new patch public_memory_functions.patch something waiting for inclusion upstream? As of this morning it would probably still apply (I now have a live ebuild for pari and this morning master is not *broken*, not like 2 days ago).



---

archive/issue_comments_221622.json:
```json
{
    "body": "Replying to [comment:54 fbissey]:\n> One question however: is the new patch public_memory_functions.patch something waiting for inclusion upstream?\nConsider this a \"transient\" patch. PARI upstream has changed their stack-handling in a non-backwards-compatible way. This patch `public_memory_functions.patch` is what's needed to use the current Sage hooks for dealing with the PARI stack. A follow-up ticket could use the new PARI stack mechanism.",
    "created_at": "2015-02-24T20:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221622",
    "user": "jdemeyer"
}
```

Replying to [comment:54 fbissey]:
> One question however: is the new patch public_memory_functions.patch something waiting for inclusion upstream?
Consider this a "transient" patch. PARI upstream has changed their stack-handling in a non-backwards-compatible way. This patch `public_memory_functions.patch` is what's needed to use the current Sage hooks for dealing with the PARI stack. A follow-up ticket could use the new PARI stack mechanism.



---

archive/issue_comments_221623.json:
```json
{
    "body": "Replying to [comment:54 fbissey]:\n> I'll need a little bit of time to get over all the dependency\nWhat does \"get over all the dependency\" mean???",
    "created_at": "2015-02-25T09:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221623",
    "user": "jdemeyer"
}
```

Replying to [comment:54 fbissey]:
> I'll need a little bit of time to get over all the dependency
What does "get over all the dependency" mean???



---

archive/issue_comments_221624.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-25T09:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221624",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_221625.json:
```json
{
    "body": "To be honest I thought there would be more package depending on pari and that more would be impacted. But apart from sage itself that's just lcalc. If we are looking at optional package there may be MaCaulay2.",
    "created_at": "2015-02-25T09:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221625",
    "user": "fbissey"
}
```

To be honest I thought there would be more package depending on pari and that more would be impacted. But apart from sage itself that's just lcalc. If we are looking at optional package there may be MaCaulay2.



---

archive/issue_comments_221626.json:
```json
{
    "body": "`eclib` also depends on `pari`.",
    "created_at": "2015-02-25T09:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221626",
    "user": "jdemeyer"
}
```

`eclib` also depends on `pari`.



---

archive/issue_comments_221627.json:
```json
{
    "body": "Replying to [comment:59 jdemeyer]:\n> `eclib` also depends on `pari`.\n\nAnd I noticed that the extent of your fix is adding the standard patching code in spkg-install. I can do some more checking with it but I can believe eclib will be unaffected since John already did a fix for pari 2.8 https://github.com/JohnCremona/eclib/commit/652337883464b277f52901c7bcaf9c71001e0c3c",
    "created_at": "2015-02-25T10:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221627",
    "user": "fbissey"
}
```

Replying to [comment:59 jdemeyer]:
> `eclib` also depends on `pari`.

And I noticed that the extent of your fix is adding the standard patching code in spkg-install. I can do some more checking with it but I can believe eclib will be unaffected since John already did a fix for pari 2.8 https://github.com/JohnCremona/eclib/commit/652337883464b277f52901c7bcaf9c71001e0c3c



---

archive/issue_comments_221628.json:
```json
{
    "body": "And if we want to be complete sympow depends on pari but only through gp.",
    "created_at": "2015-02-25T10:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221628",
    "user": "fbissey"
}
```

And if we want to be complete sympow depends on pari but only through gp.



---

archive/issue_comments_221629.json:
```json
{
    "body": "Replying to [comment:60 fbissey]:\n> Replying to [comment:59 jdemeyer]:\n> > `eclib` also depends on `pari`.\n> \n> And I noticed that the extent of your fix is adding the standard patching code in spkg-install. I can do some more checking with it but I can believe eclib will be unaffected since John already did a fix for pari 2.8\n\nYes, I know. In an earlier version of this branch, I had to explicitly add a patch and the \"patching loop\" in `spkg-install`. I left the patching loop since it makes sense anyway to have it.\n\nI am currently in the process of upgrading this branch to the latest PARI.",
    "created_at": "2015-02-25T10:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221629",
    "user": "jdemeyer"
}
```

Replying to [comment:60 fbissey]:
> Replying to [comment:59 jdemeyer]:
> > `eclib` also depends on `pari`.
> 
> And I noticed that the extent of your fix is adding the standard patching code in spkg-install. I can do some more checking with it but I can believe eclib will be unaffected since John already did a fix for pari 2.8

Yes, I know. In an earlier version of this branch, I had to explicitly add a patch and the "patching loop" in `spkg-install`. I left the patching loop since it makes sense anyway to have it.

I am currently in the process of upgrading this branch to the latest PARI.



---

archive/issue_comments_221630.json:
```json
{
    "body": "Can you put an spkg-src this time? \"make snapshot\" is not enough to reproduce a given tarball, we should know the precise commit at which you snapshot.",
    "created_at": "2015-02-25T10:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221630",
    "user": "fbissey"
}
```

Can you put an spkg-src this time? "make snapshot" is not enough to reproduce a given tarball, we should know the precise commit at which you snapshot.



---

archive/issue_comments_221631.json:
```json
{
    "body": "Replying to [comment:63 fbissey]:\n> \"make snapshot\" is not enough to reproduce a given tarball, we should know the precise commit at which you snapshot.\n\nThe commit is in `build/pkgs/pari/package-version.txt`, is that not sufficient?",
    "created_at": "2015-02-25T10:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221631",
    "user": "jdemeyer"
}
```

Replying to [comment:63 fbissey]:
> "make snapshot" is not enough to reproduce a given tarball, we should know the precise commit at which you snapshot.

The commit is in `build/pkgs/pari/package-version.txt`, is that not sufficient?



---

archive/issue_comments_221632.json:
```json
{
    "body": "Replying to [comment:64 jdemeyer]:\n> Replying to [comment:63 fbissey]:\n> > \"make snapshot\" is not enough to reproduce a given tarball, we should know the precise commit at which you snapshot.\n> \n> The commit is in `build/pkgs/pari/package-version.txt`, is that not sufficient?\n\nI guess it is. I am too lazy ;)",
    "created_at": "2015-02-25T10:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221632",
    "user": "fbissey"
}
```

Replying to [comment:64 jdemeyer]:
> Replying to [comment:63 fbissey]:
> > "make snapshot" is not enough to reproduce a given tarball, we should know the precise commit at which you snapshot.
> 
> The commit is in `build/pkgs/pari/package-version.txt`, is that not sufficient?

I guess it is. I am too lazy ;)



---

archive/issue_comments_221633.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-25T11:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221633",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221634.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-25T11:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221634",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_221635.json:
```json
{
    "body": "Replying to [comment:61 fbissey]:\n> And if we want to be complete sympow depends on pari but only through gp.\nI didn't know that, but you're right.",
    "created_at": "2015-02-25T11:20:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221635",
    "user": "jdemeyer"
}
```

Replying to [comment:61 fbissey]:
> And if we want to be complete sympow depends on pari but only through gp.
I didn't know that, but you're right.



---

archive/issue_comments_221636.json:
```json
{
    "body": "OK now I am starting tests. A technical question about upstream's intention. The current soname for pari 2.7 is libpari-gmp.so.4 the one from git master is libpari-gmp-2.8.so.0 do you know if it is temporary until 2.8 is released (and switch to something like libpari-gmp.so.5) or it is their plan to stick with that soname?",
    "created_at": "2015-02-25T20:23:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221636",
    "user": "fbissey"
}
```

OK now I am starting tests. A technical question about upstream's intention. The current soname for pari 2.7 is libpari-gmp.so.4 the one from git master is libpari-gmp-2.8.so.0 do you know if it is temporary until 2.8 is released (and switch to something like libpari-gmp.so.5) or it is their plan to stick with that soname?



---

archive/issue_comments_221637.json:
```json
{
    "body": "I think I found the answer to my own question in config directory. They have a different scheme for even numbered release on purpose. Which makes life hard for automated rebuilding in gentoo. I'll have to force things there.",
    "created_at": "2015-02-25T20:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221637",
    "user": "fbissey"
}
```

I think I found the answer to my own question in config directory. They have a different scheme for even numbered release on purpose. Which makes life hard for automated rebuilding in gentoo. I'll have to force things there.



---

archive/issue_comments_221638.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-25T22:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221638",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_221639.json:
```json
{
    "body": "OK passes a few sanity checks so this is ready for bot testing.",
    "created_at": "2015-02-25T22:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221639",
    "user": "fbissey"
}
```

OK passes a few sanity checks so this is ready for bot testing.



---

archive/issue_comments_221640.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2015-02-26T12:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221640",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_221641.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2015-02-26T12:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221641",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_221642.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-26T12:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221642",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_221643.json:
```json
{
    "body": "I also get on some buildbots:\n\n```\nsage -t --long src/sage/modular/modform_hecketriangle/hecke_triangle_group_element.py\n**********************************************************************\nFile \"src/sage/modular/modform_hecketriangle/hecke_triangle_group_element.py\", line 38, in sage.modular.modform_hecketriangle.hecke_triangle_group_element.coerce_AA\nFailed example:\n    AA(p)._exact_field()\nExpected:\n    Number Field in a with defining polynomial y^16 + ... with a in ...\nGot:\n    Number Field in a with defining polynomial y^16 - 1312*y^14 + 864612*y^12 - 2512720*y^11 - 50780668*y^10 + 360028808*y^9 - 48779642409*y^8 + 290398268512*y^7 + 15186503722504*y^6 - 566858046818416*y^5 + 27431234189939174*y^4 - 226711842252026288*y^3 + 7395502353944441460*y^2 - 39603059247494358200*y + 911555406262192128578 with a in -25.34269035681775? - 10.68732885060488?*I\n**********************************************************************\n1 item had failures:\n   1 of   5 in sage.modular.modform_hecketriangle.hecke_triangle_group_element.coerce_AA\n    [709 tests, 1 failure, 115.89 s]\n```\n\nand\n\n```\nsage -t --long src/sage/lfunctions/dokchitser.py\n**********************************************************************\nFile \"src/sage/lfunctions/dokchitser.py\", line 127, in sage.lfunctions.dokchitser.Dokchitser\nFailed example:\n    L.taylor_series(1,4)\nExpected:\n    2.90614059330736e-20 + (-1.64690098288532e-20)*z + 0.759316500288427*z^2 - 0.430302337583362*z^3 + O(z^4)  \nGot:\n    -1.15498883731660e-19 + (6.54528640417060e-20)*z + 0.759316500288427*z^2 - 0.430302337583362*z^3 + O(z^4)\n**********************************************************************\n```\n",
    "created_at": "2015-02-26T12:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221643",
    "user": "vbraun"
}
```

I also get on some buildbots:

```
sage -t --long src/sage/modular/modform_hecketriangle/hecke_triangle_group_element.py
**********************************************************************
File "src/sage/modular/modform_hecketriangle/hecke_triangle_group_element.py", line 38, in sage.modular.modform_hecketriangle.hecke_triangle_group_element.coerce_AA
Failed example:
    AA(p)._exact_field()
Expected:
    Number Field in a with defining polynomial y^16 + ... with a in ...
Got:
    Number Field in a with defining polynomial y^16 - 1312*y^14 + 864612*y^12 - 2512720*y^11 - 50780668*y^10 + 360028808*y^9 - 48779642409*y^8 + 290398268512*y^7 + 15186503722504*y^6 - 566858046818416*y^5 + 27431234189939174*y^4 - 226711842252026288*y^3 + 7395502353944441460*y^2 - 39603059247494358200*y + 911555406262192128578 with a in -25.34269035681775? - 10.68732885060488?*I
**********************************************************************
1 item had failures:
   1 of   5 in sage.modular.modform_hecketriangle.hecke_triangle_group_element.coerce_AA
    [709 tests, 1 failure, 115.89 s]
```

and

```
sage -t --long src/sage/lfunctions/dokchitser.py
**********************************************************************
File "src/sage/lfunctions/dokchitser.py", line 127, in sage.lfunctions.dokchitser.Dokchitser
Failed example:
    L.taylor_series(1,4)
Expected:
    2.90614059330736e-20 + (-1.64690098288532e-20)*z + 0.759316500288427*z^2 - 0.430302337583362*z^3 + O(z^4)  
Got:
    -1.15498883731660e-19 + (6.54528640417060e-20)*z + 0.759316500288427*z^2 - 0.430302337583362*z^3 + O(z^4)
**********************************************************************
```




---

archive/issue_comments_221644.json:
```json
{
    "body": "The first one is because of interaction with #16976.",
    "created_at": "2015-02-26T13:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221644",
    "user": "jdemeyer"
}
```

The first one is because of interaction with #16976.



---

archive/issue_comments_221645.json:
```json
{
    "body": "The `dokchitser` failure is at least related to this ticket, but I don't see what could cause the failure... Maybe there is also some interaction with another ticket?",
    "created_at": "2015-02-26T13:15:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221645",
    "user": "jdemeyer"
}
```

The `dokchitser` failure is at least related to this ticket, but I don't see what could cause the failure... Maybe there is also some interaction with another ticket?



---

archive/issue_comments_221646.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2015-02-26T13:42:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221646",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_221647.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. Last 10 new commits:",
    "created_at": "2015-02-26T13:42:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221647",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. Last 10 new commits:



---

archive/issue_comments_221648.json:
```json
{
    "body": "Merged with #16976 and fixed first failure.",
    "created_at": "2015-02-26T13:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221648",
    "user": "jdemeyer"
}
```

Merged with #16976 and fixed first failure.



---

archive/issue_comments_221649.json:
```json
{
    "body": "For the `dokchitser` failure, there is some annoying global state (which is probably a bug) in the `computel.gp` script. For example, in the doctest\n\n```\n        sage: E = EllipticCurve('389a')\n        sage: L = E.lseries().dokchitser()\n        sage: L.num_coeffs ()\n        156\n        sage: L.derivative(1,E.rank())\n        1.51863300057685\n        sage: L.taylor_series(1,4)\n        2.90760251490292e-20 + (-1.64772944938078e-20)*z + 0.759316500288427*z^2 - 0.430302337583362*z^3 + O(z^4)  # 32-bit\n        2.90614059330736e-20 + (-1.64690098288532e-20)*z + 0.759316500288427*z^2 - 0.430302337583362*z^3 + O(z^4)  # 64-bit\n```\n\n\nremoving the `L.num_coeffs ()` test changes the last results.",
    "created_at": "2015-02-26T14:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221649",
    "user": "jdemeyer"
}
```

For the `dokchitser` failure, there is some annoying global state (which is probably a bug) in the `computel.gp` script. For example, in the doctest

```
        sage: E = EllipticCurve('389a')
        sage: L = E.lseries().dokchitser()
        sage: L.num_coeffs ()
        156
        sage: L.derivative(1,E.rank())
        1.51863300057685
        sage: L.taylor_series(1,4)
        2.90760251490292e-20 + (-1.64772944938078e-20)*z + 0.759316500288427*z^2 - 0.430302337583362*z^3 + O(z^4)  # 32-bit
        2.90614059330736e-20 + (-1.64690098288532e-20)*z + 0.759316500288427*z^2 - 0.430302337583362*z^3 + O(z^4)  # 64-bit
```


removing the `L.num_coeffs ()` test changes the last results.



---

archive/issue_comments_221650.json:
```json
{
    "body": "Aren't both answers valid (up to numerical precision). Its somewhat annoying for testing purposes, maybe reset the state with other rng seeds.",
    "created_at": "2015-02-26T14:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221650",
    "user": "vbraun"
}
```

Aren't both answers valid (up to numerical precision). Its somewhat annoying for testing purposes, maybe reset the state with other rng seeds.



---

archive/issue_comments_221651.json:
```json
{
    "body": "Indeed\n\n```\nsage: E = EllipticCurve('389a')\nsage: L = E.lseries().dokchitser()\nsage: L.derivative(1,E.rank())\n1.51863300057685\nsage: s4_1 = L.taylor_series(1,4)\nsage: L.num_coeffs ()\n156\nsage: s4_2 = L.taylor_series(1,4)\nsage: s4_1 == s4_2\nFalse\nsage: s4_1 - s4_2\n-2.90886971068887e-20 + (1.64844756535569e-20)*z + O(z^4)\n```\n",
    "created_at": "2015-02-26T14:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221651",
    "user": "vdelecroix"
}
```

Indeed

```
sage: E = EllipticCurve('389a')
sage: L = E.lseries().dokchitser()
sage: L.derivative(1,E.rank())
1.51863300057685
sage: s4_1 = L.taylor_series(1,4)
sage: L.num_coeffs ()
156
sage: s4_2 = L.taylor_series(1,4)
sage: s4_1 == s4_2
False
sage: s4_1 - s4_2
-2.90886971068887e-20 + (1.64844756535569e-20)*z + O(z^4)
```




---

archive/issue_comments_221652.json:
```json
{
    "body": "AFAIK, it's not a rng issue. It's just that the result depends on seemingly unrelated things (like whether or not `L.num_coeffs()` has been called).\n\nVolker, do have an idea which elliptic-curve/L-function related ticket could have caused this?",
    "created_at": "2015-02-26T14:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221652",
    "user": "jdemeyer"
}
```

AFAIK, it's not a rng issue. It's just that the result depends on seemingly unrelated things (like whether or not `L.num_coeffs()` has been called).

Volker, do have an idea which elliptic-curve/L-function related ticket could have caused this?



---

archive/issue_comments_221653.json:
```json
{
    "body": "All doctests pass without the pari update, so its this ticket.",
    "created_at": "2015-02-26T14:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221653",
    "user": "vbraun"
}
```

All doctests pass without the pari update, so its this ticket.



---

archive/issue_comments_221654.json:
```json
{
    "body": "Replying to [comment:83 vbraun]:\n> All doctests pass without the pari update, so its this ticket.\nAll doctests also pass when just this ticket is applied, so it must be some interaction between this ticket and another unspecified ticket.",
    "created_at": "2015-02-26T16:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221654",
    "user": "jdemeyer"
}
```

Replying to [comment:83 vbraun]:
> All doctests pass without the pari update, so its this ticket.
All doctests also pass when just this ticket is applied, so it must be some interaction between this ticket and another unspecified ticket.



---

archive/issue_comments_221655.json:
```json
{
    "body": "Sided note: why is `dokchister` included as such in Sage source files? Wouldn't it be better as an external gp library (let say `$SAGE_ROOT/local/pari/`)? Morever, we ship version 1.3 and current version is 1.3.3 (see [http://www.maths.bris.ac.uk/~matyd/computel/index.html](http://www.maths.bris.ac.uk/~matyd/computel/index.html)). Though the last version does not solve the issue at all (but at least the `src/ext/pari/dokchister/testall` script is not emitting any warning anymore).",
    "created_at": "2015-02-26T16:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221655",
    "user": "vdelecroix"
}
```

Sided note: why is `dokchister` included as such in Sage source files? Wouldn't it be better as an external gp library (let say `$SAGE_ROOT/local/pari/`)? Morever, we ship version 1.3 and current version is 1.3.3 (see [http://www.maths.bris.ac.uk/~matyd/computel/index.html](http://www.maths.bris.ac.uk/~matyd/computel/index.html)). Though the last version does not solve the issue at all (but at least the `src/ext/pari/dokchister/testall` script is not emitting any warning anymore).



---

archive/issue_comments_221656.json:
```json
{
    "body": "Replying to [comment:85 vdelecroix]:\n> Sided note: why is `dokchister` included as such in Sage source files?\nHistorical reasons. There are various such scripts in `src/ext`.\n\n> Wouldn't it be better as an external gp library (let say `$SAGE_ROOT/local/pari/`)? Morever, we ship version 1.3 and current version is 1.3.3 (see [http://www.maths.bris.ac.uk/~matyd/computel/index.html](http://www.maths.bris.ac.uk/~matyd/computel/index.html)). Though the last version does not solve the issue at all (but at least the `src/ext/pari/dokchister/testall` script is not emitting any warning anymore).\nPerhaps, but let's leave that for a different ticket.",
    "created_at": "2015-02-26T16:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221656",
    "user": "jdemeyer"
}
```

Replying to [comment:85 vdelecroix]:
> Sided note: why is `dokchister` included as such in Sage source files?
Historical reasons. There are various such scripts in `src/ext`.

> Wouldn't it be better as an external gp library (let say `$SAGE_ROOT/local/pari/`)? Morever, we ship version 1.3 and current version is 1.3.3 (see [http://www.maths.bris.ac.uk/~matyd/computel/index.html](http://www.maths.bris.ac.uk/~matyd/computel/index.html)). Though the last version does not solve the issue at all (but at least the `src/ext/pari/dokchister/testall` script is not emitting any warning anymore).
Perhaps, but let's leave that for a different ticket.



---

archive/issue_comments_221657.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-27T16:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221657",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_221658.json:
```json
{
    "body": "I cannot reproduce the `src/sage/lfunctions/dokchitser.py` failure, even with 6.6.beta2. Can you confirm that the problem still exists?",
    "created_at": "2015-03-01T20:44:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221658",
    "user": "jdemeyer"
}
```

I cannot reproduce the `src/sage/lfunctions/dokchitser.py` failure, even with 6.6.beta2. Can you confirm that the problem still exists?



---

archive/issue_comments_221659.json:
```json
{
    "body": "Yep, still happens (this time on UW redhawk)",
    "created_at": "2015-03-02T08:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221659",
    "user": "vbraun"
}
```

Yep, still happens (this time on UW redhawk)



---

archive/issue_comments_221660.json:
```json
{
    "body": "What kind of machine is redhawk?",
    "created_at": "2015-03-02T09:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221660",
    "user": "fbissey"
}
```

What kind of machine is redhawk?



---

archive/issue_comments_221661.json:
```json
{
    "body": "I guess we could easily solve this with some `# tol` but I'm very curious to know *why* this is happening. It would be the first time that the result of PARI was different on different 64-bit systems (it is well known that PARI often has different results for 32-bit vs. 64-bit, but all 32-bit and all 64-bit systems should be the same).",
    "created_at": "2015-03-02T09:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221661",
    "user": "jdemeyer"
}
```

I guess we could easily solve this with some `# tol` but I'm very curious to know *why* this is happening. It would be the first time that the result of PARI was different on different 64-bit systems (it is well known that PARI often has different results for 32-bit vs. 64-bit, but all 32-bit and all 64-bit systems should be the same).



---

archive/issue_comments_221662.json:
```json
{
    "body": "> but all 32-bit and all 64-bit systems should be the same).\n\nI would not bet on this. It suffices that some processor provides a fused multiply-add and\nthat Pari uses it to get different results.\n\nPaul",
    "created_at": "2015-03-02T09:18:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221662",
    "user": "zimmerma"
}
```

> but all 32-bit and all 64-bit systems should be the same).

I would not bet on this. It suffices that some processor provides a fused multiply-add and
that Pari uses it to get different results.

Paul



---

archive/issue_comments_221663.json:
```json
{
    "body": "Replying to [comment:92 zimmerma]:\n> > but all 32-bit and all 64-bit systems should be the same).\n> \n> I would not bet on this. It suffices that some processor provides a fused multiply-add and\n> that Pari uses it to get different results.\n\nAs far as I know, PARI doesn't use native floating-point operations. They use custom arbitrary-precision arithmetic which shouldn't depend on the system.\n\nThe reason there is a difference between 32-bit and 64-bit is because their precision is measured in words: some computation which would use 96 bits on a 32-bit system would use 128 bits on a 64-bit system.",
    "created_at": "2015-03-02T09:23:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221663",
    "user": "jdemeyer"
}
```

Replying to [comment:92 zimmerma]:
> > but all 32-bit and all 64-bit systems should be the same).
> 
> I would not bet on this. It suffices that some processor provides a fused multiply-add and
> that Pari uses it to get different results.

As far as I know, PARI doesn't use native floating-point operations. They use custom arbitrary-precision arithmetic which shouldn't depend on the system.

The reason there is a difference between 32-bit and 64-bit is because their precision is measured in words: some computation which would use 96 bits on a 32-bit system would use 128 bits on a 64-bit system.



---

archive/issue_comments_221664.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-02T14:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221664",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_221665.json:
```json
{
    "body": "I confirm that PARI indeed gives a different result on redhawk. Upgrading Dokchitser's GP scripts seems to fix the issue, so that is what I will do.",
    "created_at": "2015-03-02T14:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221665",
    "user": "jdemeyer"
}
```

I confirm that PARI indeed gives a different result on redhawk. Upgrading Dokchitser's GP scripts seems to fix the issue, so that is what I will do.



---

archive/issue_comments_221666.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-02T14:40:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221666",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_221667.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-03-02T14:53:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221667",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_221668.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-02T14:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221668",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_221669.json:
```json
{
    "body": "Note: the file `computel.gp` is exactly Dokchitser's `computel` with 2 minor changes: DOS newlines converted to Unix and trailing whitespace removed.",
    "created_at": "2015-03-02T14:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221669",
    "user": "jdemeyer"
}
```

Note: the file `computel.gp` is exactly Dokchitser's `computel` with 2 minor changes: DOS newlines converted to Unix and trailing whitespace removed.



---

archive/issue_comments_221670.json:
```json
{
    "body": "I am happy to put it back to positive review.",
    "created_at": "2015-03-02T21:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221670",
    "user": "fbissey"
}
```

I am happy to put it back to positive review.



---

archive/issue_comments_221671.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-02T21:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221671",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_221672.json:
```json
{
    "body": "Thanks, let's hope it can be merged this time.",
    "created_at": "2015-03-02T22:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221672",
    "user": "jdemeyer"
}
```

Thanks, let's hope it can be merged this time.



---

archive/issue_comments_221673.json:
```json
{
    "body": "I now get this on linux 32-bit:\n\n```\nsage -t --long src/doc/en/reference/coercion/index.rst\n**********************************************************************\nFile \"src/doc/en/reference/coercion/index.rst\", line 65, in doc.en.reference.coercion.index\nFailed example:\n    f = EllipticCurve('37a').lseries().taylor_series(10); f\nExpected:\n    0.997997869801216 + 0.00140712894524925*z - 0.000498127610960097*z^2 + 0.000118835596665956*z^3 - 0.0000215906522442707*z^4 + (3.20363155418419e-6)*z^5 + O(z^6)\nGot:\n    0.990010459847588 + 0.0191338632530789*z - 0.0197489006172923*z^2 + 0.0137240085327618*z^3 - 0.00703880791607153*z^4 + 0.00280906165766519*z^5 + O(z^6)\n**********************************************************************\n1 item had failures:\n   1 of  99 in doc.en.reference.coercion.index\n    [84 tests, 1 failure, 0.98 s]\n```\n",
    "created_at": "2015-03-03T13:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221673",
    "user": "vbraun"
}
```

I now get this on linux 32-bit:

```
sage -t --long src/doc/en/reference/coercion/index.rst
**********************************************************************
File "src/doc/en/reference/coercion/index.rst", line 65, in doc.en.reference.coercion.index
Failed example:
    f = EllipticCurve('37a').lseries().taylor_series(10); f
Expected:
    0.997997869801216 + 0.00140712894524925*z - 0.000498127610960097*z^2 + 0.000118835596665956*z^3 - 0.0000215906522442707*z^4 + (3.20363155418419e-6)*z^5 + O(z^6)
Got:
    0.990010459847588 + 0.0191338632530789*z - 0.0197489006172923*z^2 + 0.0137240085327618*z^3 - 0.00703880791607153*z^4 + 0.00280906165766519*z^5 + O(z^6)
**********************************************************************
1 item had failures:
   1 of  99 in doc.en.reference.coercion.index
    [84 tests, 1 failure, 0.98 s]
```




---

archive/issue_comments_221674.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-03-03T13:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221674",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_221675.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-03T15:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221675",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_221676.json:
```json
{
    "body": "Fixed and tested on arando (32-bit).",
    "created_at": "2015-03-03T15:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221676",
    "user": "jdemeyer"
}
```

Fixed and tested on arando (32-bit).



---

archive/issue_comments_221677.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-03-03T15:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221677",
    "user": "jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_221678.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-03-03T20:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221678",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_221679.json:
```json
{
    "body": "Doctests should help tracking bugs, not hide them (last commit). Last digit noise is ok but 0.990010459847588  should not be considered as a correct 32-bits approximation of 0.997997869801216, this is too much noise and there should be a bug somewhere. Since the ticket is closed, there is a followup at #17903.",
    "created_at": "2015-03-05T17:07:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16760",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16760#issuecomment-221679",
    "user": "tmonteil"
}
```

Doctests should help tracking bugs, not hide them (last commit). Last digit noise is ok but 0.990010459847588  should not be considered as a correct 32-bits approximation of 0.997997869801216, this is too much noise and there should be a bug somewhere. Since the ticket is closed, there is a followup at #17903.
