# Issue 29887: spkg-configure for "jupyter"

Issue created by migration from https://trac.sagemath.org/ticket/30124

Original creator: mkoeppe

Original creation time: 2020-07-12 18:53:56

CC:  dimpase nbruin slelievre paulmasson fbissey charpent jhpalmieri @thierry-freebsd @sheerluck nthiery

From dimpase https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/4eKjmINXAQAJ:

switch to external jupyter - there is  no reason for
Sage to supply anything but the jupyter kernel...


---

Comment by mkoeppe created at 2020-08-04 03:23:28

This code from `src/sage/repl/ipython_kernel/install.py` of course needs updating so that we can install the kernel outside of the Sage venv:

```
        if prefix is None:
            from sys import prefix
        jupyter_dir = os.path.join(prefix, "share", "jupyter")
        self.nbextensions_dir = os.path.join(jupyter_dir, "nbextensions")
        self.kernel_dir = os.path.join(jupyter_dir, "kernels", self.identifier())
        self._mkdirs()
```



---

Comment by fbissey created at 2020-08-05 21:06:03

That implies that we will have to ask a `jupyter` that is in the `PATH` to tell us about its installation `PATH`. 

If we just call `jupyter kernelspec install` then it will install in a user location for a system wide jupyter (`~/.local/share/jupyter/kernels` on linux), for a sage jupyter it will probably go to the sage install (`{sys.prefix}/share/jupyter/kernels` on linux/OS X). But for distro it will become problematic straight away since you install in a stage before merging in the system tree. It is possible to pass a `--prefix` but this is not the same as `DESTDIR` which would be the useful thing for distros.


---

Comment by mkoeppe created at 2020-08-05 23:06:35

I think we will only need the following changes to `sagelib`:
 - remove the call to `sage.repl.ipython_kernel.install` from the installation steps done by sagelib's `setup.py` -- it is not compatible with modern python packaging methods anyway
 - add a `console_script` that installs a kernel spec (using `sage.repl.ipython_kernel.install`), call it `sage-kernel` (interface similar to: https://ipython.readthedocs.io/en/stable/install/kernel_install.html)
 - Change `sage-notebook` (which implements `sage -n`) to a shell script that invokes the correct jupyter (from system if installed in system, from SAGE_LOCAL if installed there)

Calling `sage-kernel` would be done by sage-the-distribution (perhaps in `build/pkgs/sagelib/spkg-install`), and likewise by distribution packagers' scripts.


---

Comment by mkoeppe created at 2020-08-06 01:03:30

Replying to [comment:7 mkoeppe]:
> I think we will only need the following changes to `sagelib`: ... Calling `sage-kernel` would be done by sage-the-distribution (perhaps in `build/pkgs/sagelib/spkg-install`)

I'll do the first two items in #30298


---

Comment by mkoeppe created at 2020-08-06 02:31:00

I have changed the plan a bit, see #30298 and #30299.


---

Comment by mkoeppe created at 2020-08-07 21:18:03

New commits:


---

Comment by mkoeppe created at 2020-11-12 18:11:05

If we attempt to automatically install the Sage jupyter kernel into the system jupyter, for example using `jupyter kernelspec install --user` as explained in #30476, we should think about how to disambiguate the kernels when working with multiple Sage installations.


---

Comment by mkoeppe created at 2020-12-06 18:17:38

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111


---

Comment by mkoeppe created at 2020-12-06 18:17:38

Changing keywords from "" to "sd111".


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.
