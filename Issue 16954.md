# Issue 16954: Poset: change rank dict to rank array

archive/issues_016954.json:
```json
{
    "body": "On `hasse_diagram.py` there is now `_rank_dict` whose keys are just numbers `0,...,n`. It can be converted to array, and it will be slightly faster then.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17191\n\n",
    "created_at": "2014-10-21T20:57:30Z",
    "labels": [
        "combinatorics",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Poset: change rank dict to rank array",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16954",
    "user": "jmantysalo"
}
```
On `hasse_diagram.py` there is now `_rank_dict` whose keys are just numbers `0,...,n`. It can be converted to array, and it will be slightly faster then.


Issue created by migration from https://trac.sagemath.org/ticket/17191





---

archive/issue_comments_224697.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-11-03T21:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16954#issuecomment-224697",
    "user": "ncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_224698.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-03T21:45:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16954#issuecomment-224698",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_224699.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-11-04T09:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16954#issuecomment-224699",
    "user": "jmantysalo"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_224700.json:
```json
{
    "body": "About\n\n\n```\nreturn lambda x:self._rank[x] # the rank function is just the getitem of the dict\n```\n\n\nThe comment string should be changed, \"dict\" -> \"list\". Also why bother with lambda function, because lists also has a `__getitem__`?\n\nLine\n\n\n```\nreturn [rank_fcn[i] for i in range(self.order())]\n```\n\n\nseems strange --- isn't that just same as `return rank_fcn` or `return copy(rank_fcn)`? Or maybe I didn't understand this.",
    "created_at": "2014-11-04T09:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16954#issuecomment-224700",
    "user": "jmantysalo"
}
```

About


```
return lambda x:self._rank[x] # the rank function is just the getitem of the dict
```


The comment string should be changed, "dict" -> "list". Also why bother with lambda function, because lists also has a `__getitem__`?

Line


```
return [rank_fcn[i] for i in range(self.order())]
```


seems strange --- isn't that just same as `return rank_fcn` or `return copy(rank_fcn)`? Or maybe I didn't understand this.



---

archive/issue_comments_224701.json:
```json
{
    "body": "Yooo !\n\n> {{{\n> return lambda x:self._rank[x] # the rank function is just the getitem of the dict\n> }}}\n> \n> The comment string should be changed, \"dict\" -> \"list\". Also why bother with lambda function, because lists also has a `__getitem__`?\n\nYou are right.\n\n> {{{\n> return [rank_fcn[i] for i in range(self.order())]\n> }}}\n> \n> seems strange --- isn't that just same as `return rank_fcn` or `return copy(rank_fcn)`? Or maybe I didn't understand this. \n\nBecause `rank_fcn` is a dictionary, not a list, and because it should be a dictionary in this function (because of lines like 'if x in rank_fcn').\n\nNathann",
    "created_at": "2014-11-04T09:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16954#issuecomment-224701",
    "user": "ncohen"
}
```

Yooo !

> {{{
> return lambda x:self._rank[x] # the rank function is just the getitem of the dict
> }}}
> 
> The comment string should be changed, "dict" -> "list". Also why bother with lambda function, because lists also has a `__getitem__`?

You are right.

> {{{
> return [rank_fcn[i] for i in range(self.order())]
> }}}
> 
> seems strange --- isn't that just same as `return rank_fcn` or `return copy(rank_fcn)`? Or maybe I didn't understand this. 

Because `rank_fcn` is a dictionary, not a list, and because it should be a dictionary in this function (because of lines like 'if x in rank_fcn').

Nathann



---

archive/issue_comments_224702.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-11-04T09:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16954#issuecomment-224702",
    "user": "ncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_224703.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-04T09:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16954#issuecomment-224703",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_224704.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-04T09:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16954#issuecomment-224704",
    "user": "jmantysalo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_224705.json:
```json
{
    "body": "Replying to [comment:4 ncohen]:\n\n> > {{{\n> > return [rank_fcn[i] for i in range(self.order())]\n> > }}}\n> > \n> > seems strange --- isn't that just same as `return rank_fcn` or `return copy(rank_fcn)`? Or maybe I didn't understand this. \n> \n> Because `rank_fcn` is a dictionary, not a list, and because it should be a dictionary in this function (because of lines like 'if x in rank_fcn').\n\nAh, true. This could also start with `rank_fcn=[None]*self.order()` instead of `rank_fcn={}`, but the current code seems to be cleaner.\n\nI think this is ready for production, so I also changed milestone with status.",
    "created_at": "2014-11-04T09:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16954#issuecomment-224705",
    "user": "jmantysalo"
}
```

Replying to [comment:4 ncohen]:

> > {{{
> > return [rank_fcn[i] for i in range(self.order())]
> > }}}
> > 
> > seems strange --- isn't that just same as `return rank_fcn` or `return copy(rank_fcn)`? Or maybe I didn't understand this. 
> 
> Because `rank_fcn` is a dictionary, not a list, and because it should be a dictionary in this function (because of lines like 'if x in rank_fcn').

Ah, true. This could also start with `rank_fcn=[None]*self.order()` instead of `rank_fcn={}`, but the current code seems to be cleaner.

I think this is ready for production, so I also changed milestone with status.



---

archive/issue_comments_224706.json:
```json
{
    "body": "Yo !\n\n> Ah, true. This could also start with `rank_fcn=[None]*self.order()` instead of `rank_fcn={}`, but the current code seems to be cleaner.\n\nRight again. And I could have turned the 'if x in rank_fcn' into 'if rank_fcn[x] is Null'... Stupid me.\n\n> I think this is ready for production, so I also changed milestone with status.\n\nI hope that you do not mind: I am going to add a commit in a second to do that properly with a list in the function too. Not very important, but worth doing anyway.\n\nNathann",
    "created_at": "2014-11-04T09:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16954#issuecomment-224706",
    "user": "ncohen"
}
```

Yo !

> Ah, true. This could also start with `rank_fcn=[None]*self.order()` instead of `rank_fcn={}`, but the current code seems to be cleaner.

Right again. And I could have turned the 'if x in rank_fcn' into 'if rank_fcn[x] is Null'... Stupid me.

> I think this is ready for production, so I also changed milestone with status.

I hope that you do not mind: I am going to add a commit in a second to do that properly with a list in the function too. Not very important, but worth doing anyway.

Nathann



---

archive/issue_comments_224707.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-11-04T10:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16954#issuecomment-224707",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_224708.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2014-11-04T10:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16954#issuecomment-224708",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_224709.json:
```json
{
    "body": "Works.",
    "created_at": "2014-11-04T10:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16954#issuecomment-224709",
    "user": "jmantysalo"
}
```

Works.



---

archive/issue_comments_224710.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-04T10:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16954#issuecomment-224710",
    "user": "jmantysalo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_224711.json:
```json
{
    "body": "Thanks !\n\nNathann",
    "created_at": "2014-11-04T10:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16954#issuecomment-224711",
    "user": "ncohen"
}
```

Thanks !

Nathann



---

archive/issue_comments_224712.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-11-15T16:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16954",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16954#issuecomment-224712",
    "user": "vbraun"
}
```

Resolution: fixed
