# Issue 16954: Poset: change rank dict to rank array

Issue created by migration from https://trac.sagemath.org/ticket/17191

Original creator: jmantysalo

Original creation time: 2014-10-21 20:57:30

On `hasse_diagram.py` there is now `_rank_dict` whose keys are just numbers `0,...,n`. It can be converted to array, and it will be slightly faster then.



---

Comment by ncohen created at 2014-11-03 21:45:28

Changing status from new to needs_review.


---

Comment by git created at 2014-11-03 21:45:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2014-11-04 09:24:40

Changing status from needs_review to needs_work.


---

Comment by jmantysalo created at 2014-11-04 09:24:40

About


```
return lambda x:self._rank[x] # the rank function is just the getitem of the dict
```


The comment string should be changed, "dict" -> "list". Also why bother with lambda function, because lists also has a `__getitem__`?

Line


```
return [rank_fcn[i] for i in range(self.order())]
```


seems strange --- isn't that just same as `return rank_fcn` or `return copy(rank_fcn)`? Or maybe I didn't understand this.


---

Comment by ncohen created at 2014-11-04 09:33:58

Yooo !

> {{{
> return lambda x:self._rank[x] # the rank function is just the getitem of the dict
> }}}
> 
> The comment string should be changed, "dict" -> "list". Also why bother with lambda function, because lists also has a `__getitem__`?

You are right.

> {{{
> return [rank_fcn[i] for i in range(self.order())]
> }}}
> 
> seems strange --- isn't that just same as `return rank_fcn` or `return copy(rank_fcn)`? Or maybe I didn't understand this. 

Because `rank_fcn` is a dictionary, not a list, and because it should be a dictionary in this function (because of lines like 'if x in rank_fcn').

Nathann


---

Comment by ncohen created at 2014-11-04 09:34:16

Changing status from needs_work to needs_review.


---

Comment by git created at 2014-11-04 09:34:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2014-11-04 09:53:20

Changing status from needs_review to positive_review.


---

Comment by jmantysalo created at 2014-11-04 09:53:20

Replying to [comment:4 ncohen]:

> > {{{
> > return [rank_fcn[i] for i in range(self.order())]
> > }}}
> > 
> > seems strange --- isn't that just same as `return rank_fcn` or `return copy(rank_fcn)`? Or maybe I didn't understand this. 
> 
> Because `rank_fcn` is a dictionary, not a list, and because it should be a dictionary in this function (because of lines like 'if x in rank_fcn').

Ah, true. This could also start with `rank_fcn=[None]*self.order()` instead of `rank_fcn={}`, but the current code seems to be cleaner.

I think this is ready for production, so I also changed milestone with status.


---

Comment by ncohen created at 2014-11-04 09:56:12

Yo !

> Ah, true. This could also start with `rank_fcn=[None]*self.order()` instead of `rank_fcn={}`, but the current code seems to be cleaner.

Right again. And I could have turned the 'if x in rank_fcn' into 'if rank_fcn[x] is Null'... Stupid me.

> I think this is ready for production, so I also changed milestone with status.

I hope that you do not mind: I am going to add a commit in a second to do that properly with a list in the function too. Not very important, but worth doing anyway.

Nathann


---

Comment by git created at 2014-11-04 10:01:54

Changing status from positive_review to needs_review.


---

Comment by git created at 2014-11-04 10:01:54

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by jmantysalo created at 2014-11-04 10:42:38

Works.


---

Comment by jmantysalo created at 2014-11-04 10:42:38

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2014-11-04 10:46:05

Thanks !

Nathann


---

Comment by vbraun created at 2014-11-15 16:18:33

Resolution: fixed
