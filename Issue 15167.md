# Issue 15167: Change coprime_integers(n) in Integer class to use sieving instead of naive gcd

archive/issues_015167.json:
```json
{
    "body": "Assignee: Simon Spicer\n\nCC:  was\n\nKeywords: coprime, integer\n\nAs written currently, the coprime_integers(n) method in the Integer class uses gcd naively:\n\n```\n    def coprime_integers(self, m):\n        ...\n        v = []\n        for n in range(1,m):\n            if self.gcd(n) == 1:\n                v.append(Integer(n))\n        return v\n```\n\n\nThis method should be rewritten to use sieving to speed things up.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15404\n\n",
    "created_at": "2013-11-12T17:00:23Z",
    "labels": [
        "basic arithmetic",
        "minor",
        "enhancement"
    ],
    "title": "Change coprime_integers(n) in Integer class to use sieving instead of naive gcd",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15167",
    "user": "spice"
}
```
Assignee: Simon Spicer

CC:  was

Keywords: coprime, integer

As written currently, the coprime_integers(n) method in the Integer class uses gcd naively:

```
    def coprime_integers(self, m):
        ...
        v = []
        for n in range(1,m):
            if self.gcd(n) == 1:
                v.append(Integer(n))
        return v
```


This method should be rewritten to use sieving to speed things up.

Issue created by migration from https://trac.sagemath.org/ticket/15404





---

archive/issue_comments_194753.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-11-12T17:23:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194753",
    "user": "spice"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_194754.json:
```json
{
    "body": "It can't work because this makes no sense:\n\n```\nfor p in self.prime_divisors: \n```\n",
    "created_at": "2013-11-12T18:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194754",
    "user": "was"
}
```

It can't work because this makes no sense:

```
for p in self.prime_divisors: 
```




---

archive/issue_comments_194755.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-11-12T18:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194755",
    "user": "was"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_194756.json:
```json
{
    "body": "Attachment [trac_15404.patch](tarball://root/attachments/some-uuid/ticket15404/trac_15404.patch) by spice created at 2013-11-12 19:14:41\n\nIncluded missing parentheses. Doctests now properly pass.",
    "created_at": "2013-11-12T19:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194756",
    "user": "spice"
}
```

Attachment [trac_15404.patch](tarball://root/attachments/some-uuid/ticket15404/trac_15404.patch) by spice created at 2013-11-12 19:14:41

Included missing parentheses. Doctests now properly pass.



---

archive/issue_comments_194757.json:
```json
{
    "body": "Parentheses have been added.",
    "created_at": "2013-11-12T19:15:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194757",
    "user": "spice"
}
```

Parentheses have been added.



---

archive/issue_comments_194758.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-11-12T19:15:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194758",
    "user": "spice"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_194759.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-11-12T20:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194759",
    "user": "was"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_194760.json:
```json
{
    "body": "Hey, it's not 2011 anymore, as much as I like that number\n\n```\n    - Simon Spicer (2011-11-12): Rewritten to use sieving methods  \n```\n",
    "created_at": "2013-11-12T20:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194760",
    "user": "was"
}
```

Hey, it's not 2011 anymore, as much as I like that number

```
    - Simon Spicer (2011-11-12): Rewritten to use sieving methods  
```




---

archive/issue_comments_194761.json:
```json
{
    "body": "Attachment [trac_15404.2.patch](tarball://root/attachments/some-uuid/ticket15404/trac_15404.2.patch) by spice created at 2013-11-13 16:56:12\n\nFixes date typo, now uses naive method for small inputs.",
    "created_at": "2013-11-13T16:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194761",
    "user": "spice"
}
```

Attachment [trac_15404.2.patch](tarball://root/attachments/some-uuid/ticket15404/trac_15404.2.patch) by spice created at 2013-11-13 16:56:12

Fixes date typo, now uses naive method for small inputs.



---

archive/issue_comments_194762.json:
```json
{
    "body": "New patch replaces previous patch. The method now uses naive gcd if both self and m are < 1000, since this seems to be faster.\n\nSome timings. Old code:\n\n```\nsage: %timeit 100.coprime_integers(100)\n10000 loops, best of 3: 44.5 us per loop\nsage: %timeit 101.coprime_integers(101)\n10000 loops, best of 3: 52.6 us per loop\nsage: %timeit 1000.coprime_integers(1000)\n1000 loops, best of 3: 529 us per loop\nsage: %timeit (10^6+12).coprime_integers(10^6+12)\n1 loops, best of 3: 603 ms per loop\nsage: %timeit (next_prime(10^6)).coprime_integers(10^6)\n1 loops, best of 3: 795 ms per loop\nsage: %timeit (10^8+512).coprime_integers(10^5)\n10 loops, best of 3: 55.9 ms per loop\nsage: %timeit (10^8+512).coprime_integers(10^7)\n1 loops, best of 3: 5.61 s per loop\n```\n\n\nNew code (without naive method for small inputs):\n\n\n```\nsage: %timeit 100.coprime_integers(100)\n10000 loops, best of 3: 145 us per loop\nsage: %timeit 101.coprime_integers(101)\n10000 loops, best of 3: 139 us per loop\nsage: %timeit 1000.coprime_integers(1000)\n1000 loops, best of 3: 510 us per loop\nsage: %timeit (10^6+12).coprime_integers(10^6+12)\n1 loops, best of 3: 373 ms per loop\nsage: %timeit (next_prime(10^6)).coprime_integers(10^6)\n1 loops, best of 3: 383 ms per loop\nsage: %timeit (10^8+512).coprime_integers(10^5)\n10 loops, best of 3: 39.8 ms per loop\nsage: %timeit (10^8+512).coprime_integers(10^7)\n1 loops, best of 3: 3.98 s per loop\n#MemoryError for m=10^8\n```\n\n\nThe new code should be faster when self has few prime factors, but both old and new code scale with m, the bound to which integers coprime to self are returned, since we need to fit that many sage integers in memory.",
    "created_at": "2013-11-13T17:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194762",
    "user": "spice"
}
```

New patch replaces previous patch. The method now uses naive gcd if both self and m are < 1000, since this seems to be faster.

Some timings. Old code:

```
sage: %timeit 100.coprime_integers(100)
10000 loops, best of 3: 44.5 us per loop
sage: %timeit 101.coprime_integers(101)
10000 loops, best of 3: 52.6 us per loop
sage: %timeit 1000.coprime_integers(1000)
1000 loops, best of 3: 529 us per loop
sage: %timeit (10^6+12).coprime_integers(10^6+12)
1 loops, best of 3: 603 ms per loop
sage: %timeit (next_prime(10^6)).coprime_integers(10^6)
1 loops, best of 3: 795 ms per loop
sage: %timeit (10^8+512).coprime_integers(10^5)
10 loops, best of 3: 55.9 ms per loop
sage: %timeit (10^8+512).coprime_integers(10^7)
1 loops, best of 3: 5.61 s per loop
```


New code (without naive method for small inputs):


```
sage: %timeit 100.coprime_integers(100)
10000 loops, best of 3: 145 us per loop
sage: %timeit 101.coprime_integers(101)
10000 loops, best of 3: 139 us per loop
sage: %timeit 1000.coprime_integers(1000)
1000 loops, best of 3: 510 us per loop
sage: %timeit (10^6+12).coprime_integers(10^6+12)
1 loops, best of 3: 373 ms per loop
sage: %timeit (next_prime(10^6)).coprime_integers(10^6)
1 loops, best of 3: 383 ms per loop
sage: %timeit (10^8+512).coprime_integers(10^5)
10 loops, best of 3: 39.8 ms per loop
sage: %timeit (10^8+512).coprime_integers(10^7)
1 loops, best of 3: 3.98 s per loop
#MemoryError for m=10^8
```


The new code should be faster when self has few prime factors, but both old and new code scale with m, the bound to which integers coprime to self are returned, since we need to fit that many sage integers in memory.



---

archive/issue_comments_194763.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-09-14T17:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194763",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_194764.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-14T17:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194764",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_194765.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-09-14T18:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194765",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_194766.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-14T18:28:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194766",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194767.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-14T18:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194767",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_194768.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-25T20:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194768",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194769.json:
```json
{
    "body": "I've written a new implementation that fixes some problems with the old and speeds it up:\n\n* It now handles the case that `self = 0` or negative and that `m` is too large or negative gracefully\n* It uses `trial_division()` rather than `prime_divisors()`, which will be faster and deals with the case that `self` has prime factors larger than `m` better.\n* It uses bit fiddling rather than a list of booleans.",
    "created_at": "2017-09-25T20:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194769",
    "user": "roed"
}
```

I've written a new implementation that fixes some problems with the old and speeds it up:

* It now handles the case that `self = 0` or negative and that `m` is too large or negative gracefully
* It uses `trial_division()` rather than `prime_divisors()`, which will be faster and deals with the case that `self` has prime factors larger than `m` better.
* It uses bit fiddling rather than a list of booleans.



---

archive/issue_comments_194770.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-26T01:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194770",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194771.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-02T18:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194771",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_194772.json:
```json
{
    "body": "ok",
    "created_at": "2017-10-02T18:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194772",
    "user": "chapoton"
}
```

ok



---

archive/issue_comments_194773.json:
```json
{
    "body": "Just my 2 cents: `mpz_divexact_ui` is expected to be faster than `mpz_fdiv_q`, and `mpz_sgn` instead of comparing to zero.\nAlso as you have `plong` available (why not unsigned?), it's probably better to use `mpz_cmp_si` and `mpz_divisible_ui_p`.\n\nAll this is nitpicking though.",
    "created_at": "2017-10-02T20:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194773",
    "user": "ylchapuy"
}
```

Just my 2 cents: `mpz_divexact_ui` is expected to be faster than `mpz_fdiv_q`, and `mpz_sgn` instead of comparing to zero.
Also as you have `plong` available (why not unsigned?), it's probably better to use `mpz_cmp_si` and `mpz_divisible_ui_p`.

All this is nitpicking though.



---

archive/issue_comments_194774.json:
```json
{
    "body": "Replying to [comment:18 ylchapuy]:\n>  and `mpz_sgn` instead of comparing to zero.\n\nOups, forget this was, I misread :)",
    "created_at": "2017-10-02T20:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194774",
    "user": "ylchapuy"
}
```

Replying to [comment:18 ylchapuy]:
>  and `mpz_sgn` instead of comparing to zero.

Oups, forget this was, I misread :)



---

archive/issue_comments_194775.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2017-10-02T20:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194775",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_194776.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-10-02T20:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194776",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_194777.json:
```json
{
    "body": "Thanks.  I've adjusted `plong` and `ilong` to unsigned longs, adjusted the functions and described the algorithm correctly.",
    "created_at": "2017-10-02T20:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194777",
    "user": "roed"
}
```

Thanks.  I've adjusted `plong` and `ilong` to unsigned longs, adjusted the functions and described the algorithm correctly.



---

archive/issue_comments_194778.json:
```json
{
    "body": "Am I missing something (it's late here) or is this never happening: `mpz_tstbit(sieve.value, plong)` ?\nIf `p == m` it can't be composite because it's smallest factor would have been removed before.",
    "created_at": "2017-10-02T22:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194778",
    "user": "ylchapuy"
}
```

Am I missing something (it's late here) or is this never happening: `mpz_tstbit(sieve.value, plong)` ?
If `p == m` it can't be composite because it's smallest factor would have been removed before.



---

archive/issue_comments_194779.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-04T16:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194779",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194780.json:
```json
{
    "body": "Thanks.  I removed that and another test, which were left over from before I added the last break statement.",
    "created_at": "2017-10-04T16:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194780",
    "user": "roed"
}
```

Thanks.  I removed that and another test, which were left over from before I added the last break statement.



---

archive/issue_comments_194781.json:
```json
{
    "body": "Just curious: what's the rationale for the added argument  `algorithm = None`? Are you planning to add another implementation?\n\nOtherwise LGTM.",
    "created_at": "2017-10-06T08:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194781",
    "user": "ylchapuy"
}
```

Just curious: what's the rationale for the added argument  `algorithm = None`? Are you planning to add another implementation?

Otherwise LGTM.



---

archive/issue_comments_194782.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-06T08:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194782",
    "user": "ylchapuy"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_194783.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2017-10-06T09:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194783",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_194784.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-10-06T09:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194784",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_194785.json:
```json
{
    "body": "Replying to [comment:25 ylchapuy]:\n> Just curious: what's the rationale for the added argument  `algorithm = None`? Are you planning to add another implementation?\n\nThat was left over from when I was still experimenting with other implementations.\n\n> Otherwise LGTM.\n\nI've deleted it and set the ticket back to positive review.  Thanks!",
    "created_at": "2017-10-06T09:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194785",
    "user": "roed"
}
```

Replying to [comment:25 ylchapuy]:
> Just curious: what's the rationale for the added argument  `algorithm = None`? Are you planning to add another implementation?

That was left over from when I was still experimenting with other implementations.

> Otherwise LGTM.

I've deleted it and set the ticket back to positive review.  Thanks!



---

archive/issue_comments_194786.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-06T09:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194786",
    "user": "roed"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_194787.json:
```json
{
    "body": "Hum, gives me time out in `sage/groups/additive_abelian/qmodnz.py` the backtrace points to stuff here\n\n```\nStack backtrace\n---------------\nNo symbol table info available.\n#1  0x00007f83b5e85b53 in print_enhanced_backtrace () from /usr/lib64/python2.7/site-packages/cysignals/signals.so\nNo symbol table info available.\n#2  0x00007f83b5e85c4a in sigdie () from /usr/lib64/python2.7/site-packages/cysignals/signals.so\nNo symbol table info available.\n#3  0x00007f83b5e88247 in cysigs_signal_handler () from /usr/lib64/python2.7/site-packages/cysignals/signals.so\nNo symbol table info available.\n#4  <signal handler called>\nNo symbol table info available.\n#5  0x00007f83b52f0b6a in __gmpz_divexact_ui () from /usr/lib64/libgmp.so.10\nNo symbol table info available.\n#6  0x00007f83aa3ef26e in __pyx_pw_4sage_5rings_7integer_7Integer_131coprime_integers () from /usr/lib64/python2.7/site-packages/sage/rings/integer.so\nNo symbol table info available.\n```\n",
    "created_at": "2017-10-08T07:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194787",
    "user": "fbissey"
}
```

Hum, gives me time out in `sage/groups/additive_abelian/qmodnz.py` the backtrace points to stuff here

```
Stack backtrace
---------------
No symbol table info available.
#1  0x00007f83b5e85b53 in print_enhanced_backtrace () from /usr/lib64/python2.7/site-packages/cysignals/signals.so
No symbol table info available.
#2  0x00007f83b5e85c4a in sigdie () from /usr/lib64/python2.7/site-packages/cysignals/signals.so
No symbol table info available.
#3  0x00007f83b5e88247 in cysigs_signal_handler () from /usr/lib64/python2.7/site-packages/cysignals/signals.so
No symbol table info available.
#4  <signal handler called>
No symbol table info available.
#5  0x00007f83b52f0b6a in __gmpz_divexact_ui () from /usr/lib64/libgmp.so.10
No symbol table info available.
#6  0x00007f83aa3ef26e in __pyx_pw_4sage_5rings_7integer_7Integer_131coprime_integers () from /usr/lib64/python2.7/site-packages/sage/rings/integer.so
No symbol table info available.
```




---

archive/issue_comments_194788.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-10-08T07:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194788",
    "user": "chapoton"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_194789.json:
```json
{
    "body": "Hum, \n\n```sage\np = slf.trial_division(mlong, mpz_get_si(p.value)+1)\nilong = plong = mpz_get_ui(p.value)\n```\n\nthis might be problematic if `p` is set to `slf` and doesn't fit in a long.\n\nIf moreover `plong` end up being `1`, the `while mpz_divisible_ui_p(slf.value, plong):` loop will be infinite.",
    "created_at": "2017-10-08T16:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194789",
    "user": "ylchapuy"
}
```

Hum, 

```sage
p = slf.trial_division(mlong, mpz_get_si(p.value)+1)
ilong = plong = mpz_get_ui(p.value)
```

this might be problematic if `p` is set to `slf` and doesn't fit in a long.

If moreover `plong` end up being `1`, the `while mpz_divisible_ui_p(slf.value, plong):` loop will be infinite.



---

archive/issue_comments_194790.json:
```json
{
    "body": "Replying to [comment:30 ylchapuy]:\n> Hum, \n> {{{#!sage\n> p = slf.trial_division(mlong, mpz_get_si(p.value)+1)\n> ilong = plong = mpz_get_ui(p.value)\n> }}}\n> this might be problematic if `p` is set to `slf` and doesn't fit in a long.\n\nThat can't happen since `trial_division` only goes up to the bound `mlong`.\n \n> If moreover `plong` end up being `1`, the `while mpz_divisible_ui_p(slf.value, plong):` loop will be infinite.\n\nThat can't happen since `trial_division` starts at `p+1`, which is at least 2.",
    "created_at": "2017-10-09T00:56:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194790",
    "user": "roed"
}
```

Replying to [comment:30 ylchapuy]:
> Hum, 
> {{{#!sage
> p = slf.trial_division(mlong, mpz_get_si(p.value)+1)
> ilong = plong = mpz_get_ui(p.value)
> }}}
> this might be problematic if `p` is set to `slf` and doesn't fit in a long.

That can't happen since `trial_division` only goes up to the bound `mlong`.
 
> If moreover `plong` end up being `1`, the `while mpz_divisible_ui_p(slf.value, plong):` loop will be infinite.

That can't happen since `trial_division` starts at `p+1`, which is at least 2.



---

archive/issue_comments_194791.json:
```json
{
    "body": "Replying to [comment:31 roed]:\n> Replying to [comment:30 ylchapuy]:\n> > Hum, \n> > {{{#!sage\n> > p = slf.trial_division(mlong, mpz_get_si(p.value)+1)\n> > ilong = plong = mpz_get_ui(p.value)\n> > }}}\n> > this might be problematic if `p` is set to `slf` and doesn't fit in a long.\n> \n> That can't happen since `trial_division` only goes up to the bound `mlong`.\n\nOh, I was wrong: in this case `p` will equal `slf`.  I'll fix it.",
    "created_at": "2017-10-09T00:59:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194791",
    "user": "roed"
}
```

Replying to [comment:31 roed]:
> Replying to [comment:30 ylchapuy]:
> > Hum, 
> > {{{#!sage
> > p = slf.trial_division(mlong, mpz_get_si(p.value)+1)
> > ilong = plong = mpz_get_ui(p.value)
> > }}}
> > this might be problematic if `p` is set to `slf` and doesn't fit in a long.
> 
> That can't happen since `trial_division` only goes up to the bound `mlong`.

Oh, I was wrong: in this case `p` will equal `slf`.  I'll fix it.



---

archive/issue_comments_194792.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-17T08:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194792",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194793.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-17T08:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194793",
    "user": "roed"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_194794.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-19T11:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194794",
    "user": "ylchapuy"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_194795.json:
```json
{
    "body": "Do not compile.\n\n`mpz_cmp_si(p, mlong)` should be `mpz_cmp_si(p.value, mlong)`",
    "created_at": "2017-10-19T11:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194795",
    "user": "ylchapuy"
}
```

Do not compile.

`mpz_cmp_si(p, mlong)` should be `mpz_cmp_si(p.value, mlong)`



---

archive/issue_comments_194796.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-19T14:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194796",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194797.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-19T14:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194797",
    "user": "roed"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_194798.json:
```json
{
    "body": "Oops.  Fixed.",
    "created_at": "2017-10-19T14:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194798",
    "user": "roed"
}
```

Oops.  Fixed.



---

archive/issue_comments_194799.json:
```json
{
    "body": "patchbot failures",
    "created_at": "2017-10-19T16:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194799",
    "user": "ylchapuy"
}
```

patchbot failures



---

archive/issue_comments_194800.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-19T16:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194800",
    "user": "ylchapuy"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_194801.json:
```json
{
    "body": "I think `self = 1` leads to an infinite loop.",
    "created_at": "2017-10-19T17:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194801",
    "user": "ylchapuy"
}
```

I think `self = 1` leads to an infinite loop.



---

archive/issue_comments_194802.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-19T19:26:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194802",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194803.json:
```json
{
    "body": "You're right. I've fixed that (plus a problem that would show up if `self` were negative) and added a test.",
    "created_at": "2017-10-19T19:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194803",
    "user": "roed"
}
```

You're right. I've fixed that (plus a problem that would show up if `self` were negative) and added a test.



---

archive/issue_comments_194804.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-19T19:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194804",
    "user": "roed"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_194805.json:
```json
{
    "body": "Tests pass....",
    "created_at": "2017-10-20T01:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194805",
    "user": "roed"
}
```

Tests pass....



---

archive/issue_comments_194806.json:
```json
{
    "body": "The tests are a useful addition I think :)\nLGTM, bots problems seems unrelated",
    "created_at": "2017-10-21T16:20:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194806",
    "user": "ylchapuy"
}
```

The tests are a useful addition I think :)
LGTM, bots problems seems unrelated



---

archive/issue_comments_194807.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-21T16:20:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194807",
    "user": "ylchapuy"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_194808.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-22T05:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15167#issuecomment-194808",
    "user": "vbraun"
}
```

Resolution: fixed
