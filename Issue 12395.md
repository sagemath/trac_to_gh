# Issue 12395: Implement p-adic n-th roots

Issue created by migration from Trac.

Original creator: dequan

Original creation time: 2012-02-22 23:43:10

Assignee: roed

CC:  roed saraedum dequan serickson reinier

Keywords: padics, n-th roots

We are implementing p-adic n-th roots as a p-adic Sage Days project


---

Comment by roed created at 2017-07-17 17:38:06

Changing keywords from "padics, n-th roots" to "padics, n-th roots, sd87".


---

Comment by roed created at 2018-07-22 20:16:17

Changing keywords from "padics, n-th roots, sd87" to "padics, n-th roots, sd87, padicIMA".


---

Comment by roed created at 2018-07-22 20:16:17

Changing priority from minor to major.


---

Comment by caruso created at 2018-07-28 00:11:20

Last 10 new commits:


---

Comment by caruso created at 2018-07-28 00:14:15

I just wrote a generic implementation of p-adic nth root, working over any p-adic extension (unramified, totally ramified or mixed).

Doctests are coming soon...


---

Comment by git created at 2018-07-28 00:16:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-28 02:50:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2018-07-28 02:51:20

Changing status from new to needs_review.


---

Comment by git created at 2018-07-28 09:16:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2018-07-30 07:09:19

For ease of review, I attach the diff between this ticket and #23218


---

Comment by roed created at 2018-07-31 19:58:13

Changing status from needs_review to positive_review.


---

Comment by roed created at 2018-07-31 19:58:13

I made some minor changes and tests still pass.  Positive review!
----
New commits:


---

Comment by caruso created at 2018-07-31 23:45:12

Perfect!
I've just changed a bit the doctests you added in order to have a test for the case where `p-1` divides `e` (for which the algorithm I've implemented has an extra step).


---

Comment by git created at 2018-07-31 23:46:58

Changing status from positive_review to needs_review.


---

Comment by git created at 2018-07-31 23:46:58

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by caruso created at 2018-07-31 23:49:00

Changing status from needs_review to positive_review.


---

Comment by roed created at 2018-07-31 23:49:50

Great!  I'll run the tests again.


---

Comment by caruso created at 2018-08-01 01:54:25

Changing status from positive_review to needs_work.


---

Comment by caruso created at 2018-08-01 01:54:25

Oops... there's a bug:


```
sage: K.<a> = Qq(2^3)
sage: S.<x> = K[]
sage: L.<pi> = K.extension(x^2 + 2*x + 2)
sage: elt = L.random_element()^8
sage: elt.nth_root(8)   # sometimes fails
Traceback (most recent call last):
...
ValueError: This element is not a nth power
```



---

Comment by roed created at 2018-08-02 16:37:22

Here's some more info.  It looks like some chains of repeated square roots work while others fail.

```
sage: K.<a> = Qq(2^3)
sage: S.<x> = K[]
sage: L.<pi> = K.extension(x^2 + 2*x + 2)
sage: ran = L.random_element(); elt = ran^8; r = elt.nth_root(8)
ValueError: This element is not a nth power
sage: ran
a*pi^-2 + a*pi^-1 + a + a^2*pi^5 + a^2*pi^6 + (a^2 + 1)*pi^7 + (a^2 + 1)*pi^8 + a^2*pi^9 + a^2*pi^10 + (a + 1)*pi^11 + (a^2 + a + 1)*pi^12 + pi^13 + (a^2 + a)*pi^14 + (a^2 + a + 1)*pi^15 + (a^2 + 1)*pi^16 + a^2*pi^17 + (a^2 + 1)*pi^20 + (a + 1)*pi^21 + (a + 1)*pi^22 + (a^2 + a + 1)*pi^23 + (a^2 + a + 1)*pi^24 + (a^2 + a + 1)*pi^25 + pi^26 + (a + 1)*pi^27 + (a^2 + a)*pi^28 + pi^30 + (a^2 + 1)*pi^31 + a*pi^32 + a^2*pi^33 + pi^34 + a^2*pi^35 + O(pi^36)
sage: r1 = elt.square_root()
sage: r2 = r1.square_root()
sage: r3 = r2.square_root()
NotImplementedError: extending using the sqrt function not yet implemented
sage: r1^2==elt
True
sage: r2^2==r1
True
sage: s1 = L(-1).square_root()
sage: ran^2 == s1*r2
True
sage: r1=-r1
sage: r2 = -r1.square_root()
sage: r3 = r2.square_root()
sage: ran == -r3
True
```



---

Comment by roed created at 2018-08-02 16:38:23

This makes sense actually, since this field has no 8th root of unity.


---

Comment by caruso created at 2018-08-02 17:59:16

Yes, that's it.
We need to check all (or at least more) branches. I'm working on this now and will submit a revised version soon.


---

Comment by git created at 2018-08-03 00:19:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2018-08-03 00:26:14

OK. The bug should be fixed now.

I'm not completely happy with the algorithm I've implemented since its complexity is possibly linear in p (i.e. exponential in log(p)). Something better should be feasible but I'll do it in another ticket (except if someone else does it now).

I attach a new diff with #23218


---

Comment by git created at 2018-08-03 00:28:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2018-08-03 00:32:08

Changing status from needs_work to needs_review.


---

Comment by git created at 2018-08-04 23:34:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2018-08-06 09:59:08

Changing status from needs_review to needs_work.


---

Comment by caruso created at 2018-08-06 09:59:08

I found other bugs. I'm still working on this ticket...


---

Comment by git created at 2018-08-06 22:06:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Attachment


---

Comment by caruso created at 2018-08-06 22:13:17

Finally, I've implemented a faster algorithm with better complexity with respect to `p`.

I've also added doctests demonstrating that the computation of the `n`th root works over various fields (including those having, or having almost, `p`th or `p^2`th roots of unity).

There are still failing doctests but they are due to the bug reported in #25990.


---

Comment by git created at 2018-08-17 22:13:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2018-08-17 22:13:47

Now, all tests pass: the ticket is ready for review.


---

Comment by caruso created at 2018-08-17 22:13:47

Changing status from needs_work to needs_review.


---

Comment by git created at 2018-08-18 06:10:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by alexjbest created at 2018-08-21 01:48:42

Doc doesn't build (see patchbot).

Additionally EXAMPLES blocks in doc should end in ::  not : I believe if the first thing after is code, (see primitive_root_of_unity and elsewhere).


---

Comment by git created at 2018-08-21 05:32:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-22 22:09:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-22 22:14:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2018-09-27 21:16:15

Looks good; just ran `make ptestlong`.
----
New commits:


---

Comment by roed created at 2018-09-27 21:16:15

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-09-29 11:59:43

Resolution: fixed
