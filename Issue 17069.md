# Issue 17069: Let mathjax spkg work with sagenb

Issue created by migration from https://trac.sagemath.org/ticket/17306

Original creator: tmonteil

Original creation time: 2014-11-07 20:28:55

CC:  jhpalmieri kcrisman

Keywords: mathjax notebook

The aim of this ticket is to put mathjax (see #17288) as a dependency of sagenb spkg and let them work together.



---

Comment by tmonteil created at 2014-11-07 21:05:51

I put a "need review" because the commit is ready, but there is no hurry if you need to discuss on the sagenb side.
----
New commits:


---

Comment by tmonteil created at 2014-11-07 21:05:51

Changing status from new to needs_review.


---

Comment by novoselt created at 2014-11-07 23:02:08

Since this change works even without modifying the sagenb, I don't see any point in delaying the switch. For the users the difference should be using a more up-to-date version of MathJax.


---

Comment by kcrisman created at 2014-11-08 04:09:11

Well, it's kind of a hack removing things from the egg, isn't it?  Anyway, I won't be trying it in the near future, but if you have time to test it and there aren't any subtle things, obviously in the long run this is a very good idea.


---

Comment by kcrisman created at 2014-12-07 03:09:06

Shouldn't the sagenb egg thing use the version number of the sagenb package (this should be available as some kind of env var in spkg-install)?


---

Comment by tmonteil created at 2014-12-08 11:39:56

Replying to [comment:4 kcrisman]:
> Well, it's kind of a hack removing things from the egg, isn't it?

If i understand the motivation in having this ticket separate from #17288, sagenb development has not much energy. So, if sagenb developpers agree with this ticket, then it can be accepted without the need to release a new version of sagenb (and the removing part of spkg-install can be removed later once mathjax is removed from sagenb tarball during a following release). I just wanted to avoid this ticket to impose some additional work on the sagenb side.


---

Comment by git created at 2014-12-08 12:04:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2014-12-08 13:14:20

Okay, in that case though I am not sure I will be able to review this - Andrey, I'm happy if you test this, though, I just don't want to mix things up too badly.

Incidentally, I'm surprised you have to go to those lengths to find the version number, at least for sagenb; shouldn't there be a variable defining the current pkg version available inside the current pkg install process?  It surprises me if that's not the case.  But I admit I don't have independent proof of this.


---

Comment by tmonteil created at 2014-12-08 16:52:34

I just read the `sage-spkg` script to see if i can steal something from there. There are indeed some `PKG_VER`, `LOCAL_PKG_VER` and `PKG_BASE_VER` variables that could be good candidates. However, those variables are not exported and the `spkg-install` script is called (not sourced) so the `spkg-install` will not inherit those variables.

By the way, `LOCAL_PKG_VER` is also built by looking at `package-version.txt`.


---

Comment by kcrisman created at 2014-12-08 16:56:01

Ah, interesting.  Do you think that it should be sourced?  As long as those variables then change (and after a build are vanquished) that could be useful.


---

Comment by tmonteil created at 2014-12-08 17:11:33

Replying to [comment:10 kcrisman]:
> Ah, interesting.  Do you think that it should be sourced?  As long as those variables then change (and after a build are vanquished) that could be useful.

No, if we want some variable to be available in the `spkg-install` script i would use `export USEFUL_VARIABLE` before calling the `spkg-install` script (by the way, note that some `spkg-install` scripts are written in Python and can not be sourced within a bash script). I do not know how much those variables are needed though.


---

Comment by kcrisman created at 2015-02-03 01:56:09

Waiting on #17288 at this time before bothering to review.


---

Comment by vbraun created at 2015-03-09 19:18:34

Mathjax is just a runtime dependency but doesn't block installing SageNB, right?. You can also make symlinks whose destination is not yet installed. So no need to list it in deps.


---

Comment by vbraun created at 2015-03-13 15:04:10

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-03-13 22:27:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-03-13 23:30:54

lgtm


---

Comment by vbraun created at 2015-03-13 23:30:54

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2015-03-14 10:28:20

Merge conflict with sage-6.6.beta5  (ipython 3.0 update)


---

Comment by vbraun created at 2015-03-14 10:28:26

Changing status from positive_review to needs_work.


---

Comment by git created at 2015-03-14 18:09:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2015-03-14 18:11:35

I hope the merge is correct.


---

Comment by tmonteil created at 2015-03-14 18:11:35

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2015-03-14 20:02:01

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-03-17 08:34:03

Resolution: fixed
