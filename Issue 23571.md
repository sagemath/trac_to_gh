# Issue 23571: Keep embedding info when converting algebraics to number field in projective morphism

Issue created by migration from Trac.

Original creator: paulfili

Original creation time: 2017-09-08 16:23:45

CC:  bhutz




---

Comment by paulfili created at 2017-09-08 16:44:33

The following code used to fail:

```python
R.<t>=PolynomialRing(QQ)
s = (t^3+t+1).roots(QQbar)[0][0]
P.<x,y>=ProjectiveSpace(QQbar,1)
H = Hom(P,P)
f = H([s*x^3-13*y^3, y^3-15*y^3])
f_alg = f._number_field_from_algebraics()
f_alg.change_ring(QQbar) # Used to fail
```


The problem was that the number field being defined over which f_alg was defined should include an embedding, telling Sage where to send the generator in the real/complex numbers. (After all, QQbar elements all have this embedding information.) This information was present but was not being used when defining the number field (possibly due to a quirk in the code from qqbar.py). The fix now updates the code to specify this embedding when creating the number field. 
----
New commits:


---

Comment by paulfili created at 2017-09-08 16:44:33

Changing type from PLEASE CHANGE to defect.


---

Comment by paulfili created at 2017-09-08 16:44:33

Changing status from new to needs_review.


---

Comment by paulfili created at 2017-09-08 16:44:33

Changing component from PLEASE CHANGE to algebraic geometry.


---

Comment by roed created at 2017-09-08 21:17:53

Changing status from needs_review to needs_work.


---

Comment by roed created at 2017-09-08 21:17:53

You should add a test to show that the bug has been fixed.  You can use

```
:trac:`23808`
```

to refer to this ticket in the docstring.


---

Comment by git created at 2017-09-08 23:05:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by paulfili created at 2017-09-08 23:08:19

Replying to [comment:3 roed]:
> You should add a test to show that the bug has been fixed.  You can use
> {{{
> :trac:`23808`
> }}}
> to refer to this ticket in the docstring.

Thanks, David, I added the example.


---

Comment by paulfili created at 2017-09-08 23:08:42

Changing status from needs_work to needs_review.


---

Comment by roed created at 2017-09-09 00:05:44

You should change `print f` to just `f` for Python 3 compatibility.  Other than that, looks good and positive review once patchbot approves.


---

Comment by roed created at 2017-09-09 00:05:44

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2017-09-09 15:43:57

Also, note that there is a similar function for points that should be modified at the same time.


---

Comment by git created at 2017-09-09 16:43:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by paulfili created at 2017-09-09 16:44:57

Changing status from needs_work to needs_review.


---

Comment by paulfili created at 2017-09-09 16:45:19

Replying to [comment:7 roed]:
> You should change `print f` to just `f` for Python 3 compatibility.  Other than that, looks good and positive review once patchbot approves.

Thanks, David, I have changed that as well.


---

Comment by bhutz created at 2017-09-09 17:30:15

Changing status from needs_review to positive_review.


---

Comment by bhutz created at 2017-09-09 17:30:15

This looks fine to me. I also added a description.


---

Comment by vbraun created at 2017-09-11 13:46:53

Resolution: fixed
