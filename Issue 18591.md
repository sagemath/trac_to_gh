# Issue 18591: Export graph to file

Issue created by migration from https://trac.sagemath.org/ticket/18828

Original creator: ncohen

Original creation time: 2015-06-30 14:58:53

CC:  dimpase dcoudert borassi

I feel rather guilty, as all that this branch does is steal networkx functions. With it we can export graphs to several file formats, using the `networkx.write_*` functions.

Nathann


---

Comment by ncohen created at 2015-06-30 15:14:05

New commits:


---

Comment by ncohen created at 2015-06-30 15:14:05

Changing status from new to needs_review.


---

Comment by dcoudert created at 2015-06-30 18:11:26

Changing status from needs_review to needs_work.


---

Comment by dcoudert created at 2015-06-30 18:11:26

Hello,

The patchbot reports compilation errors associated with ticket #18746. I don't know why...
Actually I have the same issue when I try to compile my develop branch, and so I'm currently unable to test this patch.

Concerning this ticket. Don't feel guilty to steal networkx. It is very useful and we will certainly also have to do the same for reading graphs from file.

I suggest to change the way you guess the file format with something like:

```
for ext in formats:
    if filename.endswith('.'+ext):
        break
finally:
    raise ...
```

With networkx it is possible to give extension like `.edgelist.gz` in which case the file should be compressed (at least with version 1.9.1, but we only have 1.8.1). See https://networkx.github.io/documentation/latest/reference/generated/networkx.readwrite.edgelist.write_edgelist.html

David.


---

Comment by borassi created at 2015-07-01 09:20:50

Hellooooo!

I have a little trouble understanding the goal of this ticket: would you like to have only one standard function to save graphs, instead of calling different NetworkX functions, right? Because, for instance, if I want to save a file in adjlist format I can simply type:


```
import networkx
networkx.write_adjlist(G, path)

```

instead of using this new function.

In any case, I have tried to compile this code, both with `make` and with `make distclean && make`, and it works! Some small suggestions:

 * could you make a test that checks if the output is correct?

 * "the format is ‘guessed’ from the extension ..." maybe it is better to say "the format is the extension", because you do not guess, you simply use the extension.

 * I would add a link to the NetworkX manual (!http://networkx.lanl.gov/reference/readwrite.html), where the different file formats are detailed.


---

Comment by ncohen created at 2015-07-01 10:15:58

Hello,

> The patchbot reports compilation errors associated with ticket #18746. I don't know why...
> Actually I have the same issue when I try to compile my develop branch, and so I'm currently unable to test this patch.

I had the same problem. Can be solved by removing all the cython cached files that you can find:


```
./src/build/temp.linux-x86_64-2.7/sage/graphs/graph_decompositions
./src/build/temp.linux-x86_64-2.7/home/ncohen/.Sage/src/build/cythonized/sage/graphs/graph_decompositions
./src/build/cythonized/sage/graphs/graph_decompositions
./src/build/cython_debug/cython_debug_info_sage.graphs.graph_decompositions*
./src/build/lib.linux-x86_64-2.7/sage/graphs/graph_decompositions
./local/lib/python2.7/site-packages/sage/graphs/graph_decompositions
```


And then it works. That's trouble for the patchbots, though.

> Concerning this ticket. Don't feel guilty to steal networkx. It is very useful and we will certainly also have to do the same for reading graphs from file.

Yep.

> I suggest to change the way you guess the file format with something like:
> {{{
> for ext in formats:
>     if filename.endswith('.'+ext):
>         break
> finally:
>     raise ...
> }}}

Why? It is longer, and does the same. None of the extensions contains a point.

> With networkx it is possible to give extension like `.edgelist.gz` in which case the file should be compressed (at least with version 1.9.1, but we only have 1.8.1). See https://networkx.github.io/documentation/latest/reference/generated/networkx.readwrite.edgelist.write_edgelist.html

So you want to add all combinations of `.edgelist.gz, edgelist.tgz,..` for all possible combinations to the dictionary of extensions? `O_o`

Nathann


---

Comment by ncohen created at 2015-07-01 10:25:31

Hello,

> I have a little trouble understanding the goal of this ticket: would you like to have only one standard function to save graphs, instead of calling different NetworkX functions, right?

Yes

> Because, for instance, if I want to save a file in adjlist format I can simply type:

That's what the branch does, too. Only you may not know that those functions can be found in networkx.

> In any case, I have tried to compile this code, both with `make` and with `make distclean && make`, and it works! Some small suggestions:
> 
>  * could you make a test that checks if the output is correct?

I added one check, but it is unpleasant in many ways. First, the (integer) vertices become strings, and then each edge gets a label encoding a weight. Well, that's networkx...

>  * "the format is ‘guessed’ from the extension ..." maybe it is better to say "the format is the extension", because you do not guess, you simply use the extension.

How is that not a guess? Anyway, udpated.

>  * I would add a link to the NetworkX manual (!http://networkx.lanl.gov/reference/readwrite.html), where the different file formats are detailed.

Done.

Nathann


---

Comment by git created at 2015-07-01 10:26:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-07-01 10:26:25

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2015-07-01 18:29:18

This method is clearly useful. It is too boring to import networkx each time you want to read/write a graph from/to a file.
> >  * could you make a test that checks if the output is correct?
> 
> I added one check, but it is unpleasant in many ways. First, the (integer) vertices become strings, and then each edge gets a label encoding a weight. Well, that's networkx...

By default method `networx.write_edgelist` sets parameter `data=True`. So your method produce a weighted edgelist instead of an edgelist

```
0 1 {}
```

instead of

```
0 1
```

I understand that you prefer short and fast code, but since writing to a file is slow anyway, we could spend some computation time to refine the behavior of the method.

David


---

Comment by ncohen created at 2015-07-01 18:31:26

> I understand that you prefer short and fast code, but since writing to a file is slow anyway, we could spend some computation time to refine the behavior of the method.

Would it do the trick for you if we replaced 'networkx.write_edgelist' with 'lambda x:networkx.write_edgelist(x,data=False)'?

Nathann


---

Comment by dcoudert created at 2015-07-01 18:51:52

Replying to [comment:10 ncohen]:
> > I understand that you prefer short and fast code, but since writing to a file is slow anyway, we could spend some computation time to refine the behavior of the method.
> 
> Would it do the trick for you if we replaced 'networkx.write_edgelist' with 'lambda x:networkx.write_edgelist(x,data=False)'?

Nice trick. Furthermore, in case we want to write the labels, we can have another parameter to set data=True.


---

Comment by git created at 2015-07-01 19:49:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-07-01 19:50:45

> Nice trick. Furthermore, in case we want to write the labels, we can have another parameter to set data=True.

Some functions have this 'data' flag, others do not. To make everything simpler I updated the code to make it possible to forward any other flag to networkx. This way, we can pick whatever we want.

Nathann


---

Comment by dcoudert created at 2015-07-02 10:42:12

I propose to add extend the tests in the following way. Let me know if you agree before I push a commit.

```
sage: g = graphs.PetersenGraph()
sage: filename = tmp_filename(ext=".pajek")
sage: g.export_to_file(filename)
sage: import networkx
sage: h = Graph( networkx.read_pajek(filename)
sage: g.is_isomorphic(h)
True
sage: filename = tmp_filename(ext=".edgelist")
sage: g.export_to_file(filename, data=False)
sage: h = Graph( networkx.read_edgelist(filename)
sage: g.is_isomorphic(h)
True
```

Relying on vertex names is unfortunately not possible yet since the read method turns vertex id like `13` to `u'13'`.


---

Comment by ncohen created at 2015-07-02 10:44:00

No problem no problem. Or perhaps we could relabel the graph with the function 'int' ? This should turn the u'13' into a proper 13.

Nathann


---

Comment by dcoudert created at 2015-07-03 15:38:28

I have pushed a small edit on the example. Hope it helps.

For the unicode problem, I have once used the following trick. Certainly not the best way to do it.

```
import string

if all(isinstance(u, unicode) for u in G):
    myaction = string.atoi
elif all(isinstance(u, str) for u in G):
    myaction = ZZ
else:
    myaction = lambda x:x

try:
    L = {u:myaction(u) for u in G}
except:
    L = {u:str(u) for u in G}

G.relabel(perm=L, inplace=True)
```

----
New commits:


---

Comment by ncohen created at 2015-07-03 15:47:51

Works for me !


---

Comment by dcoudert created at 2015-07-03 16:00:17

So then good to go.

It would be nice to have a method for importing a graph from file, but I don't know where to put it: as a method of class `Generic_Graph`? as a method of (di)graphs generators?


---

Comment by dcoudert created at 2015-07-03 16:00:17

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2015-07-03 17:09:22

> It would be nice to have a method for importing a graph from file, but I don't know where to put it: as a method of class `Generic_Graph`? as a method of (di)graphs generators?

The 'classiest way' would probably be something like `Graph(filename)`. But adding formats to the current list scares me `:-P`

Nathann


---

Comment by dcoudert created at 2015-07-03 17:10:50

> The 'classiest way' would probably be something like `Graph(filename)`. But adding formats to the current list scares me `:-P`
I understand. Although you did an impressive cleaning, it's still hard.
Well, we will think to something.


---

Comment by vbraun created at 2015-07-03 22:14:22

Resolution: fixed
