# Issue 22746: polynomial quotient rings are unique parents

archive/issues_022746.json:
```json
{
    "body": "Currently quotient rings are not unique parents which sometimes causes trouble with \n```\nsage: R.<x> = QQ[]\nsage: R.quo(x) is R.quo(x)\nFalse\nsage: R.quo(x) == R.quo(x)\nTrue\n```\n\nThe changes proposed here make the creation go through a factory which makes sure that the parents are unique.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22983\n\n",
    "created_at": "2017-05-11T18:28:17Z",
    "labels": [
        "commutative algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "polynomial quotient rings are unique parents",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22746",
    "user": "saraedum"
}
```
Currently quotient rings are not unique parents which sometimes causes trouble with 
```
sage: R.<x> = QQ[]
sage: R.quo(x) is R.quo(x)
False
sage: R.quo(x) == R.quo(x)
True
```

The changes proposed here make the creation go through a factory which makes sure that the parents are unique.

Issue created by migration from https://trac.sagemath.org/ticket/22983





---

archive/issue_comments_317648.json:
```json
{
    "body": "Does this fully solve the problem, though? One could give different generators for the same ideal. Should we be getting identical results for those, e.g., `R.quo(x-1)` and `R.quo(2*x-2)` (provided `2` is invertible in `R` ...). It might be worth documenting the choice made.\n\nI suspect that for higher rank polynomial rings, normalizing the ideal representation might be too expensive (although computing in those rings would be expensive anyway).\n----\nNew commits:",
    "created_at": "2017-05-11T22:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317648",
    "user": "nbruin"
}
```

Does this fully solve the problem, though? One could give different generators for the same ideal. Should we be getting identical results for those, e.g., `R.quo(x-1)` and `R.quo(2*x-2)` (provided `2` is invertible in `R` ...). It might be worth documenting the choice made.

I suspect that for higher rank polynomial rings, normalizing the ideal representation might be too expensive (although computing in those rings would be expensive anyway).
----
New commits:



---

archive/issue_comments_317649.json:
```json
{
    "body": "nbruin: You are right. It should be documented. I'll fix that.\nI believe that your example should produce two different rings (at least for the time being.) These could be `==` equal but not `is` equal. However, getting `==` to work for them would require a change of the hash function which is (hard and) not the scope of this ticket.",
    "created_at": "2017-05-11T23:00:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317649",
    "user": "saraedum"
}
```

nbruin: You are right. It should be documented. I'll fix that.
I believe that your example should produce two different rings (at least for the time being.) These could be `==` equal but not `is` equal. However, getting `==` to work for them would require a change of the hash function which is (hard and) not the scope of this ticket.



---

archive/issue_comments_317650.json:
```json
{
    "body": "Currently `R.quo(x-1)` and `R.quo(2*x-2)` prints in the same way.\n\n```\nsage: R.<x>= QQ[]\nsage: R.quo(x+1)\nUnivariate Quotient Polynomial Ring in xbar over Rational Field with modulus x + 1\nsage: R.quo(2*x+2)\nUnivariate Quotient Polynomial Ring in xbar over Rational Field with modulus x + 1\n```\n\nSo I would say rather that the two constructions should return the same ring; it should be easy, it suffices to make the defining polynomial monic because creating the key.",
    "created_at": "2017-05-12T05:53:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317650",
    "user": "caruso"
}
```

Currently `R.quo(x-1)` and `R.quo(2*x-2)` prints in the same way.

```
sage: R.<x>= QQ[]
sage: R.quo(x+1)
Univariate Quotient Polynomial Ring in xbar over Rational Field with modulus x + 1
sage: R.quo(2*x+2)
Univariate Quotient Polynomial Ring in xbar over Rational Field with modulus x + 1
```

So I would say rather that the two constructions should return the same ring; it should be easy, it suffices to make the defining polynomial monic because creating the key.



---

archive/issue_comments_317651.json:
```json
{
    "body": "Replying to [comment:5 caruso]:\n> Currently `R.quo(x-1)` and `R.quo(2*x-2)` prints in the same way.\n> {{{\n> sage: R.<x>= QQ[]\n> sage: R.quo(x+1)\n> Univariate Quotient Polynomial Ring in xbar over Rational Field with modulus x + 1\n> sage: R.quo(2*x+2)\n> Univariate Quotient Polynomial Ring in xbar over Rational Field with modulus x + 1\n> }}}\n> So I would say rather that the two constructions should return the same ring; it should be easy, it suffices to make the defining polynomial monic because creating the key.\n\nI agree. However, this is already happening automagically: `quo` creates a (principal) ideal and takes its generator as the modulus which is the same `x+1` in both of your examples.\nAt the same time, if someone insists to create a quotient with the modulus `x + 1` and one with the modulus `2*x + 2` by calling `PolynomialQuotientRing` directly, then these should be distinct because `.modulus()` is going to have a different value for the two, i.e., they are distinguishable. I'll add a doctest to clarify this.",
    "created_at": "2017-05-16T11:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317651",
    "user": "saraedum"
}
```

Replying to [comment:5 caruso]:
> Currently `R.quo(x-1)` and `R.quo(2*x-2)` prints in the same way.
> {{{
> sage: R.<x>= QQ[]
> sage: R.quo(x+1)
> Univariate Quotient Polynomial Ring in xbar over Rational Field with modulus x + 1
> sage: R.quo(2*x+2)
> Univariate Quotient Polynomial Ring in xbar over Rational Field with modulus x + 1
> }}}
> So I would say rather that the two constructions should return the same ring; it should be easy, it suffices to make the defining polynomial monic because creating the key.

I agree. However, this is already happening automagically: `quo` creates a (principal) ideal and takes its generator as the modulus which is the same `x+1` in both of your examples.
At the same time, if someone insists to create a quotient with the modulus `x + 1` and one with the modulus `2*x + 2` by calling `PolynomialQuotientRing` directly, then these should be distinct because `.modulus()` is going to have a different value for the two, i.e., they are distinguishable. I'll add a doctest to clarify this.



---

archive/issue_comments_317652.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-16T11:56:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317652",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317653.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-05-17T22:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317653",
    "user": "saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_317654.json:
```json
{
    "body": "Doctests in `rings/polynomial` pass for me. Let's see what the patchbot thinks about everything else.",
    "created_at": "2017-05-17T22:50:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317654",
    "user": "saraedum"
}
```

Doctests in `rings/polynomial` pass for me. Let's see what the patchbot thinks about everything else.



---

archive/issue_comments_317655.json:
```json
{
    "body": "Ok.\nIt's a bit weird and confusing that the function `PolynomialQuotientRing` does not have the same behaviour than the method `quo` (and even `QuotientRing`), isn't it? \n\n\n```\n    sage: R.<x> = QQ[]\n    sage: QuotientRing(R, 2*x+2)\n    Univariate Quotient Polynomial Ring in xbar over Rational Field with modulus x + 1\n    sage: PolynomialQuotientRing(R, 2*x+2)\n    Univariate Quotient Polynomial Ring in xbar over Rational Field with modulus 2*x + 2\n```\n\n\nI would be in favour of uniformizing this... but it's definitely for another ticket.\n\nI'll try to review your ticket soon.",
    "created_at": "2017-05-18T04:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317655",
    "user": "caruso"
}
```

Ok.
It's a bit weird and confusing that the function `PolynomialQuotientRing` does not have the same behaviour than the method `quo` (and even `QuotientRing`), isn't it? 


```
    sage: R.<x> = QQ[]
    sage: QuotientRing(R, 2*x+2)
    Univariate Quotient Polynomial Ring in xbar over Rational Field with modulus x + 1
    sage: PolynomialQuotientRing(R, 2*x+2)
    Univariate Quotient Polynomial Ring in xbar over Rational Field with modulus 2*x + 2
```


I would be in favour of uniformizing this... but it's definitely for another ticket.

I'll try to review your ticket soon.



---

archive/issue_comments_317656.json:
```json
{
    "body": "Why did you remove \"in one variable\" in the doctest.\n\n\n```\n    sage: R.<x,y> = QQ[]\n    sage: PolynomialQuotientRing(R, x^2+y+1)\n    ...\n    TypeError: ring must be a polynomial ring\n```\n",
    "created_at": "2017-05-24T16:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317656",
    "user": "caruso"
}
```

Why did you remove "in one variable" in the doctest.


```
    sage: R.<x,y> = QQ[]
    sage: PolynomialQuotientRing(R, x^2+y+1)
    ...
    TypeError: ring must be a polynomial ring
```




---

archive/issue_comments_317657.json:
```json
{
    "body": "Replying to [comment:11 caruso]:\n> Why did you remove \"in one variable\" in the doctest.\n> \n> {{{\n>     sage: R.<x,y> = QQ[]\n>     sage: PolynomialQuotientRing(R, x^2+y+1)\n>     ...\n>     TypeError: ring must be a polynomial ring\n> }}}\nBecause it already says \"univariate\" there.",
    "created_at": "2017-06-06T05:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317657",
    "user": "saraedum"
}
```

Replying to [comment:11 caruso]:
> Why did you remove "in one variable" in the doctest.
> 
> {{{
>     sage: R.<x,y> = QQ[]
>     sage: PolynomialQuotientRing(R, x^2+y+1)
>     ...
>     TypeError: ring must be a polynomial ring
> }}}
Because it already says "univariate" there.



---

archive/issue_comments_317658.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd86.5\".",
    "created_at": "2017-06-07T15:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317658",
    "user": "saraedum"
}
```

Changing keywords from "" to "sd86.5".



---

archive/issue_comments_317659.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-08T07:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317659",
    "user": "roed"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_317660.json:
```json
{
    "body": "Tests all pass for me, and it looks good.",
    "created_at": "2017-06-08T07:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317660",
    "user": "roed"
}
```

Tests all pass for me, and it looks good.



---

archive/issue_comments_317661.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2017-06-09T18:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317661",
    "user": "vbraun"
}
```

Merge conflict



---

archive/issue_comments_317662.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-06-09T18:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317662",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_317663.json:
```json
{
    "body": "Replying to [comment:15 vbraun]:\n> Merge conflict\n\nFor me, trac is showing it as still merging cleanly.  Is there a new beta against which the merge is failing, or a ticket?",
    "created_at": "2017-06-09T20:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317663",
    "user": "roed"
}
```

Replying to [comment:15 vbraun]:
> Merge conflict

For me, trac is showing it as still merging cleanly.  Is there a new beta against which the merge is failing, or a ticket?



---

archive/issue_comments_317664.json:
```json
{
    "body": "We do not get a merge conflict for that one.",
    "created_at": "2017-06-10T17:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317664",
    "user": "saraedum"
}
```

We do not get a merge conflict for that one.



---

archive/issue_comments_317665.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-06-10T17:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317665",
    "user": "saraedum"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_317666.json:
```json
{
    "body": "Wait for the next beta",
    "created_at": "2017-06-10T17:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317666",
    "user": "vbraun"
}
```

Wait for the next beta



---

archive/issue_comments_317667.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-06-10T17:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317667",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_317668.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-12T01:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317668",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317669.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-06-12T01:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317669",
    "user": "saraedum"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_317670.json:
```json
{
    "body": "Still no conflicts. What are we doing wrong?",
    "created_at": "2017-06-12T01:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317670",
    "user": "saraedum"
}
```

Still no conflicts. What are we doing wrong?



---

archive/issue_comments_317671.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-06-12T22:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317671",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_317672.json:
```json
{
    "body": "Random failures on some of the build bots:\n\n```\nsage -t --long src/sage/rings/polynomial/polynomial_quotient_ring.py\n**********************************************************************\nFile \"src/sage/rings/polynomial/polynomial_quotient_ring.py\", line 1355, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_units\nFailed example:\n    L.S_units([])\nExpected:\n    [(1/2*a + 1/2, 6),\n     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),\n     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]\nGot:\n    [(-1/2*a + 1/2, 6),\n     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),\n     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]\n**********************************************************************\nFile \"src/sage/rings/polynomial/polynomial_quotient_ring.py\", line 1359, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_units\nFailed example:\n    L.S_units([K.ideal(1/2*a - 3/2)])\nExpected:\n    [((-1/6*a - 1/2)*b^2 + (1/3*a - 1)*b + 4/3*a, +Infinity),\n     (1/2*a + 1/2, 6),\n     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),\n     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]\nGot:\n    [((-1/6*a - 1/2)*b^2 + (1/3*a - 1)*b + 4/3*a, +Infinity),\n     (-1/2*a + 1/2, 6),\n     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),\n     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]\n**********************************************************************\nFile \"src/sage/rings/polynomial/polynomial_quotient_ring.py\", line 1364, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_units\nFailed example:\n    L.S_units([K.ideal(2)])\nExpected:\n    [((1/2*a - 1/2)*b^2 + (a + 1)*b + 3, +Infinity),\n     ((1/6*a + 1/2)*b^2 + (-1/3*a + 1)*b - 5/6*a + 1/2, +Infinity),\n     ((1/6*a + 1/2)*b^2 + (-1/3*a + 1)*b - 5/6*a - 1/2, +Infinity),\n     (1/2*a + 1/2, 6),\n     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),\n     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]\nGot:\n    [((1/2*a - 1/2)*b^2 + (a + 1)*b + 3, +Infinity),\n     ((1/6*a + 1/2)*b^2 + (-1/3*a + 1)*b - 5/6*a + 1/2, +Infinity),\n     ((1/6*a + 1/2)*b^2 + (-1/3*a + 1)*b - 5/6*a - 1/2, +Infinity),\n     (-1/2*a + 1/2, 6),\n     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),\n     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]\n**********************************************************************\nFile \"src/sage/rings/polynomial/polynomial_quotient_ring.py\", line 1445, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.units\nFailed example:\n    L.units()\nExpected:\n    [(1/2*a + 1/2, 6),\n     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),\n     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]\nGot:\n    [(-1/2*a + 1/2, 6),\n     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),\n     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]\n**********************************************************************\n2 items had failures:\n   3 of  18 in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_units\n   1 of  23 in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.units\n    [385 tests, 4 failures, 1.59 s]\n```\n",
    "created_at": "2017-06-12T22:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317672",
    "user": "vbraun"
}
```

Random failures on some of the build bots:

```
sage -t --long src/sage/rings/polynomial/polynomial_quotient_ring.py
**********************************************************************
File "src/sage/rings/polynomial/polynomial_quotient_ring.py", line 1355, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_units
Failed example:
    L.S_units([])
Expected:
    [(1/2*a + 1/2, 6),
     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),
     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]
Got:
    [(-1/2*a + 1/2, 6),
     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),
     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]
**********************************************************************
File "src/sage/rings/polynomial/polynomial_quotient_ring.py", line 1359, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_units
Failed example:
    L.S_units([K.ideal(1/2*a - 3/2)])
Expected:
    [((-1/6*a - 1/2)*b^2 + (1/3*a - 1)*b + 4/3*a, +Infinity),
     (1/2*a + 1/2, 6),
     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),
     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]
Got:
    [((-1/6*a - 1/2)*b^2 + (1/3*a - 1)*b + 4/3*a, +Infinity),
     (-1/2*a + 1/2, 6),
     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),
     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]
**********************************************************************
File "src/sage/rings/polynomial/polynomial_quotient_ring.py", line 1364, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_units
Failed example:
    L.S_units([K.ideal(2)])
Expected:
    [((1/2*a - 1/2)*b^2 + (a + 1)*b + 3, +Infinity),
     ((1/6*a + 1/2)*b^2 + (-1/3*a + 1)*b - 5/6*a + 1/2, +Infinity),
     ((1/6*a + 1/2)*b^2 + (-1/3*a + 1)*b - 5/6*a - 1/2, +Infinity),
     (1/2*a + 1/2, 6),
     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),
     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]
Got:
    [((1/2*a - 1/2)*b^2 + (a + 1)*b + 3, +Infinity),
     ((1/6*a + 1/2)*b^2 + (-1/3*a + 1)*b - 5/6*a + 1/2, +Infinity),
     ((1/6*a + 1/2)*b^2 + (-1/3*a + 1)*b - 5/6*a - 1/2, +Infinity),
     (-1/2*a + 1/2, 6),
     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),
     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]
**********************************************************************
File "src/sage/rings/polynomial/polynomial_quotient_ring.py", line 1445, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.units
Failed example:
    L.units()
Expected:
    [(1/2*a + 1/2, 6),
     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),
     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]
Got:
    [(-1/2*a + 1/2, 6),
     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),
     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]
**********************************************************************
2 items had failures:
   3 of  18 in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_units
   1 of  23 in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.units
    [385 tests, 4 failures, 1.59 s]
```




---

archive/issue_comments_317673.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-16T06:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317673",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317674.json:
```json
{
    "body": "Changing keywords from \"sd86.5\" to \"sd86.5, sd87\".",
    "created_at": "2017-07-17T21:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317674",
    "user": "roed"
}
```

Changing keywords from "sd86.5" to "sd86.5, sd87".



---

archive/issue_comments_317675.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-08T03:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317675",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317676.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-08T03:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317676",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317677.json:
```json
{
    "body": "Let's see what the patchbots think now. I expect some of the `S_units` tests to disagree. I don't understand why they are not stable as I don't see anything happening in the implementation that would be random after my changes.",
    "created_at": "2018-01-08T04:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317677",
    "user": "saraedum"
}
```

Let's see what the patchbots think now. I expect some of the `S_units` tests to disagree. I don't understand why they are not stable as I don't see anything happening in the implementation that would be random after my changes.



---

archive/issue_comments_317678.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-08T04:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317678",
    "user": "saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_317679.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-01-08T15:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317679",
    "user": "saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_317680.json:
```json
{
    "body": "Some `S_units` fail. Let's make the tests less strict and add a `_test_S_units` instead.",
    "created_at": "2018-01-08T15:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317680",
    "user": "saraedum"
}
```

Some `S_units` fail. Let's make the tests less strict and add a `_test_S_units` instead.



---

archive/issue_comments_317681.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-08T23:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317681",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317682.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-08T23:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317682",
    "user": "saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_317683.json:
```json
{
    "body": "I thought for a while that the behaviour of these doctests was random. Actually\n    it is not. It is consistent over all patchbot runs with the same base version\n    of Sage. Caching the polynomial rings flips some signs, I am not sure why.\n    Anyway, the result is still correct and it is not random, so there is no need\n    for a `_test_S_units()` which would be hard to write anyway.",
    "created_at": "2018-03-08T23:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317683",
    "user": "saraedum"
}
```

I thought for a while that the behaviour of these doctests was random. Actually
    it is not. It is consistent over all patchbot runs with the same base version
    of Sage. Caching the polynomial rings flips some signs, I am not sure why.
    Anyway, the result is still correct and it is not random, so there is no need
    for a `_test_S_units()` which would be hard to write anyway.



---

archive/issue_comments_317684.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-08T23:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317684",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_317685.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2018-03-29T20:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317685",
    "user": "roed"
}
```

Looks good to me.



---

archive/issue_comments_317686.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-29T20:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317686",
    "user": "roed"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_317687.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-05-08T17:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317687",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_317688.json:
```json
{
    "body": "I still get failing tests. Random failures during high load. It looks like the tests depend on whether a garbage collection is forced due to low memory.\n\n```\nFile \"src/sage/rings/polynomial/polynomial_quotient_ring.py\", line 1445, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_units\nFailed example:\n    L.S_units([])\nExpected:\n    [(1/2*a + 1/2, 6),\n     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),\n     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]\nGot:\n    [(-1/2*a + 1/2, 6),\n     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),\n     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]\n**********************************************************************\nFile \"src/sage/rings/polynomial/polynomial_quotient_ring.py\", line 1449, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_units\nFailed example:\n    L.S_units([K.ideal(1/2*a - 3/2)])\nExpected:\n    [((-1/6*a - 1/2)*b^2 + (1/3*a - 1)*b + 4/3*a, +Infinity),\n     (1/2*a + 1/2, 6),\n     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),\n     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]\nGot:\n    [((-1/6*a - 1/2)*b^2 + (1/3*a - 1)*b + 4/3*a, +Infinity),\n     (-1/2*a + 1/2, 6),\n     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),\n     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]\n**********************************************************************\nFile \"src/sage/rings/polynomial/polynomial_quotient_ring.py\", line 1454, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_units\nFailed example:\n    L.S_units([K.ideal(2)])\nExpected:\n    [((1/2*a - 1/2)*b^2 + (a + 1)*b + 3, +Infinity),\n     ((1/6*a + 1/2)*b^2 + (-1/3*a + 1)*b - 5/6*a + 1/2, +Infinity),\n     ((1/6*a + 1/2)*b^2 + (-1/3*a + 1)*b - 5/6*a - 1/2, +Infinity),\n     (1/2*a + 1/2, 6),\n     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),\n     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]\nGot:\n    [((1/2*a - 1/2)*b^2 + (a + 1)*b + 3, +Infinity),\n     ((1/6*a + 1/2)*b^2 + (-1/3*a + 1)*b - 5/6*a + 1/2, +Infinity),\n     ((1/6*a + 1/2)*b^2 + (-1/3*a + 1)*b - 5/6*a - 1/2, +Infinity),\n     (-1/2*a + 1/2, 6),\n     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),\n     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]\n**********************************************************************\nFile \"src/sage/rings/polynomial/polynomial_quotient_ring.py\", line 1535, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.units\nFailed example:\n    L.units()\nExpected:\n    [(1/2*a + 1/2, 6),\n     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),\n     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]\nGot:\n    [(-1/2*a + 1/2, 6),\n     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),\n     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]\n**********************************************************************\nFile \"src/sage/rings/polynomial/polynomial_quotient_ring.py\", line 1544, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.units\nFailed example:\n    L.unit_group().gens_values()\nExpected:\n    [-1/2*a + 1/2, (-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, 2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2]\nGot:\n    [1/2*a + 1/2, (-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, 2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2]\n**********************************************************************\n2 items had failures:\n   3 of  18 in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_units\n   2 of  23 in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.units\n    [451 tests, 5 failures, 2.92 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/rings/polynomial/polynomial_quotient_ring.py  # 5 doctests failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2018-05-08T17:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317688",
    "user": "vbraun"
}
```

I still get failing tests. Random failures during high load. It looks like the tests depend on whether a garbage collection is forced due to low memory.

```
File "src/sage/rings/polynomial/polynomial_quotient_ring.py", line 1445, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_units
Failed example:
    L.S_units([])
Expected:
    [(1/2*a + 1/2, 6),
     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),
     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]
Got:
    [(-1/2*a + 1/2, 6),
     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),
     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]
**********************************************************************
File "src/sage/rings/polynomial/polynomial_quotient_ring.py", line 1449, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_units
Failed example:
    L.S_units([K.ideal(1/2*a - 3/2)])
Expected:
    [((-1/6*a - 1/2)*b^2 + (1/3*a - 1)*b + 4/3*a, +Infinity),
     (1/2*a + 1/2, 6),
     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),
     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]
Got:
    [((-1/6*a - 1/2)*b^2 + (1/3*a - 1)*b + 4/3*a, +Infinity),
     (-1/2*a + 1/2, 6),
     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),
     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]
**********************************************************************
File "src/sage/rings/polynomial/polynomial_quotient_ring.py", line 1454, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_units
Failed example:
    L.S_units([K.ideal(2)])
Expected:
    [((1/2*a - 1/2)*b^2 + (a + 1)*b + 3, +Infinity),
     ((1/6*a + 1/2)*b^2 + (-1/3*a + 1)*b - 5/6*a + 1/2, +Infinity),
     ((1/6*a + 1/2)*b^2 + (-1/3*a + 1)*b - 5/6*a - 1/2, +Infinity),
     (1/2*a + 1/2, 6),
     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),
     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]
Got:
    [((1/2*a - 1/2)*b^2 + (a + 1)*b + 3, +Infinity),
     ((1/6*a + 1/2)*b^2 + (-1/3*a + 1)*b - 5/6*a + 1/2, +Infinity),
     ((1/6*a + 1/2)*b^2 + (-1/3*a + 1)*b - 5/6*a - 1/2, +Infinity),
     (-1/2*a + 1/2, 6),
     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),
     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]
**********************************************************************
File "src/sage/rings/polynomial/polynomial_quotient_ring.py", line 1535, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.units
Failed example:
    L.units()
Expected:
    [(1/2*a + 1/2, 6),
     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),
     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]
Got:
    [(-1/2*a + 1/2, 6),
     ((-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, +Infinity),
     (2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2, +Infinity)]
**********************************************************************
File "src/sage/rings/polynomial/polynomial_quotient_ring.py", line 1544, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.units
Failed example:
    L.unit_group().gens_values()
Expected:
    [-1/2*a + 1/2, (-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, 2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2]
Got:
    [1/2*a + 1/2, (-1/3*a - 1)*b^2 - 4/3*a*b - 5/6*a + 7/2, 2/3*a*b^2 + (2/3*a - 2)*b - 5/6*a - 7/2]
**********************************************************************
2 items had failures:
   3 of  18 in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.S_units
   2 of  23 in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic.units
    [451 tests, 5 failures, 2.92 s]
----------------------------------------------------------------------
sage -t --long src/sage/rings/polynomial/polynomial_quotient_ring.py  # 5 doctests failed
----------------------------------------------------------------------
```




---

archive/issue_comments_317689.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-04T16:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317689",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317690.json:
```json
{
    "body": "Not the first time, something like this has happened: #23851#comment:5\n----\nNew commits:",
    "created_at": "2018-07-04T16:58:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317690",
    "user": "saraedum"
}
```

Not the first time, something like this has happened: #23851#comment:5
----
New commits:



---

archive/issue_comments_317691.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-07-04T17:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317691",
    "user": "saraedum"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_317692.json:
```json
{
    "body": "The issue has been fixed in #23851. Since I did not change anything, I am setting this back to positive review.",
    "created_at": "2018-07-04T17:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317692",
    "user": "saraedum"
}
```

The issue has been fixed in #23851. Since I did not change anything, I am setting this back to positive review.



---

archive/issue_comments_317693.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-07-08T13:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22746#issuecomment-317693",
    "user": "vbraun"
}
```

Resolution: fixed
