# Issue 15925: (x**2+x+a).any_root() over GF(2**k) seemingly loops and cannot be interrupted

archive/issues_015925.json:
```json
{
    "body": "CC:  defeo pbruin sbesnier\n\nThis seems to only be problematic with Artin-Schreier equations.\nNo immediate issues with degree > 2 or without x in the equation.\n\nNote that the `factor` mtehod works correctly.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16162\n\n",
    "created_at": "2014-04-14T15:32:56Z",
    "labels": [
        "finite rings",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "(x**2+x+a).any_root() over GF(2**k) seemingly loops and cannot be interrupted",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15925",
    "user": "jpflori"
}
```
CC:  defeo pbruin sbesnier

This seems to only be problematic with Artin-Schreier equations.
No immediate issues with degree > 2 or without x in the equation.

Note that the `factor` mtehod works correctly.

Issue created by migration from https://trac.sagemath.org/ticket/16162





---

archive/issue_comments_206806.json:
```json
{
    "body": "Changing keywords from \"\" to \"finite field polynomial root factor\".",
    "created_at": "2014-04-15T13:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206806",
    "user": "jpflori"
}
```

Changing keywords from "" to "finite field polynomial root factor".



---

archive/issue_comments_206807.json:
```json
{
    "body": "The `any_root` should surely be refactored as well.\nThat will ease the implementation of special case more efficient methods.\n----\nNew commits:",
    "created_at": "2014-04-15T13:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206807",
    "user": "jpflori"
}
```

The `any_root` should surely be refactored as well.
That will ease the implementation of special case more efficient methods.
----
New commits:



---

archive/issue_comments_206808.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-15T13:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206808",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206809.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-15T14:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206809",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206810.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-05-16T08:48:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206810",
    "user": "jpflori"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_206811.json:
```json
{
    "body": "This looks good enough for me as a first step toward better factorization over finite fields.",
    "created_at": "2014-05-16T08:48:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206811",
    "user": "jpflori"
}
```

This looks good enough for me as a first step toward better factorization over finite fields.



---

archive/issue_comments_206812.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-16T11:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206812",
    "user": "pbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_206813.json:
```json
{
    "body": "Could you add some doctests, e.g. an example that used to fail?",
    "created_at": "2014-05-16T11:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206813",
    "user": "pbruin"
}
```

Could you add some doctests, e.g. an example that used to fail?



---

archive/issue_comments_206814.json:
```json
{
    "body": "Nice... while adding tests, I found a way to trigger segfaults.",
    "created_at": "2014-05-16T13:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206814",
    "user": "jpflori"
}
```

Nice... while adding tests, I found a way to trigger segfaults.



---

archive/issue_comments_206815.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-16T13:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206815",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206816.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-16T13:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206816",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206817.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-16T13:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206817",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206818.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-16T14:12:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206818",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206819.json:
```json
{
    "body": "Peter, please have a look at the `sig_on/sig_off` stuff.\nI'm not sure what I've done is robust or even makes sense.",
    "created_at": "2014-05-16T14:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206819",
    "user": "jpflori"
}
```

Peter, please have a look at the `sig_on/sig_off` stuff.
I'm not sure what I've done is robust or even makes sense.



---

archive/issue_comments_206820.json:
```json
{
    "body": "You should not put anything inside a `sig_on()...sig_off()` block that can interfere with the Python interpreter.  From the code it is not clear (to me) if that can happen.\n\nIs the `sig_on()...sig_off()` to prevent segfaults, to allow the code to be interrupted, or both?  If it is to prevent segfaults, you have to find out where this occurs (this can hopefully be narrowed down to pure Cython code with no calls to the Python interpreter) and wrap this as tightly as possible in `sig_on()...sig_off()`.  If it is to allow Control-C, `alarm()` etc., you can also periodically check for interrupts (I don't remember the details right now).",
    "created_at": "2014-05-16T14:58:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206820",
    "user": "pbruin"
}
```

You should not put anything inside a `sig_on()...sig_off()` block that can interfere with the Python interpreter.  From the code it is not clear (to me) if that can happen.

Is the `sig_on()...sig_off()` to prevent segfaults, to allow the code to be interrupted, or both?  If it is to prevent segfaults, you have to find out where this occurs (this can hopefully be narrowed down to pure Cython code with no calls to the Python interpreter) and wrap this as tightly as possible in `sig_on()...sig_off()`.  If it is to allow Control-C, `alarm()` etc., you can also periodically check for interrupts (I don't remember the details right now).



---

archive/issue_comments_206821.json:
```json
{
    "body": "Nope, the segfaults were surely caused by the `x**q` computation with `q = 2**50` (some overflow in NTL I'd say, but the issue might be a real one, at least now it does not happen anymore).\n\nI added the `sig_on` magic to ensure you can interrupt the code (even in some of the  `while` loops, not only because of `x**q` with large `q` stuff).\nBut it seems to me that some `sig_on` are now useless and potentially wrong as some Python code might get called at some point (in the spirit of your Python interpreter remark I guess), even if it wasn't before, maybe because of the `pow` modifications, though it does not really make sense to me.\nMaybe some of the `sig_on` should be removed, but I'd definitely say some are needed.\n\nFeel free to have a deeper look and modify the code, I won't touch that before tuesday.",
    "created_at": "2014-05-16T15:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206821",
    "user": "jpflori"
}
```

Nope, the segfaults were surely caused by the `x**q` computation with `q = 2**50` (some overflow in NTL I'd say, but the issue might be a real one, at least now it does not happen anymore).

I added the `sig_on` magic to ensure you can interrupt the code (even in some of the  `while` loops, not only because of `x**q` with large `q` stuff).
But it seems to me that some `sig_on` are now useless and potentially wrong as some Python code might get called at some point (in the spirit of your Python interpreter remark I guess), even if it wasn't before, maybe because of the `pow` modifications, though it does not really make sense to me.
Maybe some of the `sig_on` should be removed, but I'd definitely say some are needed.

Feel free to have a deeper look and modify the code, I won't touch that before tuesday.



---

archive/issue_comments_206822.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-19T13:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206822",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206823.json:
```json
{
    "body": "FYI, the segfault I got was really from:\n\n```\nsage: K.<a> = GF(2**10)\nsage: R.<x> = K[]\nsage: x**(2**33)\n```\n\n(Which really needs to ba allowed to be interrupted, and to be faster (for exp < `2**33`), and fixed of course (for exp >= `2**33`)...)",
    "created_at": "2014-05-19T13:59:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206823",
    "user": "jpflori"
}
```

FYI, the segfault I got was really from:

```
sage: K.<a> = GF(2**10)
sage: R.<x> = K[]
sage: x**(2**33)
```

(Which really needs to ba allowed to be interrupted, and to be faster (for exp < `2**33`), and fixed of course (for exp >= `2**33`)...)



---

archive/issue_comments_206824.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-19T14:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206824",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206825.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-05-19T14:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206825",
    "user": "jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_206826.json:
```json
{
    "body": "Ok, the latest commit does not seem enough to let NTL be interrupted when allocating a huge array or something like that.\nNot sure why.\n\nAnyhow, this is not necessary to fix Sage's CZ implem and can be postponed.",
    "created_at": "2014-05-19T14:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206826",
    "user": "jpflori"
}
```

Ok, the latest commit does not seem enough to let NTL be interrupted when allocating a huge array or something like that.
Not sure why.

Anyhow, this is not necessary to fix Sage's CZ implem and can be postponed.



---

archive/issue_comments_206827.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-05-21T19:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206827",
    "user": "pbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_206828.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-05-22T21:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15925#issuecomment-206828",
    "user": "vbraun"
}
```

Resolution: fixed
