# Issue 20318: descents for Permutations : cleanup

archive/issues_020318.json:
```json
{
    "body": "CC:  @hivert @tscrim @darijgr @nthiery stumpc5\n\nthe descents in permutations need a little care to behave like the\nother Coxeter groups. Let us do that.\n\nAs a benefit, the descents will now follow the usual combinatorics convention.\n\nPlus adding a new test in the testesuite of Coxeter groups.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20555\n\n",
    "created_at": "2016-05-04T12:17:33Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "descents for Permutations : cleanup",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20318",
    "user": "https://github.com/fchapoton"
}
```
CC:  @hivert @tscrim @darijgr @nthiery stumpc5

the descents in permutations need a little care to behave like the
other Coxeter groups. Let us do that.

As a benefit, the descents will now follow the usual combinatorics convention.

Plus adding a new test in the testesuite of Coxeter groups.

Issue created by migration from https://trac.sagemath.org/ticket/20555





---

archive/issue_comments_279749.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-05-04T12:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279749",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_279750.json:
```json
{
    "body": "Changing keywords from \"\" to \"permutation\".",
    "created_at": "2016-05-04T12:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279750",
    "user": "https://github.com/fchapoton"
}
```

Changing keywords from "" to "permutation".



---

archive/issue_comments_279751.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-05-04T12:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279751",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_279752.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-04T12:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279752",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_279753.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-04T14:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279753",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_279754.json:
```json
{
    "body": "There is a (very) good reason for descents of permutations to be 0-based indices: they correspond to the positions in the list, which are also 0-based, where there is a descent. This is also a perfectly valid definition and almost certainly corresponds to the initial definition of a descent. Personally I am for switching the descents convention, but this is a major backwards incompatible change that is highly likely to break personal code. Also there will not be deprecation period. Much care must be taken here.\n\nA possible way to introduce a deprecation would be to have an optional argument to `descents` for being 0-based, which is `True` by default. If this argument is `True`, then we print a deprecation warning. At the very least, this requires a posting of sage(-combinat)-devel notifying of the behavior change.",
    "created_at": "2016-05-04T14:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279754",
    "user": "https://github.com/tscrim"
}
```

There is a (very) good reason for descents of permutations to be 0-based indices: they correspond to the positions in the list, which are also 0-based, where there is a descent. This is also a perfectly valid definition and almost certainly corresponds to the initial definition of a descent. Personally I am for switching the descents convention, but this is a major backwards incompatible change that is highly likely to break personal code. Also there will not be deprecation period. Much care must be taken here.

A possible way to introduce a deprecation would be to have an optional argument to `descents` for being 0-based, which is `True` by default. If this argument is `True`, then we print a deprecation warning. At the very least, this requires a posting of sage(-combinat)-devel notifying of the behavior change.



---

archive/issue_comments_279755.json:
```json
{
    "body": "I am personally not totally convinced that this change is the right way to go - I think it is a typical example that it is simply very hard to make notions that are consistent all over sage:\n\n1. Let w be a finite word in a totally ordered alphabet,say {1,...,n}. Its descents are the positions i such that w_i > w_{i+1}. Since python indexes words (or rather lists/tuples) starting with 0, it is natural to write w = w_0 w_1 ... w_m.\n\n2. Let w be a permutation of {1,...,n}. A descent of w is an index i such that w*(i i+1) ls weak order smaller than w. But on the other hand, its one-line notation is a word, it inherits the notion of descents from above, which now differs in a shift by 1.\n\n(There are tons of other examples already in the combinatorics part of sage, and the category framework makes that *really* hard to properly organize imho.)",
    "created_at": "2016-05-04T14:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279755",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

I am personally not totally convinced that this change is the right way to go - I think it is a typical example that it is simply very hard to make notions that are consistent all over sage:

1. Let w be a finite word in a totally ordered alphabet,say {1,...,n}. Its descents are the positions i such that w_i > w_{i+1}. Since python indexes words (or rather lists/tuples) starting with 0, it is natural to write w = w_0 w_1 ... w_m.

2. Let w be a permutation of {1,...,n}. A descent of w is an index i such that w*(i i+1) ls weak order smaller than w. But on the other hand, its one-line notation is a word, it inherits the notion of descents from above, which now differs in a shift by 1.

(There are tons of other examples already in the combinatorics part of sage, and the category framework makes that *really* hard to properly organize imho.)



---

archive/issue_comments_279756.json:
```json
{
    "body": "(only now seeing that Travis also answered similarly some secs earlier...)",
    "created_at": "2016-05-04T14:15:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279756",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

(only now seeing that Travis also answered similarly some secs earlier...)



---

archive/issue_comments_279757.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-05T06:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279757",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_279758.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-05T07:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279758",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_279759.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-08T09:01:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279759",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_279760.json:
```json
{
    "body": "ok, guys. I have added a from_zero argument in the descents of permutations.\n\nGiven that our permutations are indexed by 1,...,n, I really think that there is no\ngood reason to have the descents starting at 0. But of course, one need to be user-friendly, so let us for the moment just prepare for this change.\n\nThe branch would work if I disactivate the test for descents in the testsuites for permutations.\n\nI propose to do that, and also to add a deprecation when using `from_zero=True`\neven if it looks rather strange to me to do that for a default value of the argument.\n\nAny comments ?",
    "created_at": "2016-05-08T19:36:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279760",
    "user": "https://github.com/fchapoton"
}
```

ok, guys. I have added a from_zero argument in the descents of permutations.

Given that our permutations are indexed by 1,...,n, I really think that there is no
good reason to have the descents starting at 0. But of course, one need to be user-friendly, so let us for the moment just prepare for this change.

The branch would work if I disactivate the test for descents in the testsuites for permutations.

I propose to do that, and also to add a deprecation when using `from_zero=True`
even if it looks rather strange to me to do that for a default value of the argument.

Any comments ?



---

archive/issue_comments_279761.json:
```json
{
    "body": "There are now a few testsuite failures. Beside from that, I am okay with the new procedure to handle the descents in permutations.",
    "created_at": "2016-05-09T09:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279761",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

There are now a few testsuite failures. Beside from that, I am okay with the new procedure to handle the descents in permutations.



---

archive/issue_comments_279762.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-09T11:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279762",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_279763.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-10T08:54:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279763",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_279764.json:
```json
{
    "body": "ok, patchbot is green, and ticket ready for review",
    "created_at": "2016-05-11T06:29:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279764",
    "user": "https://github.com/fchapoton"
}
```

ok, patchbot is green, and ticket ready for review



---

archive/issue_comments_279765.json:
```json
{
    "body": "A few minor questions:\n\n```\n+            for i in self.index_set():\n+                si = s[i]\n+                tester.assert_(i in si.descents(side='left'))\n+                tester.assert_(i in si.descents(side='right'))\n+                tester.assert_(i not in si.descents(positive=True, side='left'))\n+                tester.assert_(i not in si.descents(positive=True, side='right'))\n```\n\n* Is it correct to test `self.index_set`, which could in principle be different from {1,...,n}?\n* You could possibly be even more specific on the assertions, such as `[i] == si.descents(side='left')`.\n\n\n```\n+ d = [0] + self.descents(from_zero=False) + [len(self)]\n```\n\n* Isn't this `+ [len(self)]` exactly the `final_descent` flag?",
    "created_at": "2016-05-11T08:29:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279765",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

A few minor questions:

```
+            for i in self.index_set():
+                si = s[i]
+                tester.assert_(i in si.descents(side='left'))
+                tester.assert_(i in si.descents(side='right'))
+                tester.assert_(i not in si.descents(positive=True, side='left'))
+                tester.assert_(i not in si.descents(positive=True, side='right'))
```

* Is it correct to test `self.index_set`, which could in principle be different from {1,...,n}?
* You could possibly be even more specific on the assertions, such as `[i] == si.descents(side='left')`.


```
+ d = [0] + self.descents(from_zero=False) + [len(self)]
```

* Isn't this `+ [len(self)]` exactly the `final_descent` flag?



---

archive/issue_comments_279766.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-11T09:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279766",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_279767.json:
```json
{
    "body": "Thanks for having a look.\n\nI do not understand you first point.\n\nI changed the second point, but now we need to wait and see if the patchbot is still green.\n\nI changed the third point too.",
    "created_at": "2016-05-11T09:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279767",
    "user": "https://github.com/fchapoton"
}
```

Thanks for having a look.

I do not understand you first point.

I changed the second point, but now we need to wait and see if the patchbot is still green.

I changed the third point too.



---

archive/issue_comments_279768.json:
```json
{
    "body": "> I do not understand you first point.\n\nMaybe I misunderstand the `tester`, but isn't this test supposed to pass always? What if I use `index_set = ['A','B','C']`, would it still pass then with this test?\n\n\n```\ntester.assert_(i not in si.descents(positive=True, side='left'))\ntester.assert_(i not in si.descents(positive=True, side='right'))\n```\n\nIf you want, you could be also explicit in those tests.\n\nBeside those two points, I give it a positive review given the patchbot turns green.",
    "created_at": "2016-05-11T09:32:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279768",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

> I do not understand you first point.

Maybe I misunderstand the `tester`, but isn't this test supposed to pass always? What if I use `index_set = ['A','B','C']`, would it still pass then with this test?


```
tester.assert_(i not in si.descents(positive=True, side='left'))
tester.assert_(i not in si.descents(positive=True, side='right'))
```

If you want, you could be also explicit in those tests.

Beside those two points, I give it a positive review given the patchbot turns green.



---

archive/issue_comments_279769.json:
```json
{
    "body": "Concerning the first point, the very same kind of loop over self.index_set is already used in the similar method `test_has_descent` just above in the code. So in general I think we do expect descents to be elements of the index set.\n\nConcerning the second point, should I really change that ? I would prefer not to.",
    "created_at": "2016-05-11T09:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279769",
    "user": "https://github.com/fchapoton"
}
```

Concerning the first point, the very same kind of loop over self.index_set is already used in the similar method `test_has_descent` just above in the code. So in general I think we do expect descents to be elements of the index set.

Concerning the second point, should I really change that ? I would prefer not to.



---

archive/issue_comments_279770.json:
```json
{
    "body": "> So in general I think we do expect descents to be elements of the index set.\n\nI see, I was actually missing this point before.\n\n> Concerning the second point, should I really change that ? I would prefer not to.\n\nOkay, your decision.\n\nWaiting for the patchbot, and also for Travis' okay...",
    "created_at": "2016-05-11T09:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279770",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

> So in general I think we do expect descents to be elements of the index set.

I see, I was actually missing this point before.

> Concerning the second point, should I really change that ? I would prefer not to.

Okay, your decision.

Waiting for the patchbot, and also for Travis' okay...



---

archive/issue_comments_279771.json:
```json
{
    "body": "bot is green.",
    "created_at": "2016-05-11T11:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279771",
    "user": "https://github.com/fchapoton"
}
```

bot is green.



---

archive/issue_comments_279772.json:
```json
{
    "body": "Sorry for the delay in my comments. Here they are:\n\n- I think it is better to use the more explicit `tester.assertEqual` and `tester.assertNotIn` (they have better default error messages).\n- You also need to have some sort of warning message saying that the behavior of `ParkingFunction.ides` has changed.\n- Some docstring changes:\n  {{{#!diff\n         INPUT:\n \n-        - ``final_descent`` -- optional boolean (default ``False``)\n-          If ``True``, the last position of a non-empty\n-          permutation is also considered as a descent.\n+        - ``final_descent`` -- boolean (default ``False``);\n+          if ``True``, the last position of a non-empty\n+          permutation is also considered as a descent\n \n-        - ``side`` -- optional, ``'right'`` (default) or ``'left'``\n-          If ``'left'``, return the descents of the inverse permutation.\n+        - ``side`` -- ``'right'`` (default) or ``'left'``;\n+          if ``'left'``, return the descents of the inverse permutation\n \n-        - ``positive`` -- optional boolean (default ``False``)\n-          If ``True``, return the positions that are not descents.\n+        - ``positive`` -- boolean (default ``False``);\n+          if ``True``, return the positions that are not descents\n \n-        - ``from_zero`` -- optional boolean (default ``True``)\n-          If ``False``, return the positions starting from `1`\n+        - ``from_zero`` -- boolean (default ``True``);\n+          if ``False``, return the positions starting from `1`\n  }}}\n  Similarly for `idescents`.\n- Your deprecation message does not match the docstring. If `from_zero` is going to be removed, we should explicitly state in that in the docstring. Also the default behavior either will change or this argument should not be deprecated.\n\n\nAs a counterpoint, the (very) good reasons that descents start at 0 is because Python uses 0-based indexing:\n\n```\nsage: p = Permutation([5,3,2,4,1])\nsage: p.descents()\n[0, 1, 3]\nsage: p[0]\n5\n```\n\nThis would break this behavior with the current branch, and actually, thinking a bit more now about it, we should add some documentation to this point.\n(I am pretty sure the position of the descent must correspond to the position of the larger value for the related math to work, but it's been awhile since I've thought about these things.)\n\nHowever, I think with sufficient advertising on sage-devel and this deprecation, the migration should be smooth.",
    "created_at": "2016-05-11T14:24:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279772",
    "user": "https://github.com/tscrim"
}
```

Sorry for the delay in my comments. Here they are:

- I think it is better to use the more explicit `tester.assertEqual` and `tester.assertNotIn` (they have better default error messages).
- You also need to have some sort of warning message saying that the behavior of `ParkingFunction.ides` has changed.
- Some docstring changes:
  {{{#!diff
         INPUT:
 
-        - ``final_descent`` -- optional boolean (default ``False``)
-          If ``True``, the last position of a non-empty
-          permutation is also considered as a descent.
+        - ``final_descent`` -- boolean (default ``False``);
+          if ``True``, the last position of a non-empty
+          permutation is also considered as a descent
 
-        - ``side`` -- optional, ``'right'`` (default) or ``'left'``
-          If ``'left'``, return the descents of the inverse permutation.
+        - ``side`` -- ``'right'`` (default) or ``'left'``;
+          if ``'left'``, return the descents of the inverse permutation
 
-        - ``positive`` -- optional boolean (default ``False``)
-          If ``True``, return the positions that are not descents.
+        - ``positive`` -- boolean (default ``False``);
+          if ``True``, return the positions that are not descents
 
-        - ``from_zero`` -- optional boolean (default ``True``)
-          If ``False``, return the positions starting from `1`
+        - ``from_zero`` -- boolean (default ``True``);
+          if ``False``, return the positions starting from `1`
  }}}
  Similarly for `idescents`.
- Your deprecation message does not match the docstring. If `from_zero` is going to be removed, we should explicitly state in that in the docstring. Also the default behavior either will change or this argument should not be deprecated.


As a counterpoint, the (very) good reasons that descents start at 0 is because Python uses 0-based indexing:

```
sage: p = Permutation([5,3,2,4,1])
sage: p.descents()
[0, 1, 3]
sage: p[0]
5
```

This would break this behavior with the current branch, and actually, thinking a bit more now about it, we should add some documentation to this point.
(I am pretty sure the position of the descent must correspond to the position of the larger value for the related math to work, but it's been awhile since I've thought about these things.)

However, I think with sufficient advertising on sage-devel and this deprecation, the migration should be smooth.



---

archive/issue_comments_279773.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-11T16:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279773",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_279774.json:
```json
{
    "body": "Replying to [comment:26 tscrim]:\n> As a counterpoint, the (very) good reasons that descents start at 0 is because Python uses 0-based indexing:\n> {{{\n> sage: p = Permutation([5,3,2,4,1])\n> sage: p.descents()\n> [0, 1, 3]\n> sage: p[0]\n> 5\n> }}}\n> This would break this behavior with the current branch, and actually, thinking a bit more now about it, we should add some documentation to this point.\n> (I am pretty sure the position of the descent must correspond to the position of the larger value for the related math to work, but it's been awhile since I've thought about these things.)\n\nI do totally agree with the math part. But I am less convinced of the sage part:\n\n```\nsage: p = Permutation([5,3,2,4,1])\nsage: p[0]\n5\n```\n\nI would consider `p[0]` an implementation detail (as this might mean something in one-line notation, or the first cycle in cycle decomposition, or whatever else, depending on the implementation of permutations) and not a mathematically well-defined operation. In my eyes, the mathematical operation is\n\n```\nsage: p(1)\n5\n```\n\nwhich matches Fr\u00e9d\u00e9ric's indexing.",
    "created_at": "2016-05-12T08:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279774",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Replying to [comment:26 tscrim]:
> As a counterpoint, the (very) good reasons that descents start at 0 is because Python uses 0-based indexing:
> {{{
> sage: p = Permutation([5,3,2,4,1])
> sage: p.descents()
> [0, 1, 3]
> sage: p[0]
> 5
> }}}
> This would break this behavior with the current branch, and actually, thinking a bit more now about it, we should add some documentation to this point.
> (I am pretty sure the position of the descent must correspond to the position of the larger value for the related math to work, but it's been awhile since I've thought about these things.)

I do totally agree with the math part. But I am less convinced of the sage part:

```
sage: p = Permutation([5,3,2,4,1])
sage: p[0]
5
```

I would consider `p[0]` an implementation detail (as this might mean something in one-line notation, or the first cycle in cycle decomposition, or whatever else, depending on the implementation of permutations) and not a mathematically well-defined operation. In my eyes, the mathematical operation is

```
sage: p(1)
5
```

which matches Frédéric's indexing.



---

archive/issue_comments_279775.json:
```json
{
    "body": "Replying to [comment:28 stumpc5]:\n> Replying to [comment:26 tscrim]:\n> I would consider `p[0]` an implementation detail (as this might mean something in one-line notation, or the first cycle in cycle decomposition, or whatever else, depending on the implementation of permutations) and not a mathematically well-defined operation. In my eyes, the mathematical operation is\n> {{{\n> sage: p(1)\n> 5\n> }}}\n> which matches Fr\u00e9d\u00e9ric's indexing.\n\nIf you think of the permutation as an automorphism of [n], yes, but if you think of it as an ordering of [n] written as (p<sub>0</sub>, p<sub>1</sub>, ..., p<sub>n-1</sub>), then `p[i]` corresponds to p<sub>i</sub>. So it is a little more than an implementation detail. Moreover, this perspective makes the descent set independent of the index set and/or the objects we are permuting.\n\nAlso, what is both of your opinions on removing the `from_zero` option or just changing the default?\n\n`@`chapoton Thanks for the changes.",
    "created_at": "2016-05-12T23:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279775",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:28 stumpc5]:
> Replying to [comment:26 tscrim]:
> I would consider `p[0]` an implementation detail (as this might mean something in one-line notation, or the first cycle in cycle decomposition, or whatever else, depending on the implementation of permutations) and not a mathematically well-defined operation. In my eyes, the mathematical operation is
> {{{
> sage: p(1)
> 5
> }}}
> which matches Frédéric's indexing.

If you think of the permutation as an automorphism of [n], yes, but if you think of it as an ordering of [n] written as (p<sub>0</sub>, p<sub>1</sub>, ..., p<sub>n-1</sub>), then `p[i]` corresponds to p<sub>i</sub>. So it is a little more than an implementation detail. Moreover, this perspective makes the descent set independent of the index set and/or the objects we are permuting.

Also, what is both of your opinions on removing the `from_zero` option or just changing the default?

`@`chapoton Thanks for the changes.



---

archive/issue_comments_279776.json:
```json
{
    "body": "I would rather just change the default value of `from_zero`, after one year of deprecation.",
    "created_at": "2016-05-13T06:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279776",
    "user": "https://github.com/fchapoton"
}
```

I would rather just change the default value of `from_zero`, after one year of deprecation.



---

archive/issue_comments_279777.json:
```json
{
    "body": "Replying to [comment:29 tscrim]:\n> If you think of the permutation as an automorphism of [n], yes, but if you think of it as an ordering of [n] written as (p<sub>0</sub>, p<sub>1</sub>, ..., p<sub>n-1</sub>), then `p[i]` corresponds to p<sub>i</sub>. So it is a little more than an implementation detail. Moreover, this perspective makes the descent set independent of the index set and/or the objects we are permuting.\n\nA priori, one could consider the list [Travis,Fr\u00e9d\u00e9ric,Christian] a permutation, but one cannot multiply such permutations (in contrary to permutations in Sage). I think, you implicitly expect the objects to be totally ordered (that is actually also needed to define descents in the first place) and indeed in bijection with {1,...,n} or {0,...,n-1}, and the list just to be one-line notation for the bijection.\n\nI more believe our \"argument\" is closer to the surface: it is mathematically more common to start labelling with 1, so it was decided to have permutations of {1,...,n} per default instead of {0,...,n-1}, and it is pythonically more common to start labelling with 0. These two handmade choices conflict whenever they meet in the code, and one has to choose one over the other to go on.\n\nIndeed, I think it would have been better to make permutations  on {0,...,n-1} standard, and as well indexing sets. This would\n* have generally not resulted in the above conflict,\n* result in many speed improvements everywhere, see\n   {{{\n   sage: %timeit p[0]\n   1000000 loops, best of 3: 610 ns per loop\n   sage: %timeit p(1)\n   100000 loops, best of 3: 2.74 \u00b5s per loop\n   }}}\n* cleaner code as one does not always need to do the +1/-1 thing for lookups (see the code on reflection groups).\n\nBut that choice is made and not reversible, so we have to argue what to do whenever we see that conflict appearing.\n\n> Also, what is both of your opinions on removing the `from_zero` option or just changing the default?\n\nI do not have a strong opinion there, both choices have their rights to be taken. If I'd do it myself, I would maybe leave the option and make it `from_one` per default. (I would also make the name of the option the default behaviour, don't you think so?)",
    "created_at": "2016-05-13T07:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279777",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Replying to [comment:29 tscrim]:
> If you think of the permutation as an automorphism of [n], yes, but if you think of it as an ordering of [n] written as (p<sub>0</sub>, p<sub>1</sub>, ..., p<sub>n-1</sub>), then `p[i]` corresponds to p<sub>i</sub>. So it is a little more than an implementation detail. Moreover, this perspective makes the descent set independent of the index set and/or the objects we are permuting.

A priori, one could consider the list [Travis,Frédéric,Christian] a permutation, but one cannot multiply such permutations (in contrary to permutations in Sage). I think, you implicitly expect the objects to be totally ordered (that is actually also needed to define descents in the first place) and indeed in bijection with {1,...,n} or {0,...,n-1}, and the list just to be one-line notation for the bijection.

I more believe our "argument" is closer to the surface: it is mathematically more common to start labelling with 1, so it was decided to have permutations of {1,...,n} per default instead of {0,...,n-1}, and it is pythonically more common to start labelling with 0. These two handmade choices conflict whenever they meet in the code, and one has to choose one over the other to go on.

Indeed, I think it would have been better to make permutations  on {0,...,n-1} standard, and as well indexing sets. This would
* have generally not resulted in the above conflict,
* result in many speed improvements everywhere, see
   {{{
   sage: %timeit p[0]
   1000000 loops, best of 3: 610 ns per loop
   sage: %timeit p(1)
   100000 loops, best of 3: 2.74 µs per loop
   }}}
* cleaner code as one does not always need to do the +1/-1 thing for lookups (see the code on reflection groups).

But that choice is made and not reversible, so we have to argue what to do whenever we see that conflict appearing.

> Also, what is both of your opinions on removing the `from_zero` option or just changing the default?

I do not have a strong opinion there, both choices have their rights to be taken. If I'd do it myself, I would maybe leave the option and make it `from_one` per default. (I would also make the name of the option the default behaviour, don't you think so?)



---

archive/issue_comments_279778.json:
```json
{
    "body": "Since we are only wanting to change the default behavior, we should have the default value be `None` (not necessarily changing the doc), where we emit the deprecation warning in this case. That way when someone explicitly passes `True`, they don't needlessly see the deprecation warning (as their code will correctly work once we change the default behavior).\n\nAlso, do we want to call the option `from_zero` or `from_one`? It is better to make that decision here.",
    "created_at": "2016-05-13T16:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279778",
    "user": "https://github.com/tscrim"
}
```

Since we are only wanting to change the default behavior, we should have the default value be `None` (not necessarily changing the doc), where we emit the deprecation warning in this case. That way when someone explicitly passes `True`, they don't needlessly see the deprecation warning (as their code will correctly work once we change the default behavior).

Also, do we want to call the option `from_zero` or `from_one`? It is better to make that decision here.



---

archive/issue_comments_279779.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-13T18:20:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279779",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_279780.json:
```json
{
    "body": "I would rather keep `from_zero`. After the change of default value, it will be the best name in my opinion.",
    "created_at": "2016-05-15T07:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279780",
    "user": "https://github.com/fchapoton"
}
```

I would rather keep `from_zero`. After the change of default value, it will be the best name in my opinion.



---

archive/issue_comments_279781.json:
```json
{
    "body": "This LGTM. Christian?",
    "created_at": "2016-05-15T14:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279781",
    "user": "https://github.com/tscrim"
}
```

This LGTM. Christian?



---

archive/issue_comments_279782.json:
```json
{
    "body": "I still see one ```from_zero`` -- boolean (default ``True``)` which should be `(default ``None``)` and don't have a computer currently to change it. Beside that, it's good to go I think.",
    "created_at": "2016-05-15T16:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279782",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

I still see one ```from_zero`` -- boolean (default ``True``)` which should be `(default ``None``)` and don't have a computer currently to change it. Beside that, it's good to go I think.



---

archive/issue_comments_279783.json:
```json
{
    "body": "None is a technical detail. It does indeed default to True",
    "created_at": "2016-05-15T16:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279783",
    "user": "https://github.com/fchapoton"
}
```

None is a technical detail. It does indeed default to True



---

archive/issue_comments_279784.json:
```json
{
    "body": "The default \"is\" `True`, it's just we need the actual to be `None` for technical reasons (the deprecation warning).",
    "created_at": "2016-05-15T16:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279784",
    "user": "https://github.com/tscrim"
}
```

The default "is" `True`, it's just we need the actual to be `None` for technical reasons (the deprecation warning).



---

archive/issue_comments_279785.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-05-15T16:33:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279785",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_279786.json:
```json
{
    "body": "Well, okay then...",
    "created_at": "2016-05-15T16:33:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279786",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Well, okay then...



---

archive/issue_events_019294.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2016-05-19T22:38:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20318#event-19294"
}
```



---

archive/issue_comments_279787.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-05-19T22:38:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20318#issuecomment-279787",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
