# Issue 34442: giac should be compiled without --disable-gui

Issue created by migration from https://trac.sagemath.org/ticket/34679

Original creator: parisse

Original creation time: 2022-10-20 11:51:53

CC:  slelievre

(I apologize if this ticket is not formatted correctly, never done one before).
The reason given for disabling GUI was that an incompatible old versions of FLTK could stop the compilation. This should not be a concern anymore now.
This would provide a standard compilation path for Giac/Xcas on systems where it is not packaged (I especially need this in an educationnal context for French maths teacher recruitement). 

Actions required: 
1/ remove --disable-gui in build/pkgs/giac/spkg-install.in
2/ For current giac source, in the files: src/Makefile.am and src/Makefile.in, in the executable aide dependencies, libgiac.la should be replaced by libxcas.la. The next release of giac 1.9.0-23 (planned next week) will include these fixes.

Thanks in advance!


---

Comment by @sheerluck created at 2022-10-20 17:21:07

but when in docker we need `--disable-gui`


---

Comment by chapoton created at 2022-10-21 06:42:41

here is a branch just removing `--disable-gui`

someone else must add the required patch changing Makefiles ; or wait for thr upgrade in #34583
----
New commits:


---

Comment by parisse created at 2022-10-23 20:38:23

I have released giac-1.9.0-25 this evening. Changes related to this problem:
1/ src/Makefile.am, src/Makefile.in: aide did not link correctly in some situations, I changed dependencies from libgiac.la to libxcas.la
2/ giac will now detect if fltk headers are installed, if not it will compile fltk-1.3.8 (included) statically and link against the compiled fltk static libraries.


---

Comment by mkoeppe created at 2022-11-12 03:27:51

With #34583, you can now use `export GIAC_CONFIGURE="--enable-fltk"` to override our default `--disable-fltk`.


---

Comment by parisse created at 2022-11-17 09:51:07

I'm afraid this will *not* solve my original problem. The guys who say it's too complicated to compile Xcas will most probably not consider running an export command before compiling sage.

Why not make the default inside sage *with* FLTK enabled and ask users who do not want the GUI to run export GIAC_CONFIGURE="--disable-fltk" ? 

The GUI can now be run inside giac/icas (type xcas at the prompt), and there you can access to some features like tracemode on functions/parametric plots : a cursor is displayed on the curve, with the value of t, x, y, tangent slope, curve radius, osculating circle, you can move the cursor interactively, and also find nearest roots/extrema/intersection/inflexion points ...

Thanks!


---

Comment by dimpase created at 2022-12-11 17:38:18

Replying to [comment:5 Bernard Parisse]:
> I'm afraid this will *not* solve my original problem. The guys who say it's too complicated to compile Xcas will most probably not consider running an export command before compiling sage.
> 
> Why not make the default inside sage *with* FLTK enabled and ask users who do not want the GUI to run export GIAC_CONFIGURE="--disable-fltk" ? 
> 
> The GUI can now be run inside giac/icas (type xcas at the prompt), and there you can access to some features like tracemode on functions/parametric plots : a cursor is displayed on the curve, with the value of t, x, y, tangent slope, curve radius, osculating circle, you can move the cursor interactively, and also find nearest roots/extrema/intersection/inflexion points ...


let's test and see how it goes. By the way, is there a new version of giac available?


---

Comment by dimpase created at 2022-12-11 17:41:43

By the way, giac as packages on Fedora 34 doesn't seem to want to report its version:

```
$ giac --version
// Using locale /usr/share/locale/
// en_GB.UTF-8
// /usr/share/locale/
// giac
// UTF-8
// Maximum number of parallel threads 16
Can't open display: localhost:10.0
```

is it due to it built with GUI enabled?


---

Comment by dimpase created at 2022-12-11 18:39:53

On Fedora 34 and this patch, build errors out with

```
libtool: link: (cd ".libs" && rm -f "libgiac.so.0" && ln -s "libgiac.so.0.0.0" "libgiac.so.0")
libtool: link: (cd ".libs" && rm -f "libgiac.so" && ln -s "libgiac.so.0.0.0" "libgiac.so")
libtool: link: ( cd ".libs" && rm -f "libgiac.la" && ln -s "../libgiac.la" "libgiac.la" )
/usr/local/bin/bash ../libtool  --tag=CXX   --mode=link g++ -std=gnu++11  -g -O2 -g -O2 -std=gnu++11 -fno-strict-aliasing -DGIAC_GENERIC_CONSTANTS -DTIMEOUT -
no-undefined -Wl,-rpath-link,/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/lib -L/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/lib -Wl
,-rpath,/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/lib -Wl,-rpath-link,/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/lib -L/home/sc
ratch/scratch2/dimpase/sage/sagetrac-mirror/local/lib -Wl,-rpath,/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/lib  -o libxcas.la  History.lo Inpu
t.lo Xcas1.lo Equation.lo Print.lo Tableur.lo Editeur.lo Graph.lo Graph3d.lo Help1.lo Cfg.lo Flv_CStyle.lo Flve_Check_Button.lo Flve_Input.lo Flv_Style.lo Flv
_Data_Source.lo Flve_Combo.lo Flv_List.lo Flv_Table.lo gl2ps.lo Python.lo libgiac.la -lfltk_images -ljpeg -lpng -lz -lfltk -lfltk_gl -lXext -lXft -lfontconfig
 -lXinerama -lX11 -lGL -lcurl -lglpk -ldl -lm -lecm -lmpfi -lmpfr -lgmp   -lrt -lpthread -lnauty -lcliquer -lcurl -lglpk -ldl -lm -lecm -lmpfi -lmpfr -lgmp 
/usr/local/bin/bash ../libtool  --tag=CXX   --mode=link g++ -std=gnu++11  -g -O2 -g -O2 -std=gnu++11 -fno-strict-aliasing -DGIAC_GENERIC_CONSTANTS -DTIMEOUT -
no-undefined -Wl,-rpath-link,/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/lib -L/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/lib -Wl
,-rpath,/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/lib -Wl,-rpath-link,/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/lib -L/home/sc
ratch/scratch2/dimpase/sage/sagetrac-mirror/local/lib -Wl,-rpath,/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/lib  -o aide aide.o libgiac.la -lre
adline -lncurses -lcurl -lglpk -ldl -lm -lecm -lmpfi -lmpfr -lgmp  -lgsl -lm -lopenblas  -lopenblas  -lrt -lpthread -lnauty -lcliquer -lcurl -lglpk -ldl -lm -
lecm -lmpfi -lmpfr -lgmp 
libtool: link: g++ -std=gnu++11 -g -O2 -g -O2 -std=gnu++11 -fno-strict-aliasing -DGIAC_GENERIC_CONSTANTS -DTIMEOUT -Wl,-rpath-link -Wl,/home/scratch/scratch2/
dimpase/sage/sagetrac-mirror/local/lib -Wl,-rpath -Wl,/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/lib -Wl,-rpath-link -Wl,/home/scratch/scratch2
/dimpase/sage/sagetrac-mirror/local/lib -Wl,-rpath -Wl,/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/lib -o .libs/aide aide.o  -L/home/scratch/scr
atch2/dimpase/sage/sagetrac-mirror/local/lib ./.libs/libgiac.so -lntl -lpari -lreadline -lncurses -lgsl -lopenblas -lrt -lpthread -lnauty -lcliquer -lcurl -lglpk -ldl -lm -lecm -lmpfi -lmpfr -lgmp -Wl,-rpath -Wl,/home/scratch/scratch2/dimpase/sage/sagetrac-mirror/local/lib
libtool: link: ar cr .libs/libxcas.a .libs/History.o .libs/Input.o .libs/Xcas1.o .libs/Equation.o .libs/Print.o .libs/Tableur.o .libs/Editeur.o .libs/Graph.o .libs/Graph3d.o .libs/Help1.o .libs/Cfg.o .libs/Flv_CStyle.o .libs/Flve_Check_Button.o .libs/Flve_Input.o .libs/Flv_Style.o .libs/Flv_Data_Source.o .libs/Flve_Combo.o .libs/Flv_List.o .libs/Flv_Table.o .libs/gl2ps.o .libs/Python.o 
libtool: link: ranlib .libs/libxcas.a
/usr/bin/ld: ./.libs/libgiac.so: undefined reference to `png_create_info_struct'
/usr/bin/ld: ./.libs/libgiac.so: undefined reference to `png_create_write_struct'
/usr/bin/ld: ./.libs/libgiac.so: undefined reference to `png_set_longjmp_fn'
/usr/bin/ld: ./.libs/libgiac.so: undefined reference to `png_set_IHDR'
/usr/bin/ld: ./.libs/libgiac.so: undefined reference to `png_write_image'
/usr/bin/ld: ./.libs/libgiac.so: undefined reference to `png_write_info'
/usr/bin/ld: ./.libs/libgiac.so: undefined reference to `png_write_end'
/usr/bin/ld: ./.libs/libgiac.so: undefined reference to `png_init_io'
collect2: error: ld returned 1 exit status
make[5]: *** [Makefile:784: aide] Error 1
```



---

Comment by dimpase created at 2022-12-11 18:44:17

Changing status from new to needs_review.


---

Comment by dimpase created at 2022-12-11 18:45:47

Changing status from needs_review to needs_work.
