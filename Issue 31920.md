# Issue 31920: Small improvements for ppl backend

archive/issues_031920.json:
```json
{
    "body": "CC:  @jplab @mkoeppe @yuan-zhou\n\nWe remove some code duplications in the ppl backend. Along the way we also allow initialization from `ppl_polyhedron`. This saves almost all the time, when extending base ring to `QQ`:\n\nBefore:\n\n\n```\nsage: %time P = polytopes.permutahedron(7)                                                                                                                                                                                                                                                                                                                                 \nCPU times: user 1.51 s, sys: 19.8 ms, total: 1.53 s\nWall time: 1.52 s\nsage: %time P.base_extend(QQ)                                                                                                                                                                                                                                                                                                                                              \nCPU times: user 1.17 s, sys: 7.78 ms, total: 1.18 s\nWall time: 1.18 s\nA 6-dimensional polyhedron in QQ^7 defined as the convex hull of 5040 vertices\n```\n\n\nAfter:\n\n\n```\nsage: %time P = polytopes.permutahedron(7)                                                                                                                                                                                                                                                                                                                                 \nCPU times: user 1.5 s, sys: 23.4 ms, total: 1.52 s\nWall time: 1.52 s\nsage: %time P.base_extend(QQ)                                                                                                                                                                                                                                                                                                                                              \nCPU times: user 177 ms, sys: 50 \u00b5s, total: 177 ms\nWall time: 176 ms\nA 6-dimensional polyhedron in QQ^7 defined as the convex hull of 5040 vertices\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/32157\n\n",
    "created_at": "2021-07-07T21:12:38Z",
    "labels": [
        "geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Small improvements for ppl backend",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31920",
    "user": "@kliem"
}
```
CC:  @jplab @mkoeppe @yuan-zhou

We remove some code duplications in the ppl backend. Along the way we also allow initialization from `ppl_polyhedron`. This saves almost all the time, when extending base ring to `QQ`:

Before:


```
sage: %time P = polytopes.permutahedron(7)                                                                                                                                                                                                                                                                                                                                 
CPU times: user 1.51 s, sys: 19.8 ms, total: 1.53 s
Wall time: 1.52 s
sage: %time P.base_extend(QQ)                                                                                                                                                                                                                                                                                                                                              
CPU times: user 1.17 s, sys: 7.78 ms, total: 1.18 s
Wall time: 1.18 s
A 6-dimensional polyhedron in QQ^7 defined as the convex hull of 5040 vertices
```


After:


```
sage: %time P = polytopes.permutahedron(7)                                                                                                                                                                                                                                                                                                                                 
CPU times: user 1.5 s, sys: 23.4 ms, total: 1.52 s
Wall time: 1.52 s
sage: %time P.base_extend(QQ)                                                                                                                                                                                                                                                                                                                                              
CPU times: user 177 ms, sys: 50 Âµs, total: 177 ms
Wall time: 176 ms
A 6-dimensional polyhedron in QQ^7 defined as the convex hull of 5040 vertices
```


Issue created by migration from https://trac.sagemath.org/ticket/32157





---

archive/issue_comments_456026.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-07T21:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31920#issuecomment-456026",
    "user": "@kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_456027.json:
```json
{
    "body": "This is a preliminary for two things:\n\n- Allowing lazy computation of Hrepresentation and Vrepresentation\n- Have interactive backends (add generator/add constraint).",
    "created_at": "2021-07-07T21:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31920#issuecomment-456027",
    "user": "@kliem"
}
```

This is a preliminary for two things:

- Allowing lazy computation of Hrepresentation and Vrepresentation
- Have interactive backends (add generator/add constraint).



---

archive/issue_comments_456028.json:
```json
{
    "body": "Why is the `_element_constructor_polyhedron` only needed for `Polyhedra_QQ_ppl` but not `Polyhedra_ZZ_ppl`?",
    "created_at": "2021-07-08T01:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31920#issuecomment-456028",
    "user": "@mkoeppe"
}
```

Why is the `_element_constructor_polyhedron` only needed for `Polyhedra_QQ_ppl` but not `Polyhedra_ZZ_ppl`?



---

archive/issue_comments_456029.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-08T12:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31920#issuecomment-456029",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_456030.json:
```json
{
    "body": "\n```\n+\n+        See :class:`Polyhedron_normaliz` for a description of the input\n+        data.\n+\n```\n\nshould be ...ppl",
    "created_at": "2021-07-08T14:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31920#issuecomment-456030",
    "user": "@mkoeppe"
}
```


```
+
+        See :class:`Polyhedron_normaliz` for a description of the input
+        data.
+
```

should be ...ppl



---

archive/issue_comments_456031.json:
```json
{
    "body": "We forgot to do this in the normaliz and polymake backends, but now that mutability is coming into play I think it's crucial to clarify object ownership: Does the normaliz cone / polymake polytope / ppl polyhedron belong to the created Polyhedron object?",
    "created_at": "2021-07-08T14:40:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31920#issuecomment-456031",
    "user": "@mkoeppe"
}
```

We forgot to do this in the normaliz and polymake backends, but now that mutability is coming into play I think it's crucial to clarify object ownership: Does the normaliz cone / polymake polytope / ppl polyhedron belong to the created Polyhedron object?



---

archive/issue_comments_456032.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-08T15:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31920#issuecomment-456032",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_456033.json:
```json
{
    "body": "Replying to [comment:6 mkoeppe]:\n> We forgot to do this in the normaliz and polymake backends, but now that mutability is coming into play I think it's crucial to clarify object ownership: Does the normaliz cone / polymake polytope / ppl polyhedron belong to the created Polyhedron object?\n\nYes, I think so. I don't know what exact consequences this has. Do we make a copy, when initializing with a cone etc?\n\nAs long as everything is immutable, it's fine to have multiple polyhedra with the same cone. However, once things are mutable, that should be taken care of.",
    "created_at": "2021-07-08T15:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31920#issuecomment-456033",
    "user": "@kliem"
}
```

Replying to [comment:6 mkoeppe]:
> We forgot to do this in the normaliz and polymake backends, but now that mutability is coming into play I think it's crucial to clarify object ownership: Does the normaliz cone / polymake polytope / ppl polyhedron belong to the created Polyhedron object?

Yes, I think so. I don't know what exact consequences this has. Do we make a copy, when initializing with a cone etc?

As long as everything is immutable, it's fine to have multiple polyhedra with the same cone. However, once things are mutable, that should be taken care of.



---

archive/issue_comments_456034.json:
```json
{
    "body": "Replying to [comment:8 gh-kliem]:\n> Replying to [comment:6 mkoeppe]:\n> > We forgot to do this in the normaliz and polymake backends, but now that mutability is coming into play I think it's crucial to clarify object ownership: Does the normaliz cone / polymake polytope / ppl polyhedron belong to the created Polyhedron object?\n> \n> Yes, I think so. I don't know what exact consequences this has. Do we make a copy, when initializing with a cone etc?\n\nIf it is clarified that ownership transfers to the new object, then no copy needs to be made.",
    "created_at": "2021-07-08T15:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31920#issuecomment-456034",
    "user": "@mkoeppe"
}
```

Replying to [comment:8 gh-kliem]:
> Replying to [comment:6 mkoeppe]:
> > We forgot to do this in the normaliz and polymake backends, but now that mutability is coming into play I think it's crucial to clarify object ownership: Does the normaliz cone / polymake polytope / ppl polyhedron belong to the created Polyhedron object?
> 
> Yes, I think so. I don't know what exact consequences this has. Do we make a copy, when initializing with a cone etc?

If it is clarified that ownership transfers to the new object, then no copy needs to be made.



---

archive/issue_comments_456035.json:
```json
{
    "body": "Yes this makes sense. When giving a cone to a normaliz polyhedron, I would usually assume that it may be modified. If the polyhedron is mutable, this mean actual modification and not just computing stuff.",
    "created_at": "2021-07-08T15:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31920#issuecomment-456035",
    "user": "@kliem"
}
```

Yes this makes sense. When giving a cone to a normaliz polyhedron, I would usually assume that it may be modified. If the polyhedron is mutable, this mean actual modification and not just computing stuff.



---

archive/issue_comments_456036.json:
```json
{
    "body": "Right, and on the other hand it would be an error if the user continues to modify the object that now belongs to the polyhedron.",
    "created_at": "2021-07-08T16:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31920#issuecomment-456036",
    "user": "@mkoeppe"
}
```

Right, and on the other hand it would be an error if the user continues to modify the object that now belongs to the polyhedron.



---

archive/issue_comments_456037.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-17T21:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31920#issuecomment-456037",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_456038.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-24T15:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31920#issuecomment-456038",
    "user": "@vbraun"
}
```

Resolution: fixed
