# Issue 31920: Small improvements for ppl backend

Issue created by migration from https://trac.sagemath.org/ticket/32157

Original creator: @kliem

Original creation time: 2021-07-07 21:12:38

CC:  jipilab mkoeppe yzh

We remove some code duplications in the ppl backend. Along the way we also allow initialization from `ppl_polyhedron`. This saves almost all the time, when extending base ring to `QQ`:

Before:


```
sage: %time P = polytopes.permutahedron(7)                                                                                                                                                                                                                                                                                                                                 
CPU times: user 1.51 s, sys: 19.8 ms, total: 1.53 s
Wall time: 1.52 s
sage: %time P.base_extend(QQ)                                                                                                                                                                                                                                                                                                                                              
CPU times: user 1.17 s, sys: 7.78 ms, total: 1.18 s
Wall time: 1.18 s
A 6-dimensional polyhedron in QQ^7 defined as the convex hull of 5040 vertices
```


After:


```
sage: %time P = polytopes.permutahedron(7)                                                                                                                                                                                                                                                                                                                                 
CPU times: user 1.5 s, sys: 23.4 ms, total: 1.52 s
Wall time: 1.52 s
sage: %time P.base_extend(QQ)                                                                                                                                                                                                                                                                                                                                              
CPU times: user 177 ms, sys: 50 Âµs, total: 177 ms
Wall time: 176 ms
A 6-dimensional polyhedron in QQ^7 defined as the convex hull of 5040 vertices
```



---

Comment by @kliem created at 2021-07-07 21:12:46

Changing status from new to needs_review.


---

Comment by @kliem created at 2021-07-07 21:14:21

This is a preliminary for two things:

- Allowing lazy computation of Hrepresentation and Vrepresentation
- Have interactive backends (add generator/add constraint).


---

Comment by mkoeppe created at 2021-07-08 01:09:04

Why is the `_element_constructor_polyhedron` only needed for `Polyhedra_QQ_ppl` but not `Polyhedra_ZZ_ppl`?


---

Comment by git created at 2021-07-08 12:38:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-07-08 14:36:03


```
+
+        See :class:`Polyhedron_normaliz` for a description of the input
+        data.
+
```

should be ...ppl


---

Comment by mkoeppe created at 2021-07-08 14:40:07

We forgot to do this in the normaliz and polymake backends, but now that mutability is coming into play I think it's crucial to clarify object ownership: Does the normaliz cone / polymake polytope / ppl polyhedron belong to the created Polyhedron object?


---

Comment by git created at 2021-07-08 15:02:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2021-07-08 15:04:08

Replying to [comment:6 mkoeppe]:
> We forgot to do this in the normaliz and polymake backends, but now that mutability is coming into play I think it's crucial to clarify object ownership: Does the normaliz cone / polymake polytope / ppl polyhedron belong to the created Polyhedron object?

Yes, I think so. I don't know what exact consequences this has. Do we make a copy, when initializing with a cone etc?

As long as everything is immutable, it's fine to have multiple polyhedra with the same cone. However, once things are mutable, that should be taken care of.


---

Comment by mkoeppe created at 2021-07-08 15:40:28

Replying to [comment:8 gh-kliem]:
> Replying to [comment:6 mkoeppe]:
> > We forgot to do this in the normaliz and polymake backends, but now that mutability is coming into play I think it's crucial to clarify object ownership: Does the normaliz cone / polymake polytope / ppl polyhedron belong to the created Polyhedron object?
> 
> Yes, I think so. I don't know what exact consequences this has. Do we make a copy, when initializing with a cone etc?

If it is clarified that ownership transfers to the new object, then no copy needs to be made.


---

Comment by @kliem created at 2021-07-08 15:42:44

Yes this makes sense. When giving a cone to a normaliz polyhedron, I would usually assume that it may be modified. If the polyhedron is mutable, this mean actual modification and not just computing stuff.


---

Comment by mkoeppe created at 2021-07-08 16:44:51

Right, and on the other hand it would be an error if the user continues to modify the object that now belongs to the polyhedron.


---

Comment by mkoeppe created at 2021-07-17 21:08:20

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-07-24 15:28:09

Resolution: fixed
