# Issue 14302: Echelonize leads to wrong multiplication

Issue created by migration from Trac.

Original creator: mraum

Original creation time: 2013-04-29 14:43:59

Assignee: jason, was

CC:  rbeezer was

Load the two matrices that I have attached and run the following code to see that the second row of the second matrix is not updated correctly.

```
sage: (a, b) = load("tst.sobj")
sage: a.transpose() * b
[                        0                         1                        24                       324                      3200                     25650                    176256                   1073720                   5930496                  30178575                 143184000                 639249300                2705114880               10916609264               42224364768              157237849404              565928955336             1975748911989             6712360813296            22258958382384            72248546142576           230126686576596           720999820523680          2226607404115308          6790183423299432         20478994820181329         61157329008540264        181004375431019448        531238661914490832       1546662807633726456       4467428806660680816      12801302700703268916      36384312930487005696     102550540165931773881     286559332427090336280     793661555641170811488    2178228257908531278912    5922967390221653096898   15954542776854757733856   42569726135569471713636  112504969550911913199256  294509000583368778593058  763659353026853825886576 1961586226496587115127844 4991900581029733007609328]
sage: (b.transpose() * a).transpose()
[0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
```


The following works correctly. To me this indicates that the internal representation is somehow not updated correctly.

```
sage: (a, b) = load("tst.sobj")
sage: b = copy(b)           
sage: a.transpose() * b
[0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
```


I make this a critical ticket. But the actual mistake seems so dangerous and it results from a common operation, so that it is a candidate for a blocker.


---

Attachment


---

Comment by darij created at 2014-11-12 08:39:24

Changing keywords from "" to "linear algebra, echelonize, cache, mutation".


---

Comment by darij created at 2014-11-12 08:39:24

The mistake is in the fact that echelonizing a rational matrix in place does not clear the `clear_denom` value of its cache. Fixed. Experiments seem to suggest that other matrix types don't suffer from this bug, but I'd rather see someone doublecheck this (I don't understand the really low-level parts of the code).
----
New commits:


---

Comment by darij created at 2014-11-12 08:39:24

Changing status from new to needs_review.


---

Comment by git created at 2014-11-12 08:41:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2014-11-12 09:18:12

Actually, maybe I should have added that `self._clear_cache()` to the underscored methods?


---

Comment by git created at 2014-11-12 18:56:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-11-17 00:14:39

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2014-11-17 00:14:39

LGTM.


---

Comment by darij created at 2014-11-17 00:15:45

Thank you!!


---

Comment by vbraun created at 2014-11-17 21:21:54

Resolution: fixed
