# Issue 16598: cartesian product of ModulesWithBasis not in ModulesWithBasis

Issue created by migration from https://trac.sagemath.org/ticket/16835

Original creator: cnassau

Original creation time: 2014-08-15 22:36:08

CC:  nthiery


```
sage: X=CombinatorialFreeModule(RDF,ZZ,category=ModulesWithBasis(RDF))
sage: Y=cartesian_product((X,X))
sage: X in ModulesWithBasis(RDF)
True
sage: Y in ModulesWithBasis(RDF)
False
sage: Y.categories()[1]
Category of modules with basis over Real Double Field
sage: Y.categories()[1] is ModulesWithBasis(RDF)
False
```


This weirdness relates to the fact that `ModulesWithBasis(RDF)` prints as the `Category of vector spaces with basis over Real Double Field`. The `Category of modules with basis over Real Double Field` is one of its super categories.

In the case at hand I cannot construct a morphism from `Y` to `X` because of the category mismatch:

```
sage: Y.module_morphism(codomain=X,on_basis=lambda (i,j):X.monomial(i))
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
..
ValueError: Free module generated by Integer Ring over Real Double Field (+) Free module generated by Integer Ring over Real Double Field is not in Category of vector spaces with basis over Real Double Field
```






---

Comment by cnassau created at 2014-08-16 05:38:03

For the same reason this also fails:

```
sage: -Y.an_element()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: Free module generated by Integer Ring over Real Double Field (+) Free module generated by Integer Ring over Real Double Field is not in Category of vector spaces with basis over Real Double Field
```



---

Comment by cnassau created at 2014-08-16 11:19:12

New commits:


---

Comment by git created at 2014-08-16 11:32:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-08-16 11:34:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cnassau created at 2014-08-16 11:36:25

Changing status from new to needs_review.


---

Comment by cnassau created at 2014-08-16 11:38:57

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-08-16 12:05:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cnassau created at 2014-08-16 12:09:06

Changing status from needs_work to needs_review.


---

Comment by cnassau created at 2014-08-16 12:09:06

I've also had to change half a dozen unrelated files that had doctests to make sure that vector spaces had neither tensor product nor cartesian products. 

The idea to document a snapshot of the current category graph in doctests that are spread out all over the place is not very good: it makes fixing things painful, and it doesn't prevent serious bugs [as this and other category related tickets show].


---

Comment by cnassau created at 2014-09-10 07:13:25

Changing priority from major to blocker.


---

Comment by cnassau created at 2014-09-10 07:13:25

I've changed the priority to make sure this issue gets addressed in the next release.


---

Comment by tscrim created at 2014-09-10 07:52:54

Changing priority from blocker to major.


---

Comment by tscrim created at 2014-09-10 07:52:54

Not a blocker, but this has been on my todo list. I hope to get to this next week.


---

Comment by tscrim created at 2014-09-14 16:58:15

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2014-09-14 16:58:15

LGTM. Although I've made a few trivial line break changes.

BTW, we all want our bugs (and tickets) addressed/reviewed quickly. As a courtesy, please don't set things to blocker trying to get yours looked at. Instead you can cc me (or other who might be good for reviewing it) and I'll look at it as soon as I can.
----
New commits:


---

Comment by cnassau created at 2014-09-14 21:53:53

Thanks very much for taking the time to review this issue!

Replying to [comment:11 tscrim]:
> BTW, we all want our bugs (and tickets) addressed/reviewed quickly. As a courtesy, please don't set things to blocker trying to get yours looked at. Instead you can cc me (or other who might be good for reviewing it) and I'll look at it as soon as I can.

Actually, my intention was not to get it reviewed quickly, just to make sure it gets adressed at all in the next release. 


> ----
> New commits:
> ||[da19932](http://git.sagemath.org/sage.git/commit/?id=da19932c0f2847e27b5cb9225d056f7b37251c68)||`Merge branch 'u/cnassau/16835' of trac.sagemath.org:sage into u/tscrim/product_modules_with_basis-16835`||
> ||[4e52d99](http://git.sagemath.org/sage.git/commit/?id=4e52d992d0e4ea3480fb3f538325c8a602c84047)||`Added some line breaks.`||


---

Comment by vbraun created at 2014-09-16 18:46:58

Resolution: fixed
