# Issue 26833: Upgrade to Cysignals 1.9.0

Issue created by migration from https://trac.sagemath.org/ticket/27070

Original creator: slelievre

Original creation time: 2019-01-17 06:04:01

CC:  arojas embray fbissey @timokau infinity0 jdemeyer slelievre thansen

Keywords: upgrade, cysignals

This ticket is to upgrade to Cysignals 1.9.0.

- Tarball: https://files.pythonhosted.org/packages/6c/29/ddd51b4f514ce7c554758eab63995024136f257f3d33ae14527d7d75705d/cysignals-1.9.0.tar.gz


---

Comment by embray created at 2019-01-18 10:40:54

Changing type from PLEASE CHANGE to enhancement.


---

Comment by jdemeyer created at 2019-01-18 13:12:58

Fine for me if somebody wants to do this, but there is no real reason for this upgrade. I mainly made the new release to answer to a Python bug.


---

Comment by jdemeyer created at 2019-03-10 21:37:35

New commits:


---

Comment by jdemeyer created at 2019-03-10 21:37:35

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2019-03-11 11:22:48

Changing priority from major to blocker.


---

Comment by @timokau created at 2019-03-11 18:24:17

Why is this a blocker?


---

Comment by tscrim created at 2019-03-11 22:31:38

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-03-11 22:31:38

I am not entirely sure. However, I am sending this off to the buildbots, so it is somewhat moot (but it would still be good to have an answer Jeroen `;)`).


---

Comment by jdemeyer created at 2019-03-11 23:02:57

It's a blocker because it fixes #27384


---

Comment by jdemeyer created at 2019-03-12 09:54:52

This is failing to build on OS X on conda-forge: https://github.com/conda-forge/cysignals-feedstock/pull/19 (despite cysignals on OS X being tested on Travis CI).


---

Comment by jdemeyer created at 2019-03-12 09:54:52

Changing status from positive_review to needs_work.


---

Comment by embray created at 2019-03-12 11:27:46

Replying to [comment:10 jdemeyer]:
> It's a blocker because it fixes #27384

Which itself is not really a blocker (though it is a bad issue) except to the extent that it's a prerequisite to fixing #27214 which could also be argued is not a blocker, but it is a pretty severe problem the more and more I look at it.


---

Comment by embray created at 2019-03-12 11:32:09

Since the build problem is just a question of building the tests on clang do we really care about that here, or do you need to make a 1.10.1?


---

Comment by jdemeyer created at 2019-03-12 12:33:50

Replying to [comment:14 embray]:
> Since the build problem is just a question of building the tests on clang do we really care about that here, or do you need to make a 1.10.1?

We do care if the problem with conda-forge also exists on the computers of Sage users. At this point, I don't know if the build failure is specific to Conda (and I guess it's not).


---

Comment by embray created at 2019-03-12 12:49:00

Okay, I just wasn't sure if the tests were built by default.  But if so then that's a reasonable caution I suppose.


---

Comment by git created at 2019-03-12 20:09:20

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2019-03-12 20:13:00

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2019-03-13 09:06:24

I'm getting this with 1.10.0 on OSX, please check before setting back to positive review:

```
[fpylll-0.4.1dev]     In file included from build/src/fpylll/fplll/integer_matrix.cpp:697:
[fpylll-0.4.1dev]     In file included from /Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals/struct_signals.h:45:
[fpylll-0.4.1dev]     /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/clang/10.0.0/include/stdatomic.h:75:26: error: reference to 'memory_order' is ambiguous
[fpylll-0.4.1dev]     void atomic_thread_fence(memory_order);
[fpylll-0.4.1dev]                              ^
[fpylll-0.4.1dev]     /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/clang/10.0.0/include/stdatomic.h:68:3: note: candidate found by name lookup is 'memory_order'
[fpylll-0.4.1dev]     } memory_order;
[fpylll-0.4.1dev]       ^
[fpylll-0.4.1dev]     /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1/atomic:588:3: note: candidate found by name lookup is 'std::__1::memory_order'
[fpylll-0.4.1dev]     } memory_order;
[fpylll-0.4.1dev]       ^
```



---

Comment by vbraun created at 2019-03-13 09:06:24

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2019-03-13 14:58:24

Which OS X machine is that? I cannot reproduce it on your `osx.fritz.box` (I tried cysignals-1.10.*1* but probably that doesn't make a difference for this error).


---

Comment by vbraun created at 2019-03-13 18:37:33

Yes, that one. Whats the compiler invocation? I have

```
    gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals -I/Users/buildslave-sage/slave/sage_git/build/local/include -I/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/core/include -I/Users/buildslave-sage/slave/sage_git/build/local/include/python2.7 -c build/src/fpylll/fplll/integer_matrix.cpp -o build/temp.macosx-10.9-x86_64-2.7/build/src/fpylll/fplll/integer_matrix.o -std=c++11
```



---

Comment by vbraun created at 2019-03-13 18:44:09

You built sage's gcc, the buildbot doesn't and runs XCode clang


---

Comment by jhpalmieri created at 2019-03-13 20:30:55

I get the same error on OS X (not building Sage's gcc).


---

Comment by jdemeyer created at 2019-03-14 08:58:35

Confirmed indeed with clang.


---

Comment by jdemeyer created at 2019-03-14 09:12:43

The problem is essentially that this doesn't compile:

```
using namespace std;
#include <atomic>
#include <stdatomic.h>
```



---

Comment by git created at 2019-03-14 14:04:54

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-03-14 14:11:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2019-03-14 14:12:10

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2019-03-14 14:23:50

I tested on that OS X machine that the cysignals test suite passes and that Sage builds.


---

Comment by embray created at 2019-03-14 14:47:54

I'm going to test this on Cygwin in a few minutes, but I don't expect any problems.


---

Comment by embray created at 2019-03-14 17:30:05

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-03-15 08:09:45

Resolution: fixed
