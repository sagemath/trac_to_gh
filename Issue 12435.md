# Issue 12435: ChainComplex reports zero homology groups (depending on ChomP)

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2012-02-29 05:12:05

Assignee: jhpalmieri

CC:  jhpalmieri kini dunfield

As reported on https://groups.google.com/d/msg/sage-release/gW9IsTBrVII/eGL-ih824vAJ, whether or not ChomP is installed changes the output of `ChainComplex.homology` by trivial pieces:

```
sage -t -long -force_lib "devel/sage-main/sage/geometry/fan.py" 
********************************************************************** 
File "/64bitdev/storage/sage/sage-5.0.beta6/devel/sage-main/sage/ 
geometry/fan.py", line 2779: 
    sage: fan.complex().homology() 
Expected: 
    {0: 0, 1: 0, 2: Z x Z, 3: 0} 
Got: 
    {2: Z x Z, 3: 0} 
********************************************************************** 
File "/64bitdev/storage/sage/sage-5.0.beta6/devel/sage-main/sage/ 
geometry/fan.py", line 2783: 
    sage: fan.complex().homology() 
Expected: 
    {0: 0, 1: 0, 2: Z, 3: 0} 
Got: 
    {2: Z, 3: 0} 
```

The fact that zero-dimensional cohomology groups are reported above and below the non-trivial range is already somewhat annoying, so I propose to fix this by changing the `homology` method to chop off these irrelevant zeroes. This would then have the additional benefit of the representation no longer depending on whether or not ChomP is installed. So the output for the homology of the 2-sphere should be 

```
{0: Z, 1: 0, 2: Z} 
```



---

Comment by jhpalmieri created at 2012-02-29 05:50:17

I'm not sure what you mean by irrelevant zeroes: if we chop off zeroes, then should the reduced homology of the 2-sphere just be `{2: Z}`? That is overly brief, I think. The answer

```
{0: 0, 1: 0, 2: Z, 3: 0}
```

for the homology of the fan includes dimensions 0-3 because those are the dimensions in which the chain complex is nonzero.  I think it makes sense to include those groups, whether zero or not.

I think that the CHomP interface should be fixed so that we don't have this issue: it can detect the upper and lower dimensions of the complex, and then pad with zeroes as necessary.  It might also make sense to add a flag for the homology method to only return nontrivial groups.


---

Comment by chapoton created at 2015-07-19 18:34:10

Changing keywords from "" to "chomp".


---

Comment by chapoton created at 2015-07-19 18:34:10

Changing status from new to needs_review.


---

Comment by chapoton created at 2015-07-19 18:34:10

simple proposal: stuff zero in the answer of chomp, so that it fits the standard answer
----
New commits:


---

Comment by git created at 2015-07-20 11:54:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-07-20 12:10:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-07-20 12:33:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2015-07-29 17:48:35

If I install CHomP, I get one doctest failure:

```
sage -t --long --warn-long 51.8 src/sage/homology/delta_complex.py
**********************************************************************
File "src/sage/homology/delta_complex.py", line 605, in sage.homology.delta_complex.DeltaComplex.chain_complex
Failed example:
    T.homology(subcomplex=T)
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/CHOMP/sage-6.8/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/CHOMP/sage-6.8/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.homology.delta_complex.DeltaComplex.chain_complex[8]>", line 1, in <module>
        T.homology(subcomplex=T)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/CHOMP/sage-6.8/local/lib/python2.7/site-packages/sage/homology/cell_complex.py", line 541, in homology
        answer = C.homology(**kwds)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/CHOMP/sage-6.8/local/lib/python2.7/site-packages/sage/misc/decorators.py", line 705, in wrapper
        return func(*args, **kwds)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/CHOMP/sage-6.8/local/lib/python2.7/site-packages/sage/homology/chain_complex.py", line 1213, in homology
        return self._homology_chomp(deg, base_ring, verbose, generators)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/CHOMP/sage-6.8/local/lib/python2.7/site-packages/sage/homology/chain_complex.py", line 1054, in _homology_chomp
        generators=generators)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/CHOMP/sage-6.8/local/lib/python2.7/site-packages/sage/interfaces/chomp.py", line 590, in homchain
        return CHomP()('homchain', complex, **kwds)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/CHOMP/sage-6.8/local/lib/python2.7/site-packages/sage/interfaces/chomp.py", line 263, in __call__
        raise RuntimeError('error inside CHomP')
    RuntimeError: error inside CHomP
**********************************************************************
1 item had failures:
   1 of  13 in sage.homology.delta_complex.DeltaComplex.chain_complex
    [145 tests, 1 failure, 1.31 s]
```

If I then run tests with `--optional=sage,chomp`, I get a few more errors:

```
sage -t --long --warn-long 51.8 src/sage/homology/tests.py
**********************************************************************
File "src/sage/homology/tests.py", line 10, in sage.homology.tests
Failed example:
    test_random_chain_complex(trials=20)  # optional - CHomP
Expected nothing
Got:
    Random testing has revealed a problem in test_random_chain_complex
    Please report this bug!  You may be the first
    person in the world to have seen this problem.
    Please include this random seed in your bug report:
    Random seed: 159304674290093254409624536430227373862
    RuntimeError('error inside CHomP',)
**********************************************************************
File "src/sage/homology/tests.py", line 11, in sage.homology.tests
Failed example:
    test_random_chain_complex(level=2, trials=20)  # optional - CHomP
Expected nothing
Got:
    Random testing has revealed a problem in test_random_chain_complex
    Please report this bug!  You may be the first
    person in the world to have seen this problem.
    Please include this random seed in your bug report:
    Random seed: 130448957777511520486902617862493201212
    RuntimeError('error inside CHomP',)
**********************************************************************
File "src/sage/homology/tests.py", line 12, in sage.homology.tests
Failed example:
    test_random_chain_complex(level=3, trials=20)  # long time # optional - CHomP
Expected nothing
Got:
    Random testing has revealed a problem in test_random_chain_complex
    Please report this bug!  You may be the first
    person in the world to have seen this problem.
    Please include this random seed in your bug report:
    Random seed: 337572972161276702442755420588198438138
    RuntimeError('error inside CHomP',)
**********************************************************************
File "src/sage/homology/tests.py", line 72, in sage.homology.tests.test_random_chain_complex
Failed example:
    test_random_chain_complex(trials=2)  # optional - CHomP
Expected nothing
Got:
    Random testing has revealed a problem in test_random_chain_complex
    Please report this bug!  You may be the first
    person in the world to have seen this problem.
    Please include this random seed in your bug report:
    Random seed: 190504759948336957776305453124739057674
    RuntimeError('error inside CHomP',)
**********************************************************************
2 items had failures:
   3 of   9 in sage.homology.tests
   1 of   3 in sage.homology.tests.test_random_chain_complex
    [20 tests, 4 failures, 2.40 s]
```

We need to fix the failures in `delta_complex.py`. It would be nice to fix the ones in `tests.py`, but that could be done on another ticket. (This is on OS X, for what that's worth.)


---

Comment by jhpalmieri created at 2015-07-29 17:48:48

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-07-30 07:01:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2015-07-30 18:42:52

Changing status from needs_work to positive_review.


---

Comment by jhpalmieri created at 2015-07-30 18:43:02

Looks good, thank you.


---

Comment by vbraun created at 2015-07-31 17:52:29

Resolution: fixed
