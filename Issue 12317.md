# Issue 12317: Fix equality of combinatorial free module on non totally ordered basis

archive/issues_012317.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  sage-combinat\n\nKeywords: CombinatorialFreeModule, equality\n\nThe following is obviously wrong:\n\n```\nsage: F = CombinatorialFreeModule(QQ, Subsets([1,2,3]))\nsage: x = F.an_element()\nsage: x+0 == x\nFalse\nsage: x+F.zero() == x\nFalse\n```\n\nThe reason is\n\n```\nsage: (x+F.zero()).terms()  # random\n[2*B[{1}], 3*B[{2}], B[{}]]\nsage: x.terms()             # random\n[2*B[{1}], B[{}], 3*B[{2}]]\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12489\n\n",
    "created_at": "2012-02-10T12:54:05Z",
    "labels": [
        "combinatorics",
        "critical",
        "bug"
    ],
    "title": "Fix equality of combinatorial free module on non totally ordered basis",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12317",
    "user": "hivert"
}
```
Assignee: sage-combinat

CC:  sage-combinat

Keywords: CombinatorialFreeModule, equality

The following is obviously wrong:

```
sage: F = CombinatorialFreeModule(QQ, Subsets([1,2,3]))
sage: x = F.an_element()
sage: x+0 == x
False
sage: x+F.zero() == x
False
```

The reason is

```
sage: (x+F.zero()).terms()  # random
[2*B[{1}], 3*B[{2}], B[{}]]
sage: x.terms()             # random
[2*B[{1}], B[{}], 3*B[{2}]]
```


Issue created by migration from https://trac.sagemath.org/ticket/12489





---

archive/issue_comments_144985.json:
```json
{
    "body": "Changing keywords from \"CombinatorialFreeModule, equality\" to \"CombinatorialFreeModule, equality, Cernay2012\".",
    "created_at": "2012-02-10T13:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12317#issuecomment-144985",
    "user": "hivert"
}
```

Changing keywords from "CombinatorialFreeModule, equality" to "CombinatorialFreeModule, equality, Cernay2012".



---

archive/issue_comments_144986.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-11T00:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12317#issuecomment-144986",
    "user": "hivert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_144987.json:
```json
{
    "body": "I uploaded the patch on behalf of Nicolas and put a positive review since I'm Ok with it (the test suite is currently running). \n\nNicolas: I just put the correct trac ticket number and added one more test compared to your patch. I don't think this needs a new review.",
    "created_at": "2012-02-11T00:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12317#issuecomment-144987",
    "user": "hivert"
}
```

I uploaded the patch on behalf of Nicolas and put a positive review since I'm Ok with it (the test suite is currently running). 

Nicolas: I just put the correct trac ticket number and added one more test compared to your patch. I don't think this needs a new review.



---

archive/issue_comments_144988.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-11T00:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12317#issuecomment-144988",
    "user": "hivert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_144989.json:
```json
{
    "body": "+1! Thanks for the review!",
    "created_at": "2012-02-11T18:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12317#issuecomment-144989",
    "user": "nthiery"
}
```

+1! Thanks for the review!



---

archive/issue_comments_144990.json:
```json
{
    "body": "\n```\nsage -t --long \"devel/sage-main/sage/combinat/sf/dual.py\"\n**********************************************************************\nFile \"/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta4/devel/sage-main/sage/combinat/sf/dual.py\", line 33:\n    sage: TestSuite(f).run()  # long time (11s on sage.math, 2011)\nExpected nothing\nGot:\n    Failure in _test_one:\n    Traceback (most recent call last):\n      File \"/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta4/local/lib/python/site-packages/sage/misc/sage_unittest.py\", line 275, in run\n        test_method(tester = tester)\n      File \"/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta4/local/lib/python/site-packages/sage/categories/monoids.py\", line 126, in _tes\nt_one\n        tester.assert_(x * one == x)\n      File \"/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta4/local/lib/python2.7/unittest/case.py\", line 420, in assertTrue\n        raise self.failureException(msg)\n    AssertionError: False is not true\n[...]\n```\n",
    "created_at": "2012-02-13T12:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12317#issuecomment-144990",
    "user": "jdemeyer"
}
```


```
sage -t --long "devel/sage-main/sage/combinat/sf/dual.py"
**********************************************************************
File "/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta4/devel/sage-main/sage/combinat/sf/dual.py", line 33:
    sage: TestSuite(f).run()  # long time (11s on sage.math, 2011)
Expected nothing
Got:
    Failure in _test_one:
    Traceback (most recent call last):
      File "/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta4/local/lib/python/site-packages/sage/misc/sage_unittest.py", line 275, in run
        test_method(tester = tester)
      File "/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta4/local/lib/python/site-packages/sage/categories/monoids.py", line 126, in _tes
t_one
        tester.assert_(x * one == x)
      File "/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta4/local/lib/python2.7/unittest/case.py", line 420, in assertTrue
        raise self.failureException(msg)
    AssertionError: False is not true
[...]
```




---

archive/issue_comments_144991.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-02-13T12:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12317#issuecomment-144991",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_144992.json:
```json
{
    "body": "Replying to [comment:5 jdemeyer]:\n> {{{\n> sage -t --long \"devel/sage-main/sage/combinat/sf/dual.py\"\n> **********************************************************************\n> File \"/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta4/devel/sage-main/sage/combinat/sf/dual.py\", line 33:\n>     sage: TestSuite(f).run()  # long time (11s on sage.math, 2011)\n> Expected nothing\n> Got:\n>     Failure in _test_one:\n>     Traceback (most recent call last):\n>       File \"/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta4/local/lib/python/site-packages/sage/misc/sage_unittest.py\", line 275, in run\n>         test_method(tester = tester)\n>       File \"/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta4/local/lib/python/site-packages/sage/categories/monoids.py\", line 126, in _tes\n> t_one\n>         tester.assert_(x * one == x)\n>       File \"/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta4/local/lib/python2.7/unittest/case.py\", line 420, in assertTrue\n>         raise self.failureException(msg)\n>     AssertionError: False is not true\n> [...]\n> }}}\n\nThanks for catching that. I am working on it. First thing, I am extracting the call to _test_associativity to only set # long on it, and not on the full testsuite (otherwise I would have caught the error myself). The other thing is that the new equality test highlighted a preexisting bug: x*f.one() contains zero coefficients in its dictionary.",
    "created_at": "2012-02-13T15:02:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12317#issuecomment-144992",
    "user": "nthiery"
}
```

Replying to [comment:5 jdemeyer]:
> {{{
> sage -t --long "devel/sage-main/sage/combinat/sf/dual.py"
> **********************************************************************
> File "/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta4/devel/sage-main/sage/combinat/sf/dual.py", line 33:
>     sage: TestSuite(f).run()  # long time (11s on sage.math, 2011)
> Expected nothing
> Got:
>     Failure in _test_one:
>     Traceback (most recent call last):
>       File "/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta4/local/lib/python/site-packages/sage/misc/sage_unittest.py", line 275, in run
>         test_method(tester = tester)
>       File "/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta4/local/lib/python/site-packages/sage/categories/monoids.py", line 126, in _tes
> t_one
>         tester.assert_(x * one == x)
>       File "/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta4/local/lib/python2.7/unittest/case.py", line 420, in assertTrue
>         raise self.failureException(msg)
>     AssertionError: False is not true
> [...]
> }}}

Thanks for catching that. I am working on it. First thing, I am extracting the call to _test_associativity to only set # long on it, and not on the full testsuite (otherwise I would have caught the error myself). The other thing is that the new equality test highlighted a preexisting bug: x*f.one() contains zero coefficients in its dictionary.



---

archive/issue_comments_144993.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-02-13T15:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12317#issuecomment-144993",
    "user": "nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_144994.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-02-13T15:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12317#issuecomment-144994",
    "user": "nthiery"
}
```

Attachment



---

archive/issue_comments_144995.json:
```json
{
    "body": "Replying to [comment:5 jdemeyer]:\n> {{{\n sage -t --long \"devel/sage-main/sage/combinat/sf/dual.py\"\n [...]\n     AssertionError: False is not true\n> }}}\nSorry for not catching this ealier ! I didn't launch the `-long` tests during my review.",
    "created_at": "2012-02-13T19:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12317#issuecomment-144995",
    "user": "hivert"
}
```

Replying to [comment:5 jdemeyer]:
> {{{
 sage -t --long "devel/sage-main/sage/combinat/sf/dual.py"
 [...]
     AssertionError: False is not true
> }}}
Sorry for not catching this ealier ! I didn't launch the `-long` tests during my review.



---

archive/issue_comments_144996.json:
```json
{
    "body": "Nicolas: using `dict_linear_combination` is clearly the good solution here. I'm testing all these and will get back to positive review if the tests pass. Do you have auto tests on sageange working the way we had on massena ?\n\nFlorent",
    "created_at": "2012-02-13T19:27:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12317#issuecomment-144996",
    "user": "hivert"
}
```

Nicolas: using `dict_linear_combination` is clearly the good solution here. I'm testing all these and will get back to positive review if the tests pass. Do you have auto tests on sageange working the way we had on massena ?

Florent



---

archive/issue_comments_144997.json:
```json
{
    "body": "Replying to [comment:10 hivert]:\n> Nicolas: using `dict_linear_combination` is clearly the good solution here. I'm testing all these and will get back to positive review if the tests pass. Do you have auto tests on sageange working the way we had on massena ?\n\nYes, that's where I ran the test mentionned above. I'll put sage-combinat-commits in CC next time.",
    "created_at": "2012-02-13T22:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12317#issuecomment-144997",
    "user": "nthiery"
}
```

Replying to [comment:10 hivert]:
> Nicolas: using `dict_linear_combination` is clearly the good solution here. I'm testing all these and will get back to positive review if the tests pass. Do you have auto tests on sageange working the way we had on massena ?

Yes, that's where I ran the test mentionned above. I'll put sage-combinat-commits in CC next time.



---

archive/issue_comments_144998.json:
```json
{
    "body": "I put back to positive review while waiting for the result of the tests.",
    "created_at": "2012-02-14T13:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12317#issuecomment-144998",
    "user": "hivert"
}
```

I put back to positive review while waiting for the result of the tests.



---

archive/issue_comments_144999.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-14T13:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12317#issuecomment-144999",
    "user": "hivert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_145000.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-02-22T10:46:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12317",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12317#issuecomment-145000",
    "user": "jdemeyer"
}
```

Resolution: fixed
