# Issue 30923: Remove strict requirement for libreadline when building python3

Issue created by migration from https://trac.sagemath.org/ticket/31160

Original creator: mkoeppe

Original creation time: 2021-01-02 19:23:51

CC:  dimpase jhpalmieri

Given that IPython is using `prompt_toolkit` for terminal interactions, we can probably remove the hard requirement for `readline` from the build of `python3`.


---

Comment by mkoeppe created at 2021-04-02 20:21:54

Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage


---

Comment by mkoeppe created at 2021-06-23 17:40:43

Changing priority from minor to major.


---

Comment by mkoeppe created at 2021-06-23 17:49:26

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-06-23 17:49:26

New commits:


---

Comment by dimpase created at 2021-06-25 09:05:28

Does this mean we potentially will build Python without readline support (if this is possible at all)


---

Comment by mkoeppe created at 2021-06-25 15:35:56

Yes


---

Comment by dimpase created at 2021-06-25 18:19:21

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2021-06-25 18:19:21

OK


---

Comment by mkoeppe created at 2021-06-25 18:23:23

Thanks.


---

Comment by tscrim created at 2021-06-28 04:58:18

I think because of this I am now no longer able to build R:

```
checking for rl_callback_read_char in -lreadline... no
configure: error: --with-readline=yes (default) and headers/libs are not available
```

I couldn't get past the Python3 build without this ticket.


---

Comment by mkoeppe created at 2021-06-28 05:02:52

It is unlikely that this is connected. R does not use Python.
If R does not build, you can use `./configure --disable-r` to disable it.


---

Comment by tscrim created at 2021-06-28 06:16:17

Ah, okay. Thank you. Sorry for the noise.


---

Comment by tscrim created at 2021-06-28 06:36:11

Perhaps this is related?

```
uqtscrim@SMP-36PQ8T2:~/sage-build$ ./sage -t src/sage/algebras/weyl_algebra.py 
too few successful tests, not using stored timings
Running doctests with ID 2021-06-28-16-35-50-d69fb13c.
Git branch: public/new_fmatrix-30423
Using --optional=build,debian,dochtml,pip,sage,sage_spkg
Doctesting 1 file.
Traceback (most recent call last):
  File "/home/uqtscrim/sage-build/src/bin/sage-runtests", line 144, in <module>
    err = DC.run()
  File "/home/uqtscrim/sage-build/local/lib/python3.9/site-packages/sage/doctest/control.py", line 1207, in run
    self.run_doctests()
  File "/home/uqtscrim/sage-build/local/lib/python3.9/site-packages/sage/doctest/control.py", line 904, in run_doctests
    self.dispatcher = DocTestDispatcher(self)
  File "/home/uqtscrim/sage-build/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1658, in __init__
    init_sage(controller)
  File "/home/uqtscrim/sage-build/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 234, in init_sage
    import readline
ModuleNotFoundError: No module named 'readline'
```



---

Comment by mkoeppe created at 2021-06-28 06:39:38

Yes, this one is...


---

Comment by mkoeppe created at 2021-06-28 06:41:05

Changing status from positive_review to needs_work.


---

Comment by git created at 2021-06-28 06:47:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-06-28 06:47:27

Try with this fix please


---

Comment by mkoeppe created at 2021-06-28 06:47:46

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2021-06-29 01:37:05

This now fixes the doctester. Thank you. Although now I am wondering why we even need that import there. Can't we just remove it, especially considering #32073?


---

Comment by tscrim created at 2021-06-29 01:40:01

Replying to [comment:18 tscrim]:
> Can't we just remove it, especially considering #32073?

I guess we need to check that we don't have a regression to #14289.


---

Comment by mkoeppe created at 2021-06-29 18:27:47

I commented out this import, and it does not seem to make a difference with current versions of Python and macOS.

However, I haven't really used `sage -t --debug` before and I don't really understand its interface (sometimes I'm getting pdb prompts, sometimes sage prompts?), so it is quite possible that I am missing something


---

Comment by tscrim created at 2021-06-29 22:06:41

I think since this is needed in order for me to build Sage (hence, the blocker upgrade) and this makes the situation no worse for a secondary feature, we can just leave it in for now. Although that is equally a reason to just simply comment that one line with leaving a note...but perhaps best for a followup.


---

Comment by tscrim created at 2021-06-29 22:06:41

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2021-06-29 22:06:41

Changing priority from major to blocker.


---

Comment by mkoeppe created at 2021-06-29 22:08:36

Thanks. I agree.


---

Comment by vbraun created at 2021-07-01 20:45:16

Resolution: fixed
