# Issue 12023: numerical_approx broken for vectors

archive/issues_012023.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  rbeezer jason\n\n#1294 implemented {{n()}} but not {{N()}} or the functional {{numerical_approx}}\n\nIssue created by migration from https://trac.sagemath.org/ticket/12195\n\n",
    "created_at": "2011-12-20T09:27:33Z",
    "labels": [
        "linear algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "numerical_approx broken for vectors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12023",
    "user": "robertwb"
}
```
Assignee: jason, was

CC:  rbeezer jason

#1294 implemented {{n()}} but not {{N()}} or the functional {{numerical_approx}}

Issue created by migration from https://trac.sagemath.org/ticket/12195





---

archive/issue_comments_138956.json:
```json
{
    "body": "Attachment [12195-numerical_approx.patch](tarball://root/attachments/some-uuid/ticket12195/12195-numerical_approx.patch) by robertwb created at 2011-12-20 09:29:20",
    "created_at": "2011-12-20T09:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12023#issuecomment-138956",
    "user": "robertwb"
}
```

Attachment [12195-numerical_approx.patch](tarball://root/attachments/some-uuid/ticket12195/12195-numerical_approx.patch) by robertwb created at 2011-12-20 09:29:20



---

archive/issue_comments_138957.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-12-20T09:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12023#issuecomment-138957",
    "user": "robertwb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_138958.json:
```json
{
    "body": "Robert,\n\nLooks good, and very welcome.  I should have noticed, and fixed, this omission during my big push last year.  Looks ready for a positive review, but I have two questions.\n\n1.  Could this make the  `.n()` method (immediate prior in source) obsolete?\n\n2.  This does not seem to show up explicitly anywhere in the documentation.  Doing `v.N?` on an integer vector `v` seems to just give the generic documentation for a numerical approximation to a single scalar.  For matrices, the approach is different.  A bit more code, and not overriding the scalar method:  Plus: explicit documentation.  Minus: duplication of code, including a really bad approximation of `log 10` as discussed recently on sage-devel.\n\nA suggestion - add a doctest in this patch for the generic method exhibiting application to vectors.  If that's agreeable, I'll make a ticket to have matrices follow the model of this ticket (and maybe even do it).  \n\nRob",
    "created_at": "2011-12-20T18:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12023#issuecomment-138958",
    "user": "rbeezer"
}
```

Robert,

Looks good, and very welcome.  I should have noticed, and fixed, this omission during my big push last year.  Looks ready for a positive review, but I have two questions.

1.  Could this make the  `.n()` method (immediate prior in source) obsolete?

2.  This does not seem to show up explicitly anywhere in the documentation.  Doing `v.N?` on an integer vector `v` seems to just give the generic documentation for a numerical approximation to a single scalar.  For matrices, the approach is different.  A bit more code, and not overriding the scalar method:  Plus: explicit documentation.  Minus: duplication of code, including a really bad approximation of `log 10` as discussed recently on sage-devel.

A suggestion - add a doctest in this patch for the generic method exhibiting application to vectors.  If that's agreeable, I'll make a ticket to have matrices follow the model of this ticket (and maybe even do it).  

Rob



---

archive/issue_comments_138959.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd40.5\".",
    "created_at": "2012-05-25T23:34:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12023#issuecomment-138959",
    "user": "was"
}
```

Changing keywords from "" to "sd40.5".



---

archive/issue_comments_138960.json:
```json
{
    "body": "This clearly needs work. Rob's point about there being an n method right before is serious.  That should be deleted, and was the result of somebody not understanding the architecture of N...",
    "created_at": "2012-05-25T23:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12023#issuecomment-138960",
    "user": "was"
}
```

This clearly needs work. Rob's point about there being an n method right before is serious.  That should be deleted, and was the result of somebody not understanding the architecture of N...



---

archive/issue_comments_138961.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-05-25T23:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12023#issuecomment-138961",
    "user": "was"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_138962.json:
```json
{
    "body": "I fixed the patch by deleting the n function before.  Looks great!",
    "created_at": "2012-05-26T06:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12023#issuecomment-138962",
    "user": "was"
}
```

I fixed the patch by deleting the n function before.  Looks great!



---

archive/issue_comments_138963.json:
```json
{
    "body": "Attachment [12195-numerical_approx.2.patch](tarball://root/attachments/some-uuid/ticket12195/12195-numerical_approx.2.patch) by was created at 2012-05-26 06:29:15\n\napply only:  12195-numerical_approx.2.patch",
    "created_at": "2012-05-26T06:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12023#issuecomment-138963",
    "user": "was"
}
```

Attachment [12195-numerical_approx.2.patch](tarball://root/attachments/some-uuid/ticket12195/12195-numerical_approx.2.patch) by was created at 2012-05-26 06:29:15

apply only:  12195-numerical_approx.2.patch



---

archive/issue_comments_138964.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-05-26T06:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12023#issuecomment-138964",
    "user": "was"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_138965.json:
```json
{
    "body": "Attachment [trac_12195-numerical-approx-v3.patch](tarball://root/attachments/some-uuid/ticket12195/trac_12195-numerical-approx-v3.patch) by rbeezer created at 2012-05-27 02:28:21",
    "created_at": "2012-05-27T02:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12023#issuecomment-138965",
    "user": "rbeezer"
}
```

Attachment [trac_12195-numerical-approx-v3.patch](tarball://root/attachments/some-uuid/ticket12195/trac_12195-numerical-approx-v3.patch) by rbeezer created at 2012-05-27 02:28:21



---

archive/issue_comments_138966.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-05-27T02:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12023#issuecomment-138966",
    "user": "rbeezer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_138967.json:
```json
{
    "body": "* Previous patches had the `_numerical_approx` function in the generic dense class, and specialized classes (such as rational dense) derive directly from the plain free module element class.  Thus the method was invisible to those specialized classes and only \"generic\" vectors could use this.  So I took William's version of the function and moved it up to a higher level.\n\n  * Removed a pile of `n()` methods, but preserved many of their doctests in the new method.\n\n  * Could not resist poking at the documentation of `misc.functional.numerical_approx`, so there was a drive-by upgrade there.\n\n  * Improved the passing of `prec` and `digits` in one or two places.\n\n  * Reworked the sparse case slightly and added a doctest to make sure it was not being clobbered.\n\n  * Passes all tests.\n\n  * Seemingly other places to look for removal, almost all outside my expertise.  Maybe I should put these on a new ticket for safekeeping?  The one for graphs is OK and does not need any inspection.\n    {{{        \nsage: search_src('def n\\(')\nmodular/abvar/morphism.py:801:    def n(self):\nmodules/vector_mod2_dense.pyx:447:    def n(self, *args, **kwargs):\ninterfaces/qsieve.py:176:    def n(self):\nschemes/elliptic_curves/heegner.py:4386:    def n(self):\nschemes/elliptic_curves/ell_curve_isogeny.py:3468:    def n(self):\n\nsage: search_src('def N\\(')\nmodular/modsym/p1list.pyx:1165:    def N(self):\nmodular/modsym/p1list_nf.py:261:    def N(self):\nmodular/modsym/p1list_nf.py:642:    def N(self):\nmodular/quatalg/brandt.py:534:    def N(self):\ngraphs/generic_graph_pyx.pyx:356:def N(n):\n\nsage: search_src('def numerical_approx\\(')\nmisc/functional.py:1196:def numerical_approx(x, prec=None, digits=None):\nschemes/elliptic_curves/heegner.py:3127:    def numerical_approx(self, prec=53):\nschemes/elliptic_curves/heegner.py:3979:    def numerical_approx(self, prec=53):\n\nsage: search_src('def _numerical_approx\\(')\nmatrix/matrix2.pyx:10332:    def _numerical_approx(self,prec=None,digits=None):\nmodules/free_module_element.pyx:991:    def _numerical_approx(self, prec=None, digits=None):\nmodules/free_module_element.pyx:4361:    def _numerical_approx(self, prec=None, digits=None):\nsymbolic/expression.pyx:4053:    def _numerical_approx(self, prec=None, digits=None):\n}}}",
    "created_at": "2012-05-27T02:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12023#issuecomment-138967",
    "user": "rbeezer"
}
```

* Previous patches had the `_numerical_approx` function in the generic dense class, and specialized classes (such as rational dense) derive directly from the plain free module element class.  Thus the method was invisible to those specialized classes and only "generic" vectors could use this.  So I took William's version of the function and moved it up to a higher level.

  * Removed a pile of `n()` methods, but preserved many of their doctests in the new method.

  * Could not resist poking at the documentation of `misc.functional.numerical_approx`, so there was a drive-by upgrade there.

  * Improved the passing of `prec` and `digits` in one or two places.

  * Reworked the sparse case slightly and added a doctest to make sure it was not being clobbered.

  * Passes all tests.

  * Seemingly other places to look for removal, almost all outside my expertise.  Maybe I should put these on a new ticket for safekeeping?  The one for graphs is OK and does not need any inspection.
    {{{        
sage: search_src('def n\(')
modular/abvar/morphism.py:801:    def n(self):
modules/vector_mod2_dense.pyx:447:    def n(self, *args, **kwargs):
interfaces/qsieve.py:176:    def n(self):
schemes/elliptic_curves/heegner.py:4386:    def n(self):
schemes/elliptic_curves/ell_curve_isogeny.py:3468:    def n(self):

sage: search_src('def N\(')
modular/modsym/p1list.pyx:1165:    def N(self):
modular/modsym/p1list_nf.py:261:    def N(self):
modular/modsym/p1list_nf.py:642:    def N(self):
modular/quatalg/brandt.py:534:    def N(self):
graphs/generic_graph_pyx.pyx:356:def N(n):

sage: search_src('def numerical_approx\(')
misc/functional.py:1196:def numerical_approx(x, prec=None, digits=None):
schemes/elliptic_curves/heegner.py:3127:    def numerical_approx(self, prec=53):
schemes/elliptic_curves/heegner.py:3979:    def numerical_approx(self, prec=53):

sage: search_src('def _numerical_approx\(')
matrix/matrix2.pyx:10332:    def _numerical_approx(self,prec=None,digits=None):
modules/free_module_element.pyx:991:    def _numerical_approx(self, prec=None, digits=None):
modules/free_module_element.pyx:4361:    def _numerical_approx(self, prec=None, digits=None):
symbolic/expression.pyx:4053:    def _numerical_approx(self, prec=None, digits=None):
}}}



---

archive/issue_comments_138968.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-27T02:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12023#issuecomment-138968",
    "user": "rbeezer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_138969.json:
```json
{
    "body": "Hello patchbot, please apply trac_12195-numerical-approx-v3.patch\n\nThank you",
    "created_at": "2012-05-27T06:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12023#issuecomment-138969",
    "user": "ddrake"
}
```

Hello patchbot, please apply trac_12195-numerical-approx-v3.patch

Thank you



---

archive/issue_comments_138970.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-27T06:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12023#issuecomment-138970",
    "user": "ddrake"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_138971.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-14T06:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12023",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12023#issuecomment-138971",
    "user": "jdemeyer"
}
```

Resolution: fixed
