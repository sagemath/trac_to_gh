# Issue 17127: All homsets category should be subcategories of the category of all homsets

archive/issues_017127.json:
```json
{
    "body": "CC:  sage-combinat simonking @nbruin @pjbruin\n\nAll homsets category should be subcategories of the category of all homsets. For example, we want:\n\n```\nsage: from sage.categories.homsets import Homsets\nsage: Schemes().Homsets().is_subcategory(Homsets())\nTrue\nsage: AdditiveMagmas().Homsets().is_subcategory(Homsets())\nTrue\nsage: AdditiveMagmas().AdditiveUnital().Homsets().is_subcategory(Homsets())\nTrue\n```\n\nThe inheritance of an homset category ``C.Homsets()`` from\n``Homsets()`` used to be implemented in\n``HomsetsCategory.extra_super_categories``; this meant that any custom\nimplementation of ``C.Homsets.extra_super_categories`` would overwrite\nit, which broke all the above examples.\n\nThis ticket fixes this, and uses the occasion to refactor the logic,\ngetting rid along the way of the custom ``category_of`` method which\nalmost duplicated that of functorial constructions. Hopefully the\nlogic and its the documentation, are clearer now.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17364\n\n",
    "created_at": "2014-11-18T15:27:20Z",
    "labels": [
        "component: categories",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "All homsets category should be subcategories of the category of all homsets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17127",
    "user": "https://github.com/nthiery"
}
```
CC:  sage-combinat simonking @nbruin @pjbruin

All homsets category should be subcategories of the category of all homsets. For example, we want:

```
sage: from sage.categories.homsets import Homsets
sage: Schemes().Homsets().is_subcategory(Homsets())
True
sage: AdditiveMagmas().Homsets().is_subcategory(Homsets())
True
sage: AdditiveMagmas().AdditiveUnital().Homsets().is_subcategory(Homsets())
True
```

The inheritance of an homset category ``C.Homsets()`` from
``Homsets()`` used to be implemented in
``HomsetsCategory.extra_super_categories``; this meant that any custom
implementation of ``C.Homsets.extra_super_categories`` would overwrite
it, which broke all the above examples.

This ticket fixes this, and uses the occasion to refactor the logic,
getting rid along the way of the custom ``category_of`` method which
almost duplicated that of functorial constructions. Hopefully the
logic and its the documentation, are clearer now.

Issue created by migration from https://trac.sagemath.org/ticket/17364





---

archive/issue_comments_227384.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-11-18T15:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17127#issuecomment-227384",
    "user": "https://github.com/nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_227385.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-11-18T15:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17127#issuecomment-227385",
    "user": "https://github.com/nthiery"
}
```

New commits:



---

archive/issue_comments_227386.json:
```json
{
    "body": "What is meant by \"category of all homsets\"? A questionable construction such as the \"category of all objects\", `Objects()`?",
    "created_at": "2014-11-18T15:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17127#issuecomment-227386",
    "user": "https://github.com/simon-king-jena"
}
```

What is meant by "category of all homsets"? A questionable construction such as the "category of all objects", `Objects()`?



---

archive/issue_comments_227387.json:
```json
{
    "body": "There remains one thing: what to do with `Schemes.Homsets` and `HeckeModules.Homsets`? Probably fine as they are without `extra_super_categories`. My tiny changes there are likely to conflict with those in #17359. Please take over, and feel free too edit that part, and make either ticket depend on the other.",
    "created_at": "2014-11-18T15:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17127#issuecomment-227387",
    "user": "https://github.com/nthiery"
}
```

There remains one thing: what to do with `Schemes.Homsets` and `HeckeModules.Homsets`? Probably fine as they are without `extra_super_categories`. My tiny changes there are likely to conflict with those in #17359. Please take over, and feel free too edit that part, and make either ticket depend on the other.



---

archive/issue_comments_227388.json:
```json
{
    "body": "Replying to [comment:3 SimonKing]:\n> What is meant by \"category of all homsets\"? A questionable construction such as the \"category of all objects\", `Objects()`?\n\n\nYeah, this basically serves the same role indeed. Anyway, it's not a new thing: you already positive reviewed it in #10668 :-)",
    "created_at": "2014-11-18T15:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17127#issuecomment-227388",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:3 SimonKing]:
> What is meant by "category of all homsets"? A questionable construction such as the "category of all objects", `Objects()`?


Yeah, this basically serves the same role indeed. Anyway, it's not a new thing: you already positive reviewed it in #10668 :-)



---

archive/issue_comments_227389.json:
```json
{
    "body": "(just fixing some typos in the description and summary)\n\nReplying to [comment:4 nthiery]:\n> There remains one thing: what to do with `Schemes.Homsets` and `HeckeModules.Homsets`? Probably fine as they are without `extra_super_categories`. My tiny changes there are likely to conflict with those in #17359. Please take over, and feel free too edit that part, and make either ticket depend on the other.\n\nIn that case I propose using #17359 to finish the two `TODO` items from this ticket (for Hecke modules and schemes).",
    "created_at": "2014-11-19T08:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17127#issuecomment-227389",
    "user": "https://github.com/pjbruin"
}
```

(just fixing some typos in the description and summary)

Replying to [comment:4 nthiery]:
> There remains one thing: what to do with `Schemes.Homsets` and `HeckeModules.Homsets`? Probably fine as they are without `extra_super_categories`. My tiny changes there are likely to conflict with those in #17359. Please take over, and feel free too edit that part, and make either ticket depend on the other.

In that case I propose using #17359 to finish the two `TODO` items from this ticket (for Hecke modules and schemes).



---

archive/issue_comments_227390.json:
```json
{
    "body": "Replying to [comment:6 pbruin]:\n> (just fixing some typos in the description and summary)\n> ...\n> In that case I propose using #17359 to finish the two `TODO` items from this ticket (for Hecke modules and schemes).\n\n\nSounds good. Thanks for taking over!",
    "created_at": "2014-11-19T09:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17127#issuecomment-227390",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:6 pbruin]:
> (just fixing some typos in the description and summary)
> ...
> In that case I propose using #17359 to finish the two `TODO` items from this ticket (for Hecke modules and schemes).


Sounds good. Thanks for taking over!



---

archive/issue_comments_227391.json:
```json
{
    "body": "I am not sure that this ticket solves all difficulties with determining the supercategories of Hom set categories.  For example (both before and after this ticket):\n\n```\nsage: HeckeModules(ZZ).is_subcategory(Modules(ZZ))\nTrue\nsage: Modules(ZZ).Homsets().all_super_categories()\n[Category of homsets of modules over Integer Ring,\n Category of modules over Integer Ring,\n Category of bimodules over Integer Ring on the left and Integer Ring on the right,\n Category of right modules over Integer Ring,\n Category of left modules over Integer Ring,\n Category of commutative additive groups,\n Category of additive groups,\n Category of additive inverse additive unital additive magmas,\n Category of commutative additive monoids,\n Category of additive monoids,\n Category of additive unital additive magmas,\n Category of commutative additive semigroups,\n Category of additive commutative additive magmas,\n Category of additive semigroups,\n Category of additive magmas,\n Category of homsets of right modules over Integer Ring and left modules over Integer Ring,\n Category of homsets,\n Category of sets,\n Category of sets with partial maps,\n Category of objects]\nsage: HeckeModules(ZZ).Homsets().all_super_categories()\n[Category of homsets of Hecke modules over Integer Ring,\n Category of homsets,\n Category of sets,\n Category of sets with partial maps,\n Category of objects]\n```\nNote that the fact that Hom sets of modules are Abelian groups is not reflected in the output of the last command.",
    "created_at": "2014-11-19T12:55:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17127#issuecomment-227391",
    "user": "https://github.com/pjbruin"
}
```

I am not sure that this ticket solves all difficulties with determining the supercategories of Hom set categories.  For example (both before and after this ticket):

```
sage: HeckeModules(ZZ).is_subcategory(Modules(ZZ))
True
sage: Modules(ZZ).Homsets().all_super_categories()
[Category of homsets of modules over Integer Ring,
 Category of modules over Integer Ring,
 Category of bimodules over Integer Ring on the left and Integer Ring on the right,
 Category of right modules over Integer Ring,
 Category of left modules over Integer Ring,
 Category of commutative additive groups,
 Category of additive groups,
 Category of additive inverse additive unital additive magmas,
 Category of commutative additive monoids,
 Category of additive monoids,
 Category of additive unital additive magmas,
 Category of commutative additive semigroups,
 Category of additive commutative additive magmas,
 Category of additive semigroups,
 Category of additive magmas,
 Category of homsets of right modules over Integer Ring and left modules over Integer Ring,
 Category of homsets,
 Category of sets,
 Category of sets with partial maps,
 Category of objects]
sage: HeckeModules(ZZ).Homsets().all_super_categories()
[Category of homsets of Hecke modules over Integer Ring,
 Category of homsets,
 Category of sets,
 Category of sets with partial maps,
 Category of objects]
```
Note that the fact that Hom sets of modules are Abelian groups is not reflected in the output of the last command.



---

archive/issue_comments_227392.json:
```json
{
    "body": "Hi Peter,\n\nReplying to [comment:8 pbruin]:\n> I am not sure that this ticket solves all difficulties with\n> determining the supercategories of Hom set categories.\n\n\nThanks for checking whether everything is correct.\n\n> For example (both before and after this ticket):\n> \n> ```\n> sage: HeckeModules(ZZ).is_subcategory(Modules(ZZ))\n\n...\n> }}}\n> Note that the fact that Hom sets of modules are Abelian groups is not reflected in the output of the last command.\n\nThis is not about the infrastructure (which is the theme of this\nticket), but about what Sage knows about Hecke modules (which is what\nthe TODO I left is about):\n\n- If the category Hecke modules is a full subcategory of the category\n  of modules, Sage should be told about this by implementing\n  `HeckeModules.additional_structure` to return `None`.\n\n- Otherwise, one needs to state explicitly that\n  `HeckeModules(ZZ).Homsets()` is a subcategory of `AbelianGroups()`\n  (or whatever appropriate) in\n  `HeckeModules.Homsets.extra_super_categories`.\n\nCheers,\n                       Nicolas",
    "created_at": "2014-11-19T13:57:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17127#issuecomment-227392",
    "user": "https://github.com/nthiery"
}
```

Hi Peter,

Replying to [comment:8 pbruin]:
> I am not sure that this ticket solves all difficulties with
> determining the supercategories of Hom set categories.


Thanks for checking whether everything is correct.

> For example (both before and after this ticket):
> 
> ```
> sage: HeckeModules(ZZ).is_subcategory(Modules(ZZ))

...
> }}}
> Note that the fact that Hom sets of modules are Abelian groups is not reflected in the output of the last command.

This is not about the infrastructure (which is the theme of this
ticket), but about what Sage knows about Hecke modules (which is what
the TODO I left is about):

- If the category Hecke modules is a full subcategory of the category
  of modules, Sage should be told about this by implementing
  `HeckeModules.additional_structure` to return `None`.

- Otherwise, one needs to state explicitly that
  `HeckeModules(ZZ).Homsets()` is a subcategory of `AbelianGroups()`
  (or whatever appropriate) in
  `HeckeModules.Homsets.extra_super_categories`.

Cheers,
                       Nicolas



---

archive/issue_comments_227393.json:
```json
{
    "body": "Replying to [comment:9 nthiery]:\n> > Note that the fact that Hom sets of modules are Abelian groups is not reflected in the output of the last command.\n\n> \n> This is not about the infrastructure (which is the theme of this\n> ticket), but about what Sage knows about Hecke modules (which is what\n> the TODO I left is about):\n> \n> - If the category Hecke modules is a full subcategory of the category\n>   of modules, Sage should be told about this by implementing\n>   `HeckeModules.additional_structure` to return `None`.\n> \n> - Otherwise, one needs to state explicitly that\n>   `HeckeModules(ZZ).Homsets()` is a subcategory of `AbelianGroups()`\n>   (or whatever appropriate) in\n>   `HeckeModules.Homsets.extra_super_categories`.\n \nOK, I see.  Thanks for the clarification!",
    "created_at": "2014-11-19T15:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17127#issuecomment-227393",
    "user": "https://github.com/pjbruin"
}
```

Replying to [comment:9 nthiery]:
> > Note that the fact that Hom sets of modules are Abelian groups is not reflected in the output of the last command.

> 
> This is not about the infrastructure (which is the theme of this
> ticket), but about what Sage knows about Hecke modules (which is what
> the TODO I left is about):
> 
> - If the category Hecke modules is a full subcategory of the category
>   of modules, Sage should be told about this by implementing
>   `HeckeModules.additional_structure` to return `None`.
> 
> - Otherwise, one needs to state explicitly that
>   `HeckeModules(ZZ).Homsets()` is a subcategory of `AbelianGroups()`
>   (or whatever appropriate) in
>   `HeckeModules.Homsets.extra_super_categories`.
 
OK, I see.  Thanks for the clarification!



---

archive/issue_comments_227394.json:
```json
{
    "body": "A related question: in an Abelian category (or more generally an additive category), all Hom sets have a structure of Abelian groups.  Would the current infrastructure allow inserting this fact somewhere in the code, so that all Hom sets in an Abelian category are automatically in `CommutativeAdditiveGroups`?  I (very simple-mindedly) tried inserting some variants of the following in `sage/categories/category_types.py`:\n\n```python\nlazy_import('sage.categories.homsets', 'HomsetsCategory')\n\nclass AbelianCategory(Category):\n    ...\n    class Homsets(HomsetsCategory):\n        def extra_super_categories(self):\n            return [CommutativeAdditiveGroups()]\n```\nbut got a strange `ImportError: No module named Homsets`.",
    "created_at": "2014-11-19T23:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17127#issuecomment-227394",
    "user": "https://github.com/pjbruin"
}
```

A related question: in an Abelian category (or more generally an additive category), all Hom sets have a structure of Abelian groups.  Would the current infrastructure allow inserting this fact somewhere in the code, so that all Hom sets in an Abelian category are automatically in `CommutativeAdditiveGroups`?  I (very simple-mindedly) tried inserting some variants of the following in `sage/categories/category_types.py`:

```python
lazy_import('sage.categories.homsets', 'HomsetsCategory')

class AbelianCategory(Category):
    ...
    class Homsets(HomsetsCategory):
        def extra_super_categories(self):
            return [CommutativeAdditiveGroups()]
```
but got a strange `ImportError: No module named Homsets`.



---

archive/issue_comments_227395.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-12-08T10:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17127#issuecomment-227395",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_227396.json:
```json
{
    "body": "Let's get this fix in.",
    "created_at": "2014-12-08T10:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17127#issuecomment-227396",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Let's get this fix in.



---

archive/issue_events_050072.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-12-15T13:31:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17127",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17127#event-50072"
}
```



---

archive/issue_comments_227397.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-12-15T13:31:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17127",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17127#issuecomment-227397",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
