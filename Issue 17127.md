# Issue 17127: All homsets category should be subcategories of the category of all homsets

Issue created by migration from Trac.

Original creator: nthiery

Original creation time: 2014-11-18 15:27:20

CC:  sage-combinat simonking nbruin pbruin

All homsets category should be subcategories of the category of all homsets. For example, we want:

```
sage: from sage.categories.homsets import Homsets
sage: Schemes().Homsets().is_subcategory(Homsets())
True
sage: AdditiveMagmas().Homsets().is_subcategory(Homsets())
True
sage: AdditiveMagmas().AdditiveUnital().Homsets().is_subcategory(Homsets())
True
```


The inheritance of an homset category ``C.Homsets()`` from
``Homsets()`` used to be implemented in
``HomsetsCategory.extra_super_categories``; this meant that any custom
implementation of ``C.Homsets.extra_super_categories`` would overwrite
it, which broke all the above examples.

This ticket fixes this, and uses the occasion to refactor the logic,
getting rid along the way of the custom ``category_of`` method which
almost duplicated that of functorial constructions. Hopefully the
logic and its the documentation, are clearer now.


---

Comment by nthiery created at 2014-11-18 15:45:21

Changing status from new to needs_review.


---

Comment by nthiery created at 2014-11-18 15:45:21

New commits:


---

Comment by SimonKing created at 2014-11-18 15:47:09

What is meant by "category of all homsets"? A questionable construction such as the "category of all objects", `Objects()`?


---

Comment by nthiery created at 2014-11-18 15:49:41

There remains one thing: what to do with `Schemes.Homsets` and `HeckeModules.Homsets`? Probably fine as they are without `extra_super_categories`. My tiny changes there are likely to conflict with those in #17359. Please take over, and feel free too edit that part, and make either ticket depend on the other.


---

Comment by nthiery created at 2014-11-18 15:51:29

Replying to [comment:3 SimonKing]:
> What is meant by "category of all homsets"? A questionable construction such as the "category of all objects", `Objects()`?

Yeah, this basically serves the same role indeed. Anyway, it's not a new thing: you already positive reviewed it in #10668 :-)


---

Comment by pbruin created at 2014-11-19 08:53:29

(just fixing some typos in the description and summary)

Replying to [comment:4 nthiery]:
> There remains one thing: what to do with `Schemes.Homsets` and `HeckeModules.Homsets`? Probably fine as they are without `extra_super_categories`. My tiny changes there are likely to conflict with those in #17359. Please take over, and feel free too edit that part, and make either ticket depend on the other.
In that case I propose using #17359 to finish the two `TODO` items from this ticket (for Hecke modules and schemes).


---

Comment by nthiery created at 2014-11-19 09:39:41

Replying to [comment:6 pbruin]:
> (just fixing some typos in the description and summary)
> ...
> In that case I propose using #17359 to finish the two `TODO` items from this ticket (for Hecke modules and schemes).

Sounds good. Thanks for taking over!


---

Comment by pbruin created at 2014-11-19 12:55:51

I am not sure that this ticket solves all difficulties with determining the supercategories of Hom set categories.  For example (both before and after this ticket):

```
sage: HeckeModules(ZZ).is_subcategory(Modules(ZZ))
True
sage: Modules(ZZ).Homsets().all_super_categories()
[Category of homsets of modules over Integer Ring,
 Category of modules over Integer Ring,
 Category of bimodules over Integer Ring on the left and Integer Ring on the right,
 Category of right modules over Integer Ring,
 Category of left modules over Integer Ring,
 Category of commutative additive groups,
 Category of additive groups,
 Category of additive inverse additive unital additive magmas,
 Category of commutative additive monoids,
 Category of additive monoids,
 Category of additive unital additive magmas,
 Category of commutative additive semigroups,
 Category of additive commutative additive magmas,
 Category of additive semigroups,
 Category of additive magmas,
 Category of homsets of right modules over Integer Ring and left modules over Integer Ring,
 Category of homsets,
 Category of sets,
 Category of sets with partial maps,
 Category of objects]
sage: HeckeModules(ZZ).Homsets().all_super_categories()
[Category of homsets of Hecke modules over Integer Ring,
 Category of homsets,
 Category of sets,
 Category of sets with partial maps,
 Category of objects]
```

Note that the fact that Hom sets of modules are Abelian groups is not reflected in the output of the last command.


---

Comment by nthiery created at 2014-11-19 13:57:06

Hi Peter,

Replying to [comment:8 pbruin]:
> I am not sure that this ticket solves all difficulties with
> determining the supercategories of Hom set categories.

Thanks for checking whether everything is correct.

> For example (both before and after this ticket):
> {{{
> sage: HeckeModules(ZZ).is_subcategory(Modules(ZZ))
...
> }}}
> Note that the fact that Hom sets of modules are Abelian groups is not reflected in the output of the last command.

This is not about the infrastructure (which is the theme of this
ticket), but about what Sage knows about Hecke modules (which is what
the TODO I left is about):

- If the category Hecke modules is a full subcategory of the category
  of modules, Sage should be told about this by implementing
  `HeckeModules.additional_structure` to return `None`.

- Otherwise, one needs to state explicitly that
  `HeckeModules(ZZ).Homsets()` is a subcategory of `AbelianGroups()`
  (or whatever appropriate) in
  `HeckeModules.Homsets.extra_super_categories`.

Cheers,
                       Nicolas


---

Comment by pbruin created at 2014-11-19 15:14:18

Replying to [comment:9 nthiery]:
> > Note that the fact that Hom sets of modules are Abelian groups is not reflected in the output of the last command.
> 
> This is not about the infrastructure (which is the theme of this
> ticket), but about what Sage knows about Hecke modules (which is what
> the TODO I left is about):
> 
> - If the category Hecke modules is a full subcategory of the category
>   of modules, Sage should be told about this by implementing
>   `HeckeModules.additional_structure` to return `None`.
> 
> - Otherwise, one needs to state explicitly that
>   `HeckeModules(ZZ).Homsets()` is a subcategory of `AbelianGroups()`
>   (or whatever appropriate) in
>   `HeckeModules.Homsets.extra_super_categories`.
OK, I see.  Thanks for the clarification!


---

Comment by pbruin created at 2014-11-19 23:40:30

A related question: in an Abelian category (or more generally an additive category), all Hom sets have a structure of Abelian groups.  Would the current infrastructure allow inserting this fact somewhere in the code, so that all Hom sets in an Abelian category are automatically in `CommutativeAdditiveGroups`?  I (very simple-mindedly) tried inserting some variants of the following in `sage/categories/category_types.py`:

```python
lazy_import('sage.categories.homsets', 'HomsetsCategory')

class AbelianCategory(Category):
    ...
    class Homsets(HomsetsCategory):
        def extra_super_categories(self):
            return [CommutativeAdditiveGroups()]
```

but got a strange `ImportError: No module named Homsets`.


---

Comment by jpflori created at 2014-12-08 10:53:06

Changing status from needs_review to positive_review.


---

Comment by jpflori created at 2014-12-08 10:53:06

Let's get this fix in.


---

Comment by vbraun created at 2014-12-15 13:31:34

Resolution: fixed
