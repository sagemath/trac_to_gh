# Issue 30881: sage --package update-latest: Fix for package-names-containing-dashes

Issue created by migration from https://trac.sagemath.org/ticket/31118

Original creator: mkoeppe

Original creation time: 2020-12-27 18:32:37

CC:  vbraun slabbe jhpalmieri dimpase vdelecroix

... the current code is confused about pypa-normalized names vs. spkg-normalized names:

```
$ ./sage -package update-latest importlib_metadata
Traceback (most recent call last):
  File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/bin/sage-package", line 42, in <module>
    run()
  File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/bin/../sage_bootstrap/cmdline.py", line 337, in run
    app.update_latest(args.package_name)
  File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/bin/../sage_bootstrap/app.py", line 141, in update_latest
    pypi.update()
  File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/bin/../sage_bootstrap/pypi.py", line 104, in update
    package = Package(self.name)
  File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/bin/../sage_bootstrap/package.py", line 48, in __init__
    self._init_type()
  File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/bin/../sage_bootstrap/package.py", line 309, in _init_type
    with open(os.path.join(self.path, 'type')) as f:
IOError: [Errno 2] No such file or directory: u'/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/pkgs/importlib-metadata/type'
```



---

Comment by mkoeppe created at 2021-01-22 04:24:36

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-01-22 04:24:36

New commits:


---

Comment by git created at 2021-01-22 18:01:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-01-22 18:05:46

Changing priority from minor to major.


---

Comment by git created at 2021-01-22 18:12:57

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2021-01-24 18:53:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2021-01-24 19:09:29

Changing priority from major to blocker.


---

Comment by dimpase created at 2021-01-24 19:09:29

OK, this appears to fix `sage -package fix-checksum`.


---

Comment by dimpase created at 2021-01-24 19:09:29

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-01-24 19:11:44

By the way, only `sage -package fix-checksum` without specifying the package was broken because it looped over all packages, including script packages. Hardly a blocker, but it does not really matter


---

Comment by dimpase created at 2021-01-25 10:00:24

inability to update spkgs is a blocker all right.


---

Comment by vbraun created at 2021-02-20 10:46:54

Resolution: fixed
