# Issue 12632: infinite loop in find method of a finite word

Issue created by migration from Trac.

Original creator: slabbe

Original creation time: 2012-04-03 20:53:48

Assignee: sage-combinat

CC:  tjolivet slabbe tmonteil sstarosta

The bug appears in the last two lines :


```
Salut,

Un participant à un TP sage (à l'EJCIM 2012) a décelé un bug :

sage: s = WordMorphism("a->a")
sage: w = Word("a")
sage: w2 = s(w)
sage: w.find("a")
0
sage: w2.find(Word("a"))
0

Pour l'instant tout va bien. Les deux problèmes sont :

sage: w2.find("a",end=1)
-1
sage: w2.find("a")
--> ça boucle

À la prochaine,
Timo

```



---

Comment by aapitzsch created at 2012-04-04 09:26:21

Changing status from new to needs_review.


---

Comment by tjolivet created at 2012-04-04 12:46:04

Changing status from needs_review to needs_work.


---

Comment by tjolivet created at 2012-04-04 12:46:04

Hi,

I also thought about using the python string methods to fix this, but the  `Word` class allows arbitrary alphabets so we cannot use the string method directly.

The problem arises for example with `u = Word([-1,-2,-3])`, where `str(u)` returns the string `'-1,-2,-3'`:


```
sage: u = Word([-1,-2,-3])
sage: v = Word([-2])
sage: u.find(v)
1
sage: str(u).find(str(v))
3
```



---

Attachment


---

Comment by aapitzsch created at 2012-04-06 17:00:41

Changing status from needs_work to needs_review.


---

Comment by aapitzsch created at 2012-04-06 17:00:41

Now string method is only used if we search for a string instead of a word.


---

Comment by mhansen created at 2012-05-28 23:07:35

Changing status from needs_review to needs_work.


---

Comment by mhansen created at 2012-05-28 23:07:35

Doesn't 


```
Word([-1,-2,-3]).find("-2")
```


still return the wrong thing?  Wouldn't it be better to do something like `list(u).index(v)` ?


---

Comment by aapitzsch created at 2012-06-06 20:38:09

Changing status from needs_work to needs_info.


---

Comment by aapitzsch created at 2012-06-06 20:38:09


```
sage: u = Word([-1,-2,-3])
sage: v = Word([-2]) 
sage: vv = Word("-2")
sage: v
word: -2
sage: vv
word: -2
sage: u.find(v) 
1
sage: u.find(vv)          
-1
```


Is this the behaviour we expect or should `u.find(vv)` return 1, too?

Notice

```
sage: v == vv
False
sage: type(v)
<class 'sage.combinat.words.word.FiniteWord_list'>
sage: type(vv)
<class 'sage.combinat.words.word.FiniteWord_str'>
```



---

Comment by vdelecroix created at 2015-04-08 22:52:00

Changing status from needs_info to needs_review.


---

Comment by vdelecroix created at 2015-04-08 22:52:00

Let us restart from scratch.
----
New commits:


---

Comment by slabbe created at 2015-04-09 20:01:21

Changing status from needs_review to needs_info.


---

Comment by slabbe created at 2015-04-09 20:01:21

I like the way the fix is done. But by coercing the sub into the parent, we may obtain a Value Error. Should we catch the Value Error and return -1 in this case?


```
sage: w = Words('ab')('babaabaaab')
sage: w.find('abc')      # find is overwritten in WordDatatype_str
-1
sage: 
sage: w = Words('ab')(tuple('babaabaaab'))
sage: w.find('abc')
Traceback (most recent call last):
...
ValueError: c not in alphabet!
```



---

Comment by git created at 2015-04-09 20:20:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2015-04-09 20:21:48

Changing status from needs_info to needs_review.


---

Comment by vdelecroix created at 2015-04-09 20:21:48

Right... done!

Vincent


---

Comment by slabbe created at 2015-04-10 08:55:27

Changing status from needs_review to needs_work.


---

Comment by slabbe created at 2015-04-10 08:55:27

The commit 2c45e2a is fine, but the new doctests do not test the good thing since they were already fine before 2c45e2a. The Value Error comes when the parent of w has a specified alphabet and when sub is outside of the language. At least one doctest should test that case.


---

Comment by slabbe created at 2015-04-13 09:46:12

Changing status from needs_work to needs_review.


---

Comment by slabbe created at 2015-04-13 09:46:12

I added the doctest that I wanted you to add. To me this is a positive review. I let you change the status for positive review if you agree with my commit.
----
New commits:


---

Comment by vdelecroix created at 2015-04-13 09:51:48

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2015-04-13 09:51:48

Thanks!


---

Comment by vbraun created at 2015-04-14 23:01:40

Resolution: fixed
