# Issue 12632: infinite loop in find method of a finite word

archive/issues_012632.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  tjolivet @seblabbe tmonteil @staroste\n\nThe bug appears in the last two lines :\n\n\n```\nSalut,\n\nUn participant \u00e0 un TP sage (\u00e0 l'EJCIM 2012) a d\u00e9cel\u00e9 un bug :\n\nsage: s = WordMorphism(\"a->a\")\nsage: w = Word(\"a\")\nsage: w2 = s(w)\nsage: w.find(\"a\")\n0\nsage: w2.find(Word(\"a\"))\n0\n\nPour l'instant tout va bien. Les deux probl\u00e8mes sont :\n\nsage: w2.find(\"a\",end=1)\n-1\nsage: w2.find(\"a\")\n--> \u00e7a boucle\n\n\u00c0 la prochaine,\nTimo\n\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12804\n\n",
    "created_at": "2012-04-03T20:53:48Z",
    "labels": [
        "combinatorics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "infinite loop in find method of a finite word",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12632",
    "user": "@seblabbe"
}
```
Assignee: sage-combinat

CC:  tjolivet @seblabbe tmonteil @staroste

The bug appears in the last two lines :


```
Salut,

Un participant à un TP sage (à l'EJCIM 2012) a décelé un bug :

sage: s = WordMorphism("a->a")
sage: w = Word("a")
sage: w2 = s(w)
sage: w.find("a")
0
sage: w2.find(Word("a"))
0

Pour l'instant tout va bien. Les deux problèmes sont :

sage: w2.find("a",end=1)
-1
sage: w2.find("a")
--> ça boucle

À la prochaine,
Timo

```


Issue created by migration from https://trac.sagemath.org/ticket/12804





---

archive/issue_comments_150377.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-04T09:26:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150377",
    "user": "@a-andre"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_150378.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-04-04T12:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150378",
    "user": "tjolivet"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_150379.json:
```json
{
    "body": "Hi,\n\nI also thought about using the python string methods to fix this, but the  `Word` class allows arbitrary alphabets so we cannot use the string method directly.\n\nThe problem arises for example with `u = Word([-1,-2,-3])`, where `str(u)` returns the string `'-1,-2,-3'`:\n\n\n```\nsage: u = Word([-1,-2,-3])\nsage: v = Word([-2])\nsage: u.find(v)\n1\nsage: str(u).find(str(v))\n3\n```\n",
    "created_at": "2012-04-04T12:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150379",
    "user": "tjolivet"
}
```

Hi,

I also thought about using the python string methods to fix this, but the  `Word` class allows arbitrary alphabets so we cannot use the string method directly.

The problem arises for example with `u = Word([-1,-2,-3])`, where `str(u)` returns the string `'-1,-2,-3'`:


```
sage: u = Word([-1,-2,-3])
sage: v = Word([-2])
sage: u.find(v)
1
sage: str(u).find(str(v))
3
```




---

archive/issue_comments_150380.json:
```json
{
    "body": "Attachment [trac_12804.patch](tarball://root/attachments/some-uuid/ticket12804/trac_12804.patch) by @a-andre created at 2012-04-06 16:36:43",
    "created_at": "2012-04-06T16:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150380",
    "user": "@a-andre"
}
```

Attachment [trac_12804.patch](tarball://root/attachments/some-uuid/ticket12804/trac_12804.patch) by @a-andre created at 2012-04-06 16:36:43



---

archive/issue_comments_150381.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-04-06T17:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150381",
    "user": "@a-andre"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_150382.json:
```json
{
    "body": "Now string method is only used if we search for a string instead of a word.",
    "created_at": "2012-04-06T17:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150382",
    "user": "@a-andre"
}
```

Now string method is only used if we search for a string instead of a word.



---

archive/issue_comments_150383.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-05-28T23:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150383",
    "user": "@mwhansen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_150384.json:
```json
{
    "body": "Doesn't \n\n\n```\nWord([-1,-2,-3]).find(\"-2\")\n```\n\n\nstill return the wrong thing?  Wouldn't it be better to do something like `list(u).index(v)` ?",
    "created_at": "2012-05-28T23:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150384",
    "user": "@mwhansen"
}
```

Doesn't 


```
Word([-1,-2,-3]).find("-2")
```


still return the wrong thing?  Wouldn't it be better to do something like `list(u).index(v)` ?



---

archive/issue_comments_150385.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2012-06-06T20:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150385",
    "user": "@a-andre"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_150386.json:
```json
{
    "body": "\n```\nsage: u = Word([-1,-2,-3])\nsage: v = Word([-2]) \nsage: vv = Word(\"-2\")\nsage: v\nword: -2\nsage: vv\nword: -2\nsage: u.find(v) \n1\nsage: u.find(vv)          \n-1\n```\n\n\nIs this the behaviour we expect or should `u.find(vv)` return 1, too?\n\nNotice\n\n```\nsage: v == vv\nFalse\nsage: type(v)\n<class 'sage.combinat.words.word.FiniteWord_list'>\nsage: type(vv)\n<class 'sage.combinat.words.word.FiniteWord_str'>\n```\n",
    "created_at": "2012-06-06T20:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150386",
    "user": "@a-andre"
}
```


```
sage: u = Word([-1,-2,-3])
sage: v = Word([-2]) 
sage: vv = Word("-2")
sage: v
word: -2
sage: vv
word: -2
sage: u.find(v) 
1
sage: u.find(vv)          
-1
```


Is this the behaviour we expect or should `u.find(vv)` return 1, too?

Notice

```
sage: v == vv
False
sage: type(v)
<class 'sage.combinat.words.word.FiniteWord_list'>
sage: type(vv)
<class 'sage.combinat.words.word.FiniteWord_str'>
```




---

archive/issue_comments_150387.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-04-08T22:52:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150387",
    "user": "@videlec"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_150388.json:
```json
{
    "body": "Let us restart from scratch.\n----\nNew commits:",
    "created_at": "2015-04-08T22:52:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150388",
    "user": "@videlec"
}
```

Let us restart from scratch.
----
New commits:



---

archive/issue_comments_150389.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-04-09T20:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150389",
    "user": "@seblabbe"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_150390.json:
```json
{
    "body": "I like the way the fix is done. But by coercing the sub into the parent, we may obtain a Value Error. Should we catch the Value Error and return -1 in this case?\n\n\n```\nsage: w = Words('ab')('babaabaaab')\nsage: w.find('abc')      # find is overwritten in WordDatatype_str\n-1\nsage: \nsage: w = Words('ab')(tuple('babaabaaab'))\nsage: w.find('abc')\nTraceback (most recent call last):\n...\nValueError: c not in alphabet!\n```\n",
    "created_at": "2015-04-09T20:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150390",
    "user": "@seblabbe"
}
```

I like the way the fix is done. But by coercing the sub into the parent, we may obtain a Value Error. Should we catch the Value Error and return -1 in this case?


```
sage: w = Words('ab')('babaabaaab')
sage: w.find('abc')      # find is overwritten in WordDatatype_str
-1
sage: 
sage: w = Words('ab')(tuple('babaabaaab'))
sage: w.find('abc')
Traceback (most recent call last):
...
ValueError: c not in alphabet!
```




---

archive/issue_comments_150391.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-09T20:20:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150391",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_150392.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-04-09T20:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150392",
    "user": "@videlec"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_150393.json:
```json
{
    "body": "Right... done!\n\nVincent",
    "created_at": "2015-04-09T20:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150393",
    "user": "@videlec"
}
```

Right... done!

Vincent



---

archive/issue_comments_150394.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-10T08:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150394",
    "user": "@seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_150395.json:
```json
{
    "body": "The commit 2c45e2a is fine, but the new doctests do not test the good thing since they were already fine before 2c45e2a. The Value Error comes when the parent of w has a specified alphabet and when sub is outside of the language. At least one doctest should test that case.",
    "created_at": "2015-04-10T08:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150395",
    "user": "@seblabbe"
}
```

The commit 2c45e2a is fine, but the new doctests do not test the good thing since they were already fine before 2c45e2a. The Value Error comes when the parent of w has a specified alphabet and when sub is outside of the language. At least one doctest should test that case.



---

archive/issue_comments_150396.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-13T09:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150396",
    "user": "@seblabbe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_150397.json:
```json
{
    "body": "I added the doctest that I wanted you to add. To me this is a positive review. I let you change the status for positive review if you agree with my commit.\n----\nNew commits:",
    "created_at": "2015-04-13T09:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150397",
    "user": "@seblabbe"
}
```

I added the doctest that I wanted you to add. To me this is a positive review. I let you change the status for positive review if you agree with my commit.
----
New commits:



---

archive/issue_comments_150398.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-13T09:51:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150398",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_150399.json:
```json
{
    "body": "Thanks!",
    "created_at": "2015-04-13T09:51:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150399",
    "user": "@videlec"
}
```

Thanks!



---

archive/issue_comments_150400.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-14T23:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12632",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12632#issuecomment-150400",
    "user": "@vbraun"
}
```

Resolution: fixed
