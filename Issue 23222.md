# Issue 23222: QuadraticField(D) fails for large D

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2017-07-18 19:00:14

CC:  mmezzarobba

Keywords: bug


```
sage: QuadraticField(4**1000+1)
Traceback (most recent call last):
...
ValueError: Cannot convert NaN or infinity to Pari float
```


see also [this ask question](https://ask.sagemath.org/question/38309/continuedfractions-fail-on-large-integers/).


---

Comment by jdemeyer created at 2017-07-19 07:34:54

Traceback please!!


---

Attachment


---

Comment by vdelecroix created at 2021-03-17 19:14:50

The error comes from

```
sage: x = polygen(QQ)
sage: (x^2 - (4**1000+1)).roots(RDF)
```



---

Comment by vdelecroix created at 2021-03-17 19:19:44

... which is legitimate since

```
sage: RDF(4**1000+1)
+infinity
```



---

Comment by vdelecroix created at 2021-03-17 19:22:28

Using `len(self._poly.roots(RDF)) == 0` to check whether a polynomial has a real root is definitely a mistake!


---

Comment by vdelecroix created at 2021-03-17 19:28:08

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2021-03-17 19:28:08

New commits:


---

Comment by mkoeppe created at 2021-03-18 03:16:34

Doctest failures in https://patchbot.sagemath.org/log/23459/Linux/1_SMP_Debian_4.19.171-2_(2021-01-30)/x86_64/4.19.0-14-amd64/tmonteil-lxc3/2021-03-17%2021:36:54


```
File "src/sage/rings/number_field/number_field_morphisms.pyx", line 472, in sage.rings.number_field.number_field_morphisms.root_from_approx
Failed example:
    root_from_approx(x^2 + 1, 0)
Expected:
    Traceback (most recent call last):
    ...
    ValueError: x^2 + 1 has no real roots
Got:
    <repr(<sage.rings.real_lazy.LazyAlgebraic at 0x7fbc82bbf5e8>) failed: IndexError: list index out of range>
```



---

Comment by mkoeppe created at 2021-03-18 03:16:41

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-03-18 12:33:03

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2021-03-18 12:33:41

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2021-03-18 12:33:41

Here is something less disruptive (but does work).


---

Comment by mkoeppe created at 2021-03-18 19:19:32

This passes tests. Do we need to be concerned about timings?


---

Comment by vdelecroix created at 2021-03-18 22:25:34

Replying to [comment:13 mkoeppe]:
> This passes tests. Do we need to be concerned about timings?

I agree that `number_of_real_roots()` is not ideal. Ideally there would be a `has_real_roots()`. But in delicate situations (a unique root), these are the same thing.


---

Comment by mkoeppe created at 2021-03-18 22:27:51

In what situations is this code used?


---

Comment by vdelecroix created at 2021-03-19 08:16:39

The `LazyAlgebraic` is used when one constructs an embedded number field with a floating point embedding (this is constructed in `number_field_morphism.pyx`). However, the `LazyAlgebraic` class is just a wrapper over `AA` or `QQbar`. I tried to change the code in `number_field_morphism.pyx` to always construct an embedding to `AA` or `QQbar` however this breaks some non-trivial things elsewhere.


---

Comment by mkoeppe created at 2021-03-19 20:42:27

Thanks for the explanation. LGTM.


---

Comment by mkoeppe created at 2021-03-19 20:42:27

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-03-20 20:55:04

Resolution: fixed
