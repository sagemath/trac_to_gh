# Issue 11475: Numerical approximation one digit

archive/issues_011475.json:
```json
{
    "body": "Assignee: jason, jkantor\n\nSage behaves unexpectedly when returning a numerical approximation to one digit:\n\n\n```\nsage: n(3.4, digits=1)\n3.4\n```\n\n\nThis should return 3.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11647\n\n",
    "created_at": "2011-08-04T06:22:21Z",
    "labels": [
        "component: numerical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Numerical approximation one digit",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11475",
    "user": "https://github.com/eviatarbach"
}
```
Assignee: jason, jkantor

Sage behaves unexpectedly when returning a numerical approximation to one digit:


```
sage: n(3.4, digits=1)
3.4
```


This should return 3.

Issue created by migration from https://trac.sagemath.org/ticket/11647





---

archive/issue_comments_128002.json:
```json
{
    "body": "Here is the code:\n\n```\n    if prec is None:\n        if digits is None:\n            prec = 53\n        else:\n            prec = int((digits+1) * 3.32192) + 1\n    try:\n        return x._numerical_approx(prec)\n```\n\nI think the idea is to give *at least* one correct digit.  It is a numerical approximation, after all, not a truncation.  What would you expect from this? \n\n```\nsage: n(3.7,digits=1)\n```\n\nMy first instinct, thus, is that this is not a bug, though more details are welcome.",
    "created_at": "2011-08-04T19:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11475#issuecomment-128002",
    "user": "https://github.com/kcrisman"
}
```

Here is the code:

```
    if prec is None:
        if digits is None:
            prec = 53
        else:
            prec = int((digits+1) * 3.32192) + 1
    try:
        return x._numerical_approx(prec)
```

I think the idea is to give *at least* one correct digit.  It is a numerical approximation, after all, not a truncation.  What would you expect from this? 

```
sage: n(3.7,digits=1)
```

My first instinct, thus, is that this is not a bug, though more details are welcome.



---

archive/issue_comments_128003.json:
```json
{
    "body": "I would expect 4. from that, similar to\n\n\n```\nsage: n(37.7,digits=2)\n38.\n```\n\n\nConsidering that for any number other than one (except very large ones, see http://trac.sagemath.org/sage_trac/ticket/10164), the number of digits in the returned number is equal to the digits argument, I think it is an unexpected result. It can be trivially fixed by adding a special case when the argument is one.",
    "created_at": "2011-08-04T22:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11475#issuecomment-128003",
    "user": "https://github.com/eviatarbach"
}
```

I would expect 4. from that, similar to


```
sage: n(37.7,digits=2)
38.
```


Considering that for any number other than one (except very large ones, see http://trac.sagemath.org/sage_trac/ticket/10164), the number of digits in the returned number is equal to the digits argument, I think it is an unexpected result. It can be trivially fixed by adding a special case when the argument is one.



---

archive/issue_comments_128004.json:
```json
{
    "body": "Don't expect exact results for decimal arithmetic. The underlying type is base 2. The fact that n allows \"digits\" to be specified in terms of decimal digits is for convenience only. When you specifying digits=1 you are really asking for ln(10)/ln(2)=3.3219 binary digits. Naturally, the system can't give you exactly what you ask for. In fact the system refuses to give you less than 53 binary digits, because there is no gain in keeping track of less. This translates to almost 16 decimal digits.\n\nIf you want decimal arithmetic rather than binary arithmetic (there is a difference when you're working with floats!), use a package that gives you that. See the `decimal` module that comes standard with python. It allows accurately setting the precision with which to do arithmetic.\n\nSage's \"RealNumber\" is trying to approximate the real numbers in behaviour. It is not concerned with managing low precisions very accurately.",
    "created_at": "2011-08-04T23:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11475#issuecomment-128004",
    "user": "https://github.com/nbruin"
}
```

Don't expect exact results for decimal arithmetic. The underlying type is base 2. The fact that n allows "digits" to be specified in terms of decimal digits is for convenience only. When you specifying digits=1 you are really asking for ln(10)/ln(2)=3.3219 binary digits. Naturally, the system can't give you exactly what you ask for. In fact the system refuses to give you less than 53 binary digits, because there is no gain in keeping track of less. This translates to almost 16 decimal digits.

If you want decimal arithmetic rather than binary arithmetic (there is a difference when you're working with floats!), use a package that gives you that. See the `decimal` module that comes standard with python. It allows accurately setting the precision with which to do arithmetic.

Sage's "RealNumber" is trying to approximate the real numbers in behaviour. It is not concerned with managing low precisions very accurately.



---

archive/issue_comments_128005.json:
```json
{
    "body": "I'm not talking about precision in arithmetic, simply saying that the user would expect the digits argument in the numerical approximation function to return a number with that number of digits, which of course is converted into bits of precision. As setting the digits argument to one is the only number which returns unexpected results, I think a special case should be added.\n\nBy the way, this is also the way Mathematica acts (http://www.wolframalpha.com/input/?i=N%5BGamma%5B3.3%5D%2C+1%5D).",
    "created_at": "2011-08-05T18:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11475#issuecomment-128005",
    "user": "https://github.com/eviatarbach"
}
```

I'm not talking about precision in arithmetic, simply saying that the user would expect the digits argument in the numerical approximation function to return a number with that number of digits, which of course is converted into bits of precision. As setting the digits argument to one is the only number which returns unexpected results, I think a special case should be added.

By the way, this is also the way Mathematica acts (http://www.wolframalpha.com/input/?i=N%5BGamma%5B3.3%5D%2C+1%5D).



---

archive/issue_comments_128006.json:
```json
{
    "body": "Since there doesn't seem to be a consensus on whether this is a bug yet, setting to 'needs info'.",
    "created_at": "2011-08-19T13:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11475#issuecomment-128006",
    "user": "https://github.com/kcrisman"
}
```

Since there doesn't seem to be a consensus on whether this is a bug yet, setting to 'needs info'.



---

archive/issue_comments_128007.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2011-08-19T13:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11475#issuecomment-128007",
    "user": "https://github.com/kcrisman"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_128008.json:
```json
{
    "body": "I think it's acceptable that digits=1 shows some strange behavior. I believe it should at least be documented, so I wrote a patch at #12120 to do so. Btw. should we assert that digits is not 0? Otherwise this should be added at #12120 as well.",
    "created_at": "2011-12-05T10:48:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11475#issuecomment-128008",
    "user": "https://github.com/saraedum"
}
```

I think it's acceptable that digits=1 shows some strange behavior. I believe it should at least be documented, so I wrote a patch at #12120 to do so. Btw. should we assert that digits is not 0? Otherwise this should be added at #12120 as well.



---

archive/issue_comments_128009.json:
```json
{
    "body": "At this point I'm wondering whether this is just a dup of #12120.  Or should it be considered a bug of some sort?",
    "created_at": "2012-07-20T15:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11475#issuecomment-128009",
    "user": "https://github.com/kcrisman"
}
```

At this point I'm wondering whether this is just a dup of #12120.  Or should it be considered a bug of some sort?



---

archive/issue_comments_128010.json:
```json
{
    "body": "As I said before, I don't think this is a bug since it is documented now. So from my point of view this can be closed.",
    "created_at": "2012-07-20T16:02:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11475#issuecomment-128010",
    "user": "https://github.com/saraedum"
}
```

As I said before, I don't think this is a bug since it is documented now. So from my point of view this can be closed.



---

archive/issue_comments_128011.json:
```json
{
    "body": "Ok.  And the original reporter should probably also weigh in...",
    "created_at": "2012-07-20T16:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11475#issuecomment-128011",
    "user": "https://github.com/kcrisman"
}
```

Ok.  And the original reporter should probably also weigh in...



---

archive/issue_comments_128012.json:
```json
{
    "body": "There seems to be a consensus that this behaviour is acceptable, so feel free to close.",
    "created_at": "2012-07-20T17:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11475#issuecomment-128012",
    "user": "https://github.com/eviatarbach"
}
```

There seems to be a consensus that this behaviour is acceptable, so feel free to close.



---

archive/issue_comments_128013.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-07-20T17:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11475#issuecomment-128013",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_128014.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-07-20T17:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11475#issuecomment-128014",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_128015.json:
```json
{
    "body": "Please fill in your real name as Author.",
    "created_at": "2012-07-27T20:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11475#issuecomment-128015",
    "user": "https://github.com/jdemeyer"
}
```

Please fill in your real name as Author.



---

archive/issue_comments_128016.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2012-07-31T06:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11475",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11475#issuecomment-128016",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: duplicate
