# Issue 27544: 2 doctests failing in src/sage/misc/package.py when --optional=sage,internet

archive/issues_027544.json:
```json
{
    "body": "CC:  @vinklein\n\nWith [SageMath](SageMath) version 8.8.beta4, Release Date: 2019-05-04,\n\n\n```\nsage -t --long src/sage/misc/package.py\n```\n\n\nis ok:\n\n\n```\nUsing --optional=4ti2,bliss,build,cbc,ccache,cmake,cryptominisat,dochtml,dot2tex,e_antic,glucose,latte_int,lidia,lrslib,memlimit,mpir,ninja_build,normaliz,notedown,pandoc_attributes,pycosat,pynormaliz,python2,qhull,rst2ipynb,sage,topcom\nDoctesting 1 file.\nsage -t --long src/sage/misc/package.py\n    [45 tests, 2.35 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\n```\n\n\nbut with tag internet:\n\n\n```\nsage -t --long --optional=sage,internet src/sage/misc/package.py\n```\n\n\ngives\n\n\n```\nUsing --optional=internet,memlimit,sage\nDoctesting 1 file.\nsage -t --long src/sage/misc/package.py\n**********************************************************************\nFile \"src/sage/misc/package.py\", line 202, in sage.misc.package.list_packages\nFailed example:\n    L['beautifulsoup']\nException raised:\n    Traceback (most recent call last):\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1095, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.package.list_packages[3]>\", line 1, in <module>\n        L['beautifulsoup']\n    KeyError: 'beautifulsoup'\n**********************************************************************\nFile \"src/sage/misc/package.py\", line 368, in sage.misc.package.package_versions\nFailed example:\n    std['zn_poly']  # random\nException raised:\n    Traceback (most recent call last):\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1095, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.package.package_versions[0]>\", line 1, in <module>\n        std['zn_poly']  # random\n    TypeError: 'function' object has no attribute '__getitem__'\n**********************************************************************\n2 items had failures:\n   1 of   5 in sage.misc.package.list_packages\n   1 of   2 in sage.misc.package.package_versions\n    [25 tests, 2 failures, 1.07 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/misc/package.py  # 2 doctests failed\n----------------------------------------------------------------------\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27781\n\n",
    "created_at": "2019-05-06T12:39:23Z",
    "labels": [
        "component: doctest coverage",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "2 doctests failing in src/sage/misc/package.py when --optional=sage,internet",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27544",
    "user": "https://github.com/seblabbe"
}
```
CC:  @vinklein

With [SageMath](SageMath) version 8.8.beta4, Release Date: 2019-05-04,


```
sage -t --long src/sage/misc/package.py
```


is ok:


```
Using --optional=4ti2,bliss,build,cbc,ccache,cmake,cryptominisat,dochtml,dot2tex,e_antic,glucose,latte_int,lidia,lrslib,memlimit,mpir,ninja_build,normaliz,notedown,pandoc_attributes,pycosat,pynormaliz,python2,qhull,rst2ipynb,sage,topcom
Doctesting 1 file.
sage -t --long src/sage/misc/package.py
    [45 tests, 2.35 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```


but with tag internet:


```
sage -t --long --optional=sage,internet src/sage/misc/package.py
```


gives


```
Using --optional=internet,memlimit,sage
Doctesting 1 file.
sage -t --long src/sage/misc/package.py
**********************************************************************
File "src/sage/misc/package.py", line 202, in sage.misc.package.list_packages
Failed example:
    L['beautifulsoup']
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1095, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.package.list_packages[3]>", line 1, in <module>
        L['beautifulsoup']
    KeyError: 'beautifulsoup'
**********************************************************************
File "src/sage/misc/package.py", line 368, in sage.misc.package.package_versions
Failed example:
    std['zn_poly']  # random
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1095, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.package.package_versions[0]>", line 1, in <module>
        std['zn_poly']  # random
    TypeError: 'function' object has no attribute '__getitem__'
**********************************************************************
2 items had failures:
   1 of   5 in sage.misc.package.list_packages
   1 of   2 in sage.misc.package.package_versions
    [25 tests, 2 failures, 1.07 s]
----------------------------------------------------------------------
sage -t --long src/sage/misc/package.py  # 2 doctests failed
----------------------------------------------------------------------
```


Issue created by migration from https://trac.sagemath.org/ticket/27781





---

archive/issue_comments_388192.json:
```json
{
    "body": "Probably caused by #27635",
    "created_at": "2019-05-09T08:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27544#issuecomment-388192",
    "user": "https://github.com/seblabbe"
}
```

Probably caused by #27635



---

archive/issue_comments_388193.json:
```json
{
    "body": "It has to do with tag `build`. When missing it creates issues. Because with `--optional=sage,internet,build` it works:\n\n\n```\nsage -t --long --optional=sage,internet,build src/sage/misc/package.py\n```\n\n\ngives\n\n\n```\nUsing --optional=build,internet,memlimit,sage\nDoctesting 1 file.\nsage -t --long src/sage/misc/package.py\n    [49 tests, 10.22 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 10.2 seconds\n    cpu time: 0.3 seconds\n    cumulative wall time: 10.2 seconds\n```\n",
    "created_at": "2019-05-09T08:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27544#issuecomment-388193",
    "user": "https://github.com/seblabbe"
}
```

It has to do with tag `build`. When missing it creates issues. Because with `--optional=sage,internet,build` it works:


```
sage -t --long --optional=sage,internet,build src/sage/misc/package.py
```


gives


```
Using --optional=build,internet,memlimit,sage
Doctesting 1 file.
sage -t --long src/sage/misc/package.py
    [49 tests, 10.22 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 10.2 seconds
    cpu time: 0.3 seconds
    cumulative wall time: 10.2 seconds
```




---

archive/issue_comments_388194.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-05-09T08:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27544#issuecomment-388194",
    "user": "https://github.com/seblabbe"
}
```

New commits:



---

archive/issue_comments_388195.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-09T08:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27544#issuecomment-388195",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_388196.json:
```json
{
    "body": "Changing keywords from \"\" to \"thursdaysbdx\".",
    "created_at": "2019-05-09T10:03:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27544#issuecomment-388196",
    "user": "https://github.com/vinklein"
}
```

Changing keywords from "" to "thursdaysbdx".



---

archive/issue_comments_388197.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2019-05-09T12:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27544#issuecomment-388197",
    "user": "https://github.com/vinklein"
}
```

Looks good to me.



---

archive/issue_comments_388198.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2019-05-09T14:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27544#issuecomment-388198",
    "user": "https://github.com/embray"
}
```

Resolution: duplicate



---

archive/issue_comments_388199.json:
```json
{
    "body": "Thanks, but this was already fixed (duplicate of #27766).",
    "created_at": "2019-05-09T14:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27544#issuecomment-388199",
    "user": "https://github.com/embray"
}
```

Thanks, but this was already fixed (duplicate of #27766).



---

archive/issue_events_025558.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-05-09T14:21:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27544",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27544#event-25558"
}
```
