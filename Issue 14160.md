# Issue 14160: The jmol spkg contains testjava.sh

archive/issues_014160.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @gutow\n\nThis script would be better in the sage-scripts spkg, as it's sage-specific, probably as sage-testjava.sh or some such. The change will break one doctest in devel/sage/sage/interfaces/jmoldata.py, where it is looking for it using the full path.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14364\n\n",
    "created_at": "2013-03-27T08:30:24Z",
    "labels": [
        "component: packages: standard",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "The jmol spkg contains testjava.sh",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14160",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```
Assignee: tbd

CC:  @gutow

This script would be better in the sage-scripts spkg, as it's sage-specific, probably as sage-testjava.sh or some such. The change will break one doctest in devel/sage/sage/interfaces/jmoldata.py, where it is looking for it using the full path.

Issue created by migration from https://trac.sagemath.org/ticket/14364





---

archive/issue_comments_177537.json:
```json
{
    "body": "I would argue the move is only appropriate if any other package in Sage depends on java.  To my knowledge, nothing in the base install other than Jmol does.",
    "created_at": "2013-03-27T16:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177537",
    "user": "https://github.com/gutow"
}
```

I would argue the move is only appropriate if any other package in Sage depends on java.  To my knowledge, nothing in the base install other than Jmol does.



---

archive/issue_comments_177538.json:
```json
{
    "body": "You can argue like that if you want, but jmol doesn't use testjava.sh -- devel/sage/sage/interfaces/jmoldata.py does. So I argue that only sage depends on it, and I stand by my report! :-P",
    "created_at": "2013-03-27T16:40:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177538",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

You can argue like that if you want, but jmol doesn't use testjava.sh -- devel/sage/sage/interfaces/jmoldata.py does. So I argue that only sage depends on it, and I stand by my report! :-P



---

archive/issue_comments_177539.json:
```json
{
    "body": "Replying to [comment:3 Snark]:\n> You can argue like that if you want, but jmol doesn't use testjava.sh -- devel/sage/sage/interfaces/jmoldata.py does. So I argue that only sage depends on it, and I stand by my report! :-P\n\nYou have a good point.  Since Sage depends on Jmol, this will always be available if Jmol needs it...I'll put this on my list as I try to incorporate the pure javascript version of Jmol for the notebook.",
    "created_at": "2013-03-27T16:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177539",
    "user": "https://github.com/gutow"
}
```

Replying to [comment:3 Snark]:
> You can argue like that if you want, but jmol doesn't use testjava.sh -- devel/sage/sage/interfaces/jmoldata.py does. So I argue that only sage depends on it, and I stand by my report! :-P

You have a good point.  Since Sage depends on Jmol, this will always be available if Jmol needs it...I'll put this on my list as I try to incorporate the pure javascript version of Jmol for the notebook.



---

archive/issue_comments_177540.json:
```json
{
    "body": "What's the status of this?",
    "created_at": "2013-05-25T12:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177540",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

What's the status of this?



---

archive/issue_comments_177541.json:
```json
{
    "body": "Replying to [comment:5 Snark]:\n> What's the status of this?\n\nI'm swamped...I am hoping to spend more time on this starting next month, but I have equipment (spectrometers, vacuum lines, computers, etc..to get fixed for next Fall's classes), and some web site programming for use at my University to finish before I can get to this.  Sorry, for the delay.  I definitely have not forgot about this.\nJG",
    "created_at": "2013-05-26T00:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177541",
    "user": "https://github.com/gutow"
}
```

Replying to [comment:5 Snark]:
> What's the status of this?

I'm swamped...I am hoping to spend more time on this starting next month, but I have equipment (spectrometers, vacuum lines, computers, etc..to get fixed for next Fall's classes), and some web site programming for use at my University to finish before I can get to this.  Sorry, for the delay.  I definitely have not forgot about this.
JG



---

archive/issue_events_040741.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14160#event-40741"
}
```



---

archive/issue_comments_177542.json:
```json
{
    "body": "Is there any interest in moving the functionality of `testjava.sh` into `jmoldata.py`? I'm not sure what is easiest to maintain, but I believe the following will work.\n\n```diff\n--- a/sage/interfaces/jmoldata.py\n+++ b/sage/interfaces/jmoldata.py\n@@ -86,13 +86,23 @@\n             sage_makedirs(jmolscratch)\n         scratchout = os.path.join(jmolscratch,\"jmolout.txt\")\n         jout=open(scratchout,'w')\n-        testjavapath = os.path.join(SAGE_LOCAL, \"share\", \"jmol\", \"testjava.sh\")\n-        result = subprocess.call([testjavapath],stdout=jout)\n-        jout.close()\n-        if (result == 0):\n-            return (True)\n-        else:\n-            return (False)\n+        try:\n+            version = subprocess.check_output(['java', '-version'], stderr=subprocess.STDOUT)\n+            import re, types\n+            java_version = re.search(\"version.*[1]\\.[567]\", version)\n+            if type(java_version) is types.NoneType:\n+                jout.write('Your version of Java is either deprecated or not supported\\nWe support versions 1.5 to 1.7\\n')\n+                jout.close()\n+                result = bool(java_version)\n+            else:\n+                jout.write('You have a supported version of Java, Exiting\\n')\n+                jout.close()\n+                result = bool(java_version)\n+        except (subprocess.CalledProcessError, OSError):\n+            jout.write('You do not have Java installed\\nWe support versions 1.5 to 1.7\\n')\n+            jout.close()\n+            result = False\n+        return result\n\n     def export_image(self,\n         targetfile,\n@@ -183,7 +193,7 @@\n             if not os.path.exists(jmolscratch):\n                 sage_makedirs(jmolscratch)\n             scratchout = os.path.join(jmolscratch,\"jmolout.txt\")\n-            jout=open(scratchout,'w')\n+            jout=open(scratchout,'a')\n             #now call the java application and write the file.\n             result = subprocess.call([\"java\",\"-Xmx512m\",\"-Djava.awt.headless=true\",\"-jar\",jmolpath,\"-iox\",\"-g\",sizeStr,\"-J\",launchscript,\"-j\",imagescript],stdout=jout)\n             jout.close()\n\n```",
    "created_at": "2013-10-09T22:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177542",
    "user": "https://github.com/strogdon"
}
```

Is there any interest in moving the functionality of `testjava.sh` into `jmoldata.py`? I'm not sure what is easiest to maintain, but I believe the following will work.

```diff
--- a/sage/interfaces/jmoldata.py
+++ b/sage/interfaces/jmoldata.py
@@ -86,13 +86,23 @@
             sage_makedirs(jmolscratch)
         scratchout = os.path.join(jmolscratch,"jmolout.txt")
         jout=open(scratchout,'w')
-        testjavapath = os.path.join(SAGE_LOCAL, "share", "jmol", "testjava.sh")
-        result = subprocess.call([testjavapath],stdout=jout)
-        jout.close()
-        if (result == 0):
-            return (True)
-        else:
-            return (False)
+        try:
+            version = subprocess.check_output(['java', '-version'], stderr=subprocess.STDOUT)
+            import re, types
+            java_version = re.search("version.*[1]\.[567]", version)
+            if type(java_version) is types.NoneType:
+                jout.write('Your version of Java is either deprecated or not supported\nWe support versions 1.5 to 1.7\n')
+                jout.close()
+                result = bool(java_version)
+            else:
+                jout.write('You have a supported version of Java, Exiting\n')
+                jout.close()
+                result = bool(java_version)
+        except (subprocess.CalledProcessError, OSError):
+            jout.write('You do not have Java installed\nWe support versions 1.5 to 1.7\n')
+            jout.close()
+            result = False
+        return result

     def export_image(self,
         targetfile,
@@ -183,7 +193,7 @@
             if not os.path.exists(jmolscratch):
                 sage_makedirs(jmolscratch)
             scratchout = os.path.join(jmolscratch,"jmolout.txt")
-            jout=open(scratchout,'w')
+            jout=open(scratchout,'a')
             #now call the java application and write the file.
             result = subprocess.call(["java","-Xmx512m","-Djava.awt.headless=true","-jar",jmolpath,"-iox","-g",sizeStr,"-J",launchscript,"-j",imagescript],stdout=jout)
             jout.close()

```



---

archive/issue_comments_177543.json:
```json
{
    "body": "This idea was also discussed [earlier](http://trac.sagemath.org/ticket/12299#comment:159).",
    "created_at": "2013-10-09T22:27:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177543",
    "user": "https://github.com/jhpalmieri"
}
```

This idea was also discussed [earlier](http://trac.sagemath.org/ticket/12299#comment:159).



---

archive/issue_comments_177544.json:
```json
{
    "body": "Replying to [comment:9 jhpalmieri]:\n\n> This idea was also discussed [earlier](http://trac.sagemath.org/ticket/12299#comment:159) .\n\nAnd the ideas are really yours.",
    "created_at": "2013-10-09T22:36:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177544",
    "user": "https://github.com/strogdon"
}
```

Replying to [comment:9 jhpalmieri]:

> This idea was also discussed [earlier](http://trac.sagemath.org/ticket/12299#comment:159) .

And the ideas are really yours.



---

archive/issue_comments_177545.json:
```json
{
    "body": "I think a lot of people had ideas about this, in fact.",
    "created_at": "2013-10-09T22:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177545",
    "user": "https://github.com/jhpalmieri"
}
```

I think a lot of people had ideas about this, in fact.



---

archive/issue_comments_177546.json:
```json
{
    "body": "I wrote the original code and think this is a good idea.  I did try to make it work that way originally, but ran into some problems, I believe with escaping of quotations.  I will try to test this soon and encourage others to as well.  If we can give it a positive review it is one less file to keep up-to-date.",
    "created_at": "2013-10-10T13:08:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177546",
    "user": "https://github.com/gutow"
}
```

I wrote the original code and think this is a good idea.  I did try to make it work that way originally, but ran into some problems, I believe with escaping of quotations.  I will try to test this soon and encourage others to as well.  If we can give it a positive review it is one less file to keep up-to-date.



---

archive/issue_comments_177547.json:
```json
{
    "body": "strongdon: I'm making an actual patch based on your suggestion. I don't see the need to write to `jmolout.txt` though...",
    "created_at": "2013-12-11T15:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177547",
    "user": "https://github.com/jdemeyer"
}
```

strongdon: I'm making an actual patch based on your suggestion. I don't see the need to write to `jmolout.txt` though...



---

archive/issue_comments_177548.json:
```json
{
    "body": "Attachment [14364_testjava.patch](tarball://root/attachments/some-uuid/ticket14364/14364_testjava.patch) by @jdemeyer created at 2013-12-11 15:18:32",
    "created_at": "2013-12-11T15:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177548",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [14364_testjava.patch](tarball://root/attachments/some-uuid/ticket14364/14364_testjava.patch) by @jdemeyer created at 2013-12-11 15:18:32



---

archive/issue_comments_177549.json:
```json
{
    "body": "Attempting to push the ```14364_testjava.patch\u200b``` to the Git Server. Let's hope this works!\n\n---\nNew commits:",
    "created_at": "2013-12-30T04:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177549",
    "user": "https://github.com/strogdon"
}
```

Attempting to push the ```14364_testjava.patch​``` to the Git Server. Let's hope this works!

---
New commits:



---

archive/issue_comments_177550.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-30T10:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177550",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_177551.json:
```json
{
    "body": "New commits:",
    "created_at": "2013-12-30T10:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177551",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_events_040742.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14160#event-40742"
}
```



---

archive/issue_events_040743.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14160#event-40743"
}
```



---

archive/issue_events_040744.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14160#event-40744"
}
```



---

archive/issue_events_040745.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14160#event-40745"
}
```



---

archive/issue_comments_177552.json:
```json
{
    "body": "[ping]\n\nIs there anything to test beyond (re)installing the spkg and testing `src/sage/interfaces/jmoldata.py`?\n\nIf not, works for me...",
    "created_at": "2014-06-12T08:29:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177552",
    "user": "https://github.com/nexttime"
}
```

[ping]

Is there anything to test beyond (re)installing the spkg and testing `src/sage/interfaces/jmoldata.py`?

If not, works for me...



---

archive/issue_comments_177553.json:
```json
{
    "body": "Ok, I was finally able to test, and it works.\n\nI think reinstalling the spkg won't do the trick for a review, because you'll still have testjava.sh from the previous installation (sage-as-a-distribution doesn't have uninstallation if I don't err). And you'll also need to recompile the sagelib since one of the files has been modified.",
    "created_at": "2014-06-13T16:51:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177553",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Ok, I was finally able to test, and it works.

I think reinstalling the spkg won't do the trick for a review, because you'll still have testjava.sh from the previous installation (sage-as-a-distribution doesn't have uninstallation if I don't err). And you'll also need to recompile the sagelib since one of the files has been modified.



---

archive/issue_comments_177554.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-13T16:51:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177554",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_177555.json:
```json
{
    "body": "Hmm...maybe I need to include this in the updated jmol.spkg I'm building? I expect to have some time to devote to that over the next few days.  I'll try plugging this into the new code.\n\nReplying to [comment:23 Snark]:\n> Ok, I was finally able to test, and it works.\n> \n> I think reinstalling the spkg won't do the trick for a review, because you'll still have testjava.sh from the previous installation (sage-as-a-distribution doesn't have uninstallation if I don't err). And you'll also need to recompile the sagelib since one of the files has been modified.",
    "created_at": "2014-06-13T19:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177555",
    "user": "https://github.com/gutow"
}
```

Hmm...maybe I need to include this in the updated jmol.spkg I'm building? I expect to have some time to devote to that over the next few days.  I'll try plugging this into the new code.

Replying to [comment:23 Snark]:
> Ok, I was finally able to test, and it works.
> 
> I think reinstalling the spkg won't do the trick for a review, because you'll still have testjava.sh from the previous installation (sage-as-a-distribution doesn't have uninstallation if I don't err). And you'll also need to recompile the sagelib since one of the files has been modified.



---

archive/issue_comments_177556.json:
```json
{
    "body": "The fix for this ticket is two patches:\n* one to detect java directly in sagelib ;\n* the other to remove testjava.sh from the build/pkgs/jmol/ data.\n\nIf they go in, doesn't it update things (in particular the spkg) correctly and automatically?",
    "created_at": "2014-06-13T20:13:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177556",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

The fix for this ticket is two patches:
* one to detect java directly in sagelib ;
* the other to remove testjava.sh from the build/pkgs/jmol/ data.

If they go in, doesn't it update things (in particular the spkg) correctly and automatically?



---

archive/issue_comments_177557.json:
```json
{
    "body": "I believe so, but if I do not fix the updated .spkg it may reinstall testjava.sh, although it would not get used.  I will make sure my update is compatible.  I too think this ticket is fine.  I just have to make my end work well with it.\n\nReplying to [comment:25 Snark]:\n\n> If they go in, doesn't it update things (in particular the spkg) correctly and automatically?",
    "created_at": "2014-06-13T21:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177557",
    "user": "https://github.com/gutow"
}
```

I believe so, but if I do not fix the updated .spkg it may reinstall testjava.sh, although it would not get used.  I will make sure my update is compatible.  I too think this ticket is fine.  I just have to make my end work well with it.

Replying to [comment:25 Snark]:

> If they go in, doesn't it update things (in particular the spkg) correctly and automatically?



---

archive/issue_comments_177558.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-15T15:24:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14160#issuecomment-177558",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_040746.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-15T15:24:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14160",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14160#event-40746"
}
```
