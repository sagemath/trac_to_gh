# Issue 21366: Update GCC

Issue created by migration from https://trac.sagemath.org/ticket/21603

Original creator: jpflori

Original creation time: 2016-09-27 09:16:43

CC:  leif fbissey jdemeyer vbraun

We currently ship 4.9.3 which is quite old.


---

Comment by jdemeyer created at 2016-09-27 14:36:24

Which version do you have in mind?


---

Comment by jpflori created at 2016-09-29 09:44:43

Would 6.2 be too adventurous?


---

Comment by jdemeyer created at 2016-09-29 11:41:33

Replying to [comment:2 jpflori]:
> Would 6.2 be too adventurous?

There is only one way to find out :-)


---

Comment by jpflori created at 2016-09-29 13:53:53

Changing status from new to needs_review.


---

Comment by jpflori created at 2016-09-29 13:53:53

New commits:


---

Comment by leif created at 2016-09-29 21:57:21

Replying to [comment:2 jpflori]:
> Would 6.2 be too adventurous?

See also #20350.


---

Comment by leif created at 2016-09-29 21:57:56

4.9.4 is out since a while, too, by the way. ;-)


---

Comment by jdemeyer created at 2016-11-04 21:21:03

Works for me.


---

Comment by jdemeyer created at 2016-11-04 21:21:13

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2016-11-05 15:41:58

On OS X Sierra, this works if I merge #21567. If I merge instead with the 7.5.beta0 branch, it doesn't:

```
***************************************************************
Error building Sage.

The following package(s) may have failed to build (not necessarily
during this run of 'make all'):

* package: libfplll-5.0.3rc0
```

Here is the tail end of the (serial) build log for libfplll:

```
libtool: compile:  g++ -DHAVE_CONFIG_H -I. -I.. -DFPLLL_DEFAULT_STRATEGY_PATH=\"/Users/palmieri/Desktop/TESTING/sage-7.5.beta0/local/share/fplll/strategies\" -DFPLLL_DEFAULT_STRATEGY=\"/Users/palmieri/Desktop/TESTING/sage-7.5.beta0/local/share/fplll/strategies/default.json\" -I./.. -I/Users/palmieri/Desktop/TESTING/sage-7.5.beta0/local/include/ -fPIC -I/Users/palmieri/Desktop/TESTING/sage-7.5.beta0/local/include/ -L/Users/palmieri/Desktop/TESTING/sage-7.5.beta0/local/lib -O3 -MT gso.lo -MD -MP -MF .deps/gso.Tpo -c gso.cpp -o gso.o >/dev/null 2>&1
depbase=`echo pruner.lo | sed 's|[^/]*$|.deps/&|;s|\.lo$||'`;\
	/bin/sh ../libtool  --tag=CXX   --mode=compile g++ -DHAVE_CONFIG_H -I. -I..  -DFPLLL_DEFAULT_STRATEGY_PATH=\"/Users/palmieri/Desktop/TESTING/sage-7.5.beta0/local/share/fplll/strategies\" -DFPLLL_DEFAULT_STRATEGY=\"/Users/palmieri/Desktop/TESTING/sage-7.5.beta0/local/share/fplll/strategies/default.json\" -I./.. -I/Users/palmieri/Desktop/TESTING/sage-7.5.beta0/local/include/  -fPIC -I/Users/palmieri/Desktop/TESTING/sage-7.5.beta0/local/include/ -L/Users/palmieri/Desktop/TESTING/sage-7.5.beta0/local/lib -O3 -MT pruner.lo -MD -MP -MF $depbase.Tpo -c -o pruner.lo pruner.cpp &&\
	mv -f $depbase.Tpo $depbase.Plo
libtool: compile:  g++ -DHAVE_CONFIG_H -I. -I.. -DFPLLL_DEFAULT_STRATEGY_PATH=\"/Users/palmieri/Desktop/TESTING/sage-7.5.beta0/local/share/fplll/strategies\" -DFPLLL_DEFAULT_STRATEGY=\"/Users/palmieri/Desktop/TESTING/sage-7.5.beta0/local/share/fplll/strategies/default.json\" -I./.. -I/Users/palmieri/Desktop/TESTING/sage-7.5.beta0/local/include/ -fPIC -I/Users/palmieri/Desktop/TESTING/sage-7.5.beta0/local/include/ -L/Users/palmieri/Desktop/TESTING/sage-7.5.beta0/local/lib -O3 -MT pruner.lo -MD -MP -MF .deps/pruner.Tpo -c pruner.cpp  -fno-common -DPIC -o .libs/pruner.o
pruner.cpp: In member function 'FT fplll::Pruner<FT>::single_enum_cost(const evec&) [with FT = fplll::FP_NR<long double>]':
pruner.cpp:306:31: internal compiler error: Segmentation fault: 11
 template <class FT> inline FT Pruner<FT>::single_enum_cost(/*i*/ const evec &b)
                               ^~~~~~~~~~

pruner.cpp:306:31: internal compiler error: Abort trap: 6
g++: internal compiler error: Abort trap: 6 (program cc1plus)
Please submit a full bug report,
with preprocessed source if appropriate.
See <http://gcc.gnu.org/bugs.html> for instructions.
make[5]: *** [pruner.lo] Error 1
make[4]: *** [all] Error 2
make[3]: *** [all-recursive] Error 1
make[2]: *** [all] Error 2
Error building fplll
```



---

Comment by jhpalmieri created at 2016-11-05 18:17:24

Same happens with 7.5.beta1. I'm going to set this to "needs work", but feel free to change it back if I've missed something.


---

Comment by jhpalmieri created at 2016-11-05 18:17:24

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2016-11-06 10:03:30

Given that we all seem to agree that upgrading GCC is a good thing to do, should we try GCC 5.4 instead?


---

Comment by fbissey created at 2016-11-06 10:22:11

Hum... I am not sure what differences between 7.4 and 7.5.beta0 could cause this. On the other hand I would try to upgrade fplll to 5.0.3, there are a few QA fix that I think may just be related.


---

Comment by rws created at 2016-11-06 16:37:13

If this works with #21567 is there a need to change the gcc version? Just depend on #21567.


---

Comment by jhpalmieri created at 2016-11-06 16:41:40

Replying to [comment:13 fbissey]:
> Hum... I am not sure what differences between 7.4 and 7.5.beta0 could cause this. On the other hand I would try to upgrade fplll to 5.0.3, there are a few QA fix that I think may just be related.

If you can provide a tarball for a different version of fplll, I am happy to test it.


---

Comment by git created at 2016-11-06 18:40:18

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2016-11-06 18:40:48

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2016-11-06 22:34:14

Now everything builds for me.


---

Comment by jhpalmieri created at 2016-11-06 23:30:25

So if it's okay with everyone else to use GCC 5.4.0 instead of 6.2.0, positive review.


---

Comment by rws created at 2016-11-07 07:00:54

Fine with me.


---

Comment by rws created at 2016-11-07 07:00:54

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-11-08 23:42:22

Resolution: fixed
