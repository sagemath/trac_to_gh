# Issue 18921: Undo the breaking of old-style packages

Issue created by migration from https://trac.sagemath.org/ticket/19158

Original creator: jdemeyer

Original creation time: 2015-09-07 20:28:29

CC:  ncohen vbraun jhpalmieri

This is really really bad:

```
$ ./sage -i chomp
Attempting to download package chomp
Error: could not find a package matching chomp
       Try 'sage --package list' to see the available packages
       Did you mean: csdp, gmp, cbc, cmake, cvxopt?
```



---

Comment by vbraun created at 2015-09-07 21:21:27

IMHO the only thing that needs to be done is make chomp a new-style package.

The mixture of old and new packages has always been broken. Let it die. We can support old packages as legacy but not mash it up with new packages in an utterly confusing manner to users.


---

Comment by jdemeyer created at 2015-09-08 06:23:54

1. There has been no deprecation at all for this, which really goes against Sage's 1-year deprecation policy. You cannot just break user's work flows like this.

2. Old-style packages still appear in various places in the documentation:

- Various places document `sage -i chomp` (or other old-style packages)
- `sage --optional` shows both new-style and old-style packages
- We even have a page in the developer documentation about creating old-style packages.


---

Comment by vbraun created at 2015-09-08 07:28:14

1. There is no deprecation period for fixing bugs.
2. The documentation should be fixed (Often we should just point people towards pip; Suggesting some ancient unmaintained spkg is yet another bug in itself)


---

Comment by jdemeyer created at 2015-09-08 07:36:46

Replying to [comment:4 vbraun]:
> 1. There is no deprecation period for fixing bugs.
The fact that `sage -i chomp` used to install `chomp` is a bug??


---

Comment by vbraun created at 2015-09-08 08:09:23

That `sage -i python` used to install an ancient Python is a bug. That the undesirable behavior of silently installing ancient packages happened to be somewhat(1) desirable for chomp doesn't make it less of a bug.

(1) The chomp spkg actually doesn't compile with modern gcc due to tighter C++ checking

```
../include/capd/matrixAlgorithms/floatMatrixAlgorithms.hpp:245:159: error: redeclaration of 'template<class MatrixType> int chomp::matrixAlgorithms::symMatrixDiagonalize(const MatrixType&, MatrixType&, typename MatrixType::ScalarType)' may not have default arguments [-fpermissive]
 int symMatrixDiagonalize(const MatrixType& A, MatrixType& D, typename MatrixType::ScalarType diagonalizingRelTolerance = typename MatrixType::ScalarType(1e-5))
                                                                                                                                                               ^
../include/capd/matrixAlgorithms/floatMatrixAlgorithms.hpp:326:177: error: redeclaration of 'template<class MatrixType> typename MatrixType::ScalarType chomp::matrixAlgorithms::spectralRadiusOfSymMatrix(const MatrixType&, typename MatrixType::ScalarType)' may not have default arguments [-fpermissive]
```



---

Comment by jdemeyer created at 2015-09-08 08:14:52

Replying to [comment:6 vbraun]:
> That `sage -i python` used to install an ancient Python is a bug.
Agreed. But #19004 wasn't the right fix.

> That the undesirable behavior of silently installing ancient packages happened to be somewhat(1) desirable for chomp doesn't make it less of a bug.
This ticket isn't about `chomp` at all, I'm just using that package as one example of an old-style package.


---

Comment by vbraun created at 2015-09-08 08:40:53

IMHO we should have removed old spkgs a long time ago. It was ok during the transition period but has been causing us constant pain since then. We are much better of with #19004 than without. For every old-style package that you might actually want to install I can name you ten that are going to get in the way if you accidentally install them.


---

Comment by jdemeyer created at 2015-09-08 09:57:26

Replying to [comment:8 vbraun]:
> IMHO we should have removed old spkgs a long time ago.
But we didn't, so we are currently stuck with them.

> It was ok during the transition period but has been causing us constant pain since then.
Maybe, but like I said: #19004 isn't the solution. The solution is warning users that they are installing old-style packages with a proper deprecation warning.


---

Comment by vbraun created at 2015-09-08 10:20:53

Replying to [comment:9 jdemeyer]:
> Maybe, but like I said: #19004 isn't the solution. The solution is warning users that they are installing old-style packages with a proper deprecation warning.

No, the solution is to not install broken/deprecated packages. Or, rather, make it difficult enough so that nobody does it accidentally.


---

Comment by jdemeyer created at 2015-09-08 11:50:11

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-09-08 11:50:11

New commits:


---

Comment by vbraun created at 2015-09-08 11:57:30

I'm against


---

Comment by jdemeyer created at 2015-09-08 11:59:56

Replying to [comment:13 vbraun]:
> I'm against

Well, I am against #19004.

Is there any compromise possible? A solution which still allows users to install old-style packages?


---

Comment by vbraun created at 2015-09-08 20:58:23

You can install old-style packages, they just aren't searched for. If you want to try to compile chomp just run e.g.

```
sage -f http://files.sagemath.org/spkg/optional/chomp-20130518.p1.spkg
```



---

Comment by jdemeyer created at 2015-09-08 21:25:02

Replying to [comment:15 vbraun]:
> You can install old-style packages, they just aren't searched for.

That's "you can" for a very dubious value of "can". To users, it really looks like the package is completely gone.


---

Comment by vbraun created at 2015-09-08 21:59:43

And thats good because they are either huge nuisances (like "python") or just broken.


---

Comment by jdemeyer created at 2015-09-09 07:32:13

We obviously cannot resolve this here, so I'm writing to sage-devel.


---

Comment by jhpalmieri created at 2015-09-11 18:31:33

As I said on #19105, you shouldn't search "standard" packages on-line.


---

Comment by jdemeyer created at 2015-09-11 21:39:53

Replying to [comment:20 jhpalmieri]:
> As I said on #19105, you shouldn't search "standard" packages on-line.
Sure, that's an easy change (although not very relevant if we merge #19105).

But I'm confused by your comment. Does it imply you're in favour of this ticket now?


---

Comment by jhpalmieri created at 2015-09-11 22:26:54

I don't think I ever said I wasn't in favor of it. My last post on the sage-devel thread said, "I could also be easily persuaded to (B) if we don't allow "sage -i python" to install the old python-2.5 package."


---

Comment by git created at 2015-09-14 08:22:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-09-14 08:44:44

Replying to [comment:22 jhpalmieri]:
> My last post on the sage-devel thread said, "I could also be easily persuaded to (B) if we don't allow "sage -i python" to install the old python-2.5 package."

Great! My last commit does that, since we no longer look for standard packages:

```
Attempting to download package python
>>> Checking online list of optional packages.
>>> Checking online list of experimental packages.
>>> Checking online list of huge packages.
Error: could not find a package matching python
       Try 'sage --package list' to see the available packages
       Did you mean: cython, ipython, python2, python3, patch?
```



---

Comment by jdemeyer created at 2015-09-14 08:51:14

Given William Stein's support, I am still very convinced that we should move forward with this ticket.


---

Comment by tscrim created at 2015-09-15 19:29:42

I was able to install (old-style) chomp without any problems with this ticket. Moreover it doesn't let me install python. Overall I'm ready to set this to positive review except for an interface question.

Could we add an option to the warning that if the user presses Y or enter (after perhaps a mandatory 5 second reading period) that the old-style spkg installs? If this is too difficult, then could we drop the sleep to 15 seconds or so (it's not that long of a message)?


---

Comment by git created at 2015-09-15 20:57:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-09-15 21:10:23

LGTM. Thanks!


---

Comment by tscrim created at 2015-09-15 21:10:23

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-09-15 22:24:12

Urgh thats so ugly I just threw up in my mouth a little. Ever wondered why none of the gnu coreutils does the ask + timeout? 

I expect you to fix the topcom/TOPCOM issue and do something about the totally broken packages.


---

Comment by jhpalmieri created at 2015-09-16 02:54:07

Replying to [comment:29 vbraun]:
> I expect you to fix the topcom/TOPCOM issue and do something about the totally broken packages.

See #19220 for `TOPCOM`. That and `python` are the two serious problems with old-style packages, as far as I understand. Other old-style packages may be broken, but that's not new. I don't know of any other packages which will break the Sage installation if you try to install them.


---

Comment by tscrim created at 2015-09-16 03:02:48

Python is handled on #19105.


---

Comment by vbraun created at 2015-09-16 07:54:05

Well somebody has to go through the list. Fun things:
* kash3 is binary-only. Somehow that wasn't OK for gap3 but you just re-enabled another optional binary-only package.
* Anything that is pip installable is wayyy outdated, terrible UX to just use ancient cruft even if it works. Nobody even made a list of which packages fall in that category
* The undocumented: soya_cvs-2006.05.09.spkg has no SPKG.txt, wtf is it and why is it a 9-year old cvs snapshot?

And by "somebody", I mean somebody who was is favor of this ticket.


---

Comment by vbraun created at 2015-09-16 18:31:29

Resolution: fixed
