# Issue 15766: update Jmol spkg  to support pure javascript 3-D in notebook...

Issue created by migration from https://trac.sagemath.org/ticket/16003

Original creator: gutow

Original creation time: 2014-03-24 00:42:12

CC:  kcrisman novoselt strogdon fbissey

Keywords: Jmol 3D 3-D

Update Jmol to Jmol-14.0.11 which supplies the JSmol pure javascript version of Jmol.  Utilizing this requires significant changes to how the notebook utilizes Jmol/JSmol.  The notebook changes are in ticket  XXXX (haven't made yet).

In addition to the updates to the new-style SPKG, the tar.gz from Jmol needs to be renamed before it matches the Sage standards.  The Jmol project distributes a large number of different archives.  The appropriate one for this SPKG is the Jmol-14.0.11-binary.tar.gz, which needs to be renamed to Jmol-14.0.11.tar.gz.

This will break the current Jmol in the notebook as a serious reorganization of supporting files was required to support both java and javascript live 3-D.


---

Comment by gutow created at 2014-03-24 01:30:48

Set assignee to gutow.


---

Comment by gutow created at 2014-03-24 01:30:48

New commits:


---

Comment by gutow created at 2014-03-24 01:31:16

Changing status from new to needs_review.


---

Comment by chapoton created at 2014-03-28 20:10:21

some typos : "privides" and "supposted"


---

Comment by chapoton created at 2014-03-28 20:10:21

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-04-05 05:07:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by gutow created at 2014-04-05 05:08:05

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2014-04-08 01:32:52

Of course, on Macs

```
The appropriate one for this SPKG is the Jmol-14.0.11-binary.tar.gz, which needs to be renamed to jmol-14.0.11.tar.gz (note the lower case "j").
```

doesn't really do that much, since it is only fictively case-sensitive :-)

Okay, trying to look into this between much grading and other stuff.


---

Comment by kcrisman created at 2014-04-10 02:59:09

I should point out that the command-line Jmols work just fine with this; it's the notebook piece that requires more review (as well as testing on some other platforms).


---

Comment by git created at 2014-04-21 01:18:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by strogdon created at 2014-04-23 18:17:19

Minor item. It appears jmol version and release date are hardcoded somewhere, probably in `SageMenu.mnu` and I guess should be changed to 14.0.13 and whatever the appropriate release date is. I see this when right-clicking on a live jmol and mousing to About -> Jmol


---

Comment by chapoton created at 2014-08-10 11:30:41

Hello,

I have rebased on 6.3.rc1.

By the way, in #12212, I have asked the jmol team for a change to handle colored surfaces. Maybe it would be worth waiting for that, if this does not takes too long.
----
New commits:


---

Comment by kcrisman created at 2014-08-11 03:05:11

> By the way, in #12212, I have asked the jmol team for a change to handle colored surfaces. Maybe it would be worth waiting for that, if this does not takes too long.

Referring to [comment:48:ticket:12212 this comment].


---

Comment by kcrisman created at 2014-08-11 08:54:01

See comment:54:ticket:12212 where
> Later this week it will appear in Jmol 14.2.5.
So probably this one could be even further updated in time for Sage 6.4, which has started its cycle.


---

Comment by chapoton created at 2014-08-20 07:53:40

According to Robert Hanson, the 18th of August 2014, 

the change useful for #12212 is now in Jmol 14.3.6 here :

https://sourceforge.net/projects/jmol/files/Jmol-beta/Jmol%2014.3/Jmol%2014.3.6/

(which seems to be a beta version).


---

Comment by kcrisman created at 2014-08-20 19:40:43

> According to Robert Hanson, the 18th of August 2014, 
> 
> the change useful for #12212 is now in Jmol 14.3.6 here :
> 
> https://sourceforge.net/projects/jmol/files/Jmol-beta/Jmol%2014.3/Jmol%2014.3.6/
> 
> (which seems to be a beta version).

Given that #12212 maybe still needs a tiny bit of care and that probably the jmol support should be a separate ticket, maybe it's easier to just review this "as is".


---

Comment by kcrisman created at 2014-08-20 20:06:36

> Minor item. It appears jmol version and release date are hardcoded somewhere, probably in `SageMenu.mnu` and I guess should be changed to 14.0.13 and whatever the appropriate release date is. I see this when right-clicking on a live jmol and mousing to About -> Jmol
You are correct, that will have to be hand-edited whenever we decide the final version here.

Also, this needs to be updated for #14364 now, it seems.  I made the change to my local one but I'm not sure if I made a mistake in merging this one - I'm surprised it showed up again for some reason.


---

Comment by kcrisman created at 2014-08-21 17:34:32

I see what happened - chapoton rebased with keeping the testjava.sh stuff in spkg-install but we don't need that any more.


---

Comment by kcrisman created at 2014-08-21 18:33:22

I hope I didn't screw this up.
----
New commits:


---

Comment by kcrisman created at 2014-08-21 18:47:17

Hi strogdon,
> > Minor item. It appears jmol version and release date are hardcoded somewhere, probably in `SageMenu.mnu` and I guess should be changed to 14.0.13 and whatever the appropriate release date is. I see this when right-clicking on a live jmol and mousing to About -> Jmol
> You are correct, that will have to be hand-edited whenever we decide the final version here.
Weirdly, I do not see this problem when using a Jmol (from command line, of course) - it seems to acquire the correct info from system itself.  So in principle we don't even have to change this.

I think this is ready for positive review as long as it actually applies properly, and of course pending #16004 or some variant thereof.


---

Comment by chapoton created at 2014-08-25 20:01:40

Latest available version is now Jmol-14.2.4_2014.08.03-binary.tar.gz

at http://sourceforge.net/projects/jmol/files/Jmol/Version%2014.2/Version%2014.2.4/


---

Comment by kcrisman created at 2014-08-25 20:42:00

> Latest available version is now Jmol-14.2.4_2014.08.03-binary.tar.gz
Do you see any substantive differences between this and that?  (I assume it doesn't have the #12212 change in any case.)
> Weirdly, I do not see this problem when using a Jmol (from command line, of course) - it seems to acquire the correct info from system itself. So in principle we don't even have to change this.
This is about `SageMenu.mnu` - in the notebook Jmols it also finds this info fine until we switch to the custom one, very weird.  I'm trying to figure out where that `.mnu` file is defined but the one at the Jmol website is clearly several (major) versions out of date.

Ah, found it - `local/share/jsmol/j2s/core/coremenu.z.js`.  Naughty!  But even the untranslated `local/share/jsmol/js/coremenu.js` seems to be getting this info dynamically in some way I'm not going to figure out immediately.  So I'm going to do the easy fix to that for now.


---

Comment by git created at 2014-08-25 20:55:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2014-09-21 20:44:09

"unzip" is not one of our build-time dependencies so far: http://www.sagemath.org/doc/installation/source.html#general-requirements I'm not terribly concerned about that one, but this is why I went a different route in #17020. But if you want to require unzip then it should be documented.

Why does this ticket depend on #16004? We should merge the jmol update asap, no need to wait as long as it doesn't break something that is currently working. Anything related to jsmol can then be dealt with in #16004 if necessary.


---

Comment by kcrisman created at 2014-09-22 13:29:29

As the description points out:
> This will break the current Jmol in the notebook as a serious reorganization of supporting files was required to support both java and javascript live 3-D.
To say this more clearly, I believe the new jmol interface uses js even for Java applets when used on the web (not command line), so one would have to reorganize in any case.  Also, I don't know that there are enough other goodies to make the Jmol update worthwhile, per se.


---

Comment by chapoton created at 2014-09-22 18:30:35

Well, new features in Jmol would be needed for #12212, but it requires Jmol 14.2.5.


---

Comment by vbraun created at 2014-09-22 19:41:21

The notebook jmol viewer is working with #17020, and I suspect it is also working with this ticket. Of course not in chrome, which has by now permanently kicked the old java applet to the curb. Works in firefox with the icedtea plugin, though.

Unless somebody objects I would propose that we make a modified tarball that does not require unzip, that is, by re-packing the upstream tarball.

Frederic, it seems that 14.2.5 is not out yet? Since you seem to know upstream, maybe you can suggest that they put jsmol uncompressed inside their archive, and not a zip-with-tar file.


---

Comment by chapoton created at 2014-09-22 19:59:57

Yes, the changes for #12212 are not yet in a release, they are in fact in there:

http://sourceforge.net/projects/jmol/files/Jmol-beta/Jmol%2014.3/Jmol%2014.3.6/

I am not sure to know "upstream". I have had a private mail exchange about #12212 with somebody who was very reactive and efficient, and had the power to include changes in the latest jmol beta. I can give you his name and mail if you send me a private mail.


---

Comment by kcrisman created at 2014-09-22 20:42:50

> The notebook jmol viewer is working with #17020, and I suspect it is also working with this ticket. Of course not in chrome, which has by now permanently kicked the old java applet to the curb. Works in firefox with the icedtea plugin, though.

Huh, that's surprising, Jonathan made it sound like the interface had changed enough that it wouldn't.  We're even having trouble with icedtea here at AIMS in any case :-(

> Unless somebody objects I would propose that we make a modified tarball that does not require unzip, that is, by re-packing the upstream tarball.

That seems reasonable; Jonathan, did you have a reason for including that?  Maybe it's just because that's how upstream packages it...


---

Comment by strogdon created at 2014-09-22 21:01:31

Replying to [comment:36 vbraun]:
> The notebook jmol viewer is working with #17020, and I suspect it is also working with this ticket. Of course not in chrome, which has by now permanently kicked the old java applet to the curb. Works in firefox with the icedtea plugin, though.
> 
Maybe I misunderstand but just upgrading jmol as in #17020 without doing anything else break jmol in the notebook here. This is with firefox and either icedtea or oracle plugin.


---

Comment by vbraun created at 2014-09-23 08:22:09

As far as I understand, the 14.3.x series is the current beta and 14.2.x is the stable branch. E.g. look at the SF download page http://sourceforge.net/projects/jmol/files/


---

Comment by vbraun created at 2014-09-23 08:24:58

Also, why is 

```
+ * JVM (java virtual machine) on the server.
```

added to the dependencies?


---

Comment by vbraun created at 2014-09-23 09:24:59

Ok, I can confirm that the jmol upgrade does not work with the current notebook. I must have had the wrong version installed.


---

Comment by gutow created at 2014-09-26 00:53:48

Replying to [comment:41 vbraun]:
> Also, why is 
> {{{
> + * JVM (java virtual machine) on the server.
> }}}
> added to the dependencies?
Tried to answer this a few days ago, but it didn't go through.  The JVM allows the server to run a headless version of Jmol to generate high quality static images.  If the JVM is not available things default to the lower quality Tachyon images (with some work those cold be made better).  The other reason to keep this is that if I ever finish sorting out the issues caused by the attempts to kill Java applets in browsers, I can begin to utilize this server-side engine to make much more efficient and adaptable packages of data to send to the browser for viewing.


---

Comment by vbraun created at 2014-09-26 17:40:00

But its still not a build requirement for jmol, right? Only a (optional) runtime dependency of sagenb.


---

Comment by vbraun created at 2014-10-05 15:03:56

I propose to close this ticket as duplicate of #17020. I imported all commits there, but switched to the different packaging that does not require `unzip`.


---

Comment by kcrisman created at 2014-10-07 14:09:33

Sure, no problem, that makes perfect sense, as long as #17020 works out fine :-)


---

Comment by kcrisman created at 2014-10-07 14:09:33

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-10-13 15:49:53

Resolution: duplicate
