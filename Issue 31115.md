# Issue 31115: Make "sage -t -all" more robust, in particular when SAGE_SRC is SAGE_LIB

archive/issues_031115.json:
```json
{
    "body": "CC:  @isuruf @jhpalmieri @fchapoton @seblabbe\n\nObserved on conda:\n\n```\n$ sage -t --all\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2021-02-06-16-05-28-bc4dacc2.\nUsing --optional=dochtml,pip,sage\nDoctesting entire Sage library.\nTraceback (most recent call last):\n  File \"/Users/mkoeppe/miniconda3/envs/sage/bin/sage-runtests\", line 182, in <module>\n    err = DC.run()\n  File \"/Users/mkoeppe/miniconda3/envs/sage/lib/python3.9/site-packages/sage/doctest/control.py\", line 1234, in run\n    self.expand_files_into_sources()\n  File \"/Users/mkoeppe/miniconda3/envs/sage/lib/python3.9/site-packages/sage/doctest/control.py\", line 817, in expand_files_into_sources\n    self.sources = [FileDocTestSource(path, self.options) for path in expand()]\n  File \"/Users/mkoeppe/miniconda3/envs/sage/lib/python3.9/site-packages/sage/doctest/control.py\", line 817, in <listcomp>\n    self.sources = [FileDocTestSource(path, self.options) for path in expand()]\n  File \"/Users/mkoeppe/miniconda3/envs/sage/lib/python3.9/site-packages/sage/doctest/sources.py\", line 528, in __init__\n    raise ValueError(\"unknown file extension %r\"%ext)\nValueError: unknown file extension ''\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/31352\n\n",
    "created_at": "2021-02-07T00:10:04Z",
    "labels": [
        "doctest framework",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Make \"sage -t -all\" more robust, in particular when SAGE_SRC is SAGE_LIB",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31115",
    "user": "@mkoeppe"
}
```
CC:  @isuruf @jhpalmieri @fchapoton @seblabbe

Observed on conda:

```
$ sage -t --all
too many failed tests, not using stored timings
Running doctests with ID 2021-02-06-16-05-28-bc4dacc2.
Using --optional=dochtml,pip,sage
Doctesting entire Sage library.
Traceback (most recent call last):
  File "/Users/mkoeppe/miniconda3/envs/sage/bin/sage-runtests", line 182, in <module>
    err = DC.run()
  File "/Users/mkoeppe/miniconda3/envs/sage/lib/python3.9/site-packages/sage/doctest/control.py", line 1234, in run
    self.expand_files_into_sources()
  File "/Users/mkoeppe/miniconda3/envs/sage/lib/python3.9/site-packages/sage/doctest/control.py", line 817, in expand_files_into_sources
    self.sources = [FileDocTestSource(path, self.options) for path in expand()]
  File "/Users/mkoeppe/miniconda3/envs/sage/lib/python3.9/site-packages/sage/doctest/control.py", line 817, in <listcomp>
    self.sources = [FileDocTestSource(path, self.options) for path in expand()]
  File "/Users/mkoeppe/miniconda3/envs/sage/lib/python3.9/site-packages/sage/doctest/sources.py", line 528, in __init__
    raise ValueError("unknown file extension %r"%ext)
ValueError: unknown file extension ''
```


Issue created by migration from https://trac.sagemath.org/ticket/31352





---

archive/issue_comments_444446.json:
```json
{
    "body": "I think the relevant line is https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/doctest/sources.py?h=9.3.beta7#n527. Changing this to a print statement might be good enough, and this worked in a simple test, but I'm not sure. I would feel more comfortable if, when an invalid file extension pops up, we explicitly tell the doctester to not test it, but maybe the other parts of the `__init__` method take care of that somehow.",
    "created_at": "2021-02-23T21:23:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31115#issuecomment-444446",
    "user": "@jhpalmieri"
}
```

I think the relevant line is https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/doctest/sources.py?h=9.3.beta7#n527. Changing this to a print statement might be good enough, and this worked in a simple test, but I'm not sure. I would feel more comfortable if, when an invalid file extension pops up, we explicitly tell the doctester to not test it, but maybe the other parts of the `__init__` method take care of that somehow.



---

archive/issue_comments_444447.json:
```json
{
    "body": "Related: #32813",
    "created_at": "2021-11-02T19:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31115#issuecomment-444447",
    "user": "@mkoeppe"
}
```

Related: #32813



---

archive/issue_comments_444448.json:
```json
{
    "body": "I did one more commit in #32813 to also show the filename in the error message and not only the wrong extension. So it should cover the goal of this ticket too.",
    "created_at": "2021-11-03T11:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31115#issuecomment-444448",
    "user": "@seblabbe"
}
```

I did one more commit in #32813 to also show the filename in the error message and not only the wrong extension. So it should cover the goal of this ticket too.



---

archive/issue_comments_444449.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-23T18:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31115#issuecomment-444449",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_444450.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-24T23:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31115#issuecomment-444450",
    "user": "@jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_444451.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2022-02-26T18:53:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31115#issuecomment-444451",
    "user": "@mkoeppe"
}
```

Resolution: invalid
