# Issue 31115: Make "sage -t -all" more robust, in particular when SAGE_SRC is SAGE_LIB

Issue created by migration from https://trac.sagemath.org/ticket/31352

Original creator: mkoeppe

Original creation time: 2021-02-07 00:10:04

CC:  isuruf jhpalmieri chapoton slabbe

Observed on conda:

```
$ sage -t --all
too many failed tests, not using stored timings
Running doctests with ID 2021-02-06-16-05-28-bc4dacc2.
Using --optional=dochtml,pip,sage
Doctesting entire Sage library.
Traceback (most recent call last):
  File "/Users/mkoeppe/miniconda3/envs/sage/bin/sage-runtests", line 182, in <module>
    err = DC.run()
  File "/Users/mkoeppe/miniconda3/envs/sage/lib/python3.9/site-packages/sage/doctest/control.py", line 1234, in run
    self.expand_files_into_sources()
  File "/Users/mkoeppe/miniconda3/envs/sage/lib/python3.9/site-packages/sage/doctest/control.py", line 817, in expand_files_into_sources
    self.sources = [FileDocTestSource(path, self.options) for path in expand()]
  File "/Users/mkoeppe/miniconda3/envs/sage/lib/python3.9/site-packages/sage/doctest/control.py", line 817, in <listcomp>
    self.sources = [FileDocTestSource(path, self.options) for path in expand()]
  File "/Users/mkoeppe/miniconda3/envs/sage/lib/python3.9/site-packages/sage/doctest/sources.py", line 528, in __init__
    raise ValueError("unknown file extension %r"%ext)
ValueError: unknown file extension ''
```



---

Comment by jhpalmieri created at 2021-02-23 21:23:40

I think the relevant line is https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/doctest/sources.py?h=9.3.beta7#n527. Changing this to a print statement might be good enough, and this worked in a simple test, but I'm not sure. I would feel more comfortable if, when an invalid file extension pops up, we explicitly tell the doctester to not test it, but maybe the other parts of the `__init__` method take care of that somehow.


---

Comment by mkoeppe created at 2021-11-02 19:58:35

Related: #32813


---

Comment by slabbe created at 2021-11-03 11:41:40

I did one more commit in #32813 to also show the filename in the error message and not only the wrong extension. So it should cover the goal of this ticket too.


---

Comment by mkoeppe created at 2022-02-23 18:47:47

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2022-02-24 23:21:57

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-02-26 18:53:04

Resolution: invalid
