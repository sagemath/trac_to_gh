# Issue 33153: singular spkg-configure.m4: Better test for help

Issue created by migration from https://trac.sagemath.org/ticket/33390

Original creator: mkoeppe

Original creation time: 2022-02-20 21:47:47

CC:  dimpase strogdon mjo

As reported in https://groups.google.com/g/sage-release/c/vxYHQA6LUGw/m/_LO2GLLlAAAJ, the current test is not suitable on some systems.



---

Comment by strogdon created at 2022-02-21 02:16:20

Perhaps something like

```diff
diff --git a/build/pkgs/singular/spkg-configure.m4 b/build/pkgs/singular/spkg-configure.m4
index 0f629e4d31..95a67f79bc 100644
--- a/build/pkgs/singular/spkg-configure.m4
+++ b/build/pkgs/singular/spkg-configure.m4
@@ -6,7 +6,7 @@ SAGE_SPKG_CONFIGURE([singular], [
       dnl Use pkg-config to ensure that Singular is new enough.
       PKG_CHECK_MODULES([SINGULAR], [Singular >= 4.2.1], [
        AC_MSG_CHECKING([that Singular's help is working])
-       AS_IF([test x`echo "help;" | Singular 2>&1 | grep "error\ occurred"` = x], [
+       AS_IF([test x`echo -e "system(\"--browser\", \"builtin\"); \n help;" | Singular 2>&1 | grep "error\ occurred"` = x], [
         AC_MSG_RESULT(yes)
         dnl We have Singular. Now determine the shared library path on
         dnl platforms on which sage.libs.singular needs to reload the library with RTLD_GLOBAL.
```

will work?


---

Comment by mkoeppe created at 2022-02-21 02:26:20

Yes, I think this would work


---

Comment by strogdon created at 2022-02-21 02:40:41

Let's make sure this is safe on other distros.
----
New commits:


---

Comment by strogdon created at 2022-02-21 02:40:41

Changing status from new to needs_review.


---

Comment by strogdon created at 2022-02-21 02:41:35

Replying to [comment:4 strogdon]:
> Let's make sure this is safe on other distros.
> ----
> New commits:
> ||[1d8cf65](https://git.sagemath.org/sage.git/commit?id=1d8cf659c3766902f88344e60d4e5fee44649c76)||`Update test for help docs in Singular`||
It seems good on Gentoo.


---

Comment by mkoeppe created at 2022-02-21 02:49:03

`tox -e docker-ubuntu-jammy-standard -- config.status` also looks fine.


---

Comment by mkoeppe created at 2022-02-21 02:49:03

Changing status from needs_review to positive_review.


---

Comment by mjo created at 2022-02-22 13:11:16

Changing status from positive_review to needs_work.


---

Comment by mjo created at 2022-02-22 13:11:16

Can you please use `printf` instead of `echo` here? The `-e` flag and escape sequences won't necessarily work with non-bash shells.


---

Comment by git created at 2022-02-22 21:06:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by strogdon created at 2022-02-22 21:10:56

`@`mjo let me know if not as expected. I'm so accustomed to using bash that I forget there are other shells.


---

Comment by strogdon created at 2022-02-22 21:10:56

Changing status from needs_work to positive_review.


---

Comment by mjo created at 2022-02-22 21:43:23

It worked in dash, zsh, and ksh; so good enough for me. Thanks!


---

Comment by vbraun created at 2022-02-27 12:59:37

Resolution: fixed
