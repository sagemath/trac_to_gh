# Issue 21831: Segfault when substituting NaN in symbolic expression

Issue created by migration from https://trac.sagemath.org/ticket/22068

Original creator: jdemeyer

Original creation time: 2016-12-16 09:22:55

CC:  rws


```
sage: sin(x).subs(x=RR('NaN'))
Segmentation fault
```



---

Comment by rws created at 2016-12-16 16:19:03

Changing status from new to needs_review.


---

Comment by rws created at 2016-12-16 16:19:03

New commits:


---

Comment by jdemeyer created at 2016-12-16 16:30:49

I'm not convinced about

```
if x == RR('NaN')
```

I would prefer to see a type-specific check. For example, `Integer` can never be `NaN`. And for `float` or `complex`, it seems overkill to involve the coercion model just to check whether the value is `NaN`. And for elements of `RR`, you could use the `is_NaN()` method.


---

Comment by jdemeyer created at 2016-12-16 16:30:49

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-12-16 16:31:24

You should add a doctest for `sin(x).subs(x=RR('NaN'))` which is the original issue of this ticket.


---

Comment by git created at 2016-12-17 07:47:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2016-12-17 07:48:22

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-12-19 08:39:53

Same problem for

```
sin(x).subs(x=float('NaN'))
```



---

Comment by jdemeyer created at 2016-12-19 08:39:53

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-12-19 08:44:16

By the way, a useful trick to check for `NaN` is `a != a`: that should be true exactly when `a` is `NaN`. Unfortunately, this does not currently work correctly for `RR` but it does work for `float` and `complex`.


---

Comment by git created at 2016-12-20 07:03:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2016-12-20 07:04:06

New commits:


---

Comment by rws created at 2016-12-20 07:04:06

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-12-20 07:19:29

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2016-12-20 07:19:29

I find the output `sin(NaN)` a bit strange (surely just `NaN` would be better), but anything is better than a segfault.


---

Comment by vbraun created at 2016-12-24 19:47:34

Resolution: fixed
