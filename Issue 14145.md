# Issue 14145: The cliquer spkg is patching upstream

archive/issues_014145.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  fbissey\n\nThis spkg does the following:\n1. it compiles cliquer not only as an executable, but also as a library -- here I can't help but notice that the patches do to likewise in debian look more complete [see here](http://anonscm.debian.org/gitweb/?p=debian-science/packages/cliquer.git;a=tree;f=debian/patches;h=dd20b2cb0ea811e0036506c1468cc39367ec027e;hb=HEAD) (and remember than when the header of a debian patch doesn't mention forwarding to upstream -- that means it was!)\n2. it modifies the api by making parse_input exported (non-static) -- was this forwarded upstream?\n3. it adds new functions, only for sage -- that code doesn't belong to this spkg but to sage itself!\n\nIssue created by migration from https://trac.sagemath.org/ticket/14349\n\n",
    "created_at": "2013-03-23T22:41:56Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "The cliquer spkg is patching upstream",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14145",
    "user": "Snark"
}
```
Assignee: tbd

CC:  fbissey

This spkg does the following:
1. it compiles cliquer not only as an executable, but also as a library -- here I can't help but notice that the patches do to likewise in debian look more complete [see here](http://anonscm.debian.org/gitweb/?p=debian-science/packages/cliquer.git;a=tree;f=debian/patches;h=dd20b2cb0ea811e0036506c1468cc39367ec027e;hb=HEAD) (and remember than when the header of a debian patch doesn't mention forwarding to upstream -- that means it was!)
2. it modifies the api by making parse_input exported (non-static) -- was this forwarded upstream?
3. it adds new functions, only for sage -- that code doesn't belong to this spkg but to sage itself!

Issue created by migration from https://trac.sagemath.org/ticket/14349





---

archive/issue_comments_177568.json:
```json
{
    "body": "Replying to [ticket:14349 Snark]:\n> 3. it adds new functions, only for sage\nPlease clarify how you would add these functions to Sage? They need access to the cliquer internals, so they cannot simply be added to Sage.",
    "created_at": "2013-05-24T12:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177568",
    "user": "jdemeyer"
}
```

Replying to [ticket:14349 Snark]:
> 3. it adds new functions, only for sage
Please clarify how you would add these functions to Sage? They need access to the cliquer internals, so they cannot simply be added to Sage.



---

archive/issue_comments_177569.json:
```json
{
    "body": "I don't remember the details, but I think it was a case of bad use of static variables ; so probably helping upstream get around that is a better route.\n\n(That involves putting those variables in a params structure which gets passed around. Perhaps with some getter/setter api for the new structure.)",
    "created_at": "2013-05-24T14:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177569",
    "user": "Snark"
}
```

I don't remember the details, but I think it was a case of bad use of static variables ; so probably helping upstream get around that is a better route.

(That involves putting those variables in a params structure which gets passed around. Perhaps with some getter/setter api for the new structure.)



---

archive/issue_comments_177570.json:
```json
{
    "body": "Good luck convincing upstream, I'm not going to do it...",
    "created_at": "2013-05-24T15:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177570",
    "user": "jdemeyer"
}
```

Good luck convincing upstream, I'm not going to do it...



---

archive/issue_comments_177571.json:
```json
{
    "body": "Attachment [0001-reduce-cliquer-patching.patch](tarball://root/attachments/some-uuid/ticket14349/0001-reduce-cliquer-patching.patch) by felixs created at 2013-06-20 07:30:31",
    "created_at": "2013-06-20T07:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177571",
    "user": "felixs"
}
```

Attachment [0001-reduce-cliquer-patching.patch](tarball://root/attachments/some-uuid/ticket14349/0001-reduce-cliquer-patching.patch) by felixs created at 2013-06-20 07:30:31



---

archive/issue_comments_177572.json:
```json
{
    "body": "Would somebody please help getting rid of the other one (cl.c.patch)?",
    "created_at": "2013-06-20T07:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177572",
    "user": "felixs"
}
```

Would somebody please help getting rid of the other one (cl.c.patch)?



---

archive/issue_comments_177573.json:
```json
{
    "body": "Most of the \"global variables\" aren't global but local to the compilation unit of the command line parser and only used to keep track of command line options. Its likely that one could just move the additional `sage_...` functions to an auxiliary source file in the Sage library.\n\nMaybe we should get a GSoC student working on the build system to clean that up? :-P\n\nUnless there is some action on this ticket soon I'll just take the current patch, add all currently untracked files to the repo, and use that for #14781",
    "created_at": "2013-07-07T15:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177573",
    "user": "vbraun"
}
```

Most of the "global variables" aren't global but local to the compilation unit of the command line parser and only used to keep track of command line options. Its likely that one could just move the additional `sage_...` functions to an auxiliary source file in the Sage library.

Maybe we should get a GSoC student working on the build system to clean that up? :-P

Unless there is some action on this ticket soon I'll just take the current patch, add all currently untracked files to the repo, and use that for #14781



---

archive/issue_comments_177574.json:
```json
{
    "body": "Replying to [comment:8 vbraun]:\n> Most of the \"global variables\" aren't global but local to the compilation unit of the command line parser and only used to keep track of command line options. Its likely that one could just move the additional `sage_...` functions to an auxiliary source file in the Sage library.\n\nseems to work. i'll test and upload the patch as soon as i'm done with gap.",
    "created_at": "2013-07-07T20:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177574",
    "user": "felixs"
}
```

Replying to [comment:8 vbraun]:
> Most of the "global variables" aren't global but local to the compilation unit of the command line parser and only used to keep track of command line options. Its likely that one could just move the additional `sage_...` functions to an auxiliary source file in the Sage library.

seems to work. i'll test and upload the patch as soon as i'm done with gap.



---

archive/issue_comments_177575.json:
```json
{
    "body": "Felix, are you still working on this ticket? We need to resolve this ticket one way or another for #14781",
    "created_at": "2013-07-12T23:26:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177575",
    "user": "vbraun"
}
```

Felix, are you still working on this ticket? We need to resolve this ticket one way or another for #14781



---

archive/issue_comments_177576.json:
```json
{
    "body": "Still stuck with gap. My cliquer patch needs to be sorted out/rebased/ported, I don't know whether that makes much sense right now. please do with this tiket whatever seems appropriate.\n\n(sorry i don't understand #14781)",
    "created_at": "2013-07-13T04:36:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177576",
    "user": "felixs"
}
```

Still stuck with gap. My cliquer patch needs to be sorted out/rebased/ported, I don't know whether that makes much sense right now. please do with this tiket whatever seems appropriate.

(sorry i don't understand #14781)



---

archive/issue_comments_177577.json:
```json
{
    "body": "What it your problem with gap? Does it have ticket number?",
    "created_at": "2013-07-13T04:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177577",
    "user": "fbissey"
}
```

What it your problem with gap? Does it have ticket number?



---

archive/issue_comments_177578.json:
```json
{
    "body": "Replying to [comment:12 fbissey]:\n> What it your problem with gap? Does it have ticket number?\n\nI have created #14887.",
    "created_at": "2013-07-13T05:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177578",
    "user": "felixs"
}
```

Replying to [comment:12 fbissey]:
> What it your problem with gap? Does it have ticket number?

I have created #14887.



---

archive/issue_comments_177579.json:
```json
{
    "body": "I've moved the 0001-reduce-cliquer-patching.patch to #14892. This ticket still has enough improvement suggestions for cliquer. Note how issue #9870 is related to this ticket.",
    "created_at": "2013-07-15T04:53:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177579",
    "user": "vbraun"
}
```

I've moved the 0001-reduce-cliquer-patching.patch to #14892. This ticket still has enough improvement suggestions for cliquer. Note how issue #9870 is related to this ticket.



---

archive/issue_comments_177580.json:
```json
{
    "body": "A patch removing the patches is now ready on top of sage 5.12beta3 (build_system). It does not address #9870.",
    "created_at": "2013-08-23T14:14:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177580",
    "user": "felixs"
}
```

A patch removing the patches is now ready on top of sage 5.12beta3 (build_system). It does not address #9870.



---

archive/issue_comments_177581.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-08-23T14:14:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177581",
    "user": "felixs"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_177582.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2013-12-02T16:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177582",
    "user": "ncohen"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_177583.json:
```json
{
    "body": "Hellooooooooo !!!\n\nThis patch probably needs to be rebased atop the nice additions of #15410, but would it also be possible to not create those two cl.c and cl.h files right inside of the graphs/ folder ? Could it be put inside of a cliquer/ folder, and couldn't it even stay inside of the spkg, even if it is not used to patch the sources but (nicely) imported at compile-time ?\n\nThe trick is nice and efficient, thanks for this patch `:-)`\n\nNathann",
    "created_at": "2013-12-02T16:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177583",
    "user": "ncohen"
}
```

Hellooooooooo !!!

This patch probably needs to be rebased atop the nice additions of #15410, but would it also be possible to not create those two cl.c and cl.h files right inside of the graphs/ folder ? Could it be put inside of a cliquer/ folder, and couldn't it even stay inside of the spkg, even if it is not used to patch the sources but (nicely) imported at compile-time ?

The trick is nice and efficient, thanks for this patch `:-)`

Nathann



---

archive/issue_comments_177584.json:
```json
{
    "body": "I don't understand your question. In any case, upstream sources go into `build/pkgs/cliquer`, source files for the Sage library into `src/sage/...`.",
    "created_at": "2013-12-02T16:29:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177584",
    "user": "vbraun"
}
```

I don't understand your question. In any case, upstream sources go into `build/pkgs/cliquer`, source files for the Sage library into `src/sage/...`.



---

archive/issue_comments_177585.json:
```json
{
    "body": "Well, then it would be cool if the cl.c and cl.h files could all be moved inside of a cliquer/ folder, for the graphs/ folder is already quite messy. Especially when these two cl.c and cl.h files are not documented in any way `O_o`\n\nWould it make sense to get rid of the .c files automatically compiled by Cython for each .pyx file by the way ?\n\nNathann",
    "created_at": "2013-12-02T16:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177585",
    "user": "ncohen"
}
```

Well, then it would be cool if the cl.c and cl.h files could all be moved inside of a cliquer/ folder, for the graphs/ folder is already quite messy. Especially when these two cl.c and cl.h files are not documented in any way `O_o`

Would it make sense to get rid of the .c files automatically compiled by Cython for each .pyx file by the way ?

Nathann



---

archive/issue_comments_177586.json:
```json
{
    "body": "You can move them into `graphs/cliquer` if thats what you are asking.\n\nThere is a ticket for in-place cythonization somewhere. Obviously the cython output c files must be somewhere for the compiler to find them.",
    "created_at": "2013-12-02T16:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177586",
    "user": "vbraun"
}
```

You can move them into `graphs/cliquer` if thats what you are asking.

There is a ticket for in-place cythonization somewhere. Obviously the cython output c files must be somewhere for the compiler to find them.



---

archive/issue_comments_177587.json:
```json
{
    "body": "> You can move them into `graphs/cliquer` if thats what you are asking.\n\nYep, that would be cool.\n\n> There is a ticket for in-place cythonization somewhere. Obviously the cython output c files must be somewhere for the compiler to find them.\n\nI guess, but they just don't have to stay there afterwards `:-P`\n\nNathann",
    "created_at": "2013-12-02T16:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177587",
    "user": "ncohen"
}
```

> You can move them into `graphs/cliquer` if thats what you are asking.

Yep, that would be cool.

> There is a ticket for in-place cythonization somewhere. Obviously the cython output c files must be somewhere for the compiler to find them.

I guess, but they just don't have to stay there afterwards `:-P`

Nathann



---

archive/issue_comments_177588.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2013-12-02T18:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177588",
    "user": "ncohen"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_177589.json:
```json
{
    "body": "At u/ncohen/14349 you will find three commits atop of this ticket's branch, which rebase it on top of #15410 and 5.13.beta4, plus moves cl.c and cl.h to a new cliquer/ directory.\n\nNathann",
    "created_at": "2013-12-02T18:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177589",
    "user": "ncohen"
}
```

At u/ncohen/14349 you will find three commits atop of this ticket's branch, which rebase it on top of #15410 and 5.13.beta4, plus moves cl.c and cl.h to a new cliquer/ directory.

Nathann



---

archive/issue_comments_177590.json:
```json
{
    "body": "ping ?",
    "created_at": "2014-01-08T09:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177590",
    "user": "ncohen"
}
```

ping ?



---

archive/issue_comments_177591.json:
```json
{
    "body": "Okay, let's forget about #15410 for the moment as it is not in `positive_review` anymore. Here is a new commit added on top of Felixs' which moves the two files into a `cliquer/` folder.\n\nNathann",
    "created_at": "2014-01-08T14:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177591",
    "user": "ncohen"
}
```

Okay, let's forget about #15410 for the moment as it is not in `positive_review` anymore. Here is a new commit added on top of Felixs' which moves the two files into a `cliquer/` folder.

Nathann



---

archive/issue_comments_177592.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-08T14:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177592",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_177593.json:
```json
{
    "body": "i'd prefer fewer directories. but i agree with 625306835f2033c96a982a3b4cee0b87b708f8e6. consider these changes positively reviewed.",
    "created_at": "2014-01-08T15:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177593",
    "user": "felixs"
}
```

i'd prefer fewer directories. but i agree with 625306835f2033c96a982a3b4cee0b87b708f8e6. consider these changes positively reviewed.



---

archive/issue_comments_177594.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-08T15:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177594",
    "user": "ncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_177595.json:
```json
{
    "body": "Well.. I prefer to have the least amount of mess in the graph/ folder. And cl.c/cl.h files do not fit in the picture `:-P`\n\nThank you fo the review !\n\nNathann",
    "created_at": "2014-01-08T15:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177595",
    "user": "ncohen"
}
```

Well.. I prefer to have the least amount of mess in the graph/ folder. And cl.c/cl.h files do not fit in the picture `:-P`

Thank you fo the review !

Nathann



---

archive/issue_comments_177596.json:
```json
{
    "body": "Further clean-up of cliquer at #9870...",
    "created_at": "2014-01-16T14:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177596",
    "user": "jdemeyer"
}
```

Further clean-up of cliquer at #9870...



---

archive/issue_comments_177597.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-01T19:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14145#issuecomment-177597",
    "user": "vbraun"
}
```

Resolution: fixed
