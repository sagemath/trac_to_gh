# Issue 14145: The cliquer spkg is patching upstream

Issue created by migration from Trac.

Original creator: Snark

Original creation time: 2013-03-23 22:41:56

Assignee: tbd

CC:  fbissey

This spkg does the following:
1. it compiles cliquer not only as an executable, but also as a library -- here I can't help but notice that the patches do to likewise in debian look more complete [see here](http://anonscm.debian.org/gitweb/?p=debian-science/packages/cliquer.git;a=tree;f=debian/patches;h=dd20b2cb0ea811e0036506c1468cc39367ec027e;hb=HEAD) (and remember than when the header of a debian patch doesn't mention forwarding to upstream -- that means it was!)
2. it modifies the api by making parse_input exported (non-static) -- was this forwarded upstream?
3. it adds new functions, only for sage -- that code doesn't belong to this spkg but to sage itself!


---

Comment by jdemeyer created at 2013-05-24 12:42:05

Replying to [ticket:14349 Snark]:
> 3. it adds new functions, only for sage
Please clarify how you would add these functions to Sage? They need access to the cliquer internals, so they cannot simply be added to Sage.


---

Comment by Snark created at 2013-05-24 14:11:14

I don't remember the details, but I think it was a case of bad use of static variables ; so probably helping upstream get around that is a better route.

(That involves putting those variables in a params structure which gets passed around. Perhaps with some getter/setter api for the new structure.)


---

Comment by jdemeyer created at 2013-05-24 15:06:55

Good luck convincing upstream, I'm not going to do it...


---

Attachment


---

Comment by felixs created at 2013-06-20 07:35:39

Would somebody please help getting rid of the other one (cl.c.patch)?


---

Comment by vbraun created at 2013-07-07 15:29:13

Most of the "global variables" aren't global but local to the compilation unit of the command line parser and only used to keep track of command line options. Its likely that one could just move the additional `sage_...` functions to an auxiliary source file in the Sage library.

Maybe we should get a GSoC student working on the build system to clean that up? :-P

Unless there is some action on this ticket soon I'll just take the current patch, add all currently untracked files to the repo, and use that for #14781


---

Comment by felixs created at 2013-07-07 20:41:12

Replying to [comment:8 vbraun]:
> Most of the "global variables" aren't global but local to the compilation unit of the command line parser and only used to keep track of command line options. Its likely that one could just move the additional `sage_...` functions to an auxiliary source file in the Sage library.

seems to work. i'll test and upload the patch as soon as i'm done with gap.


---

Comment by vbraun created at 2013-07-12 23:26:21

Felix, are you still working on this ticket? We need to resolve this ticket one way or another for #14781


---

Comment by felixs created at 2013-07-13 04:36:57

Still stuck with gap. My cliquer patch needs to be sorted out/rebased/ported, I don't know whether that makes much sense right now. please do with this tiket whatever seems appropriate.

(sorry i don't understand #14781)


---

Comment by fbissey created at 2013-07-13 04:52:56

What it your problem with gap? Does it have ticket number?


---

Comment by felixs created at 2013-07-13 05:30:33

Replying to [comment:12 fbissey]:
> What it your problem with gap? Does it have ticket number?

I have created #14887.


---

Comment by vbraun created at 2013-07-15 04:53:39

I've moved the 0001-reduce-cliquer-patching.patch to #14892. This ticket still has enough improvement suggestions for cliquer. Note how issue #9870 is related to this ticket.


---

Comment by felixs created at 2013-08-23 14:14:23

A patch removing the patches is now ready on top of sage 5.12beta3 (build_system). It does not address #9870.


---

Comment by felixs created at 2013-08-23 14:14:23

Changing status from new to needs_review.


---

Comment by ncohen created at 2013-12-02 16:21:39

Changing status from needs_review to needs_info.


---

Comment by ncohen created at 2013-12-02 16:21:39

Hellooooooooo !!!

This patch probably needs to be rebased atop the nice additions of #15410, but would it also be possible to not create those two cl.c and cl.h files right inside of the graphs/ folder ? Could it be put inside of a cliquer/ folder, and couldn't it even stay inside of the spkg, even if it is not used to patch the sources but (nicely) imported at compile-time ?

The trick is nice and efficient, thanks for this patch `:-)`

Nathann


---

Comment by vbraun created at 2013-12-02 16:29:22

I don't understand your question. In any case, upstream sources go into `build/pkgs/cliquer`, source files for the Sage library into `src/sage/...`.


---

Comment by ncohen created at 2013-12-02 16:33:25

Well, then it would be cool if the cl.c and cl.h files could all be moved inside of a cliquer/ folder, for the graphs/ folder is already quite messy. Especially when these two cl.c and cl.h files are not documented in any way `O_o`

Would it make sense to get rid of the .c files automatically compiled by Cython for each .pyx file by the way ?

Nathann


---

Comment by vbraun created at 2013-12-02 16:38:57

You can move them into `graphs/cliquer` if thats what you are asking.

There is a ticket for in-place cythonization somewhere. Obviously the cython output c files must be somewhere for the compiler to find them.


---

Comment by ncohen created at 2013-12-02 16:42:03

> You can move them into `graphs/cliquer` if thats what you are asking.

Yep, that would be cool.

> There is a ticket for in-place cythonization somewhere. Obviously the cython output c files must be somewhere for the compiler to find them.

I guess, but they just don't have to stay there afterwards `:-P`

Nathann


---

Comment by ncohen created at 2013-12-02 18:32:16

Changing status from needs_info to needs_review.


---

Comment by ncohen created at 2013-12-02 18:32:16

At u/ncohen/14349 you will find three commits atop of this ticket's branch, which rebase it on top of #15410 and 5.13.beta4, plus moves cl.c and cl.h to a new cliquer/ directory.

Nathann


---

Comment by ncohen created at 2014-01-08 09:50:30

ping ?


---

Comment by ncohen created at 2014-01-08 14:20:18

Okay, let's forget about #15410 for the moment as it is not in `positive_review` anymore. Here is a new commit added on top of Felixs' which moves the two files into a `cliquer/` folder.

Nathann


---

Comment by git created at 2014-01-08 14:20:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by felixs created at 2014-01-08 15:10:15

i'd prefer fewer directories. but i agree with 625306835f2033c96a982a3b4cee0b87b708f8e6. consider these changes positively reviewed.


---

Comment by ncohen created at 2014-01-08 15:18:57

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2014-01-08 15:18:57

Well.. I prefer to have the least amount of mess in the graph/ folder. And cl.c/cl.h files do not fit in the picture `:-P`

Thank you fo the review !

Nathann


---

Comment by jdemeyer created at 2014-01-16 14:48:39

Further clean-up of cliquer at #9870...


---

Comment by vbraun created at 2014-02-01 19:39:26

Resolution: fixed
