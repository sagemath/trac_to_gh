# Issue 27673: Three.js: Save screenshot as PNG

Issue created by migration from https://trac.sagemath.org/ticket/27910

Original creator: paulmasson

Original creation time: 2019-05-31 20:30:37

CC:  egourgoulhon embray mkoeppe

Keywords: threejs

This ticket adds a small downward-pointing arrow to the lower right-hand corner of each generated Three.js scene. When it is clicked a screenshot is saved to the browser-dependent downloads directory. There does not appear to be a way to allow the user to specify where the file will download due to browser security issues.

This ticket includes a bit of added white space to make the template a bit more legible.


---

Comment by git created at 2019-05-31 20:32:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by paulmasson created at 2019-05-31 20:33:37

Changing status from new to needs_review.


---

Comment by egourgoulhon created at 2019-06-01 16:10:19

Waouh! That's very nice!
I've just checked it and it works perfectly.

Could this be used to get png images from threejs when building the documentation, as in
http://doc.sagemath.org/html/en/reference/plot3d/sage/plot/plot3d/plot3d.html ?
Currently, this is achieved via the `sphinx_plot` function. For `sphinx_plot` to work, it suffices that the `save` method of 3d graphics objects produces a `png` file (cf. the definition of `sphinx_plot` starting at line 36 of `src/doc/common/conf.py`, in particular lines 94-105). For the moment, if `g` is a 3d graphics object, both

```
sage: g.save("image.png")  # use Jmol (the current default)
sage: g.save("image.png", viewer='tachyon')
}}} 
work, but setting `viewer='threejs'` does not:
{{{
sage: g.save("image.png", viewer='threejs')
...
ValueError: cannot use viewer=threejs to render image
}}}


---

Comment by paulmasson created at 2019-06-01 21:09:03

Glad you like it Eric. I added it because you've requested such a feature several times. Turned out to be easier than expected to implement.

Unfortunately the rendering requires a browser environment to function, so it won't work from the command line. It is possible in principle to perform command-line JavaScript rendering by making Node.js a required package and then using another third-party [library](https://github.com/nulltask/node-three.js) that hasn't been updated in years, but I wouldn't recommend that approach nor would I spend time on it.

Since matplotlib already supports 3D graphics, what I think is a better approach is to implement a `matplotlib` function for `Graphics3d` like the one here for `Graphics`:

https://github.com/sagemath/sage/blob/master/src/sage/plot/graphics.py#L2454

I'll add Matthias Koeppe to this ticket in the event he's interested in adding this function.


---

Comment by egourgoulhon created at 2019-06-03 08:56:09

Replying to [comment:6 paulmasson]:
> Glad you like it Eric. I added it because you've requested such a feature several times. Turned out to be easier than expected to implement.
> 

Thanks!

> Unfortunately the rendering requires a browser environment to function, so it won't work from the command line. It is possible in principle to perform command-line JavaScript rendering by making Node.js a required package and then using another third-party [library](https://github.com/nulltask/node-three.js) that hasn't been updated in years, but I wouldn't recommend that approach nor would I spend time on it.
> 
> Since matplotlib already supports 3D graphics, what I think is a better approach is to implement a `matplotlib` function for `Graphics3d` like the one here for `Graphics`:
> 
> https://github.com/sagemath/sage/blob/master/src/sage/plot/graphics.py#L2454
> 
> I'll add Matthias Koeppe to this ticket in the event he's interested in adding this function.

OK. This is clearly for another ticket then. 
Regarding the current one, I've checked that the png export works via `nbviewer` as well (cf. [this example](https://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/test_dodecahedron_threejs.ipynb)), although I guess there was no reason for which it should not work... So this positive review from my side.


---

Comment by egourgoulhon created at 2019-06-03 08:56:23

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-06-06 22:26:42

Resolution: fixed
