# Issue 32444: Changing brick polytopes of subword complexes to brick polyhedra

Issue created by migration from https://trac.sagemath.org/ticket/32681

Original creator: @DennisJahn

Original creation time: 2021-10-13 10:16:42

CC:  stumpc5 jipilab @kliem

Keywords: subword complex, brick vector, brick polyhedron, brick polytope,

generalize the method brick_polytope() of sage.combinat.subword_complex.py to brick_polyhedron() as done in

https://arxiv.org/abs/2103.03715


---

Comment by git created at 2021-10-14 09:12:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-14 10:18:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-14 11:05:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-14 12:35:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-14 13:24:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-18 07:05:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DennisJahn created at 2021-10-18 08:51:16

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-10-18 19:41:08


```
+        from warnings import warn
+        warn("brick_polytope() is deprecated; brick_polyhedron() is used instead; results are different for non-spherical subword complexes", DeprecationWarning)
```

better to use `deprecation` from `sage.misc.superseded` for this


---

Comment by mkoeppe created at 2021-10-18 19:42:53

if you install the optional package `pynormaliz`, you can also do exact computations over number fields, this should probably be a user option


---

Comment by git created at 2021-10-19 09:10:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DennisJahn created at 2021-10-19 09:58:06

Replying to [comment:10 mkoeppe]:
> if you install the optional package `pynormaliz`, you can also do exact computations over number fields, this should probably be a user option

I did install it but keep getting problems with vertices over the universal cyclotomic field:

1.618033988749895? of type <class 'sage.rings.qqbar.AlgebraicReal'> not valid to initialize an element of the universal cyclotomic field

Is there a way to work around this?


---

Comment by git created at 2021-10-19 10:19:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-19 15:32:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-20 12:46:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2021-10-25 09:12:28


```diff
diff --git a/src/sage/combinat/root_system/reflection_group_real.py b/src/sage/combinat/root_system/reflection_group_real.py
index 91333f0ca5..1fbf87496e 100644
--- a/src/sage/combinat/root_system/reflection_group_real.py
+++ b/src/sage/combinat/root_system/reflection_group_real.py
@@ -706,8 +706,8 @@ class RealReflectionGroup(ComplexReflectionGroup):
             [0, 1, 2]
         """
         return self._index_set_inverse[i]
-    
-    def bruhat_cone(self, x, y, side = 'upper'):
+
+    def bruhat_cone(self, x, y, side='upper', backend='cdd'):
         r"""
         Return the polyhedral cone generated by the set of positive roots ``beta`` where ``s_beta`` is the reflection corresponding to ``beta`` and:
 
@@ -744,12 +744,16 @@ class RealReflectionGroup(ComplexReflectionGroup):
             raise ValueError("side must be either 'upper' or 'lower'")
         from sage.geometry.polyhedron.constructor import Polyhedron
         if self.is_crystallographic():
-            return Polyhedron(vertices = [[0]*self.rank()], rays = roots, ambient_dim = self.rank())
+            return Polyhedron(vertices = [[0]*self.rank()], rays=roots, ambient_dim=self.rank(), backend=backend)
         else:
-            from warnings import warn
-            warn("Using floating point numbers for roots of unity. This might cause numerical errors!")
-            from sage.rings.real_double import RDF
-            return Polyhedron(vertices = [[0]*self.rank()], rays = roots, ambient_dim = self.rank(), base_ring = RDF)
+            if backend == 'cdd':
+                from warnings import warn
+                warn("Using floating point numbers for roots of unity. This might cause numerical errors!")
+                from sage.rings.real_double import RDF as base_ring
+                backend = 'cdd'
+            else:
+                from sage.rings.qqbar import AA as base_ring
+            return Polyhedron(vertices = [[0]*self.rank()], rays=roots, ambient_dim=self.rank(), base_ring=base_ring, backend=backend)
 
     class Element(RealReflectionGroupElement, ComplexReflectionGroup.Element):
 
diff --git a/src/sage/combinat/subword_complex.py b/src/sage/combinat/subword_complex.py
index bbf750b56d..dc64b5882c 100644
--- a/src/sage/combinat/subword_complex.py
+++ b/src/sage/combinat/subword_complex.py
@@ -638,9 +638,9 @@ class SubwordComplexFacet(Simplex, Element):
 
         - ``coefficients`` -- (optional) a list of coefficients used to
           scale the fundamental weights
-        
+
         - ``sign`` -- (default: ``'positive'``) must be one of the following:
-        
+
           * ``'positive'`` - entries of the extended weight configuration are summed up as they are
           * ``'negative'`` - entries of the extended weight configuration are summed up with a negative sign
 
@@ -1660,9 +1660,9 @@ class SubwordComplex(UniqueRepresentation, SimplicialComplex):
 
         - coefficients -- (optional) a list of coefficients used to
           scale the fundamental weights
-        
+
         - ``sign`` -- (default: ``'positive'``) must be one of the following:
-        
+
           * ``'positive'`` - for brick vectors, entries of the extended weight configuration are summed up as they are
           * ``'negative'`` - for brick vectors, entries of the extended weight configuration are summed up with a negative sign
 
@@ -1690,7 +1690,7 @@ class SubwordComplex(UniqueRepresentation, SimplicialComplex):
 
     def minkowski_summand(self, i):
         r"""
-        Return the `i` th Minkowski summand of ``self``. The brick polyhedron of ``self`` is the 
+        Return the `i` th Minkowski summand of ``self``. The brick polyhedron of ``self`` is the
         Minkowski sum of its associated Bruhat cone and all Minkowski summands.
 
         INPUT:
@@ -1720,7 +1720,7 @@ class SubwordComplex(UniqueRepresentation, SimplicialComplex):
             min_sum = [[QQ(CC(v)) for v in F.extended_weight_configuration()[i]] for F in self]
         return Polyhedron(min_sum)
 
-    def brick_polyhedron(self, coefficients=None, sign='positive'):
+    def brick_polyhedron(self, coefficients=None, sign='positive', backend='cdd'):
         r"""
         Return the brick polyhedron of ``self``.
 
@@ -1731,9 +1731,9 @@ class SubwordComplex(UniqueRepresentation, SimplicialComplex):
 
         - coefficients -- (optional) a list of coefficients used to
           scale the fundamental weights
-        
+
         - ``sign`` -- (default: ``'positive'``) must be one of the following:
-        
+
           * ``'positive'`` - entries of the extended weight configuration are summed up as they are.
             The Bruhat cone is taken with a negative sign.
           * ``'negative'`` - entries of the extended weight configuration are summed up with a negative sign.
@@ -1762,29 +1762,32 @@ class SubwordComplex(UniqueRepresentation, SimplicialComplex):
             sage: SC = SubwordComplex(Q,W.w0)                           # optional - gap3
             sage: SC.brick_polyhedron()                                 # optional - gap3
             A 3-dimensional polyhedron in RDF^3 defined as the convex hull of 32 vertices
-            
+
             sage: W = ReflectionGroup(['B',2])                          # optional - gap3
             sage: Q = W.w0.reduced_word()                               # optional - gap3
             sage: SC = SubwordComplex(Q, W.from_reduced_word([1]))      # optional - gap3
             sage: SC.brick_polyhedron()                                 # optional - gap3
             A 2-dimensional polyhedron in QQ^2 defined as the convex hull of 2 vertices and 2 rays
-            
+
         REFERENCES: [JahStu]_
         """
         BV = self.brick_vectors(coefficients=coefficients, sign=sign)
         G = self.group()
         if sign == 'positive':
-            BC = -G.bruhat_cone(self.pi(), G.demazure_product(self.word()))
+            BC = -G.bruhat_cone(self.pi(), G.demazure_product(self.word()), backend=backend)
         elif sign == 'negative':
-            BC = G.bruhat_cone(self.pi(), G.demazure_product(self.word()))
+            BC = G.bruhat_cone(self.pi(), G.demazure_product(self.word()), backend=backend)
         else:
             raise ValueError("sign must be either 'positive' or 'negative'")
         if G.coxeter_matrix().is_crystallographic():
-            return Polyhedron(BV, ambient_dim = G.rank()) + BC
+            return Polyhedron(BV, ambient_dim=G.rank(), backend=backend) + BC
         else:
-            from sage.rings.real_double import RDF
-            return Polyhedron(BV, ambient_dim = G.rank(), base_ring = RDF) + BC
-    
+            if backend == 'cdd':
+                from sage.rings.real_double import RDF as base_ring
+            else:
+                from sage.rings.qqbar import AA as base_ring
+            return Polyhedron(BV, ambient_dim=G.rank(), base_ring=base_ring, backend=backend) + BC
+
     from sage.misc.superseded import deprecated_function_alias
     brick_polytope = deprecated_function_alias(32681, brick_polyhedron)
```


The `backend` keyword is missing anyway and should be added.

In can be documented similar to what is done in `src/sage/geometry/polyhedron/library.py`.

A general remark: A keyword assignment should not have spaces guarding `=`: `Polyhedron(backend='cdd')`.


---

Comment by git created at 2021-10-25 09:22:20

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2021-10-25 13:58:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-25 14:14:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2021-10-25 14:20:28


```diff
-        - ``backend`` -- string (default: ``'ccd'``) -- The backend to use to create the polyhedron.
+        - ``backend`` -- string (default: ``'cdd'``); the backend to use to create the polyhedron
```


and


```diff
-        - ``backend`` -- string (default: ``'cdd'``) The backend to use to create the polyhedron.
+        - ``backend`` -- string (default: ``'cdd'``); the backend to use to create the polyhedron
```



---

Comment by @kliem created at 2021-10-25 14:22:35

The above comment was edited to also remove the trailing period.


---

Comment by git created at 2021-10-25 14:26:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-26 06:50:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-26 08:08:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-18 19:53:12

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.


---

Comment by mkoeppe created at 2022-03-03 06:55:55

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2022-03-03 06:55:55

merge conflict (red branch) => needs work


---

Comment by git created at 2022-09-13 08:08:41

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-09-13 11:48:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-13 13:01:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-13 13:24:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-14 07:03:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DennisJahn created at 2022-09-14 07:05:25

Changing status from needs_work to needs_review.


---

Comment by stumpc5 created at 2022-09-14 10:56:02

The code looks good to me! `@`tscrim, `@`chapoton: I am sure you have some comments, at least concerning the formatting and/or the doctests. Could you maybe have a quick look? -- Thanks!


---

Comment by chapoton created at 2022-09-14 12:54:45

doc does not build

```
 /home/sagemath/sage/src/sage/combinat/subword_complex.py:docstring of sage.combinat.subword_complex.SubwordComplex.brick_polyhedron:50: WARNING: citation not found: JS2021
```



---

Comment by chapoton created at 2022-09-14 13:35:59

the new deprecation must be doctested, for exemple in the module documentation near the top of the file


---

Comment by git created at 2022-09-14 17:02:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DennisJahn created at 2022-09-14 17:04:58

Replying to [comment:37 Frédéric Chapoton]:
> doc does not build
> {{{
>  /home/sagemath/sage/src/sage/combinat/subword_complex.py:docstring of sage.combinat.subword_complex.SubwordComplex.brick_polyhedron:50: WARNING: citation not found: JS2021
> }}}

The reference [JS2021] was added in #32669
I added the doctest for the new deprecation
