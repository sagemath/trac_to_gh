# Issue 30677: Generate sage/share files in sage/setup.py?

Issue created by migration from https://trac.sagemath.org/ticket/30914

Original creator: @tobiasdiez

Original creation time: 2020-11-14 18:51:24

CC:  mkoeppe jhpalmieri fbissey isuruf arojas dimpase slelievre thansen @jamesjer soehms vdelecroix was roed

Problem: While working on #30371, I noticed that most files in `local/share` are more or less static, but are generated during `make`.
I was wondering how to streamline this process a bit in order to make modularization easier, and to make it possible to install sagelib in different venv and without a previous run of `bootstrap`/`make`.

Options that I see:
1. Checkin the current version of these files (at least the almost static databases etc) in say `src/share`. Then they only need to be generated anew for update due to changes upstream. So one can remove the corresponding sage packages from the `make` pipeline.

2. Publish these dependencies to pypi, and install them to the current venv using requirements.txt and/or pipfile.

3. Generate these files during a call of `src/setup.py`, and include them in this way in the current venv.

Any other ideas/preferences about how to handle these files?


---

Comment by mkoeppe created at 2020-11-14 19:59:10

Which files, specifically?


---

Comment by mkoeppe created at 2020-11-14 20:17:35

If you are talking about database packages such as `build/pkgs/conway_polynomials`, in particular those that do not seem to have a "real upstream" (or installation procedures other than our scripts in build/pkgs), then yes, I agree that a possible direction would be to create pip-installable packages for them and to publish them to PyPI. They should be maintained outside of the source tree, each in a separate git repository.


---

Comment by mkoeppe created at 2020-11-14 20:19:37

If this is what you had in mind, let's transform this ticket into a meta-ticket and get the downstream packagers of Sage on board -- they may have insights on the upstream status of some of these packages, which we may have forgotten about.


---

Comment by fbissey created at 2020-11-14 20:49:21

Yes, a confirmation of which bits would be nice. If `@`mkoeppe is right you are talking about
* combinatorial_designs
* conway_polynomials
* elliptic_curves
* graphs
* polytopes_db
* plus some other optional packages
They are indeed static but come in two flavors. 

Architecture independent:
* combinatorial_designs
* graphs
* polytopes_db
which are really file copying.

Prepared files
* conway_polynomials
* elliptic_curves
where the files are processed before install with some python code that may be depending on python or some other software. 

`conway_polynomials` uses `pickle.dump` which could pose problems across python versions?

`elliptic_curves` is put into a SQL database with sqlite, this should be a stable format. Don't know if that's portable between, say, x86_64 and ppc64le?


---

Comment by mkoeppe created at 2020-11-14 20:51:11

OK, I've taken the liberty to rewrite the ticket description


---

Comment by mkoeppe created at 2020-11-14 20:53:00

Replying to [comment:4 fbissey]:
> Prepared files
> * conway_polynomials
> * elliptic_curves
> where the files are processed before install with some python code that may be depending on python or some other software. 
> 
> `conway_polynomials` uses `pickle.dump` which could pose problems across python versions?
> 
> `elliptic_curves` is put into a SQL database with sqlite, this should be a stable format. Don't know if that's portable between, say, x86_64 and ppc64le?

For these ones, we should make the actual source distribution architecture-independent.
The architecture-dependent products could be built during setup.py - and published as wheels.


---

Comment by mkoeppe created at 2020-11-14 20:54:43

For example `database_stein_watkins_mini`'s SPKG.rst lists http://modular.math.washington.edu/papers/stein-watkins/ as upstream or source, which is defunct


---

Comment by mkoeppe created at 2020-11-14 20:57:15

One thing that may need discussion is that for huge databases, one may want to avoid installing multiple copies


---

Comment by slelievre created at 2020-11-14 22:02:52

Replying to [comment:7 mkoeppe]:
> For example `database_stein_watkins_mini`'s SPKG.rst lists http://modular.math.washington.edu/papers/stein-watkins/ as upstream or source, which is defunct

It's at https://wstein.org/papers/stein-watkins/


---

Comment by @tobiasdiez created at 2020-11-14 22:50:33

Replying to [comment:4 fbissey]:
> Yes, a confirmation of which bits would be nice. If `@`mkoeppe is right you are talking about ...


Yes, that's exactly what I meant! Thanks everybody for their input, that's already way better than what I've imagined originally.


---

Comment by mkoeppe created at 2020-12-06 17:48:32

Changing keywords from "" to "sd111".


---

Comment by mkoeppe created at 2021-03-24 02:04:25

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-10-06 06:49:13

For #32432 (*sagemath-polyhedra*), pip-installable `polytopes_db`, `polytopes_db_4d` would be good


---

Comment by mkoeppe created at 2022-05-21 23:32:16

Replying to [comment:10 slelievre]:
> Replying to [comment:7 mkoeppe]:
> > For example `database_stein_watkins_mini`'s SPKG.rst lists http://modular.math.washington.edu/papers/stein-watkins/ as upstream or source, which is defunct
> 
> It's at https://wstein.org/papers/stein-watkins/

The link "Click here for the database" (https://wstein.org/ecdb) and "Our database" (https://wstein.org/papers/stein-watkins/ecdb) are both broken
