# Issue 30232: Implement `as_polyhedron` for combinatorial faces of polyhedra

Issue created by migration from https://trac.sagemath.org/ticket/30469

Original creator: @kliem

Original creation time: 2020-08-30 09:25:35

CC:  yzh tscrim

Keywords: polyhedral face, face figure, combinatorial polyhedron

We implement a method that obtains a combinatorial face or the face figure as combinatorial polyhedron.

This is much faster than `as_polyhedron` from polyhedral face and could be used to obtain a polyhedral face geometrically with precomputed double description.


---

Comment by git created at 2020-08-30 09:36:38

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by @kliem created at 2020-08-30 09:36:56

Changing status from new to needs_review.


---

Comment by @kliem created at 2020-09-04 09:17:14

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-09-04 09:21:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2020-09-07 10:15:26

Changing status from needs_work to needs_review.


---

Comment by @kliem created at 2020-09-07 17:30:35

I want to redesign some of the setup before making everything more complicated.

More precisely, creating strucutures `face_struct` and `faces_list_struct` that take care of the details. Then this overly long argument list of `get_next_level` will just reduce to three arguments or so. This would also make future changes easier including the transition to `bitsets.pxi`.


---

Comment by @kliem created at 2020-09-07 17:30:35

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by @kliem created at 2021-05-10 19:41:51

New commits:


---

Comment by @kliem created at 2021-05-10 19:41:51

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2021-05-10 20:25:48

Shouldn't this method be called `as_combinatorial_polyhedron`?


---

Comment by git created at 2021-05-10 20:58:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2021-05-12 14:00:47

Adding #31821 as a dependency.

It merges cleanly and tests run successful. Which is important, because the testsuite of combinatorial polyhedron is not run without #31821.


---

Comment by mkoeppe created at 2021-05-12 18:53:40

I'm getting a merge conflict with (I think) #27366


---

Comment by @kliem created at 2021-05-12 19:05:34

Yes, that is because someone introduced trailing spaces and my editor deletes them automatically.


---

Comment by git created at 2021-05-12 19:14:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2021-05-12 19:14:22

Merges fine now.


---

Comment by mkoeppe created at 2021-05-12 19:25:25

Thanks


---

Comment by mkoeppe created at 2021-05-12 19:35:08

Perhaps rephrase the docstring of `as_combinatorial_polyhedron` so it is clearer what quotient is formed (what is "the" polyhedron).

Also perhaps a doctest could show how the Vrep/Hrep of a quotient is labeled.

(This is relevant for #31803 when we introduce more specific parents, and morphisms)


---

Comment by git created at 2021-05-12 20:28:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-05-12 20:49:49

Maybe change the variables names for the faces and quotients in these examples for consistency?


---

Comment by git created at 2021-05-13 06:42:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yzh created at 2021-05-13 17:48:26

src/sage/geometry/polyhedron/base.py L6944: `facet.dim() == 0` seems to be `v.dim() == 0`. It might be good to include the case `isinstance(v, PolyhedronFace)` in the doctest "The input is flexible..."


---

Comment by yzh created at 2021-05-13 18:35:50

- `:meth:~sage.geometry.polyhedron.base.Polyhedron_base.meet_of_facets` | largest face contained specified facets` --> contained in the specified facets
- `Polyhedron_base.join_of_Vrep(self, *Vrepresentatives): ... in case of...` --> "in the case of" * 2
- `FaceIterator_base(SageObject).join_of_Vrep(self, *indices): .. NOTE:: ... may not te well defined.` --> "be"
- Why is it `meet_of_facets`, but not `meet_of_Hrep`? If rays/lines are allowed on the primal side, why doesn't it make sense to consider equations on the dual side?


---

Comment by yzh created at 2021-05-13 18:58:00

Sorry, the comments 24 & 25 are supposed to be on #29683


---

Comment by mkoeppe created at 2021-05-16 00:42:58

This seems to work well but it would be good if a reviewer who knows Cython better than I do could take a look


---

Comment by tscrim created at 2021-05-16 00:57:12

Not a Cython comment, but in `as_combinatorial_polyhedron`, the `REFERENCES` should not be indented.

Since `__copy__` is a special Python method, I am slightly worried about making it into a `cpdef` method. I think you are better off implementing a `cdef _copy` method and calling that from `__copy__`.

Looks good other than those two things.


---

Comment by mkoeppe created at 2021-05-16 02:40:06

I have to say I don't fully understand the design of `CombinatorialPolyhedron` regarding the labels that are used for the Vrep.  When I get the `CombinatorialPolyhedron` from a polyhedron, its Vrep consists of geometric VRepresentation objects; and there seems to be no method that returns an abstract `CombinatorialPolyhedron` instead (in which the Vrep consists of indices only). Then, why does `as_combinatorial_polyhedron` (with `quotient=False`) forget the geometric VRepresentation objects and return a `CombinatorialPolyhedron` whose Vrep uses indices?
I think this can be made clearer via #31803, which introduces parents.


---

Comment by @kliem created at 2021-05-16 06:29:04

You are right. The method in `list_of_faces.pyx` might as well return the relabeling map as well, so that the labels can be used.

`Vrepresentation`/vertices is clear. But I also keep the labels of the facets, taking the label of the first representative of each facet, if that makes any sense.

I even know all the equations, but that is a hard one for `CombinatorialPolyhedron`.

I could even introduce a tiny class `InducedRepresentation` that just wrappes around the original Hrepresentation object. I don't know what is best.


---

Comment by mkoeppe created at 2021-06-14 22:58:52

I think we can work on the refinements regarding the labeling discussed above in #31803.


---

Comment by mkoeppe created at 2021-06-14 22:58:52

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2021-06-15 07:53:06

Thank you.


---

Comment by git created at 2021-06-19 19:35:39

Changing status from positive_review to needs_review.


---

Comment by git created at 2021-06-19 19:35:39

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by mkoeppe created at 2021-06-19 21:12:39

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-06-20 08:14:29

Resolution: fixed
