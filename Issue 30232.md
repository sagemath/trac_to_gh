# Issue 30232: Implement `as_polyhedron` for combinatorial faces of polyhedra

archive/issues_030232.json:
```json
{
    "body": "CC:  yzh tscrim\n\nKeywords: polyhedral face, face figure, combinatorial polyhedron\n\nWe implement a method that obtains a combinatorial face or the face figure as combinatorial polyhedron.\n\nThis is much faster than `as_polyhedron` from polyhedral face and could be used to obtain a polyhedral face geometrically with precomputed double description.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30469\n\n",
    "created_at": "2020-08-30T09:25:35Z",
    "labels": [
        "geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Implement `as_polyhedron` for combinatorial faces of polyhedra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30232",
    "user": "@kliem"
}
```
CC:  yzh tscrim

Keywords: polyhedral face, face figure, combinatorial polyhedron

We implement a method that obtains a combinatorial face or the face figure as combinatorial polyhedron.

This is much faster than `as_polyhedron` from polyhedral face and could be used to obtain a polyhedral face geometrically with precomputed double description.

Issue created by migration from https://trac.sagemath.org/ticket/30469





---

archive/issue_comments_430934.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2020-08-30T09:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430934",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_430935.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-30T09:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430935",
    "user": "@kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_430936.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-09-04T09:17:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430936",
    "user": "@kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_430937.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-04T09:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430937",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430938.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-09-07T10:15:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430938",
    "user": "@kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_430939.json:
```json
{
    "body": "I want to redesign some of the setup before making everything more complicated.\n\nMore precisely, creating strucutures `face_struct` and `faces_list_struct` that take care of the details. Then this overly long argument list of `get_next_level` will just reduce to three arguments or so. This would also make future changes easier including the transition to `bitsets.pxi`.",
    "created_at": "2020-09-07T17:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430939",
    "user": "@kliem"
}
```

I want to redesign some of the setup before making everything more complicated.

More precisely, creating strucutures `face_struct` and `faces_list_struct` that take care of the details. Then this overly long argument list of `get_next_level` will just reduce to three arguments or so. This would also make future changes easier including the transition to `bitsets.pxi`.



---

archive/issue_comments_430940.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-09-07T17:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430940",
    "user": "@kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_430941.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430941",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_430942.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-05-10T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430942",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_430943.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-05-10T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430943",
    "user": "@kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_430944.json:
```json
{
    "body": "Shouldn't this method be called `as_combinatorial_polyhedron`?",
    "created_at": "2021-05-10T20:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430944",
    "user": "mkoeppe"
}
```

Shouldn't this method be called `as_combinatorial_polyhedron`?



---

archive/issue_comments_430945.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-10T20:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430945",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430946.json:
```json
{
    "body": "Adding #31821 as a dependency.\n\nIt merges cleanly and tests run successful. Which is important, because the testsuite of combinatorial polyhedron is not run without #31821.",
    "created_at": "2021-05-12T14:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430946",
    "user": "@kliem"
}
```

Adding #31821 as a dependency.

It merges cleanly and tests run successful. Which is important, because the testsuite of combinatorial polyhedron is not run without #31821.



---

archive/issue_comments_430947.json:
```json
{
    "body": "I'm getting a merge conflict with (I think) #27366",
    "created_at": "2021-05-12T18:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430947",
    "user": "mkoeppe"
}
```

I'm getting a merge conflict with (I think) #27366



---

archive/issue_comments_430948.json:
```json
{
    "body": "Yes, that is because someone introduced trailing spaces and my editor deletes them automatically.",
    "created_at": "2021-05-12T19:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430948",
    "user": "@kliem"
}
```

Yes, that is because someone introduced trailing spaces and my editor deletes them automatically.



---

archive/issue_comments_430949.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-12T19:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430949",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430950.json:
```json
{
    "body": "Merges fine now.",
    "created_at": "2021-05-12T19:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430950",
    "user": "@kliem"
}
```

Merges fine now.



---

archive/issue_comments_430951.json:
```json
{
    "body": "Thanks",
    "created_at": "2021-05-12T19:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430951",
    "user": "mkoeppe"
}
```

Thanks



---

archive/issue_comments_430952.json:
```json
{
    "body": "Perhaps rephrase the docstring of `as_combinatorial_polyhedron` so it is clearer what quotient is formed (what is \"the\" polyhedron).\n\nAlso perhaps a doctest could show how the Vrep/Hrep of a quotient is labeled.\n\n(This is relevant for #31803 when we introduce more specific parents, and morphisms)",
    "created_at": "2021-05-12T19:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430952",
    "user": "mkoeppe"
}
```

Perhaps rephrase the docstring of `as_combinatorial_polyhedron` so it is clearer what quotient is formed (what is "the" polyhedron).

Also perhaps a doctest could show how the Vrep/Hrep of a quotient is labeled.

(This is relevant for #31803 when we introduce more specific parents, and morphisms)



---

archive/issue_comments_430953.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-12T20:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430953",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430954.json:
```json
{
    "body": "Maybe change the variables names for the faces and quotients in these examples for consistency?",
    "created_at": "2021-05-12T20:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430954",
    "user": "mkoeppe"
}
```

Maybe change the variables names for the faces and quotients in these examples for consistency?



---

archive/issue_comments_430955.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-13T06:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430955",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_430956.json:
```json
{
    "body": "src/sage/geometry/polyhedron/base.py L6944: `facet.dim() == 0` seems to be `v.dim() == 0`. It might be good to include the case `isinstance(v, PolyhedronFace)` in the doctest \"The input is flexible...\"",
    "created_at": "2021-05-13T17:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430956",
    "user": "yzh"
}
```

src/sage/geometry/polyhedron/base.py L6944: `facet.dim() == 0` seems to be `v.dim() == 0`. It might be good to include the case `isinstance(v, PolyhedronFace)` in the doctest "The input is flexible..."



---

archive/issue_comments_430957.json:
```json
{
    "body": "- `:meth:~sage.geometry.polyhedron.base.Polyhedron_base.meet_of_facets` | largest face contained specified facets` --> contained in the specified facets\n- `Polyhedron_base.join_of_Vrep(self, *Vrepresentatives): ... in case of...` --> \"in the case of\" * 2\n- `FaceIterator_base(SageObject).join_of_Vrep(self, *indices): .. NOTE:: ... may not te well defined.` --> \"be\"\n- Why is it `meet_of_facets`, but not `meet_of_Hrep`? If rays/lines are allowed on the primal side, why doesn't it make sense to consider equations on the dual side?",
    "created_at": "2021-05-13T18:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430957",
    "user": "yzh"
}
```

- `:meth:~sage.geometry.polyhedron.base.Polyhedron_base.meet_of_facets` | largest face contained specified facets` --> contained in the specified facets
- `Polyhedron_base.join_of_Vrep(self, *Vrepresentatives): ... in case of...` --> "in the case of" * 2
- `FaceIterator_base(SageObject).join_of_Vrep(self, *indices): .. NOTE:: ... may not te well defined.` --> "be"
- Why is it `meet_of_facets`, but not `meet_of_Hrep`? If rays/lines are allowed on the primal side, why doesn't it make sense to consider equations on the dual side?



---

archive/issue_comments_430958.json:
```json
{
    "body": "Sorry, the comments 24 & 25 are supposed to be on #29683",
    "created_at": "2021-05-13T18:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430958",
    "user": "yzh"
}
```

Sorry, the comments 24 & 25 are supposed to be on #29683



---

archive/issue_comments_430959.json:
```json
{
    "body": "This seems to work well but it would be good if a reviewer who knows Cython better than I do could take a look",
    "created_at": "2021-05-16T00:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430959",
    "user": "mkoeppe"
}
```

This seems to work well but it would be good if a reviewer who knows Cython better than I do could take a look



---

archive/issue_comments_430960.json:
```json
{
    "body": "Not a Cython comment, but in `as_combinatorial_polyhedron`, the `REFERENCES` should not be indented.\n\nSince `__copy__` is a special Python method, I am slightly worried about making it into a `cpdef` method. I think you are better off implementing a `cdef _copy` method and calling that from `__copy__`.\n\nLooks good other than those two things.",
    "created_at": "2021-05-16T00:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430960",
    "user": "tscrim"
}
```

Not a Cython comment, but in `as_combinatorial_polyhedron`, the `REFERENCES` should not be indented.

Since `__copy__` is a special Python method, I am slightly worried about making it into a `cpdef` method. I think you are better off implementing a `cdef _copy` method and calling that from `__copy__`.

Looks good other than those two things.



---

archive/issue_comments_430961.json:
```json
{
    "body": "I have to say I don't fully understand the design of `CombinatorialPolyhedron` regarding the labels that are used for the Vrep.  When I get the `CombinatorialPolyhedron` from a polyhedron, its Vrep consists of geometric VRepresentation objects; and there seems to be no method that returns an abstract `CombinatorialPolyhedron` instead (in which the Vrep consists of indices only). Then, why does `as_combinatorial_polyhedron` (with `quotient=False`) forget the geometric VRepresentation objects and return a `CombinatorialPolyhedron` whose Vrep uses indices?\nI think this can be made clearer via #31803, which introduces parents.",
    "created_at": "2021-05-16T02:40:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430961",
    "user": "mkoeppe"
}
```

I have to say I don't fully understand the design of `CombinatorialPolyhedron` regarding the labels that are used for the Vrep.  When I get the `CombinatorialPolyhedron` from a polyhedron, its Vrep consists of geometric VRepresentation objects; and there seems to be no method that returns an abstract `CombinatorialPolyhedron` instead (in which the Vrep consists of indices only). Then, why does `as_combinatorial_polyhedron` (with `quotient=False`) forget the geometric VRepresentation objects and return a `CombinatorialPolyhedron` whose Vrep uses indices?
I think this can be made clearer via #31803, which introduces parents.



---

archive/issue_comments_430962.json:
```json
{
    "body": "You are right. The method in `list_of_faces.pyx` might as well return the relabeling map as well, so that the labels can be used.\n\n`Vrepresentation`/vertices is clear. But I also keep the labels of the facets, taking the label of the first representative of each facet, if that makes any sense.\n\nI even know all the equations, but that is a hard one for `CombinatorialPolyhedron`.\n\nI could even introduce a tiny class `InducedRepresentation` that just wrappes around the original Hrepresentation object. I don't know what is best.",
    "created_at": "2021-05-16T06:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430962",
    "user": "@kliem"
}
```

You are right. The method in `list_of_faces.pyx` might as well return the relabeling map as well, so that the labels can be used.

`Vrepresentation`/vertices is clear. But I also keep the labels of the facets, taking the label of the first representative of each facet, if that makes any sense.

I even know all the equations, but that is a hard one for `CombinatorialPolyhedron`.

I could even introduce a tiny class `InducedRepresentation` that just wrappes around the original Hrepresentation object. I don't know what is best.



---

archive/issue_comments_430963.json:
```json
{
    "body": "I think we can work on the refinements regarding the labeling discussed above in #31803.",
    "created_at": "2021-06-14T22:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430963",
    "user": "mkoeppe"
}
```

I think we can work on the refinements regarding the labeling discussed above in #31803.



---

archive/issue_comments_430964.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-14T22:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430964",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_430965.json:
```json
{
    "body": "Thank you.",
    "created_at": "2021-06-15T07:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430965",
    "user": "@kliem"
}
```

Thank you.



---

archive/issue_comments_430966.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-06-19T19:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430966",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_430967.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-06-19T19:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430967",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_430968.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-19T21:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430968",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_430969.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-06-20T08:14:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30232#issuecomment-430969",
    "user": "vbraun"
}
```

Resolution: fixed
