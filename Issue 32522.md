# Issue 32522: ./configure --disable-doc

archive/issues_032522.json:
```json
{
    "body": "CC:  @tobiasdiez @dimpase @jhpalmieri tmonteil\n\nThis switch will disable the docbuild and installation of its many dependencies (sphinx...)\n\nSplit out from #31396.\n\nIssue created by migration from https://trac.sagemath.org/ticket/32759\n\n",
    "created_at": "2021-10-24T22:45:48Z",
    "labels": [
        "build: configure",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "./configure --disable-doc",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32522",
    "user": "@mkoeppe"
}
```
CC:  @tobiasdiez @dimpase @jhpalmieri tmonteil

This switch will disable the docbuild and installation of its many dependencies (sphinx...)

Split out from #31396.

Issue created by migration from https://trac.sagemath.org/ticket/32759





---

archive/issue_comments_463913.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-25T00:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463913",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463914.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-25T01:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463914",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463915.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-25T01:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463915",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_463916.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-25T02:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463916",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463917.json:
```json
{
    "body": "If `--disable-doc` is given, then should `doc` be removed from the `all-start` target, so that `make` doesn't try to build the docs?",
    "created_at": "2021-10-29T23:18:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463917",
    "user": "@jhpalmieri"
}
```

If `--disable-doc` is given, then should `doc` be removed from the `all-start` target, so that `make` doesn't try to build the docs?



---

archive/issue_comments_463918.json:
```json
{
    "body": "Also, after I used `./configure --disable-doc`, packages like `alabaster` and `sphinxcontrib-...` were built anyway.",
    "created_at": "2021-10-29T23:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463918",
    "user": "@jhpalmieri"
}
```

Also, after I used `./configure --disable-doc`, packages like `alabaster` and `sphinxcontrib-...` were built anyway.



---

archive/issue_comments_463919.json:
```json
{
    "body": "Replying to [comment:9 jhpalmieri]:\n> If `--disable-doc` is given, then should `doc` be removed from the `all-start` target, so that `make` doesn't try to build the docs?\n\nYes, that's a good idea.",
    "created_at": "2021-10-29T23:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463919",
    "user": "@mkoeppe"
}
```

Replying to [comment:9 jhpalmieri]:
> If `--disable-doc` is given, then should `doc` be removed from the `all-start` target, so that `make` doesn't try to build the docs?

Yes, that's a good idea.



---

archive/issue_comments_463920.json:
```json
{
    "body": "`config.log` says (for example)\n\n```\nconfigure:45112: result: sphinx-4.2.0:                                standard, but disabled using configure option\n```\n\nbut maybe the problem is that I ran `make` instead of `make build`?",
    "created_at": "2021-10-29T23:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463920",
    "user": "@jhpalmieri"
}
```

`config.log` says (for example)

```
configure:45112: result: sphinx-4.2.0:                                standard, but disabled using configure option
```

but maybe the problem is that I ran `make` instead of `make build`?



---

archive/issue_comments_463921.json:
```json
{
    "body": "Yes, probably the `all-start` target pulled in the doc dependencies.",
    "created_at": "2021-10-29T23:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463921",
    "user": "@mkoeppe"
}
```

Yes, probably the `all-start` target pulled in the doc dependencies.



---

archive/issue_comments_463922.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-11-09T01:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463922",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_463923.json:
```json
{
    "body": "Replying to [comment:11 mkoeppe]:\n> Replying to [comment:9 jhpalmieri]:\n> > If `--disable-doc` is given, then should `doc` be removed from the `all-start` target, so that `make` doesn't try to build the docs?\n> \n> Yes, that's a good idea.\n\nThis is implemented now, via #31356",
    "created_at": "2021-11-09T01:29:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463923",
    "user": "@mkoeppe"
}
```

Replying to [comment:11 mkoeppe]:
> Replying to [comment:9 jhpalmieri]:
> > If `--disable-doc` is given, then should `doc` be removed from the `all-start` target, so that `make` doesn't try to build the docs?
> 
> Yes, that's a good idea.

This is implemented now, via #31356



---

archive/issue_comments_463924.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-11-10T22:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463924",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_463925.json:
```json
{
    "body": "Rebased on top of updated #31356",
    "created_at": "2021-11-10T22:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463925",
    "user": "@mkoeppe"
}
```

Rebased on top of updated #31356



---

archive/issue_comments_463926.json:
```json
{
    "body": "Should we expect doctests to pass with `./configure --disable-doc`? I get\n\n```\nsrc/sage/misc/sagedoc.py  # 8 doctests failed\nsrc/sage_docbuild/utils.py  # 5 doctests failed\nsrc/sage_docbuild/__init__.py  # 38 doctests failed\nsrc/sage_docbuild/sphinxbuild.py  # 13 doctests failed\nsrc/sage/docs/conf.py  # 1 doctest failed\n```\n\nwhich is not surprising, but should they be tagged so that they are only tested when `sagemath_doc_html` is built?",
    "created_at": "2021-11-11T04:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463926",
    "user": "@jhpalmieri"
}
```

Should we expect doctests to pass with `./configure --disable-doc`? I get

```
src/sage/misc/sagedoc.py  # 8 doctests failed
src/sage_docbuild/utils.py  # 5 doctests failed
src/sage_docbuild/__init__.py  # 38 doctests failed
src/sage_docbuild/sphinxbuild.py  # 13 doctests failed
src/sage/docs/conf.py  # 1 doctest failed
```

which is not surprising, but should they be tagged so that they are only tested when `sagemath_doc_html` is built?



---

archive/issue_comments_463927.json:
```json
{
    "body": "`git grep 'dochtml'` shows that we already seem to have an optional tag for this kind of thing.\n\nWe should probably replace it by `# optional - sagemath_doc_html` and add the missing ones for the failing doctests.",
    "created_at": "2021-11-11T04:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463927",
    "user": "@mkoeppe"
}
```

`git grep 'dochtml'` shows that we already seem to have an optional tag for this kind of thing.

We should probably replace it by `# optional - sagemath_doc_html` and add the missing ones for the failing doctests.



---

archive/issue_comments_463928.json:
```json
{
    "body": "Right, and then in the top-level `Makefile`, this line needs to be changed:\n\n```\nTESTALL_FLAGS = --optional=sage,dochtml,optional,external,build\n```\n\nand maybe the last line in this block from `src/sage/doctest/control.py`:\n\n```\n            if have_git:\n                self.files.append(opj(SAGE_SRC, 'sage_setup'))\n                self.files.append(opj(SAGE_SRC, 'sage_docbuild'))\n```\n\nPerhaps define `have_docs` appropriately and have a separate `if have_docs` block. Either that or tag everything in `sage_docbuild`.",
    "created_at": "2021-11-11T04:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463928",
    "user": "@jhpalmieri"
}
```

Right, and then in the top-level `Makefile`, this line needs to be changed:

```
TESTALL_FLAGS = --optional=sage,dochtml,optional,external,build
```

and maybe the last line in this block from `src/sage/doctest/control.py`:

```
            if have_git:
                self.files.append(opj(SAGE_SRC, 'sage_setup'))
                self.files.append(opj(SAGE_SRC, 'sage_docbuild'))
```

Perhaps define `have_docs` appropriately and have a separate `if have_docs` block. Either that or tag everything in `sage_docbuild`.



---

archive/issue_comments_463929.json:
```json
{
    "body": "Something like this?\n\n```diff\ndiff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py\nindex 858d8cb567..8dbb693e22 100644\n--- a/src/sage/doctest/control.py\n+++ b/src/sage/doctest/control.py\n@@ -727,13 +727,14 @@ class DocTestController(SageObject):\n             Doctesting ...\n         \"\"\"\n         opj = os.path.join\n-        from sage.env import SAGE_SRC, SAGE_DOC_SRC, SAGE_ROOT, SAGE_ROOT_GIT\n+        from sage.env import SAGE_SRC, SAGE_DOC_SRC, SAGE_DOC, SAGE_ROOT, SAGE_ROOT_GIT\n         # SAGE_ROOT_GIT can be None on distributions which typically\n         # only have the SAGE_LOCAL install tree but not SAGE_ROOT\n         if SAGE_ROOT_GIT is not None:\n             have_git = os.path.isdir(SAGE_ROOT_GIT)\n         else:\n             have_git = False\n+        have_docs = os.path.isdir(opj(SAGE_DOC, 'html', 'en', 'tutorial'))\n \n         def all_files():\n             self.files.append(opj(SAGE_SRC, 'sage'))\n@@ -742,7 +743,8 @@ class DocTestController(SageObject):\n             # don't make sense to run outside a build environment\n             if have_git:\n                 self.files.append(opj(SAGE_SRC, 'sage_setup'))\n-                self.files.append(opj(SAGE_SRC, 'sage_docbuild'))\n+                if have_docs:\n+                    self.files.append(opj(SAGE_SRC, 'sage_docbuild'))\n             self.files.append(SAGE_DOC_SRC)\n \n         if self.options.all or (self.options.new and not have_git):\n```\n",
    "created_at": "2021-11-11T04:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463929",
    "user": "@jhpalmieri"
}
```

Something like this?

```diff
diff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py
index 858d8cb567..8dbb693e22 100644
--- a/src/sage/doctest/control.py
+++ b/src/sage/doctest/control.py
@@ -727,13 +727,14 @@ class DocTestController(SageObject):
             Doctesting ...
         """
         opj = os.path.join
-        from sage.env import SAGE_SRC, SAGE_DOC_SRC, SAGE_ROOT, SAGE_ROOT_GIT
+        from sage.env import SAGE_SRC, SAGE_DOC_SRC, SAGE_DOC, SAGE_ROOT, SAGE_ROOT_GIT
         # SAGE_ROOT_GIT can be None on distributions which typically
         # only have the SAGE_LOCAL install tree but not SAGE_ROOT
         if SAGE_ROOT_GIT is not None:
             have_git = os.path.isdir(SAGE_ROOT_GIT)
         else:
             have_git = False
+        have_docs = os.path.isdir(opj(SAGE_DOC, 'html', 'en', 'tutorial'))
 
         def all_files():
             self.files.append(opj(SAGE_SRC, 'sage'))
@@ -742,7 +743,8 @@ class DocTestController(SageObject):
             # don't make sense to run outside a build environment
             if have_git:
                 self.files.append(opj(SAGE_SRC, 'sage_setup'))
-                self.files.append(opj(SAGE_SRC, 'sage_docbuild'))
+                if have_docs:
+                    self.files.append(opj(SAGE_SRC, 'sage_docbuild'))
             self.files.append(SAGE_DOC_SRC)
 
         if self.options.all or (self.options.new and not have_git):
```




---

archive/issue_comments_463930.json:
```json
{
    "body": "I think it would make more sense to just test whether `opj(SAGE_SRC, 'sage_docbuild')` exists.\n\nSame for `sage_setup`.\n\nI think we can get rid of the `have_git` logic",
    "created_at": "2021-11-11T04:36:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463930",
    "user": "@mkoeppe"
}
```

I think it would make more sense to just test whether `opj(SAGE_SRC, 'sage_docbuild')` exists.

Same for `sage_setup`.

I think we can get rid of the `have_git` logic



---

archive/issue_comments_463931.json:
```json
{
    "body": "By the way, with `make distclean && ./configure --disable-doc && make build`, the various sphinx packages are still being built.",
    "created_at": "2021-11-11T04:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463931",
    "user": "@jhpalmieri"
}
```

By the way, with `make distclean && ./configure --disable-doc && make build`, the various sphinx packages are still being built.



---

archive/issue_comments_463932.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-11-11T05:12:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463932",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_463933.json:
```json
{
    "body": "Replying to [comment:18 mkoeppe]:\n> Rebased on top of updated #31356\n\n... I had lost most of the commits in this rebase.\n\nFixed.",
    "created_at": "2021-11-11T05:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463933",
    "user": "@mkoeppe"
}
```

Replying to [comment:18 mkoeppe]:
> Rebased on top of updated #31356

... I had lost most of the commits in this rebase.

Fixed.



---

archive/issue_comments_463934.json:
```json
{
    "body": "Replying to [comment:23 mkoeppe]:\n> I think it would make more sense to just test whether `opj(SAGE_SRC, 'sage_docbuild')` exists.\n> \n> Same for `sage_setup`.\n> \n> I think we can get rid of the `have_git` logic\n\nEither that or test whether we can import `sage_docbuild`. I think the directory will exist (in a source distribution) regardless, but we don't want to test if we haven't at least built `sage_docbuild`. That seems cleaner than tagging everything in those files `optional - sage_docbuild`.",
    "created_at": "2021-11-11T05:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463934",
    "user": "@jhpalmieri"
}
```

Replying to [comment:23 mkoeppe]:
> I think it would make more sense to just test whether `opj(SAGE_SRC, 'sage_docbuild')` exists.
> 
> Same for `sage_setup`.
> 
> I think we can get rid of the `have_git` logic

Either that or test whether we can import `sage_docbuild`. I think the directory will exist (in a source distribution) regardless, but we don't want to test if we haven't at least built `sage_docbuild`. That seems cleaner than tagging everything in those files `optional - sage_docbuild`.



---

archive/issue_comments_463935.json:
```json
{
    "body": "I think the doctesting logic is that the source tree (in SAGE_ROOT/src) is preferred over installed sources, which are only used for falling back (for example for use in downstream packaging). But I agree, when falling back to installed sources, then importing `sage_docbuild` and using its `__path__` is the right solution",
    "created_at": "2021-11-11T05:21:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463935",
    "user": "@mkoeppe"
}
```

I think the doctesting logic is that the source tree (in SAGE_ROOT/src) is preferred over installed sources, which are only used for falling back (for example for use in downstream packaging). But I agree, when falling back to installed sources, then importing `sage_docbuild` and using its `__path__` is the right solution



---

archive/issue_comments_463936.json:
```json
{
    "body": "My point is that the typical doctest in `sage_docbuild/*` starts with `from sage_docbuild import ...`, so we shouldn't bother to test (as part of `make testall` etc.) if we can't import `sage_docbuild`. So I suggest something like:\n\n```diff\ndiff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py\nindex 858d8cb567..2bf0a4beb4 100644\n--- a/src/sage/doctest/control.py\n+++ b/src/sage/doctest/control.py\n@@ -740,9 +740,13 @@ class DocTestController(SageObject):\n             # Don't run these tests when not in the git repository; they are\n             # of interest for building sage, but not for runtime behavior and\n             # don't make sense to run outside a build environment\n-            if have_git:\n+            if os.path.isdir(opj(SAGE_SRC, 'sage_setup')):\n                 self.files.append(opj(SAGE_SRC, 'sage_setup'))\n+            try:\n+                import sage_docbuild\n                 self.files.append(opj(SAGE_SRC, 'sage_docbuild'))\n+            except ImportError:\n+                pass\n             self.files.append(SAGE_DOC_SRC)\n \n         if self.options.all or (self.options.new and not have_git):\n```\n",
    "created_at": "2021-11-11T05:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463936",
    "user": "@jhpalmieri"
}
```

My point is that the typical doctest in `sage_docbuild/*` starts with `from sage_docbuild import ...`, so we shouldn't bother to test (as part of `make testall` etc.) if we can't import `sage_docbuild`. So I suggest something like:

```diff
diff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py
index 858d8cb567..2bf0a4beb4 100644
--- a/src/sage/doctest/control.py
+++ b/src/sage/doctest/control.py
@@ -740,9 +740,13 @@ class DocTestController(SageObject):
             # Don't run these tests when not in the git repository; they are
             # of interest for building sage, but not for runtime behavior and
             # don't make sense to run outside a build environment
-            if have_git:
+            if os.path.isdir(opj(SAGE_SRC, 'sage_setup')):
                 self.files.append(opj(SAGE_SRC, 'sage_setup'))
+            try:
+                import sage_docbuild
                 self.files.append(opj(SAGE_SRC, 'sage_docbuild'))
+            except ImportError:
+                pass
             self.files.append(SAGE_DOC_SRC)
 
         if self.options.all or (self.options.new and not have_git):
```




---

archive/issue_comments_463937.json:
```json
{
    "body": "Ah ok, I agree. Same for `sage_setup` then, I think",
    "created_at": "2021-11-11T05:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463937",
    "user": "@mkoeppe"
}
```

Ah ok, I agree. Same for `sage_setup` then, I think



---

archive/issue_comments_463938.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-11T05:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463938",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463939.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-11T05:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463939",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463940.json:
```json
{
    "body": "Is it possible that `SAGE_DOC_SRC` might be missing? We could do this:\n\n```diff\ndiff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py\nindex 858d8cb567..86dbd24d1a 100644\n--- a/src/sage/doctest/control.py\n+++ b/src/sage/doctest/control.py\n@@ -737,13 +737,22 @@ class DocTestController(SageObject):\n \n         def all_files():\n             self.files.append(opj(SAGE_SRC, 'sage'))\n-            # Don't run these tests when not in the git repository; they are\n-            # of interest for building sage, but not for runtime behavior and\n-            # don't make sense to run outside a build environment\n-            if have_git:\n+            # Only test sage_setup and sage_docbuild if the relevant\n+            # imports work. They may not work if not in a build\n+            # environment or if the documentation build has been\n+            # disabled.\n+            try:\n+                import sage_setup\n                 self.files.append(opj(SAGE_SRC, 'sage_setup'))\n+            except ImportError:\n+                pass\n+            try:\n+                import sage_docbuild\n                 self.files.append(opj(SAGE_SRC, 'sage_docbuild'))\n-            self.files.append(SAGE_DOC_SRC)\n+            except ImportError:\n+                pass\n+            if os.path.isdir(SAGE_DOC_SRC):\n+                self.files.append(SAGE_DOC_SRC)\n \n         if self.options.all or (self.options.new and not have_git):\n             self.log(\"Doctesting entire Sage library.\")\n```\n\n----\nNew commits:",
    "created_at": "2021-11-11T05:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463940",
    "user": "@jhpalmieri"
}
```

Is it possible that `SAGE_DOC_SRC` might be missing? We could do this:

```diff
diff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py
index 858d8cb567..86dbd24d1a 100644
--- a/src/sage/doctest/control.py
+++ b/src/sage/doctest/control.py
@@ -737,13 +737,22 @@ class DocTestController(SageObject):
 
         def all_files():
             self.files.append(opj(SAGE_SRC, 'sage'))
-            # Don't run these tests when not in the git repository; they are
-            # of interest for building sage, but not for runtime behavior and
-            # don't make sense to run outside a build environment
-            if have_git:
+            # Only test sage_setup and sage_docbuild if the relevant
+            # imports work. They may not work if not in a build
+            # environment or if the documentation build has been
+            # disabled.
+            try:
+                import sage_setup
                 self.files.append(opj(SAGE_SRC, 'sage_setup'))
+            except ImportError:
+                pass
+            try:
+                import sage_docbuild
                 self.files.append(opj(SAGE_SRC, 'sage_docbuild'))
-            self.files.append(SAGE_DOC_SRC)
+            except ImportError:
+                pass
+            if os.path.isdir(SAGE_DOC_SRC):
+                self.files.append(SAGE_DOC_SRC)
 
         if self.options.all or (self.options.new and not have_git):
             self.log("Doctesting entire Sage library.")
```

----
New commits:



---

archive/issue_comments_463941.json:
```json
{
    "body": "Can we autodetect `sagemath_doc_html` as an optional tag to add for testing?",
    "created_at": "2021-11-11T05:37:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463941",
    "user": "@jhpalmieri"
}
```

Can we autodetect `sagemath_doc_html` as an optional tag to add for testing?



---

archive/issue_comments_463942.json:
```json
{
    "body": "Yes, I think it should be autodetected already because `sagemath_doc_html` is just an installed package",
    "created_at": "2021-11-11T05:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463942",
    "user": "@mkoeppe"
}
```

Yes, I think it should be autodetected already because `sagemath_doc_html` is just an installed package



---

archive/issue_comments_463943.json:
```json
{
    "body": "Replying to [comment:33 jhpalmieri]:\n> Is it possible that `SAGE_DOC_SRC` might be missing?\nYes, I think so, for example in downstream packaging of sage",
    "created_at": "2021-11-11T05:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463943",
    "user": "@mkoeppe"
}
```

Replying to [comment:33 jhpalmieri]:
> Is it possible that `SAGE_DOC_SRC` might be missing?
Yes, I think so, for example in downstream packaging of sage



---

archive/issue_comments_463944.json:
```json
{
    "body": "Replying to [comment:35 mkoeppe]:\n> Yes, I think it should be autodetected already because `sagemath_doc_html` is just an installed package\n\nDoes that mean we shouldn't manually add it to `TESTALL_FLAGS` and let it happen automatically?",
    "created_at": "2021-11-11T05:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463944",
    "user": "@jhpalmieri"
}
```

Replying to [comment:35 mkoeppe]:
> Yes, I think it should be autodetected already because `sagemath_doc_html` is just an installed package

Does that mean we shouldn't manually add it to `TESTALL_FLAGS` and let it happen automatically?



---

archive/issue_comments_463945.json:
```json
{
    "body": "Yes, that's a good point",
    "created_at": "2021-11-11T05:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463945",
    "user": "@mkoeppe"
}
```

Yes, that's a good point



---

archive/issue_comments_463946.json:
```json
{
    "body": "Not sure how to implement `TESTALL_NODOC_FLAGS` then \n\n```\nTESTALL_FLAGS = --optional=sage,sagemath_doc_html,optional,external,build\nTESTALL_NODOC_FLAGS = --optional=sage,optional,external,build\n```\n",
    "created_at": "2021-11-11T05:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463946",
    "user": "@mkoeppe"
}
```

Not sure how to implement `TESTALL_NODOC_FLAGS` then 

```
TESTALL_FLAGS = --optional=sage,sagemath_doc_html,optional,external,build
TESTALL_NODOC_FLAGS = --optional=sage,optional,external,build
```




---

archive/issue_comments_463947.json:
```json
{
    "body": "(introduced in #31084)",
    "created_at": "2021-11-11T05:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463947",
    "user": "@mkoeppe"
}
```

(introduced in #31084)



---

archive/issue_comments_463948.json:
```json
{
    "body": "Deprecate the `nodoc` targets and tell people to use `./configure --disable-doc` instead?\n\nOr leave it with the two `FLAGS` being identical? Running `make ptest-nodoc` runs `make build` and so shouldn't build `sagemath_doc_html`, so it shouldn't run tests with that flag, while `make ptest` runs `make` and so will build `sagemath_doc_html`.",
    "created_at": "2021-11-11T06:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463948",
    "user": "@jhpalmieri"
}
```

Deprecate the `nodoc` targets and tell people to use `./configure --disable-doc` instead?

Or leave it with the two `FLAGS` being identical? Running `make ptest-nodoc` runs `make build` and so shouldn't build `sagemath_doc_html`, so it shouldn't run tests with that flag, while `make ptest` runs `make` and so will build `sagemath_doc_html`.



---

archive/issue_comments_463949.json:
```json
{
    "body": "Thanks for the analysis, I like the 2nd option",
    "created_at": "2021-11-11T06:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463949",
    "user": "@mkoeppe"
}
```

Thanks for the analysis, I like the 2nd option



---

archive/issue_comments_463950.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-11T06:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463950",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463951.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-11T06:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463951",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463952.json:
```json
{
    "body": "Could you push the change from comment:33 to the ticket please?",
    "created_at": "2021-11-11T06:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463952",
    "user": "@mkoeppe"
}
```

Could you push the change from comment:33 to the ticket please?



---

archive/issue_comments_463953.json:
```json
{
    "body": "Replying to [comment:19 jhpalmieri]:\n> Should we expect doctests to pass with `./configure --disable-doc`? I get\n> {{{\n> src/sage/misc/sagedoc.py  # 8 doctests failed [...]\n> }}}\n\nNot sure what to do with these ones. What's happening here is that `sage.misc.sagedoc.detex` has a run-time dependency on Sphinx.\n----\nNew commits:",
    "created_at": "2021-11-11T18:01:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463953",
    "user": "@mkoeppe"
}
```

Replying to [comment:19 jhpalmieri]:
> Should we expect doctests to pass with `./configure --disable-doc`? I get
> {{{
> src/sage/misc/sagedoc.py  # 8 doctests failed [...]
> }}}

Not sure what to do with these ones. What's happening here is that `sage.misc.sagedoc.detex` has a run-time dependency on Sphinx.
----
New commits:



---

archive/issue_comments_463954.json:
```json
{
    "body": "Replying to [comment:35 mkoeppe]:\n> Yes, I think it should be autodetected already because `sagemath_doc_html` is just an installed package\nActually, at the moment this is not true because `sage.doctest.control` only looks at the optional packages.\n----\nNew commits:",
    "created_at": "2021-11-11T18:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463954",
    "user": "@mkoeppe"
}
```

Replying to [comment:35 mkoeppe]:
> Yes, I think it should be autodetected already because `sagemath_doc_html` is just an installed package
Actually, at the moment this is not true because `sage.doctest.control` only looks at the optional packages.
----
New commits:



---

archive/issue_comments_463955.json:
```json
{
    "body": "What mechanism adds `sage.geometry.polyhedron` and `sage_spkg` to the list of tags?",
    "created_at": "2021-11-11T19:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463955",
    "user": "@jhpalmieri"
}
```

What mechanism adds `sage.geometry.polyhedron` and `sage_spkg` to the list of tags?



---

archive/issue_comments_463956.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-11T20:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463956",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463957.json:
```json
{
    "body": "It's happening in the lines of code in the middle of which I have just inserted a test for `sphinx`",
    "created_at": "2021-11-11T20:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463957",
    "user": "@mkoeppe"
}
```

It's happening in the lines of code in the middle of which I have just inserted a test for `sphinx`



---

archive/issue_comments_463958.json:
```json
{
    "body": "In #32174 I am hoping to unify all that",
    "created_at": "2021-11-11T20:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463958",
    "user": "@mkoeppe"
}
```

In #32174 I am hoping to unify all that



---

archive/issue_comments_463959.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-11T20:51:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463959",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463960.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-11T20:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463960",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463961.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-11T21:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463961",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463962.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-11T21:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463962",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463963.json:
```json
{
    "body": "By the way, this fails:\n\n```\nmake distclean\n./configure --disable-doc\nmake\nmake doc-html\n```\n\nI think the error boils down to\n\n```\n[reference] intersphinx inventory '/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.5.beta5/local/share/doc/pplpy/objects.inv' not fetchable due to <class 'FileNotFoundError'>: [Errno 2] No such file or directory: '/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.5.beta5/local/share/doc/pplpy/objects.inv'\n```\n\nThe problem is that `pplpy` doesn't build its documentation the first time, and then it doesn't get rebuilt when `make doc-html` is run. I don't know how to fix this.",
    "created_at": "2021-11-11T21:58:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463963",
    "user": "@jhpalmieri"
}
```

By the way, this fails:

```
make distclean
./configure --disable-doc
make
make doc-html
```

I think the error boils down to

```
[reference] intersphinx inventory '/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.5.beta5/local/share/doc/pplpy/objects.inv' not fetchable due to <class 'FileNotFoundError'>: [Errno 2] No such file or directory: '/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.5.beta5/local/share/doc/pplpy/objects.inv'
```

The problem is that `pplpy` doesn't build its documentation the first time, and then it doesn't get rebuilt when `make doc-html` is run. I don't know how to fix this.



---

archive/issue_comments_463964.json:
```json
{
    "body": "With `make distclean && ./configure && make ptestlong`, I get two doctest failures:\n\n```\nFile \"src/sage/all.py\", line 31, in sage.all\nFailed example:\n    [inspect.getmodule(f).__name__ for f in frames if is_not_allowed(f)]\nExpected:\n    []\nGot:\n    ['pytz', 'importlib.resources']\n```\n\nand\n\n```\nFile \"src/sage/misc/sagedoc.py\", line 31, in sage.misc.sagedoc\nFailed example:\n    \"sphinx\" in sys.modules\nExpected:\n    False\nGot:\n    True\n```\n",
    "created_at": "2021-11-11T22:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463964",
    "user": "@jhpalmieri"
}
```

With `make distclean && ./configure && make ptestlong`, I get two doctest failures:

```
File "src/sage/all.py", line 31, in sage.all
Failed example:
    [inspect.getmodule(f).__name__ for f in frames if is_not_allowed(f)]
Expected:
    []
Got:
    ['pytz', 'importlib.resources']
```

and

```
File "src/sage/misc/sagedoc.py", line 31, in sage.misc.sagedoc
Failed example:
    "sphinx" in sys.modules
Expected:
    False
Got:
    True
```




---

archive/issue_comments_463965.json:
```json
{
    "body": "Replying to [comment:59 jhpalmieri]:\n> The problem is that `pplpy` doesn't build its documentation the first time, and then it doesn't get rebuilt when `make doc-html` is run. I don't know how to fix this.\n\nWe can introduce a separate package `pplpy_doc`, something that would actually also make sense for the upstream Python package.",
    "created_at": "2021-11-11T23:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463965",
    "user": "@mkoeppe"
}
```

Replying to [comment:59 jhpalmieri]:
> The problem is that `pplpy` doesn't build its documentation the first time, and then it doesn't get rebuilt when `make doc-html` is run. I don't know how to fix this.

We can introduce a separate package `pplpy_doc`, something that would actually also make sense for the upstream Python package.



---

archive/issue_comments_463966.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-11T23:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463966",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463967.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-12T00:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463967",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463968.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-12T00:31:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463968",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463969.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-12T00:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463969",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463970.json:
```json
{
    "body": "Replying to [comment:60 jhpalmieri]:\n> With `make distclean && ./configure && make ptestlong`, I get two doctest failures:\n> {{{\n> File \"src/sage/all.py\", line 31, in sage.all\n> Failed example:\n>     [inspect.getmodule(f).__name__ for f in frames if is_not_allowed(f)]\n> Expected:\n>     []\n> Got:\n>     ['pytz', 'importlib.resources']\n> }}}\n\nI've updated this doctest for the stuff that is pulled in by the doctest framework via Sphinx.\n\n> and\n> {{{\n> File \"src/sage/misc/sagedoc.py\", line 31, in sage.misc.sagedoc\n> Failed example:\n>     \"sphinx\" in sys.modules\n> Expected:\n>     False\n> Got:\n>     True\n> }}}\n\nFixed by starting a fresh interpreter for this test. Had to pull in 2 tickets that fixed issues with recursive invocation of sage",
    "created_at": "2021-11-12T00:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463970",
    "user": "@mkoeppe"
}
```

Replying to [comment:60 jhpalmieri]:
> With `make distclean && ./configure && make ptestlong`, I get two doctest failures:
> {{{
> File "src/sage/all.py", line 31, in sage.all
> Failed example:
>     [inspect.getmodule(f).__name__ for f in frames if is_not_allowed(f)]
> Expected:
>     []
> Got:
>     ['pytz', 'importlib.resources']
> }}}

I've updated this doctest for the stuff that is pulled in by the doctest framework via Sphinx.

> and
> {{{
> File "src/sage/misc/sagedoc.py", line 31, in sage.misc.sagedoc
> Failed example:
>     "sphinx" in sys.modules
> Expected:
>     False
> Got:
>     True
> }}}

Fixed by starting a fresh interpreter for this test. Had to pull in 2 tickets that fixed issues with recursive invocation of sage



---

archive/issue_comments_463971.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-12T03:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463971",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463972.json:
```json
{
    "body": "With `--disable-doc`, `make doc-html` goes through but ends with\n\n```\ntouch: /var/lib/sage/installed/sagemath_doc_html-none: No such file or directory\nmake[2]: *** [sagemath_doc_html-SAGE_DOCS-no-deps] Error 1\n```\n",
    "created_at": "2021-11-12T03:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463972",
    "user": "@mkoeppe"
}
```

With `--disable-doc`, `make doc-html` goes through but ends with

```
touch: /var/lib/sage/installed/sagemath_doc_html-none: No such file or directory
make[2]: *** [sagemath_doc_html-SAGE_DOCS-no-deps] Error 1
```




---

archive/issue_comments_463973.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-11-12T04:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463973",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_463974.json:
```json
{
    "body": "For reasons I don't understand, my computer is now refusing to build the plots in the documentation \u2014\u00a0it keeps hanging in `references/plotting`. After fighting with this for a while, I've given in and am resuming testing using `export SAGE_DOCBUILD_OPTS=' --no-plot'`.\n\n(Not related to this ticket: this happens with the `develop` branch, too.)",
    "created_at": "2021-11-12T18:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463974",
    "user": "@jhpalmieri"
}
```

For reasons I don't understand, my computer is now refusing to build the plots in the documentation — it keeps hanging in `references/plotting`. After fighting with this for a while, I've given in and am resuming testing using `export SAGE_DOCBUILD_OPTS=' --no-plot'`.

(Not related to this ticket: this happens with the `develop` branch, too.)



---

archive/issue_comments_463975.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-12T18:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463975",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463976.json:
```json
{
    "body": "Replying to [comment:70 mkoeppe]:\n> With `--disable-doc`, `make doc-html` goes through but ends with\n> {{{\n> touch: /var/lib/sage/installed/sagemath_doc_html-none: No such file or directory\n> make[2]: *** [sagemath_doc_html-SAGE_DOCS-no-deps] Error 1\n> }}}\n\nFixed now by explicitly raising a clear error.\n\nDo we want `make doc`, `make doc-html` to work when `--disable-doc` has been configured?",
    "created_at": "2021-11-12T18:50:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463976",
    "user": "@mkoeppe"
}
```

Replying to [comment:70 mkoeppe]:
> With `--disable-doc`, `make doc-html` goes through but ends with
> {{{
> touch: /var/lib/sage/installed/sagemath_doc_html-none: No such file or directory
> make[2]: *** [sagemath_doc_html-SAGE_DOCS-no-deps] Error 1
> }}}

Fixed now by explicitly raising a clear error.

Do we want `make doc`, `make doc-html` to work when `--disable-doc` has been configured?



---

archive/issue_comments_463977.json:
```json
{
    "body": "Replying to [comment:74 mkoeppe]:\n> Do we want `make doc`, `make doc-html` to work when `--disable-doc` has been configured?\n\nGood question, I don't know. Should the following work? Does it work?\n\n```\nmake distclean\n./configure --disable-doc\nmake\n./configure --enable-doc # without make distclean or similar\nmake doc-html\n```\n",
    "created_at": "2021-11-12T19:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463977",
    "user": "@jhpalmieri"
}
```

Replying to [comment:74 mkoeppe]:
> Do we want `make doc`, `make doc-html` to work when `--disable-doc` has been configured?

Good question, I don't know. Should the following work? Does it work?

```
make distclean
./configure --disable-doc
make
./configure --enable-doc # without make distclean or similar
make doc-html
```




---

archive/issue_comments_463978.json:
```json
{
    "body": "Replying to [comment:75 jhpalmieri]:\n> Replying to [comment:74 mkoeppe]:\n> > Do we want `make doc`, `make doc-html` to work when `--disable-doc` has been configured?\n> \n> Good question, I don't know.\n\nI think I would be happy if it didn't work but if there were a clear error message.\n\n```\n% make doc\n...\nError: Sage build configured with --disable-doc, so building the documentation will not work. To fix this, ...\n```\n",
    "created_at": "2021-11-12T19:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463978",
    "user": "@jhpalmieri"
}
```

Replying to [comment:75 jhpalmieri]:
> Replying to [comment:74 mkoeppe]:
> > Do we want `make doc`, `make doc-html` to work when `--disable-doc` has been configured?
> 
> Good question, I don't know.

I think I would be happy if it didn't work but if there were a clear error message.

```
% make doc
...
Error: Sage build configured with --disable-doc, so building the documentation will not work. To fix this, ...
```




---

archive/issue_comments_463979.json:
```json
{
    "body": "Replying to [comment:75 jhpalmieri]:\n> Should the following work? Does it work?\n> {{{\n> make distclean\n> ./configure --disable-doc\n> make\n> ./configure --enable-doc # without make distclean or similar\n> make doc-html\n> }}}\n\nYes, I think this works",
    "created_at": "2021-11-12T19:58:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463979",
    "user": "@mkoeppe"
}
```

Replying to [comment:75 jhpalmieri]:
> Should the following work? Does it work?
> {{{
> make distclean
> ./configure --disable-doc
> make
> ./configure --enable-doc # without make distclean or similar
> make doc-html
> }}}

Yes, I think this works



---

archive/issue_comments_463980.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-12T20:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463980",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463981.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-11-12T20:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463981",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_463982.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-12T23:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463982",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463983.json:
```json
{
    "body": "With `./configure --disable-docs && make`, I'm getting\n\n```\n[pplpy-0.8.6] Finished installing pplpy-0.8.6\nmake --no-print-directory pplpy_doc-SAGE_DOCS-no-deps\nError: The installation tree SAGE_DOCS has been disabled\nThis Sage build is configured with configure --disable-doc, so building the documentation will not work.\nmake[4]: *** [pplpy_doc-SAGE_DOCS-no-deps] Error 1\nmake[3]: *** [/var/lib/sage/installed/pplpy_doc-0.8.6] Error 2\nmake[3]: *** Waiting for unfinished jobs....\n```\n\nThis even happens after I made this change:\n\n```diff\ndiff --git a/configure.ac b/configure.ac\nindex cec63aa918..fab7171839 100644\n--- a/configure.ac\n+++ b/configure.ac\n@@ -475,7 +475,7 @@ AC_ARG_ENABLE([doc],\n   AS_HELP_STRING([--disable-doc],\n                  [disable build of the Sage documentation and packages depending on it]), [\n     dnl Disable packages needed for docbuilding\n-    for pkg in sage_docbuild alabaster babel snowballstemmer idna urllib3 certifi charset_normalizer requests imagesize sphinx sphinxcontrib_devhelp sphinxcontrib_jsmath sphinxcontrib_serializinghtml sphinxcontrib_applehelp sphinxcontrib_htmlhelp sphinxcontrib_qthelp sphinxcontrib_websupport; do\n+    for pkg in sage_docbuild alabaster babel snowballstemmer idna urllib3 certifi charset_normalizer requests imagesize sphinx sphinxcontrib_devhelp sphinxcontrib_jsmath sphinxcontrib_serializinghtml sphinxcontrib_applehelp sphinxcontrib_htmlhelp sphinxcontrib_qthelp sphinxcontrib_websupport pplpy_doc; do\n       AS_VAR_SET([SAGE_ENABLE_$pkg], [$enableval])\n     done\n     dnl Disable the docbuild by disabling the install tree for documentation\n```\n",
    "created_at": "2021-11-13T00:03:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463983",
    "user": "@jhpalmieri"
}
```

With `./configure --disable-docs && make`, I'm getting

```
[pplpy-0.8.6] Finished installing pplpy-0.8.6
make --no-print-directory pplpy_doc-SAGE_DOCS-no-deps
Error: The installation tree SAGE_DOCS has been disabled
This Sage build is configured with configure --disable-doc, so building the documentation will not work.
make[4]: *** [pplpy_doc-SAGE_DOCS-no-deps] Error 1
make[3]: *** [/var/lib/sage/installed/pplpy_doc-0.8.6] Error 2
make[3]: *** Waiting for unfinished jobs....
```

This even happens after I made this change:

```diff
diff --git a/configure.ac b/configure.ac
index cec63aa918..fab7171839 100644
--- a/configure.ac
+++ b/configure.ac
@@ -475,7 +475,7 @@ AC_ARG_ENABLE([doc],
   AS_HELP_STRING([--disable-doc],
                  [disable build of the Sage documentation and packages depending on it]), [
     dnl Disable packages needed for docbuilding
-    for pkg in sage_docbuild alabaster babel snowballstemmer idna urllib3 certifi charset_normalizer requests imagesize sphinx sphinxcontrib_devhelp sphinxcontrib_jsmath sphinxcontrib_serializinghtml sphinxcontrib_applehelp sphinxcontrib_htmlhelp sphinxcontrib_qthelp sphinxcontrib_websupport; do
+    for pkg in sage_docbuild alabaster babel snowballstemmer idna urllib3 certifi charset_normalizer requests imagesize sphinx sphinxcontrib_devhelp sphinxcontrib_jsmath sphinxcontrib_serializinghtml sphinxcontrib_applehelp sphinxcontrib_htmlhelp sphinxcontrib_qthelp sphinxcontrib_websupport pplpy_doc; do
       AS_VAR_SET([SAGE_ENABLE_$pkg], [$enableval])
     done
     dnl Disable the docbuild by disabling the install tree for documentation
```




---

archive/issue_comments_463984.json:
```json
{
    "body": "It seems to be okay now. Maybe I need to run `./bootstrap` or something similar (although the old `config.log` said that it wasn't building `pplpy_doc`.)",
    "created_at": "2021-11-13T00:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463984",
    "user": "@jhpalmieri"
}
```

It seems to be okay now. Maybe I need to run `./bootstrap` or something similar (although the old `config.log` said that it wasn't building `pplpy_doc`.)



---

archive/issue_comments_463985.json:
```json
{
    "body": "Yes, it sounds like `bootstrap` wasn't run.",
    "created_at": "2021-11-13T00:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463985",
    "user": "@mkoeppe"
}
```

Yes, it sounds like `bootstrap` wasn't run.



---

archive/issue_comments_463986.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-11-13T01:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463986",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_463987.json:
```json
{
    "body": "Merged #29039 to resolve a merge conflict",
    "created_at": "2021-11-13T01:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463987",
    "user": "@mkoeppe"
}
```

Merged #29039 to resolve a merge conflict



---

archive/issue_comments_463988.json:
```json
{
    "body": "Possibly the last commit also fixed comment:81",
    "created_at": "2021-11-13T01:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463988",
    "user": "@mkoeppe"
}
```

Possibly the last commit also fixed comment:81



---

archive/issue_comments_463989.json:
```json
{
    "body": "Everything builds for me, but my computer continues to misbehave, so I am not getting meaningful output on doctests. This is with OS X Monterey, and I have merged #32852. Many doctests involving plotting are timing out, so I get lots of doctest failures, and I don't know why. I tried a few sample plots interactively and they work.",
    "created_at": "2021-11-13T16:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463989",
    "user": "@jhpalmieri"
}
```

Everything builds for me, but my computer continues to misbehave, so I am not getting meaningful output on doctests. This is with OS X Monterey, and I have merged #32852. Many doctests involving plotting are timing out, so I get lots of doctest failures, and I don't know why. I tried a few sample plots interactively and they work.



---

archive/issue_comments_463990.json:
```json
{
    "body": "Running some tests with `EXTRA_CONFIGURE_ARGS=\"--disable-doc\" tox -e docker-ubuntu-focal-standard`.\n\nBuild went through but I am getting these failures on `make ptestlong`:\n\n```\nsage -t --long --random-seed=28205743117922504880455715083835945768 src/doc/en/tutorial/conf.py\n    ModuleNotFoundError in doctesting framework\n**********************************************************************\nTraceback (most recent call last):\n  File \"/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/doctest/forker.py\", line 2465, in __call__\n    doctests, extras = self._run(runner, options, results)\n  File \"/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/doctest/forker.py\", line 2513, in _run\n    doctests, extras = self.source.create_doctests(sage_namespace)\n  File \"/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/doctest/sources.py\", line 733, in create_doctests\n    load(filename, namespace) # errors raised here will be caught in DocTestTask\n  File \"/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/repl/load.py\", line 252, in load\n    exec(code, globals)\n  File \"./conf.py\", line 12, in <module>\n  File \"/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/docs/conf.py\", line 3, in <module>\n    import sphinx\nModuleNotFoundError: No module named 'sphinx'\n\nFile \"src/doc/en/thematic_tutorials/sandpile.rst\", line 1457, in doc.en.thematic_tutorials.sandpile\nFailed example:\n    Sandpile.help()\n[formatting details]\n```\n",
    "created_at": "2021-11-13T19:47:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463990",
    "user": "@mkoeppe"
}
```

Running some tests with `EXTRA_CONFIGURE_ARGS="--disable-doc" tox -e docker-ubuntu-focal-standard`.

Build went through but I am getting these failures on `make ptestlong`:

```
sage -t --long --random-seed=28205743117922504880455715083835945768 src/doc/en/tutorial/conf.py
    ModuleNotFoundError in doctesting framework
**********************************************************************
Traceback (most recent call last):
  File "/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/doctest/forker.py", line 2465, in __call__
    doctests, extras = self._run(runner, options, results)
  File "/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/doctest/forker.py", line 2513, in _run
    doctests, extras = self.source.create_doctests(sage_namespace)
  File "/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/doctest/sources.py", line 733, in create_doctests
    load(filename, namespace) # errors raised here will be caught in DocTestTask
  File "/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/repl/load.py", line 252, in load
    exec(code, globals)
  File "./conf.py", line 12, in <module>
  File "/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/docs/conf.py", line 3, in <module>
    import sphinx
ModuleNotFoundError: No module named 'sphinx'

File "src/doc/en/thematic_tutorials/sandpile.rst", line 1457, in doc.en.thematic_tutorials.sandpile
Failed example:
    Sandpile.help()
[formatting details]
```




---

archive/issue_comments_463991.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-13T20:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463991",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463992.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-13T20:08:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463992",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463993.json:
```json
{
    "body": "A few more failures\n\n```\nsage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/databases/findstat.py  # 94 doctests failed\nsage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/doctest/test.py  # 7 doctests failed\nsage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/doctest/sources.py  # 1 doctest failed\nsage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/misc/bindable_class.py  # 2 doctests failed\nsage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/misc/sagedoc.py  # 1 doctest failed\nsage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/misc/sphinxify.py  # 7 doctests failed\nsage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/misc/sageinspect.py  # 1 doctest failed\nsage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/repl/ipython_tests.py  # 2 doctests failed\nsage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/sandpiles/sandpile.py  # 1 doctest failed\nsage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/tests/lazy_imports.py  # 1 doctest failed\n```\n",
    "created_at": "2021-11-13T22:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463993",
    "user": "@mkoeppe"
}
```

A few more failures

```
sage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/databases/findstat.py  # 94 doctests failed
sage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/doctest/test.py  # 7 doctests failed
sage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/doctest/sources.py  # 1 doctest failed
sage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/misc/bindable_class.py  # 2 doctests failed
sage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/misc/sagedoc.py  # 1 doctest failed
sage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/misc/sphinxify.py  # 7 doctests failed
sage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/misc/sageinspect.py  # 1 doctest failed
sage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/repl/ipython_tests.py  # 2 doctests failed
sage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/sandpiles/sandpile.py  # 1 doctest failed
sage -t --long --random-seed=184472493071993940636041244744568712523 src/sage/tests/lazy_imports.py  # 1 doctest failed
```




---

archive/issue_comments_463994.json:
```json
{
    "body": "The `findstat` failures are:\n\n```\n      File \"/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/databases/findstat.py\", line 240, in <module>\n        import requests\n    ModuleNotFoundError: No module named 'requests'\n```\n",
    "created_at": "2021-11-13T22:59:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463994",
    "user": "@mkoeppe"
}
```

The `findstat` failures are:

```
      File "/sage/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/databases/findstat.py", line 240, in <module>
        import requests
    ModuleNotFoundError: No module named 'requests'
```




---

archive/issue_comments_463995.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-13T23:08:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463995",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463996.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-13T23:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463996",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463997.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-13T23:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463997",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463998.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-13T23:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463998",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_463999.json:
```json
{
    "body": "On an Ubuntu virtual machine, I'm getting doctest failures (with `./configure --disable-doc`) because the `alabaster` package is not installed:\n\n```\nFile \"src/sage/misc/package.py\", line 388, in sage.misc.package.installed_packages\nFailed example:\n    sorted(installed_packages().keys())  # optional - build\nExpected:\n    [...'alabaster', ...'sage_conf', ...]\nGot:\n    ['appnope',\n     'arb',\n     'argcomplete',\n     'argon2_cffi',\n     'attrs',\n     'backcall',\n     'bleach',\n     'cddlib',\n     'certifi',\n     'cffi',\n     'charset_normalizer',\n     'combinatorial_designs',\n     'conway_polynomials',\n     'cvxopt',\n     'cycler',\n     'cypari',\n     'cysignals',\n     'cython',\n     'dateutil',\n     'debugpy',\n     'decorator',\n     'defusedxml',\n     'docutils',\n     'ecl',\n     'eclib',\n     'elliptic_curves',\n     'entrypoints',\n     'flint',\n     'flit_core',\n     'fplll',\n     'fpylll',\n     'gap',\n     'gengetopt',\n     'giac',\n     'gmpy2',\n     'graphs',\n     'html5lib',\n     'idna',\n     'importlib_metadata',\n     'importlib_resources',\n     'ipykernel',\n     'ipython',\n     'ipython_genutils',\n     'ipywidgets',\n     'jedi',\n     'jinja2',\n     'jmol',\n     'jsonschema',\n     'jupyter_client',\n     'jupyter_core',\n     'jupyter_jsmol',\n     'jupyterlab_pygments',\n     'kiwisolver',\n     'lcalc',\n     'linbox',\n     'markupsafe',\n     'mathjax',\n     'matplotlib',\n     'matplotlib_inline',\n     'maxima',\n     'memory_allocator',\n     'mistune',\n     'mpmath',\n     'nbclient',\n     'nbconvert',\n     'nbformat',\n     'nest_asyncio',\n     'networkx',\n     'notebook',\n     'numpy',\n     'packaging',\n     'pandocfilters',\n     'pari',\n     'pari_galdata',\n     'pari_seadata_small',\n     'parso',\n     'pexpect',\n     'pickleshare',\n     'pillow',\n     'pip',\n     'pkgconfig',\n     'pluggy',\n     'polytopes_db',\n     'pplpy',\n     'prometheus_client',\n     'prompt_toolkit',\n     'ptyprocess',\n     'py',\n     'pybind11',\n     'pycparser',\n     'pycygwin',\n     'pygments',\n     'pyparsing',\n     'pyrsistent',\n     'pytz',\n     'pyzmq',\n     'ratpoints',\n     'requests',\n     'rpy2',\n     'sage_conf',\n     'sage_setup',\n     'sagelib',\n     'sagenb_export',\n     'sagetex',\n     'scipy',\n     'send2trash',\n     'setuptools',\n     'setuptools_scm',\n     'setuptools_wheel',\n     'simplegeneric',\n     'singular',\n     'six',\n     'sympy',\n     'terminado',\n     'testpath',\n     'thebe',\n     'threejs',\n     'tomli',\n     'tornado',\n     'traitlets',\n     'typing_extensions',\n     'tzlocal',\n     'urllib3',\n     'vcversioner',\n     'wcwidth',\n     'webencodings',\n     'wheel',\n     'widgetsnbextension',\n     'zipp']\n**********************************************************************\nFile \"src/sage/misc/package.py\", line 390, in sage.misc.package.installed_packages\nFailed example:\n    installed_packages()['alabaster']  # optional - build, random\nException raised:\n    Traceback (most recent call last):\n      File \"/home/john/Sage/sage-9.5.beta5/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/john/Sage/sage-9.5.beta5/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.package.installed_packages[1]>\", line 1, in <module>\n        installed_packages()['alabaster']  # optional - build, random\n    KeyError: 'alabaster'\n*********************************************************************\n```\n",
    "created_at": "2021-11-14T03:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-463999",
    "user": "@jhpalmieri"
}
```

On an Ubuntu virtual machine, I'm getting doctest failures (with `./configure --disable-doc`) because the `alabaster` package is not installed:

```
File "src/sage/misc/package.py", line 388, in sage.misc.package.installed_packages
Failed example:
    sorted(installed_packages().keys())  # optional - build
Expected:
    [...'alabaster', ...'sage_conf', ...]
Got:
    ['appnope',
     'arb',
     'argcomplete',
     'argon2_cffi',
     'attrs',
     'backcall',
     'bleach',
     'cddlib',
     'certifi',
     'cffi',
     'charset_normalizer',
     'combinatorial_designs',
     'conway_polynomials',
     'cvxopt',
     'cycler',
     'cypari',
     'cysignals',
     'cython',
     'dateutil',
     'debugpy',
     'decorator',
     'defusedxml',
     'docutils',
     'ecl',
     'eclib',
     'elliptic_curves',
     'entrypoints',
     'flint',
     'flit_core',
     'fplll',
     'fpylll',
     'gap',
     'gengetopt',
     'giac',
     'gmpy2',
     'graphs',
     'html5lib',
     'idna',
     'importlib_metadata',
     'importlib_resources',
     'ipykernel',
     'ipython',
     'ipython_genutils',
     'ipywidgets',
     'jedi',
     'jinja2',
     'jmol',
     'jsonschema',
     'jupyter_client',
     'jupyter_core',
     'jupyter_jsmol',
     'jupyterlab_pygments',
     'kiwisolver',
     'lcalc',
     'linbox',
     'markupsafe',
     'mathjax',
     'matplotlib',
     'matplotlib_inline',
     'maxima',
     'memory_allocator',
     'mistune',
     'mpmath',
     'nbclient',
     'nbconvert',
     'nbformat',
     'nest_asyncio',
     'networkx',
     'notebook',
     'numpy',
     'packaging',
     'pandocfilters',
     'pari',
     'pari_galdata',
     'pari_seadata_small',
     'parso',
     'pexpect',
     'pickleshare',
     'pillow',
     'pip',
     'pkgconfig',
     'pluggy',
     'polytopes_db',
     'pplpy',
     'prometheus_client',
     'prompt_toolkit',
     'ptyprocess',
     'py',
     'pybind11',
     'pycparser',
     'pycygwin',
     'pygments',
     'pyparsing',
     'pyrsistent',
     'pytz',
     'pyzmq',
     'ratpoints',
     'requests',
     'rpy2',
     'sage_conf',
     'sage_setup',
     'sagelib',
     'sagenb_export',
     'sagetex',
     'scipy',
     'send2trash',
     'setuptools',
     'setuptools_scm',
     'setuptools_wheel',
     'simplegeneric',
     'singular',
     'six',
     'sympy',
     'terminado',
     'testpath',
     'thebe',
     'threejs',
     'tomli',
     'tornado',
     'traitlets',
     'typing_extensions',
     'tzlocal',
     'urllib3',
     'vcversioner',
     'wcwidth',
     'webencodings',
     'wheel',
     'widgetsnbextension',
     'zipp']
**********************************************************************
File "src/sage/misc/package.py", line 390, in sage.misc.package.installed_packages
Failed example:
    installed_packages()['alabaster']  # optional - build, random
Exception raised:
    Traceback (most recent call last):
      File "/home/john/Sage/sage-9.5.beta5/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/john/Sage/sage-9.5.beta5/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.package.installed_packages[1]>", line 1, in <module>
        installed_packages()['alabaster']  # optional - build, random
    KeyError: 'alabaster'
*********************************************************************
```




---

archive/issue_comments_464000.json:
```json
{
    "body": "Also, and maybe this is just how it will have to be, if I use `./configure --disable-doc` and then `make` and then `make doc`, it installs `sphinx` and various other packages, prints a good error message when trying to install `pplpy_doc`, but of continues to install whatever it's in the middle of, so the error message gets buried.",
    "created_at": "2021-11-14T03:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464000",
    "user": "@jhpalmieri"
}
```

Also, and maybe this is just how it will have to be, if I use `./configure --disable-doc` and then `make` and then `make doc`, it installs `sphinx` and various other packages, prints a good error message when trying to install `pplpy_doc`, but of continues to install whatever it's in the middle of, so the error message gets buried.



---

archive/issue_comments_464001.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-14T03:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464001",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464002.json:
```json
{
    "body": "Replying to [comment:98 jhpalmieri]:\n> Also, and maybe this is just how it will have to be, if I use `./configure --disable-doc` and then `make` and then `make doc`, it installs `sphinx` and various other packages, prints a good error message when trying to install `pplpy_doc`, but of continues to install whatever it's in the middle of, so the error message gets buried.\n\nI think it would be too complicated to check for disable-doc earlier",
    "created_at": "2021-11-14T03:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464002",
    "user": "@mkoeppe"
}
```

Replying to [comment:98 jhpalmieri]:
> Also, and maybe this is just how it will have to be, if I use `./configure --disable-doc` and then `make` and then `make doc`, it installs `sphinx` and various other packages, prints a good error message when trying to install `pplpy_doc`, but of continues to install whatever it's in the middle of, so the error message gets buried.

I think it would be too complicated to check for disable-doc earlier



---

archive/issue_comments_464003.json:
```json
{
    "body": "Replying to [comment:97 jhpalmieri]:\n> On an Ubuntu virtual machine, I'm getting doctest failures (with `./configure --disable-doc`) because the `alabaster` package is not installed\n\nThis was also the last failure on my test with macOS, fixed in 1807446 above.",
    "created_at": "2021-11-14T18:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464003",
    "user": "@mkoeppe"
}
```

Replying to [comment:97 jhpalmieri]:
> On an Ubuntu virtual machine, I'm getting doctest failures (with `./configure --disable-doc`) because the `alabaster` package is not installed

This was also the last failure on my test with macOS, fixed in 1807446 above.



---

archive/issue_comments_464004.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-14T19:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464004",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464005.json:
```json
{
    "body": "`make doc` now builds both html and pdf, whereas before it just built html. How many people will this surprise?",
    "created_at": "2021-11-15T03:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464005",
    "user": "@jhpalmieri"
}
```

`make doc` now builds both html and pdf, whereas before it just built html. How many people will this surprise?



---

archive/issue_comments_464006.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-15T03:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464006",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464007.json:
```json
{
    "body": "Thanks for catching this; an unnecessary change",
    "created_at": "2021-11-15T03:55:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464007",
    "user": "@mkoeppe"
}
```

Thanks for catching this; an unnecessary change



---

archive/issue_comments_464008.json:
```json
{
    "body": "This part obviously works, but let me see if I understand the syntax:\n\n```\n$(1)-$(4)-no-deps:\n\t+@if [ -z '$$($(4))' ]; then \\\n\t    echo \"Error: The installation tree $(4) has been disabled\" 2>&1; \\\n\t    echo \"$$($(4)_DISABLED_MESSAGE)\" 2>&1; \\\n\t    exit 1; \\\n```\n\nIs the following right? In the case of this ticket, `$(4)` is `SAGE_DOCS`, and then `$$($(4))` evaluates the Makefile variable `SAGE_DOCS`, which will be empty if docs have been disabled.",
    "created_at": "2021-11-16T04:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464008",
    "user": "@jhpalmieri"
}
```

This part obviously works, but let me see if I understand the syntax:

```
$(1)-$(4)-no-deps:
	+@if [ -z '$$($(4))' ]; then \
	    echo "Error: The installation tree $(4) has been disabled" 2>&1; \
	    echo "$$($(4)_DISABLED_MESSAGE)" 2>&1; \
	    exit 1; \
```

Is the following right? In the case of this ticket, `$(4)` is `SAGE_DOCS`, and then `$$($(4))` evaluates the Makefile variable `SAGE_DOCS`, which will be empty if docs have been disabled.



---

archive/issue_comments_464009.json:
```json
{
    "body": "That's right.",
    "created_at": "2021-11-16T04:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464009",
    "user": "@mkoeppe"
}
```

That's right.



---

archive/issue_comments_464010.json:
```json
{
    "body": "Okay, let's merge it.",
    "created_at": "2021-11-16T05:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464010",
    "user": "@jhpalmieri"
}
```

Okay, let's merge it.



---

archive/issue_comments_464011.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-11-16T05:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464011",
    "user": "@jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_464012.json:
```json
{
    "body": "Thank you!",
    "created_at": "2021-11-16T05:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464012",
    "user": "@mkoeppe"
}
```

Thank you!



---

archive/issue_comments_464013.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-12-12T17:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464013",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_464014.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-12-12T17:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464014",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_464015.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-12T17:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464015",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_464016.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-12-23T21:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464016",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_464017.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-12-23T21:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464017",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_464018.json:
```json
{
    "body": "Merged latest beta to resolve merge conflicts.",
    "created_at": "2021-12-23T21:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464018",
    "user": "@mkoeppe"
}
```

Merged latest beta to resolve merge conflicts.



---

archive/issue_comments_464019.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-23T23:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464019",
    "user": "@jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_464020.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-12-24T00:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464020",
    "user": "@mkoeppe"
}
```

Thanks!



---

archive/issue_comments_464021.json:
```json
{
    "body": "There seems to be a merge gone wrong in `src/sage/doctest/control.py`.",
    "created_at": "2021-12-26T23:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464021",
    "user": "@tornaria"
}
```

There seems to be a merge gone wrong in `src/sage/doctest/control.py`.



---

archive/issue_comments_464022.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-12-26T23:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464022",
    "user": "@mkoeppe"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_464023.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-26T23:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464023",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_464024.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-26T23:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464024",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_464025.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-29T19:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464025",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_464026.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2021-12-31T10:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464026",
    "user": "@dimpase"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_464027.json:
```json
{
    "body": "this fixes pdf building in the latest beta, hence blocker",
    "created_at": "2021-12-31T10:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464027",
    "user": "@dimpase"
}
```

this fixes pdf building in the latest beta, hence blocker



---

archive/issue_comments_464028.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-01-01T20:15:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464028",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_464029.json:
```json
{
    "body": "Still broken for me\n\n```\n$ make doc-clean\n$ make doc-pdf\n[...]\n[sagemath_doc_pdf-none] LaTeX2e <2020-10-01> patch level 4\n[sagemath_doc_pdf-none] L3 programming layer <2021-05-07>\n[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/latex/oberdiek/hypcap.sty))))\n[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/latex/titlesec/titlesec.sty [91\n[sagemath_doc_pdf-none] (./sphinxlatexnumfig.sty (./sphinxmanual.cls])\n[sagemath_doc_pdf-none] (./sphinxmessages.sty\n[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/generic/babel/babel.sty) (./sphinxlatexlists.sty)\n[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/latex/amsfonts/umsb.fd)\n[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/generic/babel/babel.def\n[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/latex/jknapltx/ursfs.fd))) (./sphinxpackagefootnote.sty\n[sagemath_doc_pdf-none] \n[sagemath_doc_pdf-none] (./sphinxlatexstyletext.sty\n[sagemath_doc_pdf-none] Document Class: sphinxmanual 2019/12/01 v2.3.0 Document class (Sphinx manual)\n[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/latex/base/report.cls))\n[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/latex/jknapltx/mathrsfs.sty) (./sphinxlatexobjects.sty\n[sagemath_doc_pdf-none] Document Class: report 2020/04/10 v1.4m Standard LaTeX document class\n[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/latex/base/size10.clo\n[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/generic/babel/txtbabel.def) [1 (./sphinxlatexindbibtoc.sty){/usr/share/texli\n[sagemath_doc_pdf-none] ve/texmf-var/fonts/map/pdftex/updmap/pdftex.map)))\n[sagemath_doc_pdf-none] \n[sagemath_doc_pdf-none] LaTeX Warning: File `{../../../../../local/share/doc/sage/doctrees/en/reference\n[sagemath_doc_pdf-none] /plot_directive/sage/combinat/crystals/mv_polytopes-1}.pdf' not found on input \n[sagemath_doc_pdf-none] line 47273.\n[sagemath_doc_pdf-none] \n[sagemath_doc_pdf-none] \n[sagemath_doc_pdf-none] LaTeX Warning: File `{../../../../../local/share/doc/sage/doctrees/en/reference\n[sagemath_doc_pdf-none] /plot_directive/sage/combinat/crystals/mv_polytopes-1}.pdf' not found on input \n[sagemath_doc_pdf-none] line 47273.\n[sagemath_doc_pdf-none] \n[sagemath_doc_pdf-none] \n[sagemath_doc_pdf-none] ! Package pdftex.def Error: File `../../../../../local/share/doc/sage/doctrees/\n[sagemath_doc_pdf-none] en/reference/plot_directive/sage/combinat/crystals/mv_polytopes-1.pdf' not foun\n[sagemath_doc_pdf-none] d: using draft setting.\n[sagemath_doc_pdf-none] \n[sagemath_doc_pdf-none] See the pdftex.def package documentation for explanation.\n[sagemath_doc_pdf-none] Type  H <return>  for immediate help.\n[sagemath_doc_pdf-none]  ...                                              \n[sagemath_doc_pdf-none]                                                   \n[sagemath_doc_pdf-none] l.47273 .../combinat/crystals/mv_polytopes-1}.pdf}\n[sagemath_doc_pdf-none]                                                   \n[sagemath_doc_pdf-none] ? Latexmk: Index file 'constructions.idx' was written\n[sagemath_doc_pdf-none] \n[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/latex/base/makeidx.sty))))\n[sagemath_doc_pdf-none] ! Emergency stop.\n```\n\nAlso this runs in `/home/release/Sage/local/share/doc/sage/latex/en/reference/combinat` and `../../../../../local/share/doc/sage/doctrees/en/reference/plot_directive/sage/combinat/crystals/mv_polytopes-1` is missing `../../..`, how can that ever work?",
    "created_at": "2022-01-01T20:15:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464029",
    "user": "@vbraun"
}
```

Still broken for me

```
$ make doc-clean
$ make doc-pdf
[...]
[sagemath_doc_pdf-none] LaTeX2e <2020-10-01> patch level 4
[sagemath_doc_pdf-none] L3 programming layer <2021-05-07>
[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/latex/oberdiek/hypcap.sty))))
[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/latex/titlesec/titlesec.sty [91
[sagemath_doc_pdf-none] (./sphinxlatexnumfig.sty (./sphinxmanual.cls])
[sagemath_doc_pdf-none] (./sphinxmessages.sty
[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/generic/babel/babel.sty) (./sphinxlatexlists.sty)
[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/latex/amsfonts/umsb.fd)
[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/generic/babel/babel.def
[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/latex/jknapltx/ursfs.fd))) (./sphinxpackagefootnote.sty
[sagemath_doc_pdf-none] 
[sagemath_doc_pdf-none] (./sphinxlatexstyletext.sty
[sagemath_doc_pdf-none] Document Class: sphinxmanual 2019/12/01 v2.3.0 Document class (Sphinx manual)
[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/latex/base/report.cls))
[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/latex/jknapltx/mathrsfs.sty) (./sphinxlatexobjects.sty
[sagemath_doc_pdf-none] Document Class: report 2020/04/10 v1.4m Standard LaTeX document class
[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/latex/base/size10.clo
[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/generic/babel/txtbabel.def) [1 (./sphinxlatexindbibtoc.sty){/usr/share/texli
[sagemath_doc_pdf-none] ve/texmf-var/fonts/map/pdftex/updmap/pdftex.map)))
[sagemath_doc_pdf-none] 
[sagemath_doc_pdf-none] LaTeX Warning: File `{../../../../../local/share/doc/sage/doctrees/en/reference
[sagemath_doc_pdf-none] /plot_directive/sage/combinat/crystals/mv_polytopes-1}.pdf' not found on input 
[sagemath_doc_pdf-none] line 47273.
[sagemath_doc_pdf-none] 
[sagemath_doc_pdf-none] 
[sagemath_doc_pdf-none] LaTeX Warning: File `{../../../../../local/share/doc/sage/doctrees/en/reference
[sagemath_doc_pdf-none] /plot_directive/sage/combinat/crystals/mv_polytopes-1}.pdf' not found on input 
[sagemath_doc_pdf-none] line 47273.
[sagemath_doc_pdf-none] 
[sagemath_doc_pdf-none] 
[sagemath_doc_pdf-none] ! Package pdftex.def Error: File `../../../../../local/share/doc/sage/doctrees/
[sagemath_doc_pdf-none] en/reference/plot_directive/sage/combinat/crystals/mv_polytopes-1.pdf' not foun
[sagemath_doc_pdf-none] d: using draft setting.
[sagemath_doc_pdf-none] 
[sagemath_doc_pdf-none] See the pdftex.def package documentation for explanation.
[sagemath_doc_pdf-none] Type  H <return>  for immediate help.
[sagemath_doc_pdf-none]  ...                                              
[sagemath_doc_pdf-none]                                                   
[sagemath_doc_pdf-none] l.47273 .../combinat/crystals/mv_polytopes-1}.pdf}
[sagemath_doc_pdf-none]                                                   
[sagemath_doc_pdf-none] ? Latexmk: Index file 'constructions.idx' was written
[sagemath_doc_pdf-none] 
[sagemath_doc_pdf-none] (/usr/share/texlive/texmf-dist/tex/latex/base/makeidx.sty))))
[sagemath_doc_pdf-none] ! Emergency stop.
```

Also this runs in `/home/release/Sage/local/share/doc/sage/latex/en/reference/combinat` and `../../../../../local/share/doc/sage/doctrees/en/reference/plot_directive/sage/combinat/crystals/mv_polytopes-1` is missing `../../..`, how can that ever work?



---

archive/issue_comments_464030.json:
```json
{
    "body": "How is this `needs_work` for this ticket if it's already broken in 9.5.beta9?",
    "created_at": "2022-01-01T20:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464030",
    "user": "@mkoeppe"
}
```

How is this `needs_work` for this ticket if it's already broken in 9.5.beta9?



---

archive/issue_comments_464031.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-01-01T20:46:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464031",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_464032.json:
```json
{
    "body": "Note that since #29310, you need to use `make doc-uninstall` to get rid of the stuff in `local/share/doc/sage`.",
    "created_at": "2022-01-01T21:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464032",
    "user": "@mkoeppe"
}
```

Note that since #29310, you need to use `make doc-uninstall` to get rid of the stuff in `local/share/doc/sage`.



---

archive/issue_comments_464033.json:
```json
{
    "body": "So `make doc-clean` doesn't clean any more? We tell people (in the console output, among other places, to run that if they are having trouble with incremental doc builds.\n\nThis ticket was supposed to fix #33076 but apparently didn't (or, possibly, the ...-clean targets are totally broken). Are incremental builds still supported?",
    "created_at": "2022-01-01T23:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464033",
    "user": "@vbraun"
}
```

So `make doc-clean` doesn't clean any more? We tell people (in the console output, among other places, to run that if they are having trouble with incremental doc builds.

This ticket was supposed to fix #33076 but apparently didn't (or, possibly, the ...-clean targets are totally broken). Are incremental builds still supported?



---

archive/issue_comments_464034.json:
```json
{
    "body": "Replying to [comment:128 vbraun]:\n> This ticket was supposed to fix #33076 but apparently didn't \n\nI don't think anyone has been able to reproduce the failure that you reported in #33076.",
    "created_at": "2022-01-01T23:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464034",
    "user": "@mkoeppe"
}
```

Replying to [comment:128 vbraun]:
> This ticket was supposed to fix #33076 but apparently didn't 

I don't think anyone has been able to reproduce the failure that you reported in #33076.



---

archive/issue_comments_464035.json:
```json
{
    "body": "Replying to [comment:128 vbraun]:\n> So `make doc-clean` doesn't clean any more? \n\nWasn't me, but I think it was intended as a step in the direction of fixing the \"clean\" vs. \"uninstall\" confusion in the Sage build system. More in #21775 and #29097.",
    "created_at": "2022-01-01T23:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464035",
    "user": "@mkoeppe"
}
```

Replying to [comment:128 vbraun]:
> So `make doc-clean` doesn't clean any more? 

Wasn't me, but I think it was intended as a step in the direction of fixing the "clean" vs. "uninstall" confusion in the Sage build system. More in #21775 and #29097.



---

archive/issue_comments_464036.json:
```json
{
    "body": "Replying to [comment:128 vbraun]:\n> So `make doc-clean` doesn't clean any more? We tell people (in the console output, among other places, to run that if they are having trouble with incremental doc builds.\n\nThat's a good point: see #33104.",
    "created_at": "2022-01-01T23:48:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464036",
    "user": "@jhpalmieri"
}
```

Replying to [comment:128 vbraun]:
> So `make doc-clean` doesn't clean any more? We tell people (in the console output, among other places, to run that if they are having trouble with incremental doc builds.

That's a good point: see #33104.



---

archive/issue_comments_464037.json:
```json
{
    "body": "Replying to [comment:128 vbraun]:\n> So `make doc-clean` doesn't clean any more? We tell people (in the console output, among other places, to run that if they are having trouble with incremental doc builds.\n\nAfter #29310, `make doc-clean` removes the autogenerated stuff in `src/doc/en/reference`, and `make doc-uninstall` removes the built documentation.",
    "created_at": "2022-01-01T23:56:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464037",
    "user": "@jhpalmieri"
}
```

Replying to [comment:128 vbraun]:
> So `make doc-clean` doesn't clean any more? We tell people (in the console output, among other places, to run that if they are having trouble with incremental doc builds.

After #29310, `make doc-clean` removes the autogenerated stuff in `src/doc/en/reference`, and `make doc-uninstall` removes the built documentation.



---

archive/issue_comments_464038.json:
```json
{
    "body": "See also #29097#comment:9.",
    "created_at": "2022-01-01T23:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464038",
    "user": "@jhpalmieri"
}
```

See also #29097#comment:9.



---

archive/issue_comments_464039.json:
```json
{
    "body": "Of course a bit of weirdness there is that the inventories / pickles are both input and output for the docbuild.",
    "created_at": "2022-01-01T23:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464039",
    "user": "@mkoeppe"
}
```

Of course a bit of weirdness there is that the inventories / pickles are both input and output for the docbuild.



---

archive/issue_comments_464040.json:
```json
{
    "body": "I did a full rebuild after `git clean -f -d -x` and pdf docs still don't build, same failure.",
    "created_at": "2022-01-02T00:52:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464040",
    "user": "@vbraun"
}
```

I did a full rebuild after `git clean -f -d -x` and pdf docs still don't build, same failure.



---

archive/issue_comments_464041.json:
```json
{
    "body": "Replying to [comment:135 vbraun]:\n> I did a full rebuild after `git clean -f -d -x` and pdf docs still don't build, same failure.\n\nWhat OS etc are you running this on? Any manually tweaked TeX stuff?",
    "created_at": "2022-01-02T09:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464041",
    "user": "@dimpase"
}
```

Replying to [comment:135 vbraun]:
> I did a full rebuild after `git clean -f -d -x` and pdf docs still don't build, same failure.

What OS etc are you running this on? Any manually tweaked TeX stuff?



---

archive/issue_comments_464042.json:
```json
{
    "body": "I'm running Fedora 35, standard OS-wide latex installation. Also the path is wrong inside the TeX file, so the issue is already there before TeX runs.",
    "created_at": "2022-01-02T11:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464042",
    "user": "@vbraun"
}
```

I'm running Fedora 35, standard OS-wide latex installation. Also the path is wrong inside the TeX file, so the issue is already there before TeX runs.



---

archive/issue_comments_464043.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-01-02T17:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464043",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_464044.json:
```json
{
    "body": "Tests fail",
    "created_at": "2022-01-02T17:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464044",
    "user": "@vbraun"
}
```

Tests fail



---

archive/issue_comments_464045.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-01-02T22:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464045",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_464046.json:
```json
{
    "body": "Which ones.",
    "created_at": "2022-01-02T22:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464046",
    "user": "@mkoeppe"
}
```

Which ones.



---

archive/issue_comments_464047.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2022-01-02T22:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464047",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_464048.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2022-01-02T22:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464048",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_464049.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-01-02T23:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464049",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_464050.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-01-09T10:47:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32522#issuecomment-464050",
    "user": "@vbraun"
}
```

Resolution: fixed
