# Issue 11102: Cholesky matrix decomposition breaks over the rationals

Issue created by migration from Trac.

Original creator: rbeezer

Original creation time: 2011-04-28 23:47:56

Assignee: jason, was

CC:  ddrake novoselt

The matrix E is clearly symmetric, and by looking at its eigenvalues and the determinants of principal submatrices it is clearly positive definite.  


```
sage: E = matrix(QQ, [[2, 1], [1, 1]])
sage: E.is_symmetric()
True
sage: E.eigenvalues()
[0.3819660112501051?, 2.618033988749895?]
sage: E.det()
1
sage: E.cholesky_decomposition()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

<snip>

ValueError: The input matrix was not symmetric and positive definite
```


At best the error message is misleading.  

The try/except block needs to be more careful.  It should be checking if square roots are contained in the base ring, or it should first convert to an algebraically closed field, or something like that.

In this example, the error is raised because the square root of a rational is not again a rational, when I think the test should be if the argument to the square root is negative.

Perhaps for `QQ`, the base ring should be promoted to the Real Algebraic Field, `AA`.


---

Attachment

Safe-keeping


---

Comment by rbeezer created at 2012-05-27 03:54:14

*  Caching indefinite factorization seems to be ready to go.
*  Exact Cholesky decomposition is working - tested on simple examples, but needs documentation.
*  Cholesky overall needs a brutal refactoring, the existing situation is a *total mess.*


---

Comment by rbeezer created at 2012-05-27 03:54:14

Changing keywords from "" to "sd40.5".


---

Comment by ddrake created at 2012-05-27 05:43:14

Positive review to attachment:trac_11274-cache-indefinite-factors-v1.patch.


---

Attachment

"v1" patch implements Cholesky decomposition for matrices over exact rings, based on the indefinite factorization routines.

This is named `cholesky()` in preparation for its un-deprecation.  A *total cleanup* of the *total mess* will be the next task/ticket.


---

Comment by rbeezer created at 2012-05-27 22:32:37

Changing status from new to needs_review.


---

Comment by ddrake created at 2012-05-28 17:46:17

The exact Cholesky decomposition looks good. The only thing we might want is to add in the example from the description of the ticket (which now works) but the documentation is quite thorough, so it seems very unlikely that the little 2x2 case will fail with the tests we have.

Runtime for random matrices over the rationals is fine; 100x100 matrices finish in about 6.2 seconds on my machine.

Positive review to trac_11274-exact-cholesky-v1.patch.

Apply trac_11274-cache-indefinite-factors-v1.patch and 
trac_11274-exact-cholesky-v1.patch


---

Comment by ddrake created at 2012-05-28 17:46:17

Changing status from needs_review to positive_review.


---

Comment by rbeezer created at 2012-05-28 19:26:46

Changing status from positive_review to needs_work.


---

Attachment

"two-by-two" patch adds the motivational 2 x 2 example and fixed three doctest formatting mistakes.


---

Comment by rbeezer created at 2012-05-28 19:28:02

Changing status from needs_work to needs_review.


---

Comment by ddrake created at 2012-05-29 02:08:11

Changing status from needs_review to positive_review.


---

Comment by ddrake created at 2012-05-29 02:08:11

The extra 2x2 example is nice. Positive review.

Apply trac_11274-cache-indefinite-factors-v1.patch  trac_11274-exact-cholesky-v1.patch  trac_11274-exact-cholesky-two-by-two.patch


---

Comment by jdemeyer created at 2012-06-18 10:23:00

Resolution: fixed
