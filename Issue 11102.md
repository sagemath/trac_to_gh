# Issue 11102: Cholesky matrix decomposition breaks over the rationals

archive/issues_011102.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  @dandrake @novoselt\n\nThe matrix E is clearly symmetric, and by looking at its eigenvalues and the determinants of principal submatrices it is clearly positive definite.  \n\n\n```\nsage: E = matrix(QQ, [[2, 1], [1, 1]])\nsage: E.is_symmetric()\nTrue\nsage: E.eigenvalues()\n[0.3819660112501051?, 2.618033988749895?]\nsage: E.det()\n1\nsage: E.cholesky_decomposition()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n<snip>\n\nValueError: The input matrix was not symmetric and positive definite\n```\n\n\nAt best the error message is misleading.  \n\nThe try/except block needs to be more careful.  It should be checking if square roots are contained in the base ring, or it should first convert to an algebraically closed field, or something like that.\n\nIn this example, the error is raised because the square root of a rational is not again a rational, when I think the test should be if the argument to the square root is negative.\n\nPerhaps for `QQ`, the base ring should be promoted to the Real Algebraic Field, `AA`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11274\n\n",
    "created_at": "2011-04-28T23:47:56Z",
    "labels": [
        "component: linear algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "Cholesky matrix decomposition breaks over the rationals",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11102",
    "user": "https://github.com/rbeezer"
}
```
Assignee: jason, was

CC:  @dandrake @novoselt

The matrix E is clearly symmetric, and by looking at its eigenvalues and the determinants of principal submatrices it is clearly positive definite.  


```
sage: E = matrix(QQ, [[2, 1], [1, 1]])
sage: E.is_symmetric()
True
sage: E.eigenvalues()
[0.3819660112501051?, 2.618033988749895?]
sage: E.det()
1
sage: E.cholesky_decomposition()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

<snip>

ValueError: The input matrix was not symmetric and positive definite
```


At best the error message is misleading.  

The try/except block needs to be more careful.  It should be checking if square roots are contained in the base ring, or it should first convert to an algebraically closed field, or something like that.

In this example, the error is raised because the square root of a rational is not again a rational, when I think the test should be if the argument to the square root is negative.

Perhaps for `QQ`, the base ring should be promoted to the Real Algebraic Field, `AA`.

Issue created by migration from https://trac.sagemath.org/ticket/11274





---

archive/issue_comments_121223.json:
```json
{
    "body": "Attachment [trac_11274-exact-cholesky-draft1.patch](tarball://root/attachments/some-uuid/ticket11274/trac_11274-exact-cholesky-draft1.patch) by @rbeezer created at 2012-05-27 03:48:20\n\nSafe-keeping",
    "created_at": "2012-05-27T03:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11102#issuecomment-121223",
    "user": "https://github.com/rbeezer"
}
```

Attachment [trac_11274-exact-cholesky-draft1.patch](tarball://root/attachments/some-uuid/ticket11274/trac_11274-exact-cholesky-draft1.patch) by @rbeezer created at 2012-05-27 03:48:20

Safe-keeping



---

archive/issue_comments_121224.json:
```json
{
    "body": "*  Caching indefinite factorization seems to be ready to go.\n*  Exact Cholesky decomposition is working - tested on simple examples, but needs documentation.\n*  Cholesky overall needs a brutal refactoring, the existing situation is a **total mess.**",
    "created_at": "2012-05-27T03:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11102#issuecomment-121224",
    "user": "https://github.com/rbeezer"
}
```

*  Caching indefinite factorization seems to be ready to go.
*  Exact Cholesky decomposition is working - tested on simple examples, but needs documentation.
*  Cholesky overall needs a brutal refactoring, the existing situation is a **total mess.**



---

archive/issue_comments_121225.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd40.5\".",
    "created_at": "2012-05-27T03:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11102#issuecomment-121225",
    "user": "https://github.com/rbeezer"
}
```

Changing keywords from "" to "sd40.5".



---

archive/issue_comments_121226.json:
```json
{
    "body": "Positive review to attachment:trac_11274-cache-indefinite-factors-v1.patch.",
    "created_at": "2012-05-27T05:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11102#issuecomment-121226",
    "user": "https://github.com/dandrake"
}
```

Positive review to attachment:trac_11274-cache-indefinite-factors-v1.patch.



---

archive/issue_comments_121227.json:
```json
{
    "body": "Attachment [trac_11274-exact-cholesky-v1.patch](tarball://root/attachments/some-uuid/ticket11274/trac_11274-exact-cholesky-v1.patch) by @rbeezer created at 2012-05-27 22:32:37\n\n\"v1\" patch implements Cholesky decomposition for matrices over exact rings, based on the indefinite factorization routines.\n\nThis is named `cholesky()` in preparation for its un-deprecation.  A **total cleanup** of the **total mess** will be the next task/ticket.",
    "created_at": "2012-05-27T22:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11102#issuecomment-121227",
    "user": "https://github.com/rbeezer"
}
```

Attachment [trac_11274-exact-cholesky-v1.patch](tarball://root/attachments/some-uuid/ticket11274/trac_11274-exact-cholesky-v1.patch) by @rbeezer created at 2012-05-27 22:32:37

"v1" patch implements Cholesky decomposition for matrices over exact rings, based on the indefinite factorization routines.

This is named `cholesky()` in preparation for its un-deprecation.  A **total cleanup** of the **total mess** will be the next task/ticket.



---

archive/issue_comments_121228.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-05-27T22:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11102#issuecomment-121228",
    "user": "https://github.com/rbeezer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_121229.json:
```json
{
    "body": "The exact Cholesky decomposition looks good. The only thing we might want is to add in the example from the description of the ticket (which now works) but the documentation is quite thorough, so it seems very unlikely that the little 2x2 case will fail with the tests we have.\n\nRuntime for random matrices over the rationals is fine; 100x100 matrices finish in about 6.2 seconds on my machine.\n\nPositive review to trac_11274-exact-cholesky-v1.patch.\n\nApply trac_11274-cache-indefinite-factors-v1.patch and \ntrac_11274-exact-cholesky-v1.patch",
    "created_at": "2012-05-28T17:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11102#issuecomment-121229",
    "user": "https://github.com/dandrake"
}
```

The exact Cholesky decomposition looks good. The only thing we might want is to add in the example from the description of the ticket (which now works) but the documentation is quite thorough, so it seems very unlikely that the little 2x2 case will fail with the tests we have.

Runtime for random matrices over the rationals is fine; 100x100 matrices finish in about 6.2 seconds on my machine.

Positive review to trac_11274-exact-cholesky-v1.patch.

Apply trac_11274-cache-indefinite-factors-v1.patch and 
trac_11274-exact-cholesky-v1.patch



---

archive/issue_comments_121230.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-28T17:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11102#issuecomment-121230",
    "user": "https://github.com/dandrake"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_121231.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-05-28T19:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11102#issuecomment-121231",
    "user": "https://github.com/rbeezer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_121232.json:
```json
{
    "body": "Attachment [trac_11274-exact-cholesky-two-by-two.patch](tarball://root/attachments/some-uuid/ticket11274/trac_11274-exact-cholesky-two-by-two.patch) by @rbeezer created at 2012-05-28 19:26:46\n\n\"two-by-two\" patch adds the motivational 2 x 2 example and fixed three doctest formatting mistakes.",
    "created_at": "2012-05-28T19:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11102#issuecomment-121232",
    "user": "https://github.com/rbeezer"
}
```

Attachment [trac_11274-exact-cholesky-two-by-two.patch](tarball://root/attachments/some-uuid/ticket11274/trac_11274-exact-cholesky-two-by-two.patch) by @rbeezer created at 2012-05-28 19:26:46

"two-by-two" patch adds the motivational 2 x 2 example and fixed three doctest formatting mistakes.



---

archive/issue_comments_121233.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-28T19:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11102#issuecomment-121233",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_121234.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-29T02:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11102#issuecomment-121234",
    "user": "https://github.com/dandrake"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_121235.json:
```json
{
    "body": "The extra 2x2 example is nice. Positive review.\n\nApply trac_11274-cache-indefinite-factors-v1.patch  trac_11274-exact-cholesky-v1.patch  trac_11274-exact-cholesky-two-by-two.patch",
    "created_at": "2012-05-29T02:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11102#issuecomment-121235",
    "user": "https://github.com/dandrake"
}
```

The extra 2x2 example is nice. Positive review.

Apply trac_11274-cache-indefinite-factors-v1.patch  trac_11274-exact-cholesky-v1.patch  trac_11274-exact-cholesky-two-by-two.patch



---

archive/issue_comments_121236.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-18T10:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11102#issuecomment-121236",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
