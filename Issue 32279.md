# Issue 32279: Error calling FriCAS integration from sagemath 9.3

Issue created by migration from https://trac.sagemath.org/ticket/32516

Original creator: @nasser1

Original creation time: 2021-09-15 06:51:17

Keywords: integrate fricas

I do not know if this is known issue or not. If already known, this ticket can be closed.

This seems to be an API error, since the integral works inside FrinCAS 1.3.6, but gives error when FriCAS is called from sagemath



```
sage: var('x')
x
sage: integrate(1/2*I*pi,x, algorithm="fricas")

---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
/usr/lib/python3.9/site-packages/sage/interfaces/expect.py in __init__(self, parent, value, is_name, name)
   1467             try:
-> 1468                 self._name = parent._create(value, name=name)
   1469             # Convert ValueError and RuntimeError to TypeError for

/usr/lib/python3.9/site-packages/sage/interfaces/interface.py in _create(self, value, name)
    499         name = self._next_var_name() if name is None else name
--> 500         self.set(name, value)
    501         return name

/usr/lib/python3.9/site-packages/sage/interfaces/fricas.py in set(self, var, value)
    588         output = self.eval(cmd, reformat=False)
--> 589         self._check_errors(value, output)
    590 

/usr/lib/python3.9/site-packages/sage/interfaces/fricas.py in _check_errors(self, line, output)
    562                 output = output.replace(old, new)
--> 563             raise RuntimeError("An error occurred when FriCAS evaluated '%s':\n%s" % (line, output))
    564 

RuntimeError: An error occurred when FriCAS evaluated '(%pi)*(0+%i*1/2)':
   There are 31 exposed and 40 unexposed library operations named * having
      2 argument(s) but none was determined to be applicable. Use HyperDoc
      Browse, or issue
                                 )display op *
      to learn more about the available operations. Perhaps 
      package-calling the operation or using coercions on the arguments 
      will allow you to apply the operation.

 
   Cannot find a definition or applicable library operation named * with 
      argument type(s) 
                                       Pi
                           Fraction(Complex(Integer))
      
      Perhaps you should use "@" to indicate the required return type, or 
      "$" to specify which version of the function you need.



During handling of the above exception, another exception occurred:

TypeError                                 Traceback (most recent call last)
<ipython-input-18-ba123337c07f> in <module>
----> 1 integrate(Integer(1)/Integer(2)*I*pi,x, algorithm="fricas")

/usr/lib/python3.9/site-packages/sage/misc/functional.py in integral(x, *args, **kwds)
    757     """
    758     if hasattr(x, 'integral'):
--> 759         return x.integral(*args, **kwds)
    760     else:
    761         from sage.symbolic.ring import SR

/usr/lib/python3.9/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.integral (build/cythonized/sage/symbolic/expression.cpp:66867)()
  12645                     R = SR
  12646             return R(integral(f, v, a, b, **kwds))
> 12647         return integral(self, *args, **kwds)
  12648 
  12649     integrate = integral

/usr/lib/python3.9/site-packages/sage/symbolic/integration/integral.py in integrate(expression, v, a, b, algorithm, hold)
    988         if not integrator:
    989             raise ValueError("Unknown algorithm: %s" % algorithm)
--> 990         return integrator(expression, v, a, b)
    991     if a is None:
    992         return indefinite_integral(expression, v, hold=hold)

/usr/lib/python3.9/site-packages/sage/symbolic/integration/external.py in fricas_integrator(expression, v, a, b, noPole)
    397 
    398     from sage.interfaces.fricas import fricas
--> 399     ex = fricas(expression)
    400 
    401     if a is None:

/usr/lib/python3.9/site-packages/sage/interfaces/interface.py in __call__(self, x, name)
    300             # user-assigned name might change its value, so we return a
    301             # new element.
--> 302             result = self._coerce_from_special_method(x)
    303             return result if name is None else result.name(new_name=name)
    304         except TypeError:

/usr/lib/python3.9/site-packages/sage/interfaces/interface.py in _coerce_from_special_method(self, x)
    328             s = '_gp_'
    329         try:
--> 330             return (x.__getattribute__(s))(self)
    331         except AttributeError:
    332             return self(x._interface_init_())

/usr/lib/python3.9/site-packages/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._fricas_ (build/cythonized/sage/structure/sage_object.c:7616)()
    767             import sage.interfaces.fricas
    768             G = sage.interfaces.fricas.fricas
--> 769         return self._interface_(G)
    770 
    771     def _fricas_init_(self):

/usr/lib/python3.9/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._interface_ (build/cythonized/sage/symbolic/expression.cpp:7789)()
    995         if is_a_constant(self._gobj):
    996             return self.pyobject()._interface_(I)
--> 997         return super(Expression, self)._interface_(I)
    998 
    999     def _maxima_(self, session=None):

/usr/lib/python3.9/site-packages/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:5764)()
    690             except Exception:
    691                 raise NotImplementedError("coercion of object %s to %s not implemented:\n%s\n%s" % (repr(self), I))
--> 692         X = I(s)
    693         if c:
    694             try:

/usr/lib/python3.9/site-packages/sage/interfaces/interface.py in __call__(self, x, name)
    293 
    294         if isinstance(x, str):
--> 295             return cls(self, x, name=name)
    296         try:
    297             # Special methods do not and should not have an option to

/usr/lib/python3.9/site-packages/sage/interfaces/expect.py in __init__(self, parent, value, is_name, name)
   1471             except (RuntimeError, ValueError) as x:
   1472                 self._session_number = -1
-> 1473                 raise TypeError(*x.args)
   1474             except BaseException:
   1475                 self._session_number = -1

TypeError: An error occurred when FriCAS evaluated '(%pi)*(0+%i*1/2)':
   There are 31 exposed and 40 unexposed library operations named * having
      2 argument(s) but none was determined to be applicable. Use HyperDoc
      Browse, or issue
                                 )display op *
      to learn more about the available operations. Perhaps 
      package-calling the operation or using coercions on the arguments 
      will allow you to apply the operation.

 
   Cannot find a definition or applicable library operation named * with 
      argument type(s) 
                                       Pi
                           Fraction(Complex(Integer))
      
      Perhaps you should use "@" to indicate the required return type, or 
      "$" to specify which version of the function you need.

```


Notice that the integrand has no `x` in it. It is just a constant. It works when changing `1/2` to `2`.



```
sage: integrate(2*I*pi,x, algorithm="fricas")
2*I*pi*x

```


The first one works inside friCAS:



```
6) -> integrate(1/2*%i*%pi,x)

        %i %pi x
   (6)  --------
            2
                                Type: Union(Expression(Complex(Integer)),...)


```


Why using `1/2` makes it fail from sagemath?








---

Comment by chapoton created at 2021-09-15 08:26:36

works fine in 9.5.b1

please always test on the latest beta before reporting errors.


---

Comment by chapoton created at 2021-09-15 08:26:36

Changing status from new to needs_review.


---

Comment by @nasser1 created at 2021-09-15 20:23:27

I can only use stable releases. On my linux box, Manjro, the package manager can only see 9.3 version available.

So I downloaded now the binary stable version which is 9.4 and tried this integral. It gives this



```
SageMath version 9.4, Release Date: 2021-08-22                     │
│ Using Python 3.9.5. Type "help()" for help.     

/home/me/SageMath/local/lib/python3.9/site-packages/traitlets/config/loader.py:795: SyntaxWarning: "is" with a literal. Did you mean "=="?
  if len(key) is 1:
/home/me/SageMath/local/lib/python3.9/site-packages/traitlets/config/loader.py:804: SyntaxWarning: "is" with a literal. Did you mean "=="?
  if len(key) is 1:
/home/me/SageMath/local/lib/python3.9/site-packages/psutil/_pslinux.py:551: DeprecationWarning: invalid escape sequence \d
  search = re.compile('cpu\d')
/home/me/SageMath/local/lib/python3.9/site-packages/psutil/_pslinux.py:1468: DeprecationWarning: invalid escape sequence \s
  _private_re=re.compile(b"Private.*:\s+(\d+)"),
/home/me/SageMath/local/lib/python3.9/site-packages/psutil/_pslinux.py:1469: DeprecationWarning: invalid escape sequence \s
  _pss_re=re.compile(b"Pss.*:\s+(\d+)"),
/home/me/SageMath/local/lib/python3.9/site-packages/psutil/_pslinux.py:1470: DeprecationWarning: invalid escape sequence \s
  _swap_re=re.compile(b"Swap.*:\s+(\d+)")):
/home/me/SageMath/local/lib/python3.9/site-packages/psutil/_pslinux.py:1583: DeprecationWarning: invalid escape sequence \d
  def num_ctx_switches(self, _ctxsw_re=re.compile(b'ctxt_switches:\t(\d+)')):
/home/me/SageMath/local/lib/python3.9/site-packages/psutil/_pslinux.py:1596: DeprecationWarning: invalid escape sequence \d
  def num_threads(self, _num_threads_re=re.compile(b'Threads:\t(\d+)')):
/home/me/SageMath/local/lib/python3.9/site-packages/psutil/_pslinux.py:1652: DeprecationWarning: invalid escape sequence \d
  self, _re=re.compile(b"Cpus_allowed_list:\t(\d+)-(\d+)")):
/home/me/SageMath/local/lib/python3.9/site-packages/psutil/_pslinux.py:1814: DeprecationWarning: invalid escape sequence \d
  def uids(self, _uids_re=re.compile(b'Uid:\t(\d+)\t(\d+)\t(\d+)')):
/home/me/SageMath/local/lib/python3.9/site-packages/psutil/_pslinux.py:1820: DeprecationWarning: invalid escape sequence \d
  def gids(self, _gids_re=re.compile(b'Gid:\t(\d+)\t(\d+)\t(\d+)')):
/home/me/SageMath/local/lib/python3.9/site-packages/sage/combinat/posets/poset_examples.py:158: DeprecationWarning: invalid escape sequence \{
  """
sage: var('x')                                                                                                                             
x
sage: integrate(1/2*I*pi,x, algorithm="fricas")                                                                                            
/home/me/SageMath/local/lib/python3.9/site-packages/sage/symbolic/expression_conversions.py:972: DeprecationWarning: invalid escape sequence \|
  """
1/2*I*pi*x
sage:                                

```


So no error. But lots of warnings about escape sequence.  The Linux I am using is



```
>cat /etc/os-release
NAME="Manjaro Linux"
ID=manjaro
ID_LIKE=arch
BUILD_ID=rolling
PRETTY_NAME="Manjaro Linux"
ANSI_COLOR="32;1;24;144;200"
HOME_URL="https://manjaro.org/"
DOCUMENTATION_URL="https://wiki.manjaro.org/"
SUPPORT_URL="https://manjaro.org/"
BUG_REPORT_URL="https://bugs.manjaro.org/"
LOGO=manjarolinux
>lsb_release -a
shell-init: error retrieving current directory: getcwd: cannot access parent directories: No such file or directory
LSB Version:	n/a
Distributor ID:	ManjaroLinux
Description:	Manjaro Linux
Release:	21.0.4
Codename:	Ornara

```


And sagemath binary I downloaded is 9.4 from https://www.sagemath.org/download-linux.html

Do I need to worry about these warning messages?


---

Comment by @nasser1 created at 2021-09-15 20:32:08

Update:

It looks like these warning messages only show first time starting sage.

When I closed it, and set the page to /home/me/SageMath and starting sage again, now they no long show up. So I am OK now. Will use sagemath 9.4 from now on. 

I do not know why those warnings message about escape sequence showed up the very first time I tried ./sage from installation folder. 



```
>sage
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.4, Release Date: 2021-08-22                     │
│ Using Python 3.9.5. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
sage:  var('x')                                                                 
x
sage: integrate(1/2*I*pi,x, algorithm="fricas")                                 
1/2*I*pi*x
sage:  

```



---

Comment by chapoton created at 2021-09-16 06:38:28

Resolution: invalid
