# Issue 23647: Avoid _element_constructor in padics

archive/issues_023647.json:
```json
{
    "body": "CC:  simonking @koffie\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23884\n\n",
    "created_at": "2017-09-18T14:55:21Z",
    "labels": [
        "component: padics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Avoid _element_constructor in padics",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23647",
    "user": "https://github.com/jdemeyer"
}
```
CC:  simonking @koffie



Issue created by migration from https://trac.sagemath.org/ticket/23884





---

archive/issue_comments_330898.json:
```json
{
    "body": "Why not do this change at #23881 or #23880?",
    "created_at": "2017-09-18T15:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23647#issuecomment-330898",
    "user": "https://github.com/simon-king-jena"
}
```

Why not do this change at #23881 or #23880?



---

archive/issue_comments_330899.json:
```json
{
    "body": "I like small self-contained tickets, not patchbombs.",
    "created_at": "2017-09-18T15:16:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23647#issuecomment-330899",
    "user": "https://github.com/jdemeyer"
}
```

I like small self-contained tickets, not patchbombs.



---

archive/issue_comments_330900.json:
```json
{
    "body": "Also because `padics` is one of the few places outside of the parent/element/coercion framework where `_element_constructor` is directly called.",
    "created_at": "2017-09-18T15:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23647#issuecomment-330900",
    "user": "https://github.com/jdemeyer"
}
```

Also because `padics` is one of the few places outside of the parent/element/coercion framework where `_element_constructor` is directly called.



---

archive/issue_comments_330901.json:
```json
{
    "body": "Branch does *not work* :-(\n----\nNew commits:",
    "created_at": "2017-09-18T15:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23647#issuecomment-330901",
    "user": "https://github.com/jdemeyer"
}
```

Branch does *not work* :-(
----
New commits:



---

archive/issue_comments_330902.json:
```json
{
    "body": "Replying to [comment:5 jdemeyer]:\n> Branch does *not work* :-(\n> ----\n> New commits:\n> ||[8f26c2d](https://git.sagemath.org/sage.git/commit?id=8f26c2db3915b5b571ed721724f2993cbbfc594e)||`Avoid _element_constructor in padics`||\n\nWhen merging it with #23881, at least the tests in sage.structure.parent work (mainly)...\n\nWhat is failing?",
    "created_at": "2017-09-18T16:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23647#issuecomment-330902",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:5 jdemeyer]:
> Branch does *not work* :-(
> ----
> New commits:
> ||[8f26c2d](https://git.sagemath.org/sage.git/commit?id=8f26c2db3915b5b571ed721724f2993cbbfc594e)||`Avoid _element_constructor in padics`||

When merging it with #23881, at least the tests in sage.structure.parent work (mainly)...

What is failing?



---

archive/issue_comments_330903.json:
```json
{
    "body": "Replying to [comment:6 SimonKing]:\n> What is failing?\n\nIn sage.rings.padics, not much is failing actually:\n\n```\nsage -t src/sage/rings/padics/padic_base_leaves.py  # 6 doctests failed\nsage -t src/sage/rings/padics/padic_generic_element.pyx  # 1 doctest failed\nsage -t src/sage/rings/padics/padic_ZZ_pX_FM_element.pyx  # 5 doctests failed\n```\n\nnamely\n\n```\nsage -t src/sage/rings/padics/padic_base_leaves.py\n**********************************************************************\nFile \"src/sage/rings/padics/padic_base_leaves.py\", line 260, in sage.rings.padics.padic_base_leaves.pAdicRingCappedRelative._coerce_map_from_\nFailed example:\n    K.has_coerce_map_from(int)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/rings/padics/padic_base_leaves.py\", line 336, in sage.rings.padics.padic_base_leaves.pAdicRingCappedAbsolute._coerce_map_from_\nFailed example:\n    K.has_coerce_map_from(int)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/rings/padics/padic_base_leaves.py\", line 415, in sage.rings.padics.padic_base_leaves.pAdicRingFloatingPoint._coerce_map_from_\nFailed example:\n    K.has_coerce_map_from(int)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/rings/padics/padic_base_leaves.py\", line 489, in sage.rings.padics.padic_base_leaves.pAdicRingFixedMod._coerce_map_from_\nFailed example:\n    K.has_coerce_map_from(int)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/rings/padics/padic_base_leaves.py\", line 595, in sage.rings.padics.padic_base_leaves.pAdicFieldCappedRelative._coerce_map_from_\nFailed example:\n    K.has_coerce_map_from(int)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/rings/padics/padic_base_leaves.py\", line 700, in sage.rings.padics.padic_base_leaves.pAdicFieldFloatingPoint._coerce_map_from_\nFailed example:\n    K.has_coerce_map_from(int)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n```\n\n\n```\nsage -t src/sage/rings/padics/padic_generic_element.pyx\n**********************************************************************\nFile \"src/sage/rings/padics/padic_generic_element.pyx\", line 2577, in sage.rings.padics.padic_generic_element.pAdicGenericElement.exp\nFailed example:\n    z.log().exp()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.padics.padic_generic_element.pAdicGenericElement.exp[47]>\", line 1, in <module>\n        z.log().exp()\n      File \"sage/rings/padics/padic_generic_element.pyx\", line 2181, in sage.rings.padics.padic_generic_element.pAdicGenericElement.log (build/cythonized/sage/rin)\n        total = R.zero()\n      File \"sage/rings/ring.pyx\", line 710, in sage.rings.ring.Ring.zero (build/cythonized/sage/rings/ring.c:7798)\n        x = self(0)\n      File \"sage/structure/parent.pyx\", line 936, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9668)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 102, in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3790)\n        raise\n      File \"sage/structure/coerce_maps.pyx\", line 97, in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3678)\n        return C._element_constructor(C, x)\n      File \"sage/rings/padics/padic_ZZ_pX_FM_element.pyx\", line 240, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__init__ (build/cythonized/sag)\n        poly = x.polynomial().list()\n    AttributeError: 'int' object has no attribute 'polynomial'\n**********************************************************************\n```\n\n\n```\nsage -t src/sage/rings/padics/padic_ZZ_pX_FM_element.pyx\n**********************************************************************\nFile \"src/sage/rings/padics/padic_ZZ_pX_FM_element.pyx\", line 699, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__\nFailed example:\n    W(0)^0\nException raised:\n    Traceback (most recent call last):\n      File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__[11]>\", line 1, in <module>\n        W(Integer(0))**Integer(0)\n      File \"sage/rings/padics/padic_ZZ_pX_FM_element.pyx\", line 717, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__ (build/cythonized/sage)\n        return self.parent(1)\n      File \"sage/structure/element.pyx\", line 751, in sage.structure.element.Element.parent (build/cythonized/sage/structure/element.c:6987)\n        return self._parent(x)\n      File \"sage/structure/parent.pyx\", line 936, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9668)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 102, in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3790)\n        raise\n      File \"sage/structure/coerce_maps.pyx\", line 97, in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3678)\n        return C._element_constructor(C, x)\n      File \"sage/rings/padics/padic_ZZ_pX_FM_element.pyx\", line 240, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__init__ (build/cythonized/sag)\n        poly = x.polynomial().list()\n    AttributeError: 'int' object has no attribute 'polynomial'\n**********************************************************************\nFile \"src/sage/rings/padics/padic_ZZ_pX_FM_element.pyx\", line 701, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__\nFailed example:\n    W(0)^0 == W(1)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__[12]>\", line 1, in <module>\n        W(Integer(0))**Integer(0) == W(Integer(1))\n      File \"sage/rings/padics/padic_ZZ_pX_FM_element.pyx\", line 717, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__ (build/cythonized/sage)\n        return self.parent(1)\n      File \"sage/structure/element.pyx\", line 751, in sage.structure.element.Element.parent (build/cythonized/sage/structure/element.c:6987)\n        return self._parent(x)\n      File \"sage/structure/parent.pyx\", line 936, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9668)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 102, in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3790)\n        raise\n      File \"sage/structure/coerce_maps.pyx\", line 97, in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3678)\n        return C._element_constructor(C, x)\n      File \"sage/rings/padics/padic_ZZ_pX_FM_element.pyx\", line 240, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__init__ (build/cythonized/sag)\n        poly = x.polynomial().list()\n    AttributeError: 'int' object has no attribute 'polynomial'\n**********************************************************************\nFile \"src/sage/rings/padics/padic_ZZ_pX_FM_element.pyx\", line 710, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__\nFailed example:\n    type(W(0)^0) == type(W(0))\nException raised:\n    Traceback (most recent call last):\n      File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__[17]>\", line 1, in <module>\n        type(W(Integer(0))**Integer(0)) == type(W(Integer(0)))\n      File \"sage/rings/padics/padic_ZZ_pX_FM_element.pyx\", line 717, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__ (build/cythonized/sage)\n        return self.parent(1)\n      File \"sage/structure/element.pyx\", line 751, in sage.structure.element.Element.parent (build/cythonized/sage/structure/element.c:6987)\n        return self._parent(x)\n      File \"sage/structure/parent.pyx\", line 936, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9668)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 102, in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3790)\n        raise\n      File \"sage/structure/coerce_maps.pyx\", line 97, in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3678)\n        return C._element_constructor(C, x)\n      File \"sage/rings/padics/padic_ZZ_pX_FM_element.pyx\", line 240, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__init__ (build/cythonized/sag)\n        poly = x.polynomial().list()\n    AttributeError: 'int' object has no attribute 'polynomial'\n**********************************************************************\nFile \"src/sage/rings/padics/padic_ZZ_pX_FM_element.pyx\", line 815, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement._div_\nFailed example:\n    1 / W(14) == ~W(14)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement._div_[5]>\", line 1, in <module>\n        Integer(1) / W(Integer(14)) == ~W(Integer(14))\n      File \"sage/rings/integer.pyx\", line 1875, in sage.rings.integer.Integer.__div__ (build/cythonized/sage/rings/integer.c:13023)\n        return coercion_model.bin_op(left, right, operator.div)\n      File \"sage/structure/coerce.pyx\", line 1080, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9419)\n        action = self.get_action(xp, yp, op, x, y)\n      File \"sage/structure/coerce.pyx\", line 1627, in sage.structure.coerce.CoercionModel_cache_maps.get_action (build/cythonized/sage/structure/coerce.c:16738)\n        action = self.discover_action(R, S, op, r, s)\n      File \"sage/structure/coerce.pyx\", line 1841, in sage.structure.coerce.CoercionModel_cache_maps.discover_action (build/cythonized/sage/structure/coerce.c:196)\n        K = S._pseudo_fraction_field()\n      File \"sage/rings/ring.pyx\", line 1374, in sage.rings.ring.CommutativeRing._pseudo_fraction_field (build/cythonized/sage/rings/ring.c:13025)\n        return coercion_model.division_parent(self)\n      File \"sage/structure/coerce.pyx\", line 959, in sage.structure.coerce.CoercionModel_cache_maps.division_parent (build/cythonized/sage/structure/coerce.c:9162)\n        cpdef division_parent(self, Parent P):\n      File \"sage/structure/coerce.pyx\", line 994, in sage.structure.coerce.CoercionModel_cache_maps.division_parent (build/cythonized/sage/structure/coerce.c:9052)\n        ret = parent(~P.an_element())\n      File \"sage/rings/padics/padic_ZZ_pX_FM_element.pyx\", line 493, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__invert__ (build/cythonized/s)\n        raise ValueError(\"cannot invert non-unit\")\n    ValueError: cannot invert non-unit\n**********************************************************************\nFile \"src/sage/rings/padics/padic_ZZ_pX_FM_element.pyx\", line 875, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.is_zero\nFailed example:\n    O(w^189).is_zero()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.is_zero[4]>\", line 1, in <module>\n        O(w**Integer(189)).is_zero()\n      File \"/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/rings/big_oh.py\", line 152, in O\n        return x.parent()(0, absprec=x.valuation(), **kwds)\n      File \"sage/structure/parent.pyx\", line 938, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9695)\n        return mor._call_with_args(x, args, kwds)\n      File \"sage/structure/coerce_maps.pyx\", line 131, in sage.structure.coerce_maps.DefaultConvertMap._call_with_args (build/cythonized/sage/structure/coerce_map)\n        raise\n      File \"sage/structure/coerce_maps.pyx\", line 121, in sage.structure.coerce_maps.DefaultConvertMap._call_with_args (build/cythonized/sage/structure/coerce_map)\n        return C._element_constructor(C, x, **kwds)\n      File \"sage/rings/padics/padic_ZZ_pX_FM_element.pyx\", line 240, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__init__ (build/cythonized/sag)\n        poly = x.polynomial().list()\n    AttributeError: 'int' object has no attribute 'polynomial'\n**********************************************************************\n```\n\n\nAs it seems, int conversion has to be fixed. Strange. If ZZ works, int should work as well...",
    "created_at": "2017-09-18T16:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23647#issuecomment-330903",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:6 SimonKing]:
> What is failing?

In sage.rings.padics, not much is failing actually:

```
sage -t src/sage/rings/padics/padic_base_leaves.py  # 6 doctests failed
sage -t src/sage/rings/padics/padic_generic_element.pyx  # 1 doctest failed
sage -t src/sage/rings/padics/padic_ZZ_pX_FM_element.pyx  # 5 doctests failed
```

namely

```
sage -t src/sage/rings/padics/padic_base_leaves.py
**********************************************************************
File "src/sage/rings/padics/padic_base_leaves.py", line 260, in sage.rings.padics.padic_base_leaves.pAdicRingCappedRelative._coerce_map_from_
Failed example:
    K.has_coerce_map_from(int)
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/rings/padics/padic_base_leaves.py", line 336, in sage.rings.padics.padic_base_leaves.pAdicRingCappedAbsolute._coerce_map_from_
Failed example:
    K.has_coerce_map_from(int)
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/rings/padics/padic_base_leaves.py", line 415, in sage.rings.padics.padic_base_leaves.pAdicRingFloatingPoint._coerce_map_from_
Failed example:
    K.has_coerce_map_from(int)
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/rings/padics/padic_base_leaves.py", line 489, in sage.rings.padics.padic_base_leaves.pAdicRingFixedMod._coerce_map_from_
Failed example:
    K.has_coerce_map_from(int)
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/rings/padics/padic_base_leaves.py", line 595, in sage.rings.padics.padic_base_leaves.pAdicFieldCappedRelative._coerce_map_from_
Failed example:
    K.has_coerce_map_from(int)
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/rings/padics/padic_base_leaves.py", line 700, in sage.rings.padics.padic_base_leaves.pAdicFieldFloatingPoint._coerce_map_from_
Failed example:
    K.has_coerce_map_from(int)
Expected:
    True
Got:
    False
**********************************************************************
```


```
sage -t src/sage/rings/padics/padic_generic_element.pyx
**********************************************************************
File "src/sage/rings/padics/padic_generic_element.pyx", line 2577, in sage.rings.padics.padic_generic_element.pAdicGenericElement.exp
Failed example:
    z.log().exp()
Exception raised:
    Traceback (most recent call last):
      File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.padics.padic_generic_element.pAdicGenericElement.exp[47]>", line 1, in <module>
        z.log().exp()
      File "sage/rings/padics/padic_generic_element.pyx", line 2181, in sage.rings.padics.padic_generic_element.pAdicGenericElement.log (build/cythonized/sage/rin)
        total = R.zero()
      File "sage/rings/ring.pyx", line 710, in sage.rings.ring.Ring.zero (build/cythonized/sage/rings/ring.c:7798)
        x = self(0)
      File "sage/structure/parent.pyx", line 936, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9668)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 102, in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3790)
        raise
      File "sage/structure/coerce_maps.pyx", line 97, in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3678)
        return C._element_constructor(C, x)
      File "sage/rings/padics/padic_ZZ_pX_FM_element.pyx", line 240, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__init__ (build/cythonized/sag)
        poly = x.polynomial().list()
    AttributeError: 'int' object has no attribute 'polynomial'
**********************************************************************
```


```
sage -t src/sage/rings/padics/padic_ZZ_pX_FM_element.pyx
**********************************************************************
File "src/sage/rings/padics/padic_ZZ_pX_FM_element.pyx", line 699, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__
Failed example:
    W(0)^0
Exception raised:
    Traceback (most recent call last):
      File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__[11]>", line 1, in <module>
        W(Integer(0))**Integer(0)
      File "sage/rings/padics/padic_ZZ_pX_FM_element.pyx", line 717, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__ (build/cythonized/sage)
        return self.parent(1)
      File "sage/structure/element.pyx", line 751, in sage.structure.element.Element.parent (build/cythonized/sage/structure/element.c:6987)
        return self._parent(x)
      File "sage/structure/parent.pyx", line 936, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9668)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 102, in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3790)
        raise
      File "sage/structure/coerce_maps.pyx", line 97, in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3678)
        return C._element_constructor(C, x)
      File "sage/rings/padics/padic_ZZ_pX_FM_element.pyx", line 240, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__init__ (build/cythonized/sag)
        poly = x.polynomial().list()
    AttributeError: 'int' object has no attribute 'polynomial'
**********************************************************************
File "src/sage/rings/padics/padic_ZZ_pX_FM_element.pyx", line 701, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__
Failed example:
    W(0)^0 == W(1)
Exception raised:
    Traceback (most recent call last):
      File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__[12]>", line 1, in <module>
        W(Integer(0))**Integer(0) == W(Integer(1))
      File "sage/rings/padics/padic_ZZ_pX_FM_element.pyx", line 717, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__ (build/cythonized/sage)
        return self.parent(1)
      File "sage/structure/element.pyx", line 751, in sage.structure.element.Element.parent (build/cythonized/sage/structure/element.c:6987)
        return self._parent(x)
      File "sage/structure/parent.pyx", line 936, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9668)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 102, in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3790)
        raise
      File "sage/structure/coerce_maps.pyx", line 97, in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3678)
        return C._element_constructor(C, x)
      File "sage/rings/padics/padic_ZZ_pX_FM_element.pyx", line 240, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__init__ (build/cythonized/sag)
        poly = x.polynomial().list()
    AttributeError: 'int' object has no attribute 'polynomial'
**********************************************************************
File "src/sage/rings/padics/padic_ZZ_pX_FM_element.pyx", line 710, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__
Failed example:
    type(W(0)^0) == type(W(0))
Exception raised:
    Traceback (most recent call last):
      File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__[17]>", line 1, in <module>
        type(W(Integer(0))**Integer(0)) == type(W(Integer(0)))
      File "sage/rings/padics/padic_ZZ_pX_FM_element.pyx", line 717, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__pow__ (build/cythonized/sage)
        return self.parent(1)
      File "sage/structure/element.pyx", line 751, in sage.structure.element.Element.parent (build/cythonized/sage/structure/element.c:6987)
        return self._parent(x)
      File "sage/structure/parent.pyx", line 936, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9668)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 102, in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3790)
        raise
      File "sage/structure/coerce_maps.pyx", line 97, in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3678)
        return C._element_constructor(C, x)
      File "sage/rings/padics/padic_ZZ_pX_FM_element.pyx", line 240, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__init__ (build/cythonized/sag)
        poly = x.polynomial().list()
    AttributeError: 'int' object has no attribute 'polynomial'
**********************************************************************
File "src/sage/rings/padics/padic_ZZ_pX_FM_element.pyx", line 815, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement._div_
Failed example:
    1 / W(14) == ~W(14)
Exception raised:
    Traceback (most recent call last):
      File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement._div_[5]>", line 1, in <module>
        Integer(1) / W(Integer(14)) == ~W(Integer(14))
      File "sage/rings/integer.pyx", line 1875, in sage.rings.integer.Integer.__div__ (build/cythonized/sage/rings/integer.c:13023)
        return coercion_model.bin_op(left, right, operator.div)
      File "sage/structure/coerce.pyx", line 1080, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9419)
        action = self.get_action(xp, yp, op, x, y)
      File "sage/structure/coerce.pyx", line 1627, in sage.structure.coerce.CoercionModel_cache_maps.get_action (build/cythonized/sage/structure/coerce.c:16738)
        action = self.discover_action(R, S, op, r, s)
      File "sage/structure/coerce.pyx", line 1841, in sage.structure.coerce.CoercionModel_cache_maps.discover_action (build/cythonized/sage/structure/coerce.c:196)
        K = S._pseudo_fraction_field()
      File "sage/rings/ring.pyx", line 1374, in sage.rings.ring.CommutativeRing._pseudo_fraction_field (build/cythonized/sage/rings/ring.c:13025)
        return coercion_model.division_parent(self)
      File "sage/structure/coerce.pyx", line 959, in sage.structure.coerce.CoercionModel_cache_maps.division_parent (build/cythonized/sage/structure/coerce.c:9162)
        cpdef division_parent(self, Parent P):
      File "sage/structure/coerce.pyx", line 994, in sage.structure.coerce.CoercionModel_cache_maps.division_parent (build/cythonized/sage/structure/coerce.c:9052)
        ret = parent(~P.an_element())
      File "sage/rings/padics/padic_ZZ_pX_FM_element.pyx", line 493, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__invert__ (build/cythonized/s)
        raise ValueError("cannot invert non-unit")
    ValueError: cannot invert non-unit
**********************************************************************
File "src/sage/rings/padics/padic_ZZ_pX_FM_element.pyx", line 875, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.is_zero
Failed example:
    O(w^189).is_zero()
Exception raised:
    Traceback (most recent call last):
      File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.is_zero[4]>", line 1, in <module>
        O(w**Integer(189)).is_zero()
      File "/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/rings/big_oh.py", line 152, in O
        return x.parent()(0, absprec=x.valuation(), **kwds)
      File "sage/structure/parent.pyx", line 938, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9695)
        return mor._call_with_args(x, args, kwds)
      File "sage/structure/coerce_maps.pyx", line 131, in sage.structure.coerce_maps.DefaultConvertMap._call_with_args (build/cythonized/sage/structure/coerce_map)
        raise
      File "sage/structure/coerce_maps.pyx", line 121, in sage.structure.coerce_maps.DefaultConvertMap._call_with_args (build/cythonized/sage/structure/coerce_map)
        return C._element_constructor(C, x, **kwds)
      File "sage/rings/padics/padic_ZZ_pX_FM_element.pyx", line 240, in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__init__ (build/cythonized/sag)
        poly = x.polynomial().list()
    AttributeError: 'int' object has no attribute 'polynomial'
**********************************************************************
```


As it seems, int conversion has to be fixed. Strange. If ZZ works, int should work as well...



---

archive/issue_comments_330904.json:
```json
{
    "body": "Odd.\n\n```\nsage: K = Zp(17)\nsage: K.has_coerce_map_from(ZZ)\nTrue\nsage: K.has_coerce_map_from(int)\nFalse\nsage: ZZ.has_coerce_map_from(int)\nTrue\nsage: K(int(1))\n1 + O(17^20)\nsage: K(1)\n1 + O(17^20)\n```\n\nConversion works and coercion is supposed to be transitive.",
    "created_at": "2017-09-18T16:49:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23647#issuecomment-330904",
    "user": "https://github.com/simon-king-jena"
}
```

Odd.

```
sage: K = Zp(17)
sage: K.has_coerce_map_from(ZZ)
True
sage: K.has_coerce_map_from(int)
False
sage: ZZ.has_coerce_map_from(int)
True
sage: K(int(1))
1 + O(17^20)
sage: K(1)
1 + O(17^20)
```

Conversion works and coercion is supposed to be transitive.



---

archive/issue_comments_330905.json:
```json
{
    "body": "\n```\nsage: R = ZpFM(5,5)\nsage: S.<x> = R[]\nsage: f = x^5 + 75*x^3 - 15*x^2 +125*x - 5\nsage: W.<w> = R.ext(f)\nsage: W(1)\n1 + O(w^25)\nsage: W(int(1))\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-7-a7b09989f4cb> in <module>()\n----> 1 W(int(Integer(1)))\n\n/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9668)()\n    934         if mor is not None:\n    935             if no_extra_args:\n--> 936                 return mor._call_(x)\n    937             else:\n    938                 return mor._call_with_args(x, args, kwds)\n\n/home/king/Sage/git/sage/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3790)()\n    100                 print(type(C), C)\n    101                 print(type(C._element_constructor), C._element_constructor)\n--> 102             raise\n    103 \n    104     cpdef Element _call_with_args(self, x, args=(), kwds={}):\n\n/home/king/Sage/git/sage/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3678)()\n     95         cdef Parent C = self._codomain\n     96         try:\n---> 97             return C._element_constructor(C, x)\n     98         except Exception:\n     99             if print_warnings:\n\n/home/king/Sage/git/sage/src/sage/rings/padics/padic_ZZ_pX_FM_element.pyx in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__init__ (build/cythonized/sage/rings/padics/padic_ZZ_pX_FM_element.cpp:5027)()\n    238             # Should only reach here if x is not in F_p\n    239             z = parent.gen()\n--> 240             poly = x.polynomial().list()\n    241             x = sum([poly[i].lift() * (z ** i) for i in range(len(poly))], parent.zero())\n    242         elif isinstance(x, ntl_ZZ_p):\n\nAttributeError: 'int' object has no attribute 'polynomial'\n```\n",
    "created_at": "2017-09-18T17:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23647#issuecomment-330905",
    "user": "https://github.com/simon-king-jena"
}
```


```
sage: R = ZpFM(5,5)
sage: S.<x> = R[]
sage: f = x^5 + 75*x^3 - 15*x^2 +125*x - 5
sage: W.<w> = R.ext(f)
sage: W(1)
1 + O(w^25)
sage: W(int(1))
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-7-a7b09989f4cb> in <module>()
----> 1 W(int(Integer(1)))

/home/king/Sage/git/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9668)()
    934         if mor is not None:
    935             if no_extra_args:
--> 936                 return mor._call_(x)
    937             else:
    938                 return mor._call_with_args(x, args, kwds)

/home/king/Sage/git/sage/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3790)()
    100                 print(type(C), C)
    101                 print(type(C._element_constructor), C._element_constructor)
--> 102             raise
    103 
    104     cpdef Element _call_with_args(self, x, args=(), kwds={}):

/home/king/Sage/git/sage/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap._call_ (build/cythonized/sage/structure/coerce_maps.c:3678)()
     95         cdef Parent C = self._codomain
     96         try:
---> 97             return C._element_constructor(C, x)
     98         except Exception:
     99             if print_warnings:

/home/king/Sage/git/sage/src/sage/rings/padics/padic_ZZ_pX_FM_element.pyx in sage.rings.padics.padic_ZZ_pX_FM_element.pAdicZZpXFMElement.__init__ (build/cythonized/sage/rings/padics/padic_ZZ_pX_FM_element.cpp:5027)()
    238             # Should only reach here if x is not in F_p
    239             z = parent.gen()
--> 240             poly = x.polynomial().list()
    241             x = sum([poly[i].lift() * (z ** i) for i in range(len(poly))], parent.zero())
    242         elif isinstance(x, ntl_ZZ_p):

AttributeError: 'int' object has no attribute 'polynomial'
```




---

archive/issue_comments_330906.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-09-19T07:59:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23647#issuecomment-330906",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_330907.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-19T08:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23647#issuecomment-330907",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_330908.json:
```json
{
    "body": "Instead of using `.Element`, I would use `.element_class`:\n\n```\nsage: R = ZpCA(11, 5)\nsage: R.Element\n<type 'sage.rings.padics.padic_capped_absolute_element.pAdicCappedAbsoluteElement'>\nsage: R.element_class\n<type 'sage.rings.padics.padic_capped_absolute_element.pAdicCappedAbsoluteElement'>\n```\n\nfor consistency with other parts of Sage and for robustness (in case Element becomes a Python class).",
    "created_at": "2017-09-19T18:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23647#issuecomment-330908",
    "user": "https://github.com/tscrim"
}
```

Instead of using `.Element`, I would use `.element_class`:

```
sage: R = ZpCA(11, 5)
sage: R.Element
<type 'sage.rings.padics.padic_capped_absolute_element.pAdicCappedAbsoluteElement'>
sage: R.element_class
<type 'sage.rings.padics.padic_capped_absolute_element.pAdicCappedAbsoluteElement'>
```

for consistency with other parts of Sage and for robustness (in case Element becomes a Python class).



---

archive/issue_comments_330909.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-09-20T07:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23647#issuecomment-330909",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_330910.json:
```json
{
    "body": "Done.",
    "created_at": "2017-09-20T07:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23647#issuecomment-330910",
    "user": "https://github.com/jdemeyer"
}
```

Done.



---

archive/issue_comments_330911.json:
```json
{
    "body": "Looks fine to me.",
    "created_at": "2017-09-20T16:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23647#issuecomment-330911",
    "user": "https://github.com/roed314"
}
```

Looks fine to me.



---

archive/issue_comments_330912.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-20T16:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23647#issuecomment-330912",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_022152.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2017-09-22T20:26:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23647",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23647#event-22152"
}
```



---

archive/issue_comments_330913.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-22T20:26:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23647#issuecomment-330913",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
