# Issue 15573: Immutable directed graphs should know that they are directed

archive/issues_015573.json:
```json
{
    "body": "CC:  @nathanncohen\n\nKeywords: immutable directed graph\n\nBug:\n\n```\nsage: Q = DiGraph({1:{2:['a','b'], 3:['c']}, 2:{3:['d']}})\nsage: Q.is_directed_acyclic()\nTrue\nsage: I = Q.copy(immutable=True)\nsage: I.is_directed_acyclic()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-19-1dc52c5fb57c> in <module>()\n----> 1 I.is_directed_acyclic()\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/graphs/digraph.pyc in is_directed_acyclic(self, certificate)\n   1117             False\n   1118         \"\"\"\n-> 1119         return self._backend.is_directed_acyclic(certificate = certificate)\n   1120 \n   1121     def to_directed(self):\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/graphs/base/c_graph.so in sage.graphs.base.c_graph.CGraphBackend.is_directed_acyclic (sage/graphs/base/c_graph.c:19314)()\n\nValueError: Input must be a directed graph.\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/15810\n\n",
    "created_at": "2014-02-11T14:13:07Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Immutable directed graphs should know that they are directed",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15573",
    "user": "https://github.com/simon-king-jena"
}
```
CC:  @nathanncohen

Keywords: immutable directed graph

Bug:

```
sage: Q = DiGraph({1:{2:['a','b'], 3:['c']}, 2:{3:['d']}})
sage: Q.is_directed_acyclic()
True
sage: I = Q.copy(immutable=True)
sage: I.is_directed_acyclic()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-19-1dc52c5fb57c> in <module>()
----> 1 I.is_directed_acyclic()

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/graphs/digraph.pyc in is_directed_acyclic(self, certificate)
   1117             False
   1118         """
-> 1119         return self._backend.is_directed_acyclic(certificate = certificate)
   1120 
   1121     def to_directed(self):

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/graphs/base/c_graph.so in sage.graphs.base.c_graph.CGraphBackend.is_directed_acyclic (sage/graphs/base/c_graph.c:19314)()

ValueError: Input must be a directed graph.
```

Issue created by migration from https://trac.sagemath.org/ticket/15810





---

archive/issue_comments_201017.json:
```json
{
    "body": "Variation of the theme:\n\n```\nsage: Q = DiGraph({1:{2:['a','b'], 3:['c']}, 2:{3:['d']}}, immutable=True)\nsage: Q.is_directed_acyclic()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-3-a8ff599a3235> in <module>()\n----> 1 Q.is_directed_acyclic()\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/graphs/digraph.pyc in is_directed_acyclic(self, certificate)\n   1108             False\n   1109         \"\"\"\n-> 1110         return self._backend.is_directed_acyclic(certificate = certificate)\n   1111 \n   1112     def to_directed(self):\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/graphs/base/c_graph.so in sage.graphs.base.c_graph.CGraphBackend.is_directed_acyclic (sage/graphs/base/c_graph.c:19328)()\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/graphs/base/c_graph.so in sage.graphs.base.c_graph.bitset_init (sage/graphs/base/c_graph.c:3113)()\n\nValueError: bitset capacity must be greater than 0\n```",
    "created_at": "2014-02-11T14:18:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201017",
    "user": "https://github.com/simon-king-jena"
}
```

Variation of the theme:

```
sage: Q = DiGraph({1:{2:['a','b'], 3:['c']}, 2:{3:['d']}}, immutable=True)
sage: Q.is_directed_acyclic()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-3-a8ff599a3235> in <module>()
----> 1 Q.is_directed_acyclic()

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/graphs/digraph.pyc in is_directed_acyclic(self, certificate)
   1108             False
   1109         """
-> 1110         return self._backend.is_directed_acyclic(certificate = certificate)
   1111 
   1112     def to_directed(self):

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/graphs/base/c_graph.so in sage.graphs.base.c_graph.CGraphBackend.is_directed_acyclic (sage/graphs/base/c_graph.c:19328)()

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/graphs/base/c_graph.so in sage.graphs.base.c_graph.bitset_init (sage/graphs/base/c_graph.c:3113)()

ValueError: bitset capacity must be greater than 0
```



---

archive/issue_comments_201018.json:
```json
{
    "body": "PS: In that case, `Q.show()` barks, too.",
    "created_at": "2014-02-11T14:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201018",
    "user": "https://github.com/simon-king-jena"
}
```

PS: In that case, `Q.show()` barks, too.



---

archive/issue_comments_201019.json:
```json
{
    "body": "That's because in `static_sparse_backend` the binary variable for directed is `self.directed` instead of `self._directed`............\n\nNathann",
    "created_at": "2014-02-11T14:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201019",
    "user": "https://github.com/nathanncohen"
}
```

That's because in `static_sparse_backend` the binary variable for directed is `self.directed` instead of `self._directed`............

Nathann



---

archive/issue_comments_201020.json:
```json
{
    "body": "Replying to [comment:3 ncohen]:\n> That's because in `static_sparse_backend` the binary variable for directed is `self.directed` instead of `self._directed`............\n\n\nSo, easy to fix, then? What are the dependencies of this ticket? Actually, the error with the master branch is as in comment:1, whereas I get the error shown in the ticket description with a different branch (develop?).",
    "created_at": "2014-02-11T14:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201020",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:3 ncohen]:
> That's because in `static_sparse_backend` the binary variable for directed is `self.directed` instead of `self._directed`............


So, easy to fix, then? What are the dependencies of this ticket? Actually, the error with the master branch is as in comment:1, whereas I get the error shown in the ticket description with a different branch (develop?).



---

archive/issue_comments_201021.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-02-11T14:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201021",
    "user": "https://github.com/simon-king-jena"
}
```

New commits:



---

archive/issue_comments_201022.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-02-11T14:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201022",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_201023.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-02-11T14:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201023",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_201024.json:
```json
{
    "body": "There is more than this one type \"_directed  --> directed\" to fix.",
    "created_at": "2014-02-11T14:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201024",
    "user": "https://github.com/simon-king-jena"
}
```

There is more than this one type "_directed  --> directed" to fix.



---

archive/issue_comments_201025.json:
```json
{
    "body": "Arg... I was uploading mine `:-/`\n\nNathann",
    "created_at": "2014-02-11T14:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201025",
    "user": "https://github.com/nathanncohen"
}
```

Arg... I was uploading mine `:-/`

Nathann



---

archive/issue_comments_201026.json:
```json
{
    "body": "NOnonono it's not this one that should be changed. Give me a second.\n\nNathann",
    "created_at": "2014-02-11T14:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201026",
    "user": "https://github.com/nathanncohen"
}
```

NOnonono it's not this one that should be changed. Give me a second.

Nathann



---

archive/issue_comments_201027.json:
```json
{
    "body": "WTF?????\n\nWhen I generally replace _directed by directed for static graph backend, I get numerous errors!!",
    "created_at": "2014-02-11T14:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201027",
    "user": "https://github.com/simon-king-jena"
}
```

WTF?????

When I generally replace _directed by directed for static graph backend, I get numerous errors!!



---

archive/issue_comments_201028.json:
```json
{
    "body": "Replying to [comment:10 ncohen]:\n> NOnonono it's not this one that should be changed. Give me a second.\n> \n> Nathann\n\n\nWhy not? It fixes it.",
    "created_at": "2014-02-11T14:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201028",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:10 ncohen]:
> NOnonono it's not this one that should be changed. Give me a second.
> 
> Nathann


Why not? It fixes it.



---

archive/issue_comments_201029.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-02-11T14:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201029",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_201030.json:
```json
{
    "body": "With my branch, all tests in sage.graphs pass. So, what's the problem?",
    "created_at": "2014-02-11T14:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201030",
    "user": "https://github.com/simon-king-jena"
}
```

With my branch, all tests in sage.graphs pass. So, what's the problem?



---

archive/issue_comments_201031.json:
```json
{
    "body": "> When I generally replace _directed by directed for static graph backend, I get numerous errors!!\n\n\nThe file `static_graph_backend` also contains a CGraph class, which uses `.directed` and not `_directed`. It's just a terrible choice. It has to be `._directed` for GraphBackend and `.directed` for CGraph. And if you change the value used in `is_directed_acyclic` that's going to fail when the backend is a `SparseGraph`. `:-/`\n\nNathann",
    "created_at": "2014-02-11T14:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201031",
    "user": "https://github.com/nathanncohen"
}
```

> When I generally replace _directed by directed for static graph backend, I get numerous errors!!


The file `static_graph_backend` also contains a CGraph class, which uses `.directed` and not `_directed`. It's just a terrible choice. It has to be `._directed` for GraphBackend and `.directed` for CGraph. And if you change the value used in `is_directed_acyclic` that's going to fail when the backend is a `SparseGraph`. `:-/`

Nathann



---

archive/issue_comments_201032.json:
```json
{
    "body": "> With my branch, all tests in sage.graphs pass. So, what's the problem?\n\n\n`O_o`\n\nNo problem with SparseGraph backends ? Then I don't get it either.\n\nNathann",
    "created_at": "2014-02-11T14:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201032",
    "user": "https://github.com/nathanncohen"
}
```

> With my branch, all tests in sage.graphs pass. So, what's the problem?


`O_o`

No problem with SparseGraph backends ? Then I don't get it either.

Nathann



---

archive/issue_comments_201033.json:
```json
{
    "body": "Replying to [comment:15 ncohen]:\n> No problem with SparseGraph backends ? Then I don't get it either.\n\n\nApparently:\n\n```\nsage: D = DiGraph({1:{2:['a','b'], 3:['c']}, 2:{3:['d']}})\nsage: D.is_directed_acyclic()\nTrue\nsage: I = D.copy(immutable=True)\nsage: I.is_directed_acyclic()\nTrue\nsage: D._backend\n<class 'sage.graphs.base.sparse_graph.SparseGraphBackend'>\nsage: I._backend\n<class 'sage.graphs.base.static_sparse_backend.StaticSparseBackend'>\n```",
    "created_at": "2014-02-11T14:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201033",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:15 ncohen]:
> No problem with SparseGraph backends ? Then I don't get it either.


Apparently:

```
sage: D = DiGraph({1:{2:['a','b'], 3:['c']}, 2:{3:['d']}})
sage: D.is_directed_acyclic()
True
sage: I = D.copy(immutable=True)
sage: I.is_directed_acyclic()
True
sage: D._backend
<class 'sage.graphs.base.sparse_graph.SparseGraphBackend'>
sage: I._backend
<class 'sage.graphs.base.static_sparse_backend.StaticSparseBackend'>
```



---

archive/issue_comments_201034.json:
```json
{
    "body": "Replying to [comment:15 ncohen]:\n> No problem with SparseGraph backends ? Then I don't get it either.\n\n\nDid you not fix something of this kind in #15623 (which is a dependency)?",
    "created_at": "2014-02-11T14:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201034",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:15 ncohen]:
> No problem with SparseGraph backends ? Then I don't get it either.


Did you not fix something of this kind in #15623 (which is a dependency)?



---

archive/issue_comments_201035.json:
```json
{
    "body": "> Did you not fix something of this kind in #15623 (which is a dependency)?\n\n\nNo idea `O_o`\n\nIt's merged anyway, so what's the point ?\n\nI'm trying to find out why your branch works while I thought it wouldn't.\n\nNathann",
    "created_at": "2014-02-11T14:46:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201035",
    "user": "https://github.com/nathanncohen"
}
```

> Did you not fix something of this kind in #15623 (which is a dependency)?


No idea `O_o`

It's merged anyway, so what's the point ?

I'm trying to find out why your branch works while I thought it wouldn't.

Nathann



---

archive/issue_comments_201036.json:
```json
{
    "body": "```\nsage: d = DiGraph()       \nsage: d._backend.directed \nTrue\nsage: d._backend._directed\nTrue\n```\n\nI hate this code.\n\nNathann",
    "created_at": "2014-02-11T14:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201036",
    "user": "https://github.com/nathanncohen"
}
```

```
sage: d = DiGraph()       
sage: d._backend.directed 
True
sage: d._backend._directed
True
```

I hate this code.

Nathann



---

archive/issue_comments_201037.json:
```json
{
    "body": "Replying to [comment:18 ncohen]:\n> It's merged anyway, so what's the point ?\n\n\nI think it is in \"develop\", but not in \"master\", which is the default branching point when you create a ticket.",
    "created_at": "2014-02-11T14:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201037",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:18 ncohen]:
> It's merged anyway, so what's the point ?


I think it is in "develop", but not in "master", which is the default branching point when you create a ticket.



---

archive/issue_comments_201038.json:
```json
{
    "body": "Replying to [comment:19 ncohen]:\n> {{{\n> sage: d = DiGraph()       \n> sage: d._backend.directed \n> True\n> sage: d._backend._directed\n> True\n> }}}\n> \n> I hate this code.\n\n\nUnderstandably.\n> Nathann",
    "created_at": "2014-02-11T14:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201038",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:19 ncohen]:
> {{{
> sage: d = DiGraph()       
> sage: d._backend.directed 
> True
> sage: d._backend._directed
> True
> }}}
> 
> I hate this code.


Understandably.
> Nathann



---

archive/issue_comments_201039.json:
```json
{
    "body": "OK, but this seems to indicate that `_backend.directed` and `_backend._directed` are both used and are out of sync. That's bad. Perhaps this can be cleaned up in this ticket.",
    "created_at": "2014-02-11T14:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201039",
    "user": "https://github.com/simon-king-jena"
}
```

OK, but this seems to indicate that `_backend.directed` and `_backend._directed` are both used and are out of sync. That's bad. Perhaps this can be cleaned up in this ticket.



---

archive/issue_comments_201040.json:
```json
{
    "body": "> I think it is in \"develop\", but not in \"master\", which is the default branching point when you create a ticket.\n\n\nSimon, I don't want to antagonize anybody and I'm sorry enough that you have to deal with stupid errors like that in the graph code (even though these things are not my doing either), but I really believe that the develop/ branch exists for developpers to work with.\n\nNathann",
    "created_at": "2014-02-11T14:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201040",
    "user": "https://github.com/nathanncohen"
}
```

> I think it is in "develop", but not in "master", which is the default branching point when you create a ticket.


Simon, I don't want to antagonize anybody and I'm sorry enough that you have to deal with stupid errors like that in the graph code (even though these things are not my doing either), but I really believe that the develop/ branch exists for developpers to work with.

Nathann



---

archive/issue_comments_201041.json:
```json
{
    "body": "> OK, but this seems to indicate that `_backend.directed` and `_backend._directed` are both used and are out of sync. That's bad. Perhaps this can be cleaned up in this ticket.\n\n\nYeah, the `.directed` variable is set explicitly in the `DiGraph` constructor. I will update my branch in a second and add a message here when it is done.\n\nNathann",
    "created_at": "2014-02-11T14:52:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201041",
    "user": "https://github.com/nathanncohen"
}
```

> OK, but this seems to indicate that `_backend.directed` and `_backend._directed` are both used and are out of sync. That's bad. Perhaps this can be cleaned up in this ticket.


Yeah, the `.directed` variable is set explicitly in the `DiGraph` constructor. I will update my branch in a second and add a message here when it is done.

Nathann



---

archive/issue_comments_201042.json:
```json
{
    "body": "Replying to [comment:24 ncohen]:\n> Yeah, the `.directed` variable is set explicitly in the `DiGraph` constructor. I will update my branch in a second and add a message here when it is done.\n\n\nOK. Will your branch include #15623 (i.e., more than master)?",
    "created_at": "2014-02-11T14:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201042",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:24 ncohen]:
> Yeah, the `.directed` variable is set explicitly in the `DiGraph` constructor. I will update my branch in a second and add a message here when it is done.


OK. Will your branch include #15623 (i.e., more than master)?



---

archive/issue_comments_201043.json:
```json
{
    "body": "> OK. Will your branch include #15623 (i.e., more than master)?\n\n\nWell.... It will be based on develop, and include nothing else.\n\nNathann",
    "created_at": "2014-02-11T14:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201043",
    "user": "https://github.com/nathanncohen"
}
```

> OK. Will your branch include #15623 (i.e., more than master)?


Well.... It will be based on develop, and include nothing else.

Nathann



---

archive/issue_comments_201044.json:
```json
{
    "body": "By the way if you use the dev scripts and if they use the master branch as a default then that's probably a bug that should be fixed. Could you write to sage-git if that's the case ?\n\nNathann",
    "created_at": "2014-02-11T15:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201044",
    "user": "https://github.com/nathanncohen"
}
```

By the way if you use the dev scripts and if they use the master branch as a default then that's probably a bug that should be fixed. Could you write to sage-git if that's the case ?

Nathann



---

archive/issue_comments_201045.json:
```json
{
    "body": "What do you think of the current public/15810 ? It removes the ugly definition of `.directed` in the constructor of `DiGraph`. Another part of the code used this `.directed` once, and I converted it too. Now, Backends only have a `._directed` flag, as indicated by the very first lines of GenericGraphBackend\n\nNathann",
    "created_at": "2014-02-11T15:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201045",
    "user": "https://github.com/nathanncohen"
}
```

What do you think of the current public/15810 ? It removes the ugly definition of `.directed` in the constructor of `DiGraph`. Another part of the code used this `.directed` once, and I converted it too. Now, Backends only have a `._directed` flag, as indicated by the very first lines of GenericGraphBackend

Nathann



---

archive/issue_comments_201046.json:
```json
{
    "body": "Replying to [comment:28 ncohen]:\n> What do you think of the current public/15810\n\n\nCan you remind me how to obtain that branch and how to set the default location for pushing a commit?",
    "created_at": "2014-02-11T15:29:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201046",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:28 ncohen]:
> What do you think of the current public/15810


Can you remind me how to obtain that branch and how to set the default location for pushing a commit?



---

archive/issue_comments_201047.json:
```json
{
    "body": "> Can you remind me how to obtain that branch and how to set the default location for pushing a commit?\n\n\ngit fetch trac `public/15810:local_branch` will fetch this branch and call it `local_branch` on your computer.\n\nI do not know if it is what you ask with your second question, but `git push trac local_branch:remote_branch` will upload `local_branch` on Trac where it will be called `remote_branch`. `remote_branch` can be something like `public/168543843` or `u/your_trac_login/7687687`.\n\nNathann",
    "created_at": "2014-02-11T15:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201047",
    "user": "https://github.com/nathanncohen"
}
```

> Can you remind me how to obtain that branch and how to set the default location for pushing a commit?


git fetch trac `public/15810:local_branch` will fetch this branch and call it `local_branch` on your computer.

I do not know if it is what you ask with your second question, but `git push trac local_branch:remote_branch` will upload `local_branch` on Trac where it will be called `remote_branch`. `remote_branch` can be something like `public/168543843` or `u/your_trac_login/7687687`.

Nathann



---

archive/issue_comments_201048.json:
```json
{
    "body": "Thank you!\n\nSimon",
    "created_at": "2014-02-11T15:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201048",
    "user": "https://github.com/simon-king-jena"
}
```

Thank you!

Simon



---

archive/issue_comments_201049.json:
```json
{
    "body": "Is the purpose of this ticket to remove the confusion between `_directed` and `directed`? Then it needs work, as both is still in the code.",
    "created_at": "2014-02-11T15:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201049",
    "user": "https://github.com/simon-king-jena"
}
```

Is the purpose of this ticket to remove the confusion between `_directed` and `directed`? Then it needs work, as both is still in the code.



---

archive/issue_comments_201050.json:
```json
{
    "body": "> Is the purpose of this ticket to remove the confusion between `_directed` and `directed`? Then it needs work, as both is still in the code.\n\n\nWhere ? \n\n- There is a `Graph._directed` which cannot be renamed to .directed, for that's an internal variable\n- With this ticket there is a `CGraphBackend._directed`, and only that.\n- There is a `CGraph.directed`, as before.\n\nHow simple can it get ? We only store this boolean 3 times, and probably have as many functions that only return its value `>_<`\n\nNathann",
    "created_at": "2014-02-11T15:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201050",
    "user": "https://github.com/nathanncohen"
}
```

> Is the purpose of this ticket to remove the confusion between `_directed` and `directed`? Then it needs work, as both is still in the code.


Where ? 

- There is a `Graph._directed` which cannot be renamed to .directed, for that's an internal variable
- With this ticket there is a `CGraphBackend._directed`, and only that.
- There is a `CGraph.directed`, as before.

How simple can it get ? We only store this boolean 3 times, and probably have as many functions that only return its value `>_<`

Nathann



---

archive/issue_comments_201051.json:
```json
{
    "body": "```\nking@linux-etl7:~/Sage/git/sage> grep \"\\._directed\" -R src/sage/graphs/ | grep pyx:\nsrc/sage/graphs/base/static_sparse_backend.pyx:        self._directed = cg.directed\nsrc/sage/graphs/base/static_sparse_backend.pyx:        if self._directed:\nsrc/sage/graphs/base/static_sparse_backend.pyx:        if self._directed:\nsrc/sage/graphs/base/sparse_graph.pyx:        self._directed = directed\nsrc/sage/graphs/base/sparse_graph.pyx:                      self._cg, self._cg_rev, self._directed)\nsrc/sage/graphs/base/sparse_graph.pyx:                      self._cg, self._cg_rev, self._directed)\nsrc/sage/graphs/base/sparse_graph.pyx:                      self._cg, self._cg_rev, self._directed)\nsrc/sage/graphs/base/sparse_graph.pyx:                      self._cg, self._cg_rev, self._directed)\nsrc/sage/graphs/base/dense_graph.pyx:        self._directed = directed\nsrc/sage/graphs/base/c_graph.pyx:        if self._directed:\nsrc/sage/graphs/base/c_graph.pyx:                     (self._directed and\nsrc/sage/graphs/base/c_graph.pyx:        if not self._directed:\nsrc/sage/graphs/base/c_graph.pyx:        if not self._directed:\nsrc/sage/graphs/base/c_graph.pyx:        if not self.graph._directed:\nsrc/sage/graphs/graph_decompositions/vertex_separation.pyx:        if G._directed:\n```\nversus\n\n```\nking@linux-etl7:~/Sage/git/sage> grep \"\\.directed\" -R src/sage/graphs/ | grep pyx:\nsrc/sage/graphs/base/static_sparse_backend.pyx:        self.directed = G.is_directed()\nsrc/sage/graphs/base/static_sparse_backend.pyx:        if self.directed:\nsrc/sage/graphs/base/static_sparse_backend.pyx:        if not self.directed:\nsrc/sage/graphs/base/static_sparse_backend.pyx:        if not self.directed:\nsrc/sage/graphs/base/static_sparse_backend.pyx:        if not self.directed:\nsrc/sage/graphs/base/static_sparse_backend.pyx:        self._directed = cg.directed\nsrc/sage/graphs/base/static_sparse_backend.pyx:        if not cg.directed:\nsrc/sage/graphs/base/static_sparse_backend.pyx:            if cg.directed:\nsrc/sage/graphs/base/static_sparse_backend.pyx:            if cg.directed:\nsrc/sage/graphs/base/static_sparse_backend.pyx:            if cg.directed:\nsrc/sage/graphs/base/static_sparse_backend.pyx:            if cg.directed:\nsrc/sage/graphs/base/static_sparse_backend.pyx:        if cg.directed:\nsrc/sage/graphs/base/static_sparse_backend.pyx:        if cg.directed:\nsrc/sage/graphs/generic_graph_pyx.pyx:        self.directed = G.is_directed()\nsrc/sage/graphs/generic_graph_pyx.pyx:        if self.directed:\nsrc/sage/graphs/generic_graph_pyx.pyx:                    if is_admissible and self.directed:\nsrc/sage/graphs/generic_graph_pyx.pyx:        if self.directed:\n```",
    "created_at": "2014-02-11T15:43:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201051",
    "user": "https://github.com/simon-king-jena"
}
```

```
king@linux-etl7:~/Sage/git/sage> grep "\._directed" -R src/sage/graphs/ | grep pyx:
src/sage/graphs/base/static_sparse_backend.pyx:        self._directed = cg.directed
src/sage/graphs/base/static_sparse_backend.pyx:        if self._directed:
src/sage/graphs/base/static_sparse_backend.pyx:        if self._directed:
src/sage/graphs/base/sparse_graph.pyx:        self._directed = directed
src/sage/graphs/base/sparse_graph.pyx:                      self._cg, self._cg_rev, self._directed)
src/sage/graphs/base/sparse_graph.pyx:                      self._cg, self._cg_rev, self._directed)
src/sage/graphs/base/sparse_graph.pyx:                      self._cg, self._cg_rev, self._directed)
src/sage/graphs/base/sparse_graph.pyx:                      self._cg, self._cg_rev, self._directed)
src/sage/graphs/base/dense_graph.pyx:        self._directed = directed
src/sage/graphs/base/c_graph.pyx:        if self._directed:
src/sage/graphs/base/c_graph.pyx:                     (self._directed and
src/sage/graphs/base/c_graph.pyx:        if not self._directed:
src/sage/graphs/base/c_graph.pyx:        if not self._directed:
src/sage/graphs/base/c_graph.pyx:        if not self.graph._directed:
src/sage/graphs/graph_decompositions/vertex_separation.pyx:        if G._directed:
```
versus

```
king@linux-etl7:~/Sage/git/sage> grep "\.directed" -R src/sage/graphs/ | grep pyx:
src/sage/graphs/base/static_sparse_backend.pyx:        self.directed = G.is_directed()
src/sage/graphs/base/static_sparse_backend.pyx:        if self.directed:
src/sage/graphs/base/static_sparse_backend.pyx:        if not self.directed:
src/sage/graphs/base/static_sparse_backend.pyx:        if not self.directed:
src/sage/graphs/base/static_sparse_backend.pyx:        if not self.directed:
src/sage/graphs/base/static_sparse_backend.pyx:        self._directed = cg.directed
src/sage/graphs/base/static_sparse_backend.pyx:        if not cg.directed:
src/sage/graphs/base/static_sparse_backend.pyx:            if cg.directed:
src/sage/graphs/base/static_sparse_backend.pyx:            if cg.directed:
src/sage/graphs/base/static_sparse_backend.pyx:            if cg.directed:
src/sage/graphs/base/static_sparse_backend.pyx:            if cg.directed:
src/sage/graphs/base/static_sparse_backend.pyx:        if cg.directed:
src/sage/graphs/base/static_sparse_backend.pyx:        if cg.directed:
src/sage/graphs/generic_graph_pyx.pyx:        self.directed = G.is_directed()
src/sage/graphs/generic_graph_pyx.pyx:        if self.directed:
src/sage/graphs/generic_graph_pyx.pyx:                    if is_admissible and self.directed:
src/sage/graphs/generic_graph_pyx.pyx:        if self.directed:
```



---

archive/issue_comments_201052.json:
```json
{
    "body": "PS: There are numerous hits for both directed and _directed in .py files, too.",
    "created_at": "2014-02-11T15:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201052",
    "user": "https://github.com/simon-king-jena"
}
```

PS: There are numerous hits for both directed and _directed in .py files, too.



---

archive/issue_comments_201053.json:
```json
{
    "body": "Oh. Looks like the CGraph do not insist on having a `_directed` or a `directed`. So I can change the instances of `static_sparse_backend` if you like. I don't think that those of SubgraphSearch matter to you, do they ? Those are the ones you find in `generic_graph_pyx.pyx`.",
    "created_at": "2014-02-11T15:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201053",
    "user": "https://github.com/nathanncohen"
}
```

Oh. Looks like the CGraph do not insist on having a `_directed` or a `directed`. So I can change the instances of `static_sparse_backend` if you like. I don't think that those of SubgraphSearch matter to you, do they ? Those are the ones you find in `generic_graph_pyx.pyx`.



---

archive/issue_comments_201054.json:
```json
{
    "body": "I updated the branch with a new commit. I set it as this ticket's branch so that you can see it more easily. The only `.directed` that remain are those of SubgraphSearch in `generic_graph_pyx.pyx`.\n\nNathann\n\n---\nNew commits:",
    "created_at": "2014-02-11T15:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201054",
    "user": "https://github.com/nathanncohen"
}
```

I updated the branch with a new commit. I set it as this ticket's branch so that you can see it more easily. The only `.directed` that remain are those of SubgraphSearch in `generic_graph_pyx.pyx`.

Nathann

---
New commits:



---

archive/issue_comments_201055.json:
```json
{
    "body": "Could you elaborate why you *remove* one line in the following chunks, rather than replace `.directed` by `._directed`?\n\n```diff\ndiff --git a/src/sage/graphs/digraph.py b/src/sage/graphs/digraph.py\nindex f869bb0..d95e96e 100644\n--- a/src/sage/graphs/digraph.py\n+++ b/src/sage/graphs/digraph.py\n@@ -919,7 +919,6 @@ class DiGraph(GenericGraph):\n                 self._weighted = weighted\n                 self.allow_loops(loops, check=False)\n                 self.allow_multiple_edges(multiedges, check=False)\n-            self._backend.directed = True\n         else:\n             raise NotImplementedError(\"Supported implementations: networkx, c_graph.\")\n \ndiff --git a/src/sage/graphs/graph.py b/src/sage/graphs/graph.py\nindex a3f1dcd..4d15305 100644\n--- a/src/sage/graphs/graph.py\n+++ b/src/sage/graphs/graph.py\n@@ -1542,7 +1542,6 @@ class Graph(GenericGraph):\n                 self._weighted = weighted\n                 self.allow_loops(loops, check=False)\n                 self.allow_multiple_edges(multiedges, check=False)\n-            self._backend.directed = False\n         else:\n             raise NotImplementedError(\"Supported implementations: networkx, c_graph.\")\n```",
    "created_at": "2014-02-11T16:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201055",
    "user": "https://github.com/simon-king-jena"
}
```

Could you elaborate why you *remove* one line in the following chunks, rather than replace `.directed` by `._directed`?

```diff
diff --git a/src/sage/graphs/digraph.py b/src/sage/graphs/digraph.py
index f869bb0..d95e96e 100644
--- a/src/sage/graphs/digraph.py
+++ b/src/sage/graphs/digraph.py
@@ -919,7 +919,6 @@ class DiGraph(GenericGraph):
                 self._weighted = weighted
                 self.allow_loops(loops, check=False)
                 self.allow_multiple_edges(multiedges, check=False)
-            self._backend.directed = True
         else:
             raise NotImplementedError("Supported implementations: networkx, c_graph.")
 
diff --git a/src/sage/graphs/graph.py b/src/sage/graphs/graph.py
index a3f1dcd..4d15305 100644
--- a/src/sage/graphs/graph.py
+++ b/src/sage/graphs/graph.py
@@ -1542,7 +1542,6 @@ class Graph(GenericGraph):
                 self._weighted = weighted
                 self.allow_loops(loops, check=False)
                 self.allow_multiple_edges(multiedges, check=False)
-            self._backend.directed = False
         else:
             raise NotImplementedError("Supported implementations: networkx, c_graph.")
```



---

archive/issue_comments_201056.json:
```json
{
    "body": "Because several lines above those two lines, `self._backend` is created using the backend's constructor, which takes the value `True/False` as an input. \n\nAnd well, setting the value of a private variable of the backend is the backend's constructor's job. So this way, the constructors of !Graph and DiGraph do not mess with what they should not touch, the value of `_directed` is set only in the backend's constructor's code, and there is no fancy alias in the backend that is set where there should not be.\n\nNathann",
    "created_at": "2014-02-11T16:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201056",
    "user": "https://github.com/nathanncohen"
}
```

Because several lines above those two lines, `self._backend` is created using the backend's constructor, which takes the value `True/False` as an input. 

And well, setting the value of a private variable of the backend is the backend's constructor's job. So this way, the constructors of !Graph and DiGraph do not mess with what they should not touch, the value of `_directed` is set only in the backend's constructor's code, and there is no fancy alias in the backend that is set where there should not be.

Nathann



---

archive/issue_comments_201057.json:
```json
{
    "body": "Replying to [comment:39 ncohen]:\n> And well, setting the value of a private variable of the backend is the backend's constructor's job. So this way, the constructors of !Graph and DiGraph do not mess with what they should not touch, the value of `_directed` is set only in the backend's constructor's code, and there is no fancy alias in the backend that is set where there should not be.\n\n\nOK. Then, provided tests pass, it will be positive review.",
    "created_at": "2014-02-11T16:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201057",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [comment:39 ncohen]:
> And well, setting the value of a private variable of the backend is the backend's constructor's job. So this way, the constructors of !Graph and DiGraph do not mess with what they should not touch, the value of `_directed` is set only in the backend's constructor's code, and there is no fancy alias in the backend that is set where there should not be.


OK. Then, provided tests pass, it will be positive review.



---

archive/issue_comments_201058.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-02-11T20:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201058",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_201059.json:
```json
{
    "body": "Thank you, Nathann!\n\nSimon",
    "created_at": "2014-02-11T20:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201059",
    "user": "https://github.com/simon-king-jena"
}
```

Thank you, Nathann!

Simon



---

archive/issue_comments_201060.json:
```json
{
    "body": "Thanks for the review `:-)`\n\nNathann",
    "created_at": "2014-02-11T20:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201060",
    "user": "https://github.com/nathanncohen"
}
```

Thanks for the review `:-)`

Nathann



---

archive/issue_comments_201061.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-14T19:44:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15573#issuecomment-201061",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_046499.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-14T19:44:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15573",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15573#event-46499"
}
```
