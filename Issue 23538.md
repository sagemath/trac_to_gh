# Issue 23538: UCF sometimes ignores constants

Issue created by migration from https://trac.sagemath.org/ticket/23775

Original creator: vdelecroix

Original creation time: 2017-09-01 23:08:01

CC:  jipilab


```
sage: UCF = UniversalCyclotomicField()
sage: RR(UCF(E(8) - E(8,3)))
1.41421356237309
sage: RR(1 + UCF(E(8) - E(8,3)))
1.41421356237309
sage: CIF(UCF(E(8) - E(8,3)))
1.41421356237310?
sage: CIF(1 + UCF(E(8) - E(8,3)))
1.41421356237310?
```

Indeed `_eval_real_` and `_eval_complex_` are wrong


---

Comment by vdelecroix created at 2017-09-01 23:23:16

BTW, `CC` is not calling `_eval_complex_` as it should

```
sage: a = 1 + E(8) - E(8,3)
sage: a._eval_complex_(CC)
2.41421356237309
sage: CC(a)
2.41421356237309 - 2.71050543121376e-20*I
```



---

Comment by vdelecroix created at 2017-09-01 23:25:47

This is due to the coercion... that would better be bypassed in this case

```
sage: CC.coerce_map_from(UCF)
Composite map:
  From: Universal Cyclotomic Field
  To:   Complex Field with 53 bits of precision
  Defn:   Generic morphism:
          From: Universal Cyclotomic Field
          To:   Algebraic Field
        then
          Generic morphism:
          From: Algebraic Field
          To:   Complex Lazy Field
        then
          Coercion map:
          From: Complex Lazy Field
          To:   Complex Field with 53 bits of precision
```



---

Comment by vdelecroix created at 2017-09-01 23:29:17

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2017-09-01 23:29:17

New commits:


---

Comment by vdelecroix created at 2017-09-01 23:29:31

oups... some left over commits


---

Comment by git created at 2017-09-01 23:31:11

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2017-09-02 06:05:52

wrong syntax for the trac links, should be `(:trac:`23775`)`


---

Comment by git created at 2017-09-02 15:38:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2017-09-02 15:39:49

Replying to [comment:6 chapoton]:
> wrong syntax for the trac links, should be `(:trac:`23775`)`

fixed


---

Comment by roed created at 2017-09-02 19:18:07

Looks good to me.


---

Comment by roed created at 2017-09-02 19:18:07

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-09-07 16:34:54

On OSX:

```
**********************************************************************
File "src/sage/rings/universal_cyclotomic_field.py", line 642, in sage.rings.universal_cyclotomic_field.UniversalCyclotomicFieldElement._eval_complex_
Failed example:
    (1 + E(8) - E(8,3))._eval_complex_(CDF)
Expected:
    2.414213562373095
Got:
    2.4142135623730945
**********************************************************************
1 item had failures:
   1 of  10 in sage.rings.universal_cyclotomic_field.UniversalCyclotomicFieldElement._eval_complex_
    [263 tests, 1 failure, 9.72 s]
```



---

Comment by vbraun created at 2017-09-07 16:34:54

Changing status from positive_review to needs_work.


---

Comment by chapoton created at 2017-09-22 14:35:08

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2017-09-22 14:35:08

New commits:


---

Comment by chapoton created at 2017-09-22 18:55:32

ok, setting back to positive


---

Comment by chapoton created at 2017-09-22 18:55:32

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-09-24 13:04:21

Resolution: fixed
