# Issue 10400: Problem with old submodule

Issue created by migration from https://trac.sagemath.org/ticket/10453

Original creator: davidloeffler

Original creation time: 2010-12-09 17:03:17

Assignee: craigcitro

If you ask for the old submodule of a Gamma1 modular forms space, and that old subspace is actually zero, then Sage crashes:


```
sage: CuspForms(Gamma1(11), 2).old_submodule()
ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (28, 0))

---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/home/masiao/<ipython console> in <module>()

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/hecke/submodule.pyc in old_submodule(self, p)
    850             pass
    851 
--> 852         S = self.ambient_hecke_module().old_submodule(p)
    853         os = S.intersection(self)
    854         if os.rank() == self.rank():

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/hecke/ambient_module.pyc in old_submodule(self, p)
    857             #end if
    858         #end for
--> 859         os = self.submodule(d.image(), check=False)
    860         self.__is_old[p] = (os == self)
    861 

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/hecke/ambient_module.pyc in submodule(self, M, Mdual, check)
    887             if M == self.free_module():
    888                 return self
--> 889         return self._submodule_class()(self, M, Mdual, check=check)
    890 
    891     def _submodule_class(self):

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/modform/submodule.pyc in __init__(self, ambient_module, submodule, dual, check)
     46         """
     47         A = ambient_module
---> 48         sage.modular.hecke.submodule.HeckeSubmodule.__init__(self, A, submodule, check=check)
     49         space.ModularFormsSpace.__init__(self, A.group(), A.weight(),
     50                                          A.character(), A.base_ring())

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/hecke/submodule.pyc in __init__(self, ambient, submodule, dual_free_module, check)
     85             raise TypeError, "submodule must be a free module"
     86         if not submodule.is_submodule(ambient.free_module()):
---> 87             raise ValueError, "submodule must be a submodule of the ambient free module"
     88 
     89         if check:

ValueError: submodule must be a submodule of the ambient free module
```



---

Attachment

patch against 4.6.1.alpha3 + #8716


---

Comment by davidloeffler created at 2010-12-11 16:09:32

Changing status from new to needs_review.


---

Comment by davidloeffler created at 2010-12-11 16:09:32

Here's a patch. It requires #8716 (but is independent of either #10450 or #10452). The fix was to make the various degeneracy matrix commands pass around an explicit target space, rather than just a target level, as the argument.


---

Comment by davidloeffler created at 2010-12-31 14:52:54

Depends on #8716


---

Comment by johanbosman created at 2011-08-18 11:49:10

Changing status from needs_review to positive_review.


---

Comment by johanbosman created at 2011-08-18 11:49:10

The code looks sound and is well documented.  All long doctests pass.  I played around with it and couldn't produce any false results.  I did get the following while applying the patch:

```
applying trac_10453_gamma1_old_submodule.patch
patching file sage/modular/hecke/ambient_module.py
Hunk #10 succeeded at 883 with fuzz 1 (offset 6 lines).
now at: trac_10453_gamma1_old_submodule.patch
```

but according to [this discussion](http://groups.google.com/group/sage-devel/browse_thread/thread/c5af325e984d8ab4/cb85c8767055af0e?lnk=gst&q=fuzz#cb85c8767055af0e), fuzz 1 is okay.  Hence: positive review. ;).


---

Comment by leif created at 2011-09-09 00:44:50

Replying to [comment:6 johanbosman]:
> I did get the following while applying the patch:

```
applying trac_10453_gamma1_old_submodule.patch
patching file sage/modular/hecke/ambient_module.py
Hunk #10 succeeded at 883 with fuzz 1 (offset 6 lines).
now at: trac_10453_gamma1_old_submodule.patch
```

> but according to [this discussion](http://groups.google.com/group/sage-devel/browse_thread/thread/c5af325e984d8ab4/cb85c8767055af0e?lnk=gst&q=fuzz#cb85c8767055af0e), fuzz 1 is okay.  Hence: positive review. ;).

In this case, you could re-export the patch and upload the rebased version.

IMHO one should inspect any fuzz anyway.


---

Comment by davidloeffler created at 2011-09-11 10:53:37

Replying to [comment:7 leif]:
> IMHO one should inspect any fuzz anyway.

I have inspected the fuzz, which is caused by patch #10664 having gone in since this was written. It is not a problem; the issue fixed by #10664 is completely orthogonal to this one.


---

Comment by leif created at 2011-09-11 11:56:23

Replying to [comment:8 davidloeffler]:
> I have inspected the fuzz, which is caused by patch #10664 having gone in since this was written. It is not a problem; the issue fixed by #10664 is completely orthogonal to this one.

Thanks, I hadn't [yet].


---

Comment by leif created at 2011-09-17 04:33:50

Resolution: fixed
