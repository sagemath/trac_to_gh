# Issue 10400: Problem with old submodule

archive/issues_010400.json:
```json
{
    "body": "Assignee: @craigcitro\n\nIf you ask for the old submodule of a Gamma1 modular forms space, and that old subspace is actually zero, then Sage crashes:\n\n```\nsage: CuspForms(Gamma1(11), 2).old_submodule()\nERROR: An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: ('EOF in multi-line statement', (28, 0))\n\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/home/masiao/<ipython console> in <module>()\n\n/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/hecke/submodule.pyc in old_submodule(self, p)\n    850             pass\n    851 \n--> 852         S = self.ambient_hecke_module().old_submodule(p)\n    853         os = S.intersection(self)\n    854         if os.rank() == self.rank():\n\n/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/hecke/ambient_module.pyc in old_submodule(self, p)\n    857             #end if\n    858         #end for\n--> 859         os = self.submodule(d.image(), check=False)\n    860         self.__is_old[p] = (os == self)\n    861 \n\n/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/hecke/ambient_module.pyc in submodule(self, M, Mdual, check)\n    887             if M == self.free_module():\n    888                 return self\n--> 889         return self._submodule_class()(self, M, Mdual, check=check)\n    890 \n    891     def _submodule_class(self):\n\n/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/modform/submodule.pyc in __init__(self, ambient_module, submodule, dual, check)\n     46         \"\"\"\n     47         A = ambient_module\n---> 48         sage.modular.hecke.submodule.HeckeSubmodule.__init__(self, A, submodule, check=check)\n     49         space.ModularFormsSpace.__init__(self, A.group(), A.weight(),\n     50                                          A.character(), A.base_ring())\n\n/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/hecke/submodule.pyc in __init__(self, ambient, submodule, dual_free_module, check)\n     85             raise TypeError, \"submodule must be a free module\"\n     86         if not submodule.is_submodule(ambient.free_module()):\n---> 87             raise ValueError, \"submodule must be a submodule of the ambient free module\"\n     88 \n     89         if check:\n\nValueError: submodule must be a submodule of the ambient free module\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/10453\n\n",
    "created_at": "2010-12-09T17:03:17Z",
    "labels": [
        "component: modular forms",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "Problem with old submodule",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10400",
    "user": "https://github.com/loefflerd"
}
```
Assignee: @craigcitro

If you ask for the old submodule of a Gamma1 modular forms space, and that old subspace is actually zero, then Sage crashes:

```
sage: CuspForms(Gamma1(11), 2).old_submodule()
ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (28, 0))

---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/home/masiao/<ipython console> in <module>()

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/hecke/submodule.pyc in old_submodule(self, p)
    850             pass
    851 
--> 852         S = self.ambient_hecke_module().old_submodule(p)
    853         os = S.intersection(self)
    854         if os.rank() == self.rank():

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/hecke/ambient_module.pyc in old_submodule(self, p)
    857             #end if
    858         #end for
--> 859         os = self.submodule(d.image(), check=False)
    860         self.__is_old[p] = (os == self)
    861 

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/hecke/ambient_module.pyc in submodule(self, M, Mdual, check)
    887             if M == self.free_module():
    888                 return self
--> 889         return self._submodule_class()(self, M, Mdual, check=check)
    890 
    891     def _submodule_class(self):

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/modform/submodule.pyc in __init__(self, ambient_module, submodule, dual, check)
     46         """
     47         A = ambient_module
---> 48         sage.modular.hecke.submodule.HeckeSubmodule.__init__(self, A, submodule, check=check)
     49         space.ModularFormsSpace.__init__(self, A.group(), A.weight(),
     50                                          A.character(), A.base_ring())

/usr/local/sage/sage-4.6/local/lib/python2.6/site-packages/sage/modular/hecke/submodule.pyc in __init__(self, ambient, submodule, dual_free_module, check)
     85             raise TypeError, "submodule must be a free module"
     86         if not submodule.is_submodule(ambient.free_module()):
---> 87             raise ValueError, "submodule must be a submodule of the ambient free module"
     88 
     89         if check:

ValueError: submodule must be a submodule of the ambient free module
```

Issue created by migration from https://trac.sagemath.org/ticket/10453





---

archive/issue_comments_106861.json:
```json
{
    "body": "Attachment [trac_10453_gamma1_old_submodule.patch](tarball://root/attachments/some-uuid/ticket10453/trac_10453_gamma1_old_submodule.patch) by @loefflerd created at 2010-12-11 16:05:39\n\npatch against 4.6.1.alpha3 + #8716",
    "created_at": "2010-12-11T16:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10400#issuecomment-106861",
    "user": "https://github.com/loefflerd"
}
```

Attachment [trac_10453_gamma1_old_submodule.patch](tarball://root/attachments/some-uuid/ticket10453/trac_10453_gamma1_old_submodule.patch) by @loefflerd created at 2010-12-11 16:05:39

patch against 4.6.1.alpha3 + #8716



---

archive/issue_comments_106862.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-12-11T16:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10400#issuecomment-106862",
    "user": "https://github.com/loefflerd"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_106863.json:
```json
{
    "body": "Here's a patch. It requires #8716 (but is independent of either #10450 or #10452). The fix was to make the various degeneracy matrix commands pass around an explicit target space, rather than just a target level, as the argument.",
    "created_at": "2010-12-11T16:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10400#issuecomment-106863",
    "user": "https://github.com/loefflerd"
}
```

Here's a patch. It requires #8716 (but is independent of either #10450 or #10452). The fix was to make the various degeneracy matrix commands pass around an explicit target space, rather than just a target level, as the argument.



---

archive/issue_comments_106864.json:
```json
{
    "body": "Depends on #8716",
    "created_at": "2010-12-31T14:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10400#issuecomment-106864",
    "user": "https://github.com/loefflerd"
}
```

Depends on #8716



---

archive/issue_comments_106865.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-08-18T11:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10400#issuecomment-106865",
    "user": "https://trac.sagemath.org/admin/accounts/users/johanbosman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_106866.json:
```json
{
    "body": "The code looks sound and is well documented.  All long doctests pass.  I played around with it and couldn't produce any false results.  I did get the following while applying the patch:\n\n```\napplying trac_10453_gamma1_old_submodule.patch\npatching file sage/modular/hecke/ambient_module.py\nHunk #10 succeeded at 883 with fuzz 1 (offset 6 lines).\nnow at: trac_10453_gamma1_old_submodule.patch\n```\nbut according to [this discussion](http://groups.google.com/group/sage-devel/browse_thread/thread/c5af325e984d8ab4/cb85c8767055af0e?lnk=gst&q=fuzz#cb85c8767055af0e), fuzz 1 is okay.  Hence: positive review. ;).",
    "created_at": "2011-08-18T11:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10400#issuecomment-106866",
    "user": "https://trac.sagemath.org/admin/accounts/users/johanbosman"
}
```

The code looks sound and is well documented.  All long doctests pass.  I played around with it and couldn't produce any false results.  I did get the following while applying the patch:

```
applying trac_10453_gamma1_old_submodule.patch
patching file sage/modular/hecke/ambient_module.py
Hunk #10 succeeded at 883 with fuzz 1 (offset 6 lines).
now at: trac_10453_gamma1_old_submodule.patch
```
but according to [this discussion](http://groups.google.com/group/sage-devel/browse_thread/thread/c5af325e984d8ab4/cb85c8767055af0e?lnk=gst&q=fuzz#cb85c8767055af0e), fuzz 1 is okay.  Hence: positive review. ;).



---

archive/issue_comments_106867.json:
```json
{
    "body": "Replying to [comment:6 johanbosman]:\n> I did get the following while applying the patch:\n\n{{{\napplying trac_10453_gamma1_old_submodule.patch\npatching file sage/modular/hecke/ambient_module.py\nHunk #10 succeeded at 883 with fuzz 1 (offset 6 lines).\nnow at: trac_10453_gamma1_old_submodule.patch\n}}}\n> but according to [this discussion](http://groups.google.com/group/sage-devel/browse_thread/thread/c5af325e984d8ab4/cb85c8767055af0e?lnk=gst&q=fuzz#cb85c8767055af0e), fuzz 1 is okay.  Hence: positive review. ;).\n\n\nIn this case, you could re-export the patch and upload the rebased version.\n\nIMHO one should inspect any fuzz anyway.",
    "created_at": "2011-09-09T00:44:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10400#issuecomment-106867",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:6 johanbosman]:
> I did get the following while applying the patch:

{{{
applying trac_10453_gamma1_old_submodule.patch
patching file sage/modular/hecke/ambient_module.py
Hunk #10 succeeded at 883 with fuzz 1 (offset 6 lines).
now at: trac_10453_gamma1_old_submodule.patch
}}}
> but according to [this discussion](http://groups.google.com/group/sage-devel/browse_thread/thread/c5af325e984d8ab4/cb85c8767055af0e?lnk=gst&q=fuzz#cb85c8767055af0e), fuzz 1 is okay.  Hence: positive review. ;).


In this case, you could re-export the patch and upload the rebased version.

IMHO one should inspect any fuzz anyway.



---

archive/issue_comments_106868.json:
```json
{
    "body": "Replying to [comment:7 leif]:\n> IMHO one should inspect any fuzz anyway.\n\n\nI have inspected the fuzz, which is caused by patch #10664 having gone in since this was written. It is not a problem; the issue fixed by #10664 is completely orthogonal to this one.",
    "created_at": "2011-09-11T10:53:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10400#issuecomment-106868",
    "user": "https://github.com/loefflerd"
}
```

Replying to [comment:7 leif]:
> IMHO one should inspect any fuzz anyway.


I have inspected the fuzz, which is caused by patch #10664 having gone in since this was written. It is not a problem; the issue fixed by #10664 is completely orthogonal to this one.



---

archive/issue_comments_106869.json:
```json
{
    "body": "Replying to [comment:8 davidloeffler]:\n> I have inspected the fuzz, which is caused by patch #10664 having gone in since this was written. It is not a problem; the issue fixed by #10664 is completely orthogonal to this one.\n\n\nThanks, I hadn't [yet].",
    "created_at": "2011-09-11T11:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10400#issuecomment-106869",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:8 davidloeffler]:
> I have inspected the fuzz, which is caused by patch #10664 having gone in since this was written. It is not a problem; the issue fixed by #10664 is completely orthogonal to this one.


Thanks, I hadn't [yet].



---

archive/issue_comments_106870.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-09-17T04:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10400",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10400#issuecomment-106870",
    "user": "https://github.com/nexttime"
}
```

Resolution: fixed



---

archive/issue_events_026761.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-17T04:33:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10400",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10400#event-26761"
}
```
