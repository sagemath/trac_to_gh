# Issue 27603: Bug in the ppl backend of polyhedron

Issue created by migration from https://trac.sagemath.org/ticket/27840

Original creator: jipilab

Original creation time: 2019-05-16 12:07:46

CC:  mkoeppe vdelecroix tscrim

Keywords: polytopes, ppl

The following line throws a conversion error only with the (default) backend `ppl`:


```
sage: Q = Polyhedron(backend='ppl', vertices=[(1, 2, 3), (1, 3, 2), (2, 1, 3), (2, 3, 1), (3, 1, 2), (3, 2, 1)],rays=[[1,1,1]],lines=[[1,2,3]])
Traceback (most recent call last):
...
TypeError: no conversion of this rational to integer
```


Replacing the backend by any other goes through without problems.


---

Comment by mkoeppe created at 2019-05-16 13:15:41

Interesting. Here the heuristic that guesses the parent and base ring goes wrong. If one passes `base_ring=QQ`, then one can see that PPL chooses a representation using a fractional "vertex".


---

Comment by vdelecroix created at 2019-05-19 13:42:51

What should be done? Set `base_ring=QQ` when there is rays or lines?

Do you have any idea why PPL prefers a presentation with vertices with non-trivial denominators?


---

Comment by mkoeppe created at 2019-05-20 04:09:56

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2019-05-20 04:09:56

New commits:


---

Comment by vdelecroix created at 2019-05-20 06:19:34

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2019-05-20 06:19:34

Failures in

```
sage -t --long src/sage/geometry/cone.py  # 3 doctests failed
sage -t --long src/sage/doctest/control.py  # 4 doctests failed
sage -t --long src/sage/doctest/forker.py  # 6 doctests failed
sage -t --long src/sage/combinat/root_system/plot.py  # 1 doctest failed
```

(see patchbot report)

I believe that when the polytope is a cone (namely with a unique vertex at 0) then everything should be fine. No? Don't we want `base_ring=ZZ` in this case?

Also, the constructor should be tested when the user enforces `base_ring=ZZ`.


---

Comment by git created at 2019-05-20 13:03:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2019-05-20 13:06:16

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2019-05-20 15:42:11

I like more this less intrusive version. Though it is a pity that the second commit cancels some edits of the first...


---

Comment by git created at 2019-05-20 16:16:51

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2019-05-20 16:17:36

Replying to [comment:8 vdelecroix]:
> it is a pity that the second commit cancels some edits of the first...
I've squashed the two commits.


---

Comment by vdelecroix created at 2019-05-20 19:24:52

Nice Thx.


---

Comment by vdelecroix created at 2019-05-20 19:24:52

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-05-24 18:29:52

Resolution: fixed
