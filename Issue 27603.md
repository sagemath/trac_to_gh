# Issue 27603: Bug in the ppl backend of polyhedron

archive/issues_027603.json:
```json
{
    "body": "CC:  mkoeppe vdelecroix tscrim\n\nKeywords: polytopes, ppl\n\nThe following line throws a conversion error only with the (default) backend `ppl`:\n\n\n```\nsage: Q = Polyhedron(backend='ppl', vertices=[(1, 2, 3), (1, 3, 2), (2, 1, 3), (2, 3, 1), (3, 1, 2), (3, 2, 1)],rays=[[1,1,1]],lines=[[1,2,3]])\nTraceback (most recent call last):\n...\nTypeError: no conversion of this rational to integer\n```\n\n\nReplacing the backend by any other goes through without problems.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27840\n\n",
    "created_at": "2019-05-16T12:07:46Z",
    "labels": [
        "geometry",
        "major",
        "bug"
    ],
    "title": "Bug in the ppl backend of polyhedron",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27603",
    "user": "jipilab"
}
```
CC:  mkoeppe vdelecroix tscrim

Keywords: polytopes, ppl

The following line throws a conversion error only with the (default) backend `ppl`:


```
sage: Q = Polyhedron(backend='ppl', vertices=[(1, 2, 3), (1, 3, 2), (2, 1, 3), (2, 3, 1), (3, 1, 2), (3, 2, 1)],rays=[[1,1,1]],lines=[[1,2,3]])
Traceback (most recent call last):
...
TypeError: no conversion of this rational to integer
```


Replacing the backend by any other goes through without problems.

Issue created by migration from https://trac.sagemath.org/ticket/27840





---

archive/issue_comments_389506.json:
```json
{
    "body": "Interesting. Here the heuristic that guesses the parent and base ring goes wrong. If one passes `base_ring=QQ`, then one can see that PPL chooses a representation using a fractional \"vertex\".",
    "created_at": "2019-05-16T13:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27603#issuecomment-389506",
    "user": "mkoeppe"
}
```

Interesting. Here the heuristic that guesses the parent and base ring goes wrong. If one passes `base_ring=QQ`, then one can see that PPL chooses a representation using a fractional "vertex".



---

archive/issue_comments_389507.json:
```json
{
    "body": "What should be done? Set `base_ring=QQ` when there is rays or lines?\n\nDo you have any idea why PPL prefers a presentation with vertices with non-trivial denominators?",
    "created_at": "2019-05-19T13:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27603#issuecomment-389507",
    "user": "vdelecroix"
}
```

What should be done? Set `base_ring=QQ` when there is rays or lines?

Do you have any idea why PPL prefers a presentation with vertices with non-trivial denominators?



---

archive/issue_comments_389508.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-20T04:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27603#issuecomment-389508",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_389509.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-05-20T04:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27603#issuecomment-389509",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_389510.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-05-20T06:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27603#issuecomment-389510",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_389511.json:
```json
{
    "body": "Failures in\n\n```\nsage -t --long src/sage/geometry/cone.py  # 3 doctests failed\nsage -t --long src/sage/doctest/control.py  # 4 doctests failed\nsage -t --long src/sage/doctest/forker.py  # 6 doctests failed\nsage -t --long src/sage/combinat/root_system/plot.py  # 1 doctest failed\n```\n\n(see patchbot report)\n\nI believe that when the polytope is a cone (namely with a unique vertex at 0) then everything should be fine. No? Don't we want `base_ring=ZZ` in this case?\n\nAlso, the constructor should be tested when the user enforces `base_ring=ZZ`.",
    "created_at": "2019-05-20T06:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27603#issuecomment-389511",
    "user": "vdelecroix"
}
```

Failures in

```
sage -t --long src/sage/geometry/cone.py  # 3 doctests failed
sage -t --long src/sage/doctest/control.py  # 4 doctests failed
sage -t --long src/sage/doctest/forker.py  # 6 doctests failed
sage -t --long src/sage/combinat/root_system/plot.py  # 1 doctest failed
```

(see patchbot report)

I believe that when the polytope is a cone (namely with a unique vertex at 0) then everything should be fine. No? Don't we want `base_ring=ZZ` in this case?

Also, the constructor should be tested when the user enforces `base_ring=ZZ`.



---

archive/issue_comments_389512.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-20T13:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27603#issuecomment-389512",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_389513.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-05-20T13:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27603#issuecomment-389513",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_389514.json:
```json
{
    "body": "I like more this less intrusive version. Though it is a pity that the second commit cancels some edits of the first...",
    "created_at": "2019-05-20T15:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27603#issuecomment-389514",
    "user": "vdelecroix"
}
```

I like more this less intrusive version. Though it is a pity that the second commit cancels some edits of the first...



---

archive/issue_comments_389515.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-05-20T16:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27603#issuecomment-389515",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_389516.json:
```json
{
    "body": "Replying to [comment:8 vdelecroix]:\n> it is a pity that the second commit cancels some edits of the first...\nI've squashed the two commits.",
    "created_at": "2019-05-20T16:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27603#issuecomment-389516",
    "user": "mkoeppe"
}
```

Replying to [comment:8 vdelecroix]:
> it is a pity that the second commit cancels some edits of the first...
I've squashed the two commits.



---

archive/issue_comments_389517.json:
```json
{
    "body": "Nice Thx.",
    "created_at": "2019-05-20T19:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27603#issuecomment-389517",
    "user": "vdelecroix"
}
```

Nice Thx.



---

archive/issue_comments_389518.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-20T19:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27603#issuecomment-389518",
    "user": "vdelecroix"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_389519.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-05-24T18:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27603",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27603#issuecomment-389519",
    "user": "vbraun"
}
```

Resolution: fixed
