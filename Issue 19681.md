# Issue 19681: substitute exp(-x) with x infinity fails

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2016-01-20 17:53:00

CC:  rws

Keywords: bug


```
sage: exp(-Infinity)
0
```

is fine, but

```
sage: exp(-x).subs(x=Infinity)
Traceback (most recent call last):
...
RuntimeError: exp_eval(): exp^(unsigned_infinity) encountered 
```



---

Comment by jdemeyer created at 2016-01-20 18:26:50

This is very likely a bug in pynac.


---

Comment by behackl created at 2016-01-20 23:11:52

As far as I can tell, there is some sort of sign confusion occurring in pynac. This is now https://github.com/pynac/pynac/issues/123.


---

Comment by rws created at 2016-01-21 09:00:25

The reason is

```
sage: hash(SR(-oo))
2886518159
sage: hash((-x).subs(x=oo))
81231252
sage: hash((x).subs(x=-oo))
2886518159
```

See #19927 and #19928 for related bugs.


---

Comment by behackl created at 2016-01-23 09:45:01

This will be fixed in pynac-0.6.0; I'll add a doctest on this ticket after the upgrade.


---

Comment by behackl created at 2016-01-23 09:50:46

Replying to [comment:5 behackl]:
> This will be fixed in pynac-0.6.0; I'll add a doctest on this ticket after the upgrade.

... typo; I meant the next release (pynac-0.6.1 or so...).


---

Comment by behackl created at 2016-01-25 10:32:52

Changing status from new to needs_review.


---

Comment by behackl created at 2016-01-25 10:32:52

New commits:


---

Comment by behackl created at 2016-01-25 20:44:15

New commits:


---

Comment by jdemeyer created at 2016-01-25 21:02:14

I recommend adding a test also for [comment:4], which is the real underlying reason of this ticket.


---

Comment by jdemeyer created at 2016-01-25 21:02:14

Changing status from needs_review to needs_work.


---

Comment by behackl created at 2016-01-26 00:24:15

Changing status from needs_work to needs_info.


---

Comment by behackl created at 2016-01-26 00:24:15

I agree. Where is the best place to add tests for the equality of these hashes? Probably in the `__hash__`-methods in `rings/infinity.py` introduced in #19927?


---

Comment by rws created at 2016-01-26 06:53:39

Replying to [comment:10 behackl]:
> I agree. Where is the best place to add tests for the equality of these hashes? Probably in the `__hash__`-methods in `rings/infinity.py` introduced in #19927?
No, this is `SR`-specific, so `Expression.__hash__` would be the place.


---

Comment by jdemeyer created at 2016-01-26 08:35:06

Indeed. There are already several doctests of the form `hash(x) == hash(SR(x))` and that would fit there as well.


---

Comment by git created at 2016-01-26 12:07:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by behackl created at 2016-01-26 12:11:02

Thanks for pointing me there! I've added some tests for this; there might be some overlap with #19928. Do you want to have an explicit test like

```
sage: hash(x.subs(x=-oo)) == hash((-x).subs(x=oo))
True
```

too?


---

Comment by rws created at 2016-01-26 13:49:22

What you added is fine already, thanks! I'll just wait for #19948 with the review.


---

Comment by rws created at 2016-02-05 08:57:12

Changing status from needs_info to positive_review.


---

Comment by vbraun created at 2016-02-05 22:57:00

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-02-05 22:57:00

doctest fails


---

Comment by rws created at 2016-02-06 07:54:17

Changing status from needs_work to positive_review.


---

Comment by rws created at 2016-02-06 07:54:17

New commits:


---

Comment by vbraun created at 2016-02-06 21:00:27

Resolution: fixed
