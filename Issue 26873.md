# Issue 26873: Missing defusedxml module in Jupyter notebook

archive/issues_026873.json:
```json
{
    "body": "CC:  slelievre\n\nKeywords: jupyter defusedxml\n\nAs reported in https://groups.google.com/forum/#!msg/sage-release/ULwr6YtMfnY/UpPKqXmxDAAJ, the Jupyter notebook is broken in Sage 8.7.beta0: opening a notebook file (either a new one or a pre-existing one) results in \n\n```\n500 : Internal Server Error\n```\n\nthe reason being\n\n```\nImportError: No module named defusedxml\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27110\n\n",
    "created_at": "2019-01-24T14:30:30Z",
    "labels": [
        "notebook",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Missing defusedxml module in Jupyter notebook",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26873",
    "user": "egourgoulhon"
}
```
CC:  slelievre

Keywords: jupyter defusedxml

As reported in https://groups.google.com/forum/#!msg/sage-release/ULwr6YtMfnY/UpPKqXmxDAAJ, the Jupyter notebook is broken in Sage 8.7.beta0: opening a notebook file (either a new one or a pre-existing one) results in 

```
500 : Internal Server Error
```

the reason being

```
ImportError: No module named defusedxml
```


Issue created by migration from https://trac.sagemath.org/ticket/27110





---

archive/issue_comments_377987.json:
```json
{
    "body": "If anyone is curious, this new dependency of nbconvert was added in\n[nbconvert pull request 708](https://github.com/jupyter/nbconvert/pull/708).",
    "created_at": "2019-01-24T19:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-377987",
    "user": "slelievre"
}
```

If anyone is curious, this new dependency of nbconvert was added in
[nbconvert pull request 708](https://github.com/jupyter/nbconvert/pull/708).



---

archive/issue_comments_377988.json:
```json
{
    "body": "Do you plan to write a branch ?",
    "created_at": "2019-01-24T20:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-377988",
    "user": "tmonteil"
}
```

Do you plan to write a branch ?



---

archive/issue_comments_377989.json:
```json
{
    "body": "Branch added.\n\nThis is my first time adding an spkg from scratch unsupervised.\n\nI tried to follow the developer manual carefully, specifically this section:\n\n- http://doc.sagemath.org/html/en/developer/packaging.html\n\nPlease review.\n----\nNew commits:",
    "created_at": "2019-01-25T01:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-377989",
    "user": "slelievre"
}
```

Branch added.

This is my first time adding an spkg from scratch unsupervised.

I tried to follow the developer manual carefully, specifically this section:

- http://doc.sagemath.org/html/en/developer/packaging.html

Please review.
----
New commits:



---

archive/issue_comments_377990.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-01-25T01:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-377990",
    "user": "slelievre"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_377991.json:
```json
{
    "body": "Does the file `build/pkgs/nbconvert/dependencies` also need updating?\n\nCurrently it just has\n\n```\n$(PYTHON) | pip entrypoints pygments mistune pandocfilters testpath\n```\n\n\nCompare to the following, found in\n[nbconvert's setup.py at line 215](https://github.com/jupyter/nbconvert/blob/master/setup.py#L215):\n\n```\ninstall_requires = setuptools_args['install_requires'] = [\n    'mistune>=0.8.1',\n    'jinja2',\n    'pygments',\n    'traitlets>=4.2',\n    'jupyter_core',\n    'nbformat>=4.4',\n    'entrypoints>=0.2.2',\n    'bleach',\n    'pandocfilters>=1.4.1',\n    'testpath',\n    'defusedxml',\n]\njupyter_client_req = 'jupyter_client>=4.2'\n\nextra_requirements = {\n    'test': ['pytest', 'pytest-cov', 'ipykernel', jupyter_client_req],\n    'serve': ['tornado>=4.0'],\n    'execute': [jupyter_client_req],\n    'docs': ['sphinx>=1.5.1',\n             'sphinx_rtd_theme',\n             'nbsphinx>=0.2.12',\n             'sphinxcontrib_github_alt',\n             'ipython',\n             jupyter_client_req,\n             ],\n}\n```\n",
    "created_at": "2019-01-25T01:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-377991",
    "user": "slelievre"
}
```

Does the file `build/pkgs/nbconvert/dependencies` also need updating?

Currently it just has

```
$(PYTHON) | pip entrypoints pygments mistune pandocfilters testpath
```


Compare to the following, found in
[nbconvert's setup.py at line 215](https://github.com/jupyter/nbconvert/blob/master/setup.py#L215):

```
install_requires = setuptools_args['install_requires'] = [
    'mistune>=0.8.1',
    'jinja2',
    'pygments',
    'traitlets>=4.2',
    'jupyter_core',
    'nbformat>=4.4',
    'entrypoints>=0.2.2',
    'bleach',
    'pandocfilters>=1.4.1',
    'testpath',
    'defusedxml',
]
jupyter_client_req = 'jupyter_client>=4.2'

extra_requirements = {
    'test': ['pytest', 'pytest-cov', 'ipykernel', jupyter_client_req],
    'serve': ['tornado>=4.0'],
    'execute': [jupyter_client_req],
    'docs': ['sphinx>=1.5.1',
             'sphinx_rtd_theme',
             'nbsphinx>=0.2.12',
             'sphinxcontrib_github_alt',
             'ipython',
             jupyter_client_req,
             ],
}
```




---

archive/issue_comments_377992.json:
```json
{
    "body": "Replying to [comment:5 slelievre]:\n> \n> Please review.\n\nThanks for having added the package! After a pull of your branch + download of the tarball in the `upstream` folder, running `make` successfully installs the package (after the build of the documentation though, I don't know if this normal, i.e. I would expect all packages to be installed before starting building the documentation, but I may be wrong on this). Then Jupyter runs normally. So I would vote for a positive review.",
    "created_at": "2019-01-25T08:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-377992",
    "user": "egourgoulhon"
}
```

Replying to [comment:5 slelievre]:
> 
> Please review.

Thanks for having added the package! After a pull of your branch + download of the tarball in the `upstream` folder, running `make` successfully installs the package (after the build of the documentation though, I don't know if this normal, i.e. I would expect all packages to be installed before starting building the documentation, but I may be wrong on this). Then Jupyter runs normally. So I would vote for a positive review.



---

archive/issue_comments_377993.json:
```json
{
    "body": "Changing component from notebook to packages: standard.",
    "created_at": "2019-01-25T15:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-377993",
    "user": "jdemeyer"
}
```

Changing component from notebook to packages: standard.



---

archive/issue_comments_377994.json:
```json
{
    "body": "Replying to [comment:6 slelievre]:\n> Does the file `build/pkgs/nbconvert/dependencies` also need updating?\n\nI think it's best to do this, yes.",
    "created_at": "2019-01-25T15:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-377994",
    "user": "jdemeyer"
}
```

Replying to [comment:6 slelievre]:
> Does the file `build/pkgs/nbconvert/dependencies` also need updating?

I think it's best to do this, yes.



---

archive/issue_comments_377995.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-01-25T15:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-377995",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_377996.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-27T16:00:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-377996",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377997.json:
```json
{
    "body": "Update nbconvert dependencies using those in `install_requires` in nbconvert's `setup.py`.",
    "created_at": "2019-01-27T16:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-377997",
    "user": "slelievre"
}
```

Update nbconvert dependencies using those in `install_requires` in nbconvert's `setup.py`.



---

archive/issue_comments_377998.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-01-27T16:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-377998",
    "user": "slelievre"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_377999.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-27T19:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-377999",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_378000.json:
```json
{
    "body": "I just noticed that the version is hardcoded in the file `checksums.ini`, citing the above link from the reference manual: \"*Sage internally replaces the VERSION substring with the content of package-version.txt.*\"",
    "created_at": "2019-01-29T20:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-378000",
    "user": "slabbe"
}
```

I just noticed that the version is hardcoded in the file `checksums.ini`, citing the above link from the reference manual: "*Sage internally replaces the VERSION substring with the content of package-version.txt.*"



---

archive/issue_comments_378001.json:
```json
{
    "body": "This should fix it.\n----\nNew commits:",
    "created_at": "2019-01-29T21:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-378001",
    "user": "jhpalmieri"
}
```

This should fix it.
----
New commits:



---

archive/issue_comments_378002.json:
```json
{
    "body": "Thanks for catching this.",
    "created_at": "2019-01-30T00:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-378002",
    "user": "slelievre"
}
```

Thanks for catching this.



---

archive/issue_comments_378003.json:
```json
{
    "body": "I don't know that I really deserve authorship credit for that.",
    "created_at": "2019-01-30T00:38:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-378003",
    "user": "jhpalmieri"
}
```

I don't know that I really deserve authorship credit for that.



---

archive/issue_comments_378004.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-03T09:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26873",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26873#issuecomment-378004",
    "user": "vbraun"
}
```

Resolution: fixed
