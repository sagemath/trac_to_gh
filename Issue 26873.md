# Issue 26873: Missing defusedxml module in Jupyter notebook

Issue created by migration from https://trac.sagemath.org/ticket/27110

Original creator: egourgoulhon

Original creation time: 2019-01-24 14:30:30

CC:  slelievre

Keywords: jupyter defusedxml

As reported in https://groups.google.com/forum/#!msg/sage-release/ULwr6YtMfnY/UpPKqXmxDAAJ, the Jupyter notebook is broken in Sage 8.7.beta0: opening a notebook file (either a new one or a pre-existing one) results in 

```
500 : Internal Server Error
```

the reason being

```
ImportError: No module named defusedxml
```



---

Comment by slelievre created at 2019-01-24 19:14:44

If anyone is curious, this new dependency of nbconvert was added in
[nbconvert pull request 708](https://github.com/jupyter/nbconvert/pull/708).


---

Comment by tmonteil created at 2019-01-24 20:31:32

Do you plan to write a branch ?


---

Comment by slelievre created at 2019-01-25 01:03:46

Branch added.

This is my first time adding an spkg from scratch unsupervised.

I tried to follow the developer manual carefully, specifically this section:

- http://doc.sagemath.org/html/en/developer/packaging.html

Please review.
----
New commits:


---

Comment by slelievre created at 2019-01-25 01:03:46

Changing status from new to needs_review.


---

Comment by slelievre created at 2019-01-25 01:17:47

Does the file `build/pkgs/nbconvert/dependencies` also need updating?

Currently it just has

```
$(PYTHON) | pip entrypoints pygments mistune pandocfilters testpath
```


Compare to the following, found in
[nbconvert's setup.py at line 215](https://github.com/jupyter/nbconvert/blob/master/setup.py#L215):

```
install_requires = setuptools_args['install_requires'] = [
    'mistune>=0.8.1',
    'jinja2',
    'pygments',
    'traitlets>=4.2',
    'jupyter_core',
    'nbformat>=4.4',
    'entrypoints>=0.2.2',
    'bleach',
    'pandocfilters>=1.4.1',
    'testpath',
    'defusedxml',
]
jupyter_client_req = 'jupyter_client>=4.2'

extra_requirements = {
    'test': ['pytest', 'pytest-cov', 'ipykernel', jupyter_client_req],
    'serve': ['tornado>=4.0'],
    'execute': [jupyter_client_req],
    'docs': ['sphinx>=1.5.1',
             'sphinx_rtd_theme',
             'nbsphinx>=0.2.12',
             'sphinxcontrib_github_alt',
             'ipython',
             jupyter_client_req,
             ],
}
```



---

Comment by egourgoulhon created at 2019-01-25 08:38:03

Replying to [comment:5 slelievre]:
> 
> Please review.

Thanks for having added the package! After a pull of your branch + download of the tarball in the `upstream` folder, running `make` successfully installs the package (after the build of the documentation though, I don't know if this normal, i.e. I would expect all packages to be installed before starting building the documentation, but I may be wrong on this). Then Jupyter runs normally. So I would vote for a positive review.


---

Comment by jdemeyer created at 2019-01-25 15:52:56

Changing component from notebook to packages: standard.


---

Comment by jdemeyer created at 2019-01-25 15:53:51

Replying to [comment:6 slelievre]:
> Does the file `build/pkgs/nbconvert/dependencies` also need updating?

I think it's best to do this, yes.


---

Comment by jdemeyer created at 2019-01-25 15:53:51

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-01-27 16:00:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slelievre created at 2019-01-27 16:03:00

Update nbconvert dependencies using those in `install_requires` in nbconvert's `setup.py`.


---

Comment by slelievre created at 2019-01-27 16:03:00

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2019-01-27 19:10:52

Changing status from needs_review to positive_review.


---

Comment by slabbe created at 2019-01-29 20:54:09

I just noticed that the version is hardcoded in the file `checksums.ini`, citing the above link from the reference manual: "_Sage internally replaces the VERSION substring with the content of package-version.txt._"


---

Comment by jhpalmieri created at 2019-01-29 21:14:28

This should fix it.
----
New commits:


---

Comment by slelievre created at 2019-01-30 00:14:47

Thanks for catching this.


---

Comment by jhpalmieri created at 2019-01-30 00:38:59

I don't know that I really deserve authorship credit for that.


---

Comment by vbraun created at 2019-02-03 09:00:12

Resolution: fixed
