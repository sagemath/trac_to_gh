# Issue 26077: py3: Fix interfaces modules for python3

archive/issues_026077.json:
```json
{
    "body": "CC:  embray jdemeyer\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/26314\n\n",
    "created_at": "2018-09-19T15:39:11Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "py3: Fix interfaces modules for python3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26077",
    "user": "vklein"
}
```
CC:  embray jdemeyer



Issue created by migration from https://trac.sagemath.org/ticket/26314





---

archive/issue_comments_367701.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-09-19T15:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367701",
    "user": "vklein"
}
```

New commits:



---

archive/issue_comments_367702.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2018-09-19T15:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367702",
    "user": "vklein"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_367703.json:
```json
{
    "body": "see #26311 for the sleep problem",
    "created_at": "2018-09-19T17:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367703",
    "user": "chapoton"
}
```

see #26311 for the sleep problem



---

archive/issue_comments_367704.json:
```json
{
    "body": "Thanks !",
    "created_at": "2018-09-20T07:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367704",
    "user": "vklein"
}
```

Thanks !



---

archive/issue_comments_367705.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2018-09-27T07:50:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367705",
    "user": "vklein"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_367706.json:
```json
{
    "body": "This ticket don't manage the walltime case.",
    "created_at": "2018-09-27T07:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367706",
    "user": "vklein"
}
```

This ticket don't manage the walltime case.



---

archive/issue_comments_367707.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-02T09:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367707",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_367708.json:
```json
{
    "body": "Remove some unused variable to make pyflakes more happy (`AsciiArtString` is needed by `macaulay2.py`).",
    "created_at": "2018-10-02T09:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367708",
    "user": "vklein"
}
```

Remove some unused variable to make pyflakes more happy (`AsciiArtString` is needed by `macaulay2.py`).



---

archive/issue_comments_367709.json:
```json
{
    "body": "`@`embray and `@`jdemeyer, any opinion on the simple changes proposed here ?",
    "created_at": "2018-10-02T12:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367709",
    "user": "chapoton"
}
```

`@`embray and `@`jdemeyer, any opinion on the simple changes proposed here ?



---

archive/issue_comments_367710.json:
```json
{
    "body": "... or an opinion about the \"walltime\" test ...",
    "created_at": "2018-10-02T13:04:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367710",
    "user": "vklein"
}
```

... or an opinion about the "walltime" test ...



---

archive/issue_comments_367711.json:
```json
{
    "body": "For cases like:\n\n\n```diff\ndiff --git a/src/sage/interfaces/sagespawn.pyx b/src/sage/interfaces/sagespawn.pyx\nindex 9b44d3a..1600d70 100644\n--- a/src/sage/interfaces/sagespawn.pyx\n+++ b/src/sage/interfaces/sagespawn.pyx\n@@ -145,8 +145,10 @@ class SageSpawn(spawn):\n             sage: from sage.interfaces.sagespawn import SageSpawn\n             sage: E = SageSpawn(\"sh\", [\"-c\", \"echo hello world\"])\n             sage: _ = E.expect_peek(\"w\")\n-            sage: E.read()\n+            sage: E.read() # py2\n             'hello world\\r\\n'\n+            sage: E.read() # py3\n+            b'hello world\\r\\n'\n```\n\n\nwhere Python 3 returns bytes, instead of making two separate cases, in the past I have done something like `print(E.read().decode('ascii'))`.  This will have the same result in both cases.\n\n\nI wonder if Sage shouldn't include its own `sleep()` built-in that isn't broken :/",
    "created_at": "2018-10-02T13:09:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367711",
    "user": "embray"
}
```

For cases like:


```diff
diff --git a/src/sage/interfaces/sagespawn.pyx b/src/sage/interfaces/sagespawn.pyx
index 9b44d3a..1600d70 100644
--- a/src/sage/interfaces/sagespawn.pyx
+++ b/src/sage/interfaces/sagespawn.pyx
@@ -145,8 +145,10 @@ class SageSpawn(spawn):
             sage: from sage.interfaces.sagespawn import SageSpawn
             sage: E = SageSpawn("sh", ["-c", "echo hello world"])
             sage: _ = E.expect_peek("w")
-            sage: E.read()
+            sage: E.read() # py2
             'hello world\r\n'
+            sage: E.read() # py3
+            b'hello world\r\n'
```


where Python 3 returns bytes, instead of making two separate cases, in the past I have done something like `print(E.read().decode('ascii'))`.  This will have the same result in both cases.


I wonder if Sage shouldn't include its own `sleep()` built-in that isn't broken :/



---

archive/issue_comments_367712.json:
```json
{
    "body": "Replying to [comment:12 embray]:\n> where Python 3 returns bytes, instead of making two separate cases, in the past I have done something like `print(E.read().decode('ascii'))`.  This will have the same result in both cases.\n> \nI know, i hesitated between the two syntax and, as it is an `EXAMPLES::`, have think that the `# py2`-`# py3` syntax might be clearer for the end-user.\n\nI don't have a strong opinion on it, tell me what you prefer. If the past cases you talk about are also `EXAMPLES::` we should stick with the `decode('ascii')` solution for consistency.",
    "created_at": "2018-10-02T13:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367712",
    "user": "vklein"
}
```

Replying to [comment:12 embray]:
> where Python 3 returns bytes, instead of making two separate cases, in the past I have done something like `print(E.read().decode('ascii'))`.  This will have the same result in both cases.
> 
I know, i hesitated between the two syntax and, as it is an `EXAMPLES::`, have think that the `# py2`-`# py3` syntax might be clearer for the end-user.

I don't have a strong opinion on it, tell me what you prefer. If the past cases you talk about are also `EXAMPLES::` we should stick with the `decode('ascii')` solution for consistency.



---

archive/issue_comments_367713.json:
```json
{
    "body": "Yes, I think consistency is best.  There are a few other cases that also, rather than relying on the `repr`, just do like\n\n\n```\nsage: E.read() == b'Hello\\r\\n'\nTrue\n```\n\n\nor whatever.  This will also work the same on Python 2 and 3.\n\nI have thought of adding a helper to the test framework to deal with `b`-prefixed strings as it does with `u`-strings, but it turns out they are relatively uncommon in the majority of the test suite.",
    "created_at": "2018-10-02T13:40:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367713",
    "user": "embray"
}
```

Yes, I think consistency is best.  There are a few other cases that also, rather than relying on the `repr`, just do like


```
sage: E.read() == b'Hello\r\n'
True
```


or whatever.  This will also work the same on Python 2 and 3.

I have thought of adding a helper to the test framework to deal with `b`-prefixed strings as it does with `u`-strings, but it turns out they are relatively uncommon in the majority of the test suite.



---

archive/issue_comments_367714.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-02T14:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367714",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_367715.json:
```json
{
    "body": "`# py2`-`# py3` cases replaced using `decode(ascii)` syntax.",
    "created_at": "2018-10-02T14:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367715",
    "user": "vklein"
}
```

`# py2`-`# py3` cases replaced using `decode(ascii)` syntax.



---

archive/issue_comments_367716.json:
```json
{
    "body": "probably you do not need the initial `u` that you add to some doctests.",
    "created_at": "2018-10-05T09:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367716",
    "user": "chapoton"
}
```

probably you do not need the initial `u` that you add to some doctests.



---

archive/issue_comments_367717.json:
```json
{
    "body": "Replying to [comment:17 chapoton]:\n> probably you do not need the initial `u` that you add to some doctests.\n\nI think it is needed because on Python 2 `.decode(...)` will return a unicode string literal, and the doctest parser *does* treat this as relevant on Python 2.  The only thing it does w.r.t. u-prefixes is on Python 3 it strips them from the expected output.\n\nI usually avoid the issue by using `print(...)` instead, but i think this is fine as-is.",
    "created_at": "2018-10-05T10:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367717",
    "user": "embray"
}
```

Replying to [comment:17 chapoton]:
> probably you do not need the initial `u` that you add to some doctests.

I think it is needed because on Python 2 `.decode(...)` will return a unicode string literal, and the doctest parser *does* treat this as relevant on Python 2.  The only thing it does w.r.t. u-prefixes is on Python 3 it strips them from the expected output.

I usually avoid the issue by using `print(...)` instead, but i think this is fine as-is.



---

archive/issue_comments_367718.json:
```json
{
    "body": "It is as Eric says, these tests as they are won't work on py2 without the initial `u`",
    "created_at": "2018-10-05T11:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367718",
    "user": "vklein"
}
```

It is as Eric says, these tests as they are won't work on py2 without the initial `u`



---

archive/issue_comments_367719.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-21T14:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367719",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_367720.json:
```json
{
    "body": "ok, let it be",
    "created_at": "2018-10-21T14:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367720",
    "user": "chapoton"
}
```

ok, let it be



---

archive/issue_comments_367721.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-22T22:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367721",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_367722.json:
```json
{
    "body": "This should be re-targeted for 8.5.",
    "created_at": "2018-10-28T14:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26077#issuecomment-367722",
    "user": "embray"
}
```

This should be re-targeted for 8.5.
