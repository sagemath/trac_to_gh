# Issue 18019: recythonize only if cython really changed

archive/issues_018019.json:
```json
{
    "body": "Keywords: cythonize\n\nIn #17851 cycache was necessarily disabled. This now leads to recythonizing everything when only the cython version **number was touched** (e.g. by checking out an old branch followed by merging develop). Ideally, cythonizing everything should only happen if the cython binary is different when compared to the last cythonizing.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18256\n\n",
    "created_at": "2015-04-20T07:14:36Z",
    "labels": [
        "cython",
        "major",
        "enhancement"
    ],
    "title": "recythonize only if cython really changed",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18019",
    "user": "rws"
}
```
Keywords: cythonize

In #17851 cycache was necessarily disabled. This now leads to recythonizing everything when only the cython version **number was touched** (e.g. by checking out an old branch followed by merging develop). Ideally, cythonizing everything should only happen if the cython binary is different when compared to the last cythonizing.

Issue created by migration from https://trac.sagemath.org/ticket/18256





---

archive/issue_comments_242522.json:
```json
{
    "body": "This was already reported upstream in #17851. We should not have a Sage specific solution for that! Of course we would have to set again the cache once this will be fixed upstream...",
    "created_at": "2015-04-20T19:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18019#issuecomment-242522",
    "user": "vdelecroix"
}
```

This was already reported upstream in #17851. We should not have a Sage specific solution for that! Of course we would have to set again the cache once this will be fixed upstream...



---

archive/issue_comments_242523.json:
```json
{
    "body": "If the Cython version number was touched, it means that Cython really changed (otherwise, we wouldn't have changed the Cython version number...). So I don't really understand the issue.",
    "created_at": "2015-04-21T06:00:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18019#issuecomment-242523",
    "user": "jdemeyer"
}
```

If the Cython version number was touched, it means that Cython really changed (otherwise, we wouldn't have changed the Cython version number...). So I don't really understand the issue.



---

archive/issue_comments_242524.json:
```json
{
    "body": "Replying to [comment:2 jdemeyer]:\n> If the Cython version number was touched, it means that Cython really changed (otherwise, we wouldn't have changed the Cython version number...). So I don't really understand the issue.\nMaybe I'm stupid but somewhere the dependencies are described, e.g., in a Makefile or other config, which trigger the complete build. Instead, you trigger it when the version string changes, not when the timestamp changes. This results in identical behaviour on upgrade, but spares full recythonize when I do an old branch checkout followed by develop merge.",
    "created_at": "2015-04-21T06:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18019#issuecomment-242524",
    "user": "rws"
}
```

Replying to [comment:2 jdemeyer]:
> If the Cython version number was touched, it means that Cython really changed (otherwise, we wouldn't have changed the Cython version number...). So I don't really understand the issue.
Maybe I'm stupid but somewhere the dependencies are described, e.g., in a Makefile or other config, which trigger the complete build. Instead, you trigger it when the version string changes, not when the timestamp changes. This results in identical behaviour on upgrade, but spares full recythonize when I do an old branch checkout followed by develop merge.



---

archive/issue_comments_242525.json:
```json
{
    "body": "Replying to [comment:3 rws]:\n> Replying to [comment:2 jdemeyer]:\n> > If the Cython version number was touched, it means that Cython really changed (otherwise, we wouldn't have changed the Cython version number...). So I don't really understand the issue.\n> Maybe I'm stupid but somewhere the dependencies are described, e.g., in a Makefile or other config, which trigger the complete build. Instead, you trigger it when the version string changes, not when the timestamp changes. This results in identical behaviour on upgrade, but spares full recythonize when I do an old branch checkout followed by develop merge.\n???\n\nI really don't understand what you are saying. Could you please clearly indicate *the problem* (not an analysis or a fix, just the problem).",
    "created_at": "2015-04-21T07:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18019#issuecomment-242525",
    "user": "jdemeyer"
}
```

Replying to [comment:3 rws]:
> Replying to [comment:2 jdemeyer]:
> > If the Cython version number was touched, it means that Cython really changed (otherwise, we wouldn't have changed the Cython version number...). So I don't really understand the issue.
> Maybe I'm stupid but somewhere the dependencies are described, e.g., in a Makefile or other config, which trigger the complete build. Instead, you trigger it when the version string changes, not when the timestamp changes. This results in identical behaviour on upgrade, but spares full recythonize when I do an old branch checkout followed by develop merge.
???

I really don't understand what you are saying. Could you please clearly indicate *the problem* (not an analysis or a fix, just the problem).



---

archive/issue_comments_242526.json:
```json
{
    "body": "Replying to [comment:4 jdemeyer]:\n> I really don't understand what you are saying. Could you please clearly indicate *the problem* (not an analysis or a fix, just the problem).\nI frequently checkout older branches to do a fix or a review. After checkout I often merge develop. Now when I `make`, due to (my guess) the change back and forth in cython version a full recythonize is triggered. But it is IMHO not necessary because I merged develop and so, only some Python code really changed, or only specific `pyx` files. The proposal here is to optimize the `make` behaviour in such cases.",
    "created_at": "2015-04-21T07:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18019#issuecomment-242526",
    "user": "rws"
}
```

Replying to [comment:4 jdemeyer]:
> I really don't understand what you are saying. Could you please clearly indicate *the problem* (not an analysis or a fix, just the problem).
I frequently checkout older branches to do a fix or a review. After checkout I often merge develop. Now when I `make`, due to (my guess) the change back and forth in cython version a full recythonize is triggered. But it is IMHO not necessary because I merged develop and so, only some Python code really changed, or only specific `pyx` files. The proposal here is to optimize the `make` behaviour in such cases.



---

archive/issue_comments_242527.json:
```json
{
    "body": "Changing component from cython to build.",
    "created_at": "2015-04-21T08:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18019#issuecomment-242527",
    "user": "jdemeyer"
}
```

Changing component from cython to build.



---

archive/issue_comments_242528.json:
```json
{
    "body": "This has nothing to do with Cython, but with `make`.",
    "created_at": "2015-04-21T08:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18019#issuecomment-242528",
    "user": "jdemeyer"
}
```

This has nothing to do with Cython, but with `make`.



---

archive/issue_comments_242529.json:
```json
{
    "body": "Changing keywords from \"cythonize\" to \"\".",
    "created_at": "2015-04-21T08:00:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18019#issuecomment-242529",
    "user": "jdemeyer"
}
```

Changing keywords from "cythonize" to "".



---

archive/issue_comments_242530.json:
```json
{
    "body": "To clarify: this would happen with every package upgrade. Since building Cython and re-cythonizing takes a long time, you just notice it more when it's Cython which is being rebuilt.",
    "created_at": "2015-04-21T08:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18019#issuecomment-242530",
    "user": "jdemeyer"
}
```

To clarify: this would happen with every package upgrade. Since building Cython and re-cythonizing takes a long time, you just notice it more when it's Cython which is being rebuilt.



---

archive/issue_comments_242531.json:
```json
{
    "body": "Hmm no, that's not true. There is logic in `src/bin/sage-spkg` to not re-build packages if you're installing the version which is already installed.",
    "created_at": "2015-04-21T08:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18019#issuecomment-242531",
    "user": "jdemeyer"
}
```

Hmm no, that's not true. There is logic in `src/bin/sage-spkg` to not re-build packages if you're installing the version which is already installed.



---

archive/issue_comments_242532.json:
```json
{
    "body": "Replying to [comment:5 rws]:\n> a full recythonize is triggered.\nAre you sure it's really a full recythonize and not just a rebuild of all files depending on a common file like `src/ext/interrupt.pxi`? It's true that Cython (just like `make`) uses timestamps to trigger rebuilds, so if the timestamp of `src/ext/interrupt.pxi` changes, then all Cython extensions depending on that (i.e. almost all of them) would be recythonized.\n\nIf this is the problem, I would like to close this ticket as `wontfix` since it's a feature, not a bug, to use timestamps for dependency checking. And even if it would be a bug, it's in upstream Cython, not Sage.",
    "created_at": "2015-04-21T08:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18019#issuecomment-242532",
    "user": "jdemeyer"
}
```

Replying to [comment:5 rws]:
> a full recythonize is triggered.
Are you sure it's really a full recythonize and not just a rebuild of all files depending on a common file like `src/ext/interrupt.pxi`? It's true that Cython (just like `make`) uses timestamps to trigger rebuilds, so if the timestamp of `src/ext/interrupt.pxi` changes, then all Cython extensions depending on that (i.e. almost all of them) would be recythonized.

If this is the problem, I would like to close this ticket as `wontfix` since it's a feature, not a bug, to use timestamps for dependency checking. And even if it would be a bug, it's in upstream Cython, not Sage.



---

archive/issue_comments_242533.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> ...so if the timestamp of `src/ext/interrupt.pxi` changes, then all Cython extensions depending on that (i.e. almost all of them) would be recythonized.\nThen that seems to have been the reason. If there is no way to make that more fine-grained I agree with wontfix here.",
    "created_at": "2015-04-21T08:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18019#issuecomment-242533",
    "user": "rws"
}
```

Replying to [comment:10 jdemeyer]:
> ...so if the timestamp of `src/ext/interrupt.pxi` changes, then all Cython extensions depending on that (i.e. almost all of them) would be recythonized.
Then that seems to have been the reason. If there is no way to make that more fine-grained I agree with wontfix here.



---

archive/issue_comments_242534.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-21T08:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18019#issuecomment-242534",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_242535.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-21T08:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18019#issuecomment-242535",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_242536.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2015-04-22T00:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18019#issuecomment-242536",
    "user": "vbraun"
}
```

Resolution: wontfix
