# Issue 20777: make: docbuilding should depend on jmol

archive/issues_020777.json:
```json
{
    "body": "See https://groups.google.com/d/msg/sage-devel/SlpXXtK_Cy0/QynwDq2gAAAJ and https://groups.google.com/d/msg/sage-release/jQmE2nsnbDI/u32jH0vOAQAJ.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21014\n\n",
    "created_at": "2016-07-13T18:09:45Z",
    "labels": [
        "component: build",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "make: docbuilding should depend on jmol",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20777",
    "user": "https://github.com/jhpalmieri"
}
```
See https://groups.google.com/d/msg/sage-devel/SlpXXtK_Cy0/QynwDq2gAAAJ and https://groups.google.com/d/msg/sage-release/jQmE2nsnbDI/u32jH0vOAQAJ.

Issue created by migration from https://trac.sagemath.org/ticket/21014





---

archive/issue_comments_286765.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-07-13T18:12:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286765",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_286766.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-07-13T18:12:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286766",
    "user": "https://github.com/jhpalmieri"
}
```

New commits:



---

archive/issue_comments_286767.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2016-07-13T18:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286767",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_286768.json:
```json
{
    "body": "If we make plots then we run arbitrary Sage code. So all runtime dependencies are docbuild dependencies, no? And if not then somebody just hasn't make a sufficiently complicated plot yet. What I'm proposing thus is to just use a dependency like\n\n```\ndoc-html: all-build\n```\n",
    "created_at": "2016-07-13T18:34:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286768",
    "user": "https://github.com/vbraun"
}
```

If we make plots then we run arbitrary Sage code. So all runtime dependencies are docbuild dependencies, no? And if not then somebody just hasn't make a sufficiently complicated plot yet. What I'm proposing thus is to just use a dependency like

```
doc-html: all-build
```




---

archive/issue_comments_286769.json:
```json
{
    "body": "indeed, trouble probably started few months ago when people did few tickets putting nicer pictures into the docs.",
    "created_at": "2016-07-13T18:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286769",
    "user": "https://github.com/dimpase"
}
```

indeed, trouble probably started few months ago when people did few tickets putting nicer pictures into the docs.



---

archive/issue_comments_286770.json:
```json
{
    "body": "Replying to [comment:4 vbraun]:\n> If we make plots then we run arbitrary Sage code. So all runtime dependencies are docbuild dependencies, no? And if not then somebody just hasn't make a sufficiently complicated plot yet. What I'm proposing thus is to just use a dependency like\n> {{{\n> doc-html: all-build\n> }}}\n\nThis used to be the case a while ago, but it makes the parallel build less efficient. For example, currently R can be built in parallel with the docs. With your proposal, parallel builds would take more time. I'm not saying that this is a huge problem, just pointing it out.",
    "created_at": "2016-07-13T18:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286770",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:4 vbraun]:
> If we make plots then we run arbitrary Sage code. So all runtime dependencies are docbuild dependencies, no? And if not then somebody just hasn't make a sufficiently complicated plot yet. What I'm proposing thus is to just use a dependency like
> {{{
> doc-html: all-build
> }}}

This used to be the case a while ago, but it makes the parallel build less efficient. For example, currently R can be built in parallel with the docs. With your proposal, parallel builds would take more time. I'm not saying that this is a huge problem, just pointing it out.



---

archive/issue_comments_286771.json:
```json
{
    "body": "We could add `sagelib` to the docbuilding dependencies.",
    "created_at": "2016-07-13T19:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286771",
    "user": "https://github.com/jhpalmieri"
}
```

We could add `sagelib` to the docbuilding dependencies.



---

archive/issue_comments_286772.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> This used to be the case a while ago, but it makes the parallel build less efficient. For example, currently R can be built in parallel with the docs\n\nYes, until somebody adds an R plot to the docs. Then suddenly you get hard-to-debug parallel build failures.",
    "created_at": "2016-07-13T20:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286772",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:6 jdemeyer]:
> This used to be the case a while ago, but it makes the parallel build less efficient. For example, currently R can be built in parallel with the docs

Yes, until somebody adds an R plot to the docs. Then suddenly you get hard-to-debug parallel build failures.



---

archive/issue_comments_286773.json:
```json
{
    "body": "Replying to [comment:7 jhpalmieri]:\n> We could add `sagelib` to the docbuilding dependencies.\n\nSorry, it's already there. Never mind.",
    "created_at": "2016-07-13T20:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286773",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:7 jhpalmieri]:
> We could add `sagelib` to the docbuilding dependencies.

Sorry, it's already there. Never mind.



---

archive/issue_comments_286774.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> Replying to [comment:4 vbraun]:\n> > If we make plots then we run arbitrary Sage code. So all runtime dependencies are docbuild dependencies, no? And if not then somebody just hasn't make a sufficiently complicated plot yet. What I'm proposing thus is to just use a dependency like\n> > {{{\n> > doc-html: all-build\n> > }}}\n> \n> This used to be the case a while ago, but it makes the parallel build less efficient. For example, currently R can be built in parallel with the docs. \n\nbut this is only true as long as there is no doctest using R somewhere you do not expect it to be used.\n\n\n\nWith your proposal, parallel builds would take more time. I'm not saying that this is a huge problem, just pointing it out.",
    "created_at": "2016-07-13T21:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286774",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:6 jdemeyer]:
> Replying to [comment:4 vbraun]:
> > If we make plots then we run arbitrary Sage code. So all runtime dependencies are docbuild dependencies, no? And if not then somebody just hasn't make a sufficiently complicated plot yet. What I'm proposing thus is to just use a dependency like
> > {{{
> > doc-html: all-build
> > }}}
> 
> This used to be the case a while ago, but it makes the parallel build less efficient. For example, currently R can be built in parallel with the docs. 

but this is only true as long as there is no doctest using R somewhere you do not expect it to be used.



With your proposal, parallel builds would take more time. I'm not saying that this is a huge problem, just pointing it out.



---

archive/issue_comments_286775.json:
```json
{
    "body": "Replying to [comment:8 vbraun]:\n> Then suddenly you get hard-to-debug parallel build failures. \n\nYou could easily add a buildbot testing `make distclean; make doc`.",
    "created_at": "2016-07-14T09:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286775",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:8 vbraun]:
> Then suddenly you get hard-to-debug parallel build failures. 

You could easily add a buildbot testing `make distclean; make doc`.



---

archive/issue_comments_286776.json:
```json
{
    "body": "Sorry, but this issue `worksforme`. What is the exact issue that we're trying to solve here? The ticket description should be more explicit.",
    "created_at": "2016-07-14T13:01:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286776",
    "user": "https://github.com/jdemeyer"
}
```

Sorry, but this issue `worksforme`. What is the exact issue that we're trying to solve here? The ticket description should be more explicit.



---

archive/issue_comments_286777.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2016-07-14T13:01:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286777",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_286778.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-07-14T13:33:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286778",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_286779.json:
```json
{
    "body": "That's not very explicit. What *exactly* is the problem since I cannot reproduce it?",
    "created_at": "2016-07-14T13:59:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286779",
    "user": "https://github.com/jdemeyer"
}
```

That's not very explicit. What *exactly* is the problem since I cannot reproduce it?



---

archive/issue_comments_286780.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2016-07-14T13:59:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286780",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_286781.json:
```json
{
    "body": "Also: it's not a problem if *doctests* use jmol, this is only about *docbuilding*.",
    "created_at": "2016-07-14T14:02:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286781",
    "user": "https://github.com/jdemeyer"
}
```

Also: it's not a problem if *doctests* use jmol, this is only about *docbuilding*.



---

archive/issue_comments_286782.json:
```json
{
    "body": "I don't think that the fact that not everybody can reproduce this (race conditions are not easy in this sense) should postpone this ticket.",
    "created_at": "2016-07-14T14:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286782",
    "user": "https://github.com/dimpase"
}
```

I don't think that the fact that not everybody can reproduce this (race conditions are not easy in this sense) should postpone this ticket.



---

archive/issue_comments_286783.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2016-07-14T14:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286783",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_286784.json:
```json
{
    "body": "The issue is that some plots in the documentation require jmol, so if jmol happens not to be built early enough, docbuilding can fail. I just saw this yesterday on a fresh copy of 7.3.beta7, and there are other reports in sage-devel and sage-release.",
    "created_at": "2016-07-14T15:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286784",
    "user": "https://github.com/jhpalmieri"
}
```

The issue is that some plots in the documentation require jmol, so if jmol happens not to be built early enough, docbuilding can fail. I just saw this yesterday on a fresh copy of 7.3.beta7, and there are other reports in sage-devel and sage-release.



---

archive/issue_comments_286785.json:
```json
{
    "body": "Replying to [comment:17 jhpalmieri]:\n> The issue is that some plots in the documentation require jmol, so if jmol happens not to be built early enough, docbuilding can fail.\n\nI understand that, but nobody has been explicit about *which* plot is the one which is supposed to fail without jmol. And again, I cannot reproduce the problem: for me, the doc builds **without** jmol.\n\nI really don't like to add a \"fix\" for a problem when it's not at all clear what the problem is and whether the \"fix\" fixes it.\n\nI feel that the problem is more subtle and we're missing something here...",
    "created_at": "2016-07-14T15:22:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286785",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:17 jhpalmieri]:
> The issue is that some plots in the documentation require jmol, so if jmol happens not to be built early enough, docbuilding can fail.

I understand that, but nobody has been explicit about *which* plot is the one which is supposed to fail without jmol. And again, I cannot reproduce the problem: for me, the doc builds **without** jmol.

I really don't like to add a "fix" for a problem when it's not at all clear what the problem is and whether the "fix" fixes it.

I feel that the problem is more subtle and we're missing something here...



---

archive/issue_comments_286786.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2016-07-14T15:22:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286786",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_286787.json:
```json
{
    "body": "It fails for me. Here's what I did: I started with a fresh tarball, ran `make jmol` and then deleted `local/bin/jmol` and `local/share/jmol/`. Then I ran `make`. Docbuilding now fails every time, with the error as in the attached log file (extracted from `dochtml.log`).",
    "created_at": "2016-07-14T20:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286787",
    "user": "https://github.com/jhpalmieri"
}
```

It fails for me. Here's what I did: I started with a fresh tarball, ran `make jmol` and then deleted `local/bin/jmol` and `local/share/jmol/`. Then I ran `make`. Docbuilding now fails every time, with the error as in the attached log file (extracted from `dochtml.log`).



---

archive/issue_comments_286788.json:
```json
{
    "body": "Attachment [plot.log](tarball://root/attachments/some-uuid/ticket21014/plot.log) by @jhpalmieri created at 2016-07-14 20:15:21",
    "created_at": "2016-07-14T20:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286788",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [plot.log](tarball://root/attachments/some-uuid/ticket21014/plot.log) by @jhpalmieri created at 2016-07-14 20:15:21



---

archive/issue_comments_286789.json:
```json
{
    "body": "There are numerous `.txt` files under `.sage/temp/...` that probably contain something like\n\n```\nError: Unable to access jarfile $SAGE_ROOT/local/share/jmol/JmolData.jar\n```\n\nwhich is to be expected. I wonder what is in these `.txt` files for those that get failures when `jmol` is installed.",
    "created_at": "2016-07-14T21:23:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286789",
    "user": "https://github.com/strogdon"
}
```

There are numerous `.txt` files under `.sage/temp/...` that probably contain something like

```
Error: Unable to access jarfile $SAGE_ROOT/local/share/jmol/JmolData.jar
```

which is to be expected. I wonder what is in these `.txt` files for those that get failures when `jmol` is installed.



---

archive/issue_comments_286790.json:
```json
{
    "body": "I did a `make distclean && make doc-html` of plain 7.3.beta7 and it failed as expected with \n\n```\n[dochtml] [plot3d   ] RuntimeError: Jmol failed to create file '/home/vbraun/.sage/temp/volker-desktop/31502/dir_EhlRBl/preview.png', see '/home/vbraun/.sage/temp/volker-desktop/31502/tmp_tX4EGj.txt' for details\n```\n\nI'm pretty sure thats 100% reproducable, though takes a long time.",
    "created_at": "2016-07-14T22:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286790",
    "user": "https://github.com/vbraun"
}
```

I did a `make distclean && make doc-html` of plain 7.3.beta7 and it failed as expected with 

```
[dochtml] [plot3d   ] RuntimeError: Jmol failed to create file '/home/vbraun/.sage/temp/volker-desktop/31502/dir_EhlRBl/preview.png', see '/home/vbraun/.sage/temp/volker-desktop/31502/tmp_tX4EGj.txt' for details
```

I'm pretty sure thats 100% reproducable, though takes a long time.



---

archive/issue_comments_286791.json:
```json
{
    "body": "Replying to [comment:21 vbraun]:\n> I'm pretty sure thats 100% reproducable\n\nI'm pretty sure thats not the case.",
    "created_at": "2016-07-15T07:26:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286791",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:21 vbraun]:
> I'm pretty sure thats 100% reproducable

I'm pretty sure thats not the case.



---

archive/issue_comments_286792.json:
```json
{
    "body": "I agree with strogdon, it would be good to see also the `.txt` files that the error messages refer to.",
    "created_at": "2016-07-15T07:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286792",
    "user": "https://github.com/jdemeyer"
}
```

I agree with strogdon, it would be good to see also the `.txt` files that the error messages refer to.



---

archive/issue_comments_286793.json:
```json
{
    "body": "The txt files are auto-deleted by the sage cleaner. In any case I can tell you whats wrong, jmol is not a dependency of `make doc-html` so it is not built:\n\n```\n$ ./sage -sh -c jmol\n/bin/bash: jmol: command not found\n```\n",
    "created_at": "2016-07-15T07:39:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286793",
    "user": "https://github.com/vbraun"
}
```

The txt files are auto-deleted by the sage cleaner. In any case I can tell you whats wrong, jmol is not a dependency of `make doc-html` so it is not built:

```
$ ./sage -sh -c jmol
/bin/bash: jmol: command not found
```




---

archive/issue_comments_286794.json:
```json
{
    "body": "Those `.txt` files say:\n\n```\nError: Unable to access jarfile /Users/palmieri/Desktop/Sage_stuff/sage_builds/clean/sage-7.3.beta7/local/share/jmol/JmolData.jar\n```\n",
    "created_at": "2016-07-15T15:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286794",
    "user": "https://github.com/jhpalmieri"
}
```

Those `.txt` files say:

```
Error: Unable to access jarfile /Users/palmieri/Desktop/Sage_stuff/sage_builds/clean/sage-7.3.beta7/local/share/jmol/JmolData.jar
```




---

archive/issue_comments_286795.json:
```json
{
    "body": "Further analysis points to this `if` switch in `src/sage/plot/plot3d/base.pyx` in the `_rich_repr_jmol()` function:\n\n```\n        if not jdata.is_jvm_available():\n            # We can only use JMol to generate preview if a jvm is installed\n            from sage.repl.rich_output.output_graphics import OutputImagePng\n            tachyon = self._rich_repr_tachyon(OutputImagePng, **opts)\n            tachyon.png.save_as(preview_png)\n        else:\n            # Java needs absolute paths\n            # On cygwin, they should be native ones\n            scene_native = scene_zip\n            import sys\n            if sys.platform == 'cygwin':\n                from subprocess import check_output, STDOUT\n                scene_native = check_output(['cygpath', '-w', scene_native],\n                                            stderr=STDOUT).rstrip()\n            script = '''set defaultdirectory \"{0}\"\\nscript SCRIPT\\n'''.format(scene_native)\n            jdata.export_image(targetfile=preview_png, datafile=script,\n                               image_type=\"PNG\",\n                               figsize=opts['figsize'][0])\n```\n\n\nSo the problem only occurs if Java is installed.\n\nBut this leaves the question: if Tachyon works, why not always use Tachyon to produce the plots?",
    "created_at": "2016-07-15T15:55:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286795",
    "user": "https://github.com/jdemeyer"
}
```

Further analysis points to this `if` switch in `src/sage/plot/plot3d/base.pyx` in the `_rich_repr_jmol()` function:

```
        if not jdata.is_jvm_available():
            # We can only use JMol to generate preview if a jvm is installed
            from sage.repl.rich_output.output_graphics import OutputImagePng
            tachyon = self._rich_repr_tachyon(OutputImagePng, **opts)
            tachyon.png.save_as(preview_png)
        else:
            # Java needs absolute paths
            # On cygwin, they should be native ones
            scene_native = scene_zip
            import sys
            if sys.platform == 'cygwin':
                from subprocess import check_output, STDOUT
                scene_native = check_output(['cygpath', '-w', scene_native],
                                            stderr=STDOUT).rstrip()
            script = '''set defaultdirectory "{0}"\nscript SCRIPT\n'''.format(scene_native)
            jdata.export_image(targetfile=preview_png, datafile=script,
                               image_type="PNG",
                               figsize=opts['figsize'][0])
```


So the problem only occurs if Java is installed.

But this leaves the question: if Tachyon works, why not always use Tachyon to produce the plots?



---

archive/issue_comments_286796.json:
```json
{
    "body": "To anybody which does have a working Java: does the interactive JMol applet actually work in the generated documentation? If not, there is no point in using JMol for those plots.",
    "created_at": "2016-07-15T15:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286796",
    "user": "https://github.com/jdemeyer"
}
```

To anybody which does have a working Java: does the interactive JMol applet actually work in the generated documentation? If not, there is no point in using JMol for those plots.



---

archive/issue_comments_286797.json:
```json
{
    "body": "We use jmol (and java) to build the png preview of the plot server-side. This is then displayed by the notebook until the 3-d plot is activated by clicking on it. The actual in-browser animation is via jsmol (javascript).",
    "created_at": "2016-07-15T16:26:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286797",
    "user": "https://github.com/vbraun"
}
```

We use jmol (and java) to build the png preview of the plot server-side. This is then displayed by the notebook until the 3-d plot is activated by clicking on it. The actual in-browser animation is via jsmol (javascript).



---

archive/issue_comments_286798.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2016-07-16T09:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286798",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_286799.json:
```json
{
    "body": "besides, the quality of plots produced by Tachyon is not as good as with jmol...",
    "created_at": "2016-07-16T09:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286799",
    "user": "https://github.com/dimpase"
}
```

besides, the quality of plots produced by Tachyon is not as good as with jmol...



---

archive/issue_comments_286800.json:
```json
{
    "body": "tachyon output",
    "created_at": "2016-07-16T09:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286800",
    "user": "https://github.com/dimpase"
}
```

tachyon output



---

archive/issue_comments_286801.json:
```json
{
    "body": "Attachment [nose_jmol.png](tarball://root/attachments/some-uuid/ticket21014/nose_jmol.png) by @dimpase created at 2016-07-16 09:43:48\n\njmol output (smoother, no artefacts...)",
    "created_at": "2016-07-16T09:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286801",
    "user": "https://github.com/dimpase"
}
```

Attachment [nose_jmol.png](tarball://root/attachments/some-uuid/ticket21014/nose_jmol.png) by @dimpase created at 2016-07-16 09:43:48

jmol output (smoother, no artefacts...)



---

archive/issue_comments_286802.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-07-17T08:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20777#issuecomment-286802",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_019714.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-07-17T08:41:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20777",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20777#event-19714"
}
```
