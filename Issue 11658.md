# Issue 11658: Problems with Mercurial and utf-8 data in files

archive/issues_011658.json:
```json
{
    "body": "Using sage-4.7.2.alpha2 and the hg shipped with Sage, I cannot push the patch [http://trac.sagemath.org/sage_trac/attachment/ticket/11820/trac_11820_undo_4777.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/11820/trac_11820_undo_4777.patch) because the username contains utf-8 non-ASCII characters:\n\n\n```\n$ hg qpush\napplying trac_11820_undo_4777.patch\ntransaction abort!\nrollback completed\ncleaning up working directory...done\nabort: decoding near 'Andr\u00c3\u00a9 Apitzsc': 'ascii' codec can't decode byte 0xc3 in position 4: ordinal not in range(128)!\n```\n\n\nA solution is to set `HGENCODING=utf8` in `sage-env`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11830\n\n",
    "created_at": "2011-09-22T14:25:22Z",
    "labels": [
        "scripts",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "Problems with Mercurial and utf-8 data in files",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11658",
    "user": "jdemeyer"
}
```
Using sage-4.7.2.alpha2 and the hg shipped with Sage, I cannot push the patch [http://trac.sagemath.org/sage_trac/attachment/ticket/11820/trac_11820_undo_4777.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/11820/trac_11820_undo_4777.patch) because the username contains utf-8 non-ASCII characters:


```
$ hg qpush
applying trac_11820_undo_4777.patch
transaction abort!
rollback completed
cleaning up working directory...done
abort: decoding near 'AndrÃ© Apitzsc': 'ascii' codec can't decode byte 0xc3 in position 4: ordinal not in range(128)!
```


A solution is to set `HGENCODING=utf8` in `sage-env`.

Issue created by migration from https://trac.sagemath.org/ticket/11830





---

archive/issue_comments_131797.json:
```json
{
    "body": "Attachment [11830.patch](tarball://root/attachments/some-uuid/ticket11830/11830.patch) by jdemeyer created at 2011-09-22 14:27:11\n\nPatch to the SCRIPTS repository (local/bin)",
    "created_at": "2011-09-22T14:27:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11658#issuecomment-131797",
    "user": "jdemeyer"
}
```

Attachment [11830.patch](tarball://root/attachments/some-uuid/ticket11830/11830.patch) by jdemeyer created at 2011-09-22 14:27:11

Patch to the SCRIPTS repository (local/bin)



---

archive/issue_comments_131798.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-09-22T14:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11658#issuecomment-131798",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_131799.json:
```json
{
    "body": "Oh yes, this seems to catch all situations where we could run into this.\n\n(We would have had to change the Sage library's `hg_*` commands as well if we only changed e.g. `sage-sage`.)\n\nWill test this later.\n\n\n\n\nP.S:: The commit message lacks a ticket number... ;-)",
    "created_at": "2011-09-22T15:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11658#issuecomment-131799",
    "user": "leif"
}
```

Oh yes, this seems to catch all situations where we could run into this.

(We would have had to change the Sage library's `hg_*` commands as well if we only changed e.g. `sage-sage`.)

Will test this later.




P.S:: The commit message lacks a ticket number... ;-)



---

archive/issue_comments_131800.json:
```json
{
    "body": "Replying to [comment:2 leif]:\n> P.S:: The commit message lacks a ticket number... ;-)\n\nTrue, but a while ago it was decided that ticket numbers were no longer required on commit messages.  Ticket numbers are added automatically by my merger script.  This simplifies the work of the release manager, who no longer has to complain about missing ticket numbers.  It also ensures a common formatting for the ticket number: the commit message always starts with \"Trac #${TICKET_NUMBER}: \" which might be useful for scripts.",
    "created_at": "2011-09-22T19:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11658#issuecomment-131800",
    "user": "jdemeyer"
}
```

Replying to [comment:2 leif]:
> P.S:: The commit message lacks a ticket number... ;-)

True, but a while ago it was decided that ticket numbers were no longer required on commit messages.  Ticket numbers are added automatically by my merger script.  This simplifies the work of the release manager, who no longer has to complain about missing ticket numbers.  It also ensures a common formatting for the ticket number: the commit message always starts with "Trac #${TICKET_NUMBER}: " which might be useful for scripts.



---

archive/issue_comments_131801.json:
```json
{
    "body": "Replying to [comment:3 jdemeyer]:\n> Replying to [comment:2 leif]:\n> > P.S:: The commit message lacks a ticket number... ;-)\n> \n> True, but a while ago it was decided that ticket numbers were no longer required on commit messages.\n\nPerhaps my bad, I'm not aware of such an agreement, but I strongly object.\n\n\n\n\n> Ticket numbers are added automatically by my merger script.\n\nAs I already said elsewhere, this ignores the fact that there's sometimes a tiny period of time between when a patch gets attached to a ticket and when it gets merged into a release (and this release published).\n\n\n\n\n> This simplifies the work of the release manager, who no longer has to complain about missing ticket numbers.\n\nWell, he/she doesn't have to; reviewers IMHO should. Same for *filenames* of patches *not* containing the ticket number.\n\n(Btw., also the patchbot could complain about things like these, including missing or misspelled author and reviewer names on a ticket.)\n\n\n\n\n> It also ensures a common formatting for the ticket number: the commit message always starts with \"Trac #${TICKET_NUMBER}: \" which might be useful for scripts.\n\nThat's just a matter of how smart the scripts are, including the merge scripts themselves.\n\nBesides that I don't like that long form; I also noticed that a couple of commit messages get this prepended despite already containing the ticket number, or even starting with it (which they IMHO always should, since a commit message might reference other tickets as well).\n\nIf you want a *unique* form (which I'd consider unnecessary because scripts can easily recognize different, preferably nevertheless standardized variants), at least ticket numbers shouldn't get duplicated in the commit messages.",
    "created_at": "2011-09-22T23:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11658#issuecomment-131801",
    "user": "leif"
}
```

Replying to [comment:3 jdemeyer]:
> Replying to [comment:2 leif]:
> > P.S:: The commit message lacks a ticket number... ;-)
> 
> True, but a while ago it was decided that ticket numbers were no longer required on commit messages.

Perhaps my bad, I'm not aware of such an agreement, but I strongly object.




> Ticket numbers are added automatically by my merger script.

As I already said elsewhere, this ignores the fact that there's sometimes a tiny period of time between when a patch gets attached to a ticket and when it gets merged into a release (and this release published).




> This simplifies the work of the release manager, who no longer has to complain about missing ticket numbers.

Well, he/she doesn't have to; reviewers IMHO should. Same for *filenames* of patches *not* containing the ticket number.

(Btw., also the patchbot could complain about things like these, including missing or misspelled author and reviewer names on a ticket.)




> It also ensures a common formatting for the ticket number: the commit message always starts with "Trac #${TICKET_NUMBER}: " which might be useful for scripts.

That's just a matter of how smart the scripts are, including the merge scripts themselves.

Besides that I don't like that long form; I also noticed that a couple of commit messages get this prepended despite already containing the ticket number, or even starting with it (which they IMHO always should, since a commit message might reference other tickets as well).

If you want a *unique* form (which I'd consider unnecessary because scripts can easily recognize different, preferably nevertheless standardized variants), at least ticket numbers shouldn't get duplicated in the commit messages.



---

archive/issue_comments_131802.json:
```json
{
    "body": "Replying to [comment:4 leif]:\n> As I already said elsewhere, this ignores the fact that there's sometimes a tiny period of time between when a patch gets attached to a ticket and when it gets merged into a release (and this release published).\nAnd why is this a problem?\n\nReplying to [comment:4 leif]:\n> I'm not aware of such an agreement, but I strongly object.\nIt was suggested by other people and I implemented it, see [https://groups.google.com/forum/#!msg/sage-devel/9anAEvYpmp4/3PJ67hvJA_YJ](https://groups.google.com/forum/#!msg/sage-devel/9anAEvYpmp4/3PJ67hvJA_YJ)\n\nI certainly see more advantages than disadvantages to this so I would like to keep this convention.  I you want to discuss it further, it should probably be done on `sage-devel`.",
    "created_at": "2011-09-23T06:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11658#issuecomment-131802",
    "user": "jdemeyer"
}
```

Replying to [comment:4 leif]:
> As I already said elsewhere, this ignores the fact that there's sometimes a tiny period of time between when a patch gets attached to a ticket and when it gets merged into a release (and this release published).
And why is this a problem?

Replying to [comment:4 leif]:
> I'm not aware of such an agreement, but I strongly object.
It was suggested by other people and I implemented it, see [https://groups.google.com/forum/#!msg/sage-devel/9anAEvYpmp4/3PJ67hvJA_YJ](https://groups.google.com/forum/#!msg/sage-devel/9anAEvYpmp4/3PJ67hvJA_YJ)

I certainly see more advantages than disadvantages to this so I would like to keep this convention.  I you want to discuss it further, it should probably be done on `sage-devel`.



---

archive/issue_comments_131803.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-09-24T12:12:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11658#issuecomment-131803",
    "user": "leif"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_131804.json:
```json
{
    "body": "Just to work around some deficiency of my current script...",
    "created_at": "2011-09-24T12:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11658#issuecomment-131804",
    "user": "leif"
}
```

Just to work around some deficiency of my current script...



---

archive/issue_comments_131805.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-09-27T17:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11658#issuecomment-131805",
    "user": "leif"
}
```

Resolution: fixed
