# Issue 29891: Replace bashism in src/bin/sage-env

archive/issues_029891.json:
```json
{
    "body": "CC:  @jhpalmieri\n\nThe sage-env script is run under `/bin/sh` but contains bashisms:\n\n```\nSAGE_SCRIPTS_DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" && pwd )\"\n```\n\nThis causes a build failure when `/bin/sh` is not bash:\n\n```\ncd '/home/mjo/src/sage.git/build/pkgs/sage_conf' && . '/home/mjo/src/sage.git/src/bin/sage-env' && . '/home/mjo/src/sage.git/build/bin/sage-build-env-config' && sage-logger -p '/home/mjo/src/sage.git/build/pkgs/sage_conf/spkg-install' '/home/mjo/src/sage.git/logs/pkgs/sage_conf-none.log'\n/bin/sh: 123: /home/mjo/src/sage.git/src/bin/sage-env: Bad substitution\nError: SAGE_SCRIPTS_DIR is set to a bad value:\nSAGE_SCRIPTS_DIR=/home/mjo/src/sage.git/build/pkgs/sage_conf\nYou must correct it or erase it and rerun this script\nmake[3]: *** [Makefile:2022: /home/mjo/src/sage.git/local/var/lib/sage/installed/sage_conf-none] Error 1\n```\n\nThe comment at the top of sage-env about using bash features should be removed afterwards. For bonus points, it would be nice if we could add a non-bash shell to one of the CI runs.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/30128\n\n",
    "created_at": "2020-07-13T04:11:27Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Replace bashism in src/bin/sage-env",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29891",
    "user": "https://github.com/orlitzky"
}
```
CC:  @jhpalmieri

The sage-env script is run under `/bin/sh` but contains bashisms:

```
SAGE_SCRIPTS_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
```

This causes a build failure when `/bin/sh` is not bash:

```
cd '/home/mjo/src/sage.git/build/pkgs/sage_conf' && . '/home/mjo/src/sage.git/src/bin/sage-env' && . '/home/mjo/src/sage.git/build/bin/sage-build-env-config' && sage-logger -p '/home/mjo/src/sage.git/build/pkgs/sage_conf/spkg-install' '/home/mjo/src/sage.git/logs/pkgs/sage_conf-none.log'
/bin/sh: 123: /home/mjo/src/sage.git/src/bin/sage-env: Bad substitution
Error: SAGE_SCRIPTS_DIR is set to a bad value:
SAGE_SCRIPTS_DIR=/home/mjo/src/sage.git/build/pkgs/sage_conf
You must correct it or erase it and rerun this script
make[3]: *** [Makefile:2022: /home/mjo/src/sage.git/local/var/lib/sage/installed/sage_conf-none] Error 1
```

The comment at the top of sage-env about using bash features should be removed afterwards. For bonus points, it would be nice if we could add a non-bash shell to one of the CI runs.


Issue created by migration from https://trac.sagemath.org/ticket/30128





---

archive/issue_comments_424142.json:
```json
{
    "body": "Which scripts runs sage-env under /bin/sh? It's clearly documented that it's to be run in bash",
    "created_at": "2020-07-13T04:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424142",
    "user": "https://github.com/mkoeppe"
}
```

Which scripts runs sage-env under /bin/sh? It's clearly documented that it's to be run in bash



---

archive/issue_comments_424143.json:
```json
{
    "body": "That documentation was wrong after #29345, I just never noticed the comment to remove it.\n\nThe \"make\" process itself is run with `/bin/sh` and attempts to source sage-env,\n\n```\n$$(INST)/$(1)-$(2): $(3)\n\t$(AM_V_at)cd '$$(SAGE_ROOT)/build/pkgs/$(1)' && \\\n\t\t. '$$(SAGE_ROOT)/src/bin/sage-env' && . '$$(SAGE_ROOT)/build/bin/sage-build-env-config' && \\\n\t\tsage-logger -p '$$(SAGE_ROOT)/build/pkgs/$(1)/spkg-install' '$$(SAGE_LOGS)/$(1)-$(2).log'\n\ttouch \"$$@\"\n```\n\nin `build/make/Makefile.in`.",
    "created_at": "2020-07-13T04:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424143",
    "user": "https://github.com/orlitzky"
}
```

That documentation was wrong after #29345, I just never noticed the comment to remove it.

The "make" process itself is run with `/bin/sh` and attempts to source sage-env,

```
$$(INST)/$(1)-$(2): $(3)
	$(AM_V_at)cd '$$(SAGE_ROOT)/build/pkgs/$(1)' && \
		. '$$(SAGE_ROOT)/src/bin/sage-env' && . '$$(SAGE_ROOT)/build/bin/sage-build-env-config' && \
		sage-logger -p '$$(SAGE_ROOT)/build/pkgs/$(1)/spkg-install' '$$(SAGE_LOGS)/$(1)-$(2).log'
	touch "$$@"
```

in `build/make/Makefile.in`.



---

archive/issue_comments_424144.json:
```json
{
    "body": "Ah ok, this is the code for script packages?  I want to revise that anyway.\n\nIs there another place?",
    "created_at": "2020-07-13T04:23:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424144",
    "user": "https://github.com/mkoeppe"
}
```

Ah ok, this is the code for script packages?  I want to revise that anyway.

Is there another place?



---

archive/issue_comments_424145.json:
```json
{
    "body": "Replying to [comment:3 mkoeppe]:\n> Ah ok, this is the code for script packages?  I want to revise that anyway.\n... in #29386",
    "created_at": "2020-07-13T04:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424145",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:3 mkoeppe]:
> Ah ok, this is the code for script packages?  I want to revise that anyway.
... in #29386



---

archive/issue_comments_424146.json:
```json
{
    "body": "A quick fix is just to set `SAGE_SCRIPTS_DIR=$(SAGE_ROOT)/src/bin` before sourcing `sage-env`. The bash feature is only needed for locating this directory.",
    "created_at": "2020-07-13T04:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424146",
    "user": "https://github.com/mkoeppe"
}
```

A quick fix is just to set `SAGE_SCRIPTS_DIR=$(SAGE_ROOT)/src/bin` before sourcing `sage-env`. The bash feature is only needed for locating this directory.



---

archive/issue_comments_424147.json:
```json
{
    "body": "I think I may be able to solve this pretty easily by changing all instances of `. src/bin/sage-env` to `. src/bin/sage-env-config && . src/bin/sage-env`, and then requiring sage-env-config to always be sourced before sage-env (sage-env can die if `SAGE_ENV_CONFIG_SOURCED -neq 1`).\n\nsage-env really shouldn't know about sage-env-config at all, the split between the two was made at another level of abstraction. But practically, whoever is sourcing sage-env also knows the path to sage-env-config, and sage-env-config knows `SAGE_ROOT`.",
    "created_at": "2020-07-13T12:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424147",
    "user": "https://github.com/orlitzky"
}
```

I think I may be able to solve this pretty easily by changing all instances of `. src/bin/sage-env` to `. src/bin/sage-env-config && . src/bin/sage-env`, and then requiring sage-env-config to always be sourced before sage-env (sage-env can die if `SAGE_ENV_CONFIG_SOURCED -neq 1`).

sage-env really shouldn't know about sage-env-config at all, the split between the two was made at another level of abstraction. But practically, whoever is sourcing sage-env also knows the path to sage-env-config, and sage-env-config knows `SAGE_ROOT`.



---

archive/issue_comments_424148.json:
```json
{
    "body": "Great point, please go ahead.\n\nNote there's another related ticket - #29951 (`src/bin/sage-env`: Make `sage-env-config` and `SAGE_LOCAL` optional). Perhaps it makes sense to do this at the same time?",
    "created_at": "2020-07-13T14:11:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424148",
    "user": "https://github.com/mkoeppe"
}
```

Great point, please go ahead.

Note there's another related ticket - #29951 (`src/bin/sage-env`: Make `sage-env-config` and `SAGE_LOCAL` optional). Perhaps it makes sense to do this at the same time?



---

archive/issue_comments_424149.json:
```json
{
    "body": "Replying to [comment:7 mkoeppe]:\n> \n> Perhaps it makes sense to do this at the same time?\n> \n\n\nIf for no other reason than because I will temporarily understand how all of this works. I think I have the bashism thing fixed, waiting for a full rebuild of the distribution to be sure. After that #29951 looks pretty easy. Then maybe #29850... but trying to source `sage-env-config` so that we can install sage_conf is going to cause a chicken-and-egg problem there.",
    "created_at": "2020-07-13T16:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424149",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:7 mkoeppe]:
> 
> Perhaps it makes sense to do this at the same time?
> 


If for no other reason than because I will temporarily understand how all of this works. I think I have the bashism thing fixed, waiting for a full rebuild of the distribution to be sure. After that #29951 looks pretty easy. Then maybe #29850... but trying to source `sage-env-config` so that we can install sage_conf is going to cause a chicken-and-egg problem there.



---

archive/issue_comments_424150.json:
```json
{
    "body": "Replying to [comment:8 mjo]:\n> Then maybe #29850... but trying to source `sage-env-config` so that we can install sage_conf is going to cause a chicken-and-egg problem there.\n\n\nI don't think this is a problem because at build time I think (hope) you are sourcing `src/bin/sage-env-config`, not `$SAGE_LOCAL/bin/sage-env-config`.",
    "created_at": "2020-07-13T17:10:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424150",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:8 mjo]:
> Then maybe #29850... but trying to source `sage-env-config` so that we can install sage_conf is going to cause a chicken-and-egg problem there.


I don't think this is a problem because at build time I think (hope) you are sourcing `src/bin/sage-env-config`, not `$SAGE_LOCAL/bin/sage-env-config`.



---

archive/issue_comments_424151.json:
```json
{
    "body": "Ok, so we can just source it from `build/pkgs/sage_conf/...` instead. That feels wrong, but objectively it's no worse than pulling it from `src/bin`.",
    "created_at": "2020-07-13T17:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424151",
    "user": "https://github.com/orlitzky"
}
```

Ok, so we can just source it from `build/pkgs/sage_conf/...` instead. That feels wrong, but objectively it's no worse than pulling it from `src/bin`.



---

archive/issue_comments_424152.json:
```json
{
    "body": "I would prefer sourcing from `src/bin/`, not `build/pkgs/sage_conf/...`, but it makes no factual difference.",
    "created_at": "2020-07-13T18:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424152",
    "user": "https://github.com/mkoeppe"
}
```

I would prefer sourcing from `src/bin/`, not `build/pkgs/sage_conf/...`, but it makes no factual difference.



---

archive/issue_comments_424153.json:
```json
{
    "body": "Ultimately I am hoping that we can remove the dependence of the build on `src/bin/sage-env`. But not on this ticket... See #21707.",
    "created_at": "2020-07-13T18:41:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424153",
    "user": "https://github.com/mkoeppe"
}
```

Ultimately I am hoping that we can remove the dependence of the build on `src/bin/sage-env`. But not on this ticket... See #21707.



---

archive/issue_comments_424154.json:
```json
{
    "body": "This seems to work:\n\n1. The build finished with `/bin/sh -> /bin/dash`.\n2. I can run `~/src/sage.git/local/bin/sage` from my home directory afterwards and it works.\n  \n---\nNew commits:",
    "created_at": "2020-07-13T21:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424154",
    "user": "https://github.com/orlitzky"
}
```

This seems to work:

1. The build finished with `/bin/sh -> /bin/dash`.
2. I can run `~/src/sage.git/local/bin/sage` from my home directory afterwards and it works.
  
---
New commits:



---

archive/issue_comments_424155.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-13T21:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424155",
    "user": "https://github.com/orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_424156.json:
```json
{
    "body": "Looking great. I'll try it out later today",
    "created_at": "2020-07-13T21:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424156",
    "user": "https://github.com/mkoeppe"
}
```

Looking great. I'll try it out later today



---

archive/issue_comments_424157.json:
```json
{
    "body": "`sage-spkg` installs uninstall scripts for some packages in `$SAGE_LOCAL/`. \nAre these handled correctly?",
    "created_at": "2020-07-13T21:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424157",
    "user": "https://github.com/mkoeppe"
}
```

`sage-spkg` installs uninstall scripts for some packages in `$SAGE_LOCAL/`. 
Are these handled correctly?



---

archive/issue_comments_424158.json:
```json
{
    "body": "Replying to [comment:15 mkoeppe]:\n> `sage-spkg` installs uninstall scripts for some packages in `$SAGE_LOCAL/`. \n> Are these handled correctly?\n\n\nI dunno. Do you know the name of one of those packages? I don't have anything uninstall-related in `$SAGE_LOCAL` that I can see after a \"default\" install (with many system packages used).",
    "created_at": "2020-07-13T22:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424158",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:15 mkoeppe]:
> `sage-spkg` installs uninstall scripts for some packages in `$SAGE_LOCAL/`. 
> Are these handled correctly?


I dunno. Do you know the name of one of those packages? I don't have anything uninstall-related in `$SAGE_LOCAL` that I can see after a "default" install (with many system packages used).



---

archive/issue_comments_424159.json:
```json
{
    "body": "```\n$ ls -1 build/pkgs/*/spkg-*leg* build/pkgs/*/spkg-*rm* \nbuild/pkgs/boost_cropped/spkg-legacy-uninstall.in\nbuild/pkgs/brial/spkg-legacy-uninstall.in\nbuild/pkgs/cunningham_tables/spkg-legacy-uninstall.in\nbuild/pkgs/ecl/spkg-legacy-uninstall.in\nbuild/pkgs/gap/spkg-legacy-uninstall.in\nbuild/pkgs/gap/spkg-prerm.in\nbuild/pkgs/gcc/spkg-postrm.in\nbuild/pkgs/gfan/spkg-legacy-uninstall.in\nbuild/pkgs/gfortran/spkg-postrm.in\nbuild/pkgs/gsl/spkg-legacy-uninstall.in\nbuild/pkgs/jmol/spkg-legacy-uninstall.in\nbuild/pkgs/lcalc/spkg-legacy-uninstall.in\nbuild/pkgs/libgd/spkg-legacy-uninstall.in\nbuild/pkgs/mpfrcx/spkg-legacy-uninstall.in\nbuild/pkgs/numpy/spkg-legacy-uninstall.in\nbuild/pkgs/pkgconf/spkg-postrm.in\nbuild/pkgs/polymake/spkg-legacy-uninstall.in\nbuild/pkgs/polytopes_db_4d/spkg-legacy-uninstall.in\nbuild/pkgs/pplpy/spkg-postrm.in\nbuild/pkgs/r/spkg-legacy-uninstall.in\nbuild/pkgs/sage_brial/spkg-legacy-uninstall.in\n```",
    "created_at": "2020-07-13T22:41:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424159",
    "user": "https://github.com/mkoeppe"
}
```

```
$ ls -1 build/pkgs/*/spkg-*leg* build/pkgs/*/spkg-*rm* 
build/pkgs/boost_cropped/spkg-legacy-uninstall.in
build/pkgs/brial/spkg-legacy-uninstall.in
build/pkgs/cunningham_tables/spkg-legacy-uninstall.in
build/pkgs/ecl/spkg-legacy-uninstall.in
build/pkgs/gap/spkg-legacy-uninstall.in
build/pkgs/gap/spkg-prerm.in
build/pkgs/gcc/spkg-postrm.in
build/pkgs/gfan/spkg-legacy-uninstall.in
build/pkgs/gfortran/spkg-postrm.in
build/pkgs/gsl/spkg-legacy-uninstall.in
build/pkgs/jmol/spkg-legacy-uninstall.in
build/pkgs/lcalc/spkg-legacy-uninstall.in
build/pkgs/libgd/spkg-legacy-uninstall.in
build/pkgs/mpfrcx/spkg-legacy-uninstall.in
build/pkgs/numpy/spkg-legacy-uninstall.in
build/pkgs/pkgconf/spkg-postrm.in
build/pkgs/polymake/spkg-legacy-uninstall.in
build/pkgs/polytopes_db_4d/spkg-legacy-uninstall.in
build/pkgs/pplpy/spkg-postrm.in
build/pkgs/r/spkg-legacy-uninstall.in
build/pkgs/sage_brial/spkg-legacy-uninstall.in
```



---

archive/issue_comments_424160.json:
```json
{
    "body": "Definitely the prerm and postrm scripts are installed in `$SAGE_LOCAL/var/lib/sage/scripts`.",
    "created_at": "2020-07-13T22:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424160",
    "user": "https://github.com/mkoeppe"
}
```

Definitely the prerm and postrm scripts are installed in `$SAGE_LOCAL/var/lib/sage/scripts`.



---

archive/issue_comments_424161.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-07-14T00:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424161",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_424162.json:
```json
{
    "body": "I did have to fix the prerm/postrm script generator, I had missed one sourcing of sage-env in there. The only two packages that had those scripts installed were gap and pplpy, both of which can be uninstalled afterwards:\n\n```\n$ make pplpy-clean\n...\n***********************************************\nmake[1]: Entering directory '/home/mjo/src/sage.git/build/make'\nsage-spkg-uninstall  pplpy '/home/mjo/src/sage.git/local'\nUninstalling existing 'pplpy'\nRunning post-uninstall script for 'pplpy'\nRemove /home/mjo/src/sage.git/local/share/doc/pplpy directory.\nRemoving stamp file '/home/mjo/src/sage.git/local/var/lib/sage/installed/pplpy-0.8.4'\nmake[1]: Leaving directory '/home/mjo/src/sage.git/build/make'\n```",
    "created_at": "2020-07-14T00:49:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424162",
    "user": "https://github.com/orlitzky"
}
```

I did have to fix the prerm/postrm script generator, I had missed one sourcing of sage-env in there. The only two packages that had those scripts installed were gap and pplpy, both of which can be uninstalled afterwards:

```
$ make pplpy-clean
...
***********************************************
make[1]: Entering directory '/home/mjo/src/sage.git/build/make'
sage-spkg-uninstall  pplpy '/home/mjo/src/sage.git/local'
Uninstalling existing 'pplpy'
Running post-uninstall script for 'pplpy'
Remove /home/mjo/src/sage.git/local/share/doc/pplpy directory.
Removing stamp file '/home/mjo/src/sage.git/local/var/lib/sage/installed/pplpy-0.8.4'
make[1]: Leaving directory '/home/mjo/src/sage.git/build/make'
```



---

archive/issue_comments_424163.json:
```json
{
    "body": "The thing is that these scripts are installed with the intention that if you switch the source tree to a different version, the uninstall will still be done with the script that installed that version.",
    "created_at": "2020-07-14T01:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424163",
    "user": "https://github.com/mkoeppe"
}
```

The thing is that these scripts are installed with the intention that if you switch the source tree to a different version, the uninstall will still be done with the script that installed that version.



---

archive/issue_comments_424164.json:
```json
{
    "body": "Ah OK - I see that you have taken care of my concern already.",
    "created_at": "2020-07-14T01:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424164",
    "user": "https://github.com/mkoeppe"
}
```

Ah OK - I see that you have taken care of my concern already.



---

archive/issue_comments_424165.json:
```json
{
    "body": "That test for a \"broken gcc\" in $SAGE_LOCAL does not look right (before or after this ticket). If the source tree is clean (so no `src/bin/sage-env-config`) but $SAGE_LOCAL is already populated (with a `$SAGE_LOCAL/bin/sage` and a \"broken gcc\"), it will fail to detect the \"broken gcc\" situation.",
    "created_at": "2020-07-14T01:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424165",
    "user": "https://github.com/mkoeppe"
}
```

That test for a "broken gcc" in $SAGE_LOCAL does not look right (before or after this ticket). If the source tree is clean (so no `src/bin/sage-env-config`) but $SAGE_LOCAL is already populated (with a `$SAGE_LOCAL/bin/sage` and a "broken gcc"), it will fail to detect the "broken gcc" situation.



---

archive/issue_comments_424166.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-15T05:09:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424166",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_424167.json:
```json
{
    "body": "Replying to [comment:24 mkoeppe]:\n> That test for a \"broken gcc\" in $SAGE_LOCAL does not look right (before or after this ticket). If the source tree is clean (so no `src/bin/sage-env-config`) but $SAGE_LOCAL is already populated (with a `$SAGE_LOCAL/bin/sage` and a \"broken gcc\"), it will fail to detect the \"broken gcc\" situation.\n\n\nThere are many unspeakable things in the older spkg-configure files. This one, at least, I will eventually be drawn to fix as I `git grep bash` and try to eliminate the hits.",
    "created_at": "2020-07-15T14:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424167",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:24 mkoeppe]:
> That test for a "broken gcc" in $SAGE_LOCAL does not look right (before or after this ticket). If the source tree is clean (so no `src/bin/sage-env-config`) but $SAGE_LOCAL is already populated (with a `$SAGE_LOCAL/bin/sage` and a "broken gcc"), it will fail to detect the "broken gcc" situation.


There are many unspeakable things in the older spkg-configure files. This one, at least, I will eventually be drawn to fix as I `git grep bash` and try to eliminate the hits.



---

archive/issue_comments_424168.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-25T22:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29891#issuecomment-424168",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_077651.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-25T22:50:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29891",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29891#event-77651"
}
```
