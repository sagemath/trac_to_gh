# Issue 14799: Speed up matrix repr for matrices larger than 20

archive/issues_014799.json:
```json
{
    "body": "See this [sage-devel discussion](https://groups.google.com/d/msg/sage-devel/Gnw389Bd-0k/bqprN5AxtK8J).\n\nSage has a very nice feature where it tries to not print all entries of a large matrix:\n\n```\nsage: A=matrix(20,20,[2]*400)\nsage: A\n20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)\n```\nBut, as you see, Sage has to do some magic to know that `A` refers to the matrix in question. Indeed, in other situations it won't find a useful name:\n\n```\nsage: B=A\nsage: A\n20 x 20 dense matrix over Integer Ring (type 'print obj.str()' to see all of the entries)\n```\nThe process of finding a name consists of trawling through all \"globals\" dictionaries on the call stack. This is an incredibly expensive operation which also breaks python's programming model: reverse lookups of bindings are not part of the language specification.\n\nThe main concern here is that string representations may not actually make it to an output stream: they may be part of a (perhaps poorly constructed) exception message that gets caught. Fixing the exception message may not be an option, since some of these happen internally in python. TO illustrate the dramatic effect, consider:\n\n```\nsage: def t(depth,N,n):\n....:         if depth:\n....:                 return t(depth-1,N,n)\n....:         else:\n....:                 G = matrix([[2 for u in range(N)] for v in range(N)])\n....:                 for i in range(n):\n....:                         _=repr(G)\n```\nTrying it with a flat call stack is already showing that the repr of a 20x20 matrix is much more expensive to produce than for a 19x19 matrix (a factor 80):\n\n```             \nsage: timeit('t(0,19,10)')\n125 loops, best of 3: 2.14 ms per loop\nsage: timeit('t(0,20,10)')\n5 loops, best of 3: 172 ms per loop\n```\nWith a deep call stack this gets even more pronounced:\n\n```\nsage: sage: timeit('t(100,19,10)') \n125 loops, best of 3: 2.22 ms per loop\nsage: timeit('t(100,20,10)') \n5 loops, best of 3: 5.45 s per loop\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/15036\n\n",
    "created_at": "2013-08-11T20:26:57Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Speed up matrix repr for matrices larger than 20",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14799",
    "user": "https://github.com/nbruin"
}
```
See this [sage-devel discussion](https://groups.google.com/d/msg/sage-devel/Gnw389Bd-0k/bqprN5AxtK8J).

Sage has a very nice feature where it tries to not print all entries of a large matrix:

```
sage: A=matrix(20,20,[2]*400)
sage: A
20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)
```
But, as you see, Sage has to do some magic to know that `A` refers to the matrix in question. Indeed, in other situations it won't find a useful name:

```
sage: B=A
sage: A
20 x 20 dense matrix over Integer Ring (type 'print obj.str()' to see all of the entries)
```
The process of finding a name consists of trawling through all "globals" dictionaries on the call stack. This is an incredibly expensive operation which also breaks python's programming model: reverse lookups of bindings are not part of the language specification.

The main concern here is that string representations may not actually make it to an output stream: they may be part of a (perhaps poorly constructed) exception message that gets caught. Fixing the exception message may not be an option, since some of these happen internally in python. TO illustrate the dramatic effect, consider:

```
sage: def t(depth,N,n):
....:         if depth:
....:                 return t(depth-1,N,n)
....:         else:
....:                 G = matrix([[2 for u in range(N)] for v in range(N)])
....:                 for i in range(n):
....:                         _=repr(G)
```
Trying it with a flat call stack is already showing that the repr of a 20x20 matrix is much more expensive to produce than for a 19x19 matrix (a factor 80):

```             
sage: timeit('t(0,19,10)')
125 loops, best of 3: 2.14 ms per loop
sage: timeit('t(0,20,10)')
5 loops, best of 3: 172 ms per loop
```
With a deep call stack this gets even more pronounced:

```
sage: sage: timeit('t(100,19,10)') 
125 loops, best of 3: 2.22 ms per loop
sage: timeit('t(100,20,10)') 
5 loops, best of 3: 5.45 s per loop
```


Issue created by migration from https://trac.sagemath.org/ticket/15036





---

archive/issue_comments_188470.json:
```json
{
    "body": "Attachment [15036-matrix_repr_fix.patch](tarball://root/attachments/some-uuid/ticket15036/15036-matrix_repr_fix.patch) by @nbruin created at 2013-08-11 20:39:01\n\nMake matrix repr for large matrices not trawl the call stack",
    "created_at": "2013-08-11T20:39:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188470",
    "user": "https://github.com/nbruin"
}
```

Attachment [15036-matrix_repr_fix.patch](tarball://root/attachments/some-uuid/ticket15036/15036-matrix_repr_fix.patch) by @nbruin created at 2013-08-11 20:39:01

Make matrix repr for large matrices not trawl the call stack



---

archive/issue_comments_188471.json:
```json
{
    "body": "Straightforward patch attached. Probably needs some doctest fixes.",
    "created_at": "2013-08-11T20:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188471",
    "user": "https://github.com/nbruin"
}
```

Straightforward patch attached. Probably needs some doctest fixes.



---

archive/issue_comments_188472.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-08-11T20:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188472",
    "user": "https://github.com/nbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_188473.json:
```json
{
    "body": "```\nsage -t devel/sage/sage/schemes/elliptic_curves/heegner.py  # 2 doctests failed\nsage -t devel/sage/sage/matrix/matrix2.pyx  # 1 doctest failed\nsage -t devel/sage/sage/misc/sageinspect.py  # 2 doctests failed\nsage -t devel/sage/sage/modular/modsym/ambient.py  # 3 doctests failed\nsage -t devel/sage/sage/matrix/constructor.py  # 1 doctest failed\nsage -t devel/sage/sage/rings/polynomial/multi_polynomial_sequence.py  # 1 doctest failed\nsage -t devel/sage/sage/matrix/matrix_mod2e_dense.pyx  # 1 doctest failed\nsage -t devel/sage/sage/rings/number_field/number_field_ideal.py  # 1 doctest failed\nsage -t devel/sage/sage/matrix/matrix_mod2_dense.pyx  # 1 doctest failed\nsage -t devel/sage/sage/modular/hecke/hecke_operator.py  # 1 doctest failed\nsage -t devel/sage/sage/algebras/steenrod/steenrod_algebra_bases.py  # 2 doctests failed\nsage -t devel/sage/sage/matrix/matrix0.pyx  # 5 doctests failed\nsage -t devel/sage/sage/homology/chain_complex.py  # 1 doctest failed\nsage -t devel/sage/sage/modules/free_module_morphism.py  # 1 doctest failed\nsage -t devel/sage/sage/modular/modsym/relation_matrix.py  # 3 doctests failed\nsage -t devel/sage/sage/modular/hecke/degenmap.py  # 1 doctest failed\n```\nMost of the doctest failures outside of `matrix0.pyx` are of the form\n\n```\nExpected:\n    Vector space of degree 20 and dimension 20 over Rational Field\n    Basis matrix:\n    20 x 20 dense matrix over Rational Field\nGot:\n    Vector space of degree 20 and dimension 20 over Rational Field\n    Basis matrix:\n    20 x 20 dense matrix over Rational Field (type '<matrix>.str()' to see all of the entries)\n```\nwhich suggests that not including a message about `.str()` may be more appropriate.\n\n**A wild thought:** If people feel saying something about `.str()` is really necessary for output printed by the IPython REPL or notebook output, perhaps we should put in a hook on those to do a name lookup in `globals` there. In that case, we'd still get\n\n```\nsage: A = <large matrix>\nsage: A\n* x * matrix over * (type 'print A.str()' to see all entries)\n```\nbut this would happen because TOP LEVEL recognizes it's printing a string representation that may not fully reflect the value. Certainly, TOP LEVEL looking in globals() wouldn't be so bad, AND it wouldn't need to look in stack frames to find what globals dictionary is appropriate.",
    "created_at": "2013-08-11T22:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188473",
    "user": "https://github.com/nbruin"
}
```

```
sage -t devel/sage/sage/schemes/elliptic_curves/heegner.py  # 2 doctests failed
sage -t devel/sage/sage/matrix/matrix2.pyx  # 1 doctest failed
sage -t devel/sage/sage/misc/sageinspect.py  # 2 doctests failed
sage -t devel/sage/sage/modular/modsym/ambient.py  # 3 doctests failed
sage -t devel/sage/sage/matrix/constructor.py  # 1 doctest failed
sage -t devel/sage/sage/rings/polynomial/multi_polynomial_sequence.py  # 1 doctest failed
sage -t devel/sage/sage/matrix/matrix_mod2e_dense.pyx  # 1 doctest failed
sage -t devel/sage/sage/rings/number_field/number_field_ideal.py  # 1 doctest failed
sage -t devel/sage/sage/matrix/matrix_mod2_dense.pyx  # 1 doctest failed
sage -t devel/sage/sage/modular/hecke/hecke_operator.py  # 1 doctest failed
sage -t devel/sage/sage/algebras/steenrod/steenrod_algebra_bases.py  # 2 doctests failed
sage -t devel/sage/sage/matrix/matrix0.pyx  # 5 doctests failed
sage -t devel/sage/sage/homology/chain_complex.py  # 1 doctest failed
sage -t devel/sage/sage/modules/free_module_morphism.py  # 1 doctest failed
sage -t devel/sage/sage/modular/modsym/relation_matrix.py  # 3 doctests failed
sage -t devel/sage/sage/modular/hecke/degenmap.py  # 1 doctest failed
```
Most of the doctest failures outside of `matrix0.pyx` are of the form

```
Expected:
    Vector space of degree 20 and dimension 20 over Rational Field
    Basis matrix:
    20 x 20 dense matrix over Rational Field
Got:
    Vector space of degree 20 and dimension 20 over Rational Field
    Basis matrix:
    20 x 20 dense matrix over Rational Field (type '<matrix>.str()' to see all of the entries)
```
which suggests that not including a message about `.str()` may be more appropriate.

**A wild thought:** If people feel saying something about `.str()` is really necessary for output printed by the IPython REPL or notebook output, perhaps we should put in a hook on those to do a name lookup in `globals` there. In that case, we'd still get

```
sage: A = <large matrix>
sage: A
* x * matrix over * (type 'print A.str()' to see all entries)
```
but this would happen because TOP LEVEL recognizes it's printing a string representation that may not fully reflect the value. Certainly, TOP LEVEL looking in globals() wouldn't be so bad, AND it wouldn't need to look in stack frames to find what globals dictionary is appropriate.



---

archive/issue_comments_188474.json:
```json
{
    "body": "Second attachment regains interactive printing. With the notebook fix suggested on #14469, this should work in the notebook as well.",
    "created_at": "2013-08-11T23:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188474",
    "user": "https://github.com/nbruin"
}
```

Second attachment regains interactive printing. With the notebook fix suggested on #14469, this should work in the notebook as well.



---

archive/issue_comments_188475.json:
```json
{
    "body": "patchbot apply 15036-display_hook_fix.patch\n\nPersonally, I wouldn't mind the original patch either. This new patch does stay a little closer to the original output, though.",
    "created_at": "2013-08-11T23:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188475",
    "user": "https://github.com/nbruin"
}
```

patchbot apply 15036-display_hook_fix.patch

Personally, I wouldn't mind the original patch either. This new patch does stay a little closer to the original output, though.



---

archive/issue_comments_188476.json:
```json
{
    "body": "Only a few doctests to amend with the new patch:\n\n```\nsage -t devel/sage/sage/matrix/matrix_mod2e_dense.pyx  # 1 doctest failed\nsage -t devel/sage/sage/matrix/matrix0.pyx  # 3 doctests failed\n```\nIf people are OK with the proposed fix, I'll upload a patch fixing the doctests.",
    "created_at": "2013-08-11T23:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188476",
    "user": "https://github.com/nbruin"
}
```

Only a few doctests to amend with the new patch:

```
sage -t devel/sage/sage/matrix/matrix_mod2e_dense.pyx  # 1 doctest failed
sage -t devel/sage/sage/matrix/matrix0.pyx  # 3 doctests failed
```
If people are OK with the proposed fix, I'll upload a patch fixing the doctests.



---

archive/issue_comments_188477.json:
```json
{
    "body": "My 2 cents.\n\n1. I like that large matrices do not get printed entirely without being requested explicitly.\n2. Even with a helpful message, I see students who wonder why they do not get the whole matrix.  So I would rather not see the bare output\n\n```\n20 x 20 dense matrix over Rational Field\n```\n3.  I think it is less important to see the actual name of the matrix parroted in the output (the source of the inefficiency here).  So something like the following would be sufficient in my eyes, if it was easier to code/maintain:\n\n```\n20 x 20 dense matrix over Rational Field (use the '.str()' method to see all of the entries)\n```\n\nThanks for cleaning this up.\n\nRob",
    "created_at": "2013-08-12T17:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188477",
    "user": "https://github.com/rbeezer"
}
```

My 2 cents.

1. I like that large matrices do not get printed entirely without being requested explicitly.
2. Even with a helpful message, I see students who wonder why they do not get the whole matrix.  So I would rather not see the bare output

```
20 x 20 dense matrix over Rational Field
```
3.  I think it is less important to see the actual name of the matrix parroted in the output (the source of the inefficiency here).  So something like the following would be sufficient in my eyes, if it was easier to code/maintain:

```
20 x 20 dense matrix over Rational Field (use the '.str()' method to see all of the entries)
```

Thanks for cleaning this up.

Rob



---

archive/issue_comments_188478.json:
```json
{
    "body": "Thanks for the feedback.\n\n**UNPATCHED BEHAVIOUR:**\n\n```\nsage: L=[matrix(20,20,[2]*400)]\nsage: L\n[20 x 20 dense matrix over Integer Ring]\nsage: A=L[0]\nsage: L\n[20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)]\nsage: B=L[0]\nsage: L\n[20 x 20 dense matrix over Integer Ring (type 'print obj.str()' to see all of the entries)]\n```\nwhere you can see:\n- No printing tip if no direct binding is found\n- Printing of an explicit name if a unique direct binding is found\n- Printing of a generic `obj` name designator if more than one direct binding was found.\n\nThis all with an excessively verbose:\n\n```\nsage: L=[matrix(20,20,[2]*400)]*10\nsage: A=L[0]\nsage: L\n[20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),\n 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)]\n```\n\n**WITH THE PATCH:**\n\n```\nsage: L=[matrix(20,20,[2]*400)]\nsage: L\n[20 x 20 dense matrix over Integer Ring]\nsage: A=L[0]\nsage: print A\n20 x 20 dense matrix over Integer Ring\nsage: A\n20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)\nsage: L\n[20 x 20 dense matrix over Integer Ring]\nsage: L[0]\n20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)\nsage: B=L[0]\nsage: L\n[20 x 20 dense matrix over Integer Ring]\nsage: L[0]\n20 x 20 dense matrix over Integer Ring (type 'print obj.str()' to see all of the entries)\n```\n\nThus:\n- If the value returned is not a matrix itself (but for instance, a list with matrices in it), no tip is printed. I think that's appropriate.\n- Since the print hook of the interface is the routine that appends the message, a straight print statement never included the tip either\n- If the value itself is a matrix then the tip is included according to the rules that applied before.\n\nI think this is preferable to the old behaviour because\n- we're losing the inefficiency in most string productions\n- the tip is often annoying in list printing. That matrices are abbreviated in a list environment is understandable, I think. People will naturally try to look at the matrix itself if they are interested in the value.\n- we're still getting the tip in most cases where it's likely to be useful.\n\nWe can implement Beezer's static suggestion in the displayhook, which will be more efficient (although that is not so important) and more appropriate. In that case we would get:\n\n```\nsage: L=[matrix(20,20,[2]*400)]\nsage: L\n[20 x 20 dense matrix over Integer Ring]\nsage: L[0]\n20 x 20 dense matrix over Integer Ring (use the '.str()' method to see the entries)\nsage: A=L[0]\nsage: L[0]\n20 x 20 dense matrix over Integer Ring (use the '.str()' method to see the entries)\nsage: print L[0]\n20 x 20 dense matrix over Integer Ring\n```\n\nI think this is the best solution, because:\n- It provides a useful tip consistently in a minimal case: when a matrix value is returned that gets printed in abbreviated form.\n- It provides a tip that's always correct, regardless of what bindings exist (and indeed, what bindings exist is immaterial for the problem that the user is facing)\n- We won't be digging around in the globals or the call stack without explicitly being asked to do so.\n\nSo should we go for that then?\n\nIncidentally, I think `.str()` is an awful name for this method. The fact that `str(M)` and `M.str()` do similar but different things is a horrible trap. Also, `.str` and `.__str__` are too similar to both exist but be different. I don't have a direct alternative in mind, nor the inclination to follow through on the horrible deprecation process that would be required to remove this wart, though.",
    "created_at": "2013-08-12T18:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188478",
    "user": "https://github.com/nbruin"
}
```

Thanks for the feedback.

**UNPATCHED BEHAVIOUR:**

```
sage: L=[matrix(20,20,[2]*400)]
sage: L
[20 x 20 dense matrix over Integer Ring]
sage: A=L[0]
sage: L
[20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)]
sage: B=L[0]
sage: L
[20 x 20 dense matrix over Integer Ring (type 'print obj.str()' to see all of the entries)]
```
where you can see:
- No printing tip if no direct binding is found
- Printing of an explicit name if a unique direct binding is found
- Printing of a generic `obj` name designator if more than one direct binding was found.

This all with an excessively verbose:

```
sage: L=[matrix(20,20,[2]*400)]*10
sage: A=L[0]
sage: L
[20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries),
 20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)]
```

**WITH THE PATCH:**

```
sage: L=[matrix(20,20,[2]*400)]
sage: L
[20 x 20 dense matrix over Integer Ring]
sage: A=L[0]
sage: print A
20 x 20 dense matrix over Integer Ring
sage: A
20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)
sage: L
[20 x 20 dense matrix over Integer Ring]
sage: L[0]
20 x 20 dense matrix over Integer Ring (type 'print A.str()' to see all of the entries)
sage: B=L[0]
sage: L
[20 x 20 dense matrix over Integer Ring]
sage: L[0]
20 x 20 dense matrix over Integer Ring (type 'print obj.str()' to see all of the entries)
```

Thus:
- If the value returned is not a matrix itself (but for instance, a list with matrices in it), no tip is printed. I think that's appropriate.
- Since the print hook of the interface is the routine that appends the message, a straight print statement never included the tip either
- If the value itself is a matrix then the tip is included according to the rules that applied before.

I think this is preferable to the old behaviour because
- we're losing the inefficiency in most string productions
- the tip is often annoying in list printing. That matrices are abbreviated in a list environment is understandable, I think. People will naturally try to look at the matrix itself if they are interested in the value.
- we're still getting the tip in most cases where it's likely to be useful.

We can implement Beezer's static suggestion in the displayhook, which will be more efficient (although that is not so important) and more appropriate. In that case we would get:

```
sage: L=[matrix(20,20,[2]*400)]
sage: L
[20 x 20 dense matrix over Integer Ring]
sage: L[0]
20 x 20 dense matrix over Integer Ring (use the '.str()' method to see the entries)
sage: A=L[0]
sage: L[0]
20 x 20 dense matrix over Integer Ring (use the '.str()' method to see the entries)
sage: print L[0]
20 x 20 dense matrix over Integer Ring
```

I think this is the best solution, because:
- It provides a useful tip consistently in a minimal case: when a matrix value is returned that gets printed in abbreviated form.
- It provides a tip that's always correct, regardless of what bindings exist (and indeed, what bindings exist is immaterial for the problem that the user is facing)
- We won't be digging around in the globals or the call stack without explicitly being asked to do so.

So should we go for that then?

Incidentally, I think `.str()` is an awful name for this method. The fact that `str(M)` and `M.str()` do similar but different things is a horrible trap. Also, `.str` and `.__str__` are too similar to both exist but be different. I don't have a direct alternative in mind, nor the inclination to follow through on the horrible deprecation process that would be required to remove this wart, though.



---

archive/issue_comments_188479.json:
```json
{
    "body": "Replying to [comment:8 nbruin]:\n> So should we go for that then?\n\n\nThanks for the very careful examples.  I had not dug that deep.\n\nI agree 100% with 100% of what you said, including the `str()` function/method mess.  I will mostly be very glad to see the \"obj.\" go away from the tip.  Thanks again for wrestling with this one.\n\nRob",
    "created_at": "2013-08-13T03:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188479",
    "user": "https://github.com/rbeezer"
}
```

Replying to [comment:8 nbruin]:
> So should we go for that then?


Thanks for the very careful examples.  I had not dug that deep.

I agree 100% with 100% of what you said, including the `str()` function/method mess.  I will mostly be very glad to see the "obj." go away from the tip.  Thanks again for wrestling with this one.

Rob



---

archive/issue_comments_188480.json:
```json
{
    "body": "Basic repr and a static message added in displayhook; doctest fixes.",
    "created_at": "2013-08-13T07:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188480",
    "user": "https://github.com/nbruin"
}
```

Basic repr and a static message added in displayhook; doctest fixes.



---

archive/issue_comments_188481.json:
```json
{
    "body": "Attachment [15036-display_hook_fix.patch](tarball://root/attachments/some-uuid/ticket15036/15036-display_hook_fix.patch) by @nbruin created at 2013-08-13 07:30:53\n\npatchbot apply 15036-display_hook_fix.patch",
    "created_at": "2013-08-13T07:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188481",
    "user": "https://github.com/nbruin"
}
```

Attachment [15036-display_hook_fix.patch](tarball://root/attachments/some-uuid/ticket15036/15036-display_hook_fix.patch) by @nbruin created at 2013-08-13 07:30:53

patchbot apply 15036-display_hook_fix.patch



---

archive/issue_comments_188482.json:
```json
{
    "body": "one doctest is failing",
    "created_at": "2013-08-20T17:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188482",
    "user": "https://github.com/fchapoton"
}
```

one doctest is failing



---

archive/issue_comments_188483.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-08-20T17:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188483",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_043220.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14799#event-43220"
}
```



---

archive/issue_comments_188484.json:
```json
{
    "body": "I've moved it to a git branch, rebased, and fixed the failing doctest.\n\n---\nNew commits:",
    "created_at": "2014-02-05T00:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188484",
    "user": "https://github.com/tscrim"
}
```

I've moved it to a git branch, rebased, and fixed the failing doctest.

---
New commits:



---

archive/issue_comments_188485.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-02-05T00:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188485",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_188486.json:
```json
{
    "body": "If someone could check my changes, then it's a positive review.",
    "created_at": "2014-02-06T01:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188486",
    "user": "https://github.com/tscrim"
}
```

If someone could check my changes, then it's a positive review.



---

archive/issue_comments_188487.json:
```json
{
    "body": "> If someone could check my changes, then it's a positive review.\n\n\nThis change looks safe `:-P`\n\nNathann",
    "created_at": "2014-02-06T16:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188487",
    "user": "https://github.com/nathanncohen"
}
```

> If someone could check my changes, then it's a positive review.


This change looks safe `:-P`

Nathann



---

archive/issue_comments_188488.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-02-06T16:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188488",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_188489.json:
```json
{
    "body": "I liked the unedited comment. `:p` Thanks.",
    "created_at": "2014-02-06T17:34:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188489",
    "user": "https://github.com/tscrim"
}
```

I liked the unedited comment. `:p` Thanks.



---

archive/issue_comments_188490.json:
```json
{
    "body": "You didn't actually move the \"find variable name\" to the displayhook. Instead you just removed that functionality. Which I don't really mind, but then there is no reason to modify the displayhook. Just put it all into `_repr_`.",
    "created_at": "2014-02-08T14:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188490",
    "user": "https://github.com/vbraun"
}
```

You didn't actually move the "find variable name" to the displayhook. Instead you just removed that functionality. Which I don't really mind, but then there is no reason to modify the displayhook. Just put it all into `_repr_`.



---

archive/issue_comments_188491.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-02-08T14:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188491",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_188492.json:
```json
{
    "body": "Replying to [comment:17 vbraun]:\n> You didn't actually move the \"find variable name\" to the displayhook. Instead you just removed that functionality. Which I don't really mind, but then there is no reason to modify the displayhook. Just put it all into `_repr_`.\n\n\nThere is. This was carefully argued, see comment [comment:8]. I'll repeat the (slightly modified) example here for your convenience:\n\n```\nsage: L=[matrix(20,20,[2]*400) for i in range(3)]\nsage: L\n[20 x 20 dense matrix over Integer Ring,\n20 x 20 dense matrix over Integer Ring,\n20 x 20 dense matrix over Integer Ring]\n```\nIt's annoying and not useful to include the '.str()' message with each of these.\n\nThe rest of the examples gives an idea of the balance that is struck by handling the message in displayhook, which Rob and I decided on as the most desirable behaviour.\n\n```\nsage: L[0]\n20 x 20 dense matrix over Integer Ring (use the '.str()' method to see the entries)\nsage: A=L[0]\nsage: L[0]\n20 x 20 dense matrix over Integer Ring (use the '.str()' method to see the entries)\nsage: print L[0]\n20 x 20 dense matrix over Integer Ring\n```\n\nSetting back to \"needs review\"--Volker, would you set it back to positive if this satisfies your concern? If you want the annoying message all the time, go for it, but you'll be changing a LOT more doctests. This behaviour turned out to be much closer to what we already had.",
    "created_at": "2014-02-08T16:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188492",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:17 vbraun]:
> You didn't actually move the "find variable name" to the displayhook. Instead you just removed that functionality. Which I don't really mind, but then there is no reason to modify the displayhook. Just put it all into `_repr_`.


There is. This was carefully argued, see comment [comment:8]. I'll repeat the (slightly modified) example here for your convenience:

```
sage: L=[matrix(20,20,[2]*400) for i in range(3)]
sage: L
[20 x 20 dense matrix over Integer Ring,
20 x 20 dense matrix over Integer Ring,
20 x 20 dense matrix over Integer Ring]
```
It's annoying and not useful to include the '.str()' message with each of these.

The rest of the examples gives an idea of the balance that is struck by handling the message in displayhook, which Rob and I decided on as the most desirable behaviour.

```
sage: L[0]
20 x 20 dense matrix over Integer Ring (use the '.str()' method to see the entries)
sage: A=L[0]
sage: L[0]
20 x 20 dense matrix over Integer Ring (use the '.str()' method to see the entries)
sage: print L[0]
20 x 20 dense matrix over Integer Ring
```

Setting back to "needs review"--Volker, would you set it back to positive if this satisfies your concern? If you want the annoying message all the time, go for it, but you'll be changing a LOT more doctests. This behaviour turned out to be much closer to what we already had.



---

archive/issue_comments_188493.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-02-08T16:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188493",
    "user": "https://github.com/nbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_188494.json:
```json
{
    "body": "Fine, but I still think its fugly to hardcode part of the matrix output into the displayhook. If you want to achieve that, how about introducing a special method `_repr_help()`, say, whose output will be appended in the displayhook if that object is the top-level output. That would give us an extensible mechanism and keep the declaration of the representation in the matrix module.",
    "created_at": "2014-02-08T16:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188494",
    "user": "https://github.com/vbraun"
}
```

Fine, but I still think its fugly to hardcode part of the matrix output into the displayhook. If you want to achieve that, how about introducing a special method `_repr_help()`, say, whose output will be appended in the displayhook if that object is the top-level output. That would give us an extensible mechanism and keep the declaration of the representation in the matrix module.



---

archive/issue_comments_188495.json:
```json
{
    "body": "Replying to [comment:19 vbraun]:\n> Fine, but I still think its fugly to hardcode part of the matrix output into the displayhook. If you want to achieve that, how about introducing a special method `_repr_help()`, say, whose output will be appended in the displayhook if that object is the top-level output. That would give us an extensible mechanism and keep the declaration of the representation in the matrix module. \n\n\nI agree that refactoring is worth doing if we have more cases (and will be easy). Currently, the only objects this would appy to would be matrices and lists, and we can't reach into lists to implement the protocol there. For now we'd be designing and implementing a protocol to use *once*.\n\n(Conceptually, it is `DisplayHook` that should provide the hint: the object is simply giving a compact representation. It's not its task to provide help. The top-level interface is the right place to decide to provide help. Once we have more than one object requiring this, it starts making sense to implement this by letting the `DisplayHook` ask the object for a \"more helpful\" string representation.)",
    "created_at": "2014-02-08T17:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188495",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:19 vbraun]:
> Fine, but I still think its fugly to hardcode part of the matrix output into the displayhook. If you want to achieve that, how about introducing a special method `_repr_help()`, say, whose output will be appended in the displayhook if that object is the top-level output. That would give us an extensible mechanism and keep the declaration of the representation in the matrix module. 


I agree that refactoring is worth doing if we have more cases (and will be easy). Currently, the only objects this would appy to would be matrices and lists, and we can't reach into lists to implement the protocol there. For now we'd be designing and implementing a protocol to use *once*.

(Conceptually, it is `DisplayHook` that should provide the hint: the object is simply giving a compact representation. It's not its task to provide help. The top-level interface is the right place to decide to provide help. Once we have more than one object requiring this, it starts making sense to implement this by letting the `DisplayHook` ask the object for a "more helpful" string representation.)



---

archive/issue_comments_188496.json:
```json
{
    "body": "I think you should remove the line\n\n```\nfrom sage.misc.sageinspect import sage_getvariablename\n```\nfrom the `__repr__` method in `matrix0.pyx`.",
    "created_at": "2014-02-08T17:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188496",
    "user": "https://github.com/jhpalmieri"
}
```

I think you should remove the line

```
from sage.misc.sageinspect import sage_getvariablename
```
from the `__repr__` method in `matrix0.pyx`.



---

archive/issue_comments_188497.json:
```json
{
    "body": "Replying to [comment:21 jhpalmieri]:\n> I think you should remove the [import]\n\nGood point. Done.\n\n---\nNew commits:",
    "created_at": "2014-02-08T20:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188497",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:21 jhpalmieri]:
> I think you should remove the [import]

Good point. Done.

---
New commits:



---

archive/issue_comments_188498.json:
```json
{
    "body": "This was on the verge of getting a positive review a while ago. Any progress?",
    "created_at": "2014-04-22T21:42:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188498",
    "user": "https://github.com/jhpalmieri"
}
```

This was on the verge of getting a positive review a while ago. Any progress?



---

archive/issue_events_043221.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14799#event-43221"
}
```



---

archive/issue_events_043222.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14799#event-43222"
}
```



---

archive/issue_comments_188499.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-11T15:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188499",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_188500.json:
```json
{
    "body": "With 6.3base0 (tested only `matrix/`):\n\n```\nsage -t src/sage/matrix/matrix_mod2e_dense.pyx  # 1 doctest failed\nsage -t src/sage/matrix/constructor.py  # 1 doctest failed\nsage -t src/sage/matrix/matrix_mod2_dense.pyx  # 1 doctest failed\nsage -t src/sage/matrix/matrix0.pyx  # 4 doctests failed\n```",
    "created_at": "2014-05-11T15:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188500",
    "user": "https://github.com/rwst"
}
```

With 6.3base0 (tested only `matrix/`):

```
sage -t src/sage/matrix/matrix_mod2e_dense.pyx  # 1 doctest failed
sage -t src/sage/matrix/constructor.py  # 1 doctest failed
sage -t src/sage/matrix/matrix_mod2_dense.pyx  # 1 doctest failed
sage -t src/sage/matrix/matrix0.pyx  # 4 doctests failed
```



---

archive/issue_comments_188501.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-05-12T04:39:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188501",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_188502.json:
```json
{
    "body": "Replying to [comment:26 rws]:\n> With 6.3base0 (tested only `matrix/`):\n> \n> ```\n> sage -t src/sage/matrix/matrix_mod2e_dense.pyx  # 1 doctest failed\n> sage -t src/sage/matrix/constructor.py  # 1 doctest failed\n> sage -t src/sage/matrix/matrix_mod2_dense.pyx  # 1 doctest failed\n> sage -t src/sage/matrix/matrix0.pyx  # 4 doctests failed\n> ```\n\nI did not experience those doctest failures, but I did experience some other problems. Hopefully newly rebased branch is OK. If not, please go at it, because fixing this merge is beyond me if this doesn't do the trick.",
    "created_at": "2014-05-12T04:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188502",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:26 rws]:
> With 6.3base0 (tested only `matrix/`):
> 
> ```
> sage -t src/sage/matrix/matrix_mod2e_dense.pyx  # 1 doctest failed
> sage -t src/sage/matrix/constructor.py  # 1 doctest failed
> sage -t src/sage/matrix/matrix_mod2_dense.pyx  # 1 doctest failed
> sage -t src/sage/matrix/matrix0.pyx  # 4 doctests failed
> ```

I did not experience those doctest failures, but I did experience some other problems. Hopefully newly rebased branch is OK. If not, please go at it, because fixing this merge is beyond me if this doesn't do the trick.



---

archive/issue_comments_188503.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-05-12T04:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188503",
    "user": "https://github.com/nbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_188504.json:
```json
{
    "body": "(new broken doctest in combinat/designs/latin_squares.py `^^;`)",
    "created_at": "2014-05-12T09:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188504",
    "user": "https://github.com/nathanncohen"
}
```

(new broken doctest in combinat/designs/latin_squares.py `^^;`)



---

archive/issue_comments_188505.json:
```json
{
    "body": "I've fixed the broken doctests that I found (`matrix_space.py` and the `combinat/designs/latin_squares.py`). If someone could double-check, I think it's positive review.\n\n---\nNew commits:",
    "created_at": "2014-05-12T15:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188505",
    "user": "https://github.com/tscrim"
}
```

I've fixed the broken doctests that I found (`matrix_space.py` and the `combinat/designs/latin_squares.py`). If someone could double-check, I think it's positive review.

---
New commits:



---

archive/issue_comments_188506.json:
```json
{
    "body": "Replying to [comment:30 tscrim]:\n> I've fixed the broken doctests that I found (`matrix_space.py` and the `combinat/designs/latin_squares.py`). If someone could double-check, I think it's positive review.\n\nI don't think you based your branch on the branch from comment [comment:27]. I had to move the\n\n```\nfrom sage.matrix.matrix import is_Matrix\n```\nto inside `simple_format_obj` because otherwise Sage won't start for me: the IPython crash report has a long traceback, showing that somewhere along the line, that import statement fails because the name `ZZ` isn't available (yet).\n\nThis problem only arises with interactive use (and I guess in doctests that test sage via an expect interface and hence running with IPython). It would be surprising, but not impossible, if you're not experiencing this problem (in which case import resolutions aren't deterministic), but the fact that the problematic situation can arise means we need to fix it. The relevant (two line) change is at the bottom of [http://git.sagemath.org/sage.git/commit/?id=d41816c57ede520353ed24ea9534c1219137d295](http://git.sagemath.org/sage.git/commit/?id=d41816c57ede520353ed24ea9534c1219137d295).",
    "created_at": "2014-05-12T16:42:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188506",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:30 tscrim]:
> I've fixed the broken doctests that I found (`matrix_space.py` and the `combinat/designs/latin_squares.py`). If someone could double-check, I think it's positive review.

I don't think you based your branch on the branch from comment [comment:27]. I had to move the

```
from sage.matrix.matrix import is_Matrix
```
to inside `simple_format_obj` because otherwise Sage won't start for me: the IPython crash report has a long traceback, showing that somewhere along the line, that import statement fails because the name `ZZ` isn't available (yet).

This problem only arises with interactive use (and I guess in doctests that test sage via an expect interface and hence running with IPython). It would be surprising, but not impossible, if you're not experiencing this problem (in which case import resolutions aren't deterministic), but the fact that the problematic situation can arise means we need to fix it. The relevant (two line) change is at the bottom of [http://git.sagemath.org/sage.git/commit/?id=d41816c57ede520353ed24ea9534c1219137d295](http://git.sagemath.org/sage.git/commit/?id=d41816c57ede520353ed24ea9534c1219137d295).



---

archive/issue_comments_188507.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-12T21:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188507",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_188508.json:
```json
{
    "body": "Hopefully this provides a more elegant approach to importing the `is_Matrix` symbol at just the right time.",
    "created_at": "2014-05-12T21:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188508",
    "user": "https://github.com/nbruin"
}
```

Hopefully this provides a more elegant approach to importing the `is_Matrix` symbol at just the right time.



---

archive/issue_comments_188509.json:
```json
{
    "body": "I had pulled the current branch that was on trac, but perhaps my merge of `develop` overwrote that...strange... Does this not work with `lazy_import`?",
    "created_at": "2014-05-12T21:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188509",
    "user": "https://github.com/tscrim"
}
```

I had pulled the current branch that was on trac, but perhaps my merge of `develop` overwrote that...strange... Does this not work with `lazy_import`?



---

archive/issue_comments_188510.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-12T22:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188510",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_188511.json:
```json
{
    "body": "Replying to [comment:34 tscrim]:\n> Does this not work with `lazy_import`?\n\nGood point. That's probably an easier solution (at least to write and understand) And it resolves completely on the first execution.",
    "created_at": "2014-05-12T22:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188511",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:34 tscrim]:
> Does this not work with `lazy_import`?

Good point. That's probably an easier solution (at least to write and understand) And it resolves completely on the first execution.



---

archive/issue_comments_188512.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-05-12T22:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188512",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_188513.json:
```json
{
    "body": "LGTM. Thanks Nils.",
    "created_at": "2014-05-12T22:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188513",
    "user": "https://github.com/tscrim"
}
```

LGTM. Thanks Nils.



---

archive/issue_comments_188514.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-05-13T08:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14799#issuecomment-188514",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_043223.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-13T08:42:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14799",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14799#event-43223"
}
```
