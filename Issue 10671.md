# Issue 10671: Improve matrix_modn_sparse methods for converting to dense and taking submatrices

archive/issues_010671.json:
```json
{
    "body": "Assignee: was\n\nHere I'll post some improvements that are needed for #10733 but are of independent interest.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10734\n\n",
    "created_at": "2011-02-03T01:26:40Z",
    "labels": [
        "linear algebra",
        "major",
        "enhancement"
    ],
    "title": "Improve matrix_modn_sparse methods for converting to dense and taking submatrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10671",
    "user": "tornaria"
}
```
Assignee: was

Here I'll post some improvements that are needed for #10733 but are of independent interest.

Issue created by migration from https://trac.sagemath.org/ticket/10734





---

archive/issue_comments_112119.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-02-05T23:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112119",
    "user": "tornaria"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_112120.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-03-21T19:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112120",
    "user": "was"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_112121.json:
```json
{
    "body": "This ticket introduces a bunch of new functions, but doesn't include any documentation or doctests for them.",
    "created_at": "2011-03-21T19:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112121",
    "user": "was"
}
```

This ticket introduces a bunch of new functions, but doesn't include any documentation or doctests for them.



---

archive/issue_comments_112122.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-03-24T03:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112122",
    "user": "tornaria"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_112123.json:
```json
{
    "body": "The new patch adds documentation to all the functions created in the first patch.",
    "created_at": "2011-03-24T03:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112123",
    "user": "tornaria"
}
```

The new patch adds documentation to all the functions created in the first patch.



---

archive/issue_comments_112124.json:
```json
{
    "body": "Great!",
    "created_at": "2011-03-25T01:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112124",
    "user": "was"
}
```

Great!



---

archive/issue_comments_112125.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-03-25T01:55:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112125",
    "user": "was"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_112126.json:
```json
{
    "body": "Patches should be created using `hg export tip` and not `hg diff` or any other method.  Also make sure you have a file `$HOME/.hgrc` as explained in the developer's manual.",
    "created_at": "2011-04-12T09:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112126",
    "user": "jdemeyer"
}
```

Patches should be created using `hg export tip` and not `hg diff` or any other method.  Also make sure you have a file `$HOME/.hgrc` as explained in the developer's manual.



---

archive/issue_comments_112127.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-04-12T09:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112127",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_112128.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> Patches should be created using `hg export tip` and not `hg diff` or any other method.  Also make sure you have a file `$HOME/.hgrc` as explained in the developer's manual.\n\nIs it just this\n\n```\n# User Gonzalo Tornaria <tornaria@cmat.edu.uy>\n```\n\nwhat the patches are missing?\n\nThis is a misfeature of mercurial (queues), because it doesn't set the user by default in the patches. Very silly.\n\nDo you need me to reupload all the patches again, or can you just use\n\n```\n-u \"Gonzalo Tornaria <tornaria@cmat.edu.uy>\"\n```\n\nas an option when you run hg import? Reuploading 7 files to trac gets boring (is there an easier way to a batch upload to trac? from the command line?).\n\n[as a general comment; I'd prefer if the requirements are stated in terms of what the patches need to include, rather than dictating how one must use mercurial --\nI find mercurial inconvenient to use without using queues, because the history cannot be rewritten and I don't know how to effectively use branches -- I've been spoiled by git, I guess]",
    "created_at": "2011-04-14T04:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112128",
    "user": "tornaria"
}
```

Replying to [comment:6 jdemeyer]:
> Patches should be created using `hg export tip` and not `hg diff` or any other method.  Also make sure you have a file `$HOME/.hgrc` as explained in the developer's manual.

Is it just this

```
# User Gonzalo Tornaria <tornaria@cmat.edu.uy>
```

what the patches are missing?

This is a misfeature of mercurial (queues), because it doesn't set the user by default in the patches. Very silly.

Do you need me to reupload all the patches again, or can you just use

```
-u "Gonzalo Tornaria <tornaria@cmat.edu.uy>"
```

as an option when you run hg import? Reuploading 7 files to trac gets boring (is there an easier way to a batch upload to trac? from the command line?).

[as a general comment; I'd prefer if the requirements are stated in terms of what the patches need to include, rather than dictating how one must use mercurial --
I find mercurial inconvenient to use without using queues, because the history cannot be rewritten and I don't know how to effectively use branches -- I've been spoiled by git, I guess]



---

archive/issue_comments_112129.json:
```json
{
    "body": "Attachment\n\nFor matrix_modn_sparse: implement optimized versions of submatrix(), dense_matrix(), add methods dense_submatrix() and set_block_unsafe()",
    "created_at": "2011-06-13T18:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112129",
    "user": "tornaria"
}
```

Attachment

For matrix_modn_sparse: implement optimized versions of submatrix(), dense_matrix(), add methods dense_submatrix() and set_block_unsafe()



---

archive/issue_comments_112130.json:
```json
{
    "body": "Add documentation for the functions added in #10734",
    "created_at": "2011-06-13T18:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112130",
    "user": "tornaria"
}
```

Add documentation for the functions added in #10734



---

archive/issue_comments_112131.json:
```json
{
    "body": "Attachment\n\nrefactor code to support p=2 case (part 1)",
    "created_at": "2011-06-13T18:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112131",
    "user": "tornaria"
}
```

Attachment

refactor code to support p=2 case (part 1)



---

archive/issue_comments_112132.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-13T18:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112132",
    "user": "tornaria"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_112133.json:
```json
{
    "body": "I've reuploaded the two patches (hopefully) with the right format (username and date).\n\nAlso, I moved part of the referee patch in #10733 here, otherwise some doctests would fail until that ticket is merged.\n\nThere's no new code at all, so I assume the positive review is still valid.",
    "created_at": "2011-06-13T18:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112133",
    "user": "tornaria"
}
```

I've reuploaded the two patches (hopefully) with the right format (username and date).

Also, I moved part of the referee patch in #10733 here, otherwise some doctests would fail until that ticket is merged.

There's no new code at all, so I assume the positive review is still valid.



---

archive/issue_comments_112134.json:
```json
{
    "body": "apply trac_10734.dense_matrix_and_submatrix, trac_10734.02-documentation, trac_10734.03-referee_refactor_to_support_p2.patch",
    "created_at": "2011-06-15T12:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112134",
    "user": "tornaria"
}
```

apply trac_10734.dense_matrix_and_submatrix, trac_10734.02-documentation, trac_10734.03-referee_refactor_to_support_p2.patch



---

archive/issue_comments_112135.json:
```json
{
    "body": "Maybe you should add .patch at the end of the names of your patches. Otherwise they are not recognised as such, it seems.",
    "created_at": "2011-09-30T20:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112135",
    "user": "chapoton"
}
```

Maybe you should add .patch at the end of the names of your patches. Otherwise they are not recognised as such, it seems.



---

archive/issue_comments_112136.json:
```json
{
    "body": "Apply only this patch. Patch against 5.0.beta7",
    "created_at": "2012-03-12T16:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112136",
    "user": "davidloeffler"
}
```

Apply only this patch. Patch against 5.0.beta7



---

archive/issue_comments_112137.json:
```json
{
    "body": "Attachment\n\nI qfolded Gonzalo's patches into a single patch, and made sure it has \".patch\" at the end of its name, as Frederic suggests. But with this (or, equivalently, Gonzalo's original three patches) installed I get some doctest failures in sage/matrix/matrix_modn_sparse -- any ideas what's causing that?",
    "created_at": "2012-03-12T16:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112137",
    "user": "davidloeffler"
}
```

Attachment

I qfolded Gonzalo's patches into a single patch, and made sure it has ".patch" at the end of its name, as Frederic suggests. But with this (or, equivalently, Gonzalo's original three patches) installed I get some doctest failures in sage/matrix/matrix_modn_sparse -- any ideas what's causing that?



---

archive/issue_comments_112138.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-12T17:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112138",
    "user": "davidloeffler"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_112139.json:
```json
{
    "body": "Looks like the patchbot is getting the same failures, under both 4.8 and 5.0.beta7. I'm afraid that's \"needs work\", then. Here's an example of the kind of error that's coming up:\n\n```\nsage -t  -force_lib devel/sage-10734/sage/matrix/matrix_modn_sparse.pyx\n**********************************************************************\nFile \"/Users/patchbot/sage-4.8/devel/sage-10734/sage/matrix/matrix_modn_sparse.pyx\", line 635:\n    sage: A.dense_submatrix(24,24,3,3)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/patchbot/sage-4.8/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/patchbot/sage-4.8/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/patchbot/sage-4.8/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_10[4]>\", line 1, in <module>\n        A.dense_submatrix(Integer(24),Integer(24),Integer(3),Integer(3))###line 635:\n    sage: A.dense_submatrix(24,24,3,3)\n      File \"matrix_modn_sparse.pyx\", line 655, in sage.matrix.matrix_modn_sparse.Matrix_modn_sparse.dense_submatrix (sage/matrix/matrix_modn_sparse.c:11628)\n        M = self.new_matrix(nrows, ncols, sparse=False)\n    TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod_dense.Matrix_mod_dense\n**********************************************************************\n```\n",
    "created_at": "2012-03-12T17:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112139",
    "user": "davidloeffler"
}
```

Looks like the patchbot is getting the same failures, under both 4.8 and 5.0.beta7. I'm afraid that's "needs work", then. Here's an example of the kind of error that's coming up:

```
sage -t  -force_lib devel/sage-10734/sage/matrix/matrix_modn_sparse.pyx
**********************************************************************
File "/Users/patchbot/sage-4.8/devel/sage-10734/sage/matrix/matrix_modn_sparse.pyx", line 635:
    sage: A.dense_submatrix(24,24,3,3)
Exception raised:
    Traceback (most recent call last):
      File "/Users/patchbot/sage-4.8/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/patchbot/sage-4.8/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/patchbot/sage-4.8/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_10[4]>", line 1, in <module>
        A.dense_submatrix(Integer(24),Integer(24),Integer(3),Integer(3))###line 635:
    sage: A.dense_submatrix(24,24,3,3)
      File "matrix_modn_sparse.pyx", line 655, in sage.matrix.matrix_modn_sparse.Matrix_modn_sparse.dense_submatrix (sage/matrix/matrix_modn_sparse.c:11628)
        M = self.new_matrix(nrows, ncols, sparse=False)
    TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod_dense.Matrix_mod_dense
**********************************************************************
```




---

archive/issue_comments_112140.json:
```json
{
    "body": "Git branch and also has the fixes for the sparse conversion by making the `matrix_modn_dense_template` inherit from `matrix_mod_dense`\n----\nNew commits:",
    "created_at": "2014-09-14T23:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112140",
    "user": "tscrim"
}
```

Git branch and also has the fixes for the sparse conversion by making the `matrix_modn_dense_template` inherit from `matrix_mod_dense`
----
New commits:



---

archive/issue_comments_112141.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-14T23:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112141",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_112142.json:
```json
{
    "body": "needs rebase",
    "created_at": "2014-09-28T20:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112142",
    "user": "chapoton"
}
```

needs rebase



---

archive/issue_comments_112143.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-28T20:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112143",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_112144.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-07T03:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112144",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_112145.json:
```json
{
    "body": "Rebased to `6.4.rc1`.",
    "created_at": "2014-11-07T03:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112145",
    "user": "tscrim"
}
```

Rebased to `6.4.rc1`.



---

archive/issue_comments_112146.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-11-07T03:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112146",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_112147.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-01-25T17:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112147",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_112148.json:
```json
{
    "body": "Hello,\n\nWhat is the purpose of introducing the class `Matrix_mod_dense`?\n\nVincent",
    "created_at": "2015-01-25T17:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112148",
    "user": "vdelecroix"
}
```

Hello,

What is the purpose of introducing the class `Matrix_mod_dense`?

Vincent



---

archive/issue_comments_112149.json:
```json
{
    "body": "Ticket #17837 proposes to remove `matrix_modn_dense` (it is unused since a long time and much slower than `matrix_modn_dense_float` or `matrix_modn_dense_double` using LinBox). Is there anybody working on this ticket that can say something about it? Otherwise I will put #17837 in positive review (and consequently this one in needs work).\n\nVincent",
    "created_at": "2015-02-23T22:44:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112149",
    "user": "vdelecroix"
}
```

Ticket #17837 proposes to remove `matrix_modn_dense` (it is unused since a long time and much slower than `matrix_modn_dense_float` or `matrix_modn_dense_double` using LinBox). Is there anybody working on this ticket that can say something about it? Otherwise I will put #17837 in positive review (and consequently this one in needs work).

Vincent



---

archive/issue_comments_112150.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2015-02-24T16:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10671#issuecomment-112150",
    "user": "jdemeyer"
}
```

Changing status from needs_info to needs_work.
