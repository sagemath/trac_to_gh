# Issue 10671: Improve matrix_modn_sparse methods for converting to dense and taking submatrices

Issue created by migration from https://trac.sagemath.org/ticket/10734

Original creator: tornaria

Original creation time: 2011-02-03 01:26:40

Assignee: was

Here I'll post some improvements that are needed for #10733 but are of independent interest.


---

Comment by tornaria created at 2011-02-05 23:02:12

Changing status from new to needs_review.


---

Comment by was created at 2011-03-21 19:15:50

Changing status from needs_review to needs_work.


---

Comment by was created at 2011-03-21 19:15:50

This ticket introduces a bunch of new functions, but doesn't include any documentation or doctests for them.


---

Comment by tornaria created at 2011-03-24 03:00:17

Changing status from needs_work to needs_review.


---

Comment by tornaria created at 2011-03-24 03:00:17

The new patch adds documentation to all the functions created in the first patch.


---

Comment by was created at 2011-03-25 01:55:07

Great!


---

Comment by was created at 2011-03-25 01:55:07

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-04-12 09:23:52

Patches should be created using `hg export tip` and not `hg diff` or any other method.  Also make sure you have a file `$HOME/.hgrc` as explained in the developer's manual.


---

Comment by jdemeyer created at 2011-04-12 09:23:52

Changing status from positive_review to needs_work.


---

Comment by tornaria created at 2011-04-14 04:24:01

Replying to [comment:6 jdemeyer]:
> Patches should be created using `hg export tip` and not `hg diff` or any other method.  Also make sure you have a file `$HOME/.hgrc` as explained in the developer's manual.

Is it just this

```
# User Gonzalo Tornaria <tornaria@cmat.edu.uy>
```

what the patches are missing?

This is a misfeature of mercurial (queues), because it doesn't set the user by default in the patches. Very silly.

Do you need me to reupload all the patches again, or can you just use

```
-u "Gonzalo Tornaria <tornaria@cmat.edu.uy>"
```

as an option when you run hg import? Reuploading 7 files to trac gets boring (is there an easier way to a batch upload to trac? from the command line?).

[as a general comment; I'd prefer if the requirements are stated in terms of what the patches need to include, rather than dictating how one must use mercurial --
I find mercurial inconvenient to use without using queues, because the history cannot be rewritten and I don't know how to effectively use branches -- I've been spoiled by git, I guess]


---

Attachment

For matrix_modn_sparse: implement optimized versions of submatrix(), dense_matrix(), add methods dense_submatrix() and set_block_unsafe()


---

Comment by tornaria created at 2011-06-13 18:22:37

Add documentation for the functions added in #10734


---

Attachment

refactor code to support p=2 case (part 1)


---

Comment by tornaria created at 2011-06-13 18:31:46

Changing status from needs_work to needs_review.


---

Comment by tornaria created at 2011-06-13 18:31:46

I've reuploaded the two patches (hopefully) with the right format (username and date).

Also, I moved part of the referee patch in #10733 here, otherwise some doctests would fail until that ticket is merged.

There's no new code at all, so I assume the positive review is still valid.


---

Comment by tornaria created at 2011-06-15 12:53:22

apply trac_10734.dense_matrix_and_submatrix, trac_10734.02-documentation, trac_10734.03-referee_refactor_to_support_p2.patch


---

Comment by chapoton created at 2011-09-30 20:20:23

Maybe you should add .patch at the end of the names of your patches. Otherwise they are not recognised as such, it seems.


---

Comment by davidloeffler created at 2012-03-12 16:49:13

Apply only this patch. Patch against 5.0.beta7


---

Attachment

I qfolded Gonzalo's patches into a single patch, and made sure it has ".patch" at the end of its name, as Frederic suggests. But with this (or, equivalently, Gonzalo's original three patches) installed I get some doctest failures in sage/matrix/matrix_modn_sparse -- any ideas what's causing that?


---

Comment by davidloeffler created at 2012-03-12 17:32:26

Changing status from needs_review to needs_work.


---

Comment by davidloeffler created at 2012-03-12 17:32:26

Looks like the patchbot is getting the same failures, under both 4.8 and 5.0.beta7. I'm afraid that's "needs work", then. Here's an example of the kind of error that's coming up:

```
sage -t  -force_lib devel/sage-10734/sage/matrix/matrix_modn_sparse.pyx
**********************************************************************
File "/Users/patchbot/sage-4.8/devel/sage-10734/sage/matrix/matrix_modn_sparse.pyx", line 635:
    sage: A.dense_submatrix(24,24,3,3)
Exception raised:
    Traceback (most recent call last):
      File "/Users/patchbot/sage-4.8/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/patchbot/sage-4.8/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/patchbot/sage-4.8/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_10[4]>", line 1, in <module>
        A.dense_submatrix(Integer(24),Integer(24),Integer(3),Integer(3))###line 635:
    sage: A.dense_submatrix(24,24,3,3)
      File "matrix_modn_sparse.pyx", line 655, in sage.matrix.matrix_modn_sparse.Matrix_modn_sparse.dense_submatrix (sage/matrix/matrix_modn_sparse.c:11628)
        M = self.new_matrix(nrows, ncols, sparse=False)
    TypeError: Cannot convert sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float to sage.matrix.matrix_mod_dense.Matrix_mod_dense
**********************************************************************
```



---

Comment by tscrim created at 2014-09-14 23:40:30

Git branch and also has the fixes for the sparse conversion by making the `matrix_modn_dense_template` inherit from `matrix_mod_dense`
----
New commits:


---

Comment by tscrim created at 2014-09-14 23:40:30

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2014-09-28 20:07:44

needs rebase


---

Comment by chapoton created at 2014-09-28 20:07:44

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-11-07 03:41:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-11-07 03:41:52

Rebased to `6.4.rc1`.


---

Comment by tscrim created at 2014-11-07 03:41:52

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2015-01-25 17:29:58

Changing status from needs_review to needs_info.


---

Comment by vdelecroix created at 2015-01-25 17:29:58

Hello,

What is the purpose of introducing the class `Matrix_mod_dense`?

Vincent


---

Comment by vdelecroix created at 2015-02-23 22:44:15

Ticket #17837 proposes to remove `matrix_modn_dense` (it is unused since a long time and much slower than `matrix_modn_dense_float` or `matrix_modn_dense_double` using LinBox). Is there anybody working on this ticket that can say something about it? Otherwise I will put #17837 in positive review (and consequently this one in needs work).

Vincent


---

Comment by jdemeyer created at 2015-02-24 16:37:48

Changing status from needs_info to needs_work.
