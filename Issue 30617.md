# Issue 30617: the view command silently does nothing in Jupyter notebooks

Issue created by migration from https://trac.sagemath.org/ticket/30854

Original creator: was

Original creation time: 2020-11-02 21:56:06

CC:  yzh

1. Try typing `view(2/3)` in a Jupyter notebook.  
2. No visible output appears.

I don't think ever worked in Jupyter, but it did in sagenb.  This is one of those things that got forgotten (?) when switching from sagenb to Jupyter.  

Under the hood what happens looks like this:

```
sage: sage.misc.latex.EMBEDDED_MODE = True
sage: view(2/3)
<html><script type="math/tex">\newcommand{\Bold}[1]{\mathbf{#1}}\frac{2}{3}</script></html>
```


I think this <html> thing in the output is something I made up long long ago to signal that the output should be displayed as HTML.  In Jupyter, one instead uses 


```
from IPython.core.display import HTML
HTML(r'<script type="math/tex">\newcommand{\Bold}[1]{\mathbf{#1}}\frac{2}{3}</script>')
```


And the above does properly show a fraction.

So a slightly rewrite of view to work with Jupyter (and probably not with sagenb) is the way to go?


---

Comment by alexjbest created at 2020-11-03 06:31:08

I think #19515 and #26101 are relevant, I've been monkey patching the first one into my notebooks to render tikz diagrams inline, but it seems more is needed for inline math.


---

Comment by yzh created at 2021-02-02 22:55:34

Typing view(2/3) in a Jupyter notebook works fine for me: it opens a pdf file containing the fraction 2/3


---

Comment by alexjbest created at 2021-02-02 23:34:18

I think this current behaviour (though it does make a pdf for me too) is non-optimal, Jupyter has the capacity to render TeX using mathjax in a cell. So rather than spawning TeX to make a pdf, pushing the TeX code to Jupyter to render via mathjax or at least copy the rendered tex to an image to be displayed inline should be the goal of this ticket.


---

Comment by egourgoulhon created at 2021-03-24 20:33:12

Replying to [comment:3 yzh]:
> Typing view(2/3) in a Jupyter notebook works fine for me: it opens a pdf file containing the fraction 2/3

It works for me too with Sage 9.3.rc0: `view(2/3)` generates a pdf file, which is automatically opened by the default pdf viewer of my system (evince). This is with Firefox 86.0.1 on Ubuntu 20.04.


---

Comment by mkoeppe created at 2021-03-24 21:09:49

Changing status from new to needs_info.


---

Comment by mkoeppe created at 2021-03-24 21:09:49

`@`was Sounds like we need more info about the system on which you observed this behavior. Perhaps a broken pdf viewer?


---

Comment by was created at 2021-03-24 21:17:21

> `@`was Sounds like we need more info about the system on which you observed this behavior. Perhaps a broken pdf viewer?

CoCalc.com.  There is no X11 server running at all.   I should maybe amend the title of the ticket to say "the view command silently does nothing in Jupyter notebooks when there is no X11 server"?


---

Comment by was created at 2021-03-24 21:19:45

I would be happy with `view(2/3)` showing an error message rather than silently failing, though I don't know if that's even possible (given the asynchronous nature) of this.   

Anyway, it's possible this is a problem for me to deal with on my end.  E.g., I could patch the view command on cocalc.


---

Comment by alexjbest created at 2021-03-24 21:40:19

#31536 seems related, I would say that if view fails for any reasons mathjax output should be attempted in the notebook isntead of an error.

There are other non-silent failures where this would be useful too: running a binder notebook https://mybinder.org/v2/gh/alexjbest/cluster-pictures/master?filepath=notebooks%2Fdemo.ipynb one sees an error that pdftex is not installed when you try view(2/3).


---

Comment by mkoeppe created at 2021-05-10 17:42:09

Moving to 9.4, as 9.3 has been released.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.
