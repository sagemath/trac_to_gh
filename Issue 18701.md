# Issue 18701: Refactor shortest paths

archive/issues_018701.json:
```json
{
    "body": "CC:  @nathanncohen @dcoudert\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/18938\n\n",
    "created_at": "2015-07-22T13:27:18Z",
    "labels": [
        "component: please change"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Refactor shortest paths",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18701",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```
CC:  @nathanncohen @dcoudert



Issue created by migration from https://trac.sagemath.org/ticket/18938





---

archive/issue_comments_254780.json:
```json
{
    "body": "Attachment [Dependencies.png](tarball://root/attachments/some-uuid/ticket18938/Dependencies.png) by borassi created at 2015-07-22 13:52:57\n\nDependencies between shortest path routines",
    "created_at": "2015-07-22T13:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254780",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Attachment [Dependencies.png](tarball://root/attachments/some-uuid/ticket18938/Dependencies.png) by borassi created at 2015-07-22 13:52:57

Dependencies between shortest path routines



---

archive/issue_comments_254781.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to graph theory.",
    "created_at": "2015-07-22T13:54:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254781",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing component from PLEASE CHANGE to graph theory.



---

archive/issue_comments_254782.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2015-07-22T13:54:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254782",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_254783.json:
```json
{
    "body": "Changing keywords from \"\" to \"Shortest path, eccentricity, Dijkstra\".",
    "created_at": "2015-07-22T13:54:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254783",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing keywords from "" to "Shortest path, eccentricity, Dijkstra".



---

archive/issue_comments_254784.json:
```json
{
    "body": "This is very challenging but definitely useful.",
    "created_at": "2015-07-22T15:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254784",
    "user": "https://github.com/dcoudert"
}
```

This is very challenging but definitely useful.



---

archive/issue_comments_254785.json:
```json
{
    "body": "Hello!\n\nThis patch is clearly not the final version: however, before proceeding, I would like to know if you like how I defined the \"standard\" for shortest path functions. In particular, the new input variables are:\n\n* by_weight: if True, the graph is considered weighted (needed for backward compatibility);\n* algorithm: the algorithm (Dijkstra, BFS, etc);\n* weight_function: the function that provides weights (if None, the label is used).\n\nThe result of weight_function must always be convertible to a float, otherwise exceptions are raised.\n\nYou can see the result of the refactoring of the function shortest_paths, with comments. Any feedback will be appreciated!\n\nBest,\n\nMichele\n\nPS: is it true that Dijkstra is not implemented in Sage, and we rely on NetworkX? In this case, I should also insert Boost Dijkstra for efficiency (but this will be done in a subsequent ticket).\n----\nNew commits:",
    "created_at": "2015-07-22T16:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254785",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Hello!

This patch is clearly not the final version: however, before proceeding, I would like to know if you like how I defined the "standard" for shortest path functions. In particular, the new input variables are:

* by_weight: if True, the graph is considered weighted (needed for backward compatibility);
* algorithm: the algorithm (Dijkstra, BFS, etc);
* weight_function: the function that provides weights (if None, the label is used).

The result of weight_function must always be convertible to a float, otherwise exceptions are raised.

You can see the result of the refactoring of the function shortest_paths, with comments. Any feedback will be appreciated!

Best,

Michele

PS: is it true that Dijkstra is not implemented in Sage, and we rely on NetworkX? In this case, I should also insert Boost Dijkstra for efficiency (but this will be done in a subsequent ticket).
----
New commits:



---

archive/issue_comments_254786.json:
```json
{
    "body": "What's the proposed behavior when `by_weight==False`?\nOtherwise I agree with what you propose.\n\n\n\nThere is a `bidirectional_dijkstra` method in `src/sage/graphs/base/c_graph.pyx`. I don't know if it is used or not...\n\nDavid.",
    "created_at": "2015-07-23T16:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254786",
    "user": "https://github.com/dcoudert"
}
```

What's the proposed behavior when `by_weight==False`?
Otherwise I agree with what you propose.



There is a `bidirectional_dijkstra` method in `src/sage/graphs/base/c_graph.pyx`. I don't know if it is used or not...

David.



---

archive/issue_comments_254787.json:
```json
{
    "body": "Hellooooooooooooooo Michele,\n\nSeveral remarks on your branch:\n\n- ```by_weight`` - if ``True``, the graph is considered weighted.` Could you\n  be more specific by saying that the *edges* are considered to be weighted?\n\n- Documentation of `algorithm`: could you document the default value and its\n  behaviour?\n\n- This sounds like a dangerous behaviour:\n  ```weight_function`` (function) - used only if ``by_weight==True``;`\n  If somebody calls `g.shortest_paths(v,weight_function=my_function)`, we know\n  for sure that (s)he wants the edges to be considered. Why shouldn't we define\n  `by_weight` to `True` when `weight_function is not None`?\n\n- Documentation of `weight_function`: here is an attempt at making the following\n  paragraph a bit shorter.\n  {{{\n  #!diff\n  -a function that inputs an edge ``e`` and outputs its weight. An edge\n  -has the form ``(u,v,l)``, where ``u`` and ``v`` are vertices, ``l`` is\n  -a label (that can be of any kind). The ``weight_function`` can be used\n  -to transform the label into a weight. In particular:\n  +a function that takes a labelled edge `(u,v,l)` as input and returns\n  +its weight. If set to `None` when `by_weight=True`, the label `l` is\n  +used as the edge's weight.\n  }}}\n  The `is_weighted` flag is not used much in Sage, and I believe that it should\n  be removed in the long term:\n  - You never know if it is about edge/vertex weights\n  - Setting a graph to be \"weighted\" does not check anything about the vality of\n    weights\n  - You may want one function to consider the graph as weighted and not another\n    one. Changing an attribute in between is not pratical, and is actually\n    impossible for immutable graphs.\n\n- I do not think necessary to document which exceptions are raised when the\n  input is bad, e.g. conversion to float. Do what you want.\n\n- You add many arguments to this function: they should be tested in the\n  function's doctest.\n\nGood evening,\n\nNathann",
    "created_at": "2015-07-23T18:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254787",
    "user": "https://github.com/nathanncohen"
}
```

Hellooooooooooooooo Michele,

Several remarks on your branch:

- ```by_weight`` - if ``True``, the graph is considered weighted.` Could you
  be more specific by saying that the *edges* are considered to be weighted?

- Documentation of `algorithm`: could you document the default value and its
  behaviour?

- This sounds like a dangerous behaviour:
  ```weight_function`` (function) - used only if ``by_weight==True``;`
  If somebody calls `g.shortest_paths(v,weight_function=my_function)`, we know
  for sure that (s)he wants the edges to be considered. Why shouldn't we define
  `by_weight` to `True` when `weight_function is not None`?

- Documentation of `weight_function`: here is an attempt at making the following
  paragraph a bit shorter.
  {{{
  #!diff
  -a function that inputs an edge ``e`` and outputs its weight. An edge
  -has the form ``(u,v,l)``, where ``u`` and ``v`` are vertices, ``l`` is
  -a label (that can be of any kind). The ``weight_function`` can be used
  -to transform the label into a weight. In particular:
  +a function that takes a labelled edge `(u,v,l)` as input and returns
  +its weight. If set to `None` when `by_weight=True`, the label `l` is
  +used as the edge's weight.
  }}}
  The `is_weighted` flag is not used much in Sage, and I believe that it should
  be removed in the long term:
  - You never know if it is about edge/vertex weights
  - Setting a graph to be "weighted" does not check anything about the vality of
    weights
  - You may want one function to consider the graph as weighted and not another
    one. Changing an attribute in between is not pratical, and is actually
    impossible for immutable graphs.

- I do not think necessary to document which exceptions are raised when the
  input is bad, e.g. conversion to float. Do what you want.

- You add many arguments to this function: they should be tested in the
  function's doctest.

Good evening,

Nathann



---

archive/issue_comments_254788.json:
```json
{
    "body": "> There is a `bidirectional_dijkstra` method in `src/sage/graphs/base/c_graph.pyx`. I don't know if it is used or not...\n\nIt is used in `GenericGraph.shortest_path`.\n\nNathann",
    "created_at": "2015-07-23T18:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254788",
    "user": "https://github.com/nathanncohen"
}
```

> There is a `bidirectional_dijkstra` method in `src/sage/graphs/base/c_graph.pyx`. I don't know if it is used or not...

It is used in `GenericGraph.shortest_path`.

Nathann



---

archive/issue_comments_254789.json:
```json
{
    "body": "Hi!\n\nI tried to address your remarks, and I will upload the new version in a few moments. I have also started working on the other methods: still, the code is not clean, so I think you should only review the methods `shortest_paths` and `check_weight_function` (even if the whole code should be correct, because all tests are passed).\n\nOne question: since most of the arguments are the same for several routines, is there a way to avoid copy-paste in the documentation?\n\nThank you very much! Good evening,\n\nMichele\n\n> What's the proposed behavior when by_weight==False?\n\nAdded to the documentation\n\n> There is a bidirectional_dijkstra method in src/sage/graphs/base/c_graph.pyx.\n\nYes, but there is no \"standard\" Dijkstra... Maybe, if I have time before the end of the project, I will add one.\n\n> - !``by_weight!`` - if !``True!``, the graph is considered weighted. Could you be more specific by saying that the *edges* are considered to be weighted?\n\nDone\n\n> - Documentation of `algorithm`: could you document the default value and its\n> behaviour?\n\nDone\n\n> - This sounds like a dangerous behaviour:\n> ```weight_function`` (function) - used only if ``by_weight==True``;`\n> If somebody calls `g.shortest_paths(v,weight_function=my_function)`, we know\n> for sure that (s)he wants the edges to be considered. Why shouldn't we define\n> `by_weight` to `True` when `weight_function is not None`?\n\nDone\n\n> - Documentation of `weight_function`: here is an attempt at making the following\n> paragraph a bit shorter.\n> {{{\n> #!diff\n> -a function that inputs an edge e and outputs its weight. An edge\n> -has the form (u,v,l), where u and v are vertices, l is\n> -a label (that can be of any kind). The weight_function can be used\n> -to transform the label into a weight. In particular:\n> +a function that takes a labelled edge `(u,v,l)` as input and returns\n> +its weight. If set to `None` when `by_weight=True`, the label `l` is\n> +used as the edge's weight.\n> }}}\n\nI have modified heavily the paragraph, taking inspiration from your proposal.\n\n> The `is_weighted` flag is not used much in Sage, and I believe that it should\n> be removed in the long term:\n> - You never know if it is about edge/vertex weights\n> - Setting a graph to be \"weighted\" does not check anything about the vality of\n> weights\n> - You may want one function to consider the graph as weighted and not another\n> one. Changing an attribute in between is not pratical, and is actually\n> impossible for immutable graphs.\n\nI removed all references to is_weighted: now I just check that the weight function outputs numbers\n\n> - I do not think necessary to document which exceptions are raised when the\n> input is bad, e.g. conversion to float. Do what you want.\n\nDone!\n\n> - You add many arguments to this function: they should be tested in the\n> function's doctest.\n\nAdded some doctests.",
    "created_at": "2015-07-23T20:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254789",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Hi!

I tried to address your remarks, and I will upload the new version in a few moments. I have also started working on the other methods: still, the code is not clean, so I think you should only review the methods `shortest_paths` and `check_weight_function` (even if the whole code should be correct, because all tests are passed).

One question: since most of the arguments are the same for several routines, is there a way to avoid copy-paste in the documentation?

Thank you very much! Good evening,

Michele

> What's the proposed behavior when by_weight==False?

Added to the documentation

> There is a bidirectional_dijkstra method in src/sage/graphs/base/c_graph.pyx.

Yes, but there is no "standard" Dijkstra... Maybe, if I have time before the end of the project, I will add one.

> - !``by_weight!`` - if !``True!``, the graph is considered weighted. Could you be more specific by saying that the *edges* are considered to be weighted?

Done

> - Documentation of `algorithm`: could you document the default value and its
> behaviour?

Done

> - This sounds like a dangerous behaviour:
> ```weight_function`` (function) - used only if ``by_weight==True``;`
> If somebody calls `g.shortest_paths(v,weight_function=my_function)`, we know
> for sure that (s)he wants the edges to be considered. Why shouldn't we define
> `by_weight` to `True` when `weight_function is not None`?

Done

> - Documentation of `weight_function`: here is an attempt at making the following
> paragraph a bit shorter.
> {{{
> #!diff
> -a function that inputs an edge e and outputs its weight. An edge
> -has the form (u,v,l), where u and v are vertices, l is
> -a label (that can be of any kind). The weight_function can be used
> -to transform the label into a weight. In particular:
> +a function that takes a labelled edge `(u,v,l)` as input and returns
> +its weight. If set to `None` when `by_weight=True`, the label `l` is
> +used as the edge's weight.
> }}}

I have modified heavily the paragraph, taking inspiration from your proposal.

> The `is_weighted` flag is not used much in Sage, and I believe that it should
> be removed in the long term:
> - You never know if it is about edge/vertex weights
> - Setting a graph to be "weighted" does not check anything about the vality of
> weights
> - You may want one function to consider the graph as weighted and not another
> one. Changing an attribute in between is not pratical, and is actually
> impossible for immutable graphs.

I removed all references to is_weighted: now I just check that the weight function outputs numbers

> - I do not think necessary to document which exceptions are raised when the
> input is bad, e.g. conversion to float. Do what you want.

Done!

> - You add many arguments to this function: they should be tested in the
> function's doctest.

Added some doctests.



---

archive/issue_comments_254790.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-23T20:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254790",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254791.json:
```json
{
    "body": "Hello,\n\n> I think you should only review the methods `shortest_paths` and `check_weight_function`\n\nThe second function should be a hidden one, i.e. `_check_weight_function`. It is only a checking routine that we need internally. I am always wary of these routines by the way, especially when they apply to linear-time algorithms....\n\nAnyawy. You should probably replace `.edges()` by `.edge_iterator()` in there, for otherwise the first line of the loop is actually as time/space consuming as a full graph copy (even worse actually, as it is pure python stuff).\n\n> One question: since most of the arguments are the same for several routines, is there a way to avoid copy-paste in the documentation?\n\nNo magical way that I know. It's either this or \"see the doc of <X> for more inforamtion\". Or you can have a `**kwds` instead of copy/pasting the arguments in the function's prototype and foward them all to the subcall, saying that \"all arguments of function <X> (see its doc) are accepted\". No magic, really.\n\n- `If ``None`` and ``by_weight`` is ``True``, we output ``l`` by default.` We output 'l'? What about 'we use the edge's label as a weight'?\n\nNathann",
    "created_at": "2015-07-24T09:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254791",
    "user": "https://github.com/nathanncohen"
}
```

Hello,

> I think you should only review the methods `shortest_paths` and `check_weight_function`

The second function should be a hidden one, i.e. `_check_weight_function`. It is only a checking routine that we need internally. I am always wary of these routines by the way, especially when they apply to linear-time algorithms....

Anyawy. You should probably replace `.edges()` by `.edge_iterator()` in there, for otherwise the first line of the loop is actually as time/space consuming as a full graph copy (even worse actually, as it is pure python stuff).

> One question: since most of the arguments are the same for several routines, is there a way to avoid copy-paste in the documentation?

No magical way that I know. It's either this or "see the doc of <X> for more inforamtion". Or you can have a `**kwds` instead of copy/pasting the arguments in the function's prototype and foward them all to the subcall, saying that "all arguments of function <X> (see its doc) are accepted". No magic, really.

- `If ``None`` and ``by_weight`` is ``True``, we output ``l`` by default.` We output 'l'? What about 'we use the edge's label as a weight'?

Nathann



---

archive/issue_comments_254792.json:
```json
{
    "body": "Hello,\n\nIn method `check_weight_function`\n- `Checks that an edge weight function outputs only numbers.` -> `Check that an edge weight function outputs only numbers.`\n- The title of the example `A wrong weight function::` must be changed. The weight function is correct but not the edge label.\n- `for e in self.edges():` -> `for e in self.edge_iterator():` ?\n\nIn method `shortest_paths`\n- `If the weight function is wrong::` same as above\n\n\nAlso I'm wondering if we may have conflicts with tickets #18868 about memory allocation and #18864 on eccentricity\n\nDavid.",
    "created_at": "2015-07-24T09:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254792",
    "user": "https://github.com/dcoudert"
}
```

Hello,

In method `check_weight_function`
- `Checks that an edge weight function outputs only numbers.` -> `Check that an edge weight function outputs only numbers.`
- The title of the example `A wrong weight function::` must be changed. The weight function is correct but not the edge label.
- `for e in self.edges():` -> `for e in self.edge_iterator():` ?

In method `shortest_paths`
- `If the weight function is wrong::` same as above


Also I'm wondering if we may have conflicts with tickets #18868 about memory allocation and #18864 on eccentricity

David.



---

archive/issue_comments_254793.json:
```json
{
    "body": "> Also I'm wondering if we may have conflicts with tickets #18868 about memory allocation and #18864 on eccentricity\n\nThere was. I just fixed it.\n\nNathann",
    "created_at": "2015-07-24T09:40:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254793",
    "user": "https://github.com/nathanncohen"
}
```

> Also I'm wondering if we may have conflicts with tickets #18868 about memory allocation and #18864 on eccentricity

There was. I just fixed it.

Nathann



---

archive/issue_comments_254794.json:
```json
{
    "body": "I'm not sure I understand what you have done...",
    "created_at": "2015-07-24T16:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254794",
    "user": "https://github.com/dcoudert"
}
```

I'm not sure I understand what you have done...



---

archive/issue_comments_254795.json:
```json
{
    "body": "I made #18864 a dependency of #18868. And in #18868 I handled the conflict.",
    "created_at": "2015-07-24T17:18:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254795",
    "user": "https://github.com/nathanncohen"
}
```

I made #18864 a dependency of #18868. And in #18868 I handled the conflict.



---

archive/issue_comments_254796.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-07-27T10:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254796",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_254797.json:
```json
{
    "body": "Helloooooooo!\n\nI have applied all your suggestions, and I have merged this ticket with !#18868 in order to avoid conflicts.\n\nSoon I will modify the other methods, and finally ask for a review!\n\nSee you,\nMichele",
    "created_at": "2015-07-27T10:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254797",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Helloooooooo!

I have applied all your suggestions, and I have merged this ticket with !#18868 in order to avoid conflicts.

Soon I will modify the other methods, and finally ask for a review!

See you,
Michele



---

archive/issue_comments_254798.json:
```json
{
    "body": "great !",
    "created_at": "2015-07-27T18:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254798",
    "user": "https://github.com/dcoudert"
}
```

great !



---

archive/issue_comments_254799.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-28T10:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254799",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254800.json:
```json
{
    "body": "Hello!\n\nI have a problem building the documentation in this branch, and I really have no idea what's going on (I lost the whole morning trying to fix it, with no success). Could you help me, at least by telling me what does the following log mean? The code is in this ticket...\n\n\n```\nError building the documentation.\nTraceback (most recent call last):\n\u00a0 File \"/home/michele/Programmi/sage/src/doc/common/builder.py\", line 1626, in <module>\n\u00a0\u00a0\u00a0 getattr(get_builder(name), type)()\n\u00a0 File \"/home/michele/Programmi/sage/src/doc/common/builder.py\", line 292, in _wrapper\n\u00a0\u00a0\u00a0 getattr(get_builder(document), 'inventory')(*args, **kwds)\n\u00a0 File \"/home/michele/Programmi/sage/src/doc/common/builder.py\", line 503, in _wrapper\n\u00a0\u00a0\u00a0 x.get(99999)\n\u00a0 File \"/home/michele/Programmi/sage/local/lib/python/multiprocessing/pool.py\", line 558, in get\n\u00a0\u00a0\u00a0 raise self._value\nOSError: [graphs\u00a0\u00a0 ] /home/michele/Programmi/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.py:docstring of sage.graphs.generic_graph.graph_isom_equivalent_non_edge_labeled_graph:25: WARNING: Explicit markup ends without a blank line; unexpected unindent.\n\nMakefile:742: recipe for target 'doc-html' failed\nmake[2]: *** [doc-html] Error 1\nmake[2]: Leaving directory '/home/michele/Programmi/sage/build/make'\nMakefile:563: recipe for target 'all' failed\nmake[1]: *** [all] Error 2\nmake[1]: Leaving directory '/home/michele/Programmi/sage/build/make'\n```\n\nThank you very much!\n\nMichele",
    "created_at": "2015-07-28T10:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254800",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Hello!

I have a problem building the documentation in this branch, and I really have no idea what's going on (I lost the whole morning trying to fix it, with no success). Could you help me, at least by telling me what does the following log mean? The code is in this ticket...


```
Error building the documentation.
Traceback (most recent call last):
  File "/home/michele/Programmi/sage/src/doc/common/builder.py", line 1626, in <module>
    getattr(get_builder(name), type)()
  File "/home/michele/Programmi/sage/src/doc/common/builder.py", line 292, in _wrapper
    getattr(get_builder(document), 'inventory')(*args, **kwds)
  File "/home/michele/Programmi/sage/src/doc/common/builder.py", line 503, in _wrapper
    x.get(99999)
  File "/home/michele/Programmi/sage/local/lib/python/multiprocessing/pool.py", line 558, in get
    raise self._value
OSError: [graphs   ] /home/michele/Programmi/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.py:docstring of sage.graphs.generic_graph.graph_isom_equivalent_non_edge_labeled_graph:25: WARNING: Explicit markup ends without a blank line; unexpected unindent.

Makefile:742: recipe for target 'doc-html' failed
make[2]: *** [doc-html] Error 1
make[2]: Leaving directory '/home/michele/Programmi/sage/build/make'
Makefile:563: recipe for target 'all' failed
make[1]: *** [all] Error 2
make[1]: Leaving directory '/home/michele/Programmi/sage/build/make'
```

Thank you very much!

Michele



---

archive/issue_comments_254801.json:
```json
{
    "body": "After performing the following changes, I'm able to compile the doc.\n\n- In `_path_length`, change\n\n```\n       WARNING: if the graph is unweighted, the algorithm does not check that\n       the path exists. Moreover, also if the weight_function does not return a\n       number, an error is raised.\n```\n\nTo\n\n```\n        .. WARNING::\n\n            If the graph is unweighted, the algorithm does not check that the\n            path exists. Moreover, also if the weight_function does not return a\n            number, an error is raised.\n```\n\nThe `WARNING:` should declare a block, so may be you should insert space/blank line (not sure). \n\n- In `wiener_index`, change\n\n```\n       .. [KRG96b] S. Klavzar, A. Rajapakse, and I. Gutman. The Szeged and the\n       Wiener index of graphs. *Applied Mathematics Letters*, 9(5):45--49,\n       1996.\n```\n\nto\n\n```\n       .. [KRG96b] S. Klavzar, A. Rajapakse, and I. Gutman. The Szeged and the\n         Wiener index of graphs. *Applied Mathematics Letters*, 9(5):45--49,\n         1996.\n```\n",
    "created_at": "2015-07-29T12:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254801",
    "user": "https://github.com/dcoudert"
}
```

After performing the following changes, I'm able to compile the doc.

- In `_path_length`, change

```
       WARNING: if the graph is unweighted, the algorithm does not check that
       the path exists. Moreover, also if the weight_function does not return a
       number, an error is raised.
```

To

```
        .. WARNING::

            If the graph is unweighted, the algorithm does not check that the
            path exists. Moreover, also if the weight_function does not return a
            number, an error is raised.
```

The `WARNING:` should declare a block, so may be you should insert space/blank line (not sure). 

- In `wiener_index`, change

```
       .. [KRG96b] S. Klavzar, A. Rajapakse, and I. Gutman. The Szeged and the
       Wiener index of graphs. *Applied Mathematics Letters*, 9(5):45--49,
       1996.
```

to

```
       .. [KRG96b] S. Klavzar, A. Rajapakse, and I. Gutman. The Szeged and the
         Wiener index of graphs. *Applied Mathematics Letters*, 9(5):45--49,
         1996.
```




---

archive/issue_comments_254802.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-29T14:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254802",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254803.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-07-29T14:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254803",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_254804.json:
```json
{
    "body": "Finally, I have a version of the refactoring that might be reviewed. Hope you like it!",
    "created_at": "2015-07-29T14:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254804",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Finally, I have a version of the refactoring that might be reviewed. Hope you like it!



---

archive/issue_comments_254805.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-30T16:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254805",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254806.json:
```json
{
    "body": "Hello,\n\nThe patch passes all long tests, but I have a problem when building the documentation (duplicate citation KRG96b). I don't know which is the best solution. You could eventually point to the other module documentation instead of repeating citation.\n\n```\n[graphs   ] /Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.py:docstring of sage.graphs.generic_graph.GenericGraph.wiener_index:72: WARNING: duplicate citation KRG96b, other instance in /Users/dcoudert/sage/src/doc/en/reference/graphs/sage/graphs/distances_all_pairs.rst\nError building the documentation.\nTraceback (most recent call last):\n  File \"/Users/dcoudert/sage/src/doc/common/builder.py\", line 1626, in <module>\n    getattr(get_builder(name), type)()\n  File \"/Users/dcoudert/sage/src/doc/common/builder.py\", line 292, in _wrapper\n    getattr(get_builder(document), 'inventory')(*args, **kwds)\n  File \"/Users/dcoudert/sage/src/doc/common/builder.py\", line 503, in _wrapper\n    x.get(99999)\n  File \"/Users/dcoudert/sage/local/lib/python/multiprocessing/pool.py\", line 558, in get\n    raise self._value\nOSError: [graphs   ] /Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.py:docstring of sage.graphs.generic_graph.GenericGraph.wiener_index:72: WARNING: duplicate citation KRG96b, other instance in /Users/dcoudert/sage/src/doc/en/reference/graphs/sage/graphs/distances_all_pairs.rst\n\nmake[1]: *** [doc-html] Error 1\n```\n\nDavid.",
    "created_at": "2015-08-04T13:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254806",
    "user": "https://github.com/dcoudert"
}
```

Hello,

The patch passes all long tests, but I have a problem when building the documentation (duplicate citation KRG96b). I don't know which is the best solution. You could eventually point to the other module documentation instead of repeating citation.

```
[graphs   ] /Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.py:docstring of sage.graphs.generic_graph.GenericGraph.wiener_index:72: WARNING: duplicate citation KRG96b, other instance in /Users/dcoudert/sage/src/doc/en/reference/graphs/sage/graphs/distances_all_pairs.rst
Error building the documentation.
Traceback (most recent call last):
  File "/Users/dcoudert/sage/src/doc/common/builder.py", line 1626, in <module>
    getattr(get_builder(name), type)()
  File "/Users/dcoudert/sage/src/doc/common/builder.py", line 292, in _wrapper
    getattr(get_builder(document), 'inventory')(*args, **kwds)
  File "/Users/dcoudert/sage/src/doc/common/builder.py", line 503, in _wrapper
    x.get(99999)
  File "/Users/dcoudert/sage/local/lib/python/multiprocessing/pool.py", line 558, in get
    raise self._value
OSError: [graphs   ] /Users/dcoudert/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.py:docstring of sage.graphs.generic_graph.GenericGraph.wiener_index:72: WARNING: duplicate citation KRG96b, other instance in /Users/dcoudert/sage/src/doc/en/reference/graphs/sage/graphs/distances_all_pairs.rst

make[1]: *** [doc-html] Error 1
```

David.



---

archive/issue_comments_254807.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-04T13:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254807",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_254808.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-05T06:06:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254808",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254809.json:
```json
{
    "body": "I removed the duplicate reference: now the citation refers to the other module.",
    "created_at": "2015-08-05T06:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254809",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

I removed the duplicate reference: now the citation refers to the other module.



---

archive/issue_comments_254810.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-05T06:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254810",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_254811.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-08-05T07:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254811",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_254812.json:
```json
{
    "body": "Hello,\n\nnow the doc build properly and it looks fine.\nFor me this ticket is now good to go.\n\nBest,\nDavid.",
    "created_at": "2015-08-05T07:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254812",
    "user": "https://github.com/dcoudert"
}
```

Hello,

now the doc build properly and it looks fine.
For me this ticket is now good to go.

Best,
David.



---

archive/issue_comments_254813.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-08-05T10:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18701",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18701#issuecomment-254813",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
