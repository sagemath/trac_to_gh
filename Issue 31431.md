# Issue 31431: Run TestSuite on polynomial rings

archive/issues_031431.json:
```json
{
    "body": "CC:  @tscrim @videlec @dkrenn @mwageringel @mezzarobba @yuan-zhou @novoselt @nbruin\n\n#27364 fixes a bug that `_test_construction` should have found -- except `TestSuite` is not called at all for any multivariate polynomial rings. \n\nWe add a bunch of `TestSuite` calls for the rings constructed as examples in `polynomial_ring_constructor`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/31668\n\n",
    "created_at": "2021-04-13T18:17:04Z",
    "labels": [
        "component: commutative algebra",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Run TestSuite on polynomial rings",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31431",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @tscrim @videlec @dkrenn @mwageringel @mezzarobba @yuan-zhou @novoselt @nbruin

#27364 fixes a bug that `_test_construction` should have found -- except `TestSuite` is not called at all for any multivariate polynomial rings. 

We add a bunch of `TestSuite` calls for the rings constructed as examples in `polynomial_ring_constructor`.

Issue created by migration from https://trac.sagemath.org/ticket/31668





---

archive/issue_comments_448965.json:
```json
{
    "body": "```\nsage -t --random-seed=0 src/sage/rings/polynomial/polynomial_ring_constructor.py  # 12 doctests failed\n```\n\n---\nNew commits:",
    "created_at": "2021-04-13T18:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448965",
    "user": "https://github.com/mkoeppe"
}
```

```
sage -t --random-seed=0 src/sage/rings/polynomial/polynomial_ring_constructor.py  # 12 doctests failed
```

---
New commits:



---

archive/issue_comments_448966.json:
```json
{
    "body": "One more test to add here (from #27261): check that multipolynomial substitution works consistently and return objects in the right parent\n\n```\ndef test(base_ring):\n    R = base_ring['x, y']\n    S = base_ring['q, r']\n    x, y = R.gens()\n    q, r = S.gens()\n    polys = [R.zero(), R.one(), x, y, x + y]\n    assert all(p.subs(x=0).parent() is R for p in polys)\n    assert all(p.subs(y=0).parent() is R for p in polys)\n    assert all(p.subs(x=0, y=0).parent() is base_ring for p in polys)\n    assert all(p.subs(x=q, y=r).parent() is S for p in polys)\n```",
    "created_at": "2021-05-19T07:02:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448966",
    "user": "https://github.com/videlec"
}
```

One more test to add here (from #27261): check that multipolynomial substitution works consistently and return objects in the right parent

```
def test(base_ring):
    R = base_ring['x, y']
    S = base_ring['q, r']
    x, y = R.gens()
    q, r = S.gens()
    polys = [R.zero(), R.one(), x, y, x + y]
    assert all(p.subs(x=0).parent() is R for p in polys)
    assert all(p.subs(y=0).parent() is R for p in polys)
    assert all(p.subs(x=0, y=0).parent() is base_ring for p in polys)
    assert all(p.subs(x=q, y=r).parent() is S for p in polys)
```



---

archive/issue_comments_448967.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-05-24T00:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448967",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_448968.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-24T00:48:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448968",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_448969.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-05-24T00:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448969",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_448970.json:
```json
{
    "body": "Replying to [comment:6 vdelecroix]:\n> One more test to add here (from #27261): check that multipolynomial substitution works consistently and return objects in the right parent\n> \n> ```\n> def test(base_ring):\n>     R = base_ring['x, y']\n>     S = base_ring['q, r']\n>     x, y = R.gens()\n>     q, r = S.gens()\n>     polys = [R.zero(), R.one(), x, y, x + y]\n>     assert all(p.subs(x=0).parent() is R for p in polys)\n>     assert all(p.subs(y=0).parent() is R for p in polys)\n>     assert all(p.subs(x=0, y=0).parent() is base_ring for p in polys)\n>     assert all(p.subs(x=q, y=r).parent() is S for p in polys)\n> ```\n\n\nI disagree with this logic - why the parent of the result depends on values used for substitution? If one always wants \"the minimal parent\", then after plugging in `x=0` one can end up in `base_ring[y]`. When the variables and their substitution values are computed in some fashion and then substituted into a bunch of different polynomials it is inconvenient that the result may have different type and so one has to consider multiple cases. I hit it because toric code breaks on certain examples because of this issue.",
    "created_at": "2021-05-24T01:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448970",
    "user": "https://github.com/novoselt"
}
```

Replying to [comment:6 vdelecroix]:
> One more test to add here (from #27261): check that multipolynomial substitution works consistently and return objects in the right parent
> 
> ```
> def test(base_ring):
>     R = base_ring['x, y']
>     S = base_ring['q, r']
>     x, y = R.gens()
>     q, r = S.gens()
>     polys = [R.zero(), R.one(), x, y, x + y]
>     assert all(p.subs(x=0).parent() is R for p in polys)
>     assert all(p.subs(y=0).parent() is R for p in polys)
>     assert all(p.subs(x=0, y=0).parent() is base_ring for p in polys)
>     assert all(p.subs(x=q, y=r).parent() is S for p in polys)
> ```


I disagree with this logic - why the parent of the result depends on values used for substitution? If one always wants "the minimal parent", then after plugging in `x=0` one can end up in `base_ring[y]`. When the variables and their substitution values are computed in some fashion and then substituted into a bunch of different polynomials it is inconvenient that the result may have different type and so one has to consider multiple cases. I hit it because toric code breaks on certain examples because of this issue.



---

archive/issue_comments_448971.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-24T02:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448971",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_448972.json:
```json
{
    "body": "Replying to [comment:12 novoselt]:\n> Replying to [comment:6 vdelecroix]:\n> > {{{\n> > def test(base_ring):\n> >     R = base_ring['x, y']\n> >     S = base_ring['q, r']\n> >     x, y = R.gens()\n> >     q, r = S.gens()\n> >     polys = [R.zero(), R.one(), x, y, x + y]\n> >     assert all(p.subs(x=0).parent() is R for p in polys)\n> >     assert all(p.subs(y=0).parent() is R for p in polys)\n> >     assert all(p.subs(x=0, y=0).parent() is base_ring for p in polys)\n> >     assert all(p.subs(x=q, y=r).parent() is S for p in polys)\n> > }}}\n\n> \n> I disagree with this logic - why the parent of the result depends on values used for substitution? \n\n\nJust a quick comment -- the above only demonstrates that the parent of the result depends on the parents of the substituted values (not the values themselves), and which subset is substituted.",
    "created_at": "2021-05-24T02:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448972",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:12 novoselt]:
> Replying to [comment:6 vdelecroix]:
> > {{{
> > def test(base_ring):
> >     R = base_ring['x, y']
> >     S = base_ring['q, r']
> >     x, y = R.gens()
> >     q, r = S.gens()
> >     polys = [R.zero(), R.one(), x, y, x + y]
> >     assert all(p.subs(x=0).parent() is R for p in polys)
> >     assert all(p.subs(y=0).parent() is R for p in polys)
> >     assert all(p.subs(x=0, y=0).parent() is base_ring for p in polys)
> >     assert all(p.subs(x=q, y=r).parent() is S for p in polys)
> > }}}

> 
> I disagree with this logic - why the parent of the result depends on values used for substitution? 


Just a quick comment -- the above only demonstrates that the parent of the result depends on the parents of the substituted values (not the values themselves), and which subset is substituted.



---

archive/issue_comments_448973.json:
```json
{
    "body": "Replying to [comment:15 mkoeppe]:\n> Replying to [comment:12 novoselt]:\n> > Replying to [comment:6 vdelecroix]:\n> > > {{{\n> > > def test(base_ring):\n> > >     R = base_ring['x, y']\n> > >     S = base_ring['q, r']\n> > >     x, y = R.gens()\n> > >     q, r = S.gens()\n> > >     polys = [R.zero(), R.one(), x, y, x + y]\n> > >     assert all(p.subs(x=0).parent() is R for p in polys)\n> > >     assert all(p.subs(y=0).parent() is R for p in polys)\n> > >     assert all(p.subs(x=0, y=0).parent() is base_ring for p in polys)\n> > >     assert all(p.subs(x=q, y=r).parent() is S for p in polys)\n> > > }}}\n\n> > \n> > I disagree with this logic - why the parent of the result depends on values used for substitution? \n\n> \n> Just a quick comment -- the above only demonstrates that the parent of the result depends on the parents of the substituted values (not the values themselves), and which subset is substituted.\n\n\nAnd more precisely, the rule for substitution is:\n- if the substitution is \"partial\" then the omitted variables are set to themselves\n- for a full substitution, the result of the parent is set to be the common_parent of the base_ring of the polynomial ring and the parents of values to be substituted",
    "created_at": "2021-05-24T06:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448973",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:15 mkoeppe]:
> Replying to [comment:12 novoselt]:
> > Replying to [comment:6 vdelecroix]:
> > > {{{
> > > def test(base_ring):
> > >     R = base_ring['x, y']
> > >     S = base_ring['q, r']
> > >     x, y = R.gens()
> > >     q, r = S.gens()
> > >     polys = [R.zero(), R.one(), x, y, x + y]
> > >     assert all(p.subs(x=0).parent() is R for p in polys)
> > >     assert all(p.subs(y=0).parent() is R for p in polys)
> > >     assert all(p.subs(x=0, y=0).parent() is base_ring for p in polys)
> > >     assert all(p.subs(x=q, y=r).parent() is S for p in polys)
> > > }}}

> > 
> > I disagree with this logic - why the parent of the result depends on values used for substitution? 

> 
> Just a quick comment -- the above only demonstrates that the parent of the result depends on the parents of the substituted values (not the values themselves), and which subset is substituted.


And more precisely, the rule for substitution is:
- if the substitution is "partial" then the omitted variables are set to themselves
- for a full substitution, the result of the parent is set to be the common_parent of the base_ring of the polynomial ring and the parents of values to be substituted



---

archive/issue_comments_448974.json:
```json
{
    "body": "Note that the parents of substituted polynomials should be fixed in #27261. We can either set it as a dependency of this ticket or I can split this part from #27261 into an independent ticket.",
    "created_at": "2021-05-24T06:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448974",
    "user": "https://github.com/videlec"
}
```

Note that the parents of substituted polynomials should be fixed in #27261. We can either set it as a dependency of this ticket or I can split this part from #27261 into an independent ticket.



---

archive/issue_comments_448975.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-24T06:46:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448975",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_448976.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-05-24T06:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448976",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_448977.json:
```json
{
    "body": "Replying to [comment:17 vdelecroix]:\n> Note that the parents of substituted polynomials should be fixed in #27261. We can either set it as a dependency of this ticket or I can split this part from #27261 into an independent ticket.\n\n\nI have prepared the present ticket for inclusion by disabling the failing tests.\n\nReady for review",
    "created_at": "2021-05-24T06:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448977",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:17 vdelecroix]:
> Note that the parents of substituted polynomials should be fixed in #27261. We can either set it as a dependency of this ticket or I can split this part from #27261 into an independent ticket.


I have prepared the present ticket for inclusion by disabling the failing tests.

Ready for review



---

archive/issue_comments_448978.json:
```json
{
    "body": "Why something that specific is needed in `rings/polynomial/polynomial_ring.py`?\n\n```\ndef construction(self):\n    ...\n    implementation = None\n    if 'NTL' in self._implementation_repr:\n        implementation = 'NTL'\n    ...\n```\n\nOn multi-variate polynomials with a single variable this test should fail\n\n```\n            # substituting one variable (in a polynomial ring with variables) with 0\n            d = {str(gens[0]): 0}\n            tester.assertEqual(self.subs(**d).parent(), self.parent())\n```",
    "created_at": "2021-05-24T07:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448978",
    "user": "https://github.com/videlec"
}
```

Why something that specific is needed in `rings/polynomial/polynomial_ring.py`?

```
def construction(self):
    ...
    implementation = None
    if 'NTL' in self._implementation_repr:
        implementation = 'NTL'
    ...
```

On multi-variate polynomials with a single variable this test should fail

```
            # substituting one variable (in a polynomial ring with variables) with 0
            d = {str(gens[0]): 0}
            tester.assertEqual(self.subs(**d).parent(), self.parent())
```



---

archive/issue_comments_448979.json:
```json
{
    "body": "Replying to [comment:21 vdelecroix]:\n> Why something that specific is needed in `rings/polynomial/polynomial_ring.py`?\n> \n> ```\n> def construction(self):\n>     ...\n>     implementation = None\n>     if 'NTL' in self._implementation_repr:\n>         implementation = 'NTL'\n>     ...\n> ```\n\n\nThis is obviously not a complete solution. The parents don't keep track in a clean way what the implementation is. I have some other experimental code that tries to decode the element class, but it's all not very satisfying.",
    "created_at": "2021-05-24T07:06:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448979",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:21 vdelecroix]:
> Why something that specific is needed in `rings/polynomial/polynomial_ring.py`?
> 
> ```
> def construction(self):
>     ...
>     implementation = None
>     if 'NTL' in self._implementation_repr:
>         implementation = 'NTL'
>     ...
> ```


This is obviously not a complete solution. The parents don't keep track in a clean way what the implementation is. I have some other experimental code that tries to decode the element class, but it's all not very satisfying.



---

archive/issue_comments_448980.json:
```json
{
    "body": "Replying to [comment:23 mkoeppe]:\n> Replying to [comment:21 vdelecroix]:\n> > Why something that specific is needed in `rings/polynomial/polynomial_ring.py`?\n> > \n> > ```\n> > def construction(self):\n> >     ...\n> >     implementation = None\n> >     if 'NTL' in self._implementation_repr:\n> >         implementation = 'NTL'\n> >     ...\n> > ```\n\n> \n> This is obviously not a complete solution. The parents don't keep track in a clean way what the implementation is. I have some other experimental code that tries to decode the element class, but it's all not very satisfying.\n\n\nCertainly not optimal, but something similar is implemented for `MatrixSpace` (from `matrix/matrix_class.py`) via `_has_default_implementation`.",
    "created_at": "2021-05-24T07:10:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448980",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:23 mkoeppe]:
> Replying to [comment:21 vdelecroix]:
> > Why something that specific is needed in `rings/polynomial/polynomial_ring.py`?
> > 
> > ```
> > def construction(self):
> >     ...
> >     implementation = None
> >     if 'NTL' in self._implementation_repr:
> >         implementation = 'NTL'
> >     ...
> > ```

> 
> This is obviously not a complete solution. The parents don't keep track in a clean way what the implementation is. I have some other experimental code that tries to decode the element class, but it's all not very satisfying.


Certainly not optimal, but something similar is implemented for `MatrixSpace` (from `matrix/matrix_class.py`) via `_has_default_implementation`.



---

archive/issue_comments_448981.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-24T07:12:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448981",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_448982.json:
```json
{
    "body": "Replying to [comment:24 vdelecroix]:\n> Certainly not optimal, but something similar is implemented for `MatrixSpace` (from `matrix/matrix_class.py`) via `_has_default_implementation`.\n\n\nThanks for the pointer. \n\nPerhaps something for a follow-up ticket?",
    "created_at": "2021-05-24T07:15:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448982",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:24 vdelecroix]:
> Certainly not optimal, but something similar is implemented for `MatrixSpace` (from `matrix/matrix_class.py`) via `_has_default_implementation`.


Thanks for the pointer. 

Perhaps something for a follow-up ticket?



---

archive/issue_comments_448983.json:
```json
{
    "body": "Replying to [comment:26 mkoeppe]:\n> Replying to [comment:24 vdelecroix]:\n> > Certainly not optimal, but something similar is implemented for `MatrixSpace` (from `matrix/matrix_class.py`) via `_has_default_implementation`.\n\n> \n> Thanks for the pointer. \n> \n> Perhaps something for a follow-up ticket?\n\n\nDefinitely: this is #31852. I was not convinced by the solution I used for `MatrixClass`. I secretly hoped that you had some alternative.",
    "created_at": "2021-05-24T07:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448983",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:26 mkoeppe]:
> Replying to [comment:24 vdelecroix]:
> > Certainly not optimal, but something similar is implemented for `MatrixSpace` (from `matrix/matrix_class.py`) via `_has_default_implementation`.

> 
> Thanks for the pointer. 
> 
> Perhaps something for a follow-up ticket?


Definitely: this is #31852. I was not convinced by the solution I used for `MatrixClass`. I secretly hoped that you had some alternative.



---

archive/issue_comments_448984.json:
```json
{
    "body": "Also, the test suite does not catch invalid substitution such as\n\n```\nsage: QQ['x,y'].gen(0).subs(x=QQ['t'].gen())  # not intended to work\nt\n```",
    "created_at": "2021-05-24T07:33:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448984",
    "user": "https://github.com/videlec"
}
```

Also, the test suite does not catch invalid substitution such as

```
sage: QQ['x,y'].gen(0).subs(x=QQ['t'].gen())  # not intended to work
t
```



---

archive/issue_comments_448985.json:
```json
{
    "body": "Replying to [comment:16 vdelecroix]:\n> Replying to [comment:15 mkoeppe]:\n> > Replying to [comment:12 novoselt]:\n> > > I disagree with this logic - why the parent of the result depends on values used for substitution? \n\n> > \n> > Just a quick comment -- the above only demonstrates that the parent of the result depends on the parents of the substituted values (not the values themselves), and which subset is substituted.\n\n> \n> And more precisely, the rule for substitution is:\n> - if the substitution is \"partial\" then the omitted variables are set to themselves\n> - for a full substitution, the result of the parent is set to be the common_parent of the base_ring of the polynomial ring and the parents of values to be substituted\n\n\nWhat is \"partial\"? How about this one:\n\n```\nsage: R.<x, y> = QQ[]\nsage: parent(x.subs(x=1))\nMultivariate Polynomial Ring in x, y over Rational Field\nsage: R.<x, y> = QQ[\"a, b\"][]\nsage: parent(x.subs(x=1))\nMultivariate Polynomial Ring in a, b over Rational Field\n```\nI also think that it makes sense to have the same results here\n\n```\nsage; R.<x, y> = QQ[\"a, b\"][]\nsage: p = x + y\nsage: parent(p.subs(x=1, y=2))\nMultivariate Polynomial Ring in a, b over Rational Field\nsage: parent(p.subs(x=1).subs(y=2))\nMultivariate Polynomial Ring in x, y over Multivariate Polynomial Ring in a, b over Rational Field\n```",
    "created_at": "2021-05-24T14:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448985",
    "user": "https://github.com/novoselt"
}
```

Replying to [comment:16 vdelecroix]:
> Replying to [comment:15 mkoeppe]:
> > Replying to [comment:12 novoselt]:
> > > I disagree with this logic - why the parent of the result depends on values used for substitution? 

> > 
> > Just a quick comment -- the above only demonstrates that the parent of the result depends on the parents of the substituted values (not the values themselves), and which subset is substituted.

> 
> And more precisely, the rule for substitution is:
> - if the substitution is "partial" then the omitted variables are set to themselves
> - for a full substitution, the result of the parent is set to be the common_parent of the base_ring of the polynomial ring and the parents of values to be substituted


What is "partial"? How about this one:

```
sage: R.<x, y> = QQ[]
sage: parent(x.subs(x=1))
Multivariate Polynomial Ring in x, y over Rational Field
sage: R.<x, y> = QQ["a, b"][]
sage: parent(x.subs(x=1))
Multivariate Polynomial Ring in a, b over Rational Field
```
I also think that it makes sense to have the same results here

```
sage; R.<x, y> = QQ["a, b"][]
sage: p = x + y
sage: parent(p.subs(x=1, y=2))
Multivariate Polynomial Ring in a, b over Rational Field
sage: parent(p.subs(x=1).subs(y=2))
Multivariate Polynomial Ring in x, y over Multivariate Polynomial Ring in a, b over Rational Field
```



---

archive/issue_comments_448986.json:
```json
{
    "body": "Replying to [comment:29 novoselt]:\n> Replying to [comment:16 vdelecroix]:\n> > Replying to [comment:15 mkoeppe]:\n> > > Replying to [comment:12 novoselt]:\n> > > > I disagree with this logic - why the parent of the result depends on values used for substitution? \n\n> > > \n> > > Just a quick comment -- the above only demonstrates that the parent of the result depends on the parents of the substituted values (not the values themselves), and which subset is substituted.\n\n> > \n> > And more precisely, the rule for substitution is:\n> > - if the substitution is \"partial\" then the omitted variables are set to themselves\n> > - for a full substitution, the result of the parent is set to be the common_parent of the base_ring of the polynomial ring and the parents of values to be substituted\n \n> \n> What is \"partial\"?\n\n\nPartial is when you do not substitute all variables. On `QQ[x,y]` if you only specify the value of `x`, let say `x=1` then `y` is set to `y`. In other words `p.subs(x=1)` is equivalent to `p(1, y)`. All the examples you wrote are perfectly valid and will be supported in the same way. The only example that is wrong and I want to disable is in [comment:28 comment:28].",
    "created_at": "2021-05-24T17:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448986",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:29 novoselt]:
> Replying to [comment:16 vdelecroix]:
> > Replying to [comment:15 mkoeppe]:
> > > Replying to [comment:12 novoselt]:
> > > > I disagree with this logic - why the parent of the result depends on values used for substitution? 

> > > 
> > > Just a quick comment -- the above only demonstrates that the parent of the result depends on the parents of the substituted values (not the values themselves), and which subset is substituted.

> > 
> > And more precisely, the rule for substitution is:
> > - if the substitution is "partial" then the omitted variables are set to themselves
> > - for a full substitution, the result of the parent is set to be the common_parent of the base_ring of the polynomial ring and the parents of values to be substituted
 
> 
> What is "partial"?


Partial is when you do not substitute all variables. On `QQ[x,y]` if you only specify the value of `x`, let say `x=1` then `y` is set to `y`. In other words `p.subs(x=1)` is equivalent to `p(1, y)`. All the examples you wrote are perfectly valid and will be supported in the same way. The only example that is wrong and I want to disable is in [comment:28 comment:28].



---

archive/issue_comments_448987.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-24T18:17:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448987",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_448988.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-24T18:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448988",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_448989.json:
```json
{
    "body": "The example from comment 28 is now tested",
    "created_at": "2021-05-24T18:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448989",
    "user": "https://github.com/mkoeppe"
}
```

The example from comment 28 is now tested



---

archive/issue_comments_448990.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-05-24T21:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448990",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_448991.json:
```json
{
    "body": "As expected, `QQ[x,y]` now fails its test suite. Great.\n\n```\nsage -t --long --random-seed=0 src/sage/rings/ring.pyx  # 2 doctests failed\nsage -t --long --random-seed=0 src/sage/rings/polynomial/polynomial_ring_constructor.py  # 4 doctests failed\n```",
    "created_at": "2021-05-24T21:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448991",
    "user": "https://github.com/videlec"
}
```

As expected, `QQ[x,y]` now fails its test suite. Great.

```
sage -t --long --random-seed=0 src/sage/rings/ring.pyx  # 2 doctests failed
sage -t --long --random-seed=0 src/sage/rings/polynomial/polynomial_ring_constructor.py  # 4 doctests failed
```



---

archive/issue_comments_448992.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-24T22:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448992",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_448993.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-05-24T22:38:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448993",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_448994.json:
```json
{
    "body": "Replying to [comment:23 mkoeppe]:\n> Replying to [comment:21 vdelecroix]:\n> > Why something that specific is needed in `rings/polynomial/polynomial_ring.py`?\n> > \n> > ```\n> > def construction(self):\n> >     ...\n> >     implementation = None\n> >     if 'NTL' in self._implementation_repr:\n> >         implementation = 'NTL'\n> >     ...\n> > ```\n\n> \n> This is obviously not a complete solution. The parents don't keep track in a clean way what the implementation is. I have some other experimental code that tries to decode the element class, but it's all not very satisfying.\n\n\nCould you at least add a `# NOTE:` to this code and possibly add a pointer to the ticket #31852.",
    "created_at": "2021-05-28T07:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448994",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:23 mkoeppe]:
> Replying to [comment:21 vdelecroix]:
> > Why something that specific is needed in `rings/polynomial/polynomial_ring.py`?
> > 
> > ```
> > def construction(self):
> >     ...
> >     implementation = None
> >     if 'NTL' in self._implementation_repr:
> >         implementation = 'NTL'
> >     ...
> > ```

> 
> This is obviously not a complete solution. The parents don't keep track in a clean way what the implementation is. I have some other experimental code that tries to decode the element class, but it's all not very satisfying.


Could you at least add a `# NOTE:` to this code and possibly add a pointer to the ticket #31852.



---

archive/issue_comments_448995.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-29T02:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448995",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_448996.json:
```json
{
    "body": "Tiny doctest issue in the tests you introduced\n\n```\nsage -t --long --random-seed=0 src/sage/rings/polynomial/polynomial_ring.py\n**********************************************************************\nFile \"src/sage/rings/polynomial/polynomial_ring.py\", line 1964, in sage.rings.polynomial.polynomial_ring.PolynomialRing_commutative.construction\nFailed example:\n    R = PRing(ZZ, 'x'); R\nExpected nothing\nGot:\n    Univariate Polynomial Ring in x over Integer Ring\n**********************************************************************\nFile \"src/sage/rings/polynomial/polynomial_ring.py\", line 1970, in sage.rings.polynomial.polynomial_ring.PolynomialRing_commutative.construction\nFailed example:\n    R = PRing(ZZ, 'x', implementation='NTL'); R\nExpected nothing\nGot:\n    Univariate Polynomial Ring in x over Integer Ring (using NTL)\n**********************************************************************\n```",
    "created_at": "2021-05-30T08:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448996",
    "user": "https://github.com/videlec"
}
```

Tiny doctest issue in the tests you introduced

```
sage -t --long --random-seed=0 src/sage/rings/polynomial/polynomial_ring.py
**********************************************************************
File "src/sage/rings/polynomial/polynomial_ring.py", line 1964, in sage.rings.polynomial.polynomial_ring.PolynomialRing_commutative.construction
Failed example:
    R = PRing(ZZ, 'x'); R
Expected nothing
Got:
    Univariate Polynomial Ring in x over Integer Ring
**********************************************************************
File "src/sage/rings/polynomial/polynomial_ring.py", line 1970, in sage.rings.polynomial.polynomial_ring.PolynomialRing_commutative.construction
Failed example:
    R = PRing(ZZ, 'x', implementation='NTL'); R
Expected nothing
Got:
    Univariate Polynomial Ring in x over Integer Ring (using NTL)
**********************************************************************
```



---

archive/issue_comments_448997.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-05-30T08:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448997",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_448998.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-30T08:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448998",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_448999.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-05-30T08:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-448999",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_449000.json:
```json
{
    "body": "Can we get this in please? The patchbot failures are unrelated",
    "created_at": "2021-06-06T21:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-449000",
    "user": "https://github.com/mkoeppe"
}
```

Can we get this in please? The patchbot failures are unrelated



---

archive/issue_comments_449001.json:
```json
{
    "body": "Sure. I did not receive any notification e-mail for your comments 43 and 44 in the ticket.",
    "created_at": "2021-06-06T21:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-449001",
    "user": "https://github.com/videlec"
}
```

Sure. I did not receive any notification e-mail for your comments 43 and 44 in the ticket.



---

archive/issue_comments_449002.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-06T21:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-449002",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_449003.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-06-06T21:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-449003",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_comments_449004.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-06-06T22:34:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-449004",
    "user": "https://github.com/tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_449005.json:
```json
{
    "body": "I don't really like having those `TestSuite` calls in the main part of the documentation for the likely very heavily used and read `PolynomialRing`. It adds a lot of clutter and will be confusing for any non-developer. These should all occur in after the `TESTS:` line, and I feel they are best grouped together so it is easier to tell if we have full coverage rather than spread across the file.",
    "created_at": "2021-06-06T22:34:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-449005",
    "user": "https://github.com/tscrim"
}
```

I don't really like having those `TestSuite` calls in the main part of the documentation for the likely very heavily used and read `PolynomialRing`. It adds a lot of clutter and will be confusing for any non-developer. These should all occur in after the `TESTS:` line, and I feel they are best grouped together so it is easier to tell if we have full coverage rather than spread across the file.



---

archive/issue_comments_449006.json:
```json
{
    "body": "Sorry, I will not work on changing this",
    "created_at": "2021-06-06T22:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31431#issuecomment-449006",
    "user": "https://github.com/mkoeppe"
}
```

Sorry, I will not work on changing this



---

archive/issue_events_083483.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T02:58:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31431#event-83483"
}
```



---

archive/issue_events_083484.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31431#event-83484"
}
```



---

archive/issue_events_083485.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31431#event-83485"
}
```



---

archive/issue_events_083486.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31431#event-83486"
}
```



---

archive/issue_events_083487.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31431#event-83487"
}
```



---

archive/issue_events_083488.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31431#event-83488"
}
```



---

archive/issue_events_083489.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31431",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31431#event-83489"
}
```
