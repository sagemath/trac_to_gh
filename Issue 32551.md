# Issue 32551: Permanently get rid of bare except: statements

Issue created by migration from https://trac.sagemath.org/ticket/32788

Original creator: tmonteil

Original creation time: 2021-10-28 17:37:14

CC:  @kliem â€‹frederichan vdelecroix

A while ago, `@`jdemeyer used to regularly take care of removing bare `except:` statements constantly introduced in Sage source code, se e.g. #27427, #14028, #11310, #21687, #24274.

The goal of this ticket (perhaps should it be a task ticket ?) is to take over the work without self-abnegation by:

- removing the existing bare `except:` statements.
- ensure that those will not be reintroduced by adding a dedicated plugin to the patchbot (i have code for it but it could only be merged once the exisiting bare `except:` statements are removed).



---

Comment by chapoton created at 2021-10-28 18:20:54

this should rather be done using the pycodestyle linter : code E722

https://pycodestyle.pycqa.org/en/latest/intro.html#error-codes


---

Comment by chapoton created at 2021-10-28 18:23:22

see #32680 and src/tox.ini


---

Comment by chapoton created at 2021-10-28 18:27:28

but in fact, I would like that the linters first turn both green before switching on the check for E722,

so, let us hope that #32757 will at last give us green linters..


---

Comment by chapoton created at 2021-10-28 18:28:20

another aim is to turn on E713 and E714, several recent tickets  move on that way : #32766


---

Comment by chapoton created at 2021-10-28 18:59:19

Current status of E722:

```
src/sage/schemes/projective/projective_space.py:1696:21: E722 do not use bare 'except'
src/sage/schemes/berkovich/berkovich_space.py:622:13: E722 do not use bare 'except'
src/sage/schemes/product_projective/rational_point.py:498:13: E722 do not use bare 'except'
src/sage/geometry/polyhedron/base.py:5278:17: E722 do not use bare 'except'
src/sage/geometry/polyhedron/library.py:2723:9: E722 do not use bare 'except'
src/sage/graphs/digraph.py:3355:17: E722 do not use bare 'except'
src/sage/graphs/digraph.py:4000:13: E722 do not use bare 'except'
src/sage/graphs/digraph.py:4217:13: E722 do not use bare 'except'
src/sage/rings/qqbar.py:2653:5: E722 do not use bare 'except'
src/sage/interfaces/polymake.py:365:13: E722 do not use bare 'except'
src/sage/interfaces/polymake.py:1596:9: E722 do not use bare 'except'
src/sage/modules/free_module.py:466:9: E722 do not use bare 'except'
src/sage/modules/matrix_morphism.py:1421:9: E722 do not use bare 'except'
src/sage/modules/matrix_morphism.py:1506:9: E722 do not use bare 'except'
src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:241:17: E722 do not use bare 'except'
src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:248:17: E722 do not use bare 'except'
src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:255:13: E722 do not use bare 'except'
src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:806:13: E722 do not use bare 'except'
src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:896:25: E722 do not use bare 'except'
src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:1081:13: E722 do not use bare 'except'
```



---

Comment by tmonteil created at 2021-10-28 19:11:41

Replying to [comment:5 chapoton]:
> Current status of E722:
> {{{
> src/sage/schemes/projective/projective_space.py:1696:21: E722 do not use bare 'except'
> src/sage/schemes/berkovich/berkovich_space.py:622:13: E722 do not use bare 'except'
> src/sage/schemes/product_projective/rational_point.py:498:13: E722 do not use bare 'except'
> src/sage/geometry/polyhedron/base.py:5278:17: E722 do not use bare 'except'
> src/sage/geometry/polyhedron/library.py:2723:9: E722 do not use bare 'except'
> src/sage/graphs/digraph.py:3355:17: E722 do not use bare 'except'
> src/sage/graphs/digraph.py:4000:13: E722 do not use bare 'except'
> src/sage/graphs/digraph.py:4217:13: E722 do not use bare 'except'
> src/sage/rings/qqbar.py:2653:5: E722 do not use bare 'except'
> src/sage/interfaces/polymake.py:365:13: E722 do not use bare 'except'
> src/sage/interfaces/polymake.py:1596:9: E722 do not use bare 'except'
> src/sage/modules/free_module.py:466:9: E722 do not use bare 'except'
> src/sage/modules/matrix_morphism.py:1421:9: E722 do not use bare 'except'
> src/sage/modules/matrix_morphism.py:1506:9: E722 do not use bare 'except'
> src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:241:17: E722 do not use bare 'except'
> src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:248:17: E722 do not use bare 'except'
> src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:255:13: E722 do not use bare 'except'
> src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:806:13: E722 do not use bare 'except'
> src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:896:25: E722 do not use bare 'except'
> src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:1081:13: E722 do not use bare 'except'
> }}}


A basic `grep -R "except:" src/sage` returns a few more cases:


```
src/sage/libs/giac/giac.pyx:        except:
src/sage/libs/giac/giac.pyx:          except:
src/sage/libs/giac/giac.pyx:                except:
src/sage/libs/giac/giac.pyx:        except:
src/sage/libs/giac/giac.pyx:         except:
src/sage/libs/giac/giac.pyx:         except:
src/sage/libs/giac/giac.pyx:               except:
src/sage/libs/giac/giac.pyx:         except:
src/sage/libs/giac/giac.pyx:         except:
src/sage/libs/giac/giac.pyx:         except:
src/sage/libs/giac/giac.pyx:         except:
src/sage/libs/giac/giac.pyx:         except:
src/sage/libs/giac/giac.pyx:         except:
src/sage/libs/giac/giac.pyx:         except:
src/sage/libs/giac/giac.pyx:        except:
src/sage/libs/giac/giac.pyx:     #     except:
src/sage/libs/giac/giac.pyx:            except:
src/sage/libs/giac/giac.pyx:        except:
src/sage/libs/giac/giac.pyx:         except:
src/sage/libs/giac/giac.pyx:#    except:
src/sage/libs/giac/giac.pyx:#    except:
src/sage/libs/giac/giac.pyx:#    except:
src/sage/libs/giac/giac.pyx:#    except:
src/sage/libs/giac/giac.pyx:#    except:
src/sage/libs/giac/giac.pyx:         except:
src/sage/libs/giac/giac.pyx:               except:
src/sage/libs/giac/giac.pyx:        except:
src/sage/graphs/digraph.py:                except:
src/sage/graphs/digraph.py:            except:
src/sage/graphs/digraph.py:            except:
src/sage/graphs/graph_decompositions/tree_decomposition.pyx:        except:
src/sage/interfaces/polymake.py:            except:
src/sage/interfaces/polymake.py:        except:
src/sage/geometry/polyhedron/base.py:                except:
src/sage/geometry/polyhedron/library.py:        except:
src/sage/modules/free_module.py:        except:
src/sage/modules/matrix_morphism.py:        except:
src/sage/modules/matrix_morphism.py:        except:
src/sage/schemes/product_projective/rational_point.py:            except:
src/sage/schemes/berkovich/berkovich_space.py:            except:
src/sage/schemes/projective/projective_space.py:                    except:
src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:                except:
src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:                except:
src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:            except:
src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:            except:
src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:                        except:
src/sage/dynamics/arithmetic_dynamics/berkovich_ds.py:            except:
src/sage/dynamics/complex_dynamics/mandel_julia_helper.pyx:    except:
src/sage/rings/polynomial/multi_polynomial_libsingular.pyx:                except:
src/sage/rings/polynomial/multi_polynomial_libsingular.pyx:    except:
src/sage/rings/ring_extension_element.pyx:            except:
src/sage/rings/complex_arb.pyx:        except:
src/sage/rings/qqbar.py:    except:
src/sage/plot/plot3d/shapes.pyx:        except:
```



---

Comment by chapoton created at 2021-10-28 19:13:42

pycodestyle probably only looks at py files
----
New commits:


---

Comment by chapoton created at 2021-10-28 19:16:56

after my branch for py files, there remains

```
git grep -c "except\s*:" src/
src/doc/en/developer/coding_in_python.rst:1
src/sage/dynamics/complex_dynamics/mandel_julia_helper.pyx:1
src/sage/graphs/graph_decompositions/tree_decomposition.pyx:1
src/sage/libs/giac/giac.pyx:27
src/sage/plot/plot3d/shapes.pyx:1
src/sage/rings/complex_arb.pyx:1
src/sage/rings/polynomial/multi_polynomial_libsingular.pyx:2
src/sage/rings/ring_extension_element.pyx:1
```


EDIT: the one in the doc is explaining that one should not do that..


---

Comment by git created at 2021-10-28 19:25:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2021-10-28 19:25:43

new commit for pyx files except the giac.pyx mess.


---

Comment by git created at 2021-10-28 19:27:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2021-10-28 19:30:37

Replying to [comment:8 chapoton]:
> after my branch for py files, there remains
> {{{
> git grep -c "except\s*:" src/
> src/doc/en/developer/coding_in_python.rst:1
> src/sage/dynamics/complex_dynamics/mandel_julia_helper.pyx:1
> src/sage/graphs/graph_decompositions/tree_decomposition.pyx:1
> src/sage/libs/giac/giac.pyx:27
> src/sage/plot/plot3d/shapes.pyx:1
> src/sage/rings/complex_arb.pyx:1
> src/sage/rings/polynomial/multi_polynomial_libsingular.pyx:2
> src/sage/rings/ring_extension_element.pyx:1
> }}}
> 
> EDIT: the one in the doc is explaining that one should not do that..

Out of curiosity, did the branch comes from a script ?


---

Comment by tmonteil created at 2021-10-28 19:30:57

After a diagonal view at the commit, the `except Exception:` in `src/sage/interfaces/polymake.py` is dubious, and seems to be a consequence of a `try:/except:` encompassing a pretty long list of tests, which is not recommended as it might mask bugs, see https://www.python.org/dev/peps/pep-0008/#programming-recommendations


---

Comment by chapoton created at 2021-10-28 19:42:03

Replying to [comment:12 tmonteil]:
> Replying to [comment:8 chapoton]:
> > after my branch for py files, there remains
> > {{{
> > git grep -c "except\s*:" src/
> > src/doc/en/developer/coding_in_python.rst:1
> > src/sage/dynamics/complex_dynamics/mandel_julia_helper.pyx:1
> > src/sage/graphs/graph_decompositions/tree_decomposition.pyx:1
> > src/sage/libs/giac/giac.pyx:27
> > src/sage/plot/plot3d/shapes.pyx:1
> > src/sage/rings/complex_arb.pyx:1
> > src/sage/rings/polynomial/multi_polynomial_libsingular.pyx:2
> > src/sage/rings/ring_extension_element.pyx:1
> > }}}
> > 
> > EDIT: the one in the doc is explaining that one should not do that..
> 
> Out of curiosity, did the branch comes from a script ?

Not a script, just my poor old hands and fatiguated brain..


---

Comment by git created at 2021-10-28 19:48:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2021-10-28 20:01:14

Replying to [comment:14 chapoton]:
> Replying to [comment:12 tmonteil]:
> > Out of curiosity, did the branch comes from a script ?
> 
> Not a script, just my poor old hands and fatiguated brain..

Then i should stop developing for Sage given my extremely weak relative productivity in inspecting such issues.


---

Comment by tmonteil created at 2021-10-28 20:12:17

Replying to [comment:10 chapoton]:
> new commit for pyx files except the giac.pyx mess.

I am trying to look at it, it seems that all indentation is shifted by one.


---

Comment by tmonteil created at 2021-10-28 21:50:38

I added 2 commits dealing with `giac.pyx` to your branch. The first commit only fixes bad indentation that made my editor crazy, the second one fixes most `try/except` statements (most of them seem just useless).

The last two remaining cases are related with some `pari_lock` and need to be explored.

----
New commits:


---

Comment by tmonteil created at 2021-10-28 22:19:16

----


---

Comment by chapoton created at 2021-10-29 11:44:15

Sur ta branche, j'ai ajoutÃ© un commit pour corriger les doctests.
----
New commits:


---

Comment by @kliem created at 2021-10-29 13:08:09

I hope that makes any sense:

- Cleaned up the syntax.
- `pari_unlock` shouldn't haven been called like that, because we are in `sig_on ... sig_off` and one should not call python functions in that case: https://cysignals.readthedocs.io/en/latest/interrupt.html.
- `_wrap_gen(result)` doesn't belong in the `try ... except` block, because it has its own error handling (and if it was to raise an error, we would slip into the except block calling `sig_off` again.
- Use `finally` to call `sig_off` before exit.
- Apparently `giac` raises `RuntimeError` in case something goes wrong. So I used that.
----
New commits:


---

Comment by git created at 2021-10-29 20:39:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2021-10-30 06:31:54

bot is morally green, linter is green. Maybe we can stop here and keep further care for giac for another ticket ?


---

Comment by chapoton created at 2021-10-30 06:55:38

one should look more into the case of `src/sage/interfaces/polymake.py`


---

Comment by @kliem created at 2021-10-30 08:41:11

Replying to [comment:24 chapoton]:
> bot is morally green, linter is green. Maybe we can stop here and keep further care for giac for another ticket ?

Sure, I only touched the `__call__` function that made trouble here. And I didn't feel like we should keep two copies of the same function, if we modify it anyway. I thought it was entirely the same, but there is a tiny difference, which should be more apparent with the current version. I don't think we should work further on this then necessary.


---

Comment by chapoton created at 2021-10-30 09:33:48

new branch on top of u/gh-kliem/32788, where I removed a try/except in singular interface
----
New commits:


---

Comment by tmonteil created at 2021-10-30 09:59:55

Replying to [comment:27 chapoton]:
> ||[9368c2d](https://git.sagemath.org/sage.git/commit?id=9368c2dd7719fcf25e81e78b0b081039bc73f84c)||`remove one try/except in singular interface`||


+1, this try/except was too wide.


---

Comment by chapoton created at 2021-10-30 11:30:02

bot is morally green. Ready to go ?


---

Comment by git created at 2021-10-30 12:25:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2021-10-30 12:29:13

I added E722 to `src/tox.ini` so that the second part of the ticked get fixed too (using tox as `@`chapoton suggested). Regarding [comment:7 comment 7], will the `pyx` be tested as well ? Otherwise, how to deal with them ?


---

Comment by tmonteil created at 2021-10-30 20:51:51

Changing status from new to needs_review.


---

Comment by chapoton created at 2021-10-31 06:38:22

Les fichiers pyx ne sont pas regardÃ©s par tox, il me semble. Tu peux ajouter un plugin au patchbot qui ne regarde que les fichiers pyx. Un mÃ©canisme pour ca est en place dans le patchbot.


---

Comment by chapoton created at 2021-10-31 16:41:57

there seems to be something broken in polyhedron..


---

Comment by @kliem created at 2021-10-31 17:15:18

But not by our current ticket, this also appears in other reports of the same bot.


---

Comment by tmonteil created at 2021-10-31 18:04:31

Indeed, I stopped the patchbot and will see if i can restart it cleanly.


---

Comment by @kliem created at 2021-10-31 18:16:55

Well, I would surely be interested in that bug. Looks like it's my code causing the problems...


---

Comment by tmonteil created at 2021-10-31 18:49:02

I made a distclean, but the logs are still available on the tickets, let us see if it reappears.


---

Comment by tmonteil created at 2021-10-31 20:29:06

Regarding `src/sage/geometry/polyhedron/base.py` there are serious doctesting issues in 32bit architectures as well.


---

Comment by chapoton created at 2021-11-07 10:26:05

there is at least one green patchbot. Good to go ?


---

Comment by mkoeppe created at 2021-11-08 02:50:08


```
./sage -tp --optional=sage,polymake,jupymake src/sage/interfaces/polymake.py src/sage/geometry/polyhedron/



sage -t --random-seed=193726426221037022828737471270892163828 src/sage/interfaces/polymake.py
**********************************************************************
File "src/sage/interfaces/polymake.py", line 1534, in sage.interfaces.polymake.PolymakeElement._sage_
Failed example:
    PP.F_VECTOR.sage()      # optional - polymake
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.polymake.PolymakeElement._sage_[11]>", line 1, in <module>
        PP.F_VECTOR.sage()      # optional - polymake
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/sage/interfaces/interface.py", line 1106, in sage
        return self._sage_(*args, **kwds)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/sage/interfaces/polymake.py", line 1587, in _sage_
        return vector(base_ring, [str_to_base_ring(s)
    UnboundLocalError: local variable 'base_ring' referenced before assignment

File "src/sage/interfaces/polymake.py", line 1551, in sage.interfaces.polymake.PolymakeElement._sage_
Failed example:
    polymake.icosahedron().sage() # optional - polymake
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.polymake.PolymakeElement._sage_[16]>", line 1, in <module>
        polymake.icosahedron().sage() # optional - polymake
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/sage/interfaces/interface.py", line 1106, in sage
        return self._sage_(*args, **kwds)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/lib/python3.9/site-packages/sage/interfaces/polymake.py", line 1569, in _sage_
        d = int(r[i + 1: i + i1])
    ValueError: invalid literal for int() with base 10: 'aticExtension<Rational>>[SAGE2]'
```



---

Comment by mkoeppe created at 2021-11-08 02:50:08

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2021-11-09 18:57:25

I propose, as a strategy, to undo the changes in polymake interface and keep them for another ticket. This would also mean not to activate E722 here, but later.

Otherwise, somebody should stand up and fix now the polymake issues. I will not.


---

Comment by git created at 2021-11-10 19:19:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2021-11-10 19:23:36

There first change was necessary, because it changed `polymake` to `polymake_expect`, which does not work for me at all.

I still get one failure and I'm really confused, that I get this and you don't:


```
sage -t --random-seed=226050575114945871045540898771575845983 src/sage/interfaces/polymake.py
**********************************************************************
File "src/sage/interfaces/polymake.py", line 1544, in sage.interfaces.polymake.PolymakeElement._sage_
Failed example:
    _.parent()              # optional - polymake
Expected:
    Full MatrixSpace of 2 by 2 dense matrices over Integer Ring
Got:
    Full MatrixSpace of 2 by 2 dense matrices over Rational Field
**********************************************************************
1 item had failures:
   1 of  18 in sage.interfaces.polymake.PolymakeElement._sage_
    [282 tests, 1 failure, 3.17 s]
```



---

Comment by mkoeppe created at 2021-11-10 20:21:20

The changes to `PolymakeElement` look nontrivial, so I would agree with the suggestion to defer them to a separate ticket.


---

Comment by mkoeppe created at 2021-11-10 20:22:16

... or just try the minimal change that changes `except:` to `except Exception:`


---

Comment by chapoton created at 2021-11-14 09:37:38

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2021-11-14 09:37:38

I have made a branch with only a minimal change to polymake file. And squashed all the commits into one single commit. 
----
New commits:


---

Comment by git created at 2021-11-14 16:15:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-11-14 18:09:27

Polymake works OK now with this branch, thanks.


---

Comment by chapoton created at 2021-11-17 16:05:37

green bot, can we move on here, please ?


---

Comment by @kliem created at 2021-11-17 16:15:12

Replying to [comment:43 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[30b8dca](https://git.sagemath.org/sage.git/commit/?id=30b8dcaa7d84615657d0dd00290718e293276d89)||`mark polymake_expect import as optional`||

Can we please keep this commit.
Pexpect does not work in my case and importing `polymake_expect as polymake` is not a good idea in that case.


---

Comment by git created at 2021-11-17 18:08:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2021-11-17 18:08:59

ok, done


---

Comment by @kliem created at 2021-11-17 19:56:35

I think the comment should move before the code and not after:


```diff
-                rat_points.add(X(point)) # checks if this point lies on X or not
-            except:
+                rat_points.add(X(point))
+                # checks if this point lies on X or not
```


So instead we should have something as


```
                # checks if this point lies on X or not
                rat_points.add(X(point))
```



---

Comment by tmonteil created at 2021-11-17 22:56:33

Replying to [comment:47 chapoton]:
> I have made a branch with only a minimal change to polymake file. And squashed all the commits into one single commit. 

I do not see the benefit of such squashing, but i see the drawbacks: we get a mixed bomb of changes without understanding which change is done for which reason. For example, i split the changes on `giac.pyx` as follows in order to ease reviewing:


```
â€‹bcdb620	#32788 : fix intentations for libs/giac/giac.pyx
â€‹da3e437	#32788 : remove useless try/except statements in src/sage/libs/giac/giac.pyx
```


Similarly, it is important to have separate commits when you rename a file and modify it.


---

Comment by git created at 2021-11-18 10:19:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2021-11-18 10:22:26

comment:54 is now fixed

concerning squashing, I thought it was a good idea to simplify the commit history. I agree this was maybe not a so good idea. If you think this matters enough to spend your time on that, please provide a better branch


---

Comment by chapoton created at 2021-11-18 12:40:06

green bot again


---

Comment by chapoton created at 2021-11-21 19:50:36

can we please move on here ?


---

Comment by tmonteil created at 2021-11-29 19:10:54

I cherry-picked the relevant commits and merged with `9.5.beta6` so that `git diff trac/u/chapoton/except_fix_branch trac/u/tmonteil/except_fix_branch` leads to:



```diff
--- a/src/sage/interfaces/polymake.py
+++ b/src/sage/interfaces/polymake.py
@@ -364,7 +364,7 @@ class PolymakeAbstract(ExtraTabCompletion, Interface):
             try:
                 x = RDF(x)
                 return '{}'.format(x)
-            except Exception:
+            except (TypeError, ValueError):
                 pass
 
             raise NotImplementedError
```


I am not sure if i have to revert that change.
----
Last 10 new commits:


---

Comment by mkoeppe created at 2021-12-18 19:53:12

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.


---

Comment by chapoton created at 2021-12-28 16:26:59

red branch => needs work


---

Comment by chapoton created at 2021-12-28 16:26:59

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2022-01-14 19:37:51

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2022-01-14 19:37:51

rebased on 9.5.rc1
----
New commits:


---

Comment by git created at 2022-01-14 19:48:48

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2022-01-14 19:49:24

now correctly rebased, needs test by somebody having polymake


---

Comment by @mwageringel created at 2022-02-01 19:02:49

There are two polymake test failures (see below), but they are not related to this ticket, so are best dealt with in another ticket.

I am ready to set this ticket to positive, if someone could confirm that the new pycodestyle check still passes with 9.5 merged. Unfortunately, I have difficulties in running tox on my machine.

By the way, this ticket will also fix a random [doctest failure](https://patchbot.sagemath.org/log/33217/Linux/29~20.04.1-Ubuntu_SMP_Fri_Jan_14_00:32:30_UTC_2022/x86_64/5.13.0-27-generic/r640/2022-01-26%2017:49:49) in `coding/linear_code.py` which is due to an `AlarmInterrupt` being swallowed by a bare except.



----

```
sage -t --long --warn-long 69.2 --random-seed=17721019333867817533235853689613643341 src/doc/en/thematic_tutorials/geometry/polyhedra_tutorial.rst
**********************************************************************
File "src/doc/en/thematic_tutorials/geometry/polyhedra_tutorial.rst", line 650, in doc.en.thematic_tutorials.geometry.polyhedra_tutorial
Failed example:
    Polyhedron(vertices=V, backend='polymake')               # optional - polymake
Expected:
    A 3-dimensional polyhedron in (Number Field in sqrt5 with defining polynomial x^2 - 5)^3 defined as the convex hull of 20 vertices
Got:
    A 3-dimensional polyhedron in (Number Field in sqrt5 with defining polynomial x^2 - 5 with sqrt5 = 2.236067977499790?)^3 defined as the convex hull of 20 v
ertices

sage -t --long --warn-long 69.2 --random-seed=201256750698610760769760302766889916051 src/sage/interfaces/polymake.py
**********************************************************************
File "src/sage/interfaces/polymake.py", line 2189, in sage.interfaces.polymake.PolymakeExpect._eval_line
Failed example:
    c.N_VERTICES                      # optional - polymake_expect
Expected:
    32768
Got:
    Can't locate object method "description" via package "32768" (perhaps you forgot to load "32768"?) at input line 1.
```



---

Comment by @mwageringel created at 2022-02-01 19:23:04

Never mind. I have tried it on a different machine and `pycodestyle-minimal` passes, so I think this is good to go.


---

Comment by @mwageringel created at 2022-02-01 19:23:04

Changing status from needs_review to positive_review.


---

Comment by slelievre created at 2022-02-01 20:33:17

In `src/sage/libs/giac/giac.pyx`, docstring
indentation for `loadgiacgen` seems off.


---

Comment by @mwageringel created at 2022-02-02 19:10:27

Replying to [comment:70 slelievre]:
> In `src/sage/libs/giac/giac.pyx`, docstring
> indentation for `loadgiacgen` seems off.

I am happy to review it if anyone wants to change that, but I do not think it is necessary here.


---

Comment by vbraun created at 2022-02-12 22:05:36

Resolution: fixed
