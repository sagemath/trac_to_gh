# Issue 24720: make Expect._before() wrap bytes_to_str

Issue created by migration from https://trac.sagemath.org/ticket/24957

Original creator: embray

Original creation time: 2018-03-12 12:21:15

Keywords: interfaces

There are some areas in some of the interface classes that directly look in the `spawn.before` and `spawn.after` buffers (which contain `bytes`), and then we need to wrap those with `bytes_to_str`.

There was already an `Expect._before()` method which simply returned `self._expect.before`, and was only used in a few places for some reason.  We reuse that existing method, however, to provide a version that also wraps `bytes_to_str()`, allowing us to avoid some explicit `bytes_to_str()` calls.

Also added a similar `Expect._after()` method.


---

Comment by embray created at 2018-03-13 15:02:43

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-03-13 20:59:21

looks good but the doc formatting could be enhanced:

* ``str`` should rather be ```str```

* ``sage.misc.cpython.bytes_to_str`` should be a link


---

Comment by chapoton created at 2018-03-14 19:18:07

I made the suggested changes. If you agree, and the patchbot is green, you can set to positive
----
New commits:


---

Comment by chapoton created at 2018-03-15 19:59:19

bot is green. Do you agree that one can set to positive ?


---

Comment by embray created at 2018-03-27 12:35:29

It's not 100% clear to me that either of those changes are strictly needed, especially given that it's in a private method which isn't shown in the docs anyways, but that's fine.


---

Comment by embray created at 2018-03-27 12:35:29

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-05-12 11:47:40

Resolution: fixed
