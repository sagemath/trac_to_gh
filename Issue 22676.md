# Issue 22676: Reynolds Operator

archive/issues_022676.json:
```json
{
    "body": "CC:  @bhutz\n\nCompute the Reynolds Operator for finite groups G. \n\nIssue created by migration from https://trac.sagemath.org/ticket/22913\n\n",
    "created_at": "2017-04-30T17:00:16Z",
    "labels": [
        "component: group theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Reynolds Operator",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22676",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```
CC:  @bhutz

Compute the Reynolds Operator for finite groups G. 

Issue created by migration from https://trac.sagemath.org/ticket/22913





---

archive/issue_comments_315879.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-05-02T01:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315879",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

New commits:



---

archive/issue_comments_315880.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-03T21:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315880",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_315881.json:
```json
{
    "body": "Fixed Merge Conflict",
    "created_at": "2017-05-03T21:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315881",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Fixed Merge Conflict



---

archive/issue_comments_315882.json:
```json
{
    "body": "Apparently, my comment from a couple days ago failed to submit. Let me try again.\n\nThe code changes are just some minor clean-up, but you need to think about what to do with base fields. For example, the 4th character in the tetrahedral group has an invariant defined over QQ(sqrt(-3)) (or maybe QQ(sqrt(3))). It might be nice if the following gave back the invariant in that field. At the moment this doesn't even run since you only take into account the group base field and the character base field.\n\n\n```\nK.<i> = CyclotomicField(4)\nTetra =  MatrixGroup([(-1+i)/2,(-1+i)/2, (1+i)/2,(-1-i)/2], [0,i, -i,0])\nxi = Tetra.character(Tetra.character_table()[4])\nL.<w>=QuadraticField(-3)\nTetra.reynolds_operator(x^4, xi)\n```\n\n\nThis example is a good one to figure out what kind of user experience you want for base fields.\n----\nNew commits:",
    "created_at": "2017-05-05T17:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315882",
    "user": "https://github.com/bhutz"
}
```

Apparently, my comment from a couple days ago failed to submit. Let me try again.

The code changes are just some minor clean-up, but you need to think about what to do with base fields. For example, the 4th character in the tetrahedral group has an invariant defined over QQ(sqrt(-3)) (or maybe QQ(sqrt(3))). It might be nice if the following gave back the invariant in that field. At the moment this doesn't even run since you only take into account the group base field and the character base field.


```
K.<i> = CyclotomicField(4)
Tetra =  MatrixGroup([(-1+i)/2,(-1+i)/2, (1+i)/2,(-1-i)/2], [0,i, -i,0])
xi = Tetra.character(Tetra.character_table()[4])
L.<w>=QuadraticField(-3)
Tetra.reynolds_operator(x^4, xi)
```


This example is a good one to figure out what kind of user experience you want for base fields.
----
New commits:



---

archive/issue_comments_315883.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-05-05T18:45:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315883",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_315884.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-05-05T18:45:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315884",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

New commits:



---

archive/issue_comments_315885.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-05-06T00:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315885",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_315886.json:
```json
{
    "body": "I think that is better with the fields, although you missed the case where R.degree()==1\n\n\n```\nK.<i> = CyclotomicField(4)\nTetra =  MatrixGroup([(-1+i)/2,(-1+i)/2, (1+i)/2,(-1-i)/2], [0,i, -i,0])\nxi = Tetra.character(Tetra.character_table()[4])\nL.<v> = QuadraticField(5)\nR.<x,y> = QQ[]\nf=x^4\ng=Tetra.reynolds_operator(f,xi)\ng\n```\n\n\nAlso relative extensions do not work (you can decide if you'll require absolute fields or deal with relative ones)\n\n\n```\nK.<i> = CyclotomicField(4)\nG =  MatrixGroup([(-1+i)/2,(-1+i)/2, (1+i)/2,(-1-i)/2], [0,i, -i,0])\nxi = G.character(Tetra.character_table()[4])\nL.<v> = QuadraticField(5)\nR.<x>=L[]\nLL.<w> = L.extension(x^2+v)\nR.<x,y> = LL[]\nf=x^4\ng=Tetra.reynolds_operator(f,xi)\ng\n```\n\n\nQQbar doesn't work either and it seems like that should probably work\n\n```\nK.<i> = CyclotomicField(4)\nG =  MatrixGroup([(-1+i)/2,(-1+i)/2, (1+i)/2,(-1-i)/2], [0,i, -i,0])\nxi = G.character(Tetra.character_table()[4])\nL.<v> = QuadraticField(5)\nR.<x>=L[]\nLL.<w> = L.extension(x^2+v)\nR.<x,y> = QQbar[]\nf=x^4\ng=Tetra.reynolds_operator(f,xi)\ng\n```\n\n\nIt would be good to give a better error when the dimension of the polynomial ring does not match the dimension of the matrix group\n\n```\nG =  MatrixGroup(DihedralGroup(4))\nxi = G.character(G.character_table()[1])\nR.<x,y>=QQ[]\nf=x^4\ng=G.reynolds_operator(f,xi)\ng\n```\n\n\nOtherwise, everything else I tried worked just fine.\n----\nNew commits:",
    "created_at": "2017-05-06T00:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315886",
    "user": "https://github.com/bhutz"
}
```

I think that is better with the fields, although you missed the case where R.degree()==1


```
K.<i> = CyclotomicField(4)
Tetra =  MatrixGroup([(-1+i)/2,(-1+i)/2, (1+i)/2,(-1-i)/2], [0,i, -i,0])
xi = Tetra.character(Tetra.character_table()[4])
L.<v> = QuadraticField(5)
R.<x,y> = QQ[]
f=x^4
g=Tetra.reynolds_operator(f,xi)
g
```


Also relative extensions do not work (you can decide if you'll require absolute fields or deal with relative ones)


```
K.<i> = CyclotomicField(4)
G =  MatrixGroup([(-1+i)/2,(-1+i)/2, (1+i)/2,(-1-i)/2], [0,i, -i,0])
xi = G.character(Tetra.character_table()[4])
L.<v> = QuadraticField(5)
R.<x>=L[]
LL.<w> = L.extension(x^2+v)
R.<x,y> = LL[]
f=x^4
g=Tetra.reynolds_operator(f,xi)
g
```


QQbar doesn't work either and it seems like that should probably work

```
K.<i> = CyclotomicField(4)
G =  MatrixGroup([(-1+i)/2,(-1+i)/2, (1+i)/2,(-1-i)/2], [0,i, -i,0])
xi = G.character(Tetra.character_table()[4])
L.<v> = QuadraticField(5)
R.<x>=L[]
LL.<w> = L.extension(x^2+v)
R.<x,y> = QQbar[]
f=x^4
g=Tetra.reynolds_operator(f,xi)
g
```


It would be good to give a better error when the dimension of the polynomial ring does not match the dimension of the matrix group

```
G =  MatrixGroup(DihedralGroup(4))
xi = G.character(G.character_table()[1])
R.<x,y>=QQ[]
f=x^4
g=G.reynolds_operator(f,xi)
g
```


Otherwise, everything else I tried worked just fine.
----
New commits:



---

archive/issue_comments_315887.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-05-12T02:49:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315887",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

New commits:



---

archive/issue_comments_315888.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-05-12T02:49:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315888",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_315889.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-05-12T20:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315889",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_315890.json:
```json
{
    "body": "I reduced the many nested if/then/else into something I think is more readable. I also tried to do some optimization of doc-testing. Even creating some of these groups is slow, so I combined many tests. I also limited it to one test per case and limited the Tetrahedral use as it is very slow to create. I think I reduced the total test time by about 8 seconds.\n\n\nI also noticed the even in the trivial character case you may need to extend. The following then fails.\n\n\n```\n            sage: K.<i> = CyclotomicField(4)\n            sage: Tetra =  MatrixGroup([(-1+i)/2,(-1+i)/2, (1+i)/2,(-1-i)/2], [0,i, -i,0])\n            sage: L.<v> = QuadraticField(5)\n            sage: R.<x,y> = L[]\n            sage: Tetra.reynolds_operator(x^4)\n```\n\n\nAll other functionality tested was good.\n----\nNew commits:",
    "created_at": "2017-05-12T20:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315890",
    "user": "https://github.com/bhutz"
}
```

I reduced the many nested if/then/else into something I think is more readable. I also tried to do some optimization of doc-testing. Even creating some of these groups is slow, so I combined many tests. I also limited it to one test per case and limited the Tetrahedral use as it is very slow to create. I think I reduced the total test time by about 8 seconds.


I also noticed the even in the trivial character case you may need to extend. The following then fails.


```
            sage: K.<i> = CyclotomicField(4)
            sage: Tetra =  MatrixGroup([(-1+i)/2,(-1+i)/2, (1+i)/2,(-1-i)/2], [0,i, -i,0])
            sage: L.<v> = QuadraticField(5)
            sage: R.<x,y> = L[]
            sage: Tetra.reynolds_operator(x^4)
```


All other functionality tested was good.
----
New commits:



---

archive/issue_comments_315891.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-02T15:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315891",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_315892.json:
```json
{
    "body": "Fixed trivial character case and added the example above.\n----\nNew commits:",
    "created_at": "2017-06-02T15:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315892",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

Fixed trivial character case and added the example above.
----
New commits:



---

archive/issue_comments_315893.json:
```json
{
    "body": "A note on the doc: you should have a short 1-line description and then the full body. So something like\n\n```diff\n-        Compute the Reynolds Operator of this finite group `G`. This is the\n-        projection from the polynomial ring to the ring of relative invariants.\n+        Compute the Reynolds operator of ``self``.\n+\n+        Let `G` be a finite group. The Reynolds operator of `G` is the\n+        projection from the polynomial ring to the ring of relative invariants.\n```\n",
    "created_at": "2017-06-02T23:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315893",
    "user": "https://github.com/tscrim"
}
```

A note on the doc: you should have a short 1-line description and then the full body. So something like

```diff
-        Compute the Reynolds Operator of this finite group `G`. This is the
-        projection from the polynomial ring to the ring of relative invariants.
+        Compute the Reynolds operator of ``self``.
+
+        Let `G` be a finite group. The Reynolds operator of `G` is the
+        projection from the polynomial ring to the ring of relative invariants.
```




---

archive/issue_comments_315894.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-04T19:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315894",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_315895.json:
```json
{
    "body": "same basic changes as last time. I changed how the composition was generated to be more readable. I also adjusted the error messages and improved the handling in the characteristic p>0 trivial character case.\n\nAlso, the one line description was fixed.\n\nI think this works in all cases it is reasonable to make it work for at this time. So if you test it again and are fine with my changes, I'm ok with marking it positive.",
    "created_at": "2017-06-04T19:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315895",
    "user": "https://github.com/bhutz"
}
```

same basic changes as last time. I changed how the composition was generated to be more readable. I also adjusted the error messages and improved the handling in the characteristic p>0 trivial character case.

Also, the one line description was fixed.

I think this works in all cases it is reasonable to make it work for at this time. So if you test it again and are fine with my changes, I'm ok with marking it positive.



---

archive/issue_comments_315896.json:
```json
{
    "body": "I have one more comment and some additional nitpicks.\n\nSince you are changing the argument name for `molien_series`, you should deprecate the old one in case anyone has explicitly done `molien_series(xi=foo)`. The best way to do that is to use\n\n```\nfrom sage.misc.decorators import rename_keyword\n\n    @rename_keyword(22913, xi='chi')\n    def molien_series(self, chi=None, return_series=True, prec=20, variable='t'):\n```\n\n\nNitpicks:\n\n```diff\n-    def reynolds_operator(self, poly, chi = None):\n+    def reynolds_operator(self, poly, chi=None):\n```\n\n\n```diff\n-        relative invariants. [Stu1993]_. If possible, the invariant is\n+        relative invariants [Stu1993]_. If possible, the invariant is\n```\n\n\n```diff\n-        - ``poly`` -- a polynomial from K[x]\n+        - ``poly`` -- a polynomial\n```\n\nor `a polynomial in `K[x]``\n\n```diff\n        AUTHORS:\n\n-            Rebecca Lauren Miller and Ben Hutz\n+       Rebecca Lauren Miller and Ben Hutz\n```\n\n\n```diff\n         poly_gens = vector(poly.parent().gens())\n-        F = L(0)\n+        F = L.zero()\n         for g in self:\n-            F += L(chi(g))*poly(*g.matrix().change_ring(L)*poly_gens)\n+            F += L(chi(g)) * poly(*g.matrix().change_ring(L)*poly_gens)\n         F /= self.order()\n```\n",
    "created_at": "2017-06-04T22:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315896",
    "user": "https://github.com/tscrim"
}
```

I have one more comment and some additional nitpicks.

Since you are changing the argument name for `molien_series`, you should deprecate the old one in case anyone has explicitly done `molien_series(xi=foo)`. The best way to do that is to use

```
from sage.misc.decorators import rename_keyword

    @rename_keyword(22913, xi='chi')
    def molien_series(self, chi=None, return_series=True, prec=20, variable='t'):
```


Nitpicks:

```diff
-    def reynolds_operator(self, poly, chi = None):
+    def reynolds_operator(self, poly, chi=None):
```


```diff
-        relative invariants. [Stu1993]_. If possible, the invariant is
+        relative invariants [Stu1993]_. If possible, the invariant is
```


```diff
-        - ``poly`` -- a polynomial from K[x]
+        - ``poly`` -- a polynomial
```

or `a polynomial in `K[x]``

```diff
        AUTHORS:

-            Rebecca Lauren Miller and Ben Hutz
+       Rebecca Lauren Miller and Ben Hutz
```


```diff
         poly_gens = vector(poly.parent().gens())
-        F = L(0)
+        F = L.zero()
         for g in self:
-            F += L(chi(g))*poly(*g.matrix().change_ring(L)*poly_gens)
+            F += L(chi(g)) * poly(*g.matrix().change_ring(L)*poly_gens)
         F /= self.order()
```




---

archive/issue_comments_315897.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-05T13:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315897",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_315898.json:
```json
{
    "body": "I made all the changes except the deprecation. The parameter for molien_series() was introduced in #22835, so has never been part of a release version of sage. Just want to confirm that the really needs a deprecation.",
    "created_at": "2017-06-05T13:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315898",
    "user": "https://github.com/bhutz"
}
```

I made all the changes except the deprecation. The parameter for molien_series() was introduced in #22835, so has never been part of a release version of sage. Just want to confirm that the really needs a deprecation.



---

archive/issue_comments_315899.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-05T14:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315899",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_315900.json:
```json
{
    "body": "There is some slight ambiguity on that, so I don't think we have definite rule. However, I agree with all other changes. Thanks.",
    "created_at": "2017-06-05T14:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315900",
    "user": "https://github.com/tscrim"
}
```

There is some slight ambiguity on that, so I don't think we have definite rule. However, I agree with all other changes. Thanks.



---

archive/issue_comments_315901.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-12T18:01:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22676#issuecomment-315901",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_059459.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-06-12T18:01:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22676",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22676#event-59459"
}
```
