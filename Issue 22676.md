# Issue 22676: Reynolds Operator

Issue created by migration from Trac.

Original creator: rlmiller

Original creation time: 2017-04-30 17:00:16

CC:  bhutz

Compute the Reynolds Operator for finite groups G. 


---

Comment by rlmiller created at 2017-05-02 01:20:05

New commits:


---

Comment by git created at 2017-05-03 21:27:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rlmiller created at 2017-05-03 21:27:54

Fixed Merge Conflict


---

Comment by bhutz created at 2017-05-05 17:22:52

Apparently, my comment from a couple days ago failed to submit. Let me try again.

The code changes are just some minor clean-up, but you need to think about what to do with base fields. For example, the 4th character in the tetrahedral group has an invariant defined over QQ(sqrt(-3)) (or maybe QQ(sqrt(3))). It might be nice if the following gave back the invariant in that field. At the moment this doesn't even run since you only take into account the group base field and the character base field.


```
K.<i> = CyclotomicField(4)
Tetra =  MatrixGroup([(-1+i)/2,(-1+i)/2, (1+i)/2,(-1-i)/2], [0,i, -i,0])
xi = Tetra.character(Tetra.character_table()[4])
L.<w>=QuadraticField(-3)
Tetra.reynolds_operator(x^4, xi)
```


This example is a good one to figure out what kind of user experience you want for base fields.
----
New commits:


---

Comment by rlmiller created at 2017-05-05 18:45:44

Changing status from new to needs_review.


---

Comment by rlmiller created at 2017-05-05 18:45:44

New commits:


---

Comment by bhutz created at 2017-05-06 00:40:52

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2017-05-06 00:40:52

I think that is better with the fields, although you missed the case where R.degree()==1


```
K.<i> = CyclotomicField(4)
Tetra =  MatrixGroup([(-1+i)/2,(-1+i)/2, (1+i)/2,(-1-i)/2], [0,i, -i,0])
xi = Tetra.character(Tetra.character_table()[4])
L.<v> = QuadraticField(5)
R.<x,y> = QQ[]
f=x^4
g=Tetra.reynolds_operator(f,xi)
g
```


Also relative extensions do not work (you can decide if you'll require absolute fields or deal with relative ones)


```
K.<i> = CyclotomicField(4)
G =  MatrixGroup([(-1+i)/2,(-1+i)/2, (1+i)/2,(-1-i)/2], [0,i, -i,0])
xi = G.character(Tetra.character_table()[4])
L.<v> = QuadraticField(5)
R.<x>=L[]
LL.<w> = L.extension(x^2+v)
R.<x,y> = LL[]
f=x^4
g=Tetra.reynolds_operator(f,xi)
g
```


QQbar doesn't work either and it seems like that should probably work

```
K.<i> = CyclotomicField(4)
G =  MatrixGroup([(-1+i)/2,(-1+i)/2, (1+i)/2,(-1-i)/2], [0,i, -i,0])
xi = G.character(Tetra.character_table()[4])
L.<v> = QuadraticField(5)
R.<x>=L[]
LL.<w> = L.extension(x^2+v)
R.<x,y> = QQbar[]
f=x^4
g=Tetra.reynolds_operator(f,xi)
g
```


It would be good to give a better error when the dimension of the polynomial ring does not match the dimension of the matrix group

```
G =  MatrixGroup(DihedralGroup(4))
xi = G.character(G.character_table()[1])
R.<x,y>=QQ[]
f=x^4
g=G.reynolds_operator(f,xi)
g
```


Otherwise, everything else I tried worked just fine.
----
New commits:


---

Comment by rlmiller created at 2017-05-12 02:49:24

New commits:


---

Comment by rlmiller created at 2017-05-12 02:49:24

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2017-05-12 20:50:01

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2017-05-12 20:50:01

I reduced the many nested if/then/else into something I think is more readable. I also tried to do some optimization of doc-testing. Even creating some of these groups is slow, so I combined many tests. I also limited it to one test per case and limited the Tetrahedral use as it is very slow to create. I think I reduced the total test time by about 8 seconds.


I also noticed the even in the trivial character case you may need to extend. The following then fails.


```
            sage: K.<i> = CyclotomicField(4)
            sage: Tetra =  MatrixGroup([(-1+i)/2,(-1+i)/2, (1+i)/2,(-1-i)/2], [0,i, -i,0])
            sage: L.<v> = QuadraticField(5)
            sage: R.<x,y> = L[]
            sage: Tetra.reynolds_operator(x^4)
```


All other functionality tested was good.
----
New commits:


---

Comment by rlmiller created at 2017-06-02 15:13:53

Changing status from needs_work to needs_review.


---

Comment by rlmiller created at 2017-06-02 15:13:53

Fixed trivial character case and added the example above.
----
New commits:


---

Comment by tscrim created at 2017-06-02 23:09:07

A note on the doc: you should have a short 1-line description and then the full body. So something like

```diff
-        Compute the Reynolds Operator of this finite group `G`. This is the
-        projection from the polynomial ring to the ring of relative invariants.
+        Compute the Reynolds operator of ``self``.
+
+        Let `G` be a finite group. The Reynolds operator of `G` is the
+        projection from the polynomial ring to the ring of relative invariants.
```



---

Comment by git created at 2017-06-04 19:39:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2017-06-04 19:43:12

same basic changes as last time. I changed how the composition was generated to be more readable. I also adjusted the error messages and improved the handling in the characteristic p>0 trivial character case.

Also, the one line description was fixed.

I think this works in all cases it is reasonable to make it work for at this time. So if you test it again and are fine with my changes, I'm ok with marking it positive.


---

Comment by tscrim created at 2017-06-04 22:08:26

I have one more comment and some additional nitpicks.

Since you are changing the argument name for `molien_series`, you should deprecate the old one in case anyone has explicitly done `molien_series(xi=foo)`. The best way to do that is to use

```
from sage.misc.decorators import rename_keyword

    `@`rename_keyword(22913, xi='chi')
    def molien_series(self, chi=None, return_series=True, prec=20, variable='t'):
```


Nitpicks:

```diff
-    def reynolds_operator(self, poly, chi = None):
+    def reynolds_operator(self, poly, chi=None):
```


```diff
-        relative invariants. [Stu1993]_. If possible, the invariant is
+        relative invariants [Stu1993]_. If possible, the invariant is
```


```diff
-        - ``poly`` -- a polynomial from K[x]
+        - ``poly`` -- a polynomial
```

or `a polynomial in `K[x]``

```diff
        AUTHORS:

-            Rebecca Lauren Miller and Ben Hutz
+       Rebecca Lauren Miller and Ben Hutz
```


```diff
         poly_gens = vector(poly.parent().gens())
-        F = L(0)
+        F = L.zero()
         for g in self:
-            F += L(chi(g))*poly(*g.matrix().change_ring(L)*poly_gens)
+            F += L(chi(g)) * poly(*g.matrix().change_ring(L)*poly_gens)
         F /= self.order()
```



---

Comment by git created at 2017-06-05 13:54:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2017-06-05 13:56:46

I made all the changes except the deprecation. The parameter for molien_series() was introduced in #22835, so has never been part of a release version of sage. Just want to confirm that the really needs a deprecation.


---

Comment by tscrim created at 2017-06-05 14:01:44

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-06-05 14:01:44

There is some slight ambiguity on that, so I don't think we have definite rule. However, I agree with all other changes. Thanks.


---

Comment by vbraun created at 2017-06-12 18:01:27

Resolution: fixed
