# Issue 12804: Fix hash of ideals - or make it at least faster

Issue created by migration from https://trac.sagemath.org/ticket/12976

Original creator: SimonKing

Original creation time: 2012-05-19 13:16:33

Assignee: malb

CC:  burcin polybori

Define

```
sage: P.<x,y>=QQ[]
sage: J = P*[P.random_element() for _ in range(100)]
```


*__Hash is broken__*

`J.__hash__` is:

```
    def __hash__(self):
        return hash(str(self))
```

However, `J.__cmp__` does the mathematically correct thing and relies on comparison of Gröbner bases.

Hence, two ideals with different string representation can be equal. That's bad!

```
sage: I = P*J.groebner_basis()
sage: I == J
True
sage: hash(I)==hash(J)
False
```


*__Hash is slow__*

Computing the string representation is unnecessarily slow - by a factor of 3000:

```
sage: %timeit h = hash(J)
125 loops, best of 3: 4.03 ms per loop
sage: g = J.gens()
sage: %timeit h = hash(g)
625 loops, best of 3: 1.84 µs per loop
```


*__Suggestion__*

If the hash is requested then typically (in dictionaries etc) one would like to compare as well. Hence, the Gröbner basis will be computed anyway. I suggest to rely on the hash of the Gröbner basis. Timing (if the Gröbner basis is already cached):

```
sage: %timeit h = hash(J.groebner_basis())
625 loops, best of 3: 2.31 µs per loop
```


Moreover, I suggest to cache the hash.


---

Comment by SimonKing created at 2012-05-19 15:40:42

The problem with using the GB for the hash is: In comparison, it is looked whether the GB for the current monomial order is stored. If it isn't, the GB in degrevlex order is computed and then compared. Hence, it is not so easy to tell what GB one would use for the hash, because in comparison _different_ Gröbner bases are used.

Would it be feasible to make ideals (in contrast to polynomial sequences) non-hashable? Or would it be feasible to compare ideals by their sets (unordered) of defining generators?

I guess both suggestions would break many things. With the first suggestion, in particular we had to decide how to deal with Singular attributes for use in Singular functions (see #12977).


---

Comment by SimonKing created at 2012-05-19 15:41:40

I guess Burcin and Michael have an opinion on hashing ideals as well...
