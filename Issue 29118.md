# Issue 29118: Remove SAGE_ROOT/build/bin from PATH set by sage-env

Issue created by migration from https://trac.sagemath.org/ticket/29355

Original creator: mkoeppe

Original creation time: 2020-03-17 23:46:43

CC:  dimpase jhpalmieri fbissey mjo vbraun

This directory contains executables needed during building sage-the-distribution only. It should only be added to `PATH` by `sage-build-env` (see #29052 for `sage-build-env-config`).

This will require changes to some scripts in `src/bin`:

```
src/bin/sage-pkg


---

Comment by mkoeppe created at 2020-09-18 22:24:43

#29951 will only put `$SAGE_ROOT/bin` in `$PATH` if `$SAGE_ROOT` is set and readable.

Repurposing this ticket to change scripts in `src/bin` to not use `sage-system-python` (which is in `build/bin` and not installed and not available in distributions).


---

Comment by mkoeppe created at 2020-09-18 22:31:37

New commits:


---

Comment by mkoeppe created at 2020-09-18 22:31:37

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2020-09-21 20:17:56

`sage-num-threads.py` gets used in the build process, I think: it gets used in `src/bin/sage-env`. So I think this change will break building on systems with no Python 3 anywhere. Do we need to support such systems?


---

Comment by mkoeppe created at 2020-09-21 20:22:08

Thanks for catching this. This needs some thought


---

Comment by jhpalmieri created at 2020-09-21 20:26:35

I think the issue is that the line between build scripts and runtime scripts is blurred. sage-env and sage-num-threads.py, maybe others?


---

Comment by mkoeppe created at 2020-09-21 20:31:53

Yes, I agree, I think the solution is to split the build-specific parts (parsing MAKEFLAGS) out from `sage-num-threads.py`. I'll work on it.


---

Comment by mkoeppe created at 2020-09-21 21:32:06

Changing status from needs_review to needs_work.


---

Comment by jhpalmieri created at 2020-09-21 22:00:12

Sounds good to me.


---

Comment by git created at 2020-09-22 00:02:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-09-22 00:09:27

In a follow-up ticket, we could probably get rid of `src/bin/sage-num-threads.py` completely by implementing the desired defaulting behavior in `src/sage/parallel/ncpus.py` and `src/sage/doctest/control.py`.


---

Comment by mkoeppe created at 2020-09-22 00:09:27

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2020-09-23 04:27:13

Replying to [comment:18 mkoeppe]:
> In a follow-up ticket, we could probably get rid of `src/bin/sage-num-threads.py` completely by implementing the desired defaulting behavior in `src/sage/parallel/ncpus.py` and `src/sage/doctest/control.py`.

I have opened #30639 for that.


---

Comment by mjo created at 2020-09-25 14:15:12

I should probably know the answer to this, but is there a promise that "python3" is the official name for the python interpreter in the future? After 2.x is completely dead, they're not going to change it back to "python"?

(This is also relevant when we're searching for (only) a system "python3")


---

Comment by mjo created at 2020-09-25 14:40:11

The name "python3" should be OK for a long time:

 * https://www.python.org/dev/peps/pep-0394/
 * https://lwn.net/Articles/780737/


---

Comment by mkoeppe created at 2020-09-25 15:26:12

and https://twitter.com/gvanrossum/status/1306082472443084801


---

Comment by git created at 2020-10-02 02:57:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-10-02 18:31:57

Needs review


---

Comment by git created at 2020-11-01 19:34:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-11-01 19:35:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-11-02 21:11:24

Can we please get this ticket in?


---

Comment by dimpase created at 2020-11-03 17:51:22

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-11-03 17:51:22

lgtm


---

Comment by mkoeppe created at 2020-11-03 17:52:08

Thanks!


---

Comment by slabbe created at 2020-11-03 20:20:28

I was currently checking it also. So, I confirm that `sage -coverage` and `sage -coverageall` still work. Also, `sage-num-threads.py` still seems to work:


```
(sage-sh) $ echo $SAGE_NUM_THREADS
1
(sage-sh) $ echo $SAGE_NUM_THREADS_PARALLEL
8
```


or the above were defined from `build/make/install`?

Anyway, I have:


```
sage: import os                                                                 
sage: os.environ['SAGE_NUM_THREADS']                                            
'1'
sage: os.environ['SAGE_NUM_THREADS_PARALLEL']                                   
'8'
```


positive review!


---

Comment by mkoeppe created at 2020-12-14 18:37:27

Looks like this ticket was merged as part of #30627.


---

Comment by mkoeppe created at 2020-12-14 18:37:27

Resolution: fixed
