# Issue 29118: Remove SAGE_ROOT/build/bin from PATH set by sage-env

archive/issues_029118.json:
```json
{
    "body": "CC:  dimpase jhpalmieri fbissey mjo vbraun\n\nThis directory contains executables needed during building sage-the-distribution only. It should only be added to `PATH` by `sage-build-env` (see #29052 for `sage-build-env-config`).\n\nThis will require changes to some scripts in `src/bin`:\n\n```\nsrc/bin/sage-pkg\n\nIssue created by migration from https://trac.sagemath.org/ticket/29355\n\n",
    "created_at": "2020-03-17T23:46:43Z",
    "labels": [
        "scripts",
        "major",
        "enhancement"
    ],
    "title": "Remove SAGE_ROOT/build/bin from PATH set by sage-env",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29118",
    "user": "mkoeppe"
}
```
CC:  dimpase jhpalmieri fbissey mjo vbraun

This directory contains executables needed during building sage-the-distribution only. It should only be added to `PATH` by `sage-build-env` (see #29052 for `sage-build-env-config`).

This will require changes to some scripts in `src/bin`:

```
src/bin/sage-pkg

Issue created by migration from https://trac.sagemath.org/ticket/29355





---

archive/issue_comments_412256.json:
```json
{
    "body": "#29951 will only put `$SAGE_ROOT/bin` in `$PATH` if `$SAGE_ROOT` is set and readable.\n\nRepurposing this ticket to change scripts in `src/bin` to not use `sage-system-python` (which is in `build/bin` and not installed and not available in distributions).",
    "created_at": "2020-09-18T22:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412256",
    "user": "mkoeppe"
}
```

#29951 will only put `$SAGE_ROOT/bin` in `$PATH` if `$SAGE_ROOT` is set and readable.

Repurposing this ticket to change scripts in `src/bin` to not use `sage-system-python` (which is in `build/bin` and not installed and not available in distributions).



---

archive/issue_comments_412257.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-09-18T22:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412257",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_412258.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-18T22:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412258",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_412259.json:
```json
{
    "body": "`sage-num-threads.py` gets used in the build process, I think: it gets used in `src/bin/sage-env`. So I think this change will break building on systems with no Python 3 anywhere. Do we need to support such systems?",
    "created_at": "2020-09-21T20:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412259",
    "user": "jhpalmieri"
}
```

`sage-num-threads.py` gets used in the build process, I think: it gets used in `src/bin/sage-env`. So I think this change will break building on systems with no Python 3 anywhere. Do we need to support such systems?



---

archive/issue_comments_412260.json:
```json
{
    "body": "Thanks for catching this. This needs some thought",
    "created_at": "2020-09-21T20:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412260",
    "user": "mkoeppe"
}
```

Thanks for catching this. This needs some thought



---

archive/issue_comments_412261.json:
```json
{
    "body": "I think the issue is that the line between build scripts and runtime scripts is blurred. sage-env and sage-num-threads.py, maybe others?",
    "created_at": "2020-09-21T20:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412261",
    "user": "jhpalmieri"
}
```

I think the issue is that the line between build scripts and runtime scripts is blurred. sage-env and sage-num-threads.py, maybe others?



---

archive/issue_comments_412262.json:
```json
{
    "body": "Yes, I agree, I think the solution is to split the build-specific parts (parsing MAKEFLAGS) out from `sage-num-threads.py`. I'll work on it.",
    "created_at": "2020-09-21T20:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412262",
    "user": "mkoeppe"
}
```

Yes, I agree, I think the solution is to split the build-specific parts (parsing MAKEFLAGS) out from `sage-num-threads.py`. I'll work on it.



---

archive/issue_comments_412263.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-09-21T21:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412263",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_412264.json:
```json
{
    "body": "Sounds good to me.",
    "created_at": "2020-09-21T22:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412264",
    "user": "jhpalmieri"
}
```

Sounds good to me.



---

archive/issue_comments_412265.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-22T00:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412265",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412266.json:
```json
{
    "body": "In a follow-up ticket, we could probably get rid of `src/bin/sage-num-threads.py` completely by implementing the desired defaulting behavior in `src/sage/parallel/ncpus.py` and `src/sage/doctest/control.py`.",
    "created_at": "2020-09-22T00:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412266",
    "user": "mkoeppe"
}
```

In a follow-up ticket, we could probably get rid of `src/bin/sage-num-threads.py` completely by implementing the desired defaulting behavior in `src/sage/parallel/ncpus.py` and `src/sage/doctest/control.py`.



---

archive/issue_comments_412267.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-09-22T00:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412267",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_412268.json:
```json
{
    "body": "Replying to [comment:18 mkoeppe]:\n> In a follow-up ticket, we could probably get rid of `src/bin/sage-num-threads.py` completely by implementing the desired defaulting behavior in `src/sage/parallel/ncpus.py` and `src/sage/doctest/control.py`.\n\nI have opened #30639 for that.",
    "created_at": "2020-09-23T04:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412268",
    "user": "mkoeppe"
}
```

Replying to [comment:18 mkoeppe]:
> In a follow-up ticket, we could probably get rid of `src/bin/sage-num-threads.py` completely by implementing the desired defaulting behavior in `src/sage/parallel/ncpus.py` and `src/sage/doctest/control.py`.

I have opened #30639 for that.



---

archive/issue_comments_412269.json:
```json
{
    "body": "I should probably know the answer to this, but is there a promise that \"python3\" is the official name for the python interpreter in the future? After 2.x is completely dead, they're not going to change it back to \"python\"?\n\n(This is also relevant when we're searching for (only) a system \"python3\")",
    "created_at": "2020-09-25T14:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412269",
    "user": "mjo"
}
```

I should probably know the answer to this, but is there a promise that "python3" is the official name for the python interpreter in the future? After 2.x is completely dead, they're not going to change it back to "python"?

(This is also relevant when we're searching for (only) a system "python3")



---

archive/issue_comments_412270.json:
```json
{
    "body": "The name \"python3\" should be OK for a long time:\n\n* https://www.python.org/dev/peps/pep-0394/\n* https://lwn.net/Articles/780737/",
    "created_at": "2020-09-25T14:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412270",
    "user": "mjo"
}
```

The name "python3" should be OK for a long time:

* https://www.python.org/dev/peps/pep-0394/
* https://lwn.net/Articles/780737/



---

archive/issue_comments_412271.json:
```json
{
    "body": "and https://twitter.com/gvanrossum/status/1306082472443084801",
    "created_at": "2020-09-25T15:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412271",
    "user": "mkoeppe"
}
```

and https://twitter.com/gvanrossum/status/1306082472443084801



---

archive/issue_comments_412272.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-02T02:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412272",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412273.json:
```json
{
    "body": "Needs review",
    "created_at": "2020-10-02T18:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412273",
    "user": "mkoeppe"
}
```

Needs review



---

archive/issue_comments_412274.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-01T19:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412274",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412275.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-01T19:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412275",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412276.json:
```json
{
    "body": "Can we please get this ticket in?",
    "created_at": "2020-11-02T21:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412276",
    "user": "mkoeppe"
}
```

Can we please get this ticket in?



---

archive/issue_comments_412277.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-11-03T17:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412277",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_412278.json:
```json
{
    "body": "lgtm",
    "created_at": "2020-11-03T17:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412278",
    "user": "dimpase"
}
```

lgtm



---

archive/issue_comments_412279.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-11-03T17:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412279",
    "user": "mkoeppe"
}
```

Thanks!



---

archive/issue_comments_412280.json:
```json
{
    "body": "I was currently checking it also. So, I confirm that `sage -coverage` and `sage -coverageall` still work. Also, `sage-num-threads.py` still seems to work:\n\n\n```\n(sage-sh) $ echo $SAGE_NUM_THREADS\n1\n(sage-sh) $ echo $SAGE_NUM_THREADS_PARALLEL\n8\n```\n\n\nor the above were defined from `build/make/install`?\n\nAnyway, I have:\n\n\n```\nsage: import os                                                                 \nsage: os.environ['SAGE_NUM_THREADS']                                            \n'1'\nsage: os.environ['SAGE_NUM_THREADS_PARALLEL']                                   \n'8'\n```\n\n\npositive review!",
    "created_at": "2020-11-03T20:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412280",
    "user": "slabbe"
}
```

I was currently checking it also. So, I confirm that `sage -coverage` and `sage -coverageall` still work. Also, `sage-num-threads.py` still seems to work:


```
(sage-sh) $ echo $SAGE_NUM_THREADS
1
(sage-sh) $ echo $SAGE_NUM_THREADS_PARALLEL
8
```


or the above were defined from `build/make/install`?

Anyway, I have:


```
sage: import os                                                                 
sage: os.environ['SAGE_NUM_THREADS']                                            
'1'
sage: os.environ['SAGE_NUM_THREADS_PARALLEL']                                   
'8'
```


positive review!



---

archive/issue_comments_412281.json:
```json
{
    "body": "Looks like this ticket was merged as part of #30627.",
    "created_at": "2020-12-14T18:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412281",
    "user": "mkoeppe"
}
```

Looks like this ticket was merged as part of #30627.



---

archive/issue_comments_412282.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-12-14T18:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29118#issuecomment-412282",
    "user": "mkoeppe"
}
```

Resolution: fixed
