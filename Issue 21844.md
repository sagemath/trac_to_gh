# Issue 21844: Add new option to hyperbolic graphics to select the model

Issue created by migration from https://trac.sagemath.org/ticket/22081

Original creator: jhonrubia6

Original creation time: 2016-12-20 18:40:14

CC:  tscrim

As a first approach add the poincare disc model, and an option to select the model to use the drawing hyperbolic arcs and polygons


---

Comment by jhonrubia6 created at 2017-02-16 18:58:39

Changing keywords from "" to "hyperbolic geometry plot".


---

Comment by jhonrubia6 created at 2017-04-25 16:11:30

New commits:


---

Comment by git created at 2017-04-27 18:32:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhonrubia6 created at 2017-04-29 16:43:51

Changing status from new to needs_review.


---

Comment by msaaltink created at 2017-05-08 17:12:13

I like this new functionality.  It would be great if regular polygons could also be drawn in the Poincare disc model.

Here are a few issues with the coding style:

In hyperbolic_arc.py, HyperbolicArc.__init__, the code


```
        else:
            if model == "PD":
```


would better be


```
        elif model == "PD":
```


which then requires less indenting for the following block.

HyperbolicArc.__init__ should also report an error if `model` is neither 'UHP' or 'PD' rather than raising some other error.  For example, `hyperbolic_arc(0, 1, model='foo')` raises an index error rather than reporting the actual user error.

The same two remarks apply to HyperbolicPolygon.__init__.

The style guide in PEP 8 says "Method definitions inside a class are surrounded by a single blank line.".  Please do that here.

The coding guideline for docstrings says

  It describes the function or method’s effect as a command (“Do this”, “Return that”), not as a description like “Returns the pathname ...”.


So for example, the documentation for _PD_hyperbolic_arc, "Function to construct an hyperbolic arc ...",  should start "Construct an hyperbolic arc ...".  The docstring for _bezier_path, "Returns the corresponding bezier path", should not start with "Returns the" and in any case should be more informative about the function.  As this function does not in fact return anything, the docstring is quite misleading.

The docstrings should be more complete as well, for all method definitions, describing the inputs and output and containing at least one example or test.  See http://doc.sagemath.org/html/en/developer/coding_basics.html#section-documentation-strings

There are several identical methods in hyperbolic_arc.py and hyperbolic_polygon.py.  This code duplication is never a good idea if the functions are truly the same.  Perhaps the two classes could inherit from some new class that contains a singly copy of these definitions---this will make repair easier if an error is discovered in future or some new functionality is to be added.

It would be useful somewhere to describe  the different coordinate systems used for the two models, as it is not immediately obvious what are legitimate PD coordinates.

It is too bad that there is no model-independent way to specify the points (which would make it easy to plot the same diagram in the two different models).  However, adding this probably goes beyond the scope of what you are trying to do here.

Finally, file /src/bin/sage-env-config should not be tracked.


---

Comment by msaaltink created at 2017-05-08 17:12:13

Changing status from needs_review to needs_work.


---

Comment by jhonrubia6 created at 2017-05-08 18:31:48

thank you for your time reviewing the ticket. I'll work on this issues (one at a time)


---

Comment by git created at 2017-06-19 19:11:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-06-19 19:20:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhonrubia6 created at 2017-06-19 19:21:53

This is a partial commit, it lacks your suggestion about a description of the different hyperbolic plane models yet.


---

Comment by git created at 2017-07-04 19:29:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-07-04 19:33:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-07-25 19:06:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-08-07 15:33:12

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2017-08-08 17:22:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slelievre created at 2020-12-10 06:23:42

This feature was requested at

- [Ask Sage question 54314: Filling a hyperbolic polygon](https://ask.sagemath.org/question/54314)

It would be nice to revive this ticket. What remains to be done?


---

Comment by tscrim created at 2021-06-11 00:03:16

There are some doctests to add for full coverage, some seemingly trivial doctest failures, and perhaps some other cleanup. I have rebased the branch and did a little cleanup. There is still a bit more work to do, but I don't think I have time right now to finish this.
----
New commits:


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.


---

Comment by slelievre created at 2021-11-30 23:02:08

Fix author name to match name on other tickets.

- https://trac.sagemath.org/query?order=id&desc=1&author=~Honrubia


---

Comment by git created at 2021-12-06 19:48:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhonrubia6 created at 2021-12-06 20:24:38

Poincaré disk model completed


---

Comment by jhonrubia6 created at 2021-12-06 20:27:44

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2021-12-06 23:11:29

I am now wondering a bit why we are not using (and possibly combining with) the code already provided by `HyperbolicPlane` for this. It seems to be doing the same computations and it would be good for code maintenance. I know some of the implementation details need to be different, but I suspect there is code to be shared, which would give the other models essentially for free.


---

Comment by jhonrubia6 created at 2021-12-07 12:09:47

I agree. As a matter of fact we had this same doubt in ticket:22002#comment:3 five years ago. I see no trouble in relying on the geometry code, as its .plot()[0] are in fact `<class 'sage.plot.arc.Arc'>` and the same programming logic can be used to transform them in bezier arcs allowing for filling.
Is this a decision that we alone can make?


---

Comment by tscrim created at 2021-12-08 01:28:52

I thought I had already said something like this. hahaha I don't see any problem with making these design decisions; you are the one working on this code trying to improve it.


---

Comment by jhonrubia6 created at 2021-12-09 14:13:43

Ok. I'll work on this line of thinking, using HyperbolicPlane behind the scene


---

Comment by git created at 2021-12-20 17:49:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-01-04 19:31:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-01-04 19:55:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-01-13 19:19:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-01-14 01:08:54

Let me know when this is fully ready for review.

Also, minor comment:

```diff
-    A hyperbolic triangle with a vertex at Infinity
+    A hyperbolic triangle with a vertex at Infinity::
```



---

Comment by jhonrubia6 created at 2022-01-19 17:42:21

Replying to [comment:32 tscrim]:
> Let me know when this is fully ready for review.
I'll do. Right now it does work for PD and UHP using the geometry code. Next I will try to make it work for KM too.

> 
> Also, minor comment:
> {{{#!diff
> -    A hyperbolic triangle with a vertex at Infinity
> +    A hyperbolic triangle with a vertex at Infinity::
> }}}
ok


---

Comment by jhonrubia6 created at 2022-01-19 18:26:34

Set assignee to jhonrubia6.


---

Comment by jhonrubia6 created at 2022-01-19 18:26:50

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-01-30 18:49:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-14 18:53:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-18 18:53:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhonrubia6 created at 2022-02-18 19:00:48

I also cleaned the code using 

``` 
tox -e pycodestyle --  src/sage/plot/hyperbolic_polygon.py
tox -v -e relint src/sage/plot/hyperbolic_polygon.py
```



---

Comment by jhonrubia6 created at 2022-02-18 19:00:57

Changing status from needs_work to needs_review.


---

Comment by git created at 2022-02-20 06:27:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-02-20 06:31:21

Thank you for the additional changes. There were still a few bugs dealing with the different input types of `CC` versus vectors. I have tried to make the code more robust, but there are likely to be some other subtle bugs involved with an assumption of one type of input over the other. However, that can wait until another ticket.

I managed to streamline the arc construction with a little bit of refactoring and a well-placed `getattr`.

I made some other documentation tweaks and fixes.

If the bot comes back green (in particular, I think we should look at the doc output with the new tag above), then we can set a positive review if my changes are good.

Also, sometimes it can be good to ignore what the any linter/codestyle tool says in favor of readability and consistency with other code. `:)`


---

Comment by git created at 2022-02-22 00:29:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-02-22 00:31:53

Doc looked good modulo a few more tweaks I did. I also fixed up some pyflakes, which modulo that the patchbot was green.


---

Comment by tscrim created at 2022-02-22 04:31:04

From the log, the one patchbot docbuild seems like it has an unrelated error. Everything else is green.


---

Comment by jhonrubia6 created at 2022-02-22 18:53:44

looks good to me. Thanks for your contribution. I learn new python tricks everyday :-)


---

Comment by tscrim created at 2022-02-23 03:21:53

Then positive review?


---

Comment by git created at 2022-02-23 03:45:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-02-23 03:46:18

Documentation [did build](https://25c0d3225f8d160000f7c446ba4e3c26c2d567ea--sagemath-tobias.netlify.app/) prior to my trivial typo change.


---

Comment by jhonrubia6 created at 2022-02-23 10:06:31

Replying to [comment:47 tscrim]:
> Then positive review?
I do not understand. Are you asking me to change the status? :-)I don't mind changing it, if you prefer so


---

Comment by tscrim created at 2022-02-23 13:08:43

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-02-23 13:08:43

I have changed it, but since you were the one reviewing my changes (as I pushed them last), you are well within your rights to do so. `:)` Thank you.


---

Comment by jhonrubia6 created at 2022-02-24 17:33:32

Ok. I were not sure of how the 'etiquette' worked out in this case :-)


---

Comment by vbraun created at 2022-02-26 23:46:27


```
**********************************************************************
File "src/sage/geometry/hyperbolic_space/hyperbolic_geodesic.py", line 2380, in sage.geometry.hyperbolic_space.hyperbolic_geodesic.HyperbolicGeodesicHM._plot_vertices
Failed example:
    g._plot_vertices(5)
Expected:
    [(4.0, -4.0, 5.744562646538029),
     (1.3632131724692114, -1.6370738298435326, 2.353372235315133),
     (0.13856858387448234, -0.9699800871213693, 1.4000223647674197),
     (-0.9425338542843988, -1.3076813974501533, 1.8969450977056184),
     (-3.0, -3.0, 4.358898943540652)]
Got:
    [(4.0, -4.0, 5.744562646538029),
     (1.3632131724692114, -1.6370738298435326, 2.353372235315132),
     (0.13856858387448057, -0.9699800871213675, 1.4000223647674161),
     (-0.9425338542843988, -1.3076813974501533, 1.8969450977056184),
     (-3.0, -3.0, 4.358898943540652)]
**********************************************************************
1 item had failures:
   1 of   6 in sage.geometry.hyperbolic_space.hyperbolic_geodesic.HyperbolicGeodesicHM._plot_vertices
    [447 tests, 1 failure, 7.70 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage/geometry/hyperbolic_space/hyperbolic_geodesic.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

Comment by vbraun created at 2022-02-26 23:46:27

Changing status from positive_review to needs_work.


---

Comment by git created at 2022-02-27 00:31:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-02-27 00:32:36

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2022-02-27 00:32:36

This should take care of any numerical noise.


---

Comment by vbraun created at 2022-02-27 22:00:57

Resolution: fixed
