# Issue 15614: fix unhandled segfault in Coin backend

archive/issues_015614.json:
```json
{
    "body": "Coin does not properly initialise variables before solving,\nleading to get_variables() segfaulting if it is called before\nsolving. The fix is to check that the pointer returned is not\nNULL.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15851\n\n",
    "created_at": "2014-02-23T15:47:33Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "fix unhandled segfault in Coin backend",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15614",
    "user": "@dimpase"
}
```
Coin does not properly initialise variables before solving,
leading to get_variables() segfaulting if it is called before
solving. The fix is to check that the pointer returned is not
NULL.

Issue created by migration from https://trac.sagemath.org/ticket/15851





---

archive/issue_comments_202097.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to linear programming.",
    "created_at": "2014-02-23T16:00:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15614#issuecomment-202097",
    "user": "@ppurka"
}
```

Changing component from PLEASE CHANGE to linear programming.



---

archive/issue_comments_202098.json:
```json
{
    "body": "Following code should fix it\n\n```diff\ndiff --git a/src/sage/numerical/backends/coin_backend.pyx b/src/sage/numerical/backends/coin_backend.pyx\nindex 4083c79..96e47d3 100644\n--- a/src/sage/numerical/backends/coin_backend.pyx\n+++ b/src/sage/numerical/backends/coin_backend.pyx\n@@ -826,7 +826,10 @@ cdef class CoinBackend(GenericBackend):\n \n         cdef double * solution\n         solution = <double*> self.model.solver().getColSolution()\n-        return solution[variable]\n+        if solution:\n+            return solution[variable]\n+        else:\n+            return []\n \n     cpdef int ncols(self):\n         r\"\"\"\n```\n",
    "created_at": "2014-02-23T16:00:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15614#issuecomment-202098",
    "user": "@ppurka"
}
```

Following code should fix it

```diff
diff --git a/src/sage/numerical/backends/coin_backend.pyx b/src/sage/numerical/backends/coin_backend.pyx
index 4083c79..96e47d3 100644
--- a/src/sage/numerical/backends/coin_backend.pyx
+++ b/src/sage/numerical/backends/coin_backend.pyx
@@ -826,7 +826,10 @@ cdef class CoinBackend(GenericBackend):
 
         cdef double * solution
         solution = <double*> self.model.solver().getColSolution()
-        return solution[variable]
+        if solution:
+            return solution[variable]
+        else:
+            return []
 
     cpdef int ncols(self):
         r"""
```




---

archive/issue_comments_202099.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-02-23T16:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15614#issuecomment-202099",
    "user": "@dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_202100.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-02-23T16:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15614#issuecomment-202100",
    "user": "@dimpase"
}
```

New commits:



---

archive/issue_comments_202101.json:
```json
{
    "body": "Perhaps we should return `None` instead of 0.0?",
    "created_at": "2014-02-23T16:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15614#issuecomment-202101",
    "user": "@ppurka"
}
```

Perhaps we should return `None` instead of 0.0?



---

archive/issue_comments_202102.json:
```json
{
    "body": "Replying to [comment:4 ppurka]:\n> Perhaps we should return `None` instead of 0.0?\n\nother backends return 0, and IMHO it's nice to have this consistent...",
    "created_at": "2014-02-23T16:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15614#issuecomment-202102",
    "user": "@dimpase"
}
```

Replying to [comment:4 ppurka]:
> Perhaps we should return `None` instead of 0.0?

other backends return 0, and IMHO it's nice to have this consistent...



---

archive/issue_comments_202103.json:
```json
{
    "body": "Why don't you directly do a `return 0.0`?",
    "created_at": "2014-02-24T06:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15614#issuecomment-202103",
    "user": "@ppurka"
}
```

Why don't you directly do a `return 0.0`?



---

archive/issue_comments_202104.json:
```json
{
    "body": "Replying to [comment:6 ppurka]:\n> Why don't you directly do a `return 0.0`?\n\nI would like to control the type of returned value in Cython. I guess 0.0 might be float\nrather than double. I suppose making it return the same type always is a good idea, allowing\nfor faster compiled code.",
    "created_at": "2014-02-24T08:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15614#issuecomment-202104",
    "user": "@dimpase"
}
```

Replying to [comment:6 ppurka]:
> Why don't you directly do a `return 0.0`?

I would like to control the type of returned value in Cython. I guess 0.0 might be float
rather than double. I suppose making it return the same type always is a good idea, allowing
for faster compiled code.



---

archive/issue_comments_202105.json:
```json
{
    "body": "Oh, I see. It could be float by default.\n\nThen it looks good to me.",
    "created_at": "2014-02-24T08:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15614#issuecomment-202105",
    "user": "@ppurka"
}
```

Oh, I see. It could be float by default.

Then it looks good to me.



---

archive/issue_comments_202106.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-02-24T08:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15614#issuecomment-202106",
    "user": "@ppurka"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_202107.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-27T21:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15614",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15614#issuecomment-202107",
    "user": "@vbraun"
}
```

Resolution: fixed
