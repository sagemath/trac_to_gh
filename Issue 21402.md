# Issue 21402: [PATCH] Implement derivative of gegenbauer(n,a,x) wrt to x

archive/issues_021402.json:
```json
{
    "body": "CC:  @rwst\n\nKeywords: gegenbauer, ultraspherical, derivative\n\nI noticed that the derivative of the gegenbauer polynomial wrt x was not implemented, so I wrote a patch for it.\n\nI used the formula C'(n,a,x) = 2*a*C(n-1,a+1,x)\n\nWith the patch applied I get, for example:\n\nsage: var('a');\nsage: derivative(gegenbauer(2,a,x),x)\n4*(a + 1)*a*x\n\nIssue created by migration from https://trac.sagemath.org/ticket/21639\n\n",
    "created_at": "2016-10-04T17:04:17Z",
    "labels": [
        "calculus",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "[PATCH] Implement derivative of gegenbauer(n,a,x) wrt to x",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21402",
    "user": "mafra"
}
```
CC:  @rwst

Keywords: gegenbauer, ultraspherical, derivative

I noticed that the derivative of the gegenbauer polynomial wrt x was not implemented, so I wrote a patch for it.

I used the formula C'(n,a,x) = 2*a*C(n-1,a+1,x)

With the patch applied I get, for example:

sage: var('a');
sage: derivative(gegenbauer(2,a,x),x)
4*(a + 1)*a*x

Issue created by migration from https://trac.sagemath.org/ticket/21639





---

archive/issue_comments_297192.json:
```json
{
    "body": "Patch implementing the derivative of gegenbauer(n,a,x) wrt x",
    "created_at": "2016-10-04T17:05:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21402#issuecomment-297192",
    "user": "mafra"
}
```

Patch implementing the derivative of gegenbauer(n,a,x) wrt x



---

archive/issue_comments_297193.json:
```json
{
    "body": "Attachment [0001-Implement-derivative-of-gegenbauer-n-a-x-w.r.t-x.patch](tarball://root/attachments/some-uuid/ticket21639/0001-Implement-derivative-of-gegenbauer-n-a-x-w.r.t-x.patch) by mafra created at 2016-10-04 17:06:51",
    "created_at": "2016-10-04T17:06:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21402#issuecomment-297193",
    "user": "mafra"
}
```

Attachment [0001-Implement-derivative-of-gegenbauer-n-a-x-w.r.t-x.patch](tarball://root/attachments/some-uuid/ticket21639/0001-Implement-derivative-of-gegenbauer-n-a-x-w.r.t-x.patch) by mafra created at 2016-10-04 17:06:51



---

archive/issue_comments_297194.json:
```json
{
    "body": "Thanks. I would like to extend this ticket with derivatives on the second index:\n\n```\nIn [3]: gegenbauer(n,m,x)\nOut[3]: gegenbauer(n, m, x)\n\nIn [4]: _.diff(m)\nOut[4]: \nn - 1                                                                          \n ____                                                                          \n \u2572                                                                             \n  \u2572   \u239b\u239b      -k + n    \u239e                                                      \n   \u2572  \u239c\u239d2\u22c5(-1)       + 2\u23a0\u22c5(k + m)\u22c5gegenbauer(k, m, x)     \u239b         2\u22c5k + 2      \n   \u2571  \u239c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 + \u239c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  \u2571   \u239d            (-k + n)\u22c5(k + 2\u22c5m + n)                \u239d(k + 2\u22c5m)\u22c5(2\u22c5k + 2\u22c5m +\n \u2571                                                                             \n \u203e\u203e\u203e\u203e                                                                          \nk = 0                                                                          \n\n                                       \n                                       \n                                       \n                                      \u239e\n           2     \u239e                    \u239f\n\u2500\u2500\u2500 + \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u239f\u22c5gegenbauer(n, m, x) \u239f\n 1)   k + 2\u22c5m + n \u23a0                    \u23a0\n                                       \n```\n\nI'll both implement in Pynac directly. See also #21644.",
    "created_at": "2016-10-05T06:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21402#issuecomment-297194",
    "user": "@rwst"
}
```

Thanks. I would like to extend this ticket with derivatives on the second index:

```
In [3]: gegenbauer(n,m,x)
Out[3]: gegenbauer(n, m, x)

In [4]: _.diff(m)
Out[4]: 
n - 1                                                                          
 ____                                                                          
 ╲                                                                             
  ╲   ⎛⎛      -k + n    ⎞                                                      
   ╲  ⎜⎝2⋅(-1)       + 2⎠⋅(k + m)⋅gegenbauer(k, m, x)     ⎛         2⋅k + 2      
   ╱  ⎜────────────────────────────────────────────── + ⎜──────────────────────
  ╱   ⎝            (-k + n)⋅(k + 2⋅m + n)                ⎝(k + 2⋅m)⋅(2⋅k + 2⋅m +
 ╱                                                                             
 ‾‾‾‾                                                                          
k = 0                                                                          

                                       
                                       
                                       
                                      ⎞
           2     ⎞                    ⎟
─── + ───────────⎟⋅gegenbauer(n, m, x) ⎟
 1)   k + 2⋅m + n ⎠                    ⎠
                                       
```

I'll both implement in Pynac directly. See also #21644.



---

archive/issue_comments_297195.json:
```json
{
    "body": "The second case would depend on #21645.",
    "created_at": "2016-10-05T07:31:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21402#issuecomment-297195",
    "user": "@rwst"
}
```

The second case would depend on #21645.



---

archive/issue_comments_297196.json:
```json
{
    "body": "The first case is https://github.com/pynac/pynac/commit/6587fdc83ef1b002b583339bca70bcf94e50535c\n\nDoctests will be in the Pynac upgrade ticket, can be already seen at https://github.com/pynac/sage/commit/85726b14a96eb91c8fd70c1e76e729230e606a15",
    "created_at": "2016-10-05T07:47:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21402#issuecomment-297196",
    "user": "@rwst"
}
```

The first case is https://github.com/pynac/pynac/commit/6587fdc83ef1b002b583339bca70bcf94e50535c

Doctests will be in the Pynac upgrade ticket, can be already seen at https://github.com/pynac/sage/commit/85726b14a96eb91c8fd70c1e76e729230e606a15



---

archive/issue_comments_297197.json:
```json
{
    "body": "Thanks for adding the derivative wrt m, I wasn't aware of this identity (where did you get it?).\n\nBtw, what is the guiding principle to decide if things should go into pynac or pure sage?\n\nI was under the impression that 'performance' was the primary factor to move things to pynac. Is this the case here?",
    "created_at": "2016-10-05T16:32:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21402#issuecomment-297197",
    "user": "mafra"
}
```

Thanks for adding the derivative wrt m, I wasn't aware of this identity (where did you get it?).

Btw, what is the guiding principle to decide if things should go into pynac or pure sage?

I was under the impression that 'performance' was the primary factor to move things to pynac. Is this the case here?



---

archive/issue_comments_297198.json:
```json
{
    "body": "Replying to [comment:7 mafra]:\n> Thanks for adding the derivative wrt m, I wasn't aware of this identity (where did you get it?).\n\nThis is from SymPy.\n\n> Btw, what is the guiding principle to decide if things should go into pynac or pure sage?\n> \n> I was under the impression that 'performance' was the primary factor to move things to pynac. Is this the case here?\n\nYou are right, in many cases this is the reason. One other reason can be that when all the function code is already in Pynac then for clarity add the new functionality there.",
    "created_at": "2016-10-06T06:12:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21402#issuecomment-297198",
    "user": "@rwst"
}
```

Replying to [comment:7 mafra]:
> Thanks for adding the derivative wrt m, I wasn't aware of this identity (where did you get it?).

This is from SymPy.

> Btw, what is the guiding principle to decide if things should go into pynac or pure sage?
> 
> I was under the impression that 'performance' was the primary factor to move things to pynac. Is this the case here?

You are right, in many cases this is the reason. One other reason can be that when all the function code is already in Pynac then for clarity add the new functionality there.



---

archive/issue_comments_297199.json:
```json
{
    "body": "Replying to [comment:8 rws]:\n> Replying to [comment:7 mafra]:\n> > Btw, what is the guiding principle to decide if things should go into pynac or pure sage?\n> > \n> > I was under the impression that 'performance' was the primary factor to move things to pynac. Is this the case here?\n> \n> You are right, in many cases this is the reason. One other reason can be that when all the function code is already in Pynac then for clarity add the new functionality there.\n\nIMHO, Pynac should be reserved for performance reasons only.\n\nAdding the derivative functions to Pynac only complicates the situation here as we lose a unified handling of the derivatives within the Python file, like in this case with 'hermite' needing a fix in Pynac and gen_laguerre in Sage. I don't think this adds to 'clarity'.\n\nSo I disagree with moving the derivative of gegenbauer to Pynac, as it is not performance motivated and could be easily done in Sage.",
    "created_at": "2016-10-06T08:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21402#issuecomment-297199",
    "user": "mafra"
}
```

Replying to [comment:8 rws]:
> Replying to [comment:7 mafra]:
> > Btw, what is the guiding principle to decide if things should go into pynac or pure sage?
> > 
> > I was under the impression that 'performance' was the primary factor to move things to pynac. Is this the case here?
> 
> You are right, in many cases this is the reason. One other reason can be that when all the function code is already in Pynac then for clarity add the new functionality there.

IMHO, Pynac should be reserved for performance reasons only.

Adding the derivative functions to Pynac only complicates the situation here as we lose a unified handling of the derivatives within the Python file, like in this case with 'hermite' needing a fix in Pynac and gen_laguerre in Sage. I don't think this adds to 'clarity'.

So I disagree with moving the derivative of gegenbauer to Pynac, as it is not performance motivated and could be easily done in Sage.



---

archive/issue_comments_297200.json:
```json
{
    "body": "You would not believe how much slower any Python (and Cython) code is versus C/C++. That's for example why SymPy has extraordinary performance problems for even simple computations, and why they urgently push the SymEngine project. I therefore feel justified to replace *any !Python/Cython code with C++, and contrarily to SymPy we are in the fortunate position that Pynac is already integrated in Sage. While the time when to do this transcription may certainly be a matter of debate, the necessity itself is not.",
    "created_at": "2016-10-06T09:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21402#issuecomment-297200",
    "user": "@rwst"
}
```

You would not believe how much slower any Python (and Cython) code is versus C/C++. That's for example why SymPy has extraordinary performance problems for even simple computations, and why they urgently push the SymEngine project. I therefore feel justified to replace *any !Python/Cython code with C++, and contrarily to SymPy we are in the fortunate position that Pynac is already integrated in Sage. While the time when to do this transcription may certainly be a matter of debate, the necessity itself is not.



---

archive/issue_comments_297201.json:
```json
{
    "body": "Replying to [comment:10 rws]:\n> You would not believe how much slower any Python (and Cython) code is versus C/C++. That's for example why SymPy has extraordinary performance problems for even simple computations, and why they urgently push the SymEngine project. I therefore feel justified to replace *any !Python/Cython code with C++, and contrarily to SymPy we are in the fortunate position that Pynac is already integrated in Sage. While the time when to do this transcription may certainly be a matter of debate, the necessity itself is not.\n\nFair enough, thanks!",
    "created_at": "2016-10-06T09:41:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21402",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21402#issuecomment-297201",
    "user": "mafra"
}
```

Replying to [comment:10 rws]:
> You would not believe how much slower any Python (and Cython) code is versus C/C++. That's for example why SymPy has extraordinary performance problems for even simple computations, and why they urgently push the SymEngine project. I therefore feel justified to replace *any !Python/Cython code with C++, and contrarily to SymPy we are in the fortunate position that Pynac is already integrated in Sage. While the time when to do this transcription may certainly be a matter of debate, the necessity itself is not.

Fair enough, thanks!
