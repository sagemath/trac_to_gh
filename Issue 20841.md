# Issue 20841: failing doctest in TamariIntervalPosets_size

Issue created by migration from https://trac.sagemath.org/ticket/21078

Original creator: vdelecroix

Original creation time: 2016-07-23 23:01:05

CC:  vivianepons chapoton tscrim gchatel kdilks

There is a failing doctest in `sage/combinat/interval_posets.py` in sage-7.3.beta9

```
sage: from sage.combinat.interval_posets import TamariIntervalPosets_size
sage: for i in xrange(6): TestSuite(TamariIntervalPosets_size(i)).run()
------------------------------------------------------------
The following tests failed: _test_cardinality
Failure in _test_cardinality:
Traceback (most recent call last):
  File "/opt/sage/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py", line 283, in run
    test_method(tester = tester)
  File "/opt/sage/local/lib/python2.7/site-packages/sage/categories/sets_cat.py", line 1410, in _test_cardinality
    "the output of the method cardinality must either be a Sage integer or infinity. Not {}.".format(type(cardinality)))
  File "/opt/sage/local/lib/python/unittest/case.py", line 424, in assertTrue
    raise self.failureException(msg)
AssertionError: the output of the method cardinality must either be a Sage integer or infinity. Not <type 'int'>.
------------------------------------------------------------
The following tests failed: _test_cardinality
```



---

Comment by vdelecroix created at 2016-07-24 00:26:59

probably due to #20240


---

Comment by vbraun created at 2016-07-24 09:15:58

I can't reproduce. #20921 seems related.


---

Comment by vdelecroix created at 2016-07-24 13:57:37

2/3 patchbots are able to reproduce it

    https://patchbot.sagemath.org/ticket/0/

may be related to the fact that coxeter3 is present... I don't know.


---

Comment by vdelecroix created at 2016-07-24 14:11:58

Note that the failure is order dependent because of `UniqueRepresentation` that thinks that Sage Integer 1 is the same as Python int 1.

```
sage: from sage.combinat.interval_posets import TamariIntervalPosets_size
sage: T1 = TamariIntervalPosets_size(1)
sage: T2 = TamariIntervalPosets_size(1r)
sage: print (parent(T1._size), parent(T2._size))
(Integer Ring, Integer Ring)
```

vs

```
sage: from sage.combinat.interval_posets import TamariIntervalPosets_size
sage: T2 = TamariIntervalPosets_size(1r)
sage: T1 = TamariIntervalPosets_size(1)
sage: print (parent(T1._size), parent(T2._size))
(<type 'int'>, <type 'int'>)
```



---

Comment by tscrim created at 2016-07-24 14:35:41

It seems like the best solution is probably to make sure the output of `cardinality()` is in `ZZ`.


---

Comment by vdelecroix created at 2016-07-24 14:50:45

It will automatically the case if the attribute `_size` is itself an `Integer`.


---

Comment by vdelecroix created at 2016-07-25 22:28:23

New commits:


---

Comment by vdelecroix created at 2016-07-25 22:28:23

Changing status from new to needs_review.


---

Comment by tscrim created at 2016-07-26 03:54:07

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2016-07-26 03:54:07

I think this is a better test too. Thanks. (Also sorry for not doing it myself; I've been traveling the past few days.)


---

Comment by vdelecroix created at 2016-07-26 14:16:29

The previous doctest was actually a *mistake*. The `__clascall_private__` is not inherited.


---

Comment by vdelecroix created at 2016-07-26 14:16:35

Thanks for the review!


---

Comment by vbraun created at 2016-07-27 20:24:47

Resolution: fixed
