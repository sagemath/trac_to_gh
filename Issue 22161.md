# Issue 22161: LaurentPolynomial_mpair.__init__ modifies input

Issue created by migration from Trac.

Original creator: etn40ff

Original creation time: 2017-02-20 20:22:00

CC:  dkrenn

Creating mutlivariate Laurent polynomials from other mutlivariate Laurent polynomials sometimes fails.


```

        sage: LQ = LaurentPolynomialRing(QQ, 'x0, x1, x2, y0, y1, y2, y3, y4, y5')
        sage: LZ = LaurentPolynomialRing(ZZ, 'x0, x1, x2, y0, y1, y2, y3, y4, y5')
        sage: LQ.inject_variables()
        Defining x0, x1, x2, y0, y1, y2, y3, y4, y5
        sage: x2^-1*y0*y1*y2*y3*y4*y5 + x1^-1*x2^-1*y0*y1*y3*y4 + x0^-1 in LZ
        True
        sage: x2^-1*y0*y1*y2*y3*y4*y5 + x1^-1*x2^-1*y0*y1*y3*y4 + x0^-1*x1^-1*y0*y3 + x0^-1 in LZ
        Traceback (most recent call last):
        ...
        AttributeError: 'tuple' object has no attribute 'esub'

```


Apparently this is due to the fact that `LaurentPolynomial_mpair.__init__` changes the keys of the input dictionary.


---

Comment by etn40ff created at 2017-02-20 20:28:30

Your patch seems to work.
Thanks
----
New commits:


---

Comment by git created at 2017-02-21 05:18:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2017-02-21 05:22:01

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-02-21 07:39:20

The correct solution is to _not_ modify the input data (instead of working around the fact that the input data is modified).

It would be good to add an explicit doctest showing that the input is not modified. Something like

```
sage: LQ.<x,y> = LaurentPolynomialRing(QQ)
sage: D = {(-1, 1): 1}
sage: type(D.keys()[0])
<type 'tuple'>
sage: LQ(D)
x^-1*y
sage: type(D.keys()[0])
<type 'tuple'>
```



---

Comment by jdemeyer created at 2017-02-21 07:39:20

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2017-02-21 07:39:20

Changing priority from major to critical.


---

Comment by dkrenn created at 2017-02-21 08:00:30

Replying to [comment:5 jdemeyer]:
> The correct solution is to _not_ modify the input data (instead of working around the fact that the input data is modified).

I completely agree. I'll adapt the patch during the day (once my 7.6.beta4 has recompiled again...).


---

Comment by git created at 2017-02-21 13:48:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2017-02-21 13:50:34

Changing status from needs_work to needs_review.


---

Comment by dkrenn created at 2017-02-21 13:50:34

Replying to [comment:5 jdemeyer]:
> The correct solution is to _not_ modify the input data (instead of working around the fact that the input data is modified).

Done. Needs_review (...and let's see what the patchbot says).


---

Comment by jdemeyer created at 2017-02-21 14:05:27

In the doctests, you can simplify code of the form

```
id_y = id(y)
id(x) == id_y
```

by

```
x is y
```



---

Comment by jdemeyer created at 2017-02-21 14:05:27

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-02-21 14:07:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2017-02-21 14:08:40

Replying to [comment:9 jdemeyer]:
> In the doctests, you can simplify code of the form
> {{{
> id(x) == id(y)
> }}}
> by
> {{{
> x is y
> }}}

Oh, indeed :) ...done.


---

Comment by dkrenn created at 2017-02-21 14:08:40

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-02-21 14:10:35

If tests pass, you can set this to positive_review.


---

Comment by git created at 2017-02-22 09:47:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2017-02-23 10:59:07

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-02-24 14:49:15

Resolution: fixed
