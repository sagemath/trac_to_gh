# Issue 31351: Normaliz with e-antic 1.0 test ticket

Issue created by migration from https://trac.sagemath.org/ticket/31588

Original creator: mkoeppe

Original creation time: 2021-03-31 19:11:02

CC:  saraedum vdelecroix winfried jipilab @kliem dimpase mjo tscrim

Needs:
- Add ANTIC package
- check boost package
- Upgrade e-antic
- Upgrade Normaliz

Depends on dropping support for system FLINT < 2.6 (done in #31525)

We can use this ticket also as the target ticket for the ci-sage tests of e-antic 1.0


---

Comment by mkoeppe created at 2022-02-08 19:53:11

Any takers for `spkg-configure.m4` and `distros/` for ANTIC?
----
New commits:


---

Comment by git created at 2022-02-08 20:09:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-08 20:14:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-08 20:34:47

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2022-02-08 21:16:37

`ubuntu-trusty-standard`:

```
  [e_antic-1.0.3]   configure: error: *** A compiler with support for C++14 language features is required.
```



---

Comment by mkoeppe created at 2022-02-08 21:30:58

`ubuntu-xenial-standard`:

```
In file included from renf_elem/../rand_generator.hpp:17:0,
                 from renf_elem/t-get_d.cpp:14:
renf_elem/t-get_d.cpp: In function 'void d_get_fmpq(double, fmpq*)':
renf_elem/t-get_d.cpp:25:23: error: 'isnormal' was not declared in this scope
     REQUIRE(isnormal(d));
                       ^
renf_elem/t-get_d.cpp:25:23: note: suggested alternative:
In file included from /usr/include/c++/5/random:38:0,
                 from /usr/include/c++/5/bits/stl_algo.h:66,
                 from /usr/include/c++/5/algorithm:62,
                 from renf_elem/../external/catch2/single_include/catch2/catch.hpp:3595,
                 from renf_elem/../rand_generator.hpp:17,
                 from renf_elem/t-get_d.cpp:14:
/usr/include/c++/5/cmath:661:5: note:   'std::isnormal'
     isnormal(_Tp __x)
     ^
```

(https://github.com/mkoeppe/Normaliz/runs/5115731106?check_suite_focus=true)


---

Comment by git created at 2022-02-08 21:32:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-08 21:39:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-02-08 21:44:36

`ubuntu-bionic-i386-standard`:

```
PASS: renfxx/t-binop
FAIL: renfxx/t-cmp
PASS: renfxx/t-assignment
============================================================================
Testsuite summary for libeantic 1.0.3
============================================================================
```

(https://github.com/mkoeppe/Normaliz/runs/5115734755?check_suite_focus=true)

Likewise on `debian-buster-i386-standard`


---

Comment by mkoeppe created at 2022-02-08 21:47:51

`cygwin-standard`:

```
/usr/lib/gcc/x86_64-pc-cygwin/11/../../../../x86_64-pc-cygwin/bin/ld: renfxx/t-assignment.o: in function `bool Catch::compareEqual<eantic::renf_elem_class, eantic::renf_elem_class>(eantic::renf_elem_class const&, eantic::renf_elem_class const&)':
/opt/sage-normaliz-d44452a40c94e3037a71702b8d014409504b94d7/var/tmp/sage/build/e_antic-1.0.3/src/libeantic/test/renfxx/../external/catch2/single_include/catch2/catch.hpp:2311: undefined reference to `eantic::operator==(eantic::renf_elem_class const&, eantic::renf_elem_class const&)'
```

(many errors)

(https://github.com/mkoeppe/Normaliz/runs/5115730494?check_suite_focus=true)


---

Comment by mkoeppe created at 2022-02-08 22:11:49

`@`saraedum, `@`vdelecroix - these portability failures will need some upstream help


---

Comment by saraedum created at 2022-02-26 03:23:16

Replying to [comment:24 mkoeppe]:
> `ubuntu-bionic-i386-standard`:
> {{{
> PASS: renfxx/t-binop
> FAIL: renfxx/t-cmp
> PASS: renfxx/t-assignment
> ============================================================================
> Testsuite summary for libeantic 1.0.3
> ============================================================================
> }}}
> (https://github.com/mkoeppe/Normaliz/runs/5115734755?check_suite_focus=true)
> 
> Likewise on `debian-buster-i386-standard`

We fixed some i386 fedora issues in 1.1.0. That might be the same problem. (I don't see the logs of the test runs anywhere so I am not sure.)


---

Comment by saraedum created at 2022-02-26 03:24:53

Replying to [comment:25 mkoeppe]:
> `cygwin-standard`:
> {{{
> /usr/lib/gcc/x86_64-pc-cygwin/11/../../../../x86_64-pc-cygwin/bin/ld: renfxx/t-assignment.o: in function `bool Catch::compareEqual<eantic::renf_elem_class, eantic::renf_elem_class>(eantic::renf_elem_class const&, eantic::renf_elem_class const&)':
> /opt/sage-normaliz-d44452a40c94e3037a71702b8d014409504b94d7/var/tmp/sage/build/e_antic-1.0.3/src/libeantic/test/renfxx/../external/catch2/single_include/catch2/catch.hpp:2311: undefined reference to `eantic::operator==(eantic::renf_elem_class const&, eantic::renf_elem_class const&)'
> }}}
> (many errors)
> 
> (https://github.com/mkoeppe/Normaliz/runs/5115730494?check_suite_focus=true)
> 

This is a problem when building with -fvisibility=hidden. It was fixed in 1.1.0.


---

Comment by saraedum created at 2022-02-26 03:26:05

Replying to [comment:16 mkoeppe]:
> `ubuntu-trusty-standard`:
> {{{
>   [e_antic-1.0.3]   configure: error: *** A compiler with support for C++14 language features is required.
> }}}

True. Can't we assume a C++ 14 compiler?


---

Comment by saraedum created at 2022-02-26 03:30:03

Replying to [comment:18 mkoeppe]:
> `ubuntu-xenial-standard`:
> {{{
> In file included from renf_elem/../rand_generator.hpp:17:0,
>                  from renf_elem/t-get_d.cpp:14:
> renf_elem/t-get_d.cpp: In function 'void d_get_fmpq(double, fmpq*)':
> renf_elem/t-get_d.cpp:25:23: error: 'isnormal' was not declared in this scope
>      REQUIRE(isnormal(d));
>                        ^
> renf_elem/t-get_d.cpp:25:23: note: suggested alternative:
> In file included from /usr/include/c++/5/random:38:0,
>                  from /usr/include/c++/5/bits/stl_algo.h:66,
>                  from /usr/include/c++/5/algorithm:62,
>                  from renf_elem/../external/catch2/single_include/catch2/catch.hpp:3595,
>                  from renf_elem/../rand_generator.hpp:17,
>                  from renf_elem/t-get_d.cpp:14:
> /usr/include/c++/5/cmath:661:5: note:   'std::isnormal'
>      isnormal(_Tp __x)
>      ^
> }}}
> (https://github.com/mkoeppe/Normaliz/runs/5115731106?check_suite_focus=true)

Probably fixed in https://github.com/flatsurf/e-antic/pull/234.


---

Comment by mkoeppe created at 2022-02-26 05:39:49

Replying to [comment:29 saraedum]:
> Replying to [comment:16 mkoeppe]:
> > `ubuntu-trusty-standard`:
> > {{{
> >   [e_antic-1.0.3]   configure: error: *** A compiler with support for C++14 language features is required.
> > }}}
> 
> True. Can't we assume a C++ 14 compiler?

We will be able to assume it after #33316 (Sage 9.7)


---

Comment by saraedum created at 2022-02-26 07:34:39

I see. e-antic cannot compile anymore without a C++ 14 compiler. Is that a problem for [SageMath](SageMath)? (It's only an optional package, so I guess that's fine?)


---

Comment by dimpase created at 2022-02-26 09:17:44

Replying to [comment:32 saraedum]:
> I see. e-antic cannot compile anymore without a C++ 14 compiler. Is that a problem for [SageMath](SageMath)? (It's only an optional package, so I guess that's fine?)

The optional packages are supposed to work on all supported platforms in a release.


---

Comment by mkoeppe created at 2022-02-26 17:30:59

Replying to [comment:32 saraedum]:
> I see. e-antic cannot compile anymore without a C++ 14 compiler. Is that a problem for [SageMath](SageMath)?

As I said, it will not be problem after #33316. Which is why #33316 is a dependency of this ticket, and the milestone is set to 9.7.


---

Comment by git created at 2022-05-13 22:17:12

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2022-05-14 02:44:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-05-15 06:41:30

On `cygwin-standard` (https://github.com/sagemath/sagetrac-mirror/runs/6436986860)

```
  g++ -shared -Wl,--enable-auto-image-base -L/opt/sage-9ea0d4990a38b1d676288006a2f29906a2c8d146/lib -Wl,-rpath,/opt/sage-9ea0d4990a38b1d676288006a2f29906a2c8d146/lib -L/opt/sage-9ea0d4990a38b1d676288006a2f29906a2c8d146/lib -Wl,-rpath,/opt/sage-9ea0d4990a38b1d676288006a2f29906a2c8d146/lib -g -O2 build/temp.cygwin-3.3.5-x86_64-3.9/NormalizModule.o -L/opt/sage-9ea0d4990a38b1d676288006a2f29906a2c8d146/lib/python3.9/config -L/usr/lib -lnormaliz -lpython3.9 -o build/lib.cygwin-3.3.5-x86_64-3.9/PyNormaliz_cpp.cpython-39-x86_64-cygwin.dll
  /usr/lib/gcc/x86_64-pc-cygwin/11/../../../../x86_64-pc-cygwin/bin/ld: build/temp.cygwin-3.3.5-x86_64-3.9/NormalizModule.o: in function `std::vector<eantic::renf_elem_class, std::allocator<eantic::renf_elem_class> >::size() const':
  /usr/lib/gcc/x86_64-pc-cygwin/11/include/c++/bits/stl_vector.h:919: undefined reference to `__imp__ZN6eantic15renf_elem_classaSERKS0_'
  /usr/lib/gcc/x86_64-pc-cygwin/11/../../../../x86_64-pc-cygwin/bin/ld: build/temp.cygwin-3.3.5-x86_64-3.9/NormalizModule.o: in function `void std::_Destroy_aux<false>::__destroy<__gnu_cxx::__normal_iterator<eantic::renf_elem_class*, std::vector<eantic::renf_elem_class, std::allocator<eantic::renf_elem_class> > > >(__gnu_cxx::__normal_iterator<eantic::renf_elem_class*, std::vector<eantic::renf_elem_class, std::allocator<eantic::renf_elem_class> > >, __gnu_cxx::__normal_iterator<eantic::renf_elem_class*, std::vector<eantic::renf_elem_class, std::allocator<eantic::renf_elem_class> > >)':
  /usr/lib/gcc/x86_64-pc-cygwin/11/include/c++/bits/stl_construct.h:162: undefined reference to `__imp__ZN6eantic15renf_elem_classD1Ev'
  /usr/lib/gcc/x86_64-pc-cygwin/11/../../../../x86_64-pc-cygwin/bin/ld: build/temp.cygwin-3.3.5-x86_64-3.9/NormalizModule.o: in function `eantic::renf_elem_class* std::__uninitialized_copy<false>::__uninit_copy<__gnu_cxx::__normal_iterator<eantic::renf_elem_class const*, std::vector<eantic::renf_elem_class, std::allocator<eantic::renf_elem_class> > >, eantic::renf_elem_class*>(__gnu_cxx::__normal_iterator<eantic::renf_elem_class const*, std::vector<eantic::renf_elem_class, std::allocator<eantic::renf_elem_class> > >, __gnu_cxx::__normal_iterator<eantic::renf_elem_class const*, std::vector<eantic::renf_elem_class, std::allocator<eantic::renf_elem_class> > >, eantic::renf_elem_class*)':
  /usr/lib/gcc/x86_64-pc-cygwin/11/include/c++/bits/stl_uninitialized.h:91: undefined reference to `__imp__ZN6eantic15renf_elem_classC1ERKS0_'
  /usr/lib/gcc/x86_64-pc-cygwin/11/../../../../x86_64-pc-cygwin/bin/ld: build/temp.cygwin-3.3.5-x86_64-3.9/NormalizModule.o: in function `void std::_Destroy_aux<false>::__destroy<eantic::renf_elem_class*>(eantic::renf_elem_class*, eantic::renf_elem_class*)':
  /usr/lib/gcc/x86_64-pc-cygwin/11/include/c++/bits/stl_construct.h:162: undefined reference to `__imp__ZN6eantic15renf_elem_classD1Ev'
  /usr/lib/gcc/x86_64-pc-cygwin/11/../../../../x86_64-pc-cygwin/bin/ld: build/temp.cygwin-3.3.5-x86_64-3.9/NormalizModule.o: in function `eantic::renf_elem_class* std::__copy_move<false, false, std::random_access_iterator_tag>::__copy_m<eantic::renf_elem_class*, eantic::renf_elem_class*>(eantic::renf_elem_class*, eantic::renf_elem_class*, eantic::renf_elem_class*)':
  /usr/lib/gcc/x86_64-pc-cygwin/11/include/c++/bits/stl_algobase.h:383: undefined reference to `__imp__ZN6eantic15renf_elem_classaSERKS0_'
  /usr/lib/gcc/x86_64-pc-cygwin/11/../../../../x86_64-pc-cygwin/bin/ld: build/temp.cygwin-3.3.5-x86_64-3.9/NormalizModule.o: in function `eantic::renf_elem_class* std::__uninitialized_copy<false>::__uninit_copy<eantic::renf_elem_class*, eantic::renf_elem_class*>(eantic::renf_elem_class*, eantic::renf_elem_class*, eantic::renf_elem_class*)':
  /usr/lib/gcc/x86_64-pc-cygwin/11/include/c++/bits/stl_uninitialized.h:91: undefined reference to `__imp__ZN6eantic15renf_elem_classC1ERKS0_'
  /usr/lib/gcc/x86_64-pc-cygwin/11/../../../../x86_64-pc-cygwin/bin/ld: build/temp.cygwin-3.3.5-x86_64-3.9/NormalizModule.o: in function `void std::_Destroy<eantic::renf_elem_class>(eantic::renf_elem_class*)':
  /usr/lib/gcc/x86_64-pc-cygwin/11/include/c++/bits/stl_construct.h:151: undefined reference to `__imp__ZN6eantic15renf_elem_classD1Ev'
  /usr/lib/gcc/x86_64-pc-cygwin/11/../../../../x86_64-pc-cygwin/bin/ld: /usr/lib/gcc/x86_64-pc-cygwin/11/include/c++/bits/stl_construct.h:151: undefined reference to `__imp__ZN6eantic15renf_elem_classD1Ev'
.....
```



---

Comment by git created at 2022-06-16 18:21:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2022-07-14 21:16:17

Workflows for this are now running at https://github.com/saraedum/sage/actions. (Pushing a tag starts the workflows.)


---

Comment by mkoeppe created at 2022-07-16 19:12:44

this will work better after merging 9.7.beta5


---

Comment by tscrim created at 2022-08-03 07:53:57

New commits:


---

Comment by git created at 2022-09-24 23:37:38

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2022-09-26 00:58:10

Tests in https://github.com/mkoeppe/sage/actions/runs/3120192887 look OK on all Linux platforms. (Failures in docbuild etc. are unrelated - will be fixed in #34572.)


---

Comment by mkoeppe created at 2022-09-26 00:59:05

Changing status from new to needs_review.


---

Comment by git created at 2022-09-26 01:16:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-26 01:35:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-26 01:43:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-10-02 03:53:41

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-10-02 03:53:41

LGTM.


---

Comment by mkoeppe created at 2022-10-02 04:45:56

Thanks!


---

Comment by vbraun created at 2022-10-11 09:14:55

Resolution: fixed
