# Issue 10970: bzip2 only considers the SAGE64 environment variable on Solaris and OS X.

archive/issues_010970.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  jhpalmieri\n\nI discovered this after trying to debug a Linux installation.\n\nThe bzip2 package (in particular the file `$SAGE_ROOT/spkg/base/bzip2-1.0.5-install`) handles SAGE64 in a different way to the vast majority (if not all) other packages. It has:\n\n\n```\nif [ `uname` = \"Darwin\" -a \"$SAGE64\" = \"yes\" ]; then\n   echo \"Building 64 bit OSX release\"\n   CFLAGS=\"-O2 -g -m64 \" && export CFLAGS\nfi\n\nif [ `uname` = \"SunOS\" -a \"$SAGE64\" = \"yes\" ]; then\n   echo \"Building 64 bit Solaris release\"\n   CFLAGS=\"-O2 -g -m64 \" && export CFLAGS\nfi\n```\n\n\nFaster, more flexible and more portable would be:\n\n\n```\nif [ \"x$CFLAG64\" = x ] ; then\n   CFLAG64=-m64\nfi\n\nif [ \"x$SAGE64\" = xyes ]; then\n   echo \"Building a 64 bit version of bzip2\"\n   CFLAGS=\"-O2 -g $CFLAG64 $CFLAGS\"\n   export CFLAGS\nfi\n```\n\n\nThis would\n* Work on any platform, which might be useful on some like AIX\n* Could help debug some Linux issues if Linux is building 32-bit. (I found this useful to help someone on sage-support)\n* Avoids two calls to `uname` \n* Allows any flag to be used for building 64-bit executable, not just the one use by Sun/Oracle compilers and GCC. Commerical compilers for both AIX and HP-UX use different flags. \n* Would allow any flags set by the user in CFLAGS to override those here. However, currently setting CFLAGS globally in Sage can not be considered a good idea, but that's a more general bug and well outside the scope of this ticket. \n\nDave\n\nIssue created by migration from https://trac.sagemath.org/ticket/11107\n\n",
    "created_at": "2011-04-01T08:35:56Z",
    "labels": [
        "build",
        "major",
        "bug"
    ],
    "title": "bzip2 only considers the SAGE64 environment variable on Solaris and OS X.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10970",
    "user": "drkirkby"
}
```
Assignee: GeorgSWeber

CC:  jhpalmieri

I discovered this after trying to debug a Linux installation.

The bzip2 package (in particular the file `$SAGE_ROOT/spkg/base/bzip2-1.0.5-install`) handles SAGE64 in a different way to the vast majority (if not all) other packages. It has:


```
if [ `uname` = "Darwin" -a "$SAGE64" = "yes" ]; then
   echo "Building 64 bit OSX release"
   CFLAGS="-O2 -g -m64 " && export CFLAGS
fi

if [ `uname` = "SunOS" -a "$SAGE64" = "yes" ]; then
   echo "Building 64 bit Solaris release"
   CFLAGS="-O2 -g -m64 " && export CFLAGS
fi
```


Faster, more flexible and more portable would be:


```
if [ "x$CFLAG64" = x ] ; then
   CFLAG64=-m64
fi

if [ "x$SAGE64" = xyes ]; then
   echo "Building a 64 bit version of bzip2"
   CFLAGS="-O2 -g $CFLAG64 $CFLAGS"
   export CFLAGS
fi
```


This would
* Work on any platform, which might be useful on some like AIX
* Could help debug some Linux issues if Linux is building 32-bit. (I found this useful to help someone on sage-support)
* Avoids two calls to `uname` 
* Allows any flag to be used for building 64-bit executable, not just the one use by Sun/Oracle compilers and GCC. Commerical compilers for both AIX and HP-UX use different flags. 
* Would allow any flags set by the user in CFLAGS to override those here. However, currently setting CFLAGS globally in Sage can not be considered a good idea, but that's a more general bug and well outside the scope of this ticket. 

Dave

Issue created by migration from https://trac.sagemath.org/ticket/11107





---

archive/issue_comments_118637.json:
```json
{
    "body": "Mercurial patch to clear up the bzip2 problem so SAGE64 works consistently on any platform, not just Solaris and OS X",
    "created_at": "2011-04-01T09:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10970#issuecomment-118637",
    "user": "drkirkby"
}
```

Mercurial patch to clear up the bzip2 problem so SAGE64 works consistently on any platform, not just Solaris and OS X



---

archive/issue_comments_118638.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-04-01T09:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10970#issuecomment-118638",
    "user": "drkirkby"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_118639.json:
```json
{
    "body": "Attachment",
    "created_at": "2011-04-01T09:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10970#issuecomment-118639",
    "user": "drkirkby"
}
```

Attachment



---

archive/issue_comments_118640.json:
```json
{
    "body": "I checked and found bzip2 is the **only** package with this bug, so I have updated the description to reflect this.\n\nDave",
    "created_at": "2011-04-01T12:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10970#issuecomment-118640",
    "user": "drkirkby"
}
```

I checked and found bzip2 is the **only** package with this bug, so I have updated the description to reflect this.

Dave



---

archive/issue_comments_118641.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-04-20T20:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10970#issuecomment-118641",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_118642.json:
```json
{
    "body": "The patch looks good to me.",
    "created_at": "2011-04-20T20:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10970#issuecomment-118642",
    "user": "jhpalmieri"
}
```

The patch looks good to me.



---

archive/issue_comments_118643.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-04-21T19:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10970",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10970#issuecomment-118643",
    "user": "jdemeyer"
}
```

Resolution: fixed
