# Issue 10970: bzip2 only considers the SAGE64 environment variable on Solaris and OS X.

Issue created by migration from https://trac.sagemath.org/ticket/11107

Original creator: drkirkby

Original creation time: 2011-04-01 08:35:56

Assignee: GeorgSWeber

CC:  jhpalmieri

I discovered this after trying to debug a Linux installation.

The bzip2 package (in particular the file `$SAGE_ROOT/spkg/base/bzip2-1.0.5-install`) handles SAGE64 in a different way to the vast majority (if not all) other packages. It has:


```
if [ `uname` = "Darwin" -a "$SAGE64" = "yes" ]; then
   echo "Building 64 bit OSX release"
   CFLAGS="-O2 -g -m64 " && export CFLAGS
fi

if [ `uname` = "SunOS" -a "$SAGE64" = "yes" ]; then
   echo "Building 64 bit Solaris release"
   CFLAGS="-O2 -g -m64 " && export CFLAGS
fi
```


Faster, more flexible and more portable would be:


```
if [ "x$CFLAG64" = x ] ; then
   CFLAG64=-m64
fi

if [ "x$SAGE64" = xyes ]; then
   echo "Building a 64 bit version of bzip2"
   CFLAGS="-O2 -g $CFLAG64 $CFLAGS"
   export CFLAGS
fi
```


This would
 * Work on any platform, which might be useful on some like AIX
 * Could help debug some Linux issues if Linux is building 32-bit. (I found this useful to help someone on sage-support)
 * Avoids two calls to `uname` 
 * Allows any flag to be used for building 64-bit executable, not just the one use by Sun/Oracle compilers and GCC. Commerical compilers for both AIX and HP-UX use different flags. 
 * Would allow any flags set by the user in CFLAGS to override those here. However, currently setting CFLAGS globally in Sage can not be considered a good idea, but that's a more general bug and well outside the scope of this ticket. 

Dave


---

Comment by drkirkby created at 2011-04-01 09:08:54

Mercurial patch to clear up the bzip2 problem so SAGE64 works consistently on any platform, not just Solaris and OS X


---

Comment by drkirkby created at 2011-04-01 09:10:13

Changing status from new to needs_review.


---

Attachment


---

Comment by drkirkby created at 2011-04-01 12:44:59

I checked and found bzip2 is the *only* package with this bug, so I have updated the description to reflect this.

Dave


---

Comment by jhpalmieri created at 2011-04-20 20:00:47

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2011-04-20 20:00:47

The patch looks good to me.


---

Comment by jdemeyer created at 2011-04-21 19:35:29

Resolution: fixed
