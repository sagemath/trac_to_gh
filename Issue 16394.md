# Issue 16394: Universal Cyclotomic Field doesn't handle int and Integer the same

Issue created by migration from Trac.

Original creator: tscrim

Original creation time: 2014-07-09 05:23:15

Assignee: tscrim

CC:  stumpc5

With 6.3.beta5 we have

```
sage: UCF = UniversalCyclotomicField()
sage: UCF(1) / 2
1/2
sage: UCF(1) / int(2)
0.5
```



---

Comment by chapoton created at 2014-07-24 16:12:35

The problem seems to happen in `__div__` when inversing a python int, giving a python float ?


```
sage: good = UCF(1) / 2
sage: good.value.monomial_coefficients()[(1,0)].parent()
Rational Field
sage: bad = UCF(1) / int(2)
sage: bad.value.monomial_coefficients()[(1,0)].parent()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-111-4afb4f7eca31> in <module>()
----> 1 bad.value.monomial_coefficients()[(Integer(1),Integer(0))].parent()

AttributeError: 'float' object has no attribute 'parent'
```



---

Comment by nbruin created at 2014-07-24 18:49:42

I suspect it's coming from

```
sage: int(2)^int(-1)
0.5
```

and

```
sage: UCF(1)*float(0.5)
0.5
```

So there are two things:
 - UCF should probably refuse to be multiplied by float (it refuses RDF)
 - division shouldn't just multiply the argument raised to "-1" (or at least don't do that for "int", since there it loses valuable information)


---

Comment by chapoton created at 2014-07-26 20:13:19

The problem about accepting multiplication by float may be there :

```
sage: UCF.<E> = UniversalCyclotomicField()
sage: E(3)._acted_upon_(float(2))
2.0*E(3)
```

and even more deeply in

```
sage: E(5).value._acted_upon_(float(2.3))
2.3*E(5)
sage: E(5).value._acted_upon_(float(2.3)).parent()
Free module generated by The indices of the Zumbroich basis over Rational Field
```



---

Comment by chapoton created at 2014-07-31 19:38:51

Ahah, maybe a bug in CombinatorialFreeModule ?

```
sage: C = CombinatorialFreeModule(QQ,['a','b','c'])
sage: B = C.basis()
sage: toto = B['a']
sage: toto*float(pi)
3.14159265359*B['a']
sage: _.parent()
Free module generated by {'a', 'b', 'c'} over Rational Field
```



---

Comment by vdelecroix created at 2015-04-09 22:30:28

Hello,

In #18152, I reimplemented the universal cyclotomic field using libgap (faster and more reliable). In that version the issue disappears. My goal would be to close this ticket as "won't fix" as soon as #18152 would be reviewed.

Vincent


---

Comment by chapoton created at 2015-05-24 13:41:28

now works with libgap version

And I have created #18487 for the problem in combinatorial free modules


---

Comment by chapoton created at 2015-05-24 13:41:28

Changing status from new to needs_review.


---

Comment by tscrim created at 2015-05-24 22:50:42

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-06-19 08:39:55

Resolution: fixed
