# Issue 18793: fix small bug in elliptic curve isogeny matrix of maps

Issue created by migration from https://trac.sagemath.org/ticket/19030

Original creator: cremona

Original creation time: 2015-08-14 11:52:53

Keywords: isogeny class

When constructing the isogeny class C of an elliptic curve (over Q or a number field) a partial matrix of maps between the curves is computed, available as C.isogenies().  However, some of the known maps were being overwriiten by 0 (used to indicate that the map was not known.

Example:

```
K.<a> = NumberField(x^2-2)
E = EllipticCurve([1, -1, 0, 3*a, -2*a - 2])
C = E.isogeny_class()
C.isogenies()
```

used to show only 2 nonzero entries, but now shows 4.

I did not add new doctests but two existing ones had to be changed, and these illustrate the improvement.

Why this matters:  it is important that there is a curve on the class from which you can get to every other curve by following the stored maps, for example to map across generators.  This was not the case i nthe above example, but now is.


---

Comment by cremona created at 2015-08-14 11:55:43

Changing status from new to needs_review.


---

Comment by cremona created at 2015-08-14 11:55:43

Apart from the doctest changes all that the patch does is move 2 lines inside a conditional.
----
New commits:


---

Comment by cremona created at 2015-08-15 13:00:46

When setting the "reverse" isogenies from the i'th curve to the j'th where we have seen the j'th before, the codomain is only a curve isomorphic to the j'the curve, not equal to it.  This does not arise over Q where all curves will have reduced minimal models, but does occur over number fields.

Example (after commit 0690288):


```
sage: K.<i> = NumberField(x^2+1)
sage: E = EllipticCurve([1, i + 1, 1, -72*i + 8, 95*i + 146])
sage: C = E.isogeny_class()
sage: curves = C.curves
sage: isos = C.isogenies()
sage: isos[0][3].codomain() == curves[3]
False
sage: isos[0][3].codomain().is_isomorphic(curves[3])
True
```


I will update the branch to fix this.


---

Comment by cremona created at 2015-08-15 13:00:46

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-08-15 13:51:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2015-08-15 13:53:07

Changing status from needs_work to needs_review.


---

Comment by cremona created at 2015-08-15 13:53:07

OK, done -- the doctests previously changed have been updated and a new test added to show that the fault cited above is no longer there.  I also tested on many hundreds of curves over Q(i), working with which had revealed the problem.


---

Comment by git created at 2015-08-15 13:54:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-09-10 22:25:44

Changing status from needs_review to positive_review.


---

Comment by cremona created at 2015-09-11 08:13:08

Thanks!


---

Comment by wuthrich created at 2015-09-11 08:27:32

:-) I was about to put a positive review to it. 

Just one question. What is the output of the example in the description suppose to be? I get that this curve is alone in its isogeny class with or without the patch.


---

Comment by cremona created at 2015-09-11 08:43:47

Replying to [comment:8 wuthrich]:
> :-) I was about to put a positive review to it. 
> 
> Just one question. What is the output of the example in the description suppose to be? I get that this curve is alone in its isogeny class with or without the patch.
> 
Good point, I must have pasted in the wrong example. I think the patch contains some new doctests which show the improved behaviour but (within the last few seconds) the branch has disappeared from the ticket, meaning that Volker has merged it (I think).


---

Comment by wuthrich created at 2015-09-11 09:02:50

That is what I thought. The documented examples are fine.


---

Comment by cremona created at 2015-09-11 11:48:20

Good.  My code currently gets generators for one curve in the class from Magma and uses these stored isogenies to move them across to the others.  When I am done the points will be put into the LMFDB.  I am finishing up the saturation code before doing the upload (this is the old #8829 which will be up for review within a few days).  Thanks for taking the time to look at it.


---

Comment by vbraun created at 2015-09-11 16:47:06

Resolution: fixed
