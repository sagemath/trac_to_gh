# Issue 14674: very slow taylor epansion for composite functions

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2013-07-11 14:29:48

Assignee: burcin

Keywords: taylor expansion, symbolic function

The following

```
f=sin(x*sin(x*sin(x*sin(x))))
f.series(x,8)
```

takes something like 30s, which seems a bit too much. Maybe there is some bottleneck somewhere ?

In the same spirit, one could try

```
sage: x=PowerSeriesRing(QQ,'x').gen()
sage: sin(x)
Traceback (most recent call last):
...
TypeError: cannot coerce arguments: no canonical coercion from Power Series Ring in x over Rational Field to Symbolic Ring
```

It would be good if one could apply symbolic functions to power series and get power series when possible.


---

Comment by fredrik.johansson created at 2013-07-11 16:22:43

Being able to apply functions to power series would be useful.

For anyone looking to implement this, note that flint can now natively evaluate elementary functions over `Q[This is the Trac macro *x* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x-macro)` and `(Z/nZ)[This is the Trac macro *x* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x-macro)` (using `fmpq_poly_sin_series` in this case).


---

Comment by chapoton created at 2013-07-12 07:42:25

some timings:

```
sage: %timeit f.taylor(x,0,8)
100 loops, best of 3: 6.46 ms per loop
sage: %timeit f.series(x,8)
1 loops, best of 3: 42.1 s per loop
```



---

Comment by mmezzarobba created at 2014-03-05 12:40:57

Replying to [ticket:14878 chapoton]:
> Maybe there is some bottleneck somewhere ?

GiNaC's series expansion code seems to be designed for very small orders only. It is incredibly inefficient otherwise:


```
ginsh - GiNaC Interactive Shell (ginac V1.6.2)
  __,  _______  Copyright (C) 1999-2011 Johannes Gutenberg University Mainz,
 (__) *       | Germany.  This is free software with ABSOLUTELY NO WARRANTY.
  ._) i N a C | You are welcome to redistribute it under certain conditions.
<-------------' For details type `warranty;'.

Type ?? for a list of help topics.
> time(series(sin(x*sin(x*sin(x*sin(x)))), x==0, 8));
2.352s                                                                          
> time(series(sin(x*sin(x*sin(x*sin(x)))), x==0, 12));                         
40.104s                                                                         
```


Judging by the number of calls to `gcd`/`lcm` reported by `%prun f.series(x==0, k)` for successive `k`, the number of operations in ℚ seems to grow at least exponentially with `k`, and perhaps like `k!` (while it should be something like `O(k³)` in a naive implementation, and essentially linear in a careful one).

I think that's the heart of the problem, and the difference between the timings with sage and with ginsh is pynac overhead (which should of course be minimized, but only costs a constant factor).


---

Comment by chapoton created at 2015-10-08 19:58:43

New commits:


---

Comment by git created at 2015-10-09 06:46:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-01-27 20:29:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-02-05 20:22:46

branch transfered to #20017


---

Comment by rws created at 2016-02-15 07:10:35

The relevant Pynac ticket is https://github.com/pynac/pynac/issues/116


---

Comment by rws created at 2016-10-20 15:17:37

New commits:


---

Comment by rws created at 2016-10-20 15:17:37

Changing status from new to needs_review.


---

Comment by chapoton created at 2016-11-11 21:39:23

ok, looks good to me. Thanks for your work. Please add your name as author.


---

Comment by chapoton created at 2016-11-11 21:39:23

Changing status from needs_review to positive_review.


---

Comment by rws created at 2016-11-12 07:10:23

Thanks too.


---

Comment by vbraun created at 2016-11-15 23:25:14

Resolution: fixed
