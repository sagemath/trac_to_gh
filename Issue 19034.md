# Issue 19034: logs/test.log should log the tests

Issue created by migration from Trac.

Original creator: SimonKing

Original creation time: 2015-09-22 21:28:43

When doing "make test" and getting errors, it is visible in the terminal which test failed, what output was expected and what output was received. For example:

```
File "src/sage/matrix/matrix2.pyx", line 3804, in sage.matrix.matrix2.Matrix.diagonal.right_kernel
Failed example:
    P = B.right_kernel(basis = 'pivot'); P
Expected:
    Vector space of degree 4 and dimension 2 over Finite Field in a of size 5^2
    User basis matrix:
    [      4       4       1       0]
    [  a + 2 3*a + 3       0       1]
Got:
    Vector space of degree 4 and dimension 2 over Finite Field in a of size 5^2
    Basis matrix:
    [      4       4       1       0]
    [      0 2*a + 1   a + 2       1]
```


However, SAGE_ROOT/logs/test.log only says:

```
sage -t src/sage/matrix/strassen.pyx
    [69 tests, 1.60 s]
sage -t src/sage/matrix/matrix2.pyx
    [2191 tests, 5 failures, 18.24 s]
sage -t src/sage/modules/vector_complex_double_dense.pxd
    [0 tests, 0.00 s]
...
sage -t src/sage/matrix/matrix2.pyx  # 5 doctests failed
```


In other words, test.log does in fact *not* log test.


---

Comment by jdemeyer created at 2015-09-24 08:35:53

I have seen this error reported before, but I never looked into it.


---

Comment by jdemeyer created at 2015-09-29 14:05:00

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-09-29 14:05:00

New commits:


---

Comment by chapoton created at 2015-09-29 18:57:40

doc does not build


---

Comment by git created at 2015-09-30 06:44:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-09-30 15:09:31

doc still does not build


---

Comment by jhpalmieri created at 2015-09-30 16:40:49

I think you also need this change:

```diff
diff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py
index ac7fec0..6bff5c7 100644
--- a/src/sage/doctest/control.py
+++ b/src/sage/doctest/control.py
`@``@` -210,7 +210,7 `@``@` class Logger(object):
         self.files = list(files)
 
     def write(self, x):
-        """
+        r"""
         Write ``x`` to all files.
 
         TESTS::
```



---

Comment by git created at 2015-09-30 18:34:59

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2015-10-04 14:06:22

one failing doctest


---

Comment by git created at 2015-10-05 07:03:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-10-05 07:03:28

Sorry for the mess. It should be fixed now.


---

Comment by chapoton created at 2016-05-04 09:45:25

I have failing doctests with the branch here.

```
File "src/sage/doctest/test.py", line 299, in sage.doctest.test
Failed example:
    print(open(t).read())
Expected:
    Running doctests...
    Doctesting 1 file.
    sage -t --warn-long 0.0 simple_failure.rst
    **********************************************************************
    File "simple_failure.rst", line 7, in sage.doctest.tests.simple_failure
    Failed example:
        a * b
    Expected:
        20
    Got:
        15
    **********************************************************************
    1 item had failures:
       1 of   5 in sage.doctest.tests.simple_failure
        [4 tests, 1 failure, ...]
    ----------------------------------------------------------------------
    sage -t --warn-long 0.0 simple_failure.rst  # 1 doctest failed
    ----------------------------------------------------------------------
    ...
Got:
    <BLANKLINE>
```

and another one in the same file.


---

Comment by jdemeyer created at 2016-05-04 10:32:43

I haven't tested it in a while. I will have a look later.


---

Comment by jdemeyer created at 2016-05-05 10:01:39

`@`chapoton: I don't get those failures and neither does the patchbot...

I fixed one failure with the `gdb` package.


---

Comment by git created at 2016-05-05 10:02:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-05-05 10:13:46

Got it, the problems appears only when _not_ using `--long`.


---

Comment by git created at 2016-05-05 12:30:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-05-08 08:37:40

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2016-05-08 08:37:40

ok, looks good to me


---

Comment by vbraun created at 2016-05-17 07:16:52

Resolution: fixed
