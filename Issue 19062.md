# Issue 19062: product of elements of a cartesian products is very slow

archive/issues_019062.json:
```json
{
    "body": "CC:  @nathanncohen\n\nAs reported in [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/hbF_0XVpq_k) the product of elements of a cartesian product are very slow\n\n```\nsage: X = cartesian_product([IntegerModRing(2)] * 8)\nsage: A = X.addition_table() # very very long\n```\n\nOne problem is the default implementation of `cartesian_factors` for element of such product provided by `sage.categories.sets_cat`\n\n```\ndef cartesian_factors(self):\n   # TODO: optimize\n   return tuple(self.cartesian_projection(i) for i in self.parent()._sets_keys())\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/19299\n\n",
    "created_at": "2015-09-28T13:17:33Z",
    "labels": [
        "algebra",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "product of elements of a cartesian products is very slow",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19062",
    "user": "@videlec"
}
```
CC:  @nathanncohen

As reported in [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/hbF_0XVpq_k) the product of elements of a cartesian product are very slow

```
sage: X = cartesian_product([IntegerModRing(2)] * 8)
sage: A = X.addition_table() # very very long
```

One problem is the default implementation of `cartesian_factors` for element of such product provided by `sage.categories.sets_cat`

```
def cartesian_factors(self):
   # TODO: optimize
   return tuple(self.cartesian_projection(i) for i in self.parent()._sets_keys())
```


Issue created by migration from https://trac.sagemath.org/ticket/19299





---

archive/issue_comments_261530.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-09-28T13:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261530",
    "user": "@videlec"
}
```

New commits:



---

archive/issue_comments_261531.json:
```json
{
    "body": "I am still annoyed that `%prun` returns that most time is taken by the `index` method of tuple... which has no reason to be used.",
    "created_at": "2015-09-28T13:25:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261531",
    "user": "@videlec"
}
```

I am still annoyed that `%prun` returns that most time is taken by the `index` method of tuple... which has no reason to be used.



---

archive/issue_comments_261532.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-28T13:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261532",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_261533.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-28T13:44:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261533",
    "user": "@videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_261534.json:
```json
{
    "body": "Nathann,\n\nCould you see if this is enough speedup for your purpose?\n\nVincent",
    "created_at": "2015-09-28T13:44:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261534",
    "user": "@videlec"
}
```

Nathann,

Could you see if this is enough speedup for your purpose?

Vincent



---

archive/issue_comments_261535.json:
```json
{
    "body": "Hello !\n\nThe speedup is cool indeed, thanks! My constructions are still very slow but while I was trying to figure out why exactly I noticed that `Graph.complement` was rather slow too. I'll finish that and get back to the constructions, to this patch and to my slow code.\n\nNathann",
    "created_at": "2015-09-28T13:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261535",
    "user": "@nathanncohen"
}
```

Hello !

The speedup is cool indeed, thanks! My constructions are still very slow but while I was trying to figure out why exactly I noticed that `Graph.complement` was rather slow too. I'll finish that and get back to the constructions, to this patch and to my slow code.

Nathann



---

archive/issue_comments_261536.json:
```json
{
    "body": "Yo !\n\nMy graph generation is still slow, but 10 seconds for a 1024-nodes graph is, well, not as bad as some gap-based construction.\n\nI could save a couple of seconds on the graph side, however, but that would require some rewrite of the dense graph backend. I'll get to that.\n\nIs there any reason why you stored the dictionary as a parameter of `self`? I added a small commit on top of yours at u/ncohen/19299 which avoid lambda functions. It also removes the caching of the dictionary, but if you really think it can be useful, well, that can be reverted.\n\nThanks,\n\nNathann",
    "created_at": "2015-09-28T14:21:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261536",
    "user": "@nathanncohen"
}
```

Yo !

My graph generation is still slow, but 10 seconds for a 1024-nodes graph is, well, not as bad as some gap-based construction.

I could save a couple of seconds on the graph side, however, but that would require some rewrite of the dense graph backend. I'll get to that.

Is there any reason why you stored the dictionary as a parameter of `self`? I added a small commit on top of yours at u/ncohen/19299 which avoid lambda functions. It also removes the caching of the dictionary, but if you really think it can be useful, well, that can be reverted.

Thanks,

Nathann



---

archive/issue_comments_261537.json:
```json
{
    "body": "I do prefer your version!\n\nAn index attribute might be useful for the method `OperationTable.__getitem__`. But as it is not used intensively for building the table I did not touched it.\n\nVincent\n----\nNew commits:",
    "created_at": "2015-09-28T14:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261537",
    "user": "@videlec"
}
```

I do prefer your version!

An index attribute might be useful for the method `OperationTable.__getitem__`. But as it is not used intensively for building the table I did not touched it.

Vincent
----
New commits:



---

archive/issue_comments_261538.json:
```json
{
    "body": "Okayyy. Well, then if it's good for you, let it go!\n\nNathann",
    "created_at": "2015-09-28T14:33:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261538",
    "user": "@nathanncohen"
}
```

Okayyy. Well, then if it's good for you, let it go!

Nathann



---

archive/issue_comments_261539.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-09-28T14:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261539",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_261540.json:
```json
{
    "body": "There's a duplicated line `sage: A((1, 1.23)).cartesian_factors()` in the `EXAMPLE` of `cartesian_factors`, it seems.",
    "created_at": "2015-09-28T15:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261540",
    "user": "@johanrosenkilde"
}
```

There's a duplicated line `sage: A((1, 1.23)).cartesian_factors()` in the `EXAMPLE` of `cartesian_factors`, it seems.



---

archive/issue_comments_261541.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-09-28T16:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261541",
    "user": "@videlec"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_261542.json:
```json
{
    "body": "Indeed...",
    "created_at": "2015-09-28T16:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261542",
    "user": "@videlec"
}
```

Indeed...



---

archive/issue_comments_261543.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-09-28T18:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261543",
    "user": "@videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_261544.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-09-28T18:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261544",
    "user": "@videlec"
}
```

New commits:



---

archive/issue_comments_261545.json:
```json
{
    "body": "The patchbot says that everything is cool, so `positive_review` again. Sorry 'bout the previous one.\n\nNathann",
    "created_at": "2015-09-28T19:14:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261545",
    "user": "@nathanncohen"
}
```

The patchbot says that everything is cool, so `positive_review` again. Sorry 'bout the previous one.

Nathann



---

archive/issue_comments_261546.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-09-28T19:14:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261546",
    "user": "@nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_261547.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-12T07:15:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19062#issuecomment-261547",
    "user": "@vbraun"
}
```

Resolution: fixed
