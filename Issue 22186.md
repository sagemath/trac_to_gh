# Issue 22186: Random failure in sagenb/storage/filesystem_storage.py

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2017-02-23 11:49:16

Keywords: random_fail


```
sage -t --long local/lib/python2.7/site-packages/sagenb/storage/filesystem_storage.py
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb/storage/filesystem_storage.py", line 183, in sagenb.storage.filesystem_storage.FilesystemDatastore._save
Failed example:
    try:  # long time
        alarm(1)
        while True:
            D._save(s, fn)
    except (AlarmInterrupt, OSError):
        # OSError could happen due to a double close() in
        # Python's tempfile module.
        pass
Expected nothing
Got:
    Exception AttributeError: "'file' object has no attribute 'close_called'" in <bound method _TemporaryFileWrapper.__del__ of <open file '<fdopen>', mode 'w+b' at 0x272406c90>> ignored
    close failed in file object destructor:
    IOError: [Errno 9] Bad file descriptor
**********************************************************************
1 item had failures:
   1 of   8 in sagenb.storage.filesystem_storage.FilesystemDatastore._save
    [46 tests, 1 failure, 2.07 s]
```

Clearly the signal arrived during the TemporaryFile constructor...


---

Comment by jdemeyer created at 2017-03-02 17:00:48

Resolution: fixed


---

Comment by jdemeyer created at 2017-03-02 17:00:48

See https://github.com/sagemath/sagenb/commit/f987c9c0e1003916bb37a7791936a14bfe75beff
