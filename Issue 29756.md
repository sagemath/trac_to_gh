# Issue 29756: Enable MathJax in the TOC of Sage reference manual

Issue created by migration from https://trac.sagemath.org/ticket/29993

Original creator: klee

Original creation time: 2020-06-26 07:48:33

CC:  slelievre jhpalmieri

We do that, and reorganize the TOC a bit while we are at it.

In particular, the plane and space curves section is split away from elliptic and hyperelliptic curves section.


---

Comment by git created at 2020-06-26 07:51:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-26 07:55:01

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by klee created at 2020-06-26 07:58:14

Changing status from new to needs_review.


---

Comment by git created at 2020-06-30 06:23:29

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-07-09 07:14:15

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-07-29 05:29:35

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jhpalmieri created at 2020-08-11 03:46:10

Fails to merge.


---

Comment by jhpalmieri created at 2020-08-11 03:46:23

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-08-11 08:17:45

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by klee created at 2020-08-11 08:18:38

Changing status from needs_work to needs_review.


---

Comment by DavidLowry created at 2020-08-11 20:39:04

Is there a reason why we want to enable mathjax on the TOC? Maybe the idea is that perhaps we have been omitting putting tex in the TOC before for some reason, and now we can? Or is there perhaps a particular reason?


---

Comment by jhpalmieri created at 2020-08-11 23:21:21

It looks okay to me. I don't understand the changes in the themes; can you explain those?


---

Comment by klee created at 2020-08-16 07:06:56

Replying to [comment:16 DavidLowry]:
> Is there a reason why we want to enable mathjax on the TOC? Maybe the idea is that perhaps we have been omitting putting tex in the TOC before for some reason, and now we can? Or is there perhaps a particular reason?

There have been maths in the TOC, like p-adic and SL_2(Z). I guess they were not in tex just because mathjax didn't work. This ticket solves the problem.


---

Comment by klee created at 2020-08-16 07:24:42

Replying to [comment:17 jhpalmieri]:
> It looks okay to me. I don't understand the changes in the themes; can you explain those? 

I split arithmetic geometry (elliptic and hyperelliptic curves) from algebraic geometry (plane and space curves). Other than this, the changes are minor and rephrasings.

If you have better suggestions on the changes, let me know.


---

Comment by klee created at 2020-08-16 09:44:22

Replying to [comment:16 DavidLowry]:
> Maybe the idea is that perhaps we have been omitting putting tex in the TOC before for some reason...

The pdf doc of the TOC does not still render the maths correctly with this ticket. That might be one of the reasons.


---

Comment by klee created at 2020-08-16 09:44:22

Changing status from needs_review to needs_work.


---

Comment by jhpalmieri created at 2020-08-16 16:29:29

Replying to [comment:19 klee]:
> Replying to [comment:17 jhpalmieri]:
> > It looks okay to me. I don't understand the changes in the themes; can you explain those? 
> 
> I split arithmetic geometry (elliptic and hyperelliptic curves) from algebraic geometry (plane and space curves). Other than this, the changes are minor and rephrasings.
> 
> If you have better suggestions on the changes, let me know.

Sorry, my question was about the changes to the two files `layout.html`.


---

Comment by klee created at 2020-08-18 21:31:25

Replying to [comment:21 jhpalmieri]:
> Replying to [comment:19 klee]:
> > Replying to [comment:17 jhpalmieri]:
> > > It looks okay to me. I don't understand the changes in the themes; can you explain those? 
> > 
> > I split arithmetic geometry (elliptic and hyperelliptic curves) from algebraic geometry (plane and space curves). Other than this, the changes are minor and rephrasings.
> > 
> > If you have better suggestions on the changes, let me know.
> 
> Sorry, my question was about the changes to the two files `layout.html`.

Ah! They are actually bug fixes. Look at this page:

https://doc.sagemath.org/html/en/reference/arithgroup/index.html

The vertical line, called sidebar toggle, separating the search box on the left and the main content on the right has wrong height and looks ugly.

The changes do the right job to compute the height of the sidebar toggle.


---

Comment by git created at 2020-08-20 09:45:30

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by klee created at 2020-08-20 09:46:50

Changing status from needs_work to needs_review.


---

Comment by klee created at 2020-08-20 09:51:39

Replying to [comment:20 klee]:
> The pdf doc of the TOC does not still render the maths correctly with this ticket. That might be one of the reasons.

This is fixed now, by somewhat ad-hoc manner.

Along the way, I also resurrected the Sage reference manual website for pdfs, which has been broken (I might be guilty for this).


---

Comment by jhpalmieri created at 2020-08-20 17:54:16

Would you mind changing `:math:`e^\pi+1=0`` to `:math:`e^{i\pi}+1=0``? And I think I would call the line `\(s=\frac{1}{2}+it\)` just a "line", not an "imaginary line".


---

Comment by klee created at 2020-08-21 00:51:37

Replying to [comment:26 jhpalmieri]:
> Would you mind changing `:math:`e^\pi+1=0`` to `:math:`e^{i\pi}+1=0``? 

Of course, not. Thank you.

> And I think I would call the line `\(s=\frac{1}{2}+it\)` just a "line", not an "imaginary line".

Okay.


---

Comment by klee created at 2020-08-21 01:02:53

To check the documentation website for pdf docs, run:

```
sage --docbuild reference pdf
sage --docbuild website html
```

and open `local/share/doc/sage/html/en/index.html`.

Running

```
sage --docbuild website pdf
```

generates a not-so-useful file  `local/share/doc/sage/pdf/en/website/sage_documentation.pdf`.


---

Comment by git created at 2020-08-21 01:03:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-08-21 01:12:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2020-08-21 03:49:51

The html version looks good, but I'm having problems with the PDF. You should be able to run `sage --docbuild all pdf` to have it build the html website file and everything else in PDF format.

- Broken before this ticket: in local/share/doc/sage/html/en/index.html, there are supposed to be PDF icons next to each document, as links leading to the PDF builds. Those are missing, because the file `_static/pdf.png` is missing. For some reason, it is not copied from `src/doc/en/website/static` to `local/share/doc/sage/html/en/_static`.

- If I copy that file by hand, then the links are available, but the one for the reference manual (`local/share/doc/sage/pdf/en/reference/index.html`) is badly formatted. It is an html file with links to the different components in PDF format, but the table of contents basically appear twice, once badly and then once better, but not perfect.

- mathjax is not enabled in that main reference manual html file.


---

Comment by klee created at 2020-08-21 04:21:08

Replying to [comment:32 jhpalmieri]:
> The html version looks good, but I'm having problems with the PDF. You should be able to run `sage --docbuild all pdf` to have it build the html website file and everything else in PDF format.
> 
> - Broken before this ticket: in local/share/doc/sage/html/en/index.html, there are supposed to be PDF icons next to each document, as links leading to the PDF builds. Those are missing, because the file `_static/pdf.png` is missing. For some reason, it is not copied from `src/doc/en/website/static` to `local/share/doc/sage/html/en/_static`.

Did you run `sage --docbuild website html`? This copies the PDF icon.

> - If I copy that file by hand, then the links are available, but the one for the reference manual (`local/share/doc/sage/pdf/en/reference/index.html`) is badly formatted. It is an html file with links to the different components in PDF format, but the table of contents basically appear twice, once badly and then once better, but not perfect.

I think you are seeing the old version.


---

Comment by jhpalmieri created at 2020-08-21 04:45:20

Replying to [comment:33 klee]:
> Replying to [comment:32 jhpalmieri]:
> > The html version looks good, but I'm having problems with the PDF. You should be able to run `sage --docbuild all pdf` to have it build the html website file and everything else in PDF format.
> > 
> > - Broken before this ticket: in local/share/doc/sage/html/en/index.html, there are supposed to be PDF icons next to each document, as links leading to the PDF builds. Those are missing, because the file `_static/pdf.png` is missing. For some reason, it is not copied from `src/doc/en/website/static` to `local/share/doc/sage/html/en/_static`.
> 
> Did you run `sage --docbuild website html`? This copies the PDF icon.

This works, but it should not be necessary: I ran both `sage --docbuild all html` and `sage --docbuild all pdf`, and at least one of those should build the website page. See line 582 in `src/sage_setup/docbuild/__init__.py`:

```py
            if format == 'pdf':
                # First build the website page. This only takes a few seconds.
                getattr(get_builder('website'), 'html')()
```



> > - If I copy that file by hand, then the links are available, but the one for the reference manual (`local/share/doc/sage/pdf/en/reference/index.html`) is badly formatted. It is an html file with links to the different components in PDF format, but the table of contents basically appear twice, once badly and then once better, but not perfect.
> 
> I think you are seeing the old version.

The version I see has (for example) the new sentences "Welcome to the Sage reference manual. Here you find documentation for all of `Sage <http://www.sagemath.org/>`_'s features, illustrated with lots of examples. A thematic index follows." So it's the new one. (I also ran `make doc-clean` before building the documentation.) I'm attaching `local/share/doc/sage/pdf/en/reference/index.html`.


---

Attachment

Replying to [comment:34 jhpalmieri]:
> Replying to [comment:33 klee]:
> > Replying to [comment:32 jhpalmieri]:
> > > The html version looks good, but I'm having problems with the PDF. You should be able to run `sage --docbuild all pdf` to have it build the html website file and everything else in PDF format.
> > > 
> > > - Broken before this ticket: in local/share/doc/sage/html/en/index.html, there are supposed to be PDF icons next to each document, as links leading to the PDF builds. Those are missing, because the file `_static/pdf.png` is missing. For some reason, it is not copied from `src/doc/en/website/static` to `local/share/doc/sage/html/en/_static`.
> > 
> > Did you run `sage --docbuild website html`? This copies the PDF icon.
> 
> This works, but it should not be necessary: I ran both `sage --docbuild all html` and `sage --docbuild all pdf`, and at least one of those should build the website page. See line 582 in `src/sage_setup/docbuild/__init__.py`:
> {{{
> #!py
>             if format == 'pdf':
>                 # First build the website page. This only takes a few seconds.
>                 getattr(get_builder('website'), 'html')()
> }}}
> 

Strangely `sage --docbuild all html` does not copy the PDF icon, but ``sage --docbuild website html` does. I don't know why. I didn't touch this part.

> > I think you are seeing the old version.
> 
> The version I see has (for example) the new sentences "Welcome to the Sage reference manual. Here you find documentation for all of `Sage <http://www.sagemath.org/>`_'s features, illustrated with lots of examples. A thematic index follows." So it's the new one. (I also ran `make doc-clean` before building the documentation.) I'm attaching `local/share/doc/sage/pdf/en/reference/index.html`.

Right. It is strange. The file `local/share/doc/sage/pdf/en/reference/index.html` is generated using the file `local/share/doc/sage/html/en/website/index.html` as a template. Would you upload this file as well so that I can compare it with mine?


---

Comment by klee created at 2020-08-21 05:51:12

Replying to [comment:35 klee]:

> Strangely `sage --docbuild all html` does not copy the PDF icon, but ``sage --docbuild website html` does. 

I withdraw this assertion. It is quite confusing...


---

Attachment

local/share/doc/sage/pdf/en/reference/index.html


---

Comment by klee created at 2020-08-21 06:40:19

I added the file `local/share/doc/sage/pdf/en/reference/index.html`, the right one.


---

Comment by klee created at 2020-08-21 07:25:11

I don't know why, but would you try specifically?

```
sage --docbuild reference pdf
```



---

Comment by klee created at 2020-08-21 14:21:37

Replying to [comment:34 jhpalmieri]:
> I ran both `sage --docbuild all html` and `sage --docbuild all pdf`, and at least one of those should build the website page. 

I now see what have happened to you. You did not run `make build`, but only ran `make doc-clean`, `sage --docbuild all html` and `sage --docbuild all pdf`. Right? Thus you built the new document by old docbuild code.

Please try again. This time you run `make; sage --docbuild all pdf`.

Still the PDF icon would not appear. This problem existed before this ticket, I think. Anyway, this copies the PDF icon to the right place:

```
$ sage --docbuild website html
[website  ] building [html]: targets for 1 source files that are out of date
[website  ] Merging environment/index files...
[website  ] ... done (0 todos, 1 index, 0 citations, 0 modules)
[website  ] Merging js index files...
[website  ] ... done (15 js index entries)
[website  ] copying static files... ... done
[website  ] dumping search index in English (code: en)... done
[website  ] The HTML pages are in local/share/doc/sage/html/en/website.
Build finished. The built documents can be found in .../local/share/doc/sage/html/en/website
```


Notice that "copying static files...". Then reload `local/share/doc/sage/html/en/index.html`.


---

Comment by klee created at 2020-08-21 14:45:40

To see clearly the problem of the PDF icon:

Running `make doc-clean; sage --docbuild all html` does not install the PDF icon to the right place, that is under `local/share/doc/sage/html/en/website/_static`.

Running `make doc-clean; sage --docbuild website html` does install the PDF icon to the right place, that is under `local/share/doc/sage/html/en/website/_static`.


---

Comment by jhpalmieri created at 2020-08-21 16:51:46

Replying to [comment:39 klee]:
> Replying to [comment:34 jhpalmieri]:
> > I ran both `sage --docbuild all html` and `sage --docbuild all pdf`, and at least one of those should build the website page. 
> 
> I now see what have happened to you. You did not run `make build`, but only ran `make doc-clean`, `sage --docbuild all html` and `sage --docbuild all pdf`. Right? Thus you built the new document by old docbuild code.
> 
> Please try again. This time you run `make; sage --docbuild all pdf`.

You're right, this fixed it.

> Still the PDF icon would not appear. This problem existed before this ticket, I think. 

Right, that's what I said in comment:32. It would be nice to fix that, too.


---

Comment by klee created at 2020-08-21 22:33:04

Replying to [comment:41 jhpalmieri]:
> > Still the PDF icon would not appear. This problem existed before this ticket, I think. 
> 
> Right, that's what I said in comment:32. It would be nice to fix that, too.

I would love to see it fixed. But I have no idea of how to fix it. Do you have?

I suggest to fix it separately, and not to delay this ticket.


---

Comment by klee created at 2020-08-22 00:47:02

I created a ticket for the PDF icon problem: #30418.


---

Comment by jhpalmieri created at 2020-08-22 20:12:56

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2020-08-22 20:12:56

Okay, let's merge it.


---

Comment by vbraun created at 2020-08-26 21:15:44

Resolution: fixed
