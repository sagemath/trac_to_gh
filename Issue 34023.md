# Issue 34023: Implement northwest diagrams

Issue created by migration from https://trac.sagemath.org/ticket/34260

Original creator: tkarn

Original creation time: 2022-08-01 19:22:04

CC:  tscrim

Keywords: gsoc2022 northwest-diagram

Implement a class for diagrams (collections of cells `(i,j)` indexed by the natural numbers), and a class for diagrams with the northwest property. A diagram has the northwest property if the fact that `(i1, j1)` and `(i2,j2)` are in the diagram implies that the cell `(min(i1,i2), min(j1,j2))` are in the diagram.


---

Comment by tkarn created at 2022-08-01 20:13:41

Set assignee to tkarn.


---

Comment by tkarn created at 2022-08-01 20:13:41

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by tkarn created at 2022-08-01 20:13:41

New commits:


---

Comment by tkarn created at 2022-08-01 20:13:57

Changing type from PLEASE CHANGE to enhancement.


---

Comment by git created at 2022-08-02 17:37:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-08-04 03:24:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-08-04 22:29:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-08-05 13:07:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-08-09 00:15:44

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by tkarn created at 2022-08-09 00:17:00

There is currently an issue in `._test_category`.


```
sage: from sage.combinat.diagram import Diagram
sage: D = Diagram([(0,0), (0,3)])
sage: D
[(0, 0), (0, 3)]
sage: D._test_category
<built-in method _test_category of Diagram object at 0x16d1fc4c0>
sage: D._test_category()
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
Input In [6], in <cell line: 1>()
----> 1 D._test_category()

File ~/Applications/sage/src/sage/structure/element.pyx:722, in sage.structure.element.Element._test_category()
    720     # For usual Python classes, that should be done with
    721     # standard inheritance
--> 722     tester.assertTrue(isinstance(self, self.parent().category().element_class))
    723 else:
    724     # For extension types we just check that inheritance

File /usr/local/Cellar/python@3.9/3.9.13_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/unittest/case.py:688, in TestCase.assertTrue(self, expr, msg)
    686 if not expr:
    687     msg = self._formatMessage(msg, "%s is not true" % safe_repr(expr))
--> 688     raise self.failureException(msg)

AssertionError: False is not true
```



---

Comment by tscrim created at 2022-08-09 00:46:55

From a quick look, you are not passing a `parent` argument, which should be the first argument to any element `__init__` method, and passing that up to `Element.__init__`. Mainly, these code blocks:

```python
        ClonableArray.__init__(self, Diagrams(), cells, check=False)
```


```python
        Diagram.__init__(self, cells, **kwargs)
        ClonableArray.__init__(self, NorthwestDiagrams(), cells, check=check)
```

I also don't like the double initialization of `ClonableArray` here. `Diagram` should properly handle everything, otherwise it is a code smell that strongly suggests they should not be subclasses (but they should be in this case; note that this is not universal).

Remove also the `kwargs` and make them explicit, mainly the `check`.

You should also use `_repr_` (with 1 underscore).


---

Comment by git created at 2022-08-09 01:49:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tkarn created at 2022-08-09 01:49:05

Thanks for the feedback!

Replying to [comment:9 tscrim]:
> From a quick look, you are not passing a `parent` argument, which should be the first argument to any element `__init__` method, and passing that up to `Element.__init__`. Mainly, these code blocks:
> {{{#!python
>         ClonableArray.__init__(self, Diagrams(), cells, check=False)
> }}}
> {{{#!python
>         Diagram.__init__(self, cells, **kwargs)
>         ClonableArray.__init__(self, NorthwestDiagrams(), cells, check=check)
> }}}

Sorry, I'm confused. I thought that `Diagrams()` and `NorthwestDiagrams()` were those `parent` arguments. Am I misunderstanding what you are saying?
----
New commits:
----
New commits:


---

Comment by tscrim created at 2022-08-09 01:59:43

They are, but elements should take a `parent` argument first and pass that along. Imagine once you have `NorthwestDiagrams` given by some parameter. This will also fix the double initialization issue.


---

Comment by tkarn created at 2022-08-09 18:12:23

Oh! That makes sense now. It also helps with some general confusion I had about when to use `__classcall_private__` and other `Parent`/`Element` confusion. Thanks!


---

Comment by git created at 2022-08-09 19:32:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-08-09 19:49:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-08-09 21:48:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-08-09 21:51:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tkarn created at 2022-08-09 21:55:33

Changing status from new to needs_review.


---

Comment by git created at 2022-08-10 15:43:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2022-08-10 21:27:35

Some minor things:

* I'd prefer `number_of_xxx` over `n_xxx`, for consistency with other methods in the combinat file

* since `Diagrams` are extremely important, but `NorthwestDiagrams` maybe not so much, should they possibly be in separate files?

* it would be great if `ParallelogramPolyomino`, (the 2-dim case of) `Polyomino`, `Partition`, `SkewPartition` and possibly even `Composition` interacted nicely with `Diagram`.  In particular, the method names should be the same, whenever possible.  I imagine that for `Polyomino` this will not be possible, but for the others, it should be.

* I'm not sure whether `number_of_cells` should be there.  If so, wouldn't `size` be more appropriate?

Actually, for me the most important point is the synergy with the other classes.


---

Comment by git created at 2022-08-11 19:46:28

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by tkarn created at 2022-08-11 20:15:06

After rebasing off of some optimizations in #34339 and #34343


```
sage: sage: from sage.combinat.diagram import RotheDiagram
....: sage: Sym = SymmetricFunctions(QQ)
....: sage: p = Permutations(6).from_reduced_word([1, 2, 3, 4, 2, 3, 2, 1])
....: sage: s = Sym.s()
sage: sage: %lprun -f RotheDiagram(p).peelable_tableaux s.sum(s[T.shape()] for T in RotheDiagram(p).peelable_tableaux())

Timer unit: 1e-06 s

Total time: 0.008998 s
File: /Users/trevorkarn/Applications/sage/src/sage/combinat/diagram.py
Function: peelable_tableaux at line 671

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
   671                                               def peelable_tableaux(self):
  ....
   797                                                   # description without performing JDT, so we should implement that
   798                                           
   799                                                   # if there is a single column in the diagram then there is only
   800                                                   # one posslbe peelable tableau.
   801         4         15.0      3.8      0.2          if self._n_nonempty_cols == 1:
   802         1        376.0    376.0      4.2              return {Tableau([[i+1] for i, j in self._cells])}
   803                                           
   804         3         17.0      5.7      0.2          first_col = min(j for i, j in self._cells)
   805                                           
   806                                                   # TODO: The next two lines of code could be optimized by only
   807                                                   # looping over self._cells once (rather than two separate times)
   808                                                   # get the diagram without the first column
   809         3        145.0     48.3      1.6          Dhat = NorthwestDiagram([c for c in self._cells if c[1] != first_col])
   810                                           
   811                                                   # get the values from the first column
   812         3         19.0      6.3      0.2          new_vals = sorted(i + 1 for i, j in self._cells if j == first_col)
   813                                           
   814         3          9.0      3.0      0.1          k = self.n_cells() - Dhat.n_cells()
   815                                           
   816         3          4.0      1.3      0.0          peelables = set()
   817                                           
   818         6         14.0      2.3      0.2          for Q in Dhat.peelable_tableaux():
   819                                                       # get the vertical strips
   820         3        143.0     47.7      1.6              mu = Q.shape()
   821         3       2565.0    855.0     28.5              vertical_strips = mu.add_vertical_border_strip(k)
   822        12         19.0      1.6      0.2              for s in vertical_strips:
   823         9        663.0     73.7      7.4                  sQ = SkewTableaux()(Q)  # sQ is skew - get it?
   824         9       1478.0    164.2     16.4                  new_cells = (s/mu).cells()
   825                                                           # perform the jeu de taquin slides
   826        32         58.0      1.8      0.6                  for c in new_cells:
   827        23       2477.0    107.7     27.5                      sQ = sQ.backward_slide(c)
   828                                                           # create the new tableau by filling the columns
   829         9         43.0      4.8      0.5                  sQ_new = sQ.to_list()
   830        32         50.0      1.6      0.6                  for n in range(k):
   831        23         32.0      1.4      0.4                      sQ_new[n][0] = new_vals[n]
   832                                           
   833         9        180.0     20.0      2.0                  T = Tableau(sQ_new)
   834         9        674.0     74.9      7.5                  if T.is_column_strict():
   835         3         13.0      4.3      0.1                      peelables.add(T)
   836                                           
   837         3          4.0      1.3      0.0          return peelables
```



---

Comment by git created at 2022-08-11 20:45:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tkarn created at 2022-08-12 00:37:54

After rebasing off of #34345


```
Total time: 0.008072 s
File: /Users/trevorkarn/Applications/sage/src/sage/combinat/diagram.py
Function: peelable_tableaux at line 671

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
   809         3        153.0     51.0      1.9          Dhat = NorthwestDiagram([c for c in self._cells if c[1] != first_col])
   810                                           
   811                                                   # get the values from the first column
   812         3         19.0      6.3      0.2          new_vals = sorted(i + 1 for i, j in self._cells if j == first_col)
   813                                           
   814         3         11.0      3.7      0.1          k = self.n_cells() - Dhat.n_cells()
   815                                           
   816         3          6.0      2.0      0.1          peelables = set()
   817                                           
   818         6         11.0      1.8      0.1          for Q in Dhat.peelable_tableaux():
   819                                                       # get the vertical strips
   820         3        261.0     87.0      3.2              mu = Q.shape()
   821         3       2741.0    913.7     34.0              vertical_strip_cells = mu.vertical_border_strip_cells(k)
   822        12         19.0      1.6      0.2              for s in vertical_strip_cells:
   823         9        825.0     91.7     10.2                  sQ = SkewTableaux()(Q)  # sQ is skew - get it?
   824                                                           # perform the jeu de taquin slides
   825        32         56.0      1.8      0.7                  for c in s:
   826        23       2857.0    124.2     35.4                      sQ = sQ.backward_slide(c)
   827                                                           # create the new tableau by filling the columns
   828         9         43.0      4.8      0.5                  sQ_new = sQ.to_list()
   829        32         47.0      1.5      0.6                  for n in range(k):
   830        23         34.0      1.5      0.4                      sQ_new[n][0] = new_vals[n]
   831                                           
   832         9        191.0     21.2      2.4                  T = Tableau(sQ_new)
   833         9        195.0     21.7      2.4                  if T.is_column_strict():
   834         3         13.0      4.3      0.2                      peelables.add(T)
   835                                           
   836         3          3.0      1.0      0.0          return peelables

```



---

Comment by tscrim created at 2022-08-13 02:40:56

Replying to [comment:20 mantepse]:
> Some minor things:
> 
> * I'd prefer `number_of_xxx` over `n_xxx`, for consistency with other methods in the combinat file

+1 Although one could argue `nrows` and `ncols` are okay (perhaps as aliases) since they are there for matrices.

> * since `Diagrams` are extremely important, but `NorthwestDiagrams` maybe not so much, should they possibly be in separate files?

-1 They are natural to go together and it can make maintenance easier (and the documentation is also together). I don't think we should base these decisions on an "importance" metric.

> * it would be great if `ParallelogramPolyomino`, (the 2-dim case of) `Polyomino`, `Partition`, `SkewPartition` and possibly even `Composition` interacted nicely with `Diagram`.  In particular, the method names should be the same, whenever possible.  I imagine that for `Polyomino` this will not be possible, but for the others, it should be.

I agree with having the method names the same in general.

> * I'm not sure whether `number_of_cells` should be there.  If so, wouldn't `size` be more appropriate?

Good for an alias.


---

Comment by tscrim created at 2022-08-13 02:49:24

Some additional comments:

- In `check()`, it should raise `ValueError` when failing rather than an `assert`.
- All `Diagrams` can be enumerated. You put coordinates the cells by *N* by running along the diagonals. Hence, diagrams are in bijection with all finite subsets of *N*, which are easily enumerated by the binary strings of nonnegative integers.
- The default for `check` should always be `True`. It is only when we as developers want to avoid it that we should change it.
- `_cells` should be a `frozenset`. You are not using it as a `dict`. This is also hashable.

Also, some of the methods don't have doctests, so I setting this to "needs work".


---

Comment by tscrim created at 2022-08-13 02:49:24

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-08-16 17:58:31

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2022-08-16 19:32:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tkarn created at 2022-08-16 19:40:40

Replying to [comment:30 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[e973f7d](https://git.sagemath.org/sage.git/commit/?id=e973f7dcedd6378d514229348dd94c4603757ceb)||`Assertion -> ValueError`||
> ||[a57b2d0](https://git.sagemath.org/sage.git/commit/?id=a57b2d06d52ace10723505348ad5548102dd62f1)||`Add tests and remove Stanley s.f.`||

Removing Stanley symmetric functions because it should really be on #34335


---

Comment by git created at 2022-08-17 18:52:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tkarn created at 2022-08-17 18:53:28

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2022-08-31 02:12:58

Merge conflict.


---

Comment by tscrim created at 2022-08-31 02:12:58

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-09-01 22:27:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tkarn created at 2022-09-01 22:29:41

I rebased off of 9.7.beta8 develop, then #34339, #34343, and #34345 and then merged the changes. Then I force-pushed that branch, which I hope resolves the merge conflicts.


---

Comment by tscrim created at 2022-09-01 23:10:18

It is a conflict with something in the latest beta (which was released about 2 days ago).


---

Comment by git created at 2022-09-06 18:30:38

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by tkarn created at 2022-09-06 18:31:27

Ok it is now rebased on the latest beta. Sorry for the delay in this.


---

Comment by tkarn created at 2022-09-06 18:31:44

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2022-09-07 03:48:02

Here are my current comments:

I don’t like putting so much information at the class-level documentation because each it is not associated with each individual class nor easily accessible by `Foo?`. I think a lot of it is better broken up into the individual (element) classes.

The first one-sentence description should be just that: one sentence. Subsequent information can go in the next paragraph (i.e., with a blank line in between).

For the `Diagram` class, it should sort the objects and store them in the list. There shouldn’t be a need to override stuff. This is what `SetPartition` does. This way you are not duplicating the information and there is less code to maintain. In its `__init__()`, why not use `<=` for the comparisons? For the classcall, the default should be `check=True` since we should check user input by default.

I am not really a fan of the `from_foo()` type methods. The `_element_constructor_` is the thing that should handle that, but it probably is good that the individual functions are there and publicly listed. At least, I think the `_element_constructor_` should make a check to the appropriate type and dispatch out accordingly.

`peelable_tableaux()` has a number of doc issues, include incomplete, a code block after a `.` (not `::`), `ALGORITHM:` (with the block after not indented) not `.. ALOGIRHTM::`, and `Remark 25` (it is a name).

In `from_zero_one_matrix()`, the definition of `zero` and `one` are better within the `if check:`.

The `Diagram.pp()` does not respect the partition printing option for English versus French convention (but it implicitly claims it does).

Lastly, pyflakes; see the patchbot.


---

Comment by git created at 2022-09-13 00:30:02

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2022-09-13 00:34:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-13 00:40:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-13 15:00:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tkarn created at 2022-09-13 15:01:34

Replying to [comment:41 Travis Scrimshaw]:

Ok - I think all of these issues are addressed.


---

Comment by tkarn created at 2022-09-16 01:09:38

Todo: Make iterator and change category


---

Comment by tkarn created at 2022-09-16 18:36:02

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-09-17 18:49:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tkarn created at 2022-09-17 18:53:38

Ok, I think I made the changes we discussed.


---

Comment by tkarn created at 2022-09-17 18:53:38

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2022-09-20 06:07:12

Why are you using `PositiveIntegers()` and subtracting one instead of `NonNegativeIntegers()`? This seems unnecessary

```
sage: X = NonNegativeIntegers()
sage: XX = cartesian_product([X, X])
sage: it = subsets(XX)
sage: [next(it) for _ in range(10)]
[[],
 [(0, 0)],
 [(1, 0)],
 [(0, 0), (1, 0)],
 [(0, 1)],
 [(0, 0), (0, 1)],
 [(1, 0), (0, 1)],
 [(0, 0), (1, 0), (0, 1)],
 [(2, 0)],
 [(0, 0), (2, 0)]]
```


I don't find this comment helpful

```
            # we want to allow cells in the index-0 row but we
            # dont want all of them to be in the index-0 row
```

In fact, I think it actually makes things confusing. This code is based on the fact that the set of all subsets is an iterator, which means every element is hit after some finite time. It is more than fair for this code to assume that behavior.


---

Comment by tscrim created at 2022-09-20 06:07:44

Also, I would avoid imports from any `*.all`:

```
from sage.categories.cartesian_product import cartesian_product
```



---

Comment by tkarn created at 2022-09-20 12:40:30

Replying to [comment:52 Travis Scrimshaw]:
> Why are you using `PositiveIntegers()` and subtracting one instead of `NonNegativeIntegers()`? This seems unnecessary
> {{{
> sage: X = NonNegativeIntegers()
> sage: XX = cartesian_product([X, X])
> sage: it = subsets(XX)
> sage: [next(it) for _ in range(10)]
> [[],
>  [(0, 0)],
>  [(1, 0)],
>  [(0, 0), (1, 0)],
>  [(0, 1)],
>  [(0, 0), (0, 1)],
>  [(1, 0), (0, 1)],
>  [(0, 0), (1, 0), (0, 1)],
>  [(2, 0)],
>  [(0, 0), (2, 0)]]
> }}}

Hm. I must have done something wrong when I tried using `NonNegativeIntegers()` before. Whatever I was doing I was only getting diagrams that were contained in the first row. Evidently, your change works - sorry for the confusion.

> I don't find this comment helpful
> {{{
>             # we want to allow cells in the index-0 row but we
>             # dont want all of them to be in the index-0 row
> }}}
> In fact, I think it actually makes things confusing. This code is based on the fact that the set of all subsets is an iterator, which means every element is hit after some finite time. It is more than fair for this code to assume that behavior.

I meant for this to clarify why I was subtracting one instead of using `NonNegativeIntegers`, but I agree it is confusing.


---

Comment by git created at 2022-09-20 12:43:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-09-22 01:07:35

Can you also separate part of `pp()` into `_ascii_art_` (and/or maybe something that also for `_unicode_art_`), where `pp()` would simply `print(self._ascii_art_())`? This would mean `ascii_art(D)` would generate the nice pictures (and could be further manipulated).

It would be good to add a `_latex_[young_diagram]()` like `SkewPartition` that does

```python
    def _latex_(self):
        if not self._list:
            return "{\\emptyset}"

        ret = []
        for i in range(self._n_rows):
            row = []
            for j in range(self._n_cols):
                row.append("\\phantom{x}" if (i, j) in self else None)
            ret.append(row)
        from sage.combinat.output import tex_from_array
        return tex_from_array(ret)
```


This will make it easier for people to visualize it.


---

Comment by git created at 2022-09-23 02:52:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-09-23 06:35:25

`_pretty_print()` should return the string, not print it. That way, e.g., `_ascii_art_` can `return ascii_art(result)`.


---

Comment by tkarn created at 2022-09-23 11:53:48

Replying to [comment:56 Travis Scrimshaw]:

> It would be good to add a `_latex_[young_diagram]()` like `SkewPartition` that does
> {{{#!python
>     def _latex_(self):
>         if not self._list:
>             return "{\\emptyset}"
> 
>         ret = []
>         for i in range(self._n_rows):
>             row = []
>             for j in range(self._n_cols):
>                 row.append("\\phantom{x}" if (i, j) in self else None)
>             ret.append(row)
>         from sage.combinat.output import tex_from_array
>         return tex_from_array(ret)
> }}}
> 
> This will make it easier for people to visualize it.

This returns     

```
{\def\lr#1{\multicolumn{1}{|@{\hspace{.6ex}}c@{\hspace{.6ex}}|}{\raisebox{-.3ex}{$#1$}}}
    \raisebox{-.6ex}{$\begin{array}[b]{*{5}c}\cline{6-5}
    \lr{\phantom{x}}&&&\lr{\phantom{x}}&\\
    &&&&\\\cline{5-5}
    &&\lr{\phantom{x}}&&\lr{\phantom{x}}\\\cline{5-5}
    \end{array}$}
    }
```

which is not quite right.

After playing with it, I think this looks better:

```
    {\def\lr#1{\multicolumn{1}{|@{\hspace{.6ex}}c@{\hspace{.6ex}}|}{\raisebox{-.3ex}{$#1$}}}
    \raisebox{-.6ex}{$\begin{array}[b]{*{6}{p{0.6ex}}} \cline{1-1}\cline{4-4}\cline{6-5}
    \lr{\phantom{x}}&&&\lr{\phantom{x}}&\\\cline{1-1}\cline{4-4}
    &&&&\\\cline{5-5} \cline{3-3}
    &&\lr{\phantom{x}}&&\lr{\phantom{x}}\\\cline{5-5} \cline{3-3}
    \end{array}$}
    }
```


which adds lots of `\cline`s to get the boxes and also makes each box including empty boxes a square. 

Does it make sense to just do a custom tex implementation rather than using `tex_from_array`?


---

Comment by tscrim created at 2022-09-23 12:07:04

So the `tex_from_array` actually makes an assumption that the rows are continuous. That is probably what is leading to the incorrect output. If you have a way to do a simple fix `tex_from_skew_array`, then do it (it doesn't need to be fast because the latex compiling is vastly slower than almost anything you will do). Of course, you are safe doing a separate `tex_from_diagram` or something like that. Your choice.


---

Comment by git created at 2022-09-23 12:48:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-23 19:09:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tkarn created at 2022-09-23 19:11:14

Ok! I think that takes care of printing/art things.


---

Comment by tscrim created at 2022-09-24 04:14:36

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-09-24 04:14:36

Thank you. LGTM.


---

Comment by chapoton created at 2022-09-24 06:04:33

the linter says

```
sage/combinat/diagram.py:316:96: E711 comparison to None should be 'if cond is not None:'
18
sage/combinat/diagram.py:318:106: E711 comparison to None should be 'if cond is not None:'
19
sage/combinat/diagram.py:320:105: E711 comparison to None should be 'if cond is not None:'
20
sage/combinat/diagram.py:321:96: E711 comparison to None should be 'if cond is not None:'
```



---

Comment by git created at 2022-09-24 13:29:12

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2022-09-24 13:29:12

Changing status from positive_review to needs_review.


---

Comment by tkarn created at 2022-09-24 13:30:57

Replying to [comment:65 Frédéric Chapoton]:
> the linter says
> {{{
> sage/combinat/diagram.py:316:96: E711 comparison to None should be 'if cond is not None:'
> 18
> sage/combinat/diagram.py:318:106: E711 comparison to None should be 'if cond is not None:'
> 19
> sage/combinat/diagram.py:320:105: E711 comparison to None should be 'if cond is not None:'
> 20
> sage/combinat/diagram.py:321:96: E711 comparison to None should be 'if cond is not None:'
> }}}

Fixed!


---

Comment by chapoton created at 2022-09-24 15:59:10

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-09-25 00:53:42

Thanks. I don't know how I missed that.


---

Comment by vbraun created at 2022-09-25 20:48:30

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2022-09-25 20:48:30

Merge failure on top of:

5d7b401269e Trac #33816: Update gcc/gfortran to 12.x + Apple Silicon support, update openblas to 0.3.21, gsl to 2.7.1

a802d076b46 Trac #31664: Add package msolve 0.4.4 (multivariate polynomial system solver)

4541564cf15 Updated [SageMath](SageMath) version to 9.8.beta0



merge was not clean: conflicts in src/sage/combinat/partition.py


---

Comment by chapoton created at 2022-09-28 12:43:11

needs to be rebased


---

Comment by git created at 2022-10-11 23:17:45

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by tkarn created at 2022-10-11 23:18:09

Rebased, but now a test fails.


---

Comment by tscrim created at 2022-10-12 05:12:11

My guess is somewhere there is a multiplication convention issue:

```
sage: p = Permutation([4,5,2,3,1])
sage: W = WeylGroup(['A',4])
sage: W.from_reduced_word(p.reduced_word()).stanley_symmetric_function()
56*m[1, 1, 1, 1, 1, 1, 1, 1] + 26*m[2, 1, 1, 1, 1, 1, 1] + 12*m[2, 2, 1, 1, 1, 1]
 + 5*m[2, 2, 2, 1, 1] + 2*m[2, 2, 2, 2] + 6*m[3, 1, 1, 1, 1, 1]
 + 3*m[3, 2, 1, 1, 1] + m[3, 2, 2, 1] + m[3, 3, 1, 1]
sage: W.from_reduced_word(reversed(p.reduced_word())).stanley_symmetric_function()
56*m[1, 1, 1, 1, 1, 1, 1, 1] + 30*m[2, 1, 1, 1, 1, 1, 1] + 16*m[2, 2, 1, 1, 1, 1]
 + 9*m[2, 2, 2, 1, 1] + 6*m[2, 2, 2, 2] + 10*m[3, 1, 1, 1, 1, 1] + 5*m[3, 2, 1, 1, 1]
 + 3*m[3, 2, 2, 1] + m[3, 3, 1, 1] + m[3, 3, 2] + 2*m[4, 1, 1, 1, 1] + m[4, 2, 1, 1] + m[4, 2, 2]
```

A very annoying subtlety to deal with (which we can usually just hand-wave away), but we have to deal with here. Actually, I suspect the former is the "correct" output doing:

```
sage: P5 = Permutations(5)
sage: p = P5([4,5,2,3,1])
sage: p.stanley_symmetric_function()
RecursionError
sage: P5.options.mult = 'r2l'
sage: p.stanley_symmetric_function()
56*m[1, 1, 1, 1, 1, 1, 1, 1] + 26*m[2, 1, 1, 1, 1, 1, 1] + 12*m[2, 2, 1, 1, 1, 1]
 + 5*m[2, 2, 2, 1, 1] + 2*m[2, 2, 2, 2] + 6*m[3, 1, 1, 1, 1, 1]
 + 3*m[3, 2, 1, 1, 1] + m[3, 2, 2, 1] + m[3, 3, 1, 1]
```

Although annoyingly this is different from `p.to_permutation_group_element().stanley_symmetric_function()`. It might just be a matter of documenting what convention you use as both are "correct."

One extra thing I noticed, you can pull out the inverse here to not redo it so many times:

```diff
+    winv = w.inverse()
     cells = [c for c in cartesian_product_iterator((range(N), range(N)))
-             if c[0]+1 < w.inverse()(c[1]+1) and c[1]+1 < w(c[0]+1)]
+             if c[0]+1 < winv(c[1]+1) and c[1]+1 < w(c[0]+1)]
```



---

Comment by git created at 2022-10-13 04:12:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tkarn created at 2022-10-13 04:14:07

I realized that the Stanley symmetric function things should be on #34335 instead (where they have the correct multiplication convention) so I removed them from this ticket. I think this is ready.


---

Comment by tkarn created at 2022-10-13 04:14:21

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2022-10-13 04:30:32

Tests are passing for me, but it might be good to wait for the patchbot one more time.


---

Comment by tscrim created at 2022-10-14 07:29:53

I made some changes to the doc and the unicode output. If my changes are good, back to a positive review.
----
New commits:


---

Comment by tkarn created at 2022-10-15 13:53:54

It looks like pyflakes is raising some warnings about unused variables. I'm changing/testing those now, but your changes LGTM.


---

Comment by tkarn created at 2022-10-15 14:05:52

New commits:


---

Comment by tkarn created at 2022-10-15 14:08:13

All the tests pass on my end - I'll wait for patchbot.


---

Comment by tscrim created at 2022-10-16 04:33:04

Green bot.


---

Comment by chapoton created at 2022-10-27 14:09:28

so what is this now waiting for ?


---

Comment by tkarn created at 2022-10-27 15:31:41

Nothing. Thanks Frédéric


---

Comment by tkarn created at 2022-10-27 15:31:41

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-11-07 20:26:22

Resolution: fixed
