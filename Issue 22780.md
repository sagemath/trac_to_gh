# Issue 22780: Specifics of docstrings style

Issue created by migration from https://trac.sagemath.org/ticket/23017

Original creator: klee

Original creation time: 2017-05-17 13:43:45

Some details of the Sage docstring styles are not clearly stated in the developer manual, and left to each writer's discretion. This introduced inconsistencies and sometimes allowed bad styles. The purpose of this ticket is to spot those details and provide specific guidelines for them, based on the consensus of the developer community.

The guidelines collected here will be used to revise 

http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings

P1.

P2.

G1. Write 

```
   Return True if something is true.
```

but don't write 

```
   Return ``True`` if something is true.
```

The same applies to `False` and `None`

G2. Write

```
if the lattice is reflexive ...
```

but don't write

```
if ``self`` is reflexive ...
```


G3. Write

```
Return True if the lattice is reflexive.
```

but do not write

``` 
Return True if the lattice is reflexive and False otherwise."
```

nor

``` 
Return whether the lattice is reflexive.
```

nor

``` 
Test if the lattice is reflexive.
```


G4. OUTPUT block is optional

G5. Write

```
OUTPUT:

- lattice
```

but do not write

```
OUTPUT:

a lattice
```



---

Comment by jdemeyer created at 2017-05-17 15:08:25

I would like to add that `INPUT` and `OUTPUT` blocks should be sufficiently verbose.

Some places in Sage have something like


```
INPUT:

- ``x`` -- integer
```


Well, that's not very useful. If should explain the purpose of `x`, not just the fact that it's an integer.


---

Comment by jdemeyer created at 2017-05-17 15:10:15

It might also be good to formally define the style of types and defaults in `INPUT` blocks. I usually use

```
INPUT:

- ``p`` -- (integer, default: `11`) the modulus for the modular algorithm
```



---

Comment by tscrim created at 2017-05-17 15:50:53

Strong -1 to G1. `True` and similar should be code because they are Python objects.

Strong -1 to G2. `self` is a well-defined concept in Python, more concise, and more clear when subclasses are involved.

Subsequently, I see no good options in G3. However, option 3 is closet, and I prefer:

```
Return whether ``self`` is reflexive.
```


G4: recommended but optional. This is what we primarily do in practice anyways.

+1 on comment:5, although I do a slightly different style

```
INPUT:

- ``p`` -- integer (default: `11`); the modulus for the modular algorithm
```



---

Comment by mforets created at 2017-05-22 04:58:09

have you considered here the guidelines for writing an exception string? 

no beginning upper case, no final full stop is what i've been told, but i just quickly checked [documentation strings chapter](http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings) and there are seemingly no guidelines. 

only: ``“It is an error to [..]”``

thanks


---

Comment by klee created at 2017-05-22 07:02:03

Replying to [comment:9 mforets]:
> have you considered here the guidelines for writing an exception string? 

No. This ticket is about docstrings. 

If you have specific ideas, you may start your own ticket and polls about exception strings. But do you really have specific ideas to guide  developers on exception strings other than "no beginning upper case, no final full stop"?  Hmm, I don't have...


---

Comment by mforets created at 2017-05-22 07:17:42

Replying to [comment:10 klee]:
> Replying to [comment:9 mforets]:
> > have you considered here the guidelines for writing an exception string? 
> 
> No. This ticket is about docstrings. 
> 
> If you have specific ideas, you may start your own ticket and polls about exception strings. But do you really have specific ideas to guide  developers on exception strings other than "no beginning upper case, no final full stop"?  Hmm, I don't have... 

sure. the point was that "no beginning upper case, no final full stop" was sth that i learnt here in trac, which is ok, but better if it is documented somewhere close to the Guide (if i didn't miss it).


---

Comment by git created at 2017-05-23 07:48:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-05-23 08:30:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-05-23 08:36:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2017-05-23 08:59:53

1)

```
+       The lexicographic product of G and H is the graph with vertex set ...
```

use `... of `G` and `H`` (or `... of ``G`` and ``H```) for correct typesetting here. (I prefer ``G``.)

2)

```
+       - ``p`` -- prime integer (default: 2); coprime with ``n``
```

use `(default: `2`)` (or `(default: ``2``)`) for correct typesetting. (I prefer ``2``.)

Change this in the template (lines +540,28) as well.

3)

```
+       OUTPUT: a tuple of
```

shouldn't this be `a tuple ``(H, U)`` of` ?

4) More a question, as I am still compiling my current [SageMath](SageMath): Is the link in 

```
+processed by Sphinx. See http://www.sphinx-doc.org/rest.html for an
```

typeset correctly?

I did not review the bibliography-part carefully, but were there any changes or was it simply changeing indent?


---

Comment by dkrenn created at 2017-05-23 09:02:24

5)

```
+- Lines should be shorter than 80 characters.
```

Here one could link to the PEP8 https://www.python.org/dev/peps/pep-0008/#maximum-line-length


---

Comment by klee created at 2017-05-23 09:04:16

Replying to [comment:17 dkrenn]:
> I did not review the bibliography-part carefully, but were there any changes or was it simply changeing indent?

Just changing the indent.


---

Comment by klee created at 2017-05-23 09:10:05

Replying to [comment:17 dkrenn]:
> 4) More a question, as I am still compiling my current [SageMath](SageMath): Is the link in 
> {{{
> +processed by Sphinx. See http://www.sphinx-doc.org/rest.html for an
> }}}
> typeset correctly?

Yes.


---

Comment by jmantysalo created at 2017-05-23 09:14:53

Template has a `.. NOTE::` block of what should be an `ALGORITHM:`. Not sure if that should be changed in this ticket or not.


---

Comment by git created at 2017-05-23 12:18:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2017-05-23 12:20:20

Replying to [comment:17 dkrenn]:
> 1)
> {{{
> +       The lexicographic product of G and H is the graph with vertex set ...
> }}}
> use `... of `G` and `H`` (or `... of ``G`` and ``H```) for correct typesetting here. (I prefer ``G``.)

Done.
 
> 2)
> {{{
> +       - ``p`` -- prime integer (default: 2); coprime with ``n``
> }}}
> use `(default: `2`)` (or `(default: ``2``)`) for correct typesetting. (I prefer ``2``.)
> 
> Change this in the template (lines +540,28) as well.

Done.
 
> 3)
> {{{
> +       OUTPUT: a tuple of
> }}}
> shouldn't this be `a tuple ``(H, U)`` of` ?

I thinks "a tuple of" suffices here.


---

Comment by klee created at 2017-05-23 12:22:27

Replying to [comment:21 jmantysalo]:
> Template has a `.. NOTE::` block of what should be an `ALGORITHM:`. Not sure if that should be changed in this ticket or not.
 
This ticket will not touch that.  I think that block is close to a note as it does not explain the algorithm itself.


---

Comment by klee created at 2017-05-23 14:40:15

Changing status from new to needs_review.


---

Comment by git created at 2017-05-23 22:25:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2017-06-01 14:35:26

If the `OUTPUT` block is "optional but recommended", shouldn't the same be true for the `INPUT` block? I am thinking of this docstring for example:

```
cpdef edge_connectivity(g):
    r"""
    Computes the edge connectivity of the input graph, using Boost.

    OUTPUT: a pair ``(ec, edges)``, where ``ec`` is the edge
    connectivity, ``edges`` is the list of edges in a minimum cut.
```


Here, there is no explicit `INPUT` but I don't think it's needed anyway.


---

Comment by git created at 2017-06-01 16:40:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2017-06-01 16:48:08

Replying to [comment:28 jdemeyer]:
> If the `OUTPUT` block is "optional but recommended", shouldn't the same be true for the `INPUT` block? 

Certainly there are many cases that `INPUT` block is not needed, and in practice we do not add one in such cases. So `not optional` is too much prohibitive. I just removed the sentence.


---

Comment by jhpalmieri created at 2017-06-19 22:14:59

If you want to follow the guidelines here (all Sphinx directives are written in uppercase), then you should change ".. code-block::" to ".. CODE-BLOCK::". You should also change it from ".. code-block:: none" to ".. CODE-BLOCK:: rest".

The bulleted point starting with "Lines should be shorter than 80 characters." has a line which is exactly 80 characters, so perhaps that should be broken up so all lines are shorter than 80 characters. Some of the other lines (for example in the paragraph starting "The decomposition of the free module ..." are now longer than 80 characters.

Why did you delete "If it contains multiple lines, all the lines after the first need to begin at the same indentation as the backtick"? I think that is helpful information, and people often make mistakes with this indentation in docstrings.


---

Comment by git created at 2017-06-20 00:50:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2017-06-20 01:05:07

Replying to [comment:31 jhpalmieri]:
> If you want to follow the guidelines here (all Sphinx directives are written in uppercase), then you should change ".. code-block::" to ".. CODE-BLOCK::". You should also change it from ".. code-block:: none" to ".. CODE-BLOCK:: rest".

Done.

> The bulleted point starting with "Lines should be shorter than 80 characters." has a line which is exactly 80 characters, so perhaps that should be broken up so all lines are shorter than 80 characters. Some of the other lines (for example in the paragraph starting "The decomposition of the free module ..." are now longer than 80 characters.

I broke up many lines to make it shorten than 80 characters. But I kept some of the lines as they look better as they are than broken up. This includes the second line of the bulleted point, which has exactly 80 characters and the 80th character is a period. I think this is a good example showing that a guideline is just a guideline and not to be followed blindly when there are good reasons not to follow :-) 

> Why did you delete "If it contains multiple lines, all the lines after the first need to begin at the same indentation as the backtick"? I think that is helpful information, and people often make mistakes with this indentation in docstrings.

Recovered.


---

Comment by jhpalmieri created at 2017-06-20 17:33:06

I would suggest one more change:

```diff
diff --git a/src/doc/en/developer/coding_basics.rst b/src/doc/en/developer/coding_basics.rst
index 51adfc1b3e..1f7f4a0f3a 100644
--- a/src/doc/en/developer/coding_basics.rst
+++ b/src/doc/en/developer/coding_basics.rst
@@ -507,8 +507,13 @@ introduction. Sage imposes these styles:
 - All reST and Sphinx directives (like ``.. WARNING::``, ``.. NOTE::``,
   ``.. MATH::``, etc.) are written in uppercase.
 
-- Code fragments are quoted with ``````. This includes function arguments
-  and the Python literals like ````True````, ````False```` and ````None````.
+- Code fragments are quoted with double backticks. This includes
+  function arguments and the Python literals like ````True````,
+  ````False```` and ````None````. For example:
+
+  .. CODE-BLOCK:: rest
+
+      If ``check`` is ``True``, then ...
 
 Sage's master **BIBLIOGRAPHY** file
 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
```

Otherwise, it is okay with me.


---

Comment by git created at 2017-06-20 18:16:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2017-06-20 18:32:33

Okay, thank you.


---

Comment by jhpalmieri created at 2017-06-20 18:32:33

Changing status from needs_review to positive_review.


---

Comment by dkrenn created at 2017-06-20 18:42:06

Fine for me as well (it seems that I was removed from the reviewers field; I've added my name again; all my suggestions above were incoperated.)


---

Comment by klee created at 2017-06-20 18:51:38

Thank you!


---

Comment by vbraun created at 2017-06-22 07:23:34

Resolution: fixed
