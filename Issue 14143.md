# Issue 14143: Implement group cycle indices

Issue created by migration from https://trac.sagemath.org/ticket/14347

Original creator: agd

Original creation time: 2013-03-23 22:31:44

Assignee: agd

CC:  sage-combinat

Keywords: cycle index, species

Let G be a group. A G-cycle index is a map from G to the ring of cycle index series. These objects are useful for enumerating G-species (species equipped with an equivariant G-action), where they serve a role analogous to the cycle indices of species.

This patch offers an implementation of G-cycle indices with their most important algebraic features (sum, product, and composition/plethysm). (The plethysm of G-cycle indices is defined in a funny way that really depends on having access to the whole G-cycle index at once; otherwise, there wouldn't be much point in having this code.)

This code is (believed to be) complete and functional. It could use a bit of attention of someone who understand the coersion system better than I do, though.


---

Comment by agd created at 2013-03-24 01:34:21

I seem to have made a mess of the attachments. If someone with permissions to do so happens by, could you delete everything but group_cycle_index_series-agd.patch? Thanks!


---

Comment by nthiery created at 2013-03-24 20:35:17

Replying to [comment:2 agd]:
> I seem to have made a mess of the attachments. If someone with permissions to do so happens by, could you delete everything but group_cycle_index_series-agd.patch? Thanks!

Done!


---

Comment by nthiery created at 2013-03-24 20:45:46

Hi Andrew!

Thanks for your patch; this sounds interesting! I am not sure I'll have the time to make a complete review, so if anyone wants to jump in, please do! In the mean time, here are some little comments:

A G-cycle index can be interpreted as a formal linear combination of elements of G, with coefficients which are symmetric powersum functions, right? If so, may I recommend to build on top of:

```
  CombinatorialFreeModule(SymmetricFunctions(QQ).p(), G)
```


Then you would get the data structure and the additive structure for free. And all the neat little accessors and such provided by CombinatorialFreeModule.

You may want to explore the tutorials "Using Free Modules and Vector Spaces" and "Implementing Algebraic Structures" from:

```
http://combinat.sagemath.org/doc/thematic_tutorials/index-sage-combinat.html
```


See also

```
http://combinat.sagemath.org/doc/thematic_tutorials/coercion_and_categories.html
```

which is now in Sage's official thematic tutorials.

You probably also want to link back to the cycle_index method of permutation groups.

Cheers,
                                        Nicolas


---

Comment by agd created at 2013-03-24 21:24:18

Nicolas,

Thanks for the feedback! I'll take a look at those tutorials.

Implementing the ring of G-cycle indices as a CombinatorialFreeModule is an interesting idea. It's definitely appropriate from a formal perspective. At first glance, I'm concerned that it will make it harder to work with the (ordinary) cycle indices associated to the various elements of G, which are really the point of these objects, but maybe that's actually more straightforward than it looks to my naïve eyes. I'll have a go at it, in any case.


---

Comment by nthiery created at 2013-03-24 21:44:09

Replying to [comment:5 agd]:
> At first glance, I'm concerned that it will make it harder to work
> with the (ordinary) cycle indices associated to the various elements
> of G, which are really the point of these objects, but maybe that's
> actually more straightforward than it looks to my naïve eyes.

If you stumble on a concrete use case where the syntax seems to go in
your way, please post it here, and we will see what we can do!

By the way: we are in the process of finalizing those two first
tutorials. If you want to use the occasion to proofread them and send
feedback, that would be great!

Cheers,
                                Nicolas


---

Comment by agd created at 2013-03-25 00:16:02

Nicolas,

After spending a bit of time with the documentation, it looks like CombinatorialFreeModule is a great foundation for this code. I'm currently working on re-implementing it. The tutorials you linked were very helpful, although I expect I'm going to need some time figuring out the whole morphism-coersion system (if only because there are some decisions to be made about how things should work with subgroups). If there's a straightforward way to bake morphism-generation into a CombinatorialFreeModule, it would be great to see that in the tutorials. (Specifically, if G1 has a natural morphism to G2, is there a way to make CombinatorialFreeModule(R, G1) inherit a natural morphism to CombinatorialFreeModule(R, G2)? It seems like a reasonable thing to want to do, but I have no idea how to approach it.)

It appears to me, though, that the correct structure to use is CombinatorialFreeModule(CycleIndexSeriesRing(QQ), G), because then I get to take advantage of (1) the CycleIndexSeries(Ring) code for dealing nicely with these things being infinite (using LazyPowerSeries(Ring)) and (2) lots of semantics for doing combinatorial enumeration with those objects. Is this obviously wrong in some way I haven't yet picked up on?

Thanks again for your help!

--Andrew


---

Attachment

Re-implement using CombinatorialFreeModule


---

Comment by agd created at 2013-03-25 02:35:57

I've re-implemented this class using CombinatorialFreeModule(CycleIndexSeriesRing(QQ), G). The new code is less than half the length of the old and is (in my opinion) much more readable and maintainable. Big props to Nicolas for that idea!


---

Comment by nthiery created at 2013-03-25 05:08:51

Replying to [comment:7 agd]:
> It appears to me, though, that the correct structure to use is CombinatorialFreeModule(CycleIndexSeriesRing(QQ), G), because then I get to take advantage of (1) the CycleIndexSeries(Ring) code for dealing nicely with these things being infinite (using LazyPowerSeries(Ring)) and (2) lots of semantics for doing combinatorial enumeration with those objects. Is this obviously wrong in some way I haven't yet picked up on?

That's probably correct! I have not looked enough at the details of
what you are implementing to tell :-)

Cheers,
                                Nicolas


---

Comment by nthiery created at 2013-03-25 05:12:09

Replying to [comment:8 agd]:
> I've re-implemented this class using CombinatorialFreeModule(CycleIndexSeriesRing(QQ), G). The new code is less than half the length of the old and is (in my opinion) much more readable and maintainable. Big props to Nicolas for that idea!

Glad to hear that was the right infrastructure for you!

For a quick implementation of morphism between the two things you can probably do something like:

    KG2.module_morphism(KG1.monomial*G1, codomain=G1).register_as_coercion()

(where KG1 / KG2 are the cycle index rings for G1 / G2). I can be more precise later ...

Then comes the question of whether you want to have those morphism be defined automatically. I tend to be conservative and not add them until it really itches me so much that I can't do otherwise. It's easier for backward compatibility to add coercions than remove them!

Jumping on my train!


---

Comment by agd created at 2013-03-30 16:21:40

Changing status from new to needs_review.


---

Comment by agd created at 2013-04-27 17:21:19

Per discussions elsewhere, I've added a new version of the patch which was generated using "hg export tip". The content is the same.


---

Comment by agd created at 2013-06-03 21:03:32

Add bot instructions.


---

Comment by chapoton created at 2013-06-07 08:45:25

The bot instructions should be put here (namely in comments):

apply trac_14347_group_cycle_index_series.patch


---

Comment by chapoton created at 2013-06-10 11:39:41

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2013-06-10 11:39:41

* the bot has found a failing doctest, see bot report

* you need to add 3 missing doctests


---

Comment by agd created at 2013-06-16 16:20:26

Replying to [comment:15 chapoton]:

Thanks for your comments!

> * the bot has found a failing doctest, see bot report

This appears to be a regression in 5.10 related to the string representations of linear combinations. It appears to be caused by a change in the misc.repr_lincomb method, which now assumes that the coefficients of abstract linear combinations can be compared to 0. I've submitted a ticket (#14751) to try to sort this out. 
> * you need to add 3 missing doctests

I have uploaded a new version of the patch which adds the missing doctests.


---

Comment by agd created at 2013-06-16 16:20:26

Changing status from needs_work to needs_review.


---

Comment by agd created at 2013-06-17 19:58:56

A preliminary patch has been submitted to fix the issue. I'm adding a dependency.


---

Comment by agd created at 2013-06-18 12:57:26

Patchbot is still trying to apply both patches. Trying instruction again:

Apply [attachment:trac_14347_group_cycle_index_series.patch]


---

Comment by chapoton created at 2013-06-18 13:00:40

syntax for the bot is like that :

apply trac_14347_group_cycle_index_series.patch


---

Comment by agd created at 2013-06-18 13:06:04

Replying to [comment:19 chapoton]:
> syntax for the bot is like that :
> 
> apply trac_14347_group_cycle_index_series.patch

One day I'll get all this stuff figured out. Thanks for the correction.


---

Comment by jdemeyer created at 2013-08-19 06:35:19

Please make it clear whether the patch or the git branch should be merged. In the latter case, change the milestone to sage-6.0.


---

Comment by agd created at 2013-08-28 22:52:49

I have uploaded a new version of the patch which makes three changes:

1. Removes a spurious modification to the RST files.
2. Adds a `define` method to `GroupCycleIndexSeries` which, like its cousin in `LazyPowerSeries`, allows for recursively-defined series to be computed.
3. Adjusts the implementation of `composition` to make the previous work.


---

Comment by agd created at 2013-08-28 22:55:35

Patch to implement group cycle index series


---

Attachment


---

Comment by chapoton created at 2013-09-15 16:55:40

apply only trac_14347_group_cycle_index_series.patch


---

Comment by chapoton created at 2013-10-23 18:45:56

one failing doctest, see bot report


---

Comment by chapoton created at 2013-10-23 18:45:56

Changing status from needs_review to needs_work.


---

Comment by agd created at 2013-11-23 16:59:40

I have fixed the broken doctest.

Additionally, I've switched back over to using Git to manage this—the old Mercurial workflow is just too confusing. How do I tell the build bot to ignore the attachments and only use the branch?


---

Comment by agd created at 2013-11-23 16:59:40

Changing status from needs_work to needs_review.


---

Comment by git created at 2013-12-25 04:31:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-12-25 19:20:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-12-30 23:03:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-12-31 16:55:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-12-31 20:48:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2014-01-01 21:19:35

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-01-06 04:34:02

Reviewer name must be full name. Also please fill in your name on the trac.sagemath.org homepage.


---

Comment by vbraun created at 2014-01-15 15:49:21

Branch conflicts with #14846, merge that one in and resolve.


---

Comment by mhansen created at 2014-01-16 15:24:31

Changing status from positive_review to needs_info.


---

Comment by mhansen created at 2014-01-16 15:24:31

One thing that needs to be done is that the "oeis" tests need to be marked as optional.  I've made a branch which is this code based on #15637 at "u/mhansen/ticket/14347".  It also contains some speed improvements by being a bit more pedantic about streams / series /etc.


---

Comment by agd created at 2014-02-10 16:04:04

Replying to [comment:42 mhansen]:
> One thing that needs to be done is that the "oeis" tests need to be marked as optional.  I've made a branch which is this code based on #15637 at "u/mhansen/ticket/14347".  It also contains some speed improvements by being a bit more pedantic about streams / series /etc.

I've looked over this branch. The stuff I understand looks great! The rebuild in 
[927418b](http://git.sagemath.org/sage.git/commit/?id=927418b9778ee299f3698231d234f3e781b8f23c), however, is kind of mysterious to me. However, the doctests check out, and some code I'm currently using for a research project still works (and is noticeably faster), so that's good news.


---

Comment by mhansen created at 2014-02-10 16:33:31

It primarily just splits the internal functions into methods on a class.  It also does not produce intermediate series for the linear combination (LinearCombinationStream vs. `sum(coeff*monomial_composer(part, g) for part,coeff in term)`).  `map_item` does the job building the dict and using `_from_dict`.  Let me know if you have any specific questions.


---

Comment by git created at 2014-08-01 14:37:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-01 23:02:46

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by agd created at 2015-06-01 23:06:13

Changing status from needs_info to needs_review.


---

Comment by agd created at 2015-06-01 23:06:13

Since #15673 seems to have died on the vine, I have rebuilt this code on top of the current mainline Sage. My paper which presents this material and code has been accepted for publication, so I'd really love to get this up and running before too many more people email me wondering why the code doesn't work. (Note that this does depend on #14846, which I'm also currently trying to revive.)


---

Comment by git created at 2015-06-02 02:06:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2015-06-18 11:57:40

if its not too late, I'd review this in the first or second week of july, together with #14846)

Martin


---

Comment by agd created at 2015-07-20 16:54:26

That would be splendid! Please let me know if you have any questions or concerns.


---

Comment by mantepse created at 2015-07-20 16:57:39

I'm already two weeks late :-(


---

Comment by git created at 2015-08-12 16:15:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2015-08-12 16:18:19

There were a few trivial formatting fixes to do, which I did (```git trac``` automatically switched to this modified branch, I hope I didn't mess up anything)

So, the code looks fine, thanks for contributing and thanks for your patience!


---

Comment by mantepse created at 2015-08-12 16:18:19

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-09-12 11:36:44

Fails on OSX

```
sage -t --long src/sage/combinat/species/group_cycle_index_series.py
**********************************************************************
File "src/sage/combinat/species/group_cycle_index_series.py", line 354, in sage.combinat.species.group_cycle_index_series.GroupCycleIndexSeries.functorial_composition
Failed example:
    D.quotient().isotype_generating_series().counts(5)
Expected:
    [1, 1, 3, 13, 144]
Got:
    [1, 1, 1, 1, 1]
**********************************************************************
1 item had failures:
   1 of  11 in sage.combinat.species.group_cycle_index_series.GroupCycleIndexSeries.functorial_composition
```



---

Comment by vbraun created at 2015-09-12 11:36:44

Changing status from positive_review to needs_work.


---

Comment by agd created at 2015-09-14 20:00:04

Replying to [comment:62 vbraun]:
Huh. I was unable to reproduce this on either my desktop or my buildbot/server, both running Debian. I have updated the branch with the latest `develop`, just in case. I'll try to find a Mac to test with, but it may be some time.
----
New commits:


---

Comment by git created at 2020-10-24 17:55:52

Branch pushed to git repo; I updated commit sha1. New commits:
