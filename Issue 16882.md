# Issue 16882: Disallow pari(None)

archive/issues_016882.json:
```json
{
    "body": "CC:  pbruin\n\nCurrently, `pari(None)` behaves like `pari(\"None\")`, which is normally not what is intented.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17119\n\n",
    "created_at": "2014-10-09T08:17:52Z",
    "labels": [
        "interfaces",
        "major",
        "enhancement"
    ],
    "title": "Disallow pari(None)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16882",
    "user": "jdemeyer"
}
```
CC:  pbruin

Currently, `pari(None)` behaves like `pari("None")`, which is normally not what is intented.

Issue created by migration from https://trac.sagemath.org/ticket/17119





---

archive/issue_comments_223505.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-10-09T12:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16882#issuecomment-223505",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_223506.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-09T12:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16882#issuecomment-223506",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_223507.json:
```json
{
    "body": "PARI has its own equivalent of `None`, namely `gnil`.  This is internally a `t_INT` with value 0, but is treated specially by virtue of its memory address.  It is returned by things like evaluating the empty string, constructions like `if(0,1)`, etc.  In Sage we currently convert `gnil` to None:\n\n```\nsage: pari('') is None\nTrue\nsage: pari('if(0,1)') is None\nTrue\n```\n\nI think we should decide on a uniform behaviour for the relationship between `gnil` and `None`.  It seems that we have the following options:\n- Always convert `gnil` to Python `None`, and make `pari(None)` return `None`.\n- Allow wrapping `gnil` (and possibly other PARI objects that are not on the stack) in a Sage `gen` without copying it, so PARI recognises it as `gnil`.  In particular, `pari(None)` (like `pari('')`), will be such a `gen` wrapping `gnil`.  This probably prints as 0 by default, but this could be changed by the `__repr__()` method.\n- Stop treating `gnil` specially, identifying it with `gen_0`.  Make this consistent by defining `pari(None) = pari(0)`.  This is what GP does when assigning to a variable:\n\n```\ngp > if(0,1)         \\\\ returns gnil\ngp > x = if(0,1); x  \\\\ the result of gcopy(gnil) is identical to gen_0\n%2 = 0\n```\n",
    "created_at": "2014-10-10T08:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16882#issuecomment-223507",
    "user": "pbruin"
}
```

PARI has its own equivalent of `None`, namely `gnil`.  This is internally a `t_INT` with value 0, but is treated specially by virtue of its memory address.  It is returned by things like evaluating the empty string, constructions like `if(0,1)`, etc.  In Sage we currently convert `gnil` to None:

```
sage: pari('') is None
True
sage: pari('if(0,1)') is None
True
```

I think we should decide on a uniform behaviour for the relationship between `gnil` and `None`.  It seems that we have the following options:
- Always convert `gnil` to Python `None`, and make `pari(None)` return `None`.
- Allow wrapping `gnil` (and possibly other PARI objects that are not on the stack) in a Sage `gen` without copying it, so PARI recognises it as `gnil`.  In particular, `pari(None)` (like `pari('')`), will be such a `gen` wrapping `gnil`.  This probably prints as 0 by default, but this could be changed by the `__repr__()` method.
- Stop treating `gnil` specially, identifying it with `gen_0`.  Make this consistent by defining `pari(None) = pari(0)`.  This is what GP does when assigning to a variable:

```
gp > if(0,1)         \\ returns gnil
gp > x = if(0,1); x  \\ the result of gcopy(gnil) is identical to gen_0
%2 = 0
```




---

archive/issue_comments_223508.json:
```json
{
    "body": "> - Always convert `gnil` to Python `None`, and make `pari(None)` return `None`.\nThat wouldn't work with composite objects: what should `pari([None, 1])` be then?\n\n> - Allow wrapping `gnil` (and possibly other PARI objects that are not on the stack) in a Sage `gen` without copying it, so PARI recognises it as `gnil`.\nTheoretically perhaps the best, but hard to do.\n\n> - Stop treating `gnil` specially, identifying it with `gen_0`.\nI don't like this. It would lead to things like\n\n```\nsage: pari(\"print(12345)\")\n12345\n0\n```\n\n\nSo... I still think it's best to disallow `pari(None)`. I see no use case for it and the times where it did come up where all mistakes.",
    "created_at": "2014-10-10T09:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16882#issuecomment-223508",
    "user": "jdemeyer"
}
```

> - Always convert `gnil` to Python `None`, and make `pari(None)` return `None`.
That wouldn't work with composite objects: what should `pari([None, 1])` be then?

> - Allow wrapping `gnil` (and possibly other PARI objects that are not on the stack) in a Sage `gen` without copying it, so PARI recognises it as `gnil`.
Theoretically perhaps the best, but hard to do.

> - Stop treating `gnil` specially, identifying it with `gen_0`.
I don't like this. It would lead to things like

```
sage: pari("print(12345)")
12345
0
```


So... I still think it's best to disallow `pari(None)`. I see no use case for it and the times where it did come up where all mistakes.



---

archive/issue_comments_223509.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> > - Always convert `gnil` to Python `None`, and make `pari(None)` return `None`.\n> That wouldn't work with composite objects: what should `pari([None, 1])` be then?\nGood point...\n> > - Allow wrapping `gnil` (and possibly other PARI objects that are not on the stack) in a Sage `gen` without copying it, so PARI recognises it as `gnil`.\n> Theoretically perhaps the best, but hard to do.\nI agree.  It may be tricky to implement the decision to copy or not in all the necessary places.  On the other hand, PARI just changes `gnil` to `gen_0` in non-trivial situations:\n\n```\ngp > [if(0,1),1]\n%1 = [0, 1]\n```\n\n> > - Stop treating `gnil` specially, identifying it with `gen_0`.\n> I don't like this. It would lead to things like\n> {{{\n> sage: pari(\"print(12345)\")\n> 12345\n> 0\n> }}}\nI agree that this is a bad solution.\n> So... I still think it's best to disallow `pari(None)`. I see no use case for it and the times where it did come up where all mistakes.\nIn other words, this comes down to a one-way conversion from PARI to Python: whenever `gnil` arises we convert it to `None`, and we never convert `None` back to `gnil`.  Sounds reasonable.",
    "created_at": "2014-10-10T11:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16882#issuecomment-223509",
    "user": "pbruin"
}
```

Replying to [comment:6 jdemeyer]:
> > - Always convert `gnil` to Python `None`, and make `pari(None)` return `None`.
> That wouldn't work with composite objects: what should `pari([None, 1])` be then?
Good point...
> > - Allow wrapping `gnil` (and possibly other PARI objects that are not on the stack) in a Sage `gen` without copying it, so PARI recognises it as `gnil`.
> Theoretically perhaps the best, but hard to do.
I agree.  It may be tricky to implement the decision to copy or not in all the necessary places.  On the other hand, PARI just changes `gnil` to `gen_0` in non-trivial situations:

```
gp > [if(0,1),1]
%1 = [0, 1]
```

> > - Stop treating `gnil` specially, identifying it with `gen_0`.
> I don't like this. It would lead to things like
> {{{
> sage: pari("print(12345)")
> 12345
> 0
> }}}
I agree that this is a bad solution.
> So... I still think it's best to disallow `pari(None)`. I see no use case for it and the times where it did come up where all mistakes.
In other words, this comes down to a one-way conversion from PARI to Python: whenever `gnil` arises we convert it to `None`, and we never convert `None` back to `gnil`.  Sounds reasonable.



---

archive/issue_comments_223510.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-10-10T14:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16882#issuecomment-223510",
    "user": "pbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_223511.json:
```json
{
    "body": "THe UW buildbot slaves set `$HOME` so that they don't share the cython cache:\n\n```\nsage -t --long src/sage/libs/pari/gen.pyx\n**********************************************************************\nFile \"src/sage/libs/pari/gen.pyx\", line 2479, in sage.libs.pari.gen.gen.Strexpand\nFailed example:\n    pari('\"$HOME\"').Strexpand() == pari('[\"~\"]').Strexpand()\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n```\n\nYou can test that `~` expands to something else than `~`, but it doesn't really need to match `$HOME`.",
    "created_at": "2014-10-12T13:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16882#issuecomment-223511",
    "user": "vbraun"
}
```

THe UW buildbot slaves set `$HOME` so that they don't share the cython cache:

```
sage -t --long src/sage/libs/pari/gen.pyx
**********************************************************************
File "src/sage/libs/pari/gen.pyx", line 2479, in sage.libs.pari.gen.gen.Strexpand
Failed example:
    pari('"$HOME"').Strexpand() == pari('["~"]').Strexpand()
Expected:
    True
Got:
    False
**********************************************************************
```

You can test that `~` expands to something else than `~`, but it doesn't really need to match `$HOME`.



---

archive/issue_comments_223512.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-10-12T13:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16882#issuecomment-223512",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_223513.json:
```json
{
    "body": "I thought that `$HOME` was synonymous for `~`, but I guess I'm wrong...",
    "created_at": "2014-10-12T18:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16882#issuecomment-223513",
    "user": "jdemeyer"
}
```

I thought that `$HOME` was synonymous for `~`, but I guess I'm wrong...



---

archive/issue_comments_223514.json:
```json
{
    "body": "I think the best solution is probably a `# random` test.",
    "created_at": "2014-10-14T09:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16882#issuecomment-223514",
    "user": "jdemeyer"
}
```

I think the best solution is probably a `# random` test.



---

archive/issue_comments_223515.json:
```json
{
    "body": "I would check that `pari('\"$HOME\"').Strexpand() != \"$HOME\"`, that verifies that expansion took place. But `$HOME` is, at the end of the day, just an environment variable. Whereas `~` is your home directory that only the system administrator can change.",
    "created_at": "2014-10-14T10:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16882#issuecomment-223515",
    "user": "vbraun"
}
```

I would check that `pari('"$HOME"').Strexpand() != "$HOME"`, that verifies that expansion took place. But `$HOME` is, at the end of the day, just an environment variable. Whereas `~` is your home directory that only the system administrator can change.



---

archive/issue_comments_223516.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-14T12:18:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16882#issuecomment-223516",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_223517.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-10-14T12:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16882#issuecomment-223517",
    "user": "jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_223518.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-15T18:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16882",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16882#issuecomment-223518",
    "user": "vbraun"
}
```

Resolution: fixed
