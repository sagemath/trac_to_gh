# Issue 18196: speed up dimension_new_cusp_forms

archive/issues_018196.json:
```json
{
    "body": "CC:  @kevinywlui\n\nThe code for computing this (and many similar things) in Sage-6.7 (and all previous versions):\n\n```\nGamma0(11000).dimension_new_cusp_forms()\n```\nis just a \"dumb\" recurrence, which could be slow if the level is highly composite.  I just noticed Greg Martin wrote a paper\n\n   http://www.math.ubc.ca/~gerg/papers/downloads/DSCFN.pdf\n\nand slides\n  \n   http://www.math.ubc.ca/~gerg/slides/Vancouver-13Sep12.pdf\n\nthat give a direct formula for computing the dimension of the new subspace for Gamma0(N).  This may as well get coded up by somebody!  And probably wouldn't be hard.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18433\n\n",
    "created_at": "2015-05-16T23:37:46Z",
    "labels": [
        "component: modular forms",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "speed up dimension_new_cusp_forms",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18196",
    "user": "https://github.com/williamstein"
}
```
CC:  @kevinywlui

The code for computing this (and many similar things) in Sage-6.7 (and all previous versions):

```
Gamma0(11000).dimension_new_cusp_forms()
```
is just a "dumb" recurrence, which could be slow if the level is highly composite.  I just noticed Greg Martin wrote a paper

   http://www.math.ubc.ca/~gerg/papers/downloads/DSCFN.pdf

and slides
  
   http://www.math.ubc.ca/~gerg/slides/Vancouver-13Sep12.pdf

that give a direct formula for computing the dimension of the new subspace for Gamma0(N).  This may as well get coded up by somebody!  And probably wouldn't be hard.

Issue created by migration from https://trac.sagemath.org/ticket/18433





---

archive/issue_comments_245255.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-05-27T04:49:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18196#issuecomment-245255",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlee"
}
```

New commits:



---

archive/issue_events_051912.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jlee",
    "created_at": "2015-05-27T04:49:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18196",
    "milestone": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18196#event-51912"
}
```



---

archive/issue_comments_245256.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-27T07:50:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18196#issuecomment-245256",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245257.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-27T08:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18196#issuecomment-245257",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlee"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_245258.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-28T10:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18196#issuecomment-245258",
    "user": "https://trac.sagemath.org/admin/accounts/users/jlee"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_245259.json:
```json
{
    "body": "I checked the code by comparing to the article. It seems to be ok.\n\n---\nNew commits:",
    "created_at": "2017-04-17T10:03:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18196#issuecomment-245259",
    "user": "https://github.com/fchapoton"
}
```

I checked the code by comparing to the article. It seems to be ok.

---
New commits:



---

archive/issue_comments_245260.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-04-17T10:03:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18196#issuecomment-245260",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_051913.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-17T10:03:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18196",
    "milestone": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18196#event-51913"
}
```



---

archive/issue_events_051914.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-17T10:03:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18196",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18196#event-51914"
}
```



---

archive/issue_comments_245261.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-18T06:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18196#issuecomment-245261",
    "user": "https://github.com/kevinywlui"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_245262.json:
```json
{
    "body": "I also checked it against the slides and they seem correct. Performance looks good as well.\n\nold:\n\n```\nsage: G = Gamma0(prod(prime_range(20)))\nsage: %timeit G.dimension_new_cusp_forms()\n10 loops, best of 3: 36.3 ms per loop\nsage: G = Gamma0(next_prime(10000))\nsage: %timeit G.dimension_new_cusp_forms()\n1000 loops, best of 3: 161 \u00b5s per loop\nsage: G = Gamma0(next_prime(1000000))\nsage: %timeit G.dimension_new_cusp_forms()\n10000 loops, best of 3: 163 \u00b5s per loop\n```\n\nnew:\n\n```\nsage: G = Gamma0(prod(prime_range(20)))\nsage: %timeit G.dimension_new_cusp_forms()\nThe slowest run took 4.19 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 3: 89.8 \u00b5s per loop\nsage: G = Gamma0(next_prime(10000))\nsage: %timeit G.dimension_new_cusp_forms()\n10000 loops, best of 3: 60.4 \u00b5s per loop\nsage: G = Gamma0(next_prime(1000000))\nsage: %timeit G.dimension_new_cusp_forms()\nThe slowest run took 16.03 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 3: 71 \u00b5s per loop\n```",
    "created_at": "2017-04-18T06:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18196#issuecomment-245262",
    "user": "https://github.com/kevinywlui"
}
```

I also checked it against the slides and they seem correct. Performance looks good as well.

old:

```
sage: G = Gamma0(prod(prime_range(20)))
sage: %timeit G.dimension_new_cusp_forms()
10 loops, best of 3: 36.3 ms per loop
sage: G = Gamma0(next_prime(10000))
sage: %timeit G.dimension_new_cusp_forms()
1000 loops, best of 3: 161 µs per loop
sage: G = Gamma0(next_prime(1000000))
sage: %timeit G.dimension_new_cusp_forms()
10000 loops, best of 3: 163 µs per loop
```

new:

```
sage: G = Gamma0(prod(prime_range(20)))
sage: %timeit G.dimension_new_cusp_forms()
The slowest run took 4.19 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 89.8 µs per loop
sage: G = Gamma0(next_prime(10000))
sage: %timeit G.dimension_new_cusp_forms()
10000 loops, best of 3: 60.4 µs per loop
sage: G = Gamma0(next_prime(1000000))
sage: %timeit G.dimension_new_cusp_forms()
The slowest run took 16.03 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 71 µs per loop
```



---

archive/issue_events_051915.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-23T12:57:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18196",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18196#event-51915"
}
```



---

archive/issue_comments_245263.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-23T12:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18196#issuecomment-245263",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
