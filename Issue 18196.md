# Issue 18196: speed up dimension_new_cusp_forms

Issue created by migration from https://trac.sagemath.org/ticket/18433

Original creator: was

Original creation time: 2015-05-16 23:37:46

CC:  klui

The code for computing this (and many similar things) in Sage-6.7 (and all previous versions):

```
Gamma0(11000).dimension_new_cusp_forms()
```

is just a "dumb" recurrence, which could be slow if the level is highly composite.  I just noticed Greg Martin wrote a paper

   http://www.math.ubc.ca/~gerg/papers/downloads/DSCFN.pdf

and slides
  
   http://www.math.ubc.ca/~gerg/slides/Vancouver-13Sep12.pdf

that give a direct formula for computing the dimension of the new subspace for Gamma0(N).  This may as well get coded up by somebody!  And probably wouldn't be hard.


---

Comment by jlee created at 2015-05-27 04:49:39

New commits:


---

Comment by git created at 2015-05-27 07:50:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jlee created at 2015-05-27 08:04:56

Changing status from new to needs_review.


---

Comment by jlee created at 2015-05-28 10:03:10

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2017-04-17 10:03:19

I checked the code by comparing to the article. It seems to be ok.
----
New commits:


---

Comment by chapoton created at 2017-04-17 10:03:19

Changing status from needs_work to needs_review.


---

Comment by klui created at 2017-04-18 06:15:58

Changing status from needs_review to positive_review.


---

Comment by klui created at 2017-04-18 06:15:58

I also checked it against the slides and they seem correct. Performance looks good as well.

old:

```
sage: G = Gamma0(prod(prime_range(20)))
sage: %timeit G.dimension_new_cusp_forms()
10 loops, best of 3: 36.3 ms per loop
sage: G = Gamma0(next_prime(10000))
sage: %timeit G.dimension_new_cusp_forms()
1000 loops, best of 3: 161 µs per loop
sage: G = Gamma0(next_prime(1000000))
sage: %timeit G.dimension_new_cusp_forms()
10000 loops, best of 3: 163 µs per loop
```


new:

```
sage: G = Gamma0(prod(prime_range(20)))
sage: %timeit G.dimension_new_cusp_forms()
The slowest run took 4.19 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 89.8 µs per loop
sage: G = Gamma0(next_prime(10000))
sage: %timeit G.dimension_new_cusp_forms()
10000 loops, best of 3: 60.4 µs per loop
sage: G = Gamma0(next_prime(1000000))
sage: %timeit G.dimension_new_cusp_forms()
The slowest run took 16.03 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 71 µs per loop
```



---

Comment by vbraun created at 2017-04-23 12:57:11

Resolution: fixed
