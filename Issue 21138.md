# Issue 21138: py3 get rid of xrange inside combinat

Issue created by migration from https://trac.sagemath.org/ticket/21375

Original creator: chapoton

Original creation time: 2016-08-30 15:36:51

as a step towards python3

replace xrange by Python3-style range, after "from builtins import range"

here only in the combinat folder

* mechanical replacement of xrange by range
* insertion of the imports in the changed files
* fine tuning by hand so that tests pass


---

Comment by chapoton created at 2016-08-30 15:37:25

Changing status from new to needs_review.


---

Comment by chapoton created at 2016-08-30 15:37:25

New commits:


---

Comment by aapitzsch created at 2016-08-30 16:52:00

In _src/sage/combinat/affine_permutation.py_.
Replace `l=['x' for i in range(self.k+1)]` by `l = ['x'] * (self.k+1)`.


```
>>> timeit.timeit("l=['x']*100")
0.8203661441802979
>>> timeit.timeit("l=['x' for i in xrange(100)]")
4.155416011810303
```



---

Comment by tscrim created at 2016-08-30 19:35:21

It is about 10x slower to use the new range:

```sage
sage: %timeit for x in range(500000): pass
100 loops, best of 3: 12.5 ms per loop
sage: %timeit for x in xrange(500000): pass
100 loops, best of 3: 6.32 ms per loop
sage: from builtins import range
sage: %timeit for x in range(500000): pass
10 loops, best of 3: 111 ms per loop
```

So I am -1 for changing the `xrange -> range` now. All of these we should be able to do by running `sed` on the code base when we switch to python3.


---

Comment by chapoton created at 2016-08-30 19:48:07

ok, I thought that it was a perfect replacement, but it is not (coded in Python instead of CPython, I guess)

then let us close this ticket and keep only #16081 and #16457


---

Comment by aapitzsch created at 2016-08-30 20:24:46

Why not using `range` from `six.moves`? It's comparable to `xrange`.


```sage
sage: %timeit for x in range(500000): pass
100 loops, best of 3: 15.8 ms per loop
sage: %timeit for x in xrange(500000): pass
100 loops, best of 3: 9.44 ms per loop
sage: from six.moves import range
sage: %timeit for x in range(500000): pass
100 loops, best of 3: 9.32 ms per loop
```



---

Comment by git created at 2016-08-31 06:47:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-08-31 06:49:21

ok, excellent suggestion, thanks. I just did that by replacing all the imports.

Our aim being to have code running both in py2 and py3, this is a much better solution.


---

Comment by git created at 2016-08-31 12:07:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-08-31 14:17:08

When the patchbot comes back green or all tests pass, you can set a positive review.

`@`aapitzsch thanks for letting us know about `six.moves.range`!


---

Comment by git created at 2016-08-31 17:02:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-08-31 19:39:20

ok, bot is green, setting this patchbomb to positive review. There will surely be rebasing issues.


---

Comment by chapoton created at 2016-08-31 19:39:20

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-09-02 19:00:42

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-09-02 19:00:42

Merge conflict


---

Comment by git created at 2016-09-09 07:37:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-09-09 07:37:53

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2016-09-09 07:37:53

merged with 7.4.b4 (easy merge, nothing strange)


---

Comment by tscrim created at 2016-09-09 13:34:10

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-09-10 09:00:20

Resolution: fixed
