# Issue 13561: Cyclotomic embeddings should respect coercions.

archive/issues_013561.json:
```json
{
    "body": "Assignee: @loefflerd\n\nCC:  @nbruin\n\n\n```\nsage: zC=(CC(-1)^(1/3))^2\nsage: Ka.<aa>=CyclotomicField(3,embedding=zC)\nsage: Kb.<bb>=CyclotomicField(3,embedding=zC^2)\nsage: Kc.<cc>=CyclotomicField(3,embedding=CC(17))\nsage: CC(aa)\n-0.500000000000000 + 0.866025403784439*I\nsage: CC(bb)\n-0.500000000000000 - 0.866025403784439*I\nsage: CC(Ka(bb))\n-0.500000000000000 + 0.866025403784439*I\n```\n\n\nIt's better to disallow coercions between these then allow this nonsense\n\n\n```\nsage: CC(aa+bb)\n -1.00000000000000 + 1.73205080756888*I\n\nsage: CC(bb+aa)\n -1.00000000000000 - 1.73205080756888*I\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/13765\n\n",
    "created_at": "2012-11-27T21:57:25Z",
    "labels": [
        "component: number fields",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.7",
    "title": "Cyclotomic embeddings should respect coercions.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13561",
    "user": "https://github.com/robertwb"
}
```
Assignee: @loefflerd

CC:  @nbruin


```
sage: zC=(CC(-1)^(1/3))^2
sage: Ka.<aa>=CyclotomicField(3,embedding=zC)
sage: Kb.<bb>=CyclotomicField(3,embedding=zC^2)
sage: Kc.<cc>=CyclotomicField(3,embedding=CC(17))
sage: CC(aa)
-0.500000000000000 + 0.866025403784439*I
sage: CC(bb)
-0.500000000000000 - 0.866025403784439*I
sage: CC(Ka(bb))
-0.500000000000000 + 0.866025403784439*I
```


It's better to disallow coercions between these then allow this nonsense


```
sage: CC(aa+bb)
 -1.00000000000000 + 1.73205080756888*I

sage: CC(bb+aa)
 -1.00000000000000 - 1.73205080756888*I
```


Issue created by migration from https://trac.sagemath.org/ticket/13765





---

archive/issue_comments_167446.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-11-29T11:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13561#issuecomment-167446",
    "user": "https://github.com/robertwb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_167447.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2012-11-29T11:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13561#issuecomment-167447",
    "user": "https://github.com/robertwb"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_167448.json:
```json
{
    "body": "One minor comment about the doc :\n\nmaybe you could use the trac role :trac:`13765` to link to the ticket ?\n\n(see #12490)",
    "created_at": "2012-12-11T20:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13561#issuecomment-167448",
    "user": "https://github.com/fchapoton"
}
```

One minor comment about the doc :

maybe you could use the trac role :trac:`13765` to link to the ticket ?

(see #12490)



---

archive/issue_comments_167449.json:
```json
{
    "body": "There is a typo  \"no such integer exits\"",
    "created_at": "2012-12-11T20:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13561#issuecomment-167449",
    "user": "https://github.com/fchapoton"
}
```

There is a typo  "no such integer exits"



---

archive/issue_comments_167450.json:
```json
{
    "body": "I have made the small changes that I suggested :\n\napply trac-13765-cyclo-embeddings.patch",
    "created_at": "2012-12-18T21:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13561#issuecomment-167450",
    "user": "https://github.com/fchapoton"
}
```

I have made the small changes that I suggested :

apply trac-13765-cyclo-embeddings.patch



---

archive/issue_comments_167451.json:
```json
{
    "body": "Your changes look fine to me, thanks.",
    "created_at": "2013-01-02T18:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13561#issuecomment-167451",
    "user": "https://github.com/robertwb"
}
```

Your changes look fine to me, thanks.



---

archive/issue_comments_167452.json:
```json
{
    "body": "apply trac-13765-cyclo-embeddings.patch",
    "created_at": "2013-01-24T18:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13561#issuecomment-167452",
    "user": "https://github.com/fchapoton"
}
```

apply trac-13765-cyclo-embeddings.patch



---

archive/issue_comments_167453.json:
```json
{
    "body": "apply trac-13765-cyclo-embeddings.patch",
    "created_at": "2013-01-24T22:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13561#issuecomment-167453",
    "user": "https://github.com/fchapoton"
}
```

apply trac-13765-cyclo-embeddings.patch



---

archive/issue_comments_167454.json:
```json
{
    "body": "* I tested the patch using Sage 5.5.\n  * It is well documented and it solves the bug as far as I can see.\n  * The documentation builds.\n\nBut I am not convinced that the implementation of NumberField_cyclotomic._log_gen should stay like it is. It is a private method but it might be used within the class for ther purposes later. Therefore, I think the output should always make sense. But it doesn't always and it is not completely consistent. Here is an Example.\n\nThis is what I expect from the documentation:\n\n\n```\n sage: K.<zeta>=CyclotomicField(5, embedding=CC(exp(2*pi*i/5)))    \n sage: K._log_gen(10)\n sage: type(K._log_gen(10))\n <type 'NoneType'>\n```\n\nSo, this is o.k., but:\n\n\n```\n sage: K.<zeta>=CyclotomicField(5, embedding=CC(exp(2*pi*i/5)))    \n sage: K._log_gen(CDF(10))\n sage: 0\n sage: type(K._log_gen(CDF(10)))\n sage: <type 'sage.rings.integer.Integer'>\n```\n\nThis behaviour is more or less documented in the docstring. It says that \"If x is complex, returns the nearest such e whether or not the result is exact.\". But I don't agree that it should be this way.\n\nBut I think this is not consistent and it should be fixed.",
    "created_at": "2013-01-25T12:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13561#issuecomment-167454",
    "user": "https://trac.sagemath.org/admin/accounts/users/ehlen"
}
```

* I tested the patch using Sage 5.5.
  * It is well documented and it solves the bug as far as I can see.
  * The documentation builds.

But I am not convinced that the implementation of NumberField_cyclotomic._log_gen should stay like it is. It is a private method but it might be used within the class for ther purposes later. Therefore, I think the output should always make sense. But it doesn't always and it is not completely consistent. Here is an Example.

This is what I expect from the documentation:


```
 sage: K.<zeta>=CyclotomicField(5, embedding=CC(exp(2*pi*i/5)))    
 sage: K._log_gen(10)
 sage: type(K._log_gen(10))
 <type 'NoneType'>
```

So, this is o.k., but:


```
 sage: K.<zeta>=CyclotomicField(5, embedding=CC(exp(2*pi*i/5)))    
 sage: K._log_gen(CDF(10))
 sage: 0
 sage: type(K._log_gen(CDF(10)))
 sage: <type 'sage.rings.integer.Integer'>
```

This behaviour is more or less documented in the docstring. It says that "If x is complex, returns the nearest such e whether or not the result is exact.". But I don't agree that it should be this way.

But I think this is not consistent and it should be fixed.



---

archive/issue_comments_167455.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-01-25T12:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13561#issuecomment-167455",
    "user": "https://trac.sagemath.org/admin/accounts/users/ehlen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_167456.json:
```json
{
    "body": "Attachment [trac-13765-cyclo-embeddings.patch](tarball://root/attachments/some-uuid/ticket13765/trac-13765-cyclo-embeddings.patch) by @fchapoton created at 2013-01-25 14:37:02\n\nHere is a better patch, as we discussed\n\napply trac-13765-cyclo-embeddings.patch",
    "created_at": "2013-01-25T14:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13561#issuecomment-167456",
    "user": "https://github.com/fchapoton"
}
```

Attachment [trac-13765-cyclo-embeddings.patch](tarball://root/attachments/some-uuid/ticket13765/trac-13765-cyclo-embeddings.patch) by @fchapoton created at 2013-01-25 14:37:02

Here is a better patch, as we discussed

apply trac-13765-cyclo-embeddings.patch



---

archive/issue_comments_167457.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-01-25T16:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13561#issuecomment-167457",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_167458.json:
```json
{
    "body": "As you over-write the previous patch, I can't tell what changed. Is it just the two-line sanity check and corresponding change to the documentation? Seems like a OK restriction to me, in which case positive review to your changes.",
    "created_at": "2013-01-25T17:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13561#issuecomment-167458",
    "user": "https://github.com/robertwb"
}
```

As you over-write the previous patch, I can't tell what changed. Is it just the two-line sanity check and corresponding change to the documentation? Seems like a OK restriction to me, in which case positive review to your changes.



---

archive/issue_comments_167459.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-25T18:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13561#issuecomment-167459",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_167460.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-01-30T07:34:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13561",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13561#issuecomment-167460",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_013425.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-30T07:34:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13561",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13561#event-13425"
}
```
