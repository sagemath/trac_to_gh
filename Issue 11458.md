# Issue 11458: Local data of elliptic curves should not do any global work

Issue created by migration from https://trac.sagemath.org/ticket/11630

Original creator: wuthrich

Original creation time: 2011-07-26 14:14:50

Assignee: cremona

CC:  cremona

Keywords: Tate's algorithm

... unless asked to do so.

I am talking about the line 687 in sage.scheme.elliptic_curves_ell_local_data  which reads


```
        principal_flag = P.is_principal()
        if principal_flag:
            pi = P.gens_reduced()[0]
            verbose("P is principal, generator pi = %s"%pi, t, 1)
        else:
            pi = K.uniformizer(P, 'positive')
            verbose("P is not principal, uniformizer pi = %s"%pi, t, 1)
```


While it can be useful, especially when one wants a global minimal model, it is often very harmful. If the class group of the field is huge or difficult to compute, one will not be able to determine the fibres of the Neron model, simply because of this line.

One should add a switch which is by default set to use the second case and only if needed to the first case.

Of course, in an ideal world Tate's algorithm should be implemented for any elliptic curve over a local field, rather than a number field.


---

Comment by cremona created at 2011-07-26 14:21:11

That is a sensible suggestion, and if you write a patch I'll review it!  Ideally I would like the code to say "if you know that P is principal and have a generator, the use it, otherwise...", but I suppose that is what the uniformizer function might do anyway.

I think that even if we did have a version for Tate's algorithm which applied directly to an elliptic curve over a local field, I would still want a global version -- which used generators of prime ideals for fields of class number 1 at least!


---

Comment by wuthrich created at 2011-07-29 15:55:53

This patch does what I suggested + it also changes global_minimal_model. This function was only implemented when the class number was 1, now it tries to change to a global minimal model in any field.

The patch should be applied after #11540.


---

Comment by wuthrich created at 2011-07-29 15:55:53

Changing status from new to needs_review.


---

Comment by cremona created at 2011-07-31 13:49:14

Changing status from needs_review to needs_work.


---

Comment by cremona created at 2011-07-31 13:49:14

First a technical point:  the patch does not apply to 4.7.1.rc1+#11540.  Since 4.7.1 is almost out could you rebase the patch to the latest release candidate?

I'll test more after that.  Meanwhile I am not sure that the logic is correct in the new, more general, global_minimal_model() function.  Are you assuming that the is a global minimal modell iff after replacing with a local minimal model at every relevant prime, one after the other, the result is minimal at all primes?  I'm sure that is not right.  On my (infinitely long) to-do list is a function that determines whether there is a global minimal model for any curve, which comes down to computing a certain ideal and testing if it is principal; if so then (using a generator for that ideal) one can find the minimal model.  That should be done, but not on this ticket.


---

Comment by wuthrich created at 2011-08-17 15:39:37

Thanks, John, for the quick review and for spotting my stupid error. In fact all I really wanted was that global minimal models are recognised when they are, but that was a bad idea. I agree with your comments and with your suggestion to open another ticket for this. This is ticket #11697 .

I will rebase it today, hopefully, and delete the relevant passages. (Sorry, but I have decided quite a while ago not to work with intermediate versions anymore, but now 4.7.1 is here.)


---

Comment by wuthrich created at 2011-08-17 15:39:37

Remove assignee cremona.


---

Comment by wuthrich created at 2011-08-18 09:29:19

Ok. I rebased it and I removed the changes in `global_minimal_model`.
The patch should be applied after #11540.


---

Comment by wuthrich created at 2011-08-18 09:29:19

Changing status from needs_work to needs_review.


---

Comment by wuthrich created at 2011-11-17 17:00:21

The patch still applies to 4.7.2.


---

Comment by davidloeffler created at 2012-03-11 16:48:51

The patch does not apply to 4.8 or to 5.0.beta7, according to the patchbot.


---

Comment by davidloeffler created at 2012-03-11 16:48:51

Changing status from needs_review to needs_work.


---

Comment by wuthrich created at 2013-05-04 20:46:43

Changing status from needs_work to needs_review.


---

Comment by wuthrich created at 2013-05-04 20:46:43

I rebased the patch. I exported it after appying #12509 and #13953, but maybe that is no problem.

The new patch includes a lot of deletion of trailing white space in the two edited files. Not sure that this is desired.


---

Comment by wuthrich created at 2013-05-14 10:16:07

exported against 5.9


---

Attachment

I have removed the whitespaces. This patch should apply to 5.9 + #12509.


---

Comment by wuthrich created at 2013-12-22 22:22:05

That is my first use of the new git-stuff. I hope I did the right thing.

I simply rebased the patch. It is ready for a review.
----
New commits:


---

Comment by cremona created at 2013-12-22 22:50:46

I have put this onto my to-do list to attempt my first git-style review, but in view of the season do not promise to do it in the next few days.
[8 days later]
Under review!


---

Comment by cremona created at 2013-12-30 16:32:32

I am giving this a positive review despite the patchbot's red blob.


---

Comment by cremona created at 2013-12-30 16:32:32

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-01-05 06:54:09

Resolution: fixed
