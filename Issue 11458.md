# Issue 11458: Local data of elliptic curves should not do any global work

archive/issues_011458.json:
```json
{
    "body": "Assignee: cremona\n\nCC:  cremona\n\nKeywords: Tate's algorithm\n\n... unless asked to do so.\n\nI am talking about the line 687 in sage.scheme.elliptic_curves_ell_local_data  which reads\n\n\n```\n        principal_flag = P.is_principal()\n        if principal_flag:\n            pi = P.gens_reduced()[0]\n            verbose(\"P is principal, generator pi = %s\"%pi, t, 1)\n        else:\n            pi = K.uniformizer(P, 'positive')\n            verbose(\"P is not principal, uniformizer pi = %s\"%pi, t, 1)\n```\n\n\nWhile it can be useful, especially when one wants a global minimal model, it is often very harmful. If the class group of the field is huge or difficult to compute, one will not be able to determine the fibres of the Neron model, simply because of this line.\n\nOne should add a switch which is by default set to use the second case and only if needed to the first case.\n\nOf course, in an ideal world Tate's algorithm should be implemented for any elliptic curve over a local field, rather than a number field.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11630\n\n",
    "created_at": "2011-07-26T14:14:50Z",
    "labels": [
        "elliptic curves",
        "major",
        "bug"
    ],
    "title": "Local data of elliptic curves should not do any global work",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11458",
    "user": "wuthrich"
}
```
Assignee: cremona

CC:  cremona

Keywords: Tate's algorithm

... unless asked to do so.

I am talking about the line 687 in sage.scheme.elliptic_curves_ell_local_data  which reads


```
        principal_flag = P.is_principal()
        if principal_flag:
            pi = P.gens_reduced()[0]
            verbose("P is principal, generator pi = %s"%pi, t, 1)
        else:
            pi = K.uniformizer(P, 'positive')
            verbose("P is not principal, uniformizer pi = %s"%pi, t, 1)
```


While it can be useful, especially when one wants a global minimal model, it is often very harmful. If the class group of the field is huge or difficult to compute, one will not be able to determine the fibres of the Neron model, simply because of this line.

One should add a switch which is by default set to use the second case and only if needed to the first case.

Of course, in an ideal world Tate's algorithm should be implemented for any elliptic curve over a local field, rather than a number field.

Issue created by migration from https://trac.sagemath.org/ticket/11630





---

archive/issue_comments_127886.json:
```json
{
    "body": "That is a sensible suggestion, and if you write a patch I'll review it!  Ideally I would like the code to say \"if you know that P is principal and have a generator, the use it, otherwise...\", but I suppose that is what the uniformizer function might do anyway.\n\nI think that even if we did have a version for Tate's algorithm which applied directly to an elliptic curve over a local field, I would still want a global version -- which used generators of prime ideals for fields of class number 1 at least!",
    "created_at": "2011-07-26T14:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127886",
    "user": "cremona"
}
```

That is a sensible suggestion, and if you write a patch I'll review it!  Ideally I would like the code to say "if you know that P is principal and have a generator, the use it, otherwise...", but I suppose that is what the uniformizer function might do anyway.

I think that even if we did have a version for Tate's algorithm which applied directly to an elliptic curve over a local field, I would still want a global version -- which used generators of prime ideals for fields of class number 1 at least!



---

archive/issue_comments_127887.json:
```json
{
    "body": "This patch does what I suggested + it also changes global_minimal_model. This function was only implemented when the class number was 1, now it tries to change to a global minimal model in any field.\n\nThe patch should be applied after #11540.",
    "created_at": "2011-07-29T15:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127887",
    "user": "wuthrich"
}
```

This patch does what I suggested + it also changes global_minimal_model. This function was only implemented when the class number was 1, now it tries to change to a global minimal model in any field.

The patch should be applied after #11540.



---

archive/issue_comments_127888.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-07-29T15:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127888",
    "user": "wuthrich"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_127889.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-07-31T13:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127889",
    "user": "cremona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_127890.json:
```json
{
    "body": "First a technical point:  the patch does not apply to 4.7.1.rc1+#11540.  Since 4.7.1 is almost out could you rebase the patch to the latest release candidate?\n\nI'll test more after that.  Meanwhile I am not sure that the logic is correct in the new, more general, global_minimal_model() function.  Are you assuming that the is a global minimal modell iff after replacing with a local minimal model at every relevant prime, one after the other, the result is minimal at all primes?  I'm sure that is not right.  On my (infinitely long) to-do list is a function that determines whether there is a global minimal model for any curve, which comes down to computing a certain ideal and testing if it is principal; if so then (using a generator for that ideal) one can find the minimal model.  That should be done, but not on this ticket.",
    "created_at": "2011-07-31T13:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127890",
    "user": "cremona"
}
```

First a technical point:  the patch does not apply to 4.7.1.rc1+#11540.  Since 4.7.1 is almost out could you rebase the patch to the latest release candidate?

I'll test more after that.  Meanwhile I am not sure that the logic is correct in the new, more general, global_minimal_model() function.  Are you assuming that the is a global minimal modell iff after replacing with a local minimal model at every relevant prime, one after the other, the result is minimal at all primes?  I'm sure that is not right.  On my (infinitely long) to-do list is a function that determines whether there is a global minimal model for any curve, which comes down to computing a certain ideal and testing if it is principal; if so then (using a generator for that ideal) one can find the minimal model.  That should be done, but not on this ticket.



---

archive/issue_comments_127891.json:
```json
{
    "body": "Thanks, John, for the quick review and for spotting my stupid error. In fact all I really wanted was that global minimal models are recognised when they are, but that was a bad idea. I agree with your comments and with your suggestion to open another ticket for this. This is ticket #11697 .\n\nI will rebase it today, hopefully, and delete the relevant passages. (Sorry, but I have decided quite a while ago not to work with intermediate versions anymore, but now 4.7.1 is here.)",
    "created_at": "2011-08-17T15:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127891",
    "user": "wuthrich"
}
```

Thanks, John, for the quick review and for spotting my stupid error. In fact all I really wanted was that global minimal models are recognised when they are, but that was a bad idea. I agree with your comments and with your suggestion to open another ticket for this. This is ticket #11697 .

I will rebase it today, hopefully, and delete the relevant passages. (Sorry, but I have decided quite a while ago not to work with intermediate versions anymore, but now 4.7.1 is here.)



---

archive/issue_comments_127892.json:
```json
{
    "body": "Remove assignee cremona.",
    "created_at": "2011-08-17T15:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127892",
    "user": "wuthrich"
}
```

Remove assignee cremona.



---

archive/issue_comments_127893.json:
```json
{
    "body": "Ok. I rebased it and I removed the changes in `global_minimal_model`.\nThe patch should be applied after #11540.",
    "created_at": "2011-08-18T09:29:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127893",
    "user": "wuthrich"
}
```

Ok. I rebased it and I removed the changes in `global_minimal_model`.
The patch should be applied after #11540.



---

archive/issue_comments_127894.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-08-18T09:29:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127894",
    "user": "wuthrich"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_127895.json:
```json
{
    "body": "The patch still applies to 4.7.2.",
    "created_at": "2011-11-17T17:00:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127895",
    "user": "wuthrich"
}
```

The patch still applies to 4.7.2.



---

archive/issue_comments_127896.json:
```json
{
    "body": "The patch does not apply to 4.8 or to 5.0.beta7, according to the patchbot.",
    "created_at": "2012-03-11T16:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127896",
    "user": "davidloeffler"
}
```

The patch does not apply to 4.8 or to 5.0.beta7, according to the patchbot.



---

archive/issue_comments_127897.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-11T16:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127897",
    "user": "davidloeffler"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_127898.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-04T20:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127898",
    "user": "wuthrich"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_127899.json:
```json
{
    "body": "I rebased the patch. I exported it after appying #12509 and #13953, but maybe that is no problem.\n\nThe new patch includes a lot of deletion of trailing white space in the two edited files. Not sure that this is desired.",
    "created_at": "2013-05-04T20:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127899",
    "user": "wuthrich"
}
```

I rebased the patch. I exported it after appying #12509 and #13953, but maybe that is no problem.

The new patch includes a lot of deletion of trailing white space in the two edited files. Not sure that this is desired.



---

archive/issue_comments_127900.json:
```json
{
    "body": "exported against 5.9",
    "created_at": "2013-05-14T10:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127900",
    "user": "wuthrich"
}
```

exported against 5.9



---

archive/issue_comments_127901.json:
```json
{
    "body": "Attachment\n\nI have removed the whitespaces. This patch should apply to 5.9 + #12509.",
    "created_at": "2013-05-14T16:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127901",
    "user": "wuthrich"
}
```

Attachment

I have removed the whitespaces. This patch should apply to 5.9 + #12509.



---

archive/issue_comments_127902.json:
```json
{
    "body": "That is my first use of the new git-stuff. I hope I did the right thing.\n\nI simply rebased the patch. It is ready for a review.\n----\nNew commits:",
    "created_at": "2013-12-22T22:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127902",
    "user": "wuthrich"
}
```

That is my first use of the new git-stuff. I hope I did the right thing.

I simply rebased the patch. It is ready for a review.
----
New commits:



---

archive/issue_comments_127903.json:
```json
{
    "body": "I have put this onto my to-do list to attempt my first git-style review, but in view of the season do not promise to do it in the next few days.\n[8 days later]\nUnder review!",
    "created_at": "2013-12-22T22:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127903",
    "user": "cremona"
}
```

I have put this onto my to-do list to attempt my first git-style review, but in view of the season do not promise to do it in the next few days.
[8 days later]
Under review!



---

archive/issue_comments_127904.json:
```json
{
    "body": "I am giving this a positive review despite the patchbot's red blob.",
    "created_at": "2013-12-30T16:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127904",
    "user": "cremona"
}
```

I am giving this a positive review despite the patchbot's red blob.



---

archive/issue_comments_127905.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-30T16:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127905",
    "user": "cremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_127906.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-05T06:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11458#issuecomment-127906",
    "user": "vbraun"
}
```

Resolution: fixed
