# Issue 30240: preparsing Python's complex literals is broken in the REPL

Issue created by migration from https://trac.sagemath.org/ticket/30477

Original creator: @mwageringel

Original creation time: 2020-08-31 07:00:26

Keywords: preparser

The following works during doctests:

```
sage: preparse("1rj")
'1J'
sage: 1r + 1rj
(1+1j)
```


However, in the REPL it fails:

```
sage: preparse("1rj")
'Integer(1)*rj'
sage: 1r + 1rj
...
NameError: name 'rj' is not defined
```



---

Comment by slelievre created at 2020-08-31 12:29:17

Changing status from new to needs_review.


---

Comment by slelievre created at 2020-08-31 12:29:17

To signal a complex literal as raw, place the `r` at the very end:

```
sage: 1jr
1j
sage: 1r + 1jr
(1+1j)
```


I suggest to close as invalid or wontfix.

But I will listen to arguments for doing otherwise.


---

Comment by @mwageringel created at 2020-08-31 17:45:15

Oh, it turns out this is a conflict with implicit multiplication, which I had enabled in my init.sage file. Both `1rj` and `1jr` work when implicit multiplication is disabled. I have updated the description.


---

Comment by @mwageringel created at 2020-08-31 17:45:15

Changing priority from major to minor.


---

Comment by slelievre created at 2020-08-31 18:00:52

Changing status from needs_review to needs_info.


---

Comment by slelievre created at 2020-08-31 18:00:52

Should we make `1jr` the only valid form?


---

Comment by @mwageringel created at 2020-08-31 18:10:55

There is no need for that I think.


---

Comment by @mwageringel created at 2020-08-31 20:00:57

Changing status from needs_info to needs_review.


---

Comment by @mwageringel created at 2020-08-31 20:00:57

Here is a minimal fix. I have also changed the regular expressions to be case-insensitive, which solves the following problem with scientific notation and implicit multiplication:

```
sage: implicit_multiplication(True)
sage: 1e3
1000.00000000000
sage: 1E3
...
NameError: name 'E3' is not defined
```

----
New commits:


---

Comment by mkoeppe created at 2021-03-24 02:04:25

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.


---

Comment by mmezzarobba created at 2021-09-18 09:55:30

Lgtm, thank you!


---

Comment by mmezzarobba created at 2021-09-21 13:30:54

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-10-19 20:31:03

Resolution: fixed
