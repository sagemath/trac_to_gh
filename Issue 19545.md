# Issue 19545: Symlink lib64 -> lib

Issue created by migration from https://trac.sagemath.org/ticket/19782

Original creator: vbraun

Original creation time: 2015-12-25 13:36:26

CC:  leif jdemeyer




---

Comment by vbraun created at 2015-12-25 17:04:40

New commits:


---

Comment by vbraun created at 2015-12-25 17:04:40

Changing component from PLEASE CHANGE to build.


---

Comment by vbraun created at 2015-12-25 17:04:40

Changing status from new to needs_review.


---

Comment by vbraun created at 2015-12-25 17:04:40

Changing type from PLEASE CHANGE to defect.


---

Comment by leif created at 2015-12-25 17:16:37

Hmmm, if `lib64` is still a folder, we could just copy (or move) its contents to `lib` and afterwards create the symlink anyway.

I also thought we'd "fix" the GCC spkg w.r.t. this, as you said it's the only package which fills the `lib64` folder.


---

Comment by leif created at 2015-12-25 17:19:06

Ooops, it's the other way around.


---

Comment by leif created at 2015-12-25 17:20:41

... or not even that.

Shouldn't we base one on the other?


---

Comment by vbraun created at 2015-12-25 18:14:05

I'd rather not try to do upgrade it on the fly, just unnecessary complications when we don't have incremental updates 6.10 -> 7.0 anyways. You'd also need locking and/or atomic operation as it will be hit in parallel from separate make processes. 

I remember we tried to make gcc install to lib (instead lib64) but there is no easy way, its hardcoded. 

I know there is a conflict with #19776, will fix it when needed.


---

Comment by jdemeyer created at 2015-12-26 12:50:14

Replying to [comment:7 vbraun]:
> I'd rather not try to do upgrade it on the fly, just unnecessary complications when we don't have incremental updates 6.10 -> 7.0 anyways.

I agree.


---

Comment by jdemeyer created at 2015-12-26 12:50:14

Changing priority from major to blocker.


---

Comment by jdemeyer created at 2015-12-26 12:53:06

I get the idea of the patch, but I would rather do it in `configure`. We are already creating the directory structure there, so it seems like a more logical place.


---

Comment by vbraun created at 2015-12-26 15:08:27

I'd rather keep creation of `SAGE_LOCAL` stuff out of configure, ideally it should go into `make install` though we are not there yet.

If you do change configure then you need a new confball.
----
New commits:


---

Comment by jdemeyer created at 2015-12-26 15:20:55

Replying to [comment:11 vbraun]:
> I'd rather keep creation of `SAGE_LOCAL` stuff out of configure

Why? I think this should be done as early as possible in the build process. It is convenient if all other scripts in Sage can assume the existence of the basic directory structure.

And given that this basic directory structure is created by `configure`, it is most natural to create also the `lib64` symlink there.


---

Comment by git created at 2015-12-26 15:38:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-12-26 15:48:08

Configure does IMHO already too many things that it has no place to do; Why create install directories there? Its also testing package configuration for correctness (as opposed to during testing). Neither of these are typically done by configure. 

Besides being the wrong place, putting stuff into configure makes it also unnecessarily difficult to work on that in the future as it is an additional layer of inception (script writing shell script) and requires an arcane process of creating a new confball.  

That said if you insist on doing it the wrong way then I'd rather have the lib64 symlink than fix that particular configure insanity


---

Comment by jdemeyer created at 2015-12-26 15:53:27

Replying to [comment:16 vbraun]:
> as it is an additional layer of inception

That's standard `configure` stuff, it don't see why it is a complication.

> requires an arcane process of creating a new confball.

That's purely a "release management" thing. There is no fundamental reason for it, it's only because of your workflow.


---

Comment by jdemeyer created at 2015-12-26 15:55:49

Replying to [comment:16 vbraun]:
> Why create install directories there?

Like I said, this is for convenience. It allows for example `sage-env` and other scripts to assume that those directories exist. I agree it's non-standard, but really the whole Sage distribution is non-standard.


---

Comment by vbraun created at 2015-12-26 16:04:35

Replying to [comment:17 jdemeyer]:
> That's standard `configure` stuff, it don't see why it is a complication.

How many Sage developers are comfortable working with configure.ac? Maybe 5%? 

> That's purely a "release management" thing. There is no fundamental reason for it, it's only because of your workflow.

There is a fundamental reason, OSX doesn't come with autotools so we can't do the configure.ac -> configure at the client. Any change to configure.ac necessarily entails further release steps, which is why I really don't like stuff thats absolutely not configureable in there.

Replying to [comment:18 jdemeyer]:
> It allows for example `sage-env` and other scripts to assume that those directories exist. 

`sage-env` shouldn't do anythning besides setting up the environment, it certainly shouldn't do anyhing different depending on how far along we are in the install process.


---

Comment by vbraun created at 2015-12-26 16:20:13

In any case, set this ticket to positive review from me if you don't want to change it.


---

Comment by jdemeyer created at 2015-12-26 17:03:28

Replying to [comment:19 vbraun]:
> There is a fundamental reason, OSX doesn't come with autotools so we can't do the configure.ac -> configure at the client.

1. You could do a custom install of autotools on those clients.

2. You could run `./bootstrap -s` on your "release management" machine and then copy over the `configure` tarball. This is easily automated.


---

Comment by jdemeyer created at 2015-12-26 17:03:35

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-12-28 11:08:17

Resolution: fixed


---

Comment by embray created at 2019-01-02 11:53:18

Nothing in this ticket explains why this was deemed necessary.  I think I'll remove it.


---

Comment by vbraun created at 2019-01-02 12:17:55

In various places we assume that our shared libraries are in `$SAGE_LOCAL/lib`; If a package installs stuff in a different library folder like `$SAGE_LOCAL/lib64` then we won't be able to load it.


---

Comment by embray created at 2019-01-02 12:27:09

What is installed to lib64, and what do you need to link to it?


---

Comment by vbraun created at 2019-01-02 13:45:13

I don't have a comprehensive list of packages that attempt to install stuff in `lib64`, fwiw. Its likely to be platform-dependent, too.


---

Comment by embray created at 2019-01-02 14:02:32

Other than gcc/gfortran I don't think there's anything that does, otherwise you would run into this same problem.


---

Comment by kcrisman created at 2019-03-17 21:06:30

I'm running into trouble related to this, I think.  I upgraded a Linux (Ubuntu  Bionic Beaver) version of Sage from something like 6.8, ran into a problem, followed the message to do `make distclean` first.  I made it to `gfortran` and that seems to compile fine, but then at the very end

```
[gfortran-7.2.0] make[8]: Leaving directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/gcc-build/x86_64-pc-linux-gnu/libatomic'
[gfortran-7.2.0] make[7]: Leaving directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/gcc-build/x86_64-pc-linux-gnu/libatomic'
[gfortran-7.2.0] make[6]: Leaving directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/gcc-build/x86_64-pc-linux-gnu/libatomic'
[gfortran-7.2.0] make[5]: Leaving directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/gcc-build'
[gfortran-7.2.0] make[4]: Leaving directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/gcc-build'
[gfortran-7.2.0] 
[gfortran-7.2.0] real	27m10.068s
[gfortran-7.2.0] user	24m8.801s
[gfortran-7.2.0] sys	2m36.607s
[gfortran-7.2.0] Copying package files from temporary location /home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/inst to /home/crisman/sage/local
[gfortran-7.2.0] cp: cannot overwrite non-directory '/home/crisman/sage/local/./lib64' with directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/inst/home/crisman/sage/local/./lib64'
[gfortran-7.2.0] ************************************************************************
[gfortran-7.2.0] Error copying files for gfortran-7.2.0.
[gfortran-7.2.0] ************************************************************************
[gfortran-7.2.0] Please email sage-devel (http://groups.google.com/group/sage-devel)
[gfortran-7.2.0] explaining the problem and including the log file
[gfortran-7.2.0]   /home/crisman/sage/logs/pkgs/gfortran-7.2.0.log
[gfortran-7.2.0] Describe your computer, operating system, etc.
[gfortran-7.2.0] ************************************************************************
```

I can report this on sage-devel as well (I doubt it is a particular release thing unless this was indeed a very recent change) if it would be found useful.  Otherwise I don't have a way to proceed.
