# Issue 19545: Symlink lib64 -> lib

archive/issues_019545.json:
```json
{
    "body": "CC:  leif jdemeyer\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/19782\n\n",
    "created_at": "2015-12-25T13:36:26Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "Symlink lib64 -> lib",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19545",
    "user": "vbraun"
}
```
CC:  leif jdemeyer



Issue created by migration from https://trac.sagemath.org/ticket/19782





---

archive/issue_comments_268651.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-12-25T17:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268651",
    "user": "vbraun"
}
```

New commits:



---

archive/issue_comments_268652.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to build.",
    "created_at": "2015-12-25T17:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268652",
    "user": "vbraun"
}
```

Changing component from PLEASE CHANGE to build.



---

archive/issue_comments_268653.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-12-25T17:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268653",
    "user": "vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_268654.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2015-12-25T17:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268654",
    "user": "vbraun"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_268655.json:
```json
{
    "body": "Hmmm, if `lib64` is still a folder, we could just copy (or move) its contents to `lib` and afterwards create the symlink anyway.\n\nI also thought we'd \"fix\" the GCC spkg w.r.t. this, as you said it's the only package which fills the `lib64` folder.",
    "created_at": "2015-12-25T17:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268655",
    "user": "leif"
}
```

Hmmm, if `lib64` is still a folder, we could just copy (or move) its contents to `lib` and afterwards create the symlink anyway.

I also thought we'd "fix" the GCC spkg w.r.t. this, as you said it's the only package which fills the `lib64` folder.



---

archive/issue_comments_268656.json:
```json
{
    "body": "Ooops, it's the other way around.",
    "created_at": "2015-12-25T17:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268656",
    "user": "leif"
}
```

Ooops, it's the other way around.



---

archive/issue_comments_268657.json:
```json
{
    "body": "... or not even that.\n\nShouldn't we base one on the other?",
    "created_at": "2015-12-25T17:20:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268657",
    "user": "leif"
}
```

... or not even that.

Shouldn't we base one on the other?



---

archive/issue_comments_268658.json:
```json
{
    "body": "I'd rather not try to do upgrade it on the fly, just unnecessary complications when we don't have incremental updates 6.10 -> 7.0 anyways. You'd also need locking and/or atomic operation as it will be hit in parallel from separate make processes. \n\nI remember we tried to make gcc install to lib (instead lib64) but there is no easy way, its hardcoded. \n\nI know there is a conflict with #19776, will fix it when needed.",
    "created_at": "2015-12-25T18:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268658",
    "user": "vbraun"
}
```

I'd rather not try to do upgrade it on the fly, just unnecessary complications when we don't have incremental updates 6.10 -> 7.0 anyways. You'd also need locking and/or atomic operation as it will be hit in parallel from separate make processes. 

I remember we tried to make gcc install to lib (instead lib64) but there is no easy way, its hardcoded. 

I know there is a conflict with #19776, will fix it when needed.



---

archive/issue_comments_268659.json:
```json
{
    "body": "Replying to [comment:7 vbraun]:\n> I'd rather not try to do upgrade it on the fly, just unnecessary complications when we don't have incremental updates 6.10 -> 7.0 anyways.\n\nI agree.",
    "created_at": "2015-12-26T12:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268659",
    "user": "jdemeyer"
}
```

Replying to [comment:7 vbraun]:
> I'd rather not try to do upgrade it on the fly, just unnecessary complications when we don't have incremental updates 6.10 -> 7.0 anyways.

I agree.



---

archive/issue_comments_268660.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2015-12-26T12:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268660",
    "user": "jdemeyer"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_268661.json:
```json
{
    "body": "I get the idea of the patch, but I would rather do it in `configure`. We are already creating the directory structure there, so it seems like a more logical place.",
    "created_at": "2015-12-26T12:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268661",
    "user": "jdemeyer"
}
```

I get the idea of the patch, but I would rather do it in `configure`. We are already creating the directory structure there, so it seems like a more logical place.



---

archive/issue_comments_268662.json:
```json
{
    "body": "I'd rather keep creation of `SAGE_LOCAL` stuff out of configure, ideally it should go into `make install` though we are not there yet.\n\nIf you do change configure then you need a new confball.\n----\nNew commits:",
    "created_at": "2015-12-26T15:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268662",
    "user": "vbraun"
}
```

I'd rather keep creation of `SAGE_LOCAL` stuff out of configure, ideally it should go into `make install` though we are not there yet.

If you do change configure then you need a new confball.
----
New commits:



---

archive/issue_comments_268663.json:
```json
{
    "body": "Replying to [comment:11 vbraun]:\n> I'd rather keep creation of `SAGE_LOCAL` stuff out of configure\n\nWhy? I think this should be done as early as possible in the build process. It is convenient if all other scripts in Sage can assume the existence of the basic directory structure.\n\nAnd given that this basic directory structure is created by `configure`, it is most natural to create also the `lib64` symlink there.",
    "created_at": "2015-12-26T15:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268663",
    "user": "jdemeyer"
}
```

Replying to [comment:11 vbraun]:
> I'd rather keep creation of `SAGE_LOCAL` stuff out of configure

Why? I think this should be done as early as possible in the build process. It is convenient if all other scripts in Sage can assume the existence of the basic directory structure.

And given that this basic directory structure is created by `configure`, it is most natural to create also the `lib64` symlink there.



---

archive/issue_comments_268664.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-26T15:38:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268664",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_268665.json:
```json
{
    "body": "Configure does IMHO already too many things that it has no place to do; Why create install directories there? Its also testing package configuration for correctness (as opposed to during testing). Neither of these are typically done by configure. \n\nBesides being the wrong place, putting stuff into configure makes it also unnecessarily difficult to work on that in the future as it is an additional layer of inception (script writing shell script) and requires an arcane process of creating a new confball.  \n\nThat said if you insist on doing it the wrong way then I'd rather have the lib64 symlink than fix that particular configure insanity",
    "created_at": "2015-12-26T15:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268665",
    "user": "vbraun"
}
```

Configure does IMHO already too many things that it has no place to do; Why create install directories there? Its also testing package configuration for correctness (as opposed to during testing). Neither of these are typically done by configure. 

Besides being the wrong place, putting stuff into configure makes it also unnecessarily difficult to work on that in the future as it is an additional layer of inception (script writing shell script) and requires an arcane process of creating a new confball.  

That said if you insist on doing it the wrong way then I'd rather have the lib64 symlink than fix that particular configure insanity



---

archive/issue_comments_268666.json:
```json
{
    "body": "Replying to [comment:16 vbraun]:\n> as it is an additional layer of inception\n\nThat's standard `configure` stuff, it don't see why it is a complication.\n\n> requires an arcane process of creating a new confball.\n\nThat's purely a \"release management\" thing. There is no fundamental reason for it, it's only because of your workflow.",
    "created_at": "2015-12-26T15:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268666",
    "user": "jdemeyer"
}
```

Replying to [comment:16 vbraun]:
> as it is an additional layer of inception

That's standard `configure` stuff, it don't see why it is a complication.

> requires an arcane process of creating a new confball.

That's purely a "release management" thing. There is no fundamental reason for it, it's only because of your workflow.



---

archive/issue_comments_268667.json:
```json
{
    "body": "Replying to [comment:16 vbraun]:\n> Why create install directories there?\n\nLike I said, this is for convenience. It allows for example `sage-env` and other scripts to assume that those directories exist. I agree it's non-standard, but really the whole Sage distribution is non-standard.",
    "created_at": "2015-12-26T15:55:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268667",
    "user": "jdemeyer"
}
```

Replying to [comment:16 vbraun]:
> Why create install directories there?

Like I said, this is for convenience. It allows for example `sage-env` and other scripts to assume that those directories exist. I agree it's non-standard, but really the whole Sage distribution is non-standard.



---

archive/issue_comments_268668.json:
```json
{
    "body": "Replying to [comment:17 jdemeyer]:\n> That's standard `configure` stuff, it don't see why it is a complication.\n\nHow many Sage developers are comfortable working with configure.ac? Maybe 5%? \n\n> That's purely a \"release management\" thing. There is no fundamental reason for it, it's only because of your workflow.\n\nThere is a fundamental reason, OSX doesn't come with autotools so we can't do the configure.ac -> configure at the client. Any change to configure.ac necessarily entails further release steps, which is why I really don't like stuff thats absolutely not configureable in there.\n\nReplying to [comment:18 jdemeyer]:\n> It allows for example `sage-env` and other scripts to assume that those directories exist. \n\n`sage-env` shouldn't do anythning besides setting up the environment, it certainly shouldn't do anyhing different depending on how far along we are in the install process.",
    "created_at": "2015-12-26T16:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268668",
    "user": "vbraun"
}
```

Replying to [comment:17 jdemeyer]:
> That's standard `configure` stuff, it don't see why it is a complication.

How many Sage developers are comfortable working with configure.ac? Maybe 5%? 

> That's purely a "release management" thing. There is no fundamental reason for it, it's only because of your workflow.

There is a fundamental reason, OSX doesn't come with autotools so we can't do the configure.ac -> configure at the client. Any change to configure.ac necessarily entails further release steps, which is why I really don't like stuff thats absolutely not configureable in there.

Replying to [comment:18 jdemeyer]:
> It allows for example `sage-env` and other scripts to assume that those directories exist. 

`sage-env` shouldn't do anythning besides setting up the environment, it certainly shouldn't do anyhing different depending on how far along we are in the install process.



---

archive/issue_comments_268669.json:
```json
{
    "body": "In any case, set this ticket to positive review from me if you don't want to change it.",
    "created_at": "2015-12-26T16:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268669",
    "user": "vbraun"
}
```

In any case, set this ticket to positive review from me if you don't want to change it.



---

archive/issue_comments_268670.json:
```json
{
    "body": "Replying to [comment:19 vbraun]:\n> There is a fundamental reason, OSX doesn't come with autotools so we can't do the configure.ac -> configure at the client.\n\n1. You could do a custom install of autotools on those clients.\n\n2. You could run `./bootstrap -s` on your \"release management\" machine and then copy over the `configure` tarball. This is easily automated.",
    "created_at": "2015-12-26T17:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268670",
    "user": "jdemeyer"
}
```

Replying to [comment:19 vbraun]:
> There is a fundamental reason, OSX doesn't come with autotools so we can't do the configure.ac -> configure at the client.

1. You could do a custom install of autotools on those clients.

2. You could run `./bootstrap -s` on your "release management" machine and then copy over the `configure` tarball. This is easily automated.



---

archive/issue_comments_268671.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-26T17:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268671",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_268672.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-12-28T11:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268672",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_268673.json:
```json
{
    "body": "Nothing in this ticket explains why this was deemed necessary.  I think I'll remove it.",
    "created_at": "2019-01-02T11:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268673",
    "user": "embray"
}
```

Nothing in this ticket explains why this was deemed necessary.  I think I'll remove it.



---

archive/issue_comments_268674.json:
```json
{
    "body": "In various places we assume that our shared libraries are in `$SAGE_LOCAL/lib`; If a package installs stuff in a different library folder like `$SAGE_LOCAL/lib64` then we won't be able to load it.",
    "created_at": "2019-01-02T12:17:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268674",
    "user": "vbraun"
}
```

In various places we assume that our shared libraries are in `$SAGE_LOCAL/lib`; If a package installs stuff in a different library folder like `$SAGE_LOCAL/lib64` then we won't be able to load it.



---

archive/issue_comments_268675.json:
```json
{
    "body": "What is installed to lib64, and what do you need to link to it?",
    "created_at": "2019-01-02T12:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268675",
    "user": "embray"
}
```

What is installed to lib64, and what do you need to link to it?



---

archive/issue_comments_268676.json:
```json
{
    "body": "I don't have a comprehensive list of packages that attempt to install stuff in `lib64`, fwiw. Its likely to be platform-dependent, too.",
    "created_at": "2019-01-02T13:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268676",
    "user": "vbraun"
}
```

I don't have a comprehensive list of packages that attempt to install stuff in `lib64`, fwiw. Its likely to be platform-dependent, too.



---

archive/issue_comments_268677.json:
```json
{
    "body": "Other than gcc/gfortran I don't think there's anything that does, otherwise you would run into this same problem.",
    "created_at": "2019-01-02T14:02:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268677",
    "user": "embray"
}
```

Other than gcc/gfortran I don't think there's anything that does, otherwise you would run into this same problem.



---

archive/issue_comments_268678.json:
```json
{
    "body": "I'm running into trouble related to this, I think.  I upgraded a Linux (Ubuntu  Bionic Beaver) version of Sage from something like 6.8, ran into a problem, followed the message to do `make distclean` first.  I made it to `gfortran` and that seems to compile fine, but then at the very end\n\n```\n[gfortran-7.2.0] make[8]: Leaving directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/gcc-build/x86_64-pc-linux-gnu/libatomic'\n[gfortran-7.2.0] make[7]: Leaving directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/gcc-build/x86_64-pc-linux-gnu/libatomic'\n[gfortran-7.2.0] make[6]: Leaving directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/gcc-build/x86_64-pc-linux-gnu/libatomic'\n[gfortran-7.2.0] make[5]: Leaving directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/gcc-build'\n[gfortran-7.2.0] make[4]: Leaving directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/gcc-build'\n[gfortran-7.2.0] \n[gfortran-7.2.0] real\t27m10.068s\n[gfortran-7.2.0] user\t24m8.801s\n[gfortran-7.2.0] sys\t2m36.607s\n[gfortran-7.2.0] Copying package files from temporary location /home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/inst to /home/crisman/sage/local\n[gfortran-7.2.0] cp: cannot overwrite non-directory '/home/crisman/sage/local/./lib64' with directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/inst/home/crisman/sage/local/./lib64'\n[gfortran-7.2.0] ************************************************************************\n[gfortran-7.2.0] Error copying files for gfortran-7.2.0.\n[gfortran-7.2.0] ************************************************************************\n[gfortran-7.2.0] Please email sage-devel (http://groups.google.com/group/sage-devel)\n[gfortran-7.2.0] explaining the problem and including the log file\n[gfortran-7.2.0]   /home/crisman/sage/logs/pkgs/gfortran-7.2.0.log\n[gfortran-7.2.0] Describe your computer, operating system, etc.\n[gfortran-7.2.0] ************************************************************************\n```\n\nI can report this on sage-devel as well (I doubt it is a particular release thing unless this was indeed a very recent change) if it would be found useful.  Otherwise I don't have a way to proceed.",
    "created_at": "2019-03-17T21:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19545",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19545#issuecomment-268678",
    "user": "kcrisman"
}
```

I'm running into trouble related to this, I think.  I upgraded a Linux (Ubuntu  Bionic Beaver) version of Sage from something like 6.8, ran into a problem, followed the message to do `make distclean` first.  I made it to `gfortran` and that seems to compile fine, but then at the very end

```
[gfortran-7.2.0] make[8]: Leaving directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/gcc-build/x86_64-pc-linux-gnu/libatomic'
[gfortran-7.2.0] make[7]: Leaving directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/gcc-build/x86_64-pc-linux-gnu/libatomic'
[gfortran-7.2.0] make[6]: Leaving directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/gcc-build/x86_64-pc-linux-gnu/libatomic'
[gfortran-7.2.0] make[5]: Leaving directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/gcc-build'
[gfortran-7.2.0] make[4]: Leaving directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/gcc-build'
[gfortran-7.2.0] 
[gfortran-7.2.0] real	27m10.068s
[gfortran-7.2.0] user	24m8.801s
[gfortran-7.2.0] sys	2m36.607s
[gfortran-7.2.0] Copying package files from temporary location /home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/inst to /home/crisman/sage/local
[gfortran-7.2.0] cp: cannot overwrite non-directory '/home/crisman/sage/local/./lib64' with directory '/home/crisman/sage/local/var/tmp/sage/build/gfortran-7.2.0/inst/home/crisman/sage/local/./lib64'
[gfortran-7.2.0] ************************************************************************
[gfortran-7.2.0] Error copying files for gfortran-7.2.0.
[gfortran-7.2.0] ************************************************************************
[gfortran-7.2.0] Please email sage-devel (http://groups.google.com/group/sage-devel)
[gfortran-7.2.0] explaining the problem and including the log file
[gfortran-7.2.0]   /home/crisman/sage/logs/pkgs/gfortran-7.2.0.log
[gfortran-7.2.0] Describe your computer, operating system, etc.
[gfortran-7.2.0] ************************************************************************
```

I can report this on sage-devel as well (I doubt it is a particular release thing unless this was indeed a very recent change) if it would be found useful.  Otherwise I don't have a way to proceed.
