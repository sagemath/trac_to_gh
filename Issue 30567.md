# Issue 30567: Add Standard Sphere to Manifold Catalog

Issue created by migration from https://trac.sagemath.org/ticket/30804

Original creator: @mjungmath

Original creation time: 2020-10-20 18:36:11

CC:  egourgoulhon tscrim @tobiasdiez




---

Comment by @mjungmath created at 2020-10-20 20:43:31

Changing type from PLEASE CHANGE to enhancement.


---

Comment by @mjungmath created at 2020-10-20 20:43:31

Changing component from PLEASE CHANGE to manifolds.


---

Comment by @mjungmath created at 2020-10-20 20:51:12

Establishing the stereographic projection in more than 3 dimensions is very demanding, even if you know the inverse. I know that you can speed these things up a little by turning off checking and choosing a suitable simplification. But do you know more workarounds?

I also suspect that the Jacobian takes a long time.


---

Comment by tscrim created at 2020-10-21 09:22:36

Even if it takes a long time, IMO it still is good to have a general version (with a warning to the user about the time).


---

Comment by @mjungmath created at 2020-10-21 11:21:10

I agree. It is good to have these examples.

I thought about computing the desired quantities only on demand. Unfortunately it turned out difficult since most quantities are integral components and invoked by attributes not by methods. That's why I usually prefer methods rather than attributes.


---

Comment by @mjungmath created at 2020-10-21 18:18:57

Please take a peek at this first approach. I'd appreciate if someone can take a closer look at the details, i.e. transition maps, choice of subsets etc.

I tried to cover spherical coordinates in arbitrary dimensions as well. But it turned out that the transition map to the stereographic coordinates is a bit complicated in the general setup. I welcome any kind of reference that might help. Furthermore, I wanted to ensure that the spherical coordinates have the correct orientation right from the start. That explains the reordering of coordinates compared to [Wikipedia](https://en.wikipedia.org/wiki/N-sphere#Spherical_coordinates), and it makes the transition map to figure out even more tricky.
----
New commits:


---

Comment by git created at 2020-10-21 20:20:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-21 21:42:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2020-10-21 21:44:04

This should be the correct transition map, now. Checks all pass, too. I hope I didn't mess up the domains. Please check. Examples follow.


---

Comment by git created at 2020-10-21 21:55:00

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by egourgoulhon created at 2020-10-22 09:00:51

Replying to [comment:6 gh-mjungmath]:
> 
> I tried to cover spherical coordinates in arbitrary dimensions as well. But it turned out that the transition map to the stereographic coordinates is a bit complicated in the general setup. I welcome any kind of reference that might help. 

A very good reference for the sphere in any dimension is Chapter 18 _The sphere for its own sake_ in Marcel Berger: _Geometry_, vol. II, Universitext. Springer-Verlag, Berlin, 1987.

>Furthermore, I wanted to ensure that the spherical coordinates have the correct orientation right from the start. That explains the reordering of coordinates compared to [Wikipedia](https://en.wikipedia.org/wiki/N-sphere#Spherical_coordinates), and it makes the transition map to figure out even more tricky.

On general grounds, I don't think we should depart from Wikipedia conventions without a good reason. Moreover, I think it is standard convention to have the periodic coordinate on _S<sup>n</sup>_ to be the last one (as in _(theta, phi)_ for _S<sup>2</sup>_), not the first one.


---

Comment by @mjungmath created at 2020-10-22 09:21:54

Replying to [comment:12 egourgoulhon]:
> Replying to [comment:6 gh-mjungmath]:
> > 
> > I tried to cover spherical coordinates in arbitrary dimensions as well. But it turned out that the transition map to the stereographic coordinates is a bit complicated in the general setup. I welcome any kind of reference that might help. 
> 
> A very good reference for the sphere in any dimension is Chapter 18 _The sphere for its own sake_ in Marcel Berger: _Geometry_, vol. II, Universitext. Springer-Verlag, Berlin, 1987.

Thanks. I'll take a look.

> 
> >Furthermore, I wanted to ensure that the spherical coordinates have the correct orientation right from the start. That explains the reordering of coordinates compared to [Wikipedia](https://en.wikipedia.org/wiki/N-sphere#Spherical_coordinates), and it makes the transition map to figure out even more tricky.
> 
> On general grounds, I don't think we should depart from Wikipedia conventions without a good reason. Moreover, I think it is standard convention to have the periodic coordinate on _S<sup>n</sup>_ to be the last one (as in _(theta, phi)_ for _S<sup>2</sup>_), not the first one.  

We have to deviate from the Wikipedia convention anyway.

This is simply because the slit we take out for spherical coordinates should meet the poles. Currently, the north/south pole is encoded in the last coordinate. We can shift it to the first, and then we can recover the conventions in Wikipedia for spherical coordinates. But that would be another convention we break, namely for the stereographic projection.


---

Comment by egourgoulhon created at 2020-10-22 09:53:38

Replying to [comment:13 gh-mjungmath]:
> 
> We have to deviate from the Wikipedia convention anyway.
> 
> This is simply because the slit we take out for spherical coordinates should meet the poles. Currently, the north/south pole is encoded in the last coordinate. We can shift it to the first, and then we can recover the conventions in Wikipedia for spherical coordinates. But that would be another convention we break, namely for the stereographic projection.

Sorry I don't understand what you mean. It seems to me that we can keep Wikipedia conventions, both for spherical coordinates and stereographic ones, as we do already for S<sup>2</sup> in this [example](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_sphere_S2.ipynb). Then the spherical frame and the stereographic frame from the South pole are right-handed and the stereographic frame from the North pole is left-handed.


---

Comment by @mjungmath created at 2020-10-22 10:08:45

Replying to [comment:14 egourgoulhon]:
> Replying to [comment:13 gh-mjungmath]:
> > 
> > We have to deviate from the Wikipedia convention anyway.
> > 
> > This is simply because the slit we take out for spherical coordinates should meet the poles. Currently, the north/south pole is encoded in the last coordinate. We can shift it to the first, and then we can recover the conventions in Wikipedia for spherical coordinates. But that would be another convention we break, namely for the stereographic projection.
> 
> Sorry I don't understand what you mean. It seems to me that we can keep Wikipedia conventions, both for spherical coordinates and stereographic ones, as we do already for S<sup>2</sup> in this [example](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_sphere_S2.ipynb). Then the spherical frame and the stereographic frame from the South pole are right-handed and the stereographic frame from the North pole is left-handed.

That's right. But notice that the convention in the general case is slightly different than in the 2-sphere case, compare [https://en.wikipedia.org/wiki/N-sphere#Spherical_coordinates [1]] with [https://en.wikipedia.org/wiki/Spherical_coordinate_system#Cartesian_coordinates [2]]. If you consider the embedding in spherical coordinates in the general case, and follow the convention [1], it appears to happen that the poles do not belong to the removed meridian.

So what I did was reversing the order of the `x_i` and `phi_i` simultanously (compare [1]) in hope to find a consistent formula. Turns out that everything behaves nicely in this setup: the implementation is easy and the inverse looks comparably nice. One even gets an oriented coordinate frame on top.

Whatever convention we choose, I will provide a thorough documentation of the conventions used in the implementation anyway.


---

Attachment

I have added the choice of coordinates and their inverse in an [attachment](https://trac.sagemath.org/attachment/ticket/30804/spherical.png). I think the formulas look very nice this way (provided I haven't miscalculated).


---

Comment by @mjungmath created at 2020-10-23 14:50:33

I see these options:

1. Keep it the way I suggested.
2. Break the convention for the stereographic projection, and put the poles to the first coordinate, then use the convention [https://en.wikipedia.org/wiki/N-sphere#Spherical_coordinates [1]].
3. Use suggestion 1 or 2 and separate the 2-sphere to obtain convention [https://en.wikipedia.org/wiki/Spherical_coordinate_system#Cartesian_coordinates [2]].
4. Keep the stereographic convention, alter the convention [https://en.wikipedia.org/wiki/N-sphere#Spherical_coordinates [1]] in such a way that we obtain convention [https://en.wikipedia.org/wiki/Spherical_coordinate_system#Cartesian_coordinates [2]] for the 2-sphere case.

I personally vote for 1 as long as the documentation is thorough enough.


---

Comment by @mjungmath created at 2020-10-25 09:43:05

I gave it a little thought. I think option 4 is best. Option 4 is in a way canonical: we obtain the convention for `S^1` and for `S^2`. It is only plausible then that the convention should be kept for higher dimensions as well (I don't know why it isn't so).

In addition, we don't need an extra class with facade pattern for 1D and 2D.

Agreed?


---

Comment by @tobiasdiez created at 2020-10-25 12:58:13

This sounds like a good plan.

I'm not sure if that works, but is it possible to add all these different conventions as additional charts? Then the user can decide which convention he wants to follow. This would also be the most flexible approach (e.g. to verify formulas in different conventions etc).


---

Comment by @mjungmath created at 2020-10-26 13:52:18

Replying to [comment:22 gh-tobiasdiez]:
> I'm not sure if that works, but is it possible to add all these different conventions as additional charts? Then the user can decide which convention he wants to follow. This would also be the most flexible approach (e.g. to verify formulas in different conventions etc). 

I agree that this would be the best option. But I suspect that it is not worth the effort. Furthermore, these details can be added by time. I think, a non-primitive  working sphere example in any dimension is enough for now.


---

Comment by git created at 2020-10-27 15:08:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2020-10-27 15:23:33

I have added some more features and adapted the coordinates. If you agree on these conventions, I would start with the documentation.


---

Comment by git created at 2020-10-27 15:32:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-11-02 13:11:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2020-11-02 13:13:51

Okay, this is it, the code should be complete now. I will finish the documentation soon. Until then, you are free to comment on the code.

If everything is done, I will stash the commits to smooth the final merge.


---

Comment by @mjungmath created at 2020-11-02 13:17:09

If you have any ideas for examples that should come up in the documentation, please let me know.


---

Comment by egourgoulhon created at 2020-11-02 17:07:02

This looks very nice. Thanks!

 
Some first few remarks:

- the reference to Berger should be _Geometry II_, not _Geometry I_
- the LaTeX formula in the docstring of `spherical_coordinates` is not correct; in particular, one should have x_n = cos phi_1, not x_n = cos phi_n
- could one have an option for the periodic coordinate phi_n to range in [0, 2*pi] instead of [-pi, pi]? Both conventions exist in the literature. What should be the default? (I would vote for [0, 2*pi])
- for S<sup>3</sup>, could we have customized spher. coordinate names (chi, theta, phi) (I think this is pretty standard for S<sup>3</sup>), instead of (phi_1, phi_2, phi_3)? 
- for S<sup>3</sup>, we should probably have Hopf coordinates as well


---

Comment by @mjungmath created at 2020-11-02 17:22:31

Replying to [comment:30 egourgoulhon]:
> This looks very nice. Thanks!
> 
>  
> Some first few remarks:
> 
> - the reference to Berger should be _Geometry II_, not _Geometry I_
> - the LaTeX formula in the docstring of `spherical_coordinates` is not correct; in particular, one should have x_n = cos phi_1, not x_n = cos phi_n

Corrected. The finished docstring will be pushed soon. Almost done here.

> - could one have an option for the periodic coordinate phi_n to range in [0, 2*pi] instead of [-pi, pi]? Both conventions exist in the literature. What should be the default? (I would vote for [0, 2*pi])

This belongs more or less to what Tobias suggested. In principle it is good to allow various conventions. However, the case `[-pi, pi]` is easier to handle with the `atan2` function (its range is exactly `[-pi, pi]`).

> - for S<sup>3</sup>, could we have customized spher. coordinate names (chi, theta, phi) (I think this is pretty standard for S<sup>3</sup>), instead of (phi_1, phi_2, phi_3)? 

I will add them.

> - for S<sup>3</sup>, we should probably have Hopf coordinates as well

I agree. However, I would prefer that the special cases `S^1`, `S^3`, `S^7` are dedicated to a follow up ticket. This ticket already covers all necessary functionalities of general spheres.


---

Comment by @mjungmath created at 2020-11-02 17:46:53

Moreover, I think it is a splendid idea to connect `S^1` and `S^3` to its corresponding Lie groups, i.e. `U(1)` and `SU(2)`, and possible spin groups.


---

Comment by egourgoulhon created at 2020-11-02 17:47:42

Replying to [comment:31 gh-mjungmath]:
> Replying to [comment:30 egourgoulhon]:
> 
> > - could one have an option for the periodic coordinate phi_n to range in [0, 2*pi] instead of [-pi, pi]? Both conventions exist in the literature. What should be the default? (I would vote for [0, 2*pi])
> 
> This belongs more or less to what Tobias suggested. In principle it is good to allow various conventions. However, the case `[-pi, pi]` is easier to handle with the `atan2` function (its range is exactly `[-pi, pi]`).
> 
Indeed. Could we have at least a keyword argument `periodic_range` in `Sphere`? Or do you think this deserves another ticket?

> 
> > - for S<sup>3</sup>, we should probably have Hopf coordinates as well
> 
> I agree. However, I would prefer that the special cases `S^1`, `S^3`, `S^7` are dedicated to a follow up ticket. This ticket already covers all necessary functionalities of general spheres.

Agreed.


---

Comment by egourgoulhon created at 2020-11-02 17:48:28

Replying to [comment:32 gh-mjungmath]:
> Moreover, I think it is a splendid idea to connect `S^1` and `S^3` to its corresponding Lie groups, i.e. `U(1)` and `SU(2)`, and possible spin groups.

+1


---

Comment by @mjungmath created at 2020-11-02 17:55:05

Replying to [comment:33 egourgoulhon]:
> Indeed. Could we have at least a keyword argument `periodic_range` in `Sphere`? Or do you think this deserves another ticket?

Hm, I personally would vote for another ticket. Adding new features would clutter my current progress. I would like to finish the examples and conclude that ticket as soon as possible. Then we can discuss further improvements. My proposal is already more comprehensive than the previous and worth a merge, I'd say.


---

Comment by git created at 2020-11-02 19:19:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-11-03 00:01:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2020-11-03 00:03:32

docstring should be finished now. Last opportunity to declare wishes for examples.

I will finish everything up tomorrow and set the ticket to `needs_review`.


---

Comment by @mjungmath created at 2020-11-03 00:06:14

By the way, I noticed that there is no section in the documentation dedicated to general examples (except for `EuclideanSpace`). This should be expanded when more examples of this kind are added.


---

Comment by tscrim created at 2020-11-03 00:15:07

You can just set it to needs review now; if there are more comments then people can provide it then.


---

Comment by git created at 2020-11-03 09:00:04

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @mjungmath created at 2020-11-03 09:01:30

Changing status from new to needs_review.


---

Comment by @mjungmath created at 2020-11-03 09:01:30

Squashed commits. Ready for review.


---

Comment by git created at 2020-11-03 10:17:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-11-03 14:38:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2020-11-03 19:24:51

Patchbot full green.


---

Comment by egourgoulhon created at 2020-11-03 20:27:45

Good for me. Travis, do you agree?


---

Comment by egourgoulhon created at 2020-11-03 20:27:45

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2020-11-03 23:57:35

Yep, I agree.


---

Comment by @mjungmath created at 2020-11-04 07:36:06

Thank you! :)

Eric, would you mind going for the Hopf coordinates?


---

Comment by egourgoulhon created at 2020-11-04 16:51:20

Replying to [comment:50 gh-mjungmath]:
> Thank you! :)
> 

Thank you for this work. 

> Eric, would you mind going for the Hopf coordinates? 

I'll be happy to make a ticket for S<sup>3</sup> as a subclass of `Sphere`, but at the moment I am busy by other things, as you may have guessed from my slowness in reacting to Sage tickets.


---

Comment by vbraun created at 2020-11-22 15:06:35

Resolution: fixed


---

Comment by egourgoulhon created at 2021-05-05 15:53:42

See #31781 for a follow-up.
