# Issue 11842: Make linearcode.__iter__ and linearcode.list() faster

archive/issues_011842.json:
```json
{
    "body": "Assignee: wdj\n\nCC:  rkirov wdj kini jpang tfeulner\n\nKeywords: linear code, iter\n\nThe `__iter__()` method in `devel/sage/sage/coding/linear_code.py` tries to return the codewords standard form of the code. Is there a reason why it does so? This should be left to the gen_mat to provide a systematic generator matrix.\n\nThe `list()` method on the other hand doesn't call `__iter__()` at all. It instead calls a more generic method which is actually quite slow. (See [a short discussion in sage-devel](https://groups.google.com/d/msg/sage-devel/wmaSLdlkn-c/3Nu8Kx8DKZMJ))\n\nI am attaching a patch which makes it faster and makes `list()` call `__iter__()`. This patch is simply to show you that the methods can be faster. So, I haven't done any doctests. Some tests will probably break because the order of codewords returned are not the same as earlier. Before going ahead and trying to fix doctests, etc, I want to be sure that this patch is desirable.\n\nAs for the speedup, here is an example. The functions in Sage are the unpatched versions. `list_codewords()` is a function implemented in the file that is loaded with `load( )` and this contains the `iterate()` method present in the patch.\n\n```\n...ding_Theory/programs/sage> ~/Installations/sage-4.7.2/sage\n----------------------------------------------------------------------\n----------------------------------------------------------------------\nsage: C = ReedSolomonCode(7, 3, GF(8, 'a'))\nsage: load('code_functions.py')\nsage: timeit('list(C.__iter__())')\n5 loops, best of 3: 90.9 ms per loop\nsage: timeit('C.list()')\n5 loops, best of 3: 122 ms per loop\nsage: timeit('list_codewords(C)') # new code implemented in list_codewords\n125 loops, best of 3: 1.66 ms per loop\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12014\n\n",
    "created_at": "2011-11-12T08:39:09Z",
    "labels": [
        "coding theory",
        "minor",
        "enhancement"
    ],
    "title": "Make linearcode.__iter__ and linearcode.list() faster",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11842",
    "user": "ppurka"
}
```
Assignee: wdj

CC:  rkirov wdj kini jpang tfeulner

Keywords: linear code, iter

The `__iter__()` method in `devel/sage/sage/coding/linear_code.py` tries to return the codewords standard form of the code. Is there a reason why it does so? This should be left to the gen_mat to provide a systematic generator matrix.

The `list()` method on the other hand doesn't call `__iter__()` at all. It instead calls a more generic method which is actually quite slow. (See [a short discussion in sage-devel](https://groups.google.com/d/msg/sage-devel/wmaSLdlkn-c/3Nu8Kx8DKZMJ))

I am attaching a patch which makes it faster and makes `list()` call `__iter__()`. This patch is simply to show you that the methods can be faster. So, I haven't done any doctests. Some tests will probably break because the order of codewords returned are not the same as earlier. Before going ahead and trying to fix doctests, etc, I want to be sure that this patch is desirable.

As for the speedup, here is an example. The functions in Sage are the unpatched versions. `list_codewords()` is a function implemented in the file that is loaded with `load( )` and this contains the `iterate()` method present in the patch.

```
...ding_Theory/programs/sage> ~/Installations/sage-4.7.2/sage
----------------------------------------------------------------------
----------------------------------------------------------------------
sage: C = ReedSolomonCode(7, 3, GF(8, 'a'))
sage: load('code_functions.py')
sage: timeit('list(C.__iter__())')
5 loops, best of 3: 90.9 ms per loop
sage: timeit('C.list()')
5 loops, best of 3: 122 ms per loop
sage: timeit('list_codewords(C)') # new code implemented in list_codewords
125 loops, best of 3: 1.66 ms per loop
```


Issue created by migration from https://trac.sagemath.org/ticket/12014





---

archive/issue_comments_135499.json:
```json
{
    "body": "In fact, the original patch didn't break any doctests in `devel/sage/sage/coding`. I checked that it also fixes this bug mentioned in the [Sage public notebook bugreports](https://spreadsheets.google.com/pub?key=pCwvGVwSMxTzT6E2xNdo5fA):\n\n''It seems like iterating over the dual of a LinearCode gives a different result from iterating over the .list() of the dual code.\nHere is a test case:''\n\n```\nsage: G = matrix(GF(2), [[1, 1, 1, 0, 0, 0, 0, 0, 0],                        \n....: [0, 0, 0, 1, 1, 1, 0, 0, 0],[0, 0, 0, 0, 0, 0, 1, 1, 1]])\nsage: C = LinearCode(G)\nsage: Cperp = C.dual_code()\nsage: Cperp_iter = list(iter(Cperp))\nsage: Cperp_iter == Cperp.list()\nFalse\nsage: Cperp_iter_tuples = map(tuple, Cperp)\nsage: Cperp_list_tuples = map(tuple, Cperp.list())\nsage: Cperp_iter_tuples == Cperp_list_tuples \nFalse\n```\n\n*According to the documentation by doing `help(Cperp.list)` and `help(Cperp.__iter__)`, they should both be returning the same collection.*\n\nSo, I am setting this patch up for review.",
    "created_at": "2012-02-29T16:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-135499",
    "user": "ppurka"
}
```

In fact, the original patch didn't break any doctests in `devel/sage/sage/coding`. I checked that it also fixes this bug mentioned in the [Sage public notebook bugreports](https://spreadsheets.google.com/pub?key=pCwvGVwSMxTzT6E2xNdo5fA):

''It seems like iterating over the dual of a LinearCode gives a different result from iterating over the .list() of the dual code.
Here is a test case:''

```
sage: G = matrix(GF(2), [[1, 1, 1, 0, 0, 0, 0, 0, 0],                        
....: [0, 0, 0, 1, 1, 1, 0, 0, 0],[0, 0, 0, 0, 0, 0, 1, 1, 1]])
sage: C = LinearCode(G)
sage: Cperp = C.dual_code()
sage: Cperp_iter = list(iter(Cperp))
sage: Cperp_iter == Cperp.list()
False
sage: Cperp_iter_tuples = map(tuple, Cperp)
sage: Cperp_list_tuples = map(tuple, Cperp.list())
sage: Cperp_iter_tuples == Cperp_list_tuples 
False
```

*According to the documentation by doing `help(Cperp.list)` and `help(Cperp.__iter__)`, they should both be returning the same collection.*

So, I am setting this patch up for review.



---

archive/issue_comments_135500.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-29T16:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-135500",
    "user": "ppurka"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_135501.json:
```json
{
    "body": "Changing type from enhancement to defect.",
    "created_at": "2012-03-01T06:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-135501",
    "user": "ppurka"
}
```

Changing type from enhancement to defect.



---

archive/issue_comments_135502.json:
```json
{
    "body": "Replying to [comment:4 ppurka]:\n\nMaybe Rado can comment on this. If I recall right, GAP (GUAVA package) is called to do most things with linear codes; but the low-level GAP code it uses is buggy in GAP 4.4.12. A patch exists for GAP 4.5, but it's not backported, AFAIK. I requested such a backport quite a while ago, but it didn't happen.",
    "created_at": "2012-03-02T01:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-135502",
    "user": "dimpase"
}
```

Replying to [comment:4 ppurka]:

Maybe Rado can comment on this. If I recall right, GAP (GUAVA package) is called to do most things with linear codes; but the low-level GAP code it uses is buggy in GAP 4.4.12. A patch exists for GAP 4.5, but it's not backported, AFAIK. I requested such a backport quite a while ago, but it didn't happen.



---

archive/issue_comments_135503.json:
```json
{
    "body": "Replying to [comment:5 dimpase]:\n> Maybe Rado can comment on this. If I recall right, GAP (GUAVA package) is called to do most things with linear codes; but the low-level GAP code it uses is buggy in GAP 4.4.12. A patch exists for GAP 4.5, but it's not backported, AFAIK. I requested such a backport quite a while ago, but it didn't happen.\n\nThe current code for the codeword list does not call GAP. This patch also does not call GAP. I think if it did call, it would be even slower.",
    "created_at": "2012-03-02T01:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-135503",
    "user": "ppurka"
}
```

Replying to [comment:5 dimpase]:
> Maybe Rado can comment on this. If I recall right, GAP (GUAVA package) is called to do most things with linear codes; but the low-level GAP code it uses is buggy in GAP 4.4.12. A patch exists for GAP 4.5, but it's not backported, AFAIK. I requested such a backport quite a while ago, but it didn't happen.

The current code for the codeword list does not call GAP. This patch also does not call GAP. I think if it did call, it would be even slower.



---

archive/issue_comments_135504.json:
```json
{
    "body": "Attachment\n\ntest trac upload with \"replace existing attachment\"",
    "created_at": "2012-04-30T06:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-135504",
    "user": "ppurka"
}
```

Attachment

test trac upload with "replace existing attachment"



---

archive/issue_comments_135505.json:
```json
{
    "body": "Changing keywords from \"linear code, iter\" to \"linear code, iter, sd40.5\".",
    "created_at": "2012-05-27T09:50:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-135505",
    "user": "ppurka"
}
```

Changing keywords from "linear code, iter" to "linear code, iter, sd40.5".



---

archive/issue_comments_135506.json:
```json
{
    "body": "Updated to sage-5.1beta0, so that it can be reviewed :)",
    "created_at": "2012-05-27T09:50:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-135506",
    "user": "ppurka"
}
```

Updated to sage-5.1beta0, so that it can be reviewed :)



---

archive/issue_comments_135507.json:
```json
{
    "body": "Updated patch to be based on #13417. This will give much more consistent output.",
    "created_at": "2012-11-09T10:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-135507",
    "user": "ppurka"
}
```

Updated patch to be based on #13417. This will give much more consistent output.



---

archive/issue_comments_135508.json:
```json
{
    "body": "this needs a rebase for Sage 5.6.beta/rc...",
    "created_at": "2013-01-23T13:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-135508",
    "user": "dimpase"
}
```

this needs a rebase for Sage 5.6.beta/rc...



---

archive/issue_comments_135509.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-01-23T13:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-135509",
    "user": "dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_135510.json:
```json
{
    "body": "Apply to devel/sage",
    "created_at": "2013-01-27T11:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-135510",
    "user": "ppurka"
}
```

Apply to devel/sage



---

archive/issue_comments_135511.json:
```json
{
    "body": "Attachment\n\nOk. I have rebased this ticket and #13694 on 5.7.beta0.",
    "created_at": "2013-01-27T11:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-135511",
    "user": "ppurka"
}
```

Attachment

Ok. I have rebased this ticket and #13694 on 5.7.beta0.



---

archive/issue_comments_135512.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-01-27T11:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-135512",
    "user": "ppurka"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_135513.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-27T16:00:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-135513",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_135514.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-01-30T07:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-135514",
    "user": "jdemeyer"
}
```

Resolution: fixed
