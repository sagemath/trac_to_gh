# Issue 17351: Remove brain damaged installation procedure for pari on OS X

Issue created by migration from https://trac.sagemath.org/ticket/17588

Original creator: fbissey

Original creation time: 2015-01-05 21:47:49

CC:  kcrisman jhpalmieri was

The current spkg-install script for pari includes the following specific darwing instruction

```
if [ "$UNAME" = "Darwin" ]; then
        # The following is a hack to get the library installed correctly
        # on Mac OS X:
        echo "Applying Mac OS X hack -- deleting and reinstalling libpari.a ..."
        rm -f Odarwin-ppc/*lib*
        $MAKE install-lib-sta
        if [ $? -ne 0 ]; then
            echo >&2 "Error reinstalling PARI's static libraries (OS X trick)"
            exit 1
        fi

        cd "`config/objdir`" && cp -f libpari* "$SAGE_LOCAL/lib"
        if [ $? -ne 0 ]; then
            echo >&2 "Error copying PARI's libraries (OS X trick)"
            exit 1
        fi
        cd "$CUR"
    fi
```

This section completely destroy the proper setting of darwin's install_name for no good reason. It needs to be removed. See conversation in #16017 and #16044 about this.


---

Comment by fbissey created at 2015-01-05 22:24:57

Changing status from new to needs_review.


---

Comment by fbissey created at 2015-01-05 22:24:57

Ready for review if you could Karl-Dieter...
----
New commits:


---

Comment by git created at 2015-01-05 23:50:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2015-01-06 02:49:08

> Ready for review if you could Karl-Dieter...

Haha!   I might get a chance to do it on a couple older machines (10.4 and 10.7) eventually, but you should have reviewers testing it on 10.9 and 10.10, methinks.


---

Comment by fbissey created at 2015-01-06 03:04:12

Replying to [comment:3 kcrisman]:
> > Ready for review if you could Karl-Dieter...
> 
> Haha!   I might get a chance to do it on a couple older machines (10.4 and 10.7) eventually, but you should have reviewers testing it on 10.9 and 10.10, methinks.

I got 10.10 covered before committing.


---

Comment by kcrisman created at 2015-01-06 16:07:25

This passes all long doctests on 10.7 (other than the `PowmInsecureWarning: Not using mpz_powm_sec.` and a Maxima timeout, but those are unrelated and happen to me anyway).

Maybe someone should test on 10.9, but otherwise I wouldn't hold it up for me testing on any older platform.


---

Comment by kcrisman created at 2015-02-03 01:53:48

John or William, can you quick check this doesn't break anything?  I don't have access to the right version of OS X and Fran√ßois is of course the author here.  Should be a very quick finish of review.


---

Comment by fbissey created at 2015-02-03 20:36:21

pari has been updated in rc0 I need to rebase this.


---

Comment by fbissey created at 2015-02-03 21:00:21

New branch pushed.
----
New commits:


---

Comment by fbissey created at 2015-02-03 21:01:15

No new code just made sure it would merge ok.


---

Comment by kcrisman created at 2015-02-03 21:02:04

Just need someone to check this independently of you on 10.9 or 10.10 (preferred), then.


---

Comment by jhpalmieri created at 2015-02-03 21:48:04

It certainly builds on OS X 10.10 with `sage -f pari`. I need to do `make distclean; make`, though, to ensure that it's really working. This is in progress. (If the installation procedure is being changed, then just doing `sage -f pari` might leave parts of the old installation lying around, so it feels safer to delete everything and start over.)


---

Comment by fbissey created at 2015-02-03 21:51:31

It shouldn't as the file set installed is the same. Just the content of the dylib headers are different. But it is better to rebuild all pari dependencies to make sure it has been taken into account and rebuilding will do that for you.


---

Comment by jhpalmieri created at 2015-02-04 16:13:05

This works for me on OS X 10.10.


---

Comment by kcrisman created at 2015-02-04 16:14:57

All is well, then?


---

Comment by kcrisman created at 2015-02-04 16:14:57

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-02-08 15:26:20

Resolution: fixed
