# Issue 12525: Wrap T. Lecroq string processing C library as experimental package

archive/issues_012525.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  @seblabbe @saliola @videlec lecroq\n\nSee http://igm.univ-mlv.fr/~mac/CHL/CHL.html\n\nIssue created by migration from https://trac.sagemath.org/ticket/12697\n\n",
    "created_at": "2012-03-19T14:09:10Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Wrap T. Lecroq string processing C library as experimental package",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12525",
    "user": "@hivert"
}
```
Assignee: sage-combinat

CC:  @seblabbe @saliola @videlec lecroq

See http://igm.univ-mlv.fr/~mac/CHL/CHL.html

Issue created by migration from https://trac.sagemath.org/ticket/12697





---

archive/issue_comments_148381.json:
```json
{
    "body": "Very preliminary version of spkg",
    "created_at": "2012-03-19T15:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12525#issuecomment-148381",
    "user": "@nthiery"
}
```

Very preliminary version of spkg



---

archive/issue_comments_148382.json:
```json
{
    "body": "Attachment [string_process-1.0.spkg](tarball://root/attachments/some-uuid/ticket12697/string_process-1.0.spkg) by @hivert created at 2012-03-19 15:41:10",
    "created_at": "2012-03-19T15:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12525#issuecomment-148382",
    "user": "@hivert"
}
```

Attachment [string_process-1.0.spkg](tarball://root/attachments/some-uuid/ticket12697/string_process-1.0.spkg) by @hivert created at 2012-03-19 15:41:10



---

archive/issue_comments_148383.json:
```json
{
    "body": "Attachment [trac_12697-string_process-fh.patch](tarball://root/attachments/some-uuid/ticket12697/trac_12697-string_process-fh.patch) by @hivert created at 2012-03-19 16:03:32",
    "created_at": "2012-03-19T16:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12525#issuecomment-148383",
    "user": "@hivert"
}
```

Attachment [trac_12697-string_process-fh.patch](tarball://root/attachments/some-uuid/ticket12697/trac_12697-string_process-fh.patch) by @hivert created at 2012-03-19 16:03:32



---

archive/issue_comments_148384.json:
```json
{
    "body": "Hi Nicolas, Florent, Thierry,\n\nI just tested the installation of the spkg on sage-5.2 (running max osx 10.5.8). The spkg installed fine. Florent's patch works fine as well. Thanks for doing the spkg. It seems so easy just running `sage -f`.\n\nI get the following doctest errors :\n\n\n```\nsage -t  \"devel/sage-slabbe/sage/libs/string_process/string_process.pyx\"\n16\n**********************************************************************\nFile \"/Users/slabbe/Applications/sage-5.2/devel/sage-slabbe/sage/libs/string_process/string_process.pyx\", line 18:\n    sage: first_occurence_boyer_moore(\"dolor\", text)\nExpected:\n    12\nGot nothing\n**********************************************************************\nFile \"/Users/slabbe/Applications/sage-5.2/devel/sage-slabbe/sage/libs/string_process/string_process.pyx\", line 24:\n    sage: occurences = all_occurences_boyer_moore(\"in\", text); occurences\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/slabbe/Applications/sage-5.2/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/slabbe/Applications/sage-5.2/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/slabbe/Applications/sage-5.2/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_0[5]>\", line 1, in <module>\n        occurences = all_occurences_boyer_moore(\"in\", text); occurences###line 24:\n    sage: occurences = all_occurences_boyer_moore(\"in\", text); occurences\n    NameError: name 'all_occurences_boyer_moore' is not defined\n**********************************************************************\nFile \"/Users/slabbe/Applications/sage-5.2/devel/sage-slabbe/sage/libs/string_process/string_process.pyx\", line 29:\n    sage: type(occurences)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/slabbe/Applications/sage-5.2/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/slabbe/Applications/sage-5.2/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/slabbe/Applications/sage-5.2/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_0[6]>\", line 1, in <module>\n        type(occurences)###line 29:\n    sage: type(occurences)\n    NameError: name 'occurences' is not defined\n**********************************************************************\nFile \"/Users/slabbe/Applications/sage-5.2/devel/sage-slabbe/sage/libs/string_process/string_process.pyx\", line 34:\n    sage: len(occurences)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/slabbe/Applications/sage-5.2/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/slabbe/Applications/sage-5.2/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/slabbe/Applications/sage-5.2/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_0[7]>\", line 1, in <module>\n        len(occurences)###line 34:\n    sage: len(occurences)\n    NameError: name 'occurences' is not defined\n**********************************************************************\nFile \"/Users/slabbe/Applications/sage-5.2/devel/sage-slabbe/sage/libs/string_process/string_process.pyx\", line 36:\n    sage: occurences[0]\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/slabbe/Applications/sage-5.2/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/slabbe/Applications/sage-5.2/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/slabbe/Applications/sage-5.2/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_0[8]>\", line 1, in <module>\n        occurences[Integer(0)]###line 36:\n    sage: occurences[0]\n    NameError: name 'occurences' is not defined\n**********************************************************************\nFile \"/Users/slabbe/Applications/sage-5.2/devel/sage-slabbe/sage/libs/string_process/string_process.pyx\", line 51:\n    sage: b = border_array(u3); b\nExpected:\n    array([0, 0, 1, 0, 1, 2, 3, 0, 1, 2, 3, 4, 5, 6, 7], dtype=int32)\nGot:\n    array([0, 0, 1, 0, 1, 2, 3, 0, 1, 2, 3, 4, 5, 6, 7])\n**********************************************************************\nFile \"/Users/slabbe/Applications/sage-5.2/devel/sage-slabbe/sage/libs/string_process/string_process.pyx\", line 53:\n    sage: b[0] = 4; b\nExpected:\n    array([4, 0, 1, 0, 1, 2, 3, 0, 1, 2, 3, 4, 5, 6, 7], dtype=int32)\nGot:\n    array([4, 0, 1, 0, 1, 2, 3, 0, 1, 2, 3, 4, 5, 6, 7])\n**********************************************************************\n1 items had failures:\n   7 of  18 in __main__.example_0\n***Test Failed*** 7 failures.\nFor whitespace errors, see the file /Users/slabbe/.sage//tmp/string_process_50240.py\n\t [3.5 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t  \"devel/sage-slabbe/sage/libs/string_process/string_process.pyx\"\nTotal time for all tests: 3.5 seconds\n\n```\n\n\nQuestion 1\n\nAlso, I've never work with the directory `sage/libs` before. Should all function using the spkg should be there? Can other functions be elsewhere like in `sage/combinat/words` ?\n\nQuestion 2\n\nWhat is the goal of this ticket? Make the spkg as optional? Merge Florent's patch into Sage?\n\nQuestion 3\n\nNicolas, you say the spkg is very preliminary. What are the next improvements that should be done?",
    "created_at": "2012-08-09T19:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12525#issuecomment-148384",
    "user": "@seblabbe"
}
```

Hi Nicolas, Florent, Thierry,

I just tested the installation of the spkg on sage-5.2 (running max osx 10.5.8). The spkg installed fine. Florent's patch works fine as well. Thanks for doing the spkg. It seems so easy just running `sage -f`.

I get the following doctest errors :


```
sage -t  "devel/sage-slabbe/sage/libs/string_process/string_process.pyx"
16
**********************************************************************
File "/Users/slabbe/Applications/sage-5.2/devel/sage-slabbe/sage/libs/string_process/string_process.pyx", line 18:
    sage: first_occurence_boyer_moore("dolor", text)
Expected:
    12
Got nothing
**********************************************************************
File "/Users/slabbe/Applications/sage-5.2/devel/sage-slabbe/sage/libs/string_process/string_process.pyx", line 24:
    sage: occurences = all_occurences_boyer_moore("in", text); occurences
Exception raised:
    Traceback (most recent call last):
      File "/Users/slabbe/Applications/sage-5.2/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/slabbe/Applications/sage-5.2/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/slabbe/Applications/sage-5.2/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_0[5]>", line 1, in <module>
        occurences = all_occurences_boyer_moore("in", text); occurences###line 24:
    sage: occurences = all_occurences_boyer_moore("in", text); occurences
    NameError: name 'all_occurences_boyer_moore' is not defined
**********************************************************************
File "/Users/slabbe/Applications/sage-5.2/devel/sage-slabbe/sage/libs/string_process/string_process.pyx", line 29:
    sage: type(occurences)
Exception raised:
    Traceback (most recent call last):
      File "/Users/slabbe/Applications/sage-5.2/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/slabbe/Applications/sage-5.2/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/slabbe/Applications/sage-5.2/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_0[6]>", line 1, in <module>
        type(occurences)###line 29:
    sage: type(occurences)
    NameError: name 'occurences' is not defined
**********************************************************************
File "/Users/slabbe/Applications/sage-5.2/devel/sage-slabbe/sage/libs/string_process/string_process.pyx", line 34:
    sage: len(occurences)
Exception raised:
    Traceback (most recent call last):
      File "/Users/slabbe/Applications/sage-5.2/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/slabbe/Applications/sage-5.2/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/slabbe/Applications/sage-5.2/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_0[7]>", line 1, in <module>
        len(occurences)###line 34:
    sage: len(occurences)
    NameError: name 'occurences' is not defined
**********************************************************************
File "/Users/slabbe/Applications/sage-5.2/devel/sage-slabbe/sage/libs/string_process/string_process.pyx", line 36:
    sage: occurences[0]
Exception raised:
    Traceback (most recent call last):
      File "/Users/slabbe/Applications/sage-5.2/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/slabbe/Applications/sage-5.2/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/slabbe/Applications/sage-5.2/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_0[8]>", line 1, in <module>
        occurences[Integer(0)]###line 36:
    sage: occurences[0]
    NameError: name 'occurences' is not defined
**********************************************************************
File "/Users/slabbe/Applications/sage-5.2/devel/sage-slabbe/sage/libs/string_process/string_process.pyx", line 51:
    sage: b = border_array(u3); b
Expected:
    array([0, 0, 1, 0, 1, 2, 3, 0, 1, 2, 3, 4, 5, 6, 7], dtype=int32)
Got:
    array([0, 0, 1, 0, 1, 2, 3, 0, 1, 2, 3, 4, 5, 6, 7])
**********************************************************************
File "/Users/slabbe/Applications/sage-5.2/devel/sage-slabbe/sage/libs/string_process/string_process.pyx", line 53:
    sage: b[0] = 4; b
Expected:
    array([4, 0, 1, 0, 1, 2, 3, 0, 1, 2, 3, 4, 5, 6, 7], dtype=int32)
Got:
    array([4, 0, 1, 0, 1, 2, 3, 0, 1, 2, 3, 4, 5, 6, 7])
**********************************************************************
1 items had failures:
   7 of  18 in __main__.example_0
***Test Failed*** 7 failures.
For whitespace errors, see the file /Users/slabbe/.sage//tmp/string_process_50240.py
	 [3.5 s]
 
----------------------------------------------------------------------
The following tests failed:


	sage -t  "devel/sage-slabbe/sage/libs/string_process/string_process.pyx"
Total time for all tests: 3.5 seconds

```


Question 1

Also, I've never work with the directory `sage/libs` before. Should all function using the spkg should be there? Can other functions be elsewhere like in `sage/combinat/words` ?

Question 2

What is the goal of this ticket? Make the spkg as optional? Merge Florent's patch into Sage?

Question 3

Nicolas, you say the spkg is very preliminary. What are the next improvements that should be done?
