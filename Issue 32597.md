# Issue 32597: Race condition: Failed to build one or more wheels

Issue created by migration from https://trac.sagemath.org/ticket/32834

Original creator: vbraun

Original creation time: 2021-11-07 10:20:03

CC:  dimpase jhpalmieri mkoeppe

Apparently there is a race condition when building python wheels, I just had an incremental build fail with

```
Uninstalling existing 'pyparsing'
Warning: File '/home/release/Sage/local/var/lib/sage/wheels/pyparsing-2.4.7-py2.py3-none-any.whl' not found
Warning: Directory '/home/release/Sage/local/var/lib/sage/wheels' not found
Running pip-uninstall script for 'pyparsing'
Waiting for exclusive lock to run python3 -m pip uninstall --isolated --disable-pip-version-check --yes --no-input -r /home/release/Sage/local/var/lib/sage/venv-python3.9/var/lib/sage/scripts/pyparsing/spkg-piprm-requirements.txt ... ok
Found existing installation: pyparsing 2.4.7
Uninstalling pyparsing-2.4.7:
  Successfully uninstalled pyparsing-2.4.7
Removing stamp file '/home/release/Sage/local/var/lib/sage/venv-python3.9/var/lib/sage/installed/pyparsing-2.4.7'
Installing pyparsing-2.4.7
Processing /home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/src
    Running command python setup.py egg_info
    running egg_info
    creating /tmp/pip-pip-egg-info-b05xvbbp/pyparsing.egg-info
    writing /tmp/pip-pip-egg-info-b05xvbbp/pyparsing.egg-info/PKG-INFO
    writing dependency_links to /tmp/pip-pip-egg-info-b05xvbbp/pyparsing.egg-info/dependency_links.txt
    writing top-level names to /tmp/pip-pip-egg-info-b05xvbbp/pyparsing.egg-info/top_level.txt
    writing manifest file '/tmp/pip-pip-egg-info-b05xvbbp/pyparsing.egg-info/SOURCES.txt'
    reading manifest file '/tmp/pip-pip-egg-info-b05xvbbp/pyparsing.egg-info/SOURCES.txt'
    reading manifest template 'MANIFEST.in'
    warning: no files found matching 'HowToUsePyparsing.rst'
    warning: no files found matching 'pyparsingClassDiagram.*'
    warning: no files found matching 'README.md'
    warning: no files found matching 'modules.rst'
    no previously-included directories found matching 'docs/_build/*'
    adding license file 'LICENSE'
    writing manifest file '/tmp/pip-pip-egg-info-b05xvbbp/pyparsing.egg-info/SOURCES.txt'
Building wheels for collected packages: pyparsing
  Building wheel for pyparsing (setup.py): started
  Running command /home/release/Sage/local/var/lib/sage/venv-python3.9/bin/python3 -u -c 'import io, os, sys, setuptools, tokenize; sys.argv[0] = '"'"'/home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/src/setup.py'"'"'; __file__='"'"'/home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/src/setup.py'"'"';f = getattr(tokenize, '"'"'open'"'"', open)(__file__) if os.path.exists(__file__) else io.StringIO('"'"'from setuptools import setup; setup()'"'"');code = f.read().replace('"'"'\r\n'"'"', '"'"'\n'"'"');f.close();exec(compile(code, __file__, '"'"'exec'"'"'))' bdist_wheel -d /tmp/pip-wheel-frgg5xhi
  Traceback (most recent call last):
    File "<string>", line 1, in <module>
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/src/setup.py", line 18, in <module>
      setup(# Distribution meta-data
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/__init__.py", line 153, in setup
      return distutils.core.setup(**attrs)
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/_distutils/core.py", line 108, in setup
      _setup_distribution = dist = klass(attrs)
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/dist.py", line 453, in __init__
      _Distribution.__init__(
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/_distutils/dist.py", line 293, in __init__
      self.finalize_options()
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/dist.py", line 830, in finalize_options
      for ep in sorted(loaded, key=by_order):
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/dist.py", line 829, in <lambda>
      loaded = map(lambda e: e.load(), filtered)
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/pkg_resources/__init__.py", line 2449, in load
      self.require(*args, **kwargs)
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/pkg_resources/__init__.py", line 2472, in require
      items = working_set.resolve(reqs, env, installer, extras=self.extras)
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/pkg_resources/__init__.py", line 772, in resolve
      raise DistributionNotFound(req, requirers)
  pkg_resources.DistributionNotFound: The 'tomli>=1.0.0' distribution was not found and is required by the application
  Building wheel for pyparsing (setup.py): finished with status 'error'
  ERROR: Failed building wheel for pyparsing
  Running setup.py clean for pyparsing
  Running command /home/release/Sage/local/var/lib/sage/venv-python3.9/bin/python3 -u -c 'import io, os, sys, setuptools, tokenize; sys.argv[0] = '"'"'/home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/src/setup.py'"'"'; __file__='"'"'/home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/src/setup.py'"'"';f = getattr(tokenize, '"'"'open'"'"', open)(__file__) if os.path.exists(__file__) else io.StringIO('"'"'from setuptools import setup; setup()'"'"');code = f.read().replace('"'"'\r\n'"'"', '"'"'\n'"'"');f.close();exec(compile(code, __file__, '"'"'exec'"'"'))' clean --all
  Traceback (most recent call last):
    File "<string>", line 1, in <module>
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/src/setup.py", line 18, in <module>
      setup(# Distribution meta-data
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/__init__.py", line 153, in setup
      return distutils.core.setup(**attrs)
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/_distutils/core.py", line 108, in setup
      _setup_distribution = dist = klass(attrs)
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/dist.py", line 453, in __init__
      _Distribution.__init__(
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/_distutils/dist.py", line 293, in __init__
      self.finalize_options()
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/dist.py", line 830, in finalize_options
      for ep in sorted(loaded, key=by_order):
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/setuptools/dist.py", line 829, in <lambda>
      loaded = map(lambda e: e.load(), filtered)
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/pkg_resources/__init__.py", line 2449, in load
      self.require(*args, **kwargs)
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/pkg_resources/__init__.py", line 2472, in require
      items = working_set.resolve(reqs, env, installer, extras=self.extras)
    File "/home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/pkg_resources/__init__.py", line 772, in resolve
      raise DistributionNotFound(req, requirers)
  pkg_resources.DistributionNotFound: The 'tomli>=1.0.0' distribution was not found and is required by the application
  ERROR: Failed cleaning build dir for pyparsing
Failed to build pyparsing
ERROR: Failed to build one or more wheels
***********************************************************************************************************************************************************************
Error building a wheel for pyparsing-2.4.7
***********************************************************************************************************************************************************************
```

I re-ran make immediately after that, and this time it succeeded

```
Package 'pyparsing' is currently not installed
No legacy uninstaller found for 'pyparsing'; nothing to do
Installing pyparsing-2.4.7
Processing /home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/src
    Running command python setup.py egg_info
    running egg_info
    creating /tmp/pip-pip-egg-info-z4wpuj02/pyparsing.egg-info
    writing /tmp/pip-pip-egg-info-z4wpuj02/pyparsing.egg-info/PKG-INFO
    writing dependency_links to /tmp/pip-pip-egg-info-z4wpuj02/pyparsing.egg-info/dependency_links.txt
    writing top-level names to /tmp/pip-pip-egg-info-z4wpuj02/pyparsing.egg-info/top_level.txt
    writing manifest file '/tmp/pip-pip-egg-info-z4wpuj02/pyparsing.egg-info/SOURCES.txt'
    reading manifest file '/tmp/pip-pip-egg-info-z4wpuj02/pyparsing.egg-info/SOURCES.txt'
    reading manifest template 'MANIFEST.in'
    warning: no files found matching 'HowToUsePyparsing.rst'
    warning: no files found matching 'pyparsingClassDiagram.*'
    warning: no files found matching 'README.md'
    warning: no files found matching 'modules.rst'
    no previously-included directories found matching 'docs/_build/*'
    adding license file 'LICENSE'
    writing manifest file '/tmp/pip-pip-egg-info-z4wpuj02/pyparsing.egg-info/SOURCES.txt'
Building wheels for collected packages: pyparsing
  Building wheel for pyparsing (setup.py): started
  Running command /home/release/Sage/local/var/lib/sage/venv-python3.9/bin/python3 -u -c 'import io, os, sys, setuptools, tokenize; sys.argv[0] = '"'"'/home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/src/setup.py'"'"'; __file__='"'"'/home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/src/setup.py'"'"';f = getattr(tokenize, '"'"'open'"'"', open)(__file__) if os.path.exists(__file__) else io.StringIO('"'"'from setuptools import setup; setup()'"'"');code = f.read().replace('"'"'\r\n'"'"', '"'"'\n'"'"');f.close();exec(compile(code, __file__, '"'"'exec'"'"'))' bdist_wheel -d /tmp/pip-wheel-ced0k8ps
  running bdist_wheel
  running build
  running build_py
  creating build
  creating build/lib
  copying pyparsing.py -> build/lib
  installing to build/bdist.linux-x86_64/wheel
  running install
  running install_lib
  creating build/bdist.linux-x86_64
  creating build/bdist.linux-x86_64/wheel
  copying build/lib/pyparsing.py -> build/bdist.linux-x86_64/wheel
  running install_egg_info
  running egg_info
  writing pyparsing.egg-info/PKG-INFO
  writing dependency_links to pyparsing.egg-info/dependency_links.txt
  writing top-level names to pyparsing.egg-info/top_level.txt
  reading manifest file 'pyparsing.egg-info/SOURCES.txt'
  reading manifest template 'MANIFEST.in'
  warning: no files found matching 'HowToUsePyparsing.rst'
  warning: no files found matching 'pyparsingClassDiagram.*'
  warning: no files found matching 'README.md'
  warning: no files found matching 'modules.rst'
  no previously-included directories found matching 'docs/_build/*'
  adding license file 'LICENSE'
  writing manifest file 'pyparsing.egg-info/SOURCES.txt'
  Copying pyparsing.egg-info to build/bdist.linux-x86_64/wheel/pyparsing-2.4.7-py3.9.egg-info
  running install_scripts
  creating build/bdist.linux-x86_64/wheel/pyparsing-2.4.7.dist-info/WHEEL
  creating '/tmp/pip-wheel-ced0k8ps/pyparsing-2.4.7-py2.py3-none-any.whl' and adding 'build/bdist.linux-x86_64/wheel' to it
  adding 'pyparsing.py'
  adding 'pyparsing-2.4.7.dist-info/LICENSE'
  adding 'pyparsing-2.4.7.dist-info/METADATA'
  adding 'pyparsing-2.4.7.dist-info/WHEEL'
  adding 'pyparsing-2.4.7.dist-info/top_level.txt'
  adding 'pyparsing-2.4.7.dist-info/RECORD'
  removing build/bdist.linux-x86_64/wheel
  Building wheel for pyparsing (setup.py): finished with status 'done'
  Created wheel for pyparsing: filename=pyparsing-2.4.7-py2.py3-none-any.whl size=67860 sha256=c88885a6a25c4c1737289cd8c1ee303680d8a8db72e1315d1777c63d44e503fc
  Stored in directory: /tmp/pip-ephem-wheel-cache-4bi3_ldy/wheels/b6/5a/0f/cae9b0c02cfec6032d9d40f419baad38877f7a0f9c1d9dcab2
Successfully built pyparsing
WARNING: Skipping pyparsing as it is not installed.
Using pip 21.2.4 from /home/release/Sage/local/var/lib/sage/venv-python3.9/lib64/python3.9/site-packages/pip (python 3.9)
Looking in links: /home/release/Sage/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels
Processing /home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/inst/home/release/Sage/local/var/lib/sage/venv-python3.9/var/lib/sage/wheels/pyparsing-2.4.7-py2.py3-none-any.whl
Installing collected packages: pyparsing
Successfully installed pyparsing-2.4.7

real	0m5.165s
user	0m5.376s
sys	0m0.768s
Copying package files from temporary location /home/release/Sage/local/var/lib/sage/venv-python3.9/var/tmp/sage/build/pyparsing-2.4.7/inst to /home/release/Sage/local/var/lib/sage/venv-python3.9
Successfully installed pyparsing-2.4.7
```



---

Comment by vbraun created at 2022-01-09 20:45:26

This is still present, incremental builds can uninstall tomli while building pyparsing in parallel which then fails:

```
[singular-4.2.1p3] checking for string.h... (cached) yes
[singular-4.2.1p3] checking for time.h... yes
[singular-4.2.1p3] checking for math.h... yes
[ecl-21.2.1] ;;; End of Pass 1.
[singular-4.2.1p3] checking for cstdio... yes
[tomli-1.2.1] Using cached file /home/release/Sage/upstream/tomli-1.2.1.tar.gz
[singular-4.2.1p3] checking that generated files are newer than configure... done
[singular-4.2.1p3] configure: creating ./config.status
[tomli-1.2.1] tomli-1.2.1
[tomli-1.2.1] ====================================================
[tomli-1.2.1] Setting up build directory for tomli-1.2.1
[tomli-1.2.1] Finished extraction
[tomli-1.2.1] No patch files found in ../patches
[tomli-1.2.1] ****************************************************
[tomli-1.2.1] Host system:
[tomli-1.2.1] Linux zen 5.15.11-200.fc35.x86_64 #1 SMP Wed Dec 22 15:41:11 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux
[tomli-1.2.1] ****************************************************
[tomli-1.2.1] C compiler: gcc
[tomli-1.2.1] C compiler version:
[tomli-1.2.1] Using built-in specs.
[tomli-1.2.1] COLLECT_GCC=/usr/bin/gcc
[tomli-1.2.1] COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/11/lto-wrapper
[tomli-1.2.1] OFFLOAD_TARGET_NAMES=nvptx-none
[tomli-1.2.1] OFFLOAD_TARGET_DEFAULT=1
[tomli-1.2.1] Target: x86_64-redhat-linux
[tomli-1.2.1] Configured with: ../configure --enable-bootstrap --enable-languages=c,c++,fortran,objc,obj-c++,ada,go,d,lto --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared --enable-threads=posix --enable-checking=release --enable-multilib --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-gcc-major-version-only --with-linker-hash-style=gnu --enable-plugin --enable-initfini-array --with-isl=/builddir/build/BUILD/gcc-11.2.1-20211203/obj-x86_64-redhat-linux/isl-install --enable-offload-targets=nvptx-none --without-cuda-driver --enable-gnu-indirect-function --enable-cet --with-tune=generic --with-arch_32=i686 --build=x86_64-redhat-linux --with-build-config=bootstrap-lto --enable-link-serialization=1
[tomli-1.2.1] Thread model: posix
[tomli-1.2.1] Supported LTO compression algorithms: zlib zstd
[tomli-1.2.1] gcc version 11.2.1 20211203 (Red Hat 11.2.1-7) (GCC) 
[tomli-1.2.1] ****************************************************
[tomli-1.2.1] Uninstalling existing 'tomli'
[tomli-1.2.1] Warning: File '/home/release/Sage/local/var/lib/sage/wheels/tomli-1.2.1-py3-none-any.whl' not found
[tomli-1.2.1] Warning: Directory '/home/release/Sage/local/var/lib/sage/wheels' not found
[tomli-1.2.1] Running pip-uninstall script for 'tomli'
[pyparsing-3.0.6]   reading manifest file '/tmp/pip-pip-egg-info-s8vm7an1/pyparsing.egg-info/SOURCES.txt'
[pyparsing-3.0.6]   reading manifest template 'MANIFEST.in'
[pyparsing-3.0.6]   no previously-included directories found matching 'docs/_build/*'
[pyparsing-3.0.6]   no previously-included directories found matching 'tests/__pycache__'
[pyparsing-3.0.6]   adding license file 'LICENSE'
[pyparsing-3.0.6]   writing manifest file '/tmp/pip-pip-egg-info-s8vm7an1/pyparsing.egg-info/SOURCES.txt'
[pyparsing-3.0.6]   Preparing metadata (setup.py): finished with status 'done'
[pyparsing-3.0.6] Building wheels for collected packages: pyparsing
[pyparsing-3.0.6]   Building wheel for pyparsing (setup.py): started
[pyparsing-3.0.6]   Running command /home/release/Sage/local/var/lib/sage/venv-python3.9.9/bin/python3 -u -c 'import io, os, sys, setuptools, tokenize; sys.argv[0] = '"'"'/home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/tmp/sage/build/pyparsing-3.0.6/src/setup.py'"'"'; __file__='"'"'/home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/tmp/sage/build/pyparsing-3.0.6/src/setup.py'"'"';f = getattr(tokenize, '"'"'open'"'"', open)(__file__) if os.path.exists(__file__) else io.StringIO('"'"'from setuptools import setup; setup()'"'"');code = f.read().replace('"'"'\r\n'"'"', '"'"'\n'"'"');f.close();exec(compile(code, __file__, '"'"'exec'"'"'))' bdist_wheel -d /tmp/pip-wheel-zr8kkbnr
[gap-4.11.1] Successfully installed gap-4.11.1
[gap-4.11.1] Deleting temporary build directory
[gap-4.11.1] /home/release/Sage/local/var/tmp/sage/build/gap-4.11.1
[singular-4.2.1p3] config.status: creating Makefile
[singular-4.2.1p3] config.status: creating include/factory/Makefile
[singular-4.2.1p3] config.status: creating factory.pc
[singular-4.2.1p3] config.status: creating _config.h
[singular-4.2.1p3] config.status: executing depfiles commands
[singular-4.2.1p3] config.status: executing config.h commands
[singular-4.2.1p3] config.status: creating 'config.h' - prefix '' for '_config.h' defines
[singular-4.2.1p3] config.status: executing libtool commands
[tomli-1.2.1] Found existing installation: tomli 1.2.1
[tomli-1.2.1] Uninstalling tomli-1.2.1:
[tomli-1.2.1]   Successfully uninstalled tomli-1.2.1
[singular-4.2.1p3] === configuring in libpolys (/home/release/Sage/local/var/tmp/sage/build/singular-4.2.1p3/src/libpolys)
[singular-4.2.1p3] configure: running /usr/bin/bash ./configure --disable-option-checking '--prefix=/home/release/Sage/local'  '--libdir=/home/release/Sage/local/lib' '--disable-maintainer-mode' '--disable-dependency-tracking' '--exec-prefix=/home/release/Sage/local' '--bindir=/home/release/Sage/local/bin' '--with-ntl=/home/release/Sage/local' '--with-flint=/home/release/Sage/local' '--enable-gfanlib' '--enable-Singular' '--enable-factory' '--disable-doc' '--disable-polymake' '--without-python' '--without-pythonmodule' '--disable-python' '--disable-python_module' '--disable-python-module' '--disable-static' '--with-libparse' 'CC=gcc' 'CFLAGS=-g -O2' 'LDFLAGS=-Wl,-rpath-link,/home/release/Sage/local/lib -L/home/release/Sage/local/lib -Wl,-rpath,/home/release/Sage/local/lib -Wl,-rpath-link,/home/release/Sage/local/lib -L/home/release/Sage/local/lib -Wl,-rpath,/home/release/Sage/local/lib ' 'CXX=g++ -std=gnu++11' 'CXXFLAGS=-g -O2' '--enable-omalloc' 'OMALLOC_LIBS=/home/release/Sage/local/var/tmp/sage/build/singular-4.2.1p3/src/omalloc/libomalloc.la' 'OMALLOC_INCLUDES=-I/home/release/Sage/local/var/tmp/sage/build/singular-4.2.1p3/src' '--with-Singular' 'RESOURCES_LIBS=/home/release/Sage/local/var/tmp/sage/build/singular-4.2.1p3/src/resources/libsingular_resources.la' 'RESOURCES_INCLUDES=-I/home/release/Sage/local/var/tmp/sage/build/singular-4.2.1p3/src ' 'FACTORY_LIBS=/home/release/Sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory/libfactory.la' 'FACTORY_INCLUDES=-I/home/release/Sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/home/release/Sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory -I/home/release/Sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory/include' --cache-file=/dev/null --srcdir=.
[pyparsing-3.0.6]   Traceback (most recent call last):
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pkg_resources/__init__.py", line 3030, in _dep_map
[pyparsing-3.0.6]       return self.__dep_map
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pkg_resources/__init__.py", line 2827, in __getattr__
[pyparsing-3.0.6]       raise AttributeError(attr)
[pyparsing-3.0.6]   AttributeError: _DistInfoDistribution__dep_map
[pyparsing-3.0.6] 
[pyparsing-3.0.6]   During handling of the above exception, another exception occurred:
[pyparsing-3.0.6] 
[pyparsing-3.0.6]   Traceback (most recent call last):
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pkg_resources/__init__.py", line 3021, in _parsed_pkg_info
[pyparsing-3.0.6]       return self._pkg_info
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pkg_resources/__init__.py", line 2827, in __getattr__
[pyparsing-3.0.6]       raise AttributeError(attr)
[pyparsing-3.0.6]   AttributeError: _pkg_info
[pyparsing-3.0.6] 
[pyparsing-3.0.6]   During handling of the above exception, another exception occurred:
[pyparsing-3.0.6] 
[pyparsing-3.0.6]   Traceback (most recent call last):
[pyparsing-3.0.6]     File "<string>", line 1, in <module>
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/tmp/sage/build/pyparsing-3.0.6/src/setup.py", line 23, in <module>
[pyparsing-3.0.6]       setup(  # Distribution meta-data
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/setuptools/__init__.py", line 153, in setup
[pyparsing-3.0.6]       return distutils.core.setup(**attrs)
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/distutils/core.py", line 108, in setup
[pyparsing-3.0.6]       _setup_distribution = dist = klass(attrs)
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/setuptools/dist.py", line 453, in __init__
[pyparsing-3.0.6]       _Distribution.__init__(
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/distutils/dist.py", line 292, in __init__
[pyparsing-3.0.6]       self.finalize_options()
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/setuptools/dist.py", line 830, in finalize_options
[pyparsing-3.0.6]       for ep in sorted(loaded, key=by_order):
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/setuptools/dist.py", line 829, in <lambda>
[pyparsing-3.0.6]       loaded = map(lambda e: e.load(), filtered)
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pkg_resources/__init__.py", line 2463, in load
[pyparsing-3.0.6]       self.require(*args, **kwargs)
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pkg_resources/__init__.py", line 2486, in require
[pyparsing-3.0.6]       items = working_set.resolve(reqs, env, installer, extras=self.extras)
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pkg_resources/__init__.py", line 785, in resolve
[pyparsing-3.0.6]       new_requirements = dist.requires(req.extras)[::-1]
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pkg_resources/__init__.py", line 2748, in requires
[pyparsing-3.0.6]       dm = self._dep_map
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pkg_resources/__init__.py", line 3032, in _dep_map
[pyparsing-3.0.6]       self.__dep_map = self._compute_dependencies()
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pkg_resources/__init__.py", line 3041, in _compute_dependencies
[pyparsing-3.0.6]       for req in self._parsed_pkg_info.get_all('Requires-Dist') or []:
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pkg_resources/__init__.py", line 3023, in _parsed_pkg_info
[pyparsing-3.0.6]       metadata = self.get_metadata(self.PKG_INFO)
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pkg_resources/__init__.py", line 1412, in get_metadata
[pyparsing-3.0.6]       value = self._get(path)
[pyparsing-3.0.6]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pkg_resources/__init__.py", line 1616, in _get
[pyparsing-3.0.6]       with open(path, 'rb') as stream:
[pyparsing-3.0.6]   FileNotFoundError: [Errno 2] No such file or directory: '/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/tomli-1.2.1.dist-info/METADATA'
[pyparsing-3.0.6]   Building wheel for pyparsing (setup.py): finished with status 'error'
[pyparsing-3.0.6]   ERROR: Failed building wheel for pyparsing
[pyparsing-3.0.6]   Running setup.py clean for pyparsing
[pyparsing-3.0.6]   Running command /home/release/Sage/local/var/lib/sage/venv-python3.9.9/bin/python3 -u -c 'import io, os, sys, setuptools, tokenize; sys.argv[0] = '"'"'/home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/tmp/sage/build/pyparsing-3.0.6/src/setup.py'"'"'; __file__='"'"'/home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/tmp/sage/build/pyparsing-3.0.6/src/setup.py'"'"';f = getattr(tokenize, '"'"'open'"'"', open)(__file__) if os.path.exists(__file__) else io.StringIO('"'"'from setuptools import setup; setup()'"'"');code = f.read().replace('"'"'\r\n'"'"', '"'"'\n'"'"');f.close();exec(compile(code, __file__, '"'"'exec'"'"'))' clean --all
[tomli-1.2.1] Removing stamp file '/home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/lib/sage/installed/tomli-1.2.1'
[tomli-1.2.1] Installing tomli-1.2.1
```



---

Comment by mkoeppe created at 2022-01-09 20:53:58

Incremental from what? 
This installation was already broken:

```
[tomli-1.2.1] Uninstalling existing 'tomli'
[tomli-1.2.1] Warning: File '/home/release/Sage/local/var/lib/sage/wheels/tomli-1.2.1-py3-none-any.whl' not found
[tomli-1.2.1] Warning: Directory '/home/release/Sage/local/var/lib/sage/wheels' not found
```



---

Comment by vbraun created at 2022-01-09 21:43:40

Incremental from a version that passed tests...


---

Comment by mkoeppe created at 2022-01-09 21:57:49

Nuke that old tree


---

Comment by vbraun created at 2022-01-09 23:23:19

re-running make succeeded...


---

Comment by vbraun created at 2022-01-12 21:09:55

here is a repro, just do a simultaneous rebuild for tomli and pyparsing:

```
$ make   
... build to completion ...
$ sed -i 's/$/.p0/g' build/pkgs/tomli/package-version.txt
$ sed -i 's/$/.p0/g' build/pkgs/pyparsing/package-version.txt
$ make -j10 start
[...]
make --no-print-directory all-sage
make --no-print-directory tomli-SAGE_VENV-no-deps
make --no-print-directory pyparsing-SAGE_VENV-no-deps
[tomli-1.2.1.p0] Using cached file /home/release/Sage/upstream/tomli-1.2.1.tar.gz
[pyparsing-3.0.6.p0] Using cached file /home/release/Sage/upstream/pyparsing-3.0.6.tar.gz
[tomli-1.2.1.p0] tomli-1.2.1.p0
[tomli-1.2.1.p0] ====================================================
[tomli-1.2.1.p0] Setting up build directory for tomli-1.2.1.p0
[pyparsing-3.0.6.p0] pyparsing-3.0.6.p0
[pyparsing-3.0.6.p0] ====================================================
[pyparsing-3.0.6.p0] Setting up build directory for pyparsing-3.0.6.p0
[tomli-1.2.1.p0] Finished extraction
[tomli-1.2.1.p0] No patch files found in ../patches
[tomli-1.2.1.p0] ****************************************************
[tomli-1.2.1.p0] Host system:
[tomli-1.2.1.p0] Linux zen 5.15.11-200.fc35.x86_64 #1 SMP Wed Dec 22 15:41:11 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux
[tomli-1.2.1.p0] ****************************************************
[tomli-1.2.1.p0] C compiler: gcc
[tomli-1.2.1.p0] C compiler version:
[tomli-1.2.1.p0] Using built-in specs.
[tomli-1.2.1.p0] COLLECT_GCC=/usr/bin/gcc
[tomli-1.2.1.p0] COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/11/lto-wrapper
[tomli-1.2.1.p0] OFFLOAD_TARGET_NAMES=nvptx-none
[tomli-1.2.1.p0] OFFLOAD_TARGET_DEFAULT=1
[tomli-1.2.1.p0] Target: x86_64-redhat-linux
[tomli-1.2.1.p0] Configured with: ../configure --enable-bootstrap --enable-languages=c,c++,fortran,objc,obj-c++,ada,go,d,lto --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared --enable-threads=posix --enable-checking=release --enable-multilib --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-gcc-major-version-only --with-linker-hash-style=gnu --enable-plugin --enable-initfini-array --with-isl=/builddir/build/BUILD/gcc-11.2.1-20211203/obj-x86_64-redhat-linux/isl-install --enable-offload-targets=nvptx-none --without-cuda-driver --enable-gnu-indirect-function --enable-cet --with-tune=generic --with-arch_32=i686 --build=x86_64-redhat-linux --with-build-config=bootstrap-lto --enable-link-serialization=1
[tomli-1.2.1.p0] Thread model: posix
[tomli-1.2.1.p0] Supported LTO compression algorithms: zlib zstd
[tomli-1.2.1.p0] gcc version 11.2.1 20211203 (Red Hat 11.2.1-7) (GCC) 
[tomli-1.2.1.p0] ****************************************************
[pyparsing-3.0.6.p0] Finished extraction
[pyparsing-3.0.6.p0] No patch files found in ../patches
[tomli-1.2.1.p0] Uninstalling existing 'tomli'
[tomli-1.2.1.p0] Warning: File '/home/release/Sage/local/var/lib/sage/wheels/tomli-1.2.1-py3-none-any.whl' not found
[tomli-1.2.1.p0] Warning: Directory '/home/release/Sage/local/var/lib/sage/wheels' not found
[tomli-1.2.1.p0] Running pip-uninstall script for 'tomli'
[pyparsing-3.0.6.p0] ****************************************************
[pyparsing-3.0.6.p0] Host system:
[pyparsing-3.0.6.p0] Linux zen 5.15.11-200.fc35.x86_64 #1 SMP Wed Dec 22 15:41:11 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux
[pyparsing-3.0.6.p0] ****************************************************
[pyparsing-3.0.6.p0] C compiler: gcc
[pyparsing-3.0.6.p0] C compiler version:
[pyparsing-3.0.6.p0] Using built-in specs.
[pyparsing-3.0.6.p0] COLLECT_GCC=/usr/bin/gcc
[pyparsing-3.0.6.p0] COLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-redhat-linux/11/lto-wrapper
[pyparsing-3.0.6.p0] OFFLOAD_TARGET_NAMES=nvptx-none
[pyparsing-3.0.6.p0] OFFLOAD_TARGET_DEFAULT=1
[pyparsing-3.0.6.p0] Target: x86_64-redhat-linux
[pyparsing-3.0.6.p0] Configured with: ../configure --enable-bootstrap --enable-languages=c,c++,fortran,objc,obj-c++,ada,go,d,lto --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --with-bugurl=http://bugzilla.redhat.com/bugzilla --enable-shared --enable-threads=posix --enable-checking=release --enable-multilib --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-gnu-unique-object --enable-linker-build-id --with-gcc-major-version-only --with-linker-hash-style=gnu --enable-plugin --enable-initfini-array --with-isl=/builddir/build/BUILD/gcc-11.2.1-20211203/obj-x86_64-redhat-linux/isl-install --enable-offload-targets=nvptx-none --without-cuda-driver --enable-gnu-indirect-function --enable-cet --with-tune=generic --with-arch_32=i686 --build=x86_64-redhat-linux --with-build-config=bootstrap-lto --enable-link-serialization=1
[pyparsing-3.0.6.p0] Thread model: posix
[pyparsing-3.0.6.p0] Supported LTO compression algorithms: zlib zstd
[pyparsing-3.0.6.p0] gcc version 11.2.1 20211203 (Red Hat 11.2.1-7) (GCC) 
[pyparsing-3.0.6.p0] ****************************************************
[pyparsing-3.0.6.p0] Uninstalling existing 'pyparsing'
[pyparsing-3.0.6.p0] Warning: File '/home/release/Sage/local/var/lib/sage/wheels/pyparsing-3.0.6-py3-none-any.whl' not found
[pyparsing-3.0.6.p0] Warning: Directory '/home/release/Sage/local/var/lib/sage/wheels' not found
[pyparsing-3.0.6.p0] Running pip-uninstall script for 'pyparsing'
[tomli-1.2.1.p0] Found existing installation: tomli 1.2.1
[tomli-1.2.1.p0] Uninstalling tomli-1.2.1:
[tomli-1.2.1.p0]   Successfully uninstalled tomli-1.2.1
[pyparsing-3.0.6.p0] Waiting for exclusive lock to run python3 -m pip uninstall --isolated --disable-pip-version-check --yes --no-input -r /home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/lib/sage/scripts/pyparsing/spkg-piprm-requirements.txt ... ok
[tomli-1.2.1.p0] Removing stamp file '/home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/lib/sage/installed/tomli-1.2.1'
[tomli-1.2.1.p0] Installing tomli-1.2.1.p0
[pyparsing-3.0.6.p0] Found existing installation: pyparsing 3.0.6
[pyparsing-3.0.6.p0] Uninstalling pyparsing-3.0.6:
[pyparsing-3.0.6.p0]   Successfully uninstalled pyparsing-3.0.6
[tomli-1.2.1.p0] Processing /home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/tmp/sage/build/tomli-1.2.1.p0/src
[tomli-1.2.1.p0]   Preparing metadata (pyproject.toml): started
[tomli-1.2.1.p0]   Running command /home/release/Sage/local/var/lib/sage/venv-python3.9.9/bin/python3 /home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py prepare_metadata_for_build_wheel /tmp/tmppyi2csa4
[pyparsing-3.0.6.p0] Removing stamp file '/home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/lib/sage/installed/pyparsing-3.0.6'
[pyparsing-3.0.6.p0] Installing pyparsing-3.0.6.p0
[tomli-1.2.1.p0]   Preparing metadata (pyproject.toml): finished with status 'done'
[tomli-1.2.1.p0] Building wheels for collected packages: tomli
[tomli-1.2.1.p0]   Building wheel for tomli (pyproject.toml): started
[tomli-1.2.1.p0]   Running command /home/release/Sage/local/var/lib/sage/venv-python3.9.9/bin/python3 /home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pip/_vendor/pep517/in_process/_in_process.py build_wheel /tmp/tmpqu_b_8bd
[tomli-1.2.1.p0]   Building wheel for tomli (pyproject.toml): finished with status 'done'
[tomli-1.2.1.p0]   Created wheel for tomli: filename=tomli-1.2.1-py3-none-any.whl size=11849 sha256=3a83352da82206a7e320a74d52c59c2eb9246cfee3d64475568135c060b29777
[tomli-1.2.1.p0]   Stored in directory: /tmp/pip-ephem-wheel-cache-lpv8mfwg/wheels/f5/80/a3/e21b0a218ba3e80b0e2d9632545cf2b0d97f4c68c901ccefc6
[tomli-1.2.1.p0] Successfully built tomli
[pyparsing-3.0.6.p0] Processing /home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/tmp/sage/build/pyparsing-3.0.6.p0/src
[pyparsing-3.0.6.p0]   Preparing metadata (setup.py): started
[pyparsing-3.0.6.p0]   Running command python setup.py egg_info
[tomli-1.2.1.p0] WARNING: Skipping tomli as it is not installed.
[pyparsing-3.0.6.p0]   Traceback (most recent call last):
[pyparsing-3.0.6.p0]     File "<string>", line 1, in <module>
[pyparsing-3.0.6.p0]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/tmp/sage/build/pyparsing-3.0.6.p0/src/setup.py", line 23, in <module>
[pyparsing-3.0.6.p0]       setup(  # Distribution meta-data
[pyparsing-3.0.6.p0]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/setuptools/__init__.py", line 153, in setup
[pyparsing-3.0.6.p0]       return distutils.core.setup(**attrs)
[pyparsing-3.0.6.p0]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/distutils/core.py", line 108, in setup
[pyparsing-3.0.6.p0]       _setup_distribution = dist = klass(attrs)
[pyparsing-3.0.6.p0]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/setuptools/dist.py", line 453, in __init__
[pyparsing-3.0.6.p0]       _Distribution.__init__(
[pyparsing-3.0.6.p0]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/distutils/dist.py", line 292, in __init__
[pyparsing-3.0.6.p0]       self.finalize_options()
[pyparsing-3.0.6.p0]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/setuptools/dist.py", line 830, in finalize_options
[pyparsing-3.0.6.p0]       for ep in sorted(loaded, key=by_order):
[pyparsing-3.0.6.p0]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/setuptools/dist.py", line 829, in <lambda>
[pyparsing-3.0.6.p0]       loaded = map(lambda e: e.load(), filtered)
[pyparsing-3.0.6.p0]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pkg_resources/__init__.py", line 2463, in load
[pyparsing-3.0.6.p0]       self.require(*args, **kwargs)
[pyparsing-3.0.6.p0]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pkg_resources/__init__.py", line 2486, in require
[pyparsing-3.0.6.p0]       items = working_set.resolve(reqs, env, installer, extras=self.extras)
[pyparsing-3.0.6.p0]     File "/home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pkg_resources/__init__.py", line 777, in resolve
[pyparsing-3.0.6.p0]       raise DistributionNotFound(req, requirers)
[pyparsing-3.0.6.p0]   pkg_resources.DistributionNotFound: The 'tomli>=1.0.0' distribution was not found and is required by the application
[pyparsing-3.0.6.p0]   Preparing metadata (setup.py): finished with status 'error'
[pyparsing-3.0.6.p0] WARNING: Discarding file:///home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/tmp/sage/build/pyparsing-3.0.6.p0/src. Command errored out with exit status 1: python setup.py egg_info Check the logs for full command output.
[pyparsing-3.0.6.p0] ERROR: Command errored out with exit status 1: python setup.py egg_info Check the logs for full command output.
[pyparsing-3.0.6.p0] ******************************************************************************************************************************************************************************************************************************************
[pyparsing-3.0.6.p0] Error building a wheel for pyparsing-3.0.6.p0
[pyparsing-3.0.6.p0] ******************************************************************************************************************************************************************************************************************************************
[pyparsing-3.0.6.p0] 
[pyparsing-3.0.6.p0] real	0m0.614s
[pyparsing-3.0.6.p0] user	0m0.546s
[pyparsing-3.0.6.p0] sys	0m0.070s
[pyparsing-3.0.6.p0] ************************************************************************
[pyparsing-3.0.6.p0] Error installing package pyparsing-3.0.6.p0
[pyparsing-3.0.6.p0] ************************************************************************
[pyparsing-3.0.6.p0] Please email sage-devel (http://groups.google.com/group/sage-devel)
[pyparsing-3.0.6.p0] explaining the problem and including the log files
[pyparsing-3.0.6.p0]   /home/release/Sage/logs/pkgs/pyparsing-3.0.6.p0.log
[pyparsing-3.0.6.p0] and
[pyparsing-3.0.6.p0]   /home/release/Sage/config.log
[pyparsing-3.0.6.p0] Describe your computer, operating system, etc.
[pyparsing-3.0.6.p0] If you want to try to fix the problem yourself, *don't* just cd to
[pyparsing-3.0.6.p0] /home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/tmp/sage/build/pyparsing-3.0.6.p0 and type 'make' or whatever is appropriate.
[pyparsing-3.0.6.p0] Instead, the following commands setup all environment variables
[pyparsing-3.0.6.p0] correctly and load a subshell for you to debug the error:
[pyparsing-3.0.6.p0]   (cd '/home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/tmp/sage/build/pyparsing-3.0.6.p0' && '/home/release/Sage/sage' --buildsh)
[pyparsing-3.0.6.p0] When you are done debugging, you can type "exit" to leave the subshell.
[pyparsing-3.0.6.p0] ************************************************************************
make[4]: *** [Makefile:2724: pyparsing-SAGE_VENV-no-deps] Error 1
make[3]: *** [Makefile:2724: /home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/lib/sage/installed/pyparsing-3.0.6.p0] Error 2
make[3]: *** Waiting for unfinished jobs....
[tomli-1.2.1.p0] Using pip 21.3.1 from /home/release/Sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/pip (python 3.9)
[tomli-1.2.1.p0] Looking in links: /home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/lib/sage/wheels
[tomli-1.2.1.p0] Processing /home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/tmp/sage/build/tomli-1.2.1.p0/inst/home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/lib/sage/wheels/tomli-1.2.1-py3-none-any.whl
[tomli-1.2.1.p0] Installing collected packages: tomli
[tomli-1.2.1.p0] Successfully installed tomli-1.2.1
[tomli-1.2.1.p0] 
[tomli-1.2.1.p0] real	0m1.599s
[tomli-1.2.1.p0] user	0m1.403s
[tomli-1.2.1.p0] sys	0m0.189s
[tomli-1.2.1.p0] Copying package files from temporary location /home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/tmp/sage/build/tomli-1.2.1.p0/inst to /home/release/Sage/local/var/lib/sage/venv-python3.9.9
[tomli-1.2.1.p0] Successfully installed tomli-1.2.1.p0
[tomli-1.2.1.p0] Deleting temporary build directory
[tomli-1.2.1.p0] /home/release/Sage/local/var/lib/sage/venv-python3.9.9/var/tmp/sage/build/tomli-1.2.1.p0
[tomli-1.2.1.p0] Finished installing tomli-1.2.1.p0
make[2]: *** [Makefile:2432: all-build] Error 2
make[2]: Leaving directory '/home/release/Sage/build/make'
```



---

Comment by mkoeppe created at 2022-01-13 06:12:47

Looks like we may have to upgrade the lock held during `pip install` from shared to exclusive and hold a shared lock during `pip wheel`. Sage 9.6 material, I'd say


---

Comment by mkoeppe created at 2022-05-03 02:45:11

Replying to [comment:7 mkoeppe]:
> hold a shared lock during `pip wheel`

or better switch to using build isolation - #33789.


---

Comment by mkoeppe created at 2022-08-01 20:35:32

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-08-01 20:35:32

I think we can close this as outdated


---

Comment by jhpalmieri created at 2022-08-05 21:20:24

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-09-01 02:30:35

Resolution: invalid
