# Issue 30126: Migration to GitHub

Issue created by migration from https://trac.sagemath.org/ticket/30363

Original creator: @tobiasdiez

Original creation time: 2020-08-14 21:40:38

CC:  slelievre dimpase roed was klee slabbe vdelecroix

GitHub has many features that are superior to the ones trac provides. For example, pull request reviews, code view and navigation, issue management with projects and labels, [GitHub](GitHub) actions for automatic code checks and other automation. Moreover, it's the de facto standard for open source projects.

For this reason, I would propose to migrate to [GitHub](GitHub).
The following needs to be done in this process:
- Make it possible to contribute via Github Pull Requests (this is the most important one for me as a 'simple' contributor).
- Replace/integrate patchbot by [GitHub](GitHub) actions. Refs #28936
- Migrate existing issues

(feel free to add things that I've overlooked.)


---

Comment by @tobiasdiez created at 2020-08-14 21:41:21

Changing priority from major to critical.


---

Comment by @tobiasdiez created at 2020-08-14 21:41:21

Changing component from PLEASE CHANGE to misc.


---

Comment by slelievre created at 2020-08-14 23:16:42

Changing type from PLEASE CHANGE to task.


---

Comment by slelievre created at 2020-08-14 23:16:42

There once was a bot called sageb0t that would transform
any pull request opened on the SageMath repo at GitHub
to a ticket on the Sage Trac server. The bot was lost.

There is now a mechanism that will transform any merge request
opened against the SageMath repo at GitLab into a ticket
on the Sage Trac server. Read more about this mechanism:

- [sage-devel, 2019-07, New contributor experience](https://groups.google.com/d/topic/sage-devel/5Za1A9Fw4T4/discussion)

- [sage-devel, 2019-04, gitlab status](https://groups.google.com/d/topic/sage-devel/pCaSocfNzKE/discussion)

- [sage-devel, 2018-08, Enabling Merge Requests from GitLab](https://groups.google.com/d/topic/sage-devel/yBv5MCG9SJY/discussion)


---

Comment by slelievre created at 2020-08-14 23:19:58

Note another discussion on this theme:

- [sage-devel, 2018-07, talk](https://groups.google.com/d/topic/sage-devel/E_h-48rQjRk/discussion)


---

Comment by @tobiasdiez created at 2020-08-17 16:14:42

Thanks for these links.

I would argue that a simple bot that converts github pull requests and issues to trac is not enough in the long term. It might ease the transition period, but also duplicates the infrastructure. Moreover, you don't get to enjoy the above mentioned benefits if pull requests are still reviewed here on trac etc.

Are there any issues that prevent a clear one-time migration of the current issues and code contributions to github, say using tools like https://github.com/trustmaster/trac2github.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by swenson created at 2021-03-27 22:36:48

I wrote some of the sageb0t code, and it is still available here: https://github.com/swenson/sage-workflow/blob/master/sagedev/pr_export.py


---

Comment by embray created at 2021-03-29 07:45:53

-1 we have already put a significant amount of work into migration to [GitLab](GitLab) which doesn't take money from the US government to imprison migrant children: https://gitlab.com/sagemath


---

Comment by dimpase created at 2022-09-09 09:41:20

Replying to [comment:9 Erik Bray]:
> -1 we have already put a significant amount of work into migration to [GitLab](GitLab) which doesn't take money from the US government to imprison migrant children: https://gitlab.com/sagemath

Let's not get bogged down in political discussions here -  we're paying about US$4000 to Google for trac hosting, and Google is not an angel, either. Even if we create our own exclusively solar panel and wind power generator operating hosting site for trac, we still will be reliant on various arguably evil parties to be operational.

Besides, GitLab's free tier (and not only) is lacking in functionality compared to GitHub, and https://gitlab.com/sagemath
is semi-broken, in part due to this, in part due to lack of attention.


---

Comment by mkoeppe created at 2022-09-10 18:04:45

`@`vbraun, would it break any of your workflows if we protect the branches of the main Sage repo? (see https://github.com/sagemath/sage message "Your develop branch isn't protected")


---

Comment by mkoeppe created at 2022-09-10 18:57:02

​https://github.com/sagemath/sage/wiki/migration-from-trac-to-Git**b ready for broader review, what's missing


---

Comment by dimpase created at 2022-09-12 10:36:13

not sure why you changed the title; the plan should involve re-linking git.sagemath branches/commits to the corresponding branches/commits in https://github.com/sagemath/sagetrac-mirror as well.


---

Comment by mkoeppe created at 2022-09-12 12:16:24

Replying to [comment:37 Dima Pasechnik]:
> not sure why you changed the title; the plan should involve re-linking git.sagemath branches/commits to the corresponding branches/commits in https://github.com/sagemath/sagetrac-mirror as well.

Sure, I've changed it back


---

Comment by mkoeppe created at 2022-09-14 04:24:38

Replying to [comment:18 Matthias Köppe]:
> `@`vbraun, would it break any of your workflows if we protect the branches of the main Sage repo? (see https://github.com/sagemath/sage message "Your develop branch isn't protected")

Described now at https://github.com/sagemath/sage/wiki/migration-from-trac-to-Git**b#proposed-permissions-and-protections


---

Comment by klee created at 2022-09-16 01:55:48

In the migration guide,

```
for trying the branch of a PR locally, instead of using git trac checkout TICKETNUMBER 
or git trac try TICKETNUMBER, 
use git fetch origin pull/PULL_REQUEST_ID/head:LOCAL_BRANCH_NAME
```


Is the "origin" right? A PR seems associated with "upstream" rather than "origin" (my fork). No?


---

Comment by mkoeppe created at 2022-09-16 04:52:56

Thanks for catching this mistake! I've fixed it now.


---

Comment by roed created at 2022-09-16 05:41:55

As a note about github permissions, I [found](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/reviewing-changes-in-pull-requests/reviewing-proposed-changes-in-a-pull-request#submitting-your-review) that write access means "If required reviews are enabled and a collaborator with write, admin, or owner access to the repository submits a review requesting changes, the pull request cannot be merged until the same collaborator submits another review approving the changes in the pull request."  I think this is good most of the time, but I worry about how we might resolve cases where different people disagree about whether a PR should be merged or how to resolve issues on it.


---

Comment by @dimpase created at 2022-09-16 08:50:06

Replying to [comment:58 David Roe]:
> [...] I worry about how we might resolve cases where different people disagree about whether a PR should be merged or how to resolve issues on it.  

well, with trac don't have a good procedure in such cases, either. That's a conflict between humans to resolve, something that no amount of computing tools would help you much.


---

Comment by roed created at 2022-09-16 16:16:09

I completely agree that there is primarily a conflict for humans to resolve here, now and on github.  My concern is a technical one.  Currently on trac, if there's a consensus of people involved in the ticket, anyone can mark the ticket positively reviewed, the release manager can review the situation and merge it.  It sounds like, if we give all active developers write permissions, then someone can just refuse to finish their review and maybe the only recourse would be to open another PR?

I bring this up just to figure out if we want to be explicit about some policy in advance that we can point to if such a situation arises.  For example:


_If a conflict arises in reviewing a PR, a developer should allow the PR to proceed by submitting a positive review if both of the following conditions hold:_

* _At least three Sage developers are in favor of the PR, outnumbering those who opose,_
* _At least a week of discussion has passed since any new concerns were raised._

Or maybe I'm misreading what options others would have in this setting.  I think this may be an unusual situation for projects to be in since we're trying to grant Write access unusually broadly in order to preserve the ability for many developers to make changes to others' PRs.


---

Comment by mkoeppe created at 2022-09-16 16:59:01

This is an important question. I'd think a solution would be that a Team such as Core would be able to override required review etc., but we should find out the details & document it.


---

Comment by @dimpase created at 2022-09-16 17:04:45

Actually, I don't see a big reason to give all the active developers write permissions. One can work on almost all PRs without them just as well, with only a tiny bit of extra hassle.


---

Comment by roed created at 2022-09-16 17:07:50

I just looked further, and found that [Admins](https://docs.github.com/en/organizations/managing-access-to-your-organizations-repositories/repository-roles-for-an-organization) have the ability to "merge pull requests on protected branches, even if there are no approving reviews."  So I think that takes care of my technical objection.  It still may be worth codifying a social policy like I described to help in situations where people get stuck, but I'm fine putting that off for now.


---

Comment by mkoeppe created at 2022-09-16 17:08:52

Replying to [comment:62 Dima Pasechnik]:
> Actually, I don't see a big reason to give all the active developers write permissions. One can work on almost all PRs without them just as well, with only a tiny bit of extra hassle.

I tend to agree with this too. We could say that write permission can be requested - as a convenience if that developer is very active and finds themselves inconvenienced by the extra hassle.


---

Comment by roed created at 2022-09-16 17:12:56

I'm fine with having Write permissions be opt in, but I'd phrase it a bit differently.  Perhaps "if you want to be able to make changes directly on PRs (when the author elects to allow edits from maintainers), please contact X and we can give you the relevant permissions."  I think it's a reasonable workflow that we want to support, rather than having it feel like a special priveledge.

Of course, we may come up with other reasons why it's a bad idea.  That's what I've been trying to think through the consequences of various permission settings.


---

Comment by mkoeppe created at 2022-09-16 17:13:59

Yes, this is a great wording.


---

Comment by mkoeppe created at 2022-09-16 17:19:11

David, do you want to add a bit along these lines to https://github.com/sagemath/sage/wiki/migration-from-trac-to-Git**b ?


---

Comment by roed created at 2022-09-16 18:19:32

I added a bullet point to the "reviewing a change" section.


---

Comment by dimpase created at 2022-09-18 09:43:34

One more thing to take care is to fix `:trac:` tags in our manual, to point at the correct URLs (possibly more like this?).


---

Comment by jhpalmieri created at 2022-09-19 18:59:25

Replying to [comment:72 Dima Pasechnik]:
> One more thing to take care is to fix `:trac:` tags in our manual, to point at the correct URLs (possibly more like this?).

Can the tool https://github.com/sagemath/trac-to-github build a dictionary of trac ticket numbers <-> Github issues/URLs/whatever, and then we can use that to fix these tags?


---

Comment by mkoeppe created at 2022-09-19 19:01:25

Ticket numbers will be preserved as issue numbers


---

Comment by @dimpase created at 2022-09-19 19:02:33

Replying to [comment:77 John Palmieri]:
> Replying to [comment:72 Dima Pasechnik]:
> > One more thing to take care is to fix `:trac:` tags in our manual, to point at the correct URLs (possibly more like this?).
> 
> Can the tool https://github.com/sagemath/trac-to-github build a dictionary of trac ticket numbers <-> Github issues/URLs/whatever, and then we can use that to fix these tags?

the plan is that it should be 1-1, then only code handling the tag itself would need to be changed (in a trivial way).


---

Comment by roed created at 2022-09-19 20:15:55

One thing that Jeroen pointed out in a [thread about Gitlab a few years ago](https://groups.google.com/g/sage-devel/c/yBv5MCG9SJY/m/frWG2NiqBQAJ) was that he "very much [liked] the fact that we have a single git repo
where all pull requests appear. Checking out a pull request for
reviewing is so much easier with Sage than it is with typical [GitHub](GitHub)
projects. If we ever move to [GitLab](GitLab), we really should keep this workflow."

If many Sage developers have write access to the repo, it is possible to have feature branches all in the main Sage repo (which we [may need to do](https://github.com/sagemath/trac-to-github/issues/5) regardless as part of the transition).  But there is the issue of clutter to keep in mind.


---

Comment by jhpalmieri created at 2022-09-19 20:30:39

Replying to [comment:79 Dima Pasechnik]:
> Replying to [comment:77 John Palmieri]:
> > Replying to [comment:72 Dima Pasechnik]:
> > > One more thing to take care is to fix `:trac:` tags in our manual, to point at the correct URLs (possibly more like this?).
> > 
> > Can the tool https://github.com/sagemath/trac-to-github build a dictionary of trac ticket numbers <-> Github issues/URLs/whatever, and then we can use that to fix these tags?
> 
> the plan is that it should be 1-1, then only code handling the tag itself would need to be changed (in a trivial way). 

We've been talking about `:trac:` directives, but there is a bigger problem: `git grep trac.sagemath.org src/` yields lots of hits, and all of those links are going to be broken if we get rid of the trac server. Many of them are in comments rather than live documentation, but it would be good to not lose those links. One solution would be to just change them all to use `:trac:`.


---

Comment by mkoeppe created at 2022-09-19 20:36:44

In the ticket description we have:
- Need a plan to ​keep links from external websites to trac.sagemath.org working
  - either host all of trac.sagemath.org in static readonly mode (e.g via github pages) forever to preserve the links (suggested by `@`was)
  - or set up http redirects to the Issues (ticket numbers & issue numbers map 1:1)


---

Comment by mkoeppe created at 2022-09-19 20:44:50

Replying to [comment:80 David Roe]:
> One thing that Jeroen pointed out in a [thread about Gitlab a few years ago](https://groups.google.com/g/sage-devel/c/yBv5MCG9SJY/m/frWG2NiqBQAJ) was that he "very much [liked] the fact that we have a single git repo
> where all pull requests appear. Checking out a pull request for
> reviewing is so much easier with Sage than it is with typical [GitHub](GitHub)
> projects.

I don't think this is true (nor was it true when Jeroen wrote it). The PRs will all be available in our main repo, and as documented in https://github.com/sagemath/sage/wiki/migration-from-trac-to-Git**b#proposed-workflow-on-github-with-transition-guide-from-trac, they can be checked out using `git fetch upstream pull/PULL_REQUEST_ID/head:LOCAL_BRANCH_NAME`


---

Comment by mkoeppe created at 2022-09-19 20:48:53

Replying to [comment:80 David Roe]:
> If many Sage developers have write access to the repo, it is possible to have feature branches all in the main Sage repo (which we [may need to do](https://github.com/sagemath/trac-to-github/issues/5) regardless as part of the transition).  But there is the issue of clutter to keep in mind.

I don't think we should create named feature branches in the main Sage repo.

The old branches from Trac are on sagetrac-mirror, and pull requests can be initiated from there.


---

Comment by roed created at 2022-09-19 21:16:47

Creating pull requests from sagetrac-mirror sounds like a clean solution.  Reading through more of the thread where Jeroen was commenting, I think he was in the minority.  So I withdraw the proposal of having named feature branches in the main Sage repo.

We should make sure we're clear that this is the standard if we're giving Sage developers write access (which would allow them to create such branches).


---

Comment by mkoeppe created at 2022-09-25 19:47:49

Replying to [comment:86 David Roe]:
> Creating pull requests from sagetrac-mirror sounds like a clean solution. 

I've added this to https://github.com/sagemath/sage/wiki/migration-from-trac-to-Git**b#conversion-of-trac-tickets-and-the-trac-wiki-to-github


---

Comment by mkoeppe created at 2022-09-27 17:14:22

As suggested in https://github.com/sagemath/publications/pull/142#issuecomment-1259001501 and https://groups.google.com/g/sage-devel/c/hX6ojxlNwOU/m/dup_Ywu1BQAJ, we should add to [the transition guide](https://github.com/sagemath/sage/wiki/migration-from-trac-to-Git**b#proposed-workflow-on-github-with-transition-guide-from-trac) how to model Trac's ticket dependencies in GitHub PRs.
See https://github.com/orgs/community/discussions/4477 for solutions.
