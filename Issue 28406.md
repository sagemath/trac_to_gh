# Issue 28406: Speed up incidence matrix of polyhedra

Issue created by migration from https://trac.sagemath.org/ticket/28643

Original creator: @kliem

Original creation time: 2019-10-22 09:13:17

CC:  jipilab @laisrast

Keywords: polytopes, incidence matrix

We speed up the calculation of the incidence matrix by avoiding recomputation.

Before:

```
sage: P = polytopes.permutahedron(7)
sage: %time _ = P.incidence_matrix()
CPU times: user 2.21 s, sys: 52.4 ms, total: 2.26 s
Wall time: 2.21 s
sage: P = polytopes.associahedron(['A',10],backend='normaliz')
sage: %time _ = P.incidence_matrix()
CPU times: user 21.7 s, sys: 129 ms, total: 21.9 s
Wall time: 21.7 s
```


After:

```
sage: P = polytopes.permutahedron(7)
sage: %time _ = P.incidence_matrix()
CPU times: user 682 ms, sys: 81.4 ms, total: 764 ms
Wall time: 606 ms
sage: P = polytopes.associahedron(['A',10],backend='normaliz')
sage: %time _ = P.incidence_matrix()
CPU times: user 6.16 s, sys: 67.5 ms, total: 6.23 s
Wall time: 6.16 s
```



---

Comment by @kliem created at 2019-10-22 09:14:05

New commits:


---

Comment by @kliem created at 2019-10-22 09:14:05

Changing status from new to needs_review.


---

Comment by @LaisRast created at 2019-10-22 09:55:54

It is faster and still correct.
One suggestion: I think it would be a good idea to add more examples in the docstring.
For instance, you can add an example for unbounded polyhedron:

```
sage: P = Polyhedron(vertices=[(1,0,0), (1,1,0)], rays=[(1,0,0)], lines=[(0,0,1)])
sage: P.incidence_matrix()
[1 1 1]
[1 1 0]
[1 0 1]
[0 1 1]
```



---

Comment by git created at 2019-10-22 10:49:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @LaisRast created at 2019-10-22 12:51:10

You wrote that "The incidence matrix is not unique up to permutation for unbounded polyhedra", I believe you meant something else.

Plus, it would be nice to include the following example (which you suggested before). This is an example of two "combinatorially isomorphic" polyhedra with different incidence matrices.


```
sage: P1 = Polyhedron(vertices=[[1,0],[-1,0]],rays=[[0,1]])
sage: P1.incidence_matrix()
[1 1 0]
[1 0 1]
[0 1 1]
sage: P2 = Polyhedron(vertices=[[1,0],[-1,0]],rays=[[0,1], [1,1]])
sage: P2.incidence_matrix()
[1 1 0]
[1 0 0]
[0 1 1]
[0 0 1]
```



---

Comment by git created at 2019-10-22 13:35:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @LaisRast created at 2019-10-22 13:52:28

Changing status from needs_review to positive_review.


---

Comment by @LaisRast created at 2019-10-22 13:52:28

I think it is good to go.


---

Comment by jipilab created at 2019-10-24 09:00:26

May I suggest:


```
-        The incidence matrix does not uniquely determine
-        an unbounded polyhedra::
+        An incidence matrix does not determine a unique 
+        polyhedra::
```



---

Comment by jipilab created at 2019-10-24 09:00:26

Changing status from positive_review to needs_work.


---

Comment by git created at 2019-10-25 09:23:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2019-10-25 09:24:09

Changing status from needs_work to needs_review.


---

Comment by @LaisRast created at 2019-10-25 09:27:26

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-10-27 10:28:23

Resolution: fixed
