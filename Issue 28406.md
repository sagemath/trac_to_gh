# Issue 28406: Speed up incidence matrix of polyhedra

archive/issues_028406.json:
```json
{
    "body": "CC:  @jplab @laisrast\n\nKeywords: polytopes, incidence matrix\n\nWe speed up the calculation of the incidence matrix by avoiding recomputation.\n\nBefore:\n\n```\nsage: P = polytopes.permutahedron(7)\nsage: %time _ = P.incidence_matrix()\nCPU times: user 2.21 s, sys: 52.4 ms, total: 2.26 s\nWall time: 2.21 s\nsage: P = polytopes.associahedron(['A',10],backend='normaliz')\nsage: %time _ = P.incidence_matrix()\nCPU times: user 21.7 s, sys: 129 ms, total: 21.9 s\nWall time: 21.7 s\n```\n\nAfter:\n\n```\nsage: P = polytopes.permutahedron(7)\nsage: %time _ = P.incidence_matrix()\nCPU times: user 682 ms, sys: 81.4 ms, total: 764 ms\nWall time: 606 ms\nsage: P = polytopes.associahedron(['A',10],backend='normaliz')\nsage: %time _ = P.incidence_matrix()\nCPU times: user 6.16 s, sys: 67.5 ms, total: 6.23 s\nWall time: 6.16 s\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/28643\n\n",
    "created_at": "2019-10-22T09:13:17Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Speed up incidence matrix of polyhedra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28406",
    "user": "https://github.com/kliem"
}
```
CC:  @jplab @laisrast

Keywords: polytopes, incidence matrix

We speed up the calculation of the incidence matrix by avoiding recomputation.

Before:

```
sage: P = polytopes.permutahedron(7)
sage: %time _ = P.incidence_matrix()
CPU times: user 2.21 s, sys: 52.4 ms, total: 2.26 s
Wall time: 2.21 s
sage: P = polytopes.associahedron(['A',10],backend='normaliz')
sage: %time _ = P.incidence_matrix()
CPU times: user 21.7 s, sys: 129 ms, total: 21.9 s
Wall time: 21.7 s
```

After:

```
sage: P = polytopes.permutahedron(7)
sage: %time _ = P.incidence_matrix()
CPU times: user 682 ms, sys: 81.4 ms, total: 764 ms
Wall time: 606 ms
sage: P = polytopes.associahedron(['A',10],backend='normaliz')
sage: %time _ = P.incidence_matrix()
CPU times: user 6.16 s, sys: 67.5 ms, total: 6.23 s
Wall time: 6.16 s
```

Issue created by migration from https://trac.sagemath.org/ticket/28643





---

archive/issue_comments_400744.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-10-22T09:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28406#issuecomment-400744",
    "user": "https://github.com/kliem"
}
```

New commits:



---

archive/issue_comments_400745.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-10-22T09:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28406#issuecomment-400745",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_400746.json:
```json
{
    "body": "It is faster and still correct.\nOne suggestion: I think it would be a good idea to add more examples in the docstring.\nFor instance, you can add an example for unbounded polyhedron:\n\n```\nsage: P = Polyhedron(vertices=[(1,0,0), (1,1,0)], rays=[(1,0,0)], lines=[(0,0,1)])\nsage: P.incidence_matrix()\n[1 1 1]\n[1 1 0]\n[1 0 1]\n[0 1 1]\n```",
    "created_at": "2019-10-22T09:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28406#issuecomment-400746",
    "user": "https://github.com/LaisRast"
}
```

It is faster and still correct.
One suggestion: I think it would be a good idea to add more examples in the docstring.
For instance, you can add an example for unbounded polyhedron:

```
sage: P = Polyhedron(vertices=[(1,0,0), (1,1,0)], rays=[(1,0,0)], lines=[(0,0,1)])
sage: P.incidence_matrix()
[1 1 1]
[1 1 0]
[1 0 1]
[0 1 1]
```



---

archive/issue_comments_400747.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-22T10:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28406#issuecomment-400747",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400748.json:
```json
{
    "body": "You wrote that \"The incidence matrix is not unique up to permutation for unbounded polyhedra\", I believe you meant something else.\n\nPlus, it would be nice to include the following example (which you suggested before). This is an example of two \"combinatorially isomorphic\" polyhedra with different incidence matrices.\n\n```\nsage: P1 = Polyhedron(vertices=[[1,0],[-1,0]],rays=[[0,1]])\nsage: P1.incidence_matrix()\n[1 1 0]\n[1 0 1]\n[0 1 1]\nsage: P2 = Polyhedron(vertices=[[1,0],[-1,0]],rays=[[0,1], [1,1]])\nsage: P2.incidence_matrix()\n[1 1 0]\n[1 0 0]\n[0 1 1]\n[0 0 1]\n```",
    "created_at": "2019-10-22T12:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28406#issuecomment-400748",
    "user": "https://github.com/LaisRast"
}
```

You wrote that "The incidence matrix is not unique up to permutation for unbounded polyhedra", I believe you meant something else.

Plus, it would be nice to include the following example (which you suggested before). This is an example of two "combinatorially isomorphic" polyhedra with different incidence matrices.

```
sage: P1 = Polyhedron(vertices=[[1,0],[-1,0]],rays=[[0,1]])
sage: P1.incidence_matrix()
[1 1 0]
[1 0 1]
[0 1 1]
sage: P2 = Polyhedron(vertices=[[1,0],[-1,0]],rays=[[0,1], [1,1]])
sage: P2.incidence_matrix()
[1 1 0]
[1 0 0]
[0 1 1]
[0 0 1]
```



---

archive/issue_comments_400749.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-22T13:35:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28406#issuecomment-400749",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400750.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-10-22T13:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28406#issuecomment-400750",
    "user": "https://github.com/LaisRast"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_400751.json:
```json
{
    "body": "I think it is good to go.",
    "created_at": "2019-10-22T13:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28406#issuecomment-400751",
    "user": "https://github.com/LaisRast"
}
```

I think it is good to go.



---

archive/issue_comments_400752.json:
```json
{
    "body": "May I suggest:\n\n```\n-        The incidence matrix does not uniquely determine\n-        an unbounded polyhedra::\n+        An incidence matrix does not determine a unique \n+        polyhedra::\n```",
    "created_at": "2019-10-24T09:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28406#issuecomment-400752",
    "user": "https://github.com/jplab"
}
```

May I suggest:

```
-        The incidence matrix does not uniquely determine
-        an unbounded polyhedra::
+        An incidence matrix does not determine a unique 
+        polyhedra::
```



---

archive/issue_comments_400753.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-10-24T09:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28406#issuecomment-400753",
    "user": "https://github.com/jplab"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_400754.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-25T09:23:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28406#issuecomment-400754",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400755.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-25T09:24:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28406#issuecomment-400755",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_400756.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-10-25T09:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28406#issuecomment-400756",
    "user": "https://github.com/LaisRast"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_400757.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-27T10:28:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28406",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28406#issuecomment-400757",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_072130.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-27T10:28:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28406",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28406#event-72130"
}
```
