# Issue 23559: Make Sage compatible with PARI stable and PARI master

archive/issues_023559.json:
```json
{
    "body": "CC:  @infinity0 @kiwifb @JohnCremona\n\nThis makes a few changes to Sage to allow it to be compatible with both PARI stable 2.9.3, as well as PARI git master.\n\nThe main change is one call to `ellwp()`, where the current PARI version returns a value which is a factor 2 too small. Interestingly, Sage compensates for this by using a wrong formula later, to get correct results anyway.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23796\n\n",
    "created_at": "2017-09-07T08:48:39Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Make Sage compatible with PARI stable and PARI master",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23559",
    "user": "@jdemeyer"
}
```
CC:  @infinity0 @kiwifb @JohnCremona

This makes a few changes to Sage to allow it to be compatible with both PARI stable 2.9.3, as well as PARI git master.

The main change is one call to `ellwp()`, where the current PARI version returns a value which is a factor 2 too small. Interestingly, Sage compensates for this by using a wrong formula later, to get correct results anyway.

Issue created by migration from https://trac.sagemath.org/ticket/23796





---

archive/issue_comments_330009.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-09-07T09:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330009",
    "user": "@kiwifb"
}
```

New commits:



---

archive/issue_comments_330010.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-09-07T09:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330010",
    "user": "@jdemeyer"
}
```

New commits:



---

archive/issue_comments_330011.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-07T09:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330011",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_330012.json:
```json
{
    "body": "Looks good to me. Passes basic tests.",
    "created_at": "2017-09-13T07:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330012",
    "user": "@kiwifb"
}
```

Looks good to me. Passes basic tests.



---

archive/issue_comments_330013.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-13T07:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330013",
    "user": "@kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_330014.json:
```json
{
    "body": "Thanks! I hope this helps.",
    "created_at": "2017-09-13T08:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330014",
    "user": "@jdemeyer"
}
```

Thanks! I hope this helps.



---

archive/issue_comments_330015.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-09-17T06:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330015",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_330016.json:
```json
{
    "body": "On 32-bit:\n\n```\nFile \"src/sage/schemes/elliptic_curves/period_lattice.py\", line 136, in sage.schemes.elliptic_curves.period_lattice._ellwp_flag1\nFailed example:\n    _ellwp_flag1(E, E((0,1)).elliptic_logarithm())\nExpected:\n    (-7.71860259319095 E-30, 2.00000000000000)\nGot:\n    (-7.71860260 E-30, 2.00000000000000)\n```\n",
    "created_at": "2017-09-17T06:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330016",
    "user": "@vbraun"
}
```

On 32-bit:

```
File "src/sage/schemes/elliptic_curves/period_lattice.py", line 136, in sage.schemes.elliptic_curves.period_lattice._ellwp_flag1
Failed example:
    _ellwp_flag1(E, E((0,1)).elliptic_logarithm())
Expected:
    (-7.71860259319095 E-30, 2.00000000000000)
Got:
    (-7.71860260 E-30, 2.00000000000000)
```




---

archive/issue_comments_330017.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-18T07:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330017",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330018.json:
```json
{
    "body": "Obvious fix.",
    "created_at": "2017-09-18T08:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330018",
    "user": "@jdemeyer"
}
```

Obvious fix.



---

archive/issue_comments_330019.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-09-18T08:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330019",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_330020.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-09-18T08:05:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330020",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_330021.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:",
    "created_at": "2017-09-18T08:05:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330021",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:



---

archive/issue_comments_330022.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-18T08:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330022",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_330023.json:
```json
{
    "body": "Pending because of upstream discussion at https://github.com/defeo/cypari2/issues/38",
    "created_at": "2017-09-19T10:27:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330023",
    "user": "@jdemeyer"
}
```

Pending because of upstream discussion at https://github.com/defeo/cypari2/issues/38



---

archive/issue_comments_330024.json:
```json
{
    "body": "OK, the `ellwp()` bug is now *also* fixed upstream in cypari2. The simplest way forward is probably to merge this ticket as-is and then revert the `ellwp()` fix in Sage when we upgrade cypari2.",
    "created_at": "2017-09-20T11:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330024",
    "user": "@jdemeyer"
}
```

OK, the `ellwp()` bug is now *also* fixed upstream in cypari2. The simplest way forward is probably to merge this ticket as-is and then revert the `ellwp()` fix in Sage when we upgrade cypari2.



---

archive/issue_comments_330025.json:
```json
{
    "body": "Because you had left the ticket on positive review Volker already included it in his current merge, we can expect it to be closed fixed in his next round of closure - unless some new problem crop up.",
    "created_at": "2017-09-20T11:05:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330025",
    "user": "@kiwifb"
}
```

Because you had left the ticket on positive review Volker already included it in his current merge, we can expect it to be closed fixed in his next round of closure - unless some new problem crop up.



---

archive/issue_comments_330026.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-20T22:26:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23559#issuecomment-330026",
    "user": "@vbraun"
}
```

Resolution: fixed
