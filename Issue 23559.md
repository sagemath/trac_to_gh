# Issue 23559: Make Sage compatible with PARI stable and PARI master

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2017-09-07 08:48:39

CC:  infinity0 fbissey cremona

This makes a few changes to Sage to allow it to be compatible with both PARI stable 2.9.3, as well as PARI git master.

The main change is one call to `ellwp()`, where the current PARI version returns a value which is a factor 2 too small. Interestingly, Sage compensates for this by using a wrong formula later, to get correct results anyway.


---

Comment by fbissey created at 2017-09-07 09:11:17

New commits:


---

Comment by jdemeyer created at 2017-09-07 09:20:00

New commits:


---

Comment by jdemeyer created at 2017-09-07 09:24:03

Changing status from new to needs_review.


---

Comment by fbissey created at 2017-09-13 07:35:29

Looks good to me. Passes basic tests.


---

Comment by fbissey created at 2017-09-13 07:35:29

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2017-09-13 08:45:56

Thanks! I hope this helps.


---

Comment by vbraun created at 2017-09-17 06:23:09

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2017-09-17 06:23:09

On 32-bit:

```
File "src/sage/schemes/elliptic_curves/period_lattice.py", line 136, in sage.schemes.elliptic_curves.period_lattice._ellwp_flag1
Failed example:
    _ellwp_flag1(E, E((0,1)).elliptic_logarithm())
Expected:
    (-7.71860259319095 E-30, 2.00000000000000)
Got:
    (-7.71860260 E-30, 2.00000000000000)
```



---

Comment by git created at 2017-09-18 07:56:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2017-09-18 08:04:59

Obvious fix.


---

Comment by jdemeyer created at 2017-09-18 08:04:59

Changing status from needs_work to positive_review.


---

Comment by git created at 2017-09-18 08:05:50

Changing status from positive_review to needs_review.


---

Comment by git created at 2017-09-18 08:05:50

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:


---

Comment by jdemeyer created at 2017-09-18 08:06:05

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2017-09-19 10:27:57

Pending because of upstream discussion at https://github.com/defeo/cypari2/issues/38


---

Comment by jdemeyer created at 2017-09-20 11:02:55

OK, the `ellwp()` bug is now _also_ fixed upstream in cypari2. The simplest way forward is probably to merge this ticket as-is and then revert the `ellwp()` fix in Sage when we upgrade cypari2.


---

Comment by fbissey created at 2017-09-20 11:05:00

Because you had left the ticket on positive review Volker already included it in his current merge, we can expect it to be closed fixed in his next round of closure - unless some new problem crop up.


---

Comment by vbraun created at 2017-09-20 22:26:33

Resolution: fixed
