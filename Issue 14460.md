# Issue 14460: Enable type1 fonts in matplotlib

Issue created by migration from https://trac.sagemath.org/ticket/14664

Original creator: ppurka

Original creation time: 2013-05-30 12:41:41

Assignee: jason, was

Essentially what the ticket title says. Some publications require all the fonts to be embedded in the document and require the use of type-1 fonts. It is not very hard to enable these fonts.


---

Comment by ppurka created at 2013-05-30 13:13:42

Changing status from new to needs_review.


---

Comment by vbraun created at 2013-05-30 13:19:22

This isn't really about type 1 fonts, right? You are switching TeXing labels on/off. How about calling it `plot(latex=bool)`. 

It would be nice if we could autodetect the prerequisites and default to the right thing.


---

Comment by ppurka created at 2013-05-30 13:32:04

It _is_ about type 1 fonts, as far as I can tell. The first thing publications tell is that type 3 fonts should not be present in the document. Some of them silently fail when you try to upload your document - the upload website just says that the upload didn't succeed.

As for references, I found these links earlier:
 * http://nerdjusttyped.blogspot.sg/2010/07/type-1-fonts-and-matplotlib-figures.html
 * http://matplotlib.1069221.n5.nabble.com/Type-1-font-in-figures-needed-td10294.html
 * http://brainlogging.wordpress.com/2011/11/16/type-1-vs-3-fonts/

_About using `latex=bool`_:
Unless someone knows that matplotlib has its own math renderer and doesn't use latex by default for rendering math, it will not be clear that something like `latex=True` will switch fonts to type 1 fonts.


---

Comment by vbraun created at 2013-05-30 13:35:30

`rcParams['text.usetex'] = False` means that you disable TeX entirely, right? Maybe we want separate `plot(usetex=<bool>, type1_fonts=<bool>)`? Or `plot(tex=[None(default)|True|False|"type1"])`?


---

Comment by ppurka created at 2013-05-30 13:40:42

`False` is the default. You can try the following in your sage installation

```
sage: from matplotlib import rcParams
sage: rcParams['text.usetex']
False
```

matplotlib [does not require latex](http://matplotlib.org/users/mathtext.html#mathtext-tutorial) to render math fonts.


---

Comment by vbraun created at 2013-05-30 13:53:42

What I'm saying is: Whether or not to use LaTeX is completely orthogonal to which fonts to use. But your patch links `type1_fonts` to both. You should be a able to use LaTeX without Type1 and the built-in renderer with Type1 fonts.


---

Comment by vbraun created at 2013-05-30 14:58:03

The following setting might be relevant:

```
sage: matplotlib.rcParams['pdf.fonttype']
3
```



---

Comment by ppurka created at 2013-05-30 17:00:38

Changing status from needs_review to needs_work.


---

Comment by ppurka created at 2013-05-30 17:00:38

Replying to [comment:6 vbraun]:
> What I'm saying is: Whether or not to use LaTeX is completely orthogonal to which fonts to use. But your patch links `type1_fonts` to both. You should be a able to use LaTeX without Type1 and the built-in renderer with Type1 fonts.
I am not sure if the latter is possible.

But you are right about decoupling latex from type1. I will make that change.


---

Comment by ppurka created at 2013-05-30 17:05:54

Replying to [comment:7 vbraun]:
> The following setting might be relevant:
> {{{
> sage: matplotlib.rcParams['pdf.fonttype']
> 3
> }}}
From an initial reading, I believe this is something completely different and is only used with the internal matplotlib tex engine.


---

Comment by ppurka created at 2013-05-30 23:35:05

I changed the option to `font_style`. It take three strings now, "type1", "latex" and "default". In my limited testing just turning on "latex" by itself gives me embedded type 1 fonts, but maybe there are cases where this is not true.


---

Comment by ppurka created at 2013-05-30 23:35:05

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2013-05-31 09:33:34

Font style means serif/sans serif. How about `typeset="latex"`?


---

Comment by ppurka created at 2013-05-31 10:39:50

Thanks. I have changed it to `typeset`.


---

Comment by vbraun created at 2013-05-31 12:18:35

I get fuzz 2 with sage-5.10.rc0


---

Comment by vbraun created at 2013-05-31 12:23:26

* can we get a ValueError if `typeset` is not one of the allowed values?
* If you change matplotlib rcParams then you should switch it back when you are finished


---

Comment by ppurka created at 2013-05-31 17:46:54

Replying to [comment:14 vbraun]:
> * can we get a ValueError if `typeset` is not one of the allowed values?

I will do that in a day or two. I need to compile 5.10rc0 first.

> * If you change matplotlib rcParams then you should switch it back when you are finished

Not resetting the rcParams actually affects only those plots which are a mixture of Sage and (direct) matplotlib calls. Currently, there is nothing in Sage that actually does this. I will make the change nevertheless because there might be someone doing this manually.


---

Comment by ppurka created at 2013-06-02 08:26:07

Updated the patch. The "default" does not mess with the settings at all now.


---

Comment by vbraun created at 2013-06-02 12:39:26

Looks good but unfortunately conflicts with #14640. The latter has already positive review, so you'll have to rebase your patch.


---

Comment by ppurka created at 2013-06-02 13:02:16

Done. Thanks.


---

Comment by vbraun created at 2013-06-02 13:14:52

You are restoring `rc_backup` before saving it; The fuzz 2 ended up inserting a hunk at the wrong place.


---

Comment by ppurka created at 2013-06-02 13:18:25

So sorry. I should have checked the git diff. Thanks for catching this.


---

Comment by ppurka created at 2013-06-02 13:26:33

Apply to devel/sage


---

Attachment

ok. Now it should be done.


---

Comment by vbraun created at 2013-06-02 13:31:36

Looks good to me


---

Comment by vbraun created at 2013-06-02 13:31:36

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-06-06 12:34:06

Resolution: fixed
