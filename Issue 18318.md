# Issue 18318: Pickling global options

Issue created by migration from Trac.

Original creator: andrew.mathas

Original creation time: 2015-05-31 05:54:27

CC:  ncohen tscrim




---

Comment by andrew.mathas created at 2015-06-03 17:09:15

Changing keywords from "" to "options".


---

Comment by andrew.mathas created at 2015-06-03 17:09:15

Changing component from PLEASE CHANGE to interfaces.


---

Comment by andrew.mathas created at 2015-06-03 17:09:15

Changing type from PLEASE CHANGE to enhancement.


---

Comment by andrew.mathas created at 2015-06-03 17:16:09

As I am cleaning this up a related question comes to mind: the name `GlobalOptions` is slightly unfortunate because instances of this class are really just options for an associated family of objects. I can sort of forgive myself for using this name for the class, but in all of the instances of this class the associated "parent" classes have a `global_options` method that points back to its options class. This method is now being enshrined more firmly inside the code because it is exploited to allow pickling. I would be happier if these methods were simply called `options`, rather than `global_options`, even though this change would necessitate deprecating the existing `global_options` methods.

Thoughts?


---

Comment by andrew.mathas created at 2015-06-03 18:19:56

New commits:


---

Comment by git created at 2016-06-26 10:58:53

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-06-26 11:48:06

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by andrew.mathas created at 2016-06-26 11:57:16

Replying to [comment:11 git]:

This was to remove 20618 from the commit tree as it shouldn't have been there...


---

Comment by tscrim created at 2016-07-02 00:58:35

Changing status from new to needs_review.


---

Comment by tscrim created at 2016-07-02 00:58:35

Okay, I fixed the doctest failures with `permutation.py`. The issue was that the `_Option` (now `Option` so it appears in the doc) did not define a `__ne__` method, and so it returned `True` for things like `opt != X` even when `opt == X`.

The other doctest failures were due to lack of conversion to `options` from `global_options`.

This is a very nice improvement over the current interface to (global) options. If the doctest pass for you and my changes are good, then you can set this to a positive review.
----
New commits:


---

Comment by tscrim created at 2016-07-02 00:58:35

Changing keywords from "options" to "days78, options".


---

Comment by git created at 2016-07-04 15:57:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-07-05 07:08:11

There's some doc issues in the `manifold.py` options: `EXAMPLES::` and everything including and after `sage: latex(f)` is over indented.


---

Comment by git created at 2016-07-05 10:17:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by andrew.mathas created at 2016-07-05 10:21:02

Thanks Travis. Fixed. I have also cleaned up the deprecation messages, putting them in the same place, so that they will be easier to remove in future.

Finally, should the `reset` method be `_reset()` or `Reset()`? Currently it is `_reset()` but it probably shouldn't be hidden.


---

Comment by tscrim created at 2016-07-06 08:18:15

`Reset()` breaks python conventions, so that is a -1 from me. I think `reset()` or `_reset()` are both fine. Yet there is not so much a good general reason to go back to defaults other than for testing purposes in my mind. Hence the hidden `_reset()` is better IMO.

One last thing, you added an `__init__` method in `interval_poset.py`. Is this necessary? If so, it needs a doctest. Once this is done, this will be at a positive review.


---

Comment by git created at 2016-07-06 11:33:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by andrew.mathas created at 2016-07-06 11:37:55

Fixed -- not sure how that got in there. Thanks Travis!


---

Comment by andrew.mathas created at 2016-07-06 11:37:55

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-07-06 19:56:35

Reviewer name is missing


---

Comment by vbraun created at 2016-07-06 19:56:35

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2016-07-06 21:04:50

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2016-07-07 19:56:52

Merge conflict, try next beta


---

Comment by vbraun created at 2016-07-07 19:56:52

Changing status from positive_review to needs_work.


---

Comment by git created at 2016-07-08 15:49:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by andrew.mathas created at 2016-07-08 15:51:01

Merged into 7.3.beta7. Tests pass.


---

Comment by andrew.mathas created at 2016-07-08 15:51:01

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2016-07-09 16:28:56

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-07-09 16:28:56

Fails on 32-bit

```
sage -t --long src/sage/structure/global_options.py
**********************************************************************
File "src/sage/structure/global_options.py", line 599, in sage.structure.global_options.Option.__hash__
Failed example:
    hash( Tableaux.options.convention ) # indirect doc-test
Expected:
    -6673246059928475433
Got:
    -1691342633
**********************************************************************
1 item had failures:
   1 of   2 in sage.structure.global_options.Option.__hash__
    [135 tests, 1 failure, 0.03 s]
```



---

Comment by tscrim created at 2016-07-09 19:04:31

This just needs to mark the different output as `# 32-bit` and `# 64-bit`, but I'd change the actual test to `hash(Tableaux.options.convention) == hash(Tableaux.options('convention')` (it also doesn't need the `# indirect doctest` marker). Sorry for not catching that sooner.


---

Comment by git created at 2016-07-11 10:59:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by andrew.mathas created at 2016-07-11 11:00:23

Changing status from needs_work to positive_review.


---

Comment by andrew.mathas created at 2016-07-11 11:00:23

Replying to [comment:27 tscrim]:
> This just needs to mark the different output as `# 32-bit` and `# 64-bit`, but I'd change the actual test to `hash(Tableaux.options.convention) == hash(Tableaux.options('convention')` (it also doesn't need the `# indirect doctest` marker). Sorry for not catching that sooner.

Thanks Travis! Fixed and changed back to a positive review.


---

Comment by vbraun created at 2016-07-12 07:25:18

Resolution: fixed
