# Issue 18318: Pickling global options

archive/issues_018318.json:
```json
{
    "body": "CC:  @nathanncohen @tscrim\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/18555\n\n",
    "created_at": "2015-05-31T05:54:27Z",
    "labels": [
        "component: please change"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "Pickling global options",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18318",
    "user": "https://github.com/AndrewAtLarge"
}
```
CC:  @nathanncohen @tscrim



Issue created by migration from https://trac.sagemath.org/ticket/18555





---

archive/issue_comments_248077.json:
```json
{
    "body": "Changing keywords from \"\" to \"options\".",
    "created_at": "2015-06-03T17:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248077",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing keywords from "" to "options".



---

archive/issue_comments_248078.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to interfaces.",
    "created_at": "2015-06-03T17:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248078",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing component from PLEASE CHANGE to interfaces.



---

archive/issue_comments_248079.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2015-06-03T17:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248079",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_248080.json:
```json
{
    "body": "As I am cleaning this up a related question comes to mind: the name `GlobalOptions` is slightly unfortunate because instances of this class are really just options for an associated family of objects. I can sort of forgive myself for using this name for the class, but in all of the instances of this class the associated \"parent\" classes have a `global_options` method that points back to its options class. This method is now being enshrined more firmly inside the code because it is exploited to allow pickling. I would be happier if these methods were simply called `options`, rather than `global_options`, even though this change would necessitate deprecating the existing `global_options` methods.\n\nThoughts?",
    "created_at": "2015-06-03T17:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248080",
    "user": "https://github.com/AndrewAtLarge"
}
```

As I am cleaning this up a related question comes to mind: the name `GlobalOptions` is slightly unfortunate because instances of this class are really just options for an associated family of objects. I can sort of forgive myself for using this name for the class, but in all of the instances of this class the associated "parent" classes have a `global_options` method that points back to its options class. This method is now being enshrined more firmly inside the code because it is exploited to allow pickling. I would be happier if these methods were simply called `options`, rather than `global_options`, even though this change would necessitate deprecating the existing `global_options` methods.

Thoughts?



---

archive/issue_comments_248081.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-06-03T18:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248081",
    "user": "https://github.com/AndrewAtLarge"
}
```

New commits:



---

archive/issue_comments_248082.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-06-26T10:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248082",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_248083.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-06-26T11:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248083",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_248084.json:
```json
{
    "body": "Replying to [comment:11 git]:\n\nThis was to remove 20618 from the commit tree as it shouldn't have been there...",
    "created_at": "2016-06-26T11:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248084",
    "user": "https://github.com/AndrewAtLarge"
}
```

Replying to [comment:11 git]:

This was to remove 20618 from the commit tree as it shouldn't have been there...



---

archive/issue_comments_248085.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-07-02T00:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248085",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_248086.json:
```json
{
    "body": "Okay, I fixed the doctest failures with `permutation.py`. The issue was that the `_Option` (now `Option` so it appears in the doc) did not define a `__ne__` method, and so it returned `True` for things like `opt != X` even when `opt == X`.\n\nThe other doctest failures were due to lack of conversion to `options` from `global_options`.\n\nThis is a very nice improvement over the current interface to (global) options. If the doctest pass for you and my changes are good, then you can set this to a positive review.\n----\nNew commits:",
    "created_at": "2016-07-02T00:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248086",
    "user": "https://github.com/tscrim"
}
```

Okay, I fixed the doctest failures with `permutation.py`. The issue was that the `_Option` (now `Option` so it appears in the doc) did not define a `__ne__` method, and so it returned `True` for things like `opt != X` even when `opt == X`.

The other doctest failures were due to lack of conversion to `options` from `global_options`.

This is a very nice improvement over the current interface to (global) options. If the doctest pass for you and my changes are good, then you can set this to a positive review.
----
New commits:



---

archive/issue_comments_248087.json:
```json
{
    "body": "Changing keywords from \"options\" to \"days78, options\".",
    "created_at": "2016-07-02T00:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248087",
    "user": "https://github.com/tscrim"
}
```

Changing keywords from "options" to "days78, options".



---

archive/issue_comments_248088.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-04T15:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248088",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248089.json:
```json
{
    "body": "There's some doc issues in the `manifold.py` options: `EXAMPLES::` and everything including and after `sage: latex(f)` is over indented.",
    "created_at": "2016-07-05T07:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248089",
    "user": "https://github.com/tscrim"
}
```

There's some doc issues in the `manifold.py` options: `EXAMPLES::` and everything including and after `sage: latex(f)` is over indented.



---

archive/issue_comments_248090.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-05T10:17:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248090",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248091.json:
```json
{
    "body": "Thanks Travis. Fixed. I have also cleaned up the deprecation messages, putting them in the same place, so that they will be easier to remove in future.\n\nFinally, should the `reset` method be `_reset()` or `Reset()`? Currently it is `_reset()` but it probably shouldn't be hidden.",
    "created_at": "2016-07-05T10:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248091",
    "user": "https://github.com/AndrewAtLarge"
}
```

Thanks Travis. Fixed. I have also cleaned up the deprecation messages, putting them in the same place, so that they will be easier to remove in future.

Finally, should the `reset` method be `_reset()` or `Reset()`? Currently it is `_reset()` but it probably shouldn't be hidden.



---

archive/issue_comments_248092.json:
```json
{
    "body": "`Reset()` breaks python conventions, so that is a -1 from me. I think `reset()` or `_reset()` are both fine. Yet there is not so much a good general reason to go back to defaults other than for testing purposes in my mind. Hence the hidden `_reset()` is better IMO.\n\nOne last thing, you added an `__init__` method in `interval_poset.py`. Is this necessary? If so, it needs a doctest. Once this is done, this will be at a positive review.",
    "created_at": "2016-07-06T08:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248092",
    "user": "https://github.com/tscrim"
}
```

`Reset()` breaks python conventions, so that is a -1 from me. I think `reset()` or `_reset()` are both fine. Yet there is not so much a good general reason to go back to defaults other than for testing purposes in my mind. Hence the hidden `_reset()` is better IMO.

One last thing, you added an `__init__` method in `interval_poset.py`. Is this necessary? If so, it needs a doctest. Once this is done, this will be at a positive review.



---

archive/issue_comments_248093.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-06T11:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248093",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248094.json:
```json
{
    "body": "Fixed -- not sure how that got in there. Thanks Travis!",
    "created_at": "2016-07-06T11:37:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248094",
    "user": "https://github.com/AndrewAtLarge"
}
```

Fixed -- not sure how that got in there. Thanks Travis!



---

archive/issue_comments_248095.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-07-06T11:37:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248095",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_248096.json:
```json
{
    "body": "Reviewer name is missing",
    "created_at": "2016-07-06T19:56:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248096",
    "user": "https://github.com/vbraun"
}
```

Reviewer name is missing



---

archive/issue_comments_248097.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-07-06T19:56:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248097",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_248098.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-07-06T21:04:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248098",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_248099.json:
```json
{
    "body": "Merge conflict, try next beta",
    "created_at": "2016-07-07T19:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248099",
    "user": "https://github.com/vbraun"
}
```

Merge conflict, try next beta



---

archive/issue_comments_248100.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-07-07T19:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248100",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_248101.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-08T15:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248101",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248102.json:
```json
{
    "body": "Merged into 7.3.beta7. Tests pass.",
    "created_at": "2016-07-08T15:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248102",
    "user": "https://github.com/AndrewAtLarge"
}
```

Merged into 7.3.beta7. Tests pass.



---

archive/issue_comments_248103.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-07-08T15:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248103",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_248104.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-07-09T16:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248104",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_248105.json:
```json
{
    "body": "Fails on 32-bit\n\n```\nsage -t --long src/sage/structure/global_options.py\n**********************************************************************\nFile \"src/sage/structure/global_options.py\", line 599, in sage.structure.global_options.Option.__hash__\nFailed example:\n    hash( Tableaux.options.convention ) # indirect doc-test\nExpected:\n    -6673246059928475433\nGot:\n    -1691342633\n**********************************************************************\n1 item had failures:\n   1 of   2 in sage.structure.global_options.Option.__hash__\n    [135 tests, 1 failure, 0.03 s]\n```\n",
    "created_at": "2016-07-09T16:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248105",
    "user": "https://github.com/vbraun"
}
```

Fails on 32-bit

```
sage -t --long src/sage/structure/global_options.py
**********************************************************************
File "src/sage/structure/global_options.py", line 599, in sage.structure.global_options.Option.__hash__
Failed example:
    hash( Tableaux.options.convention ) # indirect doc-test
Expected:
    -6673246059928475433
Got:
    -1691342633
**********************************************************************
1 item had failures:
   1 of   2 in sage.structure.global_options.Option.__hash__
    [135 tests, 1 failure, 0.03 s]
```




---

archive/issue_comments_248106.json:
```json
{
    "body": "This just needs to mark the different output as `# 32-bit` and `# 64-bit`, but I'd change the actual test to `hash(Tableaux.options.convention) == hash(Tableaux.options('convention')` (it also doesn't need the `# indirect doctest` marker). Sorry for not catching that sooner.",
    "created_at": "2016-07-09T19:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248106",
    "user": "https://github.com/tscrim"
}
```

This just needs to mark the different output as `# 32-bit` and `# 64-bit`, but I'd change the actual test to `hash(Tableaux.options.convention) == hash(Tableaux.options('convention')` (it also doesn't need the `# indirect doctest` marker). Sorry for not catching that sooner.



---

archive/issue_comments_248107.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-11T10:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248107",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248108.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-07-11T11:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248108",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_248109.json:
```json
{
    "body": "Replying to [comment:27 tscrim]:\n> This just needs to mark the different output as `# 32-bit` and `# 64-bit`, but I'd change the actual test to `hash(Tableaux.options.convention) == hash(Tableaux.options('convention')` (it also doesn't need the `# indirect doctest` marker). Sorry for not catching that sooner.\n\nThanks Travis! Fixed and changed back to a positive review.",
    "created_at": "2016-07-11T11:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248109",
    "user": "https://github.com/AndrewAtLarge"
}
```

Replying to [comment:27 tscrim]:
> This just needs to mark the different output as `# 32-bit` and `# 64-bit`, but I'd change the actual test to `hash(Tableaux.options.convention) == hash(Tableaux.options('convention')` (it also doesn't need the `# indirect doctest` marker). Sorry for not catching that sooner.

Thanks Travis! Fixed and changed back to a positive review.



---

archive/issue_comments_248110.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-07-12T07:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18318#issuecomment-248110",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
