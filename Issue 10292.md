# Issue 10292: sage -startuptime is broken

Issue created by migration from https://trac.sagemath.org/ticket/10293

Original creator: jdemeyer

Original creation time: 2010-11-20 08:42:01

Assignee: jason

Keywords: startuptime new_import exception

Since sage-4.6.1.alpha2, `sage -startuptime` doesn't work anymore:

```
$ ./sage -startuptime
Traceback (most recent call last):
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 46, in <module>
    from sage.all import *
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python2.6/site-packages/sage/all.py", line 99, in <module>
    from sage.server.all     import *
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python2.6/site-packages/sage/server/all.py", line 2, in <module>
    from notebook.all import *
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python2.6/site-packages/sage/server/notebook/all.py", line 22, in <module>
    from sagenb.notebook.all import *
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/devel/sagenb/sagenb/notebook/all.py", line 16, in <module>
    from notebook_object import notebook, inotebook
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/devel/sagenb/sagenb/notebook/notebook_object.py", line 17, in <module>
    import notebook as _notebook
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/devel/sagenb/sagenb/notebook/notebook.py", line 39, in <module>
    import css          # style
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/devel/sagenb/sagenb/notebook/css.py", line 17, in <module>
    from sagenb.notebook.template import template
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/devel/sagenb/sagenb/notebook/template.py", line 18, in <module>
    import jinja2
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python2.6/site-packages/Jinja2-2.5.5-py2.6.egg/jinja2/__init__.py", line 45, in <module>
    from jinja2.bccache import BytecodeCache, FileSystemBytecodeCache, \
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/bin/sage-startuptime.py", line 35, in new_import
    module = old_import(name, globals, locals, fromlist)
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python2.6/site-packages/Jinja2-2.5.5-py2.6.egg/jinja2/bccache.py", line 31, in <module>
    bc_magic = 'j2'.encode('ascii') + pickle.dumps(bc_version, 2)
  File "/home/jdemeyer/sage-4.6.1.alpha2/local/lib/python/encodings/__init__.py", line 100, in search_function
    level=0)
TypeError: new_import() got an unexpected keyword argument 'level'
```



---

Attachment

That should fix it.


---

Comment by mhansen created at 2010-11-20 17:47:06

Changing status from new to needs_review.


---

Comment by fbissey created at 2010-11-20 21:03:41

The patch works for me. linux x86 (sage-on-gentoo really).


---

Comment by jdemeyer created at 2010-11-20 21:10:33

I'm impressed.  A patch for a ticket that I did not announce for a Sage version which is not released :-)


---

Comment by fbissey created at 2010-11-20 21:18:58

Replying to [comment:3 jdemeyer]:
> I'm impressed.  A patch for a ticket that I did not announce for a Sage version which is not released :-)

well you started to merge patch in alpha3 didn't you? ebuild for alpha2 have been updated yesterday and announced on the gentoo-science mailing list for your info.


---

Comment by jdemeyer created at 2010-11-20 21:22:13

Replying to [comment:4 fbissey]:
> well you started to merge patch in alpha3 didn't you? ebuild for alpha2 have been updated yesterday and announced on the gentoo-science mailing list for your info. 

I have merged patch (I assume you are referring to #9418) in sage-4.6.1.alpha*2* which is not yet released.  In fact, I am changing it now by adding the patch on this ticket.


---

Comment by fbissey created at 2010-11-20 21:30:05

Replying to [comment:6 jdemeyer]:
> Replying to [comment:4 fbissey]:
> > well you started to merge patch in alpha3 didn't you? ebuild for alpha2 have been updated yesterday and announced on the gentoo-science mailing list for your info. 
> 
> I have merged patch (I assume you are referring to #9418) in sage-4.6.1.alpha*2* which is not yet released.  In fact, I am changing it now by adding the patch on this ticket.

That's going off topic, but technically for sage-on-gentoo I don't really care
that you merged a package like patch. That 0 impact on us. Do something in sage,
sage_scripts and so on and that will have an impact.
If you are including this in alpha2 I will just have to update the manifest.


---

Comment by fbissey created at 2010-11-21 08:40:11

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2010-11-21 08:40:11

Tried the latest alpha2 with this ticket included, it still works so I am giving it a positive review.


---

Comment by jdemeyer created at 2010-11-21 08:56:36

Resolution: fixed
