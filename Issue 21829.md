# Issue 21829: implement MacMahon's Omega operator

Issue created by migration from Trac.

Original creator: dkrenn

Original creation time: 2016-12-16 08:18:29

CC:  cheuberg

MacMahon's Omega operator takes a quotient of laurent polynomials and removes all negative exponents in the corresponding power series.

The aim of this ticket is to implement it.


---

Comment by git created at 2016-12-16 08:38:40

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2016-12-16 09:55:53

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by dkrenn created at 2016-12-16 09:56:21

Changing status from new to needs_review.


---

Comment by chapoton created at 2016-12-16 09:59:51

see also #10669


---

Comment by git created at 2016-12-16 10:03:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-12-16 10:12:30

Replying to [comment:8 chapoton]:
> see also #10669

Thank you for mentioning this. (I have never thought anyone already created a ticket for this.) ;)


---

Comment by cheuberg created at 2016-12-19 13:57:20

Removed duplicate dependency #21833


---

Comment by git created at 2016-12-22 08:25:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-12-22 08:28:48

Merged in changed dependencies.


---

Comment by git created at 2016-12-26 17:35:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2017-01-02 19:19:46

This is a review of this ticket modulo its dependencies.

General:

1. I am not happy to have `Omega` in the global name space. There might be other uses of the upper case greek letter Omega which might as well live in the global name space, e.g., in context with asymptotics. Thus I suggest to have it as `MacMahonOmega` or something like that, perhaps with an alias in the docstring.

2. Is there a reason why some of the auxiliary functions are visible and some others are hidden (e.g., for #22067?). In that case, I suggest to have one example in the module documentation which demonstrates how to use `Omega` and perhaps one other example there which demonstrates how to use the other functions efficiently.

3. I think that "laurent" should be capitalized throughout, cf. [the Wikipedia article](https://en.wikipedia.org/wiki/Laurent_polynomial).

4. Nowadays, the developers guide wants us to store all bibliographical references in `SAGE_ROOT/src/doc/en/reference/references/index.rst`.

5. Long descriptions in docstrings: The developer guide does not give clear indications; nevertheless, I suggest to use the same command form as in the short description block above. Otherwise, it seems to be strange to have "Return ..." ... "this calculates".

Function `Omega`:

6. `expression` is allowed to be a `Factorization` (as per the Tests), but this is not documented.

7. Add examples demonstrating all allowed input variants (`expression` only, without denominator; `denominator` as a non-factorized Polynomial); perhaps use a simple example to demonstrate all useful variations.

8. There are two consecutive lines of imports from `sage.rings.polynomial.laurent_polynomial_ring` which could be done in one import; the second line is too long anyway

9. Document and test `NotImplementedError` for `op != operator.ge`.

10. Test `ValueError` for `not denominator.is_integral()`.

11. The line `numerator *= denominator.unit()` seems to be suspicious. Shouldn't it be `/=`?

12. Test `ValueError` "... is not a variable".

13. Test `ZeroDivisionError`

14. Test `NotImplementedError` "... is not normalized"

15. Test `NotImplementedError` "Cannot handle factor"

Function `_Omega_`:

16. Although main testing is done in `Omega`, it would be nice to have one non-trivial example to see how the input and output looks like.

Function `Omega_ge`:

17. State in docstring that `z_1`, ..., `z_n` do _not_ appear in the input, but _do_ appear in the output.

18. State the parent of the output in the docstring (The function `_Omega_` uses the fact that the parent does _not_ depend on `a` and uses a specific order of the variables)

19. Is there a reason not to use `CyclotomicField`?

20. Is there a reason to actually give the number of variables in `LaurentPolynomialRing`?

21. `subs_power`: this is never called with `value != None` but is only documented with `value != None`. Thus remove the parameter `value` and adapt documentation.

22. `subs_power`: The line `p = tuple(var.dict().popitem()[0]).index(1)` is rather hard to understand, document that this actually just means that `var` is the `p`th generator of the parent.

23. `subs_power`: also state that it is assumed that `var` only occurs with exponents divisible by `exponent`

Function `Omega_numerator`:

24. Document that the numerator is normalized in such a way that the corresponding denominator has constant term 1.

25. In `Omega_numerator` it is not clear why the input is not assumed to be flattened beforehand. Add a pointer to `Omega_denumerator`.

Function `_Omega_numerator_P`:

26. When reading [APR2001] one would assume that `_Omega_numerator_P_` should be a cached function. I assume that performance tuning showed that this does not help. Document this.

27. Add a meaningful description; currently, one must find out that these are the polynomials `P` in [APR2001].

28. The last component of the input `x` is never used; `t` is used instead. Consider removing the last component of `x`. Explain the situation.

Function `Omega_factors_denominator`:

29. Document that the denominator is normalized such that it has constant term 1 (cf. 24)

30. The implicit assumption is that the `x` and `y` are collected in such a way that one entry of `x` corresponds to the orbit of some `x_j` under multiplication by `d`th roots of unity and that the output is collected in a corresponding way.

Function `partition`:

31. Perhaps use an "ALGORITHM" block for the link to the source code.

Function `homogeneous_symmetric_function`:

32. Give definition (or a link to a definition) of homogeneous symmetric polynomials

33. "whose type is determined by the input `x`": what does this mean?


---

Comment by cheuberg created at 2017-01-02 19:19:46

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-01-04 08:24:58

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2017-01-04 17:47:36

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2017-01-04 17:49:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-01-04 17:50:20

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dkrenn created at 2017-01-04 17:52:04

Last 10 new commits:


---

Comment by git created at 2017-01-04 18:04:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2017-01-04 18:09:40

I've addressed all issues mentioned earlier; comments below.

Replying to [comment:15 cheuberg]:
> 1. I am not happy to have `Omega` in the global name space. There might be other uses of the upper case greek letter Omega which might as well live in the global name space, e.g., in context with asymptotics. Thus I suggest to have it as `MacMahonOmega` or something like that, perhaps with an alias in the docstring.

Changed to MacMahonOmega everywhere.

> 2. Is there a reason why some of the auxiliary functions are visible and some others are hidden (e.g., for #22067?). In that case, I suggest to have one example in the module documentation which demonstrates how to use `Omega` and perhaps one other example there which demonstrates how to use the other functions efficiently.

I am not sure here, what should be hidden and what not. The idea was, hide everything that for sure is a helper function. But I guess in some sense everything except for the main function is a helper somehow.
Any suggestions how to proceed?

> 4. Nowadays, the developers guide wants us to store all bibliographical references in `SAGE_ROOT/src/doc/en/reference/references/index.rst`.

Done, but my docs are still compiling (had to do `make doc-clean` as the references were not recognized...). I comment when I have a pass.

> 20. Is there a reason to actually give the number of variables in `LaurentPolynomialRing`?

Yes, so that the univariate polynomial ring is represented as multi-variate ring as well.


---

Comment by git created at 2017-01-05 09:11:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2017-01-05 09:12:55

Changing status from needs_work to needs_review.


---

Comment by dkrenn created at 2017-01-05 09:12:55

Replying to [comment:23 dkrenn]:
> > 2. Is there a reason why some of the auxiliary functions are visible and some others are hidden (e.g., for #22067?). In that case, I suggest to have one example in the module documentation which demonstrates how to use `Omega` and perhaps one other example there which demonstrates how to use the other functions efficiently.
> 
> I am not sure here, what should be hidden and what not. The idea was, hide everything that for sure is a helper function. But I guess in some sense everything except for the main function is a helper somehow.
> Any suggestions how to proceed?

Now I've added an example at the top to show what MacMahon's Omega does and how it is applied.

> > 4. Nowadays, the developers guide wants us to store all bibliographical references in `SAGE_ROOT/src/doc/en/reference/references/index.rst`.
> 
> Done, but my docs are still compiling (had to do `make doc-clean` as the references were not recognized...). I comment when I have a pass.

Passed.


---

Comment by git created at 2017-01-05 13:52:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2017-01-05 13:58:03

Replying to [comment:15 cheuberg]:
> 2. Is there a reason why some of the auxiliary functions are visible and some others are hidden (e.g., for #22067?). In that case, I suggest to have one example in the module documentation which demonstrates how to use `Omega` and perhaps one other example there which demonstrates how to use the other functions efficiently.

are we sure that the interface for the low level functions will remain stable?

> Function `Omega`:
> 
> 7. Add examples demonstrating all allowed input variants (`expression` only, without denominator; `denominator` as a non-factorized Polynomial); perhaps use a simple example to demonstrate all useful variations.


```
sage: MacMahonOmega(mu, mu^2, (1 - x*mu)*(1 - y/mu))
Traceback (most recent call last):
...
TypeError: unable to factor n
```

seems to be a strange error message (What is "n"?)

> 14. Test `NotImplementedError` "... is not normalized"

I think that the documentation should clearly state how the denominator must be factored.

34. I am not happy that `MacMahonOmega(mu, mu^2 / ((1 - x*mu)*(1 - y/mu)))` does not work. This implies that the input method "expression – an element of the quotient field of some Laurent polynomials" only works in trivial cases. After all, just entering a rational function would be the most natural input format.

35. What happens if the input is formulated in terms of polynomial rings instead of Laurent polynomial rings?


---

Comment by cheuberg created at 2017-01-05 15:01:38

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-01-05 16:03:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2017-01-05 16:04:00

Replying to [comment:26 cheuberg]:
> Branch changed from u/dkrenn/omega-7.5.rc1 to u/cheuberg/omega-7.5.rc1

Cross-reviewed (LGTM)


---

Comment by dkrenn created at 2017-01-05 16:07:44

Replying to [comment:28 cheuberg]:
> Replying to [comment:15 cheuberg]:
> are we sure that the interface for the low level functions will remain stable?

`Omega_numerator` and `Omega_factors_denominator` are now private.

> {{{
> sage: MacMahonOmega(mu, mu^2, (1 - x*mu)*(1 - y/mu))
> Traceback (most recent call last):
> ...
> TypeError: unable to factor n
> }}}
> seems to be a strange error message (What is "n"?)

This is hardcoded in `factor` and appears as Laurent polynomials have not method `factor`.

> > 14. Test `NotImplementedError` "... is not normalized"
> 
> I think that the documentation should clearly state how the denominator must be factored.
> 
> 34. I am not happy that `MacMahonOmega(mu, mu^2 / ((1 - x*mu)*(1 - y/mu)))` does not work. This implies that the input method "expression – an element of the quotient field of some Laurent polynomials" only works in trivial cases. After all, just entering a rational function would be the most natural input format.
> 
> 35. What happens if the input is formulated in terms of polynomial rings instead of Laurent polynomial rings?  

I've removed inputing a quotient from the docs as it is not functioning correctly in some cases. (Refactoring one of the factors in the denominator is not trivial and may change the result. To come around this, one has to know something on the coefficients of a factor; this should all go to a follow-up ticket.)


---

Comment by dkrenn created at 2017-01-05 16:07:52

Changing status from needs_work to needs_review.


---

Comment by cheuberg created at 2017-01-12 10:22:06

Changing status from needs_review to positive_review.


---

Comment by cheuberg created at 2017-01-12 10:22:06

ok. Dependencies are rather orthogonal to this ticket, so I set this one to positive. At some stage, it might be good to implement other algorithms (cf. #10669) and to compare speed.


---

Comment by git created at 2017-02-09 09:23:23

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2017-02-09 09:23:23

Changing status from positive_review to needs_review.


---

Comment by dkrenn created at 2017-02-09 09:24:22

Merged in #21976 (and thus 7.6.beta2) to make this patch work again.


---

Comment by dkrenn created at 2017-02-09 09:25:08

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-03-02 14:49:09

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2017-03-02 14:49:09

Needs another rebasing.


---

Comment by git created at 2017-03-02 14:58:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2017-03-02 14:59:41

Replying to [comment:39 tscrim]:
> Needs another rebasing.

Merged in dependency #21976. Once the patchbot is happy, this can be positive again.


---

Comment by dkrenn created at 2017-03-02 14:59:41

Changing status from needs_work to needs_review.


---

Comment by dkrenn created at 2017-03-03 07:44:35

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-03-05 15:13:50

Resolution: fixed
