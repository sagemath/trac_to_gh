# Issue 30427: Fixup for "Add quiet mode for bootstrap"

archive/issues_030427.json:
```json
{
    "body": "CC:  @orlitzky @vbraun\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/30664\n\n",
    "created_at": "2020-09-25T15:57:51Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Fixup for \"Add quiet mode for bootstrap\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30427",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @orlitzky @vbraun



Issue created by migration from https://trac.sagemath.org/ticket/30664





---

archive/issue_comments_433531.json:
```json
{
    "body": "I can just change it back to using `#!/usr/bin/env bash`...",
    "created_at": "2020-09-25T16:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30427#issuecomment-433531",
    "user": "https://github.com/mkoeppe"
}
```

I can just change it back to using `#!/usr/bin/env bash`...



---

archive/issue_comments_433532.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-25T16:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30427#issuecomment-433532",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_433533.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-09-25T16:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30427#issuecomment-433533",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_433534.json:
```json
{
    "body": "What error did you see with `./bootstrap`? I tested it with every shell available to me, in a clean tree (after `git clean -x -f -d`).\n\nProbably related: those two occurrences of `source` should be `.` instead. And we should be doing `test -f <file> && . <file>` instead of `2>/dev/null` so that we don't hide other, unexpected errors.",
    "created_at": "2020-09-25T17:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30427#issuecomment-433534",
    "user": "https://github.com/orlitzky"
}
```

What error did you see with `./bootstrap`? I tested it with every shell available to me, in a clean tree (after `git clean -x -f -d`).

Probably related: those two occurrences of `source` should be `.` instead. And we should be doing `test -f <file> && . <file>` instead of `2>/dev/null` so that we don't hide other, unexpected errors.



---

archive/issue_comments_433535.json:
```json
{
    "body": "It just stops silently when trying to `source` the non-existing `src/bin/sage-env-config`.\n\n```\n$ ./bootstrap  -d\nrm -rf config configure build/make/Makefile-auto.in\nrm -f src/doc/en/installation/*.txt\nrm -rf src/doc/en/reference/spkg/*.rst\nrm -f src/doc/en/reference/repl/*.txt\n```\n",
    "created_at": "2020-09-25T17:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30427#issuecomment-433535",
    "user": "https://github.com/mkoeppe"
}
```

It just stops silently when trying to `source` the non-existing `src/bin/sage-env-config`.

```
$ ./bootstrap  -d
rm -rf config configure build/make/Makefile-auto.in
rm -f src/doc/en/installation/*.txt
rm -rf src/doc/en/reference/spkg/*.rst
rm -f src/doc/en/reference/repl/*.txt
```




---

archive/issue_comments_433536.json:
```json
{
    "body": "I can't reproduce that with dash, bash, ksh, zsh, or posh. If you drop the `2>/dev/null`, what goes wrong? (What shell are you using?)\n\nThe `source` is a bashism so I would think it fails there, but I don't know why it wouldn't proceed. In any case, changing those lines to `-f <file> && . <file>` will avoid the failure.",
    "created_at": "2020-09-25T18:43:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30427#issuecomment-433536",
    "user": "https://github.com/orlitzky"
}
```

I can't reproduce that with dash, bash, ksh, zsh, or posh. If you drop the `2>/dev/null`, what goes wrong? (What shell are you using?)

The `source` is a bashism so I would think it fails there, but I don't know why it wouldn't proceed. In any case, changing those lines to `-f <file> && . <file>` will avoid the failure.



---

archive/issue_comments_433537.json:
```json
{
    "body": "I observed it both locally on macOS, and in `tox -e docker-conda-forge-ubuntu-standard`.",
    "created_at": "2020-09-25T18:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30427#issuecomment-433537",
    "user": "https://github.com/mkoeppe"
}
```

I observed it both locally on macOS, and in `tox -e docker-conda-forge-ubuntu-standard`.



---

archive/issue_comments_433538.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-09-25T18:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30427#issuecomment-433538",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_433539.json:
```json
{
    "body": "I can't explain this, but when my `/bin/sh` points to `/bin/zsh` and I run the bootstrap script, it fails. If I run `zsh ./bootstrap -d` instead, it works fine -- so whatever I was doing to test was flawed. At first I thought zsh was looking at the shebang and re-executing the script with `/bin/sh`... but `/bin/sh` is still zsh!\n\nWhatever is happening there, your branch fixes the problem. Look good on your end too?",
    "created_at": "2020-09-25T19:00:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30427#issuecomment-433539",
    "user": "https://github.com/orlitzky"
}
```

I can't explain this, but when my `/bin/sh` points to `/bin/zsh` and I run the bootstrap script, it fails. If I run `zsh ./bootstrap -d` instead, it works fine -- so whatever I was doing to test was flawed. At first I thought zsh was looking at the shebang and re-executing the script with `/bin/sh`... but `/bin/sh` is still zsh!

Whatever is happening there, your branch fixes the problem. Look good on your end too?



---

archive/issue_comments_433540.json:
```json
{
    "body": "Often $0=sh enables posixisms. bash does the same.",
    "created_at": "2020-09-25T19:01:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30427#issuecomment-433540",
    "user": "https://github.com/mkoeppe"
}
```

Often $0=sh enables posixisms. bash does the same.



---

archive/issue_comments_433541.json:
```json
{
    "body": "Yes, it works for me with this change, on both platforms",
    "created_at": "2020-09-25T19:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30427#issuecomment-433541",
    "user": "https://github.com/mkoeppe"
}
```

Yes, it works for me with this change, on both platforms



---

archive/issue_comments_433542.json:
```json
{
    "body": "Ok, thanks. I'm still not sure why zsh handles that one `set -e` differently. I went back and re-tested the others, all as `/bin/sh`. More important things to worry about.",
    "created_at": "2020-09-25T19:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30427#issuecomment-433542",
    "user": "https://github.com/orlitzky"
}
```

Ok, thanks. I'm still not sure why zsh handles that one `set -e` differently. I went back and re-tested the others, all as `/bin/sh`. More important things to worry about.



---

archive/issue_comments_433543.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-25T19:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30427#issuecomment-433543",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_433544.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-09-25T19:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30427#issuecomment-433544",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_events_027955.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2020-09-30T22:30:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30427#event-27955"
}
```



---

archive/issue_comments_433545.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-30T22:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30427#issuecomment-433545",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_433546.json:
```json
{
    "body": "Is there are make target to remove `src/bin/sage-env-config` without running `./boostrap` ?\nI could not find one, and this is a problem - `./bootstrap` can fail on a stale `sage-env-config`.",
    "created_at": "2020-10-19T12:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30427#issuecomment-433546",
    "user": "https://github.com/dimpase"
}
```

Is there are make target to remove `src/bin/sage-env-config` without running `./boostrap` ?
I could not find one, and this is a problem - `./bootstrap` can fail on a stale `sage-env-config`.



---

archive/issue_comments_433547.json:
```json
{
    "body": "please see #30795 for a followup",
    "created_at": "2020-10-19T12:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30427",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30427#issuecomment-433547",
    "user": "https://github.com/dimpase"
}
```

please see #30795 for a followup
