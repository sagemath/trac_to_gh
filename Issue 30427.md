# Issue 30427: Fixup for "Add quiet mode for bootstrap"

Issue created by migration from https://trac.sagemath.org/ticket/30664

Original creator: mkoeppe

Original creation time: 2020-09-25 15:57:51

CC:  mjo vbraun




---

Comment by mkoeppe created at 2020-09-25 16:03:50

I can just change it back to using `#!/usr/bin/env bash`...


---

Comment by mkoeppe created at 2020-09-25 16:07:14

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-09-25 16:07:14

New commits:


---

Comment by mjo created at 2020-09-25 17:30:00

What error did you see with `./bootstrap`? I tested it with every shell available to me, in a clean tree (after `git clean -x -f -d`).

Probably related: those two occurrences of `source` should be `.` instead. And we should be doing `test -f <file> && . <file>` instead of `2>/dev/null` so that we don't hide other, unexpected errors.


---

Comment by mkoeppe created at 2020-09-25 17:32:51

It just stops silently when trying to `source` the non-existing `src/bin/sage-env-config`.

```
$ ./bootstrap  -d
rm -rf config configure build/make/Makefile-auto.in
rm -f src/doc/en/installation/*.txt
rm -rf src/doc/en/reference/spkg/*.rst
rm -f src/doc/en/reference/repl/*.txt
```



---

Comment by mjo created at 2020-09-25 18:43:45

I can't reproduce that with dash, bash, ksh, zsh, or posh. If you drop the `2>/dev/null`, what goes wrong? (What shell are you using?)

The `source` is a bashism so I would think it fails there, but I don't know why it wouldn't proceed. In any case, changing those lines to `-f <file> && . <file>` will avoid the failure.


---

Comment by mkoeppe created at 2020-09-25 18:47:13

I observed it both locally on macOS, and in `tox -e docker-conda-forge-ubuntu-standard`.


---

Comment by git created at 2020-09-25 18:48:25

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mjo created at 2020-09-25 19:00:30

I can't explain this, but when my `/bin/sh` points to `/bin/zsh` and I run the bootstrap script, it fails. If I run `zsh ./bootstrap -d` instead, it works fine -- so whatever I was doing to test was flawed. At first I thought zsh was looking at the shebang and re-executing the script with `/bin/sh`... but `/bin/sh` is still zsh!

Whatever is happening there, your branch fixes the problem. Look good on your end too?


---

Comment by mkoeppe created at 2020-09-25 19:01:55

Often $0=sh enables posixisms. bash does the same.


---

Comment by mkoeppe created at 2020-09-25 19:21:48

Yes, it works for me with this change, on both platforms


---

Comment by mjo created at 2020-09-25 19:27:29

Ok, thanks. I'm still not sure why zsh handles that one `set -e` differently. I went back and re-tested the others, all as `/bin/sh`. More important things to worry about.


---

Comment by mjo created at 2020-09-25 19:27:29

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-09-25 19:47:37

Thanks!


---

Comment by vbraun created at 2020-09-30 22:30:16

Resolution: fixed


---

Comment by dimpase created at 2020-10-19 12:21:11

Is there are make target to remove `src/bin/sage-env-config` without running `./boostrap` ?
I could not find one, and this is a problem - `./bootstrap` can fail on a stale `sage-env-config`.


---

Comment by dimpase created at 2020-10-19 12:47:18

please see #30795 for a followup
