# Issue 17401: Division of polynomials produces errors when using local orderings

Issue created by migration from https://trac.sagemath.org/ticket/17638

Original creator: enriqueartal

Original creation time: 2015-01-15 18:13:34

CC:  simonking jakobkroeker slelievre

Consider two polynomials f,g in a ring define using a local ordering, e.g.,

R.<x,y>=PolynomialRing(QQ,order='neglex')

If the leading monomial of g is 1 then f/g will produces a wrong result, namely f divided by the independent coefficient of g. Note that in that case g.is_unit() yields True, since for Singular R is not Q[x,y] but the ordering localization (i.e., one can divide by the polynomials whose leading monomial is 1).

PS: It is my first ticket, I apologize for the mistakes.


---

Comment by SimonKing created at 2015-07-14 07:21:00

Changing component from algebraic geometry to commutative algebra.


---

Comment by SimonKing created at 2015-07-14 07:23:45

Example:

```
sage: R.<x,y>=PolynomialRing(QQ,order='neglex')
sage: f = 1+y
sage: g = 1+x
sage: f/g
1 + y
sage: _*g==f
False
```



---

Comment by enriqueartal created at 2015-07-14 11:07:47

As far as I remember, in the definition of the division of two polynomials, it checks first if the denominator is a unit. If it is, it divides each monomial by the indepent coefficient of the polynomial. There may be two possible solutions. The simple one would be to change this behavior for the division. A more permanent one, which was discussed in this [thread](https://groups.google.com/forum/#!searchin/sage-devel/artal/sage-devel/JQlb4bbBXjQ/7OgkbYIVNJQJ) proposes to create a new class of localized rings.


---

Comment by SimonKing created at 2015-07-14 11:30:06

Note that this is the code of "_div_" for multivariate polynomial rings:

```
        cdef poly *p
        cdef MPolynomial_libsingular right = <MPolynomial_libsingular>right_ringelement
        cdef bint is_field = left._parent._base.is_field()
        if p_IsConstant(right._poly, right._parent_ring):
            if is_field:
                singular_polynomial_div_coeff(&p, left._poly, right._poly, right._parent_ring)
                return new_MP(left._parent, p)
            else:
                return left.change_ring(left.base_ring().fraction_field())/right_ringelement
        else:
            return (left._parent).fraction_field()(left,right_ringelement)
```

So, it is tested with the libsingular function !p_IsConstant whether the divisor is constant, hence, we can divide by the leading coefficient. I bet !p_IsConstant assumes a positive ordering and just tests whether the leading monomial is of degree zero.


---

Comment by jakobkroeker created at 2017-03-04 02:46:14

Changing keywords from "" to "Singular".


---

Comment by mwest created at 2018-06-28 13:28:28

I checked the example again and it now works, is this fixed?


```
sage: R.<x,y>=PolynomialRing(QQ,order='neglex')
sage: f = 1+y
sage: g = 1+x
sage: f/g
(y + 1)/(x + 1)
```



---

Comment by tmonteil created at 2018-06-29 08:56:55

Replying to [comment:7 mwest]:
> I checked the example again and it now works, is this fixed?

In any case, it deserves a dedicated doctest to prevent future regression.


---

Comment by mwest created at 2018-06-29 13:28:51

Changing keywords from "Singular" to "Singular, days94".


---

Comment by mwest created at 2018-06-29 13:28:51

New commits:


---

Comment by mwest created at 2018-06-30 15:39:22

Changing status from new to needs_review.


---

Comment by lftabera created at 2018-06-30 15:57:32

This looks good to me. Note that the _div_ has not chaged.

Just one question, would it better if the test appears in src/sage/rings/polynomial/multi_polynomial_element.py? This is where the code in question is executed...


---

Comment by mwest created at 2018-06-30 16:08:58

I added the test to the definition of __div__ in src/sage/rings/polynomial/multi_polynomial_element.py
are you thinking somewhere else?


---

Comment by lftabera created at 2018-06-30 16:48:10

yes, sorry, I was thinking of the method _div_ in 
src/sage/rings/polynomial/multi_polynomial_libsingular.pyx
which is where the actual _div_ is performed for this ring.


---

Comment by git created at 2018-07-02 07:19:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-02 07:31:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-02 07:36:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2018-07-02 08:37:34

For reference, there is some documentation about formatting on the developer guide, see http://doc.sagemath.org/html/en/developer/coding_basics.html#python-code-style

In particular, you can add spacing between `QQ,` and `order="neglex"`, and perhaps between the `+` (though the current code is already readable).

About the `::`, just to make things clearer than our previous discussion:


```
blah

::

```


it the secure way to write `blah` followed by a block of code,



```
blah ::

```


is equivalent to the previous one.

However,


```
blah::

```


is equivalent to


```
blah:

::

```


which is therefore equivalent to:


```
blah: ::

```


[My personal preference goes to first and third, but it is up to you]

What was wrong in the commit 989c4fc2850c173ea9034f22c7742c614840a770 ([comment:10 comment 10]) was


```
Ensure that :trac:`17638` is fixed.::
```


wich will print both a dot and a column, but i fear that now you removed both, while it might be good to keep a column.


---

Comment by git created at 2018-07-02 08:58:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lftabera created at 2018-07-02 09:44:47

Changing status from needs_review to positive_review.


---

Comment by tmonteil created at 2018-07-02 09:55:49

It is all good with me, and with the newer location, we can see the test when we do:


```
sage: R.<x,y> = PolynomialRing(QQ, order='neglex')
sage: f = 1 + y
sage: f._div_??
```



---

Comment by vdelecroix created at 2018-08-03 19:20:18

update milestone 8.3 -> 8.4


---

Comment by vbraun created at 2018-08-29 22:37:28

Merge conflict


---

Comment by vbraun created at 2018-08-29 22:37:28

Changing status from positive_review to needs_work.


---

Comment by slelievre created at 2020-04-09 16:32:46

Discussed on sage-devel at:

- https://groups.google.com/d/topic/sage-devel/nDoUXqpJ6OU/discussion


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.


---

Comment by mkoeppe created at 2022-05-04 17:29:12

Replying to [comment:23 vbraun]:
> Merge conflict

The merge conflict has magically healed by itself.


---

Comment by mkoeppe created at 2022-05-04 17:29:23

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2022-05-15 22:27:24

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2022-05-15 22:27:24

Merge failure on top of:

341d434082 Trac #33834: Fix map_reduce doctest

40dfa7a1a3 Trac #33828: Fix conda workflow

b90120d1cf Trac #33761: OpenSSL 3.0.3 security update

bdcb741d5b Trac #33700: Developer's guide: Expand on [GitHub](GitHub) accounts and SSH keys

bf6aeb906d Updated [SageMath](SageMath) version to 9.6



reviewer u'\u200bLuis Felipe Tabera Alonso, Thierry Monteil' does not look right


---

Comment by mkoeppe created at 2022-05-15 22:31:08

Changing status from needs_work to positive_review.


---

Comment by mkoeppe created at 2022-05-15 22:31:24

removed the offending character


---

Comment by vbraun created at 2022-05-17 21:00:39

Resolution: fixed
