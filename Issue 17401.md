# Issue 17401: Division of polynomials produces errors when using local orderings

archive/issues_017401.json:
```json
{
    "body": "CC:  simonking jakobkroeker @slel\n\nConsider two polynomials f,g in a ring define using a local ordering, e.g.,\n\nR.<x,y>=PolynomialRing(QQ,order='neglex')\n\nIf the leading monomial of g is 1 then f/g will produces a wrong result, namely f divided by the independent coefficient of g. Note that in that case g.is_unit() yields True, since for Singular R is not Q[x,y] but the ordering localization (i.e., one can divide by the polynomials whose leading monomial is 1).\n\nPS: It is my first ticket, I apologize for the mistakes.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17638\n\n",
    "created_at": "2015-01-15T18:13:34Z",
    "labels": [
        "component: algebraic geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Division of polynomials produces errors when using local orderings",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17401",
    "user": "https://github.com/enriqueartal"
}
```
CC:  simonking jakobkroeker @slel

Consider two polynomials f,g in a ring define using a local ordering, e.g.,

R.<x,y>=PolynomialRing(QQ,order='neglex')

If the leading monomial of g is 1 then f/g will produces a wrong result, namely f divided by the independent coefficient of g. Note that in that case g.is_unit() yields True, since for Singular R is not Q[x,y] but the ordering localization (i.e., one can divide by the polynomials whose leading monomial is 1).

PS: It is my first ticket, I apologize for the mistakes.

Issue created by migration from https://trac.sagemath.org/ticket/17638





---

archive/issue_comments_231980.json:
```json
{
    "body": "Changing component from algebraic geometry to commutative algebra.",
    "created_at": "2015-07-14T07:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231980",
    "user": "https://github.com/simon-king-jena"
}
```

Changing component from algebraic geometry to commutative algebra.



---

archive/issue_comments_231981.json:
```json
{
    "body": "Example:\n\n```\nsage: R.<x,y>=PolynomialRing(QQ,order='neglex')\nsage: f = 1+y\nsage: g = 1+x\nsage: f/g\n1 + y\nsage: _*g==f\nFalse\n```\n",
    "created_at": "2015-07-14T07:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231981",
    "user": "https://github.com/simon-king-jena"
}
```

Example:

```
sage: R.<x,y>=PolynomialRing(QQ,order='neglex')
sage: f = 1+y
sage: g = 1+x
sage: f/g
1 + y
sage: _*g==f
False
```




---

archive/issue_comments_231982.json:
```json
{
    "body": "As far as I remember, in the definition of the division of two polynomials, it checks first if the denominator is a unit. If it is, it divides each monomial by the indepent coefficient of the polynomial. There may be two possible solutions. The simple one would be to change this behavior for the division. A more permanent one, which was discussed in this\u00a0[thread](https://groups.google.com/forum/#!searchin/sage-devel/artal/sage-devel/JQlb4bbBXjQ/7OgkbYIVNJQJ)\u00a0proposes to create a new class of localized rings.",
    "created_at": "2015-07-14T11:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231982",
    "user": "https://github.com/enriqueartal"
}
```

As far as I remember, in the definition of the division of two polynomials, it checks first if the denominator is a unit. If it is, it divides each monomial by the indepent coefficient of the polynomial. There may be two possible solutions. The simple one would be to change this behavior for the division. A more permanent one, which was discussed in this [thread](https://groups.google.com/forum/#!searchin/sage-devel/artal/sage-devel/JQlb4bbBXjQ/7OgkbYIVNJQJ) proposes to create a new class of localized rings.



---

archive/issue_comments_231983.json:
```json
{
    "body": "Note that this is the code of \"_div_\" for multivariate polynomial rings:\n\n```\n        cdef poly *p\n        cdef MPolynomial_libsingular right = <MPolynomial_libsingular>right_ringelement\n        cdef bint is_field = left._parent._base.is_field()\n        if p_IsConstant(right._poly, right._parent_ring):\n            if is_field:\n                singular_polynomial_div_coeff(&p, left._poly, right._poly, right._parent_ring)\n                return new_MP(left._parent, p)\n            else:\n                return left.change_ring(left.base_ring().fraction_field())/right_ringelement\n        else:\n            return (left._parent).fraction_field()(left,right_ringelement)\n```\n\nSo, it is tested with the libsingular function !p_IsConstant whether the divisor is constant, hence, we can divide by the leading coefficient. I bet !p_IsConstant assumes a positive ordering and just tests whether the leading monomial is of degree zero.",
    "created_at": "2015-07-14T11:30:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231983",
    "user": "https://github.com/simon-king-jena"
}
```

Note that this is the code of "_div_" for multivariate polynomial rings:

```
        cdef poly *p
        cdef MPolynomial_libsingular right = <MPolynomial_libsingular>right_ringelement
        cdef bint is_field = left._parent._base.is_field()
        if p_IsConstant(right._poly, right._parent_ring):
            if is_field:
                singular_polynomial_div_coeff(&p, left._poly, right._poly, right._parent_ring)
                return new_MP(left._parent, p)
            else:
                return left.change_ring(left.base_ring().fraction_field())/right_ringelement
        else:
            return (left._parent).fraction_field()(left,right_ringelement)
```

So, it is tested with the libsingular function !p_IsConstant whether the divisor is constant, hence, we can divide by the leading coefficient. I bet !p_IsConstant assumes a positive ordering and just tests whether the leading monomial is of degree zero.



---

archive/issue_comments_231984.json:
```json
{
    "body": "Changing keywords from \"\" to \"Singular\".",
    "created_at": "2017-03-04T02:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231984",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

Changing keywords from "" to "Singular".



---

archive/issue_comments_231985.json:
```json
{
    "body": "I checked the example again and it now works, is this fixed?\n\n\n```\nsage: R.<x,y>=PolynomialRing(QQ,order='neglex')\nsage: f = 1+y\nsage: g = 1+x\nsage: f/g\n(y + 1)/(x + 1)\n```\n",
    "created_at": "2018-06-28T13:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231985",
    "user": "https://github.com/mckenziewest"
}
```

I checked the example again and it now works, is this fixed?


```
sage: R.<x,y>=PolynomialRing(QQ,order='neglex')
sage: f = 1+y
sage: g = 1+x
sage: f/g
(y + 1)/(x + 1)
```




---

archive/issue_comments_231986.json:
```json
{
    "body": "Replying to [comment:7 mwest]:\n> I checked the example again and it now works, is this fixed?\n\nIn any case, it deserves a dedicated doctest to prevent future regression.",
    "created_at": "2018-06-29T08:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231986",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Replying to [comment:7 mwest]:
> I checked the example again and it now works, is this fixed?

In any case, it deserves a dedicated doctest to prevent future regression.



---

archive/issue_comments_231987.json:
```json
{
    "body": "Changing keywords from \"Singular\" to \"Singular, days94\".",
    "created_at": "2018-06-29T13:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231987",
    "user": "https://github.com/mckenziewest"
}
```

Changing keywords from "Singular" to "Singular, days94".



---

archive/issue_comments_231988.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-06-29T13:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231988",
    "user": "https://github.com/mckenziewest"
}
```

New commits:



---

archive/issue_comments_231989.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-30T15:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231989",
    "user": "https://github.com/mckenziewest"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_231990.json:
```json
{
    "body": "This looks good to me. Note that the _div_ has not chaged.\n\nJust one question, would it better if the test appears in src/sage/rings/polynomial/multi_polynomial_element.py? This is where the code in question is executed...",
    "created_at": "2018-06-30T15:57:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231990",
    "user": "https://github.com/lftabera"
}
```

This looks good to me. Note that the _div_ has not chaged.

Just one question, would it better if the test appears in src/sage/rings/polynomial/multi_polynomial_element.py? This is where the code in question is executed...



---

archive/issue_comments_231991.json:
```json
{
    "body": "I added the test to the definition of __div__ in src/sage/rings/polynomial/multi_polynomial_element.py\nare you thinking somewhere else?",
    "created_at": "2018-06-30T16:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231991",
    "user": "https://github.com/mckenziewest"
}
```

I added the test to the definition of __div__ in src/sage/rings/polynomial/multi_polynomial_element.py
are you thinking somewhere else?



---

archive/issue_comments_231992.json:
```json
{
    "body": "yes, sorry, I was thinking of the method _div_ in \nsrc/sage/rings/polynomial/multi_polynomial_libsingular.pyx\nwhich is where the actual _div_ is performed for this ring.",
    "created_at": "2018-06-30T16:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231992",
    "user": "https://github.com/lftabera"
}
```

yes, sorry, I was thinking of the method _div_ in 
src/sage/rings/polynomial/multi_polynomial_libsingular.pyx
which is where the actual _div_ is performed for this ring.



---

archive/issue_comments_231993.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-02T07:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231993",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_231994.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-02T07:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231994",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_231995.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-02T07:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231995",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_231996.json:
```json
{
    "body": "For reference, there is some documentation about formatting on the developer guide, see http://doc.sagemath.org/html/en/developer/coding_basics.html#python-code-style\n\nIn particular, you can add spacing between `QQ,` and `order=\"neglex\"`, and perhaps between the `+` (though the current code is already readable).\n\nAbout the `::`, just to make things clearer than our previous discussion:\n\n\n```\nblah\n\n::\n\n```\n\n\nit the secure way to write `blah` followed by a block of code,\n\n\n\n```\nblah ::\n\n```\n\n\nis equivalent to the previous one.\n\nHowever,\n\n\n```\nblah::\n\n```\n\n\nis equivalent to\n\n\n```\nblah:\n\n::\n\n```\n\n\nwhich is therefore equivalent to:\n\n\n```\nblah: ::\n\n```\n\n\n[My personal preference goes to first and third, but it is up to you]\n\nWhat was wrong in the commit 989c4fc2850c173ea9034f22c7742c614840a770 ([comment:10 comment 10]) was\n\n\n```\nEnsure that :trac:`17638` is fixed.::\n```\n\n\nwich will print both a dot and a column, but i fear that now you removed both, while it might be good to keep a column.",
    "created_at": "2018-07-02T08:37:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231996",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

For reference, there is some documentation about formatting on the developer guide, see http://doc.sagemath.org/html/en/developer/coding_basics.html#python-code-style

In particular, you can add spacing between `QQ,` and `order="neglex"`, and perhaps between the `+` (though the current code is already readable).

About the `::`, just to make things clearer than our previous discussion:


```
blah

::

```


it the secure way to write `blah` followed by a block of code,



```
blah ::

```


is equivalent to the previous one.

However,


```
blah::

```


is equivalent to


```
blah:

::

```


which is therefore equivalent to:


```
blah: ::

```


[My personal preference goes to first and third, but it is up to you]

What was wrong in the commit 989c4fc2850c173ea9034f22c7742c614840a770 ([comment:10 comment 10]) was


```
Ensure that :trac:`17638` is fixed.::
```


wich will print both a dot and a column, but i fear that now you removed both, while it might be good to keep a column.



---

archive/issue_comments_231997.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-02T08:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231997",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_231998.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-07-02T09:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231998",
    "user": "https://github.com/lftabera"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_231999.json:
```json
{
    "body": "It is all good with me, and with the newer location, we can see the test when we do:\n\n\n```\nsage: R.<x,y> = PolynomialRing(QQ, order='neglex')\nsage: f = 1 + y\nsage: f._div_??\n```\n",
    "created_at": "2018-07-02T09:55:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-231999",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

It is all good with me, and with the newer location, we can see the test when we do:


```
sage: R.<x,y> = PolynomialRing(QQ, order='neglex')
sage: f = 1 + y
sage: f._div_??
```




---

archive/issue_comments_232000.json:
```json
{
    "body": "update milestone 8.3 -> 8.4",
    "created_at": "2018-08-03T19:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-232000",
    "user": "https://github.com/videlec"
}
```

update milestone 8.3 -> 8.4



---

archive/issue_comments_232001.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2018-08-29T22:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-232001",
    "user": "https://github.com/vbraun"
}
```

Merge conflict



---

archive/issue_comments_232002.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-08-29T22:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-232002",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_232003.json:
```json
{
    "body": "Discussed on sage-devel at:\n\n- https://groups.google.com/d/topic/sage-devel/nDoUXqpJ6OU/discussion",
    "created_at": "2020-04-09T16:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-232003",
    "user": "https://github.com/slel"
}
```

Discussed on sage-devel at:

- https://groups.google.com/d/topic/sage-devel/nDoUXqpJ6OU/discussion



---

archive/issue_comments_232004.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-232004",
    "user": "https://github.com/mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_232005.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-232005",
    "user": "https://github.com/mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_232006.json:
```json
{
    "body": "Replying to [comment:23 vbraun]:\n> Merge conflict\n\nThe merge conflict has magically healed by itself.",
    "created_at": "2022-05-04T17:29:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-232006",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:23 vbraun]:
> Merge conflict

The merge conflict has magically healed by itself.



---

archive/issue_comments_232007.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-05-04T17:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-232007",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_232008.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-05-15T22:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-232008",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_232009.json:
```json
{
    "body": "Merge failure on top of:\n\n341d434082 Trac #33834: Fix map_reduce doctest\n\n40dfa7a1a3 Trac #33828: Fix conda workflow\n\nb90120d1cf Trac #33761: OpenSSL 3.0.3 security update\n\nbdcb741d5b Trac #33700: Developer's guide: Expand on [GitHub](GitHub) accounts and SSH keys\n\nbf6aeb906d Updated [SageMath](SageMath) version to 9.6\n\n\n\nreviewer u'\\u200bLuis Felipe Tabera Alonso, Thierry Monteil' does not look right",
    "created_at": "2022-05-15T22:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-232009",
    "user": "https://github.com/vbraun"
}
```

Merge failure on top of:

341d434082 Trac #33834: Fix map_reduce doctest

40dfa7a1a3 Trac #33828: Fix conda workflow

b90120d1cf Trac #33761: OpenSSL 3.0.3 security update

bdcb741d5b Trac #33700: Developer's guide: Expand on [GitHub](GitHub) accounts and SSH keys

bf6aeb906d Updated [SageMath](SageMath) version to 9.6



reviewer u'\u200bLuis Felipe Tabera Alonso, Thierry Monteil' does not look right



---

archive/issue_comments_232010.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-05-15T22:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-232010",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_232011.json:
```json
{
    "body": "removed the offending character",
    "created_at": "2022-05-15T22:31:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-232011",
    "user": "https://github.com/mkoeppe"
}
```

removed the offending character



---

archive/issue_comments_232012.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-05-17T21:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17401#issuecomment-232012",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_016778.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-05-17T21:00:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17401",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17401#event-16778"
}
```
