# Issue 22073: Use PPL for facet normals of full-dimensional polytopes

Issue created by migration from Trac.

Original creator: novoselt

Original creation time: 2017-02-06 03:55:40

CC:  vbraun tscrim

Before:

```
sage: timeit("LatticePolytope(lattice_polytope.cross_polytope(3).vertices()).facet_normals()")
5 loops, best of 3: 43.2 ms per loop
```

After:

```
sage: timeit("LatticePolytope(lattice_polytope.cross_polytope(3).vertices()).facet_normals()")
125 loops, best of 3: 6.81 ms per loop
```

PPL will of course work for non-full-dimensional polytopes as well, however the treatment of this case is spread around several places and its removal will be treated separately. Once this is done the speed up will be even more significant.


---

Comment by novoselt created at 2017-02-06 04:11:48

Hey Volker! Looking forward to non-full-dimensional case: many years ago #9188 promised in documentation that

```
        If this polytope is not full-dimensional, facet normals will be
        orthogonal to the integer kernel of the affine subspace spanned by
        this polytope.
```

I can't recall any reason why this orthogonality would be of any importance, can you? Trying to ensure it (unless PPL for some reason guarantees it already) involves a somewhat long chain of matrix manipulations that you eventually got correct and while it is sad to remove it, doing so will definitely simplify the code and likely make it noticeably faster.
----
New commits:


---

Comment by novoselt created at 2017-02-06 04:11:48

Changing status from new to needs_review.


---

Comment by novoselt created at 2017-03-14 04:04:49

Hi, Travis! Since you were so kind to review the dependency, do you care to take a look at this one? The real change is in the first short commit (the second one is doctest fixing) and that one is mostly copy-pasting [old code](https://github.com/sagemath/sage/blob/7.6.beta2/src/sage/geometry/lattice_polytope.py#L1024-L1051) and constructing the same thing from PPL functions rather than PALP format.


---

Comment by tscrim created at 2017-03-17 09:01:51

Are the changes in `schemes/toric` all coming from different orderings of (some of) the outputs, or are they honest changes?


---

Comment by tscrim created at 2017-03-17 09:02:04

Changing keywords from "" to "days85".


---

Comment by novoselt created at 2017-03-17 19:37:17

Um, what are "honest changes"? The cause for all of them is the change in ordering. Since toric computations often rely on both vertices and normals, things got affected quite a bit. Some tests had to be adjusted themselves (i.e. not just output) because they relied on indices of normals in the list, e.g. for charts.

I've done my best to go through all affected cases carefully and reading the context to make sure that they still made sense, although I don't know of an easy way to verify my claim ;-)


---

Comment by tscrim created at 2017-03-17 19:46:33

I would consider than an honest change, but if you say they are equivalent answers, then that is good enough for me. Thanks; positive review.


---

Comment by tscrim created at 2017-03-17 19:46:33

Changing status from needs_review to positive_review.


---

Comment by novoselt created at 2017-03-18 02:21:04

Thanks a lot! Naturally, feel free to move to the next one, but it gets more involved, although I tried to make each commit sensible on its own...


---

Comment by vbraun created at 2017-03-27 20:42:35

Resolution: fixed
