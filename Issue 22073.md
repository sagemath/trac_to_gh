# Issue 22073: Use PPL for facet normals of full-dimensional polytopes

archive/issues_022073.json:
```json
{
    "body": "CC:  @vbraun @tscrim\n\nBefore:\n\n```\nsage: timeit(\"LatticePolytope(lattice_polytope.cross_polytope(3).vertices()).facet_normals()\")\n5 loops, best of 3: 43.2 ms per loop\n```\n\nAfter:\n\n```\nsage: timeit(\"LatticePolytope(lattice_polytope.cross_polytope(3).vertices()).facet_normals()\")\n125 loops, best of 3: 6.81 ms per loop\n```\n\nPPL will of course work for non-full-dimensional polytopes as well, however the treatment of this case is spread around several places and its removal will be treated separately. Once this is done the speed up will be even more significant.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22310\n\n",
    "created_at": "2017-02-06T03:55:40Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Use PPL for facet normals of full-dimensional polytopes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22073",
    "user": "https://github.com/novoselt"
}
```
CC:  @vbraun @tscrim

Before:

```
sage: timeit("LatticePolytope(lattice_polytope.cross_polytope(3).vertices()).facet_normals()")
5 loops, best of 3: 43.2 ms per loop
```

After:

```
sage: timeit("LatticePolytope(lattice_polytope.cross_polytope(3).vertices()).facet_normals()")
125 loops, best of 3: 6.81 ms per loop
```

PPL will of course work for non-full-dimensional polytopes as well, however the treatment of this case is spread around several places and its removal will be treated separately. Once this is done the speed up will be even more significant.

Issue created by migration from https://trac.sagemath.org/ticket/22310





---

archive/issue_comments_306336.json:
```json
{
    "body": "Hey Volker! Looking forward to non-full-dimensional case: many years ago #9188 promised in documentation that\n\n```\n        If this polytope is not full-dimensional, facet normals will be\n        orthogonal to the integer kernel of the affine subspace spanned by\n        this polytope.\n```\n\nI can't recall any reason why this orthogonality would be of any importance, can you? Trying to ensure it (unless PPL for some reason guarantees it already) involves a somewhat long chain of matrix manipulations that you eventually got correct and while it is sad to remove it, doing so will definitely simplify the code and likely make it noticeably faster.\n----\nNew commits:",
    "created_at": "2017-02-06T04:11:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22073#issuecomment-306336",
    "user": "https://github.com/novoselt"
}
```

Hey Volker! Looking forward to non-full-dimensional case: many years ago #9188 promised in documentation that

```
        If this polytope is not full-dimensional, facet normals will be
        orthogonal to the integer kernel of the affine subspace spanned by
        this polytope.
```

I can't recall any reason why this orthogonality would be of any importance, can you? Trying to ensure it (unless PPL for some reason guarantees it already) involves a somewhat long chain of matrix manipulations that you eventually got correct and while it is sad to remove it, doing so will definitely simplify the code and likely make it noticeably faster.
----
New commits:



---

archive/issue_comments_306337.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-06T04:11:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22073#issuecomment-306337",
    "user": "https://github.com/novoselt"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_306338.json:
```json
{
    "body": "Hi, Travis! Since you were so kind to review the dependency, do you care to take a look at this one? The real change is in the first short commit (the second one is doctest fixing) and that one is mostly copy-pasting [old code](https://github.com/sagemath/sage/blob/7.6.beta2/src/sage/geometry/lattice_polytope.py#L1024-L1051) and constructing the same thing from PPL functions rather than PALP format.",
    "created_at": "2017-03-14T04:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22073#issuecomment-306338",
    "user": "https://github.com/novoselt"
}
```

Hi, Travis! Since you were so kind to review the dependency, do you care to take a look at this one? The real change is in the first short commit (the second one is doctest fixing) and that one is mostly copy-pasting [old code](https://github.com/sagemath/sage/blob/7.6.beta2/src/sage/geometry/lattice_polytope.py#L1024-L1051) and constructing the same thing from PPL functions rather than PALP format.



---

archive/issue_comments_306339.json:
```json
{
    "body": "Are the changes in `schemes/toric` all coming from different orderings of (some of) the outputs, or are they honest changes?",
    "created_at": "2017-03-17T09:01:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22073#issuecomment-306339",
    "user": "https://github.com/tscrim"
}
```

Are the changes in `schemes/toric` all coming from different orderings of (some of) the outputs, or are they honest changes?



---

archive/issue_comments_306340.json:
```json
{
    "body": "Changing keywords from \"\" to \"days85\".",
    "created_at": "2017-03-17T09:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22073#issuecomment-306340",
    "user": "https://github.com/tscrim"
}
```

Changing keywords from "" to "days85".



---

archive/issue_comments_306341.json:
```json
{
    "body": "Um, what are \"honest changes\"? The cause for all of them is the change in ordering. Since toric computations often rely on both vertices and normals, things got affected quite a bit. Some tests had to be adjusted themselves (i.e. not just output) because they relied on indices of normals in the list, e.g. for charts.\n\nI've done my best to go through all affected cases carefully and reading the context to make sure that they still made sense, although I don't know of an easy way to verify my claim ;-)",
    "created_at": "2017-03-17T19:37:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22073#issuecomment-306341",
    "user": "https://github.com/novoselt"
}
```

Um, what are "honest changes"? The cause for all of them is the change in ordering. Since toric computations often rely on both vertices and normals, things got affected quite a bit. Some tests had to be adjusted themselves (i.e. not just output) because they relied on indices of normals in the list, e.g. for charts.

I've done my best to go through all affected cases carefully and reading the context to make sure that they still made sense, although I don't know of an easy way to verify my claim ;-)



---

archive/issue_comments_306342.json:
```json
{
    "body": "I would consider than an honest change, but if you say they are equivalent answers, then that is good enough for me. Thanks; positive review.",
    "created_at": "2017-03-17T19:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22073#issuecomment-306342",
    "user": "https://github.com/tscrim"
}
```

I would consider than an honest change, but if you say they are equivalent answers, then that is good enough for me. Thanks; positive review.



---

archive/issue_comments_306343.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-17T19:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22073#issuecomment-306343",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_306344.json:
```json
{
    "body": "Thanks a lot! Naturally, feel free to move to the next one, but it gets more involved, although I tried to make each commit sensible on its own...",
    "created_at": "2017-03-18T02:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22073#issuecomment-306344",
    "user": "https://github.com/novoselt"
}
```

Thanks a lot! Naturally, feel free to move to the next one, but it gets more involved, although I tried to make each commit sensible on its own...



---

archive/issue_comments_306345.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-03-27T20:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22073#issuecomment-306345",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_020803.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2017-03-27T20:42:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22073",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22073#event-20803"
}
```
