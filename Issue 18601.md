# Issue 18601: GLPK backend does not detect unboundedness in simplex-only mode

Issue created by migration from Trac.

Original creator: mkoeppe

Original creation time: 2015-07-02 04:10:49

CC:  yzh ncohen dimpase â€‹john_perry dcoudert

Keywords: lp

testcase to be added


---

Comment by yzh created at 2015-07-02 13:52:04

Changing status from new to needs_review.


---

Comment by git created at 2015-07-02 21:57:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2015-07-03 14:12:20

something worries me there:

```
            status = glp_simplex(self.lp, self.smcp)
            status = glp_get_prim_stat(self.lp)
```

makes no sense to me...
The ticket proposes to change the 2nd line to 

```
            status = glp_get_status(self.lp)
```

but still...


---

Comment by git created at 2015-07-03 20:52:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-07-03 23:55:50

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2015-07-04 04:05:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-07-04 06:28:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2015-07-04 06:38:11

Replying to [comment:7 dimpase]:
> something worries me there:
> {{{
>             status = glp_simplex(self.lp, self.smcp)
>             status = glp_get_prim_stat(self.lp)
> }}}
> makes no sense to me...
> The ticket proposes to change the 2nd line to 
> {{{
>             status = glp_get_status(self.lp)
> }}}
> but still...

The code now checks both the result of glp_simplex and of glp_get_status. Needs review.


---

Comment by dimpase created at 2015-07-07 10:10:42

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2015-07-07 10:10:42

docs don't build:

```
Error building the documentation.
Traceback (most recent call last):
  File "/home/dima/software/sage/src/doc/common/builder.py", line 1626, in <module>
    getattr(get_builder(name), type)()
  File "/home/dima/software/sage/src/doc/common/builder.py", line 292, in _wrapper
    getattr(get_builder(document), 'inventory')(*args, **kwds)
  File "/home/dima/software/sage/src/doc/common/builder.py", line 503, in _wrapper
    x.get(99999)
  File "/home/dima/software/sage/local/lib/python/multiprocessing/pool.py", line 558, in get
    raise self._value
OSError: [numerical] docstring of sage.numerical.backends.glpk_backend.GLPKBackend.solve:82: ERROR: Unknown interpreted text role "ticket".
```

due to wrong tag `ticket` in

```
     Below we test that GLPK backend can detect unboundedness in simplex-only mode (:ticket:`18838`).
```


It should be 

```
(:trac:`18838`).
```

there.

PS. Please check that your patches produce correct docs, before setting tickets up for review.


---

Comment by mkoeppe created at 2015-07-07 19:38:49

Docs build now; I took the opportunity to clean up the documentation a bit.
----
New commits:


---

Comment by mkoeppe created at 2015-07-07 19:38:49

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2015-07-07 19:46:20

(Should I be rebasing this on top of #18764?)


---

Comment by git created at 2015-07-20 05:23:56

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2015-07-20 05:27:12

Rebased on top of current develop, which merged #18764.


---

Comment by mkoeppe created at 2015-08-19 23:53:33

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2015-08-19 23:53:33

This patch needs reworking on top of #18995 (which has been merged in current develop).


---

Comment by yzh created at 2015-08-21 07:31:02

Rebased on top of current develop, which merged #18995.
----
New commits:


---

Comment by mkoeppe created at 2015-08-21 17:20:40

Patchbot reports that two tests fail:



```
sage -t --long src/sage/numerical/mip.pyx
**********************************************************************
File "src/sage/numerical/mip.pyx", line 2416, in sage.numerical.mip.MIPSolverException.__init__
Failed example:
    p.solve()
Expected:
    Traceback (most recent call last):
    ...
    MIPSolverException: 'GLPK : There is no feasible integer solution to this Linear Program'
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/home/vincent/sage_patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/vincent/sage_patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.numerical.mip.MIPSolverException.__init__[7]>", line 1, in <module>
        p.solve()
      File "sage/numerical/mip.pyx", line 2098, in sage.numerical.mip.MixedIntegerLinearProgram.solve (build/cythonized/sage/numerical/mip.c:14050)
        self._backend.solve()
      File "sage/numerical/backends/glpk_backend.pyx", line 1018, in sage.numerical.backends.glpk_backend.GLPKBackend.solve (build/cythonized/sage/numerical/backends/glpk_backend.cpp:8533)
        raise MIPSolverException("GLPK : Solution is undefined. The LP (relaxation) problem instance has no primal feasible solution")
    MIPSolverException: 'GLPK : Solution is undefined. The LP (relaxation) problem instance has no primal feasible solution'
**********************************************************************
File "src/sage/numerical/mip.pyx", line 2432, in sage.numerical.mip.MIPSolverException.__init__
Failed example:
    p.solve()
Expected:
    Traceback (most recent call last):
    ...
    MIPSolverException: 'GLPK : There is no feasible integer solution to this Linear Program'
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/home/vincent/sage_patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/vincent/sage_patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.numerical.mip.MIPSolverException.__init__[14]>", line 1, in <module>
        p.solve()
      File "sage/numerical/mip.pyx", line 2098, in sage.numerical.mip.MixedIntegerLinearProgram.solve (build/cythonized/sage/numerical/mip.c:14050)
        self._backend.solve()
      File "sage/numerical/backends/glpk_backend.pyx", line 1018, in sage.numerical.backends.glpk_backend.GLPKBackend.solve (build/cythonized/sage/numerical/backends/glpk_backend.cpp:8533)
        raise MIPSolverException("GLPK : Solution is undefined. The LP (relaxation) problem instance has no primal feasible solution")
    MIPSolverException: 'GLPK : Solution is undefined. The LP (relaxation) problem instance has no primal feasible solution'
**********************************************************************
1 item had failures:
   2 of  16 in sage.numerical.mip.MIPSolverException.__init__
    [467 tests, 2 failures, 1.39 s]
```



---

Comment by git created at 2015-08-23 00:37:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-08-24 01:23:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-08-26 04:15:05

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by yzh created at 2015-08-26 04:18:48

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2015-09-18 17:39:25

This ticket is ready for review


---

Comment by dcoudert created at 2015-09-23 09:27:30

When I click on the branch http://git.sagemath.org/sage.git/diff/?id=601346c9cd74a2860fbc75ba0a6350bf8f9f72c3 at the top of this page, so on
`u/yzh/glpk_backend_does_not_detect_unboundedness_in_simplex_only_mode`, I see only removals of tons of lines of code (i.e., removal of mip.pyx and glpk backend).
I don't understand why.


---

Comment by yzh created at 2015-09-23 10:20:33

That's weird. I have the same problem now, but it was fine few weeks ago. 
I change Miestone sage-6.8 to sage-6.9 in the ticket.
Anyway, I find the correct diff here:
http://git.sagemath.org/sage.git/diff/?h=u/yzh/glpk_backend_does_not_detect_unboundedness_in_simplex_only_mode


---

Comment by ncohen created at 2015-09-23 10:21:11

Merge your branch with the latest beta (or rebase it), then push and it will go away.

Nathann


---

Comment by git created at 2015-09-23 10:41:24

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by yzh created at 2015-09-23 10:43:05

Thanks Nathann. I rebased the ticket on top of the current develop.


---

Comment by dcoudert created at 2015-09-23 11:44:51

Much better now.

The patch passes all tests. I have however some remarks:
- Why are you removing `GLP_EOPFS` and `GLP_EODFS` ? (I don't know the meaning of these variables)
- `This algorithm can be requested explicitly by setting the solver parameter "simplex_or_intopt" to "intopt_only".` The example following this statement does not examplify it. Where are you setting the solver parameter?
- comments should be formatted in 80 columns mode


---

Comment by git created at 2015-09-23 12:38:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yzh created at 2015-09-23 12:40:30

Thanks for your remarks.

> - Why are you removing `GLP_EOPFS` and `GLP_EODFS` ? (I don't know the meaning of these variables)
I remove  `GLP_EOPFS` and `GLP_EODFS`  because they are misspelled. They should be:
`GLP_ENOPFS`: "The LP (relaxation) problem has no primal feasible solution";
`GLP_ENODFS`: "The LP (relaxation) problem has no dual feasible solution",

> - `This algorithm can be requested explicitly by setting the solver parameter "simplex_or_intopt" to "intopt_only".` The example following this statement does not examplify it. Where are you setting the solver parameter?
`glp_intopt` is the default value for the solver parameter `simplex_or_intopt`, unless all variables are continuous.


---

Comment by dcoudert created at 2015-09-23 15:16:44

A small typo.
- `Thisroutine sometimes FAILS CATASTROPHICALLY`-> `This routine sometimes FAILS CATASTROPHICALLY`


---

Comment by git created at 2015-09-23 17:00:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2015-09-23 17:07:33

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2015-09-23 17:07:33

For me this patch is now good to go.
Thanks.
David.


---

Comment by vbraun created at 2015-09-25 07:52:56

Resolution: fixed
