# Issue 20540: faster __invert__ for integers

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2016-06-05 09:03:55

CC:  jdemeyer nbruin

Before

```
sage: a = 3
sage: %timeit ~a
1000000 loops, best of 3: 304 ns per loop
```

After

```
sage: a = 3
sage: %timeit ~a
1000000 loops, best of 3: 190 ns per loop
```


See also #20731


---

Comment by vdelecroix created at 2016-06-05 09:08:30

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2016-06-05 09:08:30

New commits:


---

Comment by jdemeyer created at 2016-06-05 09:16:48

Why not keep the `ZeroDivisionError`?


---

Comment by vdelecroix created at 2016-06-05 09:19:32

For `5.inverse_of_unit()`?


---

Comment by vdelecroix created at 2016-06-05 09:20:34

We might be more precise and raise either `ZeroDivisionError` for `0.inverse_of_unit()` and `ArithmeticError` for `~n` for `|n| > 1`... but it looks too complicated for me.


---

Comment by jmantysalo created at 2016-07-06 13:12:51

I can confirm the speedup, I tested with


```
sum([~x for x in IntegerRange(1000,2000)])
```


However, I can also confirm the same doctest failure on `src/sage/rings/polynomial/laurent_polynomial.pyx` that patchbot says.


---

Comment by jmantysalo created at 2016-07-06 13:12:51

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-07-06 14:33:45

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2016-07-06 14:37:02

Rebased and fixed. BTW the `__invert__` of Laurent polynomial is *completely* wrong (see #20963).


---

Comment by vdelecroix created at 2016-07-06 14:37:22

Changing status from needs_work to needs_review.


---

Comment by jmantysalo created at 2016-07-06 14:55:22

Changing status from needs_review to positive_review.


---

Comment by jmantysalo created at 2016-07-06 14:55:22

I can still confirm the speedup, and the doctest error is now gone.

I can not say that I really understand this part of Sage, but the code seems clear and simple enought to give positive review.


---

Comment by vbraun created at 2016-07-06 19:59:06

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-07-06 19:59:06

Reviewer name


---

Comment by jmantysalo created at 2016-07-06 20:07:19

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2016-07-08 07:09:59

Resolution: fixed
