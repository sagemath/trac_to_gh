# Issue 13106: Allow reporting of skipped optional tests

Issue created by migration from Trac.

Original creator: roed

Original creation time: 2012-07-19 23:06:38

Assignee: mvngu

From a discussion on [sage-combinat-devel](https://groups.google.com/d/topic/sage-combinat-devel/-8d0a3AJYoQ/discussion):

Optionally print extra information after doctesting: how many optional doctests were skipped, and how they were labeled ("skipped 5 doctests marked "optional -- bug").


---

Comment by roed created at 2013-03-15 04:33:26

Changing status from new to needs_review.


---

Comment by roed created at 2013-03-15 04:33:26

It was necessary to do some cleanup in `sage.doctest.sources.DocTestSource`: now it just stores an options object rather than separate options that it cares about.

There will be some double counting if optional tests are marked with multiple tags.

For ReST files with inner sources we'll also miss the optional tests in the inner sources.

Both issues seem minor enough that they're not worth the extra code complexity.


---

Attachment


---

Comment by jdemeyer created at 2013-03-15 12:48:29

Could you add a test to `sage/doctest/test.py` to test a complete `sage -t --show-skipped` run (also checking that optional tests which are run are not reported).

And I would enable `--show-skipped` automatically when `--verbose` is given.


---

Attachment


---

Comment by roed created at 2013-03-16 04:21:14

Replying to [comment:4 jdemeyer]:
> Could you add a test to `sage/doctest/test.py` to test a complete `sage -t --show-skipped` run (also checking that optional tests which are run are not reported).
> 
> And I would enable `--show-skipped` automatically when `--verbose` is given.

Done.


---

Comment by jdemeyer created at 2013-03-16 11:45:53

Why still use `useabspath` here (but remove it from the documentation)?

```
def __init__(self, path, options, useabspath=False)
```

especially since you replace

```
if self.useabspath: 
```

by

```
if self.options.abspath: 
```



---

Comment by jdemeyer created at 2013-03-16 11:46:27

And why isn't `--long` displayed in the output here:

```
sage: subprocess.call(["sage", "-t", "--long", "--show-skipped", "--optional=sage,gap", "show_skipped.rst"], cwd=tests_dir) 
Running doctests ... 
Doctesting 1 file. 
sage -t show_skipped.rst 
```



---

Comment by jdemeyer created at 2013-03-16 11:48:40

Line 405, you could replace

```
untested = optionals["not tested"] + optionals["not implemented"]
```

by

```
untested = optionals.pop("not tested") + optionals.pop("not implemented")
```

Then you don't need to check for "not tested" or "not implemented" further.

And I think the translation "known bug" -> "bug" should better be moved inside the `parse_optional_tags()` function itself.


---

Comment by jdemeyer created at 2013-03-16 11:48:54

Changing status from needs_review to needs_work.


---

Comment by roed created at 2013-03-17 08:17:19

Fixed.


---

Comment by roed created at 2013-03-17 08:17:19

Changing status from needs_work to needs_review.


---

Attachment


```
**********************************************************************
File "devel/sage/sage/doctest/test.py", line 240, in sage.doctest.test
Failed example:
    subprocess.call(["sage", "-t", "--long", "--show-skipped", "--optional=sage,gap", "show_skipped.rst"], cwd=tests_dir)
Expected:
    Running doctests ...
    Doctesting 1 file.
    sage -t --long show_skipped.rst
        1 unlabeled test not run
        2 tests not run due to known bugs
        1 other test skipped
        [3 tests, ... s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    ...
    0
Got:
    Running doctests with ID 2013-03-27-00-20-38-1d0ae1fc.
    Doctesting 1 file.
    sage -t --long show_skipped.rst
        1 unlabeled test not run
        2 tests not run due to known bugs
        0 not tested tests not run
        1 other test skipped
        [3 tests, 0.0 s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    Total time for all tests: 0.0 seconds
        cpu time: 0.0 seconds
        cumulative wall time: 0.0 seconds
    0
**********************************************************************
```


I'll have a look.


---

Comment by jdemeyer created at 2013-03-26 23:25:20

Changing status from needs_review to needs_work.


---

Attachment


---

Comment by jdemeyer created at 2013-03-27 00:07:57

[attachment:13278_review2.patch] (which replaces [attachment:13278_review.patch]) needs review.


---

Comment by jdemeyer created at 2013-03-27 00:07:57

Changing status from needs_work to needs_review.


---

Comment by roed created at 2013-03-27 01:02:31

Changing status from needs_review to positive_review.


---

Comment by roed created at 2013-03-27 01:02:31

Works for me.


---

Comment by jdemeyer created at 2013-03-27 01:17:54

This conflicts massively with #14331, rebasing... :-(


---

Attachment

Rebased and squashed the two patches.


---

Comment by jdemeyer created at 2013-03-28 17:57:41

Resolution: fixed


---

Comment by roed created at 2013-03-28 22:43:59

Changing component from doctest to doctest framework.
