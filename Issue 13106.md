# Issue 13106: Allow reporting of skipped optional tests

archive/issues_013106.json:
```json
{
    "body": "Assignee: mvngu\n\nFrom a discussion on [sage-combinat-devel](https://groups.google.com/d/topic/sage-combinat-devel/-8d0a3AJYoQ/discussion):\n\nOptionally print extra information after doctesting: how many optional doctests were skipped, and how they were labeled (\"skipped 5 doctests marked \"optional -- bug\").\n\nIssue created by migration from https://trac.sagemath.org/ticket/13278\n\n",
    "created_at": "2012-07-19T23:06:38Z",
    "labels": [
        "component: doctest"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.9",
    "title": "Allow reporting of skipped optional tests",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13106",
    "user": "https://github.com/roed314"
}
```
Assignee: mvngu

From a discussion on [sage-combinat-devel](https://groups.google.com/d/topic/sage-combinat-devel/-8d0a3AJYoQ/discussion):

Optionally print extra information after doctesting: how many optional doctests were skipped, and how they were labeled ("skipped 5 doctests marked "optional -- bug").

Issue created by migration from https://trac.sagemath.org/ticket/13278





---

archive/issue_comments_159220.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-03-15T04:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159220",
    "user": "https://github.com/roed314"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_159221.json:
```json
{
    "body": "It was necessary to do some cleanup in `sage.doctest.sources.DocTestSource`: now it just stores an options object rather than separate options that it cares about.\n\nThere will be some double counting if optional tests are marked with multiple tags.\n\nFor ReST files with inner sources we'll also miss the optional tests in the inner sources.\n\nBoth issues seem minor enough that they're not worth the extra code complexity.",
    "created_at": "2013-03-15T04:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159221",
    "user": "https://github.com/roed314"
}
```

It was necessary to do some cleanup in `sage.doctest.sources.DocTestSource`: now it just stores an options object rather than separate options that it cares about.

There will be some double counting if optional tests are marked with multiple tags.

For ReST files with inner sources we'll also miss the optional tests in the inner sources.

Both issues seem minor enough that they're not worth the extra code complexity.



---

archive/issue_comments_159222.json:
```json
{
    "body": "Attachment [13278_script.patch](tarball://root/attachments/some-uuid/ticket13278/13278_script.patch) by @roed314 created at 2013-03-15 04:35:56",
    "created_at": "2013-03-15T04:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159222",
    "user": "https://github.com/roed314"
}
```

Attachment [13278_script.patch](tarball://root/attachments/some-uuid/ticket13278/13278_script.patch) by @roed314 created at 2013-03-15 04:35:56



---

archive/issue_comments_159223.json:
```json
{
    "body": "Could you add a test to `sage/doctest/test.py` to test a complete `sage -t --show-skipped` run (also checking that optional tests which are run are not reported).\n\nAnd I would enable `--show-skipped` automatically when `--verbose` is given.",
    "created_at": "2013-03-15T12:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159223",
    "user": "https://github.com/jdemeyer"
}
```

Could you add a test to `sage/doctest/test.py` to test a complete `sage -t --show-skipped` run (also checking that optional tests which are run are not reported).

And I would enable `--show-skipped` automatically when `--verbose` is given.



---

archive/issue_comments_159224.json:
```json
{
    "body": "Attachment [13278.patch](tarball://root/attachments/some-uuid/ticket13278/13278.patch) by @roed314 created at 2013-03-16 04:21:00",
    "created_at": "2013-03-16T04:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159224",
    "user": "https://github.com/roed314"
}
```

Attachment [13278.patch](tarball://root/attachments/some-uuid/ticket13278/13278.patch) by @roed314 created at 2013-03-16 04:21:00



---

archive/issue_comments_159225.json:
```json
{
    "body": "Replying to [comment:4 jdemeyer]:\n> Could you add a test to `sage/doctest/test.py` to test a complete `sage -t --show-skipped` run (also checking that optional tests which are run are not reported).\n> \n> And I would enable `--show-skipped` automatically when `--verbose` is given.\n\nDone.",
    "created_at": "2013-03-16T04:21:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159225",
    "user": "https://github.com/roed314"
}
```

Replying to [comment:4 jdemeyer]:
> Could you add a test to `sage/doctest/test.py` to test a complete `sage -t --show-skipped` run (also checking that optional tests which are run are not reported).
> 
> And I would enable `--show-skipped` automatically when `--verbose` is given.

Done.



---

archive/issue_comments_159226.json:
```json
{
    "body": "Why still use `useabspath` here (but remove it from the documentation)?\n\n```\ndef __init__(self, path, options, useabspath=False)\n```\n\nespecially since you replace\n\n```\nif self.useabspath: \n```\n\nby\n\n```\nif self.options.abspath: \n```\n",
    "created_at": "2013-03-16T11:45:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159226",
    "user": "https://github.com/jdemeyer"
}
```

Why still use `useabspath` here (but remove it from the documentation)?

```
def __init__(self, path, options, useabspath=False)
```

especially since you replace

```
if self.useabspath: 
```

by

```
if self.options.abspath: 
```




---

archive/issue_comments_159227.json:
```json
{
    "body": "And why isn't `--long` displayed in the output here:\n\n```\nsage: subprocess.call([\"sage\", \"-t\", \"--long\", \"--show-skipped\", \"--optional=sage,gap\", \"show_skipped.rst\"], cwd=tests_dir) \nRunning doctests ... \nDoctesting 1 file. \nsage -t show_skipped.rst \n```\n",
    "created_at": "2013-03-16T11:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159227",
    "user": "https://github.com/jdemeyer"
}
```

And why isn't `--long` displayed in the output here:

```
sage: subprocess.call(["sage", "-t", "--long", "--show-skipped", "--optional=sage,gap", "show_skipped.rst"], cwd=tests_dir) 
Running doctests ... 
Doctesting 1 file. 
sage -t show_skipped.rst 
```




---

archive/issue_comments_159228.json:
```json
{
    "body": "Line 405, you could replace\n\n```\nuntested = optionals[\"not tested\"] + optionals[\"not implemented\"]\n```\n\nby\n\n```\nuntested = optionals.pop(\"not tested\") + optionals.pop(\"not implemented\")\n```\n\nThen you don't need to check for \"not tested\" or \"not implemented\" further.\n\nAnd I think the translation \"known bug\" -> \"bug\" should better be moved inside the `parse_optional_tags()` function itself.",
    "created_at": "2013-03-16T11:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159228",
    "user": "https://github.com/jdemeyer"
}
```

Line 405, you could replace

```
untested = optionals["not tested"] + optionals["not implemented"]
```

by

```
untested = optionals.pop("not tested") + optionals.pop("not implemented")
```

Then you don't need to check for "not tested" or "not implemented" further.

And I think the translation "known bug" -> "bug" should better be moved inside the `parse_optional_tags()` function itself.



---

archive/issue_comments_159229.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-03-16T11:48:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159229",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_159230.json:
```json
{
    "body": "Fixed.",
    "created_at": "2013-03-17T08:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159230",
    "user": "https://github.com/roed314"
}
```

Fixed.



---

archive/issue_comments_159231.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-03-17T08:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159231",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_159232.json:
```json
{
    "body": "Attachment [13278_review.patch](tarball://root/attachments/some-uuid/ticket13278/13278_review.patch) by @jdemeyer created at 2013-03-26 23:25:20\n\n\n```\n**********************************************************************\nFile \"devel/sage/sage/doctest/test.py\", line 240, in sage.doctest.test\nFailed example:\n    subprocess.call([\"sage\", \"-t\", \"--long\", \"--show-skipped\", \"--optional=sage,gap\", \"show_skipped.rst\"], cwd=tests_dir)\nExpected:\n    Running doctests ...\n    Doctesting 1 file.\n    sage -t --long show_skipped.rst\n        1 unlabeled test not run\n        2 tests not run due to known bugs\n        1 other test skipped\n        [3 tests, ... s]\n    ----------------------------------------------------------------------\n    All tests passed!\n    ----------------------------------------------------------------------\n    ...\n    0\nGot:\n    Running doctests with ID 2013-03-27-00-20-38-1d0ae1fc.\n    Doctesting 1 file.\n    sage -t --long show_skipped.rst\n        1 unlabeled test not run\n        2 tests not run due to known bugs\n        0 not tested tests not run\n        1 other test skipped\n        [3 tests, 0.0 s]\n    ----------------------------------------------------------------------\n    All tests passed!\n    ----------------------------------------------------------------------\n    Total time for all tests: 0.0 seconds\n        cpu time: 0.0 seconds\n        cumulative wall time: 0.0 seconds\n    0\n**********************************************************************\n```\n\n\nI'll have a look.",
    "created_at": "2013-03-26T23:25:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159232",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [13278_review.patch](tarball://root/attachments/some-uuid/ticket13278/13278_review.patch) by @jdemeyer created at 2013-03-26 23:25:20


```
**********************************************************************
File "devel/sage/sage/doctest/test.py", line 240, in sage.doctest.test
Failed example:
    subprocess.call(["sage", "-t", "--long", "--show-skipped", "--optional=sage,gap", "show_skipped.rst"], cwd=tests_dir)
Expected:
    Running doctests ...
    Doctesting 1 file.
    sage -t --long show_skipped.rst
        1 unlabeled test not run
        2 tests not run due to known bugs
        1 other test skipped
        [3 tests, ... s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    ...
    0
Got:
    Running doctests with ID 2013-03-27-00-20-38-1d0ae1fc.
    Doctesting 1 file.
    sage -t --long show_skipped.rst
        1 unlabeled test not run
        2 tests not run due to known bugs
        0 not tested tests not run
        1 other test skipped
        [3 tests, 0.0 s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    Total time for all tests: 0.0 seconds
        cpu time: 0.0 seconds
        cumulative wall time: 0.0 seconds
    0
**********************************************************************
```


I'll have a look.



---

archive/issue_comments_159233.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-03-26T23:25:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159233",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_159234.json:
```json
{
    "body": "Attachment [13278_review2.patch](tarball://root/attachments/some-uuid/ticket13278/13278_review2.patch) by @jdemeyer created at 2013-03-27 00:06:29",
    "created_at": "2013-03-27T00:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159234",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [13278_review2.patch](tarball://root/attachments/some-uuid/ticket13278/13278_review2.patch) by @jdemeyer created at 2013-03-27 00:06:29



---

archive/issue_comments_159235.json:
```json
{
    "body": "[attachment:13278_review2.patch] (which replaces [attachment:13278_review.patch]) needs review.",
    "created_at": "2013-03-27T00:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159235",
    "user": "https://github.com/jdemeyer"
}
```

[attachment:13278_review2.patch] (which replaces [attachment:13278_review.patch]) needs review.



---

archive/issue_comments_159236.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-03-27T00:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159236",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_159237.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-03-27T01:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159237",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_159238.json:
```json
{
    "body": "Works for me.",
    "created_at": "2013-03-27T01:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159238",
    "user": "https://github.com/roed314"
}
```

Works for me.



---

archive/issue_comments_159239.json:
```json
{
    "body": "This conflicts massively with #14331, rebasing... :-(",
    "created_at": "2013-03-27T01:17:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159239",
    "user": "https://github.com/jdemeyer"
}
```

This conflicts massively with #14331, rebasing... :-(



---

archive/issue_comments_159240.json:
```json
{
    "body": "Attachment [13278.2.patch](tarball://root/attachments/some-uuid/ticket13278/13278.2.patch) by @jdemeyer created at 2013-03-27 02:32:26\n\nRebased and squashed the two patches.",
    "created_at": "2013-03-27T02:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159240",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [13278.2.patch](tarball://root/attachments/some-uuid/ticket13278/13278.2.patch) by @jdemeyer created at 2013-03-27 02:32:26

Rebased and squashed the two patches.



---

archive/issue_comments_159241.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-03-28T17:57:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159241",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_159242.json:
```json
{
    "body": "Changing component from doctest to doctest framework.",
    "created_at": "2013-03-28T22:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13106#issuecomment-159242",
    "user": "https://github.com/roed314"
}
```

Changing component from doctest to doctest framework.
