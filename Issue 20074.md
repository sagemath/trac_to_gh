# Issue 20074: interactive_simplex_method enhancements

Issue created by migration from Trac.

Original creator: novoselt

Original creation time: 2016-03-27 23:32:53

CC:  mkoeppe

Allow constant terms in the objective, check solutions for feasibility and optimality, transformation map from standard form to the original one.


---

Comment by novoselt created at 2016-03-27 23:34:34

Changing status from new to needs_review.


---

Comment by novoselt created at 2016-03-27 23:35:26

New commits:


---

Comment by mkoeppe created at 2016-03-27 23:49:16

The standard-form transformation works well with #20296. Thanks very much! (I'll update the branch of #20296 when this ticket is merged.)

Some issues:

- I think the constant term should appear in the latex representation of the problem when nonzero.

- And it also needs to be passed through to `InteractiveLPProblemStandardForm` in `standard_form`. I have added a (failing) doctest.

- And then `InteractiveLPProblemStandardForm` needs to pass it on to the dictionaries...

- I think there should be a doctest that illustrates how the constant term interacts with `is_negative`.

- Passing `slack_variables` as a keyword argument to `standard_form` is a bit of an awkward interface, though, because `standard_form` may split equations and so the user would have to anticipate this. Perhaps it would be better to provide a list of "row_names" instead and modify that somehow when equations are split.


---

Comment by mkoeppe created at 2016-03-28 01:58:17

Changing status from needs_review to needs_work.


---

Comment by novoselt created at 2016-03-31 01:50:15

I'll probably work on it next weekend. For the record - it is not a good idea to edit old comments as apparently there are no notifications sent about it and it was a bit of an accident that I looked up.

Also, bloody trac does not let me post reply comments for no reason, but:
- I think problems should be typeset as `10 + max 5 x1 - 7 x2`, i.e. with constant term first and out of max/min as it makes it easier to "get rid of it" when desirable.
- I was not sure about the standard form, but probably it should include the constant term as well. And the dual problem has to be adjusted to make sure that optimal values still agree.
- For dictionaries convenient typesetting is probably in the objective as a part of its "name", as in `5 - z = 10 x1 + 9 x2`
- Interaction with negativity should also clearly documented.
- For "row_names" - I'd rather not introduce even more concepts and logic. If a user cares about slack names, he better know what they are and how they are formed. Also, if the only issue is the base name clash (without index), then the number of constraints does not matter, just pass that base name and indices will be taken care of.
----
New commits:


---

Comment by mkoeppe created at 2016-03-31 01:53:22

Thanks! Sounds good.


---

Comment by novoselt created at 2016-04-02 19:54:15

Changing status from needs_work to needs_review.


---

Comment by novoselt created at 2016-04-02 19:54:15

New commits:


---

Comment by mkoeppe created at 2016-04-04 04:05:45

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2016-04-04 04:05:45

I think the constant term also needs to be reflected in `run_simplex_method` and `run_revised_simplex_method`.
(Maybe the support for constant terms is a bit too complicated for the interactive simplex method after all?)


---

Comment by novoselt created at 2016-04-04 04:24:30

Well, it definitely adds very little from the didactic point of view, mostly just annoying thing to remember ;-) But since we have started and for the sake of being able to convert other problems to this type let's finish the job. What exactly is the problem with the simplex method? My hope was that things will take care of themselves there but I guess they don't.


---

Comment by mkoeppe created at 2016-04-04 04:44:35

Replying to [comment:13 novoselt]:
> What exactly is the problem with the simplex method? My hope was that things will take care of themselves there but I guess they don't.

It prints the non-shifted objective value. 
I suppose things would take care of themselves if the objective constant term were put in the constant (on the right hand side) of the dictionary, rather than into the objective name.


---

Comment by novoselt created at 2016-04-04 04:57:22

That will complicate alignment for typesetting and in general it seemed fitting to put it on the left where the negative sign goes as well for minimization problems. I'll think some more about it.


---

Comment by mkoeppe created at 2016-04-04 05:33:59

Well, the dictionary already typesets a constant for the objective function -- that's the value of the dictionary.
There's no need to distinguish these two constants from each other -- it's quite natural; the simplex method manipulates a dictionary of affine-linear functions.


---

Comment by novoselt created at 2016-04-05 15:36:58

You are right of course, and this will eliminate different meanings for `objective_value`. Although it would be better then to typeset objective with constant inside of min/max, which is probably more natural anyway.


---

Comment by mkoeppe created at 2016-04-05 21:35:07

Replying to [comment:17 novoselt]:
>  Although it would be better then to typeset objective with constant inside of min/max, which is probably more natural anyway.

I agree.


---

Comment by git created at 2016-04-10 16:47:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-04-10 21:30:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by novoselt created at 2016-04-10 21:35:24

OK, how about this one? I've also renamed `value(x)` to `objective_value(x)` to be more clear.


---

Comment by novoselt created at 2016-04-10 21:35:24

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2016-04-10 22:27:08

I think it would be better to keep the notions of [in]feasible problem and [in]feasible solution separate. 
Don't overload `is_feasible` with both meanings. Better have a new method `is_solution_feasible` and likewise rename `is_optimal` to `is_solution_optimal`.


---

Comment by mkoeppe created at 2016-04-10 22:31:53


```
`@``@` -1914,6 +2134,7 `@``@` class InteractiveLPProblemStandardForm(InteractiveLPProblem):
         A = A.matrix_from_columns(range(k) + range(k + 1, n))
         b = copy(b)
         c = vector(self.base_ring(), n - 1)
+        v = self._constant_term
         for cj, xj in zip(*self.Abcx()[-2:]):
             if xj in N:
                 c[N.index(xj)] += cj
```

This `v` doesn't seem to get used


---

Comment by novoselt created at 2016-04-10 22:34:35

Replying to [comment:22 mkoeppe]:
> I think it would be better to keep the notions of [in]feasible problem and [in]feasible solution separate. 
> Don't overload `is_feasible` with both meanings. Better have a new method `is_solution_feasible` and likewise rename `is_optimal` to `is_solution_optimal`.

No confusion is possible in use and I planned to do it for a long time without any second thoughts - several students have actually asked for exactly this ;-)


---

Comment by novoselt created at 2016-04-10 22:36:11

`v` propagates to the dictionary constructor. It happened to be initialized with 0 before.


---

Comment by mkoeppe created at 2016-04-10 22:37:13

In my experience, the persistent confusion of students about the notions of feasible problems, feasible solutions, and feasible dictionaries is the number 1 frustration in teaching the simplex method


---

Comment by novoselt created at 2016-04-10 22:37:55

If you are looking at commits in a browser, there is a handy selector in top-right for the number of context lines, which allows to see such changes in context.


---

Comment by mkoeppe created at 2016-04-10 22:38:39

Replying to [comment:27 novoselt]:
> If you are looking at commits in a browser, there is a handy selector in top-right for the number of context lines, which allows to see such changes in context.
Thanks! Yes, I was only reading the diff at this point


---

Comment by novoselt created at 2016-04-10 22:46:02

Agreed about confusion, but the questions in human language are:

A) Is this problem feasible?
B) Is this solution for this problem feasible?

which I want to translate in code to

A) `problem.is_feasible()`
B) `problem.is_feasible(solution)`

and find very natural and not **adding** any confusion at all.

Most students also feel no difference between

C) `problem.optimal_value()`
D) `optimal_dictionary.objective_value()`

since they do give the same values. Yet

C') `problem.work_hard_to_find_optimal_value()`
D') `optimal_dictionary.just_read_off_the_objective_value_you_store()`

are not the right way to teach them the difference.


---

Comment by mkoeppe created at 2016-04-10 22:59:18

I think my concern regarding A and B is in part because of Python defaulting semantics. 
If the `solution` argument is missing, people could assume that `is_feasible` somehow talks about the feasibility of some "default" solution (perhaps some "current" solution). 

I don't have a concern regarding the naming of C and D in the code.


---

Comment by novoselt created at 2016-04-10 23:05:27

What is default/current solution for a problem???

My point with C and D was that it is again just direct translation of "the human language" into code with neither solves nor adds confusion.

How about going with the current addition and seeing how (and with what degree of confusion) it will be received? Overloading methods is a common practice and we can always deprecate the use of arguments if it turns out to be bad.


---

Comment by mkoeppe created at 2016-04-10 23:22:33

Replying to [comment:31 novoselt]:
> What is default/current solution for a problem???

Well, *I* know that in your design the problem is immutable, but a user might think that if he goes pivoting in "the" dictionary obtained from `initial_dictionary`, this has some effect on the problem. 

> How about going with the current addition and seeing how (and with what degree of confusion) it will be received? Overloading methods is a common practice and we can always deprecate the use of arguments if it turns out to be bad.

OK, fine.


---

Comment by mkoeppe created at 2016-04-11 00:22:46

It seems the constant terms don't work the right way for minimization problems. Probably in the `standard_form` method the sign needs to be flipped.
(I have a test for this in InteractiveLPBackend.)


---

Comment by mkoeppe created at 2016-04-11 00:36:27

See #20413.


---

Comment by mkoeppe created at 2016-04-11 00:52:16

I have added a testcase.
----
New commits:


---

Comment by novoselt created at 2016-04-11 02:46:08

Yes, of course - thanks for thorough testing!
----
New commits:


---

Comment by mkoeppe created at 2016-04-11 02:55:11

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2016-04-11 02:55:11

Changing keywords from "" to "lp".


---

Comment by mkoeppe created at 2016-04-11 02:55:11

Thanks a lot for your work on this ticket!


---

Comment by vbraun created at 2016-04-12 16:30:38

Resolution: fixed
