# Issue 24532: make download-for-sdist race

Issue created by migration from https://trac.sagemath.org/ticket/24769

Original creator: vbraun

Original creation time: 2018-02-18 20:13:39

CC:  jdemeyer

Keywords: random_fail

This seems to be a fallout from the recent gfortran ticket; The makefile target copies the gcc tarball twice which can randomly fail: 

```
$ make download-for-sdist
[...]
[gfortran-7.2.0] Found local metadata for gfortran-7.2.0
[libgd-2.1.1.1.p1] Found local metadata for libgd-2.1.1.1.p1
[libgd-2.1.1.1.p1] Using cached file /mnt/disk/home/release/Sage/upstream/libgd-2.1.1.1.tar.bz2
[maxima-5.39.0.p2] Using cached file /mnt/disk/home/release/Sage/upstream/maxima-5.39.0.tar.gz
[python2-2.7.14.p2] Using cached file /mnt/disk/home/release/Sage/upstream/Python-2.7.14.tgz
sage-logger -p 'sage-spkg openblas-0.2.20.p1' '/mnt/disk/home/release/Sage/logs/pkgs/openblas-0.2.20.p1.log'
sage-logger -p 'sage-spkg elliptic_curves-0.8.p0' '/mnt/disk/home/release/Sage/logs/pkgs/elliptic_curves-0.8.p0.log'
sage-logger -p 'sage-spkg git-2.11.0' '/mnt/disk/home/release/Sage/logs/pkgs/git-2.11.0.log'
sage-logger -p 'sage-spkg singular-4.1.0p3.p2' '/mnt/disk/home/release/Sage/logs/pkgs/singular-4.1.0p3.p2.log'
make[1]: '/mnt/disk/home/release/Sage/local/var/lib/sage/installed/python2-2.7.14.p2' is up to date.
sage-logger -p 'sage-spkg zn_poly-0.9.p11' '/mnt/disk/home/release/Sage/logs/pkgs/zn_poly-0.9.p11.log'
[git-2.11.0] Found local metadata for git-2.11.0
[openblas-0.2.20.p1] Found local metadata for openblas-0.2.20.p1
[elliptic_curves-0.8.p0] Found local metadata for elliptic_curves-0.8.p0
[singular-4.1.0p3.p2] Found local metadata for singular-4.1.0p3.p2
[zn_poly-0.9.p11] Found local metadata for zn_poly-0.9.p11
[elliptic_curves-0.8.p0] Using cached file /mnt/disk/home/release/Sage/upstream/elliptic_curves-0.8.tar.bz2
[zn_poly-0.9.p11] Using cached file /mnt/disk/home/release/Sage/upstream/zn_poly-0.9.tar.bz2
[python3-3.6.1.p1] Using cached file /mnt/disk/home/release/Sage/upstream/Python-3.6.1.tar.gz
sage-logger -p 'sage-spkg setuptools-38.2.4' '/mnt/disk/home/release/Sage/logs/pkgs/setuptools-38.2.4.log'
make[1]: '/mnt/disk/home/release/Sage/local/var/lib/sage/installed/python3-3.6.1.p1' is up to date.
[git-2.11.0] Using cached file /mnt/disk/home/release/Sage/upstream/git-2.11.0.tar.gz
[setuptools-38.2.4] Found local metadata for setuptools-38.2.4
[singular-4.1.0p3.p2] Using cached file /mnt/disk/home/release/Sage/upstream/singular-4.1.0p3.tar.gz
[gcc-7.2.0] Using cached file /mnt/disk/home/release/Sage/upstream/gcc-7.2.0.tar.xz
[gfortran-7.2.0] Using cached file /mnt/disk/home/release/Sage/upstream/gcc-7.2.0.tar.xz
[openblas-0.2.20.p1] Using cached file /mnt/disk/home/release/Sage/upstream/OpenBLAS-0.2.20.tar.gz
[gfortran-7.2.0] cp: cannot create regular file '/mnt/disk/home/release/Sage/tmp/sage-8.2.beta6/upstream/gcc-7.2.0.tar.xz': File exists
[setuptools-38.2.4] Using cached file /mnt/disk/home/release/Sage/upstream/setuptools-38.2.4.zip
[gfortran-7.2.0] ************************************************************************
[gfortran-7.2.0] Error copying upstream tarball to directory '/mnt/disk/home/release/Sage/tmp/sage-8.2.beta6/upstream'
[gfortran-7.2.0] ************************************************************************
[gfortran-7.2.0] Please email sage-devel (http://groups.google.com/group/sage-devel)
[gfortran-7.2.0] explaining the problem and including the log file
[gfortran-7.2.0]   /mnt/disk/home/release/Sage/logs/pkgs/gfortran-7.2.0.log
[gfortran-7.2.0] Describe your computer, operating system, etc.
[gfortran-7.2.0] ************************************************************************
make[1]: *** [Makefile:1759: /mnt/disk/home/release/Sage/local/var/lib/sage/installed/gfortran-7.2.0] Error 1
make[1]: *** Waiting for unfinished jobs....
make[1]: Leaving directory '/mnt/disk/home/release/Sage/build/make'
make: *** [Makefile:846: download-for-sdist] Error 2
```



---

Comment by jdemeyer created at 2018-02-18 21:14:33

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-02-18 21:14:33

Easy solution: mark `gfortran` as optional. It will still be installed if needed because it's listed as explicit dependency as various packages.
----
New commits:


---

Comment by vbraun created at 2018-03-13 23:26:21

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-03-21 06:19:17

Resolution: fixed
