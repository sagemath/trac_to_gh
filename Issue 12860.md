# Issue 12860: Add ccache as a standard spkg

archive/issues_012860.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  @kini @robertwb @ppurka @jdemeyer\n\nThis is needed to eliminate build time when switching between various branches in the git based workflow.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13032\n\n",
    "created_at": "2012-05-27T12:08:43Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.6",
    "title": "Add ccache as a standard spkg",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12860",
    "user": "https://github.com/ohanar"
}
```
Assignee: GeorgSWeber

CC:  @kini @robertwb @ppurka @jdemeyer

This is needed to eliminate build time when switching between various branches in the git based workflow.

Issue created by migration from https://trac.sagemath.org/ticket/13032





---

archive/issue_comments_154480.json:
```json
{
    "body": "Not yet ready, the build scripts still need to be modified to set `CC` and `CXX` once this is installed.",
    "created_at": "2012-05-27T12:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154480",
    "user": "https://github.com/ohanar"
}
```

Not yet ready, the build scripts still need to be modified to set `CC` and `CXX` once this is installed.



---

archive/issue_comments_154481.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd40.5\".",
    "created_at": "2012-05-27T22:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154481",
    "user": "https://github.com/ohanar"
}
```

Changing keywords from "" to "sd40.5".



---

archive/issue_comments_154482.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-05-28T05:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154482",
    "user": "https://github.com/ohanar"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_154483.json:
```json
{
    "body": "Two general comments:\n1. We probably need to set the max cache size. On my system the default is 1G, which some people may dislike. It can be set using `ccache -M <size>{G,M,K}`, where the letters `G, M, K` can be used to specify the usual gigabytes, megabytes and kilobytes. This needs to be set only if `CCACHE_DIR` is empty, since the user may have his/her own ccache settings.\n2. This fact about the ccache size should be mentioned in the documentation, so that the user knows how much of disk space will be used.",
    "created_at": "2012-05-28T07:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154483",
    "user": "https://github.com/ppurka"
}
```

Two general comments:
1. We probably need to set the max cache size. On my system the default is 1G, which some people may dislike. It can be set using `ccache -M <size>{G,M,K}`, where the letters `G, M, K` can be used to specify the usual gigabytes, megabytes and kilobytes. This needs to be set only if `CCACHE_DIR` is empty, since the user may have his/her own ccache settings.
2. This fact about the ccache size should be mentioned in the documentation, so that the user knows how much of disk space will be used.



---

archive/issue_comments_154484.json:
```json
{
    "body": "Replying to [comment:13 ppurka]:\n> Two general comments:\n> 1. We probably need to set the max cache size. On my system the default is 1G, which some people may dislike. It can be set using `ccache -M <size>{G,M,K}`, where the letters `G, M, K` can be used to specify the usual gigabytes, megabytes and kilobytes. \n  \nThis is set in the spkg-install to 3G.\n\n> This needs to be set only if `CCACHE_DIR` is empty, since the user may have his/her own ccache settings.\n> 2. This fact about the ccache size should be mentioned in the documentation, so that the user knows how much of disk space will be used.\n  \nBoth good points, I'll see about changing these.",
    "created_at": "2012-05-28T08:19:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154484",
    "user": "https://github.com/ohanar"
}
```

Replying to [comment:13 ppurka]:
> Two general comments:
> 1. We probably need to set the max cache size. On my system the default is 1G, which some people may dislike. It can be set using `ccache -M <size>{G,M,K}`, where the letters `G, M, K` can be used to specify the usual gigabytes, megabytes and kilobytes. 
  
This is set in the spkg-install to 3G.

> This needs to be set only if `CCACHE_DIR` is empty, since the user may have his/her own ccache settings.
> 2. This fact about the ccache size should be mentioned in the documentation, so that the user knows how much of disk space will be used.
  
Both good points, I'll see about changing these.



---

archive/issue_comments_154485.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-05-29T00:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154485",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_154486.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-29T08:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154486",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_154487.json:
```json
{
    "body": "1. The f90cache source code does not include a copy of its license. Since it is based off of and old version of ccache, it must be GPL licensed, so it is in violation of GPL license. For this reason, I'm going to remove it from this ticket.\n2. ccache depends on zlib and includes its own copy to use if it can't find one. I've updated the spkg and build scripts to ensure that it uses our copy.",
    "created_at": "2012-06-20T08:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154487",
    "user": "https://github.com/ohanar"
}
```

1. The f90cache source code does not include a copy of its license. Since it is based off of and old version of ccache, it must be GPL licensed, so it is in violation of GPL license. For this reason, I'm going to remove it from this ticket.
2. ccache depends on zlib and includes its own copy to use if it can't find one. I've updated the spkg and build scripts to ensure that it uses our copy.



---

archive/issue_comments_154488.json:
```json
{
    "body": "apply to scripts repo",
    "created_at": "2012-06-20T08:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154488",
    "user": "https://github.com/ohanar"
}
```

apply to scripts repo



---

archive/issue_comments_154489.json:
```json
{
    "body": "Attachment [trac13032_scripts.patch](tarball://root/attachments/some-uuid/ticket13032/trac13032_scripts.patch) by @kini created at 2012-06-20 08:16:45\n\nHave you reported the f90cache licensing problem upstream, or asked for a special dispensation?",
    "created_at": "2012-06-20T08:16:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154489",
    "user": "https://github.com/kini"
}
```

Attachment [trac13032_scripts.patch](tarball://root/attachments/some-uuid/ticket13032/trac13032_scripts.patch) by @kini created at 2012-06-20 08:16:45

Have you reported the f90cache licensing problem upstream, or asked for a special dispensation?



---

archive/issue_comments_154490.json:
```json
{
    "body": "Replying to [comment:22 kini]:\n> Have you reported the f90cache licensing problem upstream, or asked for a special dispensation?\n\n\nI just reported the problem upstream. A special dispensation is irrelevant, it must be GPL since it derivative of ccache-2.4, which is licensed under GPL-2+, so it is an issue with violating the GPL.\n\nRegardless, I think it would be best to place a f90cache spkg in a different ticket.",
    "created_at": "2012-06-20T08:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154490",
    "user": "https://github.com/ohanar"
}
```

Replying to [comment:22 kini]:
> Have you reported the f90cache licensing problem upstream, or asked for a special dispensation?


I just reported the problem upstream. A special dispensation is irrelevant, it must be GPL since it derivative of ccache-2.4, which is licensed under GPL-2+, so it is an issue with violating the GPL.

Regardless, I think it would be best to place a f90cache spkg in a different ticket.



---

archive/issue_comments_154491.json:
```json
{
    "body": "AFAIK the licensing classification of software applies not to the body of its source code in general but to a particular act of distribution of that body of source code (though open source projects often offer public downloads of their source code with the understanding that each download of the code is taken to be governed by the license specified in the COPYING file and referred to as the license \"of the software\" itself). By \"special dispensation\" I meant the obtainment of a copy of the source code from the copyright holder under a one-time transferral stipulated to be under GPLv2+, even while the public download link was perhaps not governed by GPLv2+.",
    "created_at": "2012-06-20T08:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154491",
    "user": "https://github.com/kini"
}
```

AFAIK the licensing classification of software applies not to the body of its source code in general but to a particular act of distribution of that body of source code (though open source projects often offer public downloads of their source code with the understanding that each download of the code is taken to be governed by the license specified in the COPYING file and referred to as the license "of the software" itself). By "special dispensation" I meant the obtainment of a copy of the source code from the copyright holder under a one-time transferral stipulated to be under GPLv2+, even while the public download link was perhaps not governed by GPLv2+.



---

archive/issue_comments_154492.json:
```json
{
    "body": "Replying to [comment:24 kini]:\n> AFAIK the licensing classification of software applies not to the body of its source code in general but to a particular act of distribution of that body of source code (though open source projects often offer public downloads of their source code with the understanding that each download of the code is taken to be governed by the license specified in the COPYING file and referred to as the license \"of the software\" itself). By \"special dispensation\" I meant the obtainment of a copy of the source code from the copyright holder under a one-time transferral stipulated to be under GPLv2+, even while the public download link was perhaps not governed by GPLv2+.\n\n\nI don't understand what you're trying to say here.  The GPL talks both about running the code (I guess this is what you refer to when talking about \"the body of its source code in general\") and distributing the code.  Running and distributing are two essentially independent things, but both governed by the same license.",
    "created_at": "2012-06-20T09:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154492",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:24 kini]:
> AFAIK the licensing classification of software applies not to the body of its source code in general but to a particular act of distribution of that body of source code (though open source projects often offer public downloads of their source code with the understanding that each download of the code is taken to be governed by the license specified in the COPYING file and referred to as the license "of the software" itself). By "special dispensation" I meant the obtainment of a copy of the source code from the copyright holder under a one-time transferral stipulated to be under GPLv2+, even while the public download link was perhaps not governed by GPLv2+.


I don't understand what you're trying to say here.  The GPL talks both about running the code (I guess this is what you refer to when talking about "the body of its source code in general") and distributing the code.  Running and distributing are two essentially independent things, but both governed by the same license.



---

archive/issue_comments_154493.json:
```json
{
    "body": "In the doc patch: the command\n\n```\nsage -sh ccache --max-size=SIZE\n```\nsurely isn't correct.  Either you mean \"first run `./sage --sh`, then `ccache --max-size=SIZE`\", or you mean \"`sage --sh -c \"ccache --max-size=SIZE\"`\" or you mean \"`sage --ccache --max-size=SIZE`\" with adding a `--ccache` option to `spkg/bin/sage`.",
    "created_at": "2012-06-20T09:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154493",
    "user": "https://github.com/jdemeyer"
}
```

In the doc patch: the command

```
sage -sh ccache --max-size=SIZE
```
surely isn't correct.  Either you mean "first run `./sage --sh`, then `ccache --max-size=SIZE`", or you mean "`sage --sh -c "ccache --max-size=SIZE"`" or you mean "`sage --ccache --max-size=SIZE`" with adding a `--ccache` option to `spkg/bin/sage`.



---

archive/issue_comments_154494.json:
```json
{
    "body": "I mean that when you say \"Software X is under the GPL\", what you actually mean is \"when I obtained software X, I did so under the GPL\". If I am the copyright holder to software X, there is no contradiction in me giving it to person A under the GPL and person B under the BSD license. Similarly, if I'm the copyright holder of f90cache, there's no contradiction if I give f90cache to J. Random Hacker under an ill-specified non-GPL license, but at the same time give f90cache to ohanar under GPLv2+.\n\nOf course, it turns out I am actually contractually forbidden by the ccache authors from licensing f90cache to J. Random Hacker under this ill-specified non-GPL license, because f90cache is a derivative work of a version of ccache which I myself obtained under the GPLv2+. But there's nothing wrong with my simultaneous licensing of f90cache to ohanar under GPLv2+. At least, that's my understanding of it, based on what guys on #fsf told me a long time ago - IANAL, needless to say :)",
    "created_at": "2012-06-20T09:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154494",
    "user": "https://github.com/kini"
}
```

I mean that when you say "Software X is under the GPL", what you actually mean is "when I obtained software X, I did so under the GPL". If I am the copyright holder to software X, there is no contradiction in me giving it to person A under the GPL and person B under the BSD license. Similarly, if I'm the copyright holder of f90cache, there's no contradiction if I give f90cache to J. Random Hacker under an ill-specified non-GPL license, but at the same time give f90cache to ohanar under GPLv2+.

Of course, it turns out I am actually contractually forbidden by the ccache authors from licensing f90cache to J. Random Hacker under this ill-specified non-GPL license, because f90cache is a derivative work of a version of ccache which I myself obtained under the GPLv2+. But there's nothing wrong with my simultaneous licensing of f90cache to ohanar under GPLv2+. At least, that's my understanding of it, based on what guys on #fsf told me a long time ago - IANAL, needless to say :)



---

archive/issue_comments_154495.json:
```json
{
    "body": "Replying to [comment:26 jdemeyer]:\n> In the doc patch: the command\n> \n> ```\n> sage -sh ccache --max-size=SIZE\n> ```\n> surely isn't correct.\n\nYou are right, I could have sworn that worked. Updating the patch now...",
    "created_at": "2012-06-20T09:26:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154495",
    "user": "https://github.com/ohanar"
}
```

Replying to [comment:26 jdemeyer]:
> In the doc patch: the command
> 
> ```
> sage -sh ccache --max-size=SIZE
> ```
> surely isn't correct.

You are right, I could have sworn that worked. Updating the patch now...



---

archive/issue_comments_154496.json:
```json
{
    "body": "Updated to 3.1.8 and removed fuzz. Otherwise, everything still works fine...",
    "created_at": "2012-09-12T03:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154496",
    "user": "https://github.com/ohanar"
}
```

Updated to 3.1.8 and removed fuzz. Otherwise, everything still works fine...



---

archive/issue_comments_154497.json:
```json
{
    "body": "If `ccache` is only installed conditionally, why not make it an *optional* package?",
    "created_at": "2012-09-12T06:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154497",
    "user": "https://github.com/jdemeyer"
}
```

If `ccache` is only installed conditionally, why not make it an *optional* package?



---

archive/issue_comments_154498.json:
```json
{
    "body": "Replying to [comment:30 jdemeyer]:\n> If `ccache` is only installed conditionally, why not make it an *optional* package?\n\nThat's quite true. Maybe the ccache package can be downloaded automatically if the user sets the ccache flags in the environment. This will ensure that the distributed Sage sources does not increase in size.",
    "created_at": "2012-09-12T06:34:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154498",
    "user": "https://github.com/ppurka"
}
```

Replying to [comment:30 jdemeyer]:
> If `ccache` is only installed conditionally, why not make it an *optional* package?

That's quite true. Maybe the ccache package can be downloaded automatically if the user sets the ccache flags in the environment. This will ensure that the distributed Sage sources does not increase in size.



---

archive/issue_comments_154499.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-09-12T07:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154499",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_154500.json:
```json
{
    "body": "We can make it optional -- the only changes necessary would be in the merging process (just don't bundle the spkg) and the documentation. The reason I was making it standard was because it will be needed for fast recompiles when switching branches in got,  but for now we don't do branching, so it doesn't need to be standard.",
    "created_at": "2012-09-12T07:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154500",
    "user": "https://github.com/ohanar"
}
```

We can make it optional -- the only changes necessary would be in the merging process (just don't bundle the spkg) and the documentation. The reason I was making it standard was because it will be needed for fast recompiles when switching branches in got,  but for now we don't do branching, so it doesn't need to be standard.



---

archive/issue_comments_154501.json:
```json
{
    "body": "Attachment [trac13032_doc.patch](tarball://root/attachments/some-uuid/ticket13032/trac13032_doc.patch) by @ohanar created at 2012-09-12 21:24:44\n\napply to sage library",
    "created_at": "2012-09-12T21:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154501",
    "user": "https://github.com/ohanar"
}
```

Attachment [trac13032_doc.patch](tarball://root/attachments/some-uuid/ticket13032/trac13032_doc.patch) by @ohanar created at 2012-09-12 21:24:44

apply to sage library



---

archive/issue_comments_154502.json:
```json
{
    "body": "Ok, updated the documentation.",
    "created_at": "2012-09-12T21:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154502",
    "user": "https://github.com/ohanar"
}
```

Ok, updated the documentation.



---

archive/issue_comments_154503.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-09-12T21:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154503",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_154504.json:
```json
{
    "body": "apply to root repo",
    "created_at": "2012-09-12T23:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154504",
    "user": "https://github.com/ohanar"
}
```

apply to root repo



---

archive/issue_comments_154505.json:
```json
{
    "body": "Attachment [trac13032_root.patch](tarball://root/attachments/some-uuid/ticket13032/trac13032_root.patch) by @ohanar created at 2012-09-12 23:43:15\n\nActually it turns out you have to make a bit of a hack to make it optional while integrating with the build system (since part of the point is that you would want it to cache as much of the build as possible).\n\nI've been working with the git layout too much, where it is easy to get to the point of `newest_version` working, but where `sage-spkg` can't find the spkgs, so it tries to download them all (problem here is that `newest_version` relies on the spkg being included with the sources).",
    "created_at": "2012-09-12T23:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154505",
    "user": "https://github.com/ohanar"
}
```

Attachment [trac13032_root.patch](tarball://root/attachments/some-uuid/ticket13032/trac13032_root.patch) by @ohanar created at 2012-09-12 23:43:15

Actually it turns out you have to make a bit of a hack to make it optional while integrating with the build system (since part of the point is that you would want it to cache as much of the build as possible).

I've been working with the git layout too much, where it is easy to get to the point of `newest_version` working, but where `sage-spkg` can't find the spkgs, so it tries to download them all (problem here is that `newest_version` relies on the spkg being included with the sources).



---

archive/issue_comments_154506.json:
```json
{
    "body": "It's working nice. I downloaded 5.4beta1 and started the compilation with ccache enabled. Then I canceled the compilation after some time and ran `make distclean` and restarted all over again. Stuff that was previously compiled was flying by really fast. :)\n\nI will have to see how much it improves when there is an upgrade.",
    "created_at": "2012-09-13T02:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154506",
    "user": "https://github.com/ppurka"
}
```

It's working nice. I downloaded 5.4beta1 and started the compilation with ccache enabled. Then I canceled the compilation after some time and ran `make distclean` and restarted all over again. Stuff that was previously compiled was flying by really fast. :)

I will have to see how much it improves when there is an upgrade.



---

archive/issue_comments_154507.json:
```json
{
    "body": "A general question. How can I upgrade my installation with this patch in place? Trying to upgrade modifies some files in `SAGE_ROOT` and then the upgrade fails with the following message\n\n```\nSuccessfully installed pynac-0.2.5\nDeleting temporary build directory\n/home/punarbasu/Installations/sage-5.4.beta1/spkg/build/pynac-0.2.5\nMaking Python scripts relocatable...\nFinished installing pynac-0.2.5.spkg\nmake[1]: Leaving directory `/home/punarbasu/Installations/sage-5.4.beta1/spkg'\nmake: *** [all] Error 2\n\nreal    0m49.350s\nuser    0m59.432s\nsys     0m7.064s\nError building Sage.\nError installing Sage!\nDouble checking that all packages have been installed.\nDownloading packages from 'http://jambu.spms.ntu.edu.sg/sage/devel/sage-5.4.rc1/spkg'.\nReading package lists...  Done!\nThe following packages will be upgraded:\n\n    conway_polynomials-0.3 elliptic_curves-0.7 extcode-5.4.rc1\n    gcc-4.6.3 graphs-20120404.p4 polytopes_db-20100210.p2 r-2.14.0.p6\n    sage-5.4.rc1 sage_root-5.4.rc1 sage_scripts-5.4.rc1\n\n ** WARNING: This is a source-based upgrade, which could take hours,\n ** fail, and render your Sage install useless!!\n\nDo you want to continue [y/N]? y\nThere are uncommitted changes in the Sage root repository:\nM spkg/install\nM spkg/standard/deps\n\nAborting.\n```",
    "created_at": "2012-10-11T11:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154507",
    "user": "https://github.com/ppurka"
}
```

A general question. How can I upgrade my installation with this patch in place? Trying to upgrade modifies some files in `SAGE_ROOT` and then the upgrade fails with the following message

```
Successfully installed pynac-0.2.5
Deleting temporary build directory
/home/punarbasu/Installations/sage-5.4.beta1/spkg/build/pynac-0.2.5
Making Python scripts relocatable...
Finished installing pynac-0.2.5.spkg
make[1]: Leaving directory `/home/punarbasu/Installations/sage-5.4.beta1/spkg'
make: *** [all] Error 2

real    0m49.350s
user    0m59.432s
sys     0m7.064s
Error building Sage.
Error installing Sage!
Double checking that all packages have been installed.
Downloading packages from 'http://jambu.spms.ntu.edu.sg/sage/devel/sage-5.4.rc1/spkg'.
Reading package lists...  Done!
The following packages will be upgraded:

    conway_polynomials-0.3 elliptic_curves-0.7 extcode-5.4.rc1
    gcc-4.6.3 graphs-20120404.p4 polytopes_db-20100210.p2 r-2.14.0.p6
    sage-5.4.rc1 sage_root-5.4.rc1 sage_scripts-5.4.rc1

 ** WARNING: This is a source-based upgrade, which could take hours,
 ** fail, and render your Sage install useless!!

Do you want to continue [y/N]? y
There are uncommitted changes in the Sage root repository:
M spkg/install
M spkg/standard/deps

Aborting.
```



---

archive/issue_comments_154508.json:
```json
{
    "body": "Unfortunately, ccache doesn't help very much in the compilation of a new Sage tarball. Most of the time is taken up by ATLAS. I have a failed build of 5.4.rc4 here that failed at ATLAS, after a total compilation time of just over 3 hours.\n\n```\nreal\t187m47.272s\nuser\t236m57.749s\nsys\t12m48.248s\nError building Sage.\nmake: *** [build] Error 1\n  14218.03s user 771.96s system 133% cpu 3:07:48.73 total\n```\n\nEDIT: In comparison, a successful build of sage (make build) takes just over 4 hours.",
    "created_at": "2012-11-09T16:45:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154508",
    "user": "https://github.com/ppurka"
}
```

Unfortunately, ccache doesn't help very much in the compilation of a new Sage tarball. Most of the time is taken up by ATLAS. I have a failed build of 5.4.rc4 here that failed at ATLAS, after a total compilation time of just over 3 hours.

```
real	187m47.272s
user	236m57.749s
sys	12m48.248s
Error building Sage.
make: *** [build] Error 1
  14218.03s user 771.96s system 133% cpu 3:07:48.73 total
```

EDIT: In comparison, a successful build of sage (make build) takes just over 4 hours.



---

archive/issue_comments_154509.json:
```json
{
    "body": "I never build ATLAS, so I can't comment on how well ccache works with it, but I don't really think it matters much since everyone who would gain any sort of benefit from ccache should already be using `SAGE_ATLAS_LIB`. I do know that R seems to not get much out of ccache though.",
    "created_at": "2012-11-09T17:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154509",
    "user": "https://github.com/ohanar"
}
```

I never build ATLAS, so I can't comment on how well ccache works with it, but I don't really think it matters much since everyone who would gain any sort of benefit from ccache should already be using `SAGE_ATLAS_LIB`. I do know that R seems to not get much out of ccache though.



---

archive/issue_comments_154510.json:
```json
{
    "body": "I am installing a system ATLAS now. I have been bitten a bit too many times with failing ATLAS builds with sage. It's not a fault of sage; it is probably that the laptop overheats or something. It builds fine on a desktop.\n\nThat said, the root patch needs to be rebased on sage-5.4.rc. The rebased patch is [available here](https://github.com/ppurka/sage-patches/blob/master/sage_root/trac13032_root.1.patch). I forgot to upload it, but maybe you can take that, rename it, and upload it here, as the original file name.",
    "created_at": "2012-11-09T17:51:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154510",
    "user": "https://github.com/ppurka"
}
```

I am installing a system ATLAS now. I have been bitten a bit too many times with failing ATLAS builds with sage. It's not a fault of sage; it is probably that the laptop overheats or something. It builds fine on a desktop.

That said, the root patch needs to be rebased on sage-5.4.rc. The rebased patch is [available here](https://github.com/ppurka/sage-patches/blob/master/sage_root/trac13032_root.1.patch). I forgot to upload it, but maybe you can take that, rename it, and upload it here, as the original file name.



---

archive/issue_comments_154511.json:
```json
{
    "body": "Replying to [comment:37 ppurka]:\n> Unfortunately, ccache doesn't help very much in the compilation of a new Sage tarball. Most of the time is taken up by ATLAS. I have a failed build of 5.4.rc4 here that failed at ATLAS, after a total compilation time of just over 3 hours.\n> \n> ```\n> real\t187m47.272s\n> user\t236m57.749s\n> sys\t12m48.248s\n> Error building Sage.\n> make: *** [build] Error 1\n>   14218.03s user 771.96s system 133% cpu 3:07:48.73 total\n> ```\n> \n> EDIT: In comparison, a successful build of sage (make build) takes just over 4 hours.\n\n\nJust to check, cchache is shared across sage builds, right?\n\nRegarding ATLAS, ideally most people will either be using a system build or match one of the pre-shipped tuning parameters.",
    "created_at": "2012-11-09T18:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154511",
    "user": "https://github.com/robertwb"
}
```

Replying to [comment:37 ppurka]:
> Unfortunately, ccache doesn't help very much in the compilation of a new Sage tarball. Most of the time is taken up by ATLAS. I have a failed build of 5.4.rc4 here that failed at ATLAS, after a total compilation time of just over 3 hours.
> 
> ```
> real	187m47.272s
> user	236m57.749s
> sys	12m48.248s
> Error building Sage.
> make: *** [build] Error 1
>   14218.03s user 771.96s system 133% cpu 3:07:48.73 total
> ```
> 
> EDIT: In comparison, a successful build of sage (make build) takes just over 4 hours.


Just to check, cchache is shared across sage builds, right?

Regarding ATLAS, ideally most people will either be using a system build or match one of the pre-shipped tuning parameters.



---

archive/issue_comments_154512.json:
```json
{
    "body": "Replying to [comment:40 robertwb]:\n> Just to check, cchache is shared across sage builds, right?\n\n\nYes. It is shared across different installations.",
    "created_at": "2012-11-09T18:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154512",
    "user": "https://github.com/ppurka"
}
```

Replying to [comment:40 robertwb]:
> Just to check, cchache is shared across sage builds, right?


Yes. It is shared across different installations.



---

archive/issue_comments_154513.json:
```json
{
    "body": "Apply to SAGE_ROOT",
    "created_at": "2012-12-26T05:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154513",
    "user": "https://github.com/ppurka"
}
```

Apply to SAGE_ROOT



---

archive/issue_comments_154514.json:
```json
{
    "body": "Attachment [trac13032_root.1.patch](tarball://root/attachments/some-uuid/ticket13032/trac13032_root.1.patch) by @ppurka created at 2012-12-26 05:40:17\n\nThis has been working fine for me for several months already. Setting it to positive review.\n\nI updated the root patch to apply to more recent sage (since sage-5.5beta onwards).",
    "created_at": "2012-12-26T05:40:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154514",
    "user": "https://github.com/ppurka"
}
```

Attachment [trac13032_root.1.patch](tarball://root/attachments/some-uuid/ticket13032/trac13032_root.1.patch) by @ppurka created at 2012-12-26 05:40:17

This has been working fine for me for several months already. Setting it to positive review.

I updated the root patch to apply to more recent sage (since sage-5.5beta onwards).



---

archive/issue_comments_154515.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-12-26T05:40:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154515",
    "user": "https://github.com/ppurka"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_154516.json:
```json
{
    "body": "Thanks, Basu!",
    "created_at": "2012-12-26T05:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154516",
    "user": "https://github.com/kini"
}
```

Thanks, Basu!



---

archive/issue_comments_154517.json:
```json
{
    "body": "Why this:\n\n```\nif [ -z \"$CCACHE_DIR\" ]; then \n    CCACHE_DIR=\"$DOT_SAGE/ccache\" \nfi \nif [ -z \"$CYCACHE_DIR\" ]; then \n    CYCACHE_DIR=\"$DOT_SAGE/cycache\" \nfi \n```\n\nWhy not use the default directories?",
    "created_at": "2012-12-26T13:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154517",
    "user": "https://github.com/jdemeyer"
}
```

Why this:

```
if [ -z "$CCACHE_DIR" ]; then 
    CCACHE_DIR="$DOT_SAGE/ccache" 
fi 
if [ -z "$CYCACHE_DIR" ]; then 
    CYCACHE_DIR="$DOT_SAGE/cycache" 
fi 
```

Why not use the default directories?



---

archive/issue_comments_154518.json:
```json
{
    "body": "Replying to [comment:45 jdemeyer]:\n> Why not use the default directories?\n\nBecause it keeps the sage files in a fixed sage directory instead of the home directory of the user. The default sizes of those directories are huge (4G) and are needed because Sage itself is huge. I am already using 3.5G of that.\n\n```\n~/.sage/ccache\u00bb du -sh .\n3.5G\t.\n```",
    "created_at": "2012-12-26T13:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154518",
    "user": "https://github.com/ppurka"
}
```

Replying to [comment:45 jdemeyer]:
> Why not use the default directories?

Because it keeps the sage files in a fixed sage directory instead of the home directory of the user. The default sizes of those directories are huge (4G) and are needed because Sage itself is huge. I am already using 3.5G of that.

```
~/.sage/ccache» du -sh .
3.5G	.
```



---

archive/issue_comments_154519.json:
```json
{
    "body": "Changing component from build to optional packages.",
    "created_at": "2012-12-26T16:19:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154519",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from build to optional packages.



---

archive/issue_comments_154520.json:
```json
{
    "body": "ccache spkg is on the server",
    "created_at": "2012-12-26T17:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154520",
    "user": "https://github.com/haraldschilly"
}
```

ccache spkg is on the server



---

archive/issue_comments_154521.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-12-29T19:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154521",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_035704.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-29T19:31:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12860#event-35704"
}
```



---

archive/issue_comments_154522.json:
```json
{
    "body": "I still don't quite like how this patch uses a separate `CCACHE_DIR` inside `.sage`.  Because now, I have:\n\n```\n$ ccache -s\ncache directory                     /home/jdemeyer/.ccache\n[...]\ncache size                           3.2 Gbytes\nmax cache size                       4.0 Gbytes\n```\n\n```\n$ ./sage --sh\n(sage-sh) ccache -s\ncache directory                     /home/jdemeyer/.sage//ccache\n[...]\ncache size                         935.1 Mbytes\nmax cache size                       1.0 Gbytes\n```\n\nI would like to have just one `.ccache` directory, especially since my default ccache dir is already used for Sage.  I don't think we should add 1GB of data inside the home directories of unsuspecting users.\n\nAlso note that the default size of 1GB is too little anyway to be useful for Sage.",
    "created_at": "2013-01-08T11:25:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154522",
    "user": "https://github.com/jdemeyer"
}
```

I still don't quite like how this patch uses a separate `CCACHE_DIR` inside `.sage`.  Because now, I have:

```
$ ccache -s
cache directory                     /home/jdemeyer/.ccache
[...]
cache size                           3.2 Gbytes
max cache size                       4.0 Gbytes
```

```
$ ./sage --sh
(sage-sh) ccache -s
cache directory                     /home/jdemeyer/.sage//ccache
[...]
cache size                         935.1 Mbytes
max cache size                       1.0 Gbytes
```

I would like to have just one `.ccache` directory, especially since my default ccache dir is already used for Sage.  I don't think we should add 1GB of data inside the home directories of unsuspecting users.

Also note that the default size of 1GB is too little anyway to be useful for Sage.



---

archive/issue_comments_154523.json:
```json
{
    "body": "You can of course have only one ccache dir. In that case, simply define the environment variable `CCACHE_DIR` in your shell rc file. Then everything will use that directory. The default is set for those people who don't bother with setting up ccache variables.\n\n```\n~\u00bb sage --sh\n\nStarting subshell with Sage environment variables set.  Don't forget\nto exit when you are done.  Beware:\n * Do not do anything with other copies of Sage on your system.\n * Do not use this for installing Sage packages using \"sage -i\" or for\n   running \"make\" at Sage's root directory.  These should be done\n   outside the Sage shell.\n\nBypassing shell configuration files...\n\nNote: SAGE_ROOT=/home/punarbasu/Installations/sage-5.6.beta1\n~\u00bb ccache -s\ncache directory                     /home/punarbasu/.sage//ccache\ncache hit (direct)                  1620\ncache hit (preprocessed)           13825\ncache miss                         16881\ncalled for link                     3066\ncalled for preprocessing            1553\nmultiple source files                 20\ncompiler produced stdout               2\ncompile failed                       389\npreprocessor error                   236\nbad compiler arguments               285\nunsupported source language         1214\nautoconf compile/link               3228\nunsupported compiler option          786\nno input file                       1345\nfiles in cache                     53031\ncache size                           2.7 Gbytes\nmax cache size                       4.0 Gbytes\n~\u00bb\nExited Sage subshell.\n\n\n\n~\u00bb export CCACHE_DIR=$HOME/.ccache\n~\u00bb sage --sh\n\nStarting subshell with Sage environment variables set.  Don't forget\nto exit when you are done.  Beware:\n * Do not do anything with other copies of Sage on your system.\n * Do not use this for installing Sage packages using \"sage -i\" or for\n   running \"make\" at Sage's root directory.  These should be done\n   outside the Sage shell.\n\nBypassing shell configuration files...\n\nNote: SAGE_ROOT=/home/punarbasu/Installations/sage-5.6.beta1\n~\u00bb ccache -s\ncache directory                     /home/punarbasu/.ccache\ncache hit (direct)                     0\ncache hit (preprocessed)               0\ncache miss                             0\nfiles in cache                         0\ncache size                             0 Kbytes\nmax cache size                       1.0 Gbytes\n```",
    "created_at": "2013-01-08T13:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154523",
    "user": "https://github.com/ppurka"
}
```

You can of course have only one ccache dir. In that case, simply define the environment variable `CCACHE_DIR` in your shell rc file. Then everything will use that directory. The default is set for those people who don't bother with setting up ccache variables.

```
~» sage --sh

Starting subshell with Sage environment variables set.  Don't forget
to exit when you are done.  Beware:
 * Do not do anything with other copies of Sage on your system.
 * Do not use this for installing Sage packages using "sage -i" or for
   running "make" at Sage's root directory.  These should be done
   outside the Sage shell.

Bypassing shell configuration files...

Note: SAGE_ROOT=/home/punarbasu/Installations/sage-5.6.beta1
~» ccache -s
cache directory                     /home/punarbasu/.sage//ccache
cache hit (direct)                  1620
cache hit (preprocessed)           13825
cache miss                         16881
called for link                     3066
called for preprocessing            1553
multiple source files                 20
compiler produced stdout               2
compile failed                       389
preprocessor error                   236
bad compiler arguments               285
unsupported source language         1214
autoconf compile/link               3228
unsupported compiler option          786
no input file                       1345
files in cache                     53031
cache size                           2.7 Gbytes
max cache size                       4.0 Gbytes
~»
Exited Sage subshell.



~» export CCACHE_DIR=$HOME/.ccache
~» sage --sh

Starting subshell with Sage environment variables set.  Don't forget
to exit when you are done.  Beware:
 * Do not do anything with other copies of Sage on your system.
 * Do not use this for installing Sage packages using "sage -i" or for
   running "make" at Sage's root directory.  These should be done
   outside the Sage shell.

Bypassing shell configuration files...

Note: SAGE_ROOT=/home/punarbasu/Installations/sage-5.6.beta1
~» ccache -s
cache directory                     /home/punarbasu/.ccache
cache hit (direct)                     0
cache hit (preprocessed)               0
cache miss                             0
files in cache                         0
cache size                             0 Kbytes
max cache size                       1.0 Gbytes
```



---

archive/issue_comments_154524.json:
```json
{
    "body": "Replying to [comment:51 ppurka]:\n> The default is set for those people who don't bother with setting up ccache variables.\n\nNot really.  I didn't bother setting `CCACHE_DIR` (since I like the default) but I don't like this ticket's defaults.  It makes it harder to configure ccache for example (it needs to be done inside a Sage shell) and I still don't understand why somebody would want a separate ccache directory for Sage.",
    "created_at": "2013-01-08T15:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154524",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:51 ppurka]:
> The default is set for those people who don't bother with setting up ccache variables.

Not really.  I didn't bother setting `CCACHE_DIR` (since I like the default) but I don't like this ticket's defaults.  It makes it harder to configure ccache for example (it needs to be done inside a Sage shell) and I still don't understand why somebody would want a separate ccache directory for Sage.



---

archive/issue_comments_154525.json:
```json
{
    "body": "Maybe there should be a new environment variable `SAGE_CCACHE_DIR`. If it's not set (the default), then use `CCACHE_DIR`. Otherwise, use it, in case someone wants to use a separate ccache directory for Sage.\n\nppurka, you also didn't address the comment about 1GB being \"too little anyway to be useful for Sage\".",
    "created_at": "2013-01-08T16:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154525",
    "user": "https://github.com/jhpalmieri"
}
```

Maybe there should be a new environment variable `SAGE_CCACHE_DIR`. If it's not set (the default), then use `CCACHE_DIR`. Otherwise, use it, in case someone wants to use a separate ccache directory for Sage.

ppurka, you also didn't address the comment about 1GB being "too little anyway to be useful for Sage".



---

archive/issue_comments_154526.json:
```json
{
    "body": "I don't think we should introduce yet another environment variable. Users wishing to set a Sage-only ccache dir can use [.sage/sagerc](http://sagemath.org/doc/reference/startup.html#the-sagerc-shell-script)",
    "created_at": "2013-01-08T16:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154526",
    "user": "https://github.com/jdemeyer"
}
```

I don't think we should introduce yet another environment variable. Users wishing to set a Sage-only ccache dir can use [.sage/sagerc](http://sagemath.org/doc/reference/startup.html#the-sagerc-shell-script)



---

archive/issue_comments_154527.json:
```json
{
    "body": "I don't understand what the confusion is about. There are only two possibilities.\n1. If you set `CCACHE_DIR` in your shell's rc file, then that variable will be used and *none of your ccache settings will be changed*. Here is an example on a test account where I exported the setting `CCACHE_DIR=~/.ccache` explicitly before compiling sage. Then I stopped the compilation of sage midway and looked at the output of `ccache -s` from a different terminal. All of this is outside of sage shell.\n\n```\ntest@ub2 ~ $ ccache -s\ncache directory                     /tmp/test/.ccache\ncache hit (direct)                     1\ncache hit (preprocessed)               2\ncache miss                           139\ncalled for link                        3\ncalled for preprocessing              46\ncompile failed                         5\npreprocessor error                     5\nbad compiler arguments                 4\nautoconf compile/link                 75\nno input file                         18\nfiles in cache                       288\ncache size                           3.6 Mbytes\nmax cache size                       1.0 Gbytes\n```\n2. If you do not provide a ccache setting at all, then the package sets the ccache size and the ccache directory to some defaults. Since, you are not showing any preference here, the ccache directory is set to ~/.sage/ccache and the size is set to 4G. All sage related stuff is in one single directory ~/.sage by default - I don't understand why we should go out of our way to mix it with user's own settings in their home directories.",
    "created_at": "2013-01-09T07:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154527",
    "user": "https://github.com/ppurka"
}
```

I don't understand what the confusion is about. There are only two possibilities.
1. If you set `CCACHE_DIR` in your shell's rc file, then that variable will be used and *none of your ccache settings will be changed*. Here is an example on a test account where I exported the setting `CCACHE_DIR=~/.ccache` explicitly before compiling sage. Then I stopped the compilation of sage midway and looked at the output of `ccache -s` from a different terminal. All of this is outside of sage shell.

```
test@ub2 ~ $ ccache -s
cache directory                     /tmp/test/.ccache
cache hit (direct)                     1
cache hit (preprocessed)               2
cache miss                           139
called for link                        3
called for preprocessing              46
compile failed                         5
preprocessor error                     5
bad compiler arguments                 4
autoconf compile/link                 75
no input file                         18
files in cache                       288
cache size                           3.6 Mbytes
max cache size                       1.0 Gbytes
```
2. If you do not provide a ccache setting at all, then the package sets the ccache size and the ccache directory to some defaults. Since, you are not showing any preference here, the ccache directory is set to ~/.sage/ccache and the size is set to 4G. All sage related stuff is in one single directory ~/.sage by default - I don't understand why we should go out of our way to mix it with user's own settings in their home directories.



---

archive/issue_comments_154528.json:
```json
{
    "body": "Replying to [comment:55 ppurka]:\n> If you do not provide a ccache setting at all [...] the size is set to 4G.\n\nThat's already false, [the default is 1GB](http://ccache.samba.org/manual.html#_cache_size_management).\n\n> All sage related stuff is in one single directory ~/.sage by default - I don't understand why we should go out of our way to mix it with user's own settings in their home directories.\n\nBecause I don't consider cache compilation files to be Sage-related.\n\nImagine I want to compile a package X outside of Sage, a package which happens to be part of Sage (I do that with PARI for example). Then it's a pity that the cached object files for package X appear twice in my home directory: once in `.ccache` and once in `.sage`.\n\nMy problem really boils down to this: why would you want a separate ccache directory for Sage?",
    "created_at": "2013-01-09T08:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154528",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:55 ppurka]:
> If you do not provide a ccache setting at all [...] the size is set to 4G.

That's already false, [the default is 1GB](http://ccache.samba.org/manual.html#_cache_size_management).

> All sage related stuff is in one single directory ~/.sage by default - I don't understand why we should go out of our way to mix it with user's own settings in their home directories.

Because I don't consider cache compilation files to be Sage-related.

Imagine I want to compile a package X outside of Sage, a package which happens to be part of Sage (I do that with PARI for example). Then it's a pity that the cached object files for package X appear twice in my home directory: once in `.ccache` and once in `.sage`.

My problem really boils down to this: why would you want a separate ccache directory for Sage?



---

archive/issue_comments_154529.json:
```json
{
    "body": "Replying to [comment:55 ppurka]:\n> Since, you are not showing any preference here\n\nI would say that, by not setting `CCACHE_DIR`, I am showing a preference for the default ccache directory `$HOME/.ccache`\n\nI think that setting a variable explicitly to its default value should be the same as not setting it at all.",
    "created_at": "2013-01-09T08:53:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154529",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:55 ppurka]:
> Since, you are not showing any preference here

I would say that, by not setting `CCACHE_DIR`, I am showing a preference for the default ccache directory `$HOME/.ccache`

I think that setting a variable explicitly to its default value should be the same as not setting it at all.



---

archive/issue_comments_154530.json:
```json
{
    "body": "Replying to [comment:56 jdemeyer]:\n> Replying to [comment:55 ppurka]:\n> > If you do not provide a ccache setting at all [...] the size is set to 4G.\n\n> That's already false, [the default is 1GB](http://ccache.samba.org/manual.html#_cache_size_management).\n\nI must reiterate. **If** you don't provide any ccache directory settings at all, then [attachment:trac13032_doc.patch it is set to 4GB] with this ticket/spkg.\n\n> Imagine I want to compile a package X outside of Sage, a package which happens to be part of Sage (I do that with PARI for example). Then it's a pity that the cached object files for package X appear twice in my home directory: once in `.ccache` and once in `.sage`.\n\n\nWell, then you set your ccache environment variable appropriately. To use ccache while compiling with sage you need to set `SAGE_INSTALL_CCACHE=yes` in your environment variable. Then, it will use whatever ccache directory you have set and otherwise it will use the default of ~/.sage/ccache.\n \n> My problem really boils down to this: why would you want a separate ccache directory for Sage?\n\n\nIn fact, one question that I would ask is - what other sage setting is present outside the ~/.sage directory? If there is, then it makes sense to mix and match sage specific settings and folders with system/user specific settings.",
    "created_at": "2013-01-09T09:06:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154530",
    "user": "https://github.com/ppurka"
}
```

Replying to [comment:56 jdemeyer]:
> Replying to [comment:55 ppurka]:
> > If you do not provide a ccache setting at all [...] the size is set to 4G.

> That's already false, [the default is 1GB](http://ccache.samba.org/manual.html#_cache_size_management).

I must reiterate. **If** you don't provide any ccache directory settings at all, then [attachment:trac13032_doc.patch it is set to 4GB] with this ticket/spkg.

> Imagine I want to compile a package X outside of Sage, a package which happens to be part of Sage (I do that with PARI for example). Then it's a pity that the cached object files for package X appear twice in my home directory: once in `.ccache` and once in `.sage`.


Well, then you set your ccache environment variable appropriately. To use ccache while compiling with sage you need to set `SAGE_INSTALL_CCACHE=yes` in your environment variable. Then, it will use whatever ccache directory you have set and otherwise it will use the default of ~/.sage/ccache.
 
> My problem really boils down to this: why would you want a separate ccache directory for Sage?


In fact, one question that I would ask is - what other sage setting is present outside the ~/.sage directory? If there is, then it makes sense to mix and match sage specific settings and folders with system/user specific settings.



---

archive/issue_comments_154531.json:
```json
{
    "body": "You might want to put this question to sage-devel if you haven't already. I think there might be people on both sides of the argument.\n\nOn the one hand I agree that setting a variable explicitly to its default value should be the same as not setting it at all. On the other hand, I feel like I'd want a separate ccache directory for Sage because I would like all Sage artifacts to be segregated from other stuff on my system, as they currently are by default. Currently, Sage will never modify anything outside its directory except `/tmp` and `$DOT_SAGE` unless you specifically write code that does so (right?). Not having a separate Sage ccache directory would add `~/.ccache` to the list.\n\nA compromise/workaround would be to, say, symlink `~/.sage/ccache` to `~/.ccache` manually if you want to share caches. Is this too much of a burden, do you think, Jeroen? The SPKG installer could print a message about this possibility, or something.",
    "created_at": "2013-01-09T09:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154531",
    "user": "https://github.com/kini"
}
```

You might want to put this question to sage-devel if you haven't already. I think there might be people on both sides of the argument.

On the one hand I agree that setting a variable explicitly to its default value should be the same as not setting it at all. On the other hand, I feel like I'd want a separate ccache directory for Sage because I would like all Sage artifacts to be segregated from other stuff on my system, as they currently are by default. Currently, Sage will never modify anything outside its directory except `/tmp` and `$DOT_SAGE` unless you specifically write code that does so (right?). Not having a separate Sage ccache directory would add `~/.ccache` to the list.

A compromise/workaround would be to, say, symlink `~/.sage/ccache` to `~/.ccache` manually if you want to share caches. Is this too much of a burden, do you think, Jeroen? The SPKG installer could print a message about this possibility, or something.



---

archive/issue_comments_154532.json:
```json
{
    "body": "Replying to [comment:58 ppurka]:\n> I must reiterate. **If** you don't provide any ccache directory settings at all, then [attachment:trac13032_doc.patch it is set to 4GB] with this ticket/spkg.\n\nOK, so it's something specific to **this spkg**. When using system ccache, I still get 1GB of cache inside `.sage`, even if I manually configured ccache to use 4GB.\n\n> To use ccache while compiling with sage you need to set `SAGE_INSTALL_CCACHE=yes` in your environment variable.\n\nAgain false, as a system ccache might be used.\n\n> In fact, one question that I would ask is - what other sage setting is present outside the ~/.sage directory? If there is, then it makes sense to mix and match sage specific settings and folders with system/user specific settings.\n\nProbably Sage's readline uses non-Sage-specific configuration files (`$HOME/.inputrc`).",
    "created_at": "2013-01-09T09:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154532",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:58 ppurka]:
> I must reiterate. **If** you don't provide any ccache directory settings at all, then [attachment:trac13032_doc.patch it is set to 4GB] with this ticket/spkg.

OK, so it's something specific to **this spkg**. When using system ccache, I still get 1GB of cache inside `.sage`, even if I manually configured ccache to use 4GB.

> To use ccache while compiling with sage you need to set `SAGE_INSTALL_CCACHE=yes` in your environment variable.

Again false, as a system ccache might be used.

> In fact, one question that I would ask is - what other sage setting is present outside the ~/.sage directory? If there is, then it makes sense to mix and match sage specific settings and folders with system/user specific settings.

Probably Sage's readline uses non-Sage-specific configuration files (`$HOME/.inputrc`).



---

archive/issue_comments_154533.json:
```json
{
    "body": "Replying to [comment:59 kini]:\n> A compromise/workaround would be to, say, symlink `~/.sage/ccache` to `~/.ccache` manually if you want to share caches. Is this too much of a burden, do you think, Jeroen? The SPKG installer could print a message about this possibility, or something.\n\nOf course it's not much burden for me, but what about other people in the same situation? This patch changes the ccache directory and the cache size *behind people's back* if they were using system ccache before. So this patch can make performance strictly worse without users being aware of it.",
    "created_at": "2013-01-09T09:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154533",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:59 kini]:
> A compromise/workaround would be to, say, symlink `~/.sage/ccache` to `~/.ccache` manually if you want to share caches. Is this too much of a burden, do you think, Jeroen? The SPKG installer could print a message about this possibility, or something.

Of course it's not much burden for me, but what about other people in the same situation? This patch changes the ccache directory and the cache size *behind people's back* if they were using system ccache before. So this patch can make performance strictly worse without users being aware of it.



---

archive/issue_comments_154534.json:
```json
{
    "body": "Replying to [comment:59 kini]:\n> Not having a separate Sage ccache directory would add `~/.ccache` to the list.\n\nWhich is a problem because ...........?",
    "created_at": "2013-01-09T09:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154534",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:59 kini]:
> Not having a separate Sage ccache directory would add `~/.ccache` to the list.

Which is a problem because ...........?



---

archive/issue_comments_154535.json:
```json
{
    "body": ">Probably Sage's readline uses non-Sage-specific configuration files (`$HOME/.inputrc`).\n\n\nDoes Sage *change* `~/.inputrc` or  just read it? Sage of course reads tons of files all over the system. An example of another dotfile in `~` that Sage (or Sage's Mercurial anyway) reads is `~/.hgrc`. But it will *change* `~/.ccache`.\n\n>Of course it's not much burden for me, but what about other people in the same situation?\n\n\nAs I said, we can print a note at the end of the SPKG installation process, or otherwise document it. I suspect that most users will not mind that the ccache directory `~/.sage/ccache` is used, and if they do, it is probably because they are already running ccache on their system and want to consolidate the cache directories together, so they're probably savvy enough to make a symlink.\n\n>This patch changes the ccache directory and the cache size *behind people's back* if they were using system ccache before.\n\n\nSage installs another copy of Python on the system \"behind people's back\" as well and nobody complains (or at least we don't listen to such complaints). I don't see the problem.\n\nAlso, maybe I am misunderstanding something. Are you saying that installing this SPKG into Sage will change the behavior of the system ccache running independently of Sage?\n\n>Which is a problem because ...........?\n\n\nFor one thing, it means more detritus around the system to clean up if you want to remove Sage from your system. And very large unwanted detritus at that, if the user doesn't have a system ccache. Of course, it's an optional package, so we can assume the user at least knows they have installed the ccache SPKG, but most users would expect that they can completely eradicate Sage and all its artifacts by deleting the Sage directory and `$DOT_SAGE`.\n\nAlso, this kind of lack of compartmentalization just seems unhygienic. I kind of don't like the idea of Sage interacting with and modifying data that belongs to other programs which I've installed systemwide. I like that Sage is a sandbox mini-distribution of software which is self-contained. (Or, at least that's the paradigm the official Sage distribution has conformed to so far, sage-on-gentoo and sage-on-debian notwithstanding.)",
    "created_at": "2013-01-09T09:48:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154535",
    "user": "https://github.com/kini"
}
```

>Probably Sage's readline uses non-Sage-specific configuration files (`$HOME/.inputrc`).


Does Sage *change* `~/.inputrc` or  just read it? Sage of course reads tons of files all over the system. An example of another dotfile in `~` that Sage (or Sage's Mercurial anyway) reads is `~/.hgrc`. But it will *change* `~/.ccache`.

>Of course it's not much burden for me, but what about other people in the same situation?


As I said, we can print a note at the end of the SPKG installation process, or otherwise document it. I suspect that most users will not mind that the ccache directory `~/.sage/ccache` is used, and if they do, it is probably because they are already running ccache on their system and want to consolidate the cache directories together, so they're probably savvy enough to make a symlink.

>This patch changes the ccache directory and the cache size *behind people's back* if they were using system ccache before.


Sage installs another copy of Python on the system "behind people's back" as well and nobody complains (or at least we don't listen to such complaints). I don't see the problem.

Also, maybe I am misunderstanding something. Are you saying that installing this SPKG into Sage will change the behavior of the system ccache running independently of Sage?

>Which is a problem because ...........?


For one thing, it means more detritus around the system to clean up if you want to remove Sage from your system. And very large unwanted detritus at that, if the user doesn't have a system ccache. Of course, it's an optional package, so we can assume the user at least knows they have installed the ccache SPKG, but most users would expect that they can completely eradicate Sage and all its artifacts by deleting the Sage directory and `$DOT_SAGE`.

Also, this kind of lack of compartmentalization just seems unhygienic. I kind of don't like the idea of Sage interacting with and modifying data that belongs to other programs which I've installed systemwide. I like that Sage is a sandbox mini-distribution of software which is self-contained. (Or, at least that's the paradigm the official Sage distribution has conformed to so far, sage-on-gentoo and sage-on-debian notwithstanding.)



---

archive/issue_comments_154536.json:
```json
{
    "body": "Replying to [comment:63 kini]:\n> Also, maybe I am misunderstanding something. Are you saying that installing this SPKG into Sage will change the behavior of the system ccache running independently of Sage?\n\nNo, that's not the case at all. The case I am considering is the opposite: **not** installing this SPKG into Sage but using a system-wide ccache.",
    "created_at": "2013-01-09T10:03:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154536",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:63 kini]:
> Also, maybe I am misunderstanding something. Are you saying that installing this SPKG into Sage will change the behavior of the system ccache running independently of Sage?

No, that's not the case at all. The case I am considering is the opposite: **not** installing this SPKG into Sage but using a system-wide ccache.



---

archive/issue_comments_154537.json:
```json
{
    "body": "Here is a proposal for a compromise: use `$HOME/.ccache` if using a system-wide ccache installation and use `$DOT_SAGE/ccache` if using Sage's `ccache`, which we test by\n\n```\nif [ -x \"$SAGE_LOCAL/bin/ccache\" ];\n```",
    "created_at": "2013-01-09T10:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154537",
    "user": "https://github.com/jdemeyer"
}
```

Here is a proposal for a compromise: use `$HOME/.ccache` if using a system-wide ccache installation and use `$DOT_SAGE/ccache` if using Sage's `ccache`, which we test by

```
if [ -x "$SAGE_LOCAL/bin/ccache" ];
```



---

archive/issue_comments_154538.json:
```json
{
    "body": "Replying to [comment:63 kini]:\n> I kind of don't like the idea of Sage interacting with and modifying data that belongs to other programs which I've installed systemwide.\n\nI'd argue that in this case, the interaction is a feature, not a bug.\n\n> And very large unwanted detritus at that, if the user doesn't have a system ccache\n\nBut I do have system-wide ccache. For me, this patch adds 1GB of extra detritus in `.sage/ccache` and actually **reduces performance** by using a smaller cache.",
    "created_at": "2013-01-09T10:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154538",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:63 kini]:
> I kind of don't like the idea of Sage interacting with and modifying data that belongs to other programs which I've installed systemwide.

I'd argue that in this case, the interaction is a feature, not a bug.

> And very large unwanted detritus at that, if the user doesn't have a system ccache

But I do have system-wide ccache. For me, this patch adds 1GB of extra detritus in `.sage/ccache` and actually **reduces performance** by using a smaller cache.



---

archive/issue_comments_154539.json:
```json
{
    "body": "I think what you are really asking about is\n\n*What should the zero-configuration scenario, even for advanced users, look like?*\n\nI count you as an advanced user since you are using a user-wide ccache, and you don't want sage to use any other ccache directory by default. On top of that, you want sage to use the ccache directory that you are already using, which may or may not be the default ccache directory.\n\nI think this question should be asked to the general audience in sage-devel. There might be people who keep the ~/.sage directory separate, along with the rest of their sage installation. For a heavy user of sage or for someone running a server, I can contemplate that the ~/.sage (or `DOT_SAGE`) will not be small and there might be people who are using a different (maybe mounted) directory that is separate from their home directory.",
    "created_at": "2013-01-09T10:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154539",
    "user": "https://github.com/ppurka"
}
```

I think what you are really asking about is

*What should the zero-configuration scenario, even for advanced users, look like?*

I count you as an advanced user since you are using a user-wide ccache, and you don't want sage to use any other ccache directory by default. On top of that, you want sage to use the ccache directory that you are already using, which may or may not be the default ccache directory.

I think this question should be asked to the general audience in sage-devel. There might be people who keep the ~/.sage directory separate, along with the rest of their sage installation. For a heavy user of sage or for someone running a server, I can contemplate that the ~/.sage (or `DOT_SAGE`) will not be small and there might be people who are using a different (maybe mounted) directory that is separate from their home directory.



---

archive/issue_comments_154540.json:
```json
{
    "body": "Replying to [comment:67 ppurka]:\n> I think this question should be asked to the general audience in sage-devel.\n\nDone.",
    "created_at": "2013-01-09T16:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154540",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:67 ppurka]:
> I think this question should be asked to the general audience in sage-devel.

Done.



---

archive/issue_comments_154541.json:
```json
{
    "body": "Since the spkg is pretty small, would it make sense to distribute it with Sage? It would still only be built if `SAGE_INSTALL_CCACHE` were set, so it would still be in some sense optional. But then one wouldn't need internet access when building Sage, and the install log for ccache would have a more informative name: it would include the version number.",
    "created_at": "2013-01-09T22:58:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154541",
    "user": "https://github.com/jhpalmieri"
}
```

Since the spkg is pretty small, would it make sense to distribute it with Sage? It would still only be built if `SAGE_INSTALL_CCACHE` were set, so it would still be in some sense optional. But then one wouldn't need internet access when building Sage, and the install log for ccache would have a more informative name: it would include the version number.



---

archive/issue_comments_154542.json:
```json
{
    "body": "Replying to [comment:69 jhpalmieri]:\n> Since the spkg is pretty small, would it make sense to distribute it with Sage? It would still only be built if `SAGE_INSTALL_CCACHE` were set, so it would still be in some sense optional.\n\nI don't mind.",
    "created_at": "2013-01-10T08:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154542",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:69 jhpalmieri]:
> Since the spkg is pretty small, would it make sense to distribute it with Sage? It would still only be built if `SAGE_INSTALL_CCACHE` were set, so it would still be in some sense optional.

I don't mind.



---

archive/issue_comments_154543.json:
```json
{
    "body": "I created a patch at #13938 to not set `CCACHE_DIR`, needs review.",
    "created_at": "2013-01-10T15:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12860",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12860#issuecomment-154543",
    "user": "https://github.com/jdemeyer"
}
```

I created a patch at #13938 to not set `CCACHE_DIR`, needs review.
