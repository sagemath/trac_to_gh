# Issue 23199: sum/product of immutable matrices is not immutable

Issue created by migration from https://trac.sagemath.org/ticket/23436

Original creator: dkrenn

Original creation time: 2017-07-14 15:25:46

CC:  galipnik

Keywords: matrix


```
sage: M = Matrix([[1,2],[3,4]]); M.set_immutable()
sage: N = Matrix([[2,2],[4,4]]); N.set_immutable()
sage: (M + N).is_immutable()
False
sage: (M * N).is_immutable()
False
```

This is counter-intuitive. The result should again be immutable.


---

Comment by jdemeyer created at 2017-07-15 08:33:29

For reference, this is how Python deals with it (`frozenset` being an immutable version of `set`):

```
>>> frozenset([1,2,3]) | frozenset([4,5,6])
frozenset({1, 2, 3, 4, 5, 6})
>>> frozenset([1,2,3]) | set([4,5,6])
frozenset({1, 2, 3, 4, 5, 6})
>>> set([1,2,3]) | frozenset([4,5,6])
{1, 2, 3, 4, 5, 6}
>>> set([1,2,3]) | set([4,5,6])
{1, 2, 3, 4, 5, 6}
```


So the mutability of `A | B` is taken from the mutability of `A`.


---

Comment by mcognetta created at 2017-07-25 17:20:51

Replying to [comment:2 jdemeyer]:
> For reference, this is how Python deals with it (`frozenset` being an immutable version of `set`):
> {{{
> >>> frozenset([1,2,3]) | frozenset([4,5,6])
> frozenset({1, 2, 3, 4, 5, 6})
> >>> frozenset([1,2,3]) | set([4,5,6])
> frozenset({1, 2, 3, 4, 5, 6})
> >>> set([1,2,3]) | frozenset([4,5,6])
> {1, 2, 3, 4, 5, 6}
> >>> set([1,2,3]) | set([4,5,6])
> {1, 2, 3, 4, 5, 6}
> }}}
> 
> So the mutability of `A | B` is taken from the mutability of `A`.

Is this the desired behavior or should it be that if either is immutable than the resultant should be as well? For example, this is how networkx handles a graph product of a undirected and directed graph (in either order).
