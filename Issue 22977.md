# Issue 22977: solving integer sparse linear system using LinBox

archive/issues_022977.json:
```json
{
    "body": "CC:  @ClementPernet @tscrim tmonteil\n\nLinBox has very efficient algorithms to solve linear systems. This ticket provides the necessary interface for solving sparse systems over integers.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23214\n\n",
    "created_at": "2017-06-11T07:39:09Z",
    "labels": [
        "linear algebra",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "solving integer sparse linear system using LinBox",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22977",
    "user": "@videlec"
}
```
CC:  @ClementPernet @tscrim tmonteil

LinBox has very efficient algorithms to solve linear systems. This ticket provides the necessary interface for solving sparse systems over integers.

Issue created by migration from https://trac.sagemath.org/ticket/23214





---

archive/issue_comments_321483.json:
```json
{
    "body": "Just to put in a plug for this, it would be very useful for various aspects of number theory, particularly dealing with Hecke operators which tend to be represented by sparse integer matrices.",
    "created_at": "2017-09-11T00:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321483",
    "user": "@kedlaya"
}
```

Just to put in a plug for this, it would be very useful for various aspects of number theory, particularly dealing with Hecke operators which tend to be represented by sparse integer matrices.



---

archive/issue_comments_321484.json:
```json
{
    "body": "And combinatorics and geomtry and ... just waiting for upstream [github issue 56](https://github.com/linbox-team/linbox/issues/56).",
    "created_at": "2017-09-11T05:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321484",
    "user": "@videlec"
}
```

And combinatorics and geomtry and ... just waiting for upstream [github issue 56](https://github.com/linbox-team/linbox/issues/56).



---

archive/issue_comments_321485.json:
```json
{
    "body": "That issue has been closed.  Are we waiting on a release?",
    "created_at": "2017-11-05T07:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321485",
    "user": "@roed314"
}
```

That issue has been closed.  Are we waiting on a release?



---

archive/issue_comments_321486.json:
```json
{
    "body": "Indeed, Cl\u00e9ment wrote on the github issue\n\n```\nNote that we're also planning on releasing all 3 libraries\nsoon (within a few weeks), and I'll create a sage ticket\nfor updating the spkg.\n```\n",
    "created_at": "2017-11-05T09:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321486",
    "user": "@videlec"
}
```

Indeed, Cl√©ment wrote on the github issue

```
Note that we're also planning on releasing all 3 libraries
soon (within a few weeks), and I'll create a sage ticket
for updating the spkg.
```




---

archive/issue_comments_321487.json:
```json
{
    "body": "FYI LinBox upgrade ticket is #24214.\nCurrent ticket already depends on it by transitivity with #23158.",
    "created_at": "2017-11-14T09:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321487",
    "user": "@ClementPernet"
}
```

FYI LinBox upgrade ticket is #24214.
Current ticket already depends on it by transitivity with #23158.



---

archive/issue_comments_321488.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-01T12:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321488",
    "user": "@videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_321489.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-05-01T12:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321489",
    "user": "@videlec"
}
```

New commits:



---

archive/issue_comments_321490.json:
```json
{
    "body": "This hangs forever\n\n```\nsage: m = diagonal_matrix(ZZ, 68, [2]*66 + [1,1])\nsage: type(m)\n<type 'sage.matrix.matrix_integer_sparse.Matrix_integer_sparse'>\nsage: m.det()\n```\n\n(from `matrix/matrix_integer_dense_hnf.py`)",
    "created_at": "2018-05-02T09:47:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321490",
    "user": "@videlec"
}
```

This hangs forever

```
sage: m = diagonal_matrix(ZZ, 68, [2]*66 + [1,1])
sage: type(m)
<type 'sage.matrix.matrix_integer_sparse.Matrix_integer_sparse'>
sage: m.det()
```

(from `matrix/matrix_integer_dense_hnf.py`)



---

archive/issue_comments_321491.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-02T10:01:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321491",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321492.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-02T15:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321492",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321493.json:
```json
{
    "body": "\n```\nsage: Matrix(IntegerModRing(16), 3, 3, lambda i,j: i+j, sparse=True).determinant()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-2-2d0c9b09dcc5> in <module>()\n----> 1 Matrix(IntegerModRing(Integer(16)), Integer(3), Integer(3), lambda i,j: i+j, sparse=True).determinant()\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/matrix/matrix_modn_sparse.pyx in sage.matrix.matrix_modn_sparse.Matrix_modn_sparse.determinant (build/cythonized/sage/matrix/matrix_modn_sparse.cpp:10523)()\n    924 \n    925         if algorithm is None or algorithm == \"linbox\":\n--> 926             r, d = self._rank_det_linbox()\n    927             self.cache('rank', r)\n    928             self.cache('det', d)\n\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/matrix/matrix_modn_sparse.pyx in sage.matrix.matrix_modn_sparse.Matrix_modn_sparse._rank_det_linbox (build/cythonized/sage/matrix/matrix_modn_sparse.cpp:9553)()\n    766 \n    767         if not is_prime(self.p):\n--> 768             raise TypeError(\"only GF(p) supported via LinBox\")\n    769 \n    770         cdef Modular_int64 * F = new Modular_int64(self.p)\n\nTypeError: only GF(p) supported via LinBox\n```\n",
    "created_at": "2018-05-04T10:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321493",
    "user": "@jdemeyer"
}
```


```
sage: Matrix(IntegerModRing(16), 3, 3, lambda i,j: i+j, sparse=True).determinant()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-2-2d0c9b09dcc5> in <module>()
----> 1 Matrix(IntegerModRing(Integer(16)), Integer(3), Integer(3), lambda i,j: i+j, sparse=True).determinant()

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/matrix/matrix_modn_sparse.pyx in sage.matrix.matrix_modn_sparse.Matrix_modn_sparse.determinant (build/cythonized/sage/matrix/matrix_modn_sparse.cpp:10523)()
    924 
    925         if algorithm is None or algorithm == "linbox":
--> 926             r, d = self._rank_det_linbox()
    927             self.cache('rank', r)
    928             self.cache('det', d)

/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/matrix/matrix_modn_sparse.pyx in sage.matrix.matrix_modn_sparse.Matrix_modn_sparse._rank_det_linbox (build/cythonized/sage/matrix/matrix_modn_sparse.cpp:9553)()
    766 
    767         if not is_prime(self.p):
--> 768             raise TypeError("only GF(p) supported via LinBox")
    769 
    770         cdef Modular_int64 * F = new Modular_int64(self.p)

TypeError: only GF(p) supported via LinBox
```




---

archive/issue_comments_321494.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-05-04T10:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321494",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_321495.json:
```json
{
    "body": "Changing keywords from \"\" to \"linbox\".",
    "created_at": "2018-06-26T14:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321495",
    "user": "@fchapoton"
}
```

Changing keywords from "" to "linbox".



---

archive/issue_comments_321496.json:
```json
{
    "body": "update milestone 8.3 -> 8.4",
    "created_at": "2018-08-03T19:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321496",
    "user": "@videlec"
}
```

update milestone 8.3 -> 8.4



---

archive/issue_comments_321497.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-09-02T19:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321497",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321498.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-09-02T19:05:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321498",
    "user": "@videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_321499.json:
```json
{
    "body": "patchbot is happy :-)",
    "created_at": "2018-09-02T20:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321499",
    "user": "@videlec"
}
```

patchbot is happy :-)



---

archive/issue_comments_321500.json:
```json
{
    "body": "Oops, I got this confused with the other needs review linbox ticket where compiling on OSX was an issue, I'll try them both out together now I guess.",
    "created_at": "2018-09-02T20:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321500",
    "user": "@alexjbest"
}
```

Oops, I got this confused with the other needs review linbox ticket where compiling on OSX was an issue, I'll try them both out together now I guess.



---

archive/issue_comments_321501.json:
```json
{
    "body": "`@`alexjbest: this ticket strictly contains the commit of the other one #24544.",
    "created_at": "2018-09-02T20:36:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321501",
    "user": "@videlec"
}
```

`@`alexjbest: this ticket strictly contains the commit of the other one #24544.



---

archive/issue_comments_321502.json:
```json
{
    "body": "Small typo (missing leading colon): `meth:`sage.matrix.matrix_sparse.Matrix_sparse.charpoly`` Otherwise I am happy with the current state (and will assume there are no failures on OSX).",
    "created_at": "2018-09-03T02:23:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321502",
    "user": "@tscrim"
}
```

Small typo (missing leading colon): `meth:`sage.matrix.matrix_sparse.Matrix_sparse.charpoly`` Otherwise I am happy with the current state (and will assume there are no failures on OSX).



---

archive/issue_comments_321503.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-03T02:26:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321503",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321504.json:
```json
{
    "body": "LGTM. Thanks. Alex, if you end up hitting an error during your testing, please revert.",
    "created_at": "2018-09-03T02:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321504",
    "user": "@tscrim"
}
```

LGTM. Thanks. Alex, if you end up hitting an error during your testing, please revert.



---

archive/issue_comments_321505.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-03T02:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321505",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_321506.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-09-05T22:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321506",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_321507.json:
```json
{
    "body": "Doesn't build on OSX:\n\n```\n[sagelib-8.4.beta3] In file included from build/cythonized/sage/matrix/matrix_integer_sparse.cpp:708:\n[sagelib-8.4.beta3] In file included from /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/matrix/dense-matrix.h:79:\n[sagelib-8.4.beta3] In file included from /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/matrix/densematrix/blas-matrix.h:44:\n[sagelib-8.4.beta3] /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/vector/blas-vector.h:306:11: error: member reference base type 'const long' is not a structure or union\n[sagelib-8.4.beta3]                         _size(V.size()),_1stride(1),_rep(V.size(), F.zero),_ptr(&_rep[0]),_field(&F)\n[sagelib-8.4.beta3]                               ~^~~~~\n[sagelib-8.4.beta3] build/cythonized/sage/matrix/matrix_integer_sparse.cpp:10932:21: note: in instantiation of function template specialization 'LinBox::BlasVector<Givaro::ZRing<Givaro::Integer>, std::__1::vector<Givaro::Integer, std::__1::allocator<Givaro::Integer> > >::BlasVector<long>' requested here\n[sagelib-8.4.beta3]   __pyx_v_res = new LinBox::DenseVector<Givaro::ZRing<Givaro::Integer>>(__pyx_v_givZZ, __pyx_v_self->__pyx_base.__pyx_base.__pyx_base.__pyx_base.__pyx_base._ncols);\n[sagelib-8.4.beta3]                     ^\n[sagelib-8.4.beta3] In file included from build/cythonized/sage/matrix/matrix_integer_sparse.cpp:708:\n[sagelib-8.4.beta3] In file included from /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/matrix/dense-matrix.h:79:\n[sagelib-8.4.beta3] In file included from /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/matrix/densematrix/blas-matrix.h:44:\n[sagelib-8.4.beta3] /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/vector/blas-vector.h:306:38: error: member reference base type 'const long' is not a structure or union\n[sagelib-8.4.beta3]                         _size(V.size()),_1stride(1),_rep(V.size(), F.zero),_ptr(&_rep[0]),_field(&F)\n[sagelib-8.4.beta3]                                                          ~^~~~~\n[sagelib-8.4.beta3] /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/vector/blas-vector.h:306:61: warning: field '_rep' is uninitialized when used here [-Wuninitialized]\n[sagelib-8.4.beta3]                         _size(V.size()),_1stride(1),_rep(V.size(), F.zero),_ptr(&_rep[0]),_field(&F)\n[sagelib-8.4.beta3]                                                                                  ^\n[sagelib-8.4.beta3] /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/vector/blas-vector.h:129:13: error: type 'long' cannot be used prior to '::' because it has no members\n[sagelib-8.4.beta3]                         typename OtherVector::const_iterator jt = V.begin();\n[sagelib-8.4.beta3]                                  ^\n[sagelib-8.4.beta3] /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/vector/blas-vector.h:311:4: note: in instantiation of function template specialization 'LinBox::BlasVector<Givaro::ZRing<Givaro::Integer>, std::__1::vector<Givaro::Integer, std::__1::allocator<Givaro::Integer> > >::createBlasVector<long>' requested here\n[sagelib-8.4.beta3]                         createBlasVector(V);\n[sagelib-8.4.beta3]                         ^\n[sagelib-8.4.beta3] build/cythonized/sage/matrix/matrix_integer_sparse.cpp:10932:21: note: in instantiation of function template specialization 'LinBox::BlasVector<Givaro::ZRing<Givaro::Integer>, std::__1::vector<Givaro::Integer, std::__1::allocator<Givaro::Integer> > >::BlasVector<long>' requested here\n[sagelib-8.4.beta3]   __pyx_v_res = new LinBox::DenseVector<Givaro::ZRing<Givaro::Integer>>(__pyx_v_givZZ, __pyx_v_self->__pyx_base.__pyx_base.__pyx_base.__pyx_base.__pyx_base._ncols);\n[sagelib-8.4.beta3]                     ^\n[sagelib-8.4.beta3] 8 warnings and 3 errors generated.\n[sagelib-8.4.beta3] error: command 'gcc' failed with exit status 1\n```\n",
    "created_at": "2018-09-05T22:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321507",
    "user": "@vbraun"
}
```

Doesn't build on OSX:

```
[sagelib-8.4.beta3] In file included from build/cythonized/sage/matrix/matrix_integer_sparse.cpp:708:
[sagelib-8.4.beta3] In file included from /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/matrix/dense-matrix.h:79:
[sagelib-8.4.beta3] In file included from /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/matrix/densematrix/blas-matrix.h:44:
[sagelib-8.4.beta3] /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/vector/blas-vector.h:306:11: error: member reference base type 'const long' is not a structure or union
[sagelib-8.4.beta3]                         _size(V.size()),_1stride(1),_rep(V.size(), F.zero),_ptr(&_rep[0]),_field(&F)
[sagelib-8.4.beta3]                               ~^~~~~
[sagelib-8.4.beta3] build/cythonized/sage/matrix/matrix_integer_sparse.cpp:10932:21: note: in instantiation of function template specialization 'LinBox::BlasVector<Givaro::ZRing<Givaro::Integer>, std::__1::vector<Givaro::Integer, std::__1::allocator<Givaro::Integer> > >::BlasVector<long>' requested here
[sagelib-8.4.beta3]   __pyx_v_res = new LinBox::DenseVector<Givaro::ZRing<Givaro::Integer>>(__pyx_v_givZZ, __pyx_v_self->__pyx_base.__pyx_base.__pyx_base.__pyx_base.__pyx_base._ncols);
[sagelib-8.4.beta3]                     ^
[sagelib-8.4.beta3] In file included from build/cythonized/sage/matrix/matrix_integer_sparse.cpp:708:
[sagelib-8.4.beta3] In file included from /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/matrix/dense-matrix.h:79:
[sagelib-8.4.beta3] In file included from /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/matrix/densematrix/blas-matrix.h:44:
[sagelib-8.4.beta3] /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/vector/blas-vector.h:306:38: error: member reference base type 'const long' is not a structure or union
[sagelib-8.4.beta3]                         _size(V.size()),_1stride(1),_rep(V.size(), F.zero),_ptr(&_rep[0]),_field(&F)
[sagelib-8.4.beta3]                                                          ~^~~~~
[sagelib-8.4.beta3] /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/vector/blas-vector.h:306:61: warning: field '_rep' is uninitialized when used here [-Wuninitialized]
[sagelib-8.4.beta3]                         _size(V.size()),_1stride(1),_rep(V.size(), F.zero),_ptr(&_rep[0]),_field(&F)
[sagelib-8.4.beta3]                                                                                  ^
[sagelib-8.4.beta3] /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/vector/blas-vector.h:129:13: error: type 'long' cannot be used prior to '::' because it has no members
[sagelib-8.4.beta3]                         typename OtherVector::const_iterator jt = V.begin();
[sagelib-8.4.beta3]                                  ^
[sagelib-8.4.beta3] /Users/buildslave-sage/slave/sage_git/build/local/include/linbox/vector/blas-vector.h:311:4: note: in instantiation of function template specialization 'LinBox::BlasVector<Givaro::ZRing<Givaro::Integer>, std::__1::vector<Givaro::Integer, std::__1::allocator<Givaro::Integer> > >::createBlasVector<long>' requested here
[sagelib-8.4.beta3]                         createBlasVector(V);
[sagelib-8.4.beta3]                         ^
[sagelib-8.4.beta3] build/cythonized/sage/matrix/matrix_integer_sparse.cpp:10932:21: note: in instantiation of function template specialization 'LinBox::BlasVector<Givaro::ZRing<Givaro::Integer>, std::__1::vector<Givaro::Integer, std::__1::allocator<Givaro::Integer> > >::BlasVector<long>' requested here
[sagelib-8.4.beta3]   __pyx_v_res = new LinBox::DenseVector<Givaro::ZRing<Givaro::Integer>>(__pyx_v_givZZ, __pyx_v_self->__pyx_base.__pyx_base.__pyx_base.__pyx_base.__pyx_base._ncols);
[sagelib-8.4.beta3]                     ^
[sagelib-8.4.beta3] 8 warnings and 3 errors generated.
[sagelib-8.4.beta3] error: command 'gcc' failed with exit status 1
```




---

archive/issue_comments_321508.json:
```json
{
    "body": "With the relevant lines from `matrix_integer_sparse.cpp`:\n\n```\n  /* \"sage/matrix/matrix_integer_sparse.pyx\":1074\n *         cdef linbox.SparseMatrix_integer * A = new_linbox_matrix_integer_sparse(givZZ, self)\n *         cdef linbox.DenseVector_integer * b = new_linbox_vector_integer_dense(givZZ, v)\n *         cdef linbox.DenseVector_integer * res = new linbox.DenseVector_integer(givZZ, self._ncols)             # <<<<<<<<<<<<<<\n *         cdef givaro.Integer D\n * \n */\n  __pyx_v_res = new LinBox::DenseVector<Givaro::ZRing<Givaro::Integer>>(__pyx_v_givZZ, __pyx_v_self->__pyx_base.__pyx_base.__pyx_base.__pyx_base.__pyx_base._ncols);\n```\n",
    "created_at": "2018-09-08T11:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321508",
    "user": "@videlec"
}
```

With the relevant lines from `matrix_integer_sparse.cpp`:

```
  /* "sage/matrix/matrix_integer_sparse.pyx":1074
 *         cdef linbox.SparseMatrix_integer * A = new_linbox_matrix_integer_sparse(givZZ, self)
 *         cdef linbox.DenseVector_integer * b = new_linbox_vector_integer_dense(givZZ, v)
 *         cdef linbox.DenseVector_integer * res = new linbox.DenseVector_integer(givZZ, self._ncols)             # <<<<<<<<<<<<<<
 *         cdef givaro.Integer D
 * 
 */
  __pyx_v_res = new LinBox::DenseVector<Givaro::ZRing<Givaro::Integer>>(__pyx_v_givZZ, __pyx_v_self->__pyx_base.__pyx_base.__pyx_base.__pyx_base.__pyx_base._ncols);
```




---

archive/issue_comments_321509.json:
```json
{
    "body": "This compile failure can be reproduced outside of sage. Issue opened on upstream [linbox/issues/138](https://github.com/linbox-team/linbox/issues/138).",
    "created_at": "2018-09-18T12:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321509",
    "user": "@vinklein"
}
```

This compile failure can be reproduced outside of sage. Issue opened on upstream [linbox/issues/138](https://github.com/linbox-team/linbox/issues/138).



---

archive/issue_comments_321510.json:
```json
{
    "body": "what is the status of this ticket ?",
    "created_at": "2018-10-14T19:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321510",
    "user": "@fchapoton"
}
```

what is the status of this ticket ?



---

archive/issue_comments_321511.json:
```json
{
    "body": "Replying to [comment:31 chapoton]:\n> what is the status of this ticket ?\n\nWaiting for upstream compilation fix, see [comment:28].",
    "created_at": "2018-10-16T19:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321511",
    "user": "@videlec"
}
```

Replying to [comment:31 chapoton]:
> what is the status of this ticket ?

Waiting for upstream compilation fix, see [comment:28].



---

archive/issue_comments_321512.json:
```json
{
    "body": "As mentionned in [linbox/issues/138](https://github.com/linbox-team/linbox/issues/138), passing a long instead of a size_t to BlasVector constructor is causing an weird type resolution problem, which I can still not fully understand.\nMeanwhile 2 options can fix the problem:\n- have sage cython code send size_t parameters to LinBox, as required by the interface. This means doing explicit casts (inelegant) or changing the type of ncols and nrows in matrix classes (heavy change)\n- removing the templated constructor in LinBox::BlasVector that is in the way. This change is not harmfull for the library, but it feels not right to remove features for some weird type resolution issue on OSX due to sage not respecting the interface. This second option would also delay the fixing of this issue to the integration of the next release of LinBox or patching sage's LinBox.",
    "created_at": "2018-10-18T14:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321512",
    "user": "@ClementPernet"
}
```

As mentionned in [linbox/issues/138](https://github.com/linbox-team/linbox/issues/138), passing a long instead of a size_t to BlasVector constructor is causing an weird type resolution problem, which I can still not fully understand.
Meanwhile 2 options can fix the problem:
- have sage cython code send size_t parameters to LinBox, as required by the interface. This means doing explicit casts (inelegant) or changing the type of ncols and nrows in matrix classes (heavy change)
- removing the templated constructor in LinBox::BlasVector that is in the way. This change is not harmfull for the library, but it feels not right to remove features for some weird type resolution issue on OSX due to sage not respecting the interface. This second option would also delay the fixing of this issue to the integration of the next release of LinBox or patching sage's LinBox.



---

archive/issue_comments_321513.json:
```json
{
    "body": "Replying to [comment:34 cpernet]:\n> As mentionned in [linbox/issues/138](https://github.com/linbox-team/linbox/issues/138), passing a long instead of a size_t to BlasVector constructor is causing an weird type resolution problem, which I can still not fully understand.\n> Meanwhile 2 options can fix the problem:\n>  - have sage cython code send size_t parameters to LinBox, as required by the interface. This means doing explicit casts (inelegant) or changing the type of ncols and nrows in matrix classes (heavy change)\n\nOne possible obstruction for the change `Py_ssize_t` -> `size_t` is that matrices can be accessed with negative indices. Perhaps it is not so dramatic. However, if this change happend we want to do it coherently with vectors, etc.\n\nFor the other proposition, calling properly LinBox with casting where necessary do not look too ugly for me. We can arrange so that it only appears in the code at `sage/libs/linbox/`.\n\n>  - removing the templated constructor in LinBox::BlasVector that is in the way. This change is not harmfull for the library, but it feels not right to remove features for some weird type resolution issue on OSX due to sage not respecting the interface. This second option would also delay the fixing of this issue to the integration of the next release of LinBox or patching sage's LinBox.",
    "created_at": "2018-10-18T15:02:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321513",
    "user": "@videlec"
}
```

Replying to [comment:34 cpernet]:
> As mentionned in [linbox/issues/138](https://github.com/linbox-team/linbox/issues/138), passing a long instead of a size_t to BlasVector constructor is causing an weird type resolution problem, which I can still not fully understand.
> Meanwhile 2 options can fix the problem:
>  - have sage cython code send size_t parameters to LinBox, as required by the interface. This means doing explicit casts (inelegant) or changing the type of ncols and nrows in matrix classes (heavy change)

One possible obstruction for the change `Py_ssize_t` -> `size_t` is that matrices can be accessed with negative indices. Perhaps it is not so dramatic. However, if this change happend we want to do it coherently with vectors, etc.

For the other proposition, calling properly LinBox with casting where necessary do not look too ugly for me. We can arrange so that it only appears in the code at `sage/libs/linbox/`.

>  - removing the templated constructor in LinBox::BlasVector that is in the way. This change is not harmfull for the library, but it feels not right to remove features for some weird type resolution issue on OSX due to sage not respecting the interface. This second option would also delay the fixing of this issue to the integration of the next release of LinBox or patching sage's LinBox.



---

archive/issue_comments_321514.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-10-29T15:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321514",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_321515.json:
```json
{
    "body": "Please Mac OSX testing needed!",
    "created_at": "2018-10-29T15:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321515",
    "user": "@videlec"
}
```

Please Mac OSX testing needed!



---

archive/issue_comments_321516.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-10-29T15:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321516",
    "user": "@videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_321517.json:
```json
{
    "body": "Replying to [comment:37 vdelecroix]:\n> Please Mac OSX testing needed!\n`make ptestlong` is running.",
    "created_at": "2018-10-29T16:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321517",
    "user": "@vinklein"
}
```

Replying to [comment:37 vdelecroix]:
> Please Mac OSX testing needed!
`make ptestlong` is running.



---

archive/issue_comments_321518.json:
```json
{
    "body": "We have almost the same error but for `matrix_modn_sparse`.\n\n\n\n```\n[sagelib-8.5.beta1] In file included from build/cythonized/sage/matrix/matrix_modn_sparse.cpp:725:\n[sagelib-8.5.beta1] In file included from /Users/doctorant/sage/local/include/linbox/matrix/dense-matrix.h:79:\n[sagelib-8.5.beta1] In file included from /Users/doctorant/sage/local/include/linbox/matrix/densematrix/blas-matrix.h:44:\n[sagelib-8.5.beta1] /Users/doctorant/sage/local/include/linbox/vector/blas-vector.h:306:11: error: member reference base type 'const long' is not a structure or union\n[sagelib-8.5.beta1]                         _size(V.size()),_1stride(1),_rep(V.size(), F.zero),_ptr(&_rep[0]),_field(&F)\n[sagelib-8.5.beta1]                               ~^~~~~\n[sagelib-8.5.beta1] build/cythonized/sage/matrix/matrix_modn_sparse.cpp:12191:19: note: in instantiation of function template specialization 'LinBox::BlasVector<Givaro::ZRing<Givaro::Integer>, std::__1::vector<Givaro::Integer, std::__1::allocator<Givaro::Integer> > >::BlasVector<long>' requested here\n[sagelib-8.5.beta1]   __pyx_v_b = new LinBox::DenseVector<Givaro::ZRing<Givaro::Integer>>(__pyx_v_givZZ, __pyx_v_self->__pyx_base.__pyx_base.__pyx_base.__pyx_base.__pyx_base._nrows);\n[sagelib-8.5.beta1]                   ^\n[sagelib-8.5.beta1] In file included from build/cythonized/sage/matrix/matrix_modn_sparse.cpp:725:\n[sagelib-8.5.beta1] In file included from /Users/doctorant/sage/local/include/linbox/matrix/dense-matrix.h:79:\n[sagelib-8.5.beta1] In file included from /Users/doctorant/sage/local/include/linbox/matrix/densematrix/blas-matrix.h:44:\n[sagelib-8.5.beta1] /Users/doctorant/sage/local/include/linbox/vector/blas-vector.h:306:38: error: member reference base type 'const long' is not a structure or union\n[sagelib-8.5.beta1]                         _size(V.size()),_1stride(1),_rep(V.size(), F.zero),_ptr(&_rep[0]),_field(&F)\n[sagelib-8.5.beta1]                                                          ~^~~~~\n[sagelib-8.5.beta1] /Users/doctorant/sage/local/include/linbox/vector/blas-vector.h:306:61: warning: field '_rep' is uninitialized when used here [-Wuninitialized]\n[sagelib-8.5.beta1]                         _size(V.size()),_1stride(1),_rep(V.size(), F.zero),_ptr(&_rep[0]),_field(&F)\n[sagelib-8.5.beta1]                                                                                  ^\n[sagelib-8.5.beta1] /Users/doctorant/sage/local/include/linbox/vector/blas-vector.h:129:13: error: type 'long' cannot be used prior to '::' because it has no members\n[sagelib-8.5.beta1]                         typename OtherVector::const_iterator jt = V.begin();\n[sagelib-8.5.beta1]                                  ^\n[sagelib-8.5.beta1] /Users/doctorant/sage/local/include/linbox/vector/blas-vector.h:311:4: note: in instantiation of function template specialization 'LinBox::BlasVector<Givaro::ZRing<Givaro::Integer>, std::__1::vector<Givaro::Integer, std::__1::allocator<Givaro::Integer> > >::createBlasVector<long>' requested here\n[sagelib-8.5.beta1]                         createBlasVector(V);\n[sagelib-8.5.beta1]                         ^\n[sagelib-8.5.beta1] build/cythonized/sage/matrix/matrix_modn_sparse.cpp:12191:19: note: in instantiation of function template specialization 'LinBox::BlasVector<Givaro::ZRing<Givaro::Integer>, std::__1::vector<Givaro::Integer, std::__1::allocator<Givaro::Integer> > >::BlasVector<long>' requested here\n[sagelib-8.5.beta1]   __pyx_v_b = new LinBox::DenseVector<Givaro::ZRing<Givaro::Integer>>(__pyx_v_givZZ, __pyx_v_self->__pyx_base.__pyx_base.__pyx_base.__pyx_base.__pyx_base._nrows);\n[sagelib-8.5.beta1]                   ^\n[sagelib-8.5.beta1] 8 warnings and 3 errors generated.\n[sagelib-8.5.beta1] error: command 'gcc' failed with exit status 1\n[sagelib-8.5.beta1] [ 3/86] make[4]: *** [sage] Error 1\n```\n",
    "created_at": "2018-10-30T08:59:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321518",
    "user": "@vinklein"
}
```

We have almost the same error but for `matrix_modn_sparse`.



```
[sagelib-8.5.beta1] In file included from build/cythonized/sage/matrix/matrix_modn_sparse.cpp:725:
[sagelib-8.5.beta1] In file included from /Users/doctorant/sage/local/include/linbox/matrix/dense-matrix.h:79:
[sagelib-8.5.beta1] In file included from /Users/doctorant/sage/local/include/linbox/matrix/densematrix/blas-matrix.h:44:
[sagelib-8.5.beta1] /Users/doctorant/sage/local/include/linbox/vector/blas-vector.h:306:11: error: member reference base type 'const long' is not a structure or union
[sagelib-8.5.beta1]                         _size(V.size()),_1stride(1),_rep(V.size(), F.zero),_ptr(&_rep[0]),_field(&F)
[sagelib-8.5.beta1]                               ~^~~~~
[sagelib-8.5.beta1] build/cythonized/sage/matrix/matrix_modn_sparse.cpp:12191:19: note: in instantiation of function template specialization 'LinBox::BlasVector<Givaro::ZRing<Givaro::Integer>, std::__1::vector<Givaro::Integer, std::__1::allocator<Givaro::Integer> > >::BlasVector<long>' requested here
[sagelib-8.5.beta1]   __pyx_v_b = new LinBox::DenseVector<Givaro::ZRing<Givaro::Integer>>(__pyx_v_givZZ, __pyx_v_self->__pyx_base.__pyx_base.__pyx_base.__pyx_base.__pyx_base._nrows);
[sagelib-8.5.beta1]                   ^
[sagelib-8.5.beta1] In file included from build/cythonized/sage/matrix/matrix_modn_sparse.cpp:725:
[sagelib-8.5.beta1] In file included from /Users/doctorant/sage/local/include/linbox/matrix/dense-matrix.h:79:
[sagelib-8.5.beta1] In file included from /Users/doctorant/sage/local/include/linbox/matrix/densematrix/blas-matrix.h:44:
[sagelib-8.5.beta1] /Users/doctorant/sage/local/include/linbox/vector/blas-vector.h:306:38: error: member reference base type 'const long' is not a structure or union
[sagelib-8.5.beta1]                         _size(V.size()),_1stride(1),_rep(V.size(), F.zero),_ptr(&_rep[0]),_field(&F)
[sagelib-8.5.beta1]                                                          ~^~~~~
[sagelib-8.5.beta1] /Users/doctorant/sage/local/include/linbox/vector/blas-vector.h:306:61: warning: field '_rep' is uninitialized when used here [-Wuninitialized]
[sagelib-8.5.beta1]                         _size(V.size()),_1stride(1),_rep(V.size(), F.zero),_ptr(&_rep[0]),_field(&F)
[sagelib-8.5.beta1]                                                                                  ^
[sagelib-8.5.beta1] /Users/doctorant/sage/local/include/linbox/vector/blas-vector.h:129:13: error: type 'long' cannot be used prior to '::' because it has no members
[sagelib-8.5.beta1]                         typename OtherVector::const_iterator jt = V.begin();
[sagelib-8.5.beta1]                                  ^
[sagelib-8.5.beta1] /Users/doctorant/sage/local/include/linbox/vector/blas-vector.h:311:4: note: in instantiation of function template specialization 'LinBox::BlasVector<Givaro::ZRing<Givaro::Integer>, std::__1::vector<Givaro::Integer, std::__1::allocator<Givaro::Integer> > >::createBlasVector<long>' requested here
[sagelib-8.5.beta1]                         createBlasVector(V);
[sagelib-8.5.beta1]                         ^
[sagelib-8.5.beta1] build/cythonized/sage/matrix/matrix_modn_sparse.cpp:12191:19: note: in instantiation of function template specialization 'LinBox::BlasVector<Givaro::ZRing<Givaro::Integer>, std::__1::vector<Givaro::Integer, std::__1::allocator<Givaro::Integer> > >::BlasVector<long>' requested here
[sagelib-8.5.beta1]   __pyx_v_b = new LinBox::DenseVector<Givaro::ZRing<Givaro::Integer>>(__pyx_v_givZZ, __pyx_v_self->__pyx_base.__pyx_base.__pyx_base.__pyx_base.__pyx_base._nrows);
[sagelib-8.5.beta1]                   ^
[sagelib-8.5.beta1] 8 warnings and 3 errors generated.
[sagelib-8.5.beta1] error: command 'gcc' failed with exit status 1
[sagelib-8.5.beta1] [ 3/86] make[4]: *** [sage] Error 1
```




---

archive/issue_comments_321519.json:
```json
{
    "body": "There was indeed some casts missing. I pushed a fixed and checked that all casts have been done.\n`@`vklein, could you check again please?\n----\nNew commits:",
    "created_at": "2018-10-30T09:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321519",
    "user": "@ClementPernet"
}
```

There was indeed some casts missing. I pushed a fixed and checked that all casts have been done.
`@`vklein, could you check again please?
----
New commits:



---

archive/issue_comments_321520.json:
```json
{
    "body": "Sure.",
    "created_at": "2018-10-30T09:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321520",
    "user": "@vinklein"
}
```

Sure.



---

archive/issue_comments_321521.json:
```json
{
    "body": "I got 3 failing doctests, see patchbot.",
    "created_at": "2018-10-30T16:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321521",
    "user": "@fchapoton"
}
```

I got 3 failing doctests, see patchbot.



---

archive/issue_comments_321522.json:
```json
{
    "body": "Tests are still running on OSX. That mean off course that all compilation problems are solved.",
    "created_at": "2018-10-30T16:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321522",
    "user": "@vinklein"
}
```

Tests are still running on OSX. That mean off course that all compilation problems are solved.



---

archive/issue_comments_321523.json:
```json
{
    "body": "I get 5 errors on OSX:\n\n\n```\nsage -t --long src/sage/combinat/designs/ext_rep.py  # Killed due to abort\nsage -t --long src/sage/doctest/external.py  # Killed due to abort\nsage -t --long src/sage/matrix/matrix_modn_sparse.pyx  # 3 doctests failed\n```\n\n`matrix_modn_sparse.pyx` errors are the sames as the patchbot ones and the two others are not ticket dependent (see Justin C. Walker message in [Sage 8.5.beta1 released](https://groups.google.com/forum/?fromgroups#!topic/sage-release/yiJTgNhjB6o) ).",
    "created_at": "2018-10-30T16:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321523",
    "user": "@vinklein"
}
```

I get 5 errors on OSX:


```
sage -t --long src/sage/combinat/designs/ext_rep.py  # Killed due to abort
sage -t --long src/sage/doctest/external.py  # Killed due to abort
sage -t --long src/sage/matrix/matrix_modn_sparse.pyx  # 3 doctests failed
```

`matrix_modn_sparse.pyx` errors are the sames as the patchbot ones and the two others are not ticket dependent (see Justin C. Walker message in [Sage 8.5.beta1 released](https://groups.google.com/forum/?fromgroups#!topic/sage-release/yiJTgNhjB6o) ).



---

archive/issue_comments_321524.json:
```json
{
    "body": "My bad. Error should be fixed now.",
    "created_at": "2018-10-30T22:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321524",
    "user": "@videlec"
}
```

My bad. Error should be fixed now.



---

archive/issue_comments_321525.json:
```json
{
    "body": "forgot to push ?",
    "created_at": "2018-10-31T07:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321525",
    "user": "@fchapoton"
}
```

forgot to push ?



---

archive/issue_comments_321526.json:
```json
{
    "body": "Not quite.\n----\nNew commits:",
    "created_at": "2018-10-31T08:38:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321526",
    "user": "@videlec"
}
```

Not quite.
----
New commits:



---

archive/issue_comments_321527.json:
```json
{
    "body": "There seems to be a test failure on one of the patchbots:\n\n```\nFile \"src/sage/matrix/matrix_space.py\", line 1982, in sage.matrix.matrix_space.MatrixSpace._an_element_\nFailed example:\n    M.density()\nExpected:\n    99/1000000\nGot:\n    49/500000\n**********************************************************************\n1 item had failures:\n   1 of   7 in sage.matrix.matrix_space.MatrixSpace._an_element_\n    [383 tests, 1 failure, 6.40 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 54.6 src/sage/matrix/matrix_space.py  # 1 doctest failed\n```\n\nCan you reproduce this locally (sorry, I cannot test this right now on my laptop)?",
    "created_at": "2018-10-31T12:53:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321527",
    "user": "@tscrim"
}
```

There seems to be a test failure on one of the patchbots:

```
File "src/sage/matrix/matrix_space.py", line 1982, in sage.matrix.matrix_space.MatrixSpace._an_element_
Failed example:
    M.density()
Expected:
    99/1000000
Got:
    49/500000
**********************************************************************
1 item had failures:
   1 of   7 in sage.matrix.matrix_space.MatrixSpace._an_element_
    [383 tests, 1 failure, 6.40 s]
----------------------------------------------------------------------
sage -t --long --warn-long 54.6 src/sage/matrix/matrix_space.py  # 1 doctest failed
```

Can you reproduce this locally (sorry, I cannot test this right now on my laptop)?



---

archive/issue_comments_321528.json:
```json
{
    "body": "This concerns `petitbonum` and, on the other hand, everything is fine on `pc78-math`.\n\nI can not reproduce either.",
    "created_at": "2018-11-01T09:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321528",
    "user": "@videlec"
}
```

This concerns `petitbonum` and, on the other hand, everything is fine on `pc78-math`.

I can not reproduce either.



---

archive/issue_comments_321529.json:
```json
{
    "body": "This one on [tmonteil-debian-stretch-32](https://patchbot.sagemath.org/log/23214/debian/9.5/i686/4.9.0-7-686/tmonteil-debian-stretch-32/2018-11-02%2002:27:16?short) (32 bits) is more annoying\n\n```\n[sagelib-8.5.beta2] build/cythonized/sage/matrix/matrix_modn_sparse.cpp:8931:132: error: no matching function for call to 'LinBox::GaussDomain<Givaro::Modular<long long unsigned int, long long unsigned int> >::InPlaceLinearPivoting(size_t&, uint64_t&, LinBox::SparseMatrix<Givaro::Modular<long long unsigned int, long long unsigned int>, LinBox::SparseMatrixFormat::SparseSeq>&, size_t, size_t)'\n[sagelib-8.5.beta2]    (void)(__pyx_v_dom->InPlaceLinearPivoting(__pyx_v_A_rank, __pyx_v_A_det, (__pyx_v_A[0]), __pyx_v_A->rowdim(), __pyx_v_A->coldim()));\n[sagelib-8.5.beta2]                                                                                                                                     ^\n```\n\n`@`Cl\u00e9ment: any clue of what might be wrong on 32 bit architecture?",
    "created_at": "2018-11-02T08:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321529",
    "user": "@videlec"
}
```

This one on [tmonteil-debian-stretch-32](https://patchbot.sagemath.org/log/23214/debian/9.5/i686/4.9.0-7-686/tmonteil-debian-stretch-32/2018-11-02%2002:27:16?short) (32 bits) is more annoying

```
[sagelib-8.5.beta2] build/cythonized/sage/matrix/matrix_modn_sparse.cpp:8931:132: error: no matching function for call to 'LinBox::GaussDomain<Givaro::Modular<long long unsigned int, long long unsigned int> >::InPlaceLinearPivoting(size_t&, uint64_t&, LinBox::SparseMatrix<Givaro::Modular<long long unsigned int, long long unsigned int>, LinBox::SparseMatrixFormat::SparseSeq>&, size_t, size_t)'
[sagelib-8.5.beta2]    (void)(__pyx_v_dom->InPlaceLinearPivoting(__pyx_v_A_rank, __pyx_v_A_det, (__pyx_v_A[0]), __pyx_v_A->rowdim(), __pyx_v_A->coldim()));
[sagelib-8.5.beta2]                                                                                                                                     ^
```

`@`Cl√©ment: any clue of what might be wrong on 32 bit architecture?



---

archive/issue_comments_321530.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-11-02T08:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321530",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_321531.json:
```json
{
    "body": "`@`Clement: note that in LinBox the function is declared as (`linbox/algorithms/gauss.h` line 227)\n\n```C++\n// Sparsest method\n//   erases elements while computing rank/det.\ntemplate <class _Matrix>                                      \nunsigned long& InPlaceLinearPivoting(unsigned long &rank,\n                                     Element& determinant,\n                                     _Matrix        &A,\n                                     unsigned long Ni,\n                                     unsigned long Nj) const;\n```\n\nHere I don't understand why `rank`, `Ni` and `Nj` are not `size_t` as they should rather be.",
    "created_at": "2018-11-02T12:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321531",
    "user": "@videlec"
}
```

`@`Clement: note that in LinBox the function is declared as (`linbox/algorithms/gauss.h` line 227)

```C++
// Sparsest method
//   erases elements while computing rank/det.
template <class _Matrix>                                      
unsigned long& InPlaceLinearPivoting(unsigned long &rank,
                                     Element& determinant,
                                     _Matrix        &A,
                                     unsigned long Ni,
                                     unsigned long Nj) const;
```

Here I don't understand why `rank`, `Ni` and `Nj` are not `size_t` as they should rather be.



---

archive/issue_comments_321532.json:
```json
{
    "body": "I filled the [Issue 144](https://github.com/linbox-team/linbox/issues/144) on linbox website.",
    "created_at": "2018-11-02T19:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321532",
    "user": "@videlec"
}
```

I filled the [Issue 144](https://github.com/linbox-team/linbox/issues/144) on linbox website.



---

archive/issue_comments_321533.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-02T22:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321533",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_321534.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-11-02T22:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321534",
    "user": "@videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_321535.json:
```json
{
    "body": "Good news: tests pass on 32 bits.\n\n`@`vinklein: can you test one more time on OSX?\n\nIf everything went fine on OSX, I think we should get this ticket merged as is. I will change `unsigned long` to `size_t` as soon as LinBox gets updated.",
    "created_at": "2018-11-03T13:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321535",
    "user": "@videlec"
}
```

Good news: tests pass on 32 bits.

`@`vinklein: can you test one more time on OSX?

If everything went fine on OSX, I think we should get this ticket merged as is. I will change `unsigned long` to `size_t` as soon as LinBox gets updated.



---

archive/issue_comments_321536.json:
```json
{
    "body": "This is also good on my machine and on a 32 and 64 bit patchbot.",
    "created_at": "2018-11-04T12:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321536",
    "user": "@tscrim"
}
```

This is also good on my machine and on a 32 and 64 bit patchbot.



---

archive/issue_comments_321537.json:
```json
{
    "body": "Replying to [comment:57 vdelecroix]:\n> `@`vinklein: can you test one more time on OSX?\nSure.",
    "created_at": "2018-11-05T08:25:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321537",
    "user": "@vinklein"
}
```

Replying to [comment:57 vdelecroix]:
> `@`vinklein: can you test one more time on OSX?
Sure.



---

archive/issue_comments_321538.json:
```json
{
    "body": "Build & tests pass on OSX (`98ac984`)",
    "created_at": "2018-11-05T14:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321538",
    "user": "@vinklein"
}
```

Build & tests pass on OSX (`98ac984`)



---

archive/issue_comments_321539.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-11-05T14:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321539",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_321540.json:
```json
{
    "body": "Merci Vincent!",
    "created_at": "2018-11-05T15:47:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321540",
    "user": "@videlec"
}
```

Merci Vincent!



---

archive/issue_comments_321541.json:
```json
{
    "body": "De rien !",
    "created_at": "2018-11-05T16:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321541",
    "user": "@vinklein"
}
```

De rien !



---

archive/issue_comments_321542.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-11-07T11:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321542",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_321543.json:
```json
{
    "body": "I strongly suspect that this ticket caused #28586 (breakage in solving sparse linear systems over prime fields), as it was the most substantial related change that got in in Sage 8.5.beta3. (and I bisected #28586 to 8.5.beta3).",
    "created_at": "2019-10-10T22:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22977",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22977#issuecomment-321543",
    "user": "@dimpase"
}
```

I strongly suspect that this ticket caused #28586 (breakage in solving sparse linear systems over prime fields), as it was the most substantial related change that got in in Sage 8.5.beta3. (and I bisected #28586 to 8.5.beta3).
