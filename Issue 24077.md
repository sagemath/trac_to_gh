# Issue 24077: rootfinding for polynomials with complex ball coefficients using arb

Issue created by migration from Trac.

Original creator: mmezzarobba

Original creation time: 2017-12-02 10:02:35

CC:  fredrik.johansson vdelecroix cheuberg




---

Comment by git created at 2017-12-02 10:04:58

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2017-12-02 10:05:34

Changing status from new to needs_review.


---

Comment by fredrik.johansson created at 2017-12-02 16:01:22

It is best not to call acb_poly_find_roots once with the final precision but to use a loop like

https://github.com/fredrik-johansson/python-flint/blob/master/src/acb_poly.pyx#L331


---

Comment by fredrik.johansson created at 2017-12-02 17:22:20

Related to this ticket, an interface to arb_fmpz_poly_complex_roots would also be useful.


---

Comment by git created at 2017-12-03 12:19:55

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2017-12-03 12:25:00

Replying to [comment:4 fredrik.johansson]:
> It is best not to call acb_poly_find_roots once with the final precision but to use a loop like
> 
> https://github.com/fredrik-johansson/python-flint/blob/master/src/acb_poly.pyx#L331

Thanks for the hint. Is it better now? (I also made the version with `proof=False` return all the roots instead of only the isolated ones.)

I have doubts about the choice of refusing to run with `multiplicities=True`, any thoughts?


---

Comment by fredrik.johansson created at 2017-12-03 13:56:12

It looks reasonable to me (without having actually tested the code).

Is multiplicities=True the default? For an interval polynomial, returning certified root clusters would be a reasonable interpretation, although it's a bit dangerous since a user might expect (naively) to obtain the true multiplicities for the intended exact polynomial. It doesn't really matter right now since the algorithm in Arb doesn't support certifiable isolating all root clusters, anyway...


---

Comment by mmezzarobba created at 2017-12-04 15:49:47

Replying to [comment:8 fredrik.johansson]:
> Is multiplicities=True the default?

Yes.

> For an interval polynomial, returning certified root clusters would be a reasonable interpretation, although it's a bit dangerous since a user might expect (naively) to obtain the true multiplicities for the intended exact polynomial.

Yes, it would probably be clearer to have a separate method for that case. But we could also simply return all the roots with multiplicity one (since, unless it was called with `proof=False`, the function always fails on multiple roots).

Unless someone objects, I suggest we keep the exception for now. It will be easier to change it later if it proves too inconvenient than to go the other way.


---

Comment by git created at 2018-01-31 15:03:22

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-01-31 15:43:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2018-01-31 15:45:09

Replying to [comment:10 git]:
> Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
> ||[8474ea3](https://git.sagemath.org/sage.git/commit/?id=8474ea3c302e87aceb0b6362ce9e183e3ebf6b1a)||`Fix up 75c75e9 (#24285)`||

Wrong branch, sorry.


---

Comment by git created at 2018-03-03 12:24:11

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2018-03-03 12:24:32

rebased on develop


---

Comment by git created at 2018-03-20 09:24:25

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-03-30 09:47:20

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2018-03-30 09:48:00

fixed trivial merge conflicts


---

Comment by vdelecroix created at 2018-03-30 12:48:57

You have included a lot of example but they are right now unreachable from the documentation. It would be better to have a sample of it directly in the generic `roots` method. It is good to advertise it at this generic level since someone might want to use this even with polynomial with integer coefficients.

```
sage: x = polygen(ZZ)
sage: (x^3 + 3).roots(CBF, multiplicities=False)
[[-1.442249570307408 +/- 3.83e-16] + [+/- 3.59e-19]*I,
 [0.7211247851537042 +/- 9.34e-18] + [1.249024766483406 +/- 4.80e-16]*I,
 [0.7211247851537042 +/- 9.30e-18] + [-1.249024766483406 +/- 4.80e-16]*I]
```


It is sad that the following is not working

```
sage: x = polygen(ZZ)
sage: (x^3 + 3).roots(RBF, multiplicities=False)
Traceback (most recent call last):
...
NotImplementedError: root finding for this polynomial not implemented
```


The variable `i` is implicit. Might be good to declare it as `size_t`.

Why did you decide to not include the while loop in the `try`/`finally`?


---

Comment by vdelecroix created at 2018-03-30 12:48:57

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-03-30 14:50:39

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2018-03-30 14:52:15

Replying to [comment:19 vdelecroix]:
> You have included a lot of example but they are right now unreachable from the documentation. It would be better to have a sample of it directly in the generic `roots` method. It is good to advertise it at this generic level since someone might want to use this even with polynomial with integer coefficients.

Done... But this is really a symptom of deeper design issues (of the documentation framework, and of the `_root_univariate_polynomial` mechanism)...

> It is sad that the following is not working
> {{{
> sage: x = polygen(ZZ)
> sage: (x^3 + 3).roots(RBF, multiplicities=False)
> Traceback (most recent call last):
> ...
> NotImplementedError: root finding for this polynomial not implemented
> }}}

I have some work in progress to interface the `arb_fmpz_poly` module, but I'm waiting for some other tickets to get merged to avoid conflicts.

> The variable `i` is implicit. Might be good to declare it as `size_t`.

Why?

> Why did you decide to not include the while loop in the `try`/`finally`?

I don't know. Must have been because of the `sig_on()`/`sig_off()` block. But neither solution is perfect, I can move it in the `try` block if that's more to your taste.
----
New commits:


---

Comment by mmezzarobba created at 2018-03-30 14:52:29

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2018-04-03 07:19:14

Replying to [comment:21 mmezzarobba]:
> Replying to [comment:19 vdelecroix]:
> > The variable `i` is implicit. Might be good to declare it as `size_t`.
> 
> Why?

To not let Cython decide what it should be... Maybe not important.


---

Comment by vdelecroix created at 2018-04-03 07:20:03

Changing status from needs_review to positive_review.


---

Comment by mmezzarobba created at 2018-04-03 10:50:57

Thanks!


---

Comment by vbraun created at 2018-05-08 17:27:00

Resolution: fixed
