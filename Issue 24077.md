# Issue 24077: rootfinding for polynomials with complex ball coefficients using arb

archive/issues_024077.json:
```json
{
    "body": "CC:  fredrik.johansson vdelecroix cheuberg\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24314\n\n",
    "created_at": "2017-12-02T10:02:35Z",
    "labels": [
        "numerical",
        "major",
        "enhancement"
    ],
    "title": "rootfinding for polynomials with complex ball coefficients using arb",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24077",
    "user": "mmezzarobba"
}
```
CC:  fredrik.johansson vdelecroix cheuberg



Issue created by migration from https://trac.sagemath.org/ticket/24314





---

archive/issue_comments_337450.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-02T10:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337450",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_337451.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-12-02T10:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337451",
    "user": "mmezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_337452.json:
```json
{
    "body": "It is best not to call acb_poly_find_roots once with the final precision but to use a loop like\n\nhttps://github.com/fredrik-johansson/python-flint/blob/master/src/acb_poly.pyx#L331",
    "created_at": "2017-12-02T16:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337452",
    "user": "fredrik.johansson"
}
```

It is best not to call acb_poly_find_roots once with the final precision but to use a loop like

https://github.com/fredrik-johansson/python-flint/blob/master/src/acb_poly.pyx#L331



---

archive/issue_comments_337453.json:
```json
{
    "body": "Related to this ticket, an interface to arb_fmpz_poly_complex_roots would also be useful.",
    "created_at": "2017-12-02T17:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337453",
    "user": "fredrik.johansson"
}
```

Related to this ticket, an interface to arb_fmpz_poly_complex_roots would also be useful.



---

archive/issue_comments_337454.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-03T12:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337454",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_337455.json:
```json
{
    "body": "Replying to [comment:4 fredrik.johansson]:\n> It is best not to call acb_poly_find_roots once with the final precision but to use a loop like\n> \n> https://github.com/fredrik-johansson/python-flint/blob/master/src/acb_poly.pyx#L331\n\nThanks for the hint. Is it better now? (I also made the version with `proof=False` return all the roots instead of only the isolated ones.)\n\nI have doubts about the choice of refusing to run with `multiplicities=True`, any thoughts?",
    "created_at": "2017-12-03T12:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337455",
    "user": "mmezzarobba"
}
```

Replying to [comment:4 fredrik.johansson]:
> It is best not to call acb_poly_find_roots once with the final precision but to use a loop like
> 
> https://github.com/fredrik-johansson/python-flint/blob/master/src/acb_poly.pyx#L331

Thanks for the hint. Is it better now? (I also made the version with `proof=False` return all the roots instead of only the isolated ones.)

I have doubts about the choice of refusing to run with `multiplicities=True`, any thoughts?



---

archive/issue_comments_337456.json:
```json
{
    "body": "It looks reasonable to me (without having actually tested the code).\n\nIs multiplicities=True the default? For an interval polynomial, returning certified root clusters would be a reasonable interpretation, although it's a bit dangerous since a user might expect (naively) to obtain the true multiplicities for the intended exact polynomial. It doesn't really matter right now since the algorithm in Arb doesn't support certifiable isolating all root clusters, anyway...",
    "created_at": "2017-12-03T13:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337456",
    "user": "fredrik.johansson"
}
```

It looks reasonable to me (without having actually tested the code).

Is multiplicities=True the default? For an interval polynomial, returning certified root clusters would be a reasonable interpretation, although it's a bit dangerous since a user might expect (naively) to obtain the true multiplicities for the intended exact polynomial. It doesn't really matter right now since the algorithm in Arb doesn't support certifiable isolating all root clusters, anyway...



---

archive/issue_comments_337457.json:
```json
{
    "body": "Replying to [comment:8 fredrik.johansson]:\n> Is multiplicities=True the default?\n\nYes.\n\n> For an interval polynomial, returning certified root clusters would be a reasonable interpretation, although it's a bit dangerous since a user might expect (naively) to obtain the true multiplicities for the intended exact polynomial.\n\nYes, it would probably be clearer to have a separate method for that case. But we could also simply return all the roots with multiplicity one (since, unless it was called with `proof=False`, the function always fails on multiple roots).\n\nUnless someone objects, I suggest we keep the exception for now. It will be easier to change it later if it proves too inconvenient than to go the other way.",
    "created_at": "2017-12-04T15:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337457",
    "user": "mmezzarobba"
}
```

Replying to [comment:8 fredrik.johansson]:
> Is multiplicities=True the default?

Yes.

> For an interval polynomial, returning certified root clusters would be a reasonable interpretation, although it's a bit dangerous since a user might expect (naively) to obtain the true multiplicities for the intended exact polynomial.

Yes, it would probably be clearer to have a separate method for that case. But we could also simply return all the roots with multiplicity one (since, unless it was called with `proof=False`, the function always fails on multiple roots).

Unless someone objects, I suggest we keep the exception for now. It will be easier to change it later if it proves too inconvenient than to go the other way.



---

archive/issue_comments_337458.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-31T15:03:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337458",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_337459.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-31T15:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337459",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_337460.json:
```json
{
    "body": "Replying to [comment:10 git]:\n> Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n> ||[8474ea3](https://git.sagemath.org/sage.git/commit/?id=8474ea3c302e87aceb0b6362ce9e183e3ebf6b1a)||`Fix up 75c75e9 (#24285)`||\n\nWrong branch, sorry.",
    "created_at": "2018-01-31T15:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337460",
    "user": "mmezzarobba"
}
```

Replying to [comment:10 git]:
> Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
> ||[8474ea3](https://git.sagemath.org/sage.git/commit/?id=8474ea3c302e87aceb0b6362ce9e183e3ebf6b1a)||`Fix up 75c75e9 (#24285)`||

Wrong branch, sorry.



---

archive/issue_comments_337461.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-03T12:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337461",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_337462.json:
```json
{
    "body": "rebased on develop",
    "created_at": "2018-03-03T12:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337462",
    "user": "mmezzarobba"
}
```

rebased on develop



---

archive/issue_comments_337463.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-20T09:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337463",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_337464.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-30T09:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337464",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_337465.json:
```json
{
    "body": "fixed trivial merge conflicts",
    "created_at": "2018-03-30T09:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337465",
    "user": "mmezzarobba"
}
```

fixed trivial merge conflicts



---

archive/issue_comments_337466.json:
```json
{
    "body": "You have included a lot of example but they are right now unreachable from the documentation. It would be better to have a sample of it directly in the generic `roots` method. It is good to advertise it at this generic level since someone might want to use this even with polynomial with integer coefficients.\n\n```\nsage: x = polygen(ZZ)\nsage: (x^3 + 3).roots(CBF, multiplicities=False)\n[[-1.442249570307408 +/- 3.83e-16] + [+/- 3.59e-19]*I,\n [0.7211247851537042 +/- 9.34e-18] + [1.249024766483406 +/- 4.80e-16]*I,\n [0.7211247851537042 +/- 9.30e-18] + [-1.249024766483406 +/- 4.80e-16]*I]\n```\n\n\nIt is sad that the following is not working\n\n```\nsage: x = polygen(ZZ)\nsage: (x^3 + 3).roots(RBF, multiplicities=False)\nTraceback (most recent call last):\n...\nNotImplementedError: root finding for this polynomial not implemented\n```\n\n\nThe variable `i` is implicit. Might be good to declare it as `size_t`.\n\nWhy did you decide to not include the while loop in the `try`/`finally`?",
    "created_at": "2018-03-30T12:48:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337466",
    "user": "vdelecroix"
}
```

You have included a lot of example but they are right now unreachable from the documentation. It would be better to have a sample of it directly in the generic `roots` method. It is good to advertise it at this generic level since someone might want to use this even with polynomial with integer coefficients.

```
sage: x = polygen(ZZ)
sage: (x^3 + 3).roots(CBF, multiplicities=False)
[[-1.442249570307408 +/- 3.83e-16] + [+/- 3.59e-19]*I,
 [0.7211247851537042 +/- 9.34e-18] + [1.249024766483406 +/- 4.80e-16]*I,
 [0.7211247851537042 +/- 9.30e-18] + [-1.249024766483406 +/- 4.80e-16]*I]
```


It is sad that the following is not working

```
sage: x = polygen(ZZ)
sage: (x^3 + 3).roots(RBF, multiplicities=False)
Traceback (most recent call last):
...
NotImplementedError: root finding for this polynomial not implemented
```


The variable `i` is implicit. Might be good to declare it as `size_t`.

Why did you decide to not include the while loop in the `try`/`finally`?



---

archive/issue_comments_337467.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-03-30T12:48:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337467",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_337468.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-30T14:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337468",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_337469.json:
```json
{
    "body": "Replying to [comment:19 vdelecroix]:\n> You have included a lot of example but they are right now unreachable from the documentation. It would be better to have a sample of it directly in the generic `roots` method. It is good to advertise it at this generic level since someone might want to use this even with polynomial with integer coefficients.\n\nDone... But this is really a symptom of deeper design issues (of the documentation framework, and of the `_root_univariate_polynomial` mechanism)...\n\n> It is sad that the following is not working\n> {{{\n> sage: x = polygen(ZZ)\n> sage: (x^3 + 3).roots(RBF, multiplicities=False)\n> Traceback (most recent call last):\n> ...\n> NotImplementedError: root finding for this polynomial not implemented\n> }}}\n\nI have some work in progress to interface the `arb_fmpz_poly` module, but I'm waiting for some other tickets to get merged to avoid conflicts.\n\n> The variable `i` is implicit. Might be good to declare it as `size_t`.\n\nWhy?\n\n> Why did you decide to not include the while loop in the `try`/`finally`?\n\nI don't know. Must have been because of the `sig_on()`/`sig_off()` block. But neither solution is perfect, I can move it in the `try` block if that's more to your taste.\n----\nNew commits:",
    "created_at": "2018-03-30T14:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337469",
    "user": "mmezzarobba"
}
```

Replying to [comment:19 vdelecroix]:
> You have included a lot of example but they are right now unreachable from the documentation. It would be better to have a sample of it directly in the generic `roots` method. It is good to advertise it at this generic level since someone might want to use this even with polynomial with integer coefficients.

Done... But this is really a symptom of deeper design issues (of the documentation framework, and of the `_root_univariate_polynomial` mechanism)...

> It is sad that the following is not working
> {{{
> sage: x = polygen(ZZ)
> sage: (x^3 + 3).roots(RBF, multiplicities=False)
> Traceback (most recent call last):
> ...
> NotImplementedError: root finding for this polynomial not implemented
> }}}

I have some work in progress to interface the `arb_fmpz_poly` module, but I'm waiting for some other tickets to get merged to avoid conflicts.

> The variable `i` is implicit. Might be good to declare it as `size_t`.

Why?

> Why did you decide to not include the while loop in the `try`/`finally`?

I don't know. Must have been because of the `sig_on()`/`sig_off()` block. But neither solution is perfect, I can move it in the `try` block if that's more to your taste.
----
New commits:



---

archive/issue_comments_337470.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-30T14:52:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337470",
    "user": "mmezzarobba"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_337471.json:
```json
{
    "body": "Replying to [comment:21 mmezzarobba]:\n> Replying to [comment:19 vdelecroix]:\n> > The variable `i` is implicit. Might be good to declare it as `size_t`.\n> \n> Why?\n\nTo not let Cython decide what it should be... Maybe not important.",
    "created_at": "2018-04-03T07:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337471",
    "user": "vdelecroix"
}
```

Replying to [comment:21 mmezzarobba]:
> Replying to [comment:19 vdelecroix]:
> > The variable `i` is implicit. Might be good to declare it as `size_t`.
> 
> Why?

To not let Cython decide what it should be... Maybe not important.



---

archive/issue_comments_337472.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-03T07:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337472",
    "user": "vdelecroix"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_337473.json:
```json
{
    "body": "Thanks!",
    "created_at": "2018-04-03T10:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337473",
    "user": "mmezzarobba"
}
```

Thanks!



---

archive/issue_comments_337474.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-08T17:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24077#issuecomment-337474",
    "user": "vbraun"
}
```

Resolution: fixed
