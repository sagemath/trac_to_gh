# Issue 34146: revert for LazyTaylorSeries is missing

archive/issues_034146.json:
```json
{
    "body": "CC:  @tscrim\n\n\n```\nsage: L.<z> = LazyTaylorSeriesRing(ZZ)\nsage: (z-z^2).revert()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n...\nAttributeError: 'LazyTaylorSeriesRing_with_category.element_class' object has no attribute 'revert'\n```\n\n\nSame for `LazySymmetricFunctions`.  `compositional_inverse` might be a good alias.\n\nIssue created by migration from https://trac.sagemath.org/ticket/34383\n\n",
    "created_at": "2022-08-17T12:17:02Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "revert for LazyTaylorSeries is missing",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34146",
    "user": "https://github.com/mantepse"
}
```
CC:  @tscrim


```
sage: L.<z> = LazyTaylorSeriesRing(ZZ)
sage: (z-z^2).revert()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
...
AttributeError: 'LazyTaylorSeriesRing_with_category.element_class' object has no attribute 'revert'
```


Same for `LazySymmetricFunctions`.  `compositional_inverse` might be a good alias.

Issue created by migration from https://trac.sagemath.org/ticket/34383





---

archive/issue_comments_483879.json:
```json
{
    "body": "Unfortunately, there seems to be an inaccuracy in `Stream_plethysm`:\n\n```\nsage: h = SymmetricFunctions(QQ).h()\nsage: p = SymmetricFunctions(QQ).p()\nsage: L = LazySymmetricFunctions(p)\nsage: X = L(p[1])\nsage: e = L(lambda n: h[n]) - 1 - X\nsage: g = L(None, valuation=1)\nsage: g.define(X - e(g))\nsage: g[0]\n0\nsage: g[1]\np[1]\nsage: g[2]\n...booooom... (max recursion error)\n```\n",
    "created_at": "2022-08-17T12:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483879",
    "user": "https://github.com/mantepse"
}
```

Unfortunately, there seems to be an inaccuracy in `Stream_plethysm`:

```
sage: h = SymmetricFunctions(QQ).h()
sage: p = SymmetricFunctions(QQ).p()
sage: L = LazySymmetricFunctions(p)
sage: X = L(p[1])
sage: e = L(lambda n: h[n]) - 1 - X
sage: g = L(None, valuation=1)
sage: g.define(X - e(g))
sage: g[0]
0
sage: g[1]
p[1]
sage: g[2]
...booooom... (max recursion error)
```




---

archive/issue_comments_483880.json:
```json
{
    "body": "In the example, `h` has valuation 2, so to compute the degree 2 piece of `h(g)` we only should be accessing the degree 1 piece of `g`.  But in `Stream_plethysm.get_coefficient`, we compute `self._compute_product(2, [1, 1], 1/2)`, which in turn accesses `self._right[2]`.",
    "created_at": "2022-08-17T13:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483880",
    "user": "https://github.com/mantepse"
}
```

In the example, `h` has valuation 2, so to compute the degree 2 piece of `h(g)` we only should be accessing the degree 1 piece of `g`.  But in `Stream_plethysm.get_coefficient`, we compute `self._compute_product(2, [1, 1], 1/2)`, which in turn accesses `self._right[2]`.



---

archive/issue_comments_483881.json:
```json
{
    "body": "An easy fix is as follows:\n\n```diff\ndiff --git a/src/sage/data_structures/stream.py b/src/sage/data_structures/stream.py\nindex e54a90b8b88..b61d29544c2 100644\n--- a/src/sage/data_structures/stream.py\n+++ b/src/sage/data_structures/stream.py\n@@ -1763,6 +1763,14 @@ class Stream_plethysm(Stream_binary):\n         p = self._p\n         ret = p.zero()\n         for mu in wt_int_vec_iter(n, la):\n+            if any(j < self._gv for j in mu):\n+                continue\n             temp = c\n             for i, j in zip(la, mu):\n                 gs = self._right[j]\n                 if not gs:\n                     temp = p.zero()\n                     break\n                 temp *= p[i](gs)\n             ret += temp\n         return ret\n```\n\nHowever, it would probably be better not to generate these integer vectors in the first place.  Moreover, it is possibly a waste to compute `p[i](gs)` for each `i` in `la` separately, if `la` has many parts repeated.",
    "created_at": "2022-08-17T14:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483881",
    "user": "https://github.com/mantepse"
}
```

An easy fix is as follows:

```diff
diff --git a/src/sage/data_structures/stream.py b/src/sage/data_structures/stream.py
index e54a90b8b88..b61d29544c2 100644
--- a/src/sage/data_structures/stream.py
+++ b/src/sage/data_structures/stream.py
@@ -1763,6 +1763,14 @@ class Stream_plethysm(Stream_binary):
         p = self._p
         ret = p.zero()
         for mu in wt_int_vec_iter(n, la):
+            if any(j < self._gv for j in mu):
+                continue
             temp = c
             for i, j in zip(la, mu):
                 gs = self._right[j]
                 if not gs:
                     temp = p.zero()
                     break
                 temp *= p[i](gs)
             ret += temp
         return ret
```

However, it would probably be better not to generate these integer vectors in the first place.  Moreover, it is possibly a waste to compute `p[i](gs)` for each `i` in `la` separately, if `la` has many parts repeated.



---

archive/issue_comments_483882.json:
```json
{
    "body": "I have to leave now, but I just saw that possibly the implementation of plethysm in the species directory is more efficient.",
    "created_at": "2022-08-17T15:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483882",
    "user": "https://github.com/mantepse"
}
```

I have to leave now, but I just saw that possibly the implementation of plethysm in the species directory is more efficient.



---

archive/issue_comments_483883.json:
```json
{
    "body": "I slightly improved the implementation.  In particular, we can now specify degree one elements in the same way as for plethysm, and it is (slightly :-) faster now:\n\n```\nsage: from sage.data_structures.stream import Stream_function, Stream_plethysm, Stream_plethysm_old\nsage: s = SymmetricFunctions(QQ).s()\nsage: p = SymmetricFunctions(QQ).p()\nsage: f = Stream_function(lambda n: s[n], s, True, 1)\nsage: g = Stream_function(lambda n: s[[1]*n], s, True, 1)\nsage: h = Stream_plethysm(f, g, p)\nsage: %time _ = h[10]\nCPU times: user 122 ms, sys: 6 \u00b5s, total: 122 ms\nWall time: 122 ms\nsage: h2 = Stream_plethysm_old(f, g, p)\nsage: %time _ = h2[10]\nCPU times: user 2.13 s, sys: 0 ns, total: 2.13 s\nWall time: 2.13 s\n```\n",
    "created_at": "2022-08-22T14:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483883",
    "user": "https://github.com/mantepse"
}
```

I slightly improved the implementation.  In particular, we can now specify degree one elements in the same way as for plethysm, and it is (slightly :-) faster now:

```
sage: from sage.data_structures.stream import Stream_function, Stream_plethysm, Stream_plethysm_old
sage: s = SymmetricFunctions(QQ).s()
sage: p = SymmetricFunctions(QQ).p()
sage: f = Stream_function(lambda n: s[n], s, True, 1)
sage: g = Stream_function(lambda n: s[[1]*n], s, True, 1)
sage: h = Stream_plethysm(f, g, p)
sage: %time _ = h[10]
CPU times: user 122 ms, sys: 6 Âµs, total: 122 ms
Wall time: 122 ms
sage: h2 = Stream_plethysm_old(f, g, p)
sage: %time _ = h2[10]
CPU times: user 2.13 s, sys: 0 ns, total: 2.13 s
Wall time: 2.13 s
```




---

archive/issue_comments_483884.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2022-08-22T17:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483884",
    "user": "https://github.com/mantepse"
}
```

Last 10 new commits:



---

archive/issue_comments_483885.json:
```json
{
    "body": "Changing keywords from \"\" to \"LazyPowerSeries\".",
    "created_at": "2022-08-22T17:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483885",
    "user": "https://github.com/mantepse"
}
```

Changing keywords from "" to "LazyPowerSeries".



---

archive/issue_comments_483886.json:
```json
{
    "body": "Next I'd like to implement revert for TaylorSeries, derivative, derivative_with_respect_to_p1.\n\nStill missing: functorial_composition, arithmetic_product, logarithm for SymmetricFunctions.\n\nAll of these are needed for #32367.",
    "created_at": "2022-08-22T17:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483886",
    "user": "https://github.com/mantepse"
}
```

Next I'd like to implement revert for TaylorSeries, derivative, derivative_with_respect_to_p1.

Still missing: functorial_composition, arithmetic_product, logarithm for SymmetricFunctions.

All of these are needed for #32367.



---

archive/issue_comments_483887.json:
```json
{
    "body": "Should we `def plethysm` and make `__call__` an alias instead?  This is the way it is done in `combinat/sf/sfa.py`.",
    "created_at": "2022-08-22T20:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483887",
    "user": "https://github.com/mantepse"
}
```

Should we `def plethysm` and make `__call__` an alias instead?  This is the way it is done in `combinat/sf/sfa.py`.



---

archive/issue_comments_483888.json:
```json
{
    "body": "I agree that we should throw out integer vectors that are asking for things less than the valuation. Actually, this is simple to modify with the current code. Just subtract `valuation * len(la)` from `n`. Then you just add back in the valuation to each component of the integer vector.\n\nIt sure looks like you have just essentially duplicated the plethysm code, which I don't think we should do, especially for marginal speed gains. I think you are better off improving the symmetric functions code directly.\n\nAnother micro-optimization that can be done is to store `len(l)` in the `integer_vector_weighted.iterator_fast` code since this never changes (it can be surprising how much this extra little function call can affect speed).",
    "created_at": "2022-08-23T00:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483888",
    "user": "https://github.com/tscrim"
}
```

I agree that we should throw out integer vectors that are asking for things less than the valuation. Actually, this is simple to modify with the current code. Just subtract `valuation * len(la)` from `n`. Then you just add back in the valuation to each component of the integer vector.

It sure looks like you have just essentially duplicated the plethysm code, which I don't think we should do, especially for marginal speed gains. I think you are better off improving the symmetric functions code directly.

Another micro-optimization that can be done is to store `len(l)` in the `integer_vector_weighted.iterator_fast` code since this never changes (it can be surprising how much this extra little function call can affect speed).



---

archive/issue_comments_483889.json:
```json
{
    "body": "Replying to [comment:9 mantepse]:\n> Should we `def plethysm` and make `__call__` an alias instead?  This is the way it is done in `combinat/sf/sfa.py`.\n\nIt doesn't make any difference to me.",
    "created_at": "2022-08-23T00:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483889",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:9 mantepse]:
> Should we `def plethysm` and make `__call__` an alias instead?  This is the way it is done in `combinat/sf/sfa.py`.

It doesn't make any difference to me.



---

archive/issue_comments_483890.json:
```json
{
    "body": "I don't understand. My code is quite different, and I gain a factor 20 on the original example.",
    "created_at": "2022-08-23T04:59:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483890",
    "user": "https://github.com/mantepse"
}
```

I don't understand. My code is quite different, and I gain a factor 20 on the original example.



---

archive/issue_comments_483891.json:
```json
{
    "body": "Sorry, I just read what you wrote and took it at face value rather than actually reading the example. Indeed, that is quite an impressive speedup. I think my comment still holds about integrating it directly into the symmetric functions code. Superficially it still looks generally like the symmetric functions code. What have you changed to get that improvement?",
    "created_at": "2022-08-23T05:48:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483891",
    "user": "https://github.com/tscrim"
}
```

Sorry, I just read what you wrote and took it at face value rather than actually reading the example. Indeed, that is quite an impressive speedup. I think my comment still holds about integrating it directly into the symmetric functions code. Superficially it still looks generally like the symmetric functions code. What have you changed to get that improvement?



---

archive/issue_comments_483892.json:
```json
{
    "body": "Oh, i am sorry, that teaches me a lesson! Could we perhaps do a zoom meeting today? Maybe at 5pm Japan time?",
    "created_at": "2022-08-23T06:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483892",
    "user": "https://github.com/mantepse"
}
```

Oh, i am sorry, that teaches me a lesson! Could we perhaps do a zoom meeting today? Maybe at 5pm Japan time?



---

archive/issue_comments_483893.json:
```json
{
    "body": "Sounds good. I responded via email as well.",
    "created_at": "2022-08-23T06:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483893",
    "user": "https://github.com/tscrim"
}
```

Sounds good. I responded via email as well.



---

archive/issue_comments_483894.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-23T08:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483894",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483895.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-24T21:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483895",
    "user": "https://github.com/mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_483896.json:
```json
{
    "body": "NB: the new implementation of plethysm appears to be faster than the one in sage.combinat.sf.sfa!",
    "created_at": "2022-08-24T21:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483896",
    "user": "https://github.com/mantepse"
}
```

NB: the new implementation of plethysm appears to be faster than the one in sage.combinat.sf.sfa!



---

archive/issue_comments_483897.json:
```json
{
    "body": "Some things that should be fixed:\n\n- `_scale_part` and `_scale_c` need doctests. I might just inline the code however as they are such small and simple functions (they are needs for the symmetric functions implementation, but I think that could be improved).\n- I would explain the algorithm for `revert` in terms of (lazy) symmetric functions rather than species.\n- Instead of `sum_of_terms()`, I would just directly create a dictionary and go through `p._from_dict()` to avoid the redirection.\n- Even though its cached, I would make this change:\n  {{{#!diff\n-        if power[d]:\n-            terms = [(self._scale_part(m, i), self._raise_c(c, i)) for m, c in power[d]]\n+        val = power[d]:\n+        if val:\n+            terms = {self._scale_part(m, i): coeff for m, c in val if (coeff := self._raise_c(c, i)))}\n         else:\n-            terms = []\n+            return self._p.zero()\n \n-        return self._p.sum_of_terms(terms, distinct = True)\n+        return self._p._from_dict(terms, remove_zeros=False)\n  }}}\n  (I only very recently learned of the `:=` syntax. it is so great to have a way to assign equality in a statement in Python. It makes writing code like the above so much easier.)\n\nHowever, there is also a decent part of me that would like to see the code duplication with `sfa.plethysm()` reduced, in particular with the logic around the include/exclude. Although the same could be said for `_scale_part` and `_scale_c`, which are (essentially) the same as in the symmetric functions.\n\nLastly, shouldn't the compositional inverse also be implemented for lazy Laurent and Taylor series?",
    "created_at": "2022-08-25T00:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483897",
    "user": "https://github.com/tscrim"
}
```

Some things that should be fixed:

- `_scale_part` and `_scale_c` need doctests. I might just inline the code however as they are such small and simple functions (they are needs for the symmetric functions implementation, but I think that could be improved).
- I would explain the algorithm for `revert` in terms of (lazy) symmetric functions rather than species.
- Instead of `sum_of_terms()`, I would just directly create a dictionary and go through `p._from_dict()` to avoid the redirection.
- Even though its cached, I would make this change:
  {{{#!diff
-        if power[d]:
-            terms = [(self._scale_part(m, i), self._raise_c(c, i)) for m, c in power[d]]
+        val = power[d]:
+        if val:
+            terms = {self._scale_part(m, i): coeff for m, c in val if (coeff := self._raise_c(c, i)))}
         else:
-            terms = []
+            return self._p.zero()
 
-        return self._p.sum_of_terms(terms, distinct = True)
+        return self._p._from_dict(terms, remove_zeros=False)
  }}}
  (I only very recently learned of the `:=` syntax. it is so great to have a way to assign equality in a statement in Python. It makes writing code like the above so much easier.)

However, there is also a decent part of me that would like to see the code duplication with `sfa.plethysm()` reduced, in particular with the logic around the include/exclude. Although the same could be said for `_scale_part` and `_scale_c`, which are (essentially) the same as in the symmetric functions.

Lastly, shouldn't the compositional inverse also be implemented for lazy Laurent and Taylor series?



---

archive/issue_comments_483898.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-25T10:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483898",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483899.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-25T14:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483899",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483900.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-25T19:52:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483900",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483901.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-25T21:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483901",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483902.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-08-25T21:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483902",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_483903.json:
```json
{
    "body": "revert for Taylor is still missing (possibly I can simply redirect to Laurent), and revert for SymmetricFunctions still needs some care.",
    "created_at": "2022-08-25T21:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483903",
    "user": "https://github.com/mantepse"
}
```

revert for Taylor is still missing (possibly I can simply redirect to Laurent), and revert for SymmetricFunctions still needs some care.



---

archive/issue_comments_483904.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-25T21:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483904",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483905.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-26T07:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483905",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483906.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-26T07:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483906",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483907.json:
```json
{
    "body": "Concerning code duplication:\n\n* scale_part might be a useful action on partitions.  Can this be made fast?\n\n* the handling of degree one elements could go into a separate top-level function, but I have no idea where to place it.  Possibly sfa.py?  Alternatively it could be a method on rings.  It might look as follows:\n\n\n```\ndef _degree_one_elements(R, include=None, exclude=None):\n    \"\"\"\nReturn variables in the ring `R`.\n\n    INPUT:\n\n    - ``R`` -- a :class:`Ring`\n    - ``include``, ``exclude`` (optional, default ``None``) --\n      iterables of variables in ``R``\n\n    OUTPUT:\n    \n    - If ``include`` is specified, only these variables are returned\n      as elements of ``R``.  Otherwise, all variables in ``R``\n      (recursively) with the exception of those in ``exclude`` are\n      returned.\n\n    \"\"\"\n    if include is not None and exclude is not None:\n        raise RuntimeError(\"include and exclude cannot both be specified\")\n\n    if include is not None:\n        degree_one = [R(g) for g in include]\n    else:\n        try:\n            degree_one = [R(g) for g in R.variable_names_recursive()]\n        except AttributeError:\n            try:\n                degree_one = R.gens()\n            except NotImplementedError:\n                degree_one = []\n        if exclude is not None:\n            degree_one = [g for g in degree_one if g not in exclude]\n\n    return [g for g in degree_one if g != R.one()]\n```\n\n\nBesides, is the following a bug?\n\n```\nsage: ZZ.variable_names()\n('x',)\nsage: ZZ\nInteger Ring\n```\n",
    "created_at": "2022-08-26T07:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483907",
    "user": "https://github.com/mantepse"
}
```

Concerning code duplication:

* scale_part might be a useful action on partitions.  Can this be made fast?

* the handling of degree one elements could go into a separate top-level function, but I have no idea where to place it.  Possibly sfa.py?  Alternatively it could be a method on rings.  It might look as follows:


```
def _degree_one_elements(R, include=None, exclude=None):
    """
Return variables in the ring `R`.

    INPUT:

    - ``R`` -- a :class:`Ring`
    - ``include``, ``exclude`` (optional, default ``None``) --
      iterables of variables in ``R``

    OUTPUT:
    
    - If ``include`` is specified, only these variables are returned
      as elements of ``R``.  Otherwise, all variables in ``R``
      (recursively) with the exception of those in ``exclude`` are
      returned.

    """
    if include is not None and exclude is not None:
        raise RuntimeError("include and exclude cannot both be specified")

    if include is not None:
        degree_one = [R(g) for g in include]
    else:
        try:
            degree_one = [R(g) for g in R.variable_names_recursive()]
        except AttributeError:
            try:
                degree_one = R.gens()
            except NotImplementedError:
                degree_one = []
        if exclude is not None:
            degree_one = [g for g in degree_one if g not in exclude]

    return [g for g in degree_one if g != R.one()]
```


Besides, is the following a bug?

```
sage: ZZ.variable_names()
('x',)
sage: ZZ
Integer Ring
```




---

archive/issue_comments_483908.json:
```json
{
    "body": "I hope to implement implement multivariate plethysm and reversion for Taylor today, and fix the remaining (few) issues in #32367.  Wish me good luck.",
    "created_at": "2022-08-26T07:39:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483908",
    "user": "https://github.com/mantepse"
}
```

I hope to implement implement multivariate plethysm and reversion for Taylor today, and fix the remaining (few) issues in #32367.  Wish me good luck.



---

archive/issue_comments_483909.json:
```json
{
    "body": "Replying to [comment:28 mantepse]:\n> * scale_part might be a useful action on partitions.  Can this be made fast?\n\nNo faster than the current implementation I think. However, +1 for making it a method of partitions. (Note that it should return an element of `_Partitions`, not the parent of itself.)\n\n> * the handling of degree one elements could go into a separate top-level function, but I have no idea where to place it.  Possibly sfa.py?  Alternatively it could be a method on rings.  It might look as follows:\n> \n> {{{\n> def _degree_one_elements(R, include=None, exclude=None):\n>     \"\"\"\n>     Return variables in the ring `R`.\n> \n>     INPUT:\n> \n>     - ``R`` -- a :class:`Ring`\n>     - ``include``, ``exclude`` (optional, default ``None``) --\n>       iterables of variables in ``R``\n> \n>     OUTPUT:\n>     \n>     - If ``include`` is specified, only these variables are returned\n>       as elements of ``R``.  Otherwise, all variables in ``R``\n>       (recursively) with the exception of those in ``exclude`` are\n>       returned.\n> \n>     \"\"\"\n>     if include is not None and exclude is not None:\n>         raise RuntimeError(\"include and exclude cannot both be specified\")\n> \n>     if include is not None:\n>         degree_one = [R(g) for g in include]\n>     else:\n>         try:\n>             degree_one = [R(g) for g in R.variable_names_recursive()]\n>         except AttributeError:\n>             try:\n>                 degree_one = R.gens()\n>             except NotImplementedError:\n>                 degree_one = []\n>         if exclude is not None:\n>             degree_one = [g for g in degree_one if g not in exclude]\n> \n>     return [g for g in degree_one if g != R.one()]\n> }}}\n\n+1 as a top-level function in `sfa.py`. I would call it `_parse_degree_one_elements` and maybe tweak the one-line doc to be a little more precise about what it does. However, those are fairly trivial comments.\n\n> Besides, is the following a bug?\n> {{{\n> sage: ZZ.variable_names()\n> ('x',)\n> sage: ZZ\n> Integer Ring\n> }}}\n\nI think it is the result of very legacy code with it being a subclass of `sage.structure.parent_gens.ParentWithGens` and likely a requirement of the names being non-empty. See also\n\n```\nsage: QQ.variable_names()\n('x',)\n```\n\nI would like to call it a bug, but that is perhaps slightly unfair.\n\nGood luck!",
    "created_at": "2022-08-26T07:43:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483909",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:28 mantepse]:
> * scale_part might be a useful action on partitions.  Can this be made fast?

No faster than the current implementation I think. However, +1 for making it a method of partitions. (Note that it should return an element of `_Partitions`, not the parent of itself.)

> * the handling of degree one elements could go into a separate top-level function, but I have no idea where to place it.  Possibly sfa.py?  Alternatively it could be a method on rings.  It might look as follows:
> 
> {{{
> def _degree_one_elements(R, include=None, exclude=None):
>     """
>     Return variables in the ring `R`.
> 
>     INPUT:
> 
>     - ``R`` -- a :class:`Ring`
>     - ``include``, ``exclude`` (optional, default ``None``) --
>       iterables of variables in ``R``
> 
>     OUTPUT:
>     
>     - If ``include`` is specified, only these variables are returned
>       as elements of ``R``.  Otherwise, all variables in ``R``
>       (recursively) with the exception of those in ``exclude`` are
>       returned.
> 
>     """
>     if include is not None and exclude is not None:
>         raise RuntimeError("include and exclude cannot both be specified")
> 
>     if include is not None:
>         degree_one = [R(g) for g in include]
>     else:
>         try:
>             degree_one = [R(g) for g in R.variable_names_recursive()]
>         except AttributeError:
>             try:
>                 degree_one = R.gens()
>             except NotImplementedError:
>                 degree_one = []
>         if exclude is not None:
>             degree_one = [g for g in degree_one if g not in exclude]
> 
>     return [g for g in degree_one if g != R.one()]
> }}}

+1 as a top-level function in `sfa.py`. I would call it `_parse_degree_one_elements` and maybe tweak the one-line doc to be a little more precise about what it does. However, those are fairly trivial comments.

> Besides, is the following a bug?
> {{{
> sage: ZZ.variable_names()
> ('x',)
> sage: ZZ
> Integer Ring
> }}}

I think it is the result of very legacy code with it being a subclass of `sage.structure.parent_gens.ParentWithGens` and likely a requirement of the names being non-empty. See also

```
sage: QQ.variable_names()
('x',)
```

I would like to call it a bug, but that is perhaps slightly unfair.

Good luck!



---

archive/issue_comments_483910.json:
```json
{
    "body": "Replying to [comment:30 tscrim]:\n> Replying to [comment:28 mantepse]:\n> > * scale_part might be a useful action on partitions.  Can this be made fast?\n> \n> No faster than the current implementation I think. However, +1 for making it a method of partitions. (Note that it should return an element of `_Partitions`, not the parent of itself.)\n\nThus, it should *not* be `_acted_upon_`, but rather `scale`, right?",
    "created_at": "2022-08-26T08:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483910",
    "user": "https://github.com/mantepse"
}
```

Replying to [comment:30 tscrim]:
> Replying to [comment:28 mantepse]:
> > * scale_part might be a useful action on partitions.  Can this be made fast?
> 
> No faster than the current implementation I think. However, +1 for making it a method of partitions. (Note that it should return an element of `_Partitions`, not the parent of itself.)

Thus, it should *not* be `_acted_upon_`, but rather `scale`, right?



---

archive/issue_comments_483911.json:
```json
{
    "body": "It could be an action of `NN` on partitions, but I think that is a much broader change than what is needed. If we wanted to do that, it would definitely need to be another ticket.\n\nSo yes, I would call it something like `stretch()`.",
    "created_at": "2022-08-26T08:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483911",
    "user": "https://github.com/tscrim"
}
```

It could be an action of `NN` on partitions, but I think that is a much broader change than what is needed. If we wanted to do that, it would definitely need to be another ticket.

So yes, I would call it something like `stretch()`.



---

archive/issue_comments_483912.json:
```json
{
    "body": "Concerning the naming of the new function in `sfa.py`: it seems to me that this might be useful in other contexts, too.\n\nIt has actually very little to do with `degree_one_elements`.  Rather, it provides a safe way to get all variables in a ring, possibly excluding some (and, rarely, only including some).  (With the minor annoyance that it doesn't always work.  For example, fraction fields over iterated polynomial rings will not give the correct answer.)\n\nI'd thus like to call it for what it does, rather than what it is used for, eg. `_variable_names_recursive`.",
    "created_at": "2022-08-26T08:58:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483912",
    "user": "https://github.com/mantepse"
}
```

Concerning the naming of the new function in `sfa.py`: it seems to me that this might be useful in other contexts, too.

It has actually very little to do with `degree_one_elements`.  Rather, it provides a safe way to get all variables in a ring, possibly excluding some (and, rarely, only including some).  (With the minor annoyance that it doesn't always work.  For example, fraction fields over iterated polynomial rings will not give the correct answer.)

I'd thus like to call it for what it does, rather than what it is used for, eg. `_variable_names_recursive`.



---

archive/issue_comments_483913.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-26T10:27:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483913",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483914.json:
```json
{
    "body": "Replying to [comment:33 mantepse]:\n> I'd thus like to call it for what it does, rather than what it is used for, eg. `_variable_names_recursive`.\n\nThat's fine by me.",
    "created_at": "2022-08-26T10:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483914",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:33 mantepse]:
> I'd thus like to call it for what it does, rather than what it is used for, eg. `_variable_names_recursive`.

That's fine by me.



---

archive/issue_comments_483915.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-26T12:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483915",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483916.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-26T17:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483916",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483917.json:
```json
{
    "body": "I created #34441 for the issue about `ZZ.variable_names()` that was mentioned in comment:28 and comment:30. IMHO it's a bug.",
    "created_at": "2022-08-26T18:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483917",
    "user": "https://github.com/DaveWitteMorris"
}
```

I created #34441 for the issue about `ZZ.variable_names()` that was mentioned in comment:28 and comment:30. IMHO it's a bug.



---

archive/issue_comments_483918.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-27T09:09:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483918",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483919.json:
```json
{
    "body": "The only missing method is reversion for Taylor series now.",
    "created_at": "2022-08-27T09:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483919",
    "user": "https://github.com/mantepse"
}
```

The only missing method is reversion for Taylor series now.



---

archive/issue_comments_483920.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-27T16:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483920",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483921.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-28T08:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483921",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483922.json:
```json
{
    "body": "There remains a bug in `LazyTaylorSeries.__call__`:\n\nAt the very beginning, we deal with the case where f is a polynomial:\n\n```\n        # f has finite length\n        if isinstance(self._coeff_stream, Stream_exact) and not self._coeff_stream._constant:\n            # constant polynomial\n            poly = self.polynomial()\n            if poly.is_constant():\n                return P(poly)\n            return P(poly(g))\n```\n\nHowever, this is too eager.  In the example below, we would like to compute `g.define(z / ((1-z)(g)))`, which fails, whereas `g.define(z / (1-g))` works.  Also, if we compute in the `LazyLaurentSeriesRing` instead, there is no problem.\n\nIt would be great if `LazyLaurentSeries.__call__` and `LazyTaylorSeries.__call__` and perhaps even `LazySymmetricFunction.__call__` could share some code, to avoid these inconsistencies.\n\n\nExample:\n\n```\nsage: L.<z> = LazyTaylorSeriesRing(QQ)\nsage: f = 1 - z\nsage: g = L(None, valuation=1)\nsage: g.define(z / (1 - g))\nsage: g\nz + z^2 + 2*z^3 + 5*z^4 + 14*z^5 + 42*z^6 + 132*z^7 + O(z^8)\n\nsage: g = L(None, valuation=1)\nsage: g.define(z / f(g))\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\nFile ~/sage-develop/src/sage/data_structures/stream.py:329, in Stream_inexact.__getitem__(self, n)\n    328 try:\n--> 329     c = self._cache[n]\n    330 except KeyError:\n\nKeyError: 1\n\nDuring handling of the above exception, another exception occurred:\n\nTypeError                                 Traceback (most recent call last)\nInput In [10], in <cell line: 1>()\n----> 1 g.define(z / f(g))\n\nFile ~/sage-develop/src/sage/rings/lazy_series.py:3508, in LazyTaylorSeries.__call__(self, check, *g)\n   3506     if poly.is_constant():\n   3507         return P(poly)\n-> 3508     return P(poly(g))\n   3510 # f now has (potentially) infinitely many terms\n   3511 # Lift the resulting parent to a lazy series (if possible)\n   3512 # Also make sure each element of g is a LazyModuleElement\n   3513 from sage.rings.polynomial.polynomial_ring import PolynomialRing_general\n\nFile ~/sage-develop/src/sage/rings/polynomial/polynomial_rational_flint.pyx:552, in sage.rings.polynomial.polynomial_rational_flint.Polynomial_rational_flint.__call__()\n    550             return acb_z\n    551 \n--> 552     return Polynomial.__call__(self, *x, **kwds)\n    553 \n    554 cpdef Polynomial truncate(self, long n):\n\nFile ~/sage-develop/src/sage/rings/polynomial/polynomial_element.pyx:881, in sage.rings.polynomial.polynomial_element.Polynomial.__call__()\n    879 d = pol.degree()\n    880 \n--> 881 if d <= 0 or (isinstance(a, Element) and R.is_exact() and a.is_zero()):\n    882     return cst # with the right parent thanks to the above coercion\n    883 elif pol._parent is R and a.is_gen():\n\nFile ~/sage-develop/src/sage/structure/element.pyx:1064, in sage.structure.element.Element.is_zero()\n   1062         implement ``__bool__`` instead.\n   1063     \"\"\"\n-> 1064     return not self\n   1065 \n   1066 def _cache_key(self):\n\nFile ~/sage-develop/src/sage/rings/lazy_series.py:618, in LazyModuleElement.__bool__(self)\n    616     if any(a for a in self._coeff_stream._cache):\n    617         return True\n--> 618 if self[self._coeff_stream._approximate_order]:\n    619     return True\n    620 raise ValueError(\"undecidable as lazy Laurent series\")\n\nFile ~/sage-develop/src/sage/rings/lazy_series.py:254, in LazyModuleElement.__getitem__(self, n)\n    252     step = n.step if n.step is not None else 1\n    253     return [R(self._coeff_stream[k]) for k in range(start, n.stop, step)]\n--> 254 return R(self._coeff_stream[n])\n\nFile ~/sage-develop/src/sage/data_structures/stream.py:331, in Stream_inexact.__getitem__(self, n)\n    329         c = self._cache[n]\n    330     except KeyError:\n--> 331         c = self.get_coefficient(n)\n    332         self._cache[n] = c\n    333 else:\n\nFile ~/sage-develop/src/sage/data_structures/stream.py:876, in Stream_uninitialized.get_coefficient(self, n)\n    857 def get_coefficient(self, n):\n    858     \"\"\"\n    859     Return the ``n``-th coefficient of ``self``.\n    860 \n   (...)\n    874         1\n    875     \"\"\"\n--> 876     return self._target[n]\n\nTypeError: 'NoneType' object is not subscriptable\n```\n",
    "created_at": "2022-08-28T09:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483922",
    "user": "https://github.com/mantepse"
}
```

There remains a bug in `LazyTaylorSeries.__call__`:

At the very beginning, we deal with the case where f is a polynomial:

```
        # f has finite length
        if isinstance(self._coeff_stream, Stream_exact) and not self._coeff_stream._constant:
            # constant polynomial
            poly = self.polynomial()
            if poly.is_constant():
                return P(poly)
            return P(poly(g))
```

However, this is too eager.  In the example below, we would like to compute `g.define(z / ((1-z)(g)))`, which fails, whereas `g.define(z / (1-g))` works.  Also, if we compute in the `LazyLaurentSeriesRing` instead, there is no problem.

It would be great if `LazyLaurentSeries.__call__` and `LazyTaylorSeries.__call__` and perhaps even `LazySymmetricFunction.__call__` could share some code, to avoid these inconsistencies.


Example:

```
sage: L.<z> = LazyTaylorSeriesRing(QQ)
sage: f = 1 - z
sage: g = L(None, valuation=1)
sage: g.define(z / (1 - g))
sage: g
z + z^2 + 2*z^3 + 5*z^4 + 14*z^5 + 42*z^6 + 132*z^7 + O(z^8)

sage: g = L(None, valuation=1)
sage: g.define(z / f(g))
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
File ~/sage-develop/src/sage/data_structures/stream.py:329, in Stream_inexact.__getitem__(self, n)
    328 try:
--> 329     c = self._cache[n]
    330 except KeyError:

KeyError: 1

During handling of the above exception, another exception occurred:

TypeError                                 Traceback (most recent call last)
Input In [10], in <cell line: 1>()
----> 1 g.define(z / f(g))

File ~/sage-develop/src/sage/rings/lazy_series.py:3508, in LazyTaylorSeries.__call__(self, check, *g)
   3506     if poly.is_constant():
   3507         return P(poly)
-> 3508     return P(poly(g))
   3510 # f now has (potentially) infinitely many terms
   3511 # Lift the resulting parent to a lazy series (if possible)
   3512 # Also make sure each element of g is a LazyModuleElement
   3513 from sage.rings.polynomial.polynomial_ring import PolynomialRing_general

File ~/sage-develop/src/sage/rings/polynomial/polynomial_rational_flint.pyx:552, in sage.rings.polynomial.polynomial_rational_flint.Polynomial_rational_flint.__call__()
    550             return acb_z
    551 
--> 552     return Polynomial.__call__(self, *x, **kwds)
    553 
    554 cpdef Polynomial truncate(self, long n):

File ~/sage-develop/src/sage/rings/polynomial/polynomial_element.pyx:881, in sage.rings.polynomial.polynomial_element.Polynomial.__call__()
    879 d = pol.degree()
    880 
--> 881 if d <= 0 or (isinstance(a, Element) and R.is_exact() and a.is_zero()):
    882     return cst # with the right parent thanks to the above coercion
    883 elif pol._parent is R and a.is_gen():

File ~/sage-develop/src/sage/structure/element.pyx:1064, in sage.structure.element.Element.is_zero()
   1062         implement ``__bool__`` instead.
   1063     """
-> 1064     return not self
   1065 
   1066 def _cache_key(self):

File ~/sage-develop/src/sage/rings/lazy_series.py:618, in LazyModuleElement.__bool__(self)
    616     if any(a for a in self._coeff_stream._cache):
    617         return True
--> 618 if self[self._coeff_stream._approximate_order]:
    619     return True
    620 raise ValueError("undecidable as lazy Laurent series")

File ~/sage-develop/src/sage/rings/lazy_series.py:254, in LazyModuleElement.__getitem__(self, n)
    252     step = n.step if n.step is not None else 1
    253     return [R(self._coeff_stream[k]) for k in range(start, n.stop, step)]
--> 254 return R(self._coeff_stream[n])

File ~/sage-develop/src/sage/data_structures/stream.py:331, in Stream_inexact.__getitem__(self, n)
    329         c = self._cache[n]
    330     except KeyError:
--> 331         c = self.get_coefficient(n)
    332         self._cache[n] = c
    333 else:

File ~/sage-develop/src/sage/data_structures/stream.py:876, in Stream_uninitialized.get_coefficient(self, n)
    857 def get_coefficient(self, n):
    858     """
    859     Return the ``n``-th coefficient of ``self``.
    860 
   (...)
    874         1
    875     """
--> 876     return self._target[n]

TypeError: 'NoneType' object is not subscriptable
```




---

archive/issue_comments_483923.json:
```json
{
    "body": "Actually, it is not a bug in the lazy Taylor series code. In fact, it i working \u201ccorrectly\u201d because it is trying a very basic test to see if it is zero or not, the test of which is out of our hands, which at the time it does not know. I would actually expect the same problem in the `LazyLaurentSeriesRing`.\n\nTo fix this, the quick-n-dirty fix would be to have an uninitialized series have `__bool__()` simply return `True` as it represents a variable that has yet to be specialized . This would make it consistent with variables of a polynomial ring or symbolic variables. )Plus, in nearly all use cases, this will end up defining a non-zero series anyways.) Actually, because of that, I would even say this is the correct thing to do, and not simply a hack solution.\n\nA more broader change to fix the problem would be to have some kind of lazily-evaluated version of composition. Not only would it increase the code complexity when there is arguably a valid solution, it also would not be compatible with polynomials that can be evaluated at elements of the lazy series ring `R` with the result being coerced into `R`. Note that the polynomial itself does \u2018\u2019not\u2019\u2019 even need to convert (much less coerce) into `R`. So this would just sweep this problem under the rug (this includes even the extreme change of removing the exact implementation or feeding off to the polynomial code).\n\nHaving written all of this down, I am fully convinced we should just make it work by saying an uninitialized series is considered to be non-zero by having `__bool__()` return `True` in that case.",
    "created_at": "2022-08-28T13:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483923",
    "user": "https://github.com/tscrim"
}
```

Actually, it is not a bug in the lazy Taylor series code. In fact, it i working âcorrectlyâ because it is trying a very basic test to see if it is zero or not, the test of which is out of our hands, which at the time it does not know. I would actually expect the same problem in the `LazyLaurentSeriesRing`.

To fix this, the quick-n-dirty fix would be to have an uninitialized series have `__bool__()` simply return `True` as it represents a variable that has yet to be specialized . This would make it consistent with variables of a polynomial ring or symbolic variables. )Plus, in nearly all use cases, this will end up defining a non-zero series anyways.) Actually, because of that, I would even say this is the correct thing to do, and not simply a hack solution.

A more broader change to fix the problem would be to have some kind of lazily-evaluated version of composition. Not only would it increase the code complexity when there is arguably a valid solution, it also would not be compatible with polynomials that can be evaluated at elements of the lazy series ring `R` with the result being coerced into `R`. Note that the polynomial itself does âânotââ even need to convert (much less coerce) into `R`. So this would just sweep this problem under the rug (this includes even the extreme change of removing the exact implementation or feeding off to the polynomial code).

Having written all of this down, I am fully convinced we should just make it work by saying an uninitialized series is considered to be non-zero by having `__bool__()` return `True` in that case.



---

archive/issue_comments_483924.json:
```json
{
    "body": "I'm afraid I simply do not understand your argument.  You say that you \"would actually expect the same problem in the `LazyLaurentSeriesRing`, but I don't see the problem there:\n\n```\nsage: L.<z> = LazyLaurentSeriesRing(QQ)\nsage: f = 1-z\nsage: g = L(None, valuation=1)\nsage: g.define(z / f(g))\nsage: g\nz + z^2 + 2*z^3 + 5*z^4 + 14*z^5 + 42*z^6 + 132*z^7 + O(z^8)\n```\n\nIn fact, this is (essentially) a doctest.\n\nIn `LazyLaurentSeries.__call__`, if `f` is a polynomial, we use the following test before composing the polynomial with `g`:\n* if `g` is not a `LazyModuleElement`, we compose\n* otherwise, if `g` is a `LazyCauchyProductSeries` and `g._coeff_stream` is `Stream_exact` and `not g._coeff_stream._constant`, we also do a special case\n* finally, if none of the above applies, we use the generic algorithm.\n\nI don't see where `g.__bool__` would come into play here.",
    "created_at": "2022-08-28T19:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483924",
    "user": "https://github.com/mantepse"
}
```

I'm afraid I simply do not understand your argument.  You say that you "would actually expect the same problem in the `LazyLaurentSeriesRing`, but I don't see the problem there:

```
sage: L.<z> = LazyLaurentSeriesRing(QQ)
sage: f = 1-z
sage: g = L(None, valuation=1)
sage: g.define(z / f(g))
sage: g
z + z^2 + 2*z^3 + 5*z^4 + 14*z^5 + 42*z^6 + 132*z^7 + O(z^8)
```

In fact, this is (essentially) a doctest.

In `LazyLaurentSeries.__call__`, if `f` is a polynomial, we use the following test before composing the polynomial with `g`:
* if `g` is not a `LazyModuleElement`, we compose
* otherwise, if `g` is a `LazyCauchyProductSeries` and `g._coeff_stream` is `Stream_exact` and `not g._coeff_stream._constant`, we also do a special case
* finally, if none of the above applies, we use the generic algorithm.

I don't see where `g.__bool__` would come into play here.



---

archive/issue_comments_483925.json:
```json
{
    "body": "I tried to do a consistency check.  I'm sure it could be improved.\n\n```\n    sage: def check(L, z, verbose=False):\n    ....:     # division\n    ....:     lf = [0, L(0), 1, L(1), z, 1 + z, 2 + z + z^2]\n    ....:     lg = [3, L(3), 1 + z, 2 + z + z^2]\n    ....:     for f in lf:\n    ....:         for g in lg:\n    ....:             try:\n    ....:                 h = f / g\n    ....:                 if verbose: print(\"(%s) / (%s) = %s\" % (f, g, h))\n    ....:             except Exception as e:\n    ....:                 print(\"%s in (%s) / (%s)\" % (e, f, g))\n    ....:     # composition\n    ....:     f = 2 + z + z^2\n    ....:     l = [(f, 0), (f, L(0)), (f, 2 + z + z^2), (f, L(3)/(1 - 2*z))]\n    ....:     f = L(3)/(2 - 3*z)\n    ....:     l.extend([(f, 0), (f, L(0)), (f, 3*z/(1 - 2*z))])\n    ....:     for f, g in l:\n    ....:         try:\n    ....:             h = f(g)\n    ....:             if verbose: print(\"(%s)(%s) = %s\" % (f, g, h))\n    ....:         except Exception as e:\n    ....:             print(\"%s in (%s)(%s)\" % (e, f, g))\n    ....:     # reversion\n    ....:     l = [2 + 3*z, 3*z + 2*z^2, 3*z/(1 - 2*z - 3*z^2)]\n    ....:     for f in l:\n    ....:         try:\n    ....:             h = f.revert()\n    ....:             if verbose: print(\"(%s)^{(-1)} = %s\" % (f, h))\n    ....:         except Exception as e:\n    ....:             print(\"%s in (%s).revert()\" % (e, f))\n```\n\n\nThe current results are as follows:\n\n```\nsage: L.<z> = LazyLaurentSeriesRing(QQ)\nsage: check(L, z)\n\nsage: L.<z> = LazyTaylorSeriesRing(QQ)\nsage: check(L, z)\nunable to evaluate the series at (0,) in (3/2 + 9/4*z + 27/8*z^2 + 81/16*z^3 + 243/32*z^4 + 729/64*z^5 + 2187/128*z^6 + O(z^7))(0)\n'NoneType' object is not subscriptable in (3*z + 2*z^2).revert()\n\nsage: p = SymmetricFunctions(QQ).p()\nsage: L = LazySymmetricFunctions(p)\nsage: check(L, L(p[1]))\ncan only compose with a positive valuation series in (2*p[] + p[1] + (p[1,1]))(3*p[] + 6*p[1] + (12*p[1,1]) + (24*p[1,1,1]) + (48*p[1,1,1,1]) + (96*p[1,1,1,1,1]) + (192*p[1,1,1,1,1,1]) + O^7)\nno conversion of this rational to integer in (3/2*p[] + 9/4*p[1] + (27/8*p[1,1]) + (81/16*p[1,1,1]) + (243/32*p[1,1,1,1]) + (729/64*p[1,1,1,1,1]) + (2187/128*p[1,1,1,1,1,1]) + O^7)(0)\n```\n",
    "created_at": "2022-08-28T20:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483925",
    "user": "https://github.com/mantepse"
}
```

I tried to do a consistency check.  I'm sure it could be improved.

```
    sage: def check(L, z, verbose=False):
    ....:     # division
    ....:     lf = [0, L(0), 1, L(1), z, 1 + z, 2 + z + z^2]
    ....:     lg = [3, L(3), 1 + z, 2 + z + z^2]
    ....:     for f in lf:
    ....:         for g in lg:
    ....:             try:
    ....:                 h = f / g
    ....:                 if verbose: print("(%s) / (%s) = %s" % (f, g, h))
    ....:             except Exception as e:
    ....:                 print("%s in (%s) / (%s)" % (e, f, g))
    ....:     # composition
    ....:     f = 2 + z + z^2
    ....:     l = [(f, 0), (f, L(0)), (f, 2 + z + z^2), (f, L(3)/(1 - 2*z))]
    ....:     f = L(3)/(2 - 3*z)
    ....:     l.extend([(f, 0), (f, L(0)), (f, 3*z/(1 - 2*z))])
    ....:     for f, g in l:
    ....:         try:
    ....:             h = f(g)
    ....:             if verbose: print("(%s)(%s) = %s" % (f, g, h))
    ....:         except Exception as e:
    ....:             print("%s in (%s)(%s)" % (e, f, g))
    ....:     # reversion
    ....:     l = [2 + 3*z, 3*z + 2*z^2, 3*z/(1 - 2*z - 3*z^2)]
    ....:     for f in l:
    ....:         try:
    ....:             h = f.revert()
    ....:             if verbose: print("(%s)^{(-1)} = %s" % (f, h))
    ....:         except Exception as e:
    ....:             print("%s in (%s).revert()" % (e, f))
```


The current results are as follows:

```
sage: L.<z> = LazyLaurentSeriesRing(QQ)
sage: check(L, z)

sage: L.<z> = LazyTaylorSeriesRing(QQ)
sage: check(L, z)
unable to evaluate the series at (0,) in (3/2 + 9/4*z + 27/8*z^2 + 81/16*z^3 + 243/32*z^4 + 729/64*z^5 + 2187/128*z^6 + O(z^7))(0)
'NoneType' object is not subscriptable in (3*z + 2*z^2).revert()

sage: p = SymmetricFunctions(QQ).p()
sage: L = LazySymmetricFunctions(p)
sage: check(L, L(p[1]))
can only compose with a positive valuation series in (2*p[] + p[1] + (p[1,1]))(3*p[] + 6*p[1] + (12*p[1,1]) + (24*p[1,1,1]) + (48*p[1,1,1,1]) + (96*p[1,1,1,1,1]) + (192*p[1,1,1,1,1,1]) + O^7)
no conversion of this rational to integer in (3/2*p[] + 9/4*p[1] + (27/8*p[1,1]) + (81/16*p[1,1,1]) + (243/32*p[1,1,1,1]) + (729/64*p[1,1,1,1,1]) + (2187/128*p[1,1,1,1,1,1]) + O^7)(0)
```




---

archive/issue_comments_483926.json:
```json
{
    "body": "Replying to [comment:45 mantepse]:\n> I'm afraid I simply do not understand your argument.  You say that you \"would actually expect the same problem in the `LazyLaurentSeriesRing`, but I don't see the problem there:\n> {{{\n> sage: L.<z> = LazyLaurentSeriesRing(QQ)\n> sage: f = 1-z\n> sage: g = L(None, valuation=1)\n> sage: g.define(z / f(g))\n> sage: g\n> z + z^2 + 2*z^3 + 5*z^4 + 14*z^5 + 42*z^6 + 132*z^7 + O(z^8)\n> }}}\n> In fact, this is (essentially) a doctest.\n> \n> In `LazyLaurentSeries.__call__`, if `f` is a polynomial, we use the following test before composing the polynomial with `g`:\n> * if `g` is not a `LazyModuleElement`, we compose\n> * otherwise, if `g` is a `LazyCauchyProductSeries` and `g._coeff_stream` is `Stream_exact` and `not g._coeff_stream._constant`, we also do a special case\n> * finally, if none of the above applies, we use the generic algorithm.\n\nIn some respects, we get lucky here. I would expect the following to work:\n\n```\nsage: L.<z> = LazyLaurentSeriesRing(QQ)\nsage: f = 1 - z\nsage: g = L(None, valuation=1)\nsage: f(g) == f.polynomial()(g)\n```\n\nIn particular, the `f.polynomial()(g)` fails in exactly the same way as above.\n\nThe only reason we need to do anything special is for the negative exponents when `g` is exact. Everything else is just an optimization (as the comment there indicates, it should be replaceable by `return poly(g)`) to take advantage of caching (it could also benefit by reducing the number of multiplications too).\n\n> I don't see where `g.__bool__` would come into play here.\n\nIt is there in the error message as there is a call to `is_zero()`.",
    "created_at": "2022-08-28T23:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483926",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:45 mantepse]:
> I'm afraid I simply do not understand your argument.  You say that you "would actually expect the same problem in the `LazyLaurentSeriesRing`, but I don't see the problem there:
> {{{
> sage: L.<z> = LazyLaurentSeriesRing(QQ)
> sage: f = 1-z
> sage: g = L(None, valuation=1)
> sage: g.define(z / f(g))
> sage: g
> z + z^2 + 2*z^3 + 5*z^4 + 14*z^5 + 42*z^6 + 132*z^7 + O(z^8)
> }}}
> In fact, this is (essentially) a doctest.
> 
> In `LazyLaurentSeries.__call__`, if `f` is a polynomial, we use the following test before composing the polynomial with `g`:
> * if `g` is not a `LazyModuleElement`, we compose
> * otherwise, if `g` is a `LazyCauchyProductSeries` and `g._coeff_stream` is `Stream_exact` and `not g._coeff_stream._constant`, we also do a special case
> * finally, if none of the above applies, we use the generic algorithm.

In some respects, we get lucky here. I would expect the following to work:

```
sage: L.<z> = LazyLaurentSeriesRing(QQ)
sage: f = 1 - z
sage: g = L(None, valuation=1)
sage: f(g) == f.polynomial()(g)
```

In particular, the `f.polynomial()(g)` fails in exactly the same way as above.

The only reason we need to do anything special is for the negative exponents when `g` is exact. Everything else is just an optimization (as the comment there indicates, it should be replaceable by `return poly(g)`) to take advantage of caching (it could also benefit by reducing the number of multiplications too).

> I don't see where `g.__bool__` would come into play here.

It is there in the error message as there is a call to `is_zero()`.



---

archive/issue_comments_483927.json:
```json
{
    "body": "I am a bit happy as it seems on a simple example that my optimization is faster:\n\n```\nsage: L.<z> = LazyLaurentSeriesRing(QQ)\nsage: f = z^-1 + 2 + z + z^2 + 2*z^3\nsage: g = z^-2 / (1 - z)\n\nsage: %time (f(g))[300]\nCPU times: user 25.6 ms, sys: 10 \u00b5s, total: 25.6 ms\nWall time: 25.2 ms\n94862\nsage: %time (f.polynomial()(g))[300]\nCPU times: user 92.1 ms, sys: 0 ns, total: 92.1 ms\nWall time: 91.8 ms\n94862\n\nsage: %time (f(g))[3000]\nCPU times: user 2.22 s, sys: 0 ns, total: 2.22 s\nWall time: 2.22 s\n9048062\nsage: %time (f.polynomial()(g))[3000]\nCPU times: user 8.2 s, sys: 0 ns, total: 8.2 s\nWall time: 8.2 s\n9048062\n```\n\nAll come behold the power of the cache and rejoice. `:P`",
    "created_at": "2022-08-29T00:08:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483927",
    "user": "https://github.com/tscrim"
}
```

I am a bit happy as it seems on a simple example that my optimization is faster:

```
sage: L.<z> = LazyLaurentSeriesRing(QQ)
sage: f = z^-1 + 2 + z + z^2 + 2*z^3
sage: g = z^-2 / (1 - z)

sage: %time (f(g))[300]
CPU times: user 25.6 ms, sys: 10 Âµs, total: 25.6 ms
Wall time: 25.2 ms
94862
sage: %time (f.polynomial()(g))[300]
CPU times: user 92.1 ms, sys: 0 ns, total: 92.1 ms
Wall time: 91.8 ms
94862

sage: %time (f(g))[3000]
CPU times: user 2.22 s, sys: 0 ns, total: 2.22 s
Wall time: 2.22 s
9048062
sage: %time (f.polynomial()(g))[3000]
CPU times: user 8.2 s, sys: 0 ns, total: 8.2 s
Wall time: 8.2 s
9048062
```

All come behold the power of the cache and rejoice. `:P`



---

archive/issue_comments_483928.json:
```json
{
    "body": "Here is the fix with doctests added.\n----\nNew commits:",
    "created_at": "2022-08-29T00:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483928",
    "user": "https://github.com/tscrim"
}
```

Here is the fix with doctests added.
----
New commits:



---

archive/issue_comments_483929.json:
```json
{
    "body": "Cool, and thank you for the explanation!  I missed the fact that composing a polynomial with an uninitialised series actually makes sense even when using the generic polynomial code.",
    "created_at": "2022-08-29T06:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483929",
    "user": "https://github.com/mantepse"
}
```

Cool, and thank you for the explanation!  I missed the fact that composing a polynomial with an uninitialised series actually makes sense even when using the generic polynomial code.



---

archive/issue_comments_483930.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-29T07:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483930",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483931.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-29T07:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483931",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483932.json:
```json
{
    "body": "There are still some tests which (trivially) fail.  I am going to work on them for the next 2 hours or so.",
    "created_at": "2022-08-29T07:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483932",
    "user": "https://github.com/mantepse"
}
```

There are still some tests which (trivially) fail.  I am going to work on them for the next 2 hours or so.



---

archive/issue_comments_483933.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-29T14:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483933",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483934.json:
```json
{
    "body": "Taylor series should be OK now.\n\nThere are still slight problems with plethysm.  Some of them might be best fixed in the implementation of ordinary symmetric functions:\n\n```\nsage: p = SymmetricFunctions(QQ).p()\nsage: p[2,2,1](3)\n...\nTypeError: only know how to compute plethysms between symmetric functions or tensors of symmetric functions\n```\n\nHowever, I am not completely sure who should handle plethysms of the form `f o g` where `f` is an ordinary symmetric function and `g` is a lazy symmetric function.  The situation is similar to the case of polynomials, but not the same.  Essentially, we need to be able to express `g` as a (possibly constant, possibly lazy) symmetric function in the power sum basis.\n\nOne possibility would be to handle this in `Stream_plethysm`.  However, this goes against the general philosophy that the \"exact\" case is handled in `lazy_series.py`.  On the other hand, implementing yet another version of plethysm in `LazySymmetricFunction.__call__` seems like a lot of code duplication to me.",
    "created_at": "2022-08-29T14:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483934",
    "user": "https://github.com/mantepse"
}
```

Taylor series should be OK now.

There are still slight problems with plethysm.  Some of them might be best fixed in the implementation of ordinary symmetric functions:

```
sage: p = SymmetricFunctions(QQ).p()
sage: p[2,2,1](3)
...
TypeError: only know how to compute plethysms between symmetric functions or tensors of symmetric functions
```

However, I am not completely sure who should handle plethysms of the form `f o g` where `f` is an ordinary symmetric function and `g` is a lazy symmetric function.  The situation is similar to the case of polynomials, but not the same.  Essentially, we need to be able to express `g` as a (possibly constant, possibly lazy) symmetric function in the power sum basis.

One possibility would be to handle this in `Stream_plethysm`.  However, this goes against the general philosophy that the "exact" case is handled in `lazy_series.py`.  On the other hand, implementing yet another version of plethysm in `LazySymmetricFunction.__call__` seems like a lot of code duplication to me.



---

archive/issue_comments_483935.json:
```json
{
    "body": "Replying to [comment:55 mantepse]:\n> Taylor series should be OK now.\n\nGreat!\n\n> There are still slight problems with plethysm.  Some of them might be best fixed in the implementation of ordinary symmetric functions:\n> {{{\n> sage: p = SymmetricFunctions(QQ).p()\n> sage: p[2,2,1](3)\n> ...\n> TypeError: only know how to compute plethysms between symmetric functions or tensors of symmetric functions\n> }}}\n\nYea, this one annoys me from time to time that it doesn't at least try to coerce the element into a symmetric functions. This is for a separate ticket, but +1 for trying the coercion (or at least handling elements from the base ring)\n\n> However, I am not completely sure who should handle plethysms of the form `f o g` where `f` is an ordinary symmetric function and `g` is a lazy symmetric function.  The situation is similar to the case of polynomials, but not the same.  Essentially, we need to be able to express `g` as a (possibly constant, possibly lazy) symmetric function in the power sum basis.\n\nThe symmetric function `f` definitely should. There is no mechanism within Python (or within the coercion framework) to automatically pass control over to `g`.\n\n> One possibility would be to handle this in `Stream_plethysm`.  However, this goes against the general philosophy that the \"exact\" case is handled in `lazy_series.py`.  On the other hand, implementing yet another version of plethysm in `LazySymmetricFunction.__call__` seems like a lot of code duplication to me.\n\nI don't know how `Stream_plethysm` could even get control of this without having `f` actually handle the object. At which point, there is an easy solution: convert `f` to a `LazySymmetricFunction` and run `__call__` on that. I will push a fix in just a minute.",
    "created_at": "2022-08-30T00:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483935",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:55 mantepse]:
> Taylor series should be OK now.

Great!

> There are still slight problems with plethysm.  Some of them might be best fixed in the implementation of ordinary symmetric functions:
> {{{
> sage: p = SymmetricFunctions(QQ).p()
> sage: p[2,2,1](3)
> ...
> TypeError: only know how to compute plethysms between symmetric functions or tensors of symmetric functions
> }}}

Yea, this one annoys me from time to time that it doesn't at least try to coerce the element into a symmetric functions. This is for a separate ticket, but +1 for trying the coercion (or at least handling elements from the base ring)

> However, I am not completely sure who should handle plethysms of the form `f o g` where `f` is an ordinary symmetric function and `g` is a lazy symmetric function.  The situation is similar to the case of polynomials, but not the same.  Essentially, we need to be able to express `g` as a (possibly constant, possibly lazy) symmetric function in the power sum basis.

The symmetric function `f` definitely should. There is no mechanism within Python (or within the coercion framework) to automatically pass control over to `g`.

> One possibility would be to handle this in `Stream_plethysm`.  However, this goes against the general philosophy that the "exact" case is handled in `lazy_series.py`.  On the other hand, implementing yet another version of plethysm in `LazySymmetricFunction.__call__` seems like a lot of code duplication to me.

I don't know how `Stream_plethysm` could even get control of this without having `f` actually handle the object. At which point, there is an easy solution: convert `f` to a `LazySymmetricFunction` and run `__call__` on that. I will push a fix in just a minute.



---

archive/issue_comments_483936.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-30T00:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483936",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483937.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-30T01:25:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483937",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483938.json:
```json
{
    "body": "Replying to [comment:56 tscrim]:\n> Replying to [comment:55 mantepse]:\n\n> > There are still slight problems with plethysm.  Some of them might be best fixed in the implementation of ordinary symmetric functions:\n> > {{{\n> > sage: p = SymmetricFunctions(QQ).p()\n> > sage: p[2,2,1](3)\n> > ...\n> > TypeError: only know how to compute plethysms between symmetric functions or tensors of symmetric functions\n> > }}}\n> \n> Yea, this one annoys me from time to time that it doesn't at least try to coerce the element into a symmetric functions. This is for a separate ticket, but +1 for trying the coercion (or at least handling elements from the base ring)\n\nI ended up fixing this here as it was basically part of the changes I needed to make for the lazy series. We will not be able to return an element in the original parent for \"constants\" (broadly interpreted) without doing some cumbersome (and well-definedness is another issue too).\n\nThe check for tensor products is a bit brittle, so I've tried to make it a bit more robust (say, if the commutative ring is also a tensor product).\n\nIn trying to find a doctest for this, I found out that tensor products of commutative algebras do not know they are commutative rings:\n\n```\nsage: X = algebras.Shuffle(QQ, 'ab')\nsage: Y = algebras.Shuffle(QQ, 'bc')\nsage: X in CommutativeRings()\nTrue\nsage: Y in CommutativeRings()\nTrue\nsage: T = tensor([X,Y])\nsage: T in CommutativeRings()\nFalse\n```\n\nThis is now #34453. While not a strict dependency for this ticket, it means I get to write the doctest I wanted.\n\n> > One possibility would be to handle this in `Stream_plethysm`.  However, this goes against the general philosophy that the \"exact\" case is handled in `lazy_series.py`.  On the other hand, implementing yet another version of plethysm in `LazySymmetricFunction.__call__` seems like a lot of code duplication to me.\n> \n> I don't know how `Stream_plethysm` could even get control of this without having `f` actually handle the object. At which point, there is an easy solution: convert `f` to a `LazySymmetricFunction` and run `__call__` on that. I will push a fix in just a minute.\n\nI have now done this.",
    "created_at": "2022-08-30T01:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483938",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:56 tscrim]:
> Replying to [comment:55 mantepse]:

> > There are still slight problems with plethysm.  Some of them might be best fixed in the implementation of ordinary symmetric functions:
> > {{{
> > sage: p = SymmetricFunctions(QQ).p()
> > sage: p[2,2,1](3)
> > ...
> > TypeError: only know how to compute plethysms between symmetric functions or tensors of symmetric functions
> > }}}
> 
> Yea, this one annoys me from time to time that it doesn't at least try to coerce the element into a symmetric functions. This is for a separate ticket, but +1 for trying the coercion (or at least handling elements from the base ring)

I ended up fixing this here as it was basically part of the changes I needed to make for the lazy series. We will not be able to return an element in the original parent for "constants" (broadly interpreted) without doing some cumbersome (and well-definedness is another issue too).

The check for tensor products is a bit brittle, so I've tried to make it a bit more robust (say, if the commutative ring is also a tensor product).

In trying to find a doctest for this, I found out that tensor products of commutative algebras do not know they are commutative rings:

```
sage: X = algebras.Shuffle(QQ, 'ab')
sage: Y = algebras.Shuffle(QQ, 'bc')
sage: X in CommutativeRings()
True
sage: Y in CommutativeRings()
True
sage: T = tensor([X,Y])
sage: T in CommutativeRings()
False
```

This is now #34453. While not a strict dependency for this ticket, it means I get to write the doctest I wanted.

> > One possibility would be to handle this in `Stream_plethysm`.  However, this goes against the general philosophy that the "exact" case is handled in `lazy_series.py`.  On the other hand, implementing yet another version of plethysm in `LazySymmetricFunction.__call__` seems like a lot of code duplication to me.
> 
> I don't know how `Stream_plethysm` could even get control of this without having `f` actually handle the object. At which point, there is an easy solution: convert `f` to a `LazySymmetricFunction` and run `__call__` on that. I will push a fix in just a minute.

I have now done this.



---

archive/issue_comments_483939.json:
```json
{
    "body": "So, the idea is now to make `Stream_plethysm` handle the plethysm of a symmetric function with finite support and lazy symmetric functions of valuation 0?\n\n(That's fine with me, I just want confirmation.)\n\n(sorry for being short, I just woke up :-)",
    "created_at": "2022-08-30T05:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483939",
    "user": "https://github.com/mantepse"
}
```

So, the idea is now to make `Stream_plethysm` handle the plethysm of a symmetric function with finite support and lazy symmetric functions of valuation 0?

(That's fine with me, I just want confirmation.)

(sorry for being short, I just woke up :-)



---

archive/issue_comments_483940.json:
```json
{
    "body": "Replying to [comment:60 mantepse]:\n> So, the idea is now to make `Stream_plethysm` handle the plethysm of a symmetric function with finite support and lazy symmetric functions of valuation 0?\n\nEssentially yes because it already must do so.\n\n> (sorry for being short, I just woke up :-)\n\nNo problem.",
    "created_at": "2022-08-30T05:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483940",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:60 mantepse]:
> So, the idea is now to make `Stream_plethysm` handle the plethysm of a symmetric function with finite support and lazy symmetric functions of valuation 0?

Essentially yes because it already must do so.

> (sorry for being short, I just woke up :-)

No problem.



---

archive/issue_comments_483941.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-30T08:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483941",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483942.json:
```json
{
    "body": "It seems that we are done for now!\n\nI am sure that code and especially tests and documentation could and should be polished, but maybe it would be good to move forward now.  At least concerning functionality, the code is a huge improvement over what we had before this ticket!\n\nPerhaps it would make sense to make more tests systematic, and also check which tests are now redundant.\n\nI am very grateful for all your help and expertise, Travis!",
    "created_at": "2022-08-30T08:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483942",
    "user": "https://github.com/mantepse"
}
```

It seems that we are done for now!

I am sure that code and especially tests and documentation could and should be polished, but maybe it would be good to move forward now.  At least concerning functionality, the code is a huge improvement over what we had before this ticket!

Perhaps it would make sense to make more tests systematic, and also check which tests are now redundant.

I am very grateful for all your help and expertise, Travis!



---

archive/issue_comments_483943.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-08-30T08:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483943",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_483944.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-30T09:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483944",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483945.json:
```json
{
    "body": "Thank you for the changes and all your hard work.\n\nSome comments about my changes:\n\n- I would avoid variable names of `prod` to not cause possible confusion with the function `prod` (it isn't currently imported, but it could be and even used here).\n- I am very worried about breaking the assumption of the `wt_int_vec_iter`. By not following it, the plethysm could break in a subtle way. I just reversed everything.\n\nIsn't the `:=` syntax great? I had been missing that so much.\n\nIf my changes are good, then I we can set a positive review and move on to the next thing. We can do more polishing of the documentation and tests later.",
    "created_at": "2022-08-30T09:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483945",
    "user": "https://github.com/tscrim"
}
```

Thank you for the changes and all your hard work.

Some comments about my changes:

- I would avoid variable names of `prod` to not cause possible confusion with the function `prod` (it isn't currently imported, but it could be and even used here).
- I am very worried about breaking the assumption of the `wt_int_vec_iter`. By not following it, the plethysm could break in a subtle way. I just reversed everything.

Isn't the `:=` syntax great? I had been missing that so much.

If my changes are good, then I we can set a positive review and move on to the next thing. We can do more polishing of the documentation and tests later.



---

archive/issue_comments_483946.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-30T10:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483946",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483947.json:
```json
{
    "body": "Perfect, thanks!",
    "created_at": "2022-08-30T10:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483947",
    "user": "https://github.com/mantepse"
}
```

Perfect, thanks!



---

archive/issue_comments_483948.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-30T10:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483948",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_483949.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2022-08-30T14:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483949",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_483950.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2022-08-30T14:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483950",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_483951.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-30T18:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483951",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_483952.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2022-08-31T20:22:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483952",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_483953.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2022-08-31T20:22:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483953",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_483954.json:
```json
{
    "body": "Back to positive review, these are only trivial modifications.  Please excuse the noise.",
    "created_at": "2022-08-31T20:23:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483954",
    "user": "https://github.com/mantepse"
}
```

Back to positive review, these are only trivial modifications.  Please excuse the noise.



---

archive/issue_comments_483955.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-31T20:23:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483955",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_483956.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-09-22T22:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483956",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_483957.json:
```json
{
    "body": "\n```\nsage -t --long --warn-long 48.0 --random-seed=123 src/sage/combinat/sf/sfa.py\n**********************************************************************\nFile \"src/sage/combinat/sf/sfa.py\", line 3139, in sage.combinat.sf.sfa.SymmetricFunctionAlgebra_generic_Element.plethysm\nFailed example:\n    s(2*T.one())\nExpected:\n    (2*B[word:]#B[word:])*s[]\nGot:\n    (2*B[]#B[])*s[]\n**********************************************************************\n1 item had failures:\n   1 of  48 in sage.combinat.sf.sfa.SymmetricFunctionAlgebra_generic_Element.plethysm\n    [1238 tests, 1 failure, 18.82 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 48.0 --random-seed=123 src/sage/combinat/sf/sfa.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2022-09-22T22:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483957",
    "user": "https://github.com/vbraun"
}
```


```
sage -t --long --warn-long 48.0 --random-seed=123 src/sage/combinat/sf/sfa.py
**********************************************************************
File "src/sage/combinat/sf/sfa.py", line 3139, in sage.combinat.sf.sfa.SymmetricFunctionAlgebra_generic_Element.plethysm
Failed example:
    s(2*T.one())
Expected:
    (2*B[word:]#B[word:])*s[]
Got:
    (2*B[]#B[])*s[]
**********************************************************************
1 item had failures:
   1 of  48 in sage.combinat.sf.sfa.SymmetricFunctionAlgebra_generic_Element.plethysm
    [1238 tests, 1 failure, 18.82 s]
----------------------------------------------------------------------
sage -t --long --warn-long 48.0 --random-seed=123 src/sage/combinat/sf/sfa.py  # 1 doctest failed
----------------------------------------------------------------------
```




---

archive/issue_comments_483958.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-22T22:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483958",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483959.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-09-22T22:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483959",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_483960.json:
```json
{
    "body": "Same trivial fix that ended up on the later ticket #34413.",
    "created_at": "2022-09-22T22:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483960",
    "user": "https://github.com/tscrim"
}
```

Same trivial fix that ended up on the later ticket #34413.



---

archive/issue_comments_483961.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2022-09-25T22:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483961",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_483962.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2022-09-25T22:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483962",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_483963.json:
```json
{
    "body": "Trivial merge, hence setting back to positive review.",
    "created_at": "2022-09-25T22:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483963",
    "user": "https://github.com/mantepse"
}
```

Trivial merge, hence setting back to positive review.



---

archive/issue_comments_483964.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-25T22:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483964",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_030726.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-09-28T23:04:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34146#event-30726"
}
```



---

archive/issue_comments_483965.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-09-28T23:04:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34146#issuecomment-483965",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
