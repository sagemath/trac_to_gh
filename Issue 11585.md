# Issue 11585: update M4RI to version 20110901 or later

Issue created by migration from Trac.

Original creator: malb

Original creation time: 2011-08-29 16:20:07

Assignee: tbd

CC:  leif alexanderdreyer

In #11574 it was noticed that M4RI does not provide sufficient information to allow third party software to choose the appropriate compiler flags to link against it. Version 20110901 of M4RI fixes this issue. The relevant commit to the M4RI tree is:

   https://bitbucket.org/malb/m4ri/changeset/63552206b9e0

*Install* http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20110901.spkg


---

Comment by malb created at 2011-08-29 16:25:34

Here's how the output looks like on bsd.math:


```c
#define __M4RI_CFLAGS                   " -mmmx -msse -msse2 -msse3   -I/Users/malb/sage-4.7.2.alpha2/local/include -g -fPIC -Wall -pedantic -O2"
```


I'm not sure we want the "-I/Users/..." part in there though. But we set CFLAGS in spkg-install so I'm not sure how to avoid it.


---

Comment by malb created at 2011-08-29 16:25:34

Changing status from new to needs_review.


---

Comment by leif created at 2011-08-29 23:43:02

Replying to [comment:1 malb]:
> Here's how the output looks like on bsd.math:
> 

```c
#define __M4RI_CFLAGS                   " -mmmx -msse -msse2 -msse3   -I/Users/malb/sage-4.7.2.alpha2/local/include -g -fPIC -Wall -pedantic -O2"
```

> 
> I'm not sure we want the "-I/Users/..." part in there though. But we set CFLAGS in spkg-install so I'm not sure how to avoid it.

This would introduce new potential hardcoding issues. (It shouldn't hurt if the directory later -- after moving Sage -- does no longer exist, but it could break the installation if it does, and the headers there are meanwhile incompatible.)

You could post-process the file in M4RI's `spkg-install`.

Do you also add `__M4RI_CC`? (Haven't looked at the spkg yet.)


---

Comment by leif created at 2011-08-29 23:53:15

Since you have `-I...` already in `CPPFLAGS`, not adding it to `CFLAGS` in `spkg-install` should also work.


---

Comment by leif created at 2011-08-30 00:18:00

Replying to [comment:3 leif]:
> Since you have `-I...` already in `CPPFLAGS`, not adding it to `CFLAGS` in `spkg-install` should also work.

Oh, I see M4RI doesn't honor `CPPFLAGS`, but it also doesn't use any of Sage's headers AFAIK, so you could simply remove `-I...` from `CFLAGS` (unless `configure` does weird things).


---

Comment by malb created at 2011-08-30 11:46:21

I've revised spkg-install accordingly and replaced the SPKG. Now we get:

```c
#define __M4RI_CC                       "gcc -std=gnu99"
#define __M4RI_CFLAGS                   "    -g -fPIC -Wall -pedantic -O2"
```



---

Comment by leif created at 2011-08-31 22:19:25

Added #11574 as a dependency because of [attachment:ticket:11574:m4ri_20110601.patch] (API change, corrected extension module dependencies in `module_list.py`).

(Martin, correct me if I'm wrong...)


---

Comment by malb created at 2011-08-31 23:56:04

Uh, yep, that's correct. Thanks!


---

Comment by leif created at 2011-09-23 05:59:35

Why does this still need review?

And isn't "exporting" the compiler flags meanwhile fully fixed by #11574? (Except for perhaps a `.pc` file.)

The description should get updated...




Or is this spkg / ticket meanwhile obsolete, superseded by the one from #11574?

I actually first thought I had merged the wrong spkg.


---

Comment by malb created at 2011-09-23 09:49:28

In #11574 we only work around this short coming of M4RI, in this ticket it's fixed. It's actually *needs work* because the Sage patch should be updated to use the exported flags (instead of setting its own).


---

Comment by malb created at 2011-09-23 09:49:28

Changing status from needs_review to needs_work.


---

Attachment


---

Comment by malb created at 2011-10-04 10:53:05

Changing status from needs_work to needs_review.


---

Comment by malb created at 2011-10-04 10:53:05

The updated SPKG & patch work fine for me on sage.math, bsd.math and cicero (where we had issues before).


---

Comment by AlexanderDreyer created at 2011-10-05 08:06:16

I installed and tested spkg and patch successfully on a SLES 11 amd64 and Mac OS X 10.5 ppc (32bit). Also the patch and the spkg look sane, so positive review.


---

Comment by AlexanderDreyer created at 2011-10-05 08:06:16

Changing status from needs_review to positive_review.


---

Comment by malb created at 2011-10-05 09:16:13

yay!


---

Comment by jdemeyer created at 2011-10-05 17:34:43

Rebased on top of #10903


---

Attachment


---

Comment by jdemeyer created at 2011-10-06 11:40:54

Resolution: fixed
