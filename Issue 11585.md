# Issue 11585: update M4RI to version 20110901 or later

archive/issues_011585.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  leif alexanderdreyer\n\nIn #11574 it was noticed that M4RI does not provide sufficient information to allow third party software to choose the appropriate compiler flags to link against it. Version 20110901 of M4RI fixes this issue. The relevant commit to the M4RI tree is:\n\n   https://bitbucket.org/malb/m4ri/changeset/63552206b9e0\n\n**Install** http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20110901.spkg\n\nIssue created by migration from https://trac.sagemath.org/ticket/11757\n\n",
    "created_at": "2011-08-29T16:20:07Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "update M4RI to version 20110901 or later",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11585",
    "user": "malb"
}
```
Assignee: tbd

CC:  leif alexanderdreyer

In #11574 it was noticed that M4RI does not provide sufficient information to allow third party software to choose the appropriate compiler flags to link against it. Version 20110901 of M4RI fixes this issue. The relevant commit to the M4RI tree is:

   https://bitbucket.org/malb/m4ri/changeset/63552206b9e0

**Install** http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20110901.spkg

Issue created by migration from https://trac.sagemath.org/ticket/11757





---

archive/issue_comments_130479.json:
```json
{
    "body": "Here's how the output looks like on bsd.math:\n\n\n```c\n#define __M4RI_CFLAGS                   \" -mmmx -msse -msse2 -msse3   -I/Users/malb/sage-4.7.2.alpha2/local/include -g -fPIC -Wall -pedantic -O2\"\n```\n\n\nI'm not sure we want the \"-I/Users/...\" part in there though. But we set CFLAGS in spkg-install so I'm not sure how to avoid it.",
    "created_at": "2011-08-29T16:25:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130479",
    "user": "malb"
}
```

Here's how the output looks like on bsd.math:


```c
#define __M4RI_CFLAGS                   " -mmmx -msse -msse2 -msse3   -I/Users/malb/sage-4.7.2.alpha2/local/include -g -fPIC -Wall -pedantic -O2"
```


I'm not sure we want the "-I/Users/..." part in there though. But we set CFLAGS in spkg-install so I'm not sure how to avoid it.



---

archive/issue_comments_130480.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-08-29T16:25:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130480",
    "user": "malb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_130481.json:
```json
{
    "body": "Replying to [comment:1 malb]:\n> Here's how the output looks like on bsd.math:\n> \n\n```c\n#define __M4RI_CFLAGS                   \" -mmmx -msse -msse2 -msse3   -I/Users/malb/sage-4.7.2.alpha2/local/include -g -fPIC -Wall -pedantic -O2\"\n```\n\n> \n> I'm not sure we want the \"-I/Users/...\" part in there though. But we set CFLAGS in spkg-install so I'm not sure how to avoid it.\n\nThis would introduce new potential hardcoding issues. (It shouldn't hurt if the directory later -- after moving Sage -- does no longer exist, but it could break the installation if it does, and the headers there are meanwhile incompatible.)\n\nYou could post-process the file in M4RI's `spkg-install`.\n\nDo you also add `__M4RI_CC`? (Haven't looked at the spkg yet.)",
    "created_at": "2011-08-29T23:43:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130481",
    "user": "leif"
}
```

Replying to [comment:1 malb]:
> Here's how the output looks like on bsd.math:
> 

```c
#define __M4RI_CFLAGS                   " -mmmx -msse -msse2 -msse3   -I/Users/malb/sage-4.7.2.alpha2/local/include -g -fPIC -Wall -pedantic -O2"
```

> 
> I'm not sure we want the "-I/Users/..." part in there though. But we set CFLAGS in spkg-install so I'm not sure how to avoid it.

This would introduce new potential hardcoding issues. (It shouldn't hurt if the directory later -- after moving Sage -- does no longer exist, but it could break the installation if it does, and the headers there are meanwhile incompatible.)

You could post-process the file in M4RI's `spkg-install`.

Do you also add `__M4RI_CC`? (Haven't looked at the spkg yet.)



---

archive/issue_comments_130482.json:
```json
{
    "body": "Since you have `-I...` already in `CPPFLAGS`, not adding it to `CFLAGS` in `spkg-install` should also work.",
    "created_at": "2011-08-29T23:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130482",
    "user": "leif"
}
```

Since you have `-I...` already in `CPPFLAGS`, not adding it to `CFLAGS` in `spkg-install` should also work.



---

archive/issue_comments_130483.json:
```json
{
    "body": "Replying to [comment:3 leif]:\n> Since you have `-I...` already in `CPPFLAGS`, not adding it to `CFLAGS` in `spkg-install` should also work.\n\nOh, I see M4RI doesn't honor `CPPFLAGS`, but it also doesn't use any of Sage's headers AFAIK, so you could simply remove `-I...` from `CFLAGS` (unless `configure` does weird things).",
    "created_at": "2011-08-30T00:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130483",
    "user": "leif"
}
```

Replying to [comment:3 leif]:
> Since you have `-I...` already in `CPPFLAGS`, not adding it to `CFLAGS` in `spkg-install` should also work.

Oh, I see M4RI doesn't honor `CPPFLAGS`, but it also doesn't use any of Sage's headers AFAIK, so you could simply remove `-I...` from `CFLAGS` (unless `configure` does weird things).



---

archive/issue_comments_130484.json:
```json
{
    "body": "I've revised spkg-install accordingly and replaced the SPKG. Now we get:\n\n```c\n#define __M4RI_CC                       \"gcc -std=gnu99\"\n#define __M4RI_CFLAGS                   \"    -g -fPIC -Wall -pedantic -O2\"\n```\n",
    "created_at": "2011-08-30T11:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130484",
    "user": "malb"
}
```

I've revised spkg-install accordingly and replaced the SPKG. Now we get:

```c
#define __M4RI_CC                       "gcc -std=gnu99"
#define __M4RI_CFLAGS                   "    -g -fPIC -Wall -pedantic -O2"
```




---

archive/issue_comments_130485.json:
```json
{
    "body": "Added #11574 as a dependency because of [attachment:ticket:11574:m4ri_20110601.patch] (API change, corrected extension module dependencies in `module_list.py`).\n\n(Martin, correct me if I'm wrong...)",
    "created_at": "2011-08-31T22:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130485",
    "user": "leif"
}
```

Added #11574 as a dependency because of [attachment:ticket:11574:m4ri_20110601.patch] (API change, corrected extension module dependencies in `module_list.py`).

(Martin, correct me if I'm wrong...)



---

archive/issue_comments_130486.json:
```json
{
    "body": "Uh, yep, that's correct. Thanks!",
    "created_at": "2011-08-31T23:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130486",
    "user": "malb"
}
```

Uh, yep, that's correct. Thanks!



---

archive/issue_comments_130487.json:
```json
{
    "body": "Why does this still need review?\n\nAnd isn't \"exporting\" the compiler flags meanwhile fully fixed by #11574? (Except for perhaps a `.pc` file.)\n\nThe description should get updated...\n\n\n\n\nOr is this spkg / ticket meanwhile obsolete, superseded by the one from #11574?\n\nI actually first thought I had merged the wrong spkg.",
    "created_at": "2011-09-23T05:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130487",
    "user": "leif"
}
```

Why does this still need review?

And isn't "exporting" the compiler flags meanwhile fully fixed by #11574? (Except for perhaps a `.pc` file.)

The description should get updated...




Or is this spkg / ticket meanwhile obsolete, superseded by the one from #11574?

I actually first thought I had merged the wrong spkg.



---

archive/issue_comments_130488.json:
```json
{
    "body": "In #11574 we only work around this short coming of M4RI, in this ticket it's fixed. It's actually **needs work** because the Sage patch should be updated to use the exported flags (instead of setting its own).",
    "created_at": "2011-09-23T09:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130488",
    "user": "malb"
}
```

In #11574 we only work around this short coming of M4RI, in this ticket it's fixed. It's actually **needs work** because the Sage patch should be updated to use the exported flags (instead of setting its own).



---

archive/issue_comments_130489.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-09-23T09:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130489",
    "user": "malb"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_130490.json:
```json
{
    "body": "Attachment [trac_11757_m4ri_sse2.patch](tarball://root/attachments/some-uuid/ticket11757/trac_11757_m4ri_sse2.patch) by malb created at 2011-10-03 19:00:44",
    "created_at": "2011-10-03T19:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130490",
    "user": "malb"
}
```

Attachment [trac_11757_m4ri_sse2.patch](tarball://root/attachments/some-uuid/ticket11757/trac_11757_m4ri_sse2.patch) by malb created at 2011-10-03 19:00:44



---

archive/issue_comments_130491.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-10-04T10:53:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130491",
    "user": "malb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_130492.json:
```json
{
    "body": "The updated SPKG & patch work fine for me on sage.math, bsd.math and cicero (where we had issues before).",
    "created_at": "2011-10-04T10:53:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130492",
    "user": "malb"
}
```

The updated SPKG & patch work fine for me on sage.math, bsd.math and cicero (where we had issues before).



---

archive/issue_comments_130493.json:
```json
{
    "body": "I installed and tested spkg and patch successfully on a SLES 11 amd64 and Mac OS X 10.5 ppc (32bit). Also the patch and the spkg look sane, so positive review.",
    "created_at": "2011-10-05T08:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130493",
    "user": "AlexanderDreyer"
}
```

I installed and tested spkg and patch successfully on a SLES 11 amd64 and Mac OS X 10.5 ppc (32bit). Also the patch and the spkg look sane, so positive review.



---

archive/issue_comments_130494.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-10-05T08:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130494",
    "user": "AlexanderDreyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_130495.json:
```json
{
    "body": "yay!",
    "created_at": "2011-10-05T09:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130495",
    "user": "malb"
}
```

yay!



---

archive/issue_comments_130496.json:
```json
{
    "body": "Rebased on top of #10903",
    "created_at": "2011-10-05T17:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130496",
    "user": "jdemeyer"
}
```

Rebased on top of #10903



---

archive/issue_comments_130497.json:
```json
{
    "body": "Attachment [trac_11757_m4ri_sse2_rebased10903.patch](tarball://root/attachments/some-uuid/ticket11757/trac_11757_m4ri_sse2_rebased10903.patch) by jdemeyer created at 2011-10-05 17:39:49",
    "created_at": "2011-10-05T17:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130497",
    "user": "jdemeyer"
}
```

Attachment [trac_11757_m4ri_sse2_rebased10903.patch](tarball://root/attachments/some-uuid/ticket11757/trac_11757_m4ri_sse2_rebased10903.patch) by jdemeyer created at 2011-10-05 17:39:49



---

archive/issue_comments_130498.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-10-06T11:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-130498",
    "user": "jdemeyer"
}
```

Resolution: fixed
