# Issue 15219: fix bug in has_right/left_descents in Weyl group code

archive/issues_015219.json:
```json
{
    "body": "CC:  @sdenton4 @anneschilling @nthiery sage-combinat\n\nKeywords: coxeter, sd65\n\nThe `has_right_descents` method in `WeylGroup` element methods calls `has_left_descents` and vice versa.  This causes an error in the following example.\n\n```\nsage: W = WeylGroup(['A',4])\nsage: w = W.from_reduced_word([3,4,2])\nsage: w.has_right_descent(3)\nTraceback (click to the left of this block for traceback)\n...\nRuntimeError: maximum recursion depth exceeded\n```\n\nThe doc tests for this method make calls to `CoxeterGroup` code to test it and so all tests pass.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15456\n\n",
    "closed_at": "2015-07-17T20:07:16Z",
    "created_at": "2013-11-26T22:10:38Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "fix bug in has_right/left_descents in Weyl group code",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15219",
    "user": "https://github.com/zabrocki"
}
```
CC:  @sdenton4 @anneschilling @nthiery sage-combinat

Keywords: coxeter, sd65

The `has_right_descents` method in `WeylGroup` element methods calls `has_left_descents` and vice versa.  This causes an error in the following example.

```
sage: W = WeylGroup(['A',4])
sage: w = W.from_reduced_word([3,4,2])
sage: w.has_right_descent(3)
Traceback (click to the left of this block for traceback)
...
RuntimeError: maximum recursion depth exceeded
```

The doc tests for this method make calls to `CoxeterGroup` code to test it and so all tests pass.

Issue created by migration from https://trac.sagemath.org/ticket/15456





---

archive/issue_comments_195280.json:
```json
{
    "body": "Hi Mike!\n\nThis is not a bug but a feature :-)\n\nWhen implementing a Coxeter group one can choose to either implement has_right_descent or has_left_descent (or both), and the Coxeter group category provides a default implementation for the other, if needed.\n\nGranted, it would be nice if there was a nicer error message mentionning that at least one of has_left_descent or has_right_descent should be implemented. However, at this point, we have not generic infrastructure for this kind of situation, and it would be a bit tedious to do it by hand (but ideas on how to handle this are welcome!).\n\nCheers,",
    "created_at": "2013-11-26T22:20:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195280",
    "user": "https://github.com/nthiery"
}
```

Hi Mike!

This is not a bug but a feature :-)

When implementing a Coxeter group one can choose to either implement has_right_descent or has_left_descent (or both), and the Coxeter group category provides a default implementation for the other, if needed.

Granted, it would be nice if there was a nicer error message mentionning that at least one of has_left_descent or has_right_descent should be implemented. However, at this point, we have not generic infrastructure for this kind of situation, and it would be a bit tedious to do it by hand (but ideas on how to handle this are welcome!).

Cheers,



---

archive/issue_comments_195281.json:
```json
{
    "body": "Hi Nicolas,\n\nThis can't be a feature.  In `WeylGroup` this is a bug.  In `CoxeterGroup` it is correct.\n\nIn `WeylGroups` the method `has_right_descent` and `has_left_descent` don't do anything except call each other.",
    "created_at": "2013-11-26T22:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195281",
    "user": "https://github.com/zabrocki"
}
```

Hi Nicolas,

This can't be a feature.  In `WeylGroup` this is a bug.  In `CoxeterGroup` it is correct.

In `WeylGroups` the method `has_right_descent` and `has_left_descent` don't do anything except call each other.



---

archive/issue_comments_195282.json:
```json
{
    "body": "BTW, in `WeylGroup` the method `has_descent` doesn't call either `has_right_descent` or `has_left_descent` and decides if there is a right/left descent by another method.",
    "created_at": "2013-11-26T22:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195282",
    "user": "https://github.com/zabrocki"
}
```

BTW, in `WeylGroup` the method `has_descent` doesn't call either `has_right_descent` or `has_left_descent` and decides if there is a right/left descent by another method.



---

archive/issue_comments_195283.json:
```json
{
    "body": "Right. The proper specification is:\n\n- at least one of has_descent / has_right_descent / has_left_descent should be implemented\n- in generic code, always use has_descent, not has_*_descent.\n\nThis definitely should be put in the doc if not yet there.",
    "created_at": "2013-11-26T22:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195283",
    "user": "https://github.com/nthiery"
}
```

Right. The proper specification is:

- at least one of has_descent / has_right_descent / has_left_descent should be implemented
- in generic code, always use has_descent, not has_*_descent.

This definitely should be put in the doc if not yet there.



---

archive/issue_comments_195284.json:
```json
{
    "body": "I take the part about it being correct in `CoxeterGroup` back.  It seems to only be correct for the `CoxeterGroups().example()`.\n\nI assume that you are right in that \"Coxeter group category provides a default implementation for the other\" but no one has implemented `has_right_descent` or `has_left_descent` for any of the finite or affine `WeylGroups` or `CoxeterGroups` (to an end user of these groups, this is a bug because it should just raise a `Not Implemented` error).\n\nIs the correct solution then that \n\n(1) someone needs to implement them for each of the types \n\n(2) that the default implementation should be `has_left_descent` should call `has_descent(self, side=\"left\")`\n\n(3) the default implementation of `has_right_descent` should raise a `Not Implemented` error\n\n(4) something else?",
    "created_at": "2013-11-26T22:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195284",
    "user": "https://github.com/zabrocki"
}
```

I take the part about it being correct in `CoxeterGroup` back.  It seems to only be correct for the `CoxeterGroups().example()`.

I assume that you are right in that "Coxeter group category provides a default implementation for the other" but no one has implemented `has_right_descent` or `has_left_descent` for any of the finite or affine `WeylGroups` or `CoxeterGroups` (to an end user of these groups, this is a bug because it should just raise a `Not Implemented` error).

Is the correct solution then that 

(1) someone needs to implement them for each of the types 

(2) that the default implementation should be `has_left_descent` should call `has_descent(self, side="left")`

(3) the default implementation of `has_right_descent` should raise a `Not Implemented` error

(4) something else?



---

archive/issue_events_045050.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15219#event-45050"
}
```



---

archive/issue_comments_195285.json:
```json
{
    "body": "Here is a possible solution. Please review.\n\n---\nNew commits:",
    "created_at": "2014-03-05T16:25:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195285",
    "user": "https://github.com/fchapoton"
}
```

Here is a possible solution. Please review.

---
New commits:



---

archive/issue_comments_195286.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-03-05T16:25:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195286",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_195287.json:
```json
{
    "body": "I think what we should do is have `has_left_descent` call `has_descent(self, side=\"right\")` and `has_right_descent` call `has_descent(self, side=\"left\")`.",
    "created_at": "2014-03-05T16:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195287",
    "user": "https://github.com/tscrim"
}
```

I think what we should do is have `has_left_descent` call `has_descent(self, side="right")` and `has_right_descent` call `has_descent(self, side="left")`.



---

archive/issue_comments_195288.json:
```json
{
    "body": "8)\n\nIndeed ? well, please do that if you think this is the thing to do.",
    "created_at": "2014-03-05T16:39:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195288",
    "user": "https://github.com/fchapoton"
}
```

8)

Indeed ? well, please do that if you think this is the thing to do.



---

archive/issue_comments_195289.json:
```json
{
    "body": "tscrim: That's what WAS happening, but if you instantiate an abstract Weyl Group or Coxeter Group it leads to an infinite loop, which is a bug.  What we need is a NotImplemented error if neither side is implemented, and the appropriate call to the implemented 'side' if one side or the other is concretely implemented but not the other.\n\nI see two possible ways forward:\n1) The default Coxeter/Weyl Group 'has_x_descent' methods just give a NotImplemented error, pushing it to the person creating a concrete realization to actually implement them correctly and not give an infinite loop, or\n2) Introduce some kind of '_is_implemented' flags for checking left and right descent, which are false by default, and set to true if there's a concrete implementation on one side that the other can use.  Then if it's true, we call the other side, and otherwise raise a NotImplemented error.\n\nOption 2 seems doable but introduces an Obscure Thing for the implementers of Coxeter groups to keep track of.  As such, I would advocate for Option 1.",
    "created_at": "2014-03-05T16:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195289",
    "user": "https://github.com/sdenton4"
}
```

tscrim: That's what WAS happening, but if you instantiate an abstract Weyl Group or Coxeter Group it leads to an infinite loop, which is a bug.  What we need is a NotImplemented error if neither side is implemented, and the appropriate call to the implemented 'side' if one side or the other is concretely implemented but not the other.

I see two possible ways forward:
1) The default Coxeter/Weyl Group 'has_x_descent' methods just give a NotImplemented error, pushing it to the person creating a concrete realization to actually implement them correctly and not give an infinite loop, or
2) Introduce some kind of '_is_implemented' flags for checking left and right descent, which are false by default, and set to true if there's a concrete implementation on one side that the other can use.  Then if it's true, we call the other side, and otherwise raise a NotImplemented error.

Option 2 seems doable but introduces an Obscure Thing for the implementers of Coxeter groups to keep track of.  As such, I would advocate for Option 1.



---

archive/issue_comments_195290.json:
```json
{
    "body": "It's also worth noting that sometimes one 'side' or the other is simply faster for computing descents.  This is clearly true for simple permutations: one can check in constant time if there's a right descent, but it takes O(n) to check for a left descent.  So then it would be bad news bears to have a default implementation of the right descent that calls the left decent.\n\nBut in other cases, it's maybe the left descent that's faster to compute, so you wouldn't want the reverse situation, either...  \n\nSo I think I would advocate against breaking symmetry at the Category level, and just raise NotImplemented errors for both sides.",
    "created_at": "2014-03-05T16:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195290",
    "user": "https://github.com/sdenton4"
}
```

It's also worth noting that sometimes one 'side' or the other is simply faster for computing descents.  This is clearly true for simple permutations: one can check in constant time if there's a right descent, but it takes O(n) to check for a left descent.  So then it would be bad news bears to have a default implementation of the right descent that calls the left decent.

But in other cases, it's maybe the left descent that's faster to compute, so you wouldn't want the reverse situation, either...  

So I think I would advocate against breaking symmetry at the Category level, and just raise NotImplemented errors for both sides.



---

archive/issue_comments_195291.json:
```json
{
    "body": "I do not understand why my solution is not good enough. From my point of view, the function `has_descent` in `weyl_group.py` should rather be named `has_right_descent`, because it is necessary to have at least one of the two (left or right) descent methods to avoid the infinite loop. I think that `has_descent` should only be defined for abstract Coxeter groups.",
    "created_at": "2014-03-05T17:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195291",
    "user": "https://github.com/fchapoton"
}
```

I do not understand why my solution is not good enough. From my point of view, the function `has_descent` in `weyl_group.py` should rather be named `has_right_descent`, because it is necessary to have at least one of the two (left or right) descent methods to avoid the infinite loop. I think that `has_descent` should only be defined for abstract Coxeter groups.



---

archive/issue_comments_195292.json:
```json
{
    "body": "Hey Tom,\n\nIf we made both left/right ``@`abstract_method`'s, then we would have to implement all methods. If we made them optional, I feel that we'd get bug reports about these not being implemented. The problem is that `has_descent()` wasn't being brought into the loop, so if that was the only thing implemented, then one couldn't use `has_left_descent()` as expects. Thus [comment:4 the spec]:\n\n>* at least one of has_descent / has_right_descent / has_left_descent should be implemented\n\n\nwould be satisfied in my proposal.\n\nAlthough I think we could do a modified version of your proposal 1) by implementing some kind of modification to ``@`abstract_method`. Something like\n\n```\n@abstract_method(circular=['foo', 'bar'])\n```\nwhere if `foo` and `bar` were also called, then error out.",
    "created_at": "2014-03-05T17:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195292",
    "user": "https://github.com/tscrim"
}
```

Hey Tom,

If we made both left/right ``@`abstract_method`'s, then we would have to implement all methods. If we made them optional, I feel that we'd get bug reports about these not being implemented. The problem is that `has_descent()` wasn't being brought into the loop, so if that was the only thing implemented, then one couldn't use `has_left_descent()` as expects. Thus [comment:4 the spec]:

>* at least one of has_descent / has_right_descent / has_left_descent should be implemented


would be satisfied in my proposal.

Although I think we could do a modified version of your proposal 1) by implementing some kind of modification to ``@`abstract_method`. Something like

```
@abstract_method(circular=['foo', 'bar'])
```
where if `foo` and `bar` were also called, then error out.



---

archive/issue_comments_195293.json:
```json
{
    "body": "Replying to [comment:12 chapoton]:\n> I do not understand why my solution is not good enough. From my point of view, the function `has_descent` in `weyl_group.py` should rather be named `has_right_descent`, because it is necessary to have at least one of the two (left or right) descent methods to avoid the infinite loop. I think that `has_descent` should only be defined for abstract Coxeter groups.\n\n\nThe `has_descent()` in `weyl_group.py` works for both sides, and by simply doing an alias, you're exposing invalid (at least 'should not be used') arguments in `has_right_descent()`. In essence what you're doing is saying `has_right_descent()` should call `has_descent()` with the appropriate arguments. I'm saying let's do this in a generic fashion to follow the spec (I think comment:4 point 1 is in the doc already, but I haven't checked).",
    "created_at": "2014-03-05T17:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195293",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:12 chapoton]:
> I do not understand why my solution is not good enough. From my point of view, the function `has_descent` in `weyl_group.py` should rather be named `has_right_descent`, because it is necessary to have at least one of the two (left or right) descent methods to avoid the infinite loop. I think that `has_descent` should only be defined for abstract Coxeter groups.


The `has_descent()` in `weyl_group.py` works for both sides, and by simply doing an alias, you're exposing invalid (at least 'should not be used') arguments in `has_right_descent()`. In essence what you're doing is saying `has_right_descent()` should call `has_descent()` with the appropriate arguments. I'm saying let's do this in a generic fashion to follow the spec (I think comment:4 point 1 is in the doc already, but I haven't checked).



---

archive/issue_comments_195294.json:
```json
{
    "body": "I couldn't find an indication that the documentation specifies that at least one of has_descent / has_right_descent / has_left_descent should be implemented.\n\nInstead it seems to be that the default implementation of `has_descent` calls `has_left`or`right_descent`\n\nMaybe we should throw checks in `_test_has_descent` to ensure that all of the functions work.",
    "created_at": "2014-03-05T17:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195294",
    "user": "https://github.com/zabrocki"
}
```

I couldn't find an indication that the documentation specifies that at least one of has_descent / has_right_descent / has_left_descent should be implemented.

Instead it seems to be that the default implementation of `has_descent` calls `has_left`or`right_descent`

Maybe we should throw checks in `_test_has_descent` to ensure that all of the functions work.



---

archive/issue_comments_195295.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-05T20:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195295",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_195296.json:
```json
{
    "body": "Here is new (better) proposal:\n\nThe main idea is \"please never override has_descent\" and \"please implement either has_left_descent or has_right_descent\" in every instance (if only as a place holder raising `NotImplementedError`).\n\nIn `categories/coxeter_group`, there is only the mechanism:\n\n* has_descent calls either has_left_descent or has right_descent\n* they call each other\n\nIn instances of Coxeter group, one implements either has_left_descent or has_right_descent or both. Even in a minimalistic way, raising a `NotImplementedError`.\n\nWhat do you think ?",
    "created_at": "2014-03-05T20:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195296",
    "user": "https://github.com/fchapoton"
}
```

Here is new (better) proposal:

The main idea is "please never override has_descent" and "please implement either has_left_descent or has_right_descent" in every instance (if only as a place holder raising `NotImplementedError`).

In `categories/coxeter_group`, there is only the mechanism:

* has_descent calls either has_left_descent or has right_descent
* they call each other

In instances of Coxeter group, one implements either has_left_descent or has_right_descent or both. Even in a minimalistic way, raising a `NotImplementedError`.

What do you think ?



---

archive/issue_comments_195297.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-05T20:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195297",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_195298.json:
```json
{
    "body": "I think this is a good solution and probably what was intended to happen when the `CoxeterGroup` code was originally written.  Do others agree?",
    "created_at": "2014-03-06T12:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195298",
    "user": "https://github.com/zabrocki"
}
```

I think this is a good solution and probably what was intended to happen when the `CoxeterGroup` code was originally written.  Do others agree?



---

archive/issue_comments_195299.json:
```json
{
    "body": "I don't like having the warning saying \"don't override this\", especially since I don't see  a good reason for doing this (and there's no \"final\" semantic in python). I am in favor of saying we must implement either `has_left_descent()` or `has_right_descent()`. Also possibly implementing has_left/right_descent()` for `weyl_group.py` to call `has_descent()`.\n\nAnyways, I've put my working version on trac at `u/tscrim/15456`. I also gave default implementations of `has_left/right_descent()` to `weyl_group.py` for speed. Although now that I've done the implementation, I'm less convinced of my suggestion. Perhaps what would be best is some category magic. We test upon creation of a Coxeter group to see if any of the methods have been implemented. Thus we do the following:\n\n- If `has_descent()` has been implemented, give default `has_*_descent()` call `has_descent()` with the appropriate args for those not implemented.\n- If none were implemented, error out on construction.\n- Otherwise set it up as we have it now.\n\nMaybe this is heavy-handed?\n\nNevertheless, here are some timings. I'm using the example from the ticket description. Baseline:\n\n```\nsage: %timeit w.has_descent(3, side=\"left\")\n1000 loops, best of 3: 860 us per loop\nsage: %timeit w.has_descent(3, side=\"left\")\n1000 loops, best of 3: 820 us per loop\nsage: %timeit w.has_descent(3, side=\"right\")\n1000 loops, best of 3: 200 us per loop\nsage: %timeit w.has_descent(3, side=\"right\")\n1000 loops, best of 3: 209 us per loop\n```\nWith Frederic's branch:\n\n```\nsage: %timeit w.has_descent(3, side=\"left\")\n1000 loops, best of 3: 987 us per loop\nsage: %timeit w.has_left_descent(3)\n1000 loops, best of 3: 929 us per loop\nsage: %timeit w.has_descent(3, side=\"right\")\n1000 loops, best of 3: 204 us per loop\nsage: %timeit w.has_right_descent(3)\n1000 loops, best of 3: 215 us per loop\n```\nWith my branch:\n\n```\nsage: %timeit w.has_descent(3, side=\"left\")\n1000 loops, best of 3: 867 us per loop\nsage: %timeit w.has_left_descent(3)\n1000 loops, best of 3: 902 us per loop\nsage: %timeit w.has_descent(3, side=\"right\")\n1000 loops, best of 3: 200 us per loop\nsage: %timeit w.has_right_descent(3)\n1000 loops, best of 3: 191 us per loop\n```",
    "created_at": "2014-03-06T18:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195299",
    "user": "https://github.com/tscrim"
}
```

I don't like having the warning saying "don't override this", especially since I don't see  a good reason for doing this (and there's no "final" semantic in python). I am in favor of saying we must implement either `has_left_descent()` or `has_right_descent()`. Also possibly implementing has_left/right_descent()` for `weyl_group.py` to call `has_descent()`.

Anyways, I've put my working version on trac at `u/tscrim/15456`. I also gave default implementations of `has_left/right_descent()` to `weyl_group.py` for speed. Although now that I've done the implementation, I'm less convinced of my suggestion. Perhaps what would be best is some category magic. We test upon creation of a Coxeter group to see if any of the methods have been implemented. Thus we do the following:

- If `has_descent()` has been implemented, give default `has_*_descent()` call `has_descent()` with the appropriate args for those not implemented.
- If none were implemented, error out on construction.
- Otherwise set it up as we have it now.

Maybe this is heavy-handed?

Nevertheless, here are some timings. I'm using the example from the ticket description. Baseline:

```
sage: %timeit w.has_descent(3, side="left")
1000 loops, best of 3: 860 us per loop
sage: %timeit w.has_descent(3, side="left")
1000 loops, best of 3: 820 us per loop
sage: %timeit w.has_descent(3, side="right")
1000 loops, best of 3: 200 us per loop
sage: %timeit w.has_descent(3, side="right")
1000 loops, best of 3: 209 us per loop
```
With Frederic's branch:

```
sage: %timeit w.has_descent(3, side="left")
1000 loops, best of 3: 987 us per loop
sage: %timeit w.has_left_descent(3)
1000 loops, best of 3: 929 us per loop
sage: %timeit w.has_descent(3, side="right")
1000 loops, best of 3: 204 us per loop
sage: %timeit w.has_right_descent(3)
1000 loops, best of 3: 215 us per loop
```
With my branch:

```
sage: %timeit w.has_descent(3, side="left")
1000 loops, best of 3: 867 us per loop
sage: %timeit w.has_left_descent(3)
1000 loops, best of 3: 902 us per loop
sage: %timeit w.has_descent(3, side="right")
1000 loops, best of 3: 200 us per loop
sage: %timeit w.has_right_descent(3)
1000 loops, best of 3: 191 us per loop
```



---

archive/issue_comments_195300.json:
```json
{
    "body": "So, what shall we do here ?\n\nIf I understand your proposal, when no `has_something` is implemented in an instance of Coxeter group, one has two different possibilities of infinite loop instead of one.\n\nSupose now that I only implement `has_left` and that I call `has_right`. This will result in an infinite loop in your proposal, no ?",
    "created_at": "2014-03-07T21:09:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195300",
    "user": "https://github.com/fchapoton"
}
```

So, what shall we do here ?

If I understand your proposal, when no `has_something` is implemented in an instance of Coxeter group, one has two different possibilities of infinite loop instead of one.

Supose now that I only implement `has_left` and that I call `has_right`. This will result in an infinite loop in your proposal, no ?



---

archive/issue_comments_195301.json:
```json
{
    "body": "Ah, I made a correction in my implementation `has_right(i)` called `(~self).has_descent(i, side='left')`.\n\nI'm not so sure now what the best course of action is. From the above, having to create the inverse is slow (at least generically). I'm partially inclined to just implement `has_left` and `has_right` for Weyl groups which calls `has_descent(i, side=*)` to fix the problem at present. In any of the solutions except my initial one, I would think the speed should roughly be the same...",
    "created_at": "2014-03-07T22:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195301",
    "user": "https://github.com/tscrim"
}
```

Ah, I made a correction in my implementation `has_right(i)` called `(~self).has_descent(i, side='left')`.

I'm not so sure now what the best course of action is. From the above, having to create the inverse is slow (at least generically). I'm partially inclined to just implement `has_left` and `has_right` for Weyl groups which calls `has_descent(i, side=*)` to fix the problem at present. In any of the solutions except my initial one, I would think the speed should roughly be the same...



---

archive/issue_comments_195302.json:
```json
{
    "body": "Changing keywords from \"\" to \"coxeter\".",
    "created_at": "2014-03-14T16:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195302",
    "user": "https://github.com/fchapoton"
}
```

Changing keywords from "" to "coxeter".



---

archive/issue_comments_195303.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-08T19:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195303",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_195304.json:
```json
{
    "body": "I am comfortable with accepting Fr\u00e9d\u00e9ric's changes.  From Nicolas' comments I think that the original implementation meant to have `has_descent` should call either `has_left` or `has_right` and at least one of those needs to be implemented.\n\nI checked that at least the `_test_has_descent` will fail when one of these is not implemented by going into a Coxeter group implementation, deleting the `has_right_descent` method, and then checking that `G._test_has_descent()` raises an error.  The problem is that all tests will pass in the implementation of a Coxeter group unless the `_test_has_descent` method is called (which was probably always the case and the source of the original problem).  Is there a way of ensuring that a test of the left and right functions will be made for future implementations?  We can just leave it up to the warning which is already in the documentation.",
    "created_at": "2014-04-10T19:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195304",
    "user": "https://github.com/zabrocki"
}
```

I am comfortable with accepting Frédéric's changes.  From Nicolas' comments I think that the original implementation meant to have `has_descent` should call either `has_left` or `has_right` and at least one of those needs to be implemented.

I checked that at least the `_test_has_descent` will fail when one of these is not implemented by going into a Coxeter group implementation, deleting the `has_right_descent` method, and then checking that `G._test_has_descent()` raises an error.  The problem is that all tests will pass in the implementation of a Coxeter group unless the `_test_has_descent` method is called (which was probably always the case and the source of the original problem).  Is there a way of ensuring that a test of the left and right functions will be made for future implementations?  We can just leave it up to the warning which is already in the documentation.



---

archive/issue_comments_195305.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-18T19:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195305",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_045051.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15219#event-45051"
}
```



---

archive/issue_events_045052.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15219#event-45052"
}
```



---

archive/issue_events_045053.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15219#event-45053"
}
```



---

archive/issue_events_045054.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15219#event-45054"
}
```



---

archive/issue_events_045055.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-02-14T10:27:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15219#event-45055"
}
```



---

archive/issue_events_045056.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-02-14T10:27:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "milestone": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15219#event-45056"
}
```



---

archive/issue_events_045057.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-04-23T18:17:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "milestone": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15219#event-45057"
}
```



---

archive/issue_events_045058.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-04-23T18:17:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "milestone": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15219#event-45058"
}
```



---

archive/issue_events_045059.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-05-22T20:26:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "milestone": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15219#event-45059"
}
```



---

archive/issue_events_045060.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-05-22T20:26:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "milestone": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15219#event-45060"
}
```



---

archive/issue_comments_195306.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-06-08T16:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195306",
    "user": "https://github.com/anneschilling"
}
```

New commits:



---

archive/issue_comments_195307.json:
```json
{
    "body": "Replying to [comment:25 zabrocki]:\n> I am comfortable with accepting Fr\u00e9d\u00e9ric's changes.  From Nicolas' comments I think that the original implementation meant to have `has_descent` should call either `has_left` or `has_right` and at least one of those needs to be implemented.\n> \n> I checked that at least the `_test_has_descent` will fail when one of these is not implemented by going into a Coxeter group implementation, deleting the `has_right_descent` method, and then checking that `G._test_has_descent()` raises an error.  The problem is that all tests will pass in the implementation of a Coxeter group unless the `_test_has_descent` method is called (which was probably always the case and the source of the original problem).  Is there a way of ensuring that a test of the left and right functions will be made for future implementations?  We can just leave it up to the warning which is already in the documentation.\n\n\nI am ok with Federic's solution. All tests pass, so I think this should go in.",
    "created_at": "2015-06-08T16:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195307",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:25 zabrocki]:
> I am comfortable with accepting Frédéric's changes.  From Nicolas' comments I think that the original implementation meant to have `has_descent` should call either `has_left` or `has_right` and at least one of those needs to be implemented.
> 
> I checked that at least the `_test_has_descent` will fail when one of these is not implemented by going into a Coxeter group implementation, deleting the `has_right_descent` method, and then checking that `G._test_has_descent()` raises an error.  The problem is that all tests will pass in the implementation of a Coxeter group unless the `_test_has_descent` method is called (which was probably always the case and the source of the original problem).  Is there a way of ensuring that a test of the left and right functions will be made for future implementations?  We can just leave it up to the warning which is already in the documentation.


I am ok with Federic's solution. All tests pass, so I think this should go in.



---

archive/issue_comments_195308.json:
```json
{
    "body": "Anne looked at the code as well.  We both approve and I am setting to positive review.",
    "created_at": "2015-06-08T16:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195308",
    "user": "https://github.com/zabrocki"
}
```

Anne looked at the code as well.  We both approve and I am setting to positive review.



---

archive/issue_comments_195309.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-08T16:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195309",
    "user": "https://github.com/zabrocki"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_195310.json:
```json
{
    "body": "This will conflict will #18610 and is probably a duplicate. The review is coming too late.\n\nThis need to be checked, nevertheless.",
    "created_at": "2015-06-08T17:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195310",
    "user": "https://github.com/fchapoton"
}
```

This will conflict will #18610 and is probably a duplicate. The review is coming too late.

This need to be checked, nevertheless.



---

archive/issue_comments_195311.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2015-06-08T19:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195311",
    "user": "https://github.com/anneschilling"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_events_045061.json:
```json
{
    "actor": "https://github.com/anneschilling",
    "created_at": "2015-06-08T19:47:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "milestone": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15219#event-45061"
}
```



---

archive/issue_events_045062.json:
```json
{
    "actor": "https://github.com/anneschilling",
    "created_at": "2015-06-08T19:47:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15219#event-45062"
}
```



---

archive/issue_comments_195312.json:
```json
{
    "body": "Changing keywords from \"coxeter\" to \"coxeter, sd65\".",
    "created_at": "2015-06-09T11:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195312",
    "user": "https://github.com/zabrocki"
}
```

Changing keywords from "coxeter" to "coxeter, sd65".



---

archive/issue_comments_195313.json:
```json
{
    "body": "ok, let us consider that this has been solved by #18610",
    "created_at": "2015-06-24T19:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195313",
    "user": "https://github.com/fchapoton"
}
```

ok, let us consider that this has been solved by #18610



---

archive/issue_comments_195314.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2015-06-24T19:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195314",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_195315.json:
```json
{
    "body": "Replying to [comment:39 chapoton]:\n> ok, let us consider that this has been solved by #18610\n\n\nWhy are you setting it to positive review then and not leave it at sage-duplicate?",
    "created_at": "2015-06-24T19:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195315",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:39 chapoton]:
> ok, let us consider that this has been solved by #18610


Why are you setting it to positive review then and not leave it at sage-duplicate?



---

archive/issue_comments_195316.json:
```json
{
    "body": "This is 'positive review as a duplicate', the usual standard procedure, so that it can be closed!",
    "created_at": "2015-06-24T19:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195316",
    "user": "https://github.com/fchapoton"
}
```

This is 'positive review as a duplicate', the usual standard procedure, so that it can be closed!



---

archive/issue_comments_195317.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2015-07-17T20:07:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15219#issuecomment-195317",
    "user": "https://github.com/vbraun"
}
```

Resolution: duplicate



---

archive/issue_events_045063.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-07-17T20:07:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15219",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15219#event-45063"
}
```
