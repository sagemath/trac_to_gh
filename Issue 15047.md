# Issue 15047: Memory leak in the interface with Gurobi

Issue created by migration from Trac.

Original creator: ncohen

Original creation time: 2013-10-16 08:29:10

CC:  azi

As reported by Jernej, the `env` variable is allocated but not freed on `__dealloc___`. That's fixed here !

Nathann


---

Comment by ncohen created at 2013-10-16 08:55:27

New commits:


---

Comment by ncohen created at 2013-10-16 08:55:27

Changing status from new to needs_review.


---

Comment by azi created at 2013-10-16 18:07:58

Hello!

The patch is good just a short question - why do we need to check if it is NULL?


---

Comment by ncohen created at 2013-10-17 10:19:44

Ahahaha. Don't really know. Just used to checking that before freeing memory `:-)`

This being said, I just checled the doc and it explicitly says that `env` should only be freed after the model has been freed :
http://www.gurobi.com/documentation/5.6/reference-manual/c_grbfreeenv

Also, there was some "weird" memory leak, which this patch now fixes : in order to define a model you need to define a "master environment", and the model creates a copy of the "master environment", and that copy is the one you should work on. However, if you delete the master environment segfault follows.

So. This patch creates a "master environment" variable to STORE the temporary environment that was never deallocated. Everything then is done on the real environment, and when everything is done both environment are deallocated. Without checks for NULL, as it has been checked before, when the environment were created.

Weird behaviour, but branch updated ! `;-)`

Nathann

P.S. : Oh, and I also replace `** model` by `* model`. Makes the code simpler `:-P`


---

Comment by git created at 2013-10-17 10:21:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by azi created at 2013-10-18 09:42:08

The patch looks good to me!


---

Comment by azi created at 2013-10-18 09:47:55

The patch looks good to me!


---

Comment by azi created at 2013-10-18 09:47:55

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2013-10-18 09:48:50

Thaaaaaaaaaanks ! `;-)`

Nathann


---

Comment by vbraun created at 2013-12-21 18:43:38

Resolution: fixed
