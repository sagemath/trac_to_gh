# Issue 27508: Upgrade lrslib to 7.0

archive/issues_027508.json:
```json
{
    "body": "CC:  @slel @yuan-zhou @kliem @videlec @kiwifb @dimpase simonking\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27745\n\n",
    "created_at": "2019-04-29T08:11:05Z",
    "labels": [
        "packages: optional",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Upgrade lrslib to 7.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27508",
    "user": "@mkoeppe"
}
```
CC:  @slel @yuan-zhou @kliem @videlec @kiwifb @dimpase simonking



Issue created by migration from https://trac.sagemath.org/ticket/27745





---

archive/issue_comments_387815.json:
```json
{
    "body": "As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387815",
    "user": "@embray"
}
```

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_comments_387816.json:
```json
{
    "body": "Moving some tickets to 9.2. This is not a promise that I will be working on them.",
    "created_at": "2020-05-01T18:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387816",
    "user": "@mkoeppe"
}
```

Moving some tickets to 9.2. This is not a promise that I will be working on them.



---

archive/issue_comments_387817.json:
```json
{
    "body": "Changing keywords from \"\" to \"upgrade, lrslib\".",
    "created_at": "2020-08-19T21:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387817",
    "user": "@slel"
}
```

Changing keywords from "" to "upgrade, lrslib".



---

archive/issue_comments_387818.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387818",
    "user": "@mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_387819.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-05-17T20:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387819",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_387820.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-05-17T20:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387820",
    "user": "@mkoeppe"
}
```

New commits:



---

archive/issue_comments_387821.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-05-17T20:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387821",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_387822.json:
```json
{
    "body": "Various failures in `./sage -tp src/sage/game_theory/`, needs work",
    "created_at": "2021-05-17T20:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387822",
    "user": "@mkoeppe"
}
```

Various failures in `./sage -tp src/sage/game_theory/`, needs work



---

archive/issue_comments_387823.json:
```json
{
    "body": "Does anyone already have patches to support lrslib 071a in the Sage library?",
    "created_at": "2021-05-17T20:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387823",
    "user": "@mkoeppe"
}
```

Does anyone already have patches to support lrslib 071a in the Sage library?



---

archive/issue_comments_387824.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-17T20:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387824",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387825.json:
```json
{
    "body": "This is better, but the rather shocking lrs format parser in `src/sage/game_theory/parser.py` will need fixing",
    "created_at": "2021-05-17T20:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387825",
    "user": "@mkoeppe"
}
```

This is better, but the rather shocking lrs format parser in `src/sage/game_theory/parser.py` will need fixing



---

archive/issue_comments_387826.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-17T20:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387826",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387827.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-17T23:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387827",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387828.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-05-17T23:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387828",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_387829.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-18T01:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387829",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387830.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-18T01:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387830",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387831.json:
```json
{
    "body": "Should #28435 be dependent on this ticket, not the other way around?",
    "created_at": "2021-05-18T16:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387831",
    "user": "@dimpase"
}
```

Should #28435 be dependent on this ticket, not the other way around?



---

archive/issue_comments_387832.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-18T16:45:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387832",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387833.json:
```json
{
    "body": "FYI polymake 4.4 was just released",
    "created_at": "2021-05-18T16:45:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387833",
    "user": "@antonio-rojas"
}
```

FYI polymake 4.4 was just released



---

archive/issue_comments_387834.json:
```json
{
    "body": "should we do a bump to 4.4 here now?",
    "created_at": "2021-05-18T16:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387834",
    "user": "@dimpase"
}
```

should we do a bump to 4.4 here now?



---

archive/issue_comments_387835.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-05-18T16:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387835",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_387836.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-18T16:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387836",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387837.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-05-18T18:22:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387837",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_387838.json:
```json
{
    "body": "tested on macOS Catalina only",
    "created_at": "2021-05-18T18:41:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387838",
    "user": "@mkoeppe"
}
```

tested on macOS Catalina only



---

archive/issue_comments_387839.json:
```json
{
    "body": "`lrslib` does not compile on my Debian buster x86_64, see the attached log.",
    "created_at": "2021-05-18T20:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387839",
    "user": "tmonteil"
}
```

`lrslib` does not compile on my Debian buster x86_64, see the attached log.



---

archive/issue_comments_387840.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-05-18T20:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387840",
    "user": "tmonteil"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_387841.json:
```json
{
    "body": "Attachment [lrslib-071a+autotools-2021-05-17b.log](tarball://root/attachments/some-uuid/ticket27745/lrslib-071a+autotools-2021-05-17b.log) by tmonteil created at 2021-05-18 20:04:28",
    "created_at": "2021-05-18T20:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387841",
    "user": "tmonteil"
}
```

Attachment [lrslib-071a+autotools-2021-05-17b.log](tarball://root/attachments/some-uuid/ticket27745/lrslib-071a+autotools-2021-05-17b.log) by tmonteil created at 2021-05-18 20:04:28



---

archive/issue_comments_387842.json:
```json
{
    "body": "it build for me on Fedora.\nSomething is not right with openmpi in your log.",
    "created_at": "2021-05-18T20:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387842",
    "user": "@dimpase"
}
```

it build for me on Fedora.
Something is not right with openmpi in your log.



---

archive/issue_comments_387843.json:
```json
{
    "body": "I haven't tested at all with openmpi yet -- PRs are welcome",
    "created_at": "2021-05-18T20:34:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387843",
    "user": "@mkoeppe"
}
```

I haven't tested at all with openmpi yet -- PRs are welcome



---

archive/issue_comments_387844.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-18T23:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387844",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387845.json:
```json
{
    "body": "OK, mpi is fixed now",
    "created_at": "2021-05-18T23:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387845",
    "user": "@mkoeppe"
}
```

OK, mpi is fixed now



---

archive/issue_comments_387846.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-05-18T23:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387846",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_387847.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-19T05:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387847",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387848.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-19T05:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387848",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387849.json:
```json
{
    "body": "The `lrslib` issue with `openmpi` is fixed (self-tests pass).\n\nIf i do `export MAKE='make -j4'` before running `sage -i -f polymake`, the compilation still eats all my CPU, though `spkg-install.in` relies on `sdh_make`.\n\nAlso, i have 6G free on my machine, and the compilation ends up with a `No space left on device`. How much disk space is required to build and install `polymake` ?",
    "created_at": "2021-05-19T07:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387849",
    "user": "tmonteil"
}
```

The `lrslib` issue with `openmpi` is fixed (self-tests pass).

If i do `export MAKE='make -j4'` before running `sage -i -f polymake`, the compilation still eats all my CPU, though `spkg-install.in` relies on `sdh_make`.

Also, i have 6G free on my machine, and the compilation ends up with a `No space left on device`. How much disk space is required to build and install `polymake` ?



---

archive/issue_comments_387850.json:
```json
{
    "body": "Matthias linked it to `SAGE_NUM_THREADS`, but it is might indeed be better to link it to what `MAKE` sets. I am letting mine compile with 2 threads right now since 4 still ate through 10+Gb RAM.",
    "created_at": "2021-05-19T08:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387850",
    "user": "@tscrim"
}
```

Matthias linked it to `SAGE_NUM_THREADS`, but it is might indeed be better to link it to what `MAKE` sets. I am letting mine compile with 2 threads right now since 4 still ate through 10+Gb RAM.



---

archive/issue_comments_387851.json:
```json
{
    "body": "use `make -j4 polymake`, do not export MAKE. Time is high to drop `sage -i`, it is an extra hassle.",
    "created_at": "2021-05-19T10:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387851",
    "user": "@dimpase"
}
```

use `make -j4 polymake`, do not export MAKE. Time is high to drop `sage -i`, it is an extra hassle.



---

archive/issue_comments_387852.json:
```json
{
    "body": "Replying to [comment:46 dimpase]:\n> use `make -j4 polymake`, do not export MAKE. Time is high to drop `sage -i`, it is an extra hassle.\n\nBut then, how to i run self tests ?",
    "created_at": "2021-05-19T10:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387852",
    "user": "tmonteil"
}
```

Replying to [comment:46 dimpase]:
> use `make -j4 polymake`, do not export MAKE. Time is high to drop `sage -i`, it is an extra hassle.

But then, how to i run self tests ?



---

archive/issue_comments_387853.json:
```json
{
    "body": "Polymake is huge, it's about as big as Sage, I think. Go figure.",
    "created_at": "2021-05-19T10:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387853",
    "user": "@dimpase"
}
```

Polymake is huge, it's about as big as Sage, I think. Go figure.



---

archive/issue_comments_387854.json:
```json
{
    "body": "Replying to [comment:47 tmonteil]:\n> Replying to [comment:46 dimpase]:\n> > use `make -j4 polymake`, do not export MAKE. Time is high to drop `sage -i`, it is an extra hassle.\n> \n> But then, how to i run self tests ?\n`SAGE_CHECK=yes make -j4 polymake`",
    "created_at": "2021-05-19T10:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387854",
    "user": "@dimpase"
}
```

Replying to [comment:47 tmonteil]:
> Replying to [comment:46 dimpase]:
> > use `make -j4 polymake`, do not export MAKE. Time is high to drop `sage -i`, it is an extra hassle.
> 
> But then, how to i run self tests ?
`SAGE_CHECK=yes make -j4 polymake`



---

archive/issue_comments_387855.json:
```json
{
    "body": "How do I link perl after having installed it with\n\n`cpan -i XML::Writer XML::LibXML XML::LibXSLT File::Slurp Term::ReadLine::Gnu JSON SVG MongoDB`?\n\nI'm on a debian buster and don't know how to install polymake into sage.",
    "created_at": "2021-05-19T14:55:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387855",
    "user": "@kliem"
}
```

How do I link perl after having installed it with

`cpan -i XML::Writer XML::LibXML XML::LibXSLT File::Slurp Term::ReadLine::Gnu JSON SVG MongoDB`?

I'm on a debian buster and don't know how to install polymake into sage.



---

archive/issue_comments_387856.json:
```json
{
    "body": "Replying to [comment:45 tscrim]:\n> Matthias linked it to `SAGE_NUM_THREADS`, but it is might indeed be better to link it to what `MAKE` sets.\n\nDuring build, `SAGE_NUM_THREADS` is actually initialized from the MAKE setting.\nSee `build/bin/sage-build-num-threads` and `build/make/install`.",
    "created_at": "2021-05-19T15:09:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387856",
    "user": "@mkoeppe"
}
```

Replying to [comment:45 tscrim]:
> Matthias linked it to `SAGE_NUM_THREADS`, but it is might indeed be better to link it to what `MAKE` sets.

During build, `SAGE_NUM_THREADS` is actually initialized from the MAKE setting.
See `build/bin/sage-build-num-threads` and `build/make/install`.



---

archive/issue_comments_387857.json:
```json
{
    "body": "Replying to [comment:50 gh-kliem]:\n> How do I link perl after having installed it with\n> \n> `cpan -i XML::Writer XML::LibXML XML::LibXSLT File::Slurp Term::ReadLine::Gnu JSON SVG MongoDB`?\n> \n> I'm on a debian buster and don't know how to install polymake into sage.\n\nOn Debian, you can just install the prerequisite packages listed in `build/pkgs/perl_cpan_polymake_prereq/distros/debian.txt`",
    "created_at": "2021-05-19T15:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387857",
    "user": "@mkoeppe"
}
```

Replying to [comment:50 gh-kliem]:
> How do I link perl after having installed it with
> 
> `cpan -i XML::Writer XML::LibXML XML::LibXSLT File::Slurp Term::ReadLine::Gnu JSON SVG MongoDB`?
> 
> I'm on a debian buster and don't know how to install polymake into sage.

On Debian, you can just install the prerequisite packages listed in `build/pkgs/perl_cpan_polymake_prereq/distros/debian.txt`



---

archive/issue_comments_387858.json:
```json
{
    "body": "Replying to [comment:46 dimpase]:\n> use `make -j4 polymake`, do not export MAKE. Time is high to drop `sage -i`, it is an extra hassle.\n\nThe correct way to install an optional package is, of course,\n\n```\neval ./configure $(./config.status --config) --enable-jupymake && make build\n```\n",
    "created_at": "2021-05-19T15:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387858",
    "user": "@mkoeppe"
}
```

Replying to [comment:46 dimpase]:
> use `make -j4 polymake`, do not export MAKE. Time is high to drop `sage -i`, it is an extra hassle.

The correct way to install an optional package is, of course,

```
eval ./configure $(./config.status --config) --enable-jupymake && make build
```




---

archive/issue_comments_387859.json:
```json
{
    "body": "Replying to [comment:52 mkoeppe]:\n> Replying to [comment:50 gh-kliem]:\n> > How do I link perl after having installed it with\n> > \n> > `cpan -i XML::Writer XML::LibXML XML::LibXSLT File::Slurp Term::ReadLine::Gnu JSON SVG MongoDB`?\n> > \n> > I'm on a debian buster and don't know how to install polymake into sage.\n> \n> On Debian, you can just install the prerequisite packages listed in `build/pkgs/perl_cpan_polymake_prereq/distros/debian.txt`\n\nThanks. Well that requires root access, but I guess we have a nice IT so they'll do it.\n\nThat sage itself can be just installed without root access is a wonderful thing... (But they also have installed the generated list of recommended packages for me, which makes things a lot faster.)",
    "created_at": "2021-05-19T19:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387859",
    "user": "@kliem"
}
```

Replying to [comment:52 mkoeppe]:
> Replying to [comment:50 gh-kliem]:
> > How do I link perl after having installed it with
> > 
> > `cpan -i XML::Writer XML::LibXML XML::LibXSLT File::Slurp Term::ReadLine::Gnu JSON SVG MongoDB`?
> > 
> > I'm on a debian buster and don't know how to install polymake into sage.
> 
> On Debian, you can just install the prerequisite packages listed in `build/pkgs/perl_cpan_polymake_prereq/distros/debian.txt`

Thanks. Well that requires root access, but I guess we have a nice IT so they'll do it.

That sage itself can be just installed without root access is a wonderful thing... (But they also have installed the generated list of recommended packages for me, which makes things a lot faster.)



---

archive/issue_comments_387860.json:
```json
{
    "body": "I was able to build both packages (thank you Matthias for your help with this). However, there are issues with `interfaces/polymake.py` (make sure you run `sage -tp --optional=sage,polymake`). The biggest issue is that it doesn't even finish evaluating the first doctest:\n\n```\npolymake.eval('print foo;')\n```\n\nIt timed out after running for 5 minutes.\n\nI tried running this directly in my Sage shell, which it is still taking seemingly forever. I also tried `C = polymake('cube(3)')`, which after I hit ctrl-c, any additional attempt to run the interface results in multiple errors of the form:\n\n```\nTypeError: argument should be integer or bytes-like object, not 'str'\n```\n\n\nIs this an issue with the interface? Is this something with polymake trying to do something for the first time? Something else?\n\nThe branch just has one commit that cleans up the interface file a bit.\n----\nNew commits:",
    "created_at": "2021-05-20T00:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387860",
    "user": "@tscrim"
}
```

I was able to build both packages (thank you Matthias for your help with this). However, there are issues with `interfaces/polymake.py` (make sure you run `sage -tp --optional=sage,polymake`). The biggest issue is that it doesn't even finish evaluating the first doctest:

```
polymake.eval('print foo;')
```

It timed out after running for 5 minutes.

I tried running this directly in my Sage shell, which it is still taking seemingly forever. I also tried `C = polymake('cube(3)')`, which after I hit ctrl-c, any additional attempt to run the interface results in multiple errors of the form:

```
TypeError: argument should be integer or bytes-like object, not 'str'
```


Is this an issue with the interface? Is this something with polymake trying to do something for the first time? Something else?

The branch just has one commit that cleans up the interface file a bit.
----
New commits:



---

archive/issue_comments_387861.json:
```json
{
    "body": "Sounds like you are testing the old pexpect version of the interface.\nIf you install package `jupymake`, it will test the current version",
    "created_at": "2021-05-20T00:59:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387861",
    "user": "@mkoeppe"
}
```

Sounds like you are testing the old pexpect version of the interface.
If you install package `jupymake`, it will test the current version



---

archive/issue_comments_387862.json:
```json
{
    "body": "No, I did not. Once I installed that, then it worked. Since that is a requirement to using the interface, I think we should have `jupymake` as a dependency.",
    "created_at": "2021-05-20T01:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387862",
    "user": "@tscrim"
}
```

No, I did not. Once I installed that, then it worked. Since that is a requirement to using the interface, I think we should have `jupymake` as a dependency.



---

archive/issue_comments_387863.json:
```json
{
    "body": "Now it is stuck on line 128:\n\n```\np = polymake_expect.rand_sphere(4, 20, seed=5)\n```\n\nI guess we have to rewrite the interface file to remove all tests involving the old interface?",
    "created_at": "2021-05-20T01:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387863",
    "user": "@tscrim"
}
```

Now it is stuck on line 128:

```
p = polymake_expect.rand_sphere(4, 20, seed=5)
```

I guess we have to rewrite the interface file to remove all tests involving the old interface?



---

archive/issue_comments_387864.json:
```json
{
    "body": "Actually, do we want to just scrap the pexpect interface altogether?",
    "created_at": "2021-05-20T01:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387864",
    "user": "@tscrim"
}
```

Actually, do we want to just scrap the pexpect interface altogether?



---

archive/issue_comments_387865.json:
```json
{
    "body": "Replying to [comment:57 tscrim]:\n> No, I did not. Once I installed that, then it worked. Since that is a requirement to using the interface, I think we should have `jupymake` as a dependency.\n\njupymake can't be a dependency of polymake because it depends on polymake",
    "created_at": "2021-05-20T01:33:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387865",
    "user": "@mkoeppe"
}
```

Replying to [comment:57 tscrim]:
> No, I did not. Once I installed that, then it worked. Since that is a requirement to using the interface, I think we should have `jupymake` as a dependency.

jupymake can't be a dependency of polymake because it depends on polymake



---

archive/issue_comments_387866.json:
```json
{
    "body": "Replying to [comment:58 tscrim]:\n> Now it is stuck on line 128:\n> {{{\n> p = polymake_expect.rand_sphere(4, 20, seed=5)\n> }}}\n\nHere's how to debug this:\n\n```\nsage: from sage.interfaces.polymake import PolymakeExpect\nsage: polymake = PolymakeExpect(logfile=\"POLYMAKE.log\")\nsage: polymake.rand_sphere(4, 20, seed=5)\n```\n\n\nThen, in a separate terminal, use `tail -f POLYMAKE.log`",
    "created_at": "2021-05-20T02:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387866",
    "user": "@mkoeppe"
}
```

Replying to [comment:58 tscrim]:
> Now it is stuck on line 128:
> {{{
> p = polymake_expect.rand_sphere(4, 20, seed=5)
> }}}

Here's how to debug this:

```
sage: from sage.interfaces.polymake import PolymakeExpect
sage: polymake = PolymakeExpect(logfile="POLYMAKE.log")
sage: polymake.rand_sphere(4, 20, seed=5)
```


Then, in a separate terminal, use `tail -f POLYMAKE.log`



---

archive/issue_comments_387867.json:
```json
{
    "body": "There is indeed something going on with bytes vs strings.",
    "created_at": "2021-05-20T02:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387867",
    "user": "@mkoeppe"
}
```

There is indeed something going on with bytes vs strings.



---

archive/issue_comments_387868.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-20T03:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387868",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387869.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-20T03:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387869",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387870.json:
```json
{
    "body": "More fixes are needed",
    "created_at": "2021-05-20T05:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387870",
    "user": "@mkoeppe"
}
```

More fixes are needed



---

archive/issue_comments_387871.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-05-20T05:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387871",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_387872.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-20T16:15:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387872",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387873.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-20T16:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387873",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387874.json:
```json
{
    "body": "Thank you. That has gotten it down to one failure for me:\n\n```\n**********************************************************************\nFile \"src/sage/interfaces/polymake.py\", line 2098, in sage.interfaces.polymake.PolymakeExpect._eval_line\nFailed example:\n    c.N_VERTICES                      # optional - polymake\nExpected:\n    32768\nGot:\n    Can't locate object method \"description\" via package \"32768\" (perhaps you forgot to load \"32768\"?) at input line 1.\n```\n\nHowever, I cannot reproduce this in an interactive session, so it is probably something with the doctester setup. I propose marking it as `# known bug` with an explanation that it works interactively if it is failing for someone else.",
    "created_at": "2021-05-21T00:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387874",
    "user": "@tscrim"
}
```

Thank you. That has gotten it down to one failure for me:

```
**********************************************************************
File "src/sage/interfaces/polymake.py", line 2098, in sage.interfaces.polymake.PolymakeExpect._eval_line
Failed example:
    c.N_VERTICES                      # optional - polymake
Expected:
    32768
Got:
    Can't locate object method "description" via package "32768" (perhaps you forgot to load "32768"?) at input line 1.
```

However, I cannot reproduce this in an interactive session, so it is probably something with the doctester setup. I propose marking it as `# known bug` with an explanation that it works interactively if it is failing for someone else.



---

archive/issue_comments_387875.json:
```json
{
    "body": "Yes, there's something wrong with error recovery still.\n\nFor me, also `src/sage/geometry/polyhedron/backend_polymake.py` reveals additional errors. So there's more work",
    "created_at": "2021-05-21T00:46:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387875",
    "user": "@mkoeppe"
}
```

Yes, there's something wrong with error recovery still.

For me, also `src/sage/geometry/polyhedron/backend_polymake.py` reveals additional errors. So there's more work



---

archive/issue_comments_387876.json:
```json
{
    "body": "Thanks for the help above. So I have polymake installed now and it works in `sage -sh`.\n\nHowever, I'm getting an EOF error whenever I want to do something in sage, e.g. `polytopes.cube(backend='polymake').\n\n\n```\nTypeError: unable to start polymake: End Of File (EOF). Exception style platform.\nPolymake with PID 27045 running /usr/bin/env TERM=dumb polymake\ncommand: /usr/bin/env\nargs: ['/usr/bin/env', 'TERM=dumb', 'polymake']\nbuffer (last 100 chars): b''\nbefore (last 100 chars): b'dLine::Gnu\" at /srv/public/kliem/sage/local/share/polymake/perllib/Polymake/Core/Shell.pm line 30.\\r\\n'\nafter: <class 'pexpect.exceptions.EOF'>\nmatch: None\nmatch_index: None\nexitstatus: None\nflag_eof: True\npid: 27045\nchild_fd: 16\nclosed: False\ntimeout: None\ndelimiter: <class 'pexpect.exceptions.EOF'>\nlogfile: None\nlogfile_read: None\nlogfile_send: None\nmaxread: 4194304\nignorecase: False\nsearchwindowsize: None\ndelaybeforesend: None\ndelayafterclose: 0.1\ndelayafterterminate: 0.1\nsearcher: searcher_re:\n    0: re.compile(b'polytope > ')\n```\n",
    "created_at": "2021-05-21T06:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387876",
    "user": "@kliem"
}
```

Thanks for the help above. So I have polymake installed now and it works in `sage -sh`.

However, I'm getting an EOF error whenever I want to do something in sage, e.g. `polytopes.cube(backend='polymake').


```
TypeError: unable to start polymake: End Of File (EOF). Exception style platform.
Polymake with PID 27045 running /usr/bin/env TERM=dumb polymake
command: /usr/bin/env
args: ['/usr/bin/env', 'TERM=dumb', 'polymake']
buffer (last 100 chars): b''
before (last 100 chars): b'dLine::Gnu" at /srv/public/kliem/sage/local/share/polymake/perllib/Polymake/Core/Shell.pm line 30.\r\n'
after: <class 'pexpect.exceptions.EOF'>
match: None
match_index: None
exitstatus: None
flag_eof: True
pid: 27045
child_fd: 16
closed: False
timeout: None
delimiter: <class 'pexpect.exceptions.EOF'>
logfile: None
logfile_read: None
logfile_send: None
maxread: 4194304
ignorecase: False
searchwindowsize: None
delaybeforesend: None
delayafterclose: 0.1
delayafterterminate: 0.1
searcher: searcher_re:
    0: re.compile(b'polytope > ')
```




---

archive/issue_comments_387877.json:
```json
{
    "body": "Replying to [comment:71 gh-kliem]:\n> However, I'm getting an EOF error whenever I want to do something in sage, e.g. `polytopes.cube(backend='polymake').\n\nin `sage.interfaces.polymake` we have both `polymake_expect` and `polymake_jupymake` so which one is used in `polytopes.cube(backend='polymake')`?\n\nHow to tell `sage` I always want `polymake_jupymake` for every `something(backend='polymake')`?",
    "created_at": "2021-05-21T08:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387877",
    "user": "@sheerluck"
}
```

Replying to [comment:71 gh-kliem]:
> However, I'm getting an EOF error whenever I want to do something in sage, e.g. `polytopes.cube(backend='polymake').

in `sage.interfaces.polymake` we have both `polymake_expect` and `polymake_jupymake` so which one is used in `polytopes.cube(backend='polymake')`?

How to tell `sage` I always want `polymake_jupymake` for every `something(backend='polymake')`?



---

archive/issue_comments_387878.json:
```json
{
    "body": "oh I see\n\n```\nif PythonModule(\"JuPyMake\").is_present():\n    polymake = polymake_jupymake\nelse:\n    polymake = polymake_expect\n```\n",
    "created_at": "2021-05-21T08:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387878",
    "user": "@sheerluck"
}
```

oh I see

```
if PythonModule("JuPyMake").is_present():
    polymake = polymake_jupymake
else:
    polymake = polymake_expect
```




---

archive/issue_comments_387879.json:
```json
{
    "body": "For me it is `PolymakeExpect` apparently.",
    "created_at": "2021-05-21T08:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387879",
    "user": "@kliem"
}
```

For me it is `PolymakeExpect` apparently.



---

archive/issue_comments_387880.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-23T19:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387880",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387881.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-23T20:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387881",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387882.json:
```json
{
    "body": "With `jupymake` installed, `./sage -t  --optional=sage,polymake,jupymake,perl_mongodb src/sage/geometry/polyhedron/backend_polymake.py` now is down to 1 failure:\n\n```\nsage -t --random-seed=0 src/sage/geometry/polyhedron/backend_polymake.py\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/backend_polymake.py\", line 220, in sage.geometry.polyhedron.backend_polymake.Polyhedron_polymake.__init__\nFailed example:\n    TestSuite(p).run()                                 # optional - polymake\nExpected nothing\nGot:\n    Failure in _test_lawrence:\n    Traceback (most recent call last):\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/misc/sage_unittest.py\", line 297, in run\n        test_method(tester=tester)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/geometry/polyhedron/base.py\", line 6312, in _test_lawrence\n        tester.assertTrue(Q.is_combinatorially_isomorphic(R))\n      File \"/usr/local/Cellar/python@3.9/3.9.4/Frameworks/Python.framework/Versions/3.9/lib/python3.9/unittest/case.py\", line 682, in assertTrue\n        raise self.failureException(msg)\n    AssertionError: False is not true\n    ------------------------------------------------------------\n    The following tests failed: _test_lawrence\n**********************************************************************\n1 item had failures:\n   1 of   7 in sage.geometry.polyhedron.backend_polymake.Polyhedron_polymake.__init__\n    [91 tests, 1 failure, 27.73 s]\n----------------------------------------------------------------------\nsage -t --random-seed=0 src/sage/geometry/polyhedron/backend_polymake.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2021-05-23T20:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387882",
    "user": "@mkoeppe"
}
```

With `jupymake` installed, `./sage -t  --optional=sage,polymake,jupymake,perl_mongodb src/sage/geometry/polyhedron/backend_polymake.py` now is down to 1 failure:

```
sage -t --random-seed=0 src/sage/geometry/polyhedron/backend_polymake.py
**********************************************************************
File "src/sage/geometry/polyhedron/backend_polymake.py", line 220, in sage.geometry.polyhedron.backend_polymake.Polyhedron_polymake.__init__
Failed example:
    TestSuite(p).run()                                 # optional - polymake
Expected nothing
Got:
    Failure in _test_lawrence:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/misc/sage_unittest.py", line 297, in run
        test_method(tester=tester)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/geometry/polyhedron/base.py", line 6312, in _test_lawrence
        tester.assertTrue(Q.is_combinatorially_isomorphic(R))
      File "/usr/local/Cellar/python@3.9/3.9.4/Frameworks/Python.framework/Versions/3.9/lib/python3.9/unittest/case.py", line 682, in assertTrue
        raise self.failureException(msg)
    AssertionError: False is not true
    ------------------------------------------------------------
    The following tests failed: _test_lawrence
**********************************************************************
1 item had failures:
   1 of   7 in sage.geometry.polyhedron.backend_polymake.Polyhedron_polymake.__init__
    [91 tests, 1 failure, 27.73 s]
----------------------------------------------------------------------
sage -t --random-seed=0 src/sage/geometry/polyhedron/backend_polymake.py  # 1 doctest failed
----------------------------------------------------------------------
```




---

archive/issue_comments_387883.json:
```json
{
    "body": "Same without `jupymake`.",
    "created_at": "2021-05-23T20:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387883",
    "user": "@mkoeppe"
}
```

Same without `jupymake`.



---

archive/issue_comments_387884.json:
```json
{
    "body": "Help with the lawrence testcase would be welcome...",
    "created_at": "2021-05-23T20:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387884",
    "user": "@mkoeppe"
}
```

Help with the lawrence testcase would be welcome...



---

archive/issue_comments_387885.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-23T21:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387885",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387886.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-23T23:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387886",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387887.json:
```json
{
    "body": "I don't know how to fix the remaining errors with the pexpect version of the interface.",
    "created_at": "2021-05-23T23:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387887",
    "user": "@mkoeppe"
}
```

I don't know how to fix the remaining errors with the pexpect version of the interface.



---

archive/issue_comments_387888.json:
```json
{
    "body": "Given that `polymake` is marked experimental, perhaps this ticket is good enough for review though.",
    "created_at": "2021-05-23T23:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387888",
    "user": "@mkoeppe"
}
```

Given that `polymake` is marked experimental, perhaps this ticket is good enough for review though.



---

archive/issue_comments_387889.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-05-23T23:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387889",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_387890.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-24T00:00:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387890",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387891.json:
```json
{
    "body": "I believe the issue with `_test_lawrence()` is numerical instability. Consider\n\n```\nsage: p = Polyhedron(vertices=[(-1,-1), (1,0), (1,1), (0,1)], backend='polymake')\nsage: from sage.misc.prandom import randint \nsage: v = p.vertices()[randint(0, p.n_vertices()-1)].vector()\nsage: Q = p.lawrence_extension(2*v - p.center())\nsage: R = p.lawrence_extension(2.0*v - p.center())\n```\n\nUsing floating point numbers seems to lead to issues with the conversion back and forth as\n\n```\nsage: Q.Hrepresentation()                                                                                 \n(An inequality (0, 0, 1) x + 0 >= 0,\n An inequality (8, -4, 5) x + 4 >= 0,\n An inequality (11, -3, 0) x + 8 >= 0,\n An inequality (-8, 16, -19) x + 8 >= 0,\n An inequality (-8, 0, -5) x + 8 >= 0,\n An inequality (-3, -5, 0) x + 8 >= 0,\n An inequality (0, -4, 3) x + 4 >= 0)\nsage: R.Hrepresentation()                                                                                 \n(An inequality (-1.0, 2.0, -2.375) x + 1.0 >= 0,\n An inequality (3.66666666666667, -1.0, 0.0) x + 2.66666666666667 >= 0,\n An inequality (2.0, -1.0, 1.25) x + 1.0 >= 0,\n An inequality (0.0, -1.33333333333333, 1.0) x + 1.33333333333333 >= 0,\n An inequality (-1.0, -1.66666666666667, -2.96059473233375e-16) x + 2.66666666666667 >= 0,\n An inequality (-1.6, -1.86984930463184e-16, -1.0) x + 1.6 >= 0,\n An inequality (0.0, 0.0, 1.0) x + 0.0 >= 0)\n```\n\nThis agrees with the backend information created from polymake, but how the faces are computed in Sage are different:\n\n```\nsage: Q.facets()                                                                                          \n(A 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 3 vertices,\n A 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 3 vertices,\n A 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 3 vertices,\n A 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 3 vertices,\n A 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 3 vertices,\n A 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 3 vertices,\n A 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 4 vertices)\nsage: R.facets()                                                                                          \n(A 2-dimensional face of a Polyhedron in RDF^3 defined as the convex hull of 4 vertices,)\n```\n\nwhich is based off `R.combinatorial_polyhedron()`. In particular, if we try\n\n```\nsage: R.combinatorial_polyhedron().hasse_diagram()\n...\nValueError: not all facets are joins of vertices\nsage: R.combinatorial_polyhedron().hasse_diagram()\n```\n\n----\nBased off this, what I would do is explicitly skip the test and state that it is a known issue with numerical instability. I am not sure what else we can do about fixing it at this point `:/`.",
    "created_at": "2021-05-24T01:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387891",
    "user": "@tscrim"
}
```

I believe the issue with `_test_lawrence()` is numerical instability. Consider

```
sage: p = Polyhedron(vertices=[(-1,-1), (1,0), (1,1), (0,1)], backend='polymake')
sage: from sage.misc.prandom import randint 
sage: v = p.vertices()[randint(0, p.n_vertices()-1)].vector()
sage: Q = p.lawrence_extension(2*v - p.center())
sage: R = p.lawrence_extension(2.0*v - p.center())
```

Using floating point numbers seems to lead to issues with the conversion back and forth as

```
sage: Q.Hrepresentation()                                                                                 
(An inequality (0, 0, 1) x + 0 >= 0,
 An inequality (8, -4, 5) x + 4 >= 0,
 An inequality (11, -3, 0) x + 8 >= 0,
 An inequality (-8, 16, -19) x + 8 >= 0,
 An inequality (-8, 0, -5) x + 8 >= 0,
 An inequality (-3, -5, 0) x + 8 >= 0,
 An inequality (0, -4, 3) x + 4 >= 0)
sage: R.Hrepresentation()                                                                                 
(An inequality (-1.0, 2.0, -2.375) x + 1.0 >= 0,
 An inequality (3.66666666666667, -1.0, 0.0) x + 2.66666666666667 >= 0,
 An inequality (2.0, -1.0, 1.25) x + 1.0 >= 0,
 An inequality (0.0, -1.33333333333333, 1.0) x + 1.33333333333333 >= 0,
 An inequality (-1.0, -1.66666666666667, -2.96059473233375e-16) x + 2.66666666666667 >= 0,
 An inequality (-1.6, -1.86984930463184e-16, -1.0) x + 1.6 >= 0,
 An inequality (0.0, 0.0, 1.0) x + 0.0 >= 0)
```

This agrees with the backend information created from polymake, but how the faces are computed in Sage are different:

```
sage: Q.facets()                                                                                          
(A 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 3 vertices,
 A 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 3 vertices,
 A 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 3 vertices,
 A 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 3 vertices,
 A 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 3 vertices,
 A 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 3 vertices,
 A 2-dimensional face of a Polyhedron in QQ^3 defined as the convex hull of 4 vertices)
sage: R.facets()                                                                                          
(A 2-dimensional face of a Polyhedron in RDF^3 defined as the convex hull of 4 vertices,)
```

which is based off `R.combinatorial_polyhedron()`. In particular, if we try

```
sage: R.combinatorial_polyhedron().hasse_diagram()
...
ValueError: not all facets are joins of vertices
sage: R.combinatorial_polyhedron().hasse_diagram()
```

----
Based off this, what I would do is explicitly skip the test and state that it is a known issue with numerical instability. I am not sure what else we can do about fixing it at this point `:/`.



---

archive/issue_comments_387892.json:
```json
{
    "body": "Replying to [comment:82 mkoeppe]:\n> I don't know how to fix the remaining errors with the pexpect version of the interface.\n\nDo I understand correctly that Travis' remarks explain the error?",
    "created_at": "2021-05-24T06:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387892",
    "user": "@simon-king-jena"
}
```

Replying to [comment:82 mkoeppe]:
> I don't know how to fix the remaining errors with the pexpect version of the interface.

Do I understand correctly that Travis' remarks explain the error?



---

archive/issue_comments_387893.json:
```json
{
    "body": "Replying to [comment:87 SimonKing]:\n> Replying to [comment:82 mkoeppe]:\n> > I don't know how to fix the remaining errors with the pexpect version of the interface.\n> \n> Do I understand correctly that Travis' remarks explain the error?\n\nNo, the failure in `_test_lawrence` shows up both for the `PolymakeExpect` and for the `PolymakeJupymake` interface.\n\n`PolymakeExpect` has additional failures, which I do not know how to fix.",
    "created_at": "2021-05-24T06:45:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387893",
    "user": "@mkoeppe"
}
```

Replying to [comment:87 SimonKing]:
> Replying to [comment:82 mkoeppe]:
> > I don't know how to fix the remaining errors with the pexpect version of the interface.
> 
> Do I understand correctly that Travis' remarks explain the error?

No, the failure in `_test_lawrence` shows up both for the `PolymakeExpect` and for the `PolymakeJupymake` interface.

`PolymakeExpect` has additional failures, which I do not know how to fix.



---

archive/issue_comments_387894.json:
```json
{
    "body": "Replying to [comment:87 SimonKing]:\n> Replying to [comment:82 mkoeppe]:\n> > I don't know how to fix the remaining errors with the pexpect version of the interface.\n> \n> Do I understand correctly that Travis' remarks explain the error?\n\nI wouldn't say it fully explains it, but it at least gives an indication about what is going on. It definitely doesn't provide a fix, which should eventually be IMO (but not on this ticket).",
    "created_at": "2021-05-24T06:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387894",
    "user": "@tscrim"
}
```

Replying to [comment:87 SimonKing]:
> Replying to [comment:82 mkoeppe]:
> > I don't know how to fix the remaining errors with the pexpect version of the interface.
> 
> Do I understand correctly that Travis' remarks explain the error?

I wouldn't say it fully explains it, but it at least gives an indication about what is going on. It definitely doesn't provide a fix, which should eventually be IMO (but not on this ticket).



---

archive/issue_comments_387895.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-24T23:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387895",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387896.json:
```json
{
    "body": "Ok, with `jupymake` things are working now for me.",
    "created_at": "2021-05-25T07:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387896",
    "user": "@kliem"
}
```

Ok, with `jupymake` things are working now for me.



---

archive/issue_comments_387897.json:
```json
{
    "body": "Well it works well except for all doctests in `interfaces/polymake.py` involing `PolymakeExpect`. Maybe we should mark them as `not tested` until the bug is fixed?\n\nAlso we could catch the long `EOF` traceback, which has the deprecation warning hidden all the way at the top with something like:\n\n\n```diff\n-            self._change_prompt(\"polytope > \")\n-            Expect._start(self, alt_message=None)\n+            try:\n+                self._change_prompt(\"polytope > \")\n+                Expect._start(self, alt_message=None)\n+            except RuntimeError:\n+                raise RuntimeError(\"runtime error with deprecated pexpect-base interface to polymake; please install jupymake\")\n```\n",
    "created_at": "2021-05-25T07:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387897",
    "user": "@kliem"
}
```

Well it works well except for all doctests in `interfaces/polymake.py` involing `PolymakeExpect`. Maybe we should mark them as `not tested` until the bug is fixed?

Also we could catch the long `EOF` traceback, which has the deprecation warning hidden all the way at the top with something like:


```diff
-            self._change_prompt("polytope > ")
-            Expect._start(self, alt_message=None)
+            try:
+                self._change_prompt("polytope > ")
+                Expect._start(self, alt_message=None)
+            except RuntimeError:
+                raise RuntimeError("runtime error with deprecated pexpect-base interface to polymake; please install jupymake")
```




---

archive/issue_comments_387898.json:
```json
{
    "body": "I can't reproduce what you report about EOF.\nCould you please obtain a log as explained in comment 61?",
    "created_at": "2021-05-25T16:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387898",
    "user": "@mkoeppe"
}
```

I can't reproduce what you report about EOF.
Could you please obtain a log as explained in comment 61?



---

archive/issue_comments_387899.json:
```json
{
    "body": "\n```\nkliem@cofio:~/localhome/sage/src/sage/geometry/polyhedron$ tail -f POLYMAKE.log\nWelcome to polymake version 4.4\nCopyright (c) 1997-2021\nEwgenij Gawrilow, Michael Joswig, and the polymake team\nTechnische Universit\u00e4t Berlin, Germany\nhttps://polymake.org\n\nThis is free software licensed under GPL; see the source for copying conditions.\nThere is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n\nLoading applications now...Can't locate object method \"new\" via package \"Term::ReadLine::Gnu\" at /srv/public/kliem/sage/local/share/polymake/perllib/Polymake/Core/Shell.pm line 30.\n```\n",
    "created_at": "2021-05-26T05:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387899",
    "user": "@kliem"
}
```


```
kliem@cofio:~/localhome/sage/src/sage/geometry/polyhedron$ tail -f POLYMAKE.log
Welcome to polymake version 4.4
Copyright (c) 1997-2021
Ewgenij Gawrilow, Michael Joswig, and the polymake team
Technische Universitt Berlin, Germany
https://polymake.org

This is free software licensed under GPL; see the source for copying conditions.
There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

Loading applications now...Can't locate object method "new" via package "Term::ReadLine::Gnu" at /srv/public/kliem/sage/local/share/polymake/perllib/Polymake/Core/Shell.pm line 30.
```




---

archive/issue_comments_387900.json:
```json
{
    "body": "As mentioned above, this needs not to be fixed here (experimental and deprecated). However, I was just thinking that a more meaningful error message could be nicer. There is the deprecation message all the way on the top, so theoretically people should figure what the problem is either way (as I did; I didn't follow the discussion and so this deprecation message told me what to do).",
    "created_at": "2021-05-26T06:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387900",
    "user": "@kliem"
}
```

As mentioned above, this needs not to be fixed here (experimental and deprecated). However, I was just thinking that a more meaningful error message could be nicer. There is the deprecation message all the way on the top, so theoretically people should figure what the problem is either way (as I did; I didn't follow the discussion and so this deprecation message told me what to do).



---

archive/issue_comments_387901.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-26T06:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387901",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387902.json:
```json
{
    "body": "Replying to [comment:93 gh-kliem]:\n> Well it works well except for all doctests in `interfaces/polymake.py` involing `PolymakeExpect`. Maybe we should mark them as `not tested` until the bug is fixed?\n\nDone",
    "created_at": "2021-05-26T06:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387902",
    "user": "@mkoeppe"
}
```

Replying to [comment:93 gh-kliem]:
> Well it works well except for all doctests in `interfaces/polymake.py` involing `PolymakeExpect`. Maybe we should mark them as `not tested` until the bug is fixed?

Done



---

archive/issue_comments_387903.json:
```json
{
    "body": "Replying to [comment:96 gh-kliem]:\n> [...] I was just thinking that a more meaningful error message could be nicer. \n\nI agree, so please feel free to push this change to the ticket. Thanks!",
    "created_at": "2021-05-26T06:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387903",
    "user": "@mkoeppe"
}
```

Replying to [comment:96 gh-kliem]:
> [...] I was just thinking that a more meaningful error message could be nicer. 

I agree, so please feel free to push this change to the ticket. Thanks!



---

archive/issue_comments_387904.json:
```json
{
    "body": "Replying to [comment:95 gh-kliem]:\n> {{{\n> kliem`@`cofio:~/localhome/sage/src/sage/geometry/polyhedron$ tail -f POLYMAKE.log\n> [...]\n> Loading applications now...Can't locate object method \"new\" via package \"Term::ReadLine::Gnu\" at /srv/public/kliem/sage/local/share/polymake/perllib/Polymake/Core/Shell.pm line 30.\n> }}}\n\nLooks like `perl_term_readline_gnu` is not installed correctly.",
    "created_at": "2021-05-26T06:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387904",
    "user": "@mkoeppe"
}
```

Replying to [comment:95 gh-kliem]:
> {{{
> kliem`@`cofio:~/localhome/sage/src/sage/geometry/polyhedron$ tail -f POLYMAKE.log
> [...]
> Loading applications now...Can't locate object method "new" via package "Term::ReadLine::Gnu" at /srv/public/kliem/sage/local/share/polymake/perllib/Polymake/Core/Shell.pm line 30.
> }}}

Looks like `perl_term_readline_gnu` is not installed correctly.



---

archive/issue_comments_387905.json:
```json
{
    "body": "Replying to [comment:100 mkoeppe]:\n> Replying to [comment:95 gh-kliem]:\n> > {{{\n> > kliem`@`cofio:~/localhome/sage/src/sage/geometry/polyhedron$ tail -f POLYMAKE.log\n> > [...]\n> > Loading applications now...Can't locate object method \"new\" via package \"Term::ReadLine::Gnu\" at /srv/public/kliem/sage/local/share/polymake/perllib/Polymake/Core/Shell.pm line 30.\n> > }}}\n> \n> Looks like `perl_term_readline_gnu` is not installed correctly.\n> \n> \n> \nAccording to `dpkg -s libterm-readline-gnu-perl` I have version 1.36-1 installed. But anyway, it is not a huge issue to me, as installiing `jupymake` solved this all.",
    "created_at": "2021-05-26T07:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387905",
    "user": "@kliem"
}
```

Replying to [comment:100 mkoeppe]:
> Replying to [comment:95 gh-kliem]:
> > {{{
> > kliem`@`cofio:~/localhome/sage/src/sage/geometry/polyhedron$ tail -f POLYMAKE.log
> > [...]
> > Loading applications now...Can't locate object method "new" via package "Term::ReadLine::Gnu" at /srv/public/kliem/sage/local/share/polymake/perllib/Polymake/Core/Shell.pm line 30.
> > }}}
> 
> Looks like `perl_term_readline_gnu` is not installed correctly.
> 
> 
> 
According to `dpkg -s libterm-readline-gnu-perl` I have version 1.36-1 installed. But anyway, it is not a huge issue to me, as installiing `jupymake` solved this all.



---

archive/issue_comments_387906.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-05-26T07:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387906",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_387907.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-26T09:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387907",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387908.json:
```json
{
    "body": "`polymake` has specific options for precomputed data, so that it takes the input unconditionally.\n\nIf we do not use it, our pickling/unpickling is even worse than recreating the polytope:\n\nBefore my commits:\n\n\n```\nsage: %time P = polytopes.hypercube(8, backend='polymake')                                                                                                                                                                                                                                                                                                                 \nCPU times: user 3.16 s, sys: 200 ms, total: 3.36 s\nWall time: 3.36 s\nsage: %time P1 = loads(dumps(P))                                                                                                                                                                                                                                                                                                                                           \nCPU times: user 828 ms, sys: 35.9 ms, total: 864 ms\nWall time: 863 ms\nsage: %time P._polymake_polytope.F_VECTOR                                                                                                                                                                                                                                                                                                                                  \nCPU times: user 18.4 ms, sys: 162 \u00b5s, total: 18.6 ms\nWall time: 18.5 ms\n256 1024 1792 1792 1120 448 112 16\nsage: %time P1._polymake_polytope.F_VECTOR                                                                                                                                                                                                                                                                                                                                 \nCPU times: user 12.5 s, sys: 0 ns, total: 12.5 s\nWall time: 12.5 s\n256 1024 1792 1792 1120 448 112 16\n```\n\n\nAfter:\n\n\n```\nsage: %time P = polytopes.hypercube(8, backend='polymake')                                                                                                                                                                                                                                                                                                                 \nCPU times: user 4.63 s, sys: 287 ms, total: 4.92 s\nWall time: 4.92 s\nsage: %time P1 = loads(dumps(P))                                                                                                                                                                                                                                                                                                                                           \nCPU times: user 842 ms, sys: 39.8 ms, total: 882 ms\nWall time: 881 ms\nsage: %time P._polymake_polytope.F_VECTOR                                                                                                                                                                                                                                                                                                                                  \nCPU times: user 18.7 ms, sys: 168 \u00b5s, total: 18.8 ms\nWall time: 18.7 ms\n256 1024 1792 1792 1120 448 112 16\nsage: %time P1._polymake_polytope.F_VECTOR                                                                                                                                                                                                                                                                                                                                 \nCPU times: user 27.3 ms, sys: 0 ns, total: 27.3 ms\nWall time: 27.1 ms\n256 1024 1792 1792 1120 448 112 16\n```\n",
    "created_at": "2021-05-26T09:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387908",
    "user": "@kliem"
}
```

`polymake` has specific options for precomputed data, so that it takes the input unconditionally.

If we do not use it, our pickling/unpickling is even worse than recreating the polytope:

Before my commits:


```
sage: %time P = polytopes.hypercube(8, backend='polymake')                                                                                                                                                                                                                                                                                                                 
CPU times: user 3.16 s, sys: 200 ms, total: 3.36 s
Wall time: 3.36 s
sage: %time P1 = loads(dumps(P))                                                                                                                                                                                                                                                                                                                                           
CPU times: user 828 ms, sys: 35.9 ms, total: 864 ms
Wall time: 863 ms
sage: %time P._polymake_polytope.F_VECTOR                                                                                                                                                                                                                                                                                                                                  
CPU times: user 18.4 ms, sys: 162 s, total: 18.6 ms
Wall time: 18.5 ms
256 1024 1792 1792 1120 448 112 16
sage: %time P1._polymake_polytope.F_VECTOR                                                                                                                                                                                                                                                                                                                                 
CPU times: user 12.5 s, sys: 0 ns, total: 12.5 s
Wall time: 12.5 s
256 1024 1792 1792 1120 448 112 16
```


After:


```
sage: %time P = polytopes.hypercube(8, backend='polymake')                                                                                                                                                                                                                                                                                                                 
CPU times: user 4.63 s, sys: 287 ms, total: 4.92 s
Wall time: 4.92 s
sage: %time P1 = loads(dumps(P))                                                                                                                                                                                                                                                                                                                                           
CPU times: user 842 ms, sys: 39.8 ms, total: 882 ms
Wall time: 881 ms
sage: %time P._polymake_polytope.F_VECTOR                                                                                                                                                                                                                                                                                                                                  
CPU times: user 18.7 ms, sys: 168 s, total: 18.8 ms
Wall time: 18.7 ms
256 1024 1792 1792 1120 448 112 16
sage: %time P1._polymake_polytope.F_VECTOR                                                                                                                                                                                                                                                                                                                                 
CPU times: user 27.3 ms, sys: 0 ns, total: 27.3 ms
Wall time: 27.1 ms
256 1024 1792 1792 1120 448 112 16
```




---

archive/issue_comments_387909.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-26T09:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387909",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387910.json:
```json
{
    "body": "Looks like commit ba0a479 got lost",
    "created_at": "2021-05-26T14:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387910",
    "user": "@mkoeppe"
}
```

Looks like commit ba0a479 got lost



---

archive/issue_comments_387911.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-26T14:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387911",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387912.json:
```json
{
    "body": "Thanks for catching this.",
    "created_at": "2021-05-26T14:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387912",
    "user": "@kliem"
}
```

Thanks for catching this.



---

archive/issue_comments_387913.json:
```json
{
    "body": "I'm happy with these changes.",
    "created_at": "2021-05-26T17:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387913",
    "user": "@mkoeppe"
}
```

I'm happy with these changes.



---

archive/issue_comments_387914.json:
```json
{
    "body": "I am also happy with the current state. We can do more work later on with any specific issue (in particular, the `_test_lawrence` as I suspect that was already an issue before this). Based on everything, I am setting to a positive review. If there are any objections, feel free to revert.",
    "created_at": "2021-05-27T07:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387914",
    "user": "@tscrim"
}
```

I am also happy with the current state. We can do more work later on with any specific issue (in particular, the `_test_lawrence` as I suspect that was already an issue before this). Based on everything, I am setting to a positive review. If there are any objections, feel free to revert.



---

archive/issue_comments_387915.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-05-27T07:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387915",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_387916.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-05-27T16:31:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387916",
    "user": "@mkoeppe"
}
```

Thanks!



---

archive/issue_comments_387917.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-06-07T23:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387917",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_387918.json:
```json
{
    "body": "\n```\n**********************************************************************\nFile \"src/sage/interfaces/polymake.py\", line 187, in sage.interfaces.polymake.PolymakeAbstract.version\nFailed example:\n    Polymake(command='foobar').version()\nExpected:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: unable to start polymake because the command 'foobar' failed:\n    The command was not found or was not executable: foobar.\n    Please install the optional polymake package for sage (but read its SPKG.txt first!)\n    or install polymake system-wide\nGot:\n    doctest:warning\n      File \"/home/release/Sage/src/bin/sage-runtests\", line 144, in <module>\n        err = DC.run()\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/control.py\", line 1207, in run\n        self.run_doctests()\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/control.py\", line 909, in run_doctests\n        self.dispatcher.dispatch()\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 2040, in dispatch\n        self.parallel_dispatch()\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 1935, in parallel_dispatch\n        w.start()  # This might take some time\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 2207, in start\n        super(DocTestWorker, self).start()\n      File \"/usr/lib64/python3.9/multiprocessing/process.py\", line 121, in start\n        self._popen = self._Popen(self)\n      File \"/usr/lib64/python3.9/multiprocessing/context.py\", line 224, in _Popen\n        return _default_context.get_context().Process._Popen(process_obj)\n      File \"/usr/lib64/python3.9/multiprocessing/context.py\", line 277, in _Popen\n        return Popen(process_obj)\n      File \"/usr/lib64/python3.9/multiprocessing/popen_fork.py\", line 19, in __init__\n        self._launch(process_obj)\n      File \"/usr/lib64/python3.9/multiprocessing/popen_fork.py\", line 71, in _launch\n        code = process_obj._bootstrap(parent_sentinel=child_r)\n      File \"/usr/lib64/python3.9/multiprocessing/process.py\", line 315, in _bootstrap\n        self.run()\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 2179, in run\n        task(self.options, self.outtmpfile, msgpipe, self.result_queue)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 2508, in __call__\n        doctests, extras = self._run(runner, options, results)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 2555, in _run\n        result = runner.run(test)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 906, in run\n        return self._run(test, compileflags, out)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.polymake.PolymakeAbstract.version[1]>\", line 1, in <module>\n        Polymake(command='foobar').version()\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py\", line 196, in version\n        return self.get('$Polymake::Version')\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py\", line 617, in get\n        return self.eval(\"print {};\".format(cmd)).strip()\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/expect.py\", line 1381, in eval\n        return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/expect.py\", line 1381, in <listcomp>\n        return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py\", line 2120, in _eval_line\n        self._start()\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py\", line 1851, in _start\n        deprecation(27745, \"the pexpect-based interface to polymake is deprecated. Install package jupymake so that Sage can use the more robust jupymake-based interface to polymake\")\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/misc/superseded.py\", line 99, in deprecation\n        warning(trac_number, message, DeprecationWarning, stacklevel)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/misc/superseded.py\", line 145, in warning\n        warn(message, warning_class, stacklevel)\n      File \"/usr/lib64/python3.9/warnings.py\", line 109, in _showwarnmsg\n        sw(msg.message, msg.category, msg.filename, msg.lineno,\n    :\n    DeprecationWarning: the pexpect-based interface to polymake is deprecated. Install package jupymake so that Sage can use the more robust jupymake-based interface to polymake\n    See https://trac.sagemath.org/27745 for details.\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/expect.py\", line 492, in _start\n        self._expect = SageSpawn(cmd,\n      File \"sage/interfaces/sagespawn.pyx\", line 65, in sage.interfaces.sagespawn.SageSpawn.__init__ (build/cythonized/sage/interfaces/sagespawn.c:1984)\n        with ContainChildren(silent=True):\n      File \"sage/interfaces/sagespawn.pyx\", line 66, in sage.interfaces.sagespawn.SageSpawn.__init__ (build/cythonized/sage/interfaces/sagespawn.c:1938)\n        spawn.__init__(self, *args, **kwds)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/pexpect/pty_spawn.py\", line 205, in __init__\n        self._spawn(command, args, preexec_fn, dimensions)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/pexpect/pty_spawn.py\", line 276, in _spawn\n        raise ExceptionPexpect('The command was not found or was not ' +\n    pexpect.exceptions.ExceptionPexpect: The command was not found or was not executable: foobar.\n    <BLANKLINE>\n    During handling of the above exception, another exception occurred:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py\", line 1856, in _start\n        Expect._start(self, alt_message=None)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/expect.py\", line 503, in _start\n        raise RuntimeError(\"unable to start %s because the command %r failed: %s\\n%s\" %\n    RuntimeError: unable to start polymake because the command 'foobar' failed: The command was not found or was not executable: foobar.\n    Please install the optional polymake package for sage  (but read its SPKG.txt first!)\n    or install polymake system-wide\n    <BLANKLINE>\n    During handling of the above exception, another exception occurred:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.polymake.PolymakeAbstract.version[1]>\", line 1, in <module>\n        Polymake(command='foobar').version()\n      File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12906)\n        self.cache = f(self._instance)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py\", line 196, in version\n        return self.get('$Polymake::Version')\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py\", line 617, in get\n        return self.eval(\"print {};\".format(cmd)).strip()\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/expect.py\", line 1381, in eval\n        return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/expect.py\", line 1381, in <listcomp>\n        return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py\", line 2120, in _eval_line\n        self._start()\n      File \"/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py\", line 1858, in _start\n        raise RuntimeError(\"runtime error with deprecated pexpect-base interface to polymake; please install jupymake\")\n    RuntimeError: runtime error with deprecated pexpect-base interface to polymake; please install jupymake\n**********************************************************************\n1 item had failures:\n   1 of   3 in sage.interfaces.polymake.PolymakeAbstract.version\n    [54 tests, 1 failure, 0.03 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 47.5 --random-seed=0 src/sage/interfaces/polymake.py  # 1 doctest failed\n----------------------------------------------------------------------\n\n```\n",
    "created_at": "2021-06-07T23:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387918",
    "user": "@vbraun"
}
```


```
**********************************************************************
File "src/sage/interfaces/polymake.py", line 187, in sage.interfaces.polymake.PolymakeAbstract.version
Failed example:
    Polymake(command='foobar').version()
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: unable to start polymake because the command 'foobar' failed:
    The command was not found or was not executable: foobar.
    Please install the optional polymake package for sage (but read its SPKG.txt first!)
    or install polymake system-wide
Got:
    doctest:warning
      File "/home/release/Sage/src/bin/sage-runtests", line 144, in <module>
        err = DC.run()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/control.py", line 1207, in run
        self.run_doctests()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/control.py", line 909, in run_doctests
        self.dispatcher.dispatch()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 2040, in dispatch
        self.parallel_dispatch()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 1935, in parallel_dispatch
        w.start()  # This might take some time
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 2207, in start
        super(DocTestWorker, self).start()
      File "/usr/lib64/python3.9/multiprocessing/process.py", line 121, in start
        self._popen = self._Popen(self)
      File "/usr/lib64/python3.9/multiprocessing/context.py", line 224, in _Popen
        return _default_context.get_context().Process._Popen(process_obj)
      File "/usr/lib64/python3.9/multiprocessing/context.py", line 277, in _Popen
        return Popen(process_obj)
      File "/usr/lib64/python3.9/multiprocessing/popen_fork.py", line 19, in __init__
        self._launch(process_obj)
      File "/usr/lib64/python3.9/multiprocessing/popen_fork.py", line 71, in _launch
        code = process_obj._bootstrap(parent_sentinel=child_r)
      File "/usr/lib64/python3.9/multiprocessing/process.py", line 315, in _bootstrap
        self.run()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 2179, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 2508, in __call__
        doctests, extras = self._run(runner, options, results)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 2555, in _run
        result = runner.run(test)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 906, in run
        return self._run(test, compileflags, out)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.polymake.PolymakeAbstract.version[1]>", line 1, in <module>
        Polymake(command='foobar').version()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py", line 196, in version
        return self.get('$Polymake::Version')
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py", line 617, in get
        return self.eval("print {};".format(cmd)).strip()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/expect.py", line 1381, in eval
        return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/expect.py", line 1381, in <listcomp>
        return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py", line 2120, in _eval_line
        self._start()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py", line 1851, in _start
        deprecation(27745, "the pexpect-based interface to polymake is deprecated. Install package jupymake so that Sage can use the more robust jupymake-based interface to polymake")
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/misc/superseded.py", line 99, in deprecation
        warning(trac_number, message, DeprecationWarning, stacklevel)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/misc/superseded.py", line 145, in warning
        warn(message, warning_class, stacklevel)
      File "/usr/lib64/python3.9/warnings.py", line 109, in _showwarnmsg
        sw(msg.message, msg.category, msg.filename, msg.lineno,
    :
    DeprecationWarning: the pexpect-based interface to polymake is deprecated. Install package jupymake so that Sage can use the more robust jupymake-based interface to polymake
    See https://trac.sagemath.org/27745 for details.
    Traceback (most recent call last):
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/expect.py", line 492, in _start
        self._expect = SageSpawn(cmd,
      File "sage/interfaces/sagespawn.pyx", line 65, in sage.interfaces.sagespawn.SageSpawn.__init__ (build/cythonized/sage/interfaces/sagespawn.c:1984)
        with ContainChildren(silent=True):
      File "sage/interfaces/sagespawn.pyx", line 66, in sage.interfaces.sagespawn.SageSpawn.__init__ (build/cythonized/sage/interfaces/sagespawn.c:1938)
        spawn.__init__(self, *args, **kwds)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/pexpect/pty_spawn.py", line 205, in __init__
        self._spawn(command, args, preexec_fn, dimensions)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/pexpect/pty_spawn.py", line 276, in _spawn
        raise ExceptionPexpect('The command was not found or was not ' +
    pexpect.exceptions.ExceptionPexpect: The command was not found or was not executable: foobar.
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py", line 1856, in _start
        Expect._start(self, alt_message=None)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/expect.py", line 503, in _start
        raise RuntimeError("unable to start %s because the command %r failed: %s\n%s" %
    RuntimeError: unable to start polymake because the command 'foobar' failed: The command was not found or was not executable: foobar.
    Please install the optional polymake package for sage  (but read its SPKG.txt first!)
    or install polymake system-wide
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.polymake.PolymakeAbstract.version[1]>", line 1, in <module>
        Polymake(command='foobar').version()
      File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12906)
        self.cache = f(self._instance)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py", line 196, in version
        return self.get('$Polymake::Version')
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py", line 617, in get
        return self.eval("print {};".format(cmd)).strip()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/expect.py", line 1381, in eval
        return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/expect.py", line 1381, in <listcomp>
        return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py", line 2120, in _eval_line
        self._start()
      File "/home/release/Sage/local/lib64/python3.9/site-packages/sage/interfaces/polymake.py", line 1858, in _start
        raise RuntimeError("runtime error with deprecated pexpect-base interface to polymake; please install jupymake")
    RuntimeError: runtime error with deprecated pexpect-base interface to polymake; please install jupymake
**********************************************************************
1 item had failures:
   1 of   3 in sage.interfaces.polymake.PolymakeAbstract.version
    [54 tests, 1 failure, 0.03 s]
----------------------------------------------------------------------
sage -t --long --warn-long 47.5 --random-seed=0 src/sage/interfaces/polymake.py  # 1 doctest failed
----------------------------------------------------------------------

```




---

archive/issue_comments_387919.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-06-11T19:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387919",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_387920.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-06-11T19:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387920",
    "user": "@mkoeppe"
}
```

New commits:



---

archive/issue_comments_387921.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-12T08:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387921",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_387922.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-06-12T13:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387922",
    "user": "@mkoeppe"
}
```

Thanks!



---

archive/issue_comments_387923.json:
```json
{
    "body": "When testing with --optional=lrslib I get\n\n```\nsage -t --long --random-seed=0 src/sage/game_theory/catalog_normal_form_games.py  # 16 doctests failed\nsage -t --long --random-seed=0 src/sage/game_theory/parser.py  # 6 doctests failed\nsage -t --long --random-seed=0 src/sage/game_theory/normal_form_game.py  # 19 doctests failed\n```\n\nE.g.\n\n```\nFile \"src/sage/game_theory/parser.py\", line 158, in sage.game_theory.parser.Parser.format_lrs\nFailed example:\n    lrs_output[5:16]  # optional - lrslib\nExpected:\n    ['\\n',\n     '***** 4 4 rational\\n',\n     '2  0  1  2 \\n',\n     '1  1/2  1/2 -2 \\n',\n     '\\n',\n     '2  0  1  2 \\n',\n     '1  0  1 -2 \\n',\n     '\\n',\n     '\\n',\n     '*Number of equilibria found: 2\\n',\n     '*Player 1: vertices=3 bases=3 pivots=5\\n']\nGot:\n    []\n```\n",
    "created_at": "2021-06-20T07:26:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387923",
    "user": "@vbraun"
}
```

When testing with --optional=lrslib I get

```
sage -t --long --random-seed=0 src/sage/game_theory/catalog_normal_form_games.py  # 16 doctests failed
sage -t --long --random-seed=0 src/sage/game_theory/parser.py  # 6 doctests failed
sage -t --long --random-seed=0 src/sage/game_theory/normal_form_game.py  # 19 doctests failed
```

E.g.

```
File "src/sage/game_theory/parser.py", line 158, in sage.game_theory.parser.Parser.format_lrs
Failed example:
    lrs_output[5:16]  # optional - lrslib
Expected:
    ['\n',
     '***** 4 4 rational\n',
     '2  0  1  2 \n',
     '1  1/2  1/2 -2 \n',
     '\n',
     '2  0  1  2 \n',
     '1  0  1 -2 \n',
     '\n',
     '\n',
     '*Number of equilibria found: 2\n',
     '*Player 1: vertices=3 bases=3 pivots=5\n']
Got:
    []
```




---

archive/issue_comments_387924.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-06-20T07:26:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387924",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_387925.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-20T15:36:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387925",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387926.json:
```json
{
    "body": "I only got these failures:\n\n```\nsage -t --long --random-seed=0 src/sage/game_theory/parser.py  # 2 doctests failed\n```\n\nwhich are now fixed by aa028b7",
    "created_at": "2021-06-20T15:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387926",
    "user": "@mkoeppe"
}
```

I only got these failures:

```
sage -t --long --random-seed=0 src/sage/game_theory/parser.py  # 2 doctests failed
```

which are now fixed by aa028b7



---

archive/issue_comments_387927.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-06-20T15:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387927",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_387928.json:
```json
{
    "body": "Details for the other failures please?",
    "created_at": "2021-06-20T15:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387928",
    "user": "@mkoeppe"
}
```

Details for the other failures please?



---

archive/issue_comments_387929.json:
```json
{
    "body": "I am getting all of the failures that Volker is encountering. Running the block of lines 137-152 in `game_theory/parser.py`, I get\n\n```\nsage: lrs_output\n['\\n',\n '*nash:lrslib v.7.1 2020.10.17(64bit,lrsgmp.h,hybrid arithmetic) gmp v.6.2\\n',\n '*Input taken from  /home/uqtscrim/.sage/temp/SMP-36PQ8T2/14500/tmp_ey7z4keh']\n```\n\nAs an intermediate check\n\n```\nsage: g._Hrepresentation(A, -A)\n('H-representation\\nlinearity 1 5\\nbegin\\n5 4 rational\\n0 1 0 0 \\n0 0 1 0 \\n0 1 3  1 \\n0 2 2  1 \\n-1 1 1 0 \\nend\\n',\n 'H-representation\\nlinearity 1 5\\nbegin\\n5 4 rational\\n0 -1 -2  1 \\n0 -3 -2  1 \\n0 1 0 0 \\n0 0 1 0 \\n-1 1 1 0 \\nend\\n')\n```\n",
    "created_at": "2021-07-09T05:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387929",
    "user": "@tscrim"
}
```

I am getting all of the failures that Volker is encountering. Running the block of lines 137-152 in `game_theory/parser.py`, I get

```
sage: lrs_output
['\n',
 '*nash:lrslib v.7.1 2020.10.17(64bit,lrsgmp.h,hybrid arithmetic) gmp v.6.2\n',
 '*Input taken from  /home/uqtscrim/.sage/temp/SMP-36PQ8T2/14500/tmp_ey7z4keh']
```

As an intermediate check

```
sage: g._Hrepresentation(A, -A)
('H-representation\nlinearity 1 5\nbegin\n5 4 rational\n0 1 0 0 \n0 0 1 0 \n0 1 3  1 \n0 2 2  1 \n-1 1 1 0 \nend\n',
 'H-representation\nlinearity 1 5\nbegin\n5 4 rational\n0 -1 -2  1 \n0 -3 -2  1 \n0 1 0 0 \n0 0 1 0 \n-1 1 1 0 \nend\n')
```




---

archive/issue_comments_387930.json:
```json
{
    "body": "Help with fixing this is very welcome...",
    "created_at": "2021-07-09T06:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387930",
    "user": "@mkoeppe"
}
```

Help with fixing this is very welcome...



---

archive/issue_comments_387931.json:
```json
{
    "body": "Do you get the same for `g._Hrepresentation(A, -A)` in that code block?",
    "created_at": "2021-07-09T07:02:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387931",
    "user": "@tscrim"
}
```

Do you get the same for `g._Hrepresentation(A, -A)` in that code block?



---

archive/issue_comments_387932.json:
```json
{
    "body": "Thanks for testing. The `lrs_output` that you're getting there is too short. \nSo this looks like the installed `lrsnash` is broken. Is this from a system installation of lrslib, or from a Sage-installed lrslib? (see config.log)",
    "created_at": "2021-07-11T00:08:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387932",
    "user": "@mkoeppe"
}
```

Thanks for testing. The `lrs_output` that you're getting there is too short. 
So this looks like the installed `lrsnash` is broken. Is this from a system installation of lrslib, or from a Sage-installed lrslib? (see config.log)



---

archive/issue_comments_387933.json:
```json
{
    "body": "OK, I have reproduced this failure using `tox -e docker-ubuntu-focal-standard`.\n`lrsnash` is crashing with SIGSEGV on the given input.",
    "created_at": "2021-07-11T01:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387933",
    "user": "@mkoeppe"
}
```

OK, I have reproduced this failure using `tox -e docker-ubuntu-focal-standard`.
`lrsnash` is crashing with SIGSEGV on the given input.



---

archive/issue_comments_387934.json:
```json
{
    "body": "I have added a basic test for `lrsnash` to the autoconfiscated lrslib at https://github.com/mkoeppe/lrslib (the real upstream has no automated tests); the SIGSEGV can be seen on many platforms, for example\nhttps://github.com/mkoeppe/lrslib/runs/3038293301",
    "created_at": "2021-07-11T02:25:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387934",
    "user": "@mkoeppe"
}
```

I have added a basic test for `lrsnash` to the autoconfiscated lrslib at https://github.com/mkoeppe/lrslib (the real upstream has no automated tests); the SIGSEGV can be seen on many platforms, for example
https://github.com/mkoeppe/lrslib/runs/3038293301



---

archive/issue_comments_387935.json:
```json
{
    "body": "It may be relevant that `lrsnash` indicates on stderr that it is \"Processing legacy input files. Alternatively, you may skip setupnash and pass its input file to this program\".\n\nIt seems `lrsnash`, at least for this type of input, is broken. Using the lrslib package on `ubuntu-focal` (lrslib 0.70-3), I get `free(): double free detected in tcache 2\\n` and an error exit with status 6.",
    "created_at": "2021-07-11T02:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387935",
    "user": "@mkoeppe"
}
```

It may be relevant that `lrsnash` indicates on stderr that it is "Processing legacy input files. Alternatively, you may skip setupnash and pass its input file to this program".

It seems `lrsnash`, at least for this type of input, is broken. Using the lrslib package on `ubuntu-focal` (lrslib 0.70-3), I get `free(): double free detected in tcache 2\n` and an error exit with status 6.



---

archive/issue_comments_387936.json:
```json
{
    "body": "I'm not sure how to proceed here. We could relabel the uses of `lrslib` in the neglected `sage.game_theory` package with `lrsnash`, disabling these tests. We simply do not seem to have a working backend for game theory. \n\n(The uses of `lrslib` for volume computation in `sage.geometry` are likely OK.)",
    "created_at": "2021-07-11T02:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387936",
    "user": "@mkoeppe"
}
```

I'm not sure how to proceed here. We could relabel the uses of `lrslib` in the neglected `sage.game_theory` package with `lrsnash`, disabling these tests. We simply do not seem to have a working backend for game theory. 

(The uses of `lrslib` for volume computation in `sage.geometry` are likely OK.)



---

archive/issue_comments_387937.json:
```json
{
    "body": "The new input format is explained in http://cgm.cs.mcgill.ca/~avis/C/lrslib/USERGUIDE.html#nash",
    "created_at": "2021-07-11T03:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387937",
    "user": "@mkoeppe"
}
```

The new input format is explained in http://cgm.cs.mcgill.ca/~avis/C/lrslib/USERGUIDE.html#nash



---

archive/issue_comments_387938.json:
```json
{
    "body": "The new format works better - https://github.com/mkoeppe/lrslib/runs/3060863149",
    "created_at": "2021-07-13T23:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387938",
    "user": "@mkoeppe"
}
```

The new format works better - https://github.com/mkoeppe/lrslib/runs/3060863149



---

archive/issue_comments_387939.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-13T23:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387939",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387940.json:
```json
{
    "body": "Ready for testing",
    "created_at": "2021-07-14T00:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387940",
    "user": "@mkoeppe"
}
```

Ready for testing



---

archive/issue_comments_387941.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-14T00:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387941",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387942.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-14T00:53:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387942",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387943.json:
```json
{
    "body": "Tests at https://github.com/mkoeppe/sage/actions/runs/1028577144, https://github.com/mkoeppe/sage/actions/runs/1028577149, https://github.com/mkoeppe/sage/actions/runs/1028577148",
    "created_at": "2021-07-14T00:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387943",
    "user": "@mkoeppe"
}
```

Tests at https://github.com/mkoeppe/sage/actions/runs/1028577144, https://github.com/mkoeppe/sage/actions/runs/1028577149, https://github.com/mkoeppe/sage/actions/runs/1028577148



---

archive/issue_comments_387944.json:
```json
{
    "body": "Thank you for fixing that. I have made a few changes to the parser file so that it tests the new format. I also added it to the doc and did some very slight cleanup of that file too.\n\nI am happy with everything. If my changes are good, then we can set this to a positive review. All tests pass for me.\n----\nNew commits:",
    "created_at": "2021-07-14T02:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387944",
    "user": "@tscrim"
}
```

Thank you for fixing that. I have made a few changes to the parser file so that it tests the new format. I also added it to the doc and did some very slight cleanup of that file too.

I am happy with everything. If my changes are good, then we can set this to a positive review. All tests pass for me.
----
New commits:



---

archive/issue_comments_387945.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-14T03:22:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387945",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_387946.json:
```json
{
    "body": "Thanks, LGTM.\n\nFor the record, I tested the `spkg-configure.m4` using `tox -e docker-ubuntu-xenial-maximal -- config.status` (correctly does not accept lrslib) and `tox -e docker-ubuntu-bionic-maximal -- config.status` (correctly accepts lrslib).",
    "created_at": "2021-07-14T03:22:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387946",
    "user": "@mkoeppe"
}
```

Thanks, LGTM.

For the record, I tested the `spkg-configure.m4` using `tox -e docker-ubuntu-xenial-maximal -- config.status` (correctly does not accept lrslib) and `tox -e docker-ubuntu-bionic-maximal -- config.status` (correctly accepts lrslib).



---

archive/issue_comments_387947.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-07-19T00:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387947",
    "user": "@mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_387948.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-23T20:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27508#issuecomment-387948",
    "user": "@vbraun"
}
```

Resolution: fixed
