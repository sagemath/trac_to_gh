# Issue 12149: exclude tests that always fail for Python's spkg with SAGE_CHECK=yes

Issue created by migration from https://trac.sagemath.org/ticket/12321

Original creator: ddrake

Original creation time: 2012-01-18 14:43:28

Assignee: mvngu

The Python spkg is notorious for never, ever passing SAGE_CHECK tests. There are always several test failures that really just indicate that certain extra software (tcl, for example) isn't installed. These errors are harmless, and fortunately we can easily avoid those tests. In `spkg-check`, we need 

```
make EXTRATESTOPTS="-x test_foo -x test_bar" test
```

to exclude tests `foo` and `bar` from running.

We need to decide what tests to exclude, on what platforms, and then change the spkg so that it succeeds with `SAGE_CHECK=yes`.

Related tickets: #9299, #9297. sage-devel discussion: https://groups.google.com/d/topic/sage-devel/ol-DcoUO184/discussion


---

Comment by jdemeyer created at 2012-01-18 16:13:17

Let me point out the obvious: whatever you do on this ticket should of course be based on Python 2.7.2 at #9958.


---

Comment by jhpalmieri created at 2012-01-18 16:38:15

On OS X, both 10.6 and 10.7:

```
4 tests failed:
    test__locale test_ctypes test_distutils test_locale
```



---

Comment by jhpalmieri created at 2012-01-18 22:16:14

More testing:

 - on sage.math and hawk (OpenSolaris on x86): `test_distutils` was the only failure.
 - on several skynet machines (cicero, eno, sextus, taurus), `test_distutils` and `test_urllib2_localnet` failed.
 - on several other skynet machines (cleo, iras: the itanium machines): the same failures as in the previous case, and also `test_io`.
 - on skynet machine flavius, testing hangs apparently at `test_io`.
 - on skynet machine mark (SunOS on sparc), same failures as for cicero et al., and also `test_socket`, `test_sunaudiodev`, `test_uuid`.
 - on skynet machine silius (Linux on ppc64, not an officially supported platform for Sage), testing seems to have crashed, so it didn't print a report of which tests failed.


---

Comment by kcrisman created at 2012-01-19 02:29:21

Here's the report on OS X 10.4 PPC.

```
2 tests failed:
    test_ctypes test_distutils
37 tests skipped:
    test_aepack test_al test_applesingle test_bsddb test_bsddb3
    test_cd test_cl test_codecmaps_cn test_codecmaps_hk
    test_codecmaps_jp test_codecmaps_kr test_codecmaps_tw test_curses
    test_epoll test_gdb test_gdbm test_gl test_imgfile test_largefile
    test_linuxaudiodev test_macos test_macostools test_msilib
    test_ossaudiodev test_scriptpackages test_smtpnet
    test_socketserver test_startfile test_sunaudiodev test_timeout
    test_tk test_ttk_guionly test_urllib2net test_urllibnet
    test_winreg test_winsound test_zipfile64
5 skips unexpected on darwin:
    test_aepack test_applesingle test_macos test_scriptpackages
    test_ttk_guionly
```

I would agree that it is surprising that `test_macos` would be skipped on ... Mac OS.  Anyway, no surprises.

----

It would be nice to have documented here (and/or in SPKG.txt or something) exactly why we think each of them are okay to skip.


---

Comment by ddrake created at 2012-01-19 04:16:46

Replying to [comment:1 jdemeyer]:
> Let me point out the obvious: whatever you do on this ticket should of course be based on Python 2.7.2 at #9958.

Thanks! I'll be sure to work with that.

Replying to [comment:4 kcrisman]:
> It would be nice to have documented here (and/or in SPKG.txt or something) exactly why we think each of them are okay to skip. 

Yes, we should definitely document the reasoning in SPKG.txt.


---

Comment by jhpalmieri created at 2012-02-27 05:05:58

See also #12579: this ticket disables Python's self-tests. Assuming that ticket gets merged: first, when testing this ticket, make sure to set `SAGE_CHECK_PACKAGES` to something nonempty to override the default setting of `!python`, which disables Python's tests.  Second, when we are ready to merge this ticket, we should stop disabling the running of Python's self-tests.


---

Comment by jhpalmieri created at 2012-02-27 05:14:43

There is also a comment in the top-level Sage README.txt which needs to be changed when we get Python's self tests to work.


---

Comment by jhpalmieri created at 2012-02-29 21:55:17

Regarding #12579 and skipping Python's test suite: with the patch at #12613, you can run `sage -i -c python...` and the `-c` forces the test suite to be run. So (if #12613 is merged) testing Python spkgs from this ticket won't be too inconvenient.


---

Comment by roed created at 2013-03-28 23:09:26

Changing assignee from mvngu to GeorgSWeber.


---

Comment by roed created at 2013-03-28 23:09:26

Changing component from doctest to build.
