# Issue 12149: exclude tests that always fail for Python's spkg with SAGE_CHECK=yes

archive/issues_012149.json:
```json
{
    "body": "Assignee: mvngu\n\nThe Python spkg is notorious for never, ever passing SAGE_CHECK tests. There are always several test failures that really just indicate that certain extra software (tcl, for example) isn't installed. These errors are harmless, and fortunately we can easily avoid those tests. In `spkg-check`, we need \n\n```\nmake EXTRATESTOPTS=\"-x test_foo -x test_bar\" test\n```\n\nto exclude tests `foo` and `bar` from running.\n\nWe need to decide what tests to exclude, on what platforms, and then change the spkg so that it succeeds with `SAGE_CHECK=yes`.\n\nRelated tickets: #9299, #9297. sage-devel discussion: https://groups.google.com/d/topic/sage-devel/ol-DcoUO184/discussion\n\nIssue created by migration from https://trac.sagemath.org/ticket/12321\n\n",
    "created_at": "2012-01-18T14:43:28Z",
    "labels": [
        "doctest",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "exclude tests that always fail for Python's spkg with SAGE_CHECK=yes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12149",
    "user": "@dandrake"
}
```
Assignee: mvngu

The Python spkg is notorious for never, ever passing SAGE_CHECK tests. There are always several test failures that really just indicate that certain extra software (tcl, for example) isn't installed. These errors are harmless, and fortunately we can easily avoid those tests. In `spkg-check`, we need 

```
make EXTRATESTOPTS="-x test_foo -x test_bar" test
```

to exclude tests `foo` and `bar` from running.

We need to decide what tests to exclude, on what platforms, and then change the spkg so that it succeeds with `SAGE_CHECK=yes`.

Related tickets: #9299, #9297. sage-devel discussion: https://groups.google.com/d/topic/sage-devel/ol-DcoUO184/discussion

Issue created by migration from https://trac.sagemath.org/ticket/12321





---

archive/issue_comments_141391.json:
```json
{
    "body": "Let me point out the obvious: whatever you do on this ticket should of course be based on Python 2.7.2 at #9958.",
    "created_at": "2012-01-18T16:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12149#issuecomment-141391",
    "user": "@jdemeyer"
}
```

Let me point out the obvious: whatever you do on this ticket should of course be based on Python 2.7.2 at #9958.



---

archive/issue_comments_141392.json:
```json
{
    "body": "On OS X, both 10.6 and 10.7:\n\n```\n4 tests failed:\n    test__locale test_ctypes test_distutils test_locale\n```\n",
    "created_at": "2012-01-18T16:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12149#issuecomment-141392",
    "user": "@jhpalmieri"
}
```

On OS X, both 10.6 and 10.7:

```
4 tests failed:
    test__locale test_ctypes test_distutils test_locale
```




---

archive/issue_comments_141393.json:
```json
{
    "body": "More testing:\n\n- on sage.math and hawk (OpenSolaris on x86): `test_distutils` was the only failure.\n- on several skynet machines (cicero, eno, sextus, taurus), `test_distutils` and `test_urllib2_localnet` failed.\n- on several other skynet machines (cleo, iras: the itanium machines): the same failures as in the previous case, and also `test_io`.\n- on skynet machine flavius, testing hangs apparently at `test_io`.\n- on skynet machine mark (SunOS on sparc), same failures as for cicero et al., and also `test_socket`, `test_sunaudiodev`, `test_uuid`.\n- on skynet machine silius (Linux on ppc64, not an officially supported platform for Sage), testing seems to have crashed, so it didn't print a report of which tests failed.",
    "created_at": "2012-01-18T22:16:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12149#issuecomment-141393",
    "user": "@jhpalmieri"
}
```

More testing:

- on sage.math and hawk (OpenSolaris on x86): `test_distutils` was the only failure.
- on several skynet machines (cicero, eno, sextus, taurus), `test_distutils` and `test_urllib2_localnet` failed.
- on several other skynet machines (cleo, iras: the itanium machines): the same failures as in the previous case, and also `test_io`.
- on skynet machine flavius, testing hangs apparently at `test_io`.
- on skynet machine mark (SunOS on sparc), same failures as for cicero et al., and also `test_socket`, `test_sunaudiodev`, `test_uuid`.
- on skynet machine silius (Linux on ppc64, not an officially supported platform for Sage), testing seems to have crashed, so it didn't print a report of which tests failed.



---

archive/issue_comments_141394.json:
```json
{
    "body": "Here's the report on OS X 10.4 PPC.\n\n```\n2 tests failed:\n    test_ctypes test_distutils\n37 tests skipped:\n    test_aepack test_al test_applesingle test_bsddb test_bsddb3\n    test_cd test_cl test_codecmaps_cn test_codecmaps_hk\n    test_codecmaps_jp test_codecmaps_kr test_codecmaps_tw test_curses\n    test_epoll test_gdb test_gdbm test_gl test_imgfile test_largefile\n    test_linuxaudiodev test_macos test_macostools test_msilib\n    test_ossaudiodev test_scriptpackages test_smtpnet\n    test_socketserver test_startfile test_sunaudiodev test_timeout\n    test_tk test_ttk_guionly test_urllib2net test_urllibnet\n    test_winreg test_winsound test_zipfile64\n5 skips unexpected on darwin:\n    test_aepack test_applesingle test_macos test_scriptpackages\n    test_ttk_guionly\n```\n\nI would agree that it is surprising that `test_macos` would be skipped on ... Mac OS.  Anyway, no surprises.\n\n----\n\nIt would be nice to have documented here (and/or in SPKG.txt or something) exactly why we think each of them are okay to skip.",
    "created_at": "2012-01-19T02:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12149#issuecomment-141394",
    "user": "@kcrisman"
}
```

Here's the report on OS X 10.4 PPC.

```
2 tests failed:
    test_ctypes test_distutils
37 tests skipped:
    test_aepack test_al test_applesingle test_bsddb test_bsddb3
    test_cd test_cl test_codecmaps_cn test_codecmaps_hk
    test_codecmaps_jp test_codecmaps_kr test_codecmaps_tw test_curses
    test_epoll test_gdb test_gdbm test_gl test_imgfile test_largefile
    test_linuxaudiodev test_macos test_macostools test_msilib
    test_ossaudiodev test_scriptpackages test_smtpnet
    test_socketserver test_startfile test_sunaudiodev test_timeout
    test_tk test_ttk_guionly test_urllib2net test_urllibnet
    test_winreg test_winsound test_zipfile64
5 skips unexpected on darwin:
    test_aepack test_applesingle test_macos test_scriptpackages
    test_ttk_guionly
```

I would agree that it is surprising that `test_macos` would be skipped on ... Mac OS.  Anyway, no surprises.

----

It would be nice to have documented here (and/or in SPKG.txt or something) exactly why we think each of them are okay to skip.



---

archive/issue_comments_141395.json:
```json
{
    "body": "Replying to [comment:1 jdemeyer]:\n> Let me point out the obvious: whatever you do on this ticket should of course be based on Python 2.7.2 at #9958.\n\nThanks! I'll be sure to work with that.\n\nReplying to [comment:4 kcrisman]:\n> It would be nice to have documented here (and/or in SPKG.txt or something) exactly why we think each of them are okay to skip. \n\nYes, we should definitely document the reasoning in SPKG.txt.",
    "created_at": "2012-01-19T04:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12149#issuecomment-141395",
    "user": "@dandrake"
}
```

Replying to [comment:1 jdemeyer]:
> Let me point out the obvious: whatever you do on this ticket should of course be based on Python 2.7.2 at #9958.

Thanks! I'll be sure to work with that.

Replying to [comment:4 kcrisman]:
> It would be nice to have documented here (and/or in SPKG.txt or something) exactly why we think each of them are okay to skip. 

Yes, we should definitely document the reasoning in SPKG.txt.



---

archive/issue_comments_141396.json:
```json
{
    "body": "See also #12579: this ticket disables Python's self-tests. Assuming that ticket gets merged: first, when testing this ticket, make sure to set `SAGE_CHECK_PACKAGES` to something nonempty to override the default setting of `!python`, which disables Python's tests.  Second, when we are ready to merge this ticket, we should stop disabling the running of Python's self-tests.",
    "created_at": "2012-02-27T05:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12149#issuecomment-141396",
    "user": "@jhpalmieri"
}
```

See also #12579: this ticket disables Python's self-tests. Assuming that ticket gets merged: first, when testing this ticket, make sure to set `SAGE_CHECK_PACKAGES` to something nonempty to override the default setting of `!python`, which disables Python's tests.  Second, when we are ready to merge this ticket, we should stop disabling the running of Python's self-tests.



---

archive/issue_comments_141397.json:
```json
{
    "body": "There is also a comment in the top-level Sage README.txt which needs to be changed when we get Python's self tests to work.",
    "created_at": "2012-02-27T05:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12149#issuecomment-141397",
    "user": "@jhpalmieri"
}
```

There is also a comment in the top-level Sage README.txt which needs to be changed when we get Python's self tests to work.



---

archive/issue_comments_141398.json:
```json
{
    "body": "Regarding #12579 and skipping Python's test suite: with the patch at #12613, you can run `sage -i -c python...` and the `-c` forces the test suite to be run. So (if #12613 is merged) testing Python spkgs from this ticket won't be too inconvenient.",
    "created_at": "2012-02-29T21:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12149#issuecomment-141398",
    "user": "@jhpalmieri"
}
```

Regarding #12579 and skipping Python's test suite: with the patch at #12613, you can run `sage -i -c python...` and the `-c` forces the test suite to be run. So (if #12613 is merged) testing Python spkgs from this ticket won't be too inconvenient.



---

archive/issue_comments_141399.json:
```json
{
    "body": "Changing assignee from mvngu to GeorgSWeber.",
    "created_at": "2013-03-28T23:09:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12149#issuecomment-141399",
    "user": "@roed314"
}
```

Changing assignee from mvngu to GeorgSWeber.



---

archive/issue_comments_141400.json:
```json
{
    "body": "Changing component from doctest to build.",
    "created_at": "2013-03-28T23:09:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12149",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12149#issuecomment-141400",
    "user": "@roed314"
}
```

Changing component from doctest to build.
