# Issue 21133: Multigraph plot and error with edge_colors

archive/issues_021133.json:
```json
{
    "body": "CC:  @paulmasson\n\nThis shows third edge:\n\n\n```\ng = Graph(); g.allow_multiple_edges(True)\ng.add_edge(0, 1); g.add_edge(0, 1)\ng.show(edge_colors={'red': [(0, 1)]})\n```\n\n\nIt is propably my error in some former ticket.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21370\n\n",
    "created_at": "2016-08-30T09:25:07Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Multigraph plot and error with edge_colors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21133",
    "user": "https://github.com/jm58660"
}
```
CC:  @paulmasson

This shows third edge:


```
g = Graph(); g.allow_multiple_edges(True)
g.add_edge(0, 1); g.add_edge(0, 1)
g.show(edge_colors={'red': [(0, 1)]})
```


It is propably my error in some former ticket.

Issue created by migration from https://trac.sagemath.org/ticket/21370





---

archive/issue_comments_292483.json:
```json
{
    "body": "Jori, it wasn't your doing: bad indentation from 2009. This should fix the problem.\n----\nNew commits:",
    "created_at": "2016-08-30T23:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292483",
    "user": "https://github.com/paulmasson"
}
```

Jori, it wasn't your doing: bad indentation from 2009. This should fix the problem.
----
New commits:



---

archive/issue_comments_292484.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-30T23:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292484",
    "user": "https://github.com/paulmasson"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_292485.json:
```json
{
    "body": "Replying to [comment:2 paulmasson]:\n>This should fix the problem.\n\nIt does, and I can give it a positive review if you want. However, there is another bug, see direction of arrows:\n\n\n```\ng = DiGraph(); g.allow_multiple_edges(True)\ng.add_edge(0, 1); g.add_edge(1, 0)\ng.show(edge_colors={'red': [(0, 1)]})\ng.show()\n```\n\n\nAfter your patch this will become a one arrow only, so there is bug in both with and without this patch. Do you want to look at that, or want me to make that another ticket?",
    "created_at": "2016-08-31T05:09:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292485",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:2 paulmasson]:
>This should fix the problem.

It does, and I can give it a positive review if you want. However, there is another bug, see direction of arrows:


```
g = DiGraph(); g.allow_multiple_edges(True)
g.add_edge(0, 1); g.add_edge(1, 0)
g.show(edge_colors={'red': [(0, 1)]})
g.show()
```


After your patch this will become a one arrow only, so there is bug in both with and without this patch. Do you want to look at that, or want me to make that another ticket?



---

archive/issue_comments_292486.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-31T21:49:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292486",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_292487.json:
```json
{
    "body": "The additional error you identified arises because currently unspecificed edges are first sorted by vertex and then tested against specified edges by edge label. If there are no edge labels then unspecified edges with the same vertices as those already specified will be ignored.\n\nI replaced the test by labels with a test against an explicit list of edges already drawn. That should be more robust, but please test it in all the ways you can imagine.\n\nI've also taken out the code you put in for #21053 because the default edge color is always available from the default options. This makes the code more consistent.",
    "created_at": "2016-08-31T22:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292487",
    "user": "https://github.com/paulmasson"
}
```

The additional error you identified arises because currently unspecificed edges are first sorted by vertex and then tested against specified edges by edge label. If there are no edge labels then unspecified edges with the same vertices as those already specified will be ignored.

I replaced the test by labels with a test against an explicit list of edges already drawn. That should be more robust, but please test it in all the ways you can imagine.

I've also taken out the code you put in for #21053 because the default edge color is always available from the default options. This makes the code more consistent.



---

archive/issue_comments_292488.json:
```json
{
    "body": "Now this fails:\n\n\n```\ng = DiGraph();\ng.add_edge(0, 1); g.add_edge(1, 0)\ng.show(edge_colors={'red': [(0, 1)]})\n```\n\n\nIt works with `g.allow_multiple_edges(True)`.\n\nI can try to get more failing examples today.",
    "created_at": "2016-09-01T03:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292488",
    "user": "https://github.com/jm58660"
}
```

Now this fails:


```
g = DiGraph();
g.add_edge(0, 1); g.add_edge(1, 0)
g.show(edge_colors={'red': [(0, 1)]})
```


It works with `g.allow_multiple_edges(True)`.

I can try to get more failing examples today.



---

archive/issue_comments_292489.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-04T00:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292489",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_292490.json:
```json
{
    "body": "Jori, try testing this update please. The last error was caused because the value returned by `self._graph.edge_label` on line 634(old)/641(new) changes depending on whether `allow_multiple_edges()` is true or false.\n\nTo clean up the code I've added the method `append_or_set()`, since the same test against `edges_to_draw[]` occurs five times.",
    "created_at": "2016-09-04T00:39:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292490",
    "user": "https://github.com/paulmasson"
}
```

Jori, try testing this update please. The last error was caused because the value returned by `self._graph.edge_label` on line 634(old)/641(new) changes depending on whether `allow_multiple_edges()` is true or false.

To clean up the code I've added the method `append_or_set()`, since the same test against `edges_to_draw[]` occurs five times.



---

archive/issue_comments_292491.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-04T01:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292491",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_292492.json:
```json
{
    "body": "There is an example in #21368 that was not covered by the last commit. It should be covered now.",
    "created_at": "2016-09-04T01:15:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292492",
    "user": "https://github.com/paulmasson"
}
```

There is an example in #21368 that was not covered by the last commit. It should be covered now.



---

archive/issue_comments_292493.json:
```json
{
    "body": "Fails with\n\n\n```\nx = 101; y = 102\ng = DiGraph(multiedges=True)\ng.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); \ng.show(edge_colors={'red': [(0, 1, x)]})\n```\n",
    "created_at": "2016-09-05T08:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292493",
    "user": "https://github.com/jm58660"
}
```

Fails with


```
x = 101; y = 102
g = DiGraph(multiedges=True)
g.add_edge(0, 1, x); g.add_edge(0, 1, x); g.add_edge(0, 1, y); 
g.show(edge_colors={'red': [(0, 1, x)]})
```




---

archive/issue_comments_292494.json:
```json
{
    "body": "However, this patch seems to correct some bugs. So, if you want, I can check the patch so you can open another ticket for remaining bugs.",
    "created_at": "2016-09-05T09:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292494",
    "user": "https://github.com/jm58660"
}
```

However, this patch seems to correct some bugs. So, if you want, I can check the patch so you can open another ticket for remaining bugs.



---

archive/issue_comments_292495.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-09T01:12:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292495",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_292496.json:
```json
{
    "body": "That should cover the latest failing case. Any others?",
    "created_at": "2016-09-09T01:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292496",
    "user": "https://github.com/paulmasson"
}
```

That should cover the latest failing case. Any others?



---

archive/issue_comments_292497.json:
```json
{
    "body": "It gets harder to found bugs in every round, so I guess this will converge to bug-free code. `:=)`. But should this still be seen as a bug:\n\n\n```\ng = DiGraph(loops=True)\ng.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)\ng.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})\n```\n\n\nIt kind of makes no sense to color edge by label when `multiedges=False`, but then, why not? If someone wants to show in red exactly the edge from `1` to `2` with label `3`, if there exists one.\n\nBut as said, I can stop this for now and check the code if you want. This corrects many bugs, thanks for that!",
    "created_at": "2016-09-09T07:14:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292497",
    "user": "https://github.com/jm58660"
}
```

It gets harder to found bugs in every round, so I guess this will converge to bug-free code. `:=)`. But should this still be seen as a bug:


```
g = DiGraph(loops=True)
g.add_edge(0, 1); g.add_edge(0, 2); g.add_edge(0, 0)
g.show(edge_colors={'red': [(0, 1)], 'blue': [(0, 2, 'xxx')]})
```


It kind of makes no sense to color edge by label when `multiedges=False`, but then, why not? If someone wants to show in red exactly the edge from `1` to `2` with label `3`, if there exists one.

But as said, I can stop this for now and check the code if you want. This corrects many bugs, thanks for that!



---

archive/issue_comments_292498.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-09T21:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292498",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_292499.json:
```json
{
    "body": "Fixed! Anything else?",
    "created_at": "2016-09-09T21:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292499",
    "user": "https://github.com/paulmasson"
}
```

Fixed! Anything else?



---

archive/issue_comments_292500.json:
```json
{
    "body": "Replying to [comment:17 paulmasson]:\n> Fixed! Anything else?\n\nI tried quite hard to found more errors on colors, but did not found any. I tested with and without loops, with and wihtout multiple edges, and with some options to `edge_colors`, `edge_style` and even `vertex_size`, `graph_border` and so on.\n\nSo I suppose this if perfect now. Next I'll try to understand the code. Thanks!",
    "created_at": "2016-09-10T06:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292500",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:17 paulmasson]:
> Fixed! Anything else?

I tried quite hard to found more errors on colors, but did not found any. I tested with and without loops, with and wihtout multiple edges, and with some options to `edge_colors`, `edge_style` and even `vertex_size`, `graph_border` and so on.

So I suppose this if perfect now. Next I'll try to understand the code. Thanks!



---

archive/issue_comments_292501.json:
```json
{
    "body": "OK, I mark this as positive review.\n\nI can not say that I understand every bit of the code, but it seems reasonable, I did not found errors by testing, and possible bugs won't affect other parts of Sage.",
    "created_at": "2016-09-11T05:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292501",
    "user": "https://github.com/jm58660"
}
```

OK, I mark this as positive review.

I can not say that I understand every bit of the code, but it seems reasonable, I did not found errors by testing, and possible bugs won't affect other parts of Sage.



---

archive/issue_comments_292502.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-11T05:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292502",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_292503.json:
```json
{
    "body": "patchbot is not happy at all..",
    "created_at": "2016-09-11T20:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292503",
    "user": "https://github.com/fchapoton"
}
```

patchbot is not happy at all..



---

archive/issue_comments_292504.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-09-11T20:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292504",
    "user": "https://github.com/paulmasson"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_292505.json:
```json
{
    "body": "I'm seeing failed doctests in patchbot logs. Does anything other than that need to be addressed?",
    "created_at": "2016-09-11T20:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292505",
    "user": "https://github.com/paulmasson"
}
```

I'm seeing failed doctests in patchbot logs. Does anything other than that need to be addressed?



---

archive/issue_comments_292506.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-12T00:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292506",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_292507.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-09-12T00:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292507",
    "user": "https://github.com/paulmasson"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_292508.json:
```json
{
    "body": "Doctests should all be fixed. Jori, please test the examples in the previously failing doctests.",
    "created_at": "2016-09-12T00:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292508",
    "user": "https://github.com/paulmasson"
}
```

Doctests should all be fixed. Jori, please test the examples in the previously failing doctests.



---

archive/issue_comments_292509.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-12T05:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292509",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_292510.json:
```json
{
    "body": "Doctests passed.",
    "created_at": "2016-09-12T05:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292510",
    "user": "https://github.com/jm58660"
}
```

Doctests passed.



---

archive/issue_comments_292511.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-09-16T06:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21133#issuecomment-292511",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_020013.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2016-09-16T06:55:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21133",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21133#event-20013"
}
```
