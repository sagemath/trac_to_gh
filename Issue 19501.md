# Issue 19501: inconsistency in what simplify() does on trigonometrics expression

archive/issues_019501.json:
```json
{
    "body": "CC:  zimmerma\n\nI stumbled on the following oddity during an exercise class (sage-6.8, x86_64-linux, debian 8.2).\n\n```\nsage: simplify(cos(pi/12))\n1/12*sqrt(6)*(sqrt(3) + 3)\nsage: simplify(sin(pi/12))\n-1/12*sqrt(6)*(sqrt(3) - 3)\nsage: simplify(exp(i*pi/12))\ne^(1/12*I*pi)\n```\n\nIs there any rationale for this ? It looks like an inconsistency.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19738\n\n",
    "created_at": "2015-12-17T14:32:14Z",
    "labels": [
        "symbolics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "inconsistency in what simplify() does on trigonometrics expression",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19501",
    "user": "thome"
}
```
CC:  zimmerma

I stumbled on the following oddity during an exercise class (sage-6.8, x86_64-linux, debian 8.2).

```
sage: simplify(cos(pi/12))
1/12*sqrt(6)*(sqrt(3) + 3)
sage: simplify(sin(pi/12))
-1/12*sqrt(6)*(sqrt(3) - 3)
sage: simplify(exp(i*pi/12))
e^(1/12*I*pi)
```

Is there any rationale for this ? It looks like an inconsistency.

Issue created by migration from https://trac.sagemath.org/ticket/19738





---

archive/issue_comments_267936.json:
```json
{
    "body": "still the same in Sage 6.9.",
    "created_at": "2015-12-17T18:27:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19501#issuecomment-267936",
    "user": "zimmerma"
}
```

still the same in Sage 6.9.



---

archive/issue_comments_267937.json:
```json
{
    "body": "Note expansion is done without the need for simplify.\n\nCertainly the enhancement is within reach. There is a minor catch: although shortly before we have extended the values `m` for which `sin/cos/tan(n/m*pi)` is expanded in roots, simply doing `I*sin+cos` can result in mixed expressions because implementations differed for `sin` vs `cos`, e.g.\n\n```\nsage: sin(pi/15)\nsin(1/15*pi)\nsage: cos(pi/15)\n1/8*sqrt(5) + 1/4*sqrt(3/2*sqrt(5) + 15/2) - 1/8\nsage: I*sin(pi/15)+cos(pi/15)\n1/8*sqrt(5) + 1/4*sqrt(3/2*sqrt(5) + 15/2) + I*sin(1/15*pi) - 1/8\n```\n\nThe reason for the difference was the complexity of results---we stopped when the roots were nested more than twice.",
    "created_at": "2015-12-27T14:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19501#issuecomment-267937",
    "user": "rws"
}
```

Note expansion is done without the need for simplify.

Certainly the enhancement is within reach. There is a minor catch: although shortly before we have extended the values `m` for which `sin/cos/tan(n/m*pi)` is expanded in roots, simply doing `I*sin+cos` can result in mixed expressions because implementations differed for `sin` vs `cos`, e.g.

```
sage: sin(pi/15)
sin(1/15*pi)
sage: cos(pi/15)
1/8*sqrt(5) + 1/4*sqrt(3/2*sqrt(5) + 15/2) - 1/8
sage: I*sin(pi/15)+cos(pi/15)
1/8*sqrt(5) + 1/4*sqrt(3/2*sqrt(5) + 15/2) + I*sin(1/15*pi) - 1/8
```

The reason for the difference was the complexity of results---we stopped when the roots were nested more than twice.



---

archive/issue_comments_267938.json:
```json
{
    "body": "This is fixed in pynac git master now and will come to Sage with the next upgrade (0.5.4).",
    "created_at": "2015-12-27T15:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19501#issuecomment-267938",
    "user": "rws"
}
```

This is fixed in pynac git master now and will come to Sage with the next upgrade (0.5.4).



---

archive/issue_comments_267939.json:
```json
{
    "body": "However, do you want this?\n\n```\nFile \"src/sage/symbolic/expression.pyx\", line 10262, in sage.symbolic.expression.Expression.solve\nFailed example:\n    (z^5 - 1).solve(z)\nExpected:\n    [z == e^(2/5*I*pi), z == e^(4/5*I*pi), z == e^(-4/5*I*pi), z == e^(-2/5*I*pi), z == 1]\nGot:\n    [z == 1/4*sqrt(5) + 1/4*I*sqrt(2*sqrt(5) + 10) - 1/4, z == -1/4*sqrt(5) + 1/4*I*sqrt(-2*sqrt(5) + 10) - 1/4, z == -1/4*sqrt(5) - 1/4*I*sqrt(-2*sqrt(5) + 10) - 1/4, z == 1/4*sqrt(5) - 1/4*I*sqrt(2*sqrt(5) + 10) - 1/4, z == 1]\n```\n",
    "created_at": "2015-12-28T08:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19501#issuecomment-267939",
    "user": "rws"
}
```

However, do you want this?

```
File "src/sage/symbolic/expression.pyx", line 10262, in sage.symbolic.expression.Expression.solve
Failed example:
    (z^5 - 1).solve(z)
Expected:
    [z == e^(2/5*I*pi), z == e^(4/5*I*pi), z == e^(-4/5*I*pi), z == e^(-2/5*I*pi), z == 1]
Got:
    [z == 1/4*sqrt(5) + 1/4*I*sqrt(2*sqrt(5) + 10) - 1/4, z == -1/4*sqrt(5) + 1/4*I*sqrt(-2*sqrt(5) + 10) - 1/4, z == -1/4*sqrt(5) - 1/4*I*sqrt(-2*sqrt(5) + 10) - 1/4, z == 1/4*sqrt(5) - 1/4*I*sqrt(2*sqrt(5) + 10) - 1/4, z == 1]
```




---

archive/issue_comments_267940.json:
```json
{
    "body": "> However, do you want this?\n\nyes, this looks coherent with the rationale \"we stopped when the roots were nested more than twice\" above.\n\nPaul",
    "created_at": "2016-01-06T17:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19501#issuecomment-267940",
    "user": "zimmerma"
}
```

> However, do you want this?

yes, this looks coherent with the rationale "we stopped when the roots were nested more than twice" above.

Paul



---

archive/issue_comments_267941.json:
```json
{
    "body": "Fixed by update to Pynac 0.6.0 at #19819?",
    "created_at": "2016-01-13T09:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19501#issuecomment-267941",
    "user": "slelievre"
}
```

Fixed by update to Pynac 0.6.0 at #19819?



---

archive/issue_comments_267942.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-01-18T07:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19501#issuecomment-267942",
    "user": "rws"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_267943.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-01-18T07:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19501#issuecomment-267943",
    "user": "rws"
}
```

New commits:



---

archive/issue_comments_267944.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-01-18T09:11:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19501#issuecomment-267944",
    "user": "zimmerma"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_267945.json:
```json
{
    "body": "looks good to me.\nPaul",
    "created_at": "2016-01-18T09:11:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19501#issuecomment-267945",
    "user": "zimmerma"
}
```

looks good to me.
Paul



---

archive/issue_comments_267946.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-01-20T10:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19501#issuecomment-267946",
    "user": "vbraun"
}
```

Resolution: fixed
