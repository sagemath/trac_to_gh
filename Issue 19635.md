# Issue 19635: regular symmetric Hadamard matrices for n=324

archive/issues_019635.json:
```json
{
    "body": "CC:  @nathanncohen\n\nImplements the construction from \n\nZ.Janko, H.Kharaghani, V.D.Tonchev, The existence of a Bush-type Hadamard matrix of order 324\nand two new infinite classes of symmetric designs. Des. Codes Cryptogr. 24(2001), 225-232\n\nand use it's RSHCD of '+' type to build an srg on v=324, k=153. Also, use it to construct an RSHCD of '-' type and build an srg on v=324, k=152.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19872\n\n",
    "created_at": "2016-01-12T14:01:19Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "regular symmetric Hadamard matrices for n=324",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19635",
    "user": "https://github.com/dimpase"
}
```
CC:  @nathanncohen

Implements the construction from 

Z.Janko, H.Kharaghani, V.D.Tonchev, The existence of a Bush-type Hadamard matrix of order 324
and two new infinite classes of symmetric designs. Des. Codes Cryptogr. 24(2001), 225-232

and use it's RSHCD of '+' type to build an srg on v=324, k=153. Also, use it to construct an RSHCD of '-' type and build an srg on v=324, k=152.

Issue created by migration from https://trac.sagemath.org/ticket/19872





---

archive/issue_comments_269510.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-01-12T14:07:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269510",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_269511.json:
```json
{
    "body": "(I guess you intended this dependency as your branch contains a commit from this other ticket)",
    "created_at": "2016-01-12T17:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269511",
    "user": "https://github.com/nathanncohen"
}
```

(I guess you intended this dependency as your branch contains a commit from this other ticket)



---

archive/issue_comments_269512.json:
```json
{
    "body": "Should this ticket be in `needs_review`?\n\nWhat would you think of moving your code to a new function? I understand that it seems a bit silly considering that the code is 10 lines long, but that would give you a proper place to add your doc. As it is, it feels a bit weird to have a lengthy explanation of how this specific RSHCD is built when there is none for the others.\n\nNathann",
    "created_at": "2016-01-12T17:06:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269512",
    "user": "https://github.com/nathanncohen"
}
```

Should this ticket be in `needs_review`?

What would you think of moving your code to a new function? I understand that it seems a bit silly considering that the code is 10 lines long, but that would give you a proper place to add your doc. As it is, it feels a bit weird to have a lengthy explanation of how this specific RSHCD is built when there is none for the others.

Nathann



---

archive/issue_comments_269513.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-01-12T19:13:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269513",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_269514.json:
```json
{
    "body": "Replying to [comment:3 ncohen]:\n> Should this ticket be in `needs_review`?\n> \n> What would you think of moving your code to a new function? I understand that it seems a bit silly considering that the code is 10 lines long, but that would give you a proper place to add your doc. As it is, it feels a bit weird to have a lengthy explanation of how this specific RSHCD is built when there is none for the others.\n\nas you please. We will also write a bit about it in our preprint.\nIt's a nice addition...",
    "created_at": "2016-01-12T19:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269514",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:3 ncohen]:
> Should this ticket be in `needs_review`?
> 
> What would you think of moving your code to a new function? I understand that it seems a bit silly considering that the code is 10 lines long, but that would give you a proper place to add your doc. As it is, it feels a bit weird to have a lengthy explanation of how this specific RSHCD is built when there is none for the others.

as you please. We will also write a bit about it in our preprint.
It's a nice addition...



---

archive/issue_comments_269515.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-12T20:01:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269515",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_269516.json:
```json
{
    "body": "done. \ntnx to First Great Western trains for free wifi :-)",
    "created_at": "2016-01-12T20:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269516",
    "user": "https://github.com/dimpase"
}
```

done. 
tnx to First Great Western trains for free wifi :-)



---

archive/issue_comments_269517.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-01-13T12:54:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269517",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_269518.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-14T08:26:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269518",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_269519.json:
```json
{
    "body": "I went over your branch and I agree with it. I added a small commit with a fix for a broken link and a couple of unimportant things. If you agree with it, you can change the ticket's status. Thanks for those graphs !!!\n\nNathann",
    "created_at": "2016-01-14T08:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269519",
    "user": "https://github.com/nathanncohen"
}
```

I went over your branch and I agree with it. I added a small commit with a fix for a broken link and a couple of unimportant things. If you agree with it, you can change the ticket's status. Thanks for those graphs !!!

Nathann



---

archive/issue_comments_269520.json:
```json
{
    "body": "I'm working on speeding it up. Already using libgap gives a 3-fold speedup...\n\n```\ndiff --git a/src/sage/graphs/generators/smallgraphs.py b/src/sage/graphs/generators/smallgraphs\nindex 8ea232d..840c346 100644\n--- a/src/sage/graphs/generators/smallgraphs.py\n+++ b/src/sage/graphs/generators/smallgraphs.py\n@@ -4941,7 +4941,7 @@ def JankoKharaghaniTonchevGraph():\n \n     EXAMPLES::\n \n-        sage: Gamma=graphs.JankoKharaghaniTonchevGraph()  # long time\n+        sage: Gamma=graphs.JankoKharaghaniTonchevGraph()  # long time (14 sec)\n         sage: Gamma.is_strongly_regular(parameters=True)  # long time\n         (324, 153, 72, 72)\n \n@@ -4956,7 +4956,7 @@ def JankoKharaghaniTonchevGraph():\n     from itertools import product\n     from sage.misc.misc_c import prod\n     from sage.combinat.permutation import Permutation as P\n-    from sage.groups.perm_gps.permgroup import PermutationGroup\n+    from sage.libs.gap.libgap import libgap\n \n     m1=prod([P((9*x+k,9*x+k+3,9*x+k+6)) for k,x in product(xrange(1,4),xrange(36))])\n     m2=prod([P((3*x+1,3*x+2,3*x+3)) for x in xrange(108)])\n@@ -4975,7 +4975,7 @@ def JankoKharaghaniTonchevGraph():\n                 (18*x+4,18*x+13),(18*x+5,18*x+14),(18*x+6,18*x+15),(18*x+7,18*x+16),\n                 (18*x+8,18*x+17),(18*x+9,18*x+18)]))\n                  for x in xrange(18))\n-    G=PermutationGroup([m1,m2,t,n1,n2,s,k])\n+    G=libgap.Group(map(lambda p: libgap.PermList(p), [m1,m2,t,n1,n2,s,k]))\n     B1=(19,22,25,29,30,31,33,34,35,37,40,43,47,48,49,51,52,53,55,56,57,65,\n         66,67,68,70,72,76,77,78,79,80,81,82,86,90,92,93,95,96,98,99,100,105,107,\n         109,110,111,119,120,121,122,124,126,128,129,131,132,134,135,136,141,143,\n@@ -4995,6 +4995,6 @@ def JankoKharaghaniTonchevGraph():\n     Gamma=Graph(multiedges=False,name='Janko-Kharaghani-Tonchev')\n     for i,b in ((1,B1),(163,B163)):\n         for j in b:\n-            Gamma.add_edges(map(tuple,G.orbit((i,j),action=\"OnSets\")))\n+            Gamma.add_edges(map(tuple,G.Orbit(libgap.Set([i,j]), libgap.OnSets)))\n     Gamma.relabel()\n     return Gamma\n```\n",
    "created_at": "2016-01-14T10:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269520",
    "user": "https://github.com/dimpase"
}
```

I'm working on speeding it up. Already using libgap gives a 3-fold speedup...

```
diff --git a/src/sage/graphs/generators/smallgraphs.py b/src/sage/graphs/generators/smallgraphs
index 8ea232d..840c346 100644
--- a/src/sage/graphs/generators/smallgraphs.py
+++ b/src/sage/graphs/generators/smallgraphs.py
@@ -4941,7 +4941,7 @@ def JankoKharaghaniTonchevGraph():
 
     EXAMPLES::
 
-        sage: Gamma=graphs.JankoKharaghaniTonchevGraph()  # long time
+        sage: Gamma=graphs.JankoKharaghaniTonchevGraph()  # long time (14 sec)
         sage: Gamma.is_strongly_regular(parameters=True)  # long time
         (324, 153, 72, 72)
 
@@ -4956,7 +4956,7 @@ def JankoKharaghaniTonchevGraph():
     from itertools import product
     from sage.misc.misc_c import prod
     from sage.combinat.permutation import Permutation as P
-    from sage.groups.perm_gps.permgroup import PermutationGroup
+    from sage.libs.gap.libgap import libgap
 
     m1=prod([P((9*x+k,9*x+k+3,9*x+k+6)) for k,x in product(xrange(1,4),xrange(36))])
     m2=prod([P((3*x+1,3*x+2,3*x+3)) for x in xrange(108)])
@@ -4975,7 +4975,7 @@ def JankoKharaghaniTonchevGraph():
                 (18*x+4,18*x+13),(18*x+5,18*x+14),(18*x+6,18*x+15),(18*x+7,18*x+16),
                 (18*x+8,18*x+17),(18*x+9,18*x+18)]))
                  for x in xrange(18))
-    G=PermutationGroup([m1,m2,t,n1,n2,s,k])
+    G=libgap.Group(map(lambda p: libgap.PermList(p), [m1,m2,t,n1,n2,s,k]))
     B1=(19,22,25,29,30,31,33,34,35,37,40,43,47,48,49,51,52,53,55,56,57,65,
         66,67,68,70,72,76,77,78,79,80,81,82,86,90,92,93,95,96,98,99,100,105,107,
         109,110,111,119,120,121,122,124,126,128,129,131,132,134,135,136,141,143,
@@ -4995,6 +4995,6 @@ def JankoKharaghaniTonchevGraph():
     Gamma=Graph(multiedges=False,name='Janko-Kharaghani-Tonchev')
     for i,b in ((1,B1),(163,B163)):
         for j in b:
-            Gamma.add_edges(map(tuple,G.orbit((i,j),action="OnSets")))
+            Gamma.add_edges(map(tuple,G.Orbit(libgap.Set([i,j]), libgap.OnSets)))
     Gamma.relabel()
     return Gamma
```




---

archive/issue_comments_269521.json:
```json
{
    "body": "hmm:\n\n```\n$ git pull trac public/JKandJKT\nfatal: unable to connect to trac.sagemath.org:\ntrac.sagemath.org[0: 128.208.160.253]: errno=Connection refused\n```\n",
    "created_at": "2016-01-14T10:28:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269521",
    "user": "https://github.com/dimpase"
}
```

hmm:

```
$ git pull trac public/JKandJKT
fatal: unable to connect to trac.sagemath.org:
trac.sagemath.org[0: 128.208.160.253]: errno=Connection refused
```




---

archive/issue_comments_269522.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-14T11:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269522",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_269523.json:
```json
{
    "body": "Hope you like my last commit - otherwise I'm happy with the ticket; please set it positive review then!",
    "created_at": "2016-01-14T11:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269523",
    "user": "https://github.com/dimpase"
}
```

Hope you like my last commit - otherwise I'm happy with the ticket; please set it positive review then!



---

archive/issue_comments_269524.json:
```json
{
    "body": "Dima: in Python a call to 'map' creates a new list in memory. Do you understand of painful that makes it to read changes like that?\n\n```\n-        for j in b:\n+        for j in map(lambda x: x[0], st.OrbitsDomain(b)):\n```\n\nA new list in memory only because you want j[0] instead of j?...\n\nOf course we don't care, or course it's totally negligible, but what the hell. Don'you want to write Python code instead of badly translating GAP code into Python?..\n\nNathann",
    "created_at": "2016-01-14T12:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269524",
    "user": "https://github.com/nathanncohen"
}
```

Dima: in Python a call to 'map' creates a new list in memory. Do you understand of painful that makes it to read changes like that?

```
-        for j in b:
+        for j in map(lambda x: x[0], st.OrbitsDomain(b)):
```

A new list in memory only because you want j[0] instead of j?...

Of course we don't care, or course it's totally negligible, but what the hell. Don'you want to write Python code instead of badly translating GAP code into Python?..

Nathann



---

archive/issue_comments_269525.json:
```json
{
    "body": "Anyway.\n\nDid you try to figure out where was the loss of time coming from? I don't see Sage ever improving if you switch to using GAP directly whenever Sage's interface is too slow.\n\nNathann",
    "created_at": "2016-01-14T12:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269525",
    "user": "https://github.com/nathanncohen"
}
```

Anyway.

Did you try to figure out where was the loss of time coming from? I don't see Sage ever improving if you switch to using GAP directly whenever Sage's interface is too slow.

Nathann



---

archive/issue_comments_269526.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-01-14T12:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269526",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_269527.json:
```json
{
    "body": "Replying to [comment:15 ncohen]:\n> Dima: in Python a call to 'map' creates a new list in memory. Do you understand of painful that makes it to read changes like that?\n> {{{\n> -        for j in b:\n> +        for j in map(lambda x: x[0], st.OrbitsDomain(b)):\n> }}}\n> A new list in memory only because you want j[0] instead of j?...\n\nno, it's actually two changes; say, if `st` was a Sage `PermutationGroup` it would be\n\n```\n-        for j in b:\n+        for j in map(lambda x: x[0], st.orbits(b)):\n```\n\nto discard taking representatives of the same orbit of `st` (a 3 to 4-fold speedup), and then the translation to libGAP (another 3-fold speedup) is \n\n```\n-        for j in map(lambda x: x[0], st.orbits(b)):\n+        for j in map(lambda x: x[0], st.OrbitsDomain(b)):\n```\n\nOK, I should have used `imap`.",
    "created_at": "2016-01-14T13:39:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269527",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:15 ncohen]:
> Dima: in Python a call to 'map' creates a new list in memory. Do you understand of painful that makes it to read changes like that?
> {{{
> -        for j in b:
> +        for j in map(lambda x: x[0], st.OrbitsDomain(b)):
> }}}
> A new list in memory only because you want j[0] instead of j?...

no, it's actually two changes; say, if `st` was a Sage `PermutationGroup` it would be

```
-        for j in b:
+        for j in map(lambda x: x[0], st.orbits(b)):
```

to discard taking representatives of the same orbit of `st` (a 3 to 4-fold speedup), and then the translation to libGAP (another 3-fold speedup) is 

```
-        for j in map(lambda x: x[0], st.orbits(b)):
+        for j in map(lambda x: x[0], st.OrbitsDomain(b)):
```

OK, I should have used `imap`.



---

archive/issue_comments_269528.json:
```json
{
    "body": "Replying to [comment:16 ncohen]:\n> Did you try to figure out where was the loss of time coming from? I don't see Sage ever improving if you switch to using GAP directly whenever Sage's interface is too slow.\n\nWell, in both cases, it uses GAP, only when one uses libGAP the data goes back and forth much faster, a 3-fold speedup (apart from pipes, it's conversion to/from strings from/to lists of integers that is not needed when libGAP is used). Sage will improve when a fuller switch to libGAP happens...",
    "created_at": "2016-01-14T13:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269528",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:16 ncohen]:
> Did you try to figure out where was the loss of time coming from? I don't see Sage ever improving if you switch to using GAP directly whenever Sage's interface is too slow.

Well, in both cases, it uses GAP, only when one uses libGAP the data goes back and forth much faster, a 3-fold speedup (apart from pipes, it's conversion to/from strings from/to lists of integers that is not needed when libGAP is used). Sage will improve when a fuller switch to libGAP happens...



---

archive/issue_comments_269529.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-01-20T10:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269529",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_018707.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-20T10:19:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19635#event-18707"
}
```



---

archive/issue_comments_269530.json:
```json
{
    "body": "Coooooool... `:-P`",
    "created_at": "2016-01-20T15:59:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19635#issuecomment-269530",
    "user": "https://github.com/nathanncohen"
}
```

Coooooool... `:-P`
