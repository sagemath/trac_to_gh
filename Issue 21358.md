# Issue 21358: Add (cross) positive operator methods for convex cones

Issue created by migration from https://trac.sagemath.org/ticket/21595

Original creator: mjo

Original creation time: 2016-09-25 22:10:18

CC:  novoselt

I've had this in the works for a while.. it's not quite finished but I'd like to begin getting review. Basically, I'm adding three new methods to compute families of operators on some given cone:

  * Positive operators (matrices that are positive with respect to the cone ordering on the space).

  * Cross-positive operators (a bigger set than the positive operators, only "positive" on orthogonal pairs).

  * Z-operators (negative cross-positive operators).

The last is obviously trivial once the second is in place. Here's what still needs work:

**Test run time**

The biggest issue is that the tests sometimes take an enormous amount of time. I think most of it is being spent constructing the cone of operators when `check=True`. When the cone is proper, I can set `check=False`, but when it is not, I can't necessarily. If the cone is a subspace, for example, then the new list of generators will contain duplicates.

If that were the only problematic case, we could just remove the duplicates, but maybe other combinations arise that require `check=True`. I'm not sure what to do about these except maybe limit those tests to small trivial cases.

**Test properties**

Most of the properties that I'm testing haven't been published yet, but the algorithms themselves should be OK. The papers containing those algorithms are still in progress, but only the nonpolyhedral case requires any work. When the cones are polyhedral (and thus closed), you can verify the algorithms in a few lines.

**Long time comments**

Once I've figured out what to do about the long-running tests, pretty much every random test needs to be marked `# long time` unless by some miracle they all become fast.


---

Comment by mjo created at 2016-09-25 22:31:02

New commits:


---

Comment by mjo created at 2016-09-25 22:31:02

Changing status from new to needs_review.


---

Comment by git created at 2016-09-27 02:58:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mjo created at 2016-09-27 03:03:26

I've just fixed the most egregious long-running tests -- I accidentally copy/pasted a call to `ZZ.random_integer()` with no bounds into a few doctests.

I've left all of the tests with `max_ambient_dim=3` for now, which seems to run quickly and predictably. I would prefer 4, but sometimes corner cases pop up, for example:


```
sage: K = Cone([ (-6, 0, -11,  0),
....:            (-2, 1, -64,  2),
....:            (-1, 2,  10,  1),
....:            ( 1, 1,   0, -1),
....:            ( 0, 0,   0, -1),
....:            (-6, 0,   0, -1) ])
sage: timeit("K.positive_operator_gens()")
5 loops, best of 3: 21.3 s per loop
```


I don't think there's any way to fix that (that example is even proper), so sticking with 3d is probably wise. I can add a few longer tests to my personal repo for the paper for good measure.


---

Comment by git created at 2016-09-27 21:03:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mjo created at 2016-09-27 21:05:18

I've cited a preprint for most of the properties that I'm testing. With that, I think I've crossed the last item off my to-do list for this patch set.


---

Comment by novoselt created at 2016-10-02 21:50:25

I am not entirely sure as a non-native speaker, but wouldn't `positive_operators_gens` be a more accurate name than `positive_operator_gens`? Since these are generators not of a single positive operator, but rather of some set (cone) of many positive operators?


---

Comment by novoselt created at 2016-10-02 21:54:57

This is a bit non-committal:

```
+        OUTPUT:
+
+        A list of `m`-by-`n` matrices where `m` is the ambient
+        dimension of ``K2`` and `n` is the ambient dimension of this
+        cone. Each matrix `P` in the list should have the property
+        that `P(x)` is an element of ``K2`` whenever `x` is an
+        element of this cone. Moreover, any nonnegative linear
+        combination of these matrices shares the same property.
```

Why "should have"? Is it not guaranteed to be the case? The fact that their combination has the same property only reflect the fact that such elements form a cone, yet it does not imply that returned elements generate that cone. Returning just a zero matrix or even an empty list would fit this description ;-)


---

Comment by novoselt created at 2016-10-02 22:06:34


```
+        TESTS:
+
+        Each positive operator should send the generators of one cone
+        into the other cone::
...
+        Each positive operator should send a random element of one cone
+        into the other cone::
...
+        A random positive operator should send the generators of one
+        cone into the other cone::
...
+        A random positive operator should send a random element of one
+        cone into the other cone::
```

While it is in general good to have more tests, I think this goes over the board: the last statement includes all previous ones and assuming that randomness works makes running those tests a waste of time.

I didn't get into the math details of the subsequent ones, but if it is the same here, i.e. that some tests follow from other ones, I think they should be removed.

Keeping tests for corner cases like trivial cones/spaces, on the other hand, is probably good since they tend to be mathematically obvious but programmatically buggy.


---

Comment by novoselt created at 2016-10-02 23:49:41

`cross_positive_operators` misses `gens`


---

Comment by git created at 2016-10-03 02:13:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by novoselt created at 2016-10-10 19:57:27

Still stands:
> I am not entirely sure as a non-native speaker, but wouldn't `positive_operators_gens` be a more accurate name than `positive_operator_gens`? Since these are generators not of a single positive operator, but rather of some set (cone) of many positive operators?

While it is tiny, it is unlikely to change once one version is merged ;-) Thanks for addressing other issues!


---

Comment by git created at 2016-10-11 13:17:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mjo created at 2016-10-11 13:19:45

Ok, I haven't had any good ideas in the meantime, so `operators_gens` it is.


---

Comment by novoselt created at 2017-01-03 01:03:56

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-01-18 20:39:36

Resolution: fixed
