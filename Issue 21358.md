# Issue 21358: Add (cross) positive operator methods for convex cones

archive/issues_021358.json:
```json
{
    "body": "CC:  @novoselt\n\nI've had this in the works for a while.. it's not quite finished but I'd like to begin getting review. Basically, I'm adding three new methods to compute families of operators on some given cone:\n\n* Positive operators (matrices that are positive with respect to the cone ordering on the space).\n\n* Cross-positive operators (a bigger set than the positive operators, only \"positive\" on orthogonal pairs).\n\n* Z-operators (negative cross-positive operators).\n\nThe last is obviously trivial once the second is in place. Here's what still needs work:\n\n**Test run time**\n\nThe biggest issue is that the tests sometimes take an enormous amount of time. I think most of it is being spent constructing the cone of operators when `check=True`. When the cone is proper, I can set `check=False`, but when it is not, I can't necessarily. If the cone is a subspace, for example, then the new list of generators will contain duplicates.\n\nIf that were the only problematic case, we could just remove the duplicates, but maybe other combinations arise that require `check=True`. I'm not sure what to do about these except maybe limit those tests to small trivial cases.\n\n**Test properties**\n\nMost of the properties that I'm testing haven't been published yet, but the algorithms themselves should be OK. The papers containing those algorithms are still in progress, but only the nonpolyhedral case requires any work. When the cones are polyhedral (and thus closed), you can verify the algorithms in a few lines.\n\n**Long time comments**\n\nOnce I've figured out what to do about the long-running tests, pretty much every random test needs to be marked `# long time` unless by some miracle they all become fast.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21595\n\n",
    "created_at": "2016-09-25T22:10:18Z",
    "labels": [
        "geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Add (cross) positive operator methods for convex cones",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21358",
    "user": "@orlitzky"
}
```
CC:  @novoselt

I've had this in the works for a while.. it's not quite finished but I'd like to begin getting review. Basically, I'm adding three new methods to compute families of operators on some given cone:

* Positive operators (matrices that are positive with respect to the cone ordering on the space).

* Cross-positive operators (a bigger set than the positive operators, only "positive" on orthogonal pairs).

* Z-operators (negative cross-positive operators).

The last is obviously trivial once the second is in place. Here's what still needs work:

**Test run time**

The biggest issue is that the tests sometimes take an enormous amount of time. I think most of it is being spent constructing the cone of operators when `check=True`. When the cone is proper, I can set `check=False`, but when it is not, I can't necessarily. If the cone is a subspace, for example, then the new list of generators will contain duplicates.

If that were the only problematic case, we could just remove the duplicates, but maybe other combinations arise that require `check=True`. I'm not sure what to do about these except maybe limit those tests to small trivial cases.

**Test properties**

Most of the properties that I'm testing haven't been published yet, but the algorithms themselves should be OK. The papers containing those algorithms are still in progress, but only the nonpolyhedral case requires any work. When the cones are polyhedral (and thus closed), you can verify the algorithms in a few lines.

**Long time comments**

Once I've figured out what to do about the long-running tests, pretty much every random test needs to be marked `# long time` unless by some miracle they all become fast.

Issue created by migration from https://trac.sagemath.org/ticket/21595





---

archive/issue_comments_296462.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-09-25T22:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21358#issuecomment-296462",
    "user": "@orlitzky"
}
```

New commits:



---

archive/issue_comments_296463.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-25T22:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21358#issuecomment-296463",
    "user": "@orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_296464.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-27T02:58:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21358#issuecomment-296464",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_296465.json:
```json
{
    "body": "I've just fixed the most egregious long-running tests -- I accidentally copy/pasted a call to `ZZ.random_integer()` with no bounds into a few doctests.\n\nI've left all of the tests with `max_ambient_dim=3` for now, which seems to run quickly and predictably. I would prefer 4, but sometimes corner cases pop up, for example:\n\n\n```\nsage: K = Cone([ (-6, 0, -11,  0),\n....:            (-2, 1, -64,  2),\n....:            (-1, 2,  10,  1),\n....:            ( 1, 1,   0, -1),\n....:            ( 0, 0,   0, -1),\n....:            (-6, 0,   0, -1) ])\nsage: timeit(\"K.positive_operator_gens()\")\n5 loops, best of 3: 21.3 s per loop\n```\n\n\nI don't think there's any way to fix that (that example is even proper), so sticking with 3d is probably wise. I can add a few longer tests to my personal repo for the paper for good measure.",
    "created_at": "2016-09-27T03:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21358#issuecomment-296465",
    "user": "@orlitzky"
}
```

I've just fixed the most egregious long-running tests -- I accidentally copy/pasted a call to `ZZ.random_integer()` with no bounds into a few doctests.

I've left all of the tests with `max_ambient_dim=3` for now, which seems to run quickly and predictably. I would prefer 4, but sometimes corner cases pop up, for example:


```
sage: K = Cone([ (-6, 0, -11,  0),
....:            (-2, 1, -64,  2),
....:            (-1, 2,  10,  1),
....:            ( 1, 1,   0, -1),
....:            ( 0, 0,   0, -1),
....:            (-6, 0,   0, -1) ])
sage: timeit("K.positive_operator_gens()")
5 loops, best of 3: 21.3 s per loop
```


I don't think there's any way to fix that (that example is even proper), so sticking with 3d is probably wise. I can add a few longer tests to my personal repo for the paper for good measure.



---

archive/issue_comments_296466.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-27T21:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21358#issuecomment-296466",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_296467.json:
```json
{
    "body": "I've cited a preprint for most of the properties that I'm testing. With that, I think I've crossed the last item off my to-do list for this patch set.",
    "created_at": "2016-09-27T21:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21358#issuecomment-296467",
    "user": "@orlitzky"
}
```

I've cited a preprint for most of the properties that I'm testing. With that, I think I've crossed the last item off my to-do list for this patch set.



---

archive/issue_comments_296468.json:
```json
{
    "body": "I am not entirely sure as a non-native speaker, but wouldn't `positive_operators_gens` be a more accurate name than `positive_operator_gens`? Since these are generators not of a single positive operator, but rather of some set (cone) of many positive operators?",
    "created_at": "2016-10-02T21:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21358#issuecomment-296468",
    "user": "@novoselt"
}
```

I am not entirely sure as a non-native speaker, but wouldn't `positive_operators_gens` be a more accurate name than `positive_operator_gens`? Since these are generators not of a single positive operator, but rather of some set (cone) of many positive operators?



---

archive/issue_comments_296469.json:
```json
{
    "body": "This is a bit non-committal:\n\n```\n+        OUTPUT:\n+\n+        A list of `m`-by-`n` matrices where `m` is the ambient\n+        dimension of ``K2`` and `n` is the ambient dimension of this\n+        cone. Each matrix `P` in the list should have the property\n+        that `P(x)` is an element of ``K2`` whenever `x` is an\n+        element of this cone. Moreover, any nonnegative linear\n+        combination of these matrices shares the same property.\n```\n\nWhy \"should have\"? Is it not guaranteed to be the case? The fact that their combination has the same property only reflect the fact that such elements form a cone, yet it does not imply that returned elements generate that cone. Returning just a zero matrix or even an empty list would fit this description ;-)",
    "created_at": "2016-10-02T21:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21358#issuecomment-296469",
    "user": "@novoselt"
}
```

This is a bit non-committal:

```
+        OUTPUT:
+
+        A list of `m`-by-`n` matrices where `m` is the ambient
+        dimension of ``K2`` and `n` is the ambient dimension of this
+        cone. Each matrix `P` in the list should have the property
+        that `P(x)` is an element of ``K2`` whenever `x` is an
+        element of this cone. Moreover, any nonnegative linear
+        combination of these matrices shares the same property.
```

Why "should have"? Is it not guaranteed to be the case? The fact that their combination has the same property only reflect the fact that such elements form a cone, yet it does not imply that returned elements generate that cone. Returning just a zero matrix or even an empty list would fit this description ;-)



---

archive/issue_comments_296470.json:
```json
{
    "body": "\n```\n+        TESTS:\n+\n+        Each positive operator should send the generators of one cone\n+        into the other cone::\n...\n+        Each positive operator should send a random element of one cone\n+        into the other cone::\n...\n+        A random positive operator should send the generators of one\n+        cone into the other cone::\n...\n+        A random positive operator should send a random element of one\n+        cone into the other cone::\n```\n\nWhile it is in general good to have more tests, I think this goes over the board: the last statement includes all previous ones and assuming that randomness works makes running those tests a waste of time.\n\nI didn't get into the math details of the subsequent ones, but if it is the same here, i.e. that some tests follow from other ones, I think they should be removed.\n\nKeeping tests for corner cases like trivial cones/spaces, on the other hand, is probably good since they tend to be mathematically obvious but programmatically buggy.",
    "created_at": "2016-10-02T22:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21358#issuecomment-296470",
    "user": "@novoselt"
}
```


```
+        TESTS:
+
+        Each positive operator should send the generators of one cone
+        into the other cone::
...
+        Each positive operator should send a random element of one cone
+        into the other cone::
...
+        A random positive operator should send the generators of one
+        cone into the other cone::
...
+        A random positive operator should send a random element of one
+        cone into the other cone::
```

While it is in general good to have more tests, I think this goes over the board: the last statement includes all previous ones and assuming that randomness works makes running those tests a waste of time.

I didn't get into the math details of the subsequent ones, but if it is the same here, i.e. that some tests follow from other ones, I think they should be removed.

Keeping tests for corner cases like trivial cones/spaces, on the other hand, is probably good since they tend to be mathematically obvious but programmatically buggy.



---

archive/issue_comments_296471.json:
```json
{
    "body": "`cross_positive_operators` misses `gens`",
    "created_at": "2016-10-02T23:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21358#issuecomment-296471",
    "user": "@novoselt"
}
```

`cross_positive_operators` misses `gens`



---

archive/issue_comments_296472.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-03T02:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21358#issuecomment-296472",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_296473.json:
```json
{
    "body": "Still stands:\n> I am not entirely sure as a non-native speaker, but wouldn't `positive_operators_gens` be a more accurate name than `positive_operator_gens`? Since these are generators not of a single positive operator, but rather of some set (cone) of many positive operators?\n\nWhile it is tiny, it is unlikely to change once one version is merged ;-) Thanks for addressing other issues!",
    "created_at": "2016-10-10T19:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21358#issuecomment-296473",
    "user": "@novoselt"
}
```

Still stands:
> I am not entirely sure as a non-native speaker, but wouldn't `positive_operators_gens` be a more accurate name than `positive_operator_gens`? Since these are generators not of a single positive operator, but rather of some set (cone) of many positive operators?

While it is tiny, it is unlikely to change once one version is merged ;-) Thanks for addressing other issues!



---

archive/issue_comments_296474.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-11T13:17:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21358#issuecomment-296474",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_296475.json:
```json
{
    "body": "Ok, I haven't had any good ideas in the meantime, so `operators_gens` it is.",
    "created_at": "2016-10-11T13:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21358#issuecomment-296475",
    "user": "@orlitzky"
}
```

Ok, I haven't had any good ideas in the meantime, so `operators_gens` it is.



---

archive/issue_comments_296476.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-03T01:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21358#issuecomment-296476",
    "user": "@novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_296477.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-01-18T20:39:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21358",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21358#issuecomment-296477",
    "user": "@vbraun"
}
```

Resolution: fixed
