# Issue 11445: sending any large string at all to the gp PARI pexpect interface fails

archive/issues_011445.json:
```json
{
    "body": "Assignee: was\n\nIn Sage-4.7 (on Linux and OS X), we have:\n\n\n```\nsage: '***' in gp.eval('a='+str(range(10^3)))\nFalse\nsage: '***' in gp.eval('a='+str(range(10^4)))\nFalse\nsage: '***' in gp.eval('a='+str(range(10^5)))\nFalse\nsage: '***' in gp.eval('a='+str(range(10^6)))\nTrue\n```\n\n\nThe \"***\" appearing in the output means that an error occurs.  Looking further we find:\n\n\n```\nsage: print gp.eval('a='+str(range(10^6)))\n  ***   [...] at: read(\"/scratch/wstei\n  ***             ^--------------------\n  ***   in function read: read(\"/scratch/wstei\n...\n  *** read: error opening input file: `/scratch/wstein/sage//temp/mod.math.washington.edu/17446//interface//tmp17449'.\n```\n\nShockingly, looking at the file we are reading it we find that it contains:\n\n```\nsage: !more /scratch/wstein/sage//temp/mod.math.washington.edu/17446//interface//tmp17449\nread(\"/scratch/wstein/sage//temp/mod.math.washington.edu/17446//interface//tmp17449\")\n```\n\n\nSo, instead of writing the long string we are supposed to read in, the file contains a single line asking to read in itself!\n\nIssue created by migration from https://trac.sagemath.org/ticket/11617\n\n",
    "created_at": "2011-07-21T20:55:56Z",
    "labels": [
        "interfaces",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "sending any large string at all to the gp PARI pexpect interface fails",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11445",
    "user": "was"
}
```
Assignee: was

In Sage-4.7 (on Linux and OS X), we have:


```
sage: '***' in gp.eval('a='+str(range(10^3)))
False
sage: '***' in gp.eval('a='+str(range(10^4)))
False
sage: '***' in gp.eval('a='+str(range(10^5)))
False
sage: '***' in gp.eval('a='+str(range(10^6)))
True
```


The "***" appearing in the output means that an error occurs.  Looking further we find:


```
sage: print gp.eval('a='+str(range(10^6)))
  ***   [...] at: read("/scratch/wstei
  ***             ^--------------------
  ***   in function read: read("/scratch/wstei
...
  *** read: error opening input file: `/scratch/wstein/sage//temp/mod.math.washington.edu/17446//interface//tmp17449'.
```

Shockingly, looking at the file we are reading it we find that it contains:

```
sage: !more /scratch/wstein/sage//temp/mod.math.washington.edu/17446//interface//tmp17449
read("/scratch/wstein/sage//temp/mod.math.washington.edu/17446//interface//tmp17449")
```


So, instead of writing the long string we are supposed to read in, the file contains a single line asking to read in itself!

Issue created by migration from https://trac.sagemath.org/ticket/11617





---

archive/issue_comments_127793.json:
```json
{
    "body": "Simpler input to give the problem:\n\n```\nsage: time gp._eval_line('a='+str(range(2*10^5)))[:70]\n'  ***   [...] at: read(\"/scratch/wstei\\n  ***             ^------------'\nTime: CPU 0.12 s, Wall: 0.34 s\n```\n",
    "created_at": "2011-07-21T21:35:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11445#issuecomment-127793",
    "user": "was"
}
```

Simpler input to give the problem:

```
sage: time gp._eval_line('a='+str(range(2*10^5)))[:70]
'  ***   [...] at: read("/scratch/wstei\n  ***             ^------------'
Time: CPU 0.12 s, Wall: 0.34 s
```




---

archive/issue_comments_127794.json:
```json
{
    "body": "Attachment [trac_11617.patch](tarball://root/attachments/some-uuid/ticket11617/trac_11617.patch) by was created at 2011-07-21 21:37:28",
    "created_at": "2011-07-21T21:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11445#issuecomment-127794",
    "user": "was"
}
```

Attachment [trac_11617.patch](tarball://root/attachments/some-uuid/ticket11617/trac_11617.patch) by was created at 2011-07-21 21:37:28



---

archive/issue_comments_127795.json:
```json
{
    "body": "This turns out to be an easy 1-line fix.   The bug turned out to be caused because the \"allow_use_file\" option wasn't properly passed  in the last recursive call to _eval_line in the _eval_line function.  And I guess that option is important since the default (=True) isn't the right choice when sending the name of the command to read in the file itself.   In particular, since\n\n```\n eval_using_file_cutoff=50\n```\n\nif the filename of the file to read in (plus the read command) exceeded 50 characters, we were in big trouble... but only in the case when the stack was automatically doubled.  This example hit this threshold.",
    "created_at": "2011-07-21T21:44:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11445#issuecomment-127795",
    "user": "was"
}
```

This turns out to be an easy 1-line fix.   The bug turned out to be caused because the "allow_use_file" option wasn't properly passed  in the last recursive call to _eval_line in the _eval_line function.  And I guess that option is important since the default (=True) isn't the right choice when sending the name of the command to read in the file itself.   In particular, since

```
 eval_using_file_cutoff=50
```

if the filename of the file to read in (plus the read command) exceeded 50 characters, we were in big trouble... but only in the case when the stack was automatically doubled.  This example hit this threshold.



---

archive/issue_comments_127796.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-07-21T21:44:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11445#issuecomment-127796",
    "user": "was"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_127797.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-07-21T21:51:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11445#issuecomment-127797",
    "user": "mhansen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_127798.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2011-07-21T21:51:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11445#issuecomment-127798",
    "user": "mhansen"
}
```

Looks good to me.



---

archive/issue_comments_127799.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-08-02T19:47:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11445",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11445#issuecomment-127799",
    "user": "jdemeyer"
}
```

Resolution: fixed
