# Issue 11445: sending any large string at all to the gp PARI pexpect interface fails

Issue created by migration from https://trac.sagemath.org/ticket/11617

Original creator: was

Original creation time: 2011-07-21 20:55:56

Assignee: was

In Sage-4.7 (on Linux and OS X), we have:


```
sage: '***' in gp.eval('a='+str(range(10^3)))
False
sage: '***' in gp.eval('a='+str(range(10^4)))
False
sage: '***' in gp.eval('a='+str(range(10^5)))
False
sage: '***' in gp.eval('a='+str(range(10^6)))
True
```


The "***" appearing in the output means that an error occurs.  Looking further we find:


```
sage: print gp.eval('a='+str(range(10^6)))
  ***   [...] at: read("/scratch/wstei
  ***             ^--------------------
  ***   in function read: read("/scratch/wstei
...
  *** read: error opening input file: `/scratch/wstein/sage//temp/mod.math.washington.edu/17446//interface//tmp17449'.
```

Shockingly, looking at the file we are reading it we find that it contains:

```
sage: !more /scratch/wstein/sage//temp/mod.math.washington.edu/17446//interface//tmp17449
read("/scratch/wstein/sage//temp/mod.math.washington.edu/17446//interface//tmp17449")
```


So, instead of writing the long string we are supposed to read in, the file contains a single line asking to read in itself!


---

Comment by was created at 2011-07-21 21:35:49

Simpler input to give the problem:

```
sage: time gp._eval_line('a='+str(range(2*10^5)))[:70]
'  ***   [...] at: read("/scratch/wstei\n  ***             ^------------'
Time: CPU 0.12 s, Wall: 0.34 s
```



---

Attachment


---

Comment by was created at 2011-07-21 21:44:08

This turns out to be an easy 1-line fix.   The bug turned out to be caused because the "allow_use_file" option wasn't properly passed  in the last recursive call to _eval_line in the _eval_line function.  And I guess that option is important since the default (=True) isn't the right choice when sending the name of the command to read in the file itself.   In particular, since

```
 eval_using_file_cutoff=50
```

if the filename of the file to read in (plus the read command) exceeded 50 characters, we were in big trouble... but only in the case when the stack was automatically doubled.  This example hit this threshold.


---

Comment by was created at 2011-07-21 21:44:08

Changing status from new to needs_review.


---

Comment by mhansen created at 2011-07-21 21:51:34

Changing status from needs_review to positive_review.


---

Comment by mhansen created at 2011-07-21 21:51:34

Looks good to me.


---

Comment by jdemeyer created at 2011-08-02 19:47:25

Resolution: fixed
