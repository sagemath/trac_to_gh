# Issue 29280: register_as_coercion fails when no coercion map was already discovered

Issue created by migration from https://trac.sagemath.org/ticket/29517

Original creator: caruso

Original creation time: 2020-04-16 08:53:40

CC:  tscrim

Compare:


```
sage: A.<a> = ZZ[]
sage: B.<b> = ZZ[]
sage: phi = A.hom([b])
sage: phi.register_as_coercion()
```


with:


```
sage: A.<a> = ZZ[]
sage: B.<b> = ZZ[]
sage: B.has_coerce_map_from(A)
False
sage: phi = A.hom([b])
sage: phi.register_as_coercion()
Traceback (most recent call last):
...
AssertionError: coercion from Univariate Polynomial Ring in a over Integer Ring to Univariate Polynomial Ring in b over Integer Ring already registered or discovered
```




---

Comment by caruso created at 2020-04-16 09:14:32

Changing status from new to needs_review.


---

Comment by git created at 2020-04-16 09:16:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-04-16 14:16:38

Doctest failure here:

```
File "src/sage/categories/morphism.pyx", line 269, in sage.categories.morphism.Morphism.register_as_coercion
Failed example:
    phi.register_as_coercion()
Expected:
    Traceback (most recent call last):
    ...
    AssertionError: coercion from Univariate Polynomial Ring in x over Integer Ring to Univariate Polynomial Ring in y over Integer Ring already registered or discovered
Got:
    <BLANKLINE>
```


I cannot remember if this behavior was intentional or not as we might not wanted to create a coercion after explicitly checking that there was not one as a safety check. However, even if that was the case, I think this is the more natural thing to permit since the user should really know what they are doing to add this.

So once the doctest is fixed, then you can set a positive review on my behalf.


---

Comment by git created at 2020-04-16 14:30:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2020-04-16 14:30:59

Changing status from needs_review to positive_review.


---

Comment by slelievre created at 2020-04-16 14:34:45

Missing author name.


---

Comment by vbraun created at 2020-04-18 08:35:03

Resolution: fixed
