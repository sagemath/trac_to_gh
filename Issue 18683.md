# Issue 18683: upgrade Maxima and ECL to 5.36.0.1 and 15.3.7, respectively

archive/issues_018683.json:
```json
{
    "body": "CC:  rws jpflori kcrisman nbruin jdemeyer vbraun charpent\n\nthis would fix some bugs, e.g. as reported [here](https://groups.google.com/d/msg/sage-support/OJAN4pk4dwQ/FJRxra67EbwJ).\n\n* get Maxima [here](https://github.com/andrejv/maxima) (then `git checkout 5.36.0.1`) and\n* ECL [here](https://gitlab.com/embeddable-common-lisp/ecl.git).\n\nIssue created by migration from https://trac.sagemath.org/ticket/18920\n\n",
    "created_at": "2015-07-18T09:54:10Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "title": "upgrade Maxima and ECL to 5.36.0.1 and 15.3.7, respectively",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18683",
    "user": "dimpase"
}
```
CC:  rws jpflori kcrisman nbruin jdemeyer vbraun charpent

this would fix some bugs, e.g. as reported [here](https://groups.google.com/d/msg/sage-support/OJAN4pk4dwQ/FJRxra67EbwJ).

* get Maxima [here](https://github.com/andrejv/maxima) (then `git checkout 5.36.0.1`) and
* ECL [here](https://gitlab.com/embeddable-common-lisp/ecl.git).

Issue created by migration from https://trac.sagemath.org/ticket/18920





---

archive/issue_comments_254497.json:
```json
{
    "body": "For info, I have been using ecl 15.3.7 for a while in sage-on-gentoo. That part is a straight upgrade as far as I can see. I do not remember having tried a newer maxima but it usually breaks a lest a couple of doctest.",
    "created_at": "2015-07-18T21:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254497",
    "user": "fbissey"
}
```

For info, I have been using ecl 15.3.7 for a while in sage-on-gentoo. That part is a straight upgrade as far as I can see. I do not remember having tried a newer maxima but it usually breaks a lest a couple of doctest.



---

archive/issue_comments_254498.json:
```json
{
    "body": "I tried maxima 5.36.0 and reverted (that was with ecl 15.3.7) , not tried 5.36.1 (5.36.0.1 whatever the version number is actually).\n\n```\n     Wed Apr 29 11:14:49 2015 >>> sci-mathematics/maxima-5.35.1-r2\n       merge time: 5 minutes and 6 seconds.\n\n     Fri May  1 10:33:58 2015 >>> sci-mathematics/maxima-5.36.0\n       merge time: 4 minutes and 52 seconds.\n\n     Fri May  1 10:42:03 2015 >>> sci-mathematics/maxima-5.35.1-r2\n       merge time: 5 minutes and 8 seconds.\n```\n",
    "created_at": "2015-07-18T22:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254498",
    "user": "fbissey"
}
```

I tried maxima 5.36.0 and reverted (that was with ecl 15.3.7) , not tried 5.36.1 (5.36.0.1 whatever the version number is actually).

```
     Wed Apr 29 11:14:49 2015 >>> sci-mathematics/maxima-5.35.1-r2
       merge time: 5 minutes and 6 seconds.

     Fri May  1 10:33:58 2015 >>> sci-mathematics/maxima-5.36.0
       merge time: 4 minutes and 52 seconds.

     Fri May  1 10:42:03 2015 >>> sci-mathematics/maxima-5.35.1-r2
       merge time: 5 minutes and 8 seconds.
```




---

archive/issue_comments_254499.json:
```json
{
    "body": "The branch is currently not working; to build the new ecl pkg, one has to move `patches/implib.patch` out of the way; I tried porting the latter patch to the new ecl, but it produces a makefile error that I don't understand; anyway, it is cygwin-specific.\n\nI cc its author now. J.-P., any ideas?",
    "created_at": "2015-07-18T23:27:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254499",
    "user": "dimpase"
}
```

The branch is currently not working; to build the new ecl pkg, one has to move `patches/implib.patch` out of the way; I tried porting the latter patch to the new ecl, but it produces a makefile error that I don't understand; anyway, it is cygwin-specific.

I cc its author now. J.-P., any ideas?



---

archive/issue_comments_254500.json:
```json
{
    "body": "for the record, I get\n\n```\n...\nconfig.status: creating ecl/config.h\nConfiguration complete. To build ECL, issue make in this directory.\ncd build; make -j1\nmake[1]: Entering directory `/home/dima/software/sage/local/var/tmp/sage/build/ecl-15.3.7.p0/src/build'\nMakefile:192: *** commands commence before first target.  Stop.\nmake[1]: Leaving directory `/home/dima/software/sage/local/var/tmp/sage/build/ecl-15.3.7.p0/src/build'\nmake: *** [all] Error 2\nError - Failed to build ECL ... exiting\n```\n",
    "created_at": "2015-07-18T23:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254500",
    "user": "dimpase"
}
```

for the record, I get

```
...
config.status: creating ecl/config.h
Configuration complete. To build ECL, issue make in this directory.
cd build; make -j1
make[1]: Entering directory `/home/dima/software/sage/local/var/tmp/sage/build/ecl-15.3.7.p0/src/build'
Makefile:192: *** commands commence before first target.  Stop.
make[1]: Leaving directory `/home/dima/software/sage/local/var/tmp/sage/build/ecl-15.3.7.p0/src/build'
make: *** [all] Error 2
Error - Failed to build ECL ... exiting
```




---

archive/issue_comments_254501.json:
```json
{
    "body": "What I don't understand is whether some patches are in fact results of running autoconf/automake/aclocal on patched configure.ac, Makefile.in, etc. \n\nIf yes, then these should be split from the \"real\" ones to allow for fully automatic creation (and commands needed to run autotools need to be spelled out somewhere in the pkg docs). If no, then I don't see the point of patching configure.ac, Makefile.in, etc in the first place.",
    "created_at": "2015-07-19T09:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254501",
    "user": "dimpase"
}
```

What I don't understand is whether some patches are in fact results of running autoconf/automake/aclocal on patched configure.ac, Makefile.in, etc. 

If yes, then these should be split from the "real" ones to allow for fully automatic creation (and commands needed to run autotools need to be spelled out somewhere in the pkg docs). If no, then I don't see the point of patching configure.ac, Makefile.in, etc in the first place.



---

archive/issue_comments_254502.json:
```json
{
    "body": "Look at spkg_src. autotools are not run. But may be the impl platch was copied from an autotool run. The gmp patch deals with the removal of gmp sources from the upstream tarball (the configure script of ecl checks for stuff in that subdirectory so those checks have to be diverted). the impl patch deals with cygwin stuff.\n\nGetting real autoconf patch and running autotools wouldn't be a bad idea but that means you will need to have autotools installed to run spkg-src. spkg-src will need to be amended accordingly.",
    "created_at": "2015-07-19T10:06:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254502",
    "user": "fbissey"
}
```

Look at spkg_src. autotools are not run. But may be the impl platch was copied from an autotool run. The gmp patch deals with the removal of gmp sources from the upstream tarball (the configure script of ecl checks for stuff in that subdirectory so those checks have to be diverted). the impl patch deals with cygwin stuff.

Getting real autoconf patch and running autotools wouldn't be a bad idea but that means you will need to have autotools installed to run spkg-src. spkg-src will need to be amended accordingly.



---

archive/issue_comments_254503.json:
```json
{
    "body": "I notice that the gmp patch is against `configure.ac` while implib is against `configure.in` the last one is probably wrong.",
    "created_at": "2015-07-19T10:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254503",
    "user": "fbissey"
}
```

I notice that the gmp patch is against `configure.ac` while implib is against `configure.in` the last one is probably wrong.



---

archive/issue_comments_254504.json:
```json
{
    "body": "Replying to [comment:10 fbissey]:\n> I notice that the gmp patch is against `configure.ac` while implib is against `configure.in` the last one is probably wrong.\n\nthe name has changed in version 15.3.7.",
    "created_at": "2015-07-19T10:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254504",
    "user": "dimpase"
}
```

Replying to [comment:10 fbissey]:
> I notice that the gmp patch is against `configure.ac` while implib is against `configure.in` the last one is probably wrong.

the name has changed in version 15.3.7.



---

archive/issue_comments_254505.json:
```json
{
    "body": "I am trying to read the stuff from the git commit and of course it is patch of patch, it is not readable as this, you changed it already I see.",
    "created_at": "2015-07-19T10:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254505",
    "user": "fbissey"
}
```

I am trying to read the stuff from the git commit and of course it is patch of patch, it is not readable as this, you changed it already I see.



---

archive/issue_comments_254506.json:
```json
{
    "body": "Replying to [comment:9 fbissey]:\n> Look at spkg_src. autotools are not run. But may be the impl platch was copied from an autotool run. The gmp patch deals with the removal of gmp sources from the upstream tarball (the configure script of ecl checks for stuff in that subdirectory so those checks have to be diverted). the impl patch deals with cygwin stuff.\n> \n> Getting real autoconf patch and running autotools wouldn't be a bad idea but that means you will need to have autotools installed to run spkg-src. spkg-src will need to be amended accordingly.\n\nspkg-src is outdated anyway.",
    "created_at": "2015-07-19T10:34:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254506",
    "user": "dimpase"
}
```

Replying to [comment:9 fbissey]:
> Look at spkg_src. autotools are not run. But may be the impl platch was copied from an autotool run. The gmp patch deals with the removal of gmp sources from the upstream tarball (the configure script of ecl checks for stuff in that subdirectory so those checks have to be diverted). the impl patch deals with cygwin stuff.
> 
> Getting real autoconf patch and running autotools wouldn't be a bad idea but that means you will need to have autotools installed to run spkg-src. spkg-src will need to be amended accordingly.

spkg-src is outdated anyway.



---

archive/issue_comments_254507.json:
```json
{
    "body": "Replying to [comment:12 fbissey]:\n> I am trying to read the stuff from the git commit and of course it is patch of patch, it is not readable as this, you changed it already I see.\n\nhere they are in a more readable way: https://github.com/dimpase/ecl/commits/sagepatches",
    "created_at": "2015-07-19T10:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254507",
    "user": "dimpase"
}
```

Replying to [comment:12 fbissey]:
> I am trying to read the stuff from the git commit and of course it is patch of patch, it is not readable as this, you changed it already I see.

here they are in a more readable way: https://github.com/dimpase/ecl/commits/sagepatches



---

archive/issue_comments_254508.json:
```json
{
    "body": "Replying to [comment:13 dimpase]:\n> Replying to [comment:9 fbissey]:\n> > Look at spkg_src. autotools are not run. But may be the impl platch was copied from an autotool run. The gmp patch deals with the removal of gmp sources from the upstream tarball (the configure script of ecl checks for stuff in that subdirectory so those checks have to be diverted). the impl patch deals with cygwin stuff.\n\n\nNo, I mean that it is silly and error-prone to rebase by hand patches that are better obtained directly from diffs to output of autoconf/automake/aclocal.\n\nThe latter should not be bundled together with the \"real\" one.",
    "created_at": "2015-07-19T10:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254508",
    "user": "dimpase"
}
```

Replying to [comment:13 dimpase]:
> Replying to [comment:9 fbissey]:
> > Look at spkg_src. autotools are not run. But may be the impl platch was copied from an autotool run. The gmp patch deals with the removal of gmp sources from the upstream tarball (the configure script of ecl checks for stuff in that subdirectory so those checks have to be diverted). the impl patch deals with cygwin stuff.


No, I mean that it is silly and error-prone to rebase by hand patches that are better obtained directly from diffs to output of autoconf/automake/aclocal.

The latter should not be bundled together with the "real" one.



---

archive/issue_comments_254509.json:
```json
{
    "body": "I have opened https://gitlab.com/embeddable-common-lisp/ecl/issues/93\n\nto hopefully sort out the ECL autotools mess.",
    "created_at": "2015-07-20T08:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254509",
    "user": "dimpase"
}
```

I have opened https://gitlab.com/embeddable-common-lisp/ecl/issues/93

to hopefully sort out the ECL autotools mess.



---

archive/issue_comments_254510.json:
```json
{
    "body": "Sorry I have been too busy today to look further into this. I can reproduce your problem with your branch on my mac. I haven't quite identified yet the guilty makefile. I think the problem is not in the top makefile but in one of the subfolders but I haven't identified which one yet.",
    "created_at": "2015-07-20T08:17:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254510",
    "user": "fbissey"
}
```

Sorry I have been too busy today to look further into this. I can reproduce your problem with your branch on my mac. I haven't quite identified yet the guilty makefile. I think the problem is not in the top makefile but in one of the subfolders but I haven't identified which one yet.



---

archive/issue_comments_254511.json:
```json
{
    "body": "To complete the answer you got from upstream: automake is not used (not a crime) but ecl also ship some of its dependencies in the pristine tarball and those come with their own build systems which can use automake. Apart from `ffi` we don't want to care about these I think.",
    "created_at": "2015-07-20T08:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254511",
    "user": "fbissey"
}
```

To complete the answer you got from upstream: automake is not used (not a crime) but ecl also ship some of its dependencies in the pristine tarball and those come with their own build systems which can use automake. Apart from `ffi` we don't want to care about these I think.



---

archive/issue_comments_254512.json:
```json
{
    "body": "arrghh, that was me mixing of tabs and spaces in `src/Makefile.in` patch...\nNow all seems to work. I'll post an update soon.\n\nOK, and for the record, `src/configure` is generated by autoreconf, that is, one does not need to rebase the corresponding patch manually.",
    "created_at": "2015-07-20T11:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254512",
    "user": "dimpase"
}
```

arrghh, that was me mixing of tabs and spaces in `src/Makefile.in` patch...
Now all seems to work. I'll post an update soon.

OK, and for the record, `src/configure` is generated by autoreconf, that is, one does not need to rebase the corresponding patch manually.



---

archive/issue_comments_254513.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-20T12:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254513",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254514.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-25T19:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254514",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254515.json:
```json
{
    "body": "New Maxima output sometimes breaks Sage parser, e.g.\n\n```\nsage -t src/sage/calculus/calculus.py\n**********************************************************************\nFile \"src/sage/calculus/calculus.py\", line 373, in sage.calculus.calculus\nFailed example:\n    taylor(gamma(1/3+x),x,0,3)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/dima/software/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/dima/software/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.calculus.calculus[100]>\", line 1, in <module>\n        taylor(gamma(Integer(1)/Integer(3)+x),x,Integer(0),Integer(3))\n      File \"/home/dima/software/sage/local/lib/python2.7/site-packages/sage/calculus/functional.py\", line 378, in taylor\n        return f.taylor(*args)\n      File \"sage/symbolic/expression.pyx\", line 4038, in sage.symbolic.expression.Expression.taylor (/home/dima/software/sage/src/build/cythonized/sage/symbolic/expression.cpp:23671)\n        return self.parent()(l)\n      File \"sage/structure/parent.pyx\", line 1097, in sage.structure.parent.Parent.__call__ (/home/dima/software/sage/src/build/cythonized/sage/structure/parent.c:9546)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 237, in sage.structure.coerce_maps.NamedConvertMap._call_ (/home/dima/software/sage/src/build/cythonized/sage/structure/coerce_maps.c:5756)\n        cdef Element e = method(C)\n      File \"/home/dima/software/sage/local/lib/python2.7/site-packages/sage/interfaces/maxima_abstract.py\", line 1251, in _symbolic_\n        return R(self._sage_())\n      File \"/home/dima/software/sage/local/lib/python2.7/site-packages/sage/interfaces/maxima_abstract.py\", line 1226, in _sage_\n        maxima=self.parent())\n      File \"/home/dima/software/sage/local/lib/python2.7/site-packages/sage/calculus/calculus.py\", line 1901, in symbolic_expression_from_maxima_string\n        raise TypeError(\"unable to make sense of Maxima expression '%s' in Sage\"%s)\n    TypeError: unable to make sense of Maxima expression '(1/432)*(72*gamma(1/3)*(psi[2])(1/3)+((-72)*euler_gamma^3+((-36)*pi*3^(1/2)+(-324)*log(3))*euler_gamma^2+((-108)*log(3)*pi*3^(1/2)+(-18)*pi^2+(-486)*log(3)^2+(-216)*(psi[1])(1/3))*euler_gamma+((-1)*pi^3+((-81)*log(3)^2+(-36)*(psi[1])(1/3))*pi)*3^(1/2)+(-27)*log(3)*pi^2+(-243)*log(3)^3+(-324)*(psi[1])(1/3)*log(3))*gamma(1/3))*_SAGE_VAR_x^3+(1/24)*((12*euler_gamma^2+(4*pi*3^(1/2)+36*log(3))*euler_gamma+6*log(3)*pi*3^(1/2)+pi^2+27*log(3)^2+12*(psi[1])(1/3))*gamma(1/3))*_SAGE_VAR_x^2+((-1)/6)*((6*euler_gamma+pi*3^(1/2)+9*log(3))*gamma(1/3))*_SAGE_VAR_x+gamma(1/3)' in Sage\n```\n\nand\n\n```\nFile \"src/sage/calculus/calculus.py\", line 1746, in sage.calculus.calculus.symbolic_expression_from_maxima_string\nFailed example:\n    maxima('3*li[2](u)+8*li[33](exp(u))').sage()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/dima/software/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/dima/software/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.calculus.calculus.symbolic_expression_from_maxima_string[6]>\", line 1, in <module>\n        maxima('3*li[2](u)+8*li[33](exp(u))').sage()\n      File \"/home/dima/software/sage/local/lib/python2.7/site-packages/sage/interfaces/interface.py\", line 1016, in sage\n        return self._sage_(*args, **kwds)\n      File \"/home/dima/software/sage/local/lib/python2.7/site-packages/sage/interfaces/maxima_abstract.py\", line 1226, in _sage_\n        maxima=self.parent())\n      File \"/home/dima/software/sage/local/lib/python2.7/site-packages/sage/calculus/calculus.py\", line 1901, in symbolic_expression_from_maxima_string\n        raise TypeError(\"unable to make sense of Maxima expression '%s' in Sage\"%s)\n    TypeError: unable to make sense of Maxima expression '8*(li[33])(e^u)+3*(li[2])(u)' in Sage\n```\n\n\nIs it easy to fix?",
    "created_at": "2015-07-25T22:03:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254515",
    "user": "dimpase"
}
```

New Maxima output sometimes breaks Sage parser, e.g.

```
sage -t src/sage/calculus/calculus.py
**********************************************************************
File "src/sage/calculus/calculus.py", line 373, in sage.calculus.calculus
Failed example:
    taylor(gamma(1/3+x),x,0,3)
Exception raised:
    Traceback (most recent call last):
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.calculus.calculus[100]>", line 1, in <module>
        taylor(gamma(Integer(1)/Integer(3)+x),x,Integer(0),Integer(3))
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/calculus/functional.py", line 378, in taylor
        return f.taylor(*args)
      File "sage/symbolic/expression.pyx", line 4038, in sage.symbolic.expression.Expression.taylor (/home/dima/software/sage/src/build/cythonized/sage/symbolic/expression.cpp:23671)
        return self.parent()(l)
      File "sage/structure/parent.pyx", line 1097, in sage.structure.parent.Parent.__call__ (/home/dima/software/sage/src/build/cythonized/sage/structure/parent.c:9546)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 237, in sage.structure.coerce_maps.NamedConvertMap._call_ (/home/dima/software/sage/src/build/cythonized/sage/structure/coerce_maps.c:5756)
        cdef Element e = method(C)
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/interfaces/maxima_abstract.py", line 1251, in _symbolic_
        return R(self._sage_())
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/interfaces/maxima_abstract.py", line 1226, in _sage_
        maxima=self.parent())
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/calculus/calculus.py", line 1901, in symbolic_expression_from_maxima_string
        raise TypeError("unable to make sense of Maxima expression '%s' in Sage"%s)
    TypeError: unable to make sense of Maxima expression '(1/432)*(72*gamma(1/3)*(psi[2])(1/3)+((-72)*euler_gamma^3+((-36)*pi*3^(1/2)+(-324)*log(3))*euler_gamma^2+((-108)*log(3)*pi*3^(1/2)+(-18)*pi^2+(-486)*log(3)^2+(-216)*(psi[1])(1/3))*euler_gamma+((-1)*pi^3+((-81)*log(3)^2+(-36)*(psi[1])(1/3))*pi)*3^(1/2)+(-27)*log(3)*pi^2+(-243)*log(3)^3+(-324)*(psi[1])(1/3)*log(3))*gamma(1/3))*_SAGE_VAR_x^3+(1/24)*((12*euler_gamma^2+(4*pi*3^(1/2)+36*log(3))*euler_gamma+6*log(3)*pi*3^(1/2)+pi^2+27*log(3)^2+12*(psi[1])(1/3))*gamma(1/3))*_SAGE_VAR_x^2+((-1)/6)*((6*euler_gamma+pi*3^(1/2)+9*log(3))*gamma(1/3))*_SAGE_VAR_x+gamma(1/3)' in Sage
```

and

```
File "src/sage/calculus/calculus.py", line 1746, in sage.calculus.calculus.symbolic_expression_from_maxima_string
Failed example:
    maxima('3*li[2](u)+8*li[33](exp(u))').sage()
Exception raised:
    Traceback (most recent call last):
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.calculus.calculus.symbolic_expression_from_maxima_string[6]>", line 1, in <module>
        maxima('3*li[2](u)+8*li[33](exp(u))').sage()
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/interfaces/interface.py", line 1016, in sage
        return self._sage_(*args, **kwds)
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/interfaces/maxima_abstract.py", line 1226, in _sage_
        maxima=self.parent())
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/calculus/calculus.py", line 1901, in symbolic_expression_from_maxima_string
        raise TypeError("unable to make sense of Maxima expression '%s' in Sage"%s)
    TypeError: unable to make sense of Maxima expression '8*(li[33])(e^u)+3*(li[2])(u)' in Sage
```


Is it easy to fix?



---

archive/issue_comments_254516.json:
```json
{
    "body": "Replying to [comment:23 dimpase]:\n> {{{\n>     TypeError: unable to make sense of Maxima expression '(1/432)*(72*gamma(1/3)*(psi[2])(1/3)+((-72)*euler_gamma<sup>3+((-36)*pi*3</sup>(1/2)+(-324)*log(3))*euler_gamma<sup>2+((-108)*log(3)*pi*3</sup>(1/2)+(-18)*pi<sup>2+(-486)*log(3)</sup>2+(-216)*(psi[1])(1/3))*euler_gamma+((-1)*pi<sup>3+((-81)*log(3)</sup>2+(-36)*(psi[1])(1/3))*pi)*3<sup>(1/2)+(-27)*log(3)*pi</sup>2+(-243)*log(3)<sup>3+(-324)*(psi[1])(1/3)*log(3))*gamma(1/3))*_SAGE_VAR_x</sup>3+(1/24)*((12*euler_gamma<sup>2+(4*pi*3</sup>(1/2)+36*log(3))*euler_gamma+6*log(3)*pi*3<sup>(1/2)+pi</sup>2+27*log(3)<sup>2+12*(psi[1])(1/3))*gamma(1/3))*_SAGE_VAR_x</sup>2+((-1)/6)*((6*euler_gamma+pi*3^(1/2)+9*log(3))*gamma(1/3))*_SAGE_VAR_x+gamma(1/3)' in Sage\n> }}}\n> and\n> {{{\n>     TypeError: unable to make sense of Maxima expression '8*(li[33])(e^u)+3*(li[2])(u)' in Sage\n> }}}\n\nNo, it is not very easy to fix. We rewrite `li[n](` to `polylog(n,` and the same for `psi[n](` to `psi(n,`. This string matching obviously completely breaks if maxima starts spelling this as `(li[n])(x)`. Quite frankly, that's an insane spelling, so perhaps the preferred approach is to clarify with the maxima folks if they really intend this. It might be an unforeseen byproduct of some other change that they prefer to fix themselves, in which case we shouldn't waste time.\n\nIf they insist this is a reasonable spelling, I think we can work around it, but it'll be a bit of real work. Note that we can handle calls to parenthesized functions:\n\n```\nsage: from sage.calculus.calculus import symbolic_expression_from_maxima_string as sefms\nsage: sefms('(sin)(x)')\nsin(x)\n```\n\nso as long as we ensure that expressions like `li[n]` and `psi[n]` themselves get parsed to callable functions, we should be OK. Something like this would be OK:\n\n```\nsage: sefms('li[n]')\ncurried_polylog(n)\nsage: sefms('li[n]')(x)\npolylog(n,x)\nsage: sefms('(li[n])(x)')\npolylog(n,x)\n```\n\nSince we cannot really handle square brackets, we'd need to do the `li[n]`->`curried_polylog(n)` via a string substitution, but that should be OK. The `curried_polylog(n)` would just create a symbolic function that, when called with a single argument, would create the appropriate polylog.\n\nThe binary conversion `sr_to_max` in `maxima_lib.py`  shouldn't be affected, unless they have changed their internal representation of polylogarithms.",
    "created_at": "2015-07-25T23:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254516",
    "user": "nbruin"
}
```

Replying to [comment:23 dimpase]:
> {{{
>     TypeError: unable to make sense of Maxima expression '(1/432)*(72*gamma(1/3)*(psi[2])(1/3)+((-72)*euler_gamma<sup>3+((-36)*pi*3</sup>(1/2)+(-324)*log(3))*euler_gamma<sup>2+((-108)*log(3)*pi*3</sup>(1/2)+(-18)*pi<sup>2+(-486)*log(3)</sup>2+(-216)*(psi[1])(1/3))*euler_gamma+((-1)*pi<sup>3+((-81)*log(3)</sup>2+(-36)*(psi[1])(1/3))*pi)*3<sup>(1/2)+(-27)*log(3)*pi</sup>2+(-243)*log(3)<sup>3+(-324)*(psi[1])(1/3)*log(3))*gamma(1/3))*_SAGE_VAR_x</sup>3+(1/24)*((12*euler_gamma<sup>2+(4*pi*3</sup>(1/2)+36*log(3))*euler_gamma+6*log(3)*pi*3<sup>(1/2)+pi</sup>2+27*log(3)<sup>2+12*(psi[1])(1/3))*gamma(1/3))*_SAGE_VAR_x</sup>2+((-1)/6)*((6*euler_gamma+pi*3^(1/2)+9*log(3))*gamma(1/3))*_SAGE_VAR_x+gamma(1/3)' in Sage
> }}}
> and
> {{{
>     TypeError: unable to make sense of Maxima expression '8*(li[33])(e^u)+3*(li[2])(u)' in Sage
> }}}

No, it is not very easy to fix. We rewrite `li[n](` to `polylog(n,` and the same for `psi[n](` to `psi(n,`. This string matching obviously completely breaks if maxima starts spelling this as `(li[n])(x)`. Quite frankly, that's an insane spelling, so perhaps the preferred approach is to clarify with the maxima folks if they really intend this. It might be an unforeseen byproduct of some other change that they prefer to fix themselves, in which case we shouldn't waste time.

If they insist this is a reasonable spelling, I think we can work around it, but it'll be a bit of real work. Note that we can handle calls to parenthesized functions:

```
sage: from sage.calculus.calculus import symbolic_expression_from_maxima_string as sefms
sage: sefms('(sin)(x)')
sin(x)
```

so as long as we ensure that expressions like `li[n]` and `psi[n]` themselves get parsed to callable functions, we should be OK. Something like this would be OK:

```
sage: sefms('li[n]')
curried_polylog(n)
sage: sefms('li[n]')(x)
polylog(n,x)
sage: sefms('(li[n])(x)')
polylog(n,x)
```

Since we cannot really handle square brackets, we'd need to do the `li[n]`->`curried_polylog(n)` via a string substitution, but that should be OK. The `curried_polylog(n)` would just create a symbolic function that, when called with a single argument, would create the appropriate polylog.

The binary conversion `sr_to_max` in `maxima_lib.py`  shouldn't be affected, unless they have changed their internal representation of polylogarithms.



---

archive/issue_comments_254517.json:
```json
{
    "body": "I opened https://sourceforge.net/p/maxima/bugs/2998/ to ask about these extra ()...",
    "created_at": "2015-07-26T07:23:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254517",
    "user": "dimpase"
}
```

I opened https://sourceforge.net/p/maxima/bugs/2998/ to ask about these extra ()...



---

archive/issue_comments_254518.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-26T12:24:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254518",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254519.json:
```json
{
    "body": "This is bad:\n\n```diff\ndiff --git a/build/pkgs/maxima/spkg-install b/build/pkgs/maxima/spkg-install\nindex 3c80e5c..b08d0d7 100755\n--- a/build/pkgs/maxima/spkg-install\n+++ b/build/pkgs/maxima/spkg-install\n@@ -47,6 +47,7 @@ done\n echo\n echo \"Now configuring Maxima...\"\n+./bootstrap\n ./configure --prefix=\"$SAGE_LOCAL\" --libdir=\"$SAGE_LOCAL/lib\" --enable-ecl git_found=false\n check_error \"Failed to configure Maxima.\"\n```\n\n\nBootstrapping should ideally be done by upstream. Alternatively, it should be done in `spkg-src`, but certainly not in `spkg-install`. Autotools are not a Sage prerequisite.",
    "created_at": "2015-07-26T12:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254519",
    "user": "jdemeyer"
}
```

This is bad:

```diff
diff --git a/build/pkgs/maxima/spkg-install b/build/pkgs/maxima/spkg-install
index 3c80e5c..b08d0d7 100755
--- a/build/pkgs/maxima/spkg-install
+++ b/build/pkgs/maxima/spkg-install
@@ -47,6 +47,7 @@ done
 echo
 echo "Now configuring Maxima..."
+./bootstrap
 ./configure --prefix="$SAGE_LOCAL" --libdir="$SAGE_LOCAL/lib" --enable-ecl git_found=false
 check_error "Failed to configure Maxima."
```


Bootstrapping should ideally be done by upstream. Alternatively, it should be done in `spkg-src`, but certainly not in `spkg-install`. Autotools are not a Sage prerequisite.



---

archive/issue_comments_254520.json:
```json
{
    "body": "Replying to [comment:13 dimpase]:\n> spkg-src is outdated anyway.\n\n[citation needed]",
    "created_at": "2015-07-26T12:53:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254520",
    "user": "jdemeyer"
}
```

Replying to [comment:13 dimpase]:
> spkg-src is outdated anyway.

[citation needed]



---

archive/issue_comments_254521.json:
```json
{
    "body": "Replying to [comment:27 jdemeyer]:\n> This is bad:\n> {{{\n> #!diff\n> diff --git a/build/pkgs/maxima/spkg-install b/build/pkgs/maxima/spkg-install\n> index 3c80e5c..b08d0d7 100755\n> --- a/build/pkgs/maxima/spkg-install\n> +++ b/build/pkgs/maxima/spkg-install\n> `@``@` -47,6 +47,7 `@``@` done\n>  echo\n>  echo \"Now configuring Maxima...\"\n> +./bootstrap\n>  ./configure --prefix=\"$SAGE_LOCAL\" --libdir=\"$SAGE_LOCAL/lib\" --enable-ecl git_found=false\n>  check_error \"Failed to configure Maxima.\"\n> }}}\n> \n> Bootstrapping should ideally be done by upstream. Alternatively, it should be done in `spkg-src`, but certainly not in `spkg-install`. Autotools are not a Sage prerequisite.\n\nI am acutely aware of this; upstream is not doing bootstrapping in the release in question.\nAlso, note that the ticket status is \"new\". I'll sort this out after the bigger issues are fixed.",
    "created_at": "2015-07-26T16:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254521",
    "user": "dimpase"
}
```

Replying to [comment:27 jdemeyer]:
> This is bad:
> {{{
> #!diff
> diff --git a/build/pkgs/maxima/spkg-install b/build/pkgs/maxima/spkg-install
> index 3c80e5c..b08d0d7 100755
> --- a/build/pkgs/maxima/spkg-install
> +++ b/build/pkgs/maxima/spkg-install
> `@``@` -47,6 +47,7 `@``@` done
>  echo
>  echo "Now configuring Maxima..."
> +./bootstrap
>  ./configure --prefix="$SAGE_LOCAL" --libdir="$SAGE_LOCAL/lib" --enable-ecl git_found=false
>  check_error "Failed to configure Maxima."
> }}}
> 
> Bootstrapping should ideally be done by upstream. Alternatively, it should be done in `spkg-src`, but certainly not in `spkg-install`. Autotools are not a Sage prerequisite.

I am acutely aware of this; upstream is not doing bootstrapping in the release in question.
Also, note that the ticket status is "new". I'll sort this out after the bigger issues are fixed.



---

archive/issue_comments_254522.json:
```json
{
    "body": "Replying to [comment:28 jdemeyer]:\n> Replying to [comment:13 dimpase]:\n> > spkg-src is outdated anyway.\n> \n> [citation needed]\nI meant to say that parts of this spkg-src need an update.",
    "created_at": "2015-07-27T08:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254522",
    "user": "dimpase"
}
```

Replying to [comment:28 jdemeyer]:
> Replying to [comment:13 dimpase]:
> > spkg-src is outdated anyway.
> 
> [citation needed]
I meant to say that parts of this spkg-src need an update.



---

archive/issue_comments_254523.json:
```json
{
    "body": "with sf.net back online, one finds there version 5.36.1. Not sure yet how much different it is from 5.36.0.1, which is not official...\n\n5.36.1 has the same issue with too many ()...",
    "created_at": "2015-07-28T15:40:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254523",
    "user": "dimpase"
}
```

with sf.net back online, one finds there version 5.36.1. Not sure yet how much different it is from 5.36.0.1, which is not official...

5.36.1 has the same issue with too many ()...



---

archive/issue_comments_254524.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-07-28T21:29:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254524",
    "user": "dimpase"
}
```

New commits:



---

archive/issue_comments_254525.json:
```json
{
    "body": "I've split the update of ECL to a separate ticket #18961, as it is ready.",
    "created_at": "2015-07-28T22:26:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254525",
    "user": "dimpase"
}
```

I've split the update of ECL to a separate ticket #18961, as it is ready.



---

archive/issue_comments_254526.json:
```json
{
    "body": "Replying to [comment:24 nbruin]:\n> Replying to [comment:23 dimpase]:\n \n> The binary conversion `sr_to_max` in `maxima_lib.py`  shouldn't be affected, unless they have changed their internal representation of polylogarithms.\n\nThey say the change is a [by-product to fix another bug](http://sourceforge.net/p/maxima/bugs/2998/#09b6). Obviously it is a low priority for them to make the output backwards compatible. I wonder if we should just fully switch to `maxima_lib.py` and do not try to deal with this in some other way?",
    "created_at": "2015-08-01T08:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254526",
    "user": "dimpase"
}
```

Replying to [comment:24 nbruin]:
> Replying to [comment:23 dimpase]:
 
> The binary conversion `sr_to_max` in `maxima_lib.py`  shouldn't be affected, unless they have changed their internal representation of polylogarithms.

They say the change is a [by-product to fix another bug](http://sourceforge.net/p/maxima/bugs/2998/#09b6). Obviously it is a low priority for them to make the output backwards compatible. I wonder if we should just fully switch to `maxima_lib.py` and do not try to deal with this in some other way?



---

archive/issue_comments_254527.json:
```json
{
    "body": "Replying to [comment:34 dimpase]:\n> They say the change is a [by-product to fix another bug](http://sourceforge.net/p/maxima/bugs/2998/#09b6). Obviously it is a low priority for them to make the output backwards compatible. I wonder if we should just fully switch to `maxima_lib.py` and do not try to deal with this in some other way?\n\nRobert isn't making any statement there about priority. I would not think it's a very low priority, because the current behaviour is tantamount to writing `(sin)(x)`, which is silly. I would not be surprised if in the next couple of weeks, when he has had a chance to think about a solution, he will have a fix. I'm sure it's not hard to fix. It just needs some thought to fix it properly and efficiently.\n\nIn terms of total amount of work, I would think introducing \"curried\" poylog and psi will be less work than eliminating any dependence on string parsing from maxima.\n\nFor calculus use, we're already moved entirely to maxima_lib. The library instance just allows two interfaces back and forth: a strings-based one and the binary `sr_to_max` and `max_to_sr` one.\nMoving calculus entirely to `sr_to_max` is a nice idea in general, and that's a worthwhile project that should be quite doable (we're halfway there already and it didn't take much work to do that).\nIt would mean identifying all remaining places where calculus triggers string conversions and replace those sites with mechanisms comparable to sr_integral, sr_limit, sr_sum etc.\n\nI think it's worthwhile if somehow we do maintain the pexpect interface to maxima as well, even if we don't need it for the calculus functionality in sage proper (and since the strings-based interface in maxima_lib shares nearly all its code with that, we might as well keep that too). Having the pexpect interfaces in sage is a useful feature for communicating with other computer algebra systems.",
    "created_at": "2015-08-01T20:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254527",
    "user": "nbruin"
}
```

Replying to [comment:34 dimpase]:
> They say the change is a [by-product to fix another bug](http://sourceforge.net/p/maxima/bugs/2998/#09b6). Obviously it is a low priority for them to make the output backwards compatible. I wonder if we should just fully switch to `maxima_lib.py` and do not try to deal with this in some other way?

Robert isn't making any statement there about priority. I would not think it's a very low priority, because the current behaviour is tantamount to writing `(sin)(x)`, which is silly. I would not be surprised if in the next couple of weeks, when he has had a chance to think about a solution, he will have a fix. I'm sure it's not hard to fix. It just needs some thought to fix it properly and efficiently.

In terms of total amount of work, I would think introducing "curried" poylog and psi will be less work than eliminating any dependence on string parsing from maxima.

For calculus use, we're already moved entirely to maxima_lib. The library instance just allows two interfaces back and forth: a strings-based one and the binary `sr_to_max` and `max_to_sr` one.
Moving calculus entirely to `sr_to_max` is a nice idea in general, and that's a worthwhile project that should be quite doable (we're halfway there already and it didn't take much work to do that).
It would mean identifying all remaining places where calculus triggers string conversions and replace those sites with mechanisms comparable to sr_integral, sr_limit, sr_sum etc.

I think it's worthwhile if somehow we do maintain the pexpect interface to maxima as well, even if we don't need it for the calculus functionality in sage proper (and since the strings-based interface in maxima_lib shares nearly all its code with that, we might as well keep that too). Having the pexpect interfaces in sage is a useful feature for communicating with other computer algebra systems.



---

archive/issue_comments_254528.json:
```json
{
    "body": "Replying to [comment:35 nbruin]:\n> Replying to [comment:34 dimpase]:\n> > They say the change is a [by-product to fix another bug](http://sourceforge.net/p/maxima/bugs/2998/#09b6). Obviously it is a low priority for them to make the output backwards compatible. I wonder if we should just fully switch to `maxima_lib.py` and do not try to deal with this in some other way?\n> \n> Robert isn't making any statement there about priority. I would not think it's a very low priority, because the current behaviour is tantamount to writing `(sin)(x)`, which is silly. I would not be surprised if in the next couple of weeks, when he has had a chance to think about a solution, he will have a fix. I'm sure it's not hard to fix. It just needs some thought to fix it properly and efficiently.\n> \nhe replied, saying that he does not see a way to fix this, and that Sage has to put up with this for the time being. \n\nI'd rather see this fixed im maxima, of course, but this is probably a nontrivial job for a Lisp hacker we don't have...",
    "created_at": "2015-08-04T08:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254528",
    "user": "dimpase"
}
```

Replying to [comment:35 nbruin]:
> Replying to [comment:34 dimpase]:
> > They say the change is a [by-product to fix another bug](http://sourceforge.net/p/maxima/bugs/2998/#09b6). Obviously it is a low priority for them to make the output backwards compatible. I wonder if we should just fully switch to `maxima_lib.py` and do not try to deal with this in some other way?
> 
> Robert isn't making any statement there about priority. I would not think it's a very low priority, because the current behaviour is tantamount to writing `(sin)(x)`, which is silly. I would not be surprised if in the next couple of weeks, when he has had a chance to think about a solution, he will have a fix. I'm sure it's not hard to fix. It just needs some thought to fix it properly and efficiently.
> 
he replied, saying that he does not see a way to fix this, and that Sage has to put up with this for the time being. 

I'd rather see this fixed im maxima, of course, but this is probably a nontrivial job for a Lisp hacker we don't have...



---

archive/issue_comments_254529.json:
```json
{
    "body": "Quick workaround:\n\n```\necl_eval(\"(defprop $LI 210 rbp)\")\necl_eval(\"(defprop $PSI 210 rbp)\")\n```\n\nit certainly avoids the extra parentheses around `li` and `psi` invocations. I've reported this workaround on the maxima bugtracker too. Hopefully Robert will comment there about any possible adverse effects. Including these statements in the maxima_calculus initialization in `maxima_lib.py` might do the trick (and possibly the change is accepted upstream!)\n\n**EDIT:** A better and more universal change is probably:\n\n```\necl_eval(\"(defprop MFUNCTION 190 lbp)\")\n```\n\nThis way it applies to all \"MQAPPLY\" calls. That could be problematic, of course, but it doesn't seem to be, probably because 190 is still high enough. Things go wrong if you go too low:\n\n```\nsage: maxima_calculus(\"(a+b)(t)\")\n(b+a)(t)\nsage: ecl_eval(\"(defprop MFUNCTION 1 lbp)\")\n<ECL: 1>\nsage: maxima_calculus(\"(a+b)(t)\")\nb+a(t)\n```\n",
    "created_at": "2015-08-04T23:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254529",
    "user": "nbruin"
}
```

Quick workaround:

```
ecl_eval("(defprop $LI 210 rbp)")
ecl_eval("(defprop $PSI 210 rbp)")
```

it certainly avoids the extra parentheses around `li` and `psi` invocations. I've reported this workaround on the maxima bugtracker too. Hopefully Robert will comment there about any possible adverse effects. Including these statements in the maxima_calculus initialization in `maxima_lib.py` might do the trick (and possibly the change is accepted upstream!)

**EDIT:** A better and more universal change is probably:

```
ecl_eval("(defprop MFUNCTION 190 lbp)")
```

This way it applies to all "MQAPPLY" calls. That could be problematic, of course, but it doesn't seem to be, probably because 190 is still high enough. Things go wrong if you go too low:

```
sage: maxima_calculus("(a+b)(t)")
(b+a)(t)
sage: ecl_eval("(defprop MFUNCTION 1 lbp)")
<ECL: 1>
sage: maxima_calculus("(a+b)(t)")
b+a(t)
```




---

archive/issue_comments_254530.json:
```json
{
    "body": "Of course, the expression type that gets constructed for `li` and `psi` is more general:\n\n```\nsage: maxima_calculus(\"a[1](x)\")\na[1](x)\nsage: maxima_calculus(\"a[1](x)\").ecl()\n<ECL: ((MQAPPLY SIMP) (($A SIMP ARRAY) 1) $X)>\n```\n\nbut we already fail with that (because we carefully only convert `li[` and `psi[`):\n\n```\nsage: SR(maxima_calculus(\"a[1](x)\"))\nTypeError: unable to make sense of Maxima expression 'a[1](x)' in Sage\n```\n\nSince square brackets are really part of Maxima's expression syntax, the proper solution would be to have a parser that can handle them. The following seems valid maxima:\n\n```\nsage: maxima_calculus(\"(sin(x)+cos(y))[tan(u)[3/(a+b)]+log(w)](t)\")\n(cos(y)+sin(x))[log(w)+tan(u)[3/(b+a)]](t)\n```\n\nand parsing that with anything less than parser support for `[` will be. Of course, without `[]` support on the side of pynac, we'd have to parse `a[n]` to something like `get_item(a,n)` but that would be fine (and then `get_item` can have the right logic to actually resolve in relevant cases, but this would be more an extension of our symbolic expressions before it's a parsing issue for maxima)",
    "created_at": "2015-08-05T20:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254530",
    "user": "nbruin"
}
```

Of course, the expression type that gets constructed for `li` and `psi` is more general:

```
sage: maxima_calculus("a[1](x)")
a[1](x)
sage: maxima_calculus("a[1](x)").ecl()
<ECL: ((MQAPPLY SIMP) (($A SIMP ARRAY) 1) $X)>
```

but we already fail with that (because we carefully only convert `li[` and `psi[`):

```
sage: SR(maxima_calculus("a[1](x)"))
TypeError: unable to make sense of Maxima expression 'a[1](x)' in Sage
```

Since square brackets are really part of Maxima's expression syntax, the proper solution would be to have a parser that can handle them. The following seems valid maxima:

```
sage: maxima_calculus("(sin(x)+cos(y))[tan(u)[3/(a+b)]+log(w)](t)")
(cos(y)+sin(x))[log(w)+tan(u)[3/(b+a)]](t)
```

and parsing that with anything less than parser support for `[` will be. Of course, without `[]` support on the side of pynac, we'd have to parse `a[n]` to something like `get_item(a,n)` but that would be fine (and then `get_item` can have the right logic to actually resolve in relevant cases, but this would be more an extension of our symbolic expressions before it's a parsing issue for maxima)



---

archive/issue_comments_254531.json:
```json
{
    "body": "The maxima ticket [https://sourceforge.net/p/maxima/bugs/2998/](https://sourceforge.net/p/maxima/bugs/2998/) is now marked as resolved, so with any luck, the extra parentheses issue will not occur with the new maxima release.\n\nThe fix implemented is indeed `ecl_eval(\"(defprop MFUNCTION 190 lbp)\")`, so if you do not want to wait for the next maxima release, just put this command in the initialization section of `maxima_lib`.",
    "created_at": "2015-08-11T19:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254531",
    "user": "nbruin"
}
```

The maxima ticket [https://sourceforge.net/p/maxima/bugs/2998/](https://sourceforge.net/p/maxima/bugs/2998/) is now marked as resolved, so with any luck, the extra parentheses issue will not occur with the new maxima release.

The fix implemented is indeed `ecl_eval("(defprop MFUNCTION 190 lbp)")`, so if you do not want to wait for the next maxima release, just put this command in the initialization section of `maxima_lib`.



---

archive/issue_comments_254532.json:
```json
{
    "body": "I tried upgrading to Maxima 5.37.0 (released 17 August).  The formatting problem is fixed, although some of the output still looks slightly different (more/fewer parentheses, different ordering of terms in some polynomials).\n\nHowever, there is a serious bug in the function `eigenvectors` causing too few eigenvectors to be returned:\n\n```\n(%i1) M: matrix([1, 1, 0], [0, 1, 0], [0, 0, 2]);\n                                  [ 1  1  0 ]\n                                  [         ]\n(%o1)                             [ 0  1  0 ]\n                                  [         ]\n                                  [ 0  0  2 ]\n```\n\nMaxima 5.35.1 computes the eigenvalues and eigenvectors correctly:\n\n```\n(%i2) eigenvectors(M);\n(%o2)           [[[1, 2], [2, 1]], [[[1, 0, 0]], [[0, 0, 1]]]]\n```\n\nIn Maxima 5.37.0, the eigenvector `[0, 0, 1]` is missing:\n\n```\n(%i2) eigenvectors(M);\n(%o2)                  [[[1, 2], [2, 1]], [[[1, 0, 0]]]]\n```\n\nI found this out through several doctest failures in Sage.",
    "created_at": "2015-08-28T21:50:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254532",
    "user": "pbruin"
}
```

I tried upgrading to Maxima 5.37.0 (released 17 August).  The formatting problem is fixed, although some of the output still looks slightly different (more/fewer parentheses, different ordering of terms in some polynomials).

However, there is a serious bug in the function `eigenvectors` causing too few eigenvectors to be returned:

```
(%i1) M: matrix([1, 1, 0], [0, 1, 0], [0, 0, 2]);
                                  [ 1  1  0 ]
                                  [         ]
(%o1)                             [ 0  1  0 ]
                                  [         ]
                                  [ 0  0  2 ]
```

Maxima 5.35.1 computes the eigenvalues and eigenvectors correctly:

```
(%i2) eigenvectors(M);
(%o2)           [[[1, 2], [2, 1]], [[[1, 0, 0]], [[0, 0, 1]]]]
```

In Maxima 5.37.0, the eigenvector `[0, 0, 1]` is missing:

```
(%i2) eigenvectors(M);
(%o2)                  [[[1, 2], [2, 1]], [[[1, 0, 0]]]]
```

I found this out through several doctest failures in Sage.



---

archive/issue_comments_254533.json:
```json
{
    "body": "Upstream bug report: https://sourceforge.net/p/maxima/bugs/3008/",
    "created_at": "2015-08-28T22:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254533",
    "user": "pbruin"
}
```

Upstream bug report: https://sourceforge.net/p/maxima/bugs/3008/



---

archive/issue_comments_254534.json:
```json
{
    "body": "It seems that version 5.38 was released a few months ago, and we are currently at 5.35.1. I think we can upgrade now since the reported bug was fixed.",
    "created_at": "2016-07-02T18:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254534",
    "user": "tscrim"
}
```

It seems that version 5.38 was released a few months ago, and we are currently at 5.35.1. I think we can upgrade now since the reported bug was fixed.



---

archive/issue_comments_254535.json:
```json
{
    "body": "Replying to [comment:42 tscrim]:\n> It seems that version 5.38 was released a few months ago, and we are currently at 5.35.1. I think we can upgrade now since the reported bug was fixed.\nNote that the bug fix is only in the development branch, not in 5.38.1.  We can of course add the relevant upstream commit (3e4e107) as a patch.",
    "created_at": "2016-07-04T08:29:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254535",
    "user": "pbruin"
}
```

Replying to [comment:42 tscrim]:
> It seems that version 5.38 was released a few months ago, and we are currently at 5.35.1. I think we can upgrade now since the reported bug was fixed.
Note that the bug fix is only in the development branch, not in 5.38.1.  We can of course add the relevant upstream commit (3e4e107) as a patch.



---

archive/issue_comments_254536.json:
```json
{
    "body": "Shall we then move forward then with upgrading to 5.38.1 with backporting 3e4e107 as a patch? Or should we ask the Maxima team to see how close they are to cutting a 5.38.2?",
    "created_at": "2016-08-26T20:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254536",
    "user": "tscrim"
}
```

Shall we then move forward then with upgrading to 5.38.1 with backporting 3e4e107 as a patch? Or should we ask the Maxima team to see how close they are to cutting a 5.38.2?



---

archive/issue_comments_254537.json:
```json
{
    "body": "it's about time. Should I have a go at it?",
    "created_at": "2016-08-29T10:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254537",
    "user": "dimpase"
}
```

it's about time. Should I have a go at it?



---

archive/issue_comments_254538.json:
```json
{
    "body": "Please do. We have to make sagemath 7.4 work with maxima 5.38.1 in Debian and it would help if we had a patch that we could backport.",
    "created_at": "2016-10-27T12:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254538",
    "user": "thansen"
}
```

Please do. We have to make sagemath 7.4 work with maxima 5.38.1 in Debian and it would help if we had a patch that we could backport.



---

archive/issue_comments_254539.json:
```json
{
    "body": "Dima, can you rebase your branch?",
    "created_at": "2016-10-27T21:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254539",
    "user": "fbissey"
}
```

Dima, can you rebase your branch?



---

archive/issue_comments_254540.json:
```json
{
    "body": "Will try later today.",
    "created_at": "2016-10-27T21:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254540",
    "user": "dimpase"
}
```

Will try later today.



---

archive/issue_comments_254541.json:
```json
{
    "body": "rebased the relevant patches\n----\nNew commits:",
    "created_at": "2016-10-27T23:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254541",
    "user": "dimpase"
}
```

rebased the relevant patches
----
New commits:



---

archive/issue_comments_254542.json:
```json
{
    "body": "So far, only the relevant commits from the old branch are rebased. I still have to fix patches to Maxima sources -- they don't apply cleanly.",
    "created_at": "2016-10-28T00:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254542",
    "user": "dimpase"
}
```

So far, only the relevant commits from the old branch are rebased. I still have to fix patches to Maxima sources -- they don't apply cleanly.



---

archive/issue_comments_254543.json:
```json
{
    "body": "We'll also want to move to maxima 5.38.1 at least.",
    "created_at": "2016-10-28T01:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254543",
    "user": "fbissey"
}
```

We'll also want to move to maxima 5.38.1 at least.



---

archive/issue_comments_254544.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-28T02:57:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254544",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254545.json:
```json
{
    "body": "this seems to be a change:\n\n```\nFile \"src/sage/interfaces/maxima.py\", line 210, in sage.interfaces.maxima\nFailed example:\n    g.taylor('x', 0, 3)\nExpected:\n    x+x^3/6+(3*x^5)/40+(5*x^7)/112+(35*x^9)/1152\nGot:\n    f/(k^4*x^4)-(2*f)/((3*k^2)*x^2)+(11*f)/45-((62*k^2*f)*x^2)/945\n```\n\nthere `f` is defined as `f=maxima(`1/x^2`)`, so this no longer works, defining maxima\nfunctions this way.\n\nAnyhow, I'm pushing the other doctest changes for this file, and few other.",
    "created_at": "2016-10-28T05:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254545",
    "user": "dimpase"
}
```

this seems to be a change:

```
File "src/sage/interfaces/maxima.py", line 210, in sage.interfaces.maxima
Failed example:
    g.taylor('x', 0, 3)
Expected:
    x+x^3/6+(3*x^5)/40+(5*x^7)/112+(35*x^9)/1152
Got:
    f/(k^4*x^4)-(2*f)/((3*k^2)*x^2)+(11*f)/45-((62*k^2*f)*x^2)/945
```

there `f` is defined as `f=maxima(`1/x^2`)`, so this no longer works, defining maxima
functions this way.

Anyhow, I'm pushing the other doctest changes for this file, and few other.



---

archive/issue_comments_254546.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-28T05:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254546",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254547.json:
```json
{
    "body": "the following looks to me like a regression (or perhaps it's not really, as if one picked the right branches of the corresponding complex variable functions, it would be correct) :\n\n```\nFile \"src/sage/calculus/tests.py\", line 107, in sage.calculus.tests\nFailed example:\n    integrate(log(1-x^2)/x, x)\nExpected:\n    1/2*log(x^2)*log(-x^2 + 1) + 1/2*polylog(2, -x^2 + 1)\nGot:\n    log(-x)*log(x + 1) + log(x)*log(-x + 1) + polylog(2, x + 1) + polylog(2, -x + 1)\n```\n\n----\nNew commits:",
    "created_at": "2016-10-28T13:01:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254547",
    "user": "dimpase"
}
```

the following looks to me like a regression (or perhaps it's not really, as if one picked the right branches of the corresponding complex variable functions, it would be correct) :

```
File "src/sage/calculus/tests.py", line 107, in sage.calculus.tests
Failed example:
    integrate(log(1-x^2)/x, x)
Expected:
    1/2*log(x^2)*log(-x^2 + 1) + 1/2*polylog(2, -x^2 + 1)
Got:
    log(-x)*log(x + 1) + log(x)*log(-x + 1) + polylog(2, x + 1) + polylog(2, -x + 1)
```

----
New commits:



---

archive/issue_comments_254548.json:
```json
{
    "body": "and another regression of sorts: despite `besselexpand` set to False, one gets\n\n```\nFile \"src/sage/interfaces/maxima_lib.py\", line 66, in sage.interfaces.maxima_lib\nFailed example:\n    sum((-x)^n/(factorial(n)*factorial(n+3/2)),n,0,oo)\nExpected:\n    bessel_J(3/2, 2*sqrt(x))/x^(3/4)\nGot:\n    -1/2*(2*x*cos(2*sqrt(x)) - sqrt(x)*sin(2*sqrt(x)))/(sqrt(pi)*x^2)\n```\n\n\nPerhaps it's a deficiency of our test, which is too simple for `besselexpand` to kick in.",
    "created_at": "2016-10-28T13:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254548",
    "user": "dimpase"
}
```

and another regression of sorts: despite `besselexpand` set to False, one gets

```
File "src/sage/interfaces/maxima_lib.py", line 66, in sage.interfaces.maxima_lib
Failed example:
    sum((-x)^n/(factorial(n)*factorial(n+3/2)),n,0,oo)
Expected:
    bessel_J(3/2, 2*sqrt(x))/x^(3/4)
Got:
    -1/2*(2*x*cos(2*sqrt(x)) - sqrt(x)*sin(2*sqrt(x)))/(sqrt(pi)*x^2)
```


Perhaps it's a deficiency of our test, which is too simple for `besselexpand` to kick in.



---

archive/issue_comments_254549.json:
```json
{
    "body": "this one needs work:\n\n```\nFile \"src/sage/interfaces/maxima_lib.py\", line 724, in sage.interfaces.maxima_lib.Ma\nximaLib.sr_integral\nFailed example:\n    integrate(1 / (1 + abs(x-5)), x, -5, 6)\nException raised:\n    Traceback (most recent call last):\n    ...\n    TypeError: unable to make sense of Maxima expression 'limit(if(-(_SAGE_VAR_x-5)>0,-log(6-_SAGE_VAR_x),log(abs(_SAGE_VAR_x-4))),_SAGE_VAR_x,-5,plus)' in Sage\n```\n",
    "created_at": "2016-10-28T13:25:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254549",
    "user": "dimpase"
}
```

this one needs work:

```
File "src/sage/interfaces/maxima_lib.py", line 724, in sage.interfaces.maxima_lib.Ma
ximaLib.sr_integral
Failed example:
    integrate(1 / (1 + abs(x-5)), x, -5, 6)
Exception raised:
    Traceback (most recent call last):
    ...
    TypeError: unable to make sense of Maxima expression 'limit(if(-(_SAGE_VAR_x-5)>0,-log(6-_SAGE_VAR_x),log(abs(_SAGE_VAR_x-4))),_SAGE_VAR_x,-5,plus)' in Sage
```




---

archive/issue_comments_254550.json:
```json
{
    "body": "and this one is puzzling on the Sage side:\n\n```\nFile \"src/sage/misc/functional.py\", line 658, in sage.misc.functional.integral\nFailed example:\n    _ = integrate(y, x, -1000, 1000)\nException raised:\n...\n    FloatingPointError: Floating point exception\n```\n\nand comes from a regression in Maxima/ECL version combo (I did check that with Maxima 5.38.1 running on SBCL 1.3.6 this integral computes just fine).\n\n```\nMaxima 5.38.1 http://maxima.sourceforge.net\nusing Lisp ECL 16.1.2\nDistributed under the GNU Public License. See the file COPYING.\nDedicated to the memory of William Schelter.\nThe function bug_report() provides bug reporting information.\n(%i1) integrate((x^2)*exp(x) / (1 + exp(x))^2,x,-1000,1000);\n\nMaxima encountered a Lisp error:\n\n #<a ARITHMETIC-ERROR>\n\nAutomatically continuing.\nTo enable the Lisp debugger set *debugger-hook* to nil.\n```\n",
    "created_at": "2016-10-28T13:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254550",
    "user": "dimpase"
}
```

and this one is puzzling on the Sage side:

```
File "src/sage/misc/functional.py", line 658, in sage.misc.functional.integral
Failed example:
    _ = integrate(y, x, -1000, 1000)
Exception raised:
...
    FloatingPointError: Floating point exception
```

and comes from a regression in Maxima/ECL version combo (I did check that with Maxima 5.38.1 running on SBCL 1.3.6 this integral computes just fine).

```
Maxima 5.38.1 http://maxima.sourceforge.net
using Lisp ECL 16.1.2
Distributed under the GNU Public License. See the file COPYING.
Dedicated to the memory of William Schelter.
The function bug_report() provides bug reporting information.
(%i1) integrate((x^2)*exp(x) / (1 + exp(x))^2,x,-1000,1000);

Maxima encountered a Lisp error:

 #<a ARITHMETIC-ERROR>

Automatically continuing.
To enable the Lisp debugger set *debugger-hook* to nil.
```




---

archive/issue_comments_254551.json:
```json
{
    "body": "this one needs an expert opinion:\n\n```\nFile \"src/sage/schemes/projective/projective_morphism.py\", line 853, in sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.dynatomic_polynomial\nFailed example:\n    f.dynatomic_polynomial(2)\nExpected:\n    0.666666666666667*x^2 + 0.333333333333333*y^2\nGot:\n    2.00000000000000*x^2 + 0.999999999999999*y^2\n```\n\nThe output is clearly different, but perhaps it's OK, I don't know---I suspect it's OK, as we must be interested in the projective points where it vanishes(?) - documentation talks about \"roots\" though, and these, projectively, remain the same.",
    "created_at": "2016-10-28T13:34:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254551",
    "user": "dimpase"
}
```

this one needs an expert opinion:

```
File "src/sage/schemes/projective/projective_morphism.py", line 853, in sage.schemes.projective.projective_morphism.SchemeMorphism_polynomial_projective_space.dynatomic_polynomial
Failed example:
    f.dynatomic_polynomial(2)
Expected:
    0.666666666666667*x^2 + 0.333333333333333*y^2
Got:
    2.00000000000000*x^2 + 0.999999999999999*y^2
```

The output is clearly different, but perhaps it's OK, I don't know---I suspect it's OK, as we must be interested in the projective points where it vanishes(?) - documentation talks about "roots" though, and these, projectively, remain the same.



---

archive/issue_comments_254552.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-28T13:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254552",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254553.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-28T13:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254553",
    "user": "dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_254554.json:
```json
{
    "body": "setting this to \"needs review\", so that the issues I raised in comments can be discussed.\n\nThere are still few easy doctest fixes to be done, I'll do them.",
    "created_at": "2016-10-28T13:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254554",
    "user": "dimpase"
}
```

setting this to "needs review", so that the issues I raised in comments can be discussed.

There are still few easy doctest fixes to be done, I'll do them.



---

archive/issue_comments_254555.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-10-28T15:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254555",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_254556.json:
```json
{
    "body": "Replying to [comment:60 dimpase]:\n\n>  regression in Maxima/ECL version combo (I did check that with Maxima 5.38.1 running on SBCL 1.3.6 this integral computes just fine).\n\nI opened https://sourceforge.net/p/maxima/bugs/3235/",
    "created_at": "2016-10-29T00:06:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254556",
    "user": "dimpase"
}
```

Replying to [comment:60 dimpase]:

>  regression in Maxima/ECL version combo (I did check that with Maxima 5.38.1 running on SBCL 1.3.6 this integral computes just fine).

I opened https://sourceforge.net/p/maxima/bugs/3235/



---

archive/issue_comments_254557.json:
```json
{
    "body": "Replying to [comment:65 dimpase]:\n> Replying to [comment:60 dimpase]:\n> \n> >  regression in Maxima/ECL version combo (I did check that with Maxima 5.38.1 running on SBCL 1.3.6 this integral computes just fine).\n> \n> I opened https://sourceforge.net/p/maxima/bugs/3235/\nRobert Dodier has traced this down to a problem with ECL, see\nhttps://gitlab.com/embeddable-common-lisp/ecl/issues/299\n\nECL has a problem comparing their own (there is no Common Lisp standard for this)\ninfinity constants with 1/1000000...",
    "created_at": "2016-10-30T18:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254557",
    "user": "dimpase"
}
```

Replying to [comment:65 dimpase]:
> Replying to [comment:60 dimpase]:
> 
> >  regression in Maxima/ECL version combo (I did check that with Maxima 5.38.1 running on SBCL 1.3.6 this integral computes just fine).
> 
> I opened https://sourceforge.net/p/maxima/bugs/3235/
Robert Dodier has traced this down to a problem with ECL, see
https://gitlab.com/embeddable-common-lisp/ecl/issues/299

ECL has a problem comparing their own (there is no Common Lisp standard for this)
infinity constants with 1/1000000...



---

archive/issue_comments_254558.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-03T17:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254558",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254559.json:
```json
{
    "body": "Replying to [comment:66 dimpase]:\n> Replying to [comment:65 dimpase]:\n> > Replying to [comment:60 dimpase]:\n> > \n> > >  regression in Maxima/ECL version combo (I did check that with Maxima 5.38.1 running on SBCL 1.3.6 this integral computes just fine).\n> > \n> > I opened https://sourceforge.net/p/maxima/bugs/3235/\n> Robert Dodier has traced this down to a problem with ECL, see\n> https://gitlab.com/embeddable-common-lisp/ecl/issues/299\n> \n> ECL has a problem comparing their own (there is no Common Lisp standard for this)\n> infinity constants with 1/1000000...\n> \nthis is fixed by Maxima people, and in the latest commit 100d9d6",
    "created_at": "2016-11-03T17:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254559",
    "user": "dimpase"
}
```

Replying to [comment:66 dimpase]:
> Replying to [comment:65 dimpase]:
> > Replying to [comment:60 dimpase]:
> > 
> > >  regression in Maxima/ECL version combo (I did check that with Maxima 5.38.1 running on SBCL 1.3.6 this integral computes just fine).
> > 
> > I opened https://sourceforge.net/p/maxima/bugs/3235/
> Robert Dodier has traced this down to a problem with ECL, see
> https://gitlab.com/embeddable-common-lisp/ecl/issues/299
> 
> ECL has a problem comparing their own (there is no Common Lisp standard for this)
> infinity constants with 1/1000000...
> 
this is fixed by Maxima people, and in the latest commit 100d9d6



---

archive/issue_comments_254560.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-06T22:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254560",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254561.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-07T00:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254561",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254562.json:
```json
{
    "body": "Replying to [comment:67 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[5d86413](https://git.sagemath.org/sage.git/commit/?id=5d864132139af098f417debdf28c2e4c83cd1d75)||`Merge branch 'public/t18920' of trac.sagemath.org:sage into max5381`||\n> ||[100d9d6](https://git.sagemath.org/sage.git/commit/?id=100d9d6516e4bcfbb93ee979f086f52072ace786)||`workaround for #<a ARITHMETIC-ERROR> (18920#comment:60`||\n\nthis workaround turned out to be buggy, and anyway ECL has released a fix for this problem, making the workaround not necessary. (But it would need an update of our ECL package, as it does depend upon a number of changes, see https://gitlab.com/embeddable-common-lisp/ecl/issues/299; they promise a new release by the end of the year). \n\nShould we wait, or should we proceed?",
    "created_at": "2016-11-08T13:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254562",
    "user": "dimpase"
}
```

Replying to [comment:67 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[5d86413](https://git.sagemath.org/sage.git/commit/?id=5d864132139af098f417debdf28c2e4c83cd1d75)||`Merge branch 'public/t18920' of trac.sagemath.org:sage into max5381`||
> ||[100d9d6](https://git.sagemath.org/sage.git/commit/?id=100d9d6516e4bcfbb93ee979f086f52072ace786)||`workaround for #<a ARITHMETIC-ERROR> (18920#comment:60`||

this workaround turned out to be buggy, and anyway ECL has released a fix for this problem, making the workaround not necessary. (But it would need an update of our ECL package, as it does depend upon a number of changes, see https://gitlab.com/embeddable-common-lisp/ecl/issues/299; they promise a new release by the end of the year). 

Should we wait, or should we proceed?



---

archive/issue_comments_254563.json:
```json
{
    "body": "I think we should either backport the fix as a patch to ECL or perhaps take a development cut.",
    "created_at": "2016-11-08T15:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254563",
    "user": "tscrim"
}
```

I think we should either backport the fix as a patch to ECL or perhaps take a development cut.



---

archive/issue_comments_254564.json:
```json
{
    "body": "I would go for the first option which looks easier: just put the ECL patch into `build/pkgs/ecl/patches`.",
    "created_at": "2016-11-08T15:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254564",
    "user": "jpflori"
}
```

I would go for the first option which looks easier: just put the ECL patch into `build/pkgs/ecl/patches`.



---

archive/issue_comments_254565.json:
```json
{
    "body": "There is the issue that you have to force an ECL rebuild. Add a `p(n+1)` suffix in `package-version.txt`?",
    "created_at": "2016-11-08T15:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254565",
    "user": "jpflori"
}
```

There is the issue that you have to force an ECL rebuild. Add a `p(n+1)` suffix in `package-version.txt`?



---

archive/issue_comments_254566.json:
```json
{
    "body": "Replying to [comment:73 jpflori]:\n> I would go for the first option which looks easier: just put the ECL patch into `build/pkgs/ecl/patches`.\n\na single patch is not  enough. In fact, it hangs the ECL build if I do this. ECL people say the have worked on a number of related things, that is support of IEEE floats, since the release, so the latest fix relies on these. A proper ECL update is the only way I think.",
    "created_at": "2016-11-08T15:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254566",
    "user": "dimpase"
}
```

Replying to [comment:73 jpflori]:
> I would go for the first option which looks easier: just put the ECL patch into `build/pkgs/ecl/patches`.

a single patch is not  enough. In fact, it hangs the ECL build if I do this. ECL people say the have worked on a number of related things, that is support of IEEE floats, since the release, so the latest fix relies on these. A proper ECL update is the only way I think.



---

archive/issue_comments_254567.json:
```json
{
    "body": "We may have to wait. I could try a git snapshot in sage-on-gentoo to see how things are going but I am overloaded as it is. I have to draw the line somewhere.",
    "created_at": "2016-11-08T22:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254567",
    "user": "fbissey"
}
```

We may have to wait. I could try a git snapshot in sage-on-gentoo to see how things are going but I am overloaded as it is. I have to draw the line somewhere.



---

archive/issue_comments_254568.json:
```json
{
    "body": "Hi, we're following this ticket very closely in Debian. I notice that the following two patches are still applicable to 5.38.1:\n\n* https://git.sagemath.org/sage.git/tree/build/pkgs/maxima/patches/0001-taylor2-Avoid-blowing-the-stack-when-diff-expand-isn.patch\n* https://git.sagemath.org/sage.git/tree/build/pkgs/maxima/patches/matrixexp.patch\n\nHave these patches been forwarded upstream yet? Would they be suitable for other users of Maxima, or are they only useful for Sage?",
    "created_at": "2016-11-12T19:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254568",
    "user": "infinity0"
}
```

Hi, we're following this ticket very closely in Debian. I notice that the following two patches are still applicable to 5.38.1:

* https://git.sagemath.org/sage.git/tree/build/pkgs/maxima/patches/0001-taylor2-Avoid-blowing-the-stack-when-diff-expand-isn.patch
* https://git.sagemath.org/sage.git/tree/build/pkgs/maxima/patches/matrixexp.patch

Have these patches been forwarded upstream yet? Would they be suitable for other users of Maxima, or are they only useful for Sage?



---

archive/issue_comments_254569.json:
```json
{
    "body": "Replying to [comment:77 infinity0]:\n> Hi, we're following this ticket very closely in Debian. I notice that the following two patches are still applicable to 5.38.1:\n> \n> * https://git.sagemath.org/sage.git/tree/build/pkgs/maxima/patches/0001-taylor2-Avoid-blowing-the-stack-when-diff-expand-isn.patch\n\nthis one comes from upstream, from here: https://sourceforge.net/p/maxima/bugs/2520/#e3a5\n(so it's sort of unfinished digging on the maxima side; it's definitely useful outside of Sage)\n\n\n\n> * https://git.sagemath.org/sage.git/tree/build/pkgs/maxima/patches/matrixexp.patch\n> \nthis is also from upstream (updated somewhat):\nhttps://sourceforge.net/p/maxima/bugs/2596/\n\nagain, upstream still has it open.",
    "created_at": "2016-11-13T22:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254569",
    "user": "dimpase"
}
```

Replying to [comment:77 infinity0]:
> Hi, we're following this ticket very closely in Debian. I notice that the following two patches are still applicable to 5.38.1:
> 
> * https://git.sagemath.org/sage.git/tree/build/pkgs/maxima/patches/0001-taylor2-Avoid-blowing-the-stack-when-diff-expand-isn.patch

this one comes from upstream, from here: https://sourceforge.net/p/maxima/bugs/2520/#e3a5
(so it's sort of unfinished digging on the maxima side; it's definitely useful outside of Sage)



> * https://git.sagemath.org/sage.git/tree/build/pkgs/maxima/patches/matrixexp.patch
> 
this is also from upstream (updated somewhat):
https://sourceforge.net/p/maxima/bugs/2596/

again, upstream still has it open.



---

archive/issue_comments_254570.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/interfaces/maxima.py\n**********************************************************************\nFile \"src/sage/interfaces/maxima.py\", line 210, in sage.interfaces.maxima\nFailed example:\n    g.taylor('x', 0, 3)\nExpected:\n    x+x^3/6+(3*x^5)/40+(5*x^7)/112+(35*x^9)/1152\nGot:\n    f/(k^4*x^4)-(2*f)/((3*k^2)*x^2)+(11*f)/45-((62*k^2*f)*x^2)/945\n**********************************************************************\n1 item had failures:\n   1 of  96 in sage.interfaces.maxima\n    [182 tests, 1 failure, 10.65 s]\nsage -t --long src/sage/symbolic/expression_conversions.py\n**********************************************************************\nFile \"src/sage/symbolic/expression_conversions.py\", line 535, in sage.symbolic.expression_conversions.InterfaceInit.derivative\nFailed example:\n    b = maxima(a); b\nExpected:\n    %at('diff('f(_SAGE_VAR_t0),_SAGE_VAR_t0,1),[_SAGE_VAR_t0=%e^_SAGE_VAR_x])\nGot:\n    %at('diff('f(_SAGE_VAR_t0),_SAGE_VAR_t0,1),_SAGE_VAR_t0=%e^_SAGE_VAR_x)\n**********************************************************************\nFile \"src/sage/symbolic/expression_conversions.py\", line 544, in sage.symbolic.expression_conversions.InterfaceInit.derivative\nFailed example:\n    b = maxima(a); b\nExpected:\n    %at('diff('f(_SAGE_VAR_t0),_SAGE_VAR_t0,1),[_SAGE_VAR_t0=4])\nGot:\n    %at('diff('f(_SAGE_VAR_t0),_SAGE_VAR_t0,1),_SAGE_VAR_t0=4)\n**********************************************************************\nFile \"src/sage/symbolic/expression_conversions.py\", line 564, in sage.symbolic.expression_conversions.InterfaceInit.derivative\nFailed example:\n    b = maxima(a); b\nExpected:\n    %at('diff('f(_SAGE_VAR_t0,_SAGE_VAR_t1),_SAGE_VAR_t0,1),[_SAGE_VAR_t0=4,_SAGE_VAR_t1=_SAGE_VAR_y])\nGot:\n    %at('diff('f(_SAGE_VAR_t0,_SAGE_VAR_y),_SAGE_VAR_t0,1),_SAGE_VAR_t0=4)\n**********************************************************************\nFile \"src/sage/symbolic/expression_conversions.py\", line 573, in sage.symbolic.expression_conversions.InterfaceInit.derivative\nFailed example:\n    b = maxima(a); b\nExpected:\n    %at('diff('f(_SAGE_VAR_t0,_SAGE_VAR_t1),_SAGE_VAR_t0,1),[_SAGE_VAR_t0=4,_SAGE_VAR_t1=8])\nGot:\n    %at('diff('f(_SAGE_VAR_t0,8),_SAGE_VAR_t0,1),_SAGE_VAR_t0=4)\n**********************************************************************\n1 item had failures:\n   4 of  37 in sage.symbolic.expression_conversions.InterfaceInit.derivative\n    [462 tests, 4 failures, 5.14 s]\nsage -t --long src/sage/calculus/tests.py\n**********************************************************************\nFile \"src/sage/calculus/tests.py\", line 107, in sage.calculus.tests\nFailed example:\n    integrate(log(1-x^2)/x, x)\nExpected:\n    1/2*log(x^2)*log(-x^2 + 1) + 1/2*polylog(2, -x^2 + 1)\nGot:\n    log(-x)*log(x + 1) + log(x)*log(-x + 1) + polylog(2, x + 1) + polylog(2, -x + 1)\n**********************************************************************\n1 item had failures:\n   1 of  83 in sage.calculus.tests\n    [82 tests, 1 failure, 8.56 s]\nsage -t --long src/sage/interfaces/maxima_lib.py\n**********************************************************************\nFile \"src/sage/interfaces/maxima_lib.py\", line 66, in sage.interfaces.maxima_lib\nFailed example:\n    sum((-x)^n/(factorial(n)*factorial(n+3/2)),n,0,oo)\nExpected:\n    bessel_J(3/2, 2*sqrt(x))/x^(3/4)\nGot:\n    -1/2*(2*x*cos(2*sqrt(x)) - sqrt(x)*sin(2*sqrt(x)))/(sqrt(pi)*x^2)\n**********************************************************************\nFile \"src/sage/interfaces/maxima_lib.py\", line 724, in sage.interfaces.maxima_lib.MaximaLib.sr_integral\nFailed example:\n    integrate(1 / (1 + abs(x-5)), x, -5, 6)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.maxima_lib.MaximaLib.sr_integral[12]>\", line 1, in <module>\n        integrate(Integer(1) / (Integer(1) + abs(x-Integer(5))), x, -Integer(5), Integer(6))\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/misc/functional.py\", line 662, in integral\n        return x.integral(*args, **kwds)\n      File \"sage/symbolic/expression.pyx\", line 11624, in sage.symbolic.expression.Expression.integral (/usr/local/src/sage-config/src/build/cythonized/sage/symbolic/expression.cpp:64315)\n        return integral(self, *args, **kwds)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/integration/integral.py\", line 777, in integrate\n        return definite_integral(expression, v, a, b, hold=hold)\n      File \"sage/symbolic/function.pyx\", line 995, in sage.symbolic.function.BuiltinFunction.__call__ (/usr/local/src/sage-config/src/build/cythonized/sage/symbolic/function.cpp:11329)\n        res = super(BuiltinFunction, self).__call__(\n      File \"sage/symbolic/function.pyx\", line 485, in sage.symbolic.function.Function.__call__ (/usr/local/src/sage-config/src/build/cythonized/sage/symbolic/function.cpp:6372)\n        res = g_function_evalv(self._serial, vec, hold)\n      File \"sage/symbolic/function.pyx\", line 1084, in sage.symbolic.function.BuiltinFunction._evalf_or_eval_ (/usr/local/src/sage-config/src/build/cythonized/sage/symbolic/function.cpp:12689)\n        return self._eval0_(*args)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/integration/integral.py\", line 178, in _eval_\n        return integrator(*args)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/integration/external.py\", line 24, in maxima_integrator\n        result = maxima.sr_integral(expression, v, a, b)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/interfaces/maxima_lib.py\", line 799, in sr_integral\n        return max_to_sr(maxima_eval(([max_integrate],[sr_to_max(SR(a)) for a in args])))\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/interfaces/maxima_lib.py\", line 1672, in max_to_sr\n        args=[max_to_sr(a) for a in max_args]\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/interfaces/maxima_lib.py\", line 1672, in max_to_sr\n        args=[max_to_sr(a) for a in max_args]\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/interfaces/maxima_lib.py\", line 1663, in max_to_sr\n        sage_expr=SR(maxima(expr))\n      File \"sage/structure/parent.pyx\", line 953, in sage.structure.parent.Parent.__call__ (/usr/local/src/sage-config/src/build/cythonized/sage/structure/parent.c:9849)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 238, in sage.structure.coerce_maps.NamedConvertMap._call_ (/usr/local/src/sage-config/src/build/cythonized/sage/structure/coerce_maps.c:6388)\n        cdef Element e = method(C)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/interfaces/maxima_abstract.py\", line 1255, in _symbolic_\n        return R(self._sage_())\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/interfaces/maxima_abstract.py\", line 1230, in _sage_\n        maxima=self.parent())\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/calculus/calculus.py\", line 1897, in symbolic_expression_from_maxima_string\n        raise TypeError(\"unable to make sense of Maxima expression '%s' in Sage\"%s)\n    TypeError: unable to make sense of Maxima expression 'limit(if(-(_SAGE_VAR_x-5)>0,-log(6-_SAGE_VAR_x),log(abs(_SAGE_VAR_x-4))),_SAGE_VAR_x,-5,plus)' in Sage\n**********************************************************************\n```\n",
    "created_at": "2016-11-14T07:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254570",
    "user": "jdemeyer"
}
```


```
sage -t --long src/sage/interfaces/maxima.py
**********************************************************************
File "src/sage/interfaces/maxima.py", line 210, in sage.interfaces.maxima
Failed example:
    g.taylor('x', 0, 3)
Expected:
    x+x^3/6+(3*x^5)/40+(5*x^7)/112+(35*x^9)/1152
Got:
    f/(k^4*x^4)-(2*f)/((3*k^2)*x^2)+(11*f)/45-((62*k^2*f)*x^2)/945
**********************************************************************
1 item had failures:
   1 of  96 in sage.interfaces.maxima
    [182 tests, 1 failure, 10.65 s]
sage -t --long src/sage/symbolic/expression_conversions.py
**********************************************************************
File "src/sage/symbolic/expression_conversions.py", line 535, in sage.symbolic.expression_conversions.InterfaceInit.derivative
Failed example:
    b = maxima(a); b
Expected:
    %at('diff('f(_SAGE_VAR_t0),_SAGE_VAR_t0,1),[_SAGE_VAR_t0=%e^_SAGE_VAR_x])
Got:
    %at('diff('f(_SAGE_VAR_t0),_SAGE_VAR_t0,1),_SAGE_VAR_t0=%e^_SAGE_VAR_x)
**********************************************************************
File "src/sage/symbolic/expression_conversions.py", line 544, in sage.symbolic.expression_conversions.InterfaceInit.derivative
Failed example:
    b = maxima(a); b
Expected:
    %at('diff('f(_SAGE_VAR_t0),_SAGE_VAR_t0,1),[_SAGE_VAR_t0=4])
Got:
    %at('diff('f(_SAGE_VAR_t0),_SAGE_VAR_t0,1),_SAGE_VAR_t0=4)
**********************************************************************
File "src/sage/symbolic/expression_conversions.py", line 564, in sage.symbolic.expression_conversions.InterfaceInit.derivative
Failed example:
    b = maxima(a); b
Expected:
    %at('diff('f(_SAGE_VAR_t0,_SAGE_VAR_t1),_SAGE_VAR_t0,1),[_SAGE_VAR_t0=4,_SAGE_VAR_t1=_SAGE_VAR_y])
Got:
    %at('diff('f(_SAGE_VAR_t0,_SAGE_VAR_y),_SAGE_VAR_t0,1),_SAGE_VAR_t0=4)
**********************************************************************
File "src/sage/symbolic/expression_conversions.py", line 573, in sage.symbolic.expression_conversions.InterfaceInit.derivative
Failed example:
    b = maxima(a); b
Expected:
    %at('diff('f(_SAGE_VAR_t0,_SAGE_VAR_t1),_SAGE_VAR_t0,1),[_SAGE_VAR_t0=4,_SAGE_VAR_t1=8])
Got:
    %at('diff('f(_SAGE_VAR_t0,8),_SAGE_VAR_t0,1),_SAGE_VAR_t0=4)
**********************************************************************
1 item had failures:
   4 of  37 in sage.symbolic.expression_conversions.InterfaceInit.derivative
    [462 tests, 4 failures, 5.14 s]
sage -t --long src/sage/calculus/tests.py
**********************************************************************
File "src/sage/calculus/tests.py", line 107, in sage.calculus.tests
Failed example:
    integrate(log(1-x^2)/x, x)
Expected:
    1/2*log(x^2)*log(-x^2 + 1) + 1/2*polylog(2, -x^2 + 1)
Got:
    log(-x)*log(x + 1) + log(x)*log(-x + 1) + polylog(2, x + 1) + polylog(2, -x + 1)
**********************************************************************
1 item had failures:
   1 of  83 in sage.calculus.tests
    [82 tests, 1 failure, 8.56 s]
sage -t --long src/sage/interfaces/maxima_lib.py
**********************************************************************
File "src/sage/interfaces/maxima_lib.py", line 66, in sage.interfaces.maxima_lib
Failed example:
    sum((-x)^n/(factorial(n)*factorial(n+3/2)),n,0,oo)
Expected:
    bessel_J(3/2, 2*sqrt(x))/x^(3/4)
Got:
    -1/2*(2*x*cos(2*sqrt(x)) - sqrt(x)*sin(2*sqrt(x)))/(sqrt(pi)*x^2)
**********************************************************************
File "src/sage/interfaces/maxima_lib.py", line 724, in sage.interfaces.maxima_lib.MaximaLib.sr_integral
Failed example:
    integrate(1 / (1 + abs(x-5)), x, -5, 6)
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.maxima_lib.MaximaLib.sr_integral[12]>", line 1, in <module>
        integrate(Integer(1) / (Integer(1) + abs(x-Integer(5))), x, -Integer(5), Integer(6))
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/misc/functional.py", line 662, in integral
        return x.integral(*args, **kwds)
      File "sage/symbolic/expression.pyx", line 11624, in sage.symbolic.expression.Expression.integral (/usr/local/src/sage-config/src/build/cythonized/sage/symbolic/expression.cpp:64315)
        return integral(self, *args, **kwds)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/integration/integral.py", line 777, in integrate
        return definite_integral(expression, v, a, b, hold=hold)
      File "sage/symbolic/function.pyx", line 995, in sage.symbolic.function.BuiltinFunction.__call__ (/usr/local/src/sage-config/src/build/cythonized/sage/symbolic/function.cpp:11329)
        res = super(BuiltinFunction, self).__call__(
      File "sage/symbolic/function.pyx", line 485, in sage.symbolic.function.Function.__call__ (/usr/local/src/sage-config/src/build/cythonized/sage/symbolic/function.cpp:6372)
        res = g_function_evalv(self._serial, vec, hold)
      File "sage/symbolic/function.pyx", line 1084, in sage.symbolic.function.BuiltinFunction._evalf_or_eval_ (/usr/local/src/sage-config/src/build/cythonized/sage/symbolic/function.cpp:12689)
        return self._eval0_(*args)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/integration/integral.py", line 178, in _eval_
        return integrator(*args)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/symbolic/integration/external.py", line 24, in maxima_integrator
        result = maxima.sr_integral(expression, v, a, b)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/interfaces/maxima_lib.py", line 799, in sr_integral
        return max_to_sr(maxima_eval(([max_integrate],[sr_to_max(SR(a)) for a in args])))
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/interfaces/maxima_lib.py", line 1672, in max_to_sr
        args=[max_to_sr(a) for a in max_args]
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/interfaces/maxima_lib.py", line 1672, in max_to_sr
        args=[max_to_sr(a) for a in max_args]
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/interfaces/maxima_lib.py", line 1663, in max_to_sr
        sage_expr=SR(maxima(expr))
      File "sage/structure/parent.pyx", line 953, in sage.structure.parent.Parent.__call__ (/usr/local/src/sage-config/src/build/cythonized/sage/structure/parent.c:9849)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 238, in sage.structure.coerce_maps.NamedConvertMap._call_ (/usr/local/src/sage-config/src/build/cythonized/sage/structure/coerce_maps.c:6388)
        cdef Element e = method(C)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/interfaces/maxima_abstract.py", line 1255, in _symbolic_
        return R(self._sage_())
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/interfaces/maxima_abstract.py", line 1230, in _sage_
        maxima=self.parent())
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/calculus/calculus.py", line 1897, in symbolic_expression_from_maxima_string
        raise TypeError("unable to make sense of Maxima expression '%s' in Sage"%s)
    TypeError: unable to make sense of Maxima expression 'limit(if(-(_SAGE_VAR_x-5)>0,-log(6-_SAGE_VAR_x),log(abs(_SAGE_VAR_x-4))),_SAGE_VAR_x,-5,plus)' in Sage
**********************************************************************
```




---

archive/issue_comments_254571.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-14T07:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254571",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_254572.json:
```json
{
    "body": "Some of these doctests are solely Maxima's regressions, one is fixable via a ECL update.\nI can just mark them appropriately and proceed, if this is acceptable.",
    "created_at": "2016-11-14T10:15:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254572",
    "user": "dimpase"
}
```

Some of these doctests are solely Maxima's regressions, one is fixable via a ECL update.
I can just mark them appropriately and proceed, if this is acceptable.



---

archive/issue_comments_254573.json:
```json
{
    "body": "Replying to [comment:79 jdemeyer]:\n> {{{\n> File \"src/sage/interfaces/maxima_lib.py\", line 724, in sage.interfaces.maxima_lib.MaximaLib.sr_integral\n> Failed example:\n>     integrate(1 / (1 + abs(x-5)), x, -5, 6)\n> Exception raised:\n>     Traceback (most recent call last):\n> ...\n>       File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/calculus/calculus.py\", line 1897, in symbolic_expression_from_maxima_string\n>         raise TypeError(\"unable to make sense of Maxima expression '%s' in Sage\"%s)\n>     TypeError: unable to make sense of Maxima expression 'limit(if(-(_SAGE_VAR_x-5)>0,-log(6-_SAGE_VAR_x),log(abs(_SAGE_VAR_x-4))),_SAGE_VAR_x,-5,plus)' in Sage\n> **********************************************************************\n> }}}\nThis is both #17892 and #20191, because the result changed, presumably to something more correct that needs these symbolic functions we don't have atm.",
    "created_at": "2016-11-14T13:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254573",
    "user": "rws"
}
```

Replying to [comment:79 jdemeyer]:
> {{{
> File "src/sage/interfaces/maxima_lib.py", line 724, in sage.interfaces.maxima_lib.MaximaLib.sr_integral
> Failed example:
>     integrate(1 / (1 + abs(x-5)), x, -5, 6)
> Exception raised:
>     Traceback (most recent call last):
> ...
>       File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/calculus/calculus.py", line 1897, in symbolic_expression_from_maxima_string
>         raise TypeError("unable to make sense of Maxima expression '%s' in Sage"%s)
>     TypeError: unable to make sense of Maxima expression 'limit(if(-(_SAGE_VAR_x-5)>0,-log(6-_SAGE_VAR_x),log(abs(_SAGE_VAR_x-4))),_SAGE_VAR_x,-5,plus)' in Sage
> **********************************************************************
> }}}
This is both #17892 and #20191, because the result changed, presumably to something more correct that needs these symbolic functions we don't have atm.



---

archive/issue_comments_254574.json:
```json
{
    "body": "Replying to [comment:81 rws]:\n> Replying to [comment:79 jdemeyer]:\n> > {{{\n> > File \"src/sage/interfaces/maxima_lib.py\", line 724, in sage.interfaces.maxima_lib.MaximaLib.sr_integral\n> > Failed example:\n> >     integrate(1 / (1 + abs(x-5)), x, -5, 6)\n> > Exception raised:\n> >     Traceback (most recent call last):\n> > ...\n> >       File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/calculus/calculus.py\", line 1897, in symbolic_expression_from_maxima_string\n> >         raise TypeError(\"unable to make sense of Maxima expression '%s' in Sage\"%s)\n> >     TypeError: unable to make sense of Maxima expression 'limit(if(-(_SAGE_VAR_x-5)>0,-log(6-_SAGE_VAR_x),log(abs(_SAGE_VAR_x-4))),_SAGE_VAR_x,-5,plus)' in Sage\n> > **********************************************************************\n> > }}}\n> This is both #17892 and #20191, because the result changed, presumably to something more correct that needs these symbolic functions we don't have atm.\n\nI think this one is a new Maxima bug: \nhttps://sourceforge.net/p/maxima/bugs/3237/ - still under investigation by Maxima people.",
    "created_at": "2016-11-14T14:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254574",
    "user": "dimpase"
}
```

Replying to [comment:81 rws]:
> Replying to [comment:79 jdemeyer]:
> > {{{
> > File "src/sage/interfaces/maxima_lib.py", line 724, in sage.interfaces.maxima_lib.MaximaLib.sr_integral
> > Failed example:
> >     integrate(1 / (1 + abs(x-5)), x, -5, 6)
> > Exception raised:
> >     Traceback (most recent call last):
> > ...
> >       File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/calculus/calculus.py", line 1897, in symbolic_expression_from_maxima_string
> >         raise TypeError("unable to make sense of Maxima expression '%s' in Sage"%s)
> >     TypeError: unable to make sense of Maxima expression 'limit(if(-(_SAGE_VAR_x-5)>0,-log(6-_SAGE_VAR_x),log(abs(_SAGE_VAR_x-4))),_SAGE_VAR_x,-5,plus)' in Sage
> > **********************************************************************
> > }}}
> This is both #17892 and #20191, because the result changed, presumably to something more correct that needs these symbolic functions we don't have atm.

I think this one is a new Maxima bug: 
https://sourceforge.net/p/maxima/bugs/3237/ - still under investigation by Maxima people.



---

archive/issue_comments_254575.json:
```json
{
    "body": "Replying to [comment:79 jdemeyer]:\n> {{{\n> sage -t --long src/sage/interfaces/maxima.py\n> **********************************************************************\n> File \"src/sage/interfaces/maxima.py\", line 210, in sage.interfaces.maxima\n> Failed example:\n>     g.taylor('x', 0, 3)\n> Expected:\n>     x+x<sup>3/6+(3*x</sup>5)/40+(5*x<sup>7)/112+(35*x</sup>9)/1152\n> Got:\n>     f/(k<sup>4*x</sup>4)-(2*f)/((3*k<sup>2)*x</sup>2)+(11*f)/45-((62*k<sup>2*f)*x</sup>2)/945\n> }}}\n\nThat's odd. The doctest skipped to the next result line which is of course different.\n\n> I think this one is a new Maxima bug: \u200bhttps://sourceforge.net/p/maxima/bugs/3237/ - still under investigation by Maxima people.\n\nLooking more closely, I agree.",
    "created_at": "2016-11-14T14:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254575",
    "user": "rws"
}
```

Replying to [comment:79 jdemeyer]:
> {{{
> sage -t --long src/sage/interfaces/maxima.py
> **********************************************************************
> File "src/sage/interfaces/maxima.py", line 210, in sage.interfaces.maxima
> Failed example:
>     g.taylor('x', 0, 3)
> Expected:
>     x+x<sup>3/6+(3*x</sup>5)/40+(5*x<sup>7)/112+(35*x</sup>9)/1152
> Got:
>     f/(k<sup>4*x</sup>4)-(2*f)/((3*k<sup>2)*x</sup>2)+(11*f)/45-((62*k<sup>2*f)*x</sup>2)/945
> }}}

That's odd. The doctest skipped to the next result line which is of course different.

> I think this one is a new Maxima bug: https://sourceforge.net/p/maxima/bugs/3237/ - still under investigation by Maxima people.

Looking more closely, I agree.



---

archive/issue_comments_254576.json:
```json
{
    "body": "`ecl` 16.1.3 is out. I haven't checked yet if all we want is in there but I will look int it.",
    "created_at": "2016-12-20T03:59:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254576",
    "user": "fbissey"
}
```

`ecl` 16.1.3 is out. I haven't checked yet if all we want is in there but I will look int it.



---

archive/issue_comments_254577.json:
```json
{
    "body": "If possible, do the ECL upgrade in a new ticket.",
    "created_at": "2016-12-20T07:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254577",
    "user": "jdemeyer"
}
```

If possible, do the ECL upgrade in a new ticket.



---

archive/issue_comments_254578.json:
```json
{
    "body": "Considering the havoc it wrecks in the building of the documentation it deserves its own ticket. Surprisingly, I haven't spotted `libecl` in the numerous backtraces produced before the build petered out. But that's the only thing I changed from one successful build to this one.",
    "created_at": "2016-12-20T08:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254578",
    "user": "fbissey"
}
```

Considering the havoc it wrecks in the building of the documentation it deserves its own ticket. Surprisingly, I haven't spotted `libecl` in the numerous backtraces produced before the build petered out. But that's the only thing I changed from one successful build to this one.



---

archive/issue_comments_254579.json:
```json
{
    "body": "maxima 5.39.0 has been released. ECL upgrade is happening on #22191.",
    "created_at": "2017-01-16T14:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254579",
    "user": "dimpase"
}
```

maxima 5.39.0 has been released. ECL upgrade is happening on #22191.



---

archive/issue_comments_254580.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-16T15:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254580",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254581.json:
```json
{
    "body": "On this branch, the following works at the prompt:\n\n```\nsage: K.<i> = NumberField(x^2+1)\nsage: (6*i + 6).factor()\n(-i) * (i + 1)^3 * 3\n```\n\nbut crashes in testing:\n\n```\nUsing --optional=mpir,python2,sage\nDoctesting 1 file using 8 threads.\nsage -t src/sage/rings/number_field/number_field_element.pyx\n**********************************************************************\nFile \"src/sage/rings/number_field/number_field_element.pyx\", line 1752, in sage.rings.number_field.number_field_element.NumberFieldElement.factor\nFailed example:\n    (6*i + 6).factor()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.number_field.number_field_element.NumberFieldElement.factor[1]>\", line 1, in <module>\n        (Integer(6)*i + Integer(6)).factor()\n      File \"sage/rings/number_field/number_field_element.pyx\", line 1782, in sage.rings.number_field.number_field_element.NumberFieldElement.factor (build/cythonized/sage/rings/number_field/number_field_element.cpp:19881)\n        if not P.is_principal():\n      File \"/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field_ideal.py\", line 1115, in is_principal\n        self._cache_bnfisprincipal(proof)\n      File \"/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field_ideal.py\", line 1058, in _cache_bnfisprincipal\n        bnf = self.number_field().pari_bnf(proof)\n      File \"/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field.py\", line 3603, in pari_bnf\n        self._pari_bnf = f.bnfinit(1)\n      File \"sage/libs/cypari2/auto_gen.pxi\", line 2984, in sage.libs.cypari2.gen.gen_auto.bnfinit (build/cythonized/sage/libs/cypari2/gen.c:17894)\n        sig_on()\n      File \"src/cysignals/signals.pyx\", line 105, in cysignals.signals.sig_raise_exception (build/src/cysignals/signals.c:1519)\n    FloatingPointError: Floating point exception\n**********************************************************************\n1 item had failures:\n   1 of   8 in sage.rings.number_field.number_field_element.NumberFieldElement.factor\n    [1051 tests, 1 failure, 10.88 s]\n----------------------------------------------------------------------\nsage -t src/sage/rings/number_field/number_field_element.pyx  # 1 doctest failed\n```\n\n\nLooks like the testing environment is a bit shot, but I cannot figure out why.",
    "created_at": "2017-01-16T15:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254581",
    "user": "dimpase"
}
```

On this branch, the following works at the prompt:

```
sage: K.<i> = NumberField(x^2+1)
sage: (6*i + 6).factor()
(-i) * (i + 1)^3 * 3
```

but crashes in testing:

```
Using --optional=mpir,python2,sage
Doctesting 1 file using 8 threads.
sage -t src/sage/rings/number_field/number_field_element.pyx
**********************************************************************
File "src/sage/rings/number_field/number_field_element.pyx", line 1752, in sage.rings.number_field.number_field_element.NumberFieldElement.factor
Failed example:
    (6*i + 6).factor()
Exception raised:
    Traceback (most recent call last):
      File "/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.number_field.number_field_element.NumberFieldElement.factor[1]>", line 1, in <module>
        (Integer(6)*i + Integer(6)).factor()
      File "sage/rings/number_field/number_field_element.pyx", line 1782, in sage.rings.number_field.number_field_element.NumberFieldElement.factor (build/cythonized/sage/rings/number_field/number_field_element.cpp:19881)
        if not P.is_principal():
      File "/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field_ideal.py", line 1115, in is_principal
        self._cache_bnfisprincipal(proof)
      File "/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field_ideal.py", line 1058, in _cache_bnfisprincipal
        bnf = self.number_field().pari_bnf(proof)
      File "/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field.py", line 3603, in pari_bnf
        self._pari_bnf = f.bnfinit(1)
      File "sage/libs/cypari2/auto_gen.pxi", line 2984, in sage.libs.cypari2.gen.gen_auto.bnfinit (build/cythonized/sage/libs/cypari2/gen.c:17894)
        sig_on()
      File "src/cysignals/signals.pyx", line 105, in cysignals.signals.sig_raise_exception (build/src/cysignals/signals.c:1519)
    FloatingPointError: Floating point exception
**********************************************************************
1 item had failures:
   1 of   8 in sage.rings.number_field.number_field_element.NumberFieldElement.factor
    [1051 tests, 1 failure, 10.88 s]
----------------------------------------------------------------------
sage -t src/sage/rings/number_field/number_field_element.pyx  # 1 doctest failed
```


Looks like the testing environment is a bit shot, but I cannot figure out why.



---

archive/issue_comments_254582.json:
```json
{
    "body": "here we get fp exception instead of `ArithmeticError`\n\n```\nFile \"src/sage/arith/misc.py\", line 2696, in sage.arith.misc.is_squarefree\nFailed example:\n    is_squarefree(a - 3)\nExpected:\n    Traceback (most recent call last):\n    ...\n    ArithmeticError: non-principal ideal in factorization\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.arith.misc.is_squarefree[13]>\", line 1, in <module>\n        is_squarefree(a - Integer(3))\n      File \"/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/arith/misc.py\", line 2711, in is_squarefree\n        return all(r[1] == 1 for r in factor(n))\n      File \"/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/arith/misc.py\", line 2479, in factor\n        return n.factor(**kwds)\n      File \"sage/rings/number_field/number_field_element.pyx\", line 1782, in sage.rings.number_field.number_field_element.NumberFieldElement.factor (build/cythonized/sage/rings/number_field/number_field_element.cpp:19881)\n        if not P.is_principal():\n      File \"/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field_ideal.py\", line 1115, in is_principal\n        self._cache_bnfisprincipal(proof)\n      File \"/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field_ideal.py\", line 1058, in _cache_bnfisprincipal\n        bnf = self.number_field().pari_bnf(proof)\n      File \"/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field.py\", line 3603, in pari_bnf\n        self._pari_bnf = f.bnfinit(1)\n      File \"sage/libs/cypari2/auto_gen.pxi\", line 2984, in sage.libs.cypari2.gen.gen_auto.bnfinit (build/cythonized/sage/libs/cypari2/gen.c:17894)\n        sig_on()\n      File \"src/cysignals/signals.pyx\", line 105, in cysignals.signals.sig_raise_exception (build/src/cysignals/signals.c:1519)\n    FloatingPointError: Floating point exception\n```\n",
    "created_at": "2017-01-16T15:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254582",
    "user": "dimpase"
}
```

here we get fp exception instead of `ArithmeticError`

```
File "src/sage/arith/misc.py", line 2696, in sage.arith.misc.is_squarefree
Failed example:
    is_squarefree(a - 3)
Expected:
    Traceback (most recent call last):
    ...
    ArithmeticError: non-principal ideal in factorization
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.arith.misc.is_squarefree[13]>", line 1, in <module>
        is_squarefree(a - Integer(3))
      File "/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/arith/misc.py", line 2711, in is_squarefree
        return all(r[1] == 1 for r in factor(n))
      File "/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/arith/misc.py", line 2479, in factor
        return n.factor(**kwds)
      File "sage/rings/number_field/number_field_element.pyx", line 1782, in sage.rings.number_field.number_field_element.NumberFieldElement.factor (build/cythonized/sage/rings/number_field/number_field_element.cpp:19881)
        if not P.is_principal():
      File "/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field_ideal.py", line 1115, in is_principal
        self._cache_bnfisprincipal(proof)
      File "/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field_ideal.py", line 1058, in _cache_bnfisprincipal
        bnf = self.number_field().pari_bnf(proof)
      File "/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field.py", line 3603, in pari_bnf
        self._pari_bnf = f.bnfinit(1)
      File "sage/libs/cypari2/auto_gen.pxi", line 2984, in sage.libs.cypari2.gen.gen_auto.bnfinit (build/cythonized/sage/libs/cypari2/gen.c:17894)
        sig_on()
      File "src/cysignals/signals.pyx", line 105, in cysignals.signals.sig_raise_exception (build/src/cysignals/signals.c:1519)
    FloatingPointError: Floating point exception
```




---

archive/issue_comments_254583.json:
```json
{
    "body": "Is the following a regression in Maxima?:\n\n```\nsage -t --warn-long 87.4 src/sage/symbolic/expression.pyx\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 10600, in sage.symbolic.expression.Expression.solve\nFailed example:\n    solve(Q*sqrt(Q^2 + 2) - 1, Q, to_poly_solve=True)\nExpected:\n    [Q == 1/sqrt(-sqrt(2) + 1), Q == 1/sqrt(sqrt(2) + 1)]\nGot:\n    [Q == -sqrt(-sqrt(2) - 1)]\n```\n",
    "created_at": "2017-01-16T16:08:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254583",
    "user": "dimpase"
}
```

Is the following a regression in Maxima?:

```
sage -t --warn-long 87.4 src/sage/symbolic/expression.pyx
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 10600, in sage.symbolic.expression.Expression.solve
Failed example:
    solve(Q*sqrt(Q^2 + 2) - 1, Q, to_poly_solve=True)
Expected:
    [Q == 1/sqrt(-sqrt(2) + 1), Q == 1/sqrt(sqrt(2) + 1)]
Got:
    [Q == -sqrt(-sqrt(2) - 1)]
```




---

archive/issue_comments_254584.json:
```json
{
    "body": "The following works at the prompt:\n\n```\nsage: F.<omega> = NumberField(x^2+x+1)\nsage: xx = polygen(F)\nsage: ps = [p for p, _ in F(7).factor()]\nsage: ps\n[-3*omega - 2, 3*omega + 1]\n```\n\nbut crashes in testing:\n\n```\nsage -t --warn-long 87.4 src/sage/rings/number_field/number_field.py\n**********************************************************************\nFile \"src/sage/rings/number_field/number_field.py\", line 1246, in sage.rings.number_field.number_field.NumberField_generic\nFailed example:\n    ps = [p for p, _ in F(7).factor()]\nException raised:\n    Traceback (most recent call last):\n      File \"/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.number_field.number_field.NumberField_generic[43]>\", line 1, in <module>\n        ps = [p for p, _ in F(Integer(7)).factor()]\n      File \"sage/rings/number_field/number_field_element.pyx\", line 1782, in sage.rings.number_field.number_field_element.NumberFieldElement.factor (build/cythonized/sage/rings/number_field/number_field_element.cpp:19881)\n        if not P.is_principal():\n      File \"/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field_ideal.py\", line 1115, in is_principal\n        self._cache_bnfisprincipal(proof)\n      File \"/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field_ideal.py\", line 1058, in _cache_bnfisprincipal\n        bnf = self.number_field().pari_bnf(proof)\n      File \"/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field.py\", line 3603, in pari_bnf\n        self._pari_bnf = f.bnfinit(1)\n      File \"sage/libs/cypari2/auto_gen.pxi\", line 2984, in sage.libs.cypari2.gen.gen_auto.bnfinit (build/cythonized/sage/libs/cypari2/gen.c:17894)\n        sig_on()\n      File \"src/cysignals/signals.pyx\", line 105, in cysignals.signals.sig_raise_exception (build/src/cysignals/signals.c:1519)\n    FloatingPointError: Floating point exception\n```\n",
    "created_at": "2017-01-16T16:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254584",
    "user": "dimpase"
}
```

The following works at the prompt:

```
sage: F.<omega> = NumberField(x^2+x+1)
sage: xx = polygen(F)
sage: ps = [p for p, _ in F(7).factor()]
sage: ps
[-3*omega - 2, 3*omega + 1]
```

but crashes in testing:

```
sage -t --warn-long 87.4 src/sage/rings/number_field/number_field.py
**********************************************************************
File "src/sage/rings/number_field/number_field.py", line 1246, in sage.rings.number_field.number_field.NumberField_generic
Failed example:
    ps = [p for p, _ in F(7).factor()]
Exception raised:
    Traceback (most recent call last):
      File "/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.number_field.number_field.NumberField_generic[43]>", line 1, in <module>
        ps = [p for p, _ in F(Integer(7)).factor()]
      File "sage/rings/number_field/number_field_element.pyx", line 1782, in sage.rings.number_field.number_field_element.NumberFieldElement.factor (build/cythonized/sage/rings/number_field/number_field_element.cpp:19881)
        if not P.is_principal():
      File "/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field_ideal.py", line 1115, in is_principal
        self._cache_bnfisprincipal(proof)
      File "/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field_ideal.py", line 1058, in _cache_bnfisprincipal
        bnf = self.number_field().pari_bnf(proof)
      File "/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/number_field/number_field.py", line 3603, in pari_bnf
        self._pari_bnf = f.bnfinit(1)
      File "sage/libs/cypari2/auto_gen.pxi", line 2984, in sage.libs.cypari2.gen.gen_auto.bnfinit (build/cythonized/sage/libs/cypari2/gen.c:17894)
        sig_on()
      File "src/cysignals/signals.pyx", line 105, in cysignals.signals.sig_raise_exception (build/src/cysignals/signals.c:1519)
    FloatingPointError: Floating point exception
```




---

archive/issue_comments_254585.json:
```json
{
    "body": "This works at the prompt (with a good plot, too):\n\n```\nsage: plot(bessel_Y(1,x), (x,0,5), color='blue')\nLaunched png viewer for Graphics object consisting of 1 graphics primitive\n```\n\nbut dumps core in testing:\n\n```\nsage -t src/sage/functions/bessel.py\n...\n\nsage: plot(bessel_Y(1,x), (x,0,5), color='blue') ## line 513 ##\n------------------------------------------------------------------------\n/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x4495)[0x7f677f921495]\n/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x44e5)[0x7f677f9214e5]\n/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x7e38)[0x7f677f924e38]\n/lib64/libpthread.so.0(+0x10a00)[0x7f678c3d2a00]\n/home/scratch/dimpase/sage/sage/local/lib/libmpfr.so.4(mpfr_get_d+0x217)[0x7f6774bafd97]\n/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/real_mpfr.so(+0x11bd7)[0x7f6578157bd7]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyNumber_Float+0x2b)[0x7f678c6335cb]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x82ed5)[0x7f678c662ed5]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0xbeae3)[0x7f678c69eae3]\n/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/libs/mpmath/utils.so(+0x765e)[0x7f6577a9265e]\n/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/libs/mpmath/utils.so(+0xe0ee)[0x7f6577a990ee]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7ce1)[0x7f678c6ec461]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x85e4d)[0x7f678c665e4d]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x65f7c)[0x7f678c645f7c]\n/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/symbolic/function.so(+0xad3f)[0x7f655d2b8d3f]\n/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/symbolic/function.so(+0x23cd1)[0x7f655d2d1cd1]\n/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/symbolic/function.so(+0xad3f)[0x7f655d2b8d3f]\n/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/symbolic/function.so(+0x2a868)[0x7f655d2d8868]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_CallObjectWithKeywords+0x47)[0x7f678c6e4187]\n/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/ext/interpreters/wrapper_py.so(interp_py+0x398)[0x7f654092e1a8]\n/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/ext/interpreters/wrapper_py.so(+0x391b)[0x7f654091e91b]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x56da)[0x7f678c6e9e5a]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x85e4d)[0x7f678c665e4d]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x18aa)[0x7f678c6e602a]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x85e4d)[0x7f678c665e4d]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x18aa)[0x7f678c6e602a]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x85e4d)[0x7f678c665e4d]\n/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so(+0x1a03f)[0x7f655dde203f]\n/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so(+0x343de)[0x7f655ddfc3de]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x625b)[0x7f678c6ea9db]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x85e4d)[0x7f678c665e4d]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x18aa)[0x7f678c6e602a]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7f678c6ee139]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7428)[0x7f678c6ebba8]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x85d7c)[0x7f678c665d7c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x65f7c)[0x7f678c645f7c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0xc20b5)[0x7f678c6a20b5]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x56da)[0x7f678c6e9e5a]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8271)[0x7f678c6ec9f1]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x85d7c)[0x7f678c665d7c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x65f7c)[0x7f678c645f7c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0xc24fd)[0x7f678c6a24fd]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0xbeb2f)[0x7f678c69eb2f]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x56da)[0x7f678c6e9e5a]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8271)[0x7f678c6ec9f1]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7f678c6ee139]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0x8a)[0x7f678c7121da]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0xd7)[0x7f678c713587]\n/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(Py_Main+0xc3e)[0x7f678c729c4e]\n/lib64/libc.so.6(__libc_start_main+0xf0)[0x7f678b918580]\npython(_start+0x29)[0x400759]\n------------------------------------------------------------------------\nAttaching gdb to process id 25288.\n\nSaved trace to /home/scratch/dimpase/.sage/crash_logs/crash_vEDCJn.log\n------------------------------------------------------------------------\nUnhandled SIGFPE: An unhandled floating point exception occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\n\n**********************************************************************\n----------------------------------------------------------------------\nsage -t src/sage/functions/bessel.py  # Killed due to floating point exception\n```\n",
    "created_at": "2017-01-16T16:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254585",
    "user": "dimpase"
}
```

This works at the prompt (with a good plot, too):

```
sage: plot(bessel_Y(1,x), (x,0,5), color='blue')
Launched png viewer for Graphics object consisting of 1 graphics primitive
```

but dumps core in testing:

```
sage -t src/sage/functions/bessel.py
...

sage: plot(bessel_Y(1,x), (x,0,5), color='blue') ## line 513 ##
------------------------------------------------------------------------
/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x4495)[0x7f677f921495]
/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x44e5)[0x7f677f9214e5]
/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x7e38)[0x7f677f924e38]
/lib64/libpthread.so.0(+0x10a00)[0x7f678c3d2a00]
/home/scratch/dimpase/sage/sage/local/lib/libmpfr.so.4(mpfr_get_d+0x217)[0x7f6774bafd97]
/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/rings/real_mpfr.so(+0x11bd7)[0x7f6578157bd7]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyNumber_Float+0x2b)[0x7f678c6335cb]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x82ed5)[0x7f678c662ed5]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0xbeae3)[0x7f678c69eae3]
/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/libs/mpmath/utils.so(+0x765e)[0x7f6577a9265e]
/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/libs/mpmath/utils.so(+0xe0ee)[0x7f6577a990ee]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7ce1)[0x7f678c6ec461]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x85e4d)[0x7f678c665e4d]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x65f7c)[0x7f678c645f7c]
/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/symbolic/function.so(+0xad3f)[0x7f655d2b8d3f]
/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/symbolic/function.so(+0x23cd1)[0x7f655d2d1cd1]
/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/symbolic/function.so(+0xad3f)[0x7f655d2b8d3f]
/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/symbolic/function.so(+0x2a868)[0x7f655d2d8868]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_CallObjectWithKeywords+0x47)[0x7f678c6e4187]
/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/ext/interpreters/wrapper_py.so(interp_py+0x398)[0x7f654092e1a8]
/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/ext/interpreters/wrapper_py.so(+0x391b)[0x7f654091e91b]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x56da)[0x7f678c6e9e5a]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x85e4d)[0x7f678c665e4d]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x18aa)[0x7f678c6e602a]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x85e4d)[0x7f678c665e4d]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x18aa)[0x7f678c6e602a]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x85e4d)[0x7f678c665e4d]
/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so(+0x1a03f)[0x7f655dde203f]
/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so(+0x343de)[0x7f655ddfc3de]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x625b)[0x7f678c6ea9db]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x85e4d)[0x7f678c665e4d]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x18aa)[0x7f678c6e602a]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7f678c6ee139]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7428)[0x7f678c6ebba8]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x85d7c)[0x7f678c665d7c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x65f7c)[0x7f678c645f7c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0xc20b5)[0x7f678c6a20b5]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x56da)[0x7f678c6e9e5a]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8271)[0x7f678c6ec9f1]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x85d7c)[0x7f678c665d7c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0x65f7c)[0x7f678c645f7c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0xc24fd)[0x7f678c6a24fd]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(+0xbeb2f)[0x7f678c69eb2f]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7f678c634c13]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x56da)[0x7f678c6e9e5a]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8271)[0x7f678c6ec9f1]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x8020)[0x7f678c6ec7a0]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7f678c6ee01c]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7f678c6ee139]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0x8a)[0x7f678c7121da]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0xd7)[0x7f678c713587]
/home/scratch/dimpase/sage/sage/local/lib/libpython2.7.so.1.0(Py_Main+0xc3e)[0x7f678c729c4e]
/lib64/libc.so.6(__libc_start_main+0xf0)[0x7f678b918580]
python(_start+0x29)[0x400759]
------------------------------------------------------------------------
Attaching gdb to process id 25288.

Saved trace to /home/scratch/dimpase/.sage/crash_logs/crash_vEDCJn.log
------------------------------------------------------------------------
Unhandled SIGFPE: An unhandled floating point exception occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------

**********************************************************************
----------------------------------------------------------------------
sage -t src/sage/functions/bessel.py  # Killed due to floating point exception
```




---

archive/issue_comments_254586.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2017-01-16T16:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254586",
    "user": "dimpase"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_254587.json:
```json
{
    "body": "I think I need an idea what's wrong here, before being able to go forward. This discrepancy between testsuite vs prompt is really odd.",
    "created_at": "2017-01-16T16:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254587",
    "user": "dimpase"
}
```

I think I need an idea what's wrong here, before being able to go forward. This discrepancy between testsuite vs prompt is really odd.



---

archive/issue_comments_254588.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-16T17:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254588",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254589.json:
```json
{
    "body": "here is a bad one - reproducible on two different systems;\nI don't understand what's going on here; it appears that computing `g(x)`,\nthe Taylor expansion of `log(x)`, breaks `log(x)` plotting (in case the leftmost\ninterval point is 0).\n\nProbably this initialises some symbolics, breaking handling of infinity in the\nprocess...\n\n\n```\nsage: plot(log(x),(x,0,2))\nLaunched png viewer for Graphics object consisting of 1 graphics primitive\nsage: g(x)=taylor(log(x),x,1,6); g\nx |--> -1/6*(x - 1)^6 + 1/5*(x - 1)^5 - 1/4*(x - 1)^4 + 1/3*(x - 1)^3 - 1/2*(x - 1)^2 + x - 1\nsage: plot(log(x),(x,0,2))\n------------------------------------------------------------------------\n/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x4495)[0x7f5dbb0d9495]\n[...]\n------------------------------------------------------------------------\nUnhandled SIGFPE: An unhandled floating point exception occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n```\n\n----\nNew commits:",
    "created_at": "2017-01-16T17:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254589",
    "user": "dimpase"
}
```

here is a bad one - reproducible on two different systems;
I don't understand what's going on here; it appears that computing `g(x)`,
the Taylor expansion of `log(x)`, breaks `log(x)` plotting (in case the leftmost
interval point is 0).

Probably this initialises some symbolics, breaking handling of infinity in the
process...


```
sage: plot(log(x),(x,0,2))
Launched png viewer for Graphics object consisting of 1 graphics primitive
sage: g(x)=taylor(log(x),x,1,6); g
x |--> -1/6*(x - 1)^6 + 1/5*(x - 1)^5 - 1/4*(x - 1)^4 + 1/3*(x - 1)^3 - 1/2*(x - 1)^2 + x - 1
sage: plot(log(x),(x,0,2))
------------------------------------------------------------------------
/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/cysignals/signals.so(+0x4495)[0x7f5dbb0d9495]
[...]
------------------------------------------------------------------------
Unhandled SIGFPE: An unhandled floating point exception occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
```

----
New commits:



---

archive/issue_comments_254590.json:
```json
{
    "body": "Replying to [comment:98 dimpase]:\n> here is a bad one - reproducible on two different systems;\n> I don't understand what's going on here; it appears that computing `g(x)`,\n> the Taylor expansion of `log(x)`, breaks `log(x)` plotting (in case the leftmost\n> interval point is 0).\n> \n> Probably this initialises some symbolics, breaking handling of infinity in the\n> process...\n\nFurther entry point - the crash does not happen if I revert back to ECL 16.1.2.\n(and keep new Maxima version).\nThat is, it seems that the call to `taylor` loads ecl+maxima, and sets up some stuff\nthat is responsible for handling infinities.",
    "created_at": "2017-01-16T22:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254590",
    "user": "dimpase"
}
```

Replying to [comment:98 dimpase]:
> here is a bad one - reproducible on two different systems;
> I don't understand what's going on here; it appears that computing `g(x)`,
> the Taylor expansion of `log(x)`, breaks `log(x)` plotting (in case the leftmost
> interval point is 0).
> 
> Probably this initialises some symbolics, breaking handling of infinity in the
> process...

Further entry point - the crash does not happen if I revert back to ECL 16.1.2.
(and keep new Maxima version).
That is, it seems that the call to `taylor` loads ecl+maxima, and sets up some stuff
that is responsible for handling infinities.



---

archive/issue_comments_254591.json:
```json
{
    "body": "I think a number of things point back to `ecl-16.1.3` so it may belong to #22191. I remember having a lot of similar stuff when changing just `ecl` without change `maxima` (still need a rebuild though) in sage-on-gentoo. Right now I am just locked on 16.1.2.",
    "created_at": "2017-01-16T22:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254591",
    "user": "fbissey"
}
```

I think a number of things point back to `ecl-16.1.3` so it may belong to #22191. I remember having a lot of similar stuff when changing just `ecl` without change `maxima` (still need a rebuild though) in sage-on-gentoo. Right now I am just locked on 16.1.2.



---

archive/issue_comments_254592.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-17T10:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254592",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254593.json:
```json
{
    "body": "the last commit appears to fix the SIGFPE problem. More testing...",
    "created_at": "2017-01-17T10:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254593",
    "user": "dimpase"
}
```

the last commit appears to fix the SIGFPE problem. More testing...



---

archive/issue_comments_254594.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-17T11:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254594",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254595.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2017-01-17T11:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254595",
    "user": "dimpase"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_254596.json:
```json
{
    "body": "still a couple of SIGFPEs to figure out, but otherwise does not look too bad. I'll post ptestlong results later today.",
    "created_at": "2017-01-17T11:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254596",
    "user": "dimpase"
}
```

still a couple of SIGFPEs to figure out, but otherwise does not look too bad. I'll post ptestlong results later today.



---

archive/issue_comments_254597.json:
```json
{
    "body": "SIGFPEs are of the same sort as above:\n\n```\nsage: g(x)=taylor(log(x),x,1,6) # this initialises ECL/Maxima\nsage: q = (2^53) * 2^971/1\nsage: float(q) # boom, instead of \"inf\" as the answer.\n...\nUnhandled SIGFPE: An unhandled floating point exception occurred.\n...\n```\n\nwhich I traced down to the call to `ldexp` at `sage/rings/rational.pyx:3799`.\nNote that this is with `\u200bac8348c\t` commit already in (and so `ECL_OPT_TRAP_SIGFPE` = 0), so there is more of the same kind of story as above, but harder. I don't see what's going wrong here now.\n\nThis is a different to division by 0 kind of FPE, so this is perhaps the reason.",
    "created_at": "2017-01-17T16:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254597",
    "user": "dimpase"
}
```

SIGFPEs are of the same sort as above:

```
sage: g(x)=taylor(log(x),x,1,6) # this initialises ECL/Maxima
sage: q = (2^53) * 2^971/1
sage: float(q) # boom, instead of "inf" as the answer.
...
Unhandled SIGFPE: An unhandled floating point exception occurred.
...
```

which I traced down to the call to `ldexp` at `sage/rings/rational.pyx:3799`.
Note that this is with `ac8348c	` commit already in (and so `ECL_OPT_TRAP_SIGFPE` = 0), so there is more of the same kind of story as above, but harder. I don't see what's going wrong here now.

This is a different to division by 0 kind of FPE, so this is perhaps the reason.



---

archive/issue_comments_254598.json:
```json
{
    "body": "ecl-16.1.3+Maxima 5.39.0",
    "created_at": "2017-01-17T16:02:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254598",
    "user": "dimpase"
}
```

ecl-16.1.3+Maxima 5.39.0



---

archive/issue_comments_254599.json:
```json
{
    "body": "Attachment [ptestlong.log](tarball://root/attachments/some-uuid/ticket18920/ptestlong.log) by dimpase created at 2017-01-17 22:28:48\n\nI've decided to stick to ECL 16.1.2 for this ticket. (ECL 16.1.3 has a problem that cannot be fixed quickly, and benefits of using it here are pretty minimal).\n----\nLast 10 new commits:",
    "created_at": "2017-01-17T22:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254599",
    "user": "dimpase"
}
```

Attachment [ptestlong.log](tarball://root/attachments/some-uuid/ticket18920/ptestlong.log) by dimpase created at 2017-01-17 22:28:48

I've decided to stick to ECL 16.1.2 for this ticket. (ECL 16.1.3 has a problem that cannot be fixed quickly, and benefits of using it here are pretty minimal).
----
Last 10 new commits:



---

archive/issue_comments_254600.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-17T22:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254600",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254601.json:
```json
{
    "body": "With this branch, the following remains to be fixed (or marked as known bugs):\n\n1) this appears to be a Maxima regression [bug report](https://sourceforge.net/p/maxima/bugs/3276/):\n\n```\nsage -t src/sage/symbolic/expression.pyx\n******************************************************************\n****\nFile \"src/sage/symbolic/expression.pyx\", line 10600, in sage.symbo\nlic.expression.Expression.solve\nFailed example:\n    solve(Q*sqrt(Q^2 + 2) - 1, Q, to_poly_solve=True)\nExpected:\n    [Q == 1/sqrt(-sqrt(2) + 1), Q == 1/sqrt(sqrt(2) + 1)]\nGot:\n    [Q == -sqrt(-sqrt(2) - 1)]\n```\n\n\n2) this is weird (sage interface problem?) --- scratch this, it's a typo!\n\n```\nsage -t src/sage/interfaces/maxima.py\n******************************************************************\n****\nFile \"src/sage/interfaces/maxima.py\", line 210, in sage.interfaces\n.maxima\nFailed example:\n    g.taylor('x', 0, 3)\nExpected:\n    x+x^3/6+(3*x^5)/40+(5*x^7)/112+(35*x^9)/1152\nGot:\n    f/(k^4*x^4)-(2*f)/((3*k^2)*x^2)+(11*f)/45-((62*k^2*f)*x^2)/945\n**********************************************************************\n```\n\n\n3) this looks like a maxima regression [bug report](https://sourceforge.net/p/maxima/bugs/3275/):\n\n```\nsage -t src/sage/calculus/tests.py\n**********************************************************************\nFile \"src/sage/calculus/tests.py\", line 107, in sage.calculus.tests\nFailed example:\n    integrate(log(1-x^2)/x, x)\nExpected:\n    1/2*log(x^2)*log(-x^2 + 1) + 1/2*dilog(-x^2 + 1)\nGot:\n    log(-x)*log(x + 1) + log(x)*log(-x + 1) + dilog(x + 1) + dilog(-x + 1)\n```\n\n\n4) this is a known Maxima issue [bug report](https://sourceforge.net/p/maxima/bugs/3237/):\n\n```\nsage -t src/sage/interfaces/maxima_lib.py\n******************************************************************\n****\nFile \"src/sage/interfaces/maxima_lib.py\", line 724, in sage.interf\naces.maxima_lib.MaximaLib.sr_integral\nFailed example:\n    integrate(1 / (1 + abs(x-5)), x, -5, 6)\nException raised:\n...\n    TypeError: unable to make sense of Maxima expression 'limit(if(-(_SAGE_VAR_x-5)>0,-log(6-_SAGE_VAR_x),log(abs(_SAGE_VAR_x-4))),_SAGE_VAR_x,-5,plus)' in Sage\n**********************************************************************\n```\n",
    "created_at": "2017-01-17T22:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254601",
    "user": "dimpase"
}
```

With this branch, the following remains to be fixed (or marked as known bugs):

1) this appears to be a Maxima regression [bug report](https://sourceforge.net/p/maxima/bugs/3276/):

```
sage -t src/sage/symbolic/expression.pyx
******************************************************************
****
File "src/sage/symbolic/expression.pyx", line 10600, in sage.symbo
lic.expression.Expression.solve
Failed example:
    solve(Q*sqrt(Q^2 + 2) - 1, Q, to_poly_solve=True)
Expected:
    [Q == 1/sqrt(-sqrt(2) + 1), Q == 1/sqrt(sqrt(2) + 1)]
Got:
    [Q == -sqrt(-sqrt(2) - 1)]
```


2) this is weird (sage interface problem?) --- scratch this, it's a typo!

```
sage -t src/sage/interfaces/maxima.py
******************************************************************
****
File "src/sage/interfaces/maxima.py", line 210, in sage.interfaces
.maxima
Failed example:
    g.taylor('x', 0, 3)
Expected:
    x+x^3/6+(3*x^5)/40+(5*x^7)/112+(35*x^9)/1152
Got:
    f/(k^4*x^4)-(2*f)/((3*k^2)*x^2)+(11*f)/45-((62*k^2*f)*x^2)/945
**********************************************************************
```


3) this looks like a maxima regression [bug report](https://sourceforge.net/p/maxima/bugs/3275/):

```
sage -t src/sage/calculus/tests.py
**********************************************************************
File "src/sage/calculus/tests.py", line 107, in sage.calculus.tests
Failed example:
    integrate(log(1-x^2)/x, x)
Expected:
    1/2*log(x^2)*log(-x^2 + 1) + 1/2*dilog(-x^2 + 1)
Got:
    log(-x)*log(x + 1) + log(x)*log(-x + 1) + dilog(x + 1) + dilog(-x + 1)
```


4) this is a known Maxima issue [bug report](https://sourceforge.net/p/maxima/bugs/3237/):

```
sage -t src/sage/interfaces/maxima_lib.py
******************************************************************
****
File "src/sage/interfaces/maxima_lib.py", line 724, in sage.interf
aces.maxima_lib.MaximaLib.sr_integral
Failed example:
    integrate(1 / (1 + abs(x-5)), x, -5, 6)
Exception raised:
...
    TypeError: unable to make sense of Maxima expression 'limit(if(-(_SAGE_VAR_x-5)>0,-log(6-_SAGE_VAR_x),log(abs(_SAGE_VAR_x-4))),_SAGE_VAR_x,-5,plus)' in Sage
**********************************************************************
```




---

archive/issue_comments_254602.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2017-01-17T23:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254602",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_254603.json:
```json
{
    "body": "cleaned up the branch",
    "created_at": "2017-01-17T23:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254603",
    "user": "dimpase"
}
```

cleaned up the branch



---

archive/issue_comments_254604.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-18T00:13:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254604",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254605.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-18T11:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254605",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254606.json:
```json
{
    "body": "OK, all done, ready for review, at last.",
    "created_at": "2017-01-18T12:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254606",
    "user": "dimpase"
}
```

OK, all done, ready for review, at last.



---

archive/issue_comments_254607.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-18T12:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254607",
    "user": "dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_254608.json:
```json
{
    "body": "Instead of removing this doctest:\n\n```diff\ndiff --git a/src/sage/symbolic/expression.pyx b/src/sage/symbolic/expression.pyx\nindex 80c7149..0ca7904 100644\n--- a/src/sage/symbolic/expression.pyx\n+++ b/src/sage/symbolic/expression.pyx\n@@ -10597,8 +10597,13 @@ cdef class Expression(CommutativeRingElement):\n             Q\n             sage: solve(Q*sqrt(Q^2 + 2) - 1, Q)\n             [Q == 1/sqrt(Q^2 + 2)]\n+\n+        The following example is a regression in Maxima 5.39.0,\n+        it used to be possible to get 2 solutions here, see\n+        https://sourceforge.net/p/maxima/bugs/3276/::\n+\n             sage: solve(Q*sqrt(Q^2 + 2) - 1, Q, to_poly_solve=True)\n-            [Q == 1/sqrt(-sqrt(2) + 1), Q == 1/sqrt(sqrt(2) + 1)]\n+            [Q == -sqrt(-sqrt(2) - 1)]\n \n         In some cases there may be infinitely many solutions indexed\n         by a dummy variable.  If it begins with ``z``, it is implicitly\n```\n\nI would instead mark the previous solution as `# known bug` or at least keep the solution. Same in `calculus/tests.py`.",
    "created_at": "2017-01-18T16:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254608",
    "user": "tscrim"
}
```

Instead of removing this doctest:

```diff
diff --git a/src/sage/symbolic/expression.pyx b/src/sage/symbolic/expression.pyx
index 80c7149..0ca7904 100644
--- a/src/sage/symbolic/expression.pyx
+++ b/src/sage/symbolic/expression.pyx
@@ -10597,8 +10597,13 @@ cdef class Expression(CommutativeRingElement):
             Q
             sage: solve(Q*sqrt(Q^2 + 2) - 1, Q)
             [Q == 1/sqrt(Q^2 + 2)]
+
+        The following example is a regression in Maxima 5.39.0,
+        it used to be possible to get 2 solutions here, see
+        https://sourceforge.net/p/maxima/bugs/3276/::
+
             sage: solve(Q*sqrt(Q^2 + 2) - 1, Q, to_poly_solve=True)
-            [Q == 1/sqrt(-sqrt(2) + 1), Q == 1/sqrt(sqrt(2) + 1)]
+            [Q == -sqrt(-sqrt(2) - 1)]
 
         In some cases there may be infinitely many solutions indexed
         by a dummy variable.  If it begins with ``z``, it is implicitly
```

I would instead mark the previous solution as `# known bug` or at least keep the solution. Same in `calculus/tests.py`.



---

archive/issue_comments_254609.json:
```json
{
    "body": "On Debian testing (Core i7 + 16 GB Ram), on a branch where R 3.2.2 is merged with the latest released Sage, a parallel test (`MAKE=\"make -j8\"`) gives :\n\n\n```\n----------------------------------------------------------------------\nsage -t --long --warn-long 114.8 src/sage/tests/cmdline.py  # 2 doctests failed\nsage -t --long --warn-long 114.8 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 1 doctest failed\nsage -t --long --warn-long 114.8 src/sage/interfaces/tests.py  # 1 doctest failed\nsage -t --long --warn-long 114.8 src/sage/homology/simplicial_complex.py  # 1 doctest failed\nsage -t --long --warn-long 114.8 src/sage/modules/free_module_element.pyx  # Timed out\n----------------------------------------------------------------------\n```\n\n\n4 of these five are transient, and pass when run sandalone.\n\nHowever:\n\n```\ncharpent@asus16-ec:/usr/local/sage-7$ sage -t --long --warn-long 114.8 src/sage/rings/polynomial/multi_polynomial_ideal.py\nRunning doctests with ID 2017-01-18-16-59-41-26a3a809.\nGit branch: testR\nUsing --optional=database_gap,giacpy_sage,mpir,python2,sage,xz\nDoctesting 1 file.\nsage -t --long --warn-long 114.8 src/sage/rings/polynomial/multi_polynomial_ideal.py\n**********************************************************************\nFile \"src/sage/rings/polynomial/multi_polynomial_ideal.py\", line 3532, in sage.rings.polynomial.multi_polynomial_ideal.NCPolynomialIdeal.groebner_basis\nFailed example:\n    ideal(J.transformed_basis()).change_ring(P).interreduced_basis()  # optional - giacpy_sage\nExpected:\n    [a - 60*c^3 + 158/7*c^2 + 8/7*c - 1, b + 30*c^3 - 79/7*c^2 + 3/7*c, c^4 - 10/21*c^3 + 1/84*c^2 + 1/84*c]\nGot:\n    [7*a - 420*c^3 + 158*c^2 + 8*c - 7, 7*b + 210*c^3 - 79*c^2 + 3*c, 84*c^4 - 40*c^3 + c^2 + c]\n**********************************************************************\n1 item had failures:\n   1 of  67 in sage.rings.polynomial.multi_polynomial_ideal.NCPolynomialIdeal.groebner_basis\n    [727 tests, 1 failure, 9.29 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 114.8 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 9.4 seconds\n    cpu time: 15.5 seconds\n    cumulative wall time: 9.3 seconds\n```\n\n\nThis latter bug is known, not really a bug and has its own ticket.\n\nFurthermore, Maxima 5.38.1 (Debian testing current version) fixes one of my pet peeves :\n\n\n```\ncharpent@SAP5057241:~$ maxima\n\nMaxima 5.38.1 http://maxima.sourceforge.net\nusing Lisp GNU Common Lisp (GCL) GCL 2.6.12\nDistributed under the GNU Public License. See the file COPYING.\nDedicated to the memory of William Schelter.\nThe function bug_report() provides bug reporting information.\n(%i1) display2d:false;\n\n(%o1) false\n(%i2) integrate(f(x),x);\n\n(%o2) 'integrate(f(x),x)\n(%i3) taylor(integrate(f(x),x),x,x_0,2);\n\n(%o3) 'at('integrate(f(x),x),x = x_0)+f(x_0)*(x-x_0)\n                                     +(('at('diff(f(x),x,1),x = x_0))\n                                      *(x-x_0)^2)\n                                      /2\n```\n\n\nWhereas Sage's Maxima gives :\n\n```\ncharpent@SAP5057241:~$ sage -maxima\n;;; Loading #P\"/usr/local/sage-7/local/lib/ecl/sb-bsd-sockets.fas\"\n;;; Loading #P\"/usr/local/sage-7/local/lib/ecl/sockets.fas\"\n;;; Loading #P\"/usr/local/sage-7/local/lib/ecl/defsystem.fas\"\n;;; Loading #P\"/usr/local/sage-7/local/lib/ecl/cmp.fas\"\nMaxima 5.39.0 http://maxima.sourceforge.net\nusing Lisp ECL 16.1.2\nDistributed under the GNU Public License. See the file COPYING.\nDedicated to the memory of William Schelter.\nThe function bug_report() provides bug reporting information.\n(%i1) display2d:false;\n\n(%o1) false\n(%i2) integrate(f(x),x);         \n\n(%o2) 'integrate(f(x),x)\n(%i3) taylor(integrate(f(x),x),x,x_0,2);\n\ntaylor: unable to expand at a point specified in:\n'integrate(f(x),x)\n -- an error. To debug this try: debugmode(true);\n```\n\n\nSo, we have :\n* already known problems with parallel testing ;\n* one already reported and ticketed test failure ;\n* one not already reported problem, that continues the previous behaviour of Maxima-in-Sage, whereas this behavior has been fixed in 5.38.1.\n\nNone of these seem to impede giving this ticket a `positive_review`. Which I'd do unless you think that the behavior of the `taylor(integrate(...)...)` should/could be fixed with this issue.\n\nHowever, I think the objection of Thierry Scrim (?) valid, and I think it is more important, since it points out a case where Maxima's answer is incomplete. Hence ==>`needs_work`.",
    "created_at": "2017-01-18T16:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254609",
    "user": "charpent"
}
```

On Debian testing (Core i7 + 16 GB Ram), on a branch where R 3.2.2 is merged with the latest released Sage, a parallel test (`MAKE="make -j8"`) gives :


```
----------------------------------------------------------------------
sage -t --long --warn-long 114.8 src/sage/tests/cmdline.py  # 2 doctests failed
sage -t --long --warn-long 114.8 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 1 doctest failed
sage -t --long --warn-long 114.8 src/sage/interfaces/tests.py  # 1 doctest failed
sage -t --long --warn-long 114.8 src/sage/homology/simplicial_complex.py  # 1 doctest failed
sage -t --long --warn-long 114.8 src/sage/modules/free_module_element.pyx  # Timed out
----------------------------------------------------------------------
```


4 of these five are transient, and pass when run sandalone.

However:

```
charpent@asus16-ec:/usr/local/sage-7$ sage -t --long --warn-long 114.8 src/sage/rings/polynomial/multi_polynomial_ideal.py
Running doctests with ID 2017-01-18-16-59-41-26a3a809.
Git branch: testR
Using --optional=database_gap,giacpy_sage,mpir,python2,sage,xz
Doctesting 1 file.
sage -t --long --warn-long 114.8 src/sage/rings/polynomial/multi_polynomial_ideal.py
**********************************************************************
File "src/sage/rings/polynomial/multi_polynomial_ideal.py", line 3532, in sage.rings.polynomial.multi_polynomial_ideal.NCPolynomialIdeal.groebner_basis
Failed example:
    ideal(J.transformed_basis()).change_ring(P).interreduced_basis()  # optional - giacpy_sage
Expected:
    [a - 60*c^3 + 158/7*c^2 + 8/7*c - 1, b + 30*c^3 - 79/7*c^2 + 3/7*c, c^4 - 10/21*c^3 + 1/84*c^2 + 1/84*c]
Got:
    [7*a - 420*c^3 + 158*c^2 + 8*c - 7, 7*b + 210*c^3 - 79*c^2 + 3*c, 84*c^4 - 40*c^3 + c^2 + c]
**********************************************************************
1 item had failures:
   1 of  67 in sage.rings.polynomial.multi_polynomial_ideal.NCPolynomialIdeal.groebner_basis
    [727 tests, 1 failure, 9.29 s]
----------------------------------------------------------------------
sage -t --long --warn-long 114.8 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 9.4 seconds
    cpu time: 15.5 seconds
    cumulative wall time: 9.3 seconds
```


This latter bug is known, not really a bug and has its own ticket.

Furthermore, Maxima 5.38.1 (Debian testing current version) fixes one of my pet peeves :


```
charpent@SAP5057241:~$ maxima

Maxima 5.38.1 http://maxima.sourceforge.net
using Lisp GNU Common Lisp (GCL) GCL 2.6.12
Distributed under the GNU Public License. See the file COPYING.
Dedicated to the memory of William Schelter.
The function bug_report() provides bug reporting information.
(%i1) display2d:false;

(%o1) false
(%i2) integrate(f(x),x);

(%o2) 'integrate(f(x),x)
(%i3) taylor(integrate(f(x),x),x,x_0,2);

(%o3) 'at('integrate(f(x),x),x = x_0)+f(x_0)*(x-x_0)
                                     +(('at('diff(f(x),x,1),x = x_0))
                                      *(x-x_0)^2)
                                      /2
```


Whereas Sage's Maxima gives :

```
charpent@SAP5057241:~$ sage -maxima
;;; Loading #P"/usr/local/sage-7/local/lib/ecl/sb-bsd-sockets.fas"
;;; Loading #P"/usr/local/sage-7/local/lib/ecl/sockets.fas"
;;; Loading #P"/usr/local/sage-7/local/lib/ecl/defsystem.fas"
;;; Loading #P"/usr/local/sage-7/local/lib/ecl/cmp.fas"
Maxima 5.39.0 http://maxima.sourceforge.net
using Lisp ECL 16.1.2
Distributed under the GNU Public License. See the file COPYING.
Dedicated to the memory of William Schelter.
The function bug_report() provides bug reporting information.
(%i1) display2d:false;

(%o1) false
(%i2) integrate(f(x),x);         

(%o2) 'integrate(f(x),x)
(%i3) taylor(integrate(f(x),x),x,x_0,2);

taylor: unable to expand at a point specified in:
'integrate(f(x),x)
 -- an error. To debug this try: debugmode(true);
```


So, we have :
* already known problems with parallel testing ;
* one already reported and ticketed test failure ;
* one not already reported problem, that continues the previous behaviour of Maxima-in-Sage, whereas this behavior has been fixed in 5.38.1.

None of these seem to impede giving this ticket a `positive_review`. Which I'd do unless you think that the behavior of the `taylor(integrate(...)...)` should/could be fixed with this issue.

However, I think the objection of Thierry Scrim (?) valid, and I think it is more important, since it points out a case where Maxima's answer is incomplete. Hence ==>`needs_work`.



---

archive/issue_comments_254610.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-01-18T16:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254610",
    "user": "charpent"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_254611.json:
```json
{
    "body": "Replying to [comment:108 dimpase]:\n> 4) this is a known Maxima issue [bug report](https://sourceforge.net/p/maxima/bugs/3237/):\n> {{{\n> sage -t src/sage/interfaces/maxima_lib.py\n> ******************************************************************\n> ****\n> File \"src/sage/interfaces/maxima_lib.py\", line 724, in sage.interf\n> aces.maxima_lib.MaximaLib.sr_integral\n> Failed example:\n>     integrate(1 / (1 + abs(x-5)), x, -5, 6)\n> Exception raised:\n> ...\n>     TypeError: unable to make sense of Maxima expression 'limit(if(-(_SAGE_VAR_x-5)>0,-log(6-_SAGE_VAR_x),log(abs(_SAGE_VAR_x-4))),_SAGE_VAR_x,-5,plus)' in Sage\n> **********************************************************************\n> }}}\n\nActually I believe Maxima is not to blame here, and in the bug report the dev says \"not technically incorrect\". See #17892 for our symbolic limit ticket.",
    "created_at": "2017-01-18T16:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254611",
    "user": "rws"
}
```

Replying to [comment:108 dimpase]:
> 4) this is a known Maxima issue [bug report](https://sourceforge.net/p/maxima/bugs/3237/):
> {{{
> sage -t src/sage/interfaces/maxima_lib.py
> ******************************************************************
> ****
> File "src/sage/interfaces/maxima_lib.py", line 724, in sage.interf
> aces.maxima_lib.MaximaLib.sr_integral
> Failed example:
>     integrate(1 / (1 + abs(x-5)), x, -5, 6)
> Exception raised:
> ...
>     TypeError: unable to make sense of Maxima expression 'limit(if(-(_SAGE_VAR_x-5)>0,-log(6-_SAGE_VAR_x),log(abs(_SAGE_VAR_x-4))),_SAGE_VAR_x,-5,plus)' in Sage
> **********************************************************************
> }}}

Actually I believe Maxima is not to blame here, and in the bug report the dev says "not technically incorrect". See #17892 for our symbolic limit ticket.



---

archive/issue_comments_254612.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-18T18:22:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254612",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254613.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-18T18:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254613",
    "user": "dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_254614.json:
```json
{
    "body": "As a minor point, when reviewing documentation tickets I always ask that lines be kept to about the same length. I would appreciate if you could break the long lines here, especially in the tutorials. Thanks.",
    "created_at": "2017-01-18T21:46:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254614",
    "user": "paulmasson"
}
```

As a minor point, when reviewing documentation tickets I always ask that lines be kept to about the same length. I would appreciate if you could break the long lines here, especially in the tutorials. Thanks.



---

archive/issue_comments_254615.json:
```json
{
    "body": "This time, three failures in a parallel `ptestlong` :\n\n```\n----------------------------------------------------------------------\nsage -t --long --warn-long 110.0 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 1 doctest failed\nsage -t --long --warn-long 110.0 src/sage/homology/simplicial_complex.py  # 1 doctest failed\nsage -t --long --warn-long 110.0 src/sage/graphs/generators/smallgraphs.py  # Timed out\n----------------------------------------------------------------------\n```\n\n\nOlny the firs one persists when run standalone, and is our old aquaintance... The other two are transient (race conditions ?)\n\nSince the explanation given in #22191 show that the problem I signaled before is in ECL's realm, not Maxima's, there is no reason not to give this a `positive_review`.\n\nAaaaahhhhh !",
    "created_at": "2017-01-18T23:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254615",
    "user": "charpent"
}
```

This time, three failures in a parallel `ptestlong` :

```
----------------------------------------------------------------------
sage -t --long --warn-long 110.0 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 1 doctest failed
sage -t --long --warn-long 110.0 src/sage/homology/simplicial_complex.py  # 1 doctest failed
sage -t --long --warn-long 110.0 src/sage/graphs/generators/smallgraphs.py  # Timed out
----------------------------------------------------------------------
```


Olny the firs one persists when run standalone, and is our old aquaintance... The other two are transient (race conditions ?)

Since the explanation given in #22191 show that the problem I signaled before is in ECL's realm, not Maxima's, there is no reason not to give this a `positive_review`.

Aaaaahhhhh !



---

archive/issue_comments_254616.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-18T23:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254616",
    "user": "charpent"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_254617.json:
```json
{
    "body": "Reviewer name missing",
    "created_at": "2017-01-18T23:17:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254617",
    "user": "vbraun"
}
```

Reviewer name missing



---

archive/issue_comments_254618.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-01-18T23:17:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254618",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_254619.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-01-18T23:20:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254619",
    "user": "tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_254620.json:
```json
{
    "body": "Adding some other people who I recall contributing comments, but may not be comprehensive or conservative (i.e., add/subtract your name).",
    "created_at": "2017-01-18T23:26:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254620",
    "user": "tscrim"
}
```

Adding some other people who I recall contributing comments, but may not be comprehensive or conservative (i.e., add/subtract your name).



---

archive/issue_comments_254621.json:
```json
{
    "body": "public/maxima5390 doesn't exist... typo?",
    "created_at": "2017-01-21T17:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254621",
    "user": "vbraun"
}
```

public/maxima5390 doesn't exist... typo?



---

archive/issue_comments_254622.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-01-21T17:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254622",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_254623.json:
```json
{
    "body": "what? so it did quietly vanish? IMHO the whole git tree is fcked:\n\n```\n$ git push trac HEAD:public/maxima5390bis \nerror: unable to push to unqualified destination: public/maxima5390bis\nThe destination refspec neither matches an existing ref on the remote nor\nbegins with refs/, and we are unable to guess a prefix based on the source ref.\nerror: failed to push some refs to 'git@trac.sagemath.org:sage.git'\n```\n\n\nEDIT: this went through on a 3rd attempt",
    "created_at": "2017-01-21T18:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254623",
    "user": "dimpase"
}
```

what? so it did quietly vanish? IMHO the whole git tree is fcked:

```
$ git push trac HEAD:public/maxima5390bis 
error: unable to push to unqualified destination: public/maxima5390bis
The destination refspec neither matches an existing ref on the remote nor
begins with refs/, and we are unable to guess a prefix based on the source ref.
error: failed to push some refs to 'git@trac.sagemath.org:sage.git'
```


EDIT: this went through on a 3rd attempt



---

archive/issue_comments_254624.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-21T18:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254624",
    "user": "dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_254625.json:
```json
{
    "body": "Could please a reviewer compare the new branch with the old one he has locally? E.g. as follows:\n\n```\ngit fetch trac public/maxima5390bis\ngit diff FETCH_HEAD trac/public/maxima5390\n```\n\nif this `diff` returns nothing we're good to go.",
    "created_at": "2017-01-21T18:23:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254625",
    "user": "dimpase"
}
```

Could please a reviewer compare the new branch with the old one he has locally? E.g. as follows:

```
git fetch trac public/maxima5390bis
git diff FETCH_HEAD trac/public/maxima5390
```

if this `diff` returns nothing we're good to go.



---

archive/issue_comments_254626.json:
```json
{
    "body": "I use git-trac (nice !...), so I did :\n\n```\ncharpent@asus16-ec:/usr/local/sage-7$ git fetch trac public/maxima5390bis\nDepuis git://trac.sagemath.org/sage\n * branch                  public/maxima5390bis -> FETCH_HEAD\ncharpent@asus16-ec:/usr/local/sage-7$ git diff FETCH_HEAD t/18920/public/maxima5390 \ncharpent@asus16-ec:/usr/local/sage-7$ \n```\n\nSo, unless I'm mistaken, \"we're good to go\"...\n\nHTH,",
    "created_at": "2017-01-21T19:01:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254626",
    "user": "charpent"
}
```

I use git-trac (nice !...), so I did :

```
charpent@asus16-ec:/usr/local/sage-7$ git fetch trac public/maxima5390bis
Depuis git://trac.sagemath.org/sage
 * branch                  public/maxima5390bis -> FETCH_HEAD
charpent@asus16-ec:/usr/local/sage-7$ git diff FETCH_HEAD t/18920/public/maxima5390 
charpent@asus16-ec:/usr/local/sage-7$ 
```

So, unless I'm mistaken, "we're good to go"...

HTH,



---

archive/issue_comments_254627.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-21T19:07:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254627",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_254628.json:
```json
{
    "body": "Thanks. Hope the branch will not be cut again...",
    "created_at": "2017-01-21T21:25:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254628",
    "user": "dimpase"
}
```

Thanks. Hope the branch will not be cut again...



---

archive/issue_comments_254629.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-01-22T09:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254629",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_254630.json:
```json
{
    "body": "Fails to build, e.g. http://build.sagedev.org/#/builders/16/builds/8/steps/5/logs/maxima",
    "created_at": "2017-01-22T09:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254630",
    "user": "vbraun"
}
```

Fails to build, e.g. http://build.sagedev.org/#/builders/16/builds/8/steps/5/logs/maxima



---

archive/issue_comments_254631.json:
```json
{
    "body": "It says `makeinfo not found`. Great, we always had a few for maxima's documentation but I thought `makeinfo` was a requisite.",
    "created_at": "2017-01-22T09:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254631",
    "user": "fbissey"
}
```

It says `makeinfo not found`. Great, we always had a few for maxima's documentation but I thought `makeinfo` was a requisite.



---

archive/issue_comments_254632.json:
```json
{
    "body": "Maybe there is a make target that doesn't build the texinfo docs?",
    "created_at": "2017-01-22T09:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254632",
    "user": "vbraun"
}
```

Maybe there is a make target that doesn't build the texinfo docs?



---

archive/issue_comments_254633.json:
```json
{
    "body": "Replying to [comment:131 vbraun]:\n> Fails to build, e.g. http://build.sagedev.org/#/builders/16/builds/8/steps/5/logs/maxima\n\nI cannot find anything there, the interface is pretty impossible to use for me.\nCan I have a link to the log file I can download?",
    "created_at": "2017-01-22T10:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254633",
    "user": "dimpase"
}
```

Replying to [comment:131 vbraun]:
> Fails to build, e.g. http://build.sagedev.org/#/builders/16/builds/8/steps/5/logs/maxima

I cannot find anything there, the interface is pretty impossible to use for me.
Can I have a link to the log file I can download?



---

archive/issue_comments_254634.json:
```json
{
    "body": "Replying to [comment:133 vbraun]:\n> Maybe there is a make target that doesn't build the texinfo docs?\n\nI'd say, just add `makeinfo` to the list of pre-reqs.\nIt has been necessary to have it to build Maxima \nfor years, see e.g. https://sourceforge.net/p/maxima/bugs/2878/\n\nAnd it looks like the latter Maxima ticket did not fix anything :-)",
    "created_at": "2017-01-22T10:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254634",
    "user": "dimpase"
}
```

Replying to [comment:133 vbraun]:
> Maybe there is a make target that doesn't build the texinfo docs?

I'd say, just add `makeinfo` to the list of pre-reqs.
It has been necessary to have it to build Maxima 
for years, see e.g. https://sourceforge.net/p/maxima/bugs/2878/

And it looks like the latter Maxima ticket did not fix anything :-)



---

archive/issue_comments_254635.json:
```json
{
    "body": "something that has been a problem since Maxima 5.23 should not stop this ticket...",
    "created_at": "2017-01-22T10:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254635",
    "user": "dimpase"
}
```

something that has been a problem since Maxima 5.23 should not stop this ticket...



---

archive/issue_comments_254636.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-01-22T10:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254636",
    "user": "dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_254637.json:
```json
{
    "body": "I think we may have some workaround by touching the right file. It is not in the current spkg-install, so we have dropped it at some point. You are right to point to upstream that they have a regression. For info:\nhttps://github.com/sagemath/sage/commit/6656b7b171d83078bd55c3cceea0f45da517ded0",
    "created_at": "2017-01-22T10:17:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254637",
    "user": "fbissey"
}
```

I think we may have some workaround by touching the right file. It is not in the current spkg-install, so we have dropped it at some point. You are right to point to upstream that they have a regression. For info:
https://github.com/sagemath/sage/commit/6656b7b171d83078bd55c3cceea0f45da517ded0



---

archive/issue_comments_254638.json:
```json
{
    "body": "Seriously, the buildbots don't have makeinfo installed",
    "created_at": "2017-01-22T11:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254638",
    "user": "vbraun"
}
```

Seriously, the buildbots don't have makeinfo installed



---

archive/issue_comments_254639.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-01-22T11:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254639",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_254640.json:
```json
{
    "body": "Replying to [comment:137 fbissey]:\n> I think we may have some workaround by touching the right file. It is not in the current spkg-install, so we have dropped it at some point. You are right to point to upstream that they have a regression. For info:\n> https://github.com/sagemath/sage/commit/6656b7b171d83078bd55c3cceea0f45da517ded0\n\nperhaps our workound + Maxima's workarond + no makeinfo == error... :)\n\nI'll check this.",
    "created_at": "2017-01-22T11:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254640",
    "user": "dimpase"
}
```

Replying to [comment:137 fbissey]:
> I think we may have some workaround by touching the right file. It is not in the current spkg-install, so we have dropped it at some point. You are right to point to upstream that they have a regression. For info:
> https://github.com/sagemath/sage/commit/6656b7b171d83078bd55c3cceea0f45da517ded0

perhaps our workound + Maxima's workarond + no makeinfo == error... :)

I'll check this.



---

archive/issue_comments_254641.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-22T15:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254641",
    "user": "dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_254642.json:
```json
{
    "body": "I am not convinced whether it's at all possible to build Maxima 5.39.0 and its docs without `makeinfo`. We are on our own here, as the official upstream pre-req for the build includes autotools.\n\nInstead of wasting time on this academic issue, I'd like to rather include `makeinfo` into Sage pre-reqs.",
    "created_at": "2017-01-22T15:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254642",
    "user": "dimpase"
}
```

I am not convinced whether it's at all possible to build Maxima 5.39.0 and its docs without `makeinfo`. We are on our own here, as the official upstream pre-req for the build includes autotools.

Instead of wasting time on this academic issue, I'd like to rather include `makeinfo` into Sage pre-reqs.



---

archive/issue_comments_254643.json:
```json
{
    "body": "I have opened a new [Maxima ticket](https://sourceforge.net/p/maxima/bugs/3278/) on the `makeinfo` question.",
    "created_at": "2017-01-22T15:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254643",
    "user": "dimpase"
}
```

I have opened a new [Maxima ticket](https://sourceforge.net/p/maxima/bugs/3278/) on the `makeinfo` question.



---

archive/issue_comments_254644.json:
```json
{
    "body": "Replying to [comment:140 dimpase]:\n> I am not convinced whether it's at all possible to build Maxima 5.39.0 and its docs without `makeinfo`. We are on our own here, as the official upstream pre-req for the build includes autotools.\n> \n> Instead of wasting time on this academic issue, I'd like to rather include `makeinfo` into Sage pre-reqs.\n> \n\nSeconded, on basic principles :\n\n[ The following rant is not gratuitous. It's just a lemma. Bear with me for a while... ]\n\nOur \"batteries included\" so-called philosophy has pushed us to include more and more software of peripheral interest at best up to the point where Sage is now a small-scale, highly specialized Linux distribution.\n\nThis distribution is of great interest to sage **builders** (i. e. potential developpers). It is at best an hindrance (read \"pain in the *ss\") to what should be one of our primary targets : the potential **users** of Sage. And no, this cannot be restricted to research mathematicians specializing in number theory...\n\nFor example, going to the pain to build our own GCC collection seems to me pushing consistency exigences a bit too far. Requiring from an //installer// (i. e. potential developper) to take the pain to install a matching set of decently recent compilers does not sound too much to me.\n\nCorollary : our **binary** tarballs/packages should be sound enough to satisfy the largest possible number of potential **users**. That means that our users should not be requested to install and manage a virtual machine setup, nor a complicated installation on \"exotic\" platforms. An undergraduate or even high school student, a practising engineer, etc... should be able to install a precompiled binary and go use Sage as he uses a word processor, without having to install a $#!+load of tools he/she'll never use for anything else.\n\nTherefore, if we need autotools to build Maxima, let's use existing autotools distributions, and do not try to avoid it. Or maintaining our own port. Maintaining our ports should be limited to the cases where there is a mathematical reason to do so.\n\n[ End of rant. Now for its consequences : ]\n\nTherefore, I think that wiggling away from one more tool to build Sage amounts to trying to alleviate the load of **developers**. Which is the wrong target. Our primary goal should be to alleviate the load  imposed on **users**.\n\nThose two sets were largely overlapping in the begionning of Sage, which as long been targeted on a certain research community. This is no longer the case. Sage now needs a lot of **users**, able to report problems, if we want to be able to fix them.\n\nSo, in the present case, if autotools is needed to build Maxima, let's depend on it **for building Sage**. But users of a binary distribution of Sage should not have to bother themselves with that.\n\nIn other (shorter) words : I'm not bothered by one more build dependency, if I can lighten the run dependencies... This seems the case here.\n\nCorollary : the time spent on arguing and nitpicking over autotools would have been better spent helping Eric Bray's Cygwin port //cum// Windows installer, which opens us a quite large pool of potential users...",
    "created_at": "2017-01-22T16:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254644",
    "user": "charpent"
}
```

Replying to [comment:140 dimpase]:
> I am not convinced whether it's at all possible to build Maxima 5.39.0 and its docs without `makeinfo`. We are on our own here, as the official upstream pre-req for the build includes autotools.
> 
> Instead of wasting time on this academic issue, I'd like to rather include `makeinfo` into Sage pre-reqs.
> 

Seconded, on basic principles :

[ The following rant is not gratuitous. It's just a lemma. Bear with me for a while... ]

Our "batteries included" so-called philosophy has pushed us to include more and more software of peripheral interest at best up to the point where Sage is now a small-scale, highly specialized Linux distribution.

This distribution is of great interest to sage **builders** (i. e. potential developpers). It is at best an hindrance (read "pain in the *ss") to what should be one of our primary targets : the potential **users** of Sage. And no, this cannot be restricted to research mathematicians specializing in number theory...

For example, going to the pain to build our own GCC collection seems to me pushing consistency exigences a bit too far. Requiring from an //installer// (i. e. potential developper) to take the pain to install a matching set of decently recent compilers does not sound too much to me.

Corollary : our **binary** tarballs/packages should be sound enough to satisfy the largest possible number of potential **users**. That means that our users should not be requested to install and manage a virtual machine setup, nor a complicated installation on "exotic" platforms. An undergraduate or even high school student, a practising engineer, etc... should be able to install a precompiled binary and go use Sage as he uses a word processor, without having to install a $#!+load of tools he/she'll never use for anything else.

Therefore, if we need autotools to build Maxima, let's use existing autotools distributions, and do not try to avoid it. Or maintaining our own port. Maintaining our ports should be limited to the cases where there is a mathematical reason to do so.

[ End of rant. Now for its consequences : ]

Therefore, I think that wiggling away from one more tool to build Sage amounts to trying to alleviate the load of **developers**. Which is the wrong target. Our primary goal should be to alleviate the load  imposed on **users**.

Those two sets were largely overlapping in the begionning of Sage, which as long been targeted on a certain research community. This is no longer the case. Sage now needs a lot of **users**, able to report problems, if we want to be able to fix them.

So, in the present case, if autotools is needed to build Maxima, let's depend on it **for building Sage**. But users of a binary distribution of Sage should not have to bother themselves with that.

In other (shorter) words : I'm not bothered by one more build dependency, if I can lighten the run dependencies... This seems the case here.

Corollary : the time spent on arguing and nitpicking over autotools would have been better spent helping Eric Bray's Cygwin port //cum// Windows installer, which opens us a quite large pool of potential users...



---

archive/issue_comments_254645.json:
```json
{
    "body": "autotools are not needed to build Maxima, but makeinfo apparently is. \n\nPerhaps one can build Maxima without makeinfo if autotools are available, I didn't check, for this is even more academic question...\n \nmakeinfo is a very easy pre-req, as it is available on every system we build Sage on, and included in XCode too.",
    "created_at": "2017-01-22T17:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254645",
    "user": "dimpase"
}
```

autotools are not needed to build Maxima, but makeinfo apparently is. 

Perhaps one can build Maxima without makeinfo if autotools are available, I didn't check, for this is even more academic question...
 
makeinfo is a very easy pre-req, as it is available on every system we build Sage on, and included in XCode too.



---

archive/issue_comments_254646.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-22T19:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254646",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254647.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-22T19:07:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254647",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_254648.json:
```json
{
    "body": "I think this is enough. \n\nI have now re-introduced the `makeinfo` workaround and my logs says it is safe to use on a `makeinfo`-less system.\n\nI appreciate the feeling Emmanuel but the place for it is sage-devel - of course nothing is likely to happen for it in the short term. The reality is now there are plenty of \"user space\" package management solution around (not so many when sage was started) and most of them do a better job than the sage packaging system. The other reality is those other packaging system usually don't play well with sage. We pick problems regularly from users with a default installation of brew on OS X for example.",
    "created_at": "2017-01-22T19:07:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254648",
    "user": "fbissey"
}
```

I think this is enough. 

I have now re-introduced the `makeinfo` workaround and my logs says it is safe to use on a `makeinfo`-less system.

I appreciate the feeling Emmanuel but the place for it is sage-devel - of course nothing is likely to happen for it in the short term. The reality is now there are plenty of "user space" package management solution around (not so many when sage was started) and most of them do a better job than the sage packaging system. The other reality is those other packaging system usually don't play well with sage. We pick problems regularly from users with a default installation of brew on OS X for example.



---

archive/issue_comments_254649.json:
```json
{
    "body": "Replying to [comment:142 charpent]:\n> So, in the present case, if autotools is needed to build Maxima, let's depend on it **for building Sage**. But users of a binary distribution of Sage should not have to bother themselves with that.\n> \n> In other (shorter) words : I'm not bothered by one more build dependency, if I can lighten the run dependencies... This seems the case here.\n\nUsers of binary distributions of Sage should still be able to install optional and experimental packages. Since there is no binary distribution of optional packages, build-time tools need to be included.\n\nI would propose to add a standard package that includes (a current version of) texinfo (which provides makeinfo). Note that our autotools spkg packages only an ancient version of texinfo (4.13) (see #21196 for a discussion).",
    "created_at": "2017-01-22T19:09:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254649",
    "user": "mkoeppe"
}
```

Replying to [comment:142 charpent]:
> So, in the present case, if autotools is needed to build Maxima, let's depend on it **for building Sage**. But users of a binary distribution of Sage should not have to bother themselves with that.
> 
> In other (shorter) words : I'm not bothered by one more build dependency, if I can lighten the run dependencies... This seems the case here.

Users of binary distributions of Sage should still be able to install optional and experimental packages. Since there is no binary distribution of optional packages, build-time tools need to be included.

I would propose to add a standard package that includes (a current version of) texinfo (which provides makeinfo). Note that our autotools spkg packages only an ancient version of texinfo (4.13) (see #21196 for a discussion).



---

archive/issue_comments_254650.json:
```json
{
    "body": "Replying to [comment:143 dimpase]:\n> autotools are not needed to build Maxima, but makeinfo apparently is. \nIt should not be; the bug is that the necessary TeX files are not included in the tarball.  Even if the user does not have makeinfo, there should be no problem because the configure script will set $(MAKEINFO) to a command that does nothing.  There is at least one place where a Maxima makefile uses `makeinfo` instead of `$(MAKEINFO)`.  In #17514 I fixed this specific one, but I seem to remember another problem of this kind in newer Maxima versions.  Anyway, the only way to really fix this is if the Maxima developers make sure that all TeX files are in the distribution.",
    "created_at": "2017-01-23T07:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254650",
    "user": "pbruin"
}
```

Replying to [comment:143 dimpase]:
> autotools are not needed to build Maxima, but makeinfo apparently is. 
It should not be; the bug is that the necessary TeX files are not included in the tarball.  Even if the user does not have makeinfo, there should be no problem because the configure script will set $(MAKEINFO) to a command that does nothing.  There is at least one place where a Maxima makefile uses `makeinfo` instead of `$(MAKEINFO)`.  In #17514 I fixed this specific one, but I seem to remember another problem of this kind in newer Maxima versions.  Anyway, the only way to really fix this is if the Maxima developers make sure that all TeX files are in the distribution.



---

archive/issue_comments_254651.json:
```json
{
    "body": "I have got a funny failing doctest in sage-on-gentoo but I am not completely sure this ticket is responsible (I am testing from the current develop branch of Volker's fork where he is testing this now)\n\n```\nsage -t --long /usr/lib64/python2.7/site-packages/sage/functions/special.py\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/functions/special.py\", line 232, in sage.functions.special.SphericalHarmonic._eval_\nFailed example:\n    spherical_harmonic(3,2,1,2*pi/3)\nExpected:\n    1/240*sqrt(30)*(-15*I*sqrt(7)*sqrt(3)\n     - 15*sqrt(7))*cos(1)*sin(1)^2/sqrt(pi)\nGot:\n    -1/240*sqrt(30)*(15*I*sqrt(7)*sqrt(3) + 15*sqrt(7))*cos(1)*sin(1)^2/sqrt(pi)\n**********************************************************************\n```\n\nAs you can see they are actually identical...",
    "created_at": "2017-01-24T19:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254651",
    "user": "fbissey"
}
```

I have got a funny failing doctest in sage-on-gentoo but I am not completely sure this ticket is responsible (I am testing from the current develop branch of Volker's fork where he is testing this now)

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/functions/special.py
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/functions/special.py", line 232, in sage.functions.special.SphericalHarmonic._eval_
Failed example:
    spherical_harmonic(3,2,1,2*pi/3)
Expected:
    1/240*sqrt(30)*(-15*I*sqrt(7)*sqrt(3)
     - 15*sqrt(7))*cos(1)*sin(1)^2/sqrt(pi)
Got:
    -1/240*sqrt(30)*(15*I*sqrt(7)*sqrt(3) + 15*sqrt(7))*cos(1)*sin(1)^2/sqrt(pi)
**********************************************************************
```

As you can see they are actually identical...



---

archive/issue_comments_254652.json:
```json
{
    "body": "I get the same on the buildbot....",
    "created_at": "2017-01-24T23:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254652",
    "user": "vbraun"
}
```

I get the same on the buildbot....



---

archive/issue_comments_254653.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-01-24T23:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254653",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_254654.json:
```json
{
    "body": "All bots or a mixture?",
    "created_at": "2017-01-25T03:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254654",
    "user": "fbissey"
}
```

All bots or a mixture?



---

archive/issue_comments_254655.json:
```json
{
    "body": "all",
    "created_at": "2017-01-25T08:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254655",
    "user": "vbraun"
}
```

all



---

archive/issue_comments_254656.json:
```json
{
    "body": "Doctest introduced by #20939 merged in 7.6.beta0, that's why it was missed. The branch needs re-basing before it can be fixed. Incoming.",
    "created_at": "2017-01-25T08:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254656",
    "user": "fbissey"
}
```

Doctest introduced by #20939 merged in 7.6.beta0, that's why it was missed. The branch needs re-basing before it can be fixed. Incoming.



---

archive/issue_comments_254657.json:
```json
{
    "body": "Please go on with this. I have negative amount of time available till the end of the week.",
    "created_at": "2017-01-25T08:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254657",
    "user": "dimpase"
}
```

Please go on with this. I have negative amount of time available till the end of the week.



---

archive/issue_comments_254658.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-25T08:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254658",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_254659.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-01-25T08:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254659",
    "user": "fbissey"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_254660.json:
```json
{
    "body": "Definitely, not waiting for you. Here we go again, straight to positive review.",
    "created_at": "2017-01-25T08:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254660",
    "user": "fbissey"
}
```

Definitely, not waiting for you. Here we go again, straight to positive review.



---

archive/issue_comments_254661.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-01-28T17:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18683#issuecomment-254661",
    "user": "vbraun"
}
```

Resolution: fixed
