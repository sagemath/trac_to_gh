# Issue 17540: unsigned infinity cannot be coerced into SR

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2015-02-13 17:13:55

This is needed e.g. by `BuiltinFunction`s returning that value (#17678).

```
sage: from sage.rings.infinity import infinity, unsigned_infinity
sage: SR.coerce(infinity)
+Infinity
sage: SR.coerce(unsigned_infinity)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-5-164e151d39b6> in <module>()
----> 1 SR.coerce(unsigned_infinity)

/home/ralf/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.coerce (build/cythonized/sage/structure/parent.c:10777)()
   1290             return False
   1291 
-> 1292     cpdef coerce(self, x):
   1293         """
   1294         Return x as an element of self, if and only if there is a canonical

/home/ralf/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.coerce (build/cythonized/sage/structure/parent.c:10711)()
   1317                 except Exception:
   1318                     _record_exception()
-> 1319             raise TypeError("no canonical coercion from %s to %s" % (parent_c(x), self))
   1320         else:
   1321             return (<map.Map>mor)._call_(x)

TypeError: no canonical coercion from The Unsigned Infinity Ring to Symbolic Ring
```



---

Comment by rws created at 2015-02-14 07:51:05

Changing component from algebra to symbolics.


---

Comment by rws created at 2015-02-14 07:51:05

Changing status from new to needs_review.


---

Comment by rws created at 2015-02-14 07:51:05

Is that all? That would be easier than thought.
----
New commits:


---

Comment by rws created at 2015-02-26 09:34:20


```
sage -t --long src/sage/symbolic/expression.pyx  # 1 doctest failed
sage -t --long src/sage/rings/infinity.py  # 1 doctest failed
sage -t --long src/sage/doctest/control.py  # 2 doctests failed
```



---

Comment by rws created at 2015-02-26 09:34:20

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-03-04 17:26:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2015-03-04 17:26:47

Changing status from needs_work to needs_review.


---

Comment by mmezzarobba created at 2015-03-12 15:09:23

The docstring of `sage.rings.infinity` states that:

  The rules for arithmetic are that the unsigned infinity ring does not canonically coerce to any other ring, and all other rings canonically coerce to the unsigned infinity ring, sending all elements to the single element "a number less than infinity" of the unsigned infinity ring. Arithmetic and comparisons then take place in the unsigned infinity ring, where all arithmetic operations that are well-defined are defined.

  [...]

  Any ordered ring coerces to the infinity ring in the obvious way.

So if I understand correctly `SR` already didn't respect this specification. But this makes me wonder if your patch won't make comparisons with infinities even more inconsistent. If you understand the issues at hand better than I do, can you explain how this is all supposed to work?


---

Comment by rws created at 2015-03-12 15:46:17

I think the issue is that `SR` is even more special (see e.g. https://groups.google.com/d/topic/sage-devel/Oip2hzvjFZQ/discussion the posting by Volker). Everything coerces to it.


---

Comment by rws created at 2015-05-12 15:10:09

This blocks #17678.


---

Comment by kcrisman created at 2015-05-21 16:41:23

So... I'm not sure I understand the question of the last two comments.   I don't have any objections to this but don't want to step on anyone's toes, and it (obviously) helps #17678.


---

Comment by rws created at 2015-05-24 15:21:30

The cited "The rules for arithmetic are that the unsigned infinity ring does not canonically coerce to any other ring, and all other rings canonically coerce to the unsigned infinity ring..." is obviously wrong because the symbolic ring already has this notion. Example: `SR` could have a constant `aleph2` which the infinity rings are unable to handle right now, but `SR` can handle everything thrown at it. My guess is that the cited documentation simply ignored `SR` because it's not a typical algebraic object and doesn't fit the algebraists' concepts. Tough luck.


---

Comment by kcrisman created at 2015-05-28 15:16:18

Yeah, I agree that the symbolic ring isn't a ring in the ordinary sense.  Maybe this ticket could upgrade that documentation as well with a brief note?  (mmezzarobba, would that satisfy your concerns?)


---

Comment by mmezzarobba created at 2015-05-28 16:17:35

Replying to [comment:11 kcrisman]:
> Yeah, I agree that the symbolic ring isn't a ring in the ordinary sense.  Maybe this ticket could upgrade that documentation as well with a brief note?  (mmezzarobba, would that satisfy your concerns?)

I have no strong opinion regarding whether there should be a coercion from SR to infinity rings, from infinity rings to SR, or neither. I was just pointing out that the proposed change would contradict the documentation. And yes, I guess improving that documentation is a good idea in any case!


---

Comment by kcrisman created at 2015-05-28 17:22:46

Changing status from needs_review to needs_work.


---

Comment by kcrisman created at 2015-05-28 17:22:46

Okay, let's just make sure it's clear, then.


---

Comment by git created at 2015-06-10 15:31:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2015-06-10 15:31:45

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2015-06-10 19:10:21

I like it but I think maybe it belongs in the first part of the paragraph comment:6 mentions.

> The rules for arithmetic are that the unsigned infinity ring does not canonically coerce to any other ring, and all other rings canonically coerce to the unsigned infinity ring, sending all elements to the single element "a number less than infinity" of the unsigned infinity ring. Arithmetic and comparisons then take place in the unsigned infinity ring, where all arithmetic operations that are well-defined are defined

mmezz... would this doc change satisfy you?


---

Comment by rws created at 2015-10-20 12:42:31

ping?


---

Comment by mmezzarobba created at 2015-10-22 13:23:59

Replying to [comment:16 kcrisman]:
> I like it but I think maybe it belongs in the first part of the paragraph comment:6 mentions.
> 
> > The rules for arithmetic are that the unsigned infinity ring does not canonically coerce to any other ring, and all other rings canonically coerce to the unsigned infinity ring, sending all elements to the single element "a number less than infinity" of the unsigned infinity ring. Arithmetic and comparisons then take place in the unsigned infinity ring, where all arithmetic operations that are well-defined are defined
> 
> mmezz... would this doc change satisfy you?

Sure. And my apologies for taking so long to reply, I somehow missed your question or forgot about it until Ralph's ping.


---

Comment by mmezzarobba created at 2016-03-27 10:22:28

I made (essentially) the change discussed in the last few comments. Please feel free to set the ticket to positive review if you agree with the last commit.
----
New commits:


---

Comment by mmezzarobba created at 2016-03-27 12:13:25

Wait: with this change, lots rings would coerce into `SR` both directly and through `InfinityRing`, with different results. But coercions are supposed to form a commutative diagram. I understand that both the infinity ring and the symbolic ring are a bit special, and that, with the current coercion discovery algorithm, things probably will work fine even if that assumption is broken... but still, I really don't like the idea of breaking it if that can be avoided.

Is there really no other way to make infinities and symbolic expression play well together? For example, what about having `SR` coerce into the infinity ring (and making the global identifier `infinity` refer to `SR(infinity)`?) Or, perhaps better, adding an intermediate “symbolic infinity ring” that would coerce into both `SR` and `InfinityRing`, but have no ingoing coercions?


---

Comment by mmezzarobba created at 2016-03-27 12:13:25

Changing status from needs_review to needs_info.


---

Comment by rws created at 2016-03-27 12:41:04

Replying to [comment:20 mmezzarobba]:
> Is there really no other way to make infinities and symbolic expression play well together? For example, what about having `SR` coerce into the infinity ring (and making the global identifier `infinity` refer to `SR(infinity)`?) Or, perhaps better, adding an intermediate “symbolic infinity ring” that would coerce into both `SR` and `InfinityRing`, but have no ingoing coercions?
That sounds feasible, since SR can have subrings now.


---

Comment by mmezzarobba created at 2016-03-27 12:51:55

Actually, I'm wondering if _all_ symbolic constants shouldn't be part of a special parent, say the “set of symbolic constants”, with no operations at all defined on it (so that they can be used only after being coerced to something else). That would make it easy to support operations like `pi + 1.0`, `exp(infinity)`... with no artificial coercions from `SR`.


---

Comment by rws created at 2016-07-19 07:01:34

See also #19439.
