# Issue 17540: unsigned infinity cannot be coerced into SR

archive/issues_017540.json:
```json
{
    "body": "This is needed e.g. by `BuiltinFunction`s returning that value (#17678).\n\n```\nsage: from sage.rings.infinity import infinity, unsigned_infinity\nsage: SR.coerce(infinity)\n+Infinity\nsage: SR.coerce(unsigned_infinity)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-5-164e151d39b6> in <module>()\n----> 1 SR.coerce(unsigned_infinity)\n\n/home/ralf/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.coerce (build/cythonized/sage/structure/parent.c:10777)()\n   1290             return False\n   1291 \n-> 1292     cpdef coerce(self, x):\n   1293         \"\"\"\n   1294         Return x as an element of self, if and only if there is a canonical\n\n/home/ralf/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.coerce (build/cythonized/sage/structure/parent.c:10711)()\n   1317                 except Exception:\n   1318                     _record_exception()\n-> 1319             raise TypeError(\"no canonical coercion from %s to %s\" % (parent_c(x), self))\n   1320         else:\n   1321             return (<map.Map>mor)._call_(x)\n\nTypeError: no canonical coercion from The Unsigned Infinity Ring to Symbolic Ring\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17777\n\n",
    "created_at": "2015-02-13T17:13:55Z",
    "labels": [
        "algebra",
        "major",
        "bug"
    ],
    "title": "unsigned infinity cannot be coerced into SR",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17540",
    "user": "rws"
}
```
This is needed e.g. by `BuiltinFunction`s returning that value (#17678).

```
sage: from sage.rings.infinity import infinity, unsigned_infinity
sage: SR.coerce(infinity)
+Infinity
sage: SR.coerce(unsigned_infinity)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-5-164e151d39b6> in <module>()
----> 1 SR.coerce(unsigned_infinity)

/home/ralf/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.coerce (build/cythonized/sage/structure/parent.c:10777)()
   1290             return False
   1291 
-> 1292     cpdef coerce(self, x):
   1293         """
   1294         Return x as an element of self, if and only if there is a canonical

/home/ralf/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.coerce (build/cythonized/sage/structure/parent.c:10711)()
   1317                 except Exception:
   1318                     _record_exception()
-> 1319             raise TypeError("no canonical coercion from %s to %s" % (parent_c(x), self))
   1320         else:
   1321             return (<map.Map>mor)._call_(x)

TypeError: no canonical coercion from The Unsigned Infinity Ring to Symbolic Ring
```


Issue created by migration from https://trac.sagemath.org/ticket/17777





---

archive/issue_comments_234128.json:
```json
{
    "body": "Changing component from algebra to symbolics.",
    "created_at": "2015-02-14T07:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234128",
    "user": "rws"
}
```

Changing component from algebra to symbolics.



---

archive/issue_comments_234129.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-14T07:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234129",
    "user": "rws"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_234130.json:
```json
{
    "body": "Is that all? That would be easier than thought.\n----\nNew commits:",
    "created_at": "2015-02-14T07:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234130",
    "user": "rws"
}
```

Is that all? That would be easier than thought.
----
New commits:



---

archive/issue_comments_234131.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/symbolic/expression.pyx  # 1 doctest failed\nsage -t --long src/sage/rings/infinity.py  # 1 doctest failed\nsage -t --long src/sage/doctest/control.py  # 2 doctests failed\n```\n",
    "created_at": "2015-02-26T09:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234131",
    "user": "rws"
}
```


```
sage -t --long src/sage/symbolic/expression.pyx  # 1 doctest failed
sage -t --long src/sage/rings/infinity.py  # 1 doctest failed
sage -t --long src/sage/doctest/control.py  # 2 doctests failed
```




---

archive/issue_comments_234132.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-26T09:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234132",
    "user": "rws"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_234133.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-04T17:26:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234133",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_234134.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-04T17:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234134",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_234135.json:
```json
{
    "body": "The docstring of `sage.rings.infinity` states that:\n\n  The rules for arithmetic are that the unsigned infinity ring does not canonically coerce to any other ring, and all other rings canonically coerce to the unsigned infinity ring, sending all elements to the single element \"a number less than infinity\" of the unsigned infinity ring. Arithmetic and comparisons then take place in the unsigned infinity ring, where all arithmetic operations that are well-defined are defined.\n\n  [...]\n\n  Any ordered ring coerces to the infinity ring in the obvious way.\n\nSo if I understand correctly `SR` already didn't respect this specification. But this makes me wonder if your patch won't make comparisons with infinities even more inconsistent. If you understand the issues at hand better than I do, can you explain how this is all supposed to work?",
    "created_at": "2015-03-12T15:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234135",
    "user": "mmezzarobba"
}
```

The docstring of `sage.rings.infinity` states that:

  The rules for arithmetic are that the unsigned infinity ring does not canonically coerce to any other ring, and all other rings canonically coerce to the unsigned infinity ring, sending all elements to the single element "a number less than infinity" of the unsigned infinity ring. Arithmetic and comparisons then take place in the unsigned infinity ring, where all arithmetic operations that are well-defined are defined.

  [...]

  Any ordered ring coerces to the infinity ring in the obvious way.

So if I understand correctly `SR` already didn't respect this specification. But this makes me wonder if your patch won't make comparisons with infinities even more inconsistent. If you understand the issues at hand better than I do, can you explain how this is all supposed to work?



---

archive/issue_comments_234136.json:
```json
{
    "body": "I think the issue is that `SR` is even more special (see e.g. https://groups.google.com/d/topic/sage-devel/Oip2hzvjFZQ/discussion the posting by Volker). Everything coerces to it.",
    "created_at": "2015-03-12T15:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234136",
    "user": "rws"
}
```

I think the issue is that `SR` is even more special (see e.g. https://groups.google.com/d/topic/sage-devel/Oip2hzvjFZQ/discussion the posting by Volker). Everything coerces to it.



---

archive/issue_comments_234137.json:
```json
{
    "body": "This blocks #17678.",
    "created_at": "2015-05-12T15:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234137",
    "user": "rws"
}
```

This blocks #17678.



---

archive/issue_comments_234138.json:
```json
{
    "body": "So... I'm not sure I understand the question of the last two comments.   I don't have any objections to this but don't want to step on anyone's toes, and it (obviously) helps #17678.",
    "created_at": "2015-05-21T16:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234138",
    "user": "kcrisman"
}
```

So... I'm not sure I understand the question of the last two comments.   I don't have any objections to this but don't want to step on anyone's toes, and it (obviously) helps #17678.



---

archive/issue_comments_234139.json:
```json
{
    "body": "The cited \"The rules for arithmetic are that the unsigned infinity ring does not canonically coerce to any other ring, and all other rings canonically coerce to the unsigned infinity ring...\" is obviously wrong because the symbolic ring already has this notion. Example: `SR` could have a constant `aleph2` which the infinity rings are unable to handle right now, but `SR` can handle everything thrown at it. My guess is that the cited documentation simply ignored `SR` because it's not a typical algebraic object and doesn't fit the algebraists' concepts. Tough luck.",
    "created_at": "2015-05-24T15:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234139",
    "user": "rws"
}
```

The cited "The rules for arithmetic are that the unsigned infinity ring does not canonically coerce to any other ring, and all other rings canonically coerce to the unsigned infinity ring..." is obviously wrong because the symbolic ring already has this notion. Example: `SR` could have a constant `aleph2` which the infinity rings are unable to handle right now, but `SR` can handle everything thrown at it. My guess is that the cited documentation simply ignored `SR` because it's not a typical algebraic object and doesn't fit the algebraists' concepts. Tough luck.



---

archive/issue_comments_234140.json:
```json
{
    "body": "Yeah, I agree that the symbolic ring isn't a ring in the ordinary sense.  Maybe this ticket could upgrade that documentation as well with a brief note?  (mmezzarobba, would that satisfy your concerns?)",
    "created_at": "2015-05-28T15:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234140",
    "user": "kcrisman"
}
```

Yeah, I agree that the symbolic ring isn't a ring in the ordinary sense.  Maybe this ticket could upgrade that documentation as well with a brief note?  (mmezzarobba, would that satisfy your concerns?)



---

archive/issue_comments_234141.json:
```json
{
    "body": "Replying to [comment:11 kcrisman]:\n> Yeah, I agree that the symbolic ring isn't a ring in the ordinary sense.  Maybe this ticket could upgrade that documentation as well with a brief note?  (mmezzarobba, would that satisfy your concerns?)\n\nI have no strong opinion regarding whether there should be a coercion from SR to infinity rings, from infinity rings to SR, or neither. I was just pointing out that the proposed change would contradict the documentation. And yes, I guess improving that documentation is a good idea in any case!",
    "created_at": "2015-05-28T16:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234141",
    "user": "mmezzarobba"
}
```

Replying to [comment:11 kcrisman]:
> Yeah, I agree that the symbolic ring isn't a ring in the ordinary sense.  Maybe this ticket could upgrade that documentation as well with a brief note?  (mmezzarobba, would that satisfy your concerns?)

I have no strong opinion regarding whether there should be a coercion from SR to infinity rings, from infinity rings to SR, or neither. I was just pointing out that the proposed change would contradict the documentation. And yes, I guess improving that documentation is a good idea in any case!



---

archive/issue_comments_234142.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-28T17:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234142",
    "user": "kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_234143.json:
```json
{
    "body": "Okay, let's just make sure it's clear, then.",
    "created_at": "2015-05-28T17:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234143",
    "user": "kcrisman"
}
```

Okay, let's just make sure it's clear, then.



---

archive/issue_comments_234144.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-10T15:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234144",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_234145.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-10T15:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234145",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_234146.json:
```json
{
    "body": "I like it but I think maybe it belongs in the first part of the paragraph comment:6 mentions.\n\n> The rules for arithmetic are that the unsigned infinity ring does not canonically coerce to any other ring, and all other rings canonically coerce to the unsigned infinity ring, sending all elements to the single element \"a number less than infinity\" of the unsigned infinity ring. Arithmetic and comparisons then take place in the unsigned infinity ring, where all arithmetic operations that are well-defined are defined\n\nmmezz... would this doc change satisfy you?",
    "created_at": "2015-06-10T19:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234146",
    "user": "kcrisman"
}
```

I like it but I think maybe it belongs in the first part of the paragraph comment:6 mentions.

> The rules for arithmetic are that the unsigned infinity ring does not canonically coerce to any other ring, and all other rings canonically coerce to the unsigned infinity ring, sending all elements to the single element "a number less than infinity" of the unsigned infinity ring. Arithmetic and comparisons then take place in the unsigned infinity ring, where all arithmetic operations that are well-defined are defined

mmezz... would this doc change satisfy you?



---

archive/issue_comments_234147.json:
```json
{
    "body": "ping?",
    "created_at": "2015-10-20T12:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234147",
    "user": "rws"
}
```

ping?



---

archive/issue_comments_234148.json:
```json
{
    "body": "Replying to [comment:16 kcrisman]:\n> I like it but I think maybe it belongs in the first part of the paragraph comment:6 mentions.\n> \n> > The rules for arithmetic are that the unsigned infinity ring does not canonically coerce to any other ring, and all other rings canonically coerce to the unsigned infinity ring, sending all elements to the single element \"a number less than infinity\" of the unsigned infinity ring. Arithmetic and comparisons then take place in the unsigned infinity ring, where all arithmetic operations that are well-defined are defined\n> \n> mmezz... would this doc change satisfy you?\n\nSure. And my apologies for taking so long to reply, I somehow missed your question or forgot about it until Ralph's ping.",
    "created_at": "2015-10-22T13:23:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234148",
    "user": "mmezzarobba"
}
```

Replying to [comment:16 kcrisman]:
> I like it but I think maybe it belongs in the first part of the paragraph comment:6 mentions.
> 
> > The rules for arithmetic are that the unsigned infinity ring does not canonically coerce to any other ring, and all other rings canonically coerce to the unsigned infinity ring, sending all elements to the single element "a number less than infinity" of the unsigned infinity ring. Arithmetic and comparisons then take place in the unsigned infinity ring, where all arithmetic operations that are well-defined are defined
> 
> mmezz... would this doc change satisfy you?

Sure. And my apologies for taking so long to reply, I somehow missed your question or forgot about it until Ralph's ping.



---

archive/issue_comments_234149.json:
```json
{
    "body": "I made (essentially) the change discussed in the last few comments. Please feel free to set the ticket to positive review if you agree with the last commit.\n----\nNew commits:",
    "created_at": "2016-03-27T10:22:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234149",
    "user": "mmezzarobba"
}
```

I made (essentially) the change discussed in the last few comments. Please feel free to set the ticket to positive review if you agree with the last commit.
----
New commits:



---

archive/issue_comments_234150.json:
```json
{
    "body": "Wait: with this change, lots rings would coerce into `SR` both directly and through `InfinityRing`, with different results. But coercions are supposed to form a commutative diagram. I understand that both the infinity ring and the symbolic ring are a bit special, and that, with the current coercion discovery algorithm, things probably will work fine even if that assumption is broken... but still, I really don't like the idea of breaking it if that can be avoided.\n\nIs there really no other way to make infinities and symbolic expression play well together? For example, what about having `SR` coerce into the infinity ring (and making the global identifier `infinity` refer to `SR(infinity)`?) Or, perhaps better, adding an intermediate \u201csymbolic infinity ring\u201d that would coerce into both `SR` and `InfinityRing`, but have no ingoing coercions?",
    "created_at": "2016-03-27T12:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234150",
    "user": "mmezzarobba"
}
```

Wait: with this change, lots rings would coerce into `SR` both directly and through `InfinityRing`, with different results. But coercions are supposed to form a commutative diagram. I understand that both the infinity ring and the symbolic ring are a bit special, and that, with the current coercion discovery algorithm, things probably will work fine even if that assumption is broken... but still, I really don't like the idea of breaking it if that can be avoided.

Is there really no other way to make infinities and symbolic expression play well together? For example, what about having `SR` coerce into the infinity ring (and making the global identifier `infinity` refer to `SR(infinity)`?) Or, perhaps better, adding an intermediate “symbolic infinity ring” that would coerce into both `SR` and `InfinityRing`, but have no ingoing coercions?



---

archive/issue_comments_234151.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2016-03-27T12:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234151",
    "user": "mmezzarobba"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_234152.json:
```json
{
    "body": "Replying to [comment:20 mmezzarobba]:\n> Is there really no other way to make infinities and symbolic expression play well together? For example, what about having `SR` coerce into the infinity ring (and making the global identifier `infinity` refer to `SR(infinity)`?) Or, perhaps better, adding an intermediate \u201csymbolic infinity ring\u201d that would coerce into both `SR` and `InfinityRing`, but have no ingoing coercions?\nThat sounds feasible, since SR can have subrings now.",
    "created_at": "2016-03-27T12:41:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234152",
    "user": "rws"
}
```

Replying to [comment:20 mmezzarobba]:
> Is there really no other way to make infinities and symbolic expression play well together? For example, what about having `SR` coerce into the infinity ring (and making the global identifier `infinity` refer to `SR(infinity)`?) Or, perhaps better, adding an intermediate “symbolic infinity ring” that would coerce into both `SR` and `InfinityRing`, but have no ingoing coercions?
That sounds feasible, since SR can have subrings now.



---

archive/issue_comments_234153.json:
```json
{
    "body": "Actually, I'm wondering if *all* symbolic constants shouldn't be part of a special parent, say the \u201cset of symbolic constants\u201d, with no operations at all defined on it (so that they can be used only after being coerced to something else). That would make it easy to support operations like `pi + 1.0`, `exp(infinity)`... with no artificial coercions from `SR`.",
    "created_at": "2016-03-27T12:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234153",
    "user": "mmezzarobba"
}
```

Actually, I'm wondering if *all* symbolic constants shouldn't be part of a special parent, say the “set of symbolic constants”, with no operations at all defined on it (so that they can be used only after being coerced to something else). That would make it easy to support operations like `pi + 1.0`, `exp(infinity)`... with no artificial coercions from `SR`.



---

archive/issue_comments_234154.json:
```json
{
    "body": "See also #19439.",
    "created_at": "2016-07-19T07:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17540",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17540#issuecomment-234154",
    "user": "rws"
}
```

See also #19439.
