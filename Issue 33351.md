# Issue 33351: 15 GLPK doctests failing because "Long-step dual simplex will be used" gets printed

archive/issues_033351.json:
```json
{
    "body": "CC:  @kiwifb\n\nThe command\n\n```\nsage -tp --long src/sage/geometry/polyhedron/base.py src/sage/numerical/backends/glpk_backend.pyx src/sage/numerical/mip.pyx src/sage/tests/books/computational-mathematics-with-sagemath/lp_doctest.py\n```\n\n\ngives\n\n\n```\nDoctesting 4 files.\nsage -t --long --random-seed=35631835319362689698338084947465382717 src/sage/geometry/polyhedron/base.py\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/base.py\", line 389, in sage.geometry.polyhedron.base.Polyhedron_base.to_linear_program\nFailed example:\n    lp.solve()                                               # tol 1e-8   # optional - sage.rings.number_field\nExpected:\n    1.3090169943749475\nGot:\n    Long-step dual simplex will be used\n    1.3090169943749472\n**********************************************************************\n1 item had failures:\n   1 of  32 in sage.geometry.polyhedron.base.Polyhedron_base.to_linear_program\n    [324 tests, 1 failure, 11.62 s]\nsage -t --long --random-seed=35631835319362689698338084947465382717 src/sage/numerical/backends/glpk_backend.pyx\n**********************************************************************\nFile \"src/sage/numerical/backends/glpk_backend.pyx\", line 1104, in sage.numerical.backends.glpk_backend.GLPKBackend.solve\nFailed example:\n    p.solve() # rel tol 100\nExpected:\n    1\nGot:\n    Long-step dual simplex will be used\n    2.0\n**********************************************************************\nFile \"src/sage/numerical/backends/glpk_backend.pyx\", line 1111, in sage.numerical.backends.glpk_backend.GLPKBackend.solve\nFailed example:\n    p.solve() # rel tol 100\nExpected:\n    1\nGot:\n    Long-step dual simplex will be used\n    24.0\n**********************************************************************\n\n[...]\n\n**********************************************************************\nFile \"src/sage/tests/books/computational-mathematics-with-sagemath/lp_doctest.py\", line 127, in sage.tests.books.computational-mathematics-with-sagemath.lp_doctest\nFailed example:\n    p.solve() # abs tol 1e-10\nExpected:\n    1.4199999999999999\nGot:\n    Long-step dual simplex will be used\n    1.42\n**********************************************************************\n1 item had failures:\n   2 of  69 in sage.tests.books.computational-mathematics-with-sagemath.lp_doctest\n    [68 tests, 2 failures, 0.05 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/geometry/polyhedron/base.py  # 1 doctest failed\nsage -t --long src/sage/numerical/backends/glpk_backend.pyx  # 4 doctests failed\nsage -t --long src/sage/numerical/mip.pyx  # 8 doctests failed\nsage -t --long src/sage/tests/books/computational-mathematics-with-sagemath/lp_doctest.py  # 2 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 17.1 seconds\n    cpu time: 15.8 seconds\n    cumulative wall time: 16.7 seconds\nFeatures detected for doctesting: sage.combinat,sage.graphs,sage.rings.number_field\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33588\n\n",
    "created_at": "2022-03-29T12:54:42Z",
    "labels": [
        "numerical",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "15 GLPK doctests failing because \"Long-step dual simplex will be used\" gets printed",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33351",
    "user": "@seblabbe"
}
```
CC:  @kiwifb

The command

```
sage -tp --long src/sage/geometry/polyhedron/base.py src/sage/numerical/backends/glpk_backend.pyx src/sage/numerical/mip.pyx src/sage/tests/books/computational-mathematics-with-sagemath/lp_doctest.py
```


gives


```
Doctesting 4 files.
sage -t --long --random-seed=35631835319362689698338084947465382717 src/sage/geometry/polyhedron/base.py
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 389, in sage.geometry.polyhedron.base.Polyhedron_base.to_linear_program
Failed example:
    lp.solve()                                               # tol 1e-8   # optional - sage.rings.number_field
Expected:
    1.3090169943749475
Got:
    Long-step dual simplex will be used
    1.3090169943749472
**********************************************************************
1 item had failures:
   1 of  32 in sage.geometry.polyhedron.base.Polyhedron_base.to_linear_program
    [324 tests, 1 failure, 11.62 s]
sage -t --long --random-seed=35631835319362689698338084947465382717 src/sage/numerical/backends/glpk_backend.pyx
**********************************************************************
File "src/sage/numerical/backends/glpk_backend.pyx", line 1104, in sage.numerical.backends.glpk_backend.GLPKBackend.solve
Failed example:
    p.solve() # rel tol 100
Expected:
    1
Got:
    Long-step dual simplex will be used
    2.0
**********************************************************************
File "src/sage/numerical/backends/glpk_backend.pyx", line 1111, in sage.numerical.backends.glpk_backend.GLPKBackend.solve
Failed example:
    p.solve() # rel tol 100
Expected:
    1
Got:
    Long-step dual simplex will be used
    24.0
**********************************************************************

[...]

**********************************************************************
File "src/sage/tests/books/computational-mathematics-with-sagemath/lp_doctest.py", line 127, in sage.tests.books.computational-mathematics-with-sagemath.lp_doctest
Failed example:
    p.solve() # abs tol 1e-10
Expected:
    1.4199999999999999
Got:
    Long-step dual simplex will be used
    1.42
**********************************************************************
1 item had failures:
   2 of  69 in sage.tests.books.computational-mathematics-with-sagemath.lp_doctest
    [68 tests, 2 failures, 0.05 s]
----------------------------------------------------------------------
sage -t --long src/sage/geometry/polyhedron/base.py  # 1 doctest failed
sage -t --long src/sage/numerical/backends/glpk_backend.pyx  # 4 doctests failed
sage -t --long src/sage/numerical/mip.pyx  # 8 doctests failed
sage -t --long src/sage/tests/books/computational-mathematics-with-sagemath/lp_doctest.py  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 17.1 seconds
    cpu time: 15.8 seconds
    cumulative wall time: 16.7 seconds
Features detected for doctesting: sage.combinat,sage.graphs,sage.rings.number_field
```


Issue created by migration from https://trac.sagemath.org/ticket/33588





---

archive/issue_comments_474814.json:
```json
{
    "body": "\n```\nDoctesting 4 files.\nsage -t --long --random-seed=19 geometry/polyhedron/base.py\n    28 latte_int tests not run\n    0 tests not run because we ran out of time\n    [320 tests, 31.72 s]\nsage -t --long --random-seed=19 numerical/backends/glpk_backend.pyx\n    0 tests not run because we ran out of time\n    [592 tests, 4.18 s]\nsage -t --long --random-seed=19 numerical/mip.pyx\n    8 cplex tests not run\n    3 gurobi tests not run\n    7 not tested tests not run\n    0 tests not run because we ran out of time\n    [713 tests, 1.60 s]\nsage -t --long --random-seed=19 tests/books/computational-mathematics-with-sagemath/lp_doctest.py\n    0 tests not run because we ran out of time\n    [68 tests, 0.04 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 39.3 seconds\n    cpu time: 20.1 seconds\n    cumulative wall time: 37.5 seconds\n```\n\nbut that is `9.6.beta6` + #31962",
    "created_at": "2022-03-29T17:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474814",
    "user": "@sheerluck"
}
```


```
Doctesting 4 files.
sage -t --long --random-seed=19 geometry/polyhedron/base.py
    28 latte_int tests not run
    0 tests not run because we ran out of time
    [320 tests, 31.72 s]
sage -t --long --random-seed=19 numerical/backends/glpk_backend.pyx
    0 tests not run because we ran out of time
    [592 tests, 4.18 s]
sage -t --long --random-seed=19 numerical/mip.pyx
    8 cplex tests not run
    3 gurobi tests not run
    7 not tested tests not run
    0 tests not run because we ran out of time
    [713 tests, 1.60 s]
sage -t --long --random-seed=19 tests/books/computational-mathematics-with-sagemath/lp_doctest.py
    0 tests not run because we ran out of time
    [68 tests, 0.04 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 39.3 seconds
    cpu time: 20.1 seconds
    cumulative wall time: 37.5 seconds
```

but that is `9.6.beta6` + #31962



---

archive/issue_comments_474815.json:
```json
{
    "body": "See also #29317, where we solved this problem once before. Is this with a system version of GLPK? I'm not sure why the fix at #29317 is not catching this, in fact.",
    "created_at": "2022-03-29T22:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474815",
    "user": "@jhpalmieri"
}
```

See also #29317, where we solved this problem once before. Is this with a system version of GLPK? I'm not sure why the fix at #29317 is not catching this, in fact.



---

archive/issue_comments_474816.json:
```json
{
    "body": "Replying to [comment:3 jhpalmieri]:\n> See also #29317, where we solved this problem once before. Is this with a system version of GLPK? I'm not sure why the fix at #29317 is not catching this, in fact.\n\nYes, it is the glpk from the system:\n\n\n```\n$ grep glpk config.log\n## Checking whether SageMath should install SPKG glpk... ##\nconfigure:12313: checking glpk.h usability\nconfigure:12313: checking glpk.h presence\nconfigure:12313: checking for glpk.h\nconfigure:12352: g++ -std=gnu++11 -o conftest    conftest.cpp -lglpk  -lgmp -lm  >&5\nconfigure:12369: result: -lglpk\nconfigure:12374: result: yes. Use system's glpk\nconfigure:12395: will use system package and not install SPKG glpk\nconfigure:12434: result: using glpk from the system\n```\n\n\nThis one:\n\n\n```\n$ glpsol -v\nGLPSOL: GLPK LP/MIP Solver, v4.65\n```\n",
    "created_at": "2022-03-31T09:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474816",
    "user": "@seblabbe"
}
```

Replying to [comment:3 jhpalmieri]:
> See also #29317, where we solved this problem once before. Is this with a system version of GLPK? I'm not sure why the fix at #29317 is not catching this, in fact.

Yes, it is the glpk from the system:


```
$ grep glpk config.log
## Checking whether SageMath should install SPKG glpk... ##
configure:12313: checking glpk.h usability
configure:12313: checking glpk.h presence
configure:12313: checking for glpk.h
configure:12352: g++ -std=gnu++11 -o conftest    conftest.cpp -lglpk  -lgmp -lm  >&5
configure:12369: result: -lglpk
configure:12374: result: yes. Use system's glpk
configure:12395: will use system package and not install SPKG glpk
configure:12434: result: using glpk from the system
```


This one:


```
$ glpsol -v
GLPSOL: GLPK LP/MIP Solver, v4.65
```




---

archive/issue_comments_474817.json:
```json
{
    "body": "As I said, I wonder why the fix from #29317 is not catching this. From `sage.doctest.parsing`:\n\n```\n# Version 4.65 of glpk prints the warning \"Long-step dual simplex will\n# be used\" frequently. When Sage uses a system installation of glpk\n# which has not been patched, we need to ignore that message.\n# See :trac:`29317`.\nglpk_simplex_warning_regex = re.compile(r'(Long-step dual simplex will be used)')\n```\n\nand then later on, that regular expression should be filtered out.",
    "created_at": "2022-03-31T16:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474817",
    "user": "@jhpalmieri"
}
```

As I said, I wonder why the fix from #29317 is not catching this. From `sage.doctest.parsing`:

```
# Version 4.65 of glpk prints the warning "Long-step dual simplex will
# be used" frequently. When Sage uses a system installation of glpk
# which has not been patched, we need to ignore that message.
# See :trac:`29317`.
glpk_simplex_warning_regex = re.compile(r'(Long-step dual simplex will be used)')
```

and then later on, that regular expression should be filtered out.



---

archive/issue_comments_474818.json:
```json
{
    "body": "Replying to [comment:6 jhpalmieri]:\n> As I said, I wonder why the fix from #29317 is not catching this.\n\nI got it. It is because the `# tol 1e-8` is dealt in the `check_output` method before the glpk regex get replaced.\n\nThe following behavior is fine:\n\n\n```\nsage: import doctest\nsage: optflag = doctest.NORMALIZE_WHITESPACE|doctest.ELLIPSIS\nsage: from sage.doctest.parsing import SageOutputChecker\nsage: OC = SageOutputChecker()\nsage: OC.check_output('1.3090169943749475','1.3090169943749475',optflag)\nTrue\nsage: OC.check_output('1.3090169943749475','ANYTHING1.3090169943749475',optflag)\nFalse\nsage: OC.check_output('1.3090169943749475','Long-step dual simplex will be used\\n1.3090169943749475',optflag)\nTrue\n```\n\n\nThe following is ok as well:\n\n\n```\nsage: from sage.doctest.parsing import SageOutputChecker, SageDocTestParser\nsage: import doctest\nsage: optflag = doctest.NORMALIZE_WHITESPACE|doctest.ELLIPSIS\nsage: DTP = SageDocTestParser(('sage','magma','guava'))\nsage: OC = SageOutputChecker()\nsage: example = \"sage: 1.3090169943749475\\n1.3090169943749475\"\nsage: ex = DTP.parse(example)[1]\nsage: ex.want\n'1.3090169943749475\\n'\nsage: OC.check_output(ex.want, '1.3090169943749475', optflag)\nTrue\nsage: OC.check_output(ex.want, 'ANYTHING1.3090169943749475', optflag)\nFalse\nsage: OC.check_output(ex.want, 'Long-step dual simplex will be used\\n1.3090169943749475', optflag)\nTrue\n```\n\n\nThe following illustrates the bug (the last line should be True):\n\n```\nsage: example = \"sage: 1.3090169943749475 # tol 1e-8\\n1.3090169943749475\"\nsage: ex = DTP.parse(example)[1]\nsage: ex.sage_source\n'1.3090169943749475 # tol 1e-8\\n'\nsage: ex.want\n'1.3090169943749475\\n'\nsage: OC.check_output(ex.want, '1.3090169943749475', optflag)\nTrue\nsage: OC.check_output(ex.want, 'ANYTHING1.3090169943749475', optflag)\nFalse\nsage: OC.check_output(ex.want, 'Long-step dual simplex will be used\\n1.3090169943749475', optflag)\nFalse\n```\n\n\nObserve that turning `ex.want` back to a string fixes it because I think the return is made in the `if isinstance(want, MarkedOutput):` block within the `check_output` method:\n\n\n```\nsage: type(ex.want)\n<class 'sage.doctest.parsing.MarkedOutput'>\nsage: sage: OC.check_output(str(ex.want), 'Long-step dual simplex will be used\\n1.3090169943749475', optflag)\nTrue\n```\n",
    "created_at": "2022-04-01T15:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474818",
    "user": "@seblabbe"
}
```

Replying to [comment:6 jhpalmieri]:
> As I said, I wonder why the fix from #29317 is not catching this.

I got it. It is because the `# tol 1e-8` is dealt in the `check_output` method before the glpk regex get replaced.

The following behavior is fine:


```
sage: import doctest
sage: optflag = doctest.NORMALIZE_WHITESPACE|doctest.ELLIPSIS
sage: from sage.doctest.parsing import SageOutputChecker
sage: OC = SageOutputChecker()
sage: OC.check_output('1.3090169943749475','1.3090169943749475',optflag)
True
sage: OC.check_output('1.3090169943749475','ANYTHING1.3090169943749475',optflag)
False
sage: OC.check_output('1.3090169943749475','Long-step dual simplex will be used\n1.3090169943749475',optflag)
True
```


The following is ok as well:


```
sage: from sage.doctest.parsing import SageOutputChecker, SageDocTestParser
sage: import doctest
sage: optflag = doctest.NORMALIZE_WHITESPACE|doctest.ELLIPSIS
sage: DTP = SageDocTestParser(('sage','magma','guava'))
sage: OC = SageOutputChecker()
sage: example = "sage: 1.3090169943749475\n1.3090169943749475"
sage: ex = DTP.parse(example)[1]
sage: ex.want
'1.3090169943749475\n'
sage: OC.check_output(ex.want, '1.3090169943749475', optflag)
True
sage: OC.check_output(ex.want, 'ANYTHING1.3090169943749475', optflag)
False
sage: OC.check_output(ex.want, 'Long-step dual simplex will be used\n1.3090169943749475', optflag)
True
```


The following illustrates the bug (the last line should be True):

```
sage: example = "sage: 1.3090169943749475 # tol 1e-8\n1.3090169943749475"
sage: ex = DTP.parse(example)[1]
sage: ex.sage_source
'1.3090169943749475 # tol 1e-8\n'
sage: ex.want
'1.3090169943749475\n'
sage: OC.check_output(ex.want, '1.3090169943749475', optflag)
True
sage: OC.check_output(ex.want, 'ANYTHING1.3090169943749475', optflag)
False
sage: OC.check_output(ex.want, 'Long-step dual simplex will be used\n1.3090169943749475', optflag)
False
```


Observe that turning `ex.want` back to a string fixes it because I think the return is made in the `if isinstance(want, MarkedOutput):` block within the `check_output` method:


```
sage: type(ex.want)
<class 'sage.doctest.parsing.MarkedOutput'>
sage: sage: OC.check_output(str(ex.want), 'Long-step dual simplex will be used\n1.3090169943749475', optflag)
True
```




---

archive/issue_comments_474819.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2022-04-03T18:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474819",
    "user": "@mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_474820.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-04-07T15:15:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474820",
    "user": "@seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_474821.json:
```json
{
    "body": "I found a way to fix the issue.\n----\nNew commits:",
    "created_at": "2022-04-07T15:15:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474821",
    "user": "@seblabbe"
}
```

I found a way to fix the issue.
----
New commits:



---

archive/issue_comments_474822.json:
```json
{
    "body": "The code as it is now works and fixes the issue in the description of this ticket. Doing so, I added a new method `try_fixup` which helps understand what is happening. The way it is written follows how the code was written before. But here are few things that I dislike and that could be improved if reviewers agree:\n\n- parameter `want` is not changed by `try_fixup`, only `got`, so why should `fixup` take `want` as input?\n- the list `_repr_fixups` is defined in the header of the module but it is used only in the `try_fixup` method. I think it would make sense to remove it from the header and move it down inside the `try_fixup` method. It would make the `try_fixup` method more usable. More precisely, when somethings goes wrong for instance while debugging #33588, it is practical to add few `print` statements to see what is happening but it is quite painful to add a print statement inside of the lambda functions defined in the `_repr_fixups` at the top of the module.\n- Since `_repr_fixups` is defined completely out of context in the top module it comes with 8 lines of documentation painfully explaining what it is. These lines would just disappear by defining them in context inside of the `try_fixup` method.\n\n\n```python\n# Collection of fixups applied in the SageOutputChecker.  Each element in this\n# this list a pair of functions applied to the actual test output ('g' for\n# \"got\") and the expected test output ('w' for \"wanted\").  The first function\n# should be a simple fast test on the expected and/or actual output to                 \n# determine if a fixup should be applied.  The second function is the actual\n# fixup, which is applied if the test function passes.  In most fixups only one\n# of the expected or received outputs are normalized, depending on the\n# application.                            \n_repr_fixups = [                                                          \n    (lambda g, w: \"Long-step\" in g,         \n     lambda g, w: (glpk_simplex_warning_regex.sub('', g), w)),\n                                  \n    (lambda g, w: \"dylib\" in g,                             \n     lambda g, w: (ld_warning_regex.sub('', g), w)),             \n                                                                    \n    (lambda g, w: \"pie being ignored\" in g,                              \n     lambda g, w: (ld_pie_warning_regex.sub('', g), w))                                          \n]    \n```\n\n\nIf reviewers agree with me, I will do one more commit improving that.",
    "created_at": "2022-04-07T15:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474822",
    "user": "@seblabbe"
}
```

The code as it is now works and fixes the issue in the description of this ticket. Doing so, I added a new method `try_fixup` which helps understand what is happening. The way it is written follows how the code was written before. But here are few things that I dislike and that could be improved if reviewers agree:

- parameter `want` is not changed by `try_fixup`, only `got`, so why should `fixup` take `want` as input?
- the list `_repr_fixups` is defined in the header of the module but it is used only in the `try_fixup` method. I think it would make sense to remove it from the header and move it down inside the `try_fixup` method. It would make the `try_fixup` method more usable. More precisely, when somethings goes wrong for instance while debugging #33588, it is practical to add few `print` statements to see what is happening but it is quite painful to add a print statement inside of the lambda functions defined in the `_repr_fixups` at the top of the module.
- Since `_repr_fixups` is defined completely out of context in the top module it comes with 8 lines of documentation painfully explaining what it is. These lines would just disappear by defining them in context inside of the `try_fixup` method.


```python
# Collection of fixups applied in the SageOutputChecker.  Each element in this
# this list a pair of functions applied to the actual test output ('g' for
# "got") and the expected test output ('w' for "wanted").  The first function
# should be a simple fast test on the expected and/or actual output to                 
# determine if a fixup should be applied.  The second function is the actual
# fixup, which is applied if the test function passes.  In most fixups only one
# of the expected or received outputs are normalized, depending on the
# application.                            
_repr_fixups = [                                                          
    (lambda g, w: "Long-step" in g,         
     lambda g, w: (glpk_simplex_warning_regex.sub('', g), w)),
                                  
    (lambda g, w: "dylib" in g,                             
     lambda g, w: (ld_warning_regex.sub('', g), w)),             
                                                                    
    (lambda g, w: "pie being ignored" in g,                              
     lambda g, w: (ld_pie_warning_regex.sub('', g), w))                                          
]    
```


If reviewers agree with me, I will do one more commit improving that.



---

archive/issue_comments_474823.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2022-04-07T15:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474823",
    "user": "@seblabbe"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_474824.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-07T15:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474824",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474825.json:
```json
{
    "body": "I just added a commit which is unrelated to the question asked in comment:10.",
    "created_at": "2022-04-07T15:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474825",
    "user": "@seblabbe"
}
```

I just added a commit which is unrelated to the question asked in comment:10.



---

archive/issue_comments_474826.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-07T16:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474826",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474827.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2022-04-07T16:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474827",
    "user": "@seblabbe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_474828.json:
```json
{
    "body": "While having my head on this part of the code, I decide to answer my comment:10 by YES and I did the latest commit.\n\nNeeds review!",
    "created_at": "2022-04-07T16:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474828",
    "user": "@seblabbe"
}
```

While having my head on this part of the code, I decide to answer my comment:10 by YES and I did the latest commit.

Needs review!



---

archive/issue_comments_474829.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-04-07T16:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474829",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_474830.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-04-07T16:12:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474830",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_474831.json:
```json
{
    "body": "Did 2 small changes on the last commit. Now done. Needs review.",
    "created_at": "2022-04-07T16:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474831",
    "user": "@seblabbe"
}
```

Did 2 small changes on the last commit. Now done. Needs review.



---

archive/issue_comments_474832.json:
```json
{
    "body": "I don't have time to review this right now, but I agree with your decisions regarding comment:10.",
    "created_at": "2022-04-07T17:32:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474832",
    "user": "@jhpalmieri"
}
```

I don't have time to review this right now, but I agree with your decisions regarding comment:10.



---

archive/issue_comments_474833.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-08T08:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474833",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474834.json:
```json
{
    "body": "I renamed `try_fixup` to `do_fixup` because the following line looks better like this, the same verb is used:\n\n```\ndid_fixup, want, got = self.do_fixup(want, got)\n```\n",
    "created_at": "2022-04-08T08:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474834",
    "user": "@seblabbe"
}
```

I renamed `try_fixup` to `do_fixup` because the following line looks better like this, the same verb is used:

```
did_fixup, want, got = self.do_fixup(want, got)
```




---

archive/issue_comments_474835.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-11T07:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474835",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_474836.json:
```json
{
    "body": "I added a commit to fix one patchbot warning:\n\n```\n========== blocks ==========\ngit checkout patchbot/ticket_merged\ninside file:  b/src/sage/doctest/parsing.py\n@@ -923,41 +919,111 @@ class SageOutputChecker(doctest.OutputChecker):\n+        OUTPUT\nwrong syntax for blocks (INPUT, OUTPUT, EXAMPLES, NOTE, etc) inserted on 1 non-empty lines\nblocks -- 0 seconds\n========== end blocks ==========\n```\n",
    "created_at": "2022-04-11T07:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474836",
    "user": "@seblabbe"
}
```

I added a commit to fix one patchbot warning:

```
========== blocks ==========
git checkout patchbot/ticket_merged
inside file:  b/src/sage/doctest/parsing.py
@@ -923,41 +919,111 @@ class SageOutputChecker(doctest.OutputChecker):
+        OUTPUT
wrong syntax for blocks (INPUT, OUTPUT, EXAMPLES, NOTE, etc) inserted on 1 non-empty lines
blocks -- 0 seconds
========== end blocks ==========
```




---

archive/issue_comments_474837.json:
```json
{
    "body": "Please do not remove `_repr_fixups` and the comments before.\n\nEDIT: Just make that an empty list\n\nSomebody else may need that again at some point.",
    "created_at": "2022-04-11T09:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474837",
    "user": "@fchapoton"
}
```

Please do not remove `_repr_fixups` and the comments before.

EDIT: Just make that an empty list

Somebody else may need that again at some point.



---

archive/issue_comments_474838.json:
```json
{
    "body": "ah, I see, this is more complicated than what I thought. No time to look at that now.",
    "created_at": "2022-04-11T09:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474838",
    "user": "@fchapoton"
}
```

ah, I see, this is more complicated than what I thought. No time to look at that now.



---

archive/issue_comments_474839.json:
```json
{
    "body": "It is not so complicated in the end, but it is true that it may look complicated.\n\nLet me update the description of the ticket to better explain the problem and the solution.",
    "created_at": "2022-04-11T10:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474839",
    "user": "@seblabbe"
}
```

It is not so complicated in the end, but it is true that it may look complicated.

Let me update the description of the ticket to better explain the problem and the solution.



---

archive/issue_comments_474840.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-04-11T12:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474840",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_474841.json:
```json
{
    "body": "I removed the commit deleting the `_repr_fixups` as it can be done in a later ticket which will simplify the review of the current ticket.",
    "created_at": "2022-04-11T12:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474841",
    "user": "@seblabbe"
}
```

I removed the commit deleting the `_repr_fixups` as it can be done in a later ticket which will simplify the review of the current ticket.



---

archive/issue_comments_474842.json:
```json
{
    "body": "Updated description.",
    "created_at": "2022-04-11T13:03:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474842",
    "user": "@seblabbe"
}
```

Updated description.



---

archive/issue_comments_474843.json:
```json
{
    "body": "Further description improvements.",
    "created_at": "2022-04-11T13:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474843",
    "user": "@seblabbe"
}
```

Further description improvements.



---

archive/issue_comments_474844.json:
```json
{
    "body": "Needs review.",
    "created_at": "2022-04-11T13:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474844",
    "user": "@seblabbe"
}
```

Needs review.



---

archive/issue_comments_474845.json:
```json
{
    "body": "Touching the `_repr_fixups` list is now in a follow-up ticket #33680.",
    "created_at": "2022-04-11T13:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474845",
    "user": "@seblabbe"
}
```

Touching the `_repr_fixups` list is now in a follow-up ticket #33680.



---

archive/issue_comments_474846.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-04-18T10:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474846",
    "user": "@seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_474847.json:
```json
{
    "body": "one patchbot currently says:\n\n```\n[sagemath_doc_html-none] Error building the documentation.\n[sagemath_doc_html-none] Traceback (most recent call last):\n...\n[sagemath_doc_html-none] OSError: /home/debian/sage/local/var/lib/sage/\nvenv-python3.9/lib/python3.9/site-packages/sage/doctest/parsing.py:\ndocstring of sage.doctest.parsing.SageOutputChecker.check_output:118: \nWARNING: Block quote ends without a blank line; unexpected unindent.\n[sagemath_doc_html-none]\n```\n",
    "created_at": "2022-04-18T10:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474847",
    "user": "@seblabbe"
}
```

one patchbot currently says:

```
[sagemath_doc_html-none] Error building the documentation.
[sagemath_doc_html-none] Traceback (most recent call last):
...
[sagemath_doc_html-none] OSError: /home/debian/sage/local/var/lib/sage/
venv-python3.9/lib/python3.9/site-packages/sage/doctest/parsing.py:
docstring of sage.doctest.parsing.SageOutputChecker.check_output:118: 
WARNING: Block quote ends without a blank line; unexpected unindent.
[sagemath_doc_html-none]
```




---

archive/issue_comments_474848.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-04-18T11:01:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474848",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_474849.json:
```json
{
    "body": "The documentation failure was due to a docstring defined with `\"\"\"...\"\"\"` as opposed to `r\"\"\"...\"\"\"`. I added a commit to fix that.\n\nNow rebased on 9.6.rc0.\n\nAlso squashed the commit changing name `try_fixup` to `do_fixup` to simplify the review.",
    "created_at": "2022-04-18T11:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474849",
    "user": "@seblabbe"
}
```

The documentation failure was due to a docstring defined with `"""..."""` as opposed to `r"""..."""`. I added a commit to fix that.

Now rebased on 9.6.rc0.

Also squashed the commit changing name `try_fixup` to `do_fixup` to simplify the review.



---

archive/issue_comments_474850.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-04-18T11:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474850",
    "user": "@seblabbe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_474851.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-04-20T17:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474851",
    "user": "@jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_474852.json:
```json
{
    "body": "This looks good to me.",
    "created_at": "2022-04-20T17:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474852",
    "user": "@jhpalmieri"
}
```

This looks good to me.



---

archive/issue_comments_474853.json:
```json
{
    "body": "Thank you John!",
    "created_at": "2022-04-20T18:23:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474853",
    "user": "@seblabbe"
}
```

Thank you John!



---

archive/issue_comments_474854.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2022-04-21T07:06:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474854",
    "user": "@mkoeppe"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_474855.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-04-24T06:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33351#issuecomment-474855",
    "user": "@vbraun"
}
```

Resolution: fixed
