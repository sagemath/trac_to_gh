# Issue 32760: docker image fails to build on tigerlake

Issue created by migration from https://trac.sagemath.org/ticket/32997

Original creator: saraedum

Original creation time: 2021-12-08 23:49:58

On Tiger Lake CPUs, our Dockerfile fails to build. Apparently, openblas performs a compilation with `-march=tigerlake` even though it won't use that flag when building later.

This flag is not understood by gcc 9 which is installed on Ubuntu 20.04 which is the basis of our docker image.

Upgrading to a more recent Ubuntu fixes the issue since it then installs gcc 10+.


---

Comment by saraedum created at 2021-12-09 00:06:48

Changing keywords from "" to "docker".


---

Comment by saraedum created at 2021-12-09 05:33:33

This seems to fix it.


```
 ################################################################################
 # Image containing the run-time dependencies for Sage                          #
 ################################################################################
-FROM ubuntu:focal as run-time-dependencies
+FROM ubuntu:hirsute as run-time-dependencies
 LABEL maintainer="Erik M. Bray <erik.bray@lri.fr>, Julian RÃ¼th <julian.rueth@fsfe.org>"
 # Set sane defaults for common environment variables.
 ENV LC_ALL C.UTF-8
@@ -58,10 +58,10 @@ RUN ln -s "$SAGE_ROOT/sage" /usr/bin/sage
 RUN ln -s /usr/bin/sage /usr/bin/sagemath
 # Sage needs the fortran libraries at run-time because we do not build gfortran
 # with Sage but use the system's.
-# We need gcc/g++ and libstdc++-9-dev to allow compilation of cython at run-time from the notebook.
+# We need gcc/g++ and libstdc++-10-dev to allow compilation of cython at run-time from the notebook.
 # We also install sudo for the sage user, see below.
 RUN apt-get -qq update \
-    && apt-get -qq install -y --no-install-recommends gfortran gcc g++ libstdc++-9-dev sudo openssl \
+    && apt-get -qq install -y --no-install-recommends gfortran gcc g++ libstdc++-10-dev sudo openssl \
     && apt-get -qq clean \
     && rm -r /var/lib/apt/lists/*
 # Sage refuses to build as root, so we add a "sage" user that can sudo without a password.
```



---

Comment by chapoton created at 2022-01-29 08:58:50

bump to 9.6


---

Comment by saraedum created at 2022-02-20 17:57:53

Changing status from new to needs_review.


---

Comment by saraedum created at 2022-02-20 17:57:53

New commits:


---

Comment by mkoeppe created at 2022-02-20 18:14:45

Update ticket description please? The upgrade to `ubuntu-hirsute` is not on the ticket


---

Comment by git created at 2022-02-20 18:56:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-20 20:37:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-02-23 05:52:21

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-03-01 21:31:08

Resolution: fixed
