# Issue 10672: Simon 2-descent may not check for solubility at archimedean  places.

Issue created by migration from https://trac.sagemath.org/ticket/10735

Original creator: weigandt

Original creation time: 2011-02-03 05:59:32

Assignee: cremona

CC:  cremona was rlm

Keywords: simon_two_descent

Given an elliptic curve E the method E.simon_two_descent() returns an ordered triple. This consists of a lower bound on the Mordell-Weil rank of E, an integer which is supposed to be the F_2 dimension of the 2-Selmer group of E, and list of points, generating the part of the Mordell-Weil group that has been found.

Sometimes the second entry is larger than the actual 2-Selmer rank as computed by mwrank, and predicted by BSD. The first curve I know of for which this happens is the elliptic curve '438e1' from Cremona's tables.

This curve definitely possesses 2-covers which are everywhere locally soluble EXCEPT at that infinite place. These probably explain the discrepancy.


```
sage: E=EllipticCurve('438e1')
sage: E.simon_two_descent()
(0, 3, [(13 : -7 : 1)])
sage: E.selmer_rank() #uses mwrank
1
sage: E.sha().an()
1
```



---

Comment by wuthrich created at 2013-12-28 01:55:19

This is a bug in Simon's script indeed. I have emailed him about this one, too, as it happens with the later version of his file in gp, too.


---

Comment by wuthrich created at 2013-12-28 02:02:37

Changing type from PLEASE CHANGE to defect.


---

Comment by pbruin created at 2014-02-11 19:55:07

The problem still exists after #11005, which upgrades Simon's scripts to the latest version:

```
sage: E=EllipticCurve('438e1')
sage: E.simon_two_descent()
(0, 3, [])
```

(Note: the torsion point (13, -7) is no longer returned since #13593.)


---

Comment by pbruin created at 2014-02-13 23:58:18

It seems to me that the bug is _not_ caused by failing to detect non-solubility at the real place.  In fact, Simon's script computes the same 2-isogeny Selmer ranks as `mwrank`, but deduces an incorrect 2-Selmer rank from these.

Output of `mwrank`:

```
Curve [1,0,1,-130,-556] :	
1 points of order 2:
[13:-7:1]

Using 2-isogenous curve [0,-314,0,73,0] (minimal model [1,0,1,-2050,-35884])
-------------------------------------------------------
First step, determining 1st descent Selmer groups
-------------------------------------------------------
After first local descent, rank bound = 2
rk(S^{phi}(E'))=	3
rk(S^{phi'}(E))=	1

-------------------------------------------------------
Second step, determining 2nd descent Selmer groups
-------------------------------------------------------
After second local descent, rank bound = 0
rk(phi'(S^{2}(E)))=	1
rk(phi(S^{2}(E')))=	1
rk(S^{2}(E))=	1
rk(S^{2}(E'))=	3

Third step, determining E(Q)/phi(E'(Q)) and E'(Q)/phi'(E(Q))
-------------------------------------------------------
1. E(Q)/phi(E'(Q))
-------------------------------------------------------
(c,d)  =(157,6144)
(c',d')=(-314,73)
This component of the rank is 0
-------------------------------------------------------
2. E'(Q)/phi'(E(Q))
-------------------------------------------------------
This component of the rank is 0

-------------------------------------------------------
Summary of results:
-------------------------------------------------------
	rank(E) = 0
	#E(Q)/2E(Q) = 2

Information on III(E/Q):
	#III(E/Q)[phi']    = 1
	#III(E/Q)[2]       = 1

Information on III(E'/Q):
	#phi'(III(E/Q)[2]) = 1
	#III(E'/Q)[phi]    = 4
	#III(E'/Q)[2]      = 4


Used descent via 2-isogeny with isogenous curve E' = [1,0,1,-2050,-35884]
Rank = 0
Rank of S^2(E)  = 1
Rank of S^2(E') = 3
Rank of S^phi(E') = 3
Rank of S^phi'(E) = 1

Processing points found during 2-descent...done:
  now regulator = 1


Regulator = 1

The rank and full Mordell-Weil basis have been determined unconditionally.
 (0.098 seconds)
```

Output of `simon_two_descent`:

```
ellrank([1,0,1,-130,-556]);
 Elliptic curve: Y^2 = x^3 + x^2 - 2072*x - 35568
 E[2] = [[0], [52, 0]]
 Elliptic curve: Y^2 = x^3 + 157*x^2 + 6144*x
  Algorithm of 2-descent via isogenies
 trivial points on E(Q) = [[0, 0], [1, 1, 0], [0, 0], [0, 0]]

  #K(b,2)gen          = 3
  K(b,2)gen = [-1, 2, 3]~
  quartic ELS: Y^2 = -x^4 + 157*x^2 - 6144
  no point found on the quartic
  quartic ELS: Y^2 = 2*x^4 + 157*x^2 + 3072
  no point found on the quartic
  quartic ELS: Y^2 = -2*x^4 + 157*x^2 - 3072
  no point found on the quartic
  quartic ELS: Y^2 = 3*x^4 + 157*x^2 + 2048
  no point found on the quartic
  quartic ELS: Y^2 = -3*x^4 + 157*x^2 - 2048
  no point found on the quartic
  point on the quartic
 points on E(Q) = [[0, 0]]

[E(Q):phi'(E'(Q))] >= 2
#S^(phi')(E'/Q)     = 8  # agrees with mwrank
#III(E'/Q)[phi']   <= 4

  #K(a^2-4b,2)gen     = 2
  K(a^2-4b,2)gen     = [-1, 73]~
 trivial points on E'(Q) = [[0, 0], [1, 1, 0], [0, 0], [0, 0]]

  point on the quartic
 points on E'(Q) = [[0, 0]]
 points on E(Q) = [[0, 0]]

[E'(Q):phi(E(Q))]   = 2
#S^(phi)(E/Q)       = 2  # agrees with mwrank
#III(E/Q)[phi]      = 1

#III(E/Q)[2]       <= 4
#E(Q)[2]            = 2
#E(Q)/2E(Q)        >= 2

0 <= rank          <= 2

points = [[0, 0]]
v =  [0, 3, [[13, -7]]]
```

The 3 in the last line, which should be the rank of the 2-Selmer group according to the documentation, is the result of computing (rank of `S^(phi)(E/Q)`) + (rank of `S^(phi')(E'/Q)`) + (rank of `E(Q)[2]`) - 2 = 1 + 3 + 1 - 2 = 3.  There must be something wrong with this formula, as it is symmetric in _E_ and _E' _ (in this particular case, since `E(Q)[2]` and `E'(Q)[2]` both have rank 1) while the 2-Selmer ranks of _E_ and _E' _ are in fact different (1 and 3, respectively).


---

Comment by wuthrich created at 2014-02-15 00:19:12

That is indeed bad. The fomula (after the first descent) is indeed

 dim Sel_phi + dim Sel_phihat + dim E[2] - 2 .

this is a upper bound to dim Sel_2 and they have the same parity. But they need not be equal as the second descent in mwrank finds. The difference is a subquotient of Sha(E').

Conclusion: The output of Simon's algorithm is an upper bound on the 2-Selmer group, which is correct in parity, but not necessarily equal.

In propose that we change the documentation, for I don't image that Simon's script could give back to full answer - though I have not looked at it.


---

Comment by cremona created at 2014-02-15 11:07:54

You are right.  DS does no second descent (unlike mwrank when over Q and with 2-torsion) and the second descent can give a better upper bound on the rank.


---

Comment by pbruin created at 2014-02-15 12:56:54

Changing the documentation does indeed sound like the right solution here.  The correctness of the parity of this upper bound probably relies on finiteness of ле, or doesn't it?


---

Comment by wuthrich created at 2014-02-15 13:04:23

No the correctness of the parity is unconditional. (This is used for instance in the proof of the p-parity conjecture via p-isogeny.)


---

Comment by pbruin created at 2014-02-17 21:00:34

Changing priority from major to minor.


---

Comment by pbruin created at 2014-02-17 21:00:34

Changing status from new to needs_review.


---

Comment by pbruin created at 2014-02-17 21:00:34

Here is a patch for the documentation of `simon_two_descent()`, including a new doctest using the example from the ticket description.

There are a few other improvements to the docstring.  In particular, it contained several calls to `set_random_seed()`.  These can't have any effect, because Simon's script runs inside a separate GP interpreter with its own random state, so I removed these.


---

Comment by pbruin created at 2014-02-17 21:09:36

Another thing: the method `simon_two_descent()` is currently not quite consistent between *Q* and other number fields: the method over *Q* removes points of finite order from the list (at least since #5153), but the corresponding method over general number fields does not.  I made the documentation consistent with this, but did not change any code.  If we want to fix this, it is probably best to do it as part of #10745.


---

Comment by wuthrich created at 2014-03-28 17:51:55

We removed the points of finite order from `.gens()` for number fields but not from `simon_two_descent()`, which is a bit inconsistent, indeed. I agree to adress this in #10745.

Now to this ticket. I have run all tests and I am certainly happy with the improvement. So I give a positive review. I am not sure about the random seed issue above, but I trust you. Otherwise someone will complain at some point.


---

Comment by wuthrich created at 2014-03-28 17:51:55

Changing status from needs_review to positive_review.


---

Comment by git created at 2014-03-28 19:16:43

Changing status from positive_review to needs_review.


---

Comment by git created at 2014-03-28 19:16:43

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. Last 10 new commits:


---

Comment by pbruin created at 2014-03-28 19:18:46

There was just a trivial merge conflict with #9322, which also has positive review, so I merged that branch and made it a dependency.


---

Comment by pbruin created at 2014-03-28 19:18:46

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-03-31 21:12:33

Resolution: fixed
