# Issue 11664: pari bug in gens_reduced

archive/issues_011664.json:
```json
{
    "body": "Assignee: malb\n\nCC:  jdemeyer mstreng cremona\n\nEven with proof=false pari can not compute the reduced generators of the ideal below.\n\n\n```\nsage: E = EllipticCurve('57a1')\nsage: R.<x> = QQ['x']\nsage: L.<b3> = NumberField(x^10 - 10*x^8 - 20*x^7 + 165*x^6 - 12*x^5 - 760*x^3 + 2220*x^2 + 5280*x + 7744)\nsage: z_x = -96698852571685/2145672615243325696*b3^9 + 2472249905907/195061146840302336*b3^8 + 916693155514421/2145672615243325696*b3^7 + 1348520950997779/2145672615243325696*b3^6 - 82344497086595/12191321677518896*b3^5 + 2627122040194919/536418153810831424*b3^4 - 452199105143745/48765286710075584*b3^3 + 4317002771457621/536418153810831424*b3^2 + 2050725777454935/67052269226353928*b3 + 3711967683469209/3047830419379724\nsage: E2 = E.change_ring(L)\nsage: z = E2.lift_x(z_x)\nsage: z3=3*z\nsage: OL = L.OK()\nsage: proof.number_field(False)\nsage: gcd3 = OL.fractional_ideal(z3[0], z3[1]).gens_reduced()[0]\n  ***   Warning: precision too low for generators, not given.\n---------------------------------------------------------------------------\nTraceback \n...\n\nPariError:  (25)\n\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/11836\n\n",
    "created_at": "2011-09-22T21:30:37Z",
    "labels": [
        "commutative algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.8",
    "title": "pari bug in gens_reduced",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11664",
    "user": "mirela"
}
```
Assignee: malb

CC:  jdemeyer mstreng cremona

Even with proof=false pari can not compute the reduced generators of the ideal below.


```
sage: E = EllipticCurve('57a1')
sage: R.<x> = QQ['x']
sage: L.<b3> = NumberField(x^10 - 10*x^8 - 20*x^7 + 165*x^6 - 12*x^5 - 760*x^3 + 2220*x^2 + 5280*x + 7744)
sage: z_x = -96698852571685/2145672615243325696*b3^9 + 2472249905907/195061146840302336*b3^8 + 916693155514421/2145672615243325696*b3^7 + 1348520950997779/2145672615243325696*b3^6 - 82344497086595/12191321677518896*b3^5 + 2627122040194919/536418153810831424*b3^4 - 452199105143745/48765286710075584*b3^3 + 4317002771457621/536418153810831424*b3^2 + 2050725777454935/67052269226353928*b3 + 3711967683469209/3047830419379724
sage: E2 = E.change_ring(L)
sage: z = E2.lift_x(z_x)
sage: z3=3*z
sage: OL = L.OK()
sage: proof.number_field(False)
sage: gcd3 = OL.fractional_ideal(z3[0], z3[1]).gens_reduced()[0]
  ***   Warning: precision too low for generators, not given.
---------------------------------------------------------------------------
Traceback 
...

PariError:  (25)

```


Issue created by migration from https://trac.sagemath.org/ticket/11836





---

archive/issue_comments_131844.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-09-23T09:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131844",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_131845.json:
```json
{
    "body": "Changing component from commutative algebra to number fields.",
    "created_at": "2011-09-23T09:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131845",
    "user": "jdemeyer"
}
```

Changing component from commutative algebra to number fields.



---

archive/issue_comments_131846.json:
```json
{
    "body": "Changing assignee from malb to jdemeyer.",
    "created_at": "2011-09-23T09:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131846",
    "user": "jdemeyer"
}
```

Changing assignee from malb to jdemeyer.



---

archive/issue_comments_131847.json:
```json
{
    "body": "I get:\n\n```\nmarco@fermat:~/sage-4.7.2.alpha2/devel/sage$ hg qpush\napplying 11836.patch\nsage/rings/integer.pyx</pre>: No such file or directory\nnow at: 11836.patch\n```\n\non a copy of John's 4.7.2.alpha2 with #11130 included. And the file integer.pyx was not patched. What happened?",
    "created_at": "2011-09-29T20:07:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131847",
    "user": "mstreng"
}
```

I get:

```
marco@fermat:~/sage-4.7.2.alpha2/devel/sage$ hg qpush
applying 11836.patch
sage/rings/integer.pyx</pre>: No such file or directory
now at: 11836.patch
```

on a copy of John's 4.7.2.alpha2 with #11130 included. And the file integer.pyx was not patched. What happened?



---

archive/issue_comments_131848.json:
```json
{
    "body": "Oops, clicked the wrong link :$ that was HTML, sorry.",
    "created_at": "2011-09-29T20:08:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131848",
    "user": "mstreng"
}
```

Oops, clicked the wrong link :$ that was HTML, sorry.



---

archive/issue_comments_131849.json:
```json
{
    "body": "Ok, now I get (with #11130 and 11836.patch):\n\n```\n***   Warning: precision too low for generators, not given.\n```\n\neven though I do get correct output.\n\nExample:\n\n```\nsage: K.<a> = NumberField(x^2+x-58)\nsage: p = 613224584287432205092056925860654065041482770538957925076607095244391171340391841\nsage: P = K.ideal(p).factor()[0][0]\nsage: P\n  ***   Warning: precision too low for generators, not given.\nFractional ideal (49582667258207098257547477827105364096774*a + 402403512193607551973543413116828658131543)\nsage: P.gens_reduced()\n  ***   Warning: precision too low for generators, not given.\n(49582667258207098257547477827105364096774*a + 402403512193607551973543413116828658131543,)\nsage: _[0].norm().abs() == p\nTrue\n```\n",
    "created_at": "2011-10-03T11:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131849",
    "user": "mstreng"
}
```

Ok, now I get (with #11130 and 11836.patch):

```
***   Warning: precision too low for generators, not given.
```

even though I do get correct output.

Example:

```
sage: K.<a> = NumberField(x^2+x-58)
sage: p = 613224584287432205092056925860654065041482770538957925076607095244391171340391841
sage: P = K.ideal(p).factor()[0][0]
sage: P
  ***   Warning: precision too low for generators, not given.
Fractional ideal (49582667258207098257547477827105364096774*a + 402403512193607551973543413116828658131543)
sage: P.gens_reduced()
  ***   Warning: precision too low for generators, not given.
(49582667258207098257547477827105364096774*a + 402403512193607551973543413116828658131543,)
sage: _[0].norm().abs() == p
True
```




---

archive/issue_comments_131850.json:
```json
{
    "body": "I don't think I can easily disable that warning (without disabling *all* warnings from PARI), so I think we just have to live with it.",
    "created_at": "2011-10-03T11:51:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131850",
    "user": "jdemeyer"
}
```

I don't think I can easily disable that warning (without disabling *all* warnings from PARI), so I think we just have to live with it.



---

archive/issue_comments_131851.json:
```json
{
    "body": "Replying to [comment:12 jdemeyer]:\n> I don't think I can easily disable that warning (without disabling *all* warnings from PARI), so I think we just have to live with it.\n\nOk. In that case, could you explain the warning in the documentation and add it to the examples? I was very confused by it.\n\nOf course it also appears when gens_reduced isn't called directly, so there are a lot of functions where you can choose add it or not.",
    "created_at": "2011-10-03T16:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131851",
    "user": "mstreng"
}
```

Replying to [comment:12 jdemeyer]:
> I don't think I can easily disable that warning (without disabling *all* warnings from PARI), so I think we just have to live with it.

Ok. In that case, could you explain the warning in the documentation and add it to the examples? I was very confused by it.

Of course it also appears when gens_reduced isn't called directly, so there are a lot of functions where you can choose add it or not.



---

archive/issue_comments_131852.json:
```json
{
    "body": "Looking at the patch right now. Passed all tests, building documentation.\n\nQuestion now that I'm making comments anyway: between lines 1060 and 1061, should/could you add `self.__is_principal = ...`? Just in case some method comes into existence later that sets `__ideal_class_log` without setting `__is_principal`.\n\n```\nsage: K.<a> = QuadraticField(-5)\nsage: P = K.ideal(3).factor()[0][0]\nsage: P.is_principal()\nFalse\nsage: P = K.ideal(3).factor()[0][0]\nsage: P.__ideal_class_log = [1]\nsage: P.is_principal()\nAttributeError: 'NumberFieldFractionalIdeal' object has no attribute '_NumberFieldIdeal__is_principal'\n```\n\n\nAlso, the use of v[1] in 1073 requires some complicated logic to see that it is really defined. I think it could lead to bugs when other people edit your code later without realising this.\n\n(p.s. I'm not setting anything to \"needs work\" for any of this.)",
    "created_at": "2011-10-03T21:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131852",
    "user": "mstreng"
}
```

Looking at the patch right now. Passed all tests, building documentation.

Question now that I'm making comments anyway: between lines 1060 and 1061, should/could you add `self.__is_principal = ...`? Just in case some method comes into existence later that sets `__ideal_class_log` without setting `__is_principal`.

```
sage: K.<a> = QuadraticField(-5)
sage: P = K.ideal(3).factor()[0][0]
sage: P.is_principal()
False
sage: P = K.ideal(3).factor()[0][0]
sage: P.__ideal_class_log = [1]
sage: P.is_principal()
AttributeError: 'NumberFieldFractionalIdeal' object has no attribute '_NumberFieldIdeal__is_principal'
```


Also, the use of v[1] in 1073 requires some complicated logic to see that it is really defined. I think it could lead to bugs when other people edit your code later without realising this.

(p.s. I'm not setting anything to "needs work" for any of this.)



---

archive/issue_comments_131853.json:
```json
{
    "body": "Replying to [comment:12 jdemeyer]:\n> I don't think I can easily disable that warning (without disabling *all* warnings from PARI), so I think we just have to live with it.\n\nActually, you could try to avoid `bnf.bnfisprincipal(self.pari_hnf(), 1)` whenever `gens_needed=True`. That may even save time, as it saves a call to bnfisprincipal in some cases. I'm afraid it would mean throwing a lot of stuff around in `__cache_...` though.",
    "created_at": "2011-10-03T21:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131853",
    "user": "mstreng"
}
```

Replying to [comment:12 jdemeyer]:
> I don't think I can easily disable that warning (without disabling *all* warnings from PARI), so I think we just have to live with it.

Actually, you could try to avoid `bnf.bnfisprincipal(self.pari_hnf(), 1)` whenever `gens_needed=True`. That may even save time, as it saves a call to bnfisprincipal in some cases. I'm afraid it would mean throwing a lot of stuff around in `__cache_...` though.



---

archive/issue_comments_131854.json:
```json
{
    "body": "Ok, so here's something that really puzzles me:\n\n```\nsage: P\n  ***   Warning: precision too low for generators, not given.\nFractional ideal (49582667258207098257547477827105364096774*a + 402403512193607551973543413116828658131543)\nsage: P\n  ***   Warning: precision too low for generators, not given.\nFractional ideal (49582667258207098257547477827105364096774*a + 402403512193607551973543413116828658131543)\n```\n\nI get the warning twice, indicating that something isn't cached!\n\nIn fact, if I do\n\n```\nsage: trace('P.is_principal()')\n```\n\ntwice, then I get the following each time:\n\n```\n-> 1068             self.__ideal_class_log = list(v[0])\n```\n\nSo you're setting `self.__ideal_class_log`, but the next time, `if not hasattr(self, \"__ideal_class_log\")` is False again!",
    "created_at": "2011-10-03T21:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131854",
    "user": "mstreng"
}
```

Ok, so here's something that really puzzles me:

```
sage: P
  ***   Warning: precision too low for generators, not given.
Fractional ideal (49582667258207098257547477827105364096774*a + 402403512193607551973543413116828658131543)
sage: P
  ***   Warning: precision too low for generators, not given.
Fractional ideal (49582667258207098257547477827105364096774*a + 402403512193607551973543413116828658131543)
```

I get the warning twice, indicating that something isn't cached!

In fact, if I do

```
sage: trace('P.is_principal()')
```

twice, then I get the following each time:

```
-> 1068             self.__ideal_class_log = list(v[0])
```

So you're setting `self.__ideal_class_log`, but the next time, `if not hasattr(self, "__ideal_class_log")` is False again!



---

archive/issue_comments_131855.json:
```json
{
    "body": "Replying to [comment:15 mstreng]\n\nWait, why use flag=1 at all in bnfisprincipal? flag=1 is the (only) one that gives the warning. So if you replace flag=1 by flag=0 or flag=2 on line 1067, then that removes the warning.\n\nMore importantly: flag=2 (as opposed to 0 or 1) makes sure that `__ideal_class_log` is really correct by doubling the precision if necessary. That would fix a bug that we haven't even found yet! It doesn't slow correct answers down, as it only doubles the precision until we know `__ideal_class_log`; it does not continue on until we know a generator.\n\n```\nsage: K.<a> = NumberField(x^2+x-58)\nsage: p = 613224584287432205092056925860654065041482770538957925076607095244391171340391841\nsage: P = K.ideal(p).factor()[0][0]\nsage: bnf = P.number_field().pari_bnf()\nsage: bnf.bnfisprincipal(P.pari_hnf(), 0)\n[]~\nsage: bnf.bnfisprincipal(P.pari_hnf(), 1)\n  ***   Warning: precision too low for generators, not given.\n[[]~, []~]\nsage: bnf.bnfisprincipal(P.pari_hnf(), 2)\n[]~\nsage: bnf.bnfisprincipal(P.pari_hnf(), 3)\n[[]~, [402403512193607551973543413116828658131543, 49582667258207098257547477827105364096774]~]\n```\n",
    "created_at": "2011-10-03T22:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131855",
    "user": "mstreng"
}
```

Replying to [comment:15 mstreng]

Wait, why use flag=1 at all in bnfisprincipal? flag=1 is the (only) one that gives the warning. So if you replace flag=1 by flag=0 or flag=2 on line 1067, then that removes the warning.

More importantly: flag=2 (as opposed to 0 or 1) makes sure that `__ideal_class_log` is really correct by doubling the precision if necessary. That would fix a bug that we haven't even found yet! It doesn't slow correct answers down, as it only doubles the precision until we know `__ideal_class_log`; it does not continue on until we know a generator.

```
sage: K.<a> = NumberField(x^2+x-58)
sage: p = 613224584287432205092056925860654065041482770538957925076607095244391171340391841
sage: P = K.ideal(p).factor()[0][0]
sage: bnf = P.number_field().pari_bnf()
sage: bnf.bnfisprincipal(P.pari_hnf(), 0)
[]~
sage: bnf.bnfisprincipal(P.pari_hnf(), 1)
  ***   Warning: precision too low for generators, not given.
[[]~, []~]
sage: bnf.bnfisprincipal(P.pari_hnf(), 2)
[]~
sage: bnf.bnfisprincipal(P.pari_hnf(), 3)
[[]~, [402403512193607551973543413116828658131543, 49582667258207098257547477827105364096774]~]
```




---

archive/issue_comments_131856.json:
```json
{
    "body": "Ok, sorry for the amount of posts. I'm done reading the patch, and it looks good. So let me sum things up:\n\nCould you...\n\n* replace flag 1 by flag 2 in bnfisprincipal to fix one more bug, and remove the confusing pari warnings all at the same time!\n\n* find out why caching doesn't seem to work. Is the problem a difference between hasattr and catching `AttributeError`? see [comment:16 mstreng]\n\n* while you're doing the above, think about the minor things of [comment:14 mstreng]?",
    "created_at": "2011-10-03T22:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131856",
    "user": "mstreng"
}
```

Ok, sorry for the amount of posts. I'm done reading the patch, and it looks good. So let me sum things up:

Could you...

* replace flag 1 by flag 2 in bnfisprincipal to fix one more bug, and remove the confusing pari warnings all at the same time!

* find out why caching doesn't seem to work. Is the problem a difference between hasattr and catching `AttributeError`? see [comment:16 mstreng]

* while you're doing the above, think about the minor things of [comment:14 mstreng]?



---

archive/issue_comments_131857.json:
```json
{
    "body": "Replying to [comment:17 mstreng]:\n> Replying to [comment:15 mstreng]\n> \n> Wait, why use flag=1 at all in bnfisprincipal? flag=1 is the (only) one that gives the warning. So if you replace flag=1 by flag=0 or flag=2 on line 1067, then that removes the warning.\n\n> More importantly: flag=2 (as opposed to 0 or 1) makes sure that `__ideal_class_log` is really correct by doubling the precision if necessary. That would fix a bug that we haven't even found yet! It doesn't slow correct answers down, as it only doubles the precision until we know `__ideal_class_log`; it does not continue on until we know a generator.\n\nWhat `bnfisprincipal()` tries to do is to write an ideal as C_1 <sup>e_1</sup> * ... * C_n <sup>e_n</sup> * (a), where (a) is a principal ideal and C_1, ..., C_n are fixed generators of the class group (these are determined by `bnfinit()` or `pari_bnf()` in Sage).  The exponents e_1, ..., e_n are *always* computed but (a) is not and that is what is warning is about.  The warning is never about potentially incorrect results, it essentially means \"we could not easily compute (a), so we didn't bother\".  `__ideal_class_log` should always be correct, regardless of the flag.\n\nMy code uses `flag=1` first because sometimes we might not care about (a).  For example, if the ideal is non-principal or the user wants to know `I.is_principal()` without actually needing the generator.\n\nOne thing could be improved: if we know that the class group is trivial, some shortcuts can be made.",
    "created_at": "2011-10-04T07:20:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131857",
    "user": "jdemeyer"
}
```

Replying to [comment:17 mstreng]:
> Replying to [comment:15 mstreng]
> 
> Wait, why use flag=1 at all in bnfisprincipal? flag=1 is the (only) one that gives the warning. So if you replace flag=1 by flag=0 or flag=2 on line 1067, then that removes the warning.

> More importantly: flag=2 (as opposed to 0 or 1) makes sure that `__ideal_class_log` is really correct by doubling the precision if necessary. That would fix a bug that we haven't even found yet! It doesn't slow correct answers down, as it only doubles the precision until we know `__ideal_class_log`; it does not continue on until we know a generator.

What `bnfisprincipal()` tries to do is to write an ideal as C_1 <sup>e_1</sup> * ... * C_n <sup>e_n</sup> * (a), where (a) is a principal ideal and C_1, ..., C_n are fixed generators of the class group (these are determined by `bnfinit()` or `pari_bnf()` in Sage).  The exponents e_1, ..., e_n are *always* computed but (a) is not and that is what is warning is about.  The warning is never about potentially incorrect results, it essentially means "we could not easily compute (a), so we didn't bother".  `__ideal_class_log` should always be correct, regardless of the flag.

My code uses `flag=1` first because sometimes we might not care about (a).  For example, if the ideal is non-principal or the user wants to know `I.is_principal()` without actually needing the generator.

One thing could be improved: if we know that the class group is trivial, some shortcuts can be made.



---

archive/issue_comments_131858.json:
```json
{
    "body": "Replying to [comment:19 jdemeyer]\n\nHi Jeroen,\n\nThanks for the explanation. I understood all of that, except for `__ideal_class_log` always being output and always being correct. If it is, then what is the difference between flag=0 and flag=2? Are you saying that there is no difference? The documentation of bnfisprincipal from pari 2.5.0 seems to confirm what you are saying. I just realised that I was reading the documentation from 2.3.5, which suggested otherwise.\n\nI guess that leaves only my other reason for removing flag=1:\n\nThe warning disappears if you replace flag=1 by 0, 2 or 3. This is because you only get the warning when you ask for a generator, but don't get it and don't demand it (i.e., if you choose flag=1 and the ideal is too big). The warning is confusing and worried me as a user. So I would like to either have it extensively documented in this patch, or removed. And it can be removed simply by never using flag=1, but always 0, 2, or 3.\n\nIf you simply replace flag=1 by 0, 2 or 3, then that slows your patch down in some cases. However, you could do flag=3 if gens_needed=True, and flag=0 otherwise. In other words, call bnfisprincipal only 1 time during `__cache_...` with the flag directly depending on gens_needed. That would not slow things down. In fact, it would speed things up in case of gens_needed=True and a big ideal.\n\nMarco",
    "created_at": "2011-10-04T08:50:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131858",
    "user": "mstreng"
}
```

Replying to [comment:19 jdemeyer]

Hi Jeroen,

Thanks for the explanation. I understood all of that, except for `__ideal_class_log` always being output and always being correct. If it is, then what is the difference between flag=0 and flag=2? Are you saying that there is no difference? The documentation of bnfisprincipal from pari 2.5.0 seems to confirm what you are saying. I just realised that I was reading the documentation from 2.3.5, which suggested otherwise.

I guess that leaves only my other reason for removing flag=1:

The warning disappears if you replace flag=1 by 0, 2 or 3. This is because you only get the warning when you ask for a generator, but don't get it and don't demand it (i.e., if you choose flag=1 and the ideal is too big). The warning is confusing and worried me as a user. So I would like to either have it extensively documented in this patch, or removed. And it can be removed simply by never using flag=1, but always 0, 2, or 3.

If you simply replace flag=1 by 0, 2 or 3, then that slows your patch down in some cases. However, you could do flag=3 if gens_needed=True, and flag=0 otherwise. In other words, call bnfisprincipal only 1 time during `__cache_...` with the flag directly depending on gens_needed. That would not slow things down. In fact, it would speed things up in case of gens_needed=True and a big ideal.

Marco



---

archive/issue_comments_131859.json:
```json
{
    "body": "New patch, hopefully fixing all issues mentioned above.  The caching problem was apparently caused by double underscores, so I'm using single underscores now.  I am still using `flag=1` if `gens_needed` simply because it seems silly *not* to store the generator if PARI computes it anyway.",
    "created_at": "2011-10-04T09:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131859",
    "user": "jdemeyer"
}
```

New patch, hopefully fixing all issues mentioned above.  The caching problem was apparently caused by double underscores, so I'm using single underscores now.  I am still using `flag=1` if `gens_needed` simply because it seems silly *not* to store the generator if PARI computes it anyway.



---

archive/issue_comments_131860.json:
```json
{
    "body": "Attachment [11836.patch](tarball://root/attachments/some-uuid/ticket11836/11836.patch) by jdemeyer created at 2011-10-04 09:47:59\n\nReplying to [comment:18 mstreng]:\n> Is the problem a difference between hasattr and catching `AttributeError`?\nCould be but I don't feel like delving too much in the details here.",
    "created_at": "2011-10-04T09:47:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131860",
    "user": "jdemeyer"
}
```

Attachment [11836.patch](tarball://root/attachments/some-uuid/ticket11836/11836.patch) by jdemeyer created at 2011-10-04 09:47:59

Replying to [comment:18 mstreng]:
> Is the problem a difference between hasattr and catching `AttributeError`?
Could be but I don't feel like delving too much in the details here.



---

archive/issue_comments_131861.json:
```json
{
    "body": "Looks good, but no time to look at it in detail today. Could you send me a diff between the two versions (or simply tell me which parts didn't change)? That may save time.",
    "created_at": "2011-10-04T10:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131861",
    "user": "mstreng"
}
```

Looks good, but no time to look at it in detail today. Could you send me a diff between the two versions (or simply tell me which parts didn't change)? That may save time.



---

archive/issue_comments_131862.json:
```json
{
    "body": "Replying to [comment:24 mstreng]:\n> Looks good, but no time to look at it in detail today. Could you send me a diff between the two versions (or simply tell me which parts didn't change)? That may save time.\n\nI'm afraid I don't have a copy of the old patch.\n\nThe only parts which changed w.r.t. the old patch are:\n1. removing some underscores.\n2. the implementation of the `_cache_bnfisprincipal()` function, lines 1060--1076.\n3. added doctests for `ideal_class_log()`, lines 1123--1148.",
    "created_at": "2011-10-04T11:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131862",
    "user": "jdemeyer"
}
```

Replying to [comment:24 mstreng]:
> Looks good, but no time to look at it in detail today. Could you send me a diff between the two versions (or simply tell me which parts didn't change)? That may save time.

I'm afraid I don't have a copy of the old patch.

The only parts which changed w.r.t. the old patch are:
1. removing some underscores.
2. the implementation of the `_cache_bnfisprincipal()` function, lines 1060--1076.
3. added doctests for `ideal_class_log()`, lines 1123--1148.



---

archive/issue_comments_131863.json:
```json
{
    "body": "#11130 needs a review first",
    "created_at": "2011-10-05T13:21:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131863",
    "user": "mstreng"
}
```

#11130 needs a review first



---

archive/issue_comments_131864.json:
```json
{
    "body": "Replying to [comment:26 mstreng]:\n> #11130 needs a review first\nWhy?  It's not because a dependency needs review that this cannot be reviewed.  Anyway, #11130 was positively reviewed against sage-4.7.2.alpha2 and I simply added a small patch to #11130 for sage-4.7.2.alpha3.",
    "created_at": "2011-10-05T13:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131864",
    "user": "jdemeyer"
}
```

Replying to [comment:26 mstreng]:
> #11130 needs a review first
Why?  It's not because a dependency needs review that this cannot be reviewed.  Anyway, #11130 was positively reviewed against sage-4.7.2.alpha2 and I simply added a small patch to #11130 for sage-4.7.2.alpha3.



---

archive/issue_comments_131865.json:
```json
{
    "body": "ok, so you're saying that only that one patch of #11130 still needs a review?",
    "created_at": "2011-10-05T15:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131865",
    "user": "mstreng"
}
```

ok, so you're saying that only that one patch of #11130 still needs a review?



---

archive/issue_comments_131866.json:
```json
{
    "body": "Replying to [comment:28 mstreng]:\n> ok, so you're saying that only that one patch of #11130 still needs a review?\nYes, and also the dependency #11321.",
    "created_at": "2011-10-05T16:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131866",
    "user": "jdemeyer"
}
```

Replying to [comment:28 mstreng]:
> ok, so you're saying that only that one patch of #11130 still needs a review?
Yes, and also the dependency #11321.



---

archive/issue_comments_131867.json:
```json
{
    "body": "Replying to [comment:29 jdemeyer]:\n> Yes, and also the dependency #11321.\n\nOk, so no rush for #11836 then.",
    "created_at": "2011-10-05T16:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131867",
    "user": "mstreng"
}
```

Replying to [comment:29 jdemeyer]:
> Yes, and also the dependency #11321.

Ok, so no rush for #11836 then.



---

archive/issue_comments_131868.json:
```json
{
    "body": "Fixes all issues that I raised. Looks very good. Doctesting now...",
    "created_at": "2011-10-16T15:50:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131868",
    "user": "mstreng"
}
```

Fixes all issues that I raised. Looks very good. Doctesting now...



---

archive/issue_comments_131869.json:
```json
{
    "body": "Tests pass, thanks for all the work!",
    "created_at": "2011-10-16T16:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131869",
    "user": "mstreng"
}
```

Tests pass, thanks for all the work!



---

archive/issue_comments_131870.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-10-16T16:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131870",
    "user": "mstreng"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_131871.json:
```json
{
    "body": "Replying to [comment:32 mstreng]:\n> Tests pass, thanks for all the work!\n\nAnd thanks for the reviewing!",
    "created_at": "2011-10-16T16:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131871",
    "user": "jdemeyer"
}
```

Replying to [comment:32 mstreng]:
> Tests pass, thanks for all the work!

And thanks for the reviewing!



---

archive/issue_comments_131872.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131872",
    "user": "jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_comments_131873.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-11-07T10:12:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11664",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11664#issuecomment-131873",
    "user": "jdemeyer"
}
```

Resolution: fixed
