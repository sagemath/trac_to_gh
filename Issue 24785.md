# Issue 24785: change_ring broken on polynomials

archive/issues_024785.json:
```json
{
    "body": "CC:  rws\n\nIf the polynomial can be coerced in the new base ring, the result of `change_ring` is a constant\n\n```\nsage: p = ZZ['x']([1,2,3])\nsage: p.change_ring(QQ['x']).degree()\n0\nsage: p.change_ring(SR).degree()\n0\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/25022\n\n",
    "created_at": "2018-03-22T09:12:07Z",
    "labels": [
        "commutative algebra",
        "major",
        "bug"
    ],
    "title": "change_ring broken on polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24785",
    "user": "vdelecroix"
}
```
CC:  rws

If the polynomial can be coerced in the new base ring, the result of `change_ring` is a constant

```
sage: p = ZZ['x']([1,2,3])
sage: p.change_ring(QQ['x']).degree()
0
sage: p.change_ring(SR).degree()
0
```


Issue created by migration from https://trac.sagemath.org/ticket/25022





---

archive/issue_comments_347989.json:
```json
{
    "body": "Note that `change_ring` is supposed to change the base ring. For instance, we have:\n\n```\nsage: p.change_ring(QQ['y']).degree()\n2\nsage: p.change_ring(QQ['y']).parent()\nUnivariate Polynomial Ring in x over Univariate Polynomial Ring in y over Rational Field\n```\n\nIn your case, you basically end up with\n\n```\nsage: QQ['x']['x'](p)\n3*x^2 + 2*x + 1\n```\n\nand as it goes with coercion, the `x` of `p` coerces as low in the tower as possible.\n\nPerhaps you'd prefer the result\n\n```\nsage: QQ['x']['x'](p)\n3*x^2 + 2*x + 1\n```\n\n\nThere's some work to be done, though:\n\n```\nsage: R.<x,y>=ZZ[]\nsage: f=x^2+y^2\nsage: f.change_ring(QQ['x','y']).monomials()\n[1]\nsage: f.change_ring(QQ['x']).monomials()\n[x^2, y^2]\nsage: f.change_ring(QQ['y']).monomials()\n[x^2, y^2]\n```\n\nwhich does match\n\n```\nsage: QQ['x']['x','y'](f).monomials()\n[x^2, y^2]\nsage: QQ['x','y']['x','y'](f).monomials()\n[1]\n```\n\nbut doesn't seem to fit the pattern of \"coerce 'x' as low as possible. But then, following that rule consistently might not be such a good idea.\n\n```\nsage: QQ['x']['x'](QQ['x']['x'].0).degree()\n1\n```\n",
    "created_at": "2018-03-23T05:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24785#issuecomment-347989",
    "user": "nbruin"
}
```

Note that `change_ring` is supposed to change the base ring. For instance, we have:

```
sage: p.change_ring(QQ['y']).degree()
2
sage: p.change_ring(QQ['y']).parent()
Univariate Polynomial Ring in x over Univariate Polynomial Ring in y over Rational Field
```

In your case, you basically end up with

```
sage: QQ['x']['x'](p)
3*x^2 + 2*x + 1
```

and as it goes with coercion, the `x` of `p` coerces as low in the tower as possible.

Perhaps you'd prefer the result

```
sage: QQ['x']['x'](p)
3*x^2 + 2*x + 1
```


There's some work to be done, though:

```
sage: R.<x,y>=ZZ[]
sage: f=x^2+y^2
sage: f.change_ring(QQ['x','y']).monomials()
[1]
sage: f.change_ring(QQ['x']).monomials()
[x^2, y^2]
sage: f.change_ring(QQ['y']).monomials()
[x^2, y^2]
```

which does match

```
sage: QQ['x']['x','y'](f).monomials()
[x^2, y^2]
sage: QQ['x','y']['x','y'](f).monomials()
[1]
```

but doesn't seem to fit the pattern of "coerce 'x' as low as possible. But then, following that rule consistently might not be such a good idea.

```
sage: QQ['x']['x'](QQ['x']['x'].0).degree()
1
```




---

archive/issue_comments_347990.json:
```json
{
    "body": "I think that `change_ring` on elements should uniformly be\n\n```\ndef change_ring(self, R):\n    return self.parent().change_ring(R)(list(self))\n```\n\nI don't plan to change anything to the `_element_constructor_` which is definitely allowed to behave differently.",
    "created_at": "2018-03-23T08:11:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24785#issuecomment-347990",
    "user": "vdelecroix"
}
```

I think that `change_ring` on elements should uniformly be

```
def change_ring(self, R):
    return self.parent().change_ring(R)(list(self))
```

I don't plan to change anything to the `_element_constructor_` which is definitely allowed to behave differently.



---

archive/issue_comments_347991.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-23T14:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24785#issuecomment-347991",
    "user": "vdelecroix"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_347992.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-03-23T14:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24785#issuecomment-347992",
    "user": "vdelecroix"
}
```

New commits:



---

archive/issue_comments_347993.json:
```json
{
    "body": "Changes look good to me. nbruin, do you agree?",
    "created_at": "2018-03-23T22:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24785#issuecomment-347993",
    "user": "saraedum"
}
```

Changes look good to me. nbruin, do you agree?



---

archive/issue_comments_347994.json:
```json
{
    "body": "Patchbot is green, too.",
    "created_at": "2018-03-25T08:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24785#issuecomment-347994",
    "user": "rws"
}
```

Patchbot is green, too.



---

archive/issue_comments_347995.json:
```json
{
    "body": "ping",
    "created_at": "2018-04-03T07:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24785#issuecomment-347995",
    "user": "vdelecroix"
}
```

ping



---

archive/issue_comments_347996.json:
```json
{
    "body": "Since nbruin has not reacted, let's assume that he does at least not strongly disagree\u2026",
    "created_at": "2018-04-04T20:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24785#issuecomment-347996",
    "user": "saraedum"
}
```

Since nbruin has not reacted, let's assume that he does at least not strongly disagreeâ€¦



---

archive/issue_comments_347997.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-04T20:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24785#issuecomment-347997",
    "user": "saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_347998.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-12T11:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24785#issuecomment-347998",
    "user": "vbraun"
}
```

Resolution: fixed
