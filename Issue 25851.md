# Issue 25851: py3: hash for padic extension rings

archive/issues_025851.json:
```json
{
    "body": "CC:  caruso roed tscrim\n\npart of #24551\n\nIssue created by migration from https://trac.sagemath.org/ticket/26088\n\n",
    "created_at": "2018-08-18T06:51:13Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "py3: hash for padic extension rings",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25851",
    "user": "chapoton"
}
```
CC:  caruso roed tscrim

part of #24551

Issue created by migration from https://trac.sagemath.org/ticket/26088





---

archive/issue_comments_364814.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-08-18T06:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364814",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_364815.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-08-18T06:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364815",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_364816.json:
```json
{
    "body": "I'm not sure what hashes are used for but I would say that the precision type should be included in the hash, shouldn't it?",
    "created_at": "2018-08-18T08:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364816",
    "user": "caruso"
}
```

I'm not sure what hashes are used for but I would say that the precision type should be included in the hash, shouldn't it?



---

archive/issue_comments_364817.json:
```json
{
    "body": "This hash is parallel to the behaviour of `__eq__` in the same class.\n\nI you want to change the equality, maybe do that in another ticket ?",
    "created_at": "2018-08-18T09:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364817",
    "user": "chapoton"
}
```

This hash is parallel to the behaviour of `__eq__` in the same class.

I you want to change the equality, maybe do that in another ticket ?



---

archive/issue_comments_364818.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-08-18T10:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364818",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_364819.json:
```json
{
    "body": "some failing doctests..",
    "created_at": "2018-08-18T10:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364819",
    "user": "chapoton"
}
```

some failing doctests..



---

archive/issue_comments_364820.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-19T06:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364820",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364821.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-19T06:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364821",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_364822.json:
```json
{
    "body": "This should fix the failing doctests.",
    "created_at": "2018-08-19T06:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364822",
    "user": "chapoton"
}
```

This should fix the failing doctests.



---

archive/issue_comments_364823.json:
```json
{
    "body": "green bot, please review",
    "created_at": "2018-08-19T17:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364823",
    "user": "chapoton"
}
```

green bot, please review



---

archive/issue_comments_364824.json:
```json
{
    "body": "I think that it's not enough to compare the string representation of the printer.\nFor example:\n\n\n```\nsage: A.<pi> = Zp(2, print_mode='bars', print_sep='|').extension(x^3 - 2)\nsage: B.<pi> = Zp(2, print_mode='bars', print_sep='#').extension(x^3 - 2)\nsage: A == B\nFalse\nsage: hash(A) == hash(B)\nTrue\n```\n\n\nProbably, one should implement a method `__hash__` for the printer as well...",
    "created_at": "2018-08-20T04:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364824",
    "user": "caruso"
}
```

I think that it's not enough to compare the string representation of the printer.
For example:


```
sage: A.<pi> = Zp(2, print_mode='bars', print_sep='|').extension(x^3 - 2)
sage: B.<pi> = Zp(2, print_mode='bars', print_sep='#').extension(x^3 - 2)
sage: A == B
False
sage: hash(A) == hash(B)
True
```


Probably, one should implement a method `__hash__` for the printer as well...



---

archive/issue_comments_364825.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-20T07:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364825",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364826.json:
```json
{
    "body": "The hash is not necessarily taking all parameters into account. One could very well just forget about the printing mode.\n\nNevertheless, here is another proposal.",
    "created_at": "2018-08-20T07:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364826",
    "user": "chapoton"
}
```

The hash is not necessarily taking all parameters into account. One could very well just forget about the printing mode.

Nevertheless, here is another proposal.



---

archive/issue_comments_364827.json:
```json
{
    "body": "Replying to [comment:10 chapoton]:\n> The hash is not necessarily taking all parameters into account. One could very well just forget about the printing mode.\n\nWhat's exactly the purpose and the requirements on the hash?\nDo we need to ensure that `A == B` implies `hash(A) == hash(B)`? Or the other way around? Something else? Nothing?",
    "created_at": "2018-08-20T08:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364827",
    "user": "caruso"
}
```

Replying to [comment:10 chapoton]:
> The hash is not necessarily taking all parameters into account. One could very well just forget about the printing mode.

What's exactly the purpose and the requirements on the hash?
Do we need to ensure that `A == B` implies `hash(A) == hash(B)`? Or the other way around? Something else? Nothing?



---

archive/issue_comments_364828.json:
```json
{
    "body": "The only requirement is that \"A == B\" implies \"hash(A) == hash(B)\".\n\nOne could even use the constant hash, that would be perfectly valid, but useless. So in general there is a balance or a choice : complex hash that tells many things apart, or simple hash that is not so good.\n\nI think in sage, the hash for parents are not so important. They are required for python3 nevertheless.\n\nhttps://docs.python.org/2/library/functions.html#hash\n\nhttps://docs.python.org/2/glossary.html#term-hashable",
    "created_at": "2018-08-20T08:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364828",
    "user": "chapoton"
}
```

The only requirement is that "A == B" implies "hash(A) == hash(B)".

One could even use the constant hash, that would be perfectly valid, but useless. So in general there is a balance or a choice : complex hash that tells many things apart, or simple hash that is not so good.

I think in sage, the hash for parents are not so important. They are required for python3 nevertheless.

https://docs.python.org/2/library/functions.html#hash

https://docs.python.org/2/glossary.html#term-hashable



---

archive/issue_comments_364829.json:
```json
{
    "body": "Is this ok for you, Xavier ? Patchbot is green.",
    "created_at": "2018-08-20T19:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364829",
    "user": "chapoton"
}
```

Is this ok for you, Xavier ? Patchbot is green.



---

archive/issue_comments_364830.json:
```json
{
    "body": "Yes, it looks good to me.\n\nI would be happy to give a positive review but I don't know so much about p-adic printers and I would be more comfortable if David confirms that your changes won't break something elsewhere. David, could you do this, please?",
    "created_at": "2018-08-20T20:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364830",
    "user": "caruso"
}
```

Yes, it looks good to me.

I would be happy to give a positive review but I don't know so much about p-adic printers and I would be more comfortable if David confirms that your changes won't break something elsewhere. David, could you do this, please?



---

archive/issue_comments_364831.json:
```json
{
    "body": "A printer's `__eq__` is quite complex so I think that hashing the full dict is too much, i.e., it'll give different hashes to  printers that are considered equal. Strangely, the printer is not hashable (seems like a bug to me) so I'd not include it into the hash of the ring at all. If it were hashable, we should just include the printer's hash value.\n\nSo, I'd drop `hash_printer` and add a comment that printer's are strangely not hashable. Does that sound Ok to you?",
    "created_at": "2018-08-22T02:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364831",
    "user": "saraedum"
}
```

A printer's `__eq__` is quite complex so I think that hashing the full dict is too much, i.e., it'll give different hashes to  printers that are considered equal. Strangely, the printer is not hashable (seems like a bug to me) so I'd not include it into the hash of the ring at all. If it were hashable, we should just include the printer's hash value.

So, I'd drop `hash_printer` and add a comment that printer's are strangely not hashable. Does that sound Ok to you?



---

archive/issue_comments_364832.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-08-22T02:06:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364832",
    "user": "saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_364833.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-22T05:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364833",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364834.json:
```json
{
    "body": "done",
    "created_at": "2018-08-22T05:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364834",
    "user": "chapoton"
}
```

done



---

archive/issue_comments_364835.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-22T05:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364835",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_364836.json:
```json
{
    "body": "Everything seems to be ok. Positive review, somebody ?",
    "created_at": "2018-08-26T15:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364836",
    "user": "chapoton"
}
```

Everything seems to be ok. Positive review, somebody ?



---

archive/issue_comments_364837.json:
```json
{
    "body": "review, please",
    "created_at": "2018-08-29T18:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364837",
    "user": "chapoton"
}
```

review, please



---

archive/issue_comments_364838.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-29T18:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364838",
    "user": "saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_364839.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-30T22:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25851#issuecomment-364839",
    "user": "vbraun"
}
```

Resolution: fixed
