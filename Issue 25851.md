# Issue 25851: py3: hash for padic extension rings

Issue created by migration from https://trac.sagemath.org/ticket/26088

Original creator: chapoton

Original creation time: 2018-08-18 06:51:13

CC:  caruso roed tscrim

part of #24551


---

Comment by chapoton created at 2018-08-18 06:52:38

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-08-18 06:52:38

New commits:


---

Comment by caruso created at 2018-08-18 08:12:33

I'm not sure what hashes are used for but I would say that the precision type should be included in the hash, shouldn't it?


---

Comment by chapoton created at 2018-08-18 09:30:36

This hash is parallel to the behaviour of `__eq__` in the same class.

I you want to change the equality, maybe do that in another ticket ?


---

Comment by chapoton created at 2018-08-18 10:14:56

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2018-08-18 10:14:56

some failing doctests..


---

Comment by git created at 2018-08-19 06:44:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-08-19 06:45:31

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-08-19 06:45:31

This should fix the failing doctests.


---

Comment by chapoton created at 2018-08-19 17:02:38

green bot, please review


---

Comment by caruso created at 2018-08-20 04:29:55

I think that it's not enough to compare the string representation of the printer.
For example:


```
sage: A.<pi> = Zp(2, print_mode='bars', print_sep='|').extension(x^3 - 2)
sage: B.<pi> = Zp(2, print_mode='bars', print_sep='#').extension(x^3 - 2)
sage: A == B
False
sage: hash(A) == hash(B)
True
```


Probably, one should implement a method `__hash__` for the printer as well...


---

Comment by git created at 2018-08-20 07:25:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-08-20 07:26:35

The hash is not necessarily taking all parameters into account. One could very well just forget about the printing mode.

Nevertheless, here is another proposal.


---

Comment by caruso created at 2018-08-20 08:29:20

Replying to [comment:10 chapoton]:
> The hash is not necessarily taking all parameters into account. One could very well just forget about the printing mode.

What's exactly the purpose and the requirements on the hash?
Do we need to ensure that `A == B` implies `hash(A) == hash(B)`? Or the other way around? Something else? Nothing?


---

Comment by chapoton created at 2018-08-20 08:42:04

The only requirement is that "A == B" implies "hash(A) == hash(B)".

One could even use the constant hash, that would be perfectly valid, but useless. So in general there is a balance or a choice : complex hash that tells many things apart, or simple hash that is not so good.

I think in sage, the hash for parents are not so important. They are required for python3 nevertheless.

https://docs.python.org/2/library/functions.html#hash

https://docs.python.org/2/glossary.html#term-hashable


---

Comment by chapoton created at 2018-08-20 19:36:30

Is this ok for you, Xavier ? Patchbot is green.


---

Comment by caruso created at 2018-08-20 20:26:46

Yes, it looks good to me.

I would be happy to give a positive review but I don't know so much about p-adic printers and I would be more comfortable if David confirms that your changes won't break something elsewhere. David, could you do this, please?


---

Comment by saraedum created at 2018-08-22 02:05:48

A printer's `__eq__` is quite complex so I think that hashing the full dict is too much, i.e., it'll give different hashes to  printers that are considered equal. Strangely, the printer is not hashable (seems like a bug to me) so I'd not include it into the hash of the ring at all. If it were hashable, we should just include the printer's hash value.

So, I'd drop `hash_printer` and add a comment that printer's are strangely not hashable. Does that sound Ok to you?


---

Comment by saraedum created at 2018-08-22 02:06:07

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-08-22 05:57:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-08-22 05:58:01

done


---

Comment by chapoton created at 2018-08-22 05:58:01

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-08-26 15:15:16

Everything seems to be ok. Positive review, somebody ?


---

Comment by chapoton created at 2018-08-29 18:33:02

review, please


---

Comment by saraedum created at 2018-08-29 18:39:27

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-08-30 22:24:37

Resolution: fixed
