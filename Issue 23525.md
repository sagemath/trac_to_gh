# Issue 23525: sage.env._add_variable_or_fallback: Get rid of $variable substitution feature

archive/issues_023525.json:
```json
{
    "body": "CC:  @jhpalmieri\n\nAs discussed in #23758, the feature of `_add_variable_or_fallback` to do variable substitution seems unnecessarily complex.\n\nAll uses later in that module such as \n\n```\n_add_variable_or_fallback('SAGE_ETC',        opj('$SAGE_LOCAL', 'etc'))\n```\n\ncan be replaced by simple use of Python variables (which all exist in the `sage.env` module)\n\n```\n_add_variable_or_fallback('SAGE_ETC',        opj(SAGE_LOCAL, 'etc'))\n```\n\nThis also will have a clearer failure mode -- instead of leaving an unsubstituted $SAGE_LOCAL in a string if that variable is not set for some reason, an error will be raised.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23762\n\n",
    "created_at": "2017-08-31T05:01:29Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "sage.env._add_variable_or_fallback: Get rid of $variable substitution feature",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23525",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @jhpalmieri

As discussed in #23758, the feature of `_add_variable_or_fallback` to do variable substitution seems unnecessarily complex.

All uses later in that module such as 

```
_add_variable_or_fallback('SAGE_ETC',        opj('$SAGE_LOCAL', 'etc'))
```

can be replaced by simple use of Python variables (which all exist in the `sage.env` module)

```
_add_variable_or_fallback('SAGE_ETC',        opj(SAGE_LOCAL, 'etc'))
```

This also will have a clearer failure mode -- instead of leaving an unsubstituted $SAGE_LOCAL in a string if that variable is not set for some reason, an error will be raised.


Issue created by migration from https://trac.sagemath.org/ticket/23762





---

archive/issue_comments_329261.json:
```json
{
    "body": "I think the variable substitution scheme was introduced in #13432. I've asked there about its rationale: I don't want to remove this without trying to understand why it was introduced in the first place.\n\nIn the mean time, I have a branch which makes the change from strings to variables: `'$VAR' --> VAR`.",
    "created_at": "2017-08-31T22:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23525#issuecomment-329261",
    "user": "https://github.com/jhpalmieri"
}
```

I think the variable substitution scheme was introduced in #13432. I've asked there about its rationale: I don't want to remove this without trying to understand why it was introduced in the first place.

In the mean time, I have a branch which makes the change from strings to variables: `'$VAR' --> VAR`.



---

archive/issue_comments_329262.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-08-31T22:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23525#issuecomment-329262",
    "user": "https://github.com/jhpalmieri"
}
```

New commits:



---

archive/issue_comments_329263.json:
```json
{
    "body": "This branch passes doctests for me, but I want to wait to set it to \"needs_review\" for some feedback from the participants at #13432.",
    "created_at": "2017-09-01T00:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23525#issuecomment-329263",
    "user": "https://github.com/jhpalmieri"
}
```

This branch passes doctests for me, but I want to wait to set it to "needs_review" for some feedback from the participants at #13432.



---

archive/issue_comments_329264.json:
```json
{
    "body": "Potential conflict with #21535.",
    "created_at": "2017-09-01T12:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23525#issuecomment-329264",
    "user": "https://github.com/jdemeyer"
}
```

Potential conflict with #21535.



---

archive/issue_comments_329265.json:
```json
{
    "body": "Replying to [comment:5 jdemeyer]:\n> Potential conflict with #21535.\n\nOkay, it should be easy to rebase. I will wait until #21535 has settled into a stable state (and also to see if there are objections to this ticket as a whole).",
    "created_at": "2017-09-01T14:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23525#issuecomment-329265",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:5 jdemeyer]:
> Potential conflict with #21535.

Okay, it should be easy to rebase. I will wait until #21535 has settled into a stable state (and also to see if there are objections to this ticket as a whole).



---

archive/issue_comments_329266.json:
```json
{
    "body": "I don't think I ever saw the original version of this, but it would be superseded now by #27040 (which accomplishes the same goal).",
    "created_at": "2019-01-18T12:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23525#issuecomment-329266",
    "user": "https://github.com/embray"
}
```

I don't think I ever saw the original version of this, but it would be superseded now by #27040 (which accomplishes the same goal).



---

archive/issue_comments_329267.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2019-01-18T12:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23525",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23525#issuecomment-329267",
    "user": "https://github.com/embray"
}
```

Resolution: duplicate
