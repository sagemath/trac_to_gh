# Issue 23525: sage.env._add_variable_or_fallback: Get rid of $variable substitution feature

Issue created by migration from Trac.

Original creator: mkoeppe

Original creation time: 2017-08-31 05:01:29

CC:  jhpalmieri

As discussed in #23758, the feature of `_add_variable_or_fallback` to do variable substitution seems unnecessarily complex.

All uses later in that module such as 

```
_add_variable_or_fallback('SAGE_ETC',        opj('$SAGE_LOCAL', 'etc'))
```

can be replaced by simple use of Python variables (which all exist in the `sage.env` module)

```
_add_variable_or_fallback('SAGE_ETC',        opj(SAGE_LOCAL, 'etc'))
```

This also will have a clearer failure mode -- instead of leaving an unsubstituted $SAGE_LOCAL in a string if that variable is not set for some reason, an error will be raised.



---

Comment by jhpalmieri created at 2017-08-31 22:22:06

I think the variable substitution scheme was introduced in #13432. I've asked there about its rationale: I don't want to remove this without trying to understand why it was introduced in the first place.

In the mean time, I have a branch which makes the change from strings to variables: `'$VAR' --> VAR`.


---

Comment by jhpalmieri created at 2017-08-31 22:33:16

New commits:


---

Comment by jhpalmieri created at 2017-09-01 00:38:58

This branch passes doctests for me, but I want to wait to set it to "needs_review" for some feedback from the participants at #13432.


---

Comment by jdemeyer created at 2017-09-01 12:31:09

Potential conflict with #21535.


---

Comment by jhpalmieri created at 2017-09-01 14:40:44

Replying to [comment:5 jdemeyer]:
> Potential conflict with #21535.

Okay, it should be easy to rebase. I will wait until #21535 has settled into a stable state (and also to see if there are objections to this ticket as a whole).


---

Comment by embray created at 2019-01-18 12:34:38

I don't think I ever saw the original version of this, but it would be superseded now by #27040 (which accomplishes the same goal).


---

Comment by embray created at 2019-01-18 12:34:38

Resolution: duplicate
