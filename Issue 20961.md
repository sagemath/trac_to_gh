# Issue 20961: fast_callable for domain=ComplexField(...)

Issue created by migration from Trac.

Original creator: nbruin

Original creation time: 2016-08-10 05:31:17

CC:  robertwb

We currently don't have a fast callable interpreter that is specialized for ComplexField. The obvious candidate is to base one on the mpc library (although sage's [ComplexNumber](ComplexNumber) is not based on mpc!!)


---

Comment by leif created at 2016-08-10 08:42:13

There are a few copy-paste left-overs in comments (RR, mpfr instead of CC, mpc).

The library order in `# distutils: libraries =` is wrong, and I don't think you need GMP there.  But it seems redundant anyway, when you're importing from `sage.libs.{mpfr,mpc}`.
----
New commits:


---

Comment by leif created at 2016-08-10 08:43:56

(Trac madness, I didn't set the commit, it was already there.)


---

Comment by leif created at 2016-08-10 12:18:01

Replying to [comment:2 leif]:
> The library order in `# distutils: libraries =` is wrong, and I don't think you need GMP there.
> 
> But it seems redundant anyway, when you're importing from `sage.libs.{mpfr,mpc}`.

It _seemed_; just noticed both `mpfr.pxd` and `mpc.pxd` still lack `# distutils:` directives.


---

Comment by git created at 2016-08-10 16:27:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nbruin created at 2016-08-10 16:30:34

I think it works now! Timing improvements are signficant but not spectacular.


---

Comment by nbruin created at 2016-08-10 16:30:34

Changing status from new to needs_review.


---

Comment by leif created at 2016-08-10 16:59:31

Could you give [your] application examples?


---

Comment by nbruin created at 2016-08-10 18:20:49

Replying to [comment:7 leif]:
> Could you give [your] application examples?

The main application would be computing the periods of algebraic Riemann surfaces. You end up with a lot of newton iterations on complex-valued polynomials to compute analytic continuations, in order to compute integrals numerically. Convincing examples require extensive code (this is functionality that I intend to contribute).

So, the simplest example is perhaps newton iteration?

```
def newton_iterate(f,z,w0):
    """ Approximate a value w such that f(z,w)=0, using Newton iteration starting at w0"""
    CC=w0.parent()
    R=f.parent()
    F=fast_callable(f,domain=CC)
    dF=fast_callable(f.derivative(R.1),domain=CC)
    delta=-F(z,w0)/dF(z,w0)
    Ndelta=delta.norm()
    w0+=delta
    while True:
        new_delta=-F(z,w0)/dF(z,w0)
        Nnew_delta=new_delta.norm()
        if Nnew_delta == 0 or Nnew_delta >= Ndelta: return w0
        delta=new_delta
        Ndelta=Nnew_delta
        w0+=delta
    
sage: R.<x,y>=QQ[]
sage: f=y^2-x^3-x-1
sage: CC=ComplexField(1000)
sage: %timeit newton_iterate(f,CC(1,1),CC(1.2,1.2))
1000 loops, best of 3: 1.21 ms per loop
```



---

Comment by nbruin created at 2016-08-15 22:51:19

CCing Robert Bradshaw, on the off chance that he's still capable/willing to do ticket reviews (I think he's one of the few who has worked on fast_callable). Any other reviewer should be fine too.


---

Comment by git created at 2017-06-06 16:28:26

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2017-06-06 19:57:13

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2017-06-06 20:01:08

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by nbruin created at 2017-06-06 20:02:50

Updated to fit with new layout of interpreters. Ready for merge.


---

Comment by nbruin created at 2017-06-06 20:09:13

Changing keywords from "" to "sd86.5".


---

Comment by git created at 2017-06-06 20:41:33

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2017-06-06 22:04:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aly.deines created at 2017-06-06 22:10:10

Changing status from needs_review to positive_review.


---

Comment by aly.deines created at 2017-06-06 22:10:10

Thanks for adding the doctests.

I'm seeing a bit of a speed up when I use this.  Nice!


---

Comment by vbraun created at 2017-06-15 23:10:06

Resolution: fixed
