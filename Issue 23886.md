# Issue 23886: Some changes to _echelon_in_place_classical to improve the speed

Issue created by migration from Trac.

Original creator: tscrim

Original creation time: 2017-10-30 08:21:59

We can get faster echelon forms by

- Directly calling the foo_c implementations instead of the Python foo methods.
- Not retesting if certain entires are 0.


---

Comment by tscrim created at 2017-10-30 08:43:20

With this branch:

```
sage: for _ in range(10):
....:     M = matrix({(2000-i,i): 1/i for i in range(1,2000,1)}, sparse=True)
....:     %time M.echelonize()
CPU times: user 112 ms, sys: 0 ns, total: 112 ms
Wall time: 81 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 81 ms
CPU times: user 84 ms, sys: 0 ns, total: 84 ms
Wall time: 81.5 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 79.2 ms
CPU times: user 84 ms, sys: 0 ns, total: 84 ms
Wall time: 81.1 ms
CPU times: user 84 ms, sys: 0 ns, total: 84 ms
Wall time: 82.6 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 80.6 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 81 ms
CPU times: user 84 ms, sys: 0 ns, total: 84 ms
Wall time: 80.5 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 80.6 ms
```

versus before

```
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 78.4 ms
CPU times: user 76 ms, sys: 0 ns, total: 76 ms
Wall time: 78.3 ms
CPU times: user 76 ms, sys: 0 ns, total: 76 ms
Wall time: 78.7 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 78.5 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 78 ms
CPU times: user 76 ms, sys: 0 ns, total: 76 ms
Wall time: 77.9 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 79.5 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 78.6 ms
CPU times: user 76 ms, sys: 0 ns, total: 76 ms
Wall time: 78.1 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 79.6 ms
```

I am confused. Admittedly my example is artificial because it was trying to demonstrate how checking if an entry was 0 twice was going to be bad. Removing 3 did not change the timings. I would have thought skipping checking if certain entries were 0 would have a speed gain at the cost of some minor code duplication. Maybe this ticket can just be closed or recycled...
----
New commits:
