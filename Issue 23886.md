# Issue 23886: Some changes to _echelon_in_place_classical to improve the speed

archive/issues_023886.json:
```json
{
    "body": "We can get faster echelon forms by\n\n- Directly calling the foo_c implementations instead of the Python foo methods.\n- Not retesting if certain entires are 0.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24123\n\n",
    "created_at": "2017-10-30T08:21:59Z",
    "labels": [
        "component: performance"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Some changes to _echelon_in_place_classical to improve the speed",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23886",
    "user": "https://github.com/tscrim"
}
```
We can get faster echelon forms by

- Directly calling the foo_c implementations instead of the Python foo methods.
- Not retesting if certain entires are 0.

Issue created by migration from https://trac.sagemath.org/ticket/24123





---

archive/issue_comments_334432.json:
```json
{
    "body": "With this branch:\n\n```\nsage: for _ in range(10):\n....:     M = matrix({(2000-i,i): 1/i for i in range(1,2000,1)}, sparse=True)\n....:     %time M.echelonize()\nCPU times: user 112 ms, sys: 0 ns, total: 112 ms\nWall time: 81 ms\nCPU times: user 80 ms, sys: 0 ns, total: 80 ms\nWall time: 81 ms\nCPU times: user 84 ms, sys: 0 ns, total: 84 ms\nWall time: 81.5 ms\nCPU times: user 80 ms, sys: 0 ns, total: 80 ms\nWall time: 79.2 ms\nCPU times: user 84 ms, sys: 0 ns, total: 84 ms\nWall time: 81.1 ms\nCPU times: user 84 ms, sys: 0 ns, total: 84 ms\nWall time: 82.6 ms\nCPU times: user 80 ms, sys: 0 ns, total: 80 ms\nWall time: 80.6 ms\nCPU times: user 80 ms, sys: 0 ns, total: 80 ms\nWall time: 81 ms\nCPU times: user 84 ms, sys: 0 ns, total: 84 ms\nWall time: 80.5 ms\nCPU times: user 80 ms, sys: 0 ns, total: 80 ms\nWall time: 80.6 ms\n```\n\nversus before\n\n```\nCPU times: user 80 ms, sys: 0 ns, total: 80 ms\nWall time: 78.4 ms\nCPU times: user 76 ms, sys: 0 ns, total: 76 ms\nWall time: 78.3 ms\nCPU times: user 76 ms, sys: 0 ns, total: 76 ms\nWall time: 78.7 ms\nCPU times: user 80 ms, sys: 0 ns, total: 80 ms\nWall time: 78.5 ms\nCPU times: user 80 ms, sys: 0 ns, total: 80 ms\nWall time: 78 ms\nCPU times: user 76 ms, sys: 0 ns, total: 76 ms\nWall time: 77.9 ms\nCPU times: user 80 ms, sys: 0 ns, total: 80 ms\nWall time: 79.5 ms\nCPU times: user 80 ms, sys: 0 ns, total: 80 ms\nWall time: 78.6 ms\nCPU times: user 76 ms, sys: 0 ns, total: 76 ms\nWall time: 78.1 ms\nCPU times: user 80 ms, sys: 0 ns, total: 80 ms\nWall time: 79.6 ms\n```\n\nI am confused. Admittedly my example is artificial because it was trying to demonstrate how checking if an entry was 0 twice was going to be bad. Removing 3 did not change the timings. I would have thought skipping checking if certain entries were 0 would have a speed gain at the cost of some minor code duplication. Maybe this ticket can just be closed or recycled...\n----\nNew commits:",
    "created_at": "2017-10-30T08:43:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23886#issuecomment-334432",
    "user": "https://github.com/tscrim"
}
```

With this branch:

```
sage: for _ in range(10):
....:     M = matrix({(2000-i,i): 1/i for i in range(1,2000,1)}, sparse=True)
....:     %time M.echelonize()
CPU times: user 112 ms, sys: 0 ns, total: 112 ms
Wall time: 81 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 81 ms
CPU times: user 84 ms, sys: 0 ns, total: 84 ms
Wall time: 81.5 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 79.2 ms
CPU times: user 84 ms, sys: 0 ns, total: 84 ms
Wall time: 81.1 ms
CPU times: user 84 ms, sys: 0 ns, total: 84 ms
Wall time: 82.6 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 80.6 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 81 ms
CPU times: user 84 ms, sys: 0 ns, total: 84 ms
Wall time: 80.5 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 80.6 ms
```

versus before

```
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 78.4 ms
CPU times: user 76 ms, sys: 0 ns, total: 76 ms
Wall time: 78.3 ms
CPU times: user 76 ms, sys: 0 ns, total: 76 ms
Wall time: 78.7 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 78.5 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 78 ms
CPU times: user 76 ms, sys: 0 ns, total: 76 ms
Wall time: 77.9 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 79.5 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 78.6 ms
CPU times: user 76 ms, sys: 0 ns, total: 76 ms
Wall time: 78.1 ms
CPU times: user 80 ms, sys: 0 ns, total: 80 ms
Wall time: 79.6 ms
```

I am confused. Admittedly my example is artificial because it was trying to demonstrate how checking if an entry was 0 twice was going to be bad. Removing 3 did not change the timings. I would have thought skipping checking if certain entries were 0 would have a speed gain at the cost of some minor code duplication. Maybe this ticket can just be closed or recycled...
----
New commits:
