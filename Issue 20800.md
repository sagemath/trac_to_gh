# Issue 20800: Polyhedron.integral_points() fails for non-rational polytopes

Issue created by migration from https://trac.sagemath.org/ticket/21037

Original creator: mkoeppe

Original creation time: 2016-07-17 14:48:13

CC:  tscrim novoselt dimpase vdelecroix vbraun jdemeyer


```
    sage: P = Polyhedron(vertices=((0, 0), (17,3))) + 1/1000*polytopes.regular_polygon(5)
    TypeError: int() argument must be a string or a number, not 'AlgebraicReal'
```

(This is an irrational polytope with a small bounding box. Sage should be able to enumerate it easily using the `rectangular_box_points` method.)

Also, the method for integer point enumeration using triangulation and Smith form (a simple implementation of normaliz's method (see #20885 comment:6) in `simplex_points` is limited to lattice polytopes. Normaliz is much faster and has an implementation for rational (non-lattice) polytopes. A generalization to include the case of semi-rational polytopes (i.e., possibly irrational translations of lattice polytopes) could be valuable; example:

```
    Polyhedron(vertices=((0, 0), (1743,3134))) + 1/1000*vector(AA, [AA(sqrt(5)), AA(sqrt(5))])
```



---

Comment by tscrim created at 2016-07-17 23:08:59

Changing status from new to needs_review.


---

Comment by tscrim created at 2016-07-17 23:08:59

Just not enough error catching.
----
New commits:


---

Comment by git created at 2016-07-17 23:11:15

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2016-07-17 23:19:31

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2016-07-17 23:19:31

Thanks for fixing this!
I've moved the other item to #21041.


---

Comment by vbraun created at 2016-07-18 20:39:21

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-07-18 20:39:21


```
sage -t --long src/sage/geometry/integral_points.pyx
**********************************************************************
File "src/sage/geometry/integral_points.pyx", line 539, in sage.geometry.integral_points.?
Failed example:
    alarm(0.5); P.integral_points()
Expected:
    Traceback (most recent call last):
    ...
    AlarmInterrupt
Got:
    Exception cysignals.signals.AlarmInterrupt: AlarmInterrupt() in 'sage.geometry.integral_points.InequalityCollection.are_satisfied' ignored
    ((-5, -8, -10, -15, -12, -9, -6, -3),
     (-3, -5, -6, -9, -7, -5, -3, -1),
     (-1, -3, -3, -5, -4, -3, -2, -1),
     (-1, -2, -2, -3, -2, -1, 0, 0))
**********************************************************************
1 item had failures:
   1 of  51 in sage.geometry.integral_points.?
    [170 tests, 1 failure, 51.33 s]
```



---

Comment by tscrim created at 2016-07-18 20:44:43

IIRC, I also got that error sporadically when I was testing #18029 as well, but I don't seem to get that on develop. Jeroen, any ideas?


---

Comment by vbraun created at 2016-07-19 06:44:45

yes, the error is coming from #18029


---

Comment by jdemeyer created at 2016-07-19 06:57:17

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2016-07-19 23:12:53

Resolution: fixed
