# Issue 30678: Three.js: Upgrade to r122

Issue created by migration from https://trac.sagemath.org/ticket/30915

Original creator: paulmasson

Original creation time: 2020-11-15 01:05:23

CC:  @jcamp0x2a fbissey mkoeppe charpent enriqueartal

Keywords: threejs




---

Comment by paulmasson created at 2020-11-15 01:07:18

Joshua, should only need to do `make build` to test this. Downloading the file should be automatic.
----
New commits:


---

Comment by paulmasson created at 2020-11-15 01:07:18

Changing status from new to needs_review.


---

Comment by paulmasson created at 2020-11-15 04:27:18

Changing status from needs_review to needs_work.


---

Comment by @jcamp0x2a created at 2020-11-15 04:43:54

`make build` appears to have downloaded and extracted the files successfully. All the right stuff (OrbitControls and the "fat" line classes) seem to appear in the `three.min.js` file extracted into `local/share/threejs/build` and running a diff on it against the script I built from your repo produces no output, so it looks good.

Of course, the HTML plots produced are still looking for `OrbitControls.js` and/or directing to mrdoob's repo on the CDN, but that's going to be a separate ticket?


---

Comment by paulmasson created at 2020-11-15 04:50:54

Replying to [comment:5 gh-jcamp0x2a]:

> Of course, the HTML plots produced are still looking for `OrbitControls.js` and/or directing to mrdoob's repo on the CDN, but that's going to be a separate ticket?

No, I overlooked that before meeting a friend for dinner. Will fix tomorrow, but my friend pointed out another development: Mr.doob [reversed](https://github.com/mrdoob/three.js/issues/20455#issuecomment-706954770) himself and won’t be deprecating `examples/js` this year. I think I’m still in favor of this custom build rather than assembling a tarball because the entire process is smoother and the transition will happen at some point anyway. Feedback is welcome.


---

Comment by @jcamp0x2a created at 2020-11-15 05:05:40

Replying to [comment:6 paulmasson]:
> I think I’m still in favor of this custom build rather than assembling a tarball because the entire process is smoother and the transition will happen at some point anyway. Feedback is welcome. 

I would agree. It also allows everything to be bundled up into a single javascript file instead of having to include OrbitControls and now all the line stuff separately. So I think it's a positive change even if `examples/js` were never deprecated.


---

Comment by git created at 2020-11-20 23:49:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by paulmasson created at 2020-11-20 23:53:17

Changing status from needs_work to needs_review.


---

Comment by paulmasson created at 2020-11-20 23:55:26

The new commit updates the link generated internally, both for online and offline use. I changed the name of the internal function to recognize this. Doctests pass on the two modified files.

Matthias, part of the reason I wanted the repository moved to the SageMath organization is that the online links must point to my personal repository on the CDN. If someone creates notebooks with these changes in place for online use, they may fail to work in the future when the repository is moved. If you're fine with that possibility, then we can procede with the upgrade.

Joshua, before testing this ticket again let's hear back from Matthais.


---

Comment by mkoeppe created at 2020-11-21 00:05:49

Makes sense. Am I understanding correctly that `jsdelivr.net` refers to specific tags here, so when you update the repository, the old versions stick around and can continue to be referred to by plots that were generated earlier?


---

Comment by paulmasson created at 2020-11-21 01:05:17

Replying to [comment:11 mkoeppe]:
> Makes sense. Am I understanding correctly that `jsdelivr.net` refers to specific tags here, so when you update the repository, the old versions stick around and can continue to be referred to by plots that were generated earlier?
Once a file is in the CDN it is always available for future use and is indeed referenced by tag. According to the [documentation](https://www.jsdelivr.com/features#gh) the files remain even when a repository is deleted, so presumably it can handle movement of the repository between organizations. If you want us to proceed with the current setup then we can do that without too much worry after all.


---

Comment by mkoeppe created at 2020-11-21 01:15:46

Thanks. And for the offline mode - does it make sense to make several versions available in SAGE_LOCAL?


---

Comment by mkoeppe created at 2020-11-21 01:30:16

Also, does the offline mode depend at all on the symbolic link `threejs` that is installed in `$SAGE_LOCAL/share/jupyter/nbextensions`?

(My guess is that it does not and we can remove this symbolic link. At least that's what I gather from a comment in #30476 - it seems that threejs offline graphics also works with system jupyter notebook, which does not have that symbolic link.)


---

Comment by paulmasson created at 2020-11-21 01:41:02

Replying to [comment:13 mkoeppe]:
> Thanks. And for the offline mode - does it make sense to make several versions available in SAGE_LOCAL?
No, it does not. The Three.js template is specifically tailored to the release currently in use. Mr. Doob sometimes breaks things. Backwards compatibility is not assured.


---

Comment by paulmasson created at 2020-11-21 01:47:18

Replying to [comment:14 mkoeppe]:
> Also, does the offline mode depend at all on the symbolic link `threejs` that is installed in `$SAGE_LOCAL/share/jupyter/nbextensions`?
The system Jupyter notebook needs to find the local files for our Three.js viewer to work. As far as I know the symbolic link is how that happens. If you have a better idea in mind for letting the notebook know where the files are, then go for it. I'm still not clear on this question.


---

Comment by mkoeppe created at 2020-11-21 02:43:41

Replying to [comment:16 paulmasson]:
> Replying to [comment:14 mkoeppe]:
> > Also, does the offline mode depend at all on the symbolic link `threejs` that is installed in `$SAGE_LOCAL/share/jupyter/nbextensions`?
> The system Jupyter notebook needs to find the local files for our Three.js viewer to work. As far as I know the symbolic link is how that happens. If you have a better idea in mind for letting the notebook know where the files are, then go for it. I'm still not clear on this question.

This seems to contradict what `@`charpent reported in #30476 regarding offline threejs in the system jupyter notebook.
`@`charpent, `@`enriqueartal, could you help clarify this?


---

Comment by @jcamp0x2a created at 2020-11-21 02:46:54

Replying to [comment:15 paulmasson]:
> Replying to [comment:13 mkoeppe]:
> > Thanks. And for the offline mode - does it make sense to make several versions available in SAGE_LOCAL?
> No, it does not. The Three.js template is specifically tailored to the release currently in use. Mr. Doob sometimes breaks things. Backwards compatibility is not assured.

Hmm... perhaps it would be better to link the offline plots to a specific version.

For example, suppose I generate an offline plot using the template that works for r117. The plot links to `/home/joshua/sage/local/share/threejs/build/three.min.js`. Some time in the future I upgrade [SageMath](SageMath) in-place. (Do normal users do that?) That old plot is now linking to three.js r122 despite the template it was generated from only being guaranteed to work with r117. Suddenly the plot may no longer work.

That's not an issue for the Jupyter notebook since it's a "live" environment and you can always just re-run the cell to get an up-to-date plot. It's also not an issue for the CDN scripts since those are tied to specific versions.

Although even if we fixed this, it'd still be fragile in that moving/deleting [SageMath](SageMath) would also break old plots. To make a fully self-contained and isolated offline plot would probably require including the content of `three.min.js` inline instead of linking, but I imagine that might run afoul of the license.


---

Comment by mkoeppe created at 2020-11-21 02:49:10

In any case, so that we can make progress here, I have forked the repo at https://github.com/sagemath/threejs-sage


---

Comment by mkoeppe created at 2020-11-21 02:53:18

Replying to [comment:18 gh-jcamp0x2a]:
> Replying to [comment:15 paulmasson]:
> > Replying to [comment:13 mkoeppe]:
> > > Thanks. And for the offline mode - does it make sense to make several versions available in SAGE_LOCAL?
> > No, it does not. The Three.js template is specifically tailored to the release currently in use. Mr. Doob sometimes breaks things. Backwards compatibility is not assured.
> 
> Hmm... perhaps it would be better to link the offline plots to a specific version.
> 
> For example, suppose I generate an offline plot using the template that works for r117. The plot links to `/home/joshua/sage/local/share/threejs/build/three.min.js`. Some time in the future I upgrade [SageMath](SageMath) in-place. (Do normal users do that?)

Yes, that's a typical operation.

>  That old plot is now linking to three.js r122 despite the template it was generated from only being guaranteed to work with r117. Suddenly the plot may no longer work.

Right.  So let's please do a versioned installation scheme to address this issue. Basically, upgrades should not break operation of older things.

> That's not an issue for the Jupyter notebook since it's a "live" environment and you can always just re-run the cell to get an up-to-date plot.

Well, but isn't it an important part of the point of the notebook format that the outputs are also stored?

> It's also not an issue for the CDN scripts since those are tied to specific versions.
> 
> Although even if we fixed this, it'd still be fragile in that moving/deleting [SageMath](SageMath) would also break old plots. 

(Moving the Sage tree is not supported.)


---

Comment by mkoeppe created at 2020-11-21 02:56:06

Replying to [comment:20 mkoeppe]:
> >  That old plot is now linking to three.js r122 despite the template it was generated from only being guaranteed to work with r117. Suddenly the plot may no longer work.
> 
> Right.  So let's please do a versioned installation scheme to address this issue. Basically, upgrades should not break operation of older things.

Again the key use case to consider is to have one ("system") installation of the Jupyter notebook or JupyterLab, which the user uses to access multiple installations of different versions of the Sage kernel.


---

Comment by mkoeppe created at 2020-11-21 03:09:03

Replying to [comment:18 gh-jcamp0x2a]:
> To make a fully self-contained and isolated offline plot would probably require including the content of `three.min.js` inline instead of linking, 

Sounds like this would be a useful option.

> but I imagine that might run afoul of the license.

Does a more restrictive license than MIT apply? https://github.com/sagemath/threejs-sage/blob/main/LICENSE


---

Comment by @jcamp0x2a created at 2020-11-21 03:45:44

Replying to [comment:22 mkoeppe]:
> Replying to [comment:18 gh-jcamp0x2a]:
> > To make a fully self-contained and isolated offline plot would probably require including the content of `three.min.js` inline instead of linking, 
> 
> Sounds like this would be a useful option.
> 
> > but I imagine that might run afoul of the license.
> 
> Does a more restrictive license than MIT apply? https://github.com/sagemath/threejs-sage/blob/main/LICENSE
> 

No, I don't believe so. I was thinking it was LGPL for some reason and how all that static vs. dynamic linking stuff would work with javascript. Sorry :)


---

Comment by paulmasson created at 2020-11-21 23:53:55

Replying to [comment:19 mkoeppe]:
> In any case, so that we can make progress here, I have forked the repo at https://github.com/sagemath/threejs-sage
Matthias, to avoid any confusion with the repository, please delete your fork and I will initiate the transfer to the SageMath organization.


---

Comment by enriqueartal created at 2020-11-22 00:09:54

I just checked again. With online=False, it uses the local files of threejs. What I did is to link the threejs folder of the sage installation in /usr/local/sage/local/share/jupyter/nbextensions/

The threejs version is r-117

Replying to [comment:17 mkoeppe]:
> Replying to [comment:16 paulmasson]:
> > Replying to [comment:14 mkoeppe]:
> > > Also, does the offline mode depend at all on the symbolic link `threejs` that is installed in `$SAGE_LOCAL/share/jupyter/nbextensions`?
> > The system Jupyter notebook needs to find the local files for our Three.js viewer to work. As far as I know the symbolic link is how that happens. If you have a better idea in mind for letting the notebook know where the files are, then go for it. I'm still not clear on this question.
> 
> This seems to contradict what `@`charpent reported in #30476 regarding offline threejs in the system jupyter notebook.
> `@`charpent, `@`enriqueartal, could you help clarify this?
> 
>


---

Comment by mkoeppe created at 2020-11-22 00:15:48

Replying to [comment:24 paulmasson]:
> Replying to [comment:19 mkoeppe]:
> > In any case, so that we can make progress here, I have forked the repo at https://github.com/sagemath/threejs-sage
> Matthias, to avoid any confusion with the repository, please delete your fork and I will initiate the transfer to the SageMath organization.

It seems the confusion has already happened. I created this fork for you because you requested a repository in the sagemath github organization. If you find that this is not suitable for what you have in mind, try explaining.


---

Comment by mkoeppe created at 2020-11-22 00:16:58

Replying to [comment:25 enriqueartal]:
> I just checked again. With online=False, it uses the local files of threejs. What I did is to link the threejs folder of the sage installation in /usr/local/sage/local/share/jupyter/nbextensions/

Can you please check whether it works without this symlink?


---

Comment by paulmasson created at 2020-11-22 00:32:00

Replying to [comment:26 mkoeppe]:
> Replying to [comment:24 paulmasson]:
> > Replying to [comment:19 mkoeppe]:
> > > In any case, so that we can make progress here, I have forked the repo at https://github.com/sagemath/threejs-sage
> > Matthias, to avoid any confusion with the repository, please delete your fork and I will initiate the transfer to the SageMath organization.
> 
> It seems the confusion has already happened. I created this fork for you because you requested a repository in the sagemath github organization. If you find that this is not suitable for what you have in mind, try explaining.
Sorry! When I requested the repository, I was planning to do all the work there from the start. Then I went ahead and made my own to get things going. At this point, I could work in your fork and delete mine and [GitHub](GitHub) should then treat yours as the new master repository. Rather than rely on that happening, I think it will be cleaner for me to transfer mine to you, so that there is no possibility of a mix up. I need to initiate the transfer and was waiting for you to be ready for it.


---

Comment by mkoeppe created at 2020-11-22 00:37:14

In git, there is no notion of a master repository.  The repository I created for you is indistinguishable from yours: It has the same branches and tags.


---

Comment by paulmasson created at 2020-11-22 00:40:36

Replying to [comment:18 gh-jcamp0x2a]:

> Although even if we fixed this, it'd still be fragile in that moving/deleting [SageMath](SageMath) would also break old plots. To make a fully self-contained and isolated offline plot would probably require including the content of `three.min.js` inline instead of linking, but I imagine that might run afoul of the license.
Joshua, I always envisioned the viewer as being used to share graphics on the web, since that's how I work and that's the future. I have yet to hear of anyone having encountered this problem. While I appreciate your concerns, I think we can let this lie until someone actually complains about it.

And you could deal with the license by just copying it into the body of the document along with the library's code.


---

Comment by paulmasson created at 2020-11-22 00:43:18

Replying to [comment:29 mkoeppe]:
> In git, there is no notion of a master repository.  The repository I created for you is indistinguishable from yours: It has the same branches and tags.
It does for the moment, but it won't update itself automatically. Someone would need to do that. And I used the wrong term: GitHub uses [parent](https://docs.github.com/en/free-pro-team`@`latest/github/collaborating-with-issues-and-pull-requests/what-happens-to-forks-when-a-repository-is-deleted-or-changes-visibility). Please read the section on deleting public repositories.


---

Comment by mkoeppe created at 2020-11-22 00:47:21

Replying to [comment:31 paulmasson]:
> Replying to [comment:29 mkoeppe]:
> > In git, there is no notion of a master repository.  The repository I created for you is indistinguishable from yours: It has the same branches and tags.
> It does for the moment, but it won't update itself automatically.

Yes, obviously you would need to start using the repository.

But fine, I can redo it. Give me admin access to your repo and I'll transfer it.


---

Comment by paulmasson created at 2020-11-22 00:51:24

Replying to [comment:21 mkoeppe]:
> Replying to [comment:20 mkoeppe]:
> > >  That old plot is now linking to three.js r122 despite the template it was generated from only being guaranteed to work with r117. Suddenly the plot may no longer work.
> > 
> > Right.  So let's please do a versioned installation scheme to address this issue. Basically, upgrades should not break operation of older things.
> 
> Again the key use case to consider is to have one ("system") installation of the Jupyter notebook or JupyterLab, which the user uses to access multiple installations of different versions of the Sage kernel.
>
Matthias, the viewer was designed from the beginning for use in Sage only, so for me it's part of the kernel. Are you thinking of having us split it off completely? Otherwise the version of Three.js will track with the version of Sage.


---

Comment by mkoeppe created at 2020-11-22 00:56:37

Replying to [comment:33 paulmasson]:
> Replying to [comment:21 mkoeppe]:
> > Again the key use case to consider is to have one ("system") installation of the Jupyter notebook or JupyterLab, which the user uses to access multiple installations of different versions of the Sage kernel.
> >
> Matthias, the viewer was designed from the beginning for use in Sage only, so for me it's part of the kernel. Are you thinking of having us split it off completely? Otherwise the version of Three.js will track with the version of Sage.

The use case I am describing uses one system Jupyter installation ("frontend") that the user uses to access several kernels, including several Sage kernels installed in different directories.  The frontend may not come from Sage at all, but we need to find a way so that each of the Sage kernels fully works, and that includes the 3d graphics.


---

Comment by mkoeppe created at 2020-11-22 01:01:04

(In #30476 we are putting together documentation on how to configure such a setup.)


---

Comment by mkoeppe created at 2020-11-22 01:53:36

Replying to [comment:32 mkoeppe]:
> Give me admin access to your repo and I'll transfer it.
I received and accepted the repo invite but will need additional permissions to make the transfer.


---

Comment by paulmasson created at 2020-11-22 02:35:32

Replying to [comment:36 mkoeppe]:
> Replying to [comment:32 mkoeppe]:
> > Give me admin access to your repo and I'll transfer it.
> I received and accepted the repo invite but will need additional permissions to make the transfer.
I don't see any options other than just inviting you. Do you not have access to !Settings/Options at this point?


---

Comment by mkoeppe created at 2020-11-22 02:46:03

Replying to [comment:37 paulmasson]:
> Do you not have access to !Settings/Options at this point?
No


---

Comment by paulmasson created at 2020-11-22 03:04:14

Replying to [comment:38 mkoeppe]:
> Replying to [comment:37 paulmasson]:
> > Do you not have access to !Settings/Options at this point?
> No
Then we'll go with Plan B: since the fork is still there, I'll work in it and delete mine at some point. Good to go. Thanks!


---

Comment by enriqueartal created at 2020-11-22 10:06:29

Replying to [comment:27 mkoeppe]:
> Replying to [comment:25 enriqueartal]:
> > I just checked again. With online=False, it uses the local files of threejs. What I did is to link the threejs folder of the sage installation in /usr/local/sage/local/share/jupyter/nbextensions/
> 
> Can you please check whether it works without this symlink?

I tried this time inspecting. Without the symlink and with online=False, it works since it looks for the threejs files locally and fails, and then it tries online successfully. I rechecked with the symlink and it finds the local files. 

BTW, with jupyterhub, it uses internet pages, not local ones even with the symlink


---

Comment by mkoeppe created at 2020-11-22 18:16:03

Replying to [comment:40 enriqueartal]:
> Replying to [comment:27 mkoeppe]:
> > Replying to [comment:25 enriqueartal]:
> > > I just checked again. With online=False, it uses the local files of threejs. What I did is to link the threejs folder of the sage installation in /usr/local/sage/local/share/jupyter/nbextensions/
> > 
> > Can you please check whether it works without this symlink?
> 
> I tried this time inspecting. 

Thanks a lot for investigating!

> Without the symlink and with online=False, it works since it looks for the threejs files locally 

By "locally", do you mean through the notebook webserver?

> and fails, and then it tries online successfully. I rechecked with the symlink and it finds the local files. 

Thanks.

> BTW, with jupyterhub, it uses internet pages, not local ones even with the symlink

Sounds like we would need to install files using `jupyter labextension` to support this.


---

Comment by git created at 2020-11-22 22:15:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by paulmasson created at 2020-11-22 22:16:37

Joshua, ready for another review. Thanks!


---

Comment by mkoeppe created at 2020-11-22 22:42:28

Replying to [comment:34 mkoeppe]:
> Replying to [comment:33 paulmasson]:
> > Matthias, the viewer was designed from the beginning for use in Sage only, so for me it's part of the kernel. Are you thinking of having us split it off completely? Otherwise the version of Three.js will track with the version of Sage.
> 
> The use case I am describing uses one system Jupyter installation ("frontend") that the user uses to access several kernels, including several Sage kernels installed in different directories.  The frontend may not come from Sage at all, but we need to find a way so that each of the Sage kernels fully works, and that includes the 3d graphics.

Paul, can we try to make progress on this question please? Is what I am describing here clear now? I'll be happy to explain more if necessary.


---

Comment by git created at 2020-11-22 23:30:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by paulmasson created at 2020-11-23 00:47:07

Replying to [comment:44 mkoeppe]:
> Replying to [comment:34 mkoeppe]:
> > Replying to [comment:33 paulmasson]:
> > > Matthias, the viewer was designed from the beginning for use in Sage only, so for me it's part of the kernel. Are you thinking of having us split it off completely? Otherwise the version of Three.js will track with the version of Sage.
> > 
> > The use case I am describing uses one system Jupyter installation ("frontend") that the user uses to access several kernels, including several Sage kernels installed in different directories.  The frontend may not come from Sage at all, but we need to find a way so that each of the Sage kernels fully works, and that includes the 3d graphics.
> 
> Paul, can we try to make progress on this question please? Is what I am describing here clear now? I'll be happy to explain more if necessary.
Unfortunately I am not clear as to what you expect of me regarding this. The Sage files have to be somewhere and the notebook needs to now how to find them. If that is already necessary, why won't the notebook know how to find the Three.js file? Are you planning on eliminating `src/sage/ext_data`?

Maybe this should be a separate ticket. This one is really just to upgrade the version with the existing structure already in place.


---

Comment by mkoeppe created at 2020-11-23 01:15:34

Replying to [comment:46 paulmasson]:
> Are you planning on eliminating `src/sage/ext_data`?

No. The issue is about `share/jupyter/nbextensions/threejs` and the fact that there will be several unrelated copies of that.

Here is an example.
- Let's say system jupyter is installed in `/usr`, so the notebook server is accessing `/usr/share/jupyter/nbextensions`.  
- Sage-9.x may be installed in `/home/x/sage-9.x/local/` and may need threejs r122.
- Sage-9.y may be installed in `/home/x/sage-9.y/local/` and may need threejs r155.
- Let's say r122 and r155 are mutually incompatible.

As `@`enriqueartal has reported above, our offline threejs graphics needs `/usr/share/jupyter/nbextensions/threejs/`. But the system does not provide it -- it must come from Sage.
If we create a symlink `/usr/share/jupyter/nbextensions/threejs -> /home/x/sage-9.x/local/share/jupyter/nbextensions/threejs`, then Sage 9.x will work with the system jupyter notebook; but Sage 9.y will not.

Do you agree?

So this means that we need a versioned installation scheme. 
The details of this installation scheme is what I am trying to discuss with you, in particular because it is certainly related to that new repository.


---

Comment by @jcamp0x2a created at 2020-11-24 17:03:32

Replying to [comment:43 paulmasson]:
> Joshua, ready for another review. Thanks!

Hi Paul, I found a failing doctest in `display_manager.py` due to the CDN URL change. I hope you don't mind, but I took the liberty of pushing a fix for it. I also went ahead and modified it to read from that new `version` file instead of relying on the `REVISION=` stuff, and I also renamed a few more occurrences of "scripts" to "script" as you had done in your commit.

If you are okay with the additional changes, I think you or I could mark it as positive review.


---

Comment by @jcamp0x2a created at 2020-11-24 17:05:38

Replying to [comment:47 mkoeppe]:
> So this means that we need a versioned installation scheme. 
> The details of this installation scheme is what I am trying to discuss with you, in particular because it is certainly related to that new repository.
> 

Including the `three.min.js` inline for offline use (whether jupyter or command line) seems like it would clear up this headache for three.js at least. No more local file paths.

I'd like to get this ticket merged as-is so I can make some headway on my "fat" lines branch. So perhaps a follow-up ticket?


---

Comment by paulmasson created at 2020-11-27 21:46:43

Replying to [comment:47 mkoeppe]:
> Replying to [comment:46 paulmasson]:
> > Are you planning on eliminating `src/sage/ext_data`?
> 
> No. The issue is about `share/jupyter/nbextensions/threejs` and the fact that there will be several unrelated copies of that.
> 
> Here is an example.
> - Let's say system jupyter is installed in `/usr`, so the notebook server is accessing `/usr/share/jupyter/nbextensions`.  
> - Sage-9.x may be installed in `/home/x/sage-9.x/local/` and may need threejs r122.
> - Sage-9.y may be installed in `/home/x/sage-9.y/local/` and may need threejs r155.
> - Let's say r122 and r155 are mutually incompatible.
> 
> As `@`enriqueartal has reported above, our offline threejs graphics needs `/usr/share/jupyter/nbextensions/threejs/`. But the system does not provide it -- it must come from Sage.
> If we create a symlink `/usr/share/jupyter/nbextensions/threejs -> /home/x/sage-9.x/local/share/jupyter/nbextensions/threejs`, then Sage 9.x will work with the system jupyter notebook; but Sage 9.y will not.
> 
> Do you agree?
> 
> So this means that we need a versioned installation scheme. 
> The details of this installation scheme is what I am trying to discuss with you, in particular because it is certainly related to that new repository.
> 
Moving discussion to #30972


---

Comment by paulmasson created at 2020-11-27 21:47:27

Replying to [comment:48 gh-jcamp0x2a]:
> Replying to [comment:43 paulmasson]:
> > Joshua, ready for another review. Thanks!
> 
> Hi Paul, I found a failing doctest in `display_manager.py` due to the CDN URL change. I hope you don't mind, but I took the liberty of pushing a fix for it. I also went ahead and modified it to read from that new `version` file instead of relying on the `REVISION=` stuff, and I also renamed a few more occurrences of "scripts" to "script" as you had done in your commit.
> 
> If you are okay with the additional changes, I think you or I could mark it as positive review.
LGTM


---

Comment by paulmasson created at 2020-11-27 21:47:27

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-11-28 01:43:59

Public methods such as `threejs_offline_scripts` should not be renamed without deprecation


---

Comment by mkoeppe created at 2020-11-28 01:43:59

Changing status from positive_review to needs_work.


---

Comment by paulmasson created at 2020-11-28 02:01:26

Joshua, would you just revert the method name? It's only used internally and I no longer care if the script name doesn't match the output.


---

Comment by git created at 2020-11-28 02:28:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @jcamp0x2a created at 2020-11-28 02:30:52

Replying to [comment:53 paulmasson]:
> Joshua, would you just revert the method name? It's only used internally and I no longer care if the script name doesn't match the output.

Done. Did a quick sanity check and it still runs without issue in all four combinations of command-line/jupyter and online/offline.


---

Comment by @jcamp0x2a created at 2020-11-28 02:30:52

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2020-11-28 02:40:41

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-11-28 18:50:52

Joshua, by the way, have you tested if the offline mode works with JupyterLab too?


---

Comment by @jcamp0x2a created at 2020-11-28 19:55:35

Replying to [comment:57 mkoeppe]:
> Joshua, by the way, have you tested if the offline mode works with JupyterLab too?

Yes, sorry, that's actually what I meant by "jupyter". I've been using it in preference to the traditional notebook lately. I've gone back and tested with the traditional notebook and it works fine as well.

Oh, and I'm going to try to spend some time later today looking at your #30972.


---

Comment by mkoeppe created at 2020-11-28 20:04:27

Replying to [comment:58 gh-jcamp0x2a]:
> Replying to [comment:57 mkoeppe]:
> > Joshua, by the way, have you tested if the offline mode works with JupyterLab too?
> 
> Yes, sorry, that's actually what I meant by "jupyter". I've been using it in preference to the traditional notebook lately. I've gone back and tested with the traditional notebook and it works fine as well.

Great, thanks, I was not sure whether the JupyterLab server also serves the `/nbextensions` path.


---

Comment by vbraun created at 2020-12-05 22:13:11

Resolution: fixed
