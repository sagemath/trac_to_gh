# Issue 30678: Three.js: Upgrade to r122

archive/issues_030678.json:
```json
{
    "body": "CC:  @jcamp0x2a @kiwifb @mkoeppe @EmmanuelCharpentier @enriqueartal\n\nKeywords: threejs\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/30915\n\n",
    "created_at": "2020-11-15T01:05:23Z",
    "labels": [
        "graphics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Three.js: Upgrade to r122",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30678",
    "user": "@paulmasson"
}
```
CC:  @jcamp0x2a @kiwifb @mkoeppe @EmmanuelCharpentier @enriqueartal

Keywords: threejs



Issue created by migration from https://trac.sagemath.org/ticket/30915





---

archive/issue_comments_438623.json:
```json
{
    "body": "Joshua, should only need to do `make build` to test this. Downloading the file should be automatic.\n----\nNew commits:",
    "created_at": "2020-11-15T01:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438623",
    "user": "@paulmasson"
}
```

Joshua, should only need to do `make build` to test this. Downloading the file should be automatic.
----
New commits:



---

archive/issue_comments_438624.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-15T01:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438624",
    "user": "@paulmasson"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_438625.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-11-15T04:27:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438625",
    "user": "@paulmasson"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_438626.json:
```json
{
    "body": "`make build` appears to have downloaded and extracted the files successfully. All the right stuff (OrbitControls and the \"fat\" line classes) seem to appear in the `three.min.js` file extracted into `local/share/threejs/build` and running a diff on it against the script I built from your repo produces no output, so it looks good.\n\nOf course, the HTML plots produced are still looking for `OrbitControls.js` and/or directing to mrdoob's repo on the CDN, but that's going to be a separate ticket?",
    "created_at": "2020-11-15T04:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438626",
    "user": "@jcamp0x2a"
}
```

`make build` appears to have downloaded and extracted the files successfully. All the right stuff (OrbitControls and the "fat" line classes) seem to appear in the `three.min.js` file extracted into `local/share/threejs/build` and running a diff on it against the script I built from your repo produces no output, so it looks good.

Of course, the HTML plots produced are still looking for `OrbitControls.js` and/or directing to mrdoob's repo on the CDN, but that's going to be a separate ticket?



---

archive/issue_comments_438627.json:
```json
{
    "body": "Replying to [comment:5 gh-jcamp0x2a]:\n\n> Of course, the HTML plots produced are still looking for `OrbitControls.js` and/or directing to mrdoob's repo on the CDN, but that's going to be a separate ticket?\n\nNo, I overlooked that before meeting a friend for dinner. Will fix tomorrow, but my friend pointed out another development: Mr.doob [reversed](https://github.com/mrdoob/three.js/issues/20455#issuecomment-706954770) himself and won\u2019t be deprecating `examples/js` this year. I think I\u2019m still in favor of this custom build rather than assembling a tarball because the entire process is smoother and the transition will happen at some point anyway. Feedback is welcome.",
    "created_at": "2020-11-15T04:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438627",
    "user": "@paulmasson"
}
```

Replying to [comment:5 gh-jcamp0x2a]:

> Of course, the HTML plots produced are still looking for `OrbitControls.js` and/or directing to mrdoob's repo on the CDN, but that's going to be a separate ticket?

No, I overlooked that before meeting a friend for dinner. Will fix tomorrow, but my friend pointed out another development: Mr.doob [reversed](https://github.com/mrdoob/three.js/issues/20455#issuecomment-706954770) himself and won’t be deprecating `examples/js` this year. I think I’m still in favor of this custom build rather than assembling a tarball because the entire process is smoother and the transition will happen at some point anyway. Feedback is welcome.



---

archive/issue_comments_438628.json:
```json
{
    "body": "Replying to [comment:6 paulmasson]:\n> I think I\u2019m still in favor of this custom build rather than assembling a tarball because the entire process is smoother and the transition will happen at some point anyway. Feedback is welcome. \n\nI would agree. It also allows everything to be bundled up into a single javascript file instead of having to include OrbitControls and now all the line stuff separately. So I think it's a positive change even if `examples/js` were never deprecated.",
    "created_at": "2020-11-15T05:05:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438628",
    "user": "@jcamp0x2a"
}
```

Replying to [comment:6 paulmasson]:
> I think I’m still in favor of this custom build rather than assembling a tarball because the entire process is smoother and the transition will happen at some point anyway. Feedback is welcome. 

I would agree. It also allows everything to be bundled up into a single javascript file instead of having to include OrbitControls and now all the line stuff separately. So I think it's a positive change even if `examples/js` were never deprecated.



---

archive/issue_comments_438629.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-20T23:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438629",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438630.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-11-20T23:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438630",
    "user": "@paulmasson"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_438631.json:
```json
{
    "body": "The new commit updates the link generated internally, both for online and offline use. I changed the name of the internal function to recognize this. Doctests pass on the two modified files.\n\nMatthias, part of the reason I wanted the repository moved to the SageMath organization is that the online links must point to my personal repository on the CDN. If someone creates notebooks with these changes in place for online use, they may fail to work in the future when the repository is moved. If you're fine with that possibility, then we can procede with the upgrade.\n\nJoshua, before testing this ticket again let's hear back from Matthais.",
    "created_at": "2020-11-20T23:55:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438631",
    "user": "@paulmasson"
}
```

The new commit updates the link generated internally, both for online and offline use. I changed the name of the internal function to recognize this. Doctests pass on the two modified files.

Matthias, part of the reason I wanted the repository moved to the SageMath organization is that the online links must point to my personal repository on the CDN. If someone creates notebooks with these changes in place for online use, they may fail to work in the future when the repository is moved. If you're fine with that possibility, then we can procede with the upgrade.

Joshua, before testing this ticket again let's hear back from Matthais.



---

archive/issue_comments_438632.json:
```json
{
    "body": "Makes sense. Am I understanding correctly that `jsdelivr.net` refers to specific tags here, so when you update the repository, the old versions stick around and can continue to be referred to by plots that were generated earlier?",
    "created_at": "2020-11-21T00:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438632",
    "user": "@mkoeppe"
}
```

Makes sense. Am I understanding correctly that `jsdelivr.net` refers to specific tags here, so when you update the repository, the old versions stick around and can continue to be referred to by plots that were generated earlier?



---

archive/issue_comments_438633.json:
```json
{
    "body": "Replying to [comment:11 mkoeppe]:\n> Makes sense. Am I understanding correctly that `jsdelivr.net` refers to specific tags here, so when you update the repository, the old versions stick around and can continue to be referred to by plots that were generated earlier?\nOnce a file is in the CDN it is always available for future use and is indeed referenced by tag. According to the [documentation](https://www.jsdelivr.com/features#gh) the files remain even when a repository is deleted, so presumably it can handle movement of the repository between organizations. If you want us to proceed with the current setup then we can do that without too much worry after all.",
    "created_at": "2020-11-21T01:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438633",
    "user": "@paulmasson"
}
```

Replying to [comment:11 mkoeppe]:
> Makes sense. Am I understanding correctly that `jsdelivr.net` refers to specific tags here, so when you update the repository, the old versions stick around and can continue to be referred to by plots that were generated earlier?
Once a file is in the CDN it is always available for future use and is indeed referenced by tag. According to the [documentation](https://www.jsdelivr.com/features#gh) the files remain even when a repository is deleted, so presumably it can handle movement of the repository between organizations. If you want us to proceed with the current setup then we can do that without too much worry after all.



---

archive/issue_comments_438634.json:
```json
{
    "body": "Thanks. And for the offline mode - does it make sense to make several versions available in SAGE_LOCAL?",
    "created_at": "2020-11-21T01:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438634",
    "user": "@mkoeppe"
}
```

Thanks. And for the offline mode - does it make sense to make several versions available in SAGE_LOCAL?



---

archive/issue_comments_438635.json:
```json
{
    "body": "Also, does the offline mode depend at all on the symbolic link `threejs` that is installed in `$SAGE_LOCAL/share/jupyter/nbextensions`?\n\n(My guess is that it does not and we can remove this symbolic link. At least that's what I gather from a comment in #30476 - it seems that threejs offline graphics also works with system jupyter notebook, which does not have that symbolic link.)",
    "created_at": "2020-11-21T01:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438635",
    "user": "@mkoeppe"
}
```

Also, does the offline mode depend at all on the symbolic link `threejs` that is installed in `$SAGE_LOCAL/share/jupyter/nbextensions`?

(My guess is that it does not and we can remove this symbolic link. At least that's what I gather from a comment in #30476 - it seems that threejs offline graphics also works with system jupyter notebook, which does not have that symbolic link.)



---

archive/issue_comments_438636.json:
```json
{
    "body": "Replying to [comment:13 mkoeppe]:\n> Thanks. And for the offline mode - does it make sense to make several versions available in SAGE_LOCAL?\nNo, it does not. The Three.js template is specifically tailored to the release currently in use. Mr. Doob sometimes breaks things. Backwards compatibility is not assured.",
    "created_at": "2020-11-21T01:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438636",
    "user": "@paulmasson"
}
```

Replying to [comment:13 mkoeppe]:
> Thanks. And for the offline mode - does it make sense to make several versions available in SAGE_LOCAL?
No, it does not. The Three.js template is specifically tailored to the release currently in use. Mr. Doob sometimes breaks things. Backwards compatibility is not assured.



---

archive/issue_comments_438637.json:
```json
{
    "body": "Replying to [comment:14 mkoeppe]:\n> Also, does the offline mode depend at all on the symbolic link `threejs` that is installed in `$SAGE_LOCAL/share/jupyter/nbextensions`?\nThe system Jupyter notebook needs to find the local files for our Three.js viewer to work. As far as I know the symbolic link is how that happens. If you have a better idea in mind for letting the notebook know where the files are, then go for it. I'm still not clear on this question.",
    "created_at": "2020-11-21T01:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438637",
    "user": "@paulmasson"
}
```

Replying to [comment:14 mkoeppe]:
> Also, does the offline mode depend at all on the symbolic link `threejs` that is installed in `$SAGE_LOCAL/share/jupyter/nbextensions`?
The system Jupyter notebook needs to find the local files for our Three.js viewer to work. As far as I know the symbolic link is how that happens. If you have a better idea in mind for letting the notebook know where the files are, then go for it. I'm still not clear on this question.



---

archive/issue_comments_438638.json:
```json
{
    "body": "Replying to [comment:16 paulmasson]:\n> Replying to [comment:14 mkoeppe]:\n> > Also, does the offline mode depend at all on the symbolic link `threejs` that is installed in `$SAGE_LOCAL/share/jupyter/nbextensions`?\n> The system Jupyter notebook needs to find the local files for our Three.js viewer to work. As far as I know the symbolic link is how that happens. If you have a better idea in mind for letting the notebook know where the files are, then go for it. I'm still not clear on this question.\n\nThis seems to contradict what `@`charpent reported in #30476 regarding offline threejs in the system jupyter notebook.\n`@`charpent, `@`enriqueartal, could you help clarify this?",
    "created_at": "2020-11-21T02:43:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438638",
    "user": "@mkoeppe"
}
```

Replying to [comment:16 paulmasson]:
> Replying to [comment:14 mkoeppe]:
> > Also, does the offline mode depend at all on the symbolic link `threejs` that is installed in `$SAGE_LOCAL/share/jupyter/nbextensions`?
> The system Jupyter notebook needs to find the local files for our Three.js viewer to work. As far as I know the symbolic link is how that happens. If you have a better idea in mind for letting the notebook know where the files are, then go for it. I'm still not clear on this question.

This seems to contradict what `@`charpent reported in #30476 regarding offline threejs in the system jupyter notebook.
`@`charpent, `@`enriqueartal, could you help clarify this?



---

archive/issue_comments_438639.json:
```json
{
    "body": "Replying to [comment:15 paulmasson]:\n> Replying to [comment:13 mkoeppe]:\n> > Thanks. And for the offline mode - does it make sense to make several versions available in SAGE_LOCAL?\n> No, it does not. The Three.js template is specifically tailored to the release currently in use. Mr. Doob sometimes breaks things. Backwards compatibility is not assured.\n\nHmm... perhaps it would be better to link the offline plots to a specific version.\n\nFor example, suppose I generate an offline plot using the template that works for r117. The plot links to `/home/joshua/sage/local/share/threejs/build/three.min.js`. Some time in the future I upgrade [SageMath](SageMath) in-place. (Do normal users do that?) That old plot is now linking to three.js r122 despite the template it was generated from only being guaranteed to work with r117. Suddenly the plot may no longer work.\n\nThat's not an issue for the Jupyter notebook since it's a \"live\" environment and you can always just re-run the cell to get an up-to-date plot. It's also not an issue for the CDN scripts since those are tied to specific versions.\n\nAlthough even if we fixed this, it'd still be fragile in that moving/deleting [SageMath](SageMath) would also break old plots. To make a fully self-contained and isolated offline plot would probably require including the content of `three.min.js` inline instead of linking, but I imagine that might run afoul of the license.",
    "created_at": "2020-11-21T02:46:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438639",
    "user": "@jcamp0x2a"
}
```

Replying to [comment:15 paulmasson]:
> Replying to [comment:13 mkoeppe]:
> > Thanks. And for the offline mode - does it make sense to make several versions available in SAGE_LOCAL?
> No, it does not. The Three.js template is specifically tailored to the release currently in use. Mr. Doob sometimes breaks things. Backwards compatibility is not assured.

Hmm... perhaps it would be better to link the offline plots to a specific version.

For example, suppose I generate an offline plot using the template that works for r117. The plot links to `/home/joshua/sage/local/share/threejs/build/three.min.js`. Some time in the future I upgrade [SageMath](SageMath) in-place. (Do normal users do that?) That old plot is now linking to three.js r122 despite the template it was generated from only being guaranteed to work with r117. Suddenly the plot may no longer work.

That's not an issue for the Jupyter notebook since it's a "live" environment and you can always just re-run the cell to get an up-to-date plot. It's also not an issue for the CDN scripts since those are tied to specific versions.

Although even if we fixed this, it'd still be fragile in that moving/deleting [SageMath](SageMath) would also break old plots. To make a fully self-contained and isolated offline plot would probably require including the content of `three.min.js` inline instead of linking, but I imagine that might run afoul of the license.



---

archive/issue_comments_438640.json:
```json
{
    "body": "In any case, so that we can make progress here, I have forked the repo at https://github.com/sagemath/threejs-sage",
    "created_at": "2020-11-21T02:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438640",
    "user": "@mkoeppe"
}
```

In any case, so that we can make progress here, I have forked the repo at https://github.com/sagemath/threejs-sage



---

archive/issue_comments_438641.json:
```json
{
    "body": "Replying to [comment:18 gh-jcamp0x2a]:\n> Replying to [comment:15 paulmasson]:\n> > Replying to [comment:13 mkoeppe]:\n> > > Thanks. And for the offline mode - does it make sense to make several versions available in SAGE_LOCAL?\n> > No, it does not. The Three.js template is specifically tailored to the release currently in use. Mr. Doob sometimes breaks things. Backwards compatibility is not assured.\n> \n> Hmm... perhaps it would be better to link the offline plots to a specific version.\n> \n> For example, suppose I generate an offline plot using the template that works for r117. The plot links to `/home/joshua/sage/local/share/threejs/build/three.min.js`. Some time in the future I upgrade [SageMath](SageMath) in-place. (Do normal users do that?)\n\nYes, that's a typical operation.\n\n>  That old plot is now linking to three.js r122 despite the template it was generated from only being guaranteed to work with r117. Suddenly the plot may no longer work.\n\nRight.  So let's please do a versioned installation scheme to address this issue. Basically, upgrades should not break operation of older things.\n\n> That's not an issue for the Jupyter notebook since it's a \"live\" environment and you can always just re-run the cell to get an up-to-date plot.\n\nWell, but isn't it an important part of the point of the notebook format that the outputs are also stored?\n\n> It's also not an issue for the CDN scripts since those are tied to specific versions.\n> \n> Although even if we fixed this, it'd still be fragile in that moving/deleting [SageMath](SageMath) would also break old plots. \n\n(Moving the Sage tree is not supported.)",
    "created_at": "2020-11-21T02:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438641",
    "user": "@mkoeppe"
}
```

Replying to [comment:18 gh-jcamp0x2a]:
> Replying to [comment:15 paulmasson]:
> > Replying to [comment:13 mkoeppe]:
> > > Thanks. And for the offline mode - does it make sense to make several versions available in SAGE_LOCAL?
> > No, it does not. The Three.js template is specifically tailored to the release currently in use. Mr. Doob sometimes breaks things. Backwards compatibility is not assured.
> 
> Hmm... perhaps it would be better to link the offline plots to a specific version.
> 
> For example, suppose I generate an offline plot using the template that works for r117. The plot links to `/home/joshua/sage/local/share/threejs/build/three.min.js`. Some time in the future I upgrade [SageMath](SageMath) in-place. (Do normal users do that?)

Yes, that's a typical operation.

>  That old plot is now linking to three.js r122 despite the template it was generated from only being guaranteed to work with r117. Suddenly the plot may no longer work.

Right.  So let's please do a versioned installation scheme to address this issue. Basically, upgrades should not break operation of older things.

> That's not an issue for the Jupyter notebook since it's a "live" environment and you can always just re-run the cell to get an up-to-date plot.

Well, but isn't it an important part of the point of the notebook format that the outputs are also stored?

> It's also not an issue for the CDN scripts since those are tied to specific versions.
> 
> Although even if we fixed this, it'd still be fragile in that moving/deleting [SageMath](SageMath) would also break old plots. 

(Moving the Sage tree is not supported.)



---

archive/issue_comments_438642.json:
```json
{
    "body": "Replying to [comment:20 mkoeppe]:\n> >  That old plot is now linking to three.js r122 despite the template it was generated from only being guaranteed to work with r117. Suddenly the plot may no longer work.\n> \n> Right.  So let's please do a versioned installation scheme to address this issue. Basically, upgrades should not break operation of older things.\n\nAgain the key use case to consider is to have one (\"system\") installation of the Jupyter notebook or JupyterLab, which the user uses to access multiple installations of different versions of the Sage kernel.",
    "created_at": "2020-11-21T02:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438642",
    "user": "@mkoeppe"
}
```

Replying to [comment:20 mkoeppe]:
> >  That old plot is now linking to three.js r122 despite the template it was generated from only being guaranteed to work with r117. Suddenly the plot may no longer work.
> 
> Right.  So let's please do a versioned installation scheme to address this issue. Basically, upgrades should not break operation of older things.

Again the key use case to consider is to have one ("system") installation of the Jupyter notebook or JupyterLab, which the user uses to access multiple installations of different versions of the Sage kernel.



---

archive/issue_comments_438643.json:
```json
{
    "body": "Replying to [comment:18 gh-jcamp0x2a]:\n> To make a fully self-contained and isolated offline plot would probably require including the content of `three.min.js` inline instead of linking, \n\nSounds like this would be a useful option.\n\n> but I imagine that might run afoul of the license.\n\nDoes a more restrictive license than MIT apply? https://github.com/sagemath/threejs-sage/blob/main/LICENSE",
    "created_at": "2020-11-21T03:09:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438643",
    "user": "@mkoeppe"
}
```

Replying to [comment:18 gh-jcamp0x2a]:
> To make a fully self-contained and isolated offline plot would probably require including the content of `three.min.js` inline instead of linking, 

Sounds like this would be a useful option.

> but I imagine that might run afoul of the license.

Does a more restrictive license than MIT apply? https://github.com/sagemath/threejs-sage/blob/main/LICENSE



---

archive/issue_comments_438644.json:
```json
{
    "body": "Replying to [comment:22 mkoeppe]:\n> Replying to [comment:18 gh-jcamp0x2a]:\n> > To make a fully self-contained and isolated offline plot would probably require including the content of `three.min.js` inline instead of linking, \n> \n> Sounds like this would be a useful option.\n> \n> > but I imagine that might run afoul of the license.\n> \n> Does a more restrictive license than MIT apply? https://github.com/sagemath/threejs-sage/blob/main/LICENSE\n> \n\nNo, I don't believe so. I was thinking it was LGPL for some reason and how all that static vs. dynamic linking stuff would work with javascript. Sorry :)",
    "created_at": "2020-11-21T03:45:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438644",
    "user": "@jcamp0x2a"
}
```

Replying to [comment:22 mkoeppe]:
> Replying to [comment:18 gh-jcamp0x2a]:
> > To make a fully self-contained and isolated offline plot would probably require including the content of `three.min.js` inline instead of linking, 
> 
> Sounds like this would be a useful option.
> 
> > but I imagine that might run afoul of the license.
> 
> Does a more restrictive license than MIT apply? https://github.com/sagemath/threejs-sage/blob/main/LICENSE
> 

No, I don't believe so. I was thinking it was LGPL for some reason and how all that static vs. dynamic linking stuff would work with javascript. Sorry :)



---

archive/issue_comments_438645.json:
```json
{
    "body": "Replying to [comment:19 mkoeppe]:\n> In any case, so that we can make progress here, I have forked the repo at https://github.com/sagemath/threejs-sage\nMatthias, to avoid any confusion with the repository, please delete your fork and I will initiate the transfer to the SageMath organization.",
    "created_at": "2020-11-21T23:53:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438645",
    "user": "@paulmasson"
}
```

Replying to [comment:19 mkoeppe]:
> In any case, so that we can make progress here, I have forked the repo at https://github.com/sagemath/threejs-sage
Matthias, to avoid any confusion with the repository, please delete your fork and I will initiate the transfer to the SageMath organization.



---

archive/issue_comments_438646.json:
```json
{
    "body": "I just checked again. With online=False, it uses the local files of threejs. What I did is to link the threejs folder of the sage installation in /usr/local/sage/local/share/jupyter/nbextensions/\n\nThe threejs version is r-117\n\nReplying to [comment:17 mkoeppe]:\n> Replying to [comment:16 paulmasson]:\n> > Replying to [comment:14 mkoeppe]:\n> > > Also, does the offline mode depend at all on the symbolic link `threejs` that is installed in `$SAGE_LOCAL/share/jupyter/nbextensions`?\n> > The system Jupyter notebook needs to find the local files for our Three.js viewer to work. As far as I know the symbolic link is how that happens. If you have a better idea in mind for letting the notebook know where the files are, then go for it. I'm still not clear on this question.\n> \n> This seems to contradict what `@`charpent reported in #30476 regarding offline threejs in the system jupyter notebook.\n> `@`charpent, `@`enriqueartal, could you help clarify this?\n> \n>",
    "created_at": "2020-11-22T00:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438646",
    "user": "@enriqueartal"
}
```

I just checked again. With online=False, it uses the local files of threejs. What I did is to link the threejs folder of the sage installation in /usr/local/sage/local/share/jupyter/nbextensions/

The threejs version is r-117

Replying to [comment:17 mkoeppe]:
> Replying to [comment:16 paulmasson]:
> > Replying to [comment:14 mkoeppe]:
> > > Also, does the offline mode depend at all on the symbolic link `threejs` that is installed in `$SAGE_LOCAL/share/jupyter/nbextensions`?
> > The system Jupyter notebook needs to find the local files for our Three.js viewer to work. As far as I know the symbolic link is how that happens. If you have a better idea in mind for letting the notebook know where the files are, then go for it. I'm still not clear on this question.
> 
> This seems to contradict what `@`charpent reported in #30476 regarding offline threejs in the system jupyter notebook.
> `@`charpent, `@`enriqueartal, could you help clarify this?
> 
>



---

archive/issue_comments_438647.json:
```json
{
    "body": "Replying to [comment:24 paulmasson]:\n> Replying to [comment:19 mkoeppe]:\n> > In any case, so that we can make progress here, I have forked the repo at https://github.com/sagemath/threejs-sage\n> Matthias, to avoid any confusion with the repository, please delete your fork and I will initiate the transfer to the SageMath organization.\n\nIt seems the confusion has already happened. I created this fork for you because you requested a repository in the sagemath github organization. If you find that this is not suitable for what you have in mind, try explaining.",
    "created_at": "2020-11-22T00:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438647",
    "user": "@mkoeppe"
}
```

Replying to [comment:24 paulmasson]:
> Replying to [comment:19 mkoeppe]:
> > In any case, so that we can make progress here, I have forked the repo at https://github.com/sagemath/threejs-sage
> Matthias, to avoid any confusion with the repository, please delete your fork and I will initiate the transfer to the SageMath organization.

It seems the confusion has already happened. I created this fork for you because you requested a repository in the sagemath github organization. If you find that this is not suitable for what you have in mind, try explaining.



---

archive/issue_comments_438648.json:
```json
{
    "body": "Replying to [comment:25 enriqueartal]:\n> I just checked again. With online=False, it uses the local files of threejs. What I did is to link the threejs folder of the sage installation in /usr/local/sage/local/share/jupyter/nbextensions/\n\nCan you please check whether it works without this symlink?",
    "created_at": "2020-11-22T00:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438648",
    "user": "@mkoeppe"
}
```

Replying to [comment:25 enriqueartal]:
> I just checked again. With online=False, it uses the local files of threejs. What I did is to link the threejs folder of the sage installation in /usr/local/sage/local/share/jupyter/nbextensions/

Can you please check whether it works without this symlink?



---

archive/issue_comments_438649.json:
```json
{
    "body": "Replying to [comment:26 mkoeppe]:\n> Replying to [comment:24 paulmasson]:\n> > Replying to [comment:19 mkoeppe]:\n> > > In any case, so that we can make progress here, I have forked the repo at https://github.com/sagemath/threejs-sage\n> > Matthias, to avoid any confusion with the repository, please delete your fork and I will initiate the transfer to the SageMath organization.\n> \n> It seems the confusion has already happened. I created this fork for you because you requested a repository in the sagemath github organization. If you find that this is not suitable for what you have in mind, try explaining.\nSorry! When I requested the repository, I was planning to do all the work there from the start. Then I went ahead and made my own to get things going. At this point, I could work in your fork and delete mine and [GitHub](GitHub) should then treat yours as the new master repository. Rather than rely on that happening, I think it will be cleaner for me to transfer mine to you, so that there is no possibility of a mix up. I need to initiate the transfer and was waiting for you to be ready for it.",
    "created_at": "2020-11-22T00:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438649",
    "user": "@paulmasson"
}
```

Replying to [comment:26 mkoeppe]:
> Replying to [comment:24 paulmasson]:
> > Replying to [comment:19 mkoeppe]:
> > > In any case, so that we can make progress here, I have forked the repo at https://github.com/sagemath/threejs-sage
> > Matthias, to avoid any confusion with the repository, please delete your fork and I will initiate the transfer to the SageMath organization.
> 
> It seems the confusion has already happened. I created this fork for you because you requested a repository in the sagemath github organization. If you find that this is not suitable for what you have in mind, try explaining.
Sorry! When I requested the repository, I was planning to do all the work there from the start. Then I went ahead and made my own to get things going. At this point, I could work in your fork and delete mine and [GitHub](GitHub) should then treat yours as the new master repository. Rather than rely on that happening, I think it will be cleaner for me to transfer mine to you, so that there is no possibility of a mix up. I need to initiate the transfer and was waiting for you to be ready for it.



---

archive/issue_comments_438650.json:
```json
{
    "body": "In git, there is no notion of a master repository.  The repository I created for you is indistinguishable from yours: It has the same branches and tags.",
    "created_at": "2020-11-22T00:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438650",
    "user": "@mkoeppe"
}
```

In git, there is no notion of a master repository.  The repository I created for you is indistinguishable from yours: It has the same branches and tags.



---

archive/issue_comments_438651.json:
```json
{
    "body": "Replying to [comment:18 gh-jcamp0x2a]:\n\n> Although even if we fixed this, it'd still be fragile in that moving/deleting [SageMath](SageMath) would also break old plots. To make a fully self-contained and isolated offline plot would probably require including the content of `three.min.js` inline instead of linking, but I imagine that might run afoul of the license.\nJoshua, I always envisioned the viewer as being used to share graphics on the web, since that's how I work and that's the future. I have yet to hear of anyone having encountered this problem. While I appreciate your concerns, I think we can let this lie until someone actually complains about it.\n\nAnd you could deal with the license by just copying it into the body of the document along with the library's code.",
    "created_at": "2020-11-22T00:40:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438651",
    "user": "@paulmasson"
}
```

Replying to [comment:18 gh-jcamp0x2a]:

> Although even if we fixed this, it'd still be fragile in that moving/deleting [SageMath](SageMath) would also break old plots. To make a fully self-contained and isolated offline plot would probably require including the content of `three.min.js` inline instead of linking, but I imagine that might run afoul of the license.
Joshua, I always envisioned the viewer as being used to share graphics on the web, since that's how I work and that's the future. I have yet to hear of anyone having encountered this problem. While I appreciate your concerns, I think we can let this lie until someone actually complains about it.

And you could deal with the license by just copying it into the body of the document along with the library's code.



---

archive/issue_comments_438652.json:
```json
{
    "body": "Replying to [comment:29 mkoeppe]:\n> In git, there is no notion of a master repository.  The repository I created for you is indistinguishable from yours: It has the same branches and tags.\nIt does for the moment, but it won't update itself automatically. Someone would need to do that. And I used the wrong term: GitHub uses [parent](https://docs.github.com/en/free-pro-team`@`latest/github/collaborating-with-issues-and-pull-requests/what-happens-to-forks-when-a-repository-is-deleted-or-changes-visibility). Please read the section on deleting public repositories.",
    "created_at": "2020-11-22T00:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438652",
    "user": "@paulmasson"
}
```

Replying to [comment:29 mkoeppe]:
> In git, there is no notion of a master repository.  The repository I created for you is indistinguishable from yours: It has the same branches and tags.
It does for the moment, but it won't update itself automatically. Someone would need to do that. And I used the wrong term: GitHub uses [parent](https://docs.github.com/en/free-pro-team`@`latest/github/collaborating-with-issues-and-pull-requests/what-happens-to-forks-when-a-repository-is-deleted-or-changes-visibility). Please read the section on deleting public repositories.



---

archive/issue_comments_438653.json:
```json
{
    "body": "Replying to [comment:31 paulmasson]:\n> Replying to [comment:29 mkoeppe]:\n> > In git, there is no notion of a master repository.  The repository I created for you is indistinguishable from yours: It has the same branches and tags.\n> It does for the moment, but it won't update itself automatically.\n\nYes, obviously you would need to start using the repository.\n\nBut fine, I can redo it. Give me admin access to your repo and I'll transfer it.",
    "created_at": "2020-11-22T00:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438653",
    "user": "@mkoeppe"
}
```

Replying to [comment:31 paulmasson]:
> Replying to [comment:29 mkoeppe]:
> > In git, there is no notion of a master repository.  The repository I created for you is indistinguishable from yours: It has the same branches and tags.
> It does for the moment, but it won't update itself automatically.

Yes, obviously you would need to start using the repository.

But fine, I can redo it. Give me admin access to your repo and I'll transfer it.



---

archive/issue_comments_438654.json:
```json
{
    "body": "Replying to [comment:21 mkoeppe]:\n> Replying to [comment:20 mkoeppe]:\n> > >  That old plot is now linking to three.js r122 despite the template it was generated from only being guaranteed to work with r117. Suddenly the plot may no longer work.\n> > \n> > Right.  So let's please do a versioned installation scheme to address this issue. Basically, upgrades should not break operation of older things.\n> \n> Again the key use case to consider is to have one (\"system\") installation of the Jupyter notebook or JupyterLab, which the user uses to access multiple installations of different versions of the Sage kernel.\n>\nMatthias, the viewer was designed from the beginning for use in Sage only, so for me it's part of the kernel. Are you thinking of having us split it off completely? Otherwise the version of Three.js will track with the version of Sage.",
    "created_at": "2020-11-22T00:51:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438654",
    "user": "@paulmasson"
}
```

Replying to [comment:21 mkoeppe]:
> Replying to [comment:20 mkoeppe]:
> > >  That old plot is now linking to three.js r122 despite the template it was generated from only being guaranteed to work with r117. Suddenly the plot may no longer work.
> > 
> > Right.  So let's please do a versioned installation scheme to address this issue. Basically, upgrades should not break operation of older things.
> 
> Again the key use case to consider is to have one ("system") installation of the Jupyter notebook or JupyterLab, which the user uses to access multiple installations of different versions of the Sage kernel.
>
Matthias, the viewer was designed from the beginning for use in Sage only, so for me it's part of the kernel. Are you thinking of having us split it off completely? Otherwise the version of Three.js will track with the version of Sage.



---

archive/issue_comments_438655.json:
```json
{
    "body": "Replying to [comment:33 paulmasson]:\n> Replying to [comment:21 mkoeppe]:\n> > Again the key use case to consider is to have one (\"system\") installation of the Jupyter notebook or JupyterLab, which the user uses to access multiple installations of different versions of the Sage kernel.\n> >\n> Matthias, the viewer was designed from the beginning for use in Sage only, so for me it's part of the kernel. Are you thinking of having us split it off completely? Otherwise the version of Three.js will track with the version of Sage.\n\nThe use case I am describing uses one system Jupyter installation (\"frontend\") that the user uses to access several kernels, including several Sage kernels installed in different directories.  The frontend may not come from Sage at all, but we need to find a way so that each of the Sage kernels fully works, and that includes the 3d graphics.",
    "created_at": "2020-11-22T00:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438655",
    "user": "@mkoeppe"
}
```

Replying to [comment:33 paulmasson]:
> Replying to [comment:21 mkoeppe]:
> > Again the key use case to consider is to have one ("system") installation of the Jupyter notebook or JupyterLab, which the user uses to access multiple installations of different versions of the Sage kernel.
> >
> Matthias, the viewer was designed from the beginning for use in Sage only, so for me it's part of the kernel. Are you thinking of having us split it off completely? Otherwise the version of Three.js will track with the version of Sage.

The use case I am describing uses one system Jupyter installation ("frontend") that the user uses to access several kernels, including several Sage kernels installed in different directories.  The frontend may not come from Sage at all, but we need to find a way so that each of the Sage kernels fully works, and that includes the 3d graphics.



---

archive/issue_comments_438656.json:
```json
{
    "body": "(In #30476 we are putting together documentation on how to configure such a setup.)",
    "created_at": "2020-11-22T01:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438656",
    "user": "@mkoeppe"
}
```

(In #30476 we are putting together documentation on how to configure such a setup.)



---

archive/issue_comments_438657.json:
```json
{
    "body": "Replying to [comment:32 mkoeppe]:\n> Give me admin access to your repo and I'll transfer it.\nI received and accepted the repo invite but will need additional permissions to make the transfer.",
    "created_at": "2020-11-22T01:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438657",
    "user": "@mkoeppe"
}
```

Replying to [comment:32 mkoeppe]:
> Give me admin access to your repo and I'll transfer it.
I received and accepted the repo invite but will need additional permissions to make the transfer.



---

archive/issue_comments_438658.json:
```json
{
    "body": "Replying to [comment:36 mkoeppe]:\n> Replying to [comment:32 mkoeppe]:\n> > Give me admin access to your repo and I'll transfer it.\n> I received and accepted the repo invite but will need additional permissions to make the transfer.\nI don't see any options other than just inviting you. Do you not have access to !Settings/Options at this point?",
    "created_at": "2020-11-22T02:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438658",
    "user": "@paulmasson"
}
```

Replying to [comment:36 mkoeppe]:
> Replying to [comment:32 mkoeppe]:
> > Give me admin access to your repo and I'll transfer it.
> I received and accepted the repo invite but will need additional permissions to make the transfer.
I don't see any options other than just inviting you. Do you not have access to !Settings/Options at this point?



---

archive/issue_comments_438659.json:
```json
{
    "body": "Replying to [comment:37 paulmasson]:\n> Do you not have access to !Settings/Options at this point?\nNo",
    "created_at": "2020-11-22T02:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438659",
    "user": "@mkoeppe"
}
```

Replying to [comment:37 paulmasson]:
> Do you not have access to !Settings/Options at this point?
No



---

archive/issue_comments_438660.json:
```json
{
    "body": "Replying to [comment:38 mkoeppe]:\n> Replying to [comment:37 paulmasson]:\n> > Do you not have access to !Settings/Options at this point?\n> No\nThen we'll go with Plan B: since the fork is still there, I'll work in it and delete mine at some point. Good to go. Thanks!",
    "created_at": "2020-11-22T03:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438660",
    "user": "@paulmasson"
}
```

Replying to [comment:38 mkoeppe]:
> Replying to [comment:37 paulmasson]:
> > Do you not have access to !Settings/Options at this point?
> No
Then we'll go with Plan B: since the fork is still there, I'll work in it and delete mine at some point. Good to go. Thanks!



---

archive/issue_comments_438661.json:
```json
{
    "body": "Replying to [comment:27 mkoeppe]:\n> Replying to [comment:25 enriqueartal]:\n> > I just checked again. With online=False, it uses the local files of threejs. What I did is to link the threejs folder of the sage installation in /usr/local/sage/local/share/jupyter/nbextensions/\n> \n> Can you please check whether it works without this symlink?\n\nI tried this time inspecting. Without the symlink and with online=False, it works since it looks for the threejs files locally and fails, and then it tries online successfully. I rechecked with the symlink and it finds the local files. \n\nBTW, with jupyterhub, it uses internet pages, not local ones even with the symlink",
    "created_at": "2020-11-22T10:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438661",
    "user": "@enriqueartal"
}
```

Replying to [comment:27 mkoeppe]:
> Replying to [comment:25 enriqueartal]:
> > I just checked again. With online=False, it uses the local files of threejs. What I did is to link the threejs folder of the sage installation in /usr/local/sage/local/share/jupyter/nbextensions/
> 
> Can you please check whether it works without this symlink?

I tried this time inspecting. Without the symlink and with online=False, it works since it looks for the threejs files locally and fails, and then it tries online successfully. I rechecked with the symlink and it finds the local files. 

BTW, with jupyterhub, it uses internet pages, not local ones even with the symlink



---

archive/issue_comments_438662.json:
```json
{
    "body": "Replying to [comment:40 enriqueartal]:\n> Replying to [comment:27 mkoeppe]:\n> > Replying to [comment:25 enriqueartal]:\n> > > I just checked again. With online=False, it uses the local files of threejs. What I did is to link the threejs folder of the sage installation in /usr/local/sage/local/share/jupyter/nbextensions/\n> > \n> > Can you please check whether it works without this symlink?\n> \n> I tried this time inspecting. \n\nThanks a lot for investigating!\n\n> Without the symlink and with online=False, it works since it looks for the threejs files locally \n\nBy \"locally\", do you mean through the notebook webserver?\n\n> and fails, and then it tries online successfully. I rechecked with the symlink and it finds the local files. \n\nThanks.\n\n> BTW, with jupyterhub, it uses internet pages, not local ones even with the symlink\n\nSounds like we would need to install files using `jupyter labextension` to support this.",
    "created_at": "2020-11-22T18:16:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438662",
    "user": "@mkoeppe"
}
```

Replying to [comment:40 enriqueartal]:
> Replying to [comment:27 mkoeppe]:
> > Replying to [comment:25 enriqueartal]:
> > > I just checked again. With online=False, it uses the local files of threejs. What I did is to link the threejs folder of the sage installation in /usr/local/sage/local/share/jupyter/nbextensions/
> > 
> > Can you please check whether it works without this symlink?
> 
> I tried this time inspecting. 

Thanks a lot for investigating!

> Without the symlink and with online=False, it works since it looks for the threejs files locally 

By "locally", do you mean through the notebook webserver?

> and fails, and then it tries online successfully. I rechecked with the symlink and it finds the local files. 

Thanks.

> BTW, with jupyterhub, it uses internet pages, not local ones even with the symlink

Sounds like we would need to install files using `jupyter labextension` to support this.



---

archive/issue_comments_438663.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-22T22:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438663",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438664.json:
```json
{
    "body": "Joshua, ready for another review. Thanks!",
    "created_at": "2020-11-22T22:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438664",
    "user": "@paulmasson"
}
```

Joshua, ready for another review. Thanks!



---

archive/issue_comments_438665.json:
```json
{
    "body": "Replying to [comment:34 mkoeppe]:\n> Replying to [comment:33 paulmasson]:\n> > Matthias, the viewer was designed from the beginning for use in Sage only, so for me it's part of the kernel. Are you thinking of having us split it off completely? Otherwise the version of Three.js will track with the version of Sage.\n> \n> The use case I am describing uses one system Jupyter installation (\"frontend\") that the user uses to access several kernels, including several Sage kernels installed in different directories.  The frontend may not come from Sage at all, but we need to find a way so that each of the Sage kernels fully works, and that includes the 3d graphics.\n\nPaul, can we try to make progress on this question please? Is what I am describing here clear now? I'll be happy to explain more if necessary.",
    "created_at": "2020-11-22T22:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438665",
    "user": "@mkoeppe"
}
```

Replying to [comment:34 mkoeppe]:
> Replying to [comment:33 paulmasson]:
> > Matthias, the viewer was designed from the beginning for use in Sage only, so for me it's part of the kernel. Are you thinking of having us split it off completely? Otherwise the version of Three.js will track with the version of Sage.
> 
> The use case I am describing uses one system Jupyter installation ("frontend") that the user uses to access several kernels, including several Sage kernels installed in different directories.  The frontend may not come from Sage at all, but we need to find a way so that each of the Sage kernels fully works, and that includes the 3d graphics.

Paul, can we try to make progress on this question please? Is what I am describing here clear now? I'll be happy to explain more if necessary.



---

archive/issue_comments_438666.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-22T23:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438666",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438667.json:
```json
{
    "body": "Replying to [comment:44 mkoeppe]:\n> Replying to [comment:34 mkoeppe]:\n> > Replying to [comment:33 paulmasson]:\n> > > Matthias, the viewer was designed from the beginning for use in Sage only, so for me it's part of the kernel. Are you thinking of having us split it off completely? Otherwise the version of Three.js will track with the version of Sage.\n> > \n> > The use case I am describing uses one system Jupyter installation (\"frontend\") that the user uses to access several kernels, including several Sage kernels installed in different directories.  The frontend may not come from Sage at all, but we need to find a way so that each of the Sage kernels fully works, and that includes the 3d graphics.\n> \n> Paul, can we try to make progress on this question please? Is what I am describing here clear now? I'll be happy to explain more if necessary.\nUnfortunately I am not clear as to what you expect of me regarding this. The Sage files have to be somewhere and the notebook needs to now how to find them. If that is already necessary, why won't the notebook know how to find the Three.js file? Are you planning on eliminating `src/sage/ext_data`?\n\nMaybe this should be a separate ticket. This one is really just to upgrade the version with the existing structure already in place.",
    "created_at": "2020-11-23T00:47:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438667",
    "user": "@paulmasson"
}
```

Replying to [comment:44 mkoeppe]:
> Replying to [comment:34 mkoeppe]:
> > Replying to [comment:33 paulmasson]:
> > > Matthias, the viewer was designed from the beginning for use in Sage only, so for me it's part of the kernel. Are you thinking of having us split it off completely? Otherwise the version of Three.js will track with the version of Sage.
> > 
> > The use case I am describing uses one system Jupyter installation ("frontend") that the user uses to access several kernels, including several Sage kernels installed in different directories.  The frontend may not come from Sage at all, but we need to find a way so that each of the Sage kernels fully works, and that includes the 3d graphics.
> 
> Paul, can we try to make progress on this question please? Is what I am describing here clear now? I'll be happy to explain more if necessary.
Unfortunately I am not clear as to what you expect of me regarding this. The Sage files have to be somewhere and the notebook needs to now how to find them. If that is already necessary, why won't the notebook know how to find the Three.js file? Are you planning on eliminating `src/sage/ext_data`?

Maybe this should be a separate ticket. This one is really just to upgrade the version with the existing structure already in place.



---

archive/issue_comments_438668.json:
```json
{
    "body": "Replying to [comment:46 paulmasson]:\n> Are you planning on eliminating `src/sage/ext_data`?\n\nNo. The issue is about `share/jupyter/nbextensions/threejs` and the fact that there will be several unrelated copies of that.\n\nHere is an example.\n- Let's say system jupyter is installed in `/usr`, so the notebook server is accessing `/usr/share/jupyter/nbextensions`.  \n- Sage-9.x may be installed in `/home/x/sage-9.x/local/` and may need threejs r122.\n- Sage-9.y may be installed in `/home/x/sage-9.y/local/` and may need threejs r155.\n- Let's say r122 and r155 are mutually incompatible.\n\nAs `@`enriqueartal has reported above, our offline threejs graphics needs `/usr/share/jupyter/nbextensions/threejs/`. But the system does not provide it -- it must come from Sage.\nIf we create a symlink `/usr/share/jupyter/nbextensions/threejs -> /home/x/sage-9.x/local/share/jupyter/nbextensions/threejs`, then Sage 9.x will work with the system jupyter notebook; but Sage 9.y will not.\n\nDo you agree?\n\nSo this means that we need a versioned installation scheme. \nThe details of this installation scheme is what I am trying to discuss with you, in particular because it is certainly related to that new repository.",
    "created_at": "2020-11-23T01:15:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438668",
    "user": "@mkoeppe"
}
```

Replying to [comment:46 paulmasson]:
> Are you planning on eliminating `src/sage/ext_data`?

No. The issue is about `share/jupyter/nbextensions/threejs` and the fact that there will be several unrelated copies of that.

Here is an example.
- Let's say system jupyter is installed in `/usr`, so the notebook server is accessing `/usr/share/jupyter/nbextensions`.  
- Sage-9.x may be installed in `/home/x/sage-9.x/local/` and may need threejs r122.
- Sage-9.y may be installed in `/home/x/sage-9.y/local/` and may need threejs r155.
- Let's say r122 and r155 are mutually incompatible.

As `@`enriqueartal has reported above, our offline threejs graphics needs `/usr/share/jupyter/nbextensions/threejs/`. But the system does not provide it -- it must come from Sage.
If we create a symlink `/usr/share/jupyter/nbextensions/threejs -> /home/x/sage-9.x/local/share/jupyter/nbextensions/threejs`, then Sage 9.x will work with the system jupyter notebook; but Sage 9.y will not.

Do you agree?

So this means that we need a versioned installation scheme. 
The details of this installation scheme is what I am trying to discuss with you, in particular because it is certainly related to that new repository.



---

archive/issue_comments_438669.json:
```json
{
    "body": "Replying to [comment:43 paulmasson]:\n> Joshua, ready for another review. Thanks!\n\nHi Paul, I found a failing doctest in `display_manager.py` due to the CDN URL change. I hope you don't mind, but I took the liberty of pushing a fix for it. I also went ahead and modified it to read from that new `version` file instead of relying on the `REVISION=` stuff, and I also renamed a few more occurrences of \"scripts\" to \"script\" as you had done in your commit.\n\nIf you are okay with the additional changes, I think you or I could mark it as positive review.",
    "created_at": "2020-11-24T17:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438669",
    "user": "@jcamp0x2a"
}
```

Replying to [comment:43 paulmasson]:
> Joshua, ready for another review. Thanks!

Hi Paul, I found a failing doctest in `display_manager.py` due to the CDN URL change. I hope you don't mind, but I took the liberty of pushing a fix for it. I also went ahead and modified it to read from that new `version` file instead of relying on the `REVISION=` stuff, and I also renamed a few more occurrences of "scripts" to "script" as you had done in your commit.

If you are okay with the additional changes, I think you or I could mark it as positive review.



---

archive/issue_comments_438670.json:
```json
{
    "body": "Replying to [comment:47 mkoeppe]:\n> So this means that we need a versioned installation scheme. \n> The details of this installation scheme is what I am trying to discuss with you, in particular because it is certainly related to that new repository.\n> \n\nIncluding the `three.min.js` inline for offline use (whether jupyter or command line) seems like it would clear up this headache for three.js at least. No more local file paths.\n\nI'd like to get this ticket merged as-is so I can make some headway on my \"fat\" lines branch. So perhaps a follow-up ticket?",
    "created_at": "2020-11-24T17:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438670",
    "user": "@jcamp0x2a"
}
```

Replying to [comment:47 mkoeppe]:
> So this means that we need a versioned installation scheme. 
> The details of this installation scheme is what I am trying to discuss with you, in particular because it is certainly related to that new repository.
> 

Including the `three.min.js` inline for offline use (whether jupyter or command line) seems like it would clear up this headache for three.js at least. No more local file paths.

I'd like to get this ticket merged as-is so I can make some headway on my "fat" lines branch. So perhaps a follow-up ticket?



---

archive/issue_comments_438671.json:
```json
{
    "body": "Replying to [comment:47 mkoeppe]:\n> Replying to [comment:46 paulmasson]:\n> > Are you planning on eliminating `src/sage/ext_data`?\n> \n> No. The issue is about `share/jupyter/nbextensions/threejs` and the fact that there will be several unrelated copies of that.\n> \n> Here is an example.\n> - Let's say system jupyter is installed in `/usr`, so the notebook server is accessing `/usr/share/jupyter/nbextensions`.  \n> - Sage-9.x may be installed in `/home/x/sage-9.x/local/` and may need threejs r122.\n> - Sage-9.y may be installed in `/home/x/sage-9.y/local/` and may need threejs r155.\n> - Let's say r122 and r155 are mutually incompatible.\n> \n> As `@`enriqueartal has reported above, our offline threejs graphics needs `/usr/share/jupyter/nbextensions/threejs/`. But the system does not provide it -- it must come from Sage.\n> If we create a symlink `/usr/share/jupyter/nbextensions/threejs -> /home/x/sage-9.x/local/share/jupyter/nbextensions/threejs`, then Sage 9.x will work with the system jupyter notebook; but Sage 9.y will not.\n> \n> Do you agree?\n> \n> So this means that we need a versioned installation scheme. \n> The details of this installation scheme is what I am trying to discuss with you, in particular because it is certainly related to that new repository.\n> \nMoving discussion to #30972",
    "created_at": "2020-11-27T21:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438671",
    "user": "@paulmasson"
}
```

Replying to [comment:47 mkoeppe]:
> Replying to [comment:46 paulmasson]:
> > Are you planning on eliminating `src/sage/ext_data`?
> 
> No. The issue is about `share/jupyter/nbextensions/threejs` and the fact that there will be several unrelated copies of that.
> 
> Here is an example.
> - Let's say system jupyter is installed in `/usr`, so the notebook server is accessing `/usr/share/jupyter/nbextensions`.  
> - Sage-9.x may be installed in `/home/x/sage-9.x/local/` and may need threejs r122.
> - Sage-9.y may be installed in `/home/x/sage-9.y/local/` and may need threejs r155.
> - Let's say r122 and r155 are mutually incompatible.
> 
> As `@`enriqueartal has reported above, our offline threejs graphics needs `/usr/share/jupyter/nbextensions/threejs/`. But the system does not provide it -- it must come from Sage.
> If we create a symlink `/usr/share/jupyter/nbextensions/threejs -> /home/x/sage-9.x/local/share/jupyter/nbextensions/threejs`, then Sage 9.x will work with the system jupyter notebook; but Sage 9.y will not.
> 
> Do you agree?
> 
> So this means that we need a versioned installation scheme. 
> The details of this installation scheme is what I am trying to discuss with you, in particular because it is certainly related to that new repository.
> 
Moving discussion to #30972



---

archive/issue_comments_438672.json:
```json
{
    "body": "Replying to [comment:48 gh-jcamp0x2a]:\n> Replying to [comment:43 paulmasson]:\n> > Joshua, ready for another review. Thanks!\n> \n> Hi Paul, I found a failing doctest in `display_manager.py` due to the CDN URL change. I hope you don't mind, but I took the liberty of pushing a fix for it. I also went ahead and modified it to read from that new `version` file instead of relying on the `REVISION=` stuff, and I also renamed a few more occurrences of \"scripts\" to \"script\" as you had done in your commit.\n> \n> If you are okay with the additional changes, I think you or I could mark it as positive review.\nLGTM",
    "created_at": "2020-11-27T21:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438672",
    "user": "@paulmasson"
}
```

Replying to [comment:48 gh-jcamp0x2a]:
> Replying to [comment:43 paulmasson]:
> > Joshua, ready for another review. Thanks!
> 
> Hi Paul, I found a failing doctest in `display_manager.py` due to the CDN URL change. I hope you don't mind, but I took the liberty of pushing a fix for it. I also went ahead and modified it to read from that new `version` file instead of relying on the `REVISION=` stuff, and I also renamed a few more occurrences of "scripts" to "script" as you had done in your commit.
> 
> If you are okay with the additional changes, I think you or I could mark it as positive review.
LGTM



---

archive/issue_comments_438673.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-11-27T21:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438673",
    "user": "@paulmasson"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_438674.json:
```json
{
    "body": "Public methods such as `threejs_offline_scripts` should not be renamed without deprecation",
    "created_at": "2020-11-28T01:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438674",
    "user": "@mkoeppe"
}
```

Public methods such as `threejs_offline_scripts` should not be renamed without deprecation



---

archive/issue_comments_438675.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-11-28T01:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438675",
    "user": "@mkoeppe"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_438676.json:
```json
{
    "body": "Joshua, would you just revert the method name? It's only used internally and I no longer care if the script name doesn't match the output.",
    "created_at": "2020-11-28T02:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438676",
    "user": "@paulmasson"
}
```

Joshua, would you just revert the method name? It's only used internally and I no longer care if the script name doesn't match the output.



---

archive/issue_comments_438677.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-28T02:28:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438677",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438678.json:
```json
{
    "body": "Replying to [comment:53 paulmasson]:\n> Joshua, would you just revert the method name? It's only used internally and I no longer care if the script name doesn't match the output.\n\nDone. Did a quick sanity check and it still runs without issue in all four combinations of command-line/jupyter and online/offline.",
    "created_at": "2020-11-28T02:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438678",
    "user": "@jcamp0x2a"
}
```

Replying to [comment:53 paulmasson]:
> Joshua, would you just revert the method name? It's only used internally and I no longer care if the script name doesn't match the output.

Done. Did a quick sanity check and it still runs without issue in all four combinations of command-line/jupyter and online/offline.



---

archive/issue_comments_438679.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-11-28T02:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438679",
    "user": "@jcamp0x2a"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_438680.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-11-28T02:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438680",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_438681.json:
```json
{
    "body": "Joshua, by the way, have you tested if the offline mode works with JupyterLab too?",
    "created_at": "2020-11-28T18:50:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438681",
    "user": "@mkoeppe"
}
```

Joshua, by the way, have you tested if the offline mode works with JupyterLab too?



---

archive/issue_comments_438682.json:
```json
{
    "body": "Replying to [comment:57 mkoeppe]:\n> Joshua, by the way, have you tested if the offline mode works with JupyterLab too?\n\nYes, sorry, that's actually what I meant by \"jupyter\". I've been using it in preference to the traditional notebook lately. I've gone back and tested with the traditional notebook and it works fine as well.\n\nOh, and I'm going to try to spend some time later today looking at your #30972.",
    "created_at": "2020-11-28T19:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438682",
    "user": "@jcamp0x2a"
}
```

Replying to [comment:57 mkoeppe]:
> Joshua, by the way, have you tested if the offline mode works with JupyterLab too?

Yes, sorry, that's actually what I meant by "jupyter". I've been using it in preference to the traditional notebook lately. I've gone back and tested with the traditional notebook and it works fine as well.

Oh, and I'm going to try to spend some time later today looking at your #30972.



---

archive/issue_comments_438683.json:
```json
{
    "body": "Replying to [comment:58 gh-jcamp0x2a]:\n> Replying to [comment:57 mkoeppe]:\n> > Joshua, by the way, have you tested if the offline mode works with JupyterLab too?\n> \n> Yes, sorry, that's actually what I meant by \"jupyter\". I've been using it in preference to the traditional notebook lately. I've gone back and tested with the traditional notebook and it works fine as well.\n\nGreat, thanks, I was not sure whether the JupyterLab server also serves the `/nbextensions` path.",
    "created_at": "2020-11-28T20:04:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438683",
    "user": "@mkoeppe"
}
```

Replying to [comment:58 gh-jcamp0x2a]:
> Replying to [comment:57 mkoeppe]:
> > Joshua, by the way, have you tested if the offline mode works with JupyterLab too?
> 
> Yes, sorry, that's actually what I meant by "jupyter". I've been using it in preference to the traditional notebook lately. I've gone back and tested with the traditional notebook and it works fine as well.

Great, thanks, I was not sure whether the JupyterLab server also serves the `/nbextensions` path.



---

archive/issue_comments_438684.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-12-05T22:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30678",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30678#issuecomment-438684",
    "user": "@vbraun"
}
```

Resolution: fixed
