# Issue 14354: apply_map on sparse vectors returns vectors of smaller degree

archive/issues_014354.json:
```json
{
    "body": "Assignee: AlexGhitza\n\nCC:  rbeezer\n\nKeywords: apply_map, sparse vector\n\nCalling `apply_map` on a sparse vector with zeros at the last positions returns a vector of wrong degree.\n\n\n```\nsage: F.<a> = GF(9)\nsage: v = vector([a, 0,0,0], sparse=True)\nsage: f = F.hom([a**3])\nsage: v.apply_map(f)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/14558\n\n",
    "created_at": "2013-05-09T07:48:18Z",
    "labels": [
        "algebra",
        "major",
        "bug"
    ],
    "title": "apply_map on sparse vectors returns vectors of smaller degree",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14354",
    "user": "tfeulner"
}
```
Assignee: AlexGhitza

CC:  rbeezer

Keywords: apply_map, sparse vector

Calling `apply_map` on a sparse vector with zeros at the last positions returns a vector of wrong degree.


```
sage: F.<a> = GF(9)
sage: v = vector([a, 0,0,0], sparse=True)
sage: f = F.hom([a**3])
sage: v.apply_map(f)
```


Issue created by migration from https://trac.sagemath.org/ticket/14558





---

archive/issue_comments_181299.json:
```json
{
    "body": "Changing component from algebra to linear algebra.",
    "created_at": "2013-05-09T08:03:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14354#issuecomment-181299",
    "user": "tfeulner"
}
```

Changing component from algebra to linear algebra.



---

archive/issue_comments_181300.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-05-09T08:03:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14354#issuecomment-181300",
    "user": "tfeulner"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_181301.json:
```json
{
    "body": "It looks like you have duplicated some code for finding the common ring.  I think that ideally this step should remain in the vector constructor.\n\nBefore returning, you have the mapped elements, the degree, and the sparseness.  Did you try calling `vector()` with all the arguments supplied named, ie\n\n\n```\narg0, arg1, arg2, sparse\n```\n\n\nmuch as calling format number 4, but with sparseness supplied?  Or maybe calling format 4 needs to be sure to handle the `sparse` keyword properly.\n\nI could be wrong about this, since I have not fully tested everything, but is there a way to just do the mapping and pass the degree in the sparse and non-sparse cases?  Let the constructor determine the new ring for the mapped entries?",
    "created_at": "2013-06-04T00:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14354#issuecomment-181301",
    "user": "rbeezer"
}
```

It looks like you have duplicated some code for finding the common ring.  I think that ideally this step should remain in the vector constructor.

Before returning, you have the mapped elements, the degree, and the sparseness.  Did you try calling `vector()` with all the arguments supplied named, ie


```
arg0, arg1, arg2, sparse
```


much as calling format number 4, but with sparseness supplied?  Or maybe calling format 4 needs to be sure to handle the `sparse` keyword properly.

I could be wrong about this, since I have not fully tested everything, but is there a way to just do the mapping and pass the degree in the sparse and non-sparse cases?  Let the constructor determine the new ring for the mapped entries?



---

archive/issue_comments_181302.json:
```json
{
    "body": "Attachment\n\nReplying to [comment:3 rbeezer]:\n> It looks like you have duplicated some code for finding the common ring.  I think that ideally this step should remain in the vector constructor.\nI agree with you, this should stay in the constructor.\n\nThe updated patch now just explicitly adds, in the cases where it is necessary, one zero entry to the dictionary.",
    "created_at": "2013-06-26T13:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14354#issuecomment-181302",
    "user": "tfeulner"
}
```

Attachment

Replying to [comment:3 rbeezer]:
> It looks like you have duplicated some code for finding the common ring.  I think that ideally this step should remain in the vector constructor.
I agree with you, this should stay in the constructor.

The updated patch now just explicitly adds, in the cases where it is necessary, one zero entry to the dictionary.



---

archive/issue_comments_181303.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-08-14T23:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14354#issuecomment-181303",
    "user": "rbeezer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_181304.json:
```json
{
    "body": "Sorry to have lost track of this one.\n\nFix looks good, behaves as expected, passes tests, and docs look good.  Positive review.\n\nThanks for sticking with this one.\n\nRob",
    "created_at": "2013-08-14T23:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14354#issuecomment-181304",
    "user": "rbeezer"
}
```

Sorry to have lost track of this one.

Fix looks good, behaves as expected, passes tests, and docs look good.  Positive review.

Thanks for sticking with this one.

Rob



---

archive/issue_comments_181305.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-08-20T12:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14354",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14354#issuecomment-181305",
    "user": "jdemeyer"
}
```

Resolution: fixed
