# Issue 14354: apply_map on sparse vectors returns vectors of smaller degree

Issue created by migration from https://trac.sagemath.org/ticket/14558

Original creator: tfeulner

Original creation time: 2013-05-09 07:48:18

Assignee: AlexGhitza

CC:  rbeezer

Keywords: apply_map, sparse vector

Calling `apply_map` on a sparse vector with zeros at the last positions returns a vector of wrong degree.


```
sage: F.<a> = GF(9)
sage: v = vector([a, 0,0,0], sparse=True)
sage: f = F.hom([a**3])
sage: v.apply_map(f)
```



---

Comment by tfeulner created at 2013-05-09 08:03:07

Changing component from algebra to linear algebra.


---

Comment by tfeulner created at 2013-05-09 08:03:07

Changing status from new to needs_review.


---

Comment by rbeezer created at 2013-06-04 00:47:53

It looks like you have duplicated some code for finding the common ring.  I think that ideally this step should remain in the vector constructor.

Before returning, you have the mapped elements, the degree, and the sparseness.  Did you try calling `vector()` with all the arguments supplied named, ie


```
arg0, arg1, arg2, sparse
```


much as calling format number 4, but with sparseness supplied?  Or maybe calling format 4 needs to be sure to handle the `sparse` keyword properly.

I could be wrong about this, since I have not fully tested everything, but is there a way to just do the mapping and pass the degree in the sparse and non-sparse cases?  Let the constructor determine the new ring for the mapped entries?


---

Attachment

Replying to [comment:3 rbeezer]:
> It looks like you have duplicated some code for finding the common ring.  I think that ideally this step should remain in the vector constructor.
I agree with you, this should stay in the constructor.

The updated patch now just explicitly adds, in the cases where it is necessary, one zero entry to the dictionary.


---

Comment by rbeezer created at 2013-08-14 23:10:46

Changing status from needs_review to positive_review.


---

Comment by rbeezer created at 2013-08-14 23:10:46

Sorry to have lost track of this one.

Fix looks good, behaves as expected, passes tests, and docs look good.  Positive review.

Thanks for sticking with this one.

Rob


---

Comment by jdemeyer created at 2013-08-20 12:56:12

Resolution: fixed
