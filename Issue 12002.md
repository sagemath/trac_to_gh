# Issue 12002: modular resultants for multivariate polynomials over QQ

archive/issues_012002.json:
```json
{
    "body": "Assignee: @aghitza\n\nCC:  @burcin fschulze @videlec @jdemeyer\n\nKeywords: resultant, discriminant, polynomial, multivariate\n\nSage is somewhat slow when computing discriminants of multivariate polynomials:\n\n\n```\nsage: R.<a0,a1,a2,a3,d,t> = QQ[]\nsage: f=(16/27)*(a3+d)^2*3*a2^2*t^7*d^2+12*a1*t^7*d^3+4*a2^3*a3*t^6-2*a2^3*t^6*d+\n18*a1*a2*a3*t^6*d-*a1*a2*t^6*d^2+12*a0*t^6*d^3+3*a2^4*t^5+\n6*a1*a2^2*a3*t^5-9*a1^2*a3^2*t^5+12*a1*a2^2*t^5*d+18*a1^2*a3*t^5*d+\n18*a0*a2*a3*t^5*d+3*a1^2*t^5*d^2-6*a0*a2*t^5*d^2+6*a1*a2^3*t^4-\n6*a1^2*a2*a3*t^4+6*a0*a2^2*a3*t^4-18*a0*a1*a3^2*t^4+\n18*a1^2*a2*t^4*d+12*a0*a2^2*t^4*d+36*a0*a1*a3*t^4*d+\n6*a0*a1*t^4*d^2+3*a1^2*a2^2*t^3+6*a0*a2^3*t^3-4*a1^3*a3*t^3-\n12*a0*a1*a2*a3*t^3-9*a0^2*a3^2*t^3+8*a1^3*t^3*d+36*a0*a1*a2*t^3*d+\n18*a0^2*a3*t^3*d+3*a0^2*t^3*d^2+6*a0*a1*a2^2*t^2-12*a0*a1^2*a3*t^2-\n6*a0^2*a2*a3*t^2+24*a0*a1^2*t^2*d+18*a0^2*a2*t^2*d+3*a0^2*a2^2*t-\n12*a0^2*a1*a3*t+24*a0^2*a1*t*d-4*a0^3*a3+8*a0^3*d)\nsage: time d=f.discriminant(t)\nTime: CPU 3101.66 s, Wall: 3101.78 s\n```\n\n\nSage is relying on singular to compute the resultant of f and the derivative of f. Alternatively, one can compute the determinant of the Sylvester matrix; doing this mod p and using chinese remaindering then is much faster in this example:\n\n\n```\nsage: time dm=modular_discriminant(f,t)\nTime: CPU 42.55 s, Wall: 42.55 s\nsage: d==dm\nTrue\n```\n\n\nI attached the implementation of `modular_discriminant()`. This should not go into sage like this, it's just some experiments I did. I haven't tested it or thought about it too carefully.\n\nBtw. Maple 9.5 needs about 4s to compute this; a recent version of Maple was even faster, but I don't have the data here right now.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12174\n\n",
    "created_at": "2011-12-17T19:20:06Z",
    "labels": [
        "algebra",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "modular resultants for multivariate polynomials over QQ",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12002",
    "user": "@saraedum"
}
```
Assignee: @aghitza

CC:  @burcin fschulze @videlec @jdemeyer

Keywords: resultant, discriminant, polynomial, multivariate

Sage is somewhat slow when computing discriminants of multivariate polynomials:


```
sage: R.<a0,a1,a2,a3,d,t> = QQ[]
sage: f=(16/27)*(a3+d)^2*3*a2^2*t^7*d^2+12*a1*t^7*d^3+4*a2^3*a3*t^6-2*a2^3*t^6*d+
18*a1*a2*a3*t^6*d-*a1*a2*t^6*d^2+12*a0*t^6*d^3+3*a2^4*t^5+
6*a1*a2^2*a3*t^5-9*a1^2*a3^2*t^5+12*a1*a2^2*t^5*d+18*a1^2*a3*t^5*d+
18*a0*a2*a3*t^5*d+3*a1^2*t^5*d^2-6*a0*a2*t^5*d^2+6*a1*a2^3*t^4-
6*a1^2*a2*a3*t^4+6*a0*a2^2*a3*t^4-18*a0*a1*a3^2*t^4+
18*a1^2*a2*t^4*d+12*a0*a2^2*t^4*d+36*a0*a1*a3*t^4*d+
6*a0*a1*t^4*d^2+3*a1^2*a2^2*t^3+6*a0*a2^3*t^3-4*a1^3*a3*t^3-
12*a0*a1*a2*a3*t^3-9*a0^2*a3^2*t^3+8*a1^3*t^3*d+36*a0*a1*a2*t^3*d+
18*a0^2*a3*t^3*d+3*a0^2*t^3*d^2+6*a0*a1*a2^2*t^2-12*a0*a1^2*a3*t^2-
6*a0^2*a2*a3*t^2+24*a0*a1^2*t^2*d+18*a0^2*a2*t^2*d+3*a0^2*a2^2*t-
12*a0^2*a1*a3*t+24*a0^2*a1*t*d-4*a0^3*a3+8*a0^3*d)
sage: time d=f.discriminant(t)
Time: CPU 3101.66 s, Wall: 3101.78 s
```


Sage is relying on singular to compute the resultant of f and the derivative of f. Alternatively, one can compute the determinant of the Sylvester matrix; doing this mod p and using chinese remaindering then is much faster in this example:


```
sage: time dm=modular_discriminant(f,t)
Time: CPU 42.55 s, Wall: 42.55 s
sage: d==dm
True
```


I attached the implementation of `modular_discriminant()`. This should not go into sage like this, it's just some experiments I did. I haven't tested it or thought about it too carefully.

Btw. Maple 9.5 needs about 4s to compute this; a recent version of Maple was even faster, but I don't have the data here right now.

Issue created by migration from https://trac.sagemath.org/ticket/12174





---

archive/issue_comments_138629.json:
```json
{
    "body": "Attachment [disc.sage](tarball://root/attachments/some-uuid/ticket12174/disc.sage) by @saraedum created at 2011-12-17 19:20:31\n\nhack of a modular discriminant/resultant algorithm",
    "created_at": "2011-12-17T19:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138629",
    "user": "@saraedum"
}
```

Attachment [disc.sage](tarball://root/attachments/some-uuid/ticket12174/disc.sage) by @saraedum created at 2011-12-17 19:20:31

hack of a modular discriminant/resultant algorithm



---

archive/issue_comments_138630.json:
```json
{
    "body": "Changing keywords from \"resultant, discriminant, polynomial, multivariate\" to \"resultant, discriminant, polynomial, multivariate, sd35\".",
    "created_at": "2011-12-21T15:22:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138630",
    "user": "@saraedum"
}
```

Changing keywords from "resultant, discriminant, polynomial, multivariate" to "resultant, discriminant, polynomial, multivariate, sd35".



---

archive/issue_comments_138631.json:
```json
{
    "body": "See #16749 for a similar issue.",
    "created_at": "2014-08-04T08:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138631",
    "user": "@saraedum"
}
```

See #16749 for a similar issue.



---

archive/issue_comments_138632.json:
```json
{
    "body": "Still slow in 2018 btw.",
    "created_at": "2018-10-05T00:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138632",
    "user": "@saraedum"
}
```

Still slow in 2018 btw.



---

archive/issue_comments_138633.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-02-19T20:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138633",
    "user": "@fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_138634.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-02-19T20:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138634",
    "user": "@fchapoton"
}
```

New commits:



---

archive/issue_comments_138635.json:
```json
{
    "body": "Some timings\n\n```\nsage: x,y,z=polygen(QQ,'x,y,z')\nsage: f=x**55+x**33*z**4+3445*x*y*z*z\nsage: %timeit f.discriminant(x,algorithm='singular')\n10 loops, best of 3: 25.4 ms per loop\nsage: %timeit f.discriminant(x)\n100 loops, best of 3: 4.36 ms per loop\nsage: g= f + 5234*x*y*z**66\nsage: %timeit g.discriminant(x,algorithm='singular')\n1 loop, best of 3: 14.3 s per loop\nsage: %timeit g.discriminant(x)\n1 loop, best of 3: 4.68 s per loop\n```\n",
    "created_at": "2019-02-19T20:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138635",
    "user": "@fchapoton"
}
```

Some timings

```
sage: x,y,z=polygen(QQ,'x,y,z')
sage: f=x**55+x**33*z**4+3445*x*y*z*z
sage: %timeit f.discriminant(x,algorithm='singular')
10 loops, best of 3: 25.4 ms per loop
sage: %timeit f.discriminant(x)
100 loops, best of 3: 4.36 ms per loop
sage: g= f + 5234*x*y*z**66
sage: %timeit g.discriminant(x,algorithm='singular')
1 loop, best of 3: 14.3 s per loop
sage: %timeit g.discriminant(x)
1 loop, best of 3: 4.68 s per loop
```




---

archive/issue_comments_138636.json:
```json
{
    "body": "Not extremely convincing, sadly, for smaller polynomials. Maybe I am not doing it the right way ?",
    "created_at": "2019-02-19T20:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138636",
    "user": "@fchapoton"
}
```

Not extremely convincing, sadly, for smaller polynomials. Maybe I am not doing it the right way ?



---

archive/issue_comments_138637.json:
```json
{
    "body": "Sided note: in the development version of flint there are multivariable polynomials and an implementation of discriminant.",
    "created_at": "2019-02-20T07:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138637",
    "user": "@videlec"
}
```

Sided note: in the development version of flint there are multivariable polynomials and an implementation of discriminant.



---

archive/issue_comments_138638.json:
```json
{
    "body": "Maybe you want to use `from sage.libs.all import pari`? This is what `polynomial_element.pyx` does.",
    "created_at": "2019-02-20T23:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138638",
    "user": "@tscrim"
}
```

Maybe you want to use `from sage.libs.all import pari`? This is what `polynomial_element.pyx` does.



---

archive/issue_comments_138639.json:
```json
{
    "body": "Not sure whether this is interesting, but I get (using the develop branch, that is, without this patch):\n\n```\nsage: x,y,z=polygen(QQ,'x,y,z')\nsage: f=x**55+x**33*z**4+3445*x*y*z*z\nsage: g = f + 5234*x*y*z**66\nsage: g.discriminant(x)/fricas(g).discriminant(x).sage()\n1\nsage: %timeit g.discriminant(x)\n1 loop, best of 3: 6.93 s per loop\nsage: %timeit fricas(g).discriminant(x).sage()\n1 loop, best of 3: 270 ms per loop\n\n```\n",
    "created_at": "2019-02-21T09:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138639",
    "user": "@mantepse"
}
```

Not sure whether this is interesting, but I get (using the develop branch, that is, without this patch):

```
sage: x,y,z=polygen(QQ,'x,y,z')
sage: f=x**55+x**33*z**4+3445*x*y*z*z
sage: g = f + 5234*x*y*z**66
sage: g.discriminant(x)/fricas(g).discriminant(x).sage()
1
sage: %timeit g.discriminant(x)
1 loop, best of 3: 6.93 s per loop
sage: %timeit fricas(g).discriminant(x).sage()
1 loop, best of 3: 270 ms per loop

```




---

archive/issue_comments_138640.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-23T08:32:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138640",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_138641.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-23T08:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138641",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_138642.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-11T20:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138642",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_138643.json:
```json
{
    "body": "some progress..",
    "created_at": "2019-03-11T20:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138643",
    "user": "@fchapoton"
}
```

some progress..



---

archive/issue_comments_138644.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138644",
    "user": "@embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_138645.json:
```json
{
    "body": "With pari, for the large example in the ticket description:\n\n```\nsage: time d=f.discriminant(t)\nCPU times: user 44min 8s, sys: 2.15 s, total: 44min 11s\n```\n\nso not so good after all.",
    "created_at": "2019-04-16T11:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138645",
    "user": "@fchapoton"
}
```

With pari, for the large example in the ticket description:

```
sage: time d=f.discriminant(t)
CPU times: user 44min 8s, sys: 2.15 s, total: 44min 11s
```

so not so good after all.



---

archive/issue_comments_138646.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-04-28T08:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138646",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_138647.json:
```json
{
    "body": "Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138647",
    "user": "@embray"
}
```

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_comments_138648.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138648",
    "user": "@embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_138649.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138649",
    "user": "@mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_138650.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138650",
    "user": "@mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_138651.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12002",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12002#issuecomment-138651",
    "user": "@mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.
