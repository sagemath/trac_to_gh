# Issue 29664: .github/workflows/: Test all optional packages, add workflow for testing all experimental packages

Issue created by migration from https://trac.sagemath.org/ticket/29901

Original creator: mkoeppe

Original creation time: 2020-06-19 16:41:43

CC:  jhpalmieri novoselt @kliem mjo




---

Comment by mkoeppe created at 2020-06-19 17:28:05

The present version has an explicit list of the packages to the workflow scripts. This could be made less maintenance-intensive by #29902
----
New commits:


---

Comment by git created at 2020-06-19 17:39:16

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2020-06-19 18:01:50

.github/workflows/: Test all optional packages, add workflow for testing all experimental packages · mkoeppe/sage`@`f87c885
https://github.com/mkoeppe/sage/actions/runs/141135018

.github/workflows/: Test all optional packages, add workflow for testing all experimental packages · mkoeppe/sage`@`f87c885
https://github.com/mkoeppe/sage/actions/runs/141135010


---

Comment by git created at 2020-06-20 06:08:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-06-20 06:09:52

https://github.com/mkoeppe/sage/runs/789828733

```
Error processing tar file(exit status 1): write /sage/local/share/pari/elldata/ell366: no space left on device
Error response from daemon: Error processing tar file(exit status 1): write /sage/local/share/stein_watkins/a.010.bz2: no space left on device
```



---

Comment by jhpalmieri created at 2020-06-20 15:58:11

Maybe we don't need to test `database_stein_watkins` much: if `database_stein_watkins_mini` works, then since they use the same spkg-install.in, the only issue, I think, is whether the big tarball is corrupt.


---

Comment by mkoeppe created at 2020-06-20 16:04:10

Right. There was apparently a point to having that old category of "huge" packages. Wondering how that got lost. --> #29919 (Restore "huge" package type)


---

Comment by git created at 2020-06-20 16:11:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-20 16:19:27

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-06-20 17:06:25

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2020-06-20 17:08:32

New test at https://github.com/mkoeppe/sage/actions/runs/141954265


---

Comment by mkoeppe created at 2020-06-22 17:37:05

Filtering out the known huge packages works now.

But there are many timeouts. Will need to split "optional" into 2 parts.


---

Comment by git created at 2020-07-14 04:31:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-14 04:38:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-15 18:47:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-07-15 18:48:38

Tests for experimental packages at https://github.com/mkoeppe/sage/actions/runs/170318716

Tests for optional packages at https://github.com/mkoeppe/sage/actions/runs/170362341


---

Comment by mkoeppe created at 2020-07-15 21:29:14

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-07-16 01:09:26

Still exceeds 2 x 6h on `ubuntu-xenial`, need to split it up more


---

Comment by git created at 2020-07-16 05:48:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-07-16 05:49:51

Tests at https://github.com/mkoeppe/sage/actions/runs/170932419 and https://github.com/mkoeppe/sage/actions/runs/170932412


---

Comment by mkoeppe created at 2020-07-16 19:42:09

Should remove the testing of `sage_numerical_backends_cplex`, `sage_numerical_backends_gurobi`, which require the commercial packages to be installed first


---

Comment by git created at 2020-07-16 19:44:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2020-07-17 19:17:17

Why are there green checkmarks, if things haven't worked out?

https://github.com/mkoeppe/sage/runs/876312084?check_suite_focus=true


---

Comment by mkoeppe created at 2020-07-17 19:18:54

Targets listed in `TARGETS_OPTIONAL` ignore errors.


---

Comment by @kliem created at 2020-07-17 19:23:22

Why is that? There is probably a good reason, but I'm curious. How do I efficiently use it then.


---

Comment by mkoeppe created at 2020-07-17 19:42:51

Unfortunately a test run can only get a red or a green status on GH Actions.
`TARGETS_OPTIONAL` is designed for additional tests of things that are likely to fail - such as `ptest` in `tox.yml`, which always has 1 or 2 failures that we don't want to be signaled by a red status.

There's only a rather shallow reason why currently use `TARGETS_OPTIONAL` for testing the optional and experimental packages. At the moment the majority of the optional and experimental packages fail, so all of these test runs will fail. Thus there is no information either way. But the green checkmarks look more friendly. 

We can change this when we have made some progress in #29900 (Meta-ticket: Fix optional and experimental packages for Sage 9.2).


---

Comment by mkoeppe created at 2020-07-17 19:44:10

Replying to [comment:31 gh-kliem]:
> How do I efficiently use it then.

Look at the "This run" tab of the whole workflow and search for package names that you're interested in.


---

Comment by @kliem created at 2020-07-17 19:52:05

Thanks. Yes, sounds reasonable.

From my point of view, optional should mean almost as safe as sage itself and experimental is for all stuff that might or might not work (I guess there are runtime failures as well that make stuff experimental). So adding a doctesting framework for this seems great.


---

Comment by mkoeppe created at 2020-07-17 20:01:47

Replying to [comment:34 gh-kliem]:
> From my point of view, optional should mean almost as safe as sage itself and experimental is for all stuff that might or might not work (I guess there are runtime failures as well that make stuff experimental).

Yes, I agree with this interpretation.


---

Comment by @kliem created at 2020-07-17 20:16:56

I think this is a good improvement as it is.


---

Comment by @kliem created at 2020-07-17 20:16:56

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-07-17 20:19:16

Thanks!


---

Comment by vbraun created at 2020-07-25 22:51:14

Resolution: fixed
