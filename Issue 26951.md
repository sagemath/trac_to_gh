# Issue 26951: kenzo package and interface

Issue created by migration from https://trac.sagemath.org/ticket/27188

Original creator: mmarco

Original creation time: 2019-01-31 17:41:56

CC:  jhpalmieri slelievre dimpase




---

Comment by mmarco created at 2019-01-31 17:49:56

Changing keywords from "" to "kenzo topology".


---

Comment by mmarco created at 2019-01-31 17:49:56

Changing component from PLEASE CHANGE to interfaces.


---

Comment by git created at 2019-01-31 19:38:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2019-01-31 20:25:37

This is exciting to see. Can we get an interface between Kenzo and Sage's implementation of simplicial sets? A crude version is in `sage.homology.simplicial_set_examples.simplicial_data_from_kenzo_output`, which was written to handle the files in `src/ext/kenzo`. But doing it in lisp or Python rather than just parsing strings would be much better.


---

Comment by mmarco created at 2019-01-31 20:36:02

That is the long term idea we had in mind for starting this; but we still haven't decided the design.

Maybe include an attribute for each Sage simplicial set that is a reference to the corresponding kenzo object (via this interface)?

Right now we have just coded the bare minimum kenzo functionality, but for that task maybe we should add support for explicit list of faces and maps.


---

Comment by mmarco created at 2019-02-01 12:13:58

I just noticed that the code I pushed in this branch fails when trying to load it. It works ok in my install of Sage based on python3, but fails in the standard python2. Since we don't know how much time will take until python3 makes it into standard sage installs, I will try to find a way to import kenzo inside sage's ecl that works also for python2. 

In the meantime, you can test this branch using a python3 based sage, following the instructions in https://groups.google.com/forum/#!topic/sage-devel/uEHBKekJ_Cw


---

Comment by git created at 2019-02-01 16:41:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2019-02-01 16:42:45

I just pushed a one liner that prevents the error with python2 (at least in my system). Please test it.


---

Comment by git created at 2019-02-01 16:47:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-02-02 13:20:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-02-02 13:45:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2019-02-02 13:59:07

Switched to another upstream source. It is a fork I made to be able to include some utility scripts that we might need.

For the moment, it includes a script to compile all kenzo in a self-contained .fasl file, that we can easily load without problems both from python2 and python3.

I think it is pretty much ready to be tested.


---

Comment by slelievre created at 2019-02-03 19:46:39

Changing type from PLEASE CHANGE to enhancement.


---

Comment by dimpase created at 2019-02-03 20:25:23

we could add your scripts to `@`gheber's repo, provided they are sufficiently generic; after all I already did a bit of work on it:
https://github.com/gheber/kenzo/graphs/contributors :-)


---

Comment by mmarco created at 2019-02-03 22:30:23

Replying to [comment:17 dimpase]:
> we could add your scripts to `@`gheber's repo, provided they are sufficiently generic; after all I already did a bit of work on it:
> https://github.com/gheber/kenzo/graphs/contributors :-)


We discussed it with gheber and Sergerarert in https://github.com/gheber/kenzo/issues/129 . We finally agreed to fork it to work in whatever we need to add (we might need to add some extra functions to allow the creation of Kenzo objects from the corresponding Sage SimplicialSets counterparts). Then maybe, when we have something stable, we can consider merging back.


---

Comment by mmarco created at 2019-02-17 20:47:20

I think this can be reviewed now. We still have to adapt the SimplicialSets module, and maybe write some kenzo code, but that would be better done in future tickets.


---

Comment by mmarco created at 2019-02-18 08:06:46

Changing status from new to needs_review.


---

Comment by tscrim created at 2019-02-22 04:50:30

The documentation in your interface file needs a little more work. Some functions do not have doctests and some others have malformatted docstrings (e.g., missing `EXAMPLES::` and indentations).


---

Comment by tscrim created at 2019-02-22 04:50:30

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-02-23 20:27:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2019-02-23 20:29:49

I added more documentation. Didn't add doctest for __init__ method though. Do you think that would be necessary?


---

Comment by mmarco created at 2019-02-23 20:29:49

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2019-02-23 21:23:25

Thank you. This is improving, but there are a few more specific things to be fixed (although with these done, it should be at a positive review).

Yes, `__init__` needs to have a doctest. I think it is the best place to put the `TestSuite(foo).run()` test. I also would move the `INPUT:` block to the class level docstring as the `__init__` docstring is not in the documentation.

Change `__repr__` -> `_repr_` (which allows you to run `foo.rename('bar')` on it).

There are still some malformatted docstrings:

```diff
 def Sphere(n):
     r"""
-    Construct the n dimensional sphere, which is a simplicial set.
+    Return the ``n`` dimensional sphere as a Kenzo simplicial set.
 
     INPUT:
 
-    - ``n`` - The dimension of the sphere
+    - ``n`` -- the dimension of the sphere
```


```diff
-def MooreSpace(n, m):
+def MooreSpace(m, n):
     r"""
-    Construct the Moore space ``M(m, n)``. That is, the space
-    that has n'th homology group isomorphic to the cyclic group of order ``m``,
-    and the rest of the homology groups are trivial. It is a simplicial set.
+    Return the Moore space `M(m, n)` as a Kenzo simplicial set.
 
+    The Moore space `M(m, n)` is the space whose `n`-th homology group
+    is isomorphic to the cyclic group of order `m`, and the rest of
+    the homology groups are trivial.
 
     INPUT:
 
-    - ``m```- A positive integer. The order of the nontrivial homology group.
+    - ``m`` -- a positive integer; the order of the nontrivial homology group
 
-    - ``n```- The dimension in which the homology is not trivial
+    - ``n`` -- the dimension in which the homology is not trivial
```

Similar comments for `EilenbergMacLaneSpace`. (I opted for `return` for the short descriptions, but `construct` is okay with me as well.)

```diff
-        - ``kenzoobject``- a wrapper around a kenzo chain complex
-        (which is an ecl object).
+        - ``kenzoobject`` -- a wrapper around a kenzo chain complex
+          (which is an ecl object)
```

Similar comment for `loop_space()`, and a stray ``` there as well: `- `A KenzoSimplicialGroup`.

For the doctests (e.g., in `loop_space()`), it is not so important to test the `type(l2)` but it would be more useful to see either the output or a meaningful test. For example, in the suspension doctest, the result would have a homology of *Z* only in the 4th degree (since the homology group (= homology group in this case) for `e2` (why not call it `e3`?) is *Z* in the 3rd degree).


---

Comment by mmarco created at 2019-02-24 17:41:56

The testsuite fails at pickling, because we are wrapping ecl objects, that can't be pickled (maybe that is a good reason for not inheriting from SageObject? but from EclObject? or nothing at all?)


---

Comment by git created at 2019-02-24 17:41:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-02-24 17:51:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2019-02-24 18:19:47

Replying to [comment:26 mmarco]:
> The testsuite fails at pickling, because we are wrapping ecl objects, that can't be pickled (maybe that is a good reason for not inheriting from SageObject? but from EclObject? or nothing at all?)

You could instead skip that part of the test suite (`TestSuite(foo).run(skip='_test_pickling')`.

There are benefits to inheriting from SageObject, so I would rather skip part of the test suite than not inherit from this.


---

Comment by git created at 2019-02-24 21:54:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2019-02-24 21:55:52

Replying to [comment:29 jhpalmieri]:
> You could instead skip that part of the test suite (`TestSuite(foo).run(skip='_test_pickling')`.
> 
> There are benefits to inheriting from SageObject, so I would rather skip part of the test suite than not inherit from this.

Thanks for the hint!


---

Comment by tscrim created at 2019-02-24 23:18:19

A few more comments:


```diff
-# Redirection of ECL and Maxima stdout to /dev/null
+# Redirection of ECL and Kenzo stdout to /dev/null
+# This is also done in the Maxima library, but we
+#   also do it here for redundancy.
```


I believe Ana should also be on the copyright. Also, the modern copyright statement is

```
# ****************************************************************************
#       Copyright (C) 2019 Miguel Marco <mmarco@unizar.es>
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 2 of the License, or
# (at your option) any later version.
#                  https://www.gnu.org/licenses/
# ****************************************************************************
```

which should **not** be in the docstring.

`MooreSpace`, `EilenbergMacLaneSpace` and `KenzoChainComplex` have malformatted docstrings., e.g.:

```diff
-        - ``kenzoobject``- a wrapper around a kenzo chain complex
-        (which is an ecl object).
+        - ``kenzoobject`` -- a wrapper around a kenzo chain complex
+          (which is an ecl object)
```


```diff
-    - ``G`` -- A group. Currently only ``ZZ`` and the group of two elements are
-    supported.
+    - ``G`` -- group; currently only ``ZZ`` and the group of two elements are
+      supported
 
-    - ``n`` -- The dimension in which the homotopy is not trivial
+    - ``n`` -- the dimension in which the homotopy is not trivial
```

Also, in this particular docstring, there is not a unique group of 2 elements. Moreover, does it have to be `GF(2)`? Does `G` need to be additive or can it be multiplicative?

In the tests for `EilenbergMacLaneSpace`, it is better to use `G is ZZ`.


```diff
-Wraper to kenzo chain complexes
+Wrapper to kenzo chain complexes.
```


For future-proofing, it probably would be better to have a `KenzoObject` class above `KenzoChainComplex` with the `__init__` and `_repr_` methods.

It is more pythonic to do `repr(self._kenzo)` instead of `self._kenzo.__repr__()`. Similarly, `kenzo_object` instead of `kenzoobject` for variable names.

`KenzoSimplicialGroup` -> `:class:`~sage.interfaces.kenzo.KenzoSimplicialGroup`` (it might be possible to just do `:class:`KenzoSimplicialGroup``) and similar changes. This is less important though.


---

Comment by mmarco created at 2019-02-25 09:42:25

Replying to [comment:32 tscrim]:
> Also, in this particular docstring, there is not a unique group of 2 elements. Moreover, does it have to be `GF(2)`? Does `G` need to be additive or can it be multiplicative?
> 
We could allow whatever we want, but since usually the homology groups are denoted additively, I used that convention. It is true however that we have so many possible incarnations of finite cyclic groups (CyclicPermutationGroup, AbelianGroup, AdditiveAbelianGroup, FinitelyPresentedGroup...) that at some point we should try to unify somehow all that, but that is definietly work for another ticket.

What would you suggest for this case? Just accept every group of cardinality two?


> `KenzoSimplicialGroup` -> `:class:`~sage.interfaces.kenzo.KenzoSimplicialGroup`` (it might be possible to just do `:class:`KenzoSimplicialGroup``) and similar changes. This is less important though.

I am not sure I know how to do that.


---

Comment by git created at 2019-02-25 12:12:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-02-25 22:12:20

Replying to [comment:33 mmarco]:
> Replying to [comment:32 tscrim]:
> > Also, in this particular docstring, there is not a unique group of 2 elements. Moreover, does it have to be `GF(2)`? Does `G` need to be additive or can it be multiplicative?
> > 
> We could allow whatever we want, but since usually the homology groups are denoted additively, I used that convention. It is true however that we have so many possible incarnations of finite cyclic groups (CyclicPermutationGroup, AbelianGroup, AdditiveAbelianGroup, FinitelyPresentedGroup...) that at some point we should try to unify somehow all that, but that is definietly work for another ticket.

In some sense we have that (see below). Although in general that is a can of worms (mainly, how to differentiate between additive and multiplicative groups).

> What would you suggest for this case? Just accept every group of cardinality two?

We can check things abstractly since it gets fed off to a Kenzo object. Specifically, I am thinking of this:

```python
elif G in CommutativeAdditiveGroups() and G.cardinality() == 2:
```

Also you should add a note to the doc saying that the group must be additive.

> > `KenzoSimplicialGroup` -> `:class:`~sage.interfaces.kenzo.KenzoSimplicialGroup`` (it might be possible to just do `:class:`KenzoSimplicialGroup``) and similar changes. This is less important though.
> 
> I am not sure I know how to do that.

It is just some replacements in the doc to add links to the appropriate classes so it looks a little better. `;)`


---

Comment by git created at 2019-02-26 15:59:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2019-02-26 21:14:14

I think I took care of all.


---

Comment by tscrim created at 2019-02-26 23:08:32

Thank you, but there are a few more little bits.

See comment:32 on `MooreSpace` `INPUT:` block.

The `INPUT:` for `KenzoObject` is over indented.

It would be good to put the one-line description for `EilenbergMacLaneSpace` on its own line (I also thought the convention for Eilenberg-MacLane spaces was to be with a capital `K`?). I would prefer the more "standard" (in the sense of the [dev guide](http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings)) docstring (see comment:32), but at least it is not malformatted. So this will not hold up a positive review.


---

Comment by git created at 2019-02-27 09:46:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-02-27 10:09:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-02-27 10:12:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2019-02-27 10:13:44

Changing status from needs_review to positive_review.


---

Comment by mmarco created at 2019-02-27 10:13:44

Thanks for the thorough review!

Is it ok if I set it to positive review?


---

Comment by tscrim created at 2019-02-27 10:27:14

You definitely should have put me as reviewer, but it would have been maybe slightly better to let me have one final lookover. However, as I mentioned I will let the little doc stuff slide to avoid over-nitpicking. `;)`


---

Comment by slelievre created at 2019-02-27 22:58:18

Adding "upgrade" to the keywords so the release manager knows there is a tarball to upload.

What is our convention for renaming the tarball? Do we need version numbers to not contain dashes?


---

Comment by slelievre created at 2019-02-27 22:58:18

Changing keywords from "kenzo topology" to "upgrade, kenzo, topology".


---

Comment by tscrim created at 2019-02-27 23:40:45

Replying to [comment:44 slelievre]:
> What is our convention for renaming the tarball? Do we need version numbers to not contain dashes?

They can contain dashes, underscores, etc.; e.g.:

```
lidia-2.3.0+latte-patches-2014-10-04.tar.gz
jmol-14.6.1_2016.07.11.tar.bz2
```

I don't think we have any specific conventions for tarball names in general other than date formats yyyymmdd for things that do not have version numbers or a sha1.


---

Comment by slelievre created at 2019-02-28 00:06:30

Right, I misremembered that. Maybe our package names can't contain dashes,
so the first dash in a tarball name ends the package name and starts the version
number. That might be why we sometimes rename `some-package-name`
to `some_package_name`. No problem with kenzo in that respect.


---

Comment by fbissey created at 2019-03-01 06:37:07

Changing status from positive_review to needs_work.


---

Comment by fbissey created at 2019-03-01 06:37:07


```
sage -t --long /usr/lib64/python2.7/site-packages/sage/interfaces/kenzo.py
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/interfaces/kenzo.py", line 153, in sage.interfaces.kenzo.EilenbergMacLaneSpace
Failed example:
    from sage.interfaces.kenzo import EilenbergMacLaneSpace
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 1095, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.kenzo.EilenbergMacLaneSpace[0]>", line 1, in <module>
        from sage.interfaces.kenzo import EilenbergMacLaneSpace
      File "/usr/lib64/python2.7/site-packages/sage/interfaces/kenzo.py", line 53, in <module>
        ecl_eval("(require :kenzo)")
      File "sage/libs/ecl.pyx", line 1326, in sage.libs.ecl.ecl_eval (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/libs/ecl.c:10127)
        cpdef EclObject ecl_eval(str s):
      File "sage/libs/ecl.pyx", line 1341, in sage.libs.ecl.ecl_eval (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/libs/ecl.c:10066)
        o=ecl_safe_eval(o)
      File "sage/libs/ecl.pyx", line 350, in sage.libs.ecl.ecl_safe_eval (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/libs/ecl.c:5124)
        raise RuntimeError("ECL says: {}".format(
    RuntimeError: ECL says: Module error: Don't know how to REQUIRE KENZO.
**********************************************************************
```

on a machine without the kenzo package installed. That import line needs to be marked `# optional - kenzo` as well.


---

Comment by git created at 2019-03-01 15:52:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2019-03-01 15:53:03

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2019-03-03 22:38:13

Resolution: fixed


---

Comment by jdemeyer created at 2019-03-26 13:20:39

Did anybody ever test that this actually passes doctests? See #27554.


---

Comment by tscrim created at 2019-03-26 13:42:01

I think I might have only run it without the package installed...sorry about that.
