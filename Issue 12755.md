# Issue 12755: Logging synchronises input and output wrongly.

Issue created by migration from https://trac.sagemath.org/ticket/12927

Original creator: itaibn

Original creation time: 2012-05-08 23:10:52

Assignee: jason

Keywords: log logging

In `sage/misc/log.py`, the following is in the documentation:

```
        """
        There is an off-by-one issue with IPython's input and output
        history; ``__IPYTHON__.input_hist_raw`` is a *list* containing
        the un-preparsed Sage commands. However,
        ``__IPYTHON__.output_hist`` is a dictionary whose keys are
        integers and whose values are outputs.  This is good because
        not every input has an output.

        **BUT**, the output from::
        
            __IPYTHON__.input_hist_raw[n]

        is stored in::

            __IPYTHON__.output_hist[n+1] !

        This is annoying and it may be a bug. Right now the loggers
        correct for this, but if modifying or extending this code,
        consider yourself warned.
        """        
```

This is incorrect. In fact, the compensation for this inside the code makes the input and output out of synchronisation. This can be seen in the following log:

```
Sage Log 2012-05-08-190000
1 sage: sage.misc.preparser.load(sage.misc.preparser.base64.b64decode("L2hvbWUvaXRhaWJuLy5zYWdlLy9pbml0LnNhZ2U="),globals(),False)

  2

2 sage: 1+1
3 sage: log_text()
```



---

Comment by itaibn created at 2012-11-04 22:50:49

A patch to fix this bug


---

Attachment


---

Comment by itaibn created at 2013-08-27 17:55:56

Changing status from new to needs_review.


---

Comment by vbraun created at 2013-11-23 01:47:40

Is the patch reversed?

Also, needs commit message instead of `[mq]: trac_12927` and ideally some doctest (e.g. using the IPython test shell framework or via a separate Sage session)


---

Comment by rws created at 2014-02-12 19:48:30

Changing status from needs_review to needs_work.
