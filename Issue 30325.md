# Issue 30325: Gap downloads from wrong upstream directory

Issue created by migration from https://trac.sagemath.org/ticket/30562

Original creator: vbraun

Original creation time: 2020-09-12 11:51:03

CC:  dimpase

It should download $HOST/upstream/gap/gap-4.11.0.tar.bz2, but goes for /upstream/gap_packages/ instead:

```
[gap-4.11.0.p0] Found local metadata for gap-4.11.0.p0
[gap-4.11.0.p0] Attempting to download package gap-4.11.0.tar.bz2 from mirrors
[gap-4.11.0.p0] http://sagepad.org/spkg/upstream/gap_packages/gap-4.11.0.tar.bz2
[gap-4.11.0.p0] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
[gap-4.11.0.p0] ERROR [transfer|run:135]: [Errno 404] Not Found: '//sagepad.org/spkg/upstream/gap_packages/gap-4.11.0.tar.bz2'
[gap-4.11.0.p0] https://mirror.koddos.net/sagemath/spkg/upstream/gap_packages/gap-4.11.0.tar.bz2
[gap-4.11.0.p0] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
[gap-4.11.0.p0] ERROR [transfer|run:135]: [Errno 404] Not Found: '//mirror.koddos.net/sagemath/spkg/upstream/gap_packages/gap-4.11.0.tar.bz2'
[gap-4.11.0.p0] http://www.mirrorservice.org/sites/www.sagemath.org/spkg/upstream/gap_packages/gap-4.11.0.tar.bz2
```

For now I'm manually copying the gap tarball to /gap_packages/, but would be nice to get this fixed.


---

Comment by mkoeppe created at 2020-09-12 21:24:02

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-09-12 21:24:02

Fixed this in #29314 by using symlinks instead of duplicating the checksums.ini file


---

Comment by dimpase created at 2020-09-13 07:09:17

Except that #29314 is hit by a swarm of open cans of worms. Makes me willing to redo the Sage's docbuild using the standard modern sphinx, I don't care if it will get slower.


---

Comment by mkoeppe created at 2020-09-13 16:34:22

New commits:


---

Comment by dimpase created at 2020-09-14 12:00:51

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-09-14 12:00:51

It works if I already have the GAP tarball in upstream.
I believe it's usually will be the case, as gap is a dependency of gap_packages, thus the tarball will be fetched for gap, if gap is not installed.

I've also tested that removing the tarball from upstream triggers its downloading if gap is already installed, but gap_packages is not.

So, all good.


---

Comment by mkoeppe created at 2020-09-14 12:13:37

Thanks.


---

Comment by vbraun created at 2020-09-27 09:09:35

Resolution: fixed
