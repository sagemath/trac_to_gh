# Issue 28644: refresh the shuffle algebra file

Issue created by migration from https://trac.sagemath.org/ticket/28881

Original creator: chapoton

Original creation time: 2019-12-13 20:38:36

CC:  tscrim jmantysalo

mainly pep8 changes


---

Comment by chapoton created at 2019-12-13 20:40:16

Changing status from new to needs_review.


---

Comment by chapoton created at 2019-12-13 20:40:16

New commits:


---

Comment by tscrim created at 2019-12-13 21:23:45

Changing status from needs_review to needs_info.


---

Comment by tscrim created at 2019-12-13 21:23:45

Well, technically the shuffle algebra should be in the category of commutative Hopf algebras, so it might be better to use the category of `Bialgebras(R).Commutative()`. However, the antipode is easy to implement: reverse the order of the `n` letters times (-1)<sup>n</sup> (see [this MathOverflow post](https://mathoverflow.net/questions/63923/shuffle-hopf-algebra-how-to-prove-its-properties-in-a-slick-way)). So I would propose changing the category to `HopfAlgebras(R).Commutative()` and adding

```python
def antipode_on_basis(self, w):
    """
    Return the antipode on the basis element ``w``.
    """
    mone = -self.base_ring().one()
    return self.term(w.reversal(), mone**len(w))
```

along with in the dual PBW basis

```python
def antipode(self, elt):
    """
    Return the antipode of the element ``elt``.
    """
    return self(self.expansion(elt).antipode())
```



---

Comment by git created at 2019-12-14 09:02:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2019-12-14 09:02:39

mmm; not so easy. I am hitting problems in the testsuites.


---

Comment by tscrim created at 2019-12-14 09:13:25

Hmm...maybe the product and coproduct implemented are not compatible? I will check it on Monday (Australian time).


---

Comment by git created at 2019-12-14 16:13:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-12-14 19:38:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2019-12-14 19:39:05

The coproduct was indeed broken. There still remains a failure..


---

Comment by tscrim created at 2019-12-14 22:24:13

It almost seems like the old coproduct is meant to be the inflation product. (The coproduct was added in #15212, but there is little information available there.)


---

Comment by tscrim created at 2019-12-15 01:26:00

So the problem seems to come from the coproduct in the dual PBW basis. It is only converting basis indices over (whereas the implementation was meant to be treating them as monomials). Here is a fix that doesn't try to be clever and just uses the coercion framework.


---

Comment by tscrim created at 2019-12-15 01:42:13

Changing status from needs_info to needs_review.


---

Comment by tscrim created at 2019-12-15 01:42:13

I fixed it, and I also made the shuffle algebra know it is a graded connected Hopf algebra.
----
New commits:


---

Comment by git created at 2019-12-15 07:52:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2019-12-15 07:54:57

Thanks a lot. Looks good now. I have fixed a pyflakes warning, and added some #long tags on the TestSuites.

Now launching the bot.


---

Comment by tscrim created at 2019-12-15 08:05:26

Worked locally for me, so I am going to assume the patchbot comes back green. Thank you.


---

Comment by tscrim created at 2019-12-15 08:05:26

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-12-17 22:46:27

Resolution: fixed
