# Issue 14099: "sage -i" should only run sage-location if it exists

archive/issues_014099.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  jdemeyer\n\nKeywords: sage-location\n\nDuring Sage installation, I sometimes see an spkg fail to build, for example [#13947 zn_poly]. Then I run\n\n```\n$ ./sage -i spkg/standard/zn_poly-0.9.p10.spkg\n```\n\nIf this installs successfully, it still has a return code of 127 (on OS X, at least), because the installation runs `sage-location` at the end, which hasn't been installed yet. So perhaps `sage -i ...` should only run `sage-location` if it already exists.  This way something like\n\n```\n$ make || ./sage -i spkg/standard/zn_poly-0.9.p10.spkg && make ptestlong\n```\n\n\nmight work the way I want, and building Sage would require less babysitting.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14303\n\n",
    "created_at": "2013-03-19T01:28:56Z",
    "labels": [
        "build",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.9",
    "title": "\"sage -i\" should only run sage-location if it exists",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14099",
    "user": "jhpalmieri"
}
```
Assignee: GeorgSWeber

CC:  jdemeyer

Keywords: sage-location

During Sage installation, I sometimes see an spkg fail to build, for example [#13947 zn_poly]. Then I run

```
$ ./sage -i spkg/standard/zn_poly-0.9.p10.spkg
```

If this installs successfully, it still has a return code of 127 (on OS X, at least), because the installation runs `sage-location` at the end, which hasn't been installed yet. So perhaps `sage -i ...` should only run `sage-location` if it already exists.  This way something like

```
$ make || ./sage -i spkg/standard/zn_poly-0.9.p10.spkg && make ptestlong
```


might work the way I want, and building Sage would require less babysitting.

Issue created by migration from https://trac.sagemath.org/ticket/14303





---

archive/issue_comments_176635.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-03-19T01:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14099#issuecomment-176635",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_176636.json:
```json
{
    "body": "Here's a first patch. I wouldn't be surprised if there were better ways of doing this.",
    "created_at": "2013-03-19T01:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14099#issuecomment-176636",
    "user": "jhpalmieri"
}
```

Here's a first patch. I wouldn't be surprised if there were better ways of doing this.



---

archive/issue_comments_176637.json:
```json
{
    "body": "You should check Python also. I would go for\n\n```\nif [ -x \"$SAGE_LOCAL/bin/python\" -a -x \"$SAGE_LOCAL/bin/sage-location\" ]\n```\n",
    "created_at": "2013-03-19T06:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14099#issuecomment-176637",
    "user": "jdemeyer"
}
```

You should check Python also. I would go for

```
if [ -x "$SAGE_LOCAL/bin/python" -a -x "$SAGE_LOCAL/bin/sage-location" ]
```




---

archive/issue_comments_176638.json:
```json
{
    "body": "Just for completeness, you could also use the more \"Pythonic\"\n\n```\nsage-location\nstatus=$?\nif [ $status -eq 126 -o $status -eq 127 ]; then\n    # Python or sage-location doesn't exist\n    exit 0\nfi\nexit $status\n```\n\nbut I wouldn't, since it might use system Python if Sage's Python isn't installed and you would still an error message if it fails to run `sage-location`.",
    "created_at": "2013-03-19T06:40:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14099#issuecomment-176638",
    "user": "jdemeyer"
}
```

Just for completeness, you could also use the more "Pythonic"

```
sage-location
status=$?
if [ $status -eq 126 -o $status -eq 127 ]; then
    # Python or sage-location doesn't exist
    exit 0
fi
exit $status
```

but I wouldn't, since it might use system Python if Sage's Python isn't installed and you would still an error message if it fails to run `sage-location`.



---

archive/issue_comments_176639.json:
```json
{
    "body": "Attachment [trac_14303-location.patch](tarball://root/attachments/some-uuid/ticket14303/trac_14303-location.patch) by jhpalmieri created at 2013-03-19 15:23:30\n\nroot repo",
    "created_at": "2013-03-19T15:23:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14099#issuecomment-176639",
    "user": "jhpalmieri"
}
```

Attachment [trac_14303-location.patch](tarball://root/attachments/some-uuid/ticket14303/trac_14303-location.patch) by jhpalmieri created at 2013-03-19 15:23:30

root repo



---

archive/issue_comments_176640.json:
```json
{
    "body": "Here's a new patch, using `if [ -x \"$SAGE_LOCAL/bin/python\" -a -x \"$SAGE_LOCAL/bin/sage-location\" ]...`.",
    "created_at": "2013-03-19T15:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14099#issuecomment-176640",
    "user": "jhpalmieri"
}
```

Here's a new patch, using `if [ -x "$SAGE_LOCAL/bin/python" -a -x "$SAGE_LOCAL/bin/sage-location" ]...`.



---

archive/issue_comments_176641.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-03-20T07:38:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14099#issuecomment-176641",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_176642.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-03-22T09:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14099#issuecomment-176642",
    "user": "jdemeyer"
}
```

Resolution: fixed
