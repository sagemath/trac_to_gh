# Issue 14099: "sage -i" should only run sage-location if it exists

Issue created by migration from https://trac.sagemath.org/ticket/14303

Original creator: jhpalmieri

Original creation time: 2013-03-19 01:28:56

Assignee: GeorgSWeber

CC:  jdemeyer

Keywords: sage-location

During Sage installation, I sometimes see an spkg fail to build, for example [#13947 zn_poly]. Then I run

```
$ ./sage -i spkg/standard/zn_poly-0.9.p10.spkg
```

If this installs successfully, it still has a return code of 127 (on OS X, at least), because the installation runs `sage-location` at the end, which hasn't been installed yet. So perhaps `sage -i ...` should only run `sage-location` if it already exists.  This way something like

```
$ make || ./sage -i spkg/standard/zn_poly-0.9.p10.spkg && make ptestlong
```


might work the way I want, and building Sage would require less babysitting.


---

Comment by jhpalmieri created at 2013-03-19 01:30:17

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2013-03-19 01:30:17

Here's a first patch. I wouldn't be surprised if there were better ways of doing this.


---

Comment by jdemeyer created at 2013-03-19 06:36:59

You should check Python also. I would go for

```
if [ -x "$SAGE_LOCAL/bin/python" -a -x "$SAGE_LOCAL/bin/sage-location" ]
```



---

Comment by jdemeyer created at 2013-03-19 06:40:53

Just for completeness, you could also use the more "Pythonic"

```
sage-location
status=$?
if [ $status -eq 126 -o $status -eq 127 ]; then
    # Python or sage-location doesn't exist
    exit 0
fi
exit $status
```

but I wouldn't, since it might use system Python if Sage's Python isn't installed and you would still an error message if it fails to run `sage-location`.


---

Attachment

root repo


---

Comment by jhpalmieri created at 2013-03-19 15:24:31

Here's a new patch, using `if [ -x "$SAGE_LOCAL/bin/python" -a -x "$SAGE_LOCAL/bin/sage-location" ]...`.


---

Comment by jdemeyer created at 2013-03-20 07:38:07

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-03-22 09:53:15

Resolution: fixed
