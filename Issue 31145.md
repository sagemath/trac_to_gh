# Issue 31145: bashisms in build/bin/sage-build-env

Issue created by migration from https://trac.sagemath.org/ticket/31382

Original creator: mjo

Original creation time: 2021-02-11 12:55:20

CC:  @kliem

The tests at the top of build/bin/sage-build-env all use the bash double-equals comparison:


```
if [ "x$CFLAGS" == "x" ]; then
    export ORIGINAL_CFLAGS="$CONFIGURED_CFLAGS"
else
    export ORIGINAL_CFLAGS="$CFLAGS"
fi
if [ "x$CXXFLAGS" == "x" ]; then
```


This doesn't do what we want when /bin/sh is something else (Debian, Gentoo,...):


```
$ /bin/sh build/bin/sage-build-env
build/bin/sage-build-env: 27: [: x-O2 -pipe -march=native: unexpected operator
build/bin/sage-build-env: 32: [: x-O2 -pipe -march=native: unexpected operator
build/bin/sage-build-env: 37: [: x-O2 -pipe -march=native: unexpected operator
build/bin/sage-build-env: 42: [: x-O2 -pipe -march=native: unexpected operator
build/bin/sage-build-env: 49: [: x-O2 -pipe -march=native: unexpected operator
build/bin/sage-build-env: 72: [: x-O2 -pipe -march=native: unexpected operator
build/bin/sage-build-env: 85: [: x-O2 -pipe -march=native: unexpected operator
build/bin/sage-build-env: 98: [: x-O2 -pipe -march=native: unexpected operator
```


Fix is easy: use one equals sign.


---

Comment by mjo created at 2021-02-11 13:00:25

New commits:


---

Comment by mjo created at 2021-02-11 13:00:25

Changing status from new to needs_review.


---

Comment by git created at 2021-02-11 13:37:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2021-02-11 13:51:15

Ok. Didn't know that (obviously). LGTM.


---

Comment by @kliem created at 2021-02-11 13:51:15

Changing status from needs_review to positive_review.


---

Comment by mjo created at 2021-02-11 15:19:44

Thanks! I switched to `/bin/sh -> /bin/dash` back when I was working on the configure script every day. It's a lot faster, but earned me the unofficial position of bashism police.


---

Comment by mkoeppe created at 2021-02-11 17:04:01

Changing priority from major to critical.


---

Comment by vbraun created at 2021-03-01 00:21:14

Resolution: fixed
