# Issue 25248: reduced words in coxeter groups

Issue created by migration from https://trac.sagemath.org/ticket/25485

Original creator: stumpc5

Original creation time: 2018-05-31 17:26:57

CC:  tscrim jmichel tdouvropoulos zabrocki aschilling




---

Comment by git created at 2018-06-01 06:49:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by stumpc5 created at 2018-06-01 10:02:52

Changing keywords from "" to "coxeter group, days93.51".


---

Comment by stumpc5 created at 2018-06-01 10:02:52

Changing status from new to needs_review.


---

Comment by stumpc5 created at 2018-06-01 10:02:52

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by stumpc5 created at 2018-06-01 10:02:52

Changing type from PLEASE CHANGE to enhancement.


---

Comment by stumpc5 created at 2018-06-01 10:02:52

have to add some doctests still.

Q: leave the old implementation or not?


---

Comment by git created at 2018-06-01 10:34:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-01 10:38:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by stumpc5 created at 2018-06-01 10:39:13

okay, now ready for review


---

Comment by git created at 2018-06-01 10:41:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-06-01 11:57:33

Old:

```
sage: W = WeylGroup(['A',4])
sage: w0 = WeylGroup(['A',4]).long_element()
sage: %time len(w0.reduced_words())
CPU times: user 1.78 s, sys: 17.4 ms, total: 1.8 s
Wall time: 1.76 s
768
```

Current branch:

```
sage: %time len(w0.reduced_words())
CPU times: user 7.36 ms, sys: 0 ns, total: 7.36 ms
Wall time: 7.19 ms
768
```



---

Comment by tscrim created at 2018-06-01 12:04:47

New commits:


---

Comment by git created at 2018-06-01 12:50:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by stumpc5 created at 2018-06-01 16:49:40

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-06-02 05:16:01

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2018-06-02 05:16:01

Failing doctests. Currently fixing.


---

Comment by git created at 2018-06-02 05:23:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-06-02 05:24:06

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-06-02 05:24:06

Mike, Anne, I put you in cc because I had to change one of the k-Schur function book tests.


---

Comment by aschilling created at 2018-06-02 08:20:56

Replying to [comment:14 tscrim]:
> Mike, Anne, I put you in cc because I had to change one of the k-Schur function book tests.

It only changes the order of the output, right? I guess that is ok.


---

Comment by tscrim created at 2018-06-02 08:26:35

Replying to [comment:15 aschilling]:
> Replying to [comment:14 tscrim]:
> > Mike, Anne, I put you in cc because I had to change one of the k-Schur function book tests.
> 
> It only changes the order of the output, right? I guess that is ok.

It also is now a list of tuples whereas before it was a list of lists. (The `sorted` is because the new algorithm does not have any promises of a consistent output order.)


---

Comment by zabrocki created at 2018-06-02 12:09:42

Is the tuple output necessary for the speed improvement?  If so, I would say it can be justified.  Otherwise I don't think its a good idea to change the output type where it isn't necessary.


---

Comment by stumpc5 created at 2018-06-02 12:40:37

> Is the tuple output necessary for the speed improvement? If so, I would say it can be justified. Otherwise I don't think its a good idea to change the output type where it isn't necessary. 

Yes it is in the following sense. The new algorithm is as follows: take any tuple of integers (a reduced word) and a list of homogeneous replacement rules (braid relations, homogeneous meaning that the replacements do not change length), the algorithms is a brute force computation of this orbit by collecting new tuples into a set to be checked against. (The algorithm can actually be used without reference to reduced words or braid relations.)

So we do need to use tuples for hashing.


---

Comment by zabrocki created at 2018-06-02 12:52:52

Is there significant loss of speed by replacing the line

```
            return list(BraidOrbit(word, self.parent().braid_relations()))
```

by

```
            return [list(w) for w in BraidOrbit(word, self.parent().braid_relations())]
```

?


---

Comment by stumpc5 created at 2018-06-02 12:57:27


```
sage: W = CoxeterGroup(['A',5])
sage: w = W.long_element()
sage: %time len(w.reduced_words())
CPU times: user 1.43 s, sys: 0 ns, total: 1.43 s
Wall time: 1.43 s
292864
sage: %time len([ list(rw) for rw in w.reduced_words()])
CPU times: user 1.92 s, sys: 44.4 ms, total: 1.97 s
Wall time: 1.93 s
292864
```



---

Comment by stumpc5 created at 2018-06-02 13:02:39

I somewhat agree that it is weird that `reduced_word` outputs a list while `reduced_words` outputs tuples.

On the other hand, it seems to me that tuples would be more reasonable altogether because a reduced word is something that "cannot be changed by hand". But I also see that the `list` features might be used in rather many places in main Sage and probably even more in personal code.


---

Comment by stumpc5 created at 2018-06-02 13:03:37

Changing status from needs_review to needs_work.


---

Comment by stumpc5 created at 2018-06-02 13:03:37

Back to "needs work" because it fails on non-int index sets.


---

Comment by git created at 2018-06-02 13:24:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by stumpc5 created at 2018-06-02 13:25:17

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-06-02 13:34:19

IMO, tuples and lists are the same thing except for hashability. So I don't think such a change is important.

That being said, `braid_relations` should not be cached for the mutability (and it is not expensive enough or called often enough to warrant it).


---

Comment by stumpc5 created at 2018-06-02 13:41:23

> or called often enough

The reason I added the `cached_method` was the situation that I want to compute all reduced words of all elements in a group. I find it unreasonable to to explicitly compute the braid relations for each element again (which might take much more time than computing the orbit).

Just checked, it is an overhead of 10%.


---

Comment by tscrim created at 2018-06-02 13:50:41

Replying to [comment:26 stumpc5]:
> > or called often enough
> 
> The reason I added the `cached_method` was the situation that I want to compute all reduced words of all elements in a group. I find it unreasonable to to explicitly compute the braid relations for each element again (which might take much more time than computing the orbit).
> 
> Just checked, it is an overhead of 10%.

It is mutable output, therefore should not be a `cached_method`.

I am also being wary of an over-reliance on caching things, which can lead to memory leaks (nearly everything for this implementation is cached, which I am not saying it does give a memory leak, but it does bloat the memory usage.)


---

Comment by tscrim created at 2018-06-02 13:50:41

Changing status from needs_review to needs_work.


---

Comment by zabrocki created at 2018-06-02 19:10:46

Replying to [comment:25 tscrim]:
> IMO, tuples and lists are the same thing except for hashability. So I don't think such a change is important.

Its not important, but why mess up people's code with random unnecessary changes?  The `reduced_words` code has been in Sage for a long time and the choice was made that it would return lists.  For instance (and I'm not a big user of reduced words), but I looked in some of my files and found random places where code would need to be updated e.g.:

```
def gen_loops( w ):
    R = w.reduced_words()
    if w==G.first():
        return [(0,0),(1,1),(2,2),(3,3)]
    return map(tuple,[w1 + list(reversed(w2)) for w1 in R for w2 in R if w1[-1]!=w2[-1]])
```

Simple fix... but I would request that you don't make a change like that unless its necessary.


---

Comment by git created at 2018-06-03 05:44:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-03 12:30:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-04 09:01:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by stumpc5 created at 2018-06-04 09:08:05

Hi Travis, I agree that values of cached methods should be immutable. On the other hand, I do not agree that such rather cheap methods should not be cached. I'd rather think that all sort of "elementary information" about Coxeter groups should be cached. This is because there are simply **not many** Coxeter groups, so saving such information will never fill up the memory (unless you want to keep zillions of Coxeter groups in memory together with tons of their elementary information). It is a totally different situation for element methods where it is much more crucial to keep track of which information should be kept in memory and which should rather be recomputed per default.

This being said, I don't care enough here, so I simply removed the `chached_method`.


---

Comment by stumpc5 created at 2018-06-04 09:08:50

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-06-05 00:19:35

Like I said, I am just expressing my caution on caching everything; I did not mean to imply that it had to be removed for a positive review (except for the mutability issue).

Thank you for all the fixes.


---

Comment by tscrim created at 2018-06-05 00:19:35

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-06-07 19:18:28


```
sage -t --long src/sage/categories/coxeter_groups.py  # 4 doctests failed
```



---

Comment by vbraun created at 2018-06-07 19:18:28

Changing status from positive_review to needs_work.


---

Comment by git created at 2018-06-08 02:02:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-06-08 02:03:30

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2018-06-08 02:03:30

Some tests needed to be marked as `gap3`.


---

Comment by vbraun created at 2018-06-11 16:31:12

Resolution: fixed
