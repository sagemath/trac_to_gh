# Issue 15757: Python 3 preparation: Change for removed members of types module

Issue created by migration from https://trac.sagemath.org/ticket/15994

Original creator: wluebbe

Original creation time: 2014-03-20 15:39:24

Keywords: python3

Some members were removed from the `types` module in Python 3. 
Replace the deprecated members by their modern equivalents.

Changes according to `lib2to3/fixes/fix_types.py`:

```
  'BooleanType' : 'bool',
  'BufferType' : 'memoryview',
  'ClassType' : 'type',
  'ComplexType' : 'complex',
  'DictType': 'dict',
  'DictionaryType' : 'dict',
  'EllipsisType' : 'type(Ellipsis)',
  'FloatType': 'float',
  'IntType': 'int',
  'ListType': 'list',
  'LongType': 'int',
  'ObjectType' : 'object',
  'NoneType': 'type(None)',
  'NotImplementedType' : 'type(NotImplemented)',
  'SliceType' : 'slice',
  'StringType': 'bytes', # XXX ?
  'StringTypes' : 'str', # XXX ?
  'TupleType': 'tuple',
  'TypeType' : 'type',
  'UnicodeType': 'str',
  'XRangeType' : 'range',
```


This ticket is tracked as a dependency of meta-ticket ticket:15980.


---

Comment by wluebbe created at 2014-03-27 18:21:35

8 failed doctests in src/sage/misc/explain_pickle.py.


---

Attachment

The generated code leads to 8 doctest failures, all of them in `src/sage/misc/explain_pickle.py`.

For details see the attachment.
----
New commits:


---

Comment by wluebbe created at 2014-03-27 19:42:42

There is a Python ticket [2to3 doesn't convert 'types.InstanceType' to 'object'](http://bugs.python.org/issue8206).

The recommendation seems to be

```
or add

try:
  from types import InstanceType
except ImportError:
  InstanceType = object

to the top of the module; this would then work for both 2.x and 3.x (assuming that replacing InstanceType with object is actually correct in the code in question).
```



---

Comment by wluebbe created at 2014-03-28 13:25:50

Status updated to allow "needs work" ...


---

Comment by wluebbe created at 2014-03-28 13:25:50

Changing status from new to needs_review.


---

Comment by wluebbe created at 2014-03-28 13:31:44

Changing status from needs_review to needs_work.


---

Comment by wluebbe created at 2014-03-28 13:31:44

It needs work on the failing doctests.

The failing tests seem all to be concerned with //old style classes//. Python 3 has only //new style classes//. 

Maybe there are no more old style classes in Sage - and those tests might be removed??

Is there somebody familiar with `src/sage/misc/explain_pickle.py` who can comment?


---

Comment by ohanar created at 2014-04-03 21:25:29

There are plenty of old style classes in Sage. A lot of the codebase is ancient and has not received much attention in years. I don't know the module at all, so I can't really help here.


---

Comment by chapoton created at 2016-03-25 08:00:23

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2016-03-25 08:00:23

I am temporarily putting this to needs review to see what are the errors now.


---

Comment by git created at 2016-03-25 12:33:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-03-31 15:15:16

If somebody with expertise in pickles could have a look, that would be great.


---

Comment by chapoton created at 2016-03-31 15:15:16

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2016-04-28 06:49:32

Changing component from distribution to python3.


---

Comment by chapoton created at 2016-07-06 14:25:29

Let us split the "more easy" part of that in #20962.


---

Comment by chapoton created at 2016-07-19 12:46:08

There remains only a very annoying issue with pickle and old-style classes.


---

Comment by chapoton created at 2016-08-12 09:59:54

some work on that in #21230


---

Comment by jdemeyer created at 2016-08-12 11:40:05

I'm willing to have a look at the `explain_pickle.py` thing (but not right now).


---

Comment by chapoton created at 2016-09-23 06:24:08

remains one `XRangeType` and several `ClassType`


---

Comment by chapoton created at 2016-11-12 17:13:12

XRangeType is handled in #21867


---

Comment by chapoton created at 2017-05-01 12:51:17

one instance of ClassType is handled in #22918

there remains only the 2 ClassType in explain_pickle.


---

Comment by jdemeyer created at 2017-06-27 05:44:01

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-06-27 05:44:01

This one was actually easy: you just need to pretend that `isinstance(foo, types.ClassType)` is always `False` on Python 3.

Note that I also did some cleanup, including adding an unrelated doctest. I hope that is acceptable.
----
New commits:


---

Comment by chapoton created at 2017-06-28 14:26:41

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2017-06-28 14:26:41

ok,let it be. Thanks


---

Comment by vbraun created at 2017-06-29 06:46:39

Resolution: fixed
