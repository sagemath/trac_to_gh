# Issue 13556: Wrong basic interval arithmetic in PolynomialRing

Issue created by migration from https://trac.sagemath.org/ticket/13760

Original creator: gmoroz

Original creation time: 2012-11-26 13:20:10

Assignee: AlexGhitza

CC:  burcin mhansen malb zimmerma

Keywords: interval, polynomial, multivariate

Some multiplications in multivariate polynomial rings over RIF or CIF are wrong:


```
sage: R.<x,y> = PolynomialRing(RIF,2)
sage: RIF(-2,1)*x
0
```



## More tests


```
sage: R.<x,y> = PolynomialRing(RIF,2)
sage: RIF(-2,1)          # OK
0.?e1
sage: RIF(-2,1)*x        # Wrong
0
sage: RIF(-2,1)*x == 0   # Wrong
True
sage: cmp(RIF(-2,1)*x,0) # Wrong
0
sage: RIF(2,5)*x         # OK
1.?e1*x
sage: RIF(2,5)*x == 0    # OK
False
```


## Code digging

The problem comes from the coercion:

```
sage: R(RIF(-2,1))
0
sage: R(RIF(-2,1)) == 0
True
```


This in turn comes from the creation (in `__init__` of class `MPolynomial_polydict` in `sage.rings.polynomial.multi_polynomial_element`) of a PolyDict object (defined in `sage.rings.polynomial.polydict`) with the option `remove_zero == True`.


```
from sage.rings.polynomial.polydict import PolyDict
sage: PolyDict({(0,0):1}, remove_zero=True) # OK
PolyDict with representation {(0, 0): 1}
sage: PolyDict({(0,0):0}, remove_zero=True) # OK
PolyDict with representation {}
sage: PolyDict({(0,0):RIF(-1,1)}, remove_zero=True) # Wrong
PolyDict with representation {}
```


To check if x is 0, PolyDict uses the test `x != 0`, which actually checks for disjointness in interval field:


```
sage: RIF(-2,1) != 0
False
```



## Possible correction

This bug might be corrected by replacing in PolyDict the tests `x != zero` by one of:
- `cmp(x,0) != zero`
- `not x.is_zero()`
- `not x == zero`


---

Comment by gmoroz created at 2012-11-26 15:21:33

A patch changing `x != zero` by `not x == zero`.


---

Attachment


---

Comment by gmoroz created at 2012-11-27 13:13:46

Changing status from new to needs_review.


---

Comment by zimmerma created at 2012-12-07 17:07:23

Guillaume, a non-regression test is missing (also for #7712).

Paul


---

Comment by zimmerma created at 2012-12-07 17:07:42

Changing status from needs_review to needs_work.


---

Comment by zimmerma created at 2012-12-13 09:33:01

all tests pass on top of 5.4.1, just waiting for a non-regression test.

Paul


---

Comment by gmoroz created at 2012-12-13 11:04:48

add regression tests (to be applied after the fix patch)


---

Attachment

Guillaume, why didn't you add as regression tests the examples in the description of #7712 and this ticket?

Paul


---

Comment by zimmerma created at 2012-12-14 08:24:11

all tests pass with the regression tests.

Paul


---

Comment by gmoroz created at 2012-12-14 09:50:12

I attached the patch with regression tests with user level examples on #7712 (this choice was quite random).


---

Comment by gmoroz created at 2012-12-14 09:50:24

Changing status from needs_work to needs_review.


---

Comment by gmoroz created at 2012-12-14 10:31:15

Includes regression tests for #7712 and #13760 (same patch as in #7712, moved here for convenience)


---

Comment by zimmerma created at 2012-12-14 17:15:07

Changing status from needs_review to positive_review.


---

Attachment


---

Comment by jdemeyer created at 2012-12-15 02:28:57

Please indicate which patch(es) need to be applied.


---

Comment by zimmerma created at 2012-12-15 07:41:44

Replying to [comment:13 jdemeyer]:
> Please indicate which patch(es) need to be applied.

Done.
Paul


---

Comment by tscrim created at 2012-12-15 16:41:16

One very minor documentation thing, there should be a blankline after any double colon `::` (see line 514 in the [attachment:trac_13760_regression_tests.patch]). Thanks.


---

Comment by gmoroz created at 2012-12-19 15:38:00

Replying to [comment:16 tscrim]:
> One very minor documentation thing, there should be a blankline after any double colon `::` (see line 514 in the [attachment:trac_13760_regression_tests.patch]). Thanks.

It seems that I cannot attach a new patch for that. Is it because of the positive review status?


---

Comment by tscrim created at 2012-12-19 17:36:48

Replying to [comment:17 gmoroz]:
> It seems that I cannot attach a new patch for that. Is it because of the positive review status?

Strange...I don't think so, but I'll set this to needs work and try it then.


---

Comment by tscrim created at 2012-12-19 17:36:48

Changing status from positive_review to needs_work.


---

Attachment


---

Comment by gmoroz created at 2012-12-19 18:09:29

Replying to [comment:18 tscrim]:
> Strange...I don't think so, but I'll set this to needs work and try it then.
My bad, it appears that my file didn't have permissions to be read.


---

Comment by tscrim created at 2012-12-19 19:25:26

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2012-12-19 19:25:26

Thanks for fixing this.


---

Comment by jdemeyer created at 2012-12-21 09:33:23

Resolution: fixed
