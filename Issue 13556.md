# Issue 13556: Wrong basic interval arithmetic in PolynomialRing

archive/issues_013556.json:
```json
{
    "body": "Assignee: AlexGhitza\n\nCC:  burcin mhansen malb zimmerma\n\nKeywords: interval, polynomial, multivariate\n\nSome multiplications in multivariate polynomial rings over RIF or CIF are wrong:\n\n\n```\nsage: R.<x,y> = PolynomialRing(RIF,2)\nsage: RIF(-2,1)*x\n0\n```\n\n\n\n## More tests\n\n\n```\nsage: R.<x,y> = PolynomialRing(RIF,2)\nsage: RIF(-2,1)          # OK\n0.?e1\nsage: RIF(-2,1)*x        # Wrong\n0\nsage: RIF(-2,1)*x == 0   # Wrong\nTrue\nsage: cmp(RIF(-2,1)*x,0) # Wrong\n0\nsage: RIF(2,5)*x         # OK\n1.?e1*x\nsage: RIF(2,5)*x == 0    # OK\nFalse\n```\n\n\n## Code digging\n\nThe problem comes from the coercion:\n\n```\nsage: R(RIF(-2,1))\n0\nsage: R(RIF(-2,1)) == 0\nTrue\n```\n\n\nThis in turn comes from the creation (in `__init__` of class `MPolynomial_polydict` in `sage.rings.polynomial.multi_polynomial_element`) of a PolyDict object (defined in `sage.rings.polynomial.polydict`) with the option `remove_zero == True`.\n\n\n```\nfrom sage.rings.polynomial.polydict import PolyDict\nsage: PolyDict({(0,0):1}, remove_zero=True) # OK\nPolyDict with representation {(0, 0): 1}\nsage: PolyDict({(0,0):0}, remove_zero=True) # OK\nPolyDict with representation {}\nsage: PolyDict({(0,0):RIF(-1,1)}, remove_zero=True) # Wrong\nPolyDict with representation {}\n```\n\n\nTo check if x is 0, PolyDict uses the test `x != 0`, which actually checks for disjointness in interval field:\n\n\n```\nsage: RIF(-2,1) != 0\nFalse\n```\n\n\n\n## Possible correction\n\nThis bug might be corrected by replacing in PolyDict the tests `x != zero` by one of:\n- `cmp(x,0) != zero`\n- `not x.is_zero()`\n- `not x == zero`\n\nIssue created by migration from https://trac.sagemath.org/ticket/13760\n\n",
    "created_at": "2012-11-26T13:20:10Z",
    "labels": [
        "basic arithmetic",
        "major",
        "bug"
    ],
    "title": "Wrong basic interval arithmetic in PolynomialRing",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13556",
    "user": "gmoroz"
}
```
Assignee: AlexGhitza

CC:  burcin mhansen malb zimmerma

Keywords: interval, polynomial, multivariate

Some multiplications in multivariate polynomial rings over RIF or CIF are wrong:


```
sage: R.<x,y> = PolynomialRing(RIF,2)
sage: RIF(-2,1)*x
0
```



## More tests


```
sage: R.<x,y> = PolynomialRing(RIF,2)
sage: RIF(-2,1)          # OK
0.?e1
sage: RIF(-2,1)*x        # Wrong
0
sage: RIF(-2,1)*x == 0   # Wrong
True
sage: cmp(RIF(-2,1)*x,0) # Wrong
0
sage: RIF(2,5)*x         # OK
1.?e1*x
sage: RIF(2,5)*x == 0    # OK
False
```


## Code digging

The problem comes from the coercion:

```
sage: R(RIF(-2,1))
0
sage: R(RIF(-2,1)) == 0
True
```


This in turn comes from the creation (in `__init__` of class `MPolynomial_polydict` in `sage.rings.polynomial.multi_polynomial_element`) of a PolyDict object (defined in `sage.rings.polynomial.polydict`) with the option `remove_zero == True`.


```
from sage.rings.polynomial.polydict import PolyDict
sage: PolyDict({(0,0):1}, remove_zero=True) # OK
PolyDict with representation {(0, 0): 1}
sage: PolyDict({(0,0):0}, remove_zero=True) # OK
PolyDict with representation {}
sage: PolyDict({(0,0):RIF(-1,1)}, remove_zero=True) # Wrong
PolyDict with representation {}
```


To check if x is 0, PolyDict uses the test `x != 0`, which actually checks for disjointness in interval field:


```
sage: RIF(-2,1) != 0
False
```



## Possible correction

This bug might be corrected by replacing in PolyDict the tests `x != zero` by one of:
- `cmp(x,0) != zero`
- `not x.is_zero()`
- `not x == zero`

Issue created by migration from https://trac.sagemath.org/ticket/13760





---

archive/issue_comments_167599.json:
```json
{
    "body": "A patch changing `x != zero` by `not x == zero`.",
    "created_at": "2012-11-26T15:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167599",
    "user": "gmoroz"
}
```

A patch changing `x != zero` by `not x == zero`.



---

archive/issue_comments_167600.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-11-26T15:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167600",
    "user": "gmoroz"
}
```

Attachment



---

archive/issue_comments_167601.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-11-27T13:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167601",
    "user": "gmoroz"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_167602.json:
```json
{
    "body": "Guillaume, a non-regression test is missing (also for #7712).\n\nPaul",
    "created_at": "2012-12-07T17:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167602",
    "user": "zimmerma"
}
```

Guillaume, a non-regression test is missing (also for #7712).

Paul



---

archive/issue_comments_167603.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-12-07T17:07:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167603",
    "user": "zimmerma"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_167604.json:
```json
{
    "body": "all tests pass on top of 5.4.1, just waiting for a non-regression test.\n\nPaul",
    "created_at": "2012-12-13T09:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167604",
    "user": "zimmerma"
}
```

all tests pass on top of 5.4.1, just waiting for a non-regression test.

Paul



---

archive/issue_comments_167605.json:
```json
{
    "body": "add regression tests (to be applied after the fix patch)",
    "created_at": "2012-12-13T11:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167605",
    "user": "gmoroz"
}
```

add regression tests (to be applied after the fix patch)



---

archive/issue_comments_167606.json:
```json
{
    "body": "Attachment\n\nGuillaume, why didn't you add as regression tests the examples in the description of #7712 and this ticket?\n\nPaul",
    "created_at": "2012-12-14T08:11:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167606",
    "user": "zimmerma"
}
```

Attachment

Guillaume, why didn't you add as regression tests the examples in the description of #7712 and this ticket?

Paul



---

archive/issue_comments_167607.json:
```json
{
    "body": "all tests pass with the regression tests.\n\nPaul",
    "created_at": "2012-12-14T08:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167607",
    "user": "zimmerma"
}
```

all tests pass with the regression tests.

Paul



---

archive/issue_comments_167608.json:
```json
{
    "body": "I attached the patch with regression tests with user level examples on #7712 (this choice was quite random).",
    "created_at": "2012-12-14T09:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167608",
    "user": "gmoroz"
}
```

I attached the patch with regression tests with user level examples on #7712 (this choice was quite random).



---

archive/issue_comments_167609.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-12-14T09:50:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167609",
    "user": "gmoroz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_167610.json:
```json
{
    "body": "Includes regression tests for #7712 and #13760 (same patch as in #7712, moved here for convenience)",
    "created_at": "2012-12-14T10:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167610",
    "user": "gmoroz"
}
```

Includes regression tests for #7712 and #13760 (same patch as in #7712, moved here for convenience)



---

archive/issue_comments_167611.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-12-14T17:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167611",
    "user": "zimmerma"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_167612.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-12-14T17:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167612",
    "user": "zimmerma"
}
```

Attachment



---

archive/issue_comments_167613.json:
```json
{
    "body": "Please indicate which patch(es) need to be applied.",
    "created_at": "2012-12-15T02:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167613",
    "user": "jdemeyer"
}
```

Please indicate which patch(es) need to be applied.



---

archive/issue_comments_167614.json:
```json
{
    "body": "Replying to [comment:13 jdemeyer]:\n> Please indicate which patch(es) need to be applied.\n\nDone.\nPaul",
    "created_at": "2012-12-15T07:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167614",
    "user": "zimmerma"
}
```

Replying to [comment:13 jdemeyer]:
> Please indicate which patch(es) need to be applied.

Done.
Paul



---

archive/issue_comments_167615.json:
```json
{
    "body": "One very minor documentation thing, there should be a blankline after any double colon `::` (see line 514 in the [attachment:trac_13760_regression_tests.patch]). Thanks.",
    "created_at": "2012-12-15T16:41:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167615",
    "user": "tscrim"
}
```

One very minor documentation thing, there should be a blankline after any double colon `::` (see line 514 in the [attachment:trac_13760_regression_tests.patch]). Thanks.



---

archive/issue_comments_167616.json:
```json
{
    "body": "Replying to [comment:16 tscrim]:\n> One very minor documentation thing, there should be a blankline after any double colon `::` (see line 514 in the [attachment:trac_13760_regression_tests.patch]). Thanks.\n\nIt seems that I cannot attach a new patch for that. Is it because of the positive review status?",
    "created_at": "2012-12-19T15:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167616",
    "user": "gmoroz"
}
```

Replying to [comment:16 tscrim]:
> One very minor documentation thing, there should be a blankline after any double colon `::` (see line 514 in the [attachment:trac_13760_regression_tests.patch]). Thanks.

It seems that I cannot attach a new patch for that. Is it because of the positive review status?



---

archive/issue_comments_167617.json:
```json
{
    "body": "Replying to [comment:17 gmoroz]:\n> It seems that I cannot attach a new patch for that. Is it because of the positive review status?\n\nStrange...I don't think so, but I'll set this to needs work and try it then.",
    "created_at": "2012-12-19T17:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167617",
    "user": "tscrim"
}
```

Replying to [comment:17 gmoroz]:
> It seems that I cannot attach a new patch for that. Is it because of the positive review status?

Strange...I don't think so, but I'll set this to needs work and try it then.



---

archive/issue_comments_167618.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-12-19T17:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167618",
    "user": "tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_167619.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-12-19T18:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167619",
    "user": "gmoroz"
}
```

Attachment



---

archive/issue_comments_167620.json:
```json
{
    "body": "Replying to [comment:18 tscrim]:\n> Strange...I don't think so, but I'll set this to needs work and try it then.\nMy bad, it appears that my file didn't have permissions to be read.",
    "created_at": "2012-12-19T18:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167620",
    "user": "gmoroz"
}
```

Replying to [comment:18 tscrim]:
> Strange...I don't think so, but I'll set this to needs work and try it then.
My bad, it appears that my file didn't have permissions to be read.



---

archive/issue_comments_167621.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-12-19T19:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167621",
    "user": "tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_167622.json:
```json
{
    "body": "Thanks for fixing this.",
    "created_at": "2012-12-19T19:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167622",
    "user": "tscrim"
}
```

Thanks for fixing this.



---

archive/issue_comments_167623.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-12-21T09:33:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13556#issuecomment-167623",
    "user": "jdemeyer"
}
```

Resolution: fixed
