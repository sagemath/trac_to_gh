# Issue 23851: build hangs on ipykernel

Issue created by migration from Trac.

Original creator: mderickx

Original creation time: 2017-10-22 19:39:40

[At](https://patchbot.sagemath.org/log/0/Ubuntu/16.04/x86_64/4.4.0-96-generic/petitbonum/2017-10-22%2018:09:18?short) [least](https://patchbot.sagemath.org/log/0/Ubuntu/16.04/x86_64/4.4.0-97-generic/quasar/2017-10-22%2017:48:41?short) [three](https://patchbot.sagemath.org/log/0/Ubuntu/15.10/x86_64/3.13.0-123-generic/sagemath-patchbot-docker/2017-10-22%2017:24:17?short) patchbots fail during the build of ipykernel since 8.1.beta9. 

Most relevant part of the install log (which is messed up due to parallel builds)

```
[ipykernel-4.6.1]     Traceback (most recent call last):
[ipykernel-4.6.1]       File "<string>", line 1, in <module>
[ipykernel-4.6.1]       File "/tmp/pip-n397X9-build/setup.py", line 91, in <module>
[ipykernel-4.6.1]         from ipykernel.kernelspec import write_kernel_spec, make_ipkernel_cmd, KERNEL_NAME
[ipykernel-4.6.1]       File "ipykernel/__init__.py", line 2, in <module>
[ipykernel-4.6.1]         from .connect import *
[ipykernel-4.6.1]       File "ipykernel/connect.py", line 13, in <module>
[ipykernel-4.6.1]         from IPython.core.profiledir import ProfileDir
[ipykernel-4.6.1]       File "/opt/sage/local/lib/python2.7/site-packages/IPython/__init__.py", line 48, in <module>
[ipykernel-4.6.1]         from .core.application import Application
[ipykernel-4.6.1]       File "/opt/sage/local/lib/python2.7/site-packages/IPython/core/application.py", line 23, in <module>
[ipykernel-4.6.1]         from traitlets.config.application import Application, catch_config_error
[ipykernel-4.6.1]       File "/opt/sage/local/lib/python2.7/site-packages/traitlets/__init__.py", line 1, in <module>
[numpy-1.13.3.p0] gcc: numpy/core/src/npymath/npy_math.c
[ipykernel-4.6.1]         from .traitlets import *
[ipykernel-4.6.1]       File "/opt/sage/local/lib/python2.7/site-packages/traitlets/traitlets.py", line 60, in <module>
[ipykernel-4.6.1]         from .utils.importstring import import_item
[ipykernel-4.6.1]       File "/opt/sage/local/lib/python2.7/site-packages/traitlets/utils/importstring.py", line 8, in <module>
[ipykernel-4.6.1]         from ipython_genutils.py3compat import cast_bytes_py2
[ipykernel-4.6.1]     ImportError: No module named ipython_genutils.py3compat
```



---

Comment by fbissey created at 2017-10-22 20:10:46

It is very curious as the log shows that `traitlets` is installed and used, and it should have pulled `ipython_genutils` in fact looking at it closer, one can see the failing call is from traitlets. The quoted github issue is most relevant here I think.


---

Comment by fbissey created at 2017-10-22 20:13:20

In fact it is worse than the github issue. In the github issue, `pip` solves the dependencies, in sage it is done by the master makefile and we still fail.


---

Comment by jdemeyer created at 2017-10-22 20:37:30

I think this is just missing a dependency of `ipykernel` on `ipython`.


---

Comment by fbissey created at 2017-10-22 21:04:01

Changing status from new to needs_review.


---

Comment by fbissey created at 2017-10-22 21:04:01

That should definitely be there and it *should* be enough.
----
New commits:


---

Comment by git created at 2017-10-22 21:09:06

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2017-10-22 21:11:33

Replying to [comment:7 fbissey]:
> That should definitely be there and it *should* be enough.

Actually, it is not. But after adding a few more dependencies, it works now.


---

Comment by fbissey created at 2017-10-22 21:43:58

Indeed, I should have noticed `jupyter_client` and good spotting on `dateutils`.


---

Comment by egourgoulhon created at 2017-10-23 11:31:38

Just to confirm that this solves the issue of building Sage 8.1.beta9 from a fresh git clone. So +1 for the positive review.


---

Comment by mderickx created at 2017-10-23 12:16:55

I'm a bit confused by the status of this ticket. It was changed from new to needs review by the reviewer, so I do not know wether Jeroen thinks it is already ready for review. Anyway I am moving it to "needs work" so that other people can put it in the correct status.


---

Comment by mderickx created at 2017-10-23 12:16:55

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2017-10-23 12:37:51

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-10-23 12:37:51

Replying to [comment:12 mderickx]:
> I'm a bit confused by the status of this ticket. It was changed from new to needs review by the reviewer

Yes, that was confusing indeed.

But it needs review now.


---

Comment by mderickx created at 2017-10-23 15:56:18

Changing status from needs_review to positive_review.


---

Comment by mderickx created at 2017-10-23 15:56:18

Ok, I checked that with this branch the dependencies of ipykernel agree with what is listed on Pypi (tornado is indirectly coming via the ipython dependency), and it fixes the problem so positive review from me.


---

Comment by fbissey created at 2017-10-23 20:19:43

Must have been still sleepy, I thought Jeroen had put it for review. Until a ticket has been put to "needs review" once you cannot click "positive review" so I must have clicked what was clickable next to it.


---

Comment by vbraun created at 2017-10-25 06:58:12

Resolution: fixed
