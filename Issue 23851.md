# Issue 23851: build hangs on ipykernel

archive/issues_023851.json:
```json
{
    "body": "[At](https://patchbot.sagemath.org/log/0/Ubuntu/16.04/x86_64/4.4.0-96-generic/petitbonum/2017-10-22%2018:09:18?short) [least](https://patchbot.sagemath.org/log/0/Ubuntu/16.04/x86_64/4.4.0-97-generic/quasar/2017-10-22%2017:48:41?short) [three](https://patchbot.sagemath.org/log/0/Ubuntu/15.10/x86_64/3.13.0-123-generic/sagemath-patchbot-docker/2017-10-22%2017:24:17?short) patchbots fail during the build of ipykernel since 8.1.beta9. \n\nMost relevant part of the install log (which is messed up due to parallel builds)\n\n```\n[ipykernel-4.6.1]     Traceback (most recent call last):\n[ipykernel-4.6.1]       File \"<string>\", line 1, in <module>\n[ipykernel-4.6.1]       File \"/tmp/pip-n397X9-build/setup.py\", line 91, in <module>\n[ipykernel-4.6.1]         from ipykernel.kernelspec import write_kernel_spec, make_ipkernel_cmd, KERNEL_NAME\n[ipykernel-4.6.1]       File \"ipykernel/__init__.py\", line 2, in <module>\n[ipykernel-4.6.1]         from .connect import *\n[ipykernel-4.6.1]       File \"ipykernel/connect.py\", line 13, in <module>\n[ipykernel-4.6.1]         from IPython.core.profiledir import ProfileDir\n[ipykernel-4.6.1]       File \"/opt/sage/local/lib/python2.7/site-packages/IPython/__init__.py\", line 48, in <module>\n[ipykernel-4.6.1]         from .core.application import Application\n[ipykernel-4.6.1]       File \"/opt/sage/local/lib/python2.7/site-packages/IPython/core/application.py\", line 23, in <module>\n[ipykernel-4.6.1]         from traitlets.config.application import Application, catch_config_error\n[ipykernel-4.6.1]       File \"/opt/sage/local/lib/python2.7/site-packages/traitlets/__init__.py\", line 1, in <module>\n[numpy-1.13.3.p0] gcc: numpy/core/src/npymath/npy_math.c\n[ipykernel-4.6.1]         from .traitlets import *\n[ipykernel-4.6.1]       File \"/opt/sage/local/lib/python2.7/site-packages/traitlets/traitlets.py\", line 60, in <module>\n[ipykernel-4.6.1]         from .utils.importstring import import_item\n[ipykernel-4.6.1]       File \"/opt/sage/local/lib/python2.7/site-packages/traitlets/utils/importstring.py\", line 8, in <module>\n[ipykernel-4.6.1]         from ipython_genutils.py3compat import cast_bytes_py2\n[ipykernel-4.6.1]     ImportError: No module named ipython_genutils.py3compat\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24088\n\n",
    "created_at": "2017-10-22T19:39:40Z",
    "labels": [
        "packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "build hangs on ipykernel",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23851",
    "user": "mderickx"
}
```
[At](https://patchbot.sagemath.org/log/0/Ubuntu/16.04/x86_64/4.4.0-96-generic/petitbonum/2017-10-22%2018:09:18?short) [least](https://patchbot.sagemath.org/log/0/Ubuntu/16.04/x86_64/4.4.0-97-generic/quasar/2017-10-22%2017:48:41?short) [three](https://patchbot.sagemath.org/log/0/Ubuntu/15.10/x86_64/3.13.0-123-generic/sagemath-patchbot-docker/2017-10-22%2017:24:17?short) patchbots fail during the build of ipykernel since 8.1.beta9. 

Most relevant part of the install log (which is messed up due to parallel builds)

```
[ipykernel-4.6.1]     Traceback (most recent call last):
[ipykernel-4.6.1]       File "<string>", line 1, in <module>
[ipykernel-4.6.1]       File "/tmp/pip-n397X9-build/setup.py", line 91, in <module>
[ipykernel-4.6.1]         from ipykernel.kernelspec import write_kernel_spec, make_ipkernel_cmd, KERNEL_NAME
[ipykernel-4.6.1]       File "ipykernel/__init__.py", line 2, in <module>
[ipykernel-4.6.1]         from .connect import *
[ipykernel-4.6.1]       File "ipykernel/connect.py", line 13, in <module>
[ipykernel-4.6.1]         from IPython.core.profiledir import ProfileDir
[ipykernel-4.6.1]       File "/opt/sage/local/lib/python2.7/site-packages/IPython/__init__.py", line 48, in <module>
[ipykernel-4.6.1]         from .core.application import Application
[ipykernel-4.6.1]       File "/opt/sage/local/lib/python2.7/site-packages/IPython/core/application.py", line 23, in <module>
[ipykernel-4.6.1]         from traitlets.config.application import Application, catch_config_error
[ipykernel-4.6.1]       File "/opt/sage/local/lib/python2.7/site-packages/traitlets/__init__.py", line 1, in <module>
[numpy-1.13.3.p0] gcc: numpy/core/src/npymath/npy_math.c
[ipykernel-4.6.1]         from .traitlets import *
[ipykernel-4.6.1]       File "/opt/sage/local/lib/python2.7/site-packages/traitlets/traitlets.py", line 60, in <module>
[ipykernel-4.6.1]         from .utils.importstring import import_item
[ipykernel-4.6.1]       File "/opt/sage/local/lib/python2.7/site-packages/traitlets/utils/importstring.py", line 8, in <module>
[ipykernel-4.6.1]         from ipython_genutils.py3compat import cast_bytes_py2
[ipykernel-4.6.1]     ImportError: No module named ipython_genutils.py3compat
```


Issue created by migration from https://trac.sagemath.org/ticket/24088





---

archive/issue_comments_334245.json:
```json
{
    "body": "It is very curious as the log shows that `traitlets` is installed and used, and it should have pulled `ipython_genutils` in fact looking at it closer, one can see the failing call is from traitlets. The quoted github issue is most relevant here I think.",
    "created_at": "2017-10-22T20:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23851#issuecomment-334245",
    "user": "fbissey"
}
```

It is very curious as the log shows that `traitlets` is installed and used, and it should have pulled `ipython_genutils` in fact looking at it closer, one can see the failing call is from traitlets. The quoted github issue is most relevant here I think.



---

archive/issue_comments_334246.json:
```json
{
    "body": "In fact it is worse than the github issue. In the github issue, `pip` solves the dependencies, in sage it is done by the master makefile and we still fail.",
    "created_at": "2017-10-22T20:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23851#issuecomment-334246",
    "user": "fbissey"
}
```

In fact it is worse than the github issue. In the github issue, `pip` solves the dependencies, in sage it is done by the master makefile and we still fail.



---

archive/issue_comments_334247.json:
```json
{
    "body": "I think this is just missing a dependency of `ipykernel` on `ipython`.",
    "created_at": "2017-10-22T20:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23851#issuecomment-334247",
    "user": "jdemeyer"
}
```

I think this is just missing a dependency of `ipykernel` on `ipython`.



---

archive/issue_comments_334248.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-22T21:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23851#issuecomment-334248",
    "user": "fbissey"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_334249.json:
```json
{
    "body": "That should definitely be there and it *should* be enough.\n----\nNew commits:",
    "created_at": "2017-10-22T21:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23851#issuecomment-334249",
    "user": "fbissey"
}
```

That should definitely be there and it *should* be enough.
----
New commits:



---

archive/issue_comments_334250.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-10-22T21:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23851#issuecomment-334250",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_334251.json:
```json
{
    "body": "Replying to [comment:7 fbissey]:\n> That should definitely be there and it *should* be enough.\n\nActually, it is not. But after adding a few more dependencies, it works now.",
    "created_at": "2017-10-22T21:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23851#issuecomment-334251",
    "user": "jdemeyer"
}
```

Replying to [comment:7 fbissey]:
> That should definitely be there and it *should* be enough.

Actually, it is not. But after adding a few more dependencies, it works now.



---

archive/issue_comments_334252.json:
```json
{
    "body": "Indeed, I should have noticed `jupyter_client` and good spotting on `dateutils`.",
    "created_at": "2017-10-22T21:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23851#issuecomment-334252",
    "user": "fbissey"
}
```

Indeed, I should have noticed `jupyter_client` and good spotting on `dateutils`.



---

archive/issue_comments_334253.json:
```json
{
    "body": "Just to confirm that this solves the issue of building Sage 8.1.beta9 from a fresh git clone. So +1 for the positive review.",
    "created_at": "2017-10-23T11:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23851#issuecomment-334253",
    "user": "egourgoulhon"
}
```

Just to confirm that this solves the issue of building Sage 8.1.beta9 from a fresh git clone. So +1 for the positive review.



---

archive/issue_comments_334254.json:
```json
{
    "body": "I'm a bit confused by the status of this ticket. It was changed from new to needs review by the reviewer, so I do not know wether Jeroen thinks it is already ready for review. Anyway I am moving it to \"needs work\" so that other people can put it in the correct status.",
    "created_at": "2017-10-23T12:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23851#issuecomment-334254",
    "user": "mderickx"
}
```

I'm a bit confused by the status of this ticket. It was changed from new to needs review by the reviewer, so I do not know wether Jeroen thinks it is already ready for review. Anyway I am moving it to "needs work" so that other people can put it in the correct status.



---

archive/issue_comments_334255.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-23T12:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23851#issuecomment-334255",
    "user": "mderickx"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_334256.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-23T12:37:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23851#issuecomment-334256",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_334257.json:
```json
{
    "body": "Replying to [comment:12 mderickx]:\n> I'm a bit confused by the status of this ticket. It was changed from new to needs review by the reviewer\n\nYes, that was confusing indeed.\n\nBut it needs review now.",
    "created_at": "2017-10-23T12:37:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23851#issuecomment-334257",
    "user": "jdemeyer"
}
```

Replying to [comment:12 mderickx]:
> I'm a bit confused by the status of this ticket. It was changed from new to needs review by the reviewer

Yes, that was confusing indeed.

But it needs review now.



---

archive/issue_comments_334258.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-23T15:56:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23851#issuecomment-334258",
    "user": "mderickx"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_334259.json:
```json
{
    "body": "Ok, I checked that with this branch the dependencies of ipykernel agree with what is listed on Pypi (tornado is indirectly coming via the ipython dependency), and it fixes the problem so positive review from me.",
    "created_at": "2017-10-23T15:56:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23851#issuecomment-334259",
    "user": "mderickx"
}
```

Ok, I checked that with this branch the dependencies of ipykernel agree with what is listed on Pypi (tornado is indirectly coming via the ipython dependency), and it fixes the problem so positive review from me.



---

archive/issue_comments_334260.json:
```json
{
    "body": "Must have been still sleepy, I thought Jeroen had put it for review. Until a ticket has been put to \"needs review\" once you cannot click \"positive review\" so I must have clicked what was clickable next to it.",
    "created_at": "2017-10-23T20:19:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23851#issuecomment-334260",
    "user": "fbissey"
}
```

Must have been still sleepy, I thought Jeroen had put it for review. Until a ticket has been put to "needs review" once you cannot click "positive review" so I must have clicked what was clickable next to it.



---

archive/issue_comments_334261.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-25T06:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23851#issuecomment-334261",
    "user": "vbraun"
}
```

Resolution: fixed
