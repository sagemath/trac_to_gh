# Issue 13041: Comparisons in real number field

archive/issues_013041.json:
```json
{
    "body": "Assignee: @videlec\n\nKeywords: real number field, comparison\n\nProvide the order from RR for number field embedded in RR as in\n\n```\nsage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)\nsage: sqrt2 - 1 > 0\nTrue\nsage: sqrt2 < 2\nTrue\n```\n\n\nThere is a patch for quadratic field. Another one is comming for general number fields.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13213\n\n",
    "created_at": "2012-07-08T18:45:16Z",
    "labels": [
        "number fields",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "Comparisons in real number field",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13041",
    "user": "@videlec"
}
```
Assignee: @videlec

Keywords: real number field, comparison

Provide the order from RR for number field embedded in RR as in

```
sage: K.<sqrt2> = NumberField(x^2 - 2, 'sqrt2', embedding=1.4142)
sage: sqrt2 - 1 > 0
True
sage: sqrt2 < 2
True
```


There is a patch for quadratic field. Another one is comming for general number fields.

Issue created by migration from https://trac.sagemath.org/ticket/13213





---

archive/issue_comments_158078.json:
```json
{
    "body": "I had a short look at your patch.\nCould you use Python 3 compatible syntax to raise errors. E.g.\n\n```\nraise ValueError(\"absolute value not implemented for complex embeddings\")\n```\n",
    "created_at": "2012-07-08T19:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158078",
    "user": "@a-andre"
}
```

I had a short look at your patch.
Could you use Python 3 compatible syntax to raise errors. E.g.

```
raise ValueError("absolute value not implemented for complex embeddings")
```




---

archive/issue_comments_158079.json:
```json
{
    "body": "Thanks again for the patch. A few comments:\n\n* reimplementing the comparison of quadratic number field elements is a well defined unit of change itself. I suggest moving `floor()` and `ceil()` implementations to a separate patch, even a different ticket.\n* Do you really need to use rich comparisons? Working only with `__cmp__` should simplify the case comparisons before the return statements and avoid the new `python_object.pxi` include.\n* I guess speed could be further improved by using an approximation (with `double`s say) first and falling back to the exact computation if the results are too close.\n* `left.D` is of type `Integer`. Cython tries to do the right thing for `<unsigned int> left.D`, but it would be better to use `mpz_mul()` with `left.D.value`.\n* `mpz_sgn()` returns 0 if the argument is `0`. You don't seem to cover this case, though I couldn't find any example that returns wrong results.\n* To avoid code duplication, it might be better change the if statement to:\n\n```\n        if mpz_sgn(i)*mpz_sgn(j) == 1:\n            # both i and j are positive or negative\n            mpz_mul(i, i, i)\n            mpz_mul(j, j, j)\n            mpz_mul_ui(j, j, <unsigned int> left.D)\n\n            test = mpz_cmp(i, j)\n            if mpz_sgn(i) == -1:\n                # both i and j are negative\n                test *= -1\n```\n",
    "created_at": "2012-07-10T17:04:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158079",
    "user": "@burcin"
}
```

Thanks again for the patch. A few comments:

* reimplementing the comparison of quadratic number field elements is a well defined unit of change itself. I suggest moving `floor()` and `ceil()` implementations to a separate patch, even a different ticket.
* Do you really need to use rich comparisons? Working only with `__cmp__` should simplify the case comparisons before the return statements and avoid the new `python_object.pxi` include.
* I guess speed could be further improved by using an approximation (with `double`s say) first and falling back to the exact computation if the results are too close.
* `left.D` is of type `Integer`. Cython tries to do the right thing for `<unsigned int> left.D`, but it would be better to use `mpz_mul()` with `left.D.value`.
* `mpz_sgn()` returns 0 if the argument is `0`. You don't seem to cover this case, though I couldn't find any example that returns wrong results.
* To avoid code duplication, it might be better change the if statement to:

```
        if mpz_sgn(i)*mpz_sgn(j) == 1:
            # both i and j are positive or negative
            mpz_mul(i, i, i)
            mpz_mul(j, j, j)
            mpz_mul_ui(j, j, <unsigned int> left.D)

            test = mpz_cmp(i, j)
            if mpz_sgn(i) == -1:
                # both i and j are negative
                test *= -1
```




---

archive/issue_comments_158080.json:
```json
{
    "body": "> * reimplementing the comparison of quadratic number field elements is a well defined unit of change itself. I suggest moving `floor()` and `ceil()` implementations to a separate patch, even a different ticket.\n> * `left.D` is of type `Integer`. Cython tries to do the right thing for `<unsigned int> left.D`, but it would be better to use `mpz_mul()` with `left.D.value`.\n\nDone and done.\n\n> * Do you really need to use rich comparisons? Working only with `__cmp__` should simplify the case comparisons before the return statements and avoid the new `python_object.pxi` include.\n\nWe loose speed (~1 micro sec) by doing this. I quickly look at the code of comparison for Integer. The comparison is directly implemented inside __richcmp__ and avoid as much as possible the coercion machinery (ie the type of the input is check with the cython function PY_TYPE_CHECK). Do you think we should proceed that way ?\n\n> * I guess speed could be further improved by using an approximation (with `double`s say) first and falling back to the exact computation if the results are too close.\n\nWhat do you mean by too close ? How do I certify that my float comparison is accurate enough ?\nMoreover, if we proceed that way we have to perform conversion from mpz_t to float (or double or real_mpfr). A way it may work is to look first if a,b, D and denom have reasonable values (recall that mpz_t have unlimited precision) and if yes, convert it to double and try to compare the arguments.\nLast, I'm not sure the gain of speed would be terrific. Comparison requires only 7 integer operations.\n\n> * `mpz_sgn()` returns 0 if the argument is `0`. You don't seem to cover this case, though I couldn't find any example that returns wrong results.\n\nActually there is no problem since we compute the sign of an expression of the form a^2 + b^2 D where a and b are both integers (and one of them is non null) and D is a square free integer. Hence the sign is never 0.\n\n> * To avoid code duplication, it might be better change the if statement to:\n> {{{\n>         if mpz_sgn(i)*mpz_sgn(j) == 1:\n>             # both i and j are positive or negative\n>             mpz_mul(i, i, i)\n>             mpz_mul(j, j, j)\n>             mpz_mul_ui(j, j, <unsigned int> left.D)\n> \n>             test = mpz_cmp(i, j)\n>             if mpz_sgn(i) == -1:\n>                 # both i and j are negative\n>                 test *= -1\n> }}}\n\nSure but that way we call twice mpz_sgn(i)... I may change it if you prefer.\n\n\nActually, the part where a lot of time is lost is the check for embedding\n\n```\nif not RDF.has_coerce_map_from(left._parent):\n    ...\n```\n\nBy replacing it by\n\n```\nif left.D < 0:\n   ...\n```\n\nI pass from 4 micro second to 2 micro seconds. That way comparison without embedding for positive discriminant will be equivalent to comparison with the standard embedding. This is in the last version of the patch. What do you think about that ?",
    "created_at": "2012-07-11T07:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158080",
    "user": "@videlec"
}
```

> * reimplementing the comparison of quadratic number field elements is a well defined unit of change itself. I suggest moving `floor()` and `ceil()` implementations to a separate patch, even a different ticket.
> * `left.D` is of type `Integer`. Cython tries to do the right thing for `<unsigned int> left.D`, but it would be better to use `mpz_mul()` with `left.D.value`.

Done and done.

> * Do you really need to use rich comparisons? Working only with `__cmp__` should simplify the case comparisons before the return statements and avoid the new `python_object.pxi` include.

We loose speed (~1 micro sec) by doing this. I quickly look at the code of comparison for Integer. The comparison is directly implemented inside __richcmp__ and avoid as much as possible the coercion machinery (ie the type of the input is check with the cython function PY_TYPE_CHECK). Do you think we should proceed that way ?

> * I guess speed could be further improved by using an approximation (with `double`s say) first and falling back to the exact computation if the results are too close.

What do you mean by too close ? How do I certify that my float comparison is accurate enough ?
Moreover, if we proceed that way we have to perform conversion from mpz_t to float (or double or real_mpfr). A way it may work is to look first if a,b, D and denom have reasonable values (recall that mpz_t have unlimited precision) and if yes, convert it to double and try to compare the arguments.
Last, I'm not sure the gain of speed would be terrific. Comparison requires only 7 integer operations.

> * `mpz_sgn()` returns 0 if the argument is `0`. You don't seem to cover this case, though I couldn't find any example that returns wrong results.

Actually there is no problem since we compute the sign of an expression of the form a^2 + b^2 D where a and b are both integers (and one of them is non null) and D is a square free integer. Hence the sign is never 0.

> * To avoid code duplication, it might be better change the if statement to:
> {{{
>         if mpz_sgn(i)*mpz_sgn(j) == 1:
>             # both i and j are positive or negative
>             mpz_mul(i, i, i)
>             mpz_mul(j, j, j)
>             mpz_mul_ui(j, j, <unsigned int> left.D)
> 
>             test = mpz_cmp(i, j)
>             if mpz_sgn(i) == -1:
>                 # both i and j are negative
>                 test *= -1
> }}}

Sure but that way we call twice mpz_sgn(i)... I may change it if you prefer.


Actually, the part where a lot of time is lost is the check for embedding

```
if not RDF.has_coerce_map_from(left._parent):
    ...
```

By replacing it by

```
if left.D < 0:
   ...
```

I pass from 4 micro second to 2 micro seconds. That way comparison without embedding for positive discriminant will be equivalent to comparison with the standard embedding. This is in the last version of the patch. What do you think about that ?



---

archive/issue_comments_158081.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-07-14T18:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158081",
    "user": "@videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_158082.json:
```json
{
    "body": "The code for comparison introduces a small bug as it ask to the parent whether the embedding is standard or not (via the boolean attribute _standard_embedding). But the latter was not defined for Cyclotomic field of order 3,4,6 (which are the ones which are quadratic). In that case, the attribute _standard_embedding is created at the initialization of the cyclotomic field.\n\nThe new patch takes care of this.",
    "created_at": "2012-07-18T11:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158082",
    "user": "@videlec"
}
```

The code for comparison introduces a small bug as it ask to the parent whether the embedding is standard or not (via the boolean attribute _standard_embedding). But the latter was not defined for Cyclotomic field of order 3,4,6 (which are the ones which are quadratic). In that case, the attribute _standard_embedding is created at the initialization of the cyclotomic field.

The new patch takes care of this.



---

archive/issue_comments_158083.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-08-04T04:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158083",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_158084.json:
```json
{
    "body": "Because there are many parents for quadratic elements, I was obliged to test whether the parent has a method '_standard_embedding' or not. I correct all tests (many output have changed) and waiting for patchbot and reviewer!",
    "created_at": "2012-08-04T12:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158084",
    "user": "@videlec"
}
```

Because there are many parents for quadratic elements, I was obliged to test whether the parent has a method '_standard_embedding' or not. I correct all tests (many output have changed) and waiting for patchbot and reviewer!



---

archive/issue_comments_158085.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-08-04T12:38:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158085",
    "user": "@videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_158086.json:
```json
{
    "body": "I corrected the two last tests that have failed...",
    "created_at": "2012-08-08T09:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158086",
    "user": "@videlec"
}
```

I corrected the two last tests that have failed...



---

archive/issue_comments_158087.json:
```json
{
    "body": "How does this patch here relate to #7160?",
    "created_at": "2012-08-08T12:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158087",
    "user": "@jdemeyer"
}
```

How does this patch here relate to #7160?



---

archive/issue_comments_158088.json:
```json
{
    "body": "In the ticket title \"real number field\", should it say \"quadratic number field\" instead?",
    "created_at": "2012-08-08T12:45:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158088",
    "user": "@jdemeyer"
}
```

In the ticket title "real number field", should it say "quadratic number field" instead?



---

archive/issue_comments_158089.json:
```json
{
    "body": "Hi Jeroen,\n\nFrom the last comment of Burcin on #7160, it seems to me that we will close #7160 as a duplicate. On the other hand, an other patch is coming for comparisons of general number field. Would you prefer to have it on a separate ticket ?",
    "created_at": "2012-08-08T13:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158089",
    "user": "@videlec"
}
```

Hi Jeroen,

From the last comment of Burcin on #7160, it seems to me that we will close #7160 as a duplicate. On the other hand, an other patch is coming for comparisons of general number field. Would you prefer to have it on a separate ticket ?



---

archive/issue_comments_158090.json:
```json
{
    "body": "Replying to [comment:15 vdelecroix]:\n> From the last comment of Burcin on #7160, it seems to me that we will close #7160 as a duplicate. On the other hand, an other patch is coming for comparisons of general number field. Would you prefer to have it on a separate ticket ?\nI don't care very much, but I think it should be clear how the various tickets relate to eachother.  \n\nAlso #10064 is related, at least it has #7160 as dependency.",
    "created_at": "2012-08-08T13:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158090",
    "user": "@jdemeyer"
}
```

Replying to [comment:15 vdelecroix]:
> From the last comment of Burcin on #7160, it seems to me that we will close #7160 as a duplicate. On the other hand, an other patch is coming for comparisons of general number field. Would you prefer to have it on a separate ticket ?
I don't care very much, but I think it should be clear how the various tickets relate to eachother.  

Also #10064 is related, at least it has #7160 as dependency.



---

archive/issue_comments_158091.json:
```json
{
    "body": "Just had a quick look at your patch. How about using ``@`cached_method` as a decorator for `_gen_approx`? Then you don't have to implement caching yourself. It makes the code a little bit easier to read.",
    "created_at": "2012-08-09T15:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158091",
    "user": "@tkluck"
}
```

Just had a quick look at your patch. How about using ``@`cached_method` as a decorator for `_gen_approx`? Then you don't have to implement caching yourself. It makes the code a little bit easier to read.



---

archive/issue_comments_158092.json:
```json
{
    "body": "Hello,\n\nActually, a lot of time is lost for asking questions to the parent. For quadratic number field, it is for asking about the attribute _standard_embedding. I build a new patch with a bint attribute added to NumberFieldElement_quadratic and the speed of comparison is divided by 10 (from 4 milliseconds to 400 nanoseconds). It will be updated as soon as possible.\nAs modifying the structure of NumberFieldElement_quadratic is a major change, I will split the patch into two parts : quadratic number fields and general number fields.\n\nVincent",
    "created_at": "2012-08-13T15:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158092",
    "user": "@videlec"
}
```

Hello,

Actually, a lot of time is lost for asking questions to the parent. For quadratic number field, it is for asking about the attribute _standard_embedding. I build a new patch with a bint attribute added to NumberFieldElement_quadratic and the speed of comparison is divided by 10 (from 4 milliseconds to 400 nanoseconds). It will be updated as soon as possible.
As modifying the structure of NumberFieldElement_quadratic is a major change, I will split the patch into two parts : quadratic number fields and general number fields.

Vincent



---

archive/issue_comments_158093.json:
```json
{
    "body": "apply trac_13213-quadratic_field_comparison.patch",
    "created_at": "2013-05-10T09:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158093",
    "user": "@videlec"
}
```

apply trac_13213-quadratic_field_comparison.patch



---

archive/issue_comments_158094.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-10T14:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158094",
    "user": "jpflori"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_158095.json:
```json
{
    "body": "This fails to apply on 5.10.beta2.\nHaving a look right now.",
    "created_at": "2013-05-10T14:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158095",
    "user": "jpflori"
}
```

This fails to apply on 5.10.beta2.
Having a look right now.



---

archive/issue_comments_158096.json:
```json
{
    "body": "Replying to [comment:22 jpflori]:\n> This fails to apply on 5.10.beta2.\n\nYes, it is a minor rejection on sage/schemes/elliptic_curves/ell_number_field.py and a more serious problem with python_object.pxi that seems to not exist anymore.\n\n> Having a look right now.\n\nDoes it mean that I should wait for your modifications ?",
    "created_at": "2013-05-10T14:55:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158096",
    "user": "@videlec"
}
```

Replying to [comment:22 jpflori]:
> This fails to apply on 5.10.beta2.

Yes, it is a minor rejection on sage/schemes/elliptic_curves/ell_number_field.py and a more serious problem with python_object.pxi that seems to not exist anymore.

> Having a look right now.

Does it mean that I should wait for your modifications ?



---

archive/issue_comments_158097.json:
```json
{
    "body": "No, if you identified the issues, please go ahead.\nI've just untarred 10.beta2 and are currently on something else, so you will definitely get faster.",
    "created_at": "2013-05-10T15:03:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158097",
    "user": "jpflori"
}
```

No, if you identified the issues, please go ahead.
I've just untarred 10.beta2 and are currently on something else, so you will definitely get faster.



---

archive/issue_comments_158098.json:
```json
{
    "body": "For the second problem I simply removed the import of python_object.pxi which was not needed anymore.\n\napply trac_13213-quadratic_field_comparison.patch",
    "created_at": "2013-05-10T15:14:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158098",
    "user": "@videlec"
}
```

For the second problem I simply removed the import of python_object.pxi which was not needed anymore.

apply trac_13213-quadratic_field_comparison.patch



---

archive/issue_comments_158099.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-10T15:15:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158099",
    "user": "@videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_158100.json:
```json
{
    "body": "Last minute modification: more tests, more docs.\n\napply trac_13213-quadratic_field_comparison.patch",
    "created_at": "2013-05-10T16:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158100",
    "user": "@videlec"
}
```

Last minute modification: more tests, more docs.

apply trac_13213-quadratic_field_comparison.patch



---

archive/issue_comments_158101.json:
```json
{
    "body": "#7545 is possibly a related ticket.",
    "created_at": "2013-05-10T16:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158101",
    "user": "@kcrisman"
}
```

#7545 is possibly a related ticket.



---

archive/issue_comments_158102.json:
```json
{
    "body": "There is a **strange** problem\n\n```\nsage: K.<sqrt2> = QuadraticField(2)\nsage: 1/2 + sqrt2 > 0\nFalse\n```\n",
    "created_at": "2013-05-10T18:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158102",
    "user": "@videlec"
}
```

There is a **strange** problem

```
sage: K.<sqrt2> = QuadraticField(2)
sage: 1/2 + sqrt2 > 0
False
```




---

archive/issue_comments_158103.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-10T18:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158103",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_158104.json:
```json
{
    "body": "Replying to [comment:29 vdelecroix]:\n> There is a **strange** problem\n> {{{\n> sage: K.<sqrt2> = QuadraticField(2)\n> sage: 1/2 + sqrt2 > 0\n> False\n> }}}\n\nI got the problem... it was because there is a natural morphism implemented from the rational field to quadratic number field (`sage.rings.number_field.number_field_element_quadratic.Q_to_quadratic_field_element`) which uses a non properly initialized instance of a quadratic element !",
    "created_at": "2013-05-10T19:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158104",
    "user": "@videlec"
}
```

Replying to [comment:29 vdelecroix]:
> There is a **strange** problem
> {{{
> sage: K.<sqrt2> = QuadraticField(2)
> sage: 1/2 + sqrt2 > 0
> False
> }}}

I got the problem... it was because there is a natural morphism implemented from the rational field to quadratic number field (`sage.rings.number_field.number_field_element_quadratic.Q_to_quadratic_field_element`) which uses a non properly initialized instance of a quadratic element !



---

archive/issue_comments_158105.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-10T19:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158105",
    "user": "@videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_158106.json:
```json
{
    "body": "apply trac_13213-quadratic_field_comparison.patch",
    "created_at": "2013-05-10T19:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158106",
    "user": "@videlec"
}
```

apply trac_13213-quadratic_field_comparison.patch



---

archive/issue_comments_158107.json:
```json
{
    "body": "I get a doctest failure with sage-5.10.beta2:\n\n```\nFile \"devel/sage/doc/de/tutorial/tour_advanced.rst\", line 483, in doc.de.tutorial.tour_advanced\nFailed example:\n    M.T(2).charpoly('x').factor()\nExpected:\n    (x - 2*zeta6 - 1) * (x - zeta6 - 2) * (x + zeta6 + 1)^2\nGot:\n    (x - zeta6 - 2) * (x - 2*zeta6 - 1) * (x + zeta6 + 1)^2\n**********************************************************************\n1 item had failures:\n   1 of 136 in doc.de.tutorial.tour_advanced\n    [118 tests, 1 failure, 1.44 s]\n```\n",
    "created_at": "2013-05-14T11:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158107",
    "user": "@vbraun"
}
```

I get a doctest failure with sage-5.10.beta2:

```
File "devel/sage/doc/de/tutorial/tour_advanced.rst", line 483, in doc.de.tutorial.tour_advanced
Failed example:
    M.T(2).charpoly('x').factor()
Expected:
    (x - 2*zeta6 - 1) * (x - zeta6 - 2) * (x + zeta6 + 1)^2
Got:
    (x - zeta6 - 2) * (x - 2*zeta6 - 1) * (x + zeta6 + 1)^2
**********************************************************************
1 item had failures:
   1 of 136 in doc.de.tutorial.tour_advanced
    [118 tests, 1 failure, 1.44 s]
```




---

archive/issue_comments_158108.json:
```json
{
    "body": "Attachment [trac_13213-quadratic_field_comparison.patch](tarball://root/attachments/some-uuid/ticket13213/trac_13213-quadratic_field_comparison.patch) by @videlec created at 2013-05-15 14:31:02",
    "created_at": "2013-05-15T14:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158108",
    "user": "@videlec"
}
```

Attachment [trac_13213-quadratic_field_comparison.patch](tarball://root/attachments/some-uuid/ticket13213/trac_13213-quadratic_field_comparison.patch) by @videlec created at 2013-05-15 14:31:02



---

archive/issue_comments_158109.json:
```json
{
    "body": "Replying to [comment:32 vbraun]:\n> I get a doctest failure with sage-5.10.beta2:\n> {{{\n> File \"devel/sage/doc/de/tutorial/tour_advanced.rst\", line 483, in doc.de.tutorial.tour_advanced\n> Failed example:\n>     M.T(2).charpoly('x').factor()\n> Expected:\n>     (x - 2*zeta6 - 1) * (x - zeta6 - 2) * (x + zeta6 + 1)^2\n> Got:\n>     (x - zeta6 - 2) * (x - 2*zeta6 - 1) * (x + zeta6 + 1)^2\n> **********************************************************************\n> 1 item had failures:\n>    1 of 136 in doc.de.tutorial.tour_advanced\n>     [118 tests, 1 failure, 1.44 s]\n> }}}\n\nThanks for that. I got the same error on my computer and change the patch accordingly. Why was patchbot happy with the former patch ?\n\napply trac_13213-quadratic_field_comparison.patch",
    "created_at": "2013-05-15T14:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158109",
    "user": "@videlec"
}
```

Replying to [comment:32 vbraun]:
> I get a doctest failure with sage-5.10.beta2:
> {{{
> File "devel/sage/doc/de/tutorial/tour_advanced.rst", line 483, in doc.de.tutorial.tour_advanced
> Failed example:
>     M.T(2).charpoly('x').factor()
> Expected:
>     (x - 2*zeta6 - 1) * (x - zeta6 - 2) * (x + zeta6 + 1)^2
> Got:
>     (x - zeta6 - 2) * (x - 2*zeta6 - 1) * (x + zeta6 + 1)^2
> **********************************************************************
> 1 item had failures:
>    1 of 136 in doc.de.tutorial.tour_advanced
>     [118 tests, 1 failure, 1.44 s]
> }}}

Thanks for that. I got the same error on my computer and change the patch accordingly. Why was patchbot happy with the former patch ?

apply trac_13213-quadratic_field_comparison.patch



---

archive/issue_comments_158110.json:
```json
{
    "body": "The patchbot apparently doesn't check German docs. Entt\u00e4uschend! ;-)",
    "created_at": "2013-05-15T14:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158110",
    "user": "@vbraun"
}
```

The patchbot apparently doesn't check German docs. Entt√§uschend! ;-)



---

archive/issue_comments_158111.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-05-15T16:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158111",
    "user": "@vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_158112.json:
```json
{
    "body": "All tests pass.",
    "created_at": "2013-05-15T16:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158112",
    "user": "@vbraun"
}
```

All tests pass.



---

archive/issue_comments_158113.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-05-17T06:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13041",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13041#issuecomment-158113",
    "user": "@jdemeyer"
}
```

Resolution: fixed
