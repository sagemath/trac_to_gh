# Issue 29547: Update section "Sage Development Process" in Developer's Guide

Issue created by migration from https://trac.sagemath.org/ticket/29784

Original creator: mkoeppe

Original creation time: 2020-06-02 16:37:49

CC:  @tobiasdiez dimpase jhpalmieri slelievre yzh @davidayotte nbruin egourgoulhon

(from #29733)

the documentation at â€‹https://doc.sagemath.org/html/en/developer/walk_through.html is not really reflecting some of the recent changes to the readme


---

Comment by @tobiasdiez created at 2020-06-02 16:55:36

It might be also helpful to add the steps from #25206#comment:63 to the documentation.


---

Comment by mkoeppe created at 2020-06-02 17:15:59

Indeed. Are you planning to work on this?


---

Comment by mkoeppe created at 2021-03-24 01:53:05

Changing priority from major to critical.


---

Comment by mkoeppe created at 2021-05-10 17:42:09

Moving to 9.4, as 9.3 has been released.


---

Comment by git created at 2021-12-27 03:04:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-27 03:05:19

Changing status from new to needs_review.


---

Comment by git created at 2021-12-27 03:20:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-12-27 06:05:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2021-12-27 10:18:02

Thanks for the update! 

Maybe in `README.md`, replace

```
12. Type `make`.  That's it! Everything is automatic and
   non-interactive; but it will take a few hours (on a recent
   computer).
```

by something like

```
12. Type `make`.  That's it! Everything is automatic and
   non-interactive. NB: you can shorten the build time by typing instead 
   `MAKE='make -jNUM' make`, thereby telling the `make` program to run `NUM` jobs 
   in parallel. A recommended value for `NUM` is twice the number of cores of 
   your CPU. With `NUM` = 8, building Sage takes less than one hour on a modern 
   computer. 
```



---

Comment by dimpase created at 2021-12-27 10:19:52

> With `NUM` = 8, building Sage takes less than one hour on a modern 
   computer. `

This is only true if many packages come from the system. Of course building gcc takes more time...


---

Comment by slelievre created at 2021-12-27 16:23:35

How about `make -s V=0` for more zen?
The log files will have all the info.

Though it also makes sense to give
the simplest instructions in this guide.


---

Comment by mkoeppe created at 2021-12-27 17:15:24

Replying to [comment:19 slelievre]:
> How about `make -s V=0` for more zen?

step 9 already recommends `export V=0`.


---

Comment by mkoeppe created at 2021-12-27 17:21:47

Replying to [comment:17 egourgoulhon]:
> Maybe in `README.md`, [...] something like
> {{{
> 12. Type `make`.  That's it! Everything is automatic and
>    non-interactive. NB: you can shorten the build time by typing instead 
>    `MAKE='make -jNUM' make`, thereby telling the `make` program to run `NUM` jobs 
>    in parallel. A recommended value for `NUM` is twice the number of cores of 
>    your CPU. With `NUM` = 8, building Sage takes less than one hour on a modern 
>    computer. 
> }}}

I've made a change that instead refers back to previous steps


---

Comment by git created at 2021-12-27 17:22:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-12-27 17:26:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-12-27 17:53:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-27 17:54:20

Many more improvements could be done in the "installation from source" chapter, but I'll stop here for this ticket.

Let's get this in please


---

Attachment

fix indentation


---

Comment by egourgoulhon created at 2021-12-27 18:05:10

Replying to [comment:21 mkoeppe]:
> Replying to [comment:17 egourgoulhon]:
> > Maybe in `README.md`, [...] something like
> > {{{
> > 12. Type `make`.  That's it! Everything is automatic and
> >    non-interactive. NB: you can shorten the build time by typing instead 
> >    `MAKE='make -jNUM' make`, thereby telling the `make` program to run `NUM` jobs 
> >    in parallel. A recommended value for `NUM` is twice the number of cores of 
> >    your CPU. With `NUM` = 8, building Sage takes less than one hour on a modern 
> >    computer. 
> > }}}
> 
> I've made a change that instead refers back to previous steps

Much better indeed. 

There are some indentation issues in `README.md` (sublist should be indented with 4 char tab), which result in bad output with some markdown viewers such as retext. This is corrected in the attached file


---

Comment by egourgoulhon created at 2021-12-27 18:06:35

Otherwise, LGTM.


---

Comment by git created at 2021-12-27 18:11:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2021-12-27 19:46:16

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2021-12-27 19:46:16

Thanks!


---

Comment by mkoeppe created at 2021-12-27 20:08:00

Thank you!


---

Comment by @tobiasdiez created at 2021-12-27 20:10:17

Concerning the change
> Windows (WSL)
>    Install the package using the Linux distribution's package manager.
>    Do not attempt to use native Windows installations of ``git``.


I don't think one strictly needs to exclude the Windows git. I had no problems so far using it. Based on other discussions on similar points, I would propose to formulate it as a strong recommendation to use the Linux git, but the native Windows way should be described as well.


---

Comment by @tobiasdiez created at 2021-12-27 20:10:17

Changing status from positive_review to needs_work.


---

Comment by @tobiasdiez created at 2021-12-27 20:13:03

Concerning
> In the following, we assume that you are in the source directory of Sage (``SAGE_ROOT``),
> obtained either from a source tarball or by cloning a Sage git repository
> such as https://github.com/sagemath/sage.git, as described in the
> `README <https://github.com/sagemath/sage/#readme>`_.
> In either case, this source directory is actually the main worktree of
> a local git repository.

Does the source tarball really contain a git folder (to serve as a local git repo)?


---

Comment by git created at 2021-12-27 20:14:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-27 20:14:50

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2021-12-27 20:18:35

Replying to [comment:32 gh-tobiasdiez]:
> Does the source tarball really contain a git folder (to serve as a local git repo)?

Yes.


---

Comment by @tobiasdiez created at 2021-12-27 20:18:46

I also would propose to make the developer documentation self-contained. I remember that I was super confused when I started, since it was not clear what to do after cloning the repo. Maybe it would be better if the "installation by source" would be linking to the developer docs instead?


---

Comment by mkoeppe created at 2021-12-27 20:21:32

Larger changes like this should go in a follow up ticket. I won't work on it for Sage 9.5.


---

Comment by mkoeppe created at 2021-12-27 20:26:10

Replying to [comment:35 mkoeppe]:
> Replying to [comment:32 gh-tobiasdiez]:
> > Does the source tarball really contain a git folder (to serve as a local git repo)?
> 
> Yes.

Turns out this one has the `remote` set to the broken gitlab mirror as well. I'll fix this here in the next commit


---

Comment by mkoeppe created at 2021-12-27 20:26:18

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-12-27 20:27:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-27 20:32:12

Also, `build/bin/sage-clone-source` (which is used for creating the git repo in the source tarball) uses `origin` as the name of the remote. I'll change this to `trac` to be consistent with the developer documentation.


---

Comment by mkoeppe created at 2021-12-27 20:37:02

... in #33087.


---

Comment by mkoeppe created at 2021-12-27 20:37:15

Changing status from needs_work to needs_review.


---

Comment by @tobiasdiez created at 2021-12-27 20:39:30

Replying to [comment:37 mkoeppe]:
> Larger changes like this should go in a follow up ticket. I won't work on it for Sage 9.5.

Well, you touched this part of the docs and in my opinion its even less clear now what to do after obtaining the code. As a compromise, maybe add "run configure + make, for more details see installation from source section" for now?


---

Comment by mkoeppe created at 2021-12-27 20:48:40

It is referring to the installation from source section. 

```
  You will then need to `compile Sage
  <http://doc.sagemath.org/html/en/installation/source.html>`_ in order to use it.
```

I just removed the duplication of (outdated, short) installation instructions from this place. That's an improvement. 

Adding back incomplete short installation instructions ("configure + make") is not an improvement.


---

Comment by @tobiasdiez created at 2021-12-27 21:13:31

Okay, I find a short (but up-to-date) installation instructions helpful for newcomers. It adds quite a barrier if you need to read 5 pages just to get started with compilation.

Other than that, the changes to the docs look good to me. I cannot judge the latest commit, so I leave the ticket on needs review.

Note also that most points of the ticket description are not addressed if I'm not mistaken, so they should probably be moved to new tickets.


---

Comment by mkoeppe created at 2021-12-27 21:16:53

Reduced the ticket description. Follow-up in #33088.


---

Comment by git created at 2021-12-27 21:21:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-27 21:23:06

Replying to [comment:46 gh-tobiasdiez]:
> I find a short (but up-to-date) installation instructions helpful for newcomers. It adds quite a barrier if you need to read 5 pages just to get started with compilation.

OK, I have changed it now to point primarily to the instructions in README.md; I think this goes into the direction that you have in mind


---

Comment by @tobiasdiez created at 2021-12-27 21:26:06

That's a very good idea, I like it!


---

Comment by slelievre created at 2021-12-28 05:40:25

Thanks for these welcome changes.

Some lines are indented 3 spaces, maybe use 4 throughout?

Suggested shorter rephrasing:

```
-    * Compilers: `gcc`, `gfortran`, `g++` (a matching set of these
-      three will avoid the compilation of Sage-specific compilers -
-      unless they are too old).  See the Installation Manual for a
-      discussion of suitable compilers.
+    * Compilers: `gcc`, `gfortran`, `g++` (a recent enough matching
+      set of these three will avoid building Sage-specific compilers).
+      See the Installation Manual for a discussion of suitable compilers.
```


Positive review from me with or without these changes.


---

Comment by mkoeppe created at 2021-12-28 06:04:28

OK if you want to push this change to the ticket.


---

Comment by egourgoulhon created at 2021-12-28 09:50:08

Replying to [comment:50 gh-tobiasdiez]:
> That's a very good idea, I like it!
So do I.


---

Comment by slelievre created at 2021-12-29 00:27:13

Here are some changes to the README
(all in a single commit, sorry).

As listed in the commit message:

- Adjust indentation
- Merge steps 2 and 3 for consistency since the Git version
  of step 2 already changed into the Sage directory
- Minor rephrasing, e.g.:
  - "to something not containing any non-alphanumeric characters"
    -> "to contain only alphanumeric characters"
  - "(a matching set of these three will avoid the compilation
    of Sage-specific compilers - unless they are too old)" ->
    "(a recent enough matching set of these three will avoid
    building Sage-specific compilers)."
- Update required disk space to "at least 10 GB" (rather than 6)
- Spell out some abbreviations (OSS license -> software license;
  NFS -> network file system; cd -> change directory)
- Add `--tags` to `git clone`
- Fix minor punctuation inconsistencies (use `-` for all lists
  instead of sometimes `*`, comma after opensuse, period after `bc`)
- Expand the "try it out" item to suggest some things to try
- Suggest bookmarking the local documentation in your browser
- Add link to online list of Sage packages
- Add optional step to add symlink to `sage` in `/usr/local/bin`
----
New commits:


---

Comment by mkoeppe created at 2021-12-29 00:38:55


```
            $ ORIG=https://github.com/sagemath/sage.git
-            $ git clone -c core.symlinks=true --branch master $ORIG
+            $ git clone -c core.symlinks=true --branch --tags develop $ORIG
```

The command with this change does not work. "develop" must come right after "--branch"


---

Comment by mkoeppe created at 2021-12-29 00:43:43

And removing this breaks the workflow in the case of git

```
-3. `cd` into the source/build directory:
-
-        $ cd sage*/
-
```



---

Comment by mkoeppe created at 2021-12-29 00:45:53

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-12-29 01:43:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-12-29 01:45:53

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by slelievre created at 2021-12-29 01:46:43

Better like this?


---

Comment by slelievre created at 2021-12-29 01:46:43

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2021-12-29 02:17:02

Yes, looking good, thanks


---

Comment by egourgoulhon created at 2021-12-29 09:20:44

Could you please remove this spurious empty line in `README.md`:

```diff
             $ cd sage-x.y/  # adapt x.y
 
-
     - [Git] Alternatively, clone the Sage git repository:
 
             $ ORIG=https://github.com/sagemath/sage.git

```

It causes bad formatting in some markdown readers (e.g. abricotine).


---

Comment by git created at 2021-12-29 09:28:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2021-12-29 10:15:58

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2021-12-29 10:15:58

Thanks!


---

Comment by mkoeppe created at 2021-12-29 18:44:32

Thanks everyone for review and edits!


---

Comment by vbraun created at 2022-01-04 22:51:19

Resolution: fixed
