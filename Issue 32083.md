# Issue 32083: Ideal() with fraction-field elements is a small footgun

archive/issues_032083.json:
```json
{
    "body": "Keywords: fields, fraction fields, ideals\n\nI occasionally find myself trying to solve polynomial systems arising from rational equations:\n\n```\nsage: R.<x,y> = GF(31337)[]\nsage: xx = (x*y+y*x) / (1+23*x^2*y^2)\nsage: yy = (y^2-x^2) / (1+23*x^2*y^2)\nsage: Ideal([xx-1, yy-0]) == 1\nTrue\n```\n\nOne might conclude at this point that the equation has no solutions.\n\nThis is of course nonsense: `xx` and `yy` are elements of the *fraction field* of `R`, so every ideal is either `(0)` or `(1)`, and what we should have written is `Ideal([f.numerator() for f in (xx-1, yy-0)])`. Realizing that this is what's happening may cost the user precious seconds, minutes, or even hours.\n\nThis patch adds a warning to the `Ideal()` function when the automatically inferred base ring is a field, with the exception of fields that have a `fractional_ideal` method. The latter exception in particular applies to number fields, where the `.ideal()` method is redefined to construct a fractional ideal instead, hence there is a bigger chance that the user actually meant to use `Ideal()` with field elements.\n\nThe warning is only triggered when the base ring is not given explicitly: For example, writing `a*R` or `R.ideal(...)` or even `Ideal(R, ...)` will never print the warning, but `Ideal(1/2)` will.\n\nI couldn't really think of any cases where users would actually *want* to create ideals in fields (outside of basic educational examples), since they're all trivial. Does anyone know situations where this warning would be annoying?\n\nIssue created by migration from https://trac.sagemath.org/ticket/32320\n\n",
    "created_at": "2021-08-01T05:37:51Z",
    "labels": [
        "algebra",
        "trivial",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Ideal() with fraction-field elements is a small footgun",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32083",
    "user": "@yyyyx4"
}
```
Keywords: fields, fraction fields, ideals

I occasionally find myself trying to solve polynomial systems arising from rational equations:

```
sage: R.<x,y> = GF(31337)[]
sage: xx = (x*y+y*x) / (1+23*x^2*y^2)
sage: yy = (y^2-x^2) / (1+23*x^2*y^2)
sage: Ideal([xx-1, yy-0]) == 1
True
```

One might conclude at this point that the equation has no solutions.

This is of course nonsense: `xx` and `yy` are elements of the *fraction field* of `R`, so every ideal is either `(0)` or `(1)`, and what we should have written is `Ideal([f.numerator() for f in (xx-1, yy-0)])`. Realizing that this is what's happening may cost the user precious seconds, minutes, or even hours.

This patch adds a warning to the `Ideal()` function when the automatically inferred base ring is a field, with the exception of fields that have a `fractional_ideal` method. The latter exception in particular applies to number fields, where the `.ideal()` method is redefined to construct a fractional ideal instead, hence there is a bigger chance that the user actually meant to use `Ideal()` with field elements.

The warning is only triggered when the base ring is not given explicitly: For example, writing `a*R` or `R.ideal(...)` or even `Ideal(R, ...)` will never print the warning, but `Ideal(1/2)` will.

I couldn't really think of any cases where users would actually *want* to create ideals in fields (outside of basic educational examples), since they're all trivial. Does anyone know situations where this warning would be annoying?

Issue created by migration from https://trac.sagemath.org/ticket/32320





---

archive/issue_comments_458086.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-08-01T05:38:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32083#issuecomment-458086",
    "user": "@yyyyx4"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_458087.json:
```json
{
    "body": "Actually, do we even need the second check? It isn't used in this function.",
    "created_at": "2021-08-15T00:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32083#issuecomment-458087",
    "user": "@tscrim"
}
```

Actually, do we even need the second check? It isn't used in this function.



---

archive/issue_comments_458088.json:
```json
{
    "body": "You mean the `fractional_ideal` check? The point was to not print the warning in situations where `.ideal()` has been redefined to do fractional ideals (see for instance ticket:7596#comment:13). It's quite a hack.",
    "created_at": "2021-08-15T06:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32083#issuecomment-458088",
    "user": "@yyyyx4"
}
```

You mean the `fractional_ideal` check? The point was to not print the warning in situations where `.ideal()` has been redefined to do fractional ideals (see for instance ticket:7596#comment:13). It's quite a hack.



---

archive/issue_comments_458089.json:
```json
{
    "body": "Then shouldn't we also check that ideal is fractional_ideal? Otherwise these could be independent (perhaps because of a bug).",
    "created_at": "2021-08-15T08:45:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32083#issuecomment-458089",
    "user": "@tscrim"
}
```

Then shouldn't we also check that ideal is fractional_ideal? Otherwise these could be independent (perhaps because of a bug).



---

archive/issue_comments_458090.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-15T09:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32083#issuecomment-458090",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_458091.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-15T09:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32083#issuecomment-458091",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_458092.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-15T09:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32083#issuecomment-458092",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_458093.json:
```json
{
    "body": "Replying to [comment:5 tscrim]:\n> Then shouldn't we also check that ideal is fractional_ideal?\n\nGood point, this is a much better way of doing it. It's totally broken without #32380 though.",
    "created_at": "2021-08-15T09:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32083#issuecomment-458093",
    "user": "@yyyyx4"
}
```

Replying to [comment:5 tscrim]:
> Then shouldn't we also check that ideal is fractional_ideal?

Good point, this is a much better way of doing it. It's totally broken without #32380 though.



---

archive/issue_comments_458094.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-16T00:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32083#issuecomment-458094",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_458095.json:
```json
{
    "body": "Thank you. LGTM.",
    "created_at": "2021-08-16T00:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32083#issuecomment-458095",
    "user": "@tscrim"
}
```

Thank you. LGTM.



---

archive/issue_comments_458096.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-11-18T23:37:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32083#issuecomment-458096",
    "user": "@vbraun"
}
```

Resolution: fixed
