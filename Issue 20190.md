# Issue 20190: docstring wide optional markup

Issue created by migration from Trac.

Original creator: nthiery

Original creation time: 2016-04-11 21:40:38

CC:  mmasdeu

It's quite common that optional tests come in batch, typically when documenting a method that is only available when a certain feature or package is available. Having to mark each and every test with # optional xxx is redundant and reduces readability.

This ticket implements a Sphinx style markup to disable all doctests following it::

```
    """
    ...
    EXAMPLES::
 
        sage: ...      

    .. OPTIONAL:: gap3

    ::

        sage: gap3(...)
        sage: gap3(...)
    """
```


TODO:

- Is this the right markup? I would prefer ".. REQUIRE:: gap3" but this is not super consistent with the line-by-line markup.
- It could be desirable to have a markup to disable all tests in the module; possibly by using the above markup in the module docstring.




---

Comment by saraedum created at 2016-04-12 17:21:47

Let me know when you need a reviewer (in case sage-devel approves of this in the end.)
----
New commits:


---

Comment by jdemeyer created at 2016-08-12 09:14:27

See also #3260.


---

Comment by jdemeyer created at 2017-01-24 09:28:11

Replying to [ticket:20427 nthiery]:
> Having to mark each and every test with # optional xxx is redundant and reduces readability.

One the other hand, it's not always needed to mark _every_ test `# optional`. In many cases, a module depending on an optional package still has some stuff which does _not_ need the package and which could be tested unconditionally. Typically you have some high-level object modelling something and creating/displaying/modifying that object does not require the optional package. The package is only needed when doing something mathematically interesting.

The above paragraph certainly does not apply to all optional packages, but we should we careful that people don't become lazy and mark a whole file `# optional` when many doctests in that file are not optional.


---

Comment by mkoeppe created at 2021-02-18 01:11:07

For a module-level directive in the same direction, see #30778
