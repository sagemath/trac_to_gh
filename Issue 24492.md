# Issue 24492: Add --with-python=3 configure flag to replace SAGE_PYTHON3=yes

Issue created by migration from https://trac.sagemath.org/ticket/24729

Original creator: jdemeyer

Original creation time: 2018-02-14 12:51:26

CC:  embray chapoton mkoeppe




---

Comment by jdemeyer created at 2018-02-14 13:19:20

New commits:


---

Comment by jdemeyer created at 2018-02-14 14:46:21

Changing status from new to needs_review.


---

Comment by embray created at 2018-02-14 15:27:07

+1 Been meaning to do the same for a while (actually already did once in an old branch that I abandoned).  Though as written this will obviously conflict with #21524.


---

Comment by chapoton created at 2018-02-14 15:33:28

what is the advantage ?


---

Comment by jdemeyer created at 2018-02-14 15:50:32

Replying to [comment:5 chapoton]:
> what is the advantage ?

First of all, it's a more standard way to configure things. But one real advantage is that you only need to set this once when running `./configure` initially. With this ticket, once you ran `./configure --with-python=2` you can just run `make` without needing to remember to set `SAGE_PYTHON3=yes`.


---

Comment by chapoton created at 2018-02-14 15:52:33

ok. Great.

Stupid question maybe: in

```
+export SAGE_PYTHON_VERSION=@SAGE_PYTHON_VERSION@
```

should there be `"` around ``@`SAGE_PYTHON_VERSION`@`` ?


---

Comment by jdemeyer created at 2018-02-14 15:53:46

Replying to [comment:7 chapoton]:
> ok. Great.
> 
> Stupid question maybe: in
> {{{
> +export SAGE_PYTHON_VERSION=`@`SAGE_PYTHON_VERSION`@`
> }}}
> should there be `"` around ``@`SAGE_PYTHON_VERSION`@`` ?

That's not needed in shell scripts.


---

Comment by mkoeppe created at 2018-02-14 20:03:39

When I see a configure option `--with-python=...`, I would expect that I can do ` ./configure --with-python=/usr/bin/python3.5.77 `. How about having options `--with-python2`, `--with-python3` instead?


---

Comment by jdemeyer created at 2018-02-14 21:15:26

That's a fair comment. Let me just say that I chose the option analogous to `--with-mp=gmp|mpir`


---

Comment by jdemeyer created at 2018-02-15 06:29:40

Actually, this shouldn't be a `--with` option at all since those typically indicate components of the system which should be used. For example, mpfr has a `--with-gmp` option to indicate which GMP it should use. So it should be an `--enable` option.

I don't like `--enable-python2` and `--enable-python3` so much because it's not obvious that they are mutually exclusive. So I would prefer `--enable-python=2` and `--enable-python=3`.

Are you willing to give positive review if I change the option to `--enable-python` instead of `--with-python`?


---

Comment by jdemeyer created at 2018-02-15 06:37:14

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2018-02-15 18:58:24

No, I would say that `--with...` is the right thing to use, because Python is a dependency, rather than a feature of Sage. `--with...` does not require an argument. And we can reserve the use of an argument for future use (such as working with a distribution's Python rather than our own).

And a help string can make clear that two options are mutually exclusive (as well as signalling an error if both are provided.)


---

Comment by jdemeyer created at 2018-02-15 19:04:53

Replying to [comment:13 mkoeppe]:
> No, I would say that `--with...` is the right thing to use, because Python is a dependency, rather than a feature of Sage.

Huh? Maybe you are confusing Sage-the-library with Sage-the-distribution. I would argue that `./configure` is really the configuration script for Sage-the-distribution and that the Python-in-Sage is a feature (not a dependency) of Sage-the-distribution. Python is a dependency of Sage-the-library but I don't think that is relevant here.

Apart from this, there is also the unrelated Python-used-by-the-build-system which is a dependency. In fact, that is what we should use the `--with-python` option for.


---

Comment by mkoeppe created at 2018-02-15 19:24:01

Replying to [comment:14 jdemeyer]:
> Replying to [comment:13 mkoeppe]:
> > No, I would say that `--with...` is the right thing to use, because Python is a dependency, rather than a feature of Sage.
> 
> Huh? Maybe you are confusing Sage-the-library with Sage-the-distribution. I would argue that `./configure` is really the configuration script for Sage-the-distribution and that the Python-in-Sage is a feature (not a dependency) of Sage-the-distribution. Python is a dependency of Sage-the-library but I don't think that is relevant here.

Hm, well, I thought you might say that. But the configuration of sage-the-distribution does also affect sagelib (configuration is somehow passed through); it does not just make one or the other version of python available for sagelib to find.

Also, in light of various efforts to use system packages when available I could imagine that one day sage-the-distribution could skip installing its copy of Python and then `--with-python3=/usr/bin/python3.5.77` would make sense.

> 
> Apart from this, there is also the unrelated Python-used-by-the-build-system which is a dependency. In fact, that is what we should use the `--with-python` option for.

For that one I would suggest something like `--with-build-python` to disambiguate.


---

Comment by jdemeyer created at 2018-02-15 19:49:38

OK, I see your point of using `--with-python` instead of `--enable-python`. Still, I see no reason for separate `--with-python2` and `--with-python3` options. Why do you prefer that over `--with-python`? We already have `--with-blas=atlas` and not `--with-atlas`, so an option `--with-python=2` seems more consistent.


---

Comment by mkoeppe created at 2018-02-15 20:05:06

First of all, I'd say `--with-python=2`  just looks odd to the trained configure-user's eye, one would expect to see `--with-python=python2` or perhaps `--with-python-version=2`.
And as I explained, `--with-python2` and `--with-python3`  allows for future, compatible extensions.

Not sure if the following will make sense, but perhaps a difference to BLAS is that Python exists as an executable. So `--with-python3=/usr/bin/python3.5.77` makes sense; whereas one would perhaps see `--with-blas=atlas --with-atlas-lib=/usr/lib/dfdkfldkflkdlfk --with-atlas-include=/usr/include/fjdkfjkdjfkjd`.

But obviously all of this is not exact science; so I don't insist.


---

Comment by embray created at 2018-02-16 10:25:45

I like `--with-python=2`.  I think it would be more consistent to be `--with-python=python2` but that's obviously redundant and more likely to clash with a future use of `--with-python=<path-to-python-executabe>`.  So I think in this case we could make an exception.


---

Comment by chapoton created at 2018-02-16 10:27:26

Not an expert at all on this kind of things, but I agree with `--with-python=2`.


---

Comment by jdemeyer created at 2018-02-16 13:49:42

Replying to [comment:17 mkoeppe]:
> First of all, I'd say `--with-python=2`  just looks odd to the trained configure-user's eye, one would expect to see `--with-python=python2` or perhaps `--with-python-version=2`.

I mainly used `--with-python=2` because it's the shortest of those alternatives.


---

Comment by jdemeyer created at 2018-02-16 13:50:17

Given that nobody really objects, is somebody willing to give positive review?


---

Comment by jdemeyer created at 2018-02-16 14:19:01

Changing status from needs_work to needs_review.


---

Comment by embray created at 2018-02-16 16:28:13

Unless mkoeppe still objects, +1 from me.  I will just make this a dependency of #21524 (even though it came first, I don't mind).


---

Comment by embray created at 2018-02-16 16:28:13

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-02-17 23:37:39


```
Running the test suite for scipy-0.19.1...
  File "spkg-check.py", line 9
    print r
          ^
SyntaxError: Missing parentheses in call to 'print'
```



---

Comment by vbraun created at 2018-02-17 23:37:39

Changing status from positive_review to needs_work.


---

Comment by git created at 2018-02-18 08:51:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2018-02-18 08:56:52

Right, let's play the make-this-work-without-patching-configure game again :-)


---

Comment by jdemeyer created at 2018-02-18 08:57:36

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-02-18 09:45:14

shouldn't we fix the scipy print also, in passing ?


---

Comment by jdemeyer created at 2018-02-18 09:49:34

Replying to [comment:29 chapoton]:
> shouldn't we fix the scipy print also, in passing ?

See #24766 for that.


---

Comment by embray created at 2018-02-19 16:44:44

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-02-20 23:08:17

Resolution: fixed


---

Comment by chapoton created at 2018-03-03 07:46:26

Well.. On 8.2.b7 I get

```
./configure --with-python=3
configure: WARNING: unrecognized options: --with-python
```



---

Comment by jdemeyer created at 2018-03-03 09:08:42

Try running `make configure` first.
