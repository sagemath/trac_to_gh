# Issue 16146: Can't evaluate a polynomial on a finite field if representation is not "poly"

Issue created by migration from https://trac.sagemath.org/ticket/16383

Original creator: landais

Original creation time: 2014-05-21 09:55:05

CC:  jpflori

Keywords: polynomial finite field

Evaluating a polynomial on a finite field does not work if the finite
field was created with a 'repr' argument in the constructor different
than the default one (poly).

Curently using sage 6.1.1 on ubuntu 12.04 but same behaviour in 6.2.

Here is the code that works :


```
sage: F.<a>=GF(2**8)
sage: PR.<x>=PolynomialRing(F)
sage: f=PR.random_element(9)
sage: b=F.random_element()
sage: f(b)
a^6 + a^5 + a^4 + a^3 + a^2 + 1
```




And the same code with the repr parameter changed (same behaviour with
repr="int") :


```
sage: F.<a>=GF(2**8, repr="log")
sage: PR.<x>=PolynomialRing(F)
sage: f=PR.random_element(9)
sage: b=F.random_element()
sage: f(b)
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
<ipython-input-5-a6714ffdcf66> in <module>()
----> 1 f(b)

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_zz_pex.so in sage.rings.polynomial.polynomial_zz_pex.Polynomial_ZZ_pEX.__call__ (sage/rings/polynomial/polynomial_zz_pex.cpp:14427)()

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8858)()

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:4206)()

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:4113)()

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/finite_rings/finite_field_givaro.pyc in _element_constructor_(self, e)
    355             2*a4^3 + 2*a4^2 + 1
    356         """
--> 357         return self._cache.element_from_data(e)
    358 
    359     def gen(self, n=0):

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/finite_rings/element_givaro.so in sage.rings.finite_rings.element_givaro.Cache_givaro.element_from_data (sage/rings/finite_rings/element_givaro.cpp:6459)()

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/finite_rings/element_givaro.so in sage.rings.finite_rings.element_givaro.Cache_givaro.element_from_data (sage/rings/finite_rings/element_givaro.cpp:5381)()

<string> in <module>()
```






---

Comment by landais created at 2014-05-22 15:01:01

A strange workaround :

Create the finite field with repr="poly" then evaluate any polynomial in any point then change the representation of finite field elements.

Demo : 

```
sage: F.<a>=GF(2**8)
sage: PR.<x>=PolynomialRing(F)
sage: f=PR.random_element(9)
sage: b=F.random_element()
sage: f(b)
a^6 + a^5 + a^4 + a^3
sage: F._cache.repr=1
sage: f(b)
78
sage: f=PR.random_element(9)
sage: f(b)
204
sage: f=PR.random_element(7)
sage: b=F.random_element()
sage: f(b)
151
```


If you don't evaluate a polynomial before changing the representation, it does not work. I don't know if changing the representation this way has any side effect.


---

Comment by landais created at 2014-05-22 15:03:38

Changing component from misc to finite rings.


---

Comment by pbruin created at 2014-05-22 17:41:48

It turns out that this is caused by a stupid string-based conversion between different implementations of the same finite field.  I'm now testing a patch that uses a more direct conversion instead, which also makes evaluation 20% faster in your example.


---

Comment by pbruin created at 2014-05-22 18:08:10

Changing status from new to needs_review.


---

Comment by rws created at 2014-06-07 14:29:55

Changing status from needs_review to positive_review.


---

Comment by rws created at 2014-06-07 14:29:55

Patchbot is happy with this, doctest is included with reference to ticket, and the changes are so minimal that I can immediately accept it.


---

Comment by vbraun created at 2014-06-08 15:43:51

Resolution: fixed
