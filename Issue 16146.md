# Issue 16146: Can't evaluate a polynomial on a finite field if representation is not "poly"

archive/issues_016146.json:
```json
{
    "body": "CC:  jpflori\n\nKeywords: polynomial finite field\n\nEvaluating a polynomial on a finite field does not work if the finite\nfield was created with a 'repr' argument in the constructor different\nthan the default one (poly).\n\nCurently using sage 6.1.1 on ubuntu 12.04 but same behaviour in 6.2.\n\nHere is the code that works :\n\n\n```\nsage: F.<a>=GF(2**8)\nsage: PR.<x>=PolynomialRing(F)\nsage: f=PR.random_element(9)\nsage: b=F.random_element()\nsage: f(b)\na^6 + a^5 + a^4 + a^3 + a^2 + 1\n```\n\n\n\n\nAnd the same code with the repr parameter changed (same behaviour with\nrepr=\"int\") :\n\n\n```\nsage: F.<a>=GF(2**8, repr=\"log\")\nsage: PR.<x>=PolynomialRing(F)\nsage: f=PR.random_element(9)\nsage: b=F.random_element()\nsage: f(b)\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n<ipython-input-5-a6714ffdcf66> in <module>()\n----> 1 f(b)\n\n/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_zz_pex.so in sage.rings.polynomial.polynomial_zz_pex.Polynomial_ZZ_pEX.__call__ (sage/rings/polynomial/polynomial_zz_pex.cpp:14427)()\n\n/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8858)()\n\n/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:4206)()\n\n/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:4113)()\n\n/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/finite_rings/finite_field_givaro.pyc in _element_constructor_(self, e)\n    355             2*a4^3 + 2*a4^2 + 1\n    356         \"\"\"\n--> 357         return self._cache.element_from_data(e)\n    358 \n    359     def gen(self, n=0):\n\n/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/finite_rings/element_givaro.so in sage.rings.finite_rings.element_givaro.Cache_givaro.element_from_data (sage/rings/finite_rings/element_givaro.cpp:6459)()\n\n/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/finite_rings/element_givaro.so in sage.rings.finite_rings.element_givaro.Cache_givaro.element_from_data (sage/rings/finite_rings/element_givaro.cpp:5381)()\n\n<string> in <module>()\n```\n\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/16383\n\n",
    "created_at": "2014-05-21T09:55:05Z",
    "labels": [
        "component: misc",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Can't evaluate a polynomial on a finite field if representation is not \"poly\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16146",
    "user": "https://trac.sagemath.org/admin/accounts/users/landais"
}
```
CC:  jpflori

Keywords: polynomial finite field

Evaluating a polynomial on a finite field does not work if the finite
field was created with a 'repr' argument in the constructor different
than the default one (poly).

Curently using sage 6.1.1 on ubuntu 12.04 but same behaviour in 6.2.

Here is the code that works :


```
sage: F.<a>=GF(2**8)
sage: PR.<x>=PolynomialRing(F)
sage: f=PR.random_element(9)
sage: b=F.random_element()
sage: f(b)
a^6 + a^5 + a^4 + a^3 + a^2 + 1
```




And the same code with the repr parameter changed (same behaviour with
repr="int") :


```
sage: F.<a>=GF(2**8, repr="log")
sage: PR.<x>=PolynomialRing(F)
sage: f=PR.random_element(9)
sage: b=F.random_element()
sage: f(b)
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
<ipython-input-5-a6714ffdcf66> in <module>()
----> 1 f(b)

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_zz_pex.so in sage.rings.polynomial.polynomial_zz_pex.Polynomial_ZZ_pEX.__call__ (sage/rings/polynomial/polynomial_zz_pex.cpp:14427)()

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8858)()

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:4206)()

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:4113)()

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/finite_rings/finite_field_givaro.pyc in _element_constructor_(self, e)
    355             2*a4^3 + 2*a4^2 + 1
    356         """
--> 357         return self._cache.element_from_data(e)
    358 
    359     def gen(self, n=0):

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/finite_rings/element_givaro.so in sage.rings.finite_rings.element_givaro.Cache_givaro.element_from_data (sage/rings/finite_rings/element_givaro.cpp:6459)()

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/finite_rings/element_givaro.so in sage.rings.finite_rings.element_givaro.Cache_givaro.element_from_data (sage/rings/finite_rings/element_givaro.cpp:5381)()

<string> in <module>()
```





Issue created by migration from https://trac.sagemath.org/ticket/16383





---

archive/issue_comments_210513.json:
```json
{
    "body": "A strange workaround :\n\nCreate the finite field with repr=\"poly\" then evaluate any polynomial in any point then change the representation of finite field elements.\n\nDemo : \n\n```\nsage: F.<a>=GF(2**8)\nsage: PR.<x>=PolynomialRing(F)\nsage: f=PR.random_element(9)\nsage: b=F.random_element()\nsage: f(b)\na^6 + a^5 + a^4 + a^3\nsage: F._cache.repr=1\nsage: f(b)\n78\nsage: f=PR.random_element(9)\nsage: f(b)\n204\nsage: f=PR.random_element(7)\nsage: b=F.random_element()\nsage: f(b)\n151\n```\n\n\nIf you don't evaluate a polynomial before changing the representation, it does not work. I don't know if changing the representation this way has any side effect.",
    "created_at": "2014-05-22T15:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16146#issuecomment-210513",
    "user": "https://trac.sagemath.org/admin/accounts/users/landais"
}
```

A strange workaround :

Create the finite field with repr="poly" then evaluate any polynomial in any point then change the representation of finite field elements.

Demo : 

```
sage: F.<a>=GF(2**8)
sage: PR.<x>=PolynomialRing(F)
sage: f=PR.random_element(9)
sage: b=F.random_element()
sage: f(b)
a^6 + a^5 + a^4 + a^3
sage: F._cache.repr=1
sage: f(b)
78
sage: f=PR.random_element(9)
sage: f(b)
204
sage: f=PR.random_element(7)
sage: b=F.random_element()
sage: f(b)
151
```


If you don't evaluate a polynomial before changing the representation, it does not work. I don't know if changing the representation this way has any side effect.



---

archive/issue_comments_210514.json:
```json
{
    "body": "Changing component from misc to finite rings.",
    "created_at": "2014-05-22T15:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16146#issuecomment-210514",
    "user": "https://trac.sagemath.org/admin/accounts/users/landais"
}
```

Changing component from misc to finite rings.



---

archive/issue_comments_210515.json:
```json
{
    "body": "It turns out that this is caused by a stupid string-based conversion between different implementations of the same finite field.  I'm now testing a patch that uses a more direct conversion instead, which also makes evaluation 20% faster in your example.",
    "created_at": "2014-05-22T17:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16146#issuecomment-210515",
    "user": "https://github.com/pjbruin"
}
```

It turns out that this is caused by a stupid string-based conversion between different implementations of the same finite field.  I'm now testing a patch that uses a more direct conversion instead, which also makes evaluation 20% faster in your example.



---

archive/issue_comments_210516.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-05-22T18:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16146#issuecomment-210516",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_210517.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-07T14:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16146#issuecomment-210517",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_210518.json:
```json
{
    "body": "Patchbot is happy with this, doctest is included with reference to ticket, and the changes are so minimal that I can immediately accept it.",
    "created_at": "2014-06-07T14:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16146#issuecomment-210518",
    "user": "https://github.com/rwst"
}
```

Patchbot is happy with this, doctest is included with reference to ticket, and the changes are so minimal that I can immediately accept it.



---

archive/issue_comments_210519.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-08T15:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16146",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16146#issuecomment-210519",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_015699.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2014-06-08T15:43:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16146",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16146#event-15699"
}
```
