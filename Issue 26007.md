# Issue 26007: Small bug in doctest framework's mapping of Python 2 exception classes to Python 3 exceptions

Issue created by migration from https://trac.sagemath.org/ticket/26244

Original creator: embray

Original creation time: 2018-09-11 14:49:06

CC:  chapoton

The doctest framework has some built-in mappings of built-in exception classes from their Python 2 spellings to their Python 3, so that doctests that expect those exceptions can be raised can be written for Python 2 but still work on Python 3: #25676

There is at least one case where the current implementation of this fails.  See: #26213#comment:22


---

Comment by embray created at 2018-09-11 14:50:17

If you would like to take a stab at it.  Otherwise I'll fix it.  It's just a question of slightly rearranging this code in `sage.doctest.forker`:


```
 702                     else:
 703                         # Special case: On Python 3 these exceptions are all
 704                         # just aliases for OSError
 705                         for alias in _OSError_ALIASES:
 706                             if example.exc_msg.startswith(alias + ':'):
 707                                 exc_msg = exc_msg.replace('OSError', alias, 1)
 708                                 break
 709                         else:
 710                             for subcls in _OSError_SUBCLASSES:
 711                                 if exc_msg.startswith(subcls + ':'):
 712                                     exc_msg = exc_msg.replace(subcls, 'OSError',
 713
 714                                                               1)
 715                                     break
```



---

Comment by embray created at 2018-12-28 14:10:15

Retargeting some of my tickets (somewhat optimistically for now).


---

Comment by embray created at 2019-03-25 10:44:36

Removing most of the rest of my open tickets out of the 8.7 milestone, which should be closed.


---

Comment by mkoeppe created at 2021-10-10 20:26:38

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-10-10 20:26:38

outdated?


---

Comment by chapoton created at 2021-10-11 12:46:03

ok


---

Comment by chapoton created at 2021-10-11 12:46:03

Resolution: invalid
