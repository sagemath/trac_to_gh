# Issue 30711: build/pkgs: Split out spkg liblzma from xz

archive/issues_030711.json:
```json
{
    "body": "CC:  dimpase jhpalmieri\n\n(from #30559)\n\nIssue created by migration from https://trac.sagemath.org/ticket/30948\n\n",
    "created_at": "2020-11-22T23:03:23Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "title": "build/pkgs: Split out spkg liblzma from xz",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30711",
    "user": "mkoeppe"
}
```
CC:  dimpase jhpalmieri

(from #30559)

Issue created by migration from https://trac.sagemath.org/ticket/30948





---

archive/issue_comments_439088.json:
```json
{
    "body": "Python should be able handle uncompressing `.tar.xz` files, so maybe we should modify the `SageTarXZFile` class in `sage_bootstrap.uncompress.tar_file`: only use it if Python can't already handle `.xz` files.",
    "created_at": "2020-11-22T23:54:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439088",
    "user": "jhpalmieri"
}
```

Python should be able handle uncompressing `.tar.xz` files, so maybe we should modify the `SageTarXZFile` class in `sage_bootstrap.uncompress.tar_file`: only use it if Python can't already handle `.xz` files.



---

archive/issue_comments_439089.json:
```json
{
    "body": "We could test\n\n```\nhasattr(tarfile.TarFile, 'xzopen')\n```\n\nfor example.",
    "created_at": "2020-11-22T23:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439089",
    "user": "jhpalmieri"
}
```

We could test

```
hasattr(tarfile.TarFile, 'xzopen')
```

for example.



---

archive/issue_comments_439090.json:
```json
{
    "body": "I guess this shouldn't be necessary: `sage_bootstrap.uncompress.action.open_archive` should check to see if `tarfile.is_tarfile(FILE)` is `True` first, and it should be for `xz` files with a supported version of Python. So I still don't know what happened in Volker's case: using an old Python?",
    "created_at": "2020-11-23T00:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439090",
    "user": "jhpalmieri"
}
```

I guess this shouldn't be necessary: `sage_bootstrap.uncompress.action.open_archive` should check to see if `tarfile.is_tarfile(FILE)` is `True` first, and it should be for `xz` files with a supported version of Python. So I still don't know what happened in Volker's case: using an old Python?



---

archive/issue_comments_439091.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439091",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_439092.json:
```json
{
    "body": "If `r` is coming from the system or `--disable-r` (#31409) is used, then we can drop the SAGE_SPKG_DEPCHECK for `xz` in `python3/spkg-configure.m4`\nbecause then there is no package depending on `liblzma` that will run in the same process as `python3`.\n(`cmake` depends on `liblzma` but it does not run in the same process.)",
    "created_at": "2021-03-26T23:51:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439092",
    "user": "mkoeppe"
}
```

If `r` is coming from the system or `--disable-r` (#31409) is used, then we can drop the SAGE_SPKG_DEPCHECK for `xz` in `python3/spkg-configure.m4`
because then there is no package depending on `liblzma` that will run in the same process as `python3`.
(`cmake` depends on `liblzma` but it does not run in the same process.)



---

archive/issue_comments_439093.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-09-26T00:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439093",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_439094.json:
```json
{
    "body": "The changes discussed in comment:2 to comment:4 still need to be implemented",
    "created_at": "2021-09-26T00:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439094",
    "user": "mkoeppe"
}
```

The changes discussed in comment:2 to comment:4 still need to be implemented



---

archive/issue_comments_439095.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-09-26T00:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439095",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_439096.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-26T00:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439096",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439097.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-26T01:02:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439097",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439098.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-26T21:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439098",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_439099.json:
```json
{
    "body": "Should there be a symlink `build/pkgs/liblzma/package-version.txt -> ../xz/package-version.txt`? Or is it okay to omit the version for `lzma`?",
    "created_at": "2021-09-29T22:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439099",
    "user": "jhpalmieri"
}
```

Should there be a symlink `build/pkgs/liblzma/package-version.txt -> ../xz/package-version.txt`? Or is it okay to omit the version for `lzma`?



---

archive/issue_comments_439100.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-29T23:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439100",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439101.json:
```json
{
    "body": "It's ok to omit it (it is using \"none\" in this case), but I agree that it's probably nicer with a version",
    "created_at": "2021-09-29T23:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439101",
    "user": "mkoeppe"
}
```

It's ok to omit it (it is using "none" in this case), but I agree that it's probably nicer with a version



---

archive/issue_comments_439102.json:
```json
{
    "body": "Thank you, looks good.",
    "created_at": "2021-09-30T04:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439102",
    "user": "jhpalmieri"
}
```

Thank you, looks good.



---

archive/issue_comments_439103.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-30T04:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439103",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_439104.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-09-30T04:59:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439104",
    "user": "mkoeppe"
}
```

Thanks!



---

archive/issue_comments_439105.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-10-02T19:01:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439105",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_439106.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2021-10-02T19:01:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439106",
    "user": "vbraun"
}
```

Merge conflict



---

archive/issue_comments_439107.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-02T19:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439107",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439108.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-10-02T19:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439108",
    "user": "mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_439109.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-10T10:17:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30711#issuecomment-439109",
    "user": "vbraun"
}
```

Resolution: fixed
