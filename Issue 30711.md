# Issue 30711: build/pkgs: Split out spkg liblzma from xz

Issue created by migration from https://trac.sagemath.org/ticket/30948

Original creator: mkoeppe

Original creation time: 2020-11-22 23:03:23

CC:  dimpase jhpalmieri

(from #30559)


---

Comment by jhpalmieri created at 2020-11-22 23:54:35

Python should be able handle uncompressing `.tar.xz` files, so maybe we should modify the `SageTarXZFile` class in `sage_bootstrap.uncompress.tar_file`: only use it if Python can't already handle `.xz` files.


---

Comment by jhpalmieri created at 2020-11-22 23:59:25

We could test

```
hasattr(tarfile.TarFile, 'xzopen')
```

for example.


---

Comment by jhpalmieri created at 2020-11-23 00:05:03

I guess this shouldn't be necessary: `sage_bootstrap.uncompress.action.open_archive` should check to see if `tarfile.is_tarfile(FILE)` is `True` first, and it should be for `xz` files with a supported version of Python. So I still don't know what happened in Volker's case: using an old Python?


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-03-26 23:51:48

If `r` is coming from the system or `--disable-r` (#31409) is used, then we can drop the SAGE_SPKG_DEPCHECK for `xz` in `python3/spkg-configure.m4`
because then there is no package depending on `liblzma` that will run in the same process as `python3`.
(`cmake` depends on `liblzma` but it does not run in the same process.)


---

Comment by mkoeppe created at 2021-09-26 00:15:38

New commits:


---

Comment by mkoeppe created at 2021-09-26 00:18:35

The changes discussed in comment:2 to comment:4 still need to be implemented


---

Comment by git created at 2021-09-26 00:55:53

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2021-09-26 00:58:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-26 01:02:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-09-26 21:48:23

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2021-09-29 22:40:28

Should there be a symlink `build/pkgs/liblzma/package-version.txt -> ../xz/package-version.txt`? Or is it okay to omit the version for `lzma`?


---

Comment by git created at 2021-09-29 23:18:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-09-29 23:19:20

It's ok to omit it (it is using "none" in this case), but I agree that it's probably nicer with a version


---

Comment by jhpalmieri created at 2021-09-30 04:51:08

Thank you, looks good.


---

Comment by jhpalmieri created at 2021-09-30 04:51:08

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-09-30 04:59:18

Thanks!


---

Comment by vbraun created at 2021-10-02 19:01:00

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2021-10-02 19:01:00

Merge conflict


---

Comment by git created at 2021-10-02 19:12:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-10-02 19:13:18

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2021-10-10 10:17:12

Resolution: fixed
