# Issue 18260: Update Sphinx to 1.3.1

archive/issues_018260.json:
```json
{
    "body": "CC:  @kiwifb\n\nKeywords: python3\n\nAdds support for python 3.4.\n\nhttp://sphinx-doc.org/changes.html\n\nIssue created by migration from https://trac.sagemath.org/ticket/18497\n\n",
    "created_at": "2015-05-25T13:03:09Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "Update Sphinx to 1.3.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18260",
    "user": "https://github.com/a-andre"
}
```
CC:  @kiwifb

Keywords: python3

Adds support for python 3.4.

http://sphinx-doc.org/changes.html

Issue created by migration from https://trac.sagemath.org/ticket/18497





---

archive/issue_comments_246356.json:
```json
{
    "body": "The given branch misses some dependencies (babel, snowballstemmer). Installing them via pip makes Sphinx build. But documentation failed to build.",
    "created_at": "2015-05-30T10:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246356",
    "user": "https://github.com/a-andre"
}
```

The given branch misses some dependencies (babel, snowballstemmer). Installing them via pip makes Sphinx build. But documentation failed to build.



---

archive/issue_comments_246357.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-06-28T00:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246357",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_246358.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2015-06-28T00:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246358",
    "user": "https://github.com/a-andre"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_246359.json:
```json
{
    "body": "Any ideas how to fix\n\n```\nTraceback (most recent call last):\n  File \"/opt/sage/src/doc/common/builder.py\", line 1626, in <module>\n    getattr(get_builder(name), type)()\n  File \"/opt/sage/src/doc/common/builder.py\", line 292, in _wrapper\n    getattr(get_builder(document), 'inventory')(*args, **kwds)\n  File \"/opt/sage/src/doc/common/builder.py\", line 503, in _wrapper\n    x.get(99999)\n  File \"/opt/sage/local/lib/python/multiprocessing/pool.py\", line 558, in get\n    raise self._value\nOSError: [categorie] /opt/sage/src/doc/en/reference/categories/sage/categories/category.rst:370: WARNING: don't know which module to import for autodocumenting u'_super_categories' (try placing a \"module\" or \"currentmodule\" directive in the document, or giving an explicit module name)\n```\n\nwithout changing\n\n```\n.. automethod:: _super_categories\n```\nto\n\n```\n.. automethod:: Category._super_categories\n```\nbecause there are a lot of these warnings.",
    "created_at": "2015-06-28T00:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246359",
    "user": "https://github.com/a-andre"
}
```

Any ideas how to fix

```
Traceback (most recent call last):
  File "/opt/sage/src/doc/common/builder.py", line 1626, in <module>
    getattr(get_builder(name), type)()
  File "/opt/sage/src/doc/common/builder.py", line 292, in _wrapper
    getattr(get_builder(document), 'inventory')(*args, **kwds)
  File "/opt/sage/src/doc/common/builder.py", line 503, in _wrapper
    x.get(99999)
  File "/opt/sage/local/lib/python/multiprocessing/pool.py", line 558, in get
    raise self._value
OSError: [categorie] /opt/sage/src/doc/en/reference/categories/sage/categories/category.rst:370: WARNING: don't know which module to import for autodocumenting u'_super_categories' (try placing a "module" or "currentmodule" directive in the document, or giving an explicit module name)
```

without changing

```
.. automethod:: _super_categories
```
to

```
.. automethod:: Category._super_categories
```
because there are a lot of these warnings.



---

archive/issue_events_052015.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-09-03T10:12:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18260#event-52015"
}
```



---

archive/issue_comments_246360.json:
```json
{
    "body": "While building sphinx I get:\n\n```\nInstalled /64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/Sphinx-1.3.1-py2.7.egg\nProcessing dependencies for Sphinx==1.3.1\nSearching for snowballstemmer>=1.1\nReading https://pypi.python.org/simple/snowballstemmer/\nDownload error on https://pypi.python.org/simple/snowballstemmer/: [Errno 110] Connection timed out -- Some packages may not be found!\nCouldn't find index page for 'snowballstemmer' (maybe misspelled?)\nScanning index of all packages (this may take a while)\nReading https://pypi.python.org/simple/\nDownload error on https://pypi.python.org/simple/: [Errno 110] Connection timed out -- Some packages may not be found!\nNo local packages or download links found for snowballstemmer>=1.1\nerror: Could not find suitable distribution for Requirement.parse('snowballstemmer>=1.1')\nError building Sphinx: 'Error installing Sphinx'\n```\nwget works just fine in downloading `snowballstemmer` from `pypi.python.org/simple/snowballstemmer`",
    "created_at": "2015-09-03T18:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246360",
    "user": "https://github.com/strogdon"
}
```

While building sphinx I get:

```
Installed /64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/Sphinx-1.3.1-py2.7.egg
Processing dependencies for Sphinx==1.3.1
Searching for snowballstemmer>=1.1
Reading https://pypi.python.org/simple/snowballstemmer/
Download error on https://pypi.python.org/simple/snowballstemmer/: [Errno 110] Connection timed out -- Some packages may not be found!
Couldn't find index page for 'snowballstemmer' (maybe misspelled?)
Scanning index of all packages (this may take a while)
Reading https://pypi.python.org/simple/
Download error on https://pypi.python.org/simple/: [Errno 110] Connection timed out -- Some packages may not be found!
No local packages or download links found for snowballstemmer>=1.1
error: Could not find suitable distribution for Requirement.parse('snowballstemmer>=1.1')
Error building Sphinx: 'Error installing Sphinx'
```
wget works just fine in downloading `snowballstemmer` from `pypi.python.org/simple/snowballstemmer`



---

archive/issue_comments_246361.json:
```json
{
    "body": "The inability to download `snowballstemmer>=1.1` seems to be because of\n\n```\nexport http_proxy=http://192.0.2.0:5187/\n```\nin `build/bin/sage-spkg`. This was supposedly fixed in #14243. Am I the only one getting this?",
    "created_at": "2015-09-08T04:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246361",
    "user": "https://github.com/strogdon"
}
```

The inability to download `snowballstemmer>=1.1` seems to be because of

```
export http_proxy=http://192.0.2.0:5187/
```
in `build/bin/sage-spkg`. This was supposedly fixed in #14243. Am I the only one getting this?



---

archive/issue_comments_246362.json:
```json
{
    "body": "Replying to [comment:6 strogdon]:\n> The inability to download `snowballstemmer>=1.1` seems to be because of\n> \n> ```\n> export http_proxy=http://192.0.2.0:5187/\n> ```\n> in `build/bin/sage-spkg`. This was supposedly fixed in #14243. Am I the only one getting this?\n\nI don't see how #14243 is related. The proxy is obviously intentional, read the comment.",
    "created_at": "2015-09-08T11:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246362",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:6 strogdon]:
> The inability to download `snowballstemmer>=1.1` seems to be because of
> 
> ```
> export http_proxy=http://192.0.2.0:5187/
> ```
> in `build/bin/sage-spkg`. This was supposedly fixed in #14243. Am I the only one getting this?

I don't see how #14243 is related. The proxy is obviously intentional, read the comment.



---

archive/issue_comments_246363.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n> I don't see how #14243 is related. The proxy is obviously intentional, read the comment.\n\nYou're right about #14243 not being related. I was a bit hasty. And I realize the proxy is intentional. But what's the work-around here to allow Sphinx to install correctly? If I'm not mistaken, the proxy is blocking `snowballstemmer` download. But maybe there is something else.",
    "created_at": "2015-09-08T13:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246363",
    "user": "https://github.com/strogdon"
}
```

Replying to [comment:7 jdemeyer]:
> I don't see how #14243 is related. The proxy is obviously intentional, read the comment.

You're right about #14243 not being related. I was a bit hasty. And I realize the proxy is intentional. But what's the work-around here to allow Sphinx to install correctly? If I'm not mistaken, the proxy is blocking `snowballstemmer` download. But maybe there is something else.



---

archive/issue_comments_246364.json:
```json
{
    "body": "Replying to [comment:8 strogdon]:\n> But what's the work-around here to allow Sphinx to install correctly?\n\nAdd a `snowballstemmer` package.",
    "created_at": "2015-09-08T13:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246364",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:8 strogdon]:
> But what's the work-around here to allow Sphinx to install correctly?

Add a `snowballstemmer` package.



---

archive/issue_comments_246365.json:
```json
{
    "body": "This works for me, but not perfectly. In addition to the changes here, I used `sage --pip install` to install `snowballstemmer` and `alabaster`. I also had to change `exclude_trees` to `exclude_patterns` wherever it occurred in doc/common: `exclude_trees` was deprecated before and has now been removed. (This was in `src/doc/common/conf.py`, `src/doc/en/reference/conf.py`, `src/doc/en/reference/conf_sub.py`.)\n\nI ran into the issue mentioned in comment:3, so I made those references more explicit (changed `_blah` to `Category._blah`, etc.). Then the file `sage/lfunctions/zero_sums.pyx` was giving me errors I didn't understand, for example\n\n```\nOSError: [lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_EllipticCurve:0: ERROR: Unknown interpreted text role \"class\".\n```\nSo I removed it from the reference manual. I'll keep looking at that file, though.\n\nThen in the second pass through the reference manual, the build stopped with complaints about missing references or citations. Maybe Sphinx is pickier now, and wants the reference before any citations to it, so I moved some of them to the top-level docstring in the file, and that helped. There is a few cross-file references, and I don't know what to do about that one except to run Sphinx again and hope it resolves the reference. The build completed this way.\n\nBy the way, Sphinx 1.3.2 (a bug-fix release) is supposed to be released in a few days.",
    "created_at": "2015-11-17T00:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246365",
    "user": "https://github.com/jhpalmieri"
}
```

This works for me, but not perfectly. In addition to the changes here, I used `sage --pip install` to install `snowballstemmer` and `alabaster`. I also had to change `exclude_trees` to `exclude_patterns` wherever it occurred in doc/common: `exclude_trees` was deprecated before and has now been removed. (This was in `src/doc/common/conf.py`, `src/doc/en/reference/conf.py`, `src/doc/en/reference/conf_sub.py`.)

I ran into the issue mentioned in comment:3, so I made those references more explicit (changed `_blah` to `Category._blah`, etc.). Then the file `sage/lfunctions/zero_sums.pyx` was giving me errors I didn't understand, for example

```
OSError: [lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_EllipticCurve:0: ERROR: Unknown interpreted text role "class".
```
So I removed it from the reference manual. I'll keep looking at that file, though.

Then in the second pass through the reference manual, the build stopped with complaints about missing references or citations. Maybe Sphinx is pickier now, and wants the reference before any citations to it, so I moved some of them to the top-level docstring in the file, and that helped. There is a few cross-file references, and I don't know what to do about that one except to run Sphinx again and hope it resolves the reference. The build completed this way.

By the way, Sphinx 1.3.2 (a bug-fix release) is supposed to be released in a few days.



---

archive/issue_comments_246366.json:
```json
{
    "body": "I have tried the same (I missed the `exclude_trees` deprecation) and I too see in the build log\n\n```\n[lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_EllipticCurve:0: ERROR: Unknown interpreted text role \"class\".\n[lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_EllipticCurve.analytic_rank_upper_bound:83: ERROR: Unknown interpreted text role \"func\".\n[lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_EllipticCurve.analytic_rank_upper_bound:83: ERROR: Unknown interpreted text role \"meth\".\n[lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_EllipticCurve.analytic_rank_upper_bound:83: ERROR: Unknown interpreted text role \"func\".\n[lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_abstract:0: ERROR: Unknown interpreted text role \"class\".\n[lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_abstract.cnlist:19: ERROR: Unknown interpreted text role \"meth\".\n[lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_abstract.completed_logarithmic_derivative:39: ERROR: Unknown interpreted text role \"meth\".\n[lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_abstract.zerosum:66: ERROR: Unknown interpreted text role \"meth\".\n```\nAnd I have been searching high and low to figure out the issue. Also, if `alabaster` is not needed then `sphinx` will have to be patched to prevent it from being imported. Something like:\n\n```\n--- Sphinx-1.3.1/sphinx/application.py\t2015-09-11 22:55:30.000000000 -0500\n+++ Sphinx-1.3.1/sphinx/application.py\t2015-09-15 17:56:42.000000000 -0500\n@@ -135,8 +135,8 @@\n         # extension loading support for alabaster theme\n         # self.config.html_theme is not set from conf.py at here\n         # for now, sphinx always load a 'alabaster' extension.\n-        if 'alabaster' not in self.config.extensions:\n-            self.config.extensions.append('alabaster')\n+        #if 'alabaster' not in self.config.extensions:\n+        #    self.config.extensions.append('alabaster')\n \n         # load all user-given extension modules\n         for extension in self.config.extensions:\n```",
    "created_at": "2015-11-17T00:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246366",
    "user": "https://github.com/strogdon"
}
```

I have tried the same (I missed the `exclude_trees` deprecation) and I too see in the build log

```
[lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_EllipticCurve:0: ERROR: Unknown interpreted text role "class".
[lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_EllipticCurve.analytic_rank_upper_bound:83: ERROR: Unknown interpreted text role "func".
[lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_EllipticCurve.analytic_rank_upper_bound:83: ERROR: Unknown interpreted text role "meth".
[lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_EllipticCurve.analytic_rank_upper_bound:83: ERROR: Unknown interpreted text role "func".
[lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_abstract:0: ERROR: Unknown interpreted text role "class".
[lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_abstract.cnlist:19: ERROR: Unknown interpreted text role "meth".
[lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_abstract.completed_logarithmic_derivative:39: ERROR: Unknown interpreted text role "meth".
[lfunction] docstring of sage.lfunctions.zero_sums.LFunctionZeroSum_abstract.zerosum:66: ERROR: Unknown interpreted text role "meth".
```
And I have been searching high and low to figure out the issue. Also, if `alabaster` is not needed then `sphinx` will have to be patched to prevent it from being imported. Something like:

```
--- Sphinx-1.3.1/sphinx/application.py	2015-09-11 22:55:30.000000000 -0500
+++ Sphinx-1.3.1/sphinx/application.py	2015-09-15 17:56:42.000000000 -0500
@@ -135,8 +135,8 @@
         # extension loading support for alabaster theme
         # self.config.html_theme is not set from conf.py at here
         # for now, sphinx always load a 'alabaster' extension.
-        if 'alabaster' not in self.config.extensions:
-            self.config.extensions.append('alabaster')
+        #if 'alabaster' not in self.config.extensions:
+        #    self.config.extensions.append('alabaster')
 
         # load all user-given extension modules
         for extension in self.config.extensions:
```



---

archive/issue_comments_246367.json:
```json
{
    "body": "I don't know why, but this change fixes the problem with `lfunctions/zero_sum.pyx`:\n\n```diff\ndiff --git a/src/sage/lfunctions/zero_sums.pyx b/src/sage/lfunctions/zero_sums.pyx\nindex 6c4535c..ff1dd86 100644\n--- a/src/sage/lfunctions/zero_sums.pyx\n+++ b/src/sage/lfunctions/zero_sums.pyx\n@@ -1341,7 +1341,6 @@ cdef class LFunctionZeroSum_EllipticCurve(LFunctionZeroSum_abstract):\n \n         return small_primes, modulus, residue_chunks\n \n-    @parallel(ncpus=NCPUS)\n     def _sum_over_residues(self, residue_sum_data):\n         r\"\"\"\n         Return the p-power sum over residues in a residue chunk\n```\nI have created a branch for testing purposes which does this and the other changes I outlined above. It is not at all ready for review. Issues:\n\n- removing this \"parallel\" decorator is probably not a good idea.\n- `snowballstemmer` needs be added as a new package.\n- Maybe `alabaster`, too? I don't see why not.\n- The issue with missing references needs to be resolved.\n \n---\nNew commits:",
    "created_at": "2015-11-17T03:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246367",
    "user": "https://github.com/jhpalmieri"
}
```

I don't know why, but this change fixes the problem with `lfunctions/zero_sum.pyx`:

```diff
diff --git a/src/sage/lfunctions/zero_sums.pyx b/src/sage/lfunctions/zero_sums.pyx
index 6c4535c..ff1dd86 100644
--- a/src/sage/lfunctions/zero_sums.pyx
+++ b/src/sage/lfunctions/zero_sums.pyx
@@ -1341,7 +1341,6 @@ cdef class LFunctionZeroSum_EllipticCurve(LFunctionZeroSum_abstract):
 
         return small_primes, modulus, residue_chunks
 
-    @parallel(ncpus=NCPUS)
     def _sum_over_residues(self, residue_sum_data):
         r"""
         Return the p-power sum over residues in a residue chunk
```
I have created a branch for testing purposes which does this and the other changes I outlined above. It is not at all ready for review. Issues:

- removing this "parallel" decorator is probably not a good idea.
- `snowballstemmer` needs be added as a new package.
- Maybe `alabaster`, too? I don't see why not.
- The issue with missing references needs to be resolved.
 
---
New commits:



---

archive/issue_comments_246368.json:
```json
{
    "body": "When I first started making changes to deal with the issue mentioned in comment:#3 I only had to make changes to these files\n\n```\nsage/categories/category.py\nsage/categories/category_with_axiom.py\nsage/sets/cartesian_product.py\nsage/combinat/permutation.py\n```\nI thought this odd and suspected that something else was the reason requiring the changes.",
    "created_at": "2015-11-17T06:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246368",
    "user": "https://github.com/strogdon"
}
```

When I first started making changes to deal with the issue mentioned in comment:#3 I only had to make changes to these files

```
sage/categories/category.py
sage/categories/category_with_axiom.py
sage/sets/cartesian_product.py
sage/combinat/permutation.py
```
I thought this odd and suspected that something else was the reason requiring the changes.



---

archive/issue_comments_246369.json:
```json
{
    "body": "I wouldn't be surprised if something else was causing those problems. I didn't do a careful case-by-case test to see which changes were necessary.",
    "created_at": "2015-11-17T06:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246369",
    "user": "https://github.com/jhpalmieri"
}
```

I wouldn't be surprised if something else was causing those problems. I didn't do a careful case-by-case test to see which changes were necessary.



---

archive/issue_comments_246370.json:
```json
{
    "body": "The huge change to `sage_autodoc.py` really scares me a lot. I already have several tickets concerning the docbuilding sitting in needs_review and this ticket here will almost certainly cause a lot of conflicts.\n\nI would much prefer to stick with the current version of Sphinx (unless you have a good reason to upgrade) and first clean up the Sphinx mess.",
    "created_at": "2015-11-17T08:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246370",
    "user": "https://github.com/jdemeyer"
}
```

The huge change to `sage_autodoc.py` really scares me a lot. I already have several tickets concerning the docbuilding sitting in needs_review and this ticket here will almost certainly cause a lot of conflicts.

I would much prefer to stick with the current version of Sphinx (unless you have a good reason to upgrade) and first clean up the Sphinx mess.



---

archive/issue_comments_246371.json:
```json
{
    "body": "See also [https://github.com/OpenDreamKit/OpenDreamKit/issues/87](https://github.com/OpenDreamKit/OpenDreamKit/issues/87)",
    "created_at": "2015-11-17T08:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246371",
    "user": "https://github.com/jdemeyer"
}
```

See also [https://github.com/OpenDreamKit/OpenDreamKit/issues/87](https://github.com/OpenDreamKit/OpenDreamKit/issues/87)



---

archive/issue_comments_246372.json:
```json
{
    "body": "[Sphinx 1.3.2](https://pypi.python.org/pypi/Sphinx) has now been released.",
    "created_at": "2015-11-29T16:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246372",
    "user": "https://github.com/jhpalmieri"
}
```

[Sphinx 1.3.2](https://pypi.python.org/pypi/Sphinx) has now been released.



---

archive/issue_comments_246373.json:
```json
{
    "body": "Again: I would much rather first clean up the Sphinx mess before upgrading it.",
    "created_at": "2015-11-29T17:11:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246373",
    "user": "https://github.com/jdemeyer"
}
```

Again: I would much rather first clean up the Sphinx mess before upgrading it.



---

archive/issue_comments_246374.json:
```json
{
    "body": "I understand that, I'm just adding the link for future reference.",
    "created_at": "2015-11-29T19:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246374",
    "user": "https://github.com/jhpalmieri"
}
```

I understand that, I'm just adding the link for future reference.



---

archive/issue_comments_246375.json:
```json
{
    "body": "[Sphinx 1.3.5 was released on 2016-01-24.](https://groups.google.com/d/msg/sphinx-dev/FtrXpX92euA/xlb6SDvdCQAJ)",
    "created_at": "2016-01-26T16:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246375",
    "user": "https://github.com/slel"
}
```

[Sphinx 1.3.5 was released on 2016-01-24.](https://groups.google.com/d/msg/sphinx-dev/FtrXpX92euA/xlb6SDvdCQAJ)



---

archive/issue_comments_246376.json:
```json
{
    "body": "If this ever gets up steam again it appears that the `inline-latex.patch` may no longer be needed. The following\n\nhttps://github.com/sphinx-doc/sphinx/issues/1480\nhttps://github.com/sphinx-doc/sphinx/pull/2188\n\nare supposedly addressed in 1.3.5 (actually fixed in 1.3.4).",
    "created_at": "2016-01-26T18:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246376",
    "user": "https://github.com/strogdon"
}
```

If this ever gets up steam again it appears that the `inline-latex.patch` may no longer be needed. The following

https://github.com/sphinx-doc/sphinx/issues/1480
https://github.com/sphinx-doc/sphinx/pull/2188

are supposedly addressed in 1.3.5 (actually fixed in 1.3.4).



---

archive/issue_comments_246377.json:
```json
{
    "body": "Replying to [comment:23 strogdon]:\n> If this ever gets up steam again\n\n\nSee [comment:19] and also the prospect of Sage Days dedicated to (amongst other things) Sphinx, organized by Nicolas Thi\u00e9ry.",
    "created_at": "2016-01-27T08:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246377",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:23 strogdon]:
> If this ever gets up steam again


See [comment:19] and also the prospect of Sage Days dedicated to (amongst other things) Sphinx, organized by Nicolas Thiéry.



---

archive/issue_events_052016.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-04-06T16:53:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18260#event-52016"
}
```



---

archive/issue_events_052017.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-04-06T16:53:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18260#event-52017"
}
```



---

archive/issue_comments_246378.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2016-04-06T16:58:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246378",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_246379.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-04-06T17:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246379",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_246380.json:
```json
{
    "body": "Rebased on #20359 except for the changes to `sage_autodoc.py` and the changes to `.. automethod::`.",
    "created_at": "2016-04-06T17:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246380",
    "user": "https://github.com/jdemeyer"
}
```

Rebased on #20359 except for the changes to `sage_autodoc.py` and the changes to `.. automethod::`.



---

archive/issue_comments_246381.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-06T18:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246381",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246382.json:
```json
{
    "body": "I get\n\n```\nBuilding reference manual, first pass.\n\nError building the documentation.\nTraceback (most recent call last):\n  File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python/runpy.py\", line 162, in _run_module_as_main\n    \"__main__\", fname, loader, pkg_name)\n  File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python/runpy.py\", line 72, in _run_code\n\n  File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py\", line 2, in <module>\n    main()\n  File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 1629, in main\n    builder()\n  File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 284, in _wrapper\n    getattr(get_builder(document), 'inventory')(*args, **kwds)\n  File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\", line 495, in _wrapper\n    x.get(99999)\n  File \"/64bitdev/storage/sage-git_develop/sage/local/lib/python/multiprocessing/pool.py\", line 567, in get\n    raise self._value\nTypeError: frompickle() takes exactly 3 arguments (2 given)\n```\nIn\n\n```\nlocal/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py\n```\nthere is\n\n```\nenv = BuildEnvironment.frompickle(config, env_pickle)\n```\nAnd in\n\n```\nlocal/lib/python2.7/site-packages/Sphinx-1.4-py2.7.egg/sphinx/environment.py\n```\nthere is\n\n```\ndef frompickle(srcdir, config, filename):\n```\nIt looks like the `srcdir` is new. I believe I've merged everything.",
    "created_at": "2016-04-06T21:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246382",
    "user": "https://github.com/strogdon"
}
```

I get

```
Building reference manual, first pass.

Error building the documentation.
Traceback (most recent call last):
  File "/64bitdev/storage/sage-git_develop/sage/local/lib/python/runpy.py", line 162, in _run_module_as_main
    "__main__", fname, loader, pkg_name)
  File "/64bitdev/storage/sage-git_develop/sage/local/lib/python/runpy.py", line 72, in _run_code

  File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
    main()
  File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 1629, in main
    builder()
  File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 284, in _wrapper
    getattr(get_builder(document), 'inventory')(*args, **kwds)
  File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py", line 495, in _wrapper
    x.get(99999)
  File "/64bitdev/storage/sage-git_develop/sage/local/lib/python/multiprocessing/pool.py", line 567, in get
    raise self._value
TypeError: frompickle() takes exactly 3 arguments (2 given)
```
In

```
local/lib/python2.7/site-packages/sage_setup/docbuild/__init__.py
```
there is

```
env = BuildEnvironment.frompickle(config, env_pickle)
```
And in

```
local/lib/python2.7/site-packages/Sphinx-1.4-py2.7.egg/sphinx/environment.py
```
there is

```
def frompickle(srcdir, config, filename):
```
It looks like the `srcdir` is new. I believe I've merged everything.



---

archive/issue_comments_246383.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-04-07T20:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246383",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_246384.json:
```json
{
    "body": "This now builds Sphinx correctly. I agree with the problem on [comment:37] but have not investigated yet.",
    "created_at": "2016-04-07T20:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246384",
    "user": "https://github.com/jdemeyer"
}
```

This now builds Sphinx correctly. I agree with the problem on [comment:37] but have not investigated yet.



---

archive/issue_comments_246385.json:
```json
{
    "body": "I don't know the right fix, but I think the problem is in this line:\n\n```diff\ndiff --git a/src/sage_setup/docbuild/__init__.py b/src/sage_setup/docbuild/__init__.py\nindex 6bfe38e..069c0a9 100644\n--- a/src/sage_setup/docbuild/__init__.py\n+++ b/src/sage_setup/docbuild/__init__.py\n@@ -767,7 +767,7 @@ class ReferenceSubBuilder(DocBuilder):\n \n         env_pickle = os.path.join(self._doctrees_dir(), 'environment.pickle')\n         try:\n-            env = BuildEnvironment.frompickle(config, env_pickle)\n+            env = BuildEnvironment.frompickle(self.dir, config, env_pickle)\n             logger.debug(\"Opened Sphinx environment: %s\", env_pickle)\n             return env\n         except IOError as err:\n```\nWith this change I get other errors, one of which can be fixed like this:\n\n```diff\ndiff --git a/src/sage_setup/docbuild/ext/sage_autodoc.py b/src/sage_setup/docbuild/ext/sage_autodoc.py\nindex 20f7168..e2073a5 100644\n--- a/src/sage_setup/docbuild/ext/sage_autodoc.py\n+++ b/src/sage_setup/docbuild/ext/sage_autodoc.py\n@@ -38,7 +38,7 @@ from sphinx.application import ExtensionError\n from sphinx.util.nodes import nested_parse_with_titles\n from sphinx.util.compat import Directive\n from sphinx.util.inspect import getargspec, isdescriptor, safe_getmembers, \\\n-     safe_getattr, safe_repr as sphinx_safe_repr, is_builtin_class_method\n+     safe_getattr, object_description as sphinx_safe_repr, is_builtin_class_method\n from sphinx.util.pycompat import base_exception, class_types\n from sphinx.util.docstrings import prepare_docstring\n \n```\nI don't know about the others, though.",
    "created_at": "2016-04-07T22:08:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246385",
    "user": "https://github.com/jhpalmieri"
}
```

I don't know the right fix, but I think the problem is in this line:

```diff
diff --git a/src/sage_setup/docbuild/__init__.py b/src/sage_setup/docbuild/__init__.py
index 6bfe38e..069c0a9 100644
--- a/src/sage_setup/docbuild/__init__.py
+++ b/src/sage_setup/docbuild/__init__.py
@@ -767,7 +767,7 @@ class ReferenceSubBuilder(DocBuilder):
 
         env_pickle = os.path.join(self._doctrees_dir(), 'environment.pickle')
         try:
-            env = BuildEnvironment.frompickle(config, env_pickle)
+            env = BuildEnvironment.frompickle(self.dir, config, env_pickle)
             logger.debug("Opened Sphinx environment: %s", env_pickle)
             return env
         except IOError as err:
```
With this change I get other errors, one of which can be fixed like this:

```diff
diff --git a/src/sage_setup/docbuild/ext/sage_autodoc.py b/src/sage_setup/docbuild/ext/sage_autodoc.py
index 20f7168..e2073a5 100644
--- a/src/sage_setup/docbuild/ext/sage_autodoc.py
+++ b/src/sage_setup/docbuild/ext/sage_autodoc.py
@@ -38,7 +38,7 @@ from sphinx.application import ExtensionError
 from sphinx.util.nodes import nested_parse_with_titles
 from sphinx.util.compat import Directive
 from sphinx.util.inspect import getargspec, isdescriptor, safe_getmembers, \
-     safe_getattr, safe_repr as sphinx_safe_repr, is_builtin_class_method
+     safe_getattr, object_description as sphinx_safe_repr, is_builtin_class_method
 from sphinx.util.pycompat import base_exception, class_types
 from sphinx.util.docstrings import prepare_docstring
 
```
I don't know about the others, though.



---

archive/issue_comments_246386.json:
```json
{
    "body": "Also, sphinx still tries to load `alabaster` even though it is not installed because of `no_alabaster.patch`. In `Sphinx-1.4/sphinx/application.py` there is\n\n```\n        # for now, sphinx always load a 'alabaster' extension.\n        if 'alabaster' not in self.config.extensions:\n            self.config.extensions.append('alabaster')\n```",
    "created_at": "2016-04-08T01:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246386",
    "user": "https://github.com/strogdon"
}
```

Also, sphinx still tries to load `alabaster` even though it is not installed because of `no_alabaster.patch`. In `Sphinx-1.4/sphinx/application.py` there is

```
        # for now, sphinx always load a 'alabaster' extension.
        if 'alabaster' not in self.config.extensions:
            self.config.extensions.append('alabaster')
```



---

archive/issue_comments_246387.json:
```json
{
    "body": "Changing keywords from \"python3\" to \"python3, days77\".",
    "created_at": "2016-04-08T11:21:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246387",
    "user": "https://github.com/jdemeyer"
}
```

Changing keywords from "python3" to "python3, days77".



---

archive/issue_comments_246388.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-08T12:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246388",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246389.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-08T14:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246389",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246390.json:
```json
{
    "body": "Replying to [comment:42 strogdon]:\n> Also, sphinx still tries to load `alabaster` even though it is not installed because of `no_alabaster.patch`.\n\n\nRight, I guess that's what I meant by \"other errors\".",
    "created_at": "2016-04-08T15:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246390",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:42 strogdon]:
> Also, sphinx still tries to load `alabaster` even though it is not installed because of `no_alabaster.patch`.


Right, I guess that's what I meant by "other errors".



---

archive/issue_comments_246391.json:
```json
{
    "body": "So, using `MAKE=make -j1` the first failures/warnings are:\n\n```\n[repl     ] /64bitdev/storage/sage-git_develop/sage/src/doc/en/reference/repl/sage/repl/display/fancy_repr.rst:13: WARNING: don't know which module to import for autodocumenting u'__call__' (try placing a \"module\" or \"currentmodule\" directive in the document, or giving an explicit module name)\n[repl     ] /64bitdev/storage/sage-git_develop/sage/src/doc/en/reference/repl/sage/repl/display/fancy_repr.rst:23: WARNING: don't know which module to import for autodocumenting u'__call__' (try placing a \"module\" or \"currentmodule\" directive in the document, or giving an explicit module name)\n[repl     ] /64bitdev/storage/sage-git_develop/sage/src/doc/en/reference/repl/sage/repl/display/fancy_repr.rst:53: WARNING: don't know which module to import for autodocumenting u'__call__' (try placing a \"module\" or \"currentmodule\" directive in the document, or giving an explicit module name)\n[repl     ] /64bitdev/storage/sage-git_develop/sage/src/doc/en/reference/repl/sage/repl/display/fancy_repr.rst:69: WARNING: don't know which module to import for autodocumenting u'__call__' (try placing a \"module\" or \"currentmodule\" directive in the document, or giving an explicit module name)\n[repl     ] /64bitdev/storage/sage-git_develop/sage/src/doc/en/reference/repl/sage/repl/display/fancy_repr.rst:79: WARNING: don't know which module to import for autodocumenting u'__call__' (try placing a \"module\" or \"currentmodule\" directive in the document, or giving an explicit module name)\n[repl     ] /64bitdev/storage/sage-git_develop/sage/src/doc/en/reference/repl/sage/repl/display/util.rst:15: WARNING: don't know which module to import for autodocumenting u'__call__' (try placing a \"module\" or \"currentmodule\" directive in the document, or giving an explicit module name)\n```\nAnd all occur where there is\n\n```\n    .. automethod:: __call__\n```\nwhich is the same type of error we had way back when. So what's the `fix` - to include the `class` name with the `method` name?",
    "created_at": "2016-04-08T15:54:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246391",
    "user": "https://github.com/strogdon"
}
```

So, using `MAKE=make -j1` the first failures/warnings are:

```
[repl     ] /64bitdev/storage/sage-git_develop/sage/src/doc/en/reference/repl/sage/repl/display/fancy_repr.rst:13: WARNING: don't know which module to import for autodocumenting u'__call__' (try placing a "module" or "currentmodule" directive in the document, or giving an explicit module name)
[repl     ] /64bitdev/storage/sage-git_develop/sage/src/doc/en/reference/repl/sage/repl/display/fancy_repr.rst:23: WARNING: don't know which module to import for autodocumenting u'__call__' (try placing a "module" or "currentmodule" directive in the document, or giving an explicit module name)
[repl     ] /64bitdev/storage/sage-git_develop/sage/src/doc/en/reference/repl/sage/repl/display/fancy_repr.rst:53: WARNING: don't know which module to import for autodocumenting u'__call__' (try placing a "module" or "currentmodule" directive in the document, or giving an explicit module name)
[repl     ] /64bitdev/storage/sage-git_develop/sage/src/doc/en/reference/repl/sage/repl/display/fancy_repr.rst:69: WARNING: don't know which module to import for autodocumenting u'__call__' (try placing a "module" or "currentmodule" directive in the document, or giving an explicit module name)
[repl     ] /64bitdev/storage/sage-git_develop/sage/src/doc/en/reference/repl/sage/repl/display/fancy_repr.rst:79: WARNING: don't know which module to import for autodocumenting u'__call__' (try placing a "module" or "currentmodule" directive in the document, or giving an explicit module name)
[repl     ] /64bitdev/storage/sage-git_develop/sage/src/doc/en/reference/repl/sage/repl/display/util.rst:15: WARNING: don't know which module to import for autodocumenting u'__call__' (try placing a "module" or "currentmodule" directive in the document, or giving an explicit module name)
```
And all occur where there is

```
    .. automethod:: __call__
```
which is the same type of error we had way back when. So what's the `fix` - to include the `class` name with the `method` name?



---

archive/issue_comments_246392.json:
```json
{
    "body": "I am working on this, hang on...",
    "created_at": "2016-04-08T16:23:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246392",
    "user": "https://github.com/jdemeyer"
}
```

I am working on this, hang on...



---

archive/issue_comments_246393.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-08T17:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246393",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246394.json:
```json
{
    "body": "I see. That's the way it is in the Sphinx `autodoc.py`.",
    "created_at": "2016-04-08T18:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246394",
    "user": "https://github.com/strogdon"
}
```

I see. That's the way it is in the Sphinx `autodoc.py`.



---

archive/issue_comments_246395.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-04-22T09:48:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246395",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_246396.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2016-04-22T16:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246396",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_246397.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-04-22T17:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246397",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_246398.json:
```json
{
    "body": "The html-docs do build once I deal with `alabaster`.\n\n```\n[tensor_fr] Extension error:\n[polynomia] Extension error:\n[repl     ] Extension error:\n[tensor_fr] Could not import extension alabaster (exception: No module named alabaster)\n```\n\nIt seems to me that that either `alabaster` must be included as a package or it must be neutered (see comment:42). Also there is a typo in `/build/pkgs/sphinx/patches/Makefile.patch`, `epdflatex` should be `pdflatex` which halts building of the latex-docs.",
    "created_at": "2016-04-22T19:10:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246398",
    "user": "https://github.com/strogdon"
}
```

The html-docs do build once I deal with `alabaster`.

```
[tensor_fr] Extension error:
[polynomia] Extension error:
[repl     ] Extension error:
[tensor_fr] Could not import extension alabaster (exception: No module named alabaster)
```

It seems to me that that either `alabaster` must be included as a package or it must be neutered (see comment:42). Also there is a typo in `/build/pkgs/sphinx/patches/Makefile.patch`, `epdflatex` should be `pdflatex` which halts building of the latex-docs.



---

archive/issue_comments_246399.json:
```json
{
    "body": "I might add that I find it amazing how this has progressed. Initially it was a nightmare.",
    "created_at": "2016-04-22T19:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246399",
    "user": "https://github.com/strogdon"
}
```

I might add that I find it amazing how this has progressed. Initially it was a nightmare.



---

archive/issue_comments_246400.json:
```json
{
    "body": "The generated documentation doesn't look bad either, there is not much difference with the old version. One thing I noticed is that the `sage:` prompts are no longer syntax highlighted in a special way. This is probably a bug, in any case it makes the documentation look more boring.",
    "created_at": "2016-04-22T20:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246400",
    "user": "https://github.com/jdemeyer"
}
```

The generated documentation doesn't look bad either, there is not much difference with the old version. One thing I noticed is that the `sage:` prompts are no longer syntax highlighted in a special way. This is probably a bug, in any case it makes the documentation look more boring.



---

archive/issue_comments_246401.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-04-22T20:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246401",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_246402.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-22T21:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246402",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246403.json:
```json
{
    "body": "Perhaps getting a bit ahead but if I force building the pdf-docs I get\n\n```\n                $\nl.6285 \\($\\prod\n               _j=1^{i-1} m_j^{-1} (mod m_i)$\\)\n```\nwhich seems to come from\n\n```\nlocal/share/doc/sage/latex/en/reference/rings_standard/rings_standard.tex\n```\n\nThe associated math formulas in\n\n```\nlocal/share/doc/sage/html/en/reference/rings_standard/sage/ext/multi_modular.html\n```\ndon't look correct.\n\nWikiFormatting is not working properly for me here. I can't get what I want inside a ``...``",
    "created_at": "2016-04-22T21:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246403",
    "user": "https://github.com/strogdon"
}
```

Perhaps getting a bit ahead but if I force building the pdf-docs I get

```
                $
l.6285 \($\prod
               _j=1^{i-1} m_j^{-1} (mod m_i)$\)
```
which seems to come from

```
local/share/doc/sage/latex/en/reference/rings_standard/rings_standard.tex
```

The associated math formulas in

```
local/share/doc/sage/html/en/reference/rings_standard/sage/ext/multi_modular.html
```
don't look correct.

WikiFormatting is not working properly for me here. I can't get what I want inside a ``...``



---

archive/issue_comments_246404.json:
```json
{
    "body": "Is this the formula on line 710 of `multi_modular.pyx`? That looks like it has extra backticks or dollar signs: the formula should have one or the other, not both.",
    "created_at": "2016-04-24T00:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246404",
    "user": "https://github.com/jhpalmieri"
}
```

Is this the formula on line 710 of `multi_modular.pyx`? That looks like it has extra backticks or dollar signs: the formula should have one or the other, not both.



---

archive/issue_comments_246405.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2016-04-24T10:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246405",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_246406.json:
```json
{
    "body": "Replying to [comment:11 strogdon]:\n> Also, if `alabaster` is not needed then `sphinx` will have to be patched to prevent it from being imported.\n\n\nI fixed this problem by simply installing `alabaster`. It's a small package, so it's not worth the trouble to patch Sphinx for it. Also, while Sage doesn't use alabaster, maybe other packages do use it.",
    "created_at": "2016-04-24T11:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246406",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 strogdon]:
> Also, if `alabaster` is not needed then `sphinx` will have to be patched to prevent it from being imported.


I fixed this problem by simply installing `alabaster`. It's a small package, so it's not worth the trouble to patch Sphinx for it. Also, while Sage doesn't use alabaster, maybe other packages do use it.



---

archive/issue_comments_246407.json:
```json
{
    "body": "Replying to [comment:65 jhpalmieri]:\n> Is this the formula on line 710 of `multi_modular.pyx`? That looks like it has extra backticks or dollar signs: the formula should have one or the other, not both.\n\n\nYes, that's it. And there is a similar problem in `src/sage/symbolic/expression.pyx` around line 8830.\n\n```\n There are two square roots of `$(x + 1)^2$`\n```\nIt appears this version of Sphinx is exposing some sphinx syntax issues in the documentation that now appear when generating the latex files for building the pdf-docs. The older sphinx -> latex must be a bit more forgiving.",
    "created_at": "2016-04-24T18:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246407",
    "user": "https://github.com/strogdon"
}
```

Replying to [comment:65 jhpalmieri]:
> Is this the formula on line 710 of `multi_modular.pyx`? That looks like it has extra backticks or dollar signs: the formula should have one or the other, not both.


Yes, that's it. And there is a similar problem in `src/sage/symbolic/expression.pyx` around line 8830.

```
 There are two square roots of `$(x + 1)^2$`
```
It appears this version of Sphinx is exposing some sphinx syntax issues in the documentation that now appear when generating the latex files for building the pdf-docs. The older sphinx -> latex must be a bit more forgiving.



---

archive/issue_comments_246408.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-24T21:16:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246408",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246409.json:
```json
{
    "body": "Replying to [comment:69 strogdon]:\n> Yes, that's it. And there is a similar problem in `src/sage/symbolic/expression.pyx` around line 8830.\n\n\nFeel free to add commits to fix such issues. I will stop rebasing this branch to make it easier for other people to push fixes.\n\nSage now builds and all doctests pass with this branch. On first sight, the documentation looks good too.",
    "created_at": "2016-04-24T21:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246409",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:69 strogdon]:
> Yes, that's it. And there is a similar problem in `src/sage/symbolic/expression.pyx` around line 8830.


Feel free to add commits to fix such issues. I will stop rebasing this branch to make it easier for other people to push fixes.

Sage now builds and all doctests pass with this branch. On first sight, the documentation looks good too.



---

archive/issue_comments_246410.json:
```json
{
    "body": "Also, I see two of\n\n```\n! LaTeX Error: Lonely \\item--perhaps a missing list environment.\n```\n\nin `docpdf.log`. After grepping through `latex/en/reference` it's because of `combinat/combinat.tex` and `graphs/graphs.tex` where there is\n\n```\n}, \\footnote[2]{\\sphinxAtStartFootnote%\\begin{enumerate}\n\\setcounter{enumi}{4}\n\\item {}\nAssmus, J. Key, Designs and their codes, CUP, 1992.\n\n\\end{enumerate}\n```\n\nI suspect this should be\n\n```\n}, \\footnote[2]{\\sphinxAtStartFootnote%\n\\begin{enumerate}\n\\setcounter{enumi}{4}\n\\item {}\nAssmus, J. Key, Designs and their codes, CUP, 1992.\n\n\\end{enumerate}\n```\n\nwhich does work. And since this is auto-generated, I suspect a bug?",
    "created_at": "2016-04-24T21:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246410",
    "user": "https://github.com/strogdon"
}
```

Also, I see two of

```
! LaTeX Error: Lonely \item--perhaps a missing list environment.
```

in `docpdf.log`. After grepping through `latex/en/reference` it's because of `combinat/combinat.tex` and `graphs/graphs.tex` where there is

```
}, \footnote[2]{\sphinxAtStartFootnote%\begin{enumerate}
\setcounter{enumi}{4}
\item {}
Assmus, J. Key, Designs and their codes, CUP, 1992.

\end{enumerate}
```

I suspect this should be

```
}, \footnote[2]{\sphinxAtStartFootnote%
\begin{enumerate}
\setcounter{enumi}{4}
\item {}
Assmus, J. Key, Designs and their codes, CUP, 1992.

\end{enumerate}
```

which does work. And since this is auto-generated, I suspect a bug?



---

archive/issue_comments_246411.json:
```json
{
    "body": "Replying to [comment:72 strogdon]:\n> And since this is auto-generated, I suspect a bug?\n\n\nThe real problem is that docutils interprets this as a list item (and that's a feature!):\n\n```\nE. Assmus, J. Key, Designs and their codes, CUP, 1992.\n```\nThis should work:\n\n```diff\n-.. [2] E. Assmus, J. Key, Designs and their codes, CUP, 1992.\n+.. [2] \\E. Assmus, J. Key, Designs and their codes, CUP, 1992.\n```",
    "created_at": "2016-04-25T09:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246411",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:72 strogdon]:
> And since this is auto-generated, I suspect a bug?


The real problem is that docutils interprets this as a list item (and that's a feature!):

```
E. Assmus, J. Key, Designs and their codes, CUP, 1992.
```
This should work:

```diff
-.. [2] E. Assmus, J. Key, Designs and their codes, CUP, 1992.
+.. [2] \E. Assmus, J. Key, Designs and their codes, CUP, 1992.
```



---

archive/issue_comments_246412.json:
```json
{
    "body": "See #20496 for this.",
    "created_at": "2016-04-25T09:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246412",
    "user": "https://github.com/jdemeyer"
}
```

See #20496 for this.



---

archive/issue_comments_246413.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-25T15:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246413",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246414.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-25T17:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246414",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246415.json:
```json
{
    "body": "Is this ready for review?",
    "created_at": "2016-04-25T22:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246415",
    "user": "https://github.com/jhpalmieri"
}
```

Is this ready for review?



---

archive/issue_comments_246416.json:
```json
{
    "body": "So I've finally been able to build the pdf-docs without error.",
    "created_at": "2016-04-26T02:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246416",
    "user": "https://github.com/strogdon"
}
```

So I've finally been able to build the pdf-docs without error.



---

archive/issue_comments_246417.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-04-26T07:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246417",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_246418.json:
```json
{
    "body": "Let's say it's ready for review then.",
    "created_at": "2016-04-26T07:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246418",
    "user": "https://github.com/jdemeyer"
}
```

Let's say it's ready for review then.



---

archive/issue_comments_246419.json:
```json
{
    "body": "This looks good. Everything builds here. I do see\n\n```\nMakefile:27: recipe for target 'all-pdf-ja' failed\nmake[2]: [all-pdf-ja] Error 255 (ignored)\nfor f in *.tex; do platex -kanji=utf8  $f; done\n```\nwhen building the Japanese pdfs (the two Japanese pdfs are generated and, as far as I can determine, look OK). Perhaps a consequence of my system Japanese lang installation which took some effort to get it to work.\n\n`@`jhpalmieri (John) add your name if you concur.",
    "created_at": "2016-04-26T16:52:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246419",
    "user": "https://github.com/strogdon"
}
```

This looks good. Everything builds here. I do see

```
Makefile:27: recipe for target 'all-pdf-ja' failed
make[2]: [all-pdf-ja] Error 255 (ignored)
for f in *.tex; do platex -kanji=utf8  $f; done
```
when building the Japanese pdfs (the two Japanese pdfs are generated and, as far as I can determine, look OK). Perhaps a consequence of my system Japanese lang installation which took some effort to get it to work.

`@`jhpalmieri (John) add your name if you concur.



---

archive/issue_comments_246420.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-04-26T16:52:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246420",
    "user": "https://github.com/strogdon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_246421.json:
```json
{
    "body": "I never managed to get the Japanese docs working, so I cannot fully test that either.",
    "created_at": "2016-04-26T17:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246421",
    "user": "https://github.com/jdemeyer"
}
```

I never managed to get the Japanese docs working, so I cannot fully test that either.



---

archive/issue_events_052018.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-04-28T15:36:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18260#event-52018"
}
```



---

archive/issue_comments_246422.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-04-28T15:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18260#issuecomment-246422",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
