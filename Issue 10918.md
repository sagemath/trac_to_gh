# Issue 10918: Update Simon's GP scripts and convert to use via gp2c

Issue created by migration from https://trac.sagemath.org/ticket/11005

Original creator: cremona

Original creation time: 2011-03-23 23:34:01

Assignee: cremona

CC:  was pbruin

1.  Denis Simon's GP scripts (in data/extcode/pari/simon) need updating.

2.  Using them via gp2c would be more efficient.

The scripts have been combined into one and revised to make the gp2c-compliant, and gp2c has been used to make a single C file from them.  This can be compiled (once, on building Sage) into a shared library file which can then be used in a GP session, the result being faster running of all the functions.

To implement this we (1) created a new spkg containing the C file, which on bring installed puts tha .so into data/extcode/pari/simon (together with a helper GP script);  (2) patched the extcode repository (removing the old scripts);  (3) patched the sage library repository, mainly to adapt the interface in elliptic_curves/gp_simon.py but also to correct the doctest output (due to the script upgrade giving different generators in some cases).

So there are two patches and an spkg needed!  I have them all and will attach them shortly.


---

Attachment

applies to 4.7.alpha1


---

Comment by cremona created at 2011-03-23 23:41:51

applies to 4.7.alpha1


---

Comment by cremona created at 2011-03-23 23:45:23

Changing status from new to needs_review.


---

Attachment


---

Comment by cremona created at 2011-03-23 23:49:11

Note to reviewers.   It is very likely that you will find elliptic curves where the scripts do not work (I have some of my own).  That is *not* a reason to reject this enhancement.  The scripts are not perfect, but they are all we have over number fields!  As a result of this ticket, we get both updated version of the scripts (with some bug-fixes and enhancements) and also faster execution.  But not perfection.


---

Comment by cremona created at 2011-03-24 05:04:11

Changing status from needs_review to needs_work.


---

Comment by cremona created at 2011-03-24 05:04:11

Not yet ready for review: still testing.


---

Attachment

New spkg


---

Comment by cremona created at 2011-03-24 17:34:55

Changing status from needs_work to needs_review.


---

Comment by mraum created at 2011-03-25 23:41:26

I created a new spkg and I updated the way to update import the library, removing one GP-script from the spkg.
I can give this a positive review, but before someone needs to test this on Mac at least.


---

Attachment


---

Comment by cremona created at 2011-04-22 16:45:56

Martin, the spkg at  http://sage.math.washington.edu/home/mraum/simon-20110321.spkg seems to be identical to my original one, which cannot be right.


---

Comment by cremona created at 2011-04-22 16:45:56

Changing status from needs_review to needs_info.


---

Comment by cremona created at 2011-04-22 16:45:56

Changing keywords from "" to "simon".


---

Comment by mraum created at 2011-04-22 17:52:47

Changing status from needs_info to needs_review.


---

Comment by mraum created at 2011-04-22 17:52:47

I checked this, but indeed this is the right package. The point was to update the spkg-install script. The rest of the spkg, I think is perfect. Well, we should incorporate the new scripts that you received by Simon.


---

Comment by mraum created at 2011-04-22 17:53:08

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2011-04-24 18:46:21

Changing keywords from "simon" to "simon spkg".


---

Comment by jdemeyer created at 2011-04-24 18:46:21

Note that adding a new standard spkg to Sage would at least require changing some files in SAGE_ROOT, in particular `spkg/install` and `spkg/standard/deps`.


---

Comment by jdemeyer created at 2011-05-02 13:33:11

I don't see much reason for this a separate spkg.  Given that it is essentially one .c file, could we not put this into the main Sage library?


---

Comment by cremona created at 2011-05-02 15:49:25

Replying to [comment:12 jdemeyer]:
> I don't see much reason for this a separate spkg.  Given that it is essentially one .c file, could we not put this into the main Sage library?

I think that is a great idea.  Putting it into an spkg seemed simpler as a way to work on it and test it, but I would be very happy to put it into the library.  I guess that can be done by applying patches to the right places (the usual Sage library, but where else? ) and then would "sage -b" be enough to include it while testing?


---

Comment by jdemeyer created at 2011-05-03 07:17:21

Replying to [comment:13 cremona]:
> I think that is a great idea.  Putting it into an spkg seemed simpler as a way to work on it and test it, but I would be very happy to put it into the library.  I guess that can be done by applying patches to the right places (the usual Sage library, but where else? ) and then would "sage -b" be enough to include it while testing?

You would need to edit also `module_list.py`.  But I haven't given this idea much thought for now, I plan to work on this after 4.7 has been released.


---

Comment by fbissey created at 2011-08-02 01:58:25

Is this the main block to getting pari-2.5.0 in (I am aware there are also issues with lcalc on OS X but they seem to be actively worked on).

The description needs editing, it talks about two patches but there are three given. Plus point (1) doesn't make complete sense (it looks like some writing I could have done at 2am and forgot about).


---

Comment by cremona created at 2011-08-02 08:14:53

I'll look at this again -- it was a lot of work (by Martin Raum, Henri Cohen and me) getting this to work at Sage Days in March, and a great disappointment that it then stalled.

But I don't think this affects the 2.5.0 issue; rather the contrary, I did not want to put more work into this one until the pari version was updated.


---

Comment by zimmerma created at 2011-09-15 15:33:40

what are the work issues for that ticket?

Paul


---

Comment by cremona created at 2011-09-15 15:56:33

This is the ticket I mentioned in my recent posting to the other ticket #9322.

I think I was waiting for Jeroen Demeyer who 5 months ago said he would look at it after 4.7 was released, but clearly had other things to do (as have I).  I'll add it to my list of things to do.

One issue I do remember is that to make Simon's scripts work here we did a lot of editing of them (to make them correctly compile with gp2c), and told Simon what we had done, then as a result he made a new version which was already gp2c-compatible.  So then someone (probably me) has to compare the versions so as to merge our changes, in effect.  For example, one set of changes I made was to have all the top-level functions take as parameters all the parameters which Simon currently sets using global gp variables;  this made his functions a lot cleaner to use.


---

Attachment


---

Comment by mraum created at 2011-12-21 12:07:05

This patch works in the sense that most tests pass. There is, though, still work to be done.


---

Comment by cremona created at 2011-12-21 15:33:43

I am now working on correcting the doctests (so not ready for review yet).


---

Comment by chapoton created at 2013-09-21 12:29:00

Changing keywords from "simon spkg" to "simon_two_descent spkg".


---

Comment by pbruin created at 2014-02-11 19:22:52

Changing status from needs_work to needs_review.


---

Comment by pbruin created at 2014-02-11 19:22:52

This branch updates Denis Simon's GP scripts to versions 06/04/2011 (`ell.gp`) resp. 13/01/2014 (`ellQ.gp`, `ellcommon.gp` [new], `qfsolve.gp`, `resultant3.gp`).  The scripts themselves were copied unchanged from Simon's website (`http://www.math.unicaen.fr/~simon/`).

Summary of the other changes:
- change `Qfsolve` and `Qfparam` to `qfsolve` and `qfparam`
- remove one doctest in `gp_simon.py` that is also in `ell_rational_field.py`
- remove `# random output` in `ell_number_field.py`; if necessary we can add `set_random_seed(0)` before that, but I got the same output every time
- doctest fixes due to changed test output
- minor documentation fixes

Of course the real work in this ticket was done (indirectly) by Denis Simon, and I just made the necessary fixes to the Sage library, but it seems to me that the "Author" field is normally used for ticket authors rather than authors of any "upstream" code; do correct me if I'm wrong.

Jeroen has opened #15809 for the `gp2c` conversion; hopefully John and Martin's hard work can somehow be transplanted there!


---

Comment by jdemeyer created at 2014-02-12 10:06:35

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-02-21 20:08:14

Resolution: fixed


---

Comment by vbraun created at 2014-02-23 17:07:34

Resolution changed from fixed to 


---

Comment by vbraun created at 2014-02-23 17:07:34

Changing status from closed to new.


---

Comment by vbraun created at 2014-02-23 17:07:34

Doctest failures on 32-bit
* http://build.sagemath.org/sage/builders/%20%20slow%20Skynet%20cicero%20%28Fedora%2016%20i686%29%20full/builds/20/steps/shell_5/logs/stdio
* http://build.sagemath.org/sage/builders/%20%20slow%20Skynet%20mark%20%28SunOS%205.10-32%29%20full/builds/24/steps/shell_5/logs/stdio


---

Comment by pbruin created at 2014-02-23 17:29:24

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2014-02-24 08:44:58

The `pbori.pyx` failure is from #15755.


---

Comment by jdemeyer created at 2014-02-24 08:54:25

Why the dependency on #15483? Now both these tickets depend on eachother. I would prefer to fix #11005 first (using `# 32-bit`/`# 64-bit`) and then do #15483 on top of this.


---

Comment by jdemeyer created at 2014-02-24 08:54:43

New commits:


---

Comment by jdemeyer created at 2014-02-24 08:54:48

Changing status from needs_review to needs_work.


---

Comment by pbruin created at 2014-02-24 11:28:18

Replying to [comment:39 jdemeyer]:
> Why the dependency on #15483?
Because #15483 is the obvious fix for the problem from comment:36.
> Now both these tickets depend on eachother. I would prefer to fix #11005 first (using `# 32-bit`/`# 64-bit`) and then do #15483 on top of this.
I thought Git was supposed to make things like this easy.  I knew that I made the two tickets depend on each other, of course, and agree that circular dependencies are _in abstracto_ not very nice.  However, in this case, what looks like a circular dependency is just a way of saying that the tickets should be merged together; the structure of the Git branches is still linear and easy to understand.  Moreover, Git will automatically give the same result independently of the ordering in which the two branches are merged.  I don't feel like spending any time on making each of the two tickets pass doctests separately.

I also realise you don't like the patch at #15483, so I will make a bit more propaganda for it.


---

Comment by jdemeyer created at 2014-02-24 13:07:36

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2014-02-27 21:28:53

Resolution: fixed
