# Issue 14398: Symbolic expression to number fields

archive/issues_014398.json:
```json
{
    "body": "Assignee: @loefflerd\n\nCC:  @videlec @mkoeppe\n\nThe ticket stands to improve the `AlgebraicConverter` in `sage.symbolic.expression_converters` to work with number fields.\n\nAs mentioned on [ask](http://ask.sagemath.org/question/2581/convert-expression-to-quadraticfield) the following fails\n\n```\nsage: K = QuadraticField(3)\nsage: K(sqrt(3))\nTraceback (most recent call last):\n...\nTypeError: ...\n```\n\nBut the following gives an answer with a wrong parent\n\n```\nsage: x = K(3)**(1/2); x\nsqrt(3)\nsage: a.parent()\nSymbolic Ring\n```\n\nwhile it is possible to do\n\n```\nsage: y = K(3).sqrt(); y\na\nsage: y == K.gen()\nTrue\n```\n\nFinally, we hopefully have\n\n```\nsage: K.gen() == sqrt(3)\nsqrt(3) == sqrt(3)\nsage: bool(K.gen() == sqrt(3))\nTrue\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/14602\n\n",
    "created_at": "2013-05-17T08:50:47Z",
    "labels": [
        "number fields",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Symbolic expression to number fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14398",
    "user": "@videlec"
}
```
Assignee: @loefflerd

CC:  @videlec @mkoeppe

The ticket stands to improve the `AlgebraicConverter` in `sage.symbolic.expression_converters` to work with number fields.

As mentioned on [ask](http://ask.sagemath.org/question/2581/convert-expression-to-quadraticfield) the following fails

```
sage: K = QuadraticField(3)
sage: K(sqrt(3))
Traceback (most recent call last):
...
TypeError: ...
```

But the following gives an answer with a wrong parent

```
sage: x = K(3)**(1/2); x
sqrt(3)
sage: a.parent()
Symbolic Ring
```

while it is possible to do

```
sage: y = K(3).sqrt(); y
a
sage: y == K.gen()
True
```

Finally, we hopefully have

```
sage: K.gen() == sqrt(3)
sqrt(3) == sqrt(3)
sage: bool(K.gen() == sqrt(3))
True
```


Issue created by migration from https://trac.sagemath.org/ticket/14602





---

archive/issue_comments_182018.json:
```json
{
    "body": "everything seems to work fine now (sage 8.9.b7)",
    "created_at": "2019-08-24T18:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182018",
    "user": "@fchapoton"
}
```

everything seems to work fine now (sage 8.9.b7)



---

archive/issue_comments_182019.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-08-24T22:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182019",
    "user": "@videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_182020.json:
```json
{
    "body": "Indeed. The situation improved.",
    "created_at": "2019-08-24T22:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182020",
    "user": "@videlec"
}
```

Indeed. The situation improved.



---

archive/issue_comments_182021.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-25T03:26:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182021",
    "user": "@kevinywlui"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_182022.json:
```json
{
    "body": "Yep.\n\nEvery example in the ticket text now works!",
    "created_at": "2019-08-25T03:26:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182022",
    "user": "@kevinywlui"
}
```

Yep.

Every example in the ticket text now works!



---

archive/issue_comments_182023.json:
```json
{
    "body": "Is this doctested somewhere ?",
    "created_at": "2019-08-25T05:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182023",
    "user": "@fchapoton"
}
```

Is this doctested somewhere ?



---

archive/issue_comments_182024.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-08-25T06:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182024",
    "user": "@kevinywlui"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_182025.json:
```json
{
    "body": "Replying to [comment:10 chapoton]:\n> Is this doctested somewhere ?\nNot as far as I can tell. Good point. Forgot to check that.",
    "created_at": "2019-08-25T06:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182025",
    "user": "@kevinywlui"
}
```

Replying to [comment:10 chapoton]:
> Is this doctested somewhere ?
Not as far as I can tell. Good point. Forgot to check that.



---

archive/issue_comments_182026.json:
```json
{
    "body": "The PR adds doctests. Note that we still have\n\n```\nsage: (K(3)^(1/2)).parent()                                                  \nSymbolic Ring\n```\n\nThat seems ok to me, but if the parent should be `K`, then I think another ticket should be opened. (The parent of `sqrt(K(3))` is `K`, and is one of the new doctests.)\n----\nNew commits:",
    "created_at": "2021-01-24T02:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182026",
    "user": "@DaveWitteMorris"
}
```

The PR adds doctests. Note that we still have

```
sage: (K(3)^(1/2)).parent()                                                  
Symbolic Ring
```

That seems ok to me, but if the parent should be `K`, then I think another ticket should be opened. (The parent of `sqrt(K(3))` is `K`, and is one of the new doctests.)
----
New commits:



---

archive/issue_comments_182027.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-01-24T03:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182027",
    "user": "@DaveWitteMorris"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_182028.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2021-01-24T03:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182028",
    "user": "@DaveWitteMorris"
}
```

Changing priority from major to minor.



---

archive/issue_comments_182029.json:
```json
{
    "body": "Could you also doctest the other embedding\n\n```\nsage: L = QuadraticField(3, embedding=-AA(3).sqrt())\nsage: bool(L.gen() == -sqrt(3))\nTrue\n```\n",
    "created_at": "2021-01-24T08:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182029",
    "user": "@videlec"
}
```

Could you also doctest the other embedding

```
sage: L = QuadraticField(3, embedding=-AA(3).sqrt())
sage: bool(L.gen() == -sqrt(3))
True
```




---

archive/issue_comments_182030.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-24T17:39:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182030",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_182031.json:
```json
{
    "body": "Thanks for the suggestion. I added this doctest.",
    "created_at": "2021-01-24T17:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182031",
    "user": "@DaveWitteMorris"
}
```

Thanks for the suggestion. I added this doctest.



---

archive/issue_comments_182032.json:
```json
{
    "body": "Thanks. Good to me. Waiting for the patchbot.",
    "created_at": "2021-01-24T18:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182032",
    "user": "@videlec"
}
```

Thanks. Good to me. Waiting for the patchbot.



---

archive/issue_comments_182033.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-01-24T20:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182033",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_182034.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-01-24T20:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182034",
    "user": "@DaveWitteMorris"
}
```

Thanks!



---

archive/issue_comments_182035.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-03-09T00:00:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14398",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14398#issuecomment-182035",
    "user": "@vbraun"
}
```

Resolution: fixed
