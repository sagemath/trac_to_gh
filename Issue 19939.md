# Issue 19939: New magic comment for doctest "# optional - latex"

Issue created by migration from Trac.

Original creator: klee

Original creation time: 2016-03-08 08:31:38

We need a new magic comment

# optional - latex

for doctests that require latex installed on the system.

In addition, the developer's manual needs to be updated to include an explanation of the ellipsis in doctests. For your information: The ellipsis is part of Python's doctest framework. In Python it's not enabled by default, but in Sage it is.


---

Comment by dkrenn created at 2016-03-08 08:42:44

Replying to [ticket:20176 klee]:
> We need a new magic comment
> 
> # optional - latex
> 
> for doctests that require latex installed on the system.
> 
> In addition, the developer's manual needs to be updated to include an explanation of the ellipsis in doctests. For your information: The ellipsis is part of Python's doctest framework. In Python it's not enabled by default, but in Sage it is. 

Maybe also adding a link to the corresponding part of the Python manual.

The two issues should be split on two tickets.


---

Comment by jdemeyer created at 2016-03-08 08:44:28

Changing component from doctest framework to documentation.


---

Comment by jdemeyer created at 2016-03-08 08:44:28

You can already use `# optional - latex` right now.


---

Comment by jhpalmieri created at 2016-03-08 16:30:50

Regarding `latex`, we could consider trying to detect whether the system has LaTeX installed and so whether to run those doctests automatically. I don't want to do this for every non-Sage piece of software mentioned in an optional flag, but maybe LaTeX deserves a special case? I'm not sure.


---

Comment by jhpalmieri created at 2016-03-09 06:20:01

For the record, I'm thinking of something like

```diff
diff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py
index 6a49e68..79567db 100644
--- a/src/sage/doctest/control.py
+++ b/src/sage/doctest/control.py
`@``@` -259,6 +259,10 `@``@` class DocTestController(SageObject):
                         if versions[0] == versions[1]:
                             options.optional.add(pkg)
 
+                from sage.misc.latex import have_latex
+                if have_latex():
+                    options.optional.add('latex')
+
                 # Check that all tags are valid
                 for o in options.optional:
                     if not optionaltag_regex.search(o):
```



---

Comment by jdemeyer created at 2016-03-09 07:23:39

See #13540 and #18904 for general discussions about automatically detecting optional flags.


---

Comment by jhpalmieri created at 2016-03-09 15:56:09

And now #20182, apparently.


---

Comment by klee created at 2016-03-09 16:02:02

Wow, you are so fast! Thank you.


---

Comment by klee created at 2016-03-17 06:08:29

New commits:


---

Comment by klee created at 2016-03-17 06:10:20

Changing status from new to needs_review.


---

Comment by dkrenn created at 2016-03-17 07:02:15

Changing status from needs_review to needs_work.


---

Comment by dkrenn created at 2016-03-17 07:02:15

Something like `:python:`RuntimeError<library/exceptions.html#exceptions.RuntimeError>`` should work for Python-links.

Changing `ellipsis marker (...)`  to `ellipsis marker ``...``` would (IMHO) make it clearer what the actual marker is, since it is typeset as code (tt-font). What do you think?


---

Comment by git created at 2016-03-18 03:00:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2016-03-18 03:01:13

Replying to [comment:10 dkrenn]:
> Something like `:python:`RuntimeError<library/exceptions.html#exceptions.RuntimeError>`` should work for Python-links.
> 
> Changing `ellipsis marker (...)`  to `ellipsis marker ``...``` would (IMHO) make it clearer what the actual marker is, since it is typeset as code (tt-font). What do you think?

Nice tips. Thank you!


---

Comment by klee created at 2016-03-18 03:01:52

Changing status from needs_work to needs_review.


---

Comment by dkrenn created at 2016-03-18 13:28:44

Changing status from needs_review to needs_work.


---

Comment by dkrenn created at 2016-03-18 13:28:44

Thanks for changing. One very small issue I just saw now: Could you make two line-breaks to avoid the long lines? (PEP8)
Apart from this, positive_review.


---

Comment by git created at 2016-03-18 15:26:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2016-03-23 04:24:19

Changing status from needs_work to needs_review.


---

Comment by dkrenn created at 2016-03-23 10:34:06

Looks good now.


---

Comment by dkrenn created at 2016-03-23 10:34:06

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-03-23 23:55:01

Resolution: fixed
