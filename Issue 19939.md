# Issue 19939: New magic comment for doctest "# optional - latex"

archive/issues_019939.json:
```json
{
    "body": "We need a new magic comment\n\n# optional - latex\n\nfor doctests that require latex installed on the system.\n\nIn addition, the developer's manual needs to be updated to include an explanation of the ellipsis in doctests. For your information: The ellipsis is part of Python's doctest framework. In Python it's not enabled by default, but in Sage it is.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20176\n\n",
    "created_at": "2016-03-08T08:31:38Z",
    "labels": [
        "component: doctest framework",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "New magic comment for doctest \"# optional - latex\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19939",
    "user": "https://github.com/kwankyu"
}
```
We need a new magic comment

# optional - latex

for doctests that require latex installed on the system.

In addition, the developer's manual needs to be updated to include an explanation of the ellipsis in doctests. For your information: The ellipsis is part of Python's doctest framework. In Python it's not enabled by default, but in Sage it is.

Issue created by migration from https://trac.sagemath.org/ticket/20176





---

archive/issue_comments_274082.json:
```json
{
    "body": "Replying to [ticket:20176 klee]:\n> We need a new magic comment\n> \n> # optional - latex\n> \n> for doctests that require latex installed on the system.\n> \n> In addition, the developer's manual needs to be updated to include an explanation of the ellipsis in doctests. For your information: The ellipsis is part of Python's doctest framework. In Python it's not enabled by default, but in Sage it is. \n\nMaybe also adding a link to the corresponding part of the Python manual.\n\nThe two issues should be split on two tickets.",
    "created_at": "2016-03-08T08:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274082",
    "user": "https://github.com/dkrenn"
}
```

Replying to [ticket:20176 klee]:
> We need a new magic comment
> 
> # optional - latex
> 
> for doctests that require latex installed on the system.
> 
> In addition, the developer's manual needs to be updated to include an explanation of the ellipsis in doctests. For your information: The ellipsis is part of Python's doctest framework. In Python it's not enabled by default, but in Sage it is. 

Maybe also adding a link to the corresponding part of the Python manual.

The two issues should be split on two tickets.



---

archive/issue_comments_274083.json:
```json
{
    "body": "Changing component from doctest framework to documentation.",
    "created_at": "2016-03-08T08:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274083",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from doctest framework to documentation.



---

archive/issue_comments_274084.json:
```json
{
    "body": "You can already use `# optional - latex` right now.",
    "created_at": "2016-03-08T08:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274084",
    "user": "https://github.com/jdemeyer"
}
```

You can already use `# optional - latex` right now.



---

archive/issue_comments_274085.json:
```json
{
    "body": "Regarding `latex`, we could consider trying to detect whether the system has LaTeX installed and so whether to run those doctests automatically. I don't want to do this for every non-Sage piece of software mentioned in an optional flag, but maybe LaTeX deserves a special case? I'm not sure.",
    "created_at": "2016-03-08T16:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274085",
    "user": "https://github.com/jhpalmieri"
}
```

Regarding `latex`, we could consider trying to detect whether the system has LaTeX installed and so whether to run those doctests automatically. I don't want to do this for every non-Sage piece of software mentioned in an optional flag, but maybe LaTeX deserves a special case? I'm not sure.



---

archive/issue_comments_274086.json:
```json
{
    "body": "For the record, I'm thinking of something like\n\n```diff\ndiff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py\nindex 6a49e68..79567db 100644\n--- a/src/sage/doctest/control.py\n+++ b/src/sage/doctest/control.py\n@@ -259,6 +259,10 @@ class DocTestController(SageObject):\n                         if versions[0] == versions[1]:\n                             options.optional.add(pkg)\n \n+                from sage.misc.latex import have_latex\n+                if have_latex():\n+                    options.optional.add('latex')\n+\n                 # Check that all tags are valid\n                 for o in options.optional:\n                     if not optionaltag_regex.search(o):\n```\n",
    "created_at": "2016-03-09T06:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274086",
    "user": "https://github.com/jhpalmieri"
}
```

For the record, I'm thinking of something like

```diff
diff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py
index 6a49e68..79567db 100644
--- a/src/sage/doctest/control.py
+++ b/src/sage/doctest/control.py
@@ -259,6 +259,10 @@ class DocTestController(SageObject):
                         if versions[0] == versions[1]:
                             options.optional.add(pkg)
 
+                from sage.misc.latex import have_latex
+                if have_latex():
+                    options.optional.add('latex')
+
                 # Check that all tags are valid
                 for o in options.optional:
                     if not optionaltag_regex.search(o):
```




---

archive/issue_comments_274087.json:
```json
{
    "body": "See #13540 and #18904 for general discussions about automatically detecting optional flags.",
    "created_at": "2016-03-09T07:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274087",
    "user": "https://github.com/jdemeyer"
}
```

See #13540 and #18904 for general discussions about automatically detecting optional flags.



---

archive/issue_comments_274088.json:
```json
{
    "body": "And now #20182, apparently.",
    "created_at": "2016-03-09T15:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274088",
    "user": "https://github.com/jhpalmieri"
}
```

And now #20182, apparently.



---

archive/issue_comments_274089.json:
```json
{
    "body": "Wow, you are so fast! Thank you.",
    "created_at": "2016-03-09T16:02:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274089",
    "user": "https://github.com/kwankyu"
}
```

Wow, you are so fast! Thank you.



---

archive/issue_comments_274090.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-03-17T06:08:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274090",
    "user": "https://github.com/kwankyu"
}
```

New commits:



---

archive/issue_comments_274091.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-03-17T06:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274091",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_274092.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-17T07:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274092",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_274093.json:
```json
{
    "body": "Something like `:python:`RuntimeError<library/exceptions.html#exceptions.RuntimeError>`` should work for Python-links.\n\nChanging `ellipsis marker (...)`  to `ellipsis marker ``...``` would (IMHO) make it clearer what the actual marker is, since it is typeset as code (tt-font). What do you think?",
    "created_at": "2016-03-17T07:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274093",
    "user": "https://github.com/dkrenn"
}
```

Something like `:python:`RuntimeError<library/exceptions.html#exceptions.RuntimeError>`` should work for Python-links.

Changing `ellipsis marker (...)`  to `ellipsis marker ``...``` would (IMHO) make it clearer what the actual marker is, since it is typeset as code (tt-font). What do you think?



---

archive/issue_comments_274094.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-18T03:00:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274094",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_274095.json:
```json
{
    "body": "Replying to [comment:10 dkrenn]:\n> Something like `:python:`RuntimeError<library/exceptions.html#exceptions.RuntimeError>`` should work for Python-links.\n> \n> Changing `ellipsis marker (...)`  to `ellipsis marker ``...``` would (IMHO) make it clearer what the actual marker is, since it is typeset as code (tt-font). What do you think?\n\nNice tips. Thank you!",
    "created_at": "2016-03-18T03:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274095",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:10 dkrenn]:
> Something like `:python:`RuntimeError<library/exceptions.html#exceptions.RuntimeError>`` should work for Python-links.
> 
> Changing `ellipsis marker (...)`  to `ellipsis marker ``...``` would (IMHO) make it clearer what the actual marker is, since it is typeset as code (tt-font). What do you think?

Nice tips. Thank you!



---

archive/issue_comments_274096.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-18T03:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274096",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_274097.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-18T13:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274097",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_274098.json:
```json
{
    "body": "Thanks for changing. One very small issue I just saw now: Could you make two line-breaks to avoid the long lines? (PEP8)\nApart from this, positive_review.",
    "created_at": "2016-03-18T13:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274098",
    "user": "https://github.com/dkrenn"
}
```

Thanks for changing. One very small issue I just saw now: Could you make two line-breaks to avoid the long lines? (PEP8)
Apart from this, positive_review.



---

archive/issue_comments_274099.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-18T15:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274099",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_274100.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-23T04:24:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274100",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_274101.json:
```json
{
    "body": "Looks good now.",
    "created_at": "2016-03-23T10:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274101",
    "user": "https://github.com/dkrenn"
}
```

Looks good now.



---

archive/issue_comments_274102.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-23T10:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274102",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_274103.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-23T23:55:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19939",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19939#issuecomment-274103",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
