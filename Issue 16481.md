# Issue 16481: Create a category for Cartesian products of groups

archive/issues_016481.json:
```json
{
    "body": "Assignee: tscrim\n\nCC:  ncohen nthiery\n\nKeywords: cartesian product, generators, categories\n\nWe can define generators of a Cartesian (direct) product of groups as a Cartesian product of the generators with the identity elements. This will fix the issue noted in https://groups.google.com/forum/#!topic/sage-devel/nlRGZpr_Je8.\n\n```\nsage: AG=cartesian_product([CyclicPermutationGroup(5),CyclicPermutationGroup(4),CyclicPermutationGroup(4)])\nsage: AG.group_generators()\n...\nAttributeError: 'CartesianProduct_with_category' object has no attribute 'gens'\nsage: AG.j_classes()\n...\nAttributeError: 'CartesianProduct_with_category' object has no attribute 'gens'\n```\n\n\nWe will do so by defining a general method in the appropriate category.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16718\n\n",
    "created_at": "2014-07-27T01:29:00Z",
    "labels": [
        "group theory",
        "major",
        "enhancement"
    ],
    "title": "Create a category for Cartesian products of groups",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16481",
    "user": "tscrim"
}
```
Assignee: tscrim

CC:  ncohen nthiery

Keywords: cartesian product, generators, categories

We can define generators of a Cartesian (direct) product of groups as a Cartesian product of the generators with the identity elements. This will fix the issue noted in https://groups.google.com/forum/#!topic/sage-devel/nlRGZpr_Je8.

```
sage: AG=cartesian_product([CyclicPermutationGroup(5),CyclicPermutationGroup(4),CyclicPermutationGroup(4)])
sage: AG.group_generators()
...
AttributeError: 'CartesianProduct_with_category' object has no attribute 'gens'
sage: AG.j_classes()
...
AttributeError: 'CartesianProduct_with_category' object has no attribute 'gens'
```


We will do so by defining a general method in the appropriate category.

Issue created by migration from https://trac.sagemath.org/ticket/16718





---

archive/issue_comments_216725.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-07-27T05:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216725",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_216726.json:
```json
{
    "body": "This also works for infinitely generated groups, but it's a hack and is work very well. I've also copied this over to monoids as well. A note for the future, these functions should be split if we implement an axiom `FinitelyGenerated`.\n----\nNew commits:",
    "created_at": "2014-07-27T05:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216726",
    "user": "tscrim"
}
```

This also works for infinitely generated groups, but it's a hack and is work very well. I've also copied this over to monoids as well. A note for the future, these functions should be split if we implement an axiom `FinitelyGenerated`.
----
New commits:



---

archive/issue_comments_216727.json:
```json
{
    "body": "Helloooooooooooooooooo !!\n\nWhy do you need to implement the same function twice ? Isn't there a way to say that `group_generators = monoid_generators` ?\n\nNathann",
    "created_at": "2014-07-27T08:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216727",
    "user": "ncohen"
}
```

Helloooooooooooooooooo !!

Why do you need to implement the same function twice ? Isn't there a way to say that `group_generators = monoid_generators` ?

Nathann



---

archive/issue_comments_216728.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2014-07-27T20:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216728",
    "user": "ncohen"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_216729.json:
```json
{
    "body": "It's better to have two separate functions because the number of generators as group is often smaller the number of generators as a monoid (usually by a factor of 2 since the inverses need to be included as generators of the monoid for torsion free generators) -- albeit Sage currently does not make a distinction, nor has the functionality I believe. Plus `group_generators` currently does not call `monoid_generators` and not all groups have a `monoid_generators` method.",
    "created_at": "2014-07-27T21:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216729",
    "user": "tscrim"
}
```

It's better to have two separate functions because the number of generators as group is often smaller the number of generators as a monoid (usually by a factor of 2 since the inverses need to be included as generators of the monoid for torsion free generators) -- albeit Sage currently does not make a distinction, nor has the functionality I believe. Plus `group_generators` currently does not call `monoid_generators` and not all groups have a `monoid_generators` method.



---

archive/issue_comments_216730.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2014-07-27T21:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216730",
    "user": "tscrim"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_216731.json:
```json
{
    "body": "Hello !\n> It's better to have two separate functions because the number of generators as group is often smaller the number of generators as a monoid (usually by a factor of 2 since the inverses need to be included as generators of the monoid for torsion free generators) -- albeit Sage currently does not make a distinction, nor has the functionality I believe. \n\nThe code that only exists in your head again ....\n\n> Plus `group_generators` currently does not call `monoid_generators` and not all groups have a `monoid_generators` method.\n\nWhy don't all groups have a `monoid_generators` method ? They are monoids, aren't they ?\n\nNathann",
    "created_at": "2014-07-28T09:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216731",
    "user": "ncohen"
}
```

Hello !
> It's better to have two separate functions because the number of generators as group is often smaller the number of generators as a monoid (usually by a factor of 2 since the inverses need to be included as generators of the monoid for torsion free generators) -- albeit Sage currently does not make a distinction, nor has the functionality I believe. 

The code that only exists in your head again ....

> Plus `group_generators` currently does not call `monoid_generators` and not all groups have a `monoid_generators` method.

Why don't all groups have a `monoid_generators` method ? They are monoids, aren't they ?

Nathann



---

archive/issue_comments_216732.json:
```json
{
    "body": "Replying to [comment:5 ncohen]:\n> The code that only exists in your head again ....\n\nThere's thousands of lines by hundreds of people. `:p`\n\n> > Plus `group_generators` currently does not call `monoid_generators` and not all groups have a `monoid_generators` method.\n> \n> Why don't all groups have a `monoid_generators` method ? They are monoids, aren't they ?\n\nYes, but as I stated above, there are often more generators as a monoid than as a group. For example, take `ZZ` under addition, there is 1 generator as a group (`+1`) but 2 generators as a monoid (`+/-1`). However for C<sub>n</sub> (cyclic group), the generators as a group and as a monoid are the same. I guess we could define the monoid generators as the group generators and their inverses as a general method for general groups and for finite groups, the generators as a group also generate as a monoid. This is now #16725.\n\nAs for why this is not there for many groups is that they were implemented before monoids were considered in Sage (I believe).",
    "created_at": "2014-07-28T17:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216732",
    "user": "tscrim"
}
```

Replying to [comment:5 ncohen]:
> The code that only exists in your head again ....

There's thousands of lines by hundreds of people. `:p`

> > Plus `group_generators` currently does not call `monoid_generators` and not all groups have a `monoid_generators` method.
> 
> Why don't all groups have a `monoid_generators` method ? They are monoids, aren't they ?

Yes, but as I stated above, there are often more generators as a monoid than as a group. For example, take `ZZ` under addition, there is 1 generator as a group (`+1`) but 2 generators as a monoid (`+/-1`). However for C<sub>n</sub> (cyclic group), the generators as a group and as a monoid are the same. I guess we could define the monoid generators as the group generators and their inverses as a general method for general groups and for finite groups, the generators as a group also generate as a monoid. This is now #16725.

As for why this is not there for many groups is that they were implemented before monoids were considered in Sage (I believe).



---

archive/issue_comments_216733.json:
```json
{
    "body": "Hello !!\n\nCould you add doctests for the infinite case ?\n\nAlso, why `M.monoid_generators().cardinality() != float('inf')` instead of `M.monoid_generators().is_finite()` ?\n\nNathann",
    "created_at": "2014-07-28T19:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216733",
    "user": "ncohen"
}
```

Hello !!

Could you add doctests for the infinite case ?

Also, why `M.monoid_generators().cardinality() != float('inf')` instead of `M.monoid_generators().is_finite()` ?

Nathann



---

archive/issue_comments_216734.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-29T21:06:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216734",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216735.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-29T21:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216735",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216736.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-29T21:19:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216736",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216737.json:
```json
{
    "body": "Replying to [comment:7 ncohen]:\n> Could you add doctests for the infinite case ?\n\nDone.\n\n> Also, why `M.monoid_generators().cardinality() != float('inf')` instead of `M.monoid_generators().is_finite()` ?\n\nI've changed this to `in FiniteEnumeratedSets()` which is more restrictive, but it is safer. I've also added a second safety check in case `*_generators()` returns a tuple or a list (it shouldn't and maybe tuple/list should be considered as a objects in `FiniteEnumeratedSets()`?).",
    "created_at": "2014-07-29T21:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216737",
    "user": "tscrim"
}
```

Replying to [comment:7 ncohen]:
> Could you add doctests for the infinite case ?

Done.

> Also, why `M.monoid_generators().cardinality() != float('inf')` instead of `M.monoid_generators().is_finite()` ?

I've changed this to `in FiniteEnumeratedSets()` which is more restrictive, but it is safer. I've also added a second safety check in case `*_generators()` returns a tuple or a list (it shouldn't and maybe tuple/list should be considered as a objects in `FiniteEnumeratedSets()`?).



---

archive/issue_comments_216738.json:
```json
{
    "body": "Yo.\n\n> I've changed this to `in FiniteEnumeratedSets()` which is more restrictive, but it is safer.\n\nIt is also more costly. Really it would all be okay if this was compiled code, but I keep thinking of what happens when a line like \n\n```\nif all(M.monoid_generators() in FiniteEnumeratedSets()\n  or isinstance(M.monoid_generators(), (tuple, list)) for M in F):\n  ret = [lift(i, gen) for i,M in enumerate(F) for gen in M.monoid_generators()]\n```\n\nis executed and it really is awful... `monoid_generators()` is called once or twice per factor, the caching mechanism does its job to return the pre-computed generators if necessary, `FiniteEnumeratedSets()` is also created at each turn and because it is a `UniqueRepresentation` of something there is a lookup going on there too....\n\n> I've also added a second safety check in case `*_generators()` returns a tuple or a list (it shouldn't and maybe tuple/list should be considered as a objects in `FiniteEnumeratedSets()`?).\n\nDon't know ... Then you would have stuff which is detected as `FiniteEnumeratedSet` but does not inherit the methods... Well...\n\nOkay. Despite the fact that I really do not like categories and probably never will, thank you for fixing that, your patch does the job. Can you fix the broken doctests ? It can be set to `positive_review` afterwards.\n\nNathann",
    "created_at": "2014-07-29T21:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216738",
    "user": "ncohen"
}
```

Yo.

> I've changed this to `in FiniteEnumeratedSets()` which is more restrictive, but it is safer.

It is also more costly. Really it would all be okay if this was compiled code, but I keep thinking of what happens when a line like 

```
if all(M.monoid_generators() in FiniteEnumeratedSets()
  or isinstance(M.monoid_generators(), (tuple, list)) for M in F):
  ret = [lift(i, gen) for i,M in enumerate(F) for gen in M.monoid_generators()]
```

is executed and it really is awful... `monoid_generators()` is called once or twice per factor, the caching mechanism does its job to return the pre-computed generators if necessary, `FiniteEnumeratedSets()` is also created at each turn and because it is a `UniqueRepresentation` of something there is a lookup going on there too....

> I've also added a second safety check in case `*_generators()` returns a tuple or a list (it shouldn't and maybe tuple/list should be considered as a objects in `FiniteEnumeratedSets()`?).

Don't know ... Then you would have stuff which is detected as `FiniteEnumeratedSet` but does not inherit the methods... Well...

Okay. Despite the fact that I really do not like categories and probably never will, thank you for fixing that, your patch does the job. Can you fix the broken doctests ? It can be set to `positive_review` afterwards.

Nathann



---

archive/issue_comments_216739.json:
```json
{
    "body": "Sorry, I forgot to give you the files \n\n```\n----------------------------------------------------------------------\nsage -t --long algebras.py  # 1 doctest failed\nsage -t --long covariant_functorial_construction.py  # 2 doctests failed\nsage -t --long cartesian_product.py  # 3 doctests failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2014-07-29T21:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216739",
    "user": "ncohen"
}
```

Sorry, I forgot to give you the files 

```
----------------------------------------------------------------------
sage -t --long algebras.py  # 1 doctest failed
sage -t --long covariant_functorial_construction.py  # 2 doctests failed
sage -t --long cartesian_product.py  # 3 doctests failed
----------------------------------------------------------------------
```




---

archive/issue_comments_216740.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-29T22:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216740",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216741.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-29T22:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216741",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216742.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-07-29T22:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216742",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_216743.json:
```json
{
    "body": "Replying to [comment:12 ncohen]:\n> It is also more costly. Really it would all be okay if this was compiled code, but I keep thinking of what happens when a line like \n> {{{\n> if all(M.monoid_generators() in FiniteEnumeratedSets()\n>   or isinstance(M.monoid_generators(), (tuple, list)) for M in F):\n>   ret = [lift(i, gen) for i,M in enumerate(F) for gen in M.monoid_generators()]\n> }}}\n> is executed and it really is awful... `monoid_generators()` is called once or twice per factor, the caching mechanism does its job to return the pre-computed generators if necessary, `FiniteEnumeratedSets()` is also created at each turn and because it is a `UniqueRepresentation` of something there is a lookup going on there too....\n\nI changed it to create `FiniteEnumeratedSets()` outside of the loop (its a micro-optimization: the result is cached and the number of factors is small). However `*_generators` is very rarely to be called twice and not short-circuit the `all` (because `*_generators` should return a `Family`), and it should be cached.\n\n> Don't know ... Then you would have stuff which is detected as `FiniteEnumeratedSet` but does not inherit the methods... Well...\n\nAnother question for me to ask Nicolas next time I see him.\n\n> Okay. Despite the fact that I really do not like categories and probably never will, thank you for fixing that, your patch does the job. Can you fix the broken doctests ? It can be set to `positive_review` afterwards.\n\nThanks Nathann!",
    "created_at": "2014-07-29T22:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216743",
    "user": "tscrim"
}
```

Replying to [comment:12 ncohen]:
> It is also more costly. Really it would all be okay if this was compiled code, but I keep thinking of what happens when a line like 
> {{{
> if all(M.monoid_generators() in FiniteEnumeratedSets()
>   or isinstance(M.monoid_generators(), (tuple, list)) for M in F):
>   ret = [lift(i, gen) for i,M in enumerate(F) for gen in M.monoid_generators()]
> }}}
> is executed and it really is awful... `monoid_generators()` is called once or twice per factor, the caching mechanism does its job to return the pre-computed generators if necessary, `FiniteEnumeratedSets()` is also created at each turn and because it is a `UniqueRepresentation` of something there is a lookup going on there too....

I changed it to create `FiniteEnumeratedSets()` outside of the loop (its a micro-optimization: the result is cached and the number of factors is small). However `*_generators` is very rarely to be called twice and not short-circuit the `all` (because `*_generators` should return a `Family`), and it should be cached.

> Don't know ... Then you would have stuff which is detected as `FiniteEnumeratedSet` but does not inherit the methods... Well...

Another question for me to ask Nicolas next time I see him.

> Okay. Despite the fact that I really do not like categories and probably never will, thank you for fixing that, your patch does the job. Can you fix the broken doctests ? It can be set to `positive_review` afterwards.

Thanks Nathann!



---

archive/issue_comments_216744.json:
```json
{
    "body": "Yoooooooo !\n\n> I changed it to create `FiniteEnumeratedSets()` outside of the loop (its a micro-optimization: the result is cached and the number of factors is small).\n\nThanks for that `:-)`\n\nNathann",
    "created_at": "2014-07-30T06:39:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216744",
    "user": "ncohen"
}
```

Yoooooooo !

> I changed it to create `FiniteEnumeratedSets()` outside of the loop (its a micro-optimization: the result is cached and the number of factors is small).

Thanks for that `:-)`

Nathann



---

archive/issue_comments_216745.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-07-31T00:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16481",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16481#issuecomment-216745",
    "user": "vbraun"
}
```

Resolution: fixed
