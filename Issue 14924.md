# Issue 14924: Parent/Element relation for ChainComplex/Chain

archive/issues_014924.json:
```json
{
    "body": "CC:  jhpalmieri tscrim\n\nNothing in `sage.homology` makes use of the Parent/Element framework. But it would be nice to be able to work with chains and use normal syntax for addition and multiplication by scalars. The aim of this ticket is to adapt chain complexes. The analogous project for cell complexes will be left for a future ticket.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15161\n\n",
    "created_at": "2013-09-05T17:03:39Z",
    "labels": [
        "algebraic topology",
        "major",
        "enhancement"
    ],
    "title": "Parent/Element relation for ChainComplex/Chain",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14924",
    "user": "vbraun"
}
```
CC:  jhpalmieri tscrim

Nothing in `sage.homology` makes use of the Parent/Element framework. But it would be nice to be able to work with chains and use normal syntax for addition and multiplication by scalars. The aim of this ticket is to adapt chain complexes. The analogous project for cell complexes will be left for a future ticket.

Issue created by migration from https://trac.sagemath.org/ticket/15161





---

archive/issue_comments_190652.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-09-05T21:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190652",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_190653.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-09-07T21:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190653",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_190654.json:
```json
{
    "body": "comment:2 is a minor screwup of the scripts, only the first commit should have been listed...\n\nIn any case, all tests pass for me and I did what I wanted to do on this ticket. Ready for review...",
    "created_at": "2013-09-07T21:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190654",
    "user": "vbraun"
}
```

comment:2 is a minor screwup of the scripts, only the first commit should have been listed...

In any case, all tests pass for me and I did what I wanted to do on this ticket. Ready for review...



---

archive/issue_comments_190655.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-09-07T21:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190655",
    "user": "vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_190656.json:
```json
{
    "body": "I don't understand the example `C.an_element()` in the ticket description: all of the differentials are zero, so the various listed elements can't be mapping to each other. I would expect that an element would be an element of a single `C^i`, or possibly an element of the direct sum of all of the `C^i`'s, and I would prefer the first choice.",
    "created_at": "2013-09-08T03:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190656",
    "user": "jhpalmieri"
}
```

I don't understand the example `C.an_element()` in the ticket description: all of the differentials are zero, so the various listed elements can't be mapping to each other. I would expect that an element would be an element of a single `C^i`, or possibly an element of the direct sum of all of the `C^i`'s, and I would prefer the first choice.



---

archive/issue_comments_190657.json:
```json
{
    "body": "Here, element = chain, i.e. an element of the direct sum of the `C_i`. That is the most general notion of element, so it is the one that ought to be implemented. The arrows in the ascii art are there to visualize the relative position in the complex. And they are `\\to` and not `\\mapsto` arrows... Do you have a better ascii art representation in mind?\n\nSince it is useful to see the coordinate expression of a chain that is supported only in a single degree (e.g. homology generators) they are printed differently: \n\n```\nsage: D = ChainComplex({0: matrix(ZZ, 2, 2, [1,0,0,2])})\nsage: D()\nTrivial chain\nsage: D({0:[2, 3]})\nChain(0:(2, 3))\nsage: D({0:[2, 3], 1:[4, 5]})\nChain with 2 nonzero terms over Integer Ring\nsage: z = D({1:[0,1]})\nsage: z.is_boundary()\nFalse\nsage: (2*z).is_boundary()\nTrue\n```\n",
    "created_at": "2013-09-08T10:52:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190657",
    "user": "vbraun"
}
```

Here, element = chain, i.e. an element of the direct sum of the `C_i`. That is the most general notion of element, so it is the one that ought to be implemented. The arrows in the ascii art are there to visualize the relative position in the complex. And they are `\to` and not `\mapsto` arrows... Do you have a better ascii art representation in mind?

Since it is useful to see the coordinate expression of a chain that is supported only in a single degree (e.g. homology generators) they are printed differently: 

```
sage: D = ChainComplex({0: matrix(ZZ, 2, 2, [1,0,0,2])})
sage: D()
Trivial chain
sage: D({0:[2, 3]})
Chain(0:(2, 3))
sage: D({0:[2, 3], 1:[4, 5]})
Chain with 2 nonzero terms over Integer Ring
sage: z = D({1:[0,1]})
sage: z.is_boundary()
False
sage: (2*z).is_boundary()
True
```




---

archive/issue_comments_190658.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-09-08T11:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190658",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_190659.json:
```json
{
    "body": "I've been busy with various departmental duties for the past month, but I'd like to start reviewing this soon. I don't know how to review git tickets, though, and the directions I've found seem to be contradictory (if I download Sage from git and type `make`, it fails because the top-level Makefile refers to spkg/pipestatus, while everything has been moved from `spkg` to `build`. If I switch branches to `build_system`, then it builds but `./sage --dev ...` doesn't work).\n\nFurthermore, I don't know how to look at the relevant changes easily. Do I really need to look at half a dozen different changesets, or is there a unified view somewhere? On this ticket, the \"branch\" field doesn't seem to be active, but on a ticket like #15202, if I click on \"Commits\" I get a pretty diagram, and then from there if I click on \"View changes\", I get \"504 Gateway Time-out.  The server didn't respond in time.\" I guess I'm supposed to click on the branch name instead?",
    "created_at": "2013-10-07T05:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190659",
    "user": "jhpalmieri"
}
```

I've been busy with various departmental duties for the past month, but I'd like to start reviewing this soon. I don't know how to review git tickets, though, and the directions I've found seem to be contradictory (if I download Sage from git and type `make`, it fails because the top-level Makefile refers to spkg/pipestatus, while everything has been moved from `spkg` to `build`. If I switch branches to `build_system`, then it builds but `./sage --dev ...` doesn't work).

Furthermore, I don't know how to look at the relevant changes easily. Do I really need to look at half a dozen different changesets, or is there a unified view somewhere? On this ticket, the "branch" field doesn't seem to be active, but on a ticket like #15202, if I click on "Commits" I get a pretty diagram, and then from there if I click on "View changes", I get "504 Gateway Time-out.  The server didn't respond in time." I guess I'm supposed to click on the branch name instead?



---

archive/issue_comments_190660.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-10-07T11:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190660",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_190661.json:
```json
{
    "body": "Starting this week, using git should be relatively simple. If you download the current master from github (say) then installation should just work. See http://trac.sagemath.org/wiki/QuickStartSageGit\n\nThe developer scripts should also work as in http://sagemath.github.io/git-developer-guide/walk_through.html:\n\n```\nsage -dev checkout --ticket 15161\n```\n\ngets you the source code. Then make/test as usual. To see all source code changes relative to the master branch, use\n\n```\nsage -dev diff --base master\n```\n\n\n* I just merged in the current master so this ticket contains the dev scripts, too.\n\n* The changeset browser in trac still needs some love...",
    "created_at": "2013-10-07T11:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190661",
    "user": "vbraun"
}
```

Starting this week, using git should be relatively simple. If you download the current master from github (say) then installation should just work. See http://trac.sagemath.org/wiki/QuickStartSageGit

The developer scripts should also work as in http://sagemath.github.io/git-developer-guide/walk_through.html:

```
sage -dev checkout --ticket 15161
```

gets you the source code. Then make/test as usual. To see all source code changes relative to the master branch, use

```
sage -dev diff --base master
```


* I just merged in the current master so this ticket contains the dev scripts, too.

* The changeset browser in trac still needs some love...



---

archive/issue_comments_190662.json:
```json
{
    "body": "On a quick reading of chain_complex.py:\n\n- Do you want to add your name to the `AUTHORS` list at the top of chain_complex.py?\n- In the docstring for `ChainComplex_class`, change ``base_ring`` to ```base_ring```\n- In the docstring for `differential`, the spaces aren't lined up right in the indented part for `dim`. Same thing happens several other places. I guess I ought to be able to fix issues like this and then push them to a branch of my own. Meanwhile, I've attached a patch file with the changes.\n- In `betti`, well, first, I hope we are moving toward using CHomP as much as possible for homology computations. Given this, if we have a chain complex over a finite field, it may be faster to CHomP to compute its homology (hence its Betti numbers) than to use Sage to compute its homology over `Q` (which is a little strange anyway, if the chain complex is over a finite field). So the beginning part of the code might use the complex's base ring by default, if it's a field, rather than using `QQ` by default.\n- I wonder if we should deprecate the method `torsion_list`. Maybe this is more appropriate for a Sage worksheet than Sage source code; what do you think?\n\nI'll keep working on this.",
    "created_at": "2013-10-07T21:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190662",
    "user": "jhpalmieri"
}
```

On a quick reading of chain_complex.py:

- Do you want to add your name to the `AUTHORS` list at the top of chain_complex.py?
- In the docstring for `ChainComplex_class`, change ``base_ring`` to ```base_ring```
- In the docstring for `differential`, the spaces aren't lined up right in the indented part for `dim`. Same thing happens several other places. I guess I ought to be able to fix issues like this and then push them to a branch of my own. Meanwhile, I've attached a patch file with the changes.
- In `betti`, well, first, I hope we are moving toward using CHomP as much as possible for homology computations. Given this, if we have a chain complex over a finite field, it may be faster to CHomP to compute its homology (hence its Betti numbers) than to use Sage to compute its homology over `Q` (which is a little strange anyway, if the chain complex is over a finite field). So the beginning part of the code might use the complex's base ring by default, if it's a field, rather than using `QQ` by default.
- I wonder if we should deprecate the method `torsion_list`. Maybe this is more appropriate for a Sage worksheet than Sage source code; what do you think?

I'll keep working on this.



---

archive/issue_comments_190663.json:
```json
{
    "body": "Attachment\n\nfixes white space and other small issues in some docstrings",
    "created_at": "2013-10-07T21:40:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190663",
    "user": "jhpalmieri"
}
```

Attachment

fixes white space and other small issues in some docstrings



---

archive/issue_comments_190664.json:
```json
{
    "body": "In cell_complex.py, just about everything looks good, except for one misformatted docstring (plus the missing word \"as\"):\n\n```diff\ndiff --git a/src/sage/homology/cell_complex.py b/src/sage/homology/cell_complex.py\nindex d736837..02d53fa 100644\n--- a/src/sage/homology/cell_complex.py\n+++ b/src/sage/homology/cell_complex.py\n@@ -20,7 +20,8 @@ by developers producing new classes, not casual users.\n     the :meth:`~GenericCellComplex.homology` method get passed on to\n     the :meth:`~GenericCellComplex.chain_complex` method and also to\n     the constructor for chain complexes in\n-    :class:`sage.homology.chain_complex.ChainComplex_class <ChainComplex>`, as well its\n+    :class:`ChainComplex <sage.homology.chain_complex.ChainComplex_class>`,\n+    as well as its\n     associated\n     :meth:`~sage.homology.chain_complex.ChainComplex_class.homology` method.\n     This means that those keywords should have consistent meaning in\n```\n\n\nAlso, the newly created files (`matrix_utils.py` and `homology_group.py`) should be added to the reference manual.",
    "created_at": "2013-10-08T22:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190664",
    "user": "jhpalmieri"
}
```

In cell_complex.py, just about everything looks good, except for one misformatted docstring (plus the missing word "as"):

```diff
diff --git a/src/sage/homology/cell_complex.py b/src/sage/homology/cell_complex.py
index d736837..02d53fa 100644
--- a/src/sage/homology/cell_complex.py
+++ b/src/sage/homology/cell_complex.py
@@ -20,7 +20,8 @@ by developers producing new classes, not casual users.
     the :meth:`~GenericCellComplex.homology` method get passed on to
     the :meth:`~GenericCellComplex.chain_complex` method and also to
     the constructor for chain complexes in
-    :class:`sage.homology.chain_complex.ChainComplex_class <ChainComplex>`, as well its
+    :class:`ChainComplex <sage.homology.chain_complex.ChainComplex_class>`,
+    as well as its
     associated
     :meth:`~sage.homology.chain_complex.ChainComplex_class.homology` method.
     This means that those keywords should have consistent meaning in
```


Also, the newly created files (`matrix_utils.py` and `homology_group.py`) should be added to the reference manual.



---

archive/issue_comments_190665.json:
```json
{
    "body": "Hey Volker and John,\n\nI've worked in all of John's documentation changes and made a few of my own (plus rebased to the latest version of Sage). I don't think we should deprecate `torsion_list()` as it's not doing any harm and someone might find (or be finding) it useful. If you're happy with my changes, then I think we can set this to positive review.\n\nBest,\n\nTravis\n----\nNew commits:",
    "created_at": "2013-12-01T04:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190665",
    "user": "tscrim"
}
```

Hey Volker and John,

I've worked in all of John's documentation changes and made a few of my own (plus rebased to the latest version of Sage). I don't think we should deprecate `torsion_list()` as it's not doing any harm and someone might find (or be finding) it useful. If you're happy with my changes, then I think we can set this to positive review.

Best,

Travis
----
New commits:



---

archive/issue_comments_190666.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-01T06:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190666",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_190667.json:
```json
{
    "body": "I'd also like this change:\n\n```diff\ndiff --git a/src/doc/en/reference/homology/index.rst b/src/doc/en/reference/homology/index\nindex 82c2f33..147cd8c 100644\n--- a/src/doc/en/reference/homology/index.rst\n+++ b/src/doc/en/reference/homology/index.rst\n@@ -21,6 +21,8 @@ cell complexes.\n    sage/homology/delta_complex\n    sage/homology/cubical_complex\n    sage/homology/cell_complex\n+   sage/homology/homology_group\n+   sage/homology/matrix_utils\n    sage/interfaces/chomp\n \n .. include:: ../footer.txt\n```\n",
    "created_at": "2013-12-01T06:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190667",
    "user": "jhpalmieri"
}
```

I'd also like this change:

```diff
diff --git a/src/doc/en/reference/homology/index.rst b/src/doc/en/reference/homology/index
index 82c2f33..147cd8c 100644
--- a/src/doc/en/reference/homology/index.rst
+++ b/src/doc/en/reference/homology/index.rst
@@ -21,6 +21,8 @@ cell complexes.
    sage/homology/delta_complex
    sage/homology/cubical_complex
    sage/homology/cell_complex
+   sage/homology/homology_group
+   sage/homology/matrix_utils
    sage/interfaces/chomp
 
 .. include:: ../footer.txt
```




---

archive/issue_comments_190668.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-02T16:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190668",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_190669.json:
```json
{
    "body": "Ack, I completely forgot about that. Done.",
    "created_at": "2013-12-02T16:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190669",
    "user": "tscrim"
}
```

Ack, I completely forgot about that. Done.



---

archive/issue_comments_190670.json:
```json
{
    "body": "Everything looks good to me.",
    "created_at": "2013-12-04T19:16:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190670",
    "user": "jhpalmieri"
}
```

Everything looks good to me.



---

archive/issue_comments_190671.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-04T19:16:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190671",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_190672.json:
```json
{
    "body": "I don't think what I did warrants author credits (especially since most of what I changes was in John's review patch `:)` ).",
    "created_at": "2013-12-05T02:24:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190672",
    "user": "tscrim"
}
```

I don't think what I did warrants author credits (especially since most of what I changes was in John's review patch `:)` ).



---

archive/issue_comments_190673.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-21T12:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190673",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_190674.json:
```json
{
    "body": "See #15730 for a follow-up.",
    "created_at": "2014-01-24T22:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14924#issuecomment-190674",
    "user": "jhpalmieri"
}
```

See #15730 for a follow-up.
