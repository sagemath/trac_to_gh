# Issue 16393: Fix category for finite Coxeter groups

Issue created by migration from https://trac.sagemath.org/ticket/16630

Original creator: tscrim

Original creation time: 2014-07-09 04:21:47

Assignee: tscrim

CC:  nthiery chapoton jipilab vripoll

Keywords: Coxeter, category

Currently finite Coxeter groups don't know that they are finite.

```
sage: CG = CoxeterGroup(['D',4])
sage: CG.category()
Category of coxeter groups
```



---

Comment by tscrim created at 2014-07-09 07:33:25

Okay, it's now up for review. It feels somewhat hacky to me (in particular, I had to catch an `OverflowError`), but it comes from Sage's somewhat lack of ability to compute positive definiteness of a matrix over a variety of fields. Although I do feel that checking for positive definiteness is better than doing the matrix comparisons, at least as a first try. meh *shrugs*
----
New commits:


---

Comment by tscrim created at 2014-07-09 07:33:25

Changing status from new to needs_review.


---

Comment by darij created at 2014-07-29 18:23:57

What does this have to do with real numbers?


---

Comment by tscrim created at 2014-07-30 03:39:30

It has to do with `positive_definite` trying to work over `RR` but the default for the matrices (for the Coexter groups) is over the universal cyclotomic field.


---

Comment by darij created at 2014-07-30 09:25:22

Ah, I see. Hmm, are these matrices bounded away from singularity well enough that we can trust this to work? Otherwise I'd rather take the irreducible decomposition of the matrix (Dijkstra's algorithm, should be fast) and check each of them for being a Coxeter-Dynkin diagram (now that can be annoying). I assume the two steps of this procedure (irreducible decomposition and Coxeter-Dynkin classification) are something we want to have anyway; or do we already?


---

Comment by tscrim created at 2014-07-30 15:29:03

As far as I've tested. The fallback (in case an error is raised) is to check by comparing Coxeter matrices under the standard labeling, but does not break it up into irreducible components. It probably is better to do the process entirely using graph comparisons (it feels like it should be slower, but maybe it's not...). Although no such check has been implemented for Coxeter diagrams/matrices, which currently don't have dedicated classes (#16126). (BTW there's only limited support for Dynkin diagrams.)


---

Comment by git created at 2014-10-28 19:07:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2014-10-28 19:14:28

I thought this would be fun :/ Not really tested so far (I have added doctests checking that finite Coxeter groups are recognized as finite, but it is much harder to test that infinite Coxeter groups are not). But you can throw away the red #16634 dependency at least.

Can you check that my retraction of your base_ring.one() -> base_ring(2) edit was correct? Also, I was a bit worried about the slash in `val(coxeter_matrix[i, j]) / base_ring(-2)` getting reinterpreted as division-with-rest when `base_ring` is ZZ, but apparently this does not cause issues.


---

Comment by git created at 2014-10-29 19:30:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2014-10-29 19:32:09

A few thoughts:

- If the finiteness testing algorithm is slow, we might want to add an option to provide the necessary info right away.

- The algorithm does a lot more than finiteness checking: it breaks the group into irreducibles, and (with some modification) should be able to build an explicit isomorphism of a finite Coxeter group to a direct product of classical Cartan-type groups. Methinks we should make use of this. Should this isomorphism be cached?


---

Comment by git created at 2014-10-29 19:48:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nthiery created at 2014-10-30 07:58:55

Replying to [comment:10 darij]:
> A few thoughts:
> 
> - If the finiteness testing algorithm is slow, we might want to add an option to provide the necessary info right away.
> 
> - The algorithm does a lot more than finiteness checking: it breaks the group into irreducibles, and (with some modification) should be able to build an explicit isomorphism of a finite Coxeter group to a direct product of classical Cartan-type groups. Methinks we should make use of this. Should this isomorphism be cached?

A couple further thoughts:

Looking at â€‹dd22351, this indeed looks like an automatic type
recognition starting from a Coxeter diagram or Dynkin diagram, as is
implemented in GAP 3. That's been in the TODO list for a while [1], so
it would be rather cool. If we go this way, this should really be a
method of CartanType and friends, and we should reuse the same
algorithm for this method as in GAP3, except that we have fast graph
isomorphism tests, so we can simplify it a bit. For the name, maybe
this could be `isomorphic_named_cartan_type`. Although we probably
want to return a relabelled Cartan type that exactly matches the
original Cartan type.

This could then, in the long run, be used for any Coxeter group, be it
defined by a Coxeter matrix or concretely by simple reflections and a
product rule: first build the Coxeter diagram by computing the length
of the braid relation between the simple reflections, and then get the
canonical type. Single caveat: if, for a given Coxeter group, all we
have available is the possibility to compute products of such simple
reflections, then we can get stuck computing that order if there is an
infinite braid relation.

For the record real positivity test is implemented, with guaranteed
result, in UCF:

```
sage: x = UniversalCyclotomicField().an_element()
sage: x.is_real_positive()
```

Maybe this is a simpler way to go.

If the user knows right away that the groupe is finite (or infinite),
then he should just pass that information on with a
`category=CoxeterGroups().Finite()` argument.

Cheers,
                                Nicolas

[1] http://trac.sagemath.org/wiki/SageCombinatChevieStatusReport


---

Comment by tscrim created at 2014-10-30 15:56:40

The only unbounded edges for finite Coxeter diagrams are the dihedral groups, so we just special case rank 2 (which are almost always finite and we should be able to check the infinite case easily enough) and then build the graph by checking (xy)<sup>m</sup> up to m = 5 (the finite check) or some specified user input.


---

Comment by nthiery created at 2014-10-31 08:39:40

True enough; for finiteness checking purposes, only rank 2 is an issue. In the case at hand,
that's easy to handle. Gor Coxeter groups implepented differently, we might not be able to decide, but that's a narrow enough case that we can leave the responsability to the group implementer.

Cheers,


---

Comment by tscrim created at 2014-11-17 06:09:54

Notes for Darij from our discussion:

- Make the finiteness check a separate static function.
- Make the testing for #16630 more systematic using something like

```
sage: all(CoxeterGroup(ct) in CoxeterGroups().Finite() for ct in some_list_of_types)
True
```



---

Comment by git created at 2015-02-14 10:55:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-02-14 13:58:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-02-14 20:55:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-02-14 21:00:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-02-14 21:05:25

Hmm, I am having some git problems.. Let me try with this branch

public/ticket/16630


---

Comment by git created at 2015-02-14 21:29:38

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2015-02-15 17:58:28

Ok, I think this is good to go. Can somebody review my commits ?


---

Comment by tscrim created at 2015-02-17 23:39:00

LGTM modulo one minor change: when constructing `self._bilinear`, could we divide by `base_field(-2)` instead of `base_ring(-2)` (since this coercion will happen anyways)? Once this change is made, then you can set a positive review on my behalf.


---

Comment by darij created at 2015-02-18 03:05:09

A git question: When this branch gets merged, will the branch in #16634 become invisible (i.e., appear to do nothing)? This is one of those corner cases where I'm worried about git doing the wrong thing, because I reverted the changes from #16634 in a followup commit here.


---

Comment by darij created at 2015-02-18 03:06:35

Also, I suggest we do allow the user to pass a boolean `is_finite` parameter to sidestep finiteness recognition. I reckon that lots of Coxeter groups constructed will be `A_n` and `B_n` for high `n`.


---

Comment by tscrim created at 2015-02-18 03:17:18

It should be okay. If it doesn't work, the commits from #16634 are still in the history which we can pull out.

For the flag thing, because of pickling and how `UniqueRepresentation` works, we are better off doing a partial version of #16126 by making a class for `CoxeterMatrix`, which is now #17798 and should be easy enough to do (and will be high on my todo list).


---

Comment by darij created at 2015-02-18 05:02:24

Oh wait, I see that I actually already rebased #16634. Forget about it then.

Will #17798 mean that Coxeter groups given via their types will be tested for finiteness directly rather than using my matrix-analysis code? That would indeed be a solution.


---

Comment by git created at 2015-02-18 08:26:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-02-18 08:27:06

So is this ok now ?


---

Comment by tscrim created at 2015-02-18 15:03:18

`@`darij Yes, that's correct, or at least what I'm planning to do on #17798. (I added your name to the authors list since you wrote the first version of the recognition algorithm.)

`@`Frederic Yes. Thank you.


---

Comment by tscrim created at 2015-02-18 15:03:18

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-02-18 21:42:54

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2015-02-18 21:42:54


```
sage -t --long --warn-long 39.8 src/sage/groups/matrix_gps/coxeter_group.py  # 2 doctests failed
```



---

Comment by chapoton created at 2015-02-19 08:40:19

Damn.. Now that they are recognized to be finite, an iterator seems to be required.. or at least a cardinality method maybe..

```
sage: W = CoxeterGroup([[1,3,2],[3,1,4],[2,4,1]], base_ring=QQbar)
sage: W.is_finite()
True
sage: W.cardinality()
BOOM
```



---

Comment by git created at 2015-02-19 09:11:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-02-19 09:12:45

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2015-02-19 09:12:45

Ok, adding a cardinality method seems to work.

I have also added the word "Finite" to the repr when the Coxeter group is finite.


---

Comment by tscrim created at 2015-02-19 17:32:19

I renamed this method `order`, which is the real cause of the issue why `cardinality` from `FiniteEnumeratedSets` isn't working properly (and `order` raises a `NotImplementedError` where it shouldn't either). I also refined the category to `Infinite` if the group is not finite.

Note that I cherry-picked your commits into this branch (since I don't want to upgrade my copy of Sage today).
----
New commits:


---

Comment by chapoton created at 2015-02-19 20:31:10

Looks good to me. If you agree, you can set a positive review.


---

Comment by tscrim created at 2015-02-19 21:04:57

I'm good with things; Darij?


---

Comment by darij created at 2015-02-19 21:08:04

From a quick glance at it, yes. But I haven't been keeping track of this ticket too closely, so I hope someone has reviewed Francois's edits too?


---

Comment by tscrim created at 2015-02-19 21:21:11

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2015-02-19 21:21:11

I have been looking at Frederic's changes, so (back to) positive review.


---

Comment by vbraun created at 2015-02-21 12:40:41

Resolution: fixed
