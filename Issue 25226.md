# Issue 25226: partial pyflakes cleanup of elliptic curves

Issue created by migration from https://trac.sagemath.org/ticket/25463

Original creator: chapoton

Original creation time: 2018-05-30 07:40:32

CC:  wuthrich

but more work remains to be done.


---

Comment by chapoton created at 2018-05-30 07:41:03

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-05-30 07:41:03

New commits:


---

Comment by cremona created at 2018-05-30 08:49:47

I will look at this, and with luck will finish it off.  Thanks for doing the bulk so far.


---

Comment by git created at 2018-05-30 09:31:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2018-05-30 09:35:35

OK so I positively review all the changes made in the first commit, and offer more, which almost finishes off sage.schemes.elliptic_curves. 

Remaining issues:

   1. padic_lseries has 4 lines 1627-30 which look redundant but I want to ask someone else.
   2. all.py: this must be a general thing to decide if we want pyflakes not to comlain about almost all all.py files!  One way round it is to simply add a line "assert x" for everything imported, but is that necessary?
   3. There's a test in ell_number_field which is tagged long time with an estimate (by me probably) of 80s but it now takes 180s which is ridiculous.  I don't have time now to track down the regression, but there must be one somewhere.  I will open a ticket for that after checking that there is not yet one (I think there is a ticket about slow doctests for that file).


---

Comment by chapoton created at 2018-05-30 11:33:55

I think we should already do the changes here, and maybe care for the few remaining ones later in another ticket. There is no need to do anything for all.py.

I agree with your changes, and propose to set to positive once a patchbot is green.


---

Comment by chapoton created at 2018-05-30 11:35:47

There are failing doctests in 

sage -t src/sage/schemes/elliptic_curves/BSD.py

These 3 failing doctests seem to be improvements over the existing ones. Should we just change them ?


---

Comment by cremona created at 2018-05-30 12:43:59

Yes, it seems that fixing the typo on current line means that the 5-part of the proof now goes through.  I would like Chris Wuthrich to give a view on both this and the one in padic_lseries before we merge this, but I will make an updated commit now. 

I guess this will be the first time in history where pyflakes has succeeded in solving one of the Millennium $1M Prize problems!


---

Comment by cremona created at 2018-05-30 12:45:50

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-05-30 13:19:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by wuthrich created at 2018-05-30 13:38:07

I guess I will have to learn what pyflakes is. By now I assume it is a thing that picks up redundant or bad lines. Tell me if I need more. (Is there a version for cython, too? The amount of cython warnings during compilation should frighten anyone.)

> padic_lseries has 4 lines 1627-30 which look redundant but I want to ask someone else. 

```
        if p < 5:
            phi = self.frobenius(min(6,prec),algorithm="approx")
        else:
            phi = self.frobenius(prec+2,algorithm="mw")
```

Yes, they are, please delete.
phi enters the picture only at line 1737.

Yes, the crit(e)_lw is mine. Sorry about this and thanks for correcting. I agree that the doctest can be changed as proposed.

Let me know if I need to look at anything further, I am happy to help.


---

Comment by git created at 2018-05-30 13:51:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2018-05-30 13:52:49

Thanks -- all the last commit does is delete the lines which had been commented out.

Yes, pyflakes does a syntax check & warns of unused imports, of variables assigned to but never then used (which can be a bug, as with one of these), or re-use of a variable name.  I don't know about cython.


---

Comment by cremona created at 2018-05-30 13:52:49

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-05-30 14:15:25

I have just launched my patchbot. We can give a positive review once it's green.


---

Comment by chapoton created at 2018-05-30 16:42:39

green bot. Thanks !


---

Comment by chapoton created at 2018-05-30 16:42:39

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-05-31 17:25:38

Resolution: fixed
