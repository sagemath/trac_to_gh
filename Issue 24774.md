# Issue 24774: Better fix to "GCC is installed multiple times"

archive/issues_024774.json:
```json
{
    "body": "CC:  @kiwifb @vbraun\n\n#24907 added some code to `configure.ac` that may remove files from `$SAGE_LOCAL` when running `./configure`.  This is at best a bit sketchy.  Instead it should modify something in the Makefile--e.g. enable some rule to clean up GCC.  I haven't fully considered the details yet.  Ideally a fix to this would also not conflict too much with #24919.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25011\n\n",
    "created_at": "2018-03-19T11:23:13Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Better fix to \"GCC is installed multiple times\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24774",
    "user": "https://github.com/embray"
}
```
CC:  @kiwifb @vbraun

#24907 added some code to `configure.ac` that may remove files from `$SAGE_LOCAL` when running `./configure`.  This is at best a bit sketchy.  Instead it should modify something in the Makefile--e.g. enable some rule to clean up GCC.  I haven't fully considered the details yet.  Ideally a fix to this would also not conflict too much with #24919.

Issue created by migration from https://trac.sagemath.org/ticket/25011





---

archive/issue_comments_347413.json:
```json
{
    "body": "I fully agree that #24907 is ugly by the way :-)",
    "created_at": "2018-03-19T11:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347413",
    "user": "https://github.com/jdemeyer"
}
```

I fully agree that #24907 is ugly by the way :-)



---

archive/issue_comments_347414.json:
```json
{
    "body": "Yep--I don't mind either--I understand it was needed as a quick fix.  I just wish I'd had like 1 hour to give it a look and try something else, but it's fine to fix it later.",
    "created_at": "2018-03-19T11:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347414",
    "user": "https://github.com/embray"
}
```

Yep--I don't mind either--I understand it was needed as a quick fix.  I just wish I'd had like 1 hour to give it a look and try something else, but it's fine to fix it later.



---

archive/issue_events_062734.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-18T10:20:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24774#event-62734"
}
```



---

archive/issue_comments_347415.json:
```json
{
    "body": "Set assignee to @embray.",
    "created_at": "2018-04-18T10:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347415",
    "user": "https://github.com/embray"
}
```

Set assignee to @embray.



---

archive/issue_comments_347416.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-18T12:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347416",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_347417.json:
```json
{
    "body": "Here's one possible approach to this.  I admit it's still kind of ugly.  But it fulfills the following (arguable) requirements that I set for the solution:\n\n1. A broken \"sage-gcc\" (will use this to refer explicitly to a GCC provided by Sage's gcc SPKG) is detected by configure, which should indicate this state somehow.\n2. If there is a broken sage-gcc it should be cleaned up by make before building any new spkgs.\n3. Once the broken sage-gcc is cleaned up, obviously no further attempt should be made by make to remove sage-gcc (once we rebuild the gcc SPKG we'll want to at least assume that it is no longer broken).\n4. Subsequent calls to `configure` or just `config.status` should still double-check that we have a working sage-gcc, and if not re-indicate that to make.\n\nThis is accomplished by having `configure` spit out a little stamp file to `build/make/.clean-broken-gcc` if a broken sage-gcc is detected.  A special target is added to the Makefile `_clean-broken-gcc` which checks for that stamp file and, if it exists, cleans up the broken sage-gcc and removes the stamp file (the cleanup having been completed).  This target is then added as a prerequisite to building all SPKGs.\n\n---\nNew commits:",
    "created_at": "2018-04-18T12:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347417",
    "user": "https://github.com/embray"
}
```

Here's one possible approach to this.  I admit it's still kind of ugly.  But it fulfills the following (arguable) requirements that I set for the solution:

1. A broken "sage-gcc" (will use this to refer explicitly to a GCC provided by Sage's gcc SPKG) is detected by configure, which should indicate this state somehow.
2. If there is a broken sage-gcc it should be cleaned up by make before building any new spkgs.
3. Once the broken sage-gcc is cleaned up, obviously no further attempt should be made by make to remove sage-gcc (once we rebuild the gcc SPKG we'll want to at least assume that it is no longer broken).
4. Subsequent calls to `configure` or just `config.status` should still double-check that we have a working sage-gcc, and if not re-indicate that to make.

This is accomplished by having `configure` spit out a little stamp file to `build/make/.clean-broken-gcc` if a broken sage-gcc is detected.  A special target is added to the Makefile `_clean-broken-gcc` which checks for that stamp file and, if it exists, cleans up the broken sage-gcc and removes the stamp file (the cleanup having been completed).  This target is then added as a prerequisite to building all SPKGs.

---
New commits:



---

archive/issue_comments_347418.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-07-13T15:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347418",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_347419.json:
```json
{
    "body": "Although not explicitly needed, I've rebased this on 8.3.rc0, so that I can also rebase #24919",
    "created_at": "2018-07-13T15:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347419",
    "user": "https://github.com/embray"
}
```

Although not explicitly needed, I've rebased this on 8.3.rc0, so that I can also rebase #24919



---

archive/issue_comments_347420.json:
```json
{
    "body": "I find this somewhat confusing and I wonder whether we really need all this special logic for this case (I don't know about the history of this, so I might have the wrong perspective\u2026)\n\nHere are a few questions:\n* Do I understand correctly that we only test GCC if we provided it? Why don't we always test?\n* Do we need the \"uninstall\" logic? Can't we just tell people that their GCC is broken and they should reinstall Sage, i.e., how frequent is this issue?",
    "created_at": "2018-07-17T14:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347420",
    "user": "https://github.com/saraedum"
}
```

I find this somewhat confusing and I wonder whether we really need all this special logic for this case (I don't know about the history of this, so I might have the wrong perspectiveâ€¦)

Here are a few questions:
* Do I understand correctly that we only test GCC if we provided it? Why don't we always test?
* Do we need the "uninstall" logic? Can't we just tell people that their GCC is broken and they should reinstall Sage, i.e., how frequent is this issue?



---

archive/issue_comments_347421.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2018-07-17T14:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347421",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_347422.json:
```json
{
    "body": "Replying to [comment:7 saraedum]:\n> I find this somewhat confusing and I wonder whether we really need all this special logic for this case (I don't know about the history of this, so I might have the wrong perspective\u2026)\n\n\nI don't exactly remember all the history myself. But whatever the case, the central issue is that if you install Sage's GCC package (I call it \"sage-gcc\"), and then somehow or other that gcc is broken (don't ask me how, but apparently it has happened due to past bugs), then you basically can't build any package for Sage anymore because it will try by default to use sage-gcc (since Sage-the-distribution mixes its build environment with its runtime target), and there's no way to force it *not* to.  So sage-gcc is installed but broken it's necessary as soon as possible to remove it.\n\nThe immediate background to this ticket, then, is that in #24907 Jeroen added a workaround which \"fixes\" it by `rm -rf`ing files from sage-gcc if it exists, and is broken.  The problem is that this is done by the `./configure` script itself, which really ought not to be writing things to `$SAGE_LOCAL` at all.\n\nThis fix then just uses `./configure` to test whether sage-gcc exists and is broken, and adds a special make target to clean it up immediately before trying to build anything else.  Therefore the existing Sage environment can still keep working, and sage-gcc can even be reinstalled if desired.\n\n> Here are a few questions:\n> * Do I understand correctly that we only test GCC if we provided it? Why don't we always test?\n\n\nNo, if you look later in the `configure.ac` there are several compiler-related checks, mostly using standard autoconf macros; however if you have a broken sage-gcc those will fail and the end result is Sage deciding that you need to install sage-gcc even though it's already installed (but broken).  This leads to basically an infinite loop of Sage trying to reinstall sage-gcc.\n\nTherefore it's necessary to have an explicit test for this case early on and make note of it.\n\n> * Do we need the \"uninstall\" logic? Can't we just tell people that their GCC is broken and they should reinstall Sage, i.e., how frequent is this issue?\n\n\nA few things about this:\n\n1. I resent that we ship our own GCC at all.  I would just as soon not, but enough people think that's important enough that we need to bend over backwards to support it and I don't care to fight that (just make it work a little better I hope, but that's a separate issue).\n\n2. Personally I would be fine with just saying \"do a make dist-clean and try again\".  But that does kind of suck because for some people building from scratch does take a very long time, and having a broken sage-gcc doesn't necessarily invalidate all the rest of the build.\n\n3. The uninstall process itself (all the `rm -rf`'s will be improved soon as we have DESTDIR support for sage-gcc.  Then we can replace that with just `sage-spkg-uninstall gcc` and it will be much cleaner overall.\n\n4. I'd also prefer if `./configure` just reported \"you have sage-gcc but it's broken; please uninstall it\".  But for automated builds and stuff like that it is kind of useful to have an automated cleanup.",
    "created_at": "2018-07-17T15:18:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347422",
    "user": "https://github.com/embray"
}
```

Replying to [comment:7 saraedum]:
> I find this somewhat confusing and I wonder whether we really need all this special logic for this case (I don't know about the history of this, so I might have the wrong perspectiveâ€¦)


I don't exactly remember all the history myself. But whatever the case, the central issue is that if you install Sage's GCC package (I call it "sage-gcc"), and then somehow or other that gcc is broken (don't ask me how, but apparently it has happened due to past bugs), then you basically can't build any package for Sage anymore because it will try by default to use sage-gcc (since Sage-the-distribution mixes its build environment with its runtime target), and there's no way to force it *not* to.  So sage-gcc is installed but broken it's necessary as soon as possible to remove it.

The immediate background to this ticket, then, is that in #24907 Jeroen added a workaround which "fixes" it by `rm -rf`ing files from sage-gcc if it exists, and is broken.  The problem is that this is done by the `./configure` script itself, which really ought not to be writing things to `$SAGE_LOCAL` at all.

This fix then just uses `./configure` to test whether sage-gcc exists and is broken, and adds a special make target to clean it up immediately before trying to build anything else.  Therefore the existing Sage environment can still keep working, and sage-gcc can even be reinstalled if desired.

> Here are a few questions:
> * Do I understand correctly that we only test GCC if we provided it? Why don't we always test?


No, if you look later in the `configure.ac` there are several compiler-related checks, mostly using standard autoconf macros; however if you have a broken sage-gcc those will fail and the end result is Sage deciding that you need to install sage-gcc even though it's already installed (but broken).  This leads to basically an infinite loop of Sage trying to reinstall sage-gcc.

Therefore it's necessary to have an explicit test for this case early on and make note of it.

> * Do we need the "uninstall" logic? Can't we just tell people that their GCC is broken and they should reinstall Sage, i.e., how frequent is this issue?


A few things about this:

1. I resent that we ship our own GCC at all.  I would just as soon not, but enough people think that's important enough that we need to bend over backwards to support it and I don't care to fight that (just make it work a little better I hope, but that's a separate issue).

2. Personally I would be fine with just saying "do a make dist-clean and try again".  But that does kind of suck because for some people building from scratch does take a very long time, and having a broken sage-gcc doesn't necessarily invalidate all the rest of the build.

3. The uninstall process itself (all the `rm -rf`'s will be improved soon as we have DESTDIR support for sage-gcc.  Then we can replace that with just `sage-spkg-uninstall gcc` and it will be much cleaner overall.

4. I'd also prefer if `./configure` just reported "you have sage-gcc but it's broken; please uninstall it".  But for automated builds and stuff like that it is kind of useful to have an automated cleanup.



---

archive/issue_comments_347423.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2018-07-17T15:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347423",
    "user": "https://github.com/embray"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_347424.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-07-18T10:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347424",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_347425.json:
```json
{
    "body": "(the above was just rebasing on 8.3.rc1 and fixing some typos in a commit message)",
    "created_at": "2018-07-18T10:05:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347425",
    "user": "https://github.com/embray"
}
```

(the above was just rebasing on 8.3.rc1 and fixing some typos in a commit message)



---

archive/issue_comments_347426.json:
```json
{
    "body": "Ack, I see why I'm getting mixed up.  I keep confusing this ticket with #25188; I seem to be having a serious dyslexic moment right now.",
    "created_at": "2018-07-18T10:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347426",
    "user": "https://github.com/embray"
}
```

Ack, I see why I'm getting mixed up.  I keep confusing this ticket with #25188; I seem to be having a serious dyslexic moment right now.



---

archive/issue_comments_347427.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-07-18T10:14:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347427",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_347428.json:
```json
{
    "body": "I believe this issue can reasonably be addressed for Sage 8.4.",
    "created_at": "2018-07-18T11:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347428",
    "user": "https://github.com/embray"
}
```

I believe this issue can reasonably be addressed for Sage 8.4.



---

archive/issue_events_062735.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:47:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24774#event-62735"
}
```



---

archive/issue_events_062736.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:47:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24774#event-62736"
}
```



---

archive/issue_comments_347429.json:
```json
{
    "body": "Something about this still isn't right.  Adding the `_clean-broken-gcc` phony target to gcc's dependencies forces `make gcc` to run even when it shouldn't.  I don't think that's how I intended `_clean-broken-gcc` to be used when I first started working on this issue, so I must have been out of my mind when I did that.",
    "created_at": "2018-07-18T13:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347429",
    "user": "https://github.com/embray"
}
```

Something about this still isn't right.  Adding the `_clean-broken-gcc` phony target to gcc's dependencies forces `make gcc` to run even when it shouldn't.  I don't think that's how I intended `_clean-broken-gcc` to be used when I first started working on this issue, so I must have been out of my mind when I did that.



---

archive/issue_comments_347430.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-18T13:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347430",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_347431.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-19T07:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347431",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347432.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-19T07:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347432",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_347433.json:
```json
{
    "body": "I think this does the \"right\" thing now, so far as any of this is reasonable...",
    "created_at": "2018-07-19T07:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347433",
    "user": "https://github.com/embray"
}
```

I think this does the "right" thing now, so far as any of this is reasonable...



---

archive/issue_comments_347434.json:
```json
{
    "body": "One thing to understand about the gcc spkg which I keep forgetting, but is important to how this works, is that at the end of its `spkg-install` script it runs `touch $SAGE_ROOT/configure`.  This means before any other package is built, it is forced to re-run `./configure`.\n\nWhen sage-gcc is installed it adds `$(SAGE_LOCAL)/bin/gcc` as a prerequisite to every spkg when `build/make/Makefile` is generated.  Since sage-gcc was forced to be reinstalled, this means `bin/gcc` will be newer than any other packages' stamp files, so they are forced to be rebuilt as well (this behavior was implemented partly in #24703).",
    "created_at": "2018-07-19T07:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347434",
    "user": "https://github.com/embray"
}
```

One thing to understand about the gcc spkg which I keep forgetting, but is important to how this works, is that at the end of its `spkg-install` script it runs `touch $SAGE_ROOT/configure`.  This means before any other package is built, it is forced to re-run `./configure`.

When sage-gcc is installed it adds `$(SAGE_LOCAL)/bin/gcc` as a prerequisite to every spkg when `build/make/Makefile` is generated.  Since sage-gcc was forced to be reinstalled, this means `bin/gcc` will be newer than any other packages' stamp files, so they are forced to be rebuilt as well (this behavior was implemented partly in #24703).



---

archive/issue_comments_347435.json:
```json
{
    "body": "The fact that we ship gcc is largely due to the need to provide gfortran (or some other modern fortran) on OSX.\n\nPerhaps we should separate Sage from Sage's build toolchain, this would be a step towards despahgettifying this a bit.",
    "created_at": "2018-08-16T08:58:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347435",
    "user": "https://github.com/dimpase"
}
```

The fact that we ship gcc is largely due to the need to provide gfortran (or some other modern fortran) on OSX.

Perhaps we should separate Sage from Sage's build toolchain, this would be a step towards despahgettifying this a bit.



---

archive/issue_comments_347436.json:
```json
{
    "body": "looks good to me.",
    "created_at": "2018-08-16T09:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347436",
    "user": "https://github.com/dimpase"
}
```

looks good to me.



---

archive/issue_comments_347437.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-16T09:34:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347437",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_347438.json:
```json
{
    "body": "Replying to [comment:20 dimpase]:\n> The fact that we ship gcc is largely due to the need to provide gfortran (or some other modern fortran) on OSX.\n> \n> Perhaps we should separate Sage from Sage's build toolchain, this would be a step towards despahgettifying this a bit.\n\n\nI am 100% in favor of that and have a plan in mind for doing so.  But it's yet another herculean task that I'm not prepared to take on until I've made more progress on a few others (though it would certainly make some things I'm trying to do easier--maybe I shouldn't gone with my first instinct of pushing more for that in the first place).",
    "created_at": "2018-08-16T11:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347438",
    "user": "https://github.com/embray"
}
```

Replying to [comment:20 dimpase]:
> The fact that we ship gcc is largely due to the need to provide gfortran (or some other modern fortran) on OSX.
> 
> Perhaps we should separate Sage from Sage's build toolchain, this would be a step towards despahgettifying this a bit.


I am 100% in favor of that and have a plan in mind for doing so.  But it's yet another herculean task that I'm not prepared to take on until I've made more progress on a few others (though it would certainly make some things I'm trying to do easier--maybe I shouldn't gone with my first instinct of pushing more for that in the first place).



---

archive/issue_comments_347439.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-08-18T17:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347439",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_347440.json:
```json
{
    "body": "If autotools are not installed:\n\n```\nmake[1]: warning: -jN forced in submake: disabling jobserver mode.\nmake[1]: Entering directory '/home/buildbot/slave/sage_git/build/build/make'\nmake[1]: *** No rule to make target '@SAGE_GCC_DEP@', needed by '/home/buildbot/slave/sage_git/build/local/var/lib/sage/installed/patch-2.7.5'.\nmake[1]: Target 'base-toolchain' not remade because of errors.\nmake[1]: Leaving directory '/home/buildbot/slave/sage_git/build/build/make'\n```",
    "created_at": "2018-08-18T17:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347440",
    "user": "https://github.com/vbraun"
}
```

If autotools are not installed:

```
make[1]: warning: -jN forced in submake: disabling jobserver mode.
make[1]: Entering directory '/home/buildbot/slave/sage_git/build/build/make'
make[1]: *** No rule to make target '@SAGE_GCC_DEP@', needed by '/home/buildbot/slave/sage_git/build/local/var/lib/sage/installed/patch-2.7.5'.
make[1]: Target 'base-toolchain' not remade because of errors.
make[1]: Leaving directory '/home/buildbot/slave/sage_git/build/build/make'
```



---

archive/issue_comments_347441.json:
```json
{
    "body": "Replying to [comment:24 vbraun]:\n> If autotools are not installed:\n> \n> ```\n> make[1]: warning: -jN forced in submake: disabling jobserver mode.\n> make[1]: Entering directory '/home/buildbot/slave/sage_git/build/build/make'\n> make[1]: *** No rule to make target '@SAGE_GCC_DEP@', needed by '/home/buildbot/slave/sage_git/build/local/var/lib/sage/installed/patch-2.7.5'.\n> make[1]: Target 'base-toolchain' not remade because of errors.\n> make[1]: Leaving directory '/home/buildbot/slave/sage_git/build/build/make'\n> ```\n\n\nThis must be a buildbot setup bug, at least I cannot reproduce it. Probably the bot has a stale\n./configure (as ./configure is no longer under git, the bot needs to get it somehow, autotools or not).",
    "created_at": "2018-08-19T06:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347441",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:24 vbraun]:
> If autotools are not installed:
> 
> ```
> make[1]: warning: -jN forced in submake: disabling jobserver mode.
> make[1]: Entering directory '/home/buildbot/slave/sage_git/build/build/make'
> make[1]: *** No rule to make target '@SAGE_GCC_DEP@', needed by '/home/buildbot/slave/sage_git/build/local/var/lib/sage/installed/patch-2.7.5'.
> make[1]: Target 'base-toolchain' not remade because of errors.
> make[1]: Leaving directory '/home/buildbot/slave/sage_git/build/build/make'
> ```


This must be a buildbot setup bug, at least I cannot reproduce it. Probably the bot has a stale
./configure (as ./configure is no longer under git, the bot needs to get it somehow, autotools or not).



---

archive/issue_comments_347442.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-08-19T06:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347442",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_347443.json:
```json
{
    "body": "Or it might be I don't understand the workflow for tickets involving modifications to ./configure.",
    "created_at": "2018-08-19T06:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347443",
    "user": "https://github.com/dimpase"
}
```

Or it might be I don't understand the workflow for tickets involving modifications to ./configure.



---

archive/issue_comments_347444.json:
```json
{
    "body": "I agree with Dima.  Obviously you can't apply this change requires rebuilding the `configure` script.  How do you normally handle tickets that modify `configure`?  In this case both `configure.ac` and one of the `m4/` macros were updated.",
    "created_at": "2018-08-20T10:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347444",
    "user": "https://github.com/embray"
}
```

I agree with Dima.  Obviously you can't apply this change requires rebuilding the `configure` script.  How do you normally handle tickets that modify `configure`?  In this case both `configure.ac` and one of the `m4/` macros were updated.



---

archive/issue_comments_347445.json:
```json
{
    "body": "It would be good to have answers on this because I have made changes in the past that modified configure, and have many more coming down the pipeline....",
    "created_at": "2018-08-20T10:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347445",
    "user": "https://github.com/embray"
}
```

It would be good to have answers on this because I have made changes in the past that modified configure, and have many more coming down the pipeline....



---

archive/issue_comments_347446.json:
```json
{
    "body": "OK, it's came back from my brain swap: e.g. on #12426 one was creating \n`configure-XYZ.tar.gz` to be placed in SAGE_ROOT/upstream, containing\n\n```\nconfigure\nconfig/compile\nconfig/config.guess\nconfig/config.sub\nconfig/install-sh\nconfig/missing\nbuild/make/Makefile-auto.in\n```\nwith XYZ doing a version bump. I don't know how it was done - perhaps just `tar`?\nfbissey should know. IMHO it's a hassle, and ought to be handled by build/patch-bots.",
    "created_at": "2018-08-20T12:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347446",
    "user": "https://github.com/dimpase"
}
```

OK, it's came back from my brain swap: e.g. on #12426 one was creating 
`configure-XYZ.tar.gz` to be placed in SAGE_ROOT/upstream, containing

```
configure
config/compile
config/config.guess
config/config.sub
config/install-sh
config/missing
build/make/Makefile-auto.in
```
with XYZ doing a version bump. I don't know how it was done - perhaps just `tar`?
fbissey should know. IMHO it's a hassle, and ought to be handled by build/patch-bots.



---

archive/issue_comments_347447.json:
```json
{
    "body": "Replying to [comment:29 dimpase]:\n> IMHO it's a hassle, and ought to be handled by build/patch-bots.\n\n\nI think normally it is.  Because the first time I updated `configure.ac` I also provided a configure tarball (there is actually a script that makes it--you can build it by running `./bootstrap -s`).\n\nBut somebody (I think either Volker or Jeroen) told me it wasn't necessary, and I haven't needed to bother since, even with tickets that changed much more than this one.  So I'm at a loss.",
    "created_at": "2018-08-20T13:46:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347447",
    "user": "https://github.com/embray"
}
```

Replying to [comment:29 dimpase]:
> IMHO it's a hassle, and ought to be handled by build/patch-bots.


I think normally it is.  Because the first time I updated `configure.ac` I also provided a configure tarball (there is actually a script that makes it--you can build it by running `./bootstrap -s`).

But somebody (I think either Volker or Jeroen) told me it wasn't necessary, and I haven't needed to bother since, even with tickets that changed much more than this one.  So I'm at a loss.



---

archive/issue_comments_347448.json:
```json
{
    "body": "Replying to [comment:29 dimpase]:\n> OK, it's came back from my brain swap: e.g. on #12426 one was creating \n> `configure-XYZ.tar.gz` to be placed in SAGE_ROOT/upstream, containing\n> \n> ```\n> configure\n> config/compile\n> config/config.guess\n> config/config.sub\n> config/install-sh\n> config/missing\n> build/make/Makefile-auto.in\n> ```\n> with XYZ doing a version bump. I don't know how it was done - perhaps just `tar`?\n> fbissey should know. IMHO it's a hassle, and ought to be handled by build/patch-bots.\n\n\nFor info, it is produced by a switch of the `bootstrap` script (`-s`) that you use to regenerate configure.",
    "created_at": "2018-08-20T19:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347448",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:29 dimpase]:
> OK, it's came back from my brain swap: e.g. on #12426 one was creating 
> `configure-XYZ.tar.gz` to be placed in SAGE_ROOT/upstream, containing
> 
> ```
> configure
> config/compile
> config/config.guess
> config/config.sub
> config/install-sh
> config/missing
> build/make/Makefile-auto.in
> ```
> with XYZ doing a version bump. I don't know how it was done - perhaps just `tar`?
> fbissey should know. IMHO it's a hassle, and ought to be handled by build/patch-bots.


For info, it is produced by a switch of the `bootstrap` script (`-s`) that you use to regenerate configure.



---

archive/issue_comments_347449.json:
```json
{
    "body": "I wrote that just above :)\n\nI'll go ahead and do that, but in the past I haven't had to...",
    "created_at": "2018-08-21T11:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347449",
    "user": "https://github.com/embray"
}
```

I wrote that just above :)

I'll go ahead and do that, but in the past I haven't had to...



---

archive/issue_comments_347450.json:
```json
{
    "body": "So, what are we supposed to do about this?",
    "created_at": "2018-08-22T10:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347450",
    "user": "https://github.com/embray"
}
```

So, what are we supposed to do about this?



---

archive/issue_comments_347451.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-08-22T22:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347451",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_347452.json:
```json
{
    "body": "create new confball and add link to ticket",
    "created_at": "2018-08-22T22:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347452",
    "user": "https://github.com/vbraun"
}
```

create new confball and add link to ticket



---

archive/issue_comments_347453.json:
```json
{
    "body": "Weird that I never had to do that before.  Does that mean some of my configure.ac changes weren't being tested?",
    "created_at": "2018-08-23T11:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347453",
    "user": "https://github.com/embray"
}
```

Weird that I never had to do that before.  Does that mean some of my configure.ac changes weren't being tested?



---

archive/issue_comments_347454.json:
```json
{
    "body": "I don't see why the buildbot master cannot run ./bootstrap before going further:\n\nhttp://docs.buildbot.net/0.8.3/Running-Commands-on-the-Master.html",
    "created_at": "2018-08-23T12:40:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347454",
    "user": "https://github.com/dimpase"
}
```

I don't see why the buildbot master cannot run ./bootstrap before going further:

http://docs.buildbot.net/0.8.3/Running-Commands-on-the-Master.html



---

archive/issue_comments_347455.json:
```json
{
    "body": "Replying to [comment:36 dimpase]:\n> I don't see why the buildbot master cannot run ./bootstrap before going further:\n> \n> http://docs.buildbot.net/0.8.3/Running-Commands-on-the-Master.html\n\n\nIt does implicitly--the top-level `Makefile` re-runs `./bootstrap` if `configure` needs to be rebuilt (i.e. `configure.ac` or any of the `m4/` files changed).\n\nHowever, Volker is pointing out that this does not work for systems that don't have autoconf installed, such that running `./bootstrap` fails.\n\nPerhaps it's new that there's a buildbot build where that is the case?  I don't remember having any problem with this before.  Obviously on a system with no autoconf it's not going to work unless they can download a new `configure` tarball.",
    "created_at": "2018-08-23T12:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347455",
    "user": "https://github.com/embray"
}
```

Replying to [comment:36 dimpase]:
> I don't see why the buildbot master cannot run ./bootstrap before going further:
> 
> http://docs.buildbot.net/0.8.3/Running-Commands-on-the-Master.html


It does implicitly--the top-level `Makefile` re-runs `./bootstrap` if `configure` needs to be rebuilt (i.e. `configure.ac` or any of the `m4/` files changed).

However, Volker is pointing out that this does not work for systems that don't have autoconf installed, such that running `./bootstrap` fails.

Perhaps it's new that there's a buildbot build where that is the case?  I don't remember having any problem with this before.  Obviously on a system with no autoconf it's not going to work unless they can download a new `configure` tarball.



---

archive/issue_comments_347456.json:
```json
{
    "body": "Replying to [comment:34 vbraun]:\n> create new confball and add link to ticket\n\n\nDoes that mean I have to do that for every ticket that modifies configure?  Because I have several like that.",
    "created_at": "2018-08-23T12:59:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347456",
    "user": "https://github.com/embray"
}
```

Replying to [comment:34 vbraun]:
> create new confball and add link to ticket


Does that mean I have to do that for every ticket that modifies configure?  Because I have several like that.



---

archive/issue_comments_347457.json:
```json
{
    "body": "Replying to [comment:38 embray]:\n> Does that mean I have to do that for every ticket that modifies configure?  Because I have several like that.\n\n\nOnly if `configure.ac` is modified in an *incompatible* way. Sometimes you can get away with using an old version of `configure`.\n\nYes, it's annoying and it should be fixed by changing the release manager workflow.",
    "created_at": "2018-08-23T13:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347457",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:38 embray]:
> Does that mean I have to do that for every ticket that modifies configure?  Because I have several like that.


Only if `configure.ac` is modified in an *incompatible* way. Sometimes you can get away with using an old version of `configure`.

Yes, it's annoying and it should be fixed by changing the release manager workflow.



---

archive/issue_comments_347458.json:
```json
{
    "body": "Replying to [comment:37 embray]:\n> Replying to [comment:36 dimpase]:\n> > I don't see why the buildbot master cannot run ./bootstrap before going further:\n> > \n> > http://docs.buildbot.net/0.8.3/Running-Commands-on-the-Master.html\n\n> \n> It does implicitly--the top-level `Makefile` re-runs `./bootstrap` if `configure` needs to be rebuilt (i.e. `configure.ac` or any of the `m4/` files changed).\n> \n> However, Volker is pointing out that this does not work for systems that don't have autoconf installed, such that running `./bootstrap` fails.\n> \n> Perhaps it's new that there's a buildbot build where that is the case?  I don't remember having any problem with this before.  Obviously on a system with no autoconf it's not going to work unless they can download a new `configure` tarball.\n\n\nIMHO, buildbot is master-slave, and building happens on slaves, which get jobs from the master. I am saying that master should run ./bootstrap and send it over to slaves.",
    "created_at": "2018-08-23T13:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347458",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:37 embray]:
> Replying to [comment:36 dimpase]:
> > I don't see why the buildbot master cannot run ./bootstrap before going further:
> > 
> > http://docs.buildbot.net/0.8.3/Running-Commands-on-the-Master.html

> 
> It does implicitly--the top-level `Makefile` re-runs `./bootstrap` if `configure` needs to be rebuilt (i.e. `configure.ac` or any of the `m4/` files changed).
> 
> However, Volker is pointing out that this does not work for systems that don't have autoconf installed, such that running `./bootstrap` fails.
> 
> Perhaps it's new that there's a buildbot build where that is the case?  I don't remember having any problem with this before.  Obviously on a system with no autoconf it's not going to work unless they can download a new `configure` tarball.


IMHO, buildbot is master-slave, and building happens on slaves, which get jobs from the master. I am saying that master should run ./bootstrap and send it over to slaves.



---

archive/issue_comments_347459.json:
```json
{
    "body": "Unfortunately that's not really how buildbot works.  In any case there's no reason the workers can't have autotools installed.  My guess is just that there is deliberately one that does not, in order to catch cases where a new `configure` tarball must be built.  I don't think that makes a lot of sense--I think the `configure` script should just be built automatically every time a release is made and included in the source tarball like most projects do :shrug:",
    "created_at": "2018-08-23T15:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347459",
    "user": "https://github.com/embray"
}
```

Unfortunately that's not really how buildbot works.  In any case there's no reason the workers can't have autotools installed.  My guess is just that there is deliberately one that does not, in order to catch cases where a new `configure` tarball must be built.  I don't think that makes a lot of sense--I think the `configure` script should just be built automatically every time a release is made and included in the source tarball like most projects do :shrug:



---

archive/issue_comments_347460.json:
```json
{
    "body": "Replying to [comment:41 embray]:\n> Unfortunately that's not really how buildbot works.  In any case there's no reason the workers can't have autotools installed.  My guess is just that there is deliberately one that does not, in order to catch cases where a new `configure` tarball must be built.  I don't think that makes a lot of sense--I think the `configure` script should just be built automatically every time a release is made and included in the source tarball like most projects do :shrug:\n\n\nWell I can think of one. Many people don't have autotools installed. Having autotools installed will mask the fact that a package forgot to run it after a change. It may then fail on a end user machine where autotools is not present and the maintainer mode kicks in and trigger a re-run.",
    "created_at": "2018-08-23T21:04:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347460",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:41 embray]:
> Unfortunately that's not really how buildbot works.  In any case there's no reason the workers can't have autotools installed.  My guess is just that there is deliberately one that does not, in order to catch cases where a new `configure` tarball must be built.  I don't think that makes a lot of sense--I think the `configure` script should just be built automatically every time a release is made and included in the source tarball like most projects do :shrug:


Well I can think of one. Many people don't have autotools installed. Having autotools installed will mask the fact that a package forgot to run it after a change. It may then fail on a end user machine where autotools is not present and the maintainer mode kicks in and trigger a re-run.



---

archive/issue_comments_347461.json:
```json
{
    "body": "it is clear that Sage installation should not need autotools. What is unclear to me is why the release building process must run without autotools, and need a manually built configure tarball, something that is not only inconvenient, but error prone as well. \n\nby right, package configure must be updated, version bumped, as\n https://github.com/sagemath/sage/blob/master/build/pkgs/configure/checksums.ini\n\n\nshould not be ignored.\nPerhaps all this may be done by trac, automatically, for the lack of better place?",
    "created_at": "2018-08-24T09:41:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347461",
    "user": "https://github.com/dimpase"
}
```

it is clear that Sage installation should not need autotools. What is unclear to me is why the release building process must run without autotools, and need a manually built configure tarball, something that is not only inconvenient, but error prone as well. 

by right, package configure must be updated, version bumped, as
 https://github.com/sagemath/sage/blob/master/build/pkgs/configure/checksums.ini


should not be ignored.
Perhaps all this may be done by trac, automatically, for the lack of better place?



---

archive/issue_comments_347462.json:
```json
{
    "body": "Replying to [comment:43 dimpase]:\n> it is clear that Sage installation should not need autotools. What is unclear to me is why the release building process must run without autotools, and need a manually built configure tarball, something that is not only inconvenient, but error prone as well. \n\n\nExactly.  There's no reason (at least not obvious) the release process shouldn't just do this automatically, including for \"beta\" releases, so I don't see why this is being held up by a buildbot that can't build properly.\n\nThe fact that I've made past changes to configure but where it \"happened\" to keep working on those buildbots is a further argument that it's not useful to have in the first place.\n\nIt's not that I mind generating and uploading a new configure tarball.  That's easy.  Of course as I have multiple tickets open that modify configure, and as I have no way to \"guess\" which ones will or will not \"happen\" to work without an updated configure tarball, that just means I now have to generate configure tarballs for all of them, which is necessarily going to lead to merge conflicts, and slower acceptance of these tickets (each one is going to have a different new configure tarball go along with it).",
    "created_at": "2018-08-24T09:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347462",
    "user": "https://github.com/embray"
}
```

Replying to [comment:43 dimpase]:
> it is clear that Sage installation should not need autotools. What is unclear to me is why the release building process must run without autotools, and need a manually built configure tarball, something that is not only inconvenient, but error prone as well. 


Exactly.  There's no reason (at least not obvious) the release process shouldn't just do this automatically, including for "beta" releases, so I don't see why this is being held up by a buildbot that can't build properly.

The fact that I've made past changes to configure but where it "happened" to keep working on those buildbots is a further argument that it's not useful to have in the first place.

It's not that I mind generating and uploading a new configure tarball.  That's easy.  Of course as I have multiple tickets open that modify configure, and as I have no way to "guess" which ones will or will not "happen" to work without an updated configure tarball, that just means I now have to generate configure tarballs for all of them, which is necessarily going to lead to merge conflicts, and slower acceptance of these tickets (each one is going to have a different new configure tarball go along with it).



---

archive/issue_comments_347463.json:
```json
{
    "body": "For the record, the release script generates a new confball for every beta/rc release but not for every merged ticket. Doing it for every ticket has issues with size (every confball is 100k on the mirrors) and, more importantly, would make it more difficult for me to unmerge tickets because the version would always conflict.\n\nAn automatted solution would at the very least need to detect when a new confball is needed. E.g. extend ./bootstrap to have a maybe-save option that only saves a new confball if there was a relevant change over the current confball. And use non-consecutive version numbers. Perhaps just use a hash of the content (excluding file timestamps) as version number. Then I could run that with every ticket.",
    "created_at": "2018-08-25T12:15:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347463",
    "user": "https://github.com/vbraun"
}
```

For the record, the release script generates a new confball for every beta/rc release but not for every merged ticket. Doing it for every ticket has issues with size (every confball is 100k on the mirrors) and, more importantly, would make it more difficult for me to unmerge tickets because the version would always conflict.

An automatted solution would at the very least need to detect when a new confball is needed. E.g. extend ./bootstrap to have a maybe-save option that only saves a new confball if there was a relevant change over the current confball. And use non-consecutive version numbers. Perhaps just use a hash of the content (excluding file timestamps) as version number. Then I could run that with every ticket.



---

archive/issue_comments_347464.json:
```json
{
    "body": "Replying to [comment:41 embray]:\n> I think the `configure` script should just be built automatically every time a release is made and included in the source tarball like most projects do\n\n\n...and Sage also does this.\n\nHowever, the buildbots don't build from a release, they build from the git repo. So this is purely a buildbot workflow issue, not a Sage release issue.",
    "created_at": "2018-08-25T14:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347464",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:41 embray]:
> I think the `configure` script should just be built automatically every time a release is made and included in the source tarball like most projects do


...and Sage also does this.

However, the buildbots don't build from a release, they build from the git repo. So this is purely a buildbot workflow issue, not a Sage release issue.



---

archive/issue_comments_347465.json:
```json
{
    "body": "What I (more precisely, my scripts) did when I was release manager: create a fake source release every time you want to test Sage on the buildbot and then build from that fake source release on the buildbots instead of from git.",
    "created_at": "2018-08-25T14:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347465",
    "user": "https://github.com/jdemeyer"
}
```

What I (more precisely, my scripts) did when I was release manager: create a fake source release every time you want to test Sage on the buildbot and then build from that fake source release on the buildbots instead of from git.



---

archive/issue_comments_347466.json:
```json
{
    "body": "I definitely want to leverage git on the buildbots though. Things are much easier to debug if you can easily switch between versions. E.g. if I find a problem that specific to a buildbot I can just log in and compare with the last known-good version, back out tickets, etc.",
    "created_at": "2018-08-25T14:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347466",
    "user": "https://github.com/vbraun"
}
```

I definitely want to leverage git on the buildbots though. Things are much easier to debug if you can easily switch between versions. E.g. if I find a problem that specific to a buildbot I can just log in and compare with the last known-good version, back out tickets, etc.



---

archive/issue_comments_347467.json:
```json
{
    "body": "Replying to [comment:46 jdemeyer]:\n> Replying to [comment:41 embray]:\n> > I think the `configure` script should just be built automatically every time a release is made and included in the source tarball like most projects do\n\n> \n> ...and Sage also does this.\n> \n> However, the buildbots don't build from a release, they build from the git repo. So this is purely a buildbot workflow issue, not a Sage release issue.\n\n\nI still don't understand.  The top-level Makefile ensures that `configure` is up-to-date by running `./bootstrap`.\n\nWhy is there even a buildbot that tries to build without autoconf?  If the configure tarball is updated when there is a release anyways, what use is this, especially if it produces false negatives?",
    "created_at": "2018-08-28T12:45:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347467",
    "user": "https://github.com/embray"
}
```

Replying to [comment:46 jdemeyer]:
> Replying to [comment:41 embray]:
> > I think the `configure` script should just be built automatically every time a release is made and included in the source tarball like most projects do

> 
> ...and Sage also does this.
> 
> However, the buildbots don't build from a release, they build from the git repo. So this is purely a buildbot workflow issue, not a Sage release issue.


I still don't understand.  The top-level Makefile ensures that `configure` is up-to-date by running `./bootstrap`.

Why is there even a buildbot that tries to build without autoconf?  If the configure tarball is updated when there is a release anyways, what use is this, especially if it produces false negatives?



---

archive/issue_comments_347468.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2018-08-28T12:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347468",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_347469.json:
```json
{
    "body": "This really ought to be resolved sensibly.  You want me to create a configure tarball and upload it, which I'm happy to do.  But there are going to be more of them, and likely with conflicting versions, etc--all the problems you described.  This shouldn't be needed to get a ticket merged.",
    "created_at": "2018-08-28T12:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347469",
    "user": "https://github.com/embray"
}
```

This really ought to be resolved sensibly.  You want me to create a configure tarball and upload it, which I'm happy to do.  But there are going to be more of them, and likely with conflicting versions, etc--all the problems you described.  This shouldn't be needed to get a ticket merged.



---

archive/issue_comments_347470.json:
```json
{
    "body": "Replying to [comment:49 embray]:\n> Why is there even a buildbot that tries to build without autoconf?\n\n\nThis is a good idea actually. It ensures that Sage can be built on systems without autotools. Otherwise, you might mistakenly add a dependency on autotools and you would only notice that once somebody tries to build Sage on a system without autotools.",
    "created_at": "2018-08-28T12:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347470",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:49 embray]:
> Why is there even a buildbot that tries to build without autoconf?


This is a good idea actually. It ensures that Sage can be built on systems without autotools. Otherwise, you might mistakenly add a dependency on autotools and you would only notice that once somebody tries to build Sage on a system without autotools.



---

archive/issue_comments_347471.json:
```json
{
    "body": "Okay, I still think it's a bit strange not to just require that as a build dependency but let's say there's a valid reason for that:  Such a buildbot should be ignored then for tickets like this one that by requirement need autoconf to make any sense to build.",
    "created_at": "2018-08-28T13:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347471",
    "user": "https://github.com/embray"
}
```

Okay, I still think it's a bit strange not to just require that as a build dependency but let's say there's a valid reason for that:  Such a buildbot should be ignored then for tickets like this one that by requirement need autoconf to make any sense to build.



---

archive/issue_comments_347472.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-28T13:11:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347472",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347473.json:
```json
{
    "body": "Replying to [comment:53 embray]:\n> Such a buildbot should be ignored then for tickets like this one\n\n\nThe buildbot doesn't test *tickets*, it tests *releases* (before they are releases).",
    "created_at": "2018-08-28T13:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347473",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:53 embray]:
> Such a buildbot should be ignored then for tickets like this one


The buildbot doesn't test *tickets*, it tests *releases* (before they are releases).



---

archive/issue_comments_347474.json:
```json
{
    "body": "Attachment [configure-273.tar.gz](tarball://root/attachments/some-uuid/ticket25011/configure-273.tar.gz) by @embray created at 2018-08-28 13:16:00\n\nYes, I understand that.  And *releases* should just include the built `configure` script in the first place IMO.",
    "created_at": "2018-08-28T13:16:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347474",
    "user": "https://github.com/embray"
}
```

Attachment [configure-273.tar.gz](tarball://root/attachments/some-uuid/ticket25011/configure-273.tar.gz) by @embray created at 2018-08-28 13:16:00

Yes, I understand that.  And *releases* should just include the built `configure` script in the first place IMO.



---

archive/issue_comments_347475.json:
```json
{
    "body": "I mean, it's not testing releases if it's building from the git repo.",
    "created_at": "2018-08-28T13:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347475",
    "user": "https://github.com/embray"
}
```

I mean, it's not testing releases if it's building from the git repo.



---

archive/issue_comments_347476.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2018-08-28T13:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347476",
    "user": "https://github.com/embray"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_347477.json:
```json
{
    "body": "I'll just keep doing this.  I don't mind doing it and resolving the conflicts that inevitably emerge.  I just wish someone had said it was necessary in the first place.  I explicitly recall being told at one point that it wasn't.",
    "created_at": "2018-08-28T13:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347477",
    "user": "https://github.com/embray"
}
```

I'll just keep doing this.  I don't mind doing it and resolving the conflicts that inevitably emerge.  I just wish someone had said it was necessary in the first place.  I explicitly recall being told at one point that it wasn't.



---

archive/issue_comments_347478.json:
```json
{
    "body": "Replying to [comment:48 vbraun]:\n> I definitely want to leverage git on the buildbots though. Things are much easier to debug if you can easily switch between versions. E.g. if I find a problem that specific to a buildbot I can just log in and compare with the last known-good version, back out tickets, etc. \n\n\nUse git--make a release from git--build from the release.  Otherwise you're not actually testing releasing or building from a *release*.",
    "created_at": "2018-08-28T13:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347478",
    "user": "https://github.com/embray"
}
```

Replying to [comment:48 vbraun]:
> I definitely want to leverage git on the buildbots though. Things are much easier to debug if you can easily switch between versions. E.g. if I find a problem that specific to a buildbot I can just log in and compare with the last known-good version, back out tickets, etc. 


Use git--make a release from git--build from the release.  Otherwise you're not actually testing releasing or building from a *release*.



---

archive/issue_comments_347479.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-08-29T22:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347479",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_347480.json:
```json
{
    "body": "merge conflict",
    "created_at": "2018-08-29T22:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347480",
    "user": "https://github.com/vbraun"
}
```

merge conflict



---

archive/issue_comments_347481.json:
```json
{
    "body": "Specifically with `build/pkgs/configure/checksums.ini` what a surprise.  Does this mean I need to rebuild the configure tarball too?",
    "created_at": "2018-09-03T10:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347481",
    "user": "https://github.com/embray"
}
```

Specifically with `build/pkgs/configure/checksums.ini` what a surprise.  Does this mean I need to rebuild the configure tarball too?



---

archive/issue_comments_347482.json:
```json
{
    "body": "It's really frustrating to do by the way, because apparently my \"config.guess\" is too old, but when I download a recent one from upstream and place it in `config/` it just gets deleted again when I run `./bootstrap`.  So I have to manually edit `./bootstrap` to not do that in order to build the tarball.  Can't the release manager just do that?",
    "created_at": "2018-09-03T10:05:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347482",
    "user": "https://github.com/embray"
}
```

It's really frustrating to do by the way, because apparently my "config.guess" is too old, but when I download a recent one from upstream and place it in `config/` it just gets deleted again when I run `./bootstrap`.  So I have to manually edit `./bootstrap` to not do that in order to build the tarball.  Can't the release manager just do that?



---

archive/issue_comments_347483.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-09-03T10:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347483",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_347484.json:
```json
{
    "body": "Attachment [configure-280.tar.gz](tarball://root/attachments/some-uuid/ticket25011/configure-280.tar.gz) by @embray created at 2018-09-03 10:14:47\n\nAdded a new one.  I think it's actually identical to the previous one, for some reason, despite the merge conflict.  But it has to have a new version number.",
    "created_at": "2018-09-03T10:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347484",
    "user": "https://github.com/embray"
}
```

Attachment [configure-280.tar.gz](tarball://root/attachments/some-uuid/ticket25011/configure-280.tar.gz) by @embray created at 2018-09-03 10:14:47

Added a new one.  I think it's actually identical to the previous one, for some reason, despite the merge conflict.  But it has to have a new version number.



---

archive/issue_comments_347485.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-09-03T10:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347485",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_347486.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-05T16:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347486",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_062737.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-05T16:43:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24774#event-62737"
}
```



---

archive/issue_comments_347487.json:
```json
{
    "body": "Thanks! On to the next one...",
    "created_at": "2018-09-06T09:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24774#issuecomment-347487",
    "user": "https://github.com/embray"
}
```

Thanks! On to the next one...
