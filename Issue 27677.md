# Issue 27677: py3: hash collisions of Laurent polynomials

archive/issues_027677.json:
```json
{
    "body": "This ticket adjusts the hash of multivariate Laurent polynomials, so that it agrees with the hash of univariate Laurent polynomials.\n\nThis solves the following problem: Using Python 3, this doctest in `laurent_polynomial.pyx` fails about 1 out of 4 times.\n\n```\n            sage: L.<w,z> = LaurentPolynomialRing(QQ)\n            sage: len({hash(w^i*z^j) for i in [-2..2] for j in [-2..2]})\n            25\n```\n\nDue to hash collisions, the result can be smaller than 25 (such as 23 or 21). This gets even worse when using a larger range of monomials.\n\nRegardless of that, it is desirable that univariate and multivariate Laurent polynomials have the same hash anyway. The univariate hash implementation does not seem to have these collisions, so adopting that implementation solves this problem.\n\nFor reference, the univariate and multivariate hashes were implemented in #21272 and #23864.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27914\n\n",
    "created_at": "2019-06-01T10:36:02Z",
    "labels": [
        "component: python3",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "py3: hash collisions of Laurent polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27677",
    "user": "https://github.com/mwageringel"
}
```
This ticket adjusts the hash of multivariate Laurent polynomials, so that it agrees with the hash of univariate Laurent polynomials.

This solves the following problem: Using Python 3, this doctest in `laurent_polynomial.pyx` fails about 1 out of 4 times.

```
            sage: L.<w,z> = LaurentPolynomialRing(QQ)
            sage: len({hash(w^i*z^j) for i in [-2..2] for j in [-2..2]})
            25
```

Due to hash collisions, the result can be smaller than 25 (such as 23 or 21). This gets even worse when using a larger range of monomials.

Regardless of that, it is desirable that univariate and multivariate Laurent polynomials have the same hash anyway. The univariate hash implementation does not seem to have these collisions, so adopting that implementation solves this problem.

For reference, the univariate and multivariate hashes were implemented in #21272 and #23864.

Issue created by migration from https://trac.sagemath.org/ticket/27914





---

archive/issue_comments_390305.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-06-01T11:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27677#issuecomment-390305",
    "user": "https://github.com/mwageringel"
}
```

New commits:



---

archive/issue_comments_390306.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-01T11:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27677#issuecomment-390306",
    "user": "https://github.com/mwageringel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_390307.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-02T16:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27677#issuecomment-390307",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_390308.json:
```json
{
    "body": "ok, let it be",
    "created_at": "2019-06-02T16:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27677#issuecomment-390308",
    "user": "https://github.com/fchapoton"
}
```

ok, let it be



---

archive/issue_events_025680.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-05T18:30:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27677",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27677#event-25680"
}
```



---

archive/issue_comments_390309.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-05T18:30:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27677#issuecomment-390309",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
