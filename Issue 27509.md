# Issue 27509: Fix LiDIA installation on macOS

archive/issues_027509.json:
```json
{
    "body": "CC:  @dimpase @jplab @sophiasage\n\nhttps://groups.google.com/d/msg/sage-devel/UtdbqZy-1VE/Jlxfj3FxDAAJ\n\nhttps://github.com/mkoeppe/LiDIA/issues/1\n\nIssue created by migration from https://trac.sagemath.org/ticket/27746\n\n",
    "created_at": "2019-04-29T09:17:18Z",
    "labels": [
        "component: please change",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Fix LiDIA installation on macOS",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27509",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @dimpase @jplab @sophiasage

https://groups.google.com/d/msg/sage-devel/UtdbqZy-1VE/Jlxfj3FxDAAJ

https://github.com/mkoeppe/LiDIA/issues/1

Issue created by migration from https://trac.sagemath.org/ticket/27746





---

archive/issue_comments_387516.json:
```json
{
    "body": "Also, https://github.com/mkoeppe/LiDIA/pull/2 - can this be merged upstream?",
    "created_at": "2019-04-29T09:34:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387516",
    "user": "https://github.com/dimpase"
}
```

Also, https://github.com/mkoeppe/LiDIA/pull/2 - can this be merged upstream?



---

archive/issue_comments_387517.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: experimental.",
    "created_at": "2019-04-29T11:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387517",
    "user": "https://github.com/jplab"
}
```

Changing component from PLEASE CHANGE to packages: experimental.



---

archive/issue_comments_387518.json:
```json
{
    "body": "What happened in this bug report is that CXX has been set to \"g++ -std=gnu++11\" (where g++ is the system's clang compiler).\nThis causes an error.",
    "created_at": "2019-04-29T14:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387518",
    "user": "https://github.com/mkoeppe"
}
```

What happened in this bug report is that CXX has been set to "g++ -std=gnu++11" (where g++ is the system's clang compiler).
This causes an error.



---

archive/issue_comments_387519.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-05-01T18:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387519",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_387520.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-01T18:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387520",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_387521.json:
```json
{
    "body": "OK, this also needs adjustement w.r.t. to #27212. (Somehow lidia went under the radar there).\n\nWhat is the correct way to configure it if GMP is installed in the standard location,\nsearched by default by compiler/linker? Does it still need these `--with-extra...`?\n\nOtherwise, `spkg-install` should contain something like\n\n```sh\nsdh_configure --with-arithmetic=gmp \\\n              --with-extra-includes=\"$SAGE_GMP_INCLUDE\" \\\n              --with-extra-libs=\"$SAGE_GMP_PREFIX/lib\" \\\n              --enable-shared=yes --enable-static=no\n```\n \n\n-------------\n\nok, so an experiment tells me that `--with-extra-` may be skipped if the GMP location is searched by compiler/linker.",
    "created_at": "2019-05-01T19:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387521",
    "user": "https://github.com/dimpase"
}
```

OK, this also needs adjustement w.r.t. to #27212. (Somehow lidia went under the radar there).

What is the correct way to configure it if GMP is installed in the standard location,
searched by default by compiler/linker? Does it still need these `--with-extra...`?

Otherwise, `spkg-install` should contain something like

```sh
sdh_configure --with-arithmetic=gmp \
              --with-extra-includes="$SAGE_GMP_INCLUDE" \
              --with-extra-libs="$SAGE_GMP_PREFIX/lib" \
              --enable-shared=yes --enable-static=no
```
 

-------------

ok, so an experiment tells me that `--with-extra-` may be skipped if the GMP location is searched by compiler/linker.



---

archive/issue_comments_387522.json:
```json
{
    "body": "otherwise, I checked that things build with gcc 8.3 on linux and with clang 6.0.1 on freebsd.",
    "created_at": "2019-05-01T19:21:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387522",
    "user": "https://github.com/dimpase"
}
```

otherwise, I checked that things build with gcc 8.3 on linux and with clang 6.0.1 on freebsd.



---

archive/issue_comments_387523.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-01T22:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387523",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387524.json:
```json
{
    "body": "Attachment [lidia-2.3.0+latte-patches-2014-10-04.p0.log](tarball://root/attachments/some-uuid/ticket27746/lidia-2.3.0+latte-patches-2014-10-04.p0.log) by @sophiasage created at 2019-05-02 06:51:14",
    "created_at": "2019-05-02T06:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387524",
    "user": "https://github.com/sophiasage"
}
```

Attachment [lidia-2.3.0+latte-patches-2014-10-04.p0.log](tarball://root/attachments/some-uuid/ticket27746/lidia-2.3.0+latte-patches-2014-10-04.p0.log) by @sophiasage created at 2019-05-02 06:51:14



---

archive/issue_comments_387525.json:
```json
{
    "body": "Attachment [lidia-2.3.0+latte-patches-2019-05-01.log](tarball://root/attachments/some-uuid/ticket27746/lidia-2.3.0+latte-patches-2019-05-01.log) by @sophiasage created at 2019-05-02 06:51:24",
    "created_at": "2019-05-02T06:51:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387525",
    "user": "https://github.com/sophiasage"
}
```

Attachment [lidia-2.3.0+latte-patches-2019-05-01.log](tarball://root/attachments/some-uuid/ticket27746/lidia-2.3.0+latte-patches-2019-05-01.log) by @sophiasage created at 2019-05-02 06:51:24



---

archive/issue_comments_387526.json:
```json
{
    "body": "in the setting where location of GMP headers and libs has to be specified in C(XX)FLAGS and in LDFLAGS, lidia's configure returns a false negative, as it ignores them for no good reason. So one needs \n\n```diff\n--- /dev/null\n+++ b/build/pkgs/lidia/patches/accept_gmp.patch\n@@ -0,0 +1,13 @@\n+diff --git a/configure b/configure\n+index dd9b0ad..77a438a 100755\n+--- a/configure\n++++ b/configure\n+@@ -18092,7 +18092,7 @@ EOF\n+   test $ac_status = 0; }; } > /dev/null 2>&1; then\n+                       lidia_cv_gmp=\"yes\"\n+               else\n+-                      lidia_cv_gmp=\"no\"\n++                      lidia_cv_gmp=\"yes\"\n+               fi\n+ \n+ fi\n```\n\nto tell it to shut up and trust that Sage has it all sorted already.",
    "created_at": "2019-05-02T09:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387526",
    "user": "https://github.com/dimpase"
}
```

in the setting where location of GMP headers and libs has to be specified in C(XX)FLAGS and in LDFLAGS, lidia's configure returns a false negative, as it ignores them for no good reason. So one needs 

```diff
--- /dev/null
+++ b/build/pkgs/lidia/patches/accept_gmp.patch
@@ -0,0 +1,13 @@
+diff --git a/configure b/configure
+index dd9b0ad..77a438a 100755
+--- a/configure
++++ b/configure
+@@ -18092,7 +18092,7 @@ EOF
+   test $ac_status = 0; }; } > /dev/null 2>&1; then
+                       lidia_cv_gmp="yes"
+               else
+-                      lidia_cv_gmp="no"
++                      lidia_cv_gmp="yes"
+               fi
+ 
+ fi
```

to tell it to shut up and trust that Sage has it all sorted already.



---

archive/issue_comments_387527.json:
```json
{
    "body": "The correct fix, of course, would be in lidia's `acinclude.m4`.",
    "created_at": "2019-05-02T09:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387527",
    "user": "https://github.com/mkoeppe"
}
```

The correct fix, of course, would be in lidia's `acinclude.m4`.



---

archive/issue_comments_387528.json:
```json
{
    "body": "Of course, but I saw way too many semi-broken homegrown m4 macros to recognise GMP lately to be bothered about it.\n\nThe only harm of this patch is that, potentially, if something goes horribly wrong, you get a linker error...",
    "created_at": "2019-05-02T09:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387528",
    "user": "https://github.com/dimpase"
}
```

Of course, but I saw way too many semi-broken homegrown m4 macros to recognise GMP lately to be bothered about it.

The only harm of this patch is that, potentially, if something goes horribly wrong, you get a linker error...



---

archive/issue_comments_387529.json:
```json
{
    "body": "\n```\nChanged 3 hours ago by selia\nAttachment lidia-2.3.0+latte-patches-2014-10-04.p0.log\u200b added\nChanged 3 hours ago by selia\nAttachment lidia-2.3.0+latte-patches-2019-05-01.log\u200b added\n```\n\n`@`selia, have you pulled the branch of this ticket?\nThere should not be any patches to apply in `build/pkgs/lidia/patches/`.",
    "created_at": "2019-05-02T09:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387529",
    "user": "https://github.com/dimpase"
}
```


```
Changed 3 hours ago by selia
Attachment lidia-2.3.0+latte-patches-2014-10-04.p0.log​ added
Changed 3 hours ago by selia
Attachment lidia-2.3.0+latte-patches-2019-05-01.log​ added
```

`@`selia, have you pulled the branch of this ticket?
There should not be any patches to apply in `build/pkgs/lidia/patches/`.



---

archive/issue_comments_387530.json:
```json
{
    "body": "Dima, could you test branch `config_flags` from https://github.com/mkoeppe/LiDIA/tree/config_flags",
    "created_at": "2019-05-02T09:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387530",
    "user": "https://github.com/mkoeppe"
}
```

Dima, could you test branch `config_flags` from https://github.com/mkoeppe/LiDIA/tree/config_flags



---

archive/issue_comments_387531.json:
```json
{
    "body": "running `./bootstrap` gives a lot of warnings like\n\n```\nlibrary/number_fields/Makefile.am:42: warning: source file '$(LIDIA_NF_SRCDIR)/quadratic_order/quadratic_order1.cc' is in a subdirectory,\nlibrary/number_fields/Makefile.am:42: but option 'subdir-objects' is disabled\n```\n\nIs it normal?",
    "created_at": "2019-05-02T12:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387531",
    "user": "https://github.com/dimpase"
}
```

running `./bootstrap` gives a lot of warnings like

```
library/number_fields/Makefile.am:42: warning: source file '$(LIDIA_NF_SRCDIR)/quadratic_order/quadratic_order1.cc' is in a subdirectory,
library/number_fields/Makefile.am:42: but option 'subdir-objects' is disabled
```

Is it normal?



---

archive/issue_comments_387532.json:
```json
{
    "body": "OK, https://github.com/mkoeppe/LiDIA/tree/config_flags works for me in instead of the patch in comment:10.\n\nBy the way, not only with clang 6, but with clang 7 too.",
    "created_at": "2019-05-02T13:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387532",
    "user": "https://github.com/dimpase"
}
```

OK, https://github.com/mkoeppe/LiDIA/tree/config_flags works for me in instead of the patch in comment:10.

By the way, not only with clang 6, but with clang 7 too.



---

archive/issue_comments_387533.json:
```json
{
    "body": "Thanks for testing!",
    "created_at": "2019-05-02T13:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387533",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for testing!



---

archive/issue_comments_387534.json:
```json
{
    "body": "once you made a new tarball, and provided a link to it, please feel free to set this to positive review.",
    "created_at": "2019-05-02T13:37:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387534",
    "user": "https://github.com/dimpase"
}
```

once you made a new tarball, and provided a link to it, please feel free to set this to positive review.



---

archive/issue_comments_387535.json:
```json
{
    "body": "Replying to [comment:15 dimpase]:\n> running `./bootstrap` gives a lot of warnings like\n> {{{\n> library/number_fields/Makefile.am:42: warning: source file '$(LIDIA_NF_SRCDIR)/quadratic_order/quadratic_order1.cc' is in a subdirectory,\n> library/number_fields/Makefile.am:42: but option 'subdir-objects' is disabled\n> }}}\n> Is it normal?\nI see these warnings too, but I decided not to address them at this time.",
    "created_at": "2019-05-02T15:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387535",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:15 dimpase]:
> running `./bootstrap` gives a lot of warnings like
> {{{
> library/number_fields/Makefile.am:42: warning: source file '$(LIDIA_NF_SRCDIR)/quadratic_order/quadratic_order1.cc' is in a subdirectory,
> library/number_fields/Makefile.am:42: but option 'subdir-objects' is disabled
> }}}
> Is it normal?
I see these warnings too, but I decided not to address them at this time.



---

archive/issue_comments_387536.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-02T15:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387536",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_387537.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-02T15:22:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387537",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_025531.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2019-05-06T11:56:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27509#event-25531"
}
```



---

archive/issue_comments_387538.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-05-06T11:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27509",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27509#issuecomment-387538",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
