# Issue 27509: Fix LiDIA installation on macOS

Issue created by migration from https://trac.sagemath.org/ticket/27746

Original creator: mkoeppe

Original creation time: 2019-04-29 09:17:18

CC:  dimpase jipilab @sophiasage

https://groups.google.com/d/msg/sage-devel/UtdbqZy-1VE/Jlxfj3FxDAAJ

https://github.com/mkoeppe/LiDIA/issues/1


---

Comment by dimpase created at 2019-04-29 09:34:22

Also, https://github.com/mkoeppe/LiDIA/pull/2 - can this be merged upstream?


---

Comment by jipilab created at 2019-04-29 11:25:12

Changing component from PLEASE CHANGE to packages: experimental.


---

Comment by mkoeppe created at 2019-04-29 14:06:38

What happened in this bug report is that CXX has been set to "g++ -std=gnu++11" (where g++ is the system's clang compiler).
This causes an error.


---

Comment by mkoeppe created at 2019-05-01 18:41:17

New commits:


---

Comment by mkoeppe created at 2019-05-01 18:41:17

Changing status from new to needs_review.


---

Comment by dimpase created at 2019-05-01 19:11:56

OK, this also needs adjustement w.r.t. to #27212. (Somehow lidia went under the radar there).

What is the correct way to configure it if GMP is installed in the standard location,
searched by default by compiler/linker? Does it still need these `--with-extra...`?

Otherwise, `spkg-install` should contain something like

```sh
sdh_configure --with-arithmetic=gmp \
              --with-extra-includes="$SAGE_GMP_INCLUDE" \
              --with-extra-libs="$SAGE_GMP_PREFIX/lib" \
              --enable-shared=yes --enable-static=no
}}} 

-------------

ok, so an experiment tells me that `--with-extra-` may be skipped if the GMP location is searched by compiler/linker.


---

Comment by dimpase created at 2019-05-01 19:21:46

otherwise, I checked that things build with gcc 8.3 on linux and with clang 6.0.1 on freebsd.


---

Comment by git created at 2019-05-01 22:42:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Attachment


---

Attachment


---

Comment by dimpase created at 2019-05-02 09:07:51

in the setting where location of GMP headers and libs has to be specified in C(XX)FLAGS and in LDFLAGS, lidia's configure returns a false negative, as it ignores them for no good reason. So one needs 

```diff
--- /dev/null
+++ b/build/pkgs/lidia/patches/accept_gmp.patch
@@ -0,0 +1,13 @@
+diff --git a/configure b/configure
+index dd9b0ad..77a438a 100755
+--- a/configure
++++ b/configure
+@@ -18092,7 +18092,7 @@ EOF
+   test $ac_status = 0; }; } > /dev/null 2>&1; then
+                       lidia_cv_gmp="yes"
+               else
+-                      lidia_cv_gmp="no"
++                      lidia_cv_gmp="yes"
+               fi
+ 
+ fi
```

to tell it to shut up and trust that Sage has it all sorted already.


---

Comment by mkoeppe created at 2019-05-02 09:24:32

The correct fix, of course, would be in lidia's `acinclude.m4`.


---

Comment by dimpase created at 2019-05-02 09:31:47

Of course, but I saw way too many semi-broken homegrown m4 macros to recognise GMP lately to be bothered about it.

The only harm of this patch is that, potentially, if something goes horribly wrong, you get a linker error...


---

Comment by dimpase created at 2019-05-02 09:36:38


```
Changed 3 hours ago by selia
Attachment lidia-2.3.0+latte-patches-2014-10-04.p0.log​ added
Changed 3 hours ago by selia
Attachment lidia-2.3.0+latte-patches-2019-05-01.log​ added
```

`@`selia, have you pulled the branch of this ticket?
There should not be any patches to apply in `build/pkgs/lidia/patches/`.


---

Comment by mkoeppe created at 2019-05-02 09:49:45

Dima, could you test branch `config_flags` from https://github.com/mkoeppe/LiDIA/tree/config_flags


---

Comment by dimpase created at 2019-05-02 12:50:31

running `./bootstrap` gives a lot of warnings like

```
library/number_fields/Makefile.am:42: warning: source file '$(LIDIA_NF_SRCDIR)/quadratic_order/quadratic_order1.cc' is in a subdirectory,
library/number_fields/Makefile.am:42: but option 'subdir-objects' is disabled
```

Is it normal?


---

Comment by dimpase created at 2019-05-02 13:20:45

OK, https://github.com/mkoeppe/LiDIA/tree/config_flags works for me in instead of the patch in comment:10.

By the way, not only with clang 6, but with clang 7 too.


---

Comment by mkoeppe created at 2019-05-02 13:23:20

Thanks for testing!


---

Comment by dimpase created at 2019-05-02 13:37:21

once you made a new tarball, and provided a link to it, please feel free to set this to positive review.


---

Comment by mkoeppe created at 2019-05-02 15:11:14

Replying to [comment:15 dimpase]:
> running `./bootstrap` gives a lot of warnings like
> {{{
> library/number_fields/Makefile.am:42: warning: source file '$(LIDIA_NF_SRCDIR)/quadratic_order/quadratic_order1.cc' is in a subdirectory,
> library/number_fields/Makefile.am:42: but option 'subdir-objects' is disabled
> }}}
> Is it normal?
I see these warnings too, but I decided not to address them at this time.


---

Comment by git created at 2019-05-02 15:21:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2019-05-02 15:22:29

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-05-06 11:56:09

Resolution: fixed
