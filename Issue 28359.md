# Issue 28359: Fix jmol permissions

archive/issues_028359.json:
```json
{
    "body": "CC:  jdemeyer embray novoselt\n\nThis is a followup to #25026: the permissions of `SAGE_ROOT/local/share/jmol/` are wrong.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28596\n\n",
    "created_at": "2019-10-12T17:13:45Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "title": "Fix jmol permissions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28359",
    "user": "jhpalmieri"
}
```
CC:  jdemeyer embray novoselt

This is a followup to #25026: the permissions of `SAGE_ROOT/local/share/jmol/` are wrong.

Issue created by migration from https://trac.sagemath.org/ticket/28596





---

archive/issue_comments_400476.json:
```json
{
    "body": "I can see two solutions: change jmol's spkg-install script so it sets the right permissions, or set the permissions differently for all packages. Here is a branch which does the second of these: after unpacking the tarball into `src`, run `chmod +rx src`. Is this a bad idea for some reason?",
    "created_at": "2019-10-12T17:31:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28359#issuecomment-400476",
    "user": "jhpalmieri"
}
```

I can see two solutions: change jmol's spkg-install script so it sets the right permissions, or set the permissions differently for all packages. Here is a branch which does the second of these: after unpacking the tarball into `src`, run `chmod +rx src`. Is this a bad idea for some reason?



---

archive/issue_comments_400477.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-10-12T17:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28359#issuecomment-400477",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_400478.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-10-12T17:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28359#issuecomment-400478",
    "user": "jhpalmieri"
}
```

New commits:



---

archive/issue_comments_400479.json:
```json
{
    "body": "I want to do this for all packages to avoid similar situations in the future.",
    "created_at": "2019-10-12T17:34:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28359#issuecomment-400479",
    "user": "jhpalmieri"
}
```

I want to do this for all packages to avoid similar situations in the future.



---

archive/issue_comments_400480.json:
```json
{
    "body": "This does not seem to fix the doc building issue.",
    "created_at": "2019-10-12T18:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28359#issuecomment-400480",
    "user": "chapoton"
}
```

This does not seem to fix the doc building issue.



---

archive/issue_comments_400481.json:
```json
{
    "body": "Replying to [comment:6 chapoton]:\n> This does not seem to fix the doc building issue.\n\nI don't know what doc building issue you're referencing.",
    "created_at": "2019-12-16T11:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28359#issuecomment-400481",
    "user": "embray"
}
```

Replying to [comment:6 chapoton]:
> This does not seem to fix the doc building issue.

I don't know what doc building issue you're referencing.



---

archive/issue_comments_400482.json:
```json
{
    "body": "Here is the docbuild log where the problem appears:\n\nhttps://patchbot.sagemath.org/log/0/Ubuntu/16.04/x86_64/4.4.0-166-generic/atlas/2019-11-27%2010:02:21?plugin=docbuild\n\nThis prevents me from using this machine as a patchbot.",
    "created_at": "2019-12-16T13:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28359#issuecomment-400482",
    "user": "chapoton"
}
```

Here is the docbuild log where the problem appears:

https://patchbot.sagemath.org/log/0/Ubuntu/16.04/x86_64/4.4.0-166-generic/atlas/2019-11-27%2010:02:21?plugin=docbuild

This prevents me from using this machine as a patchbot.



---

archive/issue_comments_400483.json:
```json
{
    "body": "This behavior originates from #24567, and would be different if we'd gone with Jeroen's suggestion of a less restricted mask on the files than I used.\n\nI wrote at the time:\n\n> this should have no effect on the permissions applied when the files are installed, but I guess it depends in part on the installation mechanism\n\nWhich, incidentally was true at the time.  But the part of \"depends on the installation mechanism\" was also true, and the installation mechanism *did* change after that, in such a way that this did have an effect on the installed files.\n\nSo I think the better option here might be to try Jeroen's original suggestion of a less restrictive permission mask on the source tarball's extraction location.",
    "created_at": "2019-12-16T15:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28359#issuecomment-400483",
    "user": "embray"
}
```

This behavior originates from #24567, and would be different if we'd gone with Jeroen's suggestion of a less restricted mask on the files than I used.

I wrote at the time:

> this should have no effect on the permissions applied when the files are installed, but I guess it depends in part on the installation mechanism

Which, incidentally was true at the time.  But the part of "depends on the installation mechanism" was also true, and the installation mechanism *did* change after that, in such a way that this did have an effect on the installed files.

So I think the better option here might be to try Jeroen's original suggestion of a less restrictive permission mask on the source tarball's extraction location.



---

archive/issue_comments_400484.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-12-16T15:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28359#issuecomment-400484",
    "user": "embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_400485.json:
```json
{
    "body": "This approach fixes the issue closer to the source.  However, it would be good to test a full rebuild.  I don't know for sure if there aren't some pathological packages that can break because of this (and if so those packages should probably be fixed...).\n----\nNew commits:",
    "created_at": "2019-12-16T16:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28359#issuecomment-400485",
    "user": "embray"
}
```

This approach fixes the issue closer to the source.  However, it would be good to test a full rebuild.  I don't know for sure if there aren't some pathological packages that can break because of this (and if so those packages should probably be fixed...).
----
New commits:



---

archive/issue_comments_400486.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-12-16T16:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28359#issuecomment-400486",
    "user": "embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_400487.json:
```json
{
    "body": "All tests pass for me on OS X, with a build from scratch, and the permissions look okay.",
    "created_at": "2019-12-16T22:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28359#issuecomment-400487",
    "user": "jhpalmieri"
}
```

All tests pass for me on OS X, with a build from scratch, and the permissions look okay.



---

archive/issue_comments_400488.json:
```json
{
    "body": "then it should be ok, no ?",
    "created_at": "2019-12-17T19:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28359#issuecomment-400488",
    "user": "chapoton"
}
```

then it should be ok, no ?



---

archive/issue_comments_400489.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-17T19:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28359#issuecomment-400489",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_400490.json:
```json
{
    "body": "Okay with me.",
    "created_at": "2019-12-17T19:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28359#issuecomment-400490",
    "user": "jhpalmieri"
}
```

Okay with me.



---

archive/issue_comments_400491.json:
```json
{
    "body": "I'm sure, if he were paying attention, Jeroen would be pleased to be vindicated :)",
    "created_at": "2019-12-18T10:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28359#issuecomment-400491",
    "user": "embray"
}
```

I'm sure, if he were paying attention, Jeroen would be pleased to be vindicated :)



---

archive/issue_comments_400492.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-12-20T22:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28359#issuecomment-400492",
    "user": "vbraun"
}
```

Resolution: fixed
