# Issue 28359: Fix jmol permissions

Issue created by migration from https://trac.sagemath.org/ticket/28596

Original creator: jhpalmieri

Original creation time: 2019-10-12 17:13:45

CC:  jdemeyer embray novoselt

This is a followup to #25026: the permissions of `SAGE_ROOT/local/share/jmol/` are wrong.


---

Comment by jhpalmieri created at 2019-10-12 17:31:23

I can see two solutions: change jmol's spkg-install script so it sets the right permissions, or set the permissions differently for all packages. Here is a branch which does the second of these: after unpacking the tarball into `src`, run `chmod +rx src`. Is this a bad idea for some reason?


---

Comment by jhpalmieri created at 2019-10-12 17:32:54

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2019-10-12 17:32:54

New commits:


---

Comment by jhpalmieri created at 2019-10-12 17:34:13

I want to do this for all packages to avoid similar situations in the future.


---

Comment by chapoton created at 2019-10-12 18:59:33

This does not seem to fix the doc building issue.


---

Comment by embray created at 2019-12-16 11:16:40

Replying to [comment:6 chapoton]:
> This does not seem to fix the doc building issue.

I don't know what doc building issue you're referencing.


---

Comment by chapoton created at 2019-12-16 13:31:49

Here is the docbuild log where the problem appears:

https://patchbot.sagemath.org/log/0/Ubuntu/16.04/x86_64/4.4.0-166-generic/atlas/2019-11-27%2010:02:21?plugin=docbuild

This prevents me from using this machine as a patchbot.


---

Comment by embray created at 2019-12-16 15:31:54

This behavior originates from #24567, and would be different if we'd gone with Jeroen's suggestion of a less restricted mask on the files than I used.

I wrote at the time:

> this should have no effect on the permissions applied when the files are installed, but I guess it depends in part on the installation mechanism

Which, incidentally was true at the time.  But the part of "depends on the installation mechanism" was also true, and the installation mechanism _did_ change after that, in such a way that this did have an effect on the installed files.

So I think the better option here might be to try Jeroen's original suggestion of a less restrictive permission mask on the source tarball's extraction location.


---

Comment by embray created at 2019-12-16 15:31:54

Changing status from needs_review to needs_work.


---

Comment by embray created at 2019-12-16 16:04:53

This approach fixes the issue closer to the source.  However, it would be good to test a full rebuild.  I don't know for sure if there aren't some pathological packages that can break because of this (and if so those packages should probably be fixed...).
----
New commits:


---

Comment by embray created at 2019-12-16 16:05:05

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2019-12-16 22:24:48

All tests pass for me on OS X, with a build from scratch, and the permissions look okay.


---

Comment by chapoton created at 2019-12-17 19:16:07

then it should be ok, no ?


---

Comment by jhpalmieri created at 2019-12-17 19:17:04

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2019-12-17 19:17:04

Okay with me.


---

Comment by embray created at 2019-12-18 10:22:44

I'm sure, if he were paying attention, Jeroen would be pleased to be vindicated :)


---

Comment by vbraun created at 2019-12-20 22:46:04

Resolution: fixed
