# Issue 23105: Cython wrapper for Hein's ternary Birch code

Issue created by migration from Trac.

Original creator: kedlaya

Original creation time: 2017-06-30 05:46:48

CC:  jvoight tornaria

Keywords: Hecke operators, quadratic forms

One product of Jeffery Hein's PhD thesis is some impressive C++ code for computing Hecke operators on spaces of modular forms, based on a method of Birch involving reduction of ternary quadratic forms. Besides being very fast, the code produces sparse integer matrices for individual Atkin-Lehner eigenspaces.

The code is available at

https://github.com/jefferyphein/ternary-birch

and it would be great to get it into Sage. This might require some better packaging on the upstream end, but for now I'm focusing on building a working Cython wrapper. I have some progress on that, but I'm new to the Cython/C++ interaction and that is holding things up.


---

Comment by jdemeyer created at 2017-06-30 10:08:44

Replying to [ticket:23342 kedlaya]:
> This might require some better packaging on the upstream end

I see that this package uses SCons unfortunately. I personally hate SCons because it is much less portable than other alternatives. We used to have a few packages in Sage using SCons, but we either got rid of them or we ported them to a different build system. Besides that, there is also the simple fact that SCons is not shipped with Sage. Luckily, the package is simple enough, so porting to autotools should not be too hard.


---

Comment by kedlaya created at 2017-06-30 16:22:31

Replying to [comment:1 jdemeyer]:
> Replying to [ticket:23342 kedlaya]:
> > This might require some better packaging on the upstream end
> 
> I see that this package uses SCons unfortunately. I personally hate SCons because it is much less portable than other alternatives. We used to have a few packages in Sage using SCons, but we either got rid of them or we ported them to a different build system. Besides that, there is also the simple fact that SCons is not shipped with Sage. Luckily, the package is simple enough, so porting to autotools should not be too hard.

We may be able to get some help from upstream if it comes to that. Anyway, the purpose of this ticket is just the wrapper; I plan to open another ticket regarding packaging later if we get that far.


---

Comment by kedlaya created at 2017-08-25 20:02:22

Sage+Cython wrapper to Hein's C++ code


---

Attachment

I've attached a working wrapper to Hein's code. The code itself may be of some independent interest besides what I've exposed (e.g., for dealing with quaternion algebras), but I'm not sure if it can easily be made 32-bit-safe. (This has been an issue with incorporating other packages; see for instance #965.)

By the way, the publicly available reference for Birch's method is Birch's 1991 article "Hecke actions on classes of ternary quadratic forms".


---

Comment by kedlaya created at 2017-08-25 20:06:55

Changing keywords from "Hecke operators, quadratic forms" to "Hecke operators, quadratic forms, days88".


---

Comment by kedlaya created at 2017-08-26 18:51:50

It seems that I managed to include enough build directives in my Cython that there is no need for Scons (just tested this on a fresh copy).


---

Comment by chapoton created at 2017-09-18 16:02:44

New commits:


---

Comment by roed created at 2017-09-30 22:42:38

Changing keywords from "Hecke operators, quadratic forms, days88" to "Hecke operators, quadratic forms, days88, sd91".


---

Comment by git created at 2018-05-10 17:21:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kedlaya created at 2018-05-10 17:25:18

Quick update: in light of the deprecation warnings, I changed the pragmas to use distutils.

This currently "works" in the following sense: if I put `hein_wrapper.pyx` in the same folder as the Hein code, then running `load("hein_wrapper.pyx")` works in Sage 8.2. However, I haven't thought at all about packaging this to actually build as part of Sage.


---

Comment by jdemeyer created at 2018-05-10 19:08:41

I see two options:

1. Simply "fork" the upstream into Sage, meaning copy the code.

2. Add a proper build system to the upstream package (for example using autotools) and then add that to Sage as optional package.


---

Comment by kedlaya created at 2018-05-10 20:16:16

My impression is that Hein would be willing to accept code upstream (he is not working in academia and may not be spending too much time on this anymore). So setting up a proper build system upstream might be the best plan here; but I'm not competent to do this myself.


---

Comment by kedlaya created at 2019-01-26 18:29:42

Update: Hein has released a 2.0 version of his code with a much better Sage wrapper than the one I wrote. So we might be able to get by with forking the upstream and discarding my previous code (which would be fine with me).
----
New commits:
