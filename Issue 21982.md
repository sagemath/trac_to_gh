# Issue 21982: Upgrade to pynac-0.7.4

Issue created by migration from https://trac.sagemath.org/ticket/22219

Original creator: rws

Original creation time: 2017-01-20 16:10:00

From pynac-0.7.4 Changelog:
* improve domain logic (#18883, #22026)
* improve derivatives of `conjugate`, `real`, `imag`, `abs` (#22209)
* precision was lost with some useries
* replace crationality with exactness when deciding when to evalf (fixes #22142)
* fix giac support
* expose `to_gamma()` and `gamma_normalize()` to Sage (#22174)
* improve gamma normalization in Gosper summation
* performance improvements

With this ticket we also finally turn on Giac support in Pynac (used for GCD) again (#21885).

https://github.com/pynac/pynac/releases/download/pynac-0.7.4/pynac-0.7.4.tar.bz2


---

Comment by rws created at 2017-01-20 16:24:35

New commits:


---

Comment by rws created at 2017-01-20 16:24:35

Changing status from new to needs_review.


---

Comment by jpflori created at 2017-01-31 12:15:22

I get a bunch of errors when running tests on a POWER7:

```
sage: y = var('y')
sage: g = x + y/(x + 2); g
x + y/(x + 2)
sage: g
x + y/(x + 2)
sage: g.numerator()
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-4-7f8c42e112c2> in <module>()
----> 1 g.numerator()

/home/jpflori/sage.git/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.numerator (/home/jpflori/sage.git/src/build/cythonized/sage/symbolic/expression.cpp:45767)()
   8608         cdef GEx oper, power
   8609         if normalize:
-> 8610             return new_Expression_from_GEx(self._parent, self._gobj.numer())
   8611         elif is_a_mul(self._gobj):
   8612             for i from 0 <= i < self._gobj.nops():

RuntimeError: Exponent overflow Error: Bad Argument Value
```



---

Comment by rws created at 2017-01-31 13:55:25

Could you please do the following: start `sage -gdb`, hit Ctrl-Z to get the gdb prompt, input `catch throw` then give `c<Enter>` until you get back to the Sage prompt. Now on error you should be thrown directly down to gdb. Now I would be interested in a backtrace that you can get with `bt`. I don't need the full list, please give me just the C++ part, i.e. everything until you see the `Py...` functions.


---

Comment by jpflori created at 2017-01-31 14:16:51

Here you go:

```
#0  0x00003fffac10ae54 in .__cxa_throw () from /lib64/libstdc++.so.6
#1  0x00003ffb20b99b38 in giac::undeferr (
    s="Exponent overflow Error: Bad Argument Value") at gen.cc:445
#2  0x00003ffb20b99f84 in giac::gensizeerr (s=...) at gen.cc:485
#3  0x00003ffb20c0110c in giac::pow (base=..., exponent=<optimized out>)
    at gen.cc:7096
#4  0x00003ffb20472644 in giac::giac_gcd_modular_algo1 (p=..., q=..., d=...)
    at modpoly.cc:7309
#5  0x00003ffb2047af4c in giac::gcd_modular_algo1 (p=..., q=..., d=..., 
    compute_cof=<optimized out>) at modpoly.cc:7675
#6  0x00003ffb201decc4 in giac::gcd_modular_algo (p=..., q=..., d=..., 
    compute_cof=<optimized out>) at gausspol.cc:3513
#7  0x00003ffb2047bc38 in giac::gcd_modular (p_orig=..., q_orig=..., pgcd=..., 
    pcofactor=..., qcofactor=..., compute_cofactors=<optimized out>)
    at modpoly.cc:2878
#8  0x00003ffb201bcb28 in giac::gcdheu (p_orig=..., 
    p_deg=std::vector of length 1, capacity 1 = {...}, q_orig=..., 
    q_deg=std::vector of length 1, capacity 1 = {...}, p_simp=..., 
    np_simp=..., q_simp=..., nq_simp=..., d=..., d_content=..., 
    skip_test=skip_test@entry=false, 
    compute_cofactors=compute_cofactors@entry=false) at gausspol.cc:3920
#9  0x00003ffb201c256c in giac::gcd (p=..., q=..., d=...) at gausspol.cc:4675
#10 0x00003ffb201c1eec in giac::gcd (p=..., q=..., d=...) at gausspol.cc:4657
#11 0x00003ffb201c2c9c in giac::gcd (p=..., q=...) at gausspol.cc:4693
#12 0x00003ffb201c7988 in giac::has_constant_variables_gcd (p=..., q=..., 
    d=...) at gausspol.cc:3756
#13 0x00003ffb201c2418 in giac::gcd (p=..., q=..., d=...) at gausspol.cc:4669
#14 0x00003ffb210d1b0c in GiNaC::gcdpoly (a=..., b=..., ca=0x3fffffff9b18, 
    cb=0x3fffffff9b10, check_args=<optimized out>) at mpoly-giac.cpp:392
#15 0x00003ffb21100a28 in GiNaC::frac_cancel (n=..., d=...) at normal.cpp:405
#16 0x00003ffb211016f0 in GiNaC::add::normal (this=<optimized out>, repl=..., 
    rev_lookup=..., level=<optimized out>, options=<optimized out>)
    at normal.cpp:491
#17 0x00003ffb210f9cec in GiNaC::ex::numer (this=<optimized out>)
    at normal.cpp:646
...
```



---

Comment by jpflori created at 2017-01-31 14:18:34

Which looks very giac related.
I think I got other giac errors (without going through pynac), I'll have to check.


---

Comment by jpflori created at 2017-01-31 14:24:11

It might be http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=19&t=1723 so completely pynac unrelated.


---

Comment by jpflori created at 2017-01-31 14:36:18

And I guess it also means the dependencies file should mention giac.


---

Comment by git created at 2017-01-31 15:48:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-01-31 15:49:18

Replying to [comment:8 jpflori]:
> And I guess it also means the dependencies file should mention giac.

Yes, I always forget that.


---

Comment by dkrenn created at 2017-02-04 14:32:33

FYI, Everything seem to work fine on Linux Mint 17.3.


---

Comment by vbraun created at 2017-02-05 14:09:20

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-02-06 23:11:38

Resolution: fixed
