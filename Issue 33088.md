# Issue 33088: First display of an object is slow

Issue created by migration from https://trac.sagemath.org/ticket/33325

Original creator: roed

Original creation time: 2022-02-12 04:42:56

CC:  klee vbraun dimpase jhpalmieri

In Sage 9.5,

```
sage: %time s = display(1)
1
CPU times: user 677 ms, sys: 31.1 ms, total: 708 ms
Wall time: 708 ms
```


In other words, the first object you display in a Sage session takes almost a second.  This is new since 9.4 (I don't have 9.5 betas to check against).


---

Comment by slelievre created at 2022-02-12 11:01:12

Did Sage startup time decrease accordingly?

Recent changes in lazy imports might cause such a shift.

- https://trac.sagemath.org/query?order=id&desc=1&summary=~lazy&summary=~startup


---

Comment by lorenz created at 2022-04-24 10:14:37

I played around with `strace` for a bit and the delay does seem to be caused by module imports. Indeed, looking at `sys.modules` supports this hypothesis:


```sage
sage: ms1 = set(sys.modules.keys())
sage: 5  # slow
5
sage: ms2 = set(sys.modules.keys())
sage: sorted({m.split('.')[0] for m in ms2 - ms1})
['PIL',
 '_elementtree',
 'cffi',
 'cycler',
 'dateutil',
 'defusedxml',
 'kiwisolver',
 'matplotlib',
 'mpl_toolkits',
 'numpy',
 'packaging',
 'pyexpat',
 'pyparsing',
 'secrets',
 'xml']
```


I don't think there's a good reason why displaying a simple object should have to load all these modules, so this does seem to qualify as a defect.

What's also kind of strange is that `5` is slow, but `print(5)` is fast.


---

Comment by mkoeppe created at 2022-04-24 20:22:35

It's the import from `matplotlib.figure` in `sage.repl`


---

Comment by mkoeppe created at 2022-04-24 20:32:39

(see also #33017.)


---

Comment by mkoeppe created at 2022-04-24 20:47:56

Changing priority from major to blocker.


---

Comment by mkoeppe created at 2022-04-24 20:47:56

New commits:


---

Comment by mkoeppe created at 2022-04-24 20:47:56

Changing status from new to needs_review.


---

Comment by vbraun created at 2022-04-24 22:00:13

Thats quite far in the "ridiculous" territory as far as blockers go


---

Comment by mkoeppe created at 2022-04-24 22:07:15

I don't know, it's a regression


---

Comment by mkoeppe created at 2022-04-24 22:24:49

I think there's no definition of blocker other than "if a ticket is set to a priority other than this, it will not be merged"


---

Comment by klee created at 2022-04-25 00:54:36

It works perfect. Tested with 

https://nbviewer.org/github/egourgoulhon/SageMathTest/blob/master/Notebooks/test_display.ipynb


---

Comment by klee created at 2022-04-25 00:54:36

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-04-25 04:56:22

Thanks!


---

Comment by vbraun created at 2022-04-25 22:28:27

The definition is more akin to "this is so important that we will have another rc cycle and not merge any other ticket for at least a week"


---

Comment by vbraun created at 2022-04-28 19:24:57

Resolution: fixed
