# Issue 14913: Implement NCSym

archive/issues_014913.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  sage-combinat @zabrocki @saliola @darijgr\n\nImplement the Hopf algebra of symmetric functions in non-commuting variables in the following bases:\n\n- monomial\n- elementary\n- homogeneous\n- power-sum\n- x\n- q\n\nas well as the dual basis w.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15150\n\n",
    "created_at": "2013-09-03T19:19:41Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.13",
    "title": "Implement NCSym",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14913",
    "user": "https://github.com/tscrim"
}
```
Assignee: sage-combinat

CC:  sage-combinat @zabrocki @saliola @darijgr

Implement the Hopf algebra of symmetric functions in non-commuting variables in the following bases:

- monomial
- elementary
- homogeneous
- power-sum
- x
- q

as well as the dual basis w.

Issue created by migration from https://trac.sagemath.org/ticket/15150





---

archive/issue_comments_190150.json:
```json
{
    "body": "[Answered my own question.]",
    "created_at": "2013-09-03T19:37:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190150",
    "user": "https://github.com/saliola"
}
```

[Answered my own question.]



---

archive/issue_comments_190151.json:
```json
{
    "body": "Here's what I currently have. The multiplication in the dual basis isn't working correctly yet. I know there's the `hopf_algebra_of_supercharacters-fs.patch` patch in the queue which seems like its targeted more for base rings of `ZZ[q]` (or like Hall-Littlewoods are to Sym), and I was hoping to link them together at some point (please correct me if I'm wrong). I'd be happy to work with you on this patch.",
    "created_at": "2013-09-03T19:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190151",
    "user": "https://github.com/tscrim"
}
```

Here's what I currently have. The multiplication in the dual basis isn't working correctly yet. I know there's the `hopf_algebra_of_supercharacters-fs.patch` patch in the queue which seems like its targeted more for base rings of `ZZ[q]` (or like Hall-Littlewoods are to Sym), and I was hoping to link them together at some point (please correct me if I'm wrong). I'd be happy to work with you on this patch.



---

archive/issue_comments_190152.json:
```json
{
    "body": "The only problem is that I don't have much time these days to work on this. I've been meaning to implement NCSym. I'll try to take a look at what you have and see what I can offer, if anything.\n\nAs usual, thank you for your work, Travis!",
    "created_at": "2013-09-03T19:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190152",
    "user": "https://github.com/saliola"
}
```

The only problem is that I don't have much time these days to work on this. I've been meaning to implement NCSym. I'll try to take a look at what you have and see what I can offer, if anything.

As usual, thank you for your work, Travis!



---

archive/issue_comments_190153.json:
```json
{
    "body": "Travis, what sources are you using for this? I'm asking because I haven't read anything about NCSym so far. I have a vague impression it has been introduced in one of Rota's Foundations papers, but not one that I have. A good introduction would simplify my job reviewing this by a lot.",
    "created_at": "2013-09-03T19:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190153",
    "user": "https://github.com/darijgr"
}
```

Travis, what sources are you using for this? I'm asking because I haven't read anything about NCSym so far. I have a vague impression it has been introduced in one of Rota's Foundations papers, but not one that I have. A good introduction would simplify my job reviewing this by a lot.



---

archive/issue_comments_190154.json:
```json
{
    "body": "Here's one of the references (Bergeron, Zabrocki): http://arxiv.org/pdf/math/0509265.pdf. I forget the other references off-hand (it's on my other computer tho), and I'll be adding all of the references to the doc as I finish it up.",
    "created_at": "2013-09-03T19:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190154",
    "user": "https://github.com/tscrim"
}
```

Here's one of the references (Bergeron, Zabrocki): http://arxiv.org/pdf/math/0509265.pdf. I forget the other references off-hand (it's on my other computer tho), and I'll be adding all of the references to the doc as I finish it up.



---

archive/issue_comments_190155.json:
```json
{
    "body": "Also I just fixed the **w** basis multiplication.",
    "created_at": "2013-09-03T20:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190155",
    "user": "https://github.com/tscrim"
}
```

Also I just fixed the **w** basis multiplication.



---

archive/issue_comments_190156.json:
```json
{
    "body": "Okay, the patch is now ready for first review. It has full doctest coverage and all tests pass for me. I've removed some of the coercions in the old version since I was worried about possibly breaking coercion commutative diagrams.\n\nSome of the things I'm not perfectly happy about (but can live with currently):\n\n- A descriptive name of the **q**, **x**, and **w** bases.\n- No antipode for the **w** basis.\n- Creating the `SymmetricFunctions` base object when creating `SymmetricFunctionNonCommutingVariables` in order to set up the coercion.\n- Is it safe to put the natural maps `Sym -> NCSym` and `NSym -> NCSym` as coercions?\n\nThe references I used are included in the documentation now too.",
    "created_at": "2013-09-07T00:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190156",
    "user": "https://github.com/tscrim"
}
```

Okay, the patch is now ready for first review. It has full doctest coverage and all tests pass for me. I've removed some of the coercions in the old version since I was worried about possibly breaking coercion commutative diagrams.

Some of the things I'm not perfectly happy about (but can live with currently):

- A descriptive name of the **q**, **x**, and **w** bases.
- No antipode for the **w** basis.
- Creating the `SymmetricFunctions` base object when creating `SymmetricFunctionNonCommutingVariables` in order to set up the coercion.
- Is it safe to put the natural maps `Sym -> NCSym` and `NSym -> NCSym` as coercions?

The references I used are included in the documentation now too.



---

archive/issue_comments_190157.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-09-07T00:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190157",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_190158.json:
```json
{
    "body": "Hi Travis, One initial comment about the `NSym -> NCSym` map.  It is dangerous to call it \"the natural\" map from `NSym` to `NCSym`.  It is one of many.  There does not seem to be a reason to favor the map which sends the complete generators to the complete generators.  If you were to send the elementary generators to the elementary generators you get a map which is equally compelling and (unfortunately) they are not the same map.",
    "created_at": "2013-09-09T17:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190158",
    "user": "https://github.com/zabrocki"
}
```

Hi Travis, One initial comment about the `NSym -> NCSym` map.  It is dangerous to call it "the natural" map from `NSym` to `NCSym`.  It is one of many.  There does not seem to be a reason to favor the map which sends the complete generators to the complete generators.  If you were to send the elementary generators to the elementary generators you get a map which is equally compelling and (unfortunately) they are not the same map.



---

archive/issue_comments_190159.json:
```json
{
    "body": "New version rebased over changes in #15143 and removes the word \"natural\" and instead states that it is the map which fixes `Sym`.",
    "created_at": "2013-09-13T04:58:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190159",
    "user": "https://github.com/tscrim"
}
```

New version rebased over changes in #15143 and removes the word "natural" and instead states that it is the map which fixes `Sym`.



---

archive/issue_comments_190160.json:
```json
{
    "body": "Hi Travis,\n\nWhat patches and version do you have applied?  I get fuzz on the file sage/combinat/ncsf_qsym/ncsf.py and doc tests failing in ncsym.py (seemingly) because the output displays in a different order.  We may need to put a dependency with other patches that touch ncsf.py.  I am currently running on sage-5.12.beta5 and only #15143 applied.",
    "created_at": "2013-09-13T17:21:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190160",
    "user": "https://github.com/zabrocki"
}
```

Hi Travis,

What patches and version do you have applied?  I get fuzz on the file sage/combinat/ncsf_qsym/ncsf.py and doc tests failing in ncsym.py (seemingly) because the output displays in a different order.  We may need to put a dependency with other patches that touch ncsf.py.  I am currently running on sage-5.12.beta5 and only #15143 applied.



---

archive/issue_comments_190161.json:
```json
{
    "body": "Hey Mike,\n\nI have 5.12.beta3 in the combinat queue, but the fuzz is likely due to #15164 (which I'm planning to review soon). What type of fuzz do you get? If it's 0 or 1, we don't need to put it down as a dependency.\n\nI'll build 5.12.beta5 today and see if I also get doctest failing.\n\nBest,\n\nTravis",
    "created_at": "2013-09-13T17:49:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190161",
    "user": "https://github.com/tscrim"
}
```

Hey Mike,

I have 5.12.beta3 in the combinat queue, but the fuzz is likely due to #15164 (which I'm planning to review soon). What type of fuzz do you get? If it's 0 or 1, we don't need to put it down as a dependency.

I'll build 5.12.beta5 today and see if I also get doctest failing.

Best,

Travis



---

archive/issue_comments_190162.json:
```json
{
    "body": "You are right that the fuzz is disappears by applying #15164\n\nI get 4 doctest failures on ncsym.py.  They are minor, but I don't know why I see them and you don't (so it doesn't seem like a good idea to change them).  They are on lines 248, 438, 633, 737 and for instance one is\n\n```\n\nFile \"sage/combinat/ncsym/ncsym.py\", line 633, in sage.combinat.ncsym.ncsym.SymmetricFunctionsNonCommutingVariables.elementary.Element.omega\nFailed example:\n    elt = e[[1,3],[2]].omega(); elt\nExpected:\n    -e{{1, 3}, {2}} + 2*e{{1}, {2}, {3}}\nGot:\n    2*e{{1}, {2}, {3}} - e{{1, 3}, {2}}\n```",
    "created_at": "2013-09-13T18:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190162",
    "user": "https://github.com/zabrocki"
}
```

You are right that the fuzz is disappears by applying #15164

I get 4 doctest failures on ncsym.py.  They are minor, but I don't know why I see them and you don't (so it doesn't seem like a good idea to change them).  They are on lines 248, 438, 633, 737 and for instance one is

```

File "sage/combinat/ncsym/ncsym.py", line 633, in sage.combinat.ncsym.ncsym.SymmetricFunctionsNonCommutingVariables.elementary.Element.omega
Failed example:
    elt = e[[1,3],[2]].omega(); elt
Expected:
    -e{{1, 3}, {2}} + 2*e{{1}, {2}, {3}}
Got:
    2*e{{1}, {2}, {3}} - e{{1, 3}, {2}}
```



---

archive/issue_comments_190163.json:
```json
{
    "body": "I would have thought that the total ordering on set partitions in #15143 would have `CombinatorialFreeModule` give a unique sorting on the elements:\n\n```\nsage: SetPartition([[1,3],[2]]) < SetPartition([[1],[2],[3]])\nFalse\nsage: SetPartition([[1,3],[2]]) > SetPartition([[1],[2],[3]])\nTrue\nsage: SetPartition([[1],[2],[3]]) < SetPartition([[1,3],[2]])\nTrue\nsage: SetPartition([[1],[2],[3]]) > SetPartition([[1,3],[2]])\nFalse\n```\n\nMy guess as to why we're getting different output is a failure in the comparisons (I didn't see any tickets that seemed like would change the output of `linear_comb()`). Try running:\n\n```\nsage: e = SymmetricFunctionsNonCommutingVariables(QQ).e()\nsage: e.print_options()\n{'bracket': False,\n 'latex_bracket': False,\n 'latex_prefix': None,\n 'latex_scalar_mult': None,\n 'monomial_cmp': <function cmp>,\n 'prefix': 'e',\n 'scalar_mult': '*',\n 'tensor_symbol': None}\nsage: cmp(SetPartition([[1],[2],[3]]), SetPartition([[1,3],[2]]))\n-1\nsage: elt = 2*e[[1],[2],[3]] - e[[1,3],[2]]\nsage: L = elt._monomial_coefficients.items()\nsage: L.sort(cmp=cmp, key=lambda (x,y): x)\nsage: L\n[({{1, 3}, {2}}, -1), ({{1}, {2}, {3}}, 2)]\n```\nDo you get anything different, in particular the last one?",
    "created_at": "2013-09-13T18:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190163",
    "user": "https://github.com/tscrim"
}
```

I would have thought that the total ordering on set partitions in #15143 would have `CombinatorialFreeModule` give a unique sorting on the elements:

```
sage: SetPartition([[1,3],[2]]) < SetPartition([[1],[2],[3]])
False
sage: SetPartition([[1,3],[2]]) > SetPartition([[1],[2],[3]])
True
sage: SetPartition([[1],[2],[3]]) < SetPartition([[1,3],[2]])
True
sage: SetPartition([[1],[2],[3]]) > SetPartition([[1,3],[2]])
False
```

My guess as to why we're getting different output is a failure in the comparisons (I didn't see any tickets that seemed like would change the output of `linear_comb()`). Try running:

```
sage: e = SymmetricFunctionsNonCommutingVariables(QQ).e()
sage: e.print_options()
{'bracket': False,
 'latex_bracket': False,
 'latex_prefix': None,
 'latex_scalar_mult': None,
 'monomial_cmp': <function cmp>,
 'prefix': 'e',
 'scalar_mult': '*',
 'tensor_symbol': None}
sage: cmp(SetPartition([[1],[2],[3]]), SetPartition([[1,3],[2]]))
-1
sage: elt = 2*e[[1],[2],[3]] - e[[1,3],[2]]
sage: L = elt._monomial_coefficients.items()
sage: L.sort(cmp=cmp, key=lambda (x,y): x)
sage: L
[({{1, 3}, {2}}, -1), ({{1}, {2}, {3}}, 2)]
```
Do you get anything different, in particular the last one?



---

archive/issue_comments_190164.json:
```json
{
    "body": "I do get something different, but all of the comparisons are the same.  For the last one I get:\n`[({{1}, {2}, {3}}, 2), ({{1, 3}, {2}}, -1)]`\n\nAny idea why?",
    "created_at": "2013-09-13T19:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190164",
    "user": "https://github.com/zabrocki"
}
```

I do get something different, but all of the comparisons are the same.  For the last one I get:
`[({{1}, {2}, {3}}, 2), ({{1, 3}, {2}}, -1)]`

Any idea why?



---

archive/issue_comments_190165.json:
```json
{
    "body": "This is why:\n\n```\nsage: A = SetPartition([[1],[2],[3]])\nsage: B = SetPartition([[1,3],[2]])\nsage: cmp(A, B)\n-1\nsage: cmp(B, A)\n-1\n```\nThe `cmp` is not correctly using the rich comparisons because `ClonableArray` has (in effect) a `__cmp__` function which calls the underlying list (which contains `Set` objects which don't compare as intended)...\n\nI'm fixing this right now.",
    "created_at": "2013-09-13T19:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190165",
    "user": "https://github.com/tscrim"
}
```

This is why:

```
sage: A = SetPartition([[1],[2],[3]])
sage: B = SetPartition([[1,3],[2]])
sage: cmp(A, B)
-1
sage: cmp(B, A)
-1
```
The `cmp` is not correctly using the rich comparisons because `ClonableArray` has (in effect) a `__cmp__` function which calls the underlying list (which contains `Set` objects which don't compare as intended)...

I'm fixing this right now.



---

archive/issue_comments_190166.json:
```json
{
    "body": "Okay, now it should be consistent.\n\n```\nsage: A = SetPartition([[1],[2],[3]])\nsage: B = SetPartition([[1,3],[2]])\nsage: cmp(A, B)\n-1\nsage: cmp(B, A)\n1\n```\n\nI added a `__cmp__()` method to `SetPartition` to override the behavior of `ClonableArray`.",
    "created_at": "2013-09-13T19:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190166",
    "user": "https://github.com/tscrim"
}
```

Okay, now it should be consistent.

```
sage: A = SetPartition([[1],[2],[3]])
sage: B = SetPartition([[1,3],[2]])
sage: cmp(A, B)
-1
sage: cmp(B, A)
1
```

I added a `__cmp__()` method to `SetPartition` to override the behavior of `ClonableArray`.



---

archive/issue_comments_190167.json:
```json
{
    "body": "Attachment [trac_15150_product_on_basis_q-mz.patch](tarball://root/attachments/some-uuid/ticket15150/trac_15150_product_on_basis_q-mz.patch) by @zabrocki created at 2013-09-15 04:31:51\n\nOK. Thanks for fixing that.  I'm looking over the patch and I have some initial changes where the multiplication uses the pipe function and the product is implemented in the `q` basis.\n\nThe change of basis from `q` to `x` or vice versa is slow and so ideally I would like to improve this.\n\nI think that line 180 from `ncsym.py` is wrong.  There should be no morphism from NCSym to Sym, but there is a projection.  There is however a morphism from DNCSym to Sym.\n\nDNCSym is similar to quasi-symmetric functions so that if you add the right elements together (say some linear combination of the `w` basis) then you have an element of Sym.",
    "created_at": "2013-09-15T04:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190167",
    "user": "https://github.com/zabrocki"
}
```

Attachment [trac_15150_product_on_basis_q-mz.patch](tarball://root/attachments/some-uuid/ticket15150/trac_15150_product_on_basis_q-mz.patch) by @zabrocki created at 2013-09-15 04:31:51

OK. Thanks for fixing that.  I'm looking over the patch and I have some initial changes where the multiplication uses the pipe function and the product is implemented in the `q` basis.

The change of basis from `q` to `x` or vice versa is slow and so ideally I would like to improve this.

I think that line 180 from `ncsym.py` is wrong.  There should be no morphism from NCSym to Sym, but there is a projection.  There is however a morphism from DNCSym to Sym.

DNCSym is similar to quasi-symmetric functions so that if you add the right elements together (say some linear combination of the `w` basis) then you have an element of Sym.



---

archive/issue_comments_190168.json:
```json
{
    "body": "Another thing that was bothering me was that `x[[1,2],[3]]` is ok, but `x([[1,2],[3]])` is not.  Both should be ok.  I think that this should be an easy fix.",
    "created_at": "2013-09-15T04:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190168",
    "user": "https://github.com/zabrocki"
}
```

Another thing that was bothering me was that `x[[1,2],[3]]` is ok, but `x([[1,2],[3]])` is not.  Both should be ok.  I think that this should be an easy fix.



---

archive/issue_comments_190169.json:
```json
{
    "body": "Some random comments on ncsym.py.\n\n```\n    The ring of symmetric functions in non-commutative variables,\n    which is not to be confused with the :class:`non-commutative symmetric\n    functions<NonCommutativeSymmetricFunctions>`, are polynomials in `n`\n    non-commuting variables `{\\bf k}[x_1, x_2, \\ldots, x_n]` where the\n    dimension of the subspace of elements of degree `k` is equal to\n    the number of compositions of `k` (with less than `n` parts).\n```\nIf the variables are non-commuting, use angular rather than square brackets. Also, I assume you want infinitely many variables? And do you really want compositions?\n\nTypo:\n\n```\nGrothendeick\n```\n\nOld-style arXiv references like this:\n\n```\n:arxiv:`0208168`\n```\nshould have a \"math/\" in front of them, I believe (also, I'd add a version number, in this case math/0208168v2).\n\nWhat is the \\wedge operation on set partitions? It is used but not defined. If it's the one from the Bergeron-Zabrocki paper, it is simply the meet of set partitions (aka `__mul__`) and should be explained as such.\n\nOn the right hand side of\n\n```\n                S(\\mathbf{p}_A) = \\sum_{\\gamma} (-1)^{\\ell(\\gamma)} \\gamma[A]\n```\ndon't you mean to say ` p_{\\gamma[A]} ` rather than ` \\gamma[A] ` ? And on the next line, do you mean to say `of `[\\ell(A)]`` instead of `of length `\\ell(A)``?\n\nSimilarly here:\n\n```\n                p(A) = \\sum_{\\gamma} (-1)^{\\ell(\\gamma)-1} \\gamma[A]\n```\n\nI assume that \"strictly coarser\" in\n\n```\n        where we sum over all strictly coarser set partitions `B`.\n```\nrefers to the relation of strict coarsening as defined in `set_partition.py`. If so, please say this explicitly, as the notation is slightly counterintuitive (one normally thinks \"strictly coarser\" means \"coarser and not equal\").\n\nI'll eventually have a closer look at the patch if only to understand how exactly internal-coproduct-by-coercion works (for use in NSym); I cannot promise that I will ever give this an actual review. Nevertheless, great work here, Travis.",
    "created_at": "2013-09-16T04:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190169",
    "user": "https://github.com/darijgr"
}
```

Some random comments on ncsym.py.

```
    The ring of symmetric functions in non-commutative variables,
    which is not to be confused with the :class:`non-commutative symmetric
    functions<NonCommutativeSymmetricFunctions>`, are polynomials in `n`
    non-commuting variables `{\bf k}[x_1, x_2, \ldots, x_n]` where the
    dimension of the subspace of elements of degree `k` is equal to
    the number of compositions of `k` (with less than `n` parts).
```
If the variables are non-commuting, use angular rather than square brackets. Also, I assume you want infinitely many variables? And do you really want compositions?

Typo:

```
Grothendeick
```

Old-style arXiv references like this:

```
:arxiv:`0208168`
```
should have a "math/" in front of them, I believe (also, I'd add a version number, in this case math/0208168v2).

What is the \wedge operation on set partitions? It is used but not defined. If it's the one from the Bergeron-Zabrocki paper, it is simply the meet of set partitions (aka `__mul__`) and should be explained as such.

On the right hand side of

```
                S(\mathbf{p}_A) = \sum_{\gamma} (-1)^{\ell(\gamma)} \gamma[A]
```
don't you mean to say ` p_{\gamma[A]} ` rather than ` \gamma[A] ` ? And on the next line, do you mean to say `of `[\ell(A)]`` instead of `of length `\ell(A)``?

Similarly here:

```
                p(A) = \sum_{\gamma} (-1)^{\ell(\gamma)-1} \gamma[A]
```

I assume that "strictly coarser" in

```
        where we sum over all strictly coarser set partitions `B`.
```
refers to the relation of strict coarsening as defined in `set_partition.py`. If so, please say this explicitly, as the notation is slightly counterintuitive (one normally thinks "strictly coarser" means "coarser and not equal").

I'll eventually have a closer look at the patch if only to understand how exactly internal-coproduct-by-coercion works (for use in NSym); I cannot promise that I will ever give this an actual review. Nevertheless, great work here, Travis.



---

archive/issue_comments_190170.json:
```json
{
    "body": "Here's the new version of the patch which (hopefully) takes care of all of Darij's comments. How the `internal_coproduct*` works is a trick with `lazy_attribute` which `*_by_coercion()` creates the correct morphism object if `*_on_basis()` is not implemented and so it behaves like a method.\n\nI've removed the coercion from `NCSym` to `Sym` since it is not a Hopf morphism, which is a requirement for it to be a coercion. I've fixed the input to accept `x([[1,3],[2]])` as well.\n\nCurrently to get from `x` to `q` (or vice versa) there's a few coercions going on, and I don't know of a way to go between them directly. (Data suggests that `x(q[A])` is a sum over some subset of set partitions with all coefficients occurring (-1)<sup>nest(A)</sup>.)\n\nFor `DNCSym`, is there a way to express an element in the **w** basis as a polynomial? Currently I have a map from `Sym` to `DNCSym` which is at least (appears to me to be) an algebra morphism (see the `sum_of_partitions()` method). Is this a Hopf morphism and is the map from `DNCSym` to `Sym` the inverse of this map?\n\nThank you all for looking at this patch,\n\nTravis\n\nEdit - let's see if the patchbot catches it in an edited message:\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch\u200b",
    "created_at": "2013-09-17T03:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190170",
    "user": "https://github.com/tscrim"
}
```

Here's the new version of the patch which (hopefully) takes care of all of Darij's comments. How the `internal_coproduct*` works is a trick with `lazy_attribute` which `*_by_coercion()` creates the correct morphism object if `*_on_basis()` is not implemented and so it behaves like a method.

I've removed the coercion from `NCSym` to `Sym` since it is not a Hopf morphism, which is a requirement for it to be a coercion. I've fixed the input to accept `x([[1,3],[2]])` as well.

Currently to get from `x` to `q` (or vice versa) there's a few coercions going on, and I don't know of a way to go between them directly. (Data suggests that `x(q[A])` is a sum over some subset of set partitions with all coefficients occurring (-1)<sup>nest(A)</sup>.)

For `DNCSym`, is there a way to express an element in the **w** basis as a polynomial? Currently I have a map from `Sym` to `DNCSym` which is at least (appears to me to be) an algebra morphism (see the `sum_of_partitions()` method). Is this a Hopf morphism and is the map from `DNCSym` to `Sym` the inverse of this map?

Thank you all for looking at this patch,

Travis

Edit - let's see if the patchbot catches it in an edited message:

For patchbot:

Apply: trac_15150-ncsym-ts.patch​



---

archive/issue_comments_190171.json:
```json
{
    "body": "Hi Travis,\nIs it possible that this is the same patch as before?",
    "created_at": "2013-09-19T13:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190171",
    "user": "https://github.com/zabrocki"
}
```

Hi Travis,
Is it possible that this is the same patch as before?



---

archive/issue_comments_190172.json:
```json
{
    "body": "I think I uploaded the patch from my beta3 install instead of my beta5. Sorry about that. Here's the new one.\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch\u200b",
    "created_at": "2013-09-19T14:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190172",
    "user": "https://github.com/tscrim"
}
```

I think I uploaded the patch from my beta3 install instead of my beta5. Sorry about that. Here's the new one.

For patchbot:

Apply: trac_15150-ncsym-ts.patch​



---

archive/issue_comments_190173.json:
```json
{
    "body": "So about your question if `DNCSym` can be realized in the polynomial algebra.  The answer is 'probably' but no one has ever done this.  Maybe you can make a guess at the realization by what I will write.  I will guess that the dual to the complete basis is some sort of monomial basis (the `w` basis is the dual to the `m` basis).\n\nThe morphism from `DNCSym` into `Sym` is 'the coefficient of `w_A` in `h_\\lambda` is equal to the coefficient of `m_\\lambda` in `chi(m_A)`.'  Therefore,\n\n```\n\\sum_{A} A^{!} w_A = h_\\lambda\n```\nwhere the sum is over `A` with set partitions with part lengths a partition `\\lambda` and the `A^{!}` notation is from Rosas / Sagan p. 4.",
    "created_at": "2013-09-19T14:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190173",
    "user": "https://github.com/zabrocki"
}
```

So about your question if `DNCSym` can be realized in the polynomial algebra.  The answer is 'probably' but no one has ever done this.  Maybe you can make a guess at the realization by what I will write.  I will guess that the dual to the complete basis is some sort of monomial basis (the `w` basis is the dual to the `m` basis).

The morphism from `DNCSym` into `Sym` is 'the coefficient of `w_A` in `h_\lambda` is equal to the coefficient of `m_\lambda` in `chi(m_A)`.'  Therefore,

```
\sum_{A} A^{!} w_A = h_\lambda
```
where the sum is over `A` with set partitions with part lengths a partition `\lambda` and the `A^{!}` notation is from Rosas / Sagan p. 4.



---

archive/issue_comments_190174.json:
```json
{
    "body": "Replying to [comment:23 zabrocki]:\n> So about your question if `DNCSym` can be realized in the polynomial algebra.  The answer is 'probably' but no one has ever done this.  Maybe you can make a guess at the realization by what I will write.  I will guess that the dual to the complete basis is some sort of monomial basis (the `w` basis is the dual to the `m` basis).\n> \n> The morphism from `DNCSym` into `Sym` is 'the coefficient of `w_A` in `h_\\lambda` is equal to the coefficient of `m_\\lambda` in `chi(m_A)`.'  Therefore,\n> \n> \n> ```\n> \\sum_{A} A^{!} w_A = h_\\lambda\n> ```\n> where the sum is over `A` with set partitions with part lengths a partition `\\lambda` and the `A^{!}` notation is from Rosas / Sagan p. 4.\n\n\nOkay, this is describing the image of the map I currently have implemented:\n\n```\nsage: h = SymmetricFunctions(QQ).h()\nsage: w = SymmetricFunctionsNonCommutingVariables(QQ).dual().w()\nsage: w(h[2,1,1])\n2*w{{1}, {2}, {3, 4}} + 2*w{{1}, {2, 3}, {4}} + 2*w{{1}, {2, 4}, {3}}\n + 2*w{{1, 2}, {3}, {4}} + 2*w{{1, 3}, {2}, {4}} + 2*w{{1, 4}, {2}, {3}}\n```\nThis map is respecting the multiplication\n\n```\nsage: w[[1,2]] * w[[1]] * w[[1]]\n2*w{{1}, {2}, {3, 4}} + 2*w{{1}, {2, 3}, {4}} + 2*w{{1}, {2, 4}, {3}}\n + 2*w{{1, 2}, {3}, {4}} + 2*w{{1, 3}, {2}, {4}} + 2*w{{1, 4}, {2}, {3}}\n```\nso we can at least get `w[This is the Trac macro *1,2,...,n* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,2,...,n-macro) = h[n]` as the correct expansion. However this does not seem straightforward to me in general as we have\n\n```\nsage: h[2,1,1].expand(2)\nx0^4 + 3*x0^3*x1 + 4*x0^2*x1^2 + 3*x0*x1^3 + x1^4\n```\nIf it does work, it probably uses crossings and/or nestings, but I don't see it.\n\nAnyways, do you think I should add a method `is_symmetric_function()` and/or `to_symmetric_function()` for the dual bases?\n\nAlso I found a bug with the expansion, in that `SetPartition` was not always living in the correct parent when taking `inf` or `sup`. I also added `to_symmetric_function` for the **e**, **h**, and **p** `NCSym` basis to return the correct object in the e, h, and p `Sym` basis resp.\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch\u200b",
    "created_at": "2013-09-19T16:19:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190174",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:23 zabrocki]:
> So about your question if `DNCSym` can be realized in the polynomial algebra.  The answer is 'probably' but no one has ever done this.  Maybe you can make a guess at the realization by what I will write.  I will guess that the dual to the complete basis is some sort of monomial basis (the `w` basis is the dual to the `m` basis).
> 
> The morphism from `DNCSym` into `Sym` is 'the coefficient of `w_A` in `h_\lambda` is equal to the coefficient of `m_\lambda` in `chi(m_A)`.'  Therefore,
> 
> 
> ```
> \sum_{A} A^{!} w_A = h_\lambda
> ```
> where the sum is over `A` with set partitions with part lengths a partition `\lambda` and the `A^{!}` notation is from Rosas / Sagan p. 4.


Okay, this is describing the image of the map I currently have implemented:

```
sage: h = SymmetricFunctions(QQ).h()
sage: w = SymmetricFunctionsNonCommutingVariables(QQ).dual().w()
sage: w(h[2,1,1])
2*w{{1}, {2}, {3, 4}} + 2*w{{1}, {2, 3}, {4}} + 2*w{{1}, {2, 4}, {3}}
 + 2*w{{1, 2}, {3}, {4}} + 2*w{{1, 3}, {2}, {4}} + 2*w{{1, 4}, {2}, {3}}
```
This map is respecting the multiplication

```
sage: w[[1,2]] * w[[1]] * w[[1]]
2*w{{1}, {2}, {3, 4}} + 2*w{{1}, {2, 3}, {4}} + 2*w{{1}, {2, 4}, {3}}
 + 2*w{{1, 2}, {3}, {4}} + 2*w{{1, 3}, {2}, {4}} + 2*w{{1, 4}, {2}, {3}}
```
so we can at least get `w[This is the Trac macro *1,2,...,n* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,2,...,n-macro) = h[n]` as the correct expansion. However this does not seem straightforward to me in general as we have

```
sage: h[2,1,1].expand(2)
x0^4 + 3*x0^3*x1 + 4*x0^2*x1^2 + 3*x0*x1^3 + x1^4
```
If it does work, it probably uses crossings and/or nestings, but I don't see it.

Anyways, do you think I should add a method `is_symmetric_function()` and/or `to_symmetric_function()` for the dual bases?

Also I found a bug with the expansion, in that `SetPartition` was not always living in the correct parent when taking `inf` or `sup`. I also added `to_symmetric_function` for the **e**, **h**, and **p** `NCSym` basis to return the correct object in the e, h, and p `Sym` basis resp.

For patchbot:

Apply: trac_15150-ncsym-ts.patch​



---

archive/issue_comments_190175.json:
```json
{
    "body": "You are right that the polynomial realization of the `w` basis may not be obvious.  I suspect that you will have a better hope of guessing at what the polynomial realization is by looking at the dual of the **h** basis.\n\nI think that there should be a method for `is_symmetric_function()` for the bases of `DNCSym`.  I don't think that `to_symmetric_function()` makes sense in that space.",
    "created_at": "2013-09-19T21:45:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190175",
    "user": "https://github.com/zabrocki"
}
```

You are right that the polynomial realization of the `w` basis may not be obvious.  I suspect that you will have a better hope of guessing at what the polynomial realization is by looking at the dual of the **h** basis.

I think that there should be a method for `is_symmetric_function()` for the bases of `DNCSym`.  I don't think that `to_symmetric_function()` makes sense in that space.



---

archive/issue_comments_190176.json:
```json
{
    "body": "for the **patchbots**:\n\napply only trac_15150-ncsym-ts.patch\u200b",
    "created_at": "2013-09-20T18:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190176",
    "user": "https://github.com/fchapoton"
}
```

for the **patchbots**:

apply only trac_15150-ncsym-ts.patch​



---

archive/issue_comments_190177.json:
```json
{
    "body": "for the **patchbots**:\n\napply only trac_15150-ncsym-ts.patch\u200b",
    "created_at": "2013-09-20T19:05:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190177",
    "user": "https://github.com/fchapoton"
}
```

for the **patchbots**:

apply only trac_15150-ncsym-ts.patch​



---

archive/issue_comments_190178.json:
```json
{
    "body": "Patchbots are dummy ?\n\napply trac_15150-ncsym-ts.patch",
    "created_at": "2013-09-20T19:06:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190178",
    "user": "https://github.com/fchapoton"
}
```

Patchbots are dummy ?

apply trac_15150-ncsym-ts.patch



---

archive/issue_comments_190179.json:
```json
{
    "body": "\"Also I found a bug with the expansion, in that SetPartition was not always living in the correct parent when taking inf or sup.\"\n\nHow that?\n\n```\nsage: P = SetPartition([[3,1],[2]])\nsage: parent(P)\nSet partitions\nsage: Q = SetPartition([[1,2],[3]])\nsage: Q.inf(P)\n{{1}, {2}, {3}}\nsage: parent(Q.inf(P))\nSet partitions\nsage: parent(Q.sup(P))\nSet partitions\nsage: P = SetPartitions(3)(P)\nsage: P\n{{1, 3}, {2}}\nsage: parent(P)\nSet partitions of {1, 2, 3}\nsage: Q = SetPartitions(3)(Q)\nsage: parent(Q)\nSet partitions of {1, 2, 3}\nsage: P.inf(Q)\n{{1}, {2}, {3}}\nsage: parent(P.inf(Q))\nSet partitions of {1, 2, 3}\nsage: parent(P.sup(Q))\nSet partitions of {1, 2, 3}\n```",
    "created_at": "2013-09-20T19:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190179",
    "user": "https://github.com/darijgr"
}
```

"Also I found a bug with the expansion, in that SetPartition was not always living in the correct parent when taking inf or sup."

How that?

```
sage: P = SetPartition([[3,1],[2]])
sage: parent(P)
Set partitions
sage: Q = SetPartition([[1,2],[3]])
sage: Q.inf(P)
{{1}, {2}, {3}}
sage: parent(Q.inf(P))
Set partitions
sage: parent(Q.sup(P))
Set partitions
sage: P = SetPartitions(3)(P)
sage: P
{{1, 3}, {2}}
sage: parent(P)
Set partitions of {1, 2, 3}
sage: Q = SetPartitions(3)(Q)
sage: parent(Q)
Set partitions of {1, 2, 3}
sage: P.inf(Q)
{{1}, {2}, {3}}
sage: parent(P.inf(Q))
Set partitions of {1, 2, 3}
sage: parent(P.sup(Q))
Set partitions of {1, 2, 3}
```



---

archive/issue_comments_190180.json:
```json
{
    "body": "Try it with `SetPartitions(3, [2,1,1])`.",
    "created_at": "2013-09-20T20:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190180",
    "user": "https://github.com/tscrim"
}
```

Try it with `SetPartitions(3, [2,1,1])`.



---

archive/issue_comments_190181.json:
```json
{
    "body": "Oh, that's ugly (although I hope you mean `SetPartitions(4, [2,1,1])`. I'm wondering if we need a parent for set partitions with given type at all? I can think of very few maps which preserve the type, and it's not just inf and sup that fail:\n\n```\nsage: P = SetPartitions(4, [2,1,1])\nsage: x = P[0]\nsage: x.coarsenings()\n[...]\nAssertionError: \nsage: x.refinements()\n[...]\nAssertionError: \n```",
    "created_at": "2013-09-20T20:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190181",
    "user": "https://github.com/darijgr"
}
```

Oh, that's ugly (although I hope you mean `SetPartitions(4, [2,1,1])`. I'm wondering if we need a parent for set partitions with given type at all? I can think of very few maps which preserve the type, and it's not just inf and sup that fail:

```
sage: P = SetPartitions(4, [2,1,1])
sage: x = P[0]
sage: x.coarsenings()
[...]
AssertionError: 
sage: x.refinements()
[...]
AssertionError: 
```



---

archive/issue_comments_190182.json:
```json
{
    "body": "This thing actually happens not only with set partitions. Any idea on how to avoid it on a bigger scale?\n\n```\nsage: P = Permutations(recoils=[2,3])\nsage: u = P[1]\nsage: u.complement()\n[5, 3, 2, 4, 1]\nsage: parent(u.complement())\nStandard permutations whose recoils composition is [2, 3]\n```\n\nThe only reason why this doesn't blow up is that the class of permutations whose recoils composition is a given composition is liberal to invalid input.\n\nSimilarly:\n\n```\nsage: P = Permutations(5, avoiding=[1,2,3])\nsage: parent(P[25].complement())\nStandard permutations of 5 avoiding [1, 2, 3]\nsage: P[25].complement()\n[3, 1, 4, 2, 5]\n```",
    "created_at": "2013-09-20T20:33:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190182",
    "user": "https://github.com/darijgr"
}
```

This thing actually happens not only with set partitions. Any idea on how to avoid it on a bigger scale?

```
sage: P = Permutations(recoils=[2,3])
sage: u = P[1]
sage: u.complement()
[5, 3, 2, 4, 1]
sage: parent(u.complement())
Standard permutations whose recoils composition is [2, 3]
```

The only reason why this doesn't blow up is that the class of permutations whose recoils composition is a given composition is liberal to invalid input.

Similarly:

```
sage: P = Permutations(5, avoiding=[1,2,3])
sage: parent(P[25].complement())
Standard permutations of 5 avoiding [1, 2, 3]
sage: P[25].complement()
[3, 1, 4, 2, 5]
```



---

archive/issue_comments_190183.json:
```json
{
    "body": "Ah, yes I did. I'd want the parent so as to provide an object to iterate over set partitions with a given shape. I thought I also fixed the `coarsenings` and `refinements` in this patch as well.\n\nFlorent was working on a related issue to this in the set factories ticket #10194 and we could tweak the concept to fix this by saying that it's parents must not contain certain conditions. As a current work around, we'd have to revert to a general parent on any method that does not preserve all conditions. I'm worried that this might end up having repercussions in other parts of Sage (mainly symmetric functions).",
    "created_at": "2013-09-20T20:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190183",
    "user": "https://github.com/tscrim"
}
```

Ah, yes I did. I'd want the parent so as to provide an object to iterate over set partitions with a given shape. I thought I also fixed the `coarsenings` and `refinements` in this patch as well.

Florent was working on a related issue to this in the set factories ticket #10194 and we could tweak the concept to fix this by saying that it's parents must not contain certain conditions. As a current work around, we'd have to revert to a general parent on any method that does not preserve all conditions. I'm worried that this might end up having repercussions in other parts of Sage (mainly symmetric functions).



---

archive/issue_comments_190184.json:
```json
{
    "body": "Similarly:\n\n```\nsage: C = Compositions(6, inner=[2,2])\nsage: c1 = C[1]\nsage: c1\n[3, 3]\nsage: c1.conjugate()\n[1, 1, 2, 1, 1]\nsage: parent(c1.conjugate())\nCompositions of the integer 6 satisfying constraints inner=[2, 2]\nsage: c1.conjugate() in parent(c1.conjugate())\nFalse\n```\n\nLack of input checking again saves this.",
    "created_at": "2013-09-20T20:43:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190184",
    "user": "https://github.com/darijgr"
}
```

Similarly:

```
sage: C = Compositions(6, inner=[2,2])
sage: c1 = C[1]
sage: c1
[3, 3]
sage: c1.conjugate()
[1, 1, 2, 1, 1]
sage: parent(c1.conjugate())
Compositions of the integer 6 satisfying constraints inner=[2, 2]
sage: c1.conjugate() in parent(c1.conjugate())
False
```

Lack of input checking again saves this.



---

archive/issue_comments_190185.json:
```json
{
    "body": "Hey Mike,\n\nI've added an `is_symmetric()` method to the **w** basis.\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-09-21T06:02:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190185",
    "user": "https://github.com/tscrim"
}
```

Hey Mike,

I've added an `is_symmetric()` method to the **w** basis.

For patchbot:

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_comments_190186.json:
```json
{
    "body": "many failing doctests",
    "created_at": "2013-09-22T15:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190186",
    "user": "https://github.com/fchapoton"
}
```

many failing doctests



---

archive/issue_comments_190187.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-09-22T15:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190187",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_190188.json:
```json
{
    "body": "Now with fixed doctests.",
    "created_at": "2013-09-22T19:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190188",
    "user": "https://github.com/tscrim"
}
```

Now with fixed doctests.



---

archive/issue_comments_190189.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-09-22T19:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190189",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_190190.json:
```json
{
    "body": "Hi Travis,\nSo far I am focusing in on pieces of functionality.  It doesn't quite seem to work as I expect.  The doc string `w.sum_of_partitions?` does not seem to agree with what it does since it is actually a sum with coefficients.\n\nI was trying to figure out how to coerce `f=w[[1,2],[3]]+w[[1,3],[2]]+w[[2,3],[1]]` to the h-basis and I don't see a doc-string and what I tried doesn't seem to work anyway.  `DNCSym.to_symmetric_function?` gives an error and when I try either `h(f)` or `DNCSym.to_symmetric_function(f)`, both give the same error:\n\n```\n\nTypeError                                 Traceback (most recent call last)\n<ipython-input-34-98785946d5a3> in <module>()\n----> 1 DNCSym.to_symmetric_function(f)\n\n/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/categories/map.so in sage.categories.map.Map.__call__ (sage/categories/map.c:4018)()\n\n/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/categories/morphism.so in sage.categories.morphism.SetMorphism._call_ (sage/categories/morphism.c:4837)()\n\n/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/categories/modules_with_basis.pyc in preimage(self, f)\n   1711                 j_preimage = j\n   1712             else:\n-> 1713                 j_preimage = self._inverse_on_support(j)\n   1714                 if j_preimage is None:\n   1715                     raise ValueError, \"%s is not in the image of %s\"%(f, self)\n\n/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/ncsym/dual.pyc in _par_to_set_par(self, la)\n    287             ret = []\n    288             for i in sorted(la):\n--> 289                 ret += [range(cur, cur+i)]\n    290                 cur += i\n    291             return SetPartitions()(ret)\n\nTypeError: unsupported operand type(s) for +: 'int' and 'Set_object_enumerated_with_category'\n```\n\nWhat should I do in order to send my element `f` into the symmetric functions?",
    "created_at": "2013-09-22T22:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190190",
    "user": "https://github.com/zabrocki"
}
```

Hi Travis,
So far I am focusing in on pieces of functionality.  It doesn't quite seem to work as I expect.  The doc string `w.sum_of_partitions?` does not seem to agree with what it does since it is actually a sum with coefficients.

I was trying to figure out how to coerce `f=w[[1,2],[3]]+w[[1,3],[2]]+w[[2,3],[1]]` to the h-basis and I don't see a doc-string and what I tried doesn't seem to work anyway.  `DNCSym.to_symmetric_function?` gives an error and when I try either `h(f)` or `DNCSym.to_symmetric_function(f)`, both give the same error:

```

TypeError                                 Traceback (most recent call last)
<ipython-input-34-98785946d5a3> in <module>()
----> 1 DNCSym.to_symmetric_function(f)

/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/categories/map.so in sage.categories.map.Map.__call__ (sage/categories/map.c:4018)()

/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/categories/morphism.so in sage.categories.morphism.SetMorphism._call_ (sage/categories/morphism.c:4837)()

/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/categories/modules_with_basis.pyc in preimage(self, f)
   1711                 j_preimage = j
   1712             else:
-> 1713                 j_preimage = self._inverse_on_support(j)
   1714                 if j_preimage is None:
   1715                     raise ValueError, "%s is not in the image of %s"%(f, self)

/Applications/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/ncsym/dual.pyc in _par_to_set_par(self, la)
    287             ret = []
    288             for i in sorted(la):
--> 289                 ret += [range(cur, cur+i)]
    290                 cur += i
    291             return SetPartitions()(ret)

TypeError: unsupported operand type(s) for +: 'int' and 'Set_object_enumerated_with_category'
```

What should I do in order to send my element `f` into the symmetric functions?



---

archive/issue_comments_190191.json:
```json
{
    "body": "Hey Mike,\n\nYou use the new version of the patch which corrects all of the above. I also added a method `to_symmetric_function()` to the `w` basis and, to be consistent with `QSym`, to its elements. Just let me know everything you'd want to see this patch do.\n\nBest,\n\nTravis\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-09-23T02:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190191",
    "user": "https://github.com/tscrim"
}
```

Hey Mike,

You use the new version of the patch which corrects all of the above. I also added a method `to_symmetric_function()` to the `w` basis and, to be consistent with `QSym`, to its elements. Just let me know everything you'd want to see this patch do.

Best,

Travis

For patchbot:

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_comments_190192.json:
```json
{
    "body": "Overall the functionality looks good.  You covered a lot of ground for a first implementation.  I don't think I will suggest other functionality, but I will check the ones you have.\n\nWhat I can see of the map from  Sym -> NCSym* seems to work well.\n\nHow come you import `SymmetricFunctionsNonCommutingVariables` into the namespace, but not the dual?  It seems as though we can only access it through `NCSym.dual()`.  Is it because there is no name for the dual space?  Actually it is called \u03a0QSym in \"Commutative Combinatorial Hopf Algebras\" `http://arxiv.org/abs/math/0605262`.  I think that we can do better than \u03a0QSym for a name.  This reference seems to realize this space in the ring of polynomials (see equations (23) and (55) for this realization), but not clearly where Sym is a subalgebra.",
    "created_at": "2013-09-23T04:08:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190192",
    "user": "https://github.com/zabrocki"
}
```

Overall the functionality looks good.  You covered a lot of ground for a first implementation.  I don't think I will suggest other functionality, but I will check the ones you have.

What I can see of the map from  Sym -> NCSym* seems to work well.

How come you import `SymmetricFunctionsNonCommutingVariables` into the namespace, but not the dual?  It seems as though we can only access it through `NCSym.dual()`.  Is it because there is no name for the dual space?  Actually it is called ΠQSym in "Commutative Combinatorial Hopf Algebras" `http://arxiv.org/abs/math/0605262`.  I think that we can do better than ΠQSym for a name.  This reference seems to realize this space in the ring of polynomials (see equations (23) and (55) for this realization), but not clearly where Sym is a subalgebra.



---

archive/issue_comments_190193.json:
```json
{
    "body": "Sorry, but what does this mean:\n\n```\n \t496\t            def to_ncsym_on_basis(self, I): \n \t497\t                r\"\"\" \n \t498\t                The image of the basis element indexed by ``I`` under the \n \t499\t                map to the symmetric functions in non-commuting \n \t500\t                variables that fixes the usual symmetric functions. \n```\n\nHow can a map from NSym to something fix the usual symmetric functions if the latter aren't a subspace of NSym? (Same question for both `to_ncsym` methods.)\n\nOooh, I think you mean \"commutes with the projection onto the usual symmetric functions\". Maybe clarify this?",
    "created_at": "2013-09-23T15:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190193",
    "user": "https://github.com/darijgr"
}
```

Sorry, but what does this mean:

```
 	496	            def to_ncsym_on_basis(self, I): 
 	497	                r""" 
 	498	                The image of the basis element indexed by ``I`` under the 
 	499	                map to the symmetric functions in non-commuting 
 	500	                variables that fixes the usual symmetric functions. 
```

How can a map from NSym to something fix the usual symmetric functions if the latter aren't a subspace of NSym? (Same question for both `to_ncsym` methods.)

Oooh, I think you mean "commutes with the projection onto the usual symmetric functions". Maybe clarify this?



---

archive/issue_comments_190194.json:
```json
{
    "body": "Hey Mike,\n\nThe biggest thing why it's not imported is the name, I didn't think just calling it `DualSymmetricFunctionsNonCommutingVariables` was more descriptive than calling `SymmetricFunctionsNonCommutingVariables(QQ).dual()` (and it's not much shorter to call). I'm not 100% happy with the name (being the global namespace) since I seem to want to attach dual to function, as in the dual symmetric functions (as in linear functionals) in non-commuting variables. I know it doesn't make much sense, but it sounded more descriptive than `SymmetricFunctionsNonCommutingVariablesDual`. I'll import `Dual*` in the next version unless we come up with a better name. I can't think of one right now... Franco, you have any ideas as well?\n\nI'll use http://arxiv.org/abs/math/0605262 to give a realization and also define a coercion from `QSym` into `DNCSym`.\n\nHey Darij,\n\nYes, up to abuse of labels on commutative diagrams. I'll change it to explicitly state that ``\\chi \\circ p = \\phi` on Sym` (up to function names).\n\nBest,\n\nTravis",
    "created_at": "2013-09-24T21:21:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190194",
    "user": "https://github.com/tscrim"
}
```

Hey Mike,

The biggest thing why it's not imported is the name, I didn't think just calling it `DualSymmetricFunctionsNonCommutingVariables` was more descriptive than calling `SymmetricFunctionsNonCommutingVariables(QQ).dual()` (and it's not much shorter to call). I'm not 100% happy with the name (being the global namespace) since I seem to want to attach dual to function, as in the dual symmetric functions (as in linear functionals) in non-commuting variables. I know it doesn't make much sense, but it sounded more descriptive than `SymmetricFunctionsNonCommutingVariablesDual`. I'll import `Dual*` in the next version unless we come up with a better name. I can't think of one right now... Franco, you have any ideas as well?

I'll use http://arxiv.org/abs/math/0605262 to give a realization and also define a coercion from `QSym` into `DNCSym`.

Hey Darij,

Yes, up to abuse of labels on commutative diagrams. I'll change it to explicitly state that ``\chi \circ p = \phi` on Sym` (up to function names).

Best,

Travis



---

archive/issue_comments_190195.json:
```json
{
    "body": "not a review but a few improvement suggestions (docstrings mostly)",
    "created_at": "2013-09-29T06:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190195",
    "user": "https://github.com/darijgr"
}
```

not a review but a few improvement suggestions (docstrings mostly)



---

archive/issue_comments_190196.json:
```json
{
    "body": "Attachment [trac_15150-docs-dg.patch](tarball://root/attachments/some-uuid/ticket15150/trac_15150-docs-dg.patch) by @tscrim created at 2013-09-30 16:11:40\n\nNew patch that Mike and I have talked about (removes the QSym stuff and the name for the Hopf dual) and with Darij's docstring improvements folded in.\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-09-30T16:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190196",
    "user": "https://github.com/tscrim"
}
```

Attachment [trac_15150-docs-dg.patch](tarball://root/attachments/some-uuid/ticket15150/trac_15150-docs-dg.patch) by @tscrim created at 2013-09-30 16:11:40

New patch that Mike and I have talked about (removes the QSym stuff and the name for the Hopf dual) and with Darij's docstring improvements folded in.

For patchbot:

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_comments_190197.json:
```json
{
    "body": "Should be a one-line edit:\n\n```\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/ncsym.py\", line 248, in sage.combinat.ncsym.ncsym.SymmetricFunctionsNonCommutingVariables.monomial.from_symmetric_function\nFailed example:\n    elt = m.from_symmetric_function(mon[2,1,1]); elt\nException raised:\n    Traceback (most recent call last):\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 479, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 838, in execute\n        exec compiled in globs\n      File \"<doctest sage.combinat.ncsym.ncsym.SymmetricFunctionsNonCommutingVariables.monomial.from_symmetric_function[2]>\", line 1, in <module>\n        elt = m.from_symmetric_function(mon[Integer(2),Integer(1),Integer(1)]); elt\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/ncsym/ncsym.py\", line 255, in from_symmetric_function\n        return self.sum([c * self.sum_of_partitions(i) for i,c in m(f)])\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/ncsym/ncsym.py\", line 471, in sum_of_partitions\n        la = Partition(la) # Make sure it is a partition\n    NameError: global name 'Partition' is not defined\n```",
    "created_at": "2013-10-02T01:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190197",
    "user": "https://github.com/darijgr"
}
```

Should be a one-line edit:

```
**********************************************************************
File "devel/sage/sage/combinat/ncsym/ncsym.py", line 248, in sage.combinat.ncsym.ncsym.SymmetricFunctionsNonCommutingVariables.monomial.from_symmetric_function
Failed example:
    elt = m.from_symmetric_function(mon[2,1,1]); elt
Exception raised:
    Traceback (most recent call last):
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest sage.combinat.ncsym.ncsym.SymmetricFunctionsNonCommutingVariables.monomial.from_symmetric_function[2]>", line 1, in <module>
        elt = m.from_symmetric_function(mon[Integer(2),Integer(1),Integer(1)]); elt
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/ncsym/ncsym.py", line 255, in from_symmetric_function
        return self.sum([c * self.sum_of_partitions(i) for i,c in m(f)])
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/combinat/ncsym/ncsym.py", line 471, in sum_of_partitions
        la = Partition(la) # Make sure it is a partition
    NameError: global name 'Partition' is not defined
```



---

archive/issue_comments_190198.json:
```json
{
    "body": "Whoops. Fixed.\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-10-02T01:51:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190198",
    "user": "https://github.com/tscrim"
}
```

Whoops. Fixed.

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_comments_190199.json:
```json
{
    "body": "Sorry, more stuff coming up (and I can't edit right now since I'm running doctests):\n\n```\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 346, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.expand\nFailed example:\n    w[[1,3],[2]].expand(4)\nExpected:\n    x0*x1*x0 + x0*x2*x0 + x0*x3*x0 + x1*x0*x1 + x1*x2*x1 + x1*x3*x1\n     + x2*x0*x2 + x2*x1*x2 + x2*x3*x2 + x3*x0*x3 + x3*x1*x3 + x3*x2*x3\nGot:\n    x02*x11*x20 + x03*x11*x30 + x03*x22*x30 + x13*x22*x31\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 353, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.expand\nFailed example:\n    w[[1],[2,3]].expand(3, letter='y')\nExpected:\n    y0*y1^2 + y0*y2^2 + y1*y0^2 + y1*y2^2 + y2*y0^2 + y2*y1^2\nGot:\n    y00*y12*y21\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 492, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric\nFailed example:\n    elt = w.sum_of_compositions([2,1,1])\nException raised:\n    Traceback (most recent call last):\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 479, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 838, in execute\n        exec compiled in globs\n      File \"<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric[1]>\", line 1, in <module>\n        elt = w.sum_of_compositions([Integer(2),Integer(1),Integer(1)])\n      File \"parent.pyx\", line 761, in sage.structure.parent.Parent.__getattr__ (sage/structure/parent.c:6823)\n      File \"misc.pyx\", line 251, in sage.structure.misc.getattr_from_other_class (sage/structure/misc.c:1606)\n    AttributeError: 'SymmetricFunctionsNonCommutingVariablesDual.w_with_category' object has no attribute 'sum_of_compositions'\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 493, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric\nFailed example:\n    elt.is_quasisymmetric()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 479, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 838, in execute\n        exec compiled in globs\n      File \"<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric[2]>\", line 1, in <module>\n        elt.is_quasisymmetric()\n    NameError: name 'elt' is not defined\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 495, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric\nFailed example:\n    elt -= 3*w.sum_of_compositions([1,1])\nException raised:\n    Traceback (most recent call last):\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 479, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 838, in execute\n        exec compiled in globs\n      File \"<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric[3]>\", line 1, in <module>\n        elt -= Integer(3)*w.sum_of_compositions([Integer(1),Integer(1)])\n    NameError: name 'elt' is not defined\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 496, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric\nFailed example:\n    elt.is_quasisymmetric()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 479, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 838, in execute\n        exec compiled in globs\n      File \"<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric[4]>\", line 1, in <module>\n        elt.is_quasisymmetric()\n    NameError: name 'elt' is not defined\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 538, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function\nFailed example:\n    elt.to_quassymmetric_function()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 479, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 838, in execute\n        exec compiled in globs\n      File \"<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function[2]>\", line 1, in <module>\n        elt.to_quassymmetric_function()\n      File \"element.pyx\", line 344, in sage.structure.element.Element.__getattr__ (sage/structure/element.c:3871)\n      File \"misc.pyx\", line 251, in sage.structure.misc.getattr_from_other_class (sage/structure/misc.c:1606)\n    AttributeError: 'SymmetricFunctionsNonCommutingVariablesDual.w_with_category.element_class' object has no attribute 'to_quassymmetric_function'\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 541, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function\nFailed example:\n    elt.to_quasisymmetric_function()\nExpected:\n    1/2*h[2, 1, 1]\nGot:\n    M[1, 1, 2] + M[1, 2, 1] + M[2, 1, 1]\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 549, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function\nFailed example:\n    w([]).to_quasisymmetric_function()\nExpected:\n    h[]\nGot:\n    M[]\n**********************************************************************\nFile \"devel/sage/sage/combinat/ncsym/dual.py\", line 551, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function\nFailed example:\n    (2*w([])).to_quasisymmetric_function()\nExpected:\n    2*h[]\nGot:\n    2*M[]\n**********************************************************************\n```\nThis is still the old file, since I didn't want to pop and push during doctesting.",
    "created_at": "2013-10-02T02:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190199",
    "user": "https://github.com/darijgr"
}
```

Sorry, more stuff coming up (and I can't edit right now since I'm running doctests):

```
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 346, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.expand
Failed example:
    w[[1,3],[2]].expand(4)
Expected:
    x0*x1*x0 + x0*x2*x0 + x0*x3*x0 + x1*x0*x1 + x1*x2*x1 + x1*x3*x1
     + x2*x0*x2 + x2*x1*x2 + x2*x3*x2 + x3*x0*x3 + x3*x1*x3 + x3*x2*x3
Got:
    x02*x11*x20 + x03*x11*x30 + x03*x22*x30 + x13*x22*x31
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 353, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.expand
Failed example:
    w[[1],[2,3]].expand(3, letter='y')
Expected:
    y0*y1^2 + y0*y2^2 + y1*y0^2 + y1*y2^2 + y2*y0^2 + y2*y1^2
Got:
    y00*y12*y21
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 492, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric
Failed example:
    elt = w.sum_of_compositions([2,1,1])
Exception raised:
    Traceback (most recent call last):
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric[1]>", line 1, in <module>
        elt = w.sum_of_compositions([Integer(2),Integer(1),Integer(1)])
      File "parent.pyx", line 761, in sage.structure.parent.Parent.__getattr__ (sage/structure/parent.c:6823)
      File "misc.pyx", line 251, in sage.structure.misc.getattr_from_other_class (sage/structure/misc.c:1606)
    AttributeError: 'SymmetricFunctionsNonCommutingVariablesDual.w_with_category' object has no attribute 'sum_of_compositions'
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 493, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric
Failed example:
    elt.is_quasisymmetric()
Exception raised:
    Traceback (most recent call last):
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric[2]>", line 1, in <module>
        elt.is_quasisymmetric()
    NameError: name 'elt' is not defined
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 495, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric
Failed example:
    elt -= 3*w.sum_of_compositions([1,1])
Exception raised:
    Traceback (most recent call last):
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric[3]>", line 1, in <module>
        elt -= Integer(3)*w.sum_of_compositions([Integer(1),Integer(1)])
    NameError: name 'elt' is not defined
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 496, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric
Failed example:
    elt.is_quasisymmetric()
Exception raised:
    Traceback (most recent call last):
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.is_quasisymmetric[4]>", line 1, in <module>
        elt.is_quasisymmetric()
    NameError: name 'elt' is not defined
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 538, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function
Failed example:
    elt.to_quassymmetric_function()
Exception raised:
    Traceback (most recent call last):
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 479, in _run
        self.execute(example, compiled, test.globs)
      File "/home/darij/sage-5.12.beta5/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 838, in execute
        exec compiled in globs
      File "<doctest sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function[2]>", line 1, in <module>
        elt.to_quassymmetric_function()
      File "element.pyx", line 344, in sage.structure.element.Element.__getattr__ (sage/structure/element.c:3871)
      File "misc.pyx", line 251, in sage.structure.misc.getattr_from_other_class (sage/structure/misc.c:1606)
    AttributeError: 'SymmetricFunctionsNonCommutingVariablesDual.w_with_category.element_class' object has no attribute 'to_quassymmetric_function'
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 541, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function
Failed example:
    elt.to_quasisymmetric_function()
Expected:
    1/2*h[2, 1, 1]
Got:
    M[1, 1, 2] + M[1, 2, 1] + M[2, 1, 1]
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 549, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function
Failed example:
    w([]).to_quasisymmetric_function()
Expected:
    h[]
Got:
    M[]
**********************************************************************
File "devel/sage/sage/combinat/ncsym/dual.py", line 551, in sage.combinat.ncsym.dual.SymmetricFunctionsNonCommutingVariablesDual.w.Element.to_quasisymmetric_function
Failed example:
    (2*w([])).to_quasisymmetric_function()
Expected:
    2*h[]
Got:
    2*M[]
**********************************************************************
```
This is still the old file, since I didn't want to pop and push during doctesting.



---

archive/issue_comments_190200.json:
```json
{
    "body": "I didn't separate everything off as I thought I did. I also made the expansion live in the correct parent (in HNT it is the quotient of a polynomial ring).\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-10-02T14:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190200",
    "user": "https://github.com/tscrim"
}
```

I didn't separate everything off as I thought I did. I also made the expansion live in the correct parent (in HNT it is the quotient of a polynomial ring).

For patchbot:

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_comments_190201.json:
```json
{
    "body": "Here are some doc changes, but a lot of methods need OUTPUT as well as INPUT.  Remember how I said \"I don't think I will suggest other functionality...\"?  I was wrong.  One thing that I realized that was missing was a `duality_pairing` function.  I have a patch to add this, but I need to add documentation yet.  I'll try to do this shortly.",
    "created_at": "2013-10-03T00:33:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190201",
    "user": "https://github.com/zabrocki"
}
```

Here are some doc changes, but a lot of methods need OUTPUT as well as INPUT.  Remember how I said "I don't think I will suggest other functionality..."?  I was wrong.  One thing that I realized that was missing was a `duality_pairing` function.  I have a patch to add this, but I need to add documentation yet.  I'll try to do this shortly.



---

archive/issue_comments_190202.json:
```json
{
    "body": "Attachment [trac_15150-duality_pairing-mz.patch](tarball://root/attachments/some-uuid/ticket15150/trac_15150-duality_pairing-mz.patch) by @tscrim created at 2013-10-04 04:39:53\n\nNew version with both of Mike's patches folded in and functions documented, along with refactoring the categories to a common super category to not duplicate code.",
    "created_at": "2013-10-04T04:39:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190202",
    "user": "https://github.com/tscrim"
}
```

Attachment [trac_15150-duality_pairing-mz.patch](tarball://root/attachments/some-uuid/ticket15150/trac_15150-duality_pairing-mz.patch) by @tscrim created at 2013-10-04 04:39:53

New version with both of Mike's patches folded in and functions documented, along with refactoring the categories to a common super category to not duplicate code.



---

archive/issue_comments_190203.json:
```json
{
    "body": "Hi Travis,\nI was looking at the method `from_symmetric_function` and I want to make sure that I understand.  It is just a linear map of one vector space to another, right?  It does not preserve the product or the coproduct structure if I understand it.",
    "created_at": "2013-10-09T20:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190203",
    "user": "https://github.com/zabrocki"
}
```

Hi Travis,
I was looking at the method `from_symmetric_function` and I want to make sure that I understand.  It is just a linear map of one vector space to another, right?  It does not preserve the product or the coproduct structure if I understand it.



---

archive/issue_comments_190204.json:
```json
{
    "body": "Hey Mike.\n\nYes. It is more about it being a section of the natural projection and working with the map with NSym.",
    "created_at": "2013-10-10T00:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190204",
    "user": "https://github.com/tscrim"
}
```

Hey Mike.

Yes. It is more about it being a section of the natural projection and working with the map with NSym.



---

archive/issue_comments_190205.json:
```json
{
    "body": "Here is one that I can see needs to be fixed.\n\n```\nsage: Sp = SymmetricFunctions(QQ).p()\nsage: Np = SymmetricFunctionsNonCommutingVariables(QQ).p()\nsage: Nh = SymmetricFunctionsNonCommutingVariables(QQ).h()\nsage: Sp(Nh(Np([[1,4],[2,3]])).to_symmetric_function())\n45/2*p[1, 1, 1, 1] - p[2, 1, 1] + 1/2*p[2, 2]\nsage: Np([[1,4],[2,3]]).to_symmetric_function()\np[2, 2]\nsage: Ne = SymmetricFunctionsNonCommutingVariables(QQ).e()\nsage: Sp(Ne(Np([[1,4],[2,3]])).to_symmetric_function())\n45/2*p[1, 1, 1, 1] + p[2, 1, 1] + 1/2*p[2, 2]\n```\nWith **m**, **q**, **x** the coercion is consistent.\n\nI am fairly sure the problem is with the projection `to_symmetric_function` in the **h** and the **e** bases.",
    "created_at": "2013-10-10T12:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190205",
    "user": "https://github.com/zabrocki"
}
```

Here is one that I can see needs to be fixed.

```
sage: Sp = SymmetricFunctions(QQ).p()
sage: Np = SymmetricFunctionsNonCommutingVariables(QQ).p()
sage: Nh = SymmetricFunctionsNonCommutingVariables(QQ).h()
sage: Sp(Nh(Np([[1,4],[2,3]])).to_symmetric_function())
45/2*p[1, 1, 1, 1] - p[2, 1, 1] + 1/2*p[2, 2]
sage: Np([[1,4],[2,3]]).to_symmetric_function()
p[2, 2]
sage: Ne = SymmetricFunctionsNonCommutingVariables(QQ).e()
sage: Sp(Ne(Np([[1,4],[2,3]])).to_symmetric_function())
45/2*p[1, 1, 1, 1] + p[2, 1, 1] + 1/2*p[2, 2]
```
With **m**, **q**, **x** the coercion is consistent.

I am fairly sure the problem is with the projection `to_symmetric_function` in the **h** and the **e** bases.



---

archive/issue_comments_190206.json:
```json
{
    "body": "more doc changes",
    "created_at": "2013-10-10T13:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190206",
    "user": "https://github.com/zabrocki"
}
```

more doc changes



---

archive/issue_comments_190207.json:
```json
{
    "body": "Hey Mike,\n\nI've folded in your latest review patch, fixed the projection in the **h** and **e** bases (I wasn't scaling by the correct constant), and added some exposition to the `NCSym` class.\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-10-13T17:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190207",
    "user": "https://github.com/tscrim"
}
```

Hey Mike,

I've folded in your latest review patch, fixed the projection in the **h** and **e** bases (I wasn't scaling by the correct constant), and added some exposition to the `NCSym` class.

For patchbot:

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_comments_190208.json:
```json
{
    "body": "Sorry I had to put this aside for a while.  I factored out `product_on_basis` and moved it to `bases.py` since the product is the same for all bases except the monomial basis.  Added a few more doc changes.  I think that there is more to do, but we are getting close.",
    "created_at": "2013-10-26T13:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190208",
    "user": "https://github.com/zabrocki"
}
```

Sorry I had to put this aside for a while.  I factored out `product_on_basis` and moved it to `bases.py` since the product is the same for all bases except the monomial basis.  Added a few more doc changes.  I think that there is more to do, but we are getting close.



---

archive/issue_comments_190209.json:
```json
{
    "body": "This version includes changes to `dual.py`.  I deleted the function `_set_par_to_par` because it didn't make sense and the documentation was wrong and it could be replaced with `lambda A: A.shape()`.",
    "created_at": "2013-10-26T16:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190209",
    "user": "https://github.com/zabrocki"
}
```

This version includes changes to `dual.py`.  I deleted the function `_set_par_to_par` because it didn't make sense and the documentation was wrong and it could be replaced with `lambda A: A.shape()`.



---

archive/issue_comments_190210.json:
```json
{
    "body": "Hmm. Am I seeing it right that you defined the product to be piping on every basis unless overshadowed explicitly? A bit of an trap if you ask me.\n\nAlso:\n\n```\n \t392\t                The expansion of an element of the `\\mathbf{w}` basis is \n \t393\t                given by equations (26) and (55) in [HNT06]_. \n```\nThe formula numbers refer to a version of the paper other than the one referenced (arXiv; by the way, please add a version number).",
    "created_at": "2013-10-26T16:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190210",
    "user": "https://github.com/darijgr"
}
```

Hmm. Am I seeing it right that you defined the product to be piping on every basis unless overshadowed explicitly? A bit of an trap if you ask me.

Also:

```
 	392	                The expansion of an element of the `\mathbf{w}` basis is 
 	393	                given by equations (26) and (55) in [HNT06]_. 
```
The formula numbers refer to a version of the paper other than the one referenced (arXiv; by the way, please add a version number).



---

archive/issue_comments_190211.json:
```json
{
    "body": "I created a category of multiplicative bases and put the `product_on_basis` there.  In theory, calculations can be sped up by applying homomorphisms to irreducible components of basis elements.",
    "created_at": "2013-10-27T12:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190211",
    "user": "https://github.com/zabrocki"
}
```

I created a category of multiplicative bases and put the `product_on_basis` there.  In theory, calculations can be sped up by applying homomorphisms to irreducible components of basis elements.



---

archive/issue_comments_190212.json:
```json
{
    "body": "But it's in `class NCSymBases(Category_realization_of_parent)`, not in some hypothetical `class MultiplicativeNCSymBases(NCSymBases)` right? Oooh, I see, this nevertheless means the multiplicative bases only, while all the others go through the `NCSymBasis_abstract` class. But IMHO this is confusing, and could be clarified at least in the class docstrings if not in the names of the classes...",
    "created_at": "2013-10-27T16:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190212",
    "user": "https://github.com/darijgr"
}
```

But it's in `class NCSymBases(Category_realization_of_parent)`, not in some hypothetical `class MultiplicativeNCSymBases(NCSymBases)` right? Oooh, I see, this nevertheless means the multiplicative bases only, while all the others go through the `NCSymBasis_abstract` class. But IMHO this is confusing, and could be clarified at least in the class docstrings if not in the names of the classes...



---

archive/issue_comments_190213.json:
```json
{
    "body": "The method `_set_par_to_par` is needed because does a little bit more than just return the shape and is needed for the [inverse] coercion. The method `_set_par_to_par()` in effect takes a subset of set partitions which are in bijection with partitions and corresponds to leading terms in the coercion.\n\nWith Mike's patch we have:\n\n```python\nsage: w = SymmetricFunctionsNonCommutingVariablesDual(QQ).w()\nsage: h = SymmetricFunctions(QQ).h()\nsage: h(w[[1,3],[2]])\n---------------------------------------------------------------------------\nAssertionError                            Traceback (most recent call last)\n<ipython-input-3-5d0ec5476c79> in <module>()\n----> 1 h(w[[Integer(1),Integer(3)],[Integer(2)]])\n\n/home/travis/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8372)()\n\n/home/travis/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/categories/morphism.so in sage.categories.morphism.SetMorphism._call_ (sage/categories/morphism.c:4837)()\n\n/home/travis/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/categories/modules_with_basis.pyc in preimage(self, f)\n   1715                     raise ValueError, \"%s is not in the image of %s\"%(f, self)\n   1716             s = map(j_preimage)\n-> 1717             assert j == self._dominant_item(s)[0]\n   1718 \n   1719             if not self._unitriangular:\n\nAssertionError:\n```\nWhile it shouldn't work, it is giving the wrong error.\n\nI've folded in your latest patch Mike, but reinstated `_set_par_to_par` with some documentation changes and some doctests. Hopefully it is more clear what it does, but perhaps the method could be renamed.\n\n> But it's in class NCSymBases(Category_realization_of_parent), not in some hypothetical class MultiplicativeNCSymBases(NCSymBases) right? Oooh, I see, this nevertheless means the multiplicative bases only, while all the others go through the NCSymBasis_abstract class. But IMHO this is confusing, and could be clarified at least in the class docstrings if not in the names of the classes...\n\n\nNot quite. We need the `NCSymBasis_abstract` class to overwrite the `_element_constructor_` from `Parent`. This is not a category object, and all bases inherit from this (as classes). The different categories are used as a slightly different type of abstraction, which includes (in a sense) a mathematical organization.\n\nI've also made the **w** basis inherit from `NCSymBasis_abstract`.\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-10-27T17:36:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190213",
    "user": "https://github.com/tscrim"
}
```

The method `_set_par_to_par` is needed because does a little bit more than just return the shape and is needed for the [inverse] coercion. The method `_set_par_to_par()` in effect takes a subset of set partitions which are in bijection with partitions and corresponds to leading terms in the coercion.

With Mike's patch we have:

```python
sage: w = SymmetricFunctionsNonCommutingVariablesDual(QQ).w()
sage: h = SymmetricFunctions(QQ).h()
sage: h(w[[1,3],[2]])
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
<ipython-input-3-5d0ec5476c79> in <module>()
----> 1 h(w[[Integer(1),Integer(3)],[Integer(2)]])

/home/travis/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8372)()

/home/travis/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/categories/morphism.so in sage.categories.morphism.SetMorphism._call_ (sage/categories/morphism.c:4837)()

/home/travis/sage-5.13.beta0/local/lib/python2.7/site-packages/sage/categories/modules_with_basis.pyc in preimage(self, f)
   1715                     raise ValueError, "%s is not in the image of %s"%(f, self)
   1716             s = map(j_preimage)
-> 1717             assert j == self._dominant_item(s)[0]
   1718 
   1719             if not self._unitriangular:

AssertionError:
```
While it shouldn't work, it is giving the wrong error.

I've folded in your latest patch Mike, but reinstated `_set_par_to_par` with some documentation changes and some doctests. Hopefully it is more clear what it does, but perhaps the method could be renamed.

> But it's in class NCSymBases(Category_realization_of_parent), not in some hypothetical class MultiplicativeNCSymBases(NCSymBases) right? Oooh, I see, this nevertheless means the multiplicative bases only, while all the others go through the NCSymBasis_abstract class. But IMHO this is confusing, and could be clarified at least in the class docstrings if not in the names of the classes...


Not quite. We need the `NCSymBasis_abstract` class to overwrite the `_element_constructor_` from `Parent`. This is not a category object, and all bases inherit from this (as classes). The different categories are used as a slightly different type of abstraction, which includes (in a sense) a mathematical organization.

I've also made the **w** basis inherit from `NCSymBasis_abstract`.

For patchbot:

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_comments_190214.json:
```json
{
    "body": "Hmm.  I still don't get `_set_par_to_par`.  Where does the `\\lambda_i \\leq \\lambda_{i+1}` come in?\n\n```\nsage: w = SymmetricFunctionsNonCommutingVariables(QQ).dual().w()\nsage: h = SymmetricFunctions(QQ).h() \nsage: w._set_par_to_par(SetPartition([[1],[2],[3,4,5]]))\n[3, 1, 1]\nsage: w._set_par_to_par(SetPartition([[1,2,3],[4],[5]]))\n[3, 1, 1]\nsage: w._set_par_to_par(SetPartition([[1],[2,3,4],[5]]))\n[3, 1, 1]\nsage: w._set_par_to_par(SetPartition([[1],[2,3,5],[4]]))\nsage: h(w[[1,2],[3]])\n---------------------------------------------------------------------------\nAssertionError                            Traceback (most recent call last)\n...\nAssertionError: \nsage: h(w[[1],[2,3]])\n---------------------------------------------------------------------------\nAssertionError                            Traceback (most recent call last)\n...\nAssertionError: \nsage: h(w[[1,3],[2]])\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: w{{1, 3}, {2}} is not in the image of Generic morphism:\n  From: Symmetric Functions over Rational Field in the homogeneous basis\n  To:   Dual symmetric functions in non-commuting variables over the Rational Field in the w basis\nsage: \n```\nWhy is the last one a `ValueError` and the others are assertion errors?",
    "created_at": "2013-10-27T18:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190214",
    "user": "https://github.com/zabrocki"
}
```

Hmm.  I still don't get `_set_par_to_par`.  Where does the `\lambda_i \leq \lambda_{i+1}` come in?

```
sage: w = SymmetricFunctionsNonCommutingVariables(QQ).dual().w()
sage: h = SymmetricFunctions(QQ).h() 
sage: w._set_par_to_par(SetPartition([[1],[2],[3,4,5]]))
[3, 1, 1]
sage: w._set_par_to_par(SetPartition([[1,2,3],[4],[5]]))
[3, 1, 1]
sage: w._set_par_to_par(SetPartition([[1],[2,3,4],[5]]))
[3, 1, 1]
sage: w._set_par_to_par(SetPartition([[1],[2,3,5],[4]]))
sage: h(w[[1,2],[3]])
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
...
AssertionError: 
sage: h(w[[1],[2,3]])
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
...
AssertionError: 
sage: h(w[[1,3],[2]])
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: w{{1, 3}, {2}} is not in the image of Generic morphism:
  From: Symmetric Functions over Rational Field in the homogeneous basis
  To:   Dual symmetric functions in non-commuting variables over the Rational Field in the w basis
sage: 
```
Why is the last one a `ValueError` and the others are assertion errors?



---

archive/issue_comments_190215.json:
```json
{
    "body": "There's two problems, the first is the morphism should be the other triangular and the second is the `_set_par_to_par()` is not restrictive enough. I'll be fixing this now.",
    "created_at": "2013-10-27T19:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190215",
    "user": "https://github.com/tscrim"
}
```

There's two problems, the first is the morphism should be the other triangular and the second is the `_set_par_to_par()` is not restrictive enough. I'll be fixing this now.



---

archive/issue_comments_190216.json:
```json
{
    "body": "Okay, fixed. They all return `ValueError`s now and I'm now using the ordering on `lambda_i` in the method.",
    "created_at": "2013-10-27T19:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190216",
    "user": "https://github.com/tscrim"
}
```

Okay, fixed. They all return `ValueError`s now and I'm now using the ordering on `lambda_i` in the method.



---

archive/issue_comments_190217.json:
```json
{
    "body": "There seems to be a problem with coercion for bases other than than `h`.\n\n```\nsage: w = SymmetricFunctionsNonCommutingVariablesDual(QQ).w()\nsage: e = SymmetricFunctions(QQ).e()\nsage: e(w(e[2,1]))\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-4-66ec535e7d35> in <module>()\n----> 1 e(w(e[Integer(2),Integer(1)]))\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8372)()\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3856)()\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3757)()\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/sf/classical.pyc in _element_constructor_(self, x)\n    327                 return eclass(self, {sage.combinat.partition.Partition([]):R(x)})\n    328             except StandardError:\n--> 329                 raise TypeError, \"do not know how to make x (= %s) an element of self\"%(x)\n    330 \n    331     # This subclass is currently needed for the test above:\n\nTypeError: do not know how to make x (= 6*w{{1}, {2}, {3}} - w{{1}, {2, 3}} - w{{1, 2}, {3}} - w{{1, 3}, {2}}) an element of self\nsage: h = SymmetricFunctions(QQ).h()\nsage: e(h(w(e[2,1])))\ne[2, 1]\n```",
    "created_at": "2013-10-28T01:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190217",
    "user": "https://github.com/zabrocki"
}
```

There seems to be a problem with coercion for bases other than than `h`.

```
sage: w = SymmetricFunctionsNonCommutingVariablesDual(QQ).w()
sage: e = SymmetricFunctions(QQ).e()
sage: e(w(e[2,1]))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-66ec535e7d35> in <module>()
----> 1 e(w(e[Integer(2),Integer(1)]))

/Applications/sage/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8372)()

/Applications/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3856)()

/Applications/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3757)()

/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/sf/classical.pyc in _element_constructor_(self, x)
    327                 return eclass(self, {sage.combinat.partition.Partition([]):R(x)})
    328             except StandardError:
--> 329                 raise TypeError, "do not know how to make x (= %s) an element of self"%(x)
    330 
    331     # This subclass is currently needed for the test above:

TypeError: do not know how to make x (= 6*w{{1}, {2}, {3}} - w{{1}, {2, 3}} - w{{1, 2}, {3}} - w{{1, 3}, {2}}) an element of self
sage: h = SymmetricFunctions(QQ).h()
sage: e(h(w(e[2,1])))
e[2, 1]
```



---

archive/issue_comments_190218.json:
```json
{
    "body": "A few minor changes in whitespace and pyflakes warnings.",
    "created_at": "2013-10-28T01:47:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190218",
    "user": "https://github.com/zabrocki"
}
```

A few minor changes in whitespace and pyflakes warnings.



---

archive/issue_comments_190219.json:
```json
{
    "body": "Mike, you're trying to coerce from a basis of dual NCSym to a basis of Sym? Should that really be a coercion? That would give a noncommutative coercion graph...",
    "created_at": "2013-10-28T02:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190219",
    "user": "https://github.com/darijgr"
}
```

Mike, you're trying to coerce from a basis of dual NCSym to a basis of Sym? Should that really be a coercion? That would give a noncommutative coercion graph...



---

archive/issue_comments_190220.json:
```json
{
    "body": "To my eye, the problem is the doc tests.  I see examples of coercion through the `h` basis rather than the use of the `to_symmetric_function` method.  Reading those doc-tests I suspected that the `h` basis is not the only portal and I was wrong.\n\n```\nsage: w = SymmetricFunctionsNonCommutingVariablesDual(QQ).w()\nsage: e = SymmetricFunctions(QQ).e()\nsage: w(e[2,1]).to_symmetric_function()\nh[1, 1, 1] - h[2, 1]\n```",
    "created_at": "2013-10-28T02:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190220",
    "user": "https://github.com/zabrocki"
}
```

To my eye, the problem is the doc tests.  I see examples of coercion through the `h` basis rather than the use of the `to_symmetric_function` method.  Reading those doc-tests I suspected that the `h` basis is not the only portal and I was wrong.

```
sage: w = SymmetricFunctionsNonCommutingVariablesDual(QQ).w()
sage: e = SymmetricFunctions(QQ).e()
sage: w(e[2,1]).to_symmetric_function()
h[1, 1, 1] - h[2, 1]
```



---

archive/issue_comments_190221.json:
```json
{
    "body": "OK, this thing is implemented as a conversion (rightly -- it can't be a coercion), whence there is no automatic path discovery. But the docstring is claiming it's a coercion, and could be more explicit about it only leading to `h`.",
    "created_at": "2013-10-28T02:50:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190221",
    "user": "https://github.com/darijgr"
}
```

OK, this thing is implemented as a conversion (rightly -- it can't be a coercion), whence there is no automatic path discovery. But the docstring is claiming it's a coercion, and could be more explicit about it only leading to `h`.



---

archive/issue_comments_190222.json:
```json
{
    "body": "I'm not sure if I should be too concerned because the doc tests are in a hidden function and they are there to test if that coercion doesn't work, not to demonstrate how to coerce between NCSym<sup>*</sup> and Sym.  I tried to make it *slightly* clearer by changing the doc test.\n\nI also changed the following because I don't think it is right:\n\n```\n    There is also a natural projection to the usual symmetric functions by\n    letting the variables commute. This projection does *not* preserve the\n    product nor coproduct stucture, but instead is just a module morphism.\n```\nI think the slice defined in `from_symmetric_function` does not preserve the Hopf structure, but the projection preserves both product and coproduct.",
    "created_at": "2013-10-28T13:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190222",
    "user": "https://github.com/zabrocki"
}
```

I'm not sure if I should be too concerned because the doc tests are in a hidden function and they are there to test if that coercion doesn't work, not to demonstrate how to coerce between NCSym<sup>*</sup> and Sym.  I tried to make it *slightly* clearer by changing the doc test.

I also changed the following because I don't think it is right:

```
    There is also a natural projection to the usual symmetric functions by
    letting the variables commute. This projection does *not* preserve the
    product nor coproduct stucture, but instead is just a module morphism.
```
I think the slice defined in `from_symmetric_function` does not preserve the Hopf structure, but the projection preserves both product and coproduct.



---

archive/issue_comments_190223.json:
```json
{
    "body": "I added a few doc tests that hopefully clarifies the purpose of `from_symmetric_function`.",
    "created_at": "2013-10-28T15:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190223",
    "user": "https://github.com/zabrocki"
}
```

I added a few doc tests that hopefully clarifies the purpose of `from_symmetric_function`.



---

archive/issue_comments_190224.json:
```json
{
    "body": "I believe that there is missing documentation due to #9107 (e.g. any methods in `monomial.Element`).  This version includes some minor doc changes.",
    "created_at": "2013-10-29T00:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190224",
    "user": "https://github.com/zabrocki"
}
```

I believe that there is missing documentation due to #9107 (e.g. any methods in `monomial.Element`).  This version includes some minor doc changes.



---

archive/issue_comments_190225.json:
```json
{
    "body": "Replying to [comment:70 zabrocki]:\n> I think the slice defined in `from_symmetric_function` does not preserve the Hopf structure, but the projection preserves both product and coproduct.\n\n\nIf it doesn't preserve the Hopf structure, we can't have it be a coercion (including the **w** basis to the homogeneous sym funcs). Instead we have to make them all conversions. I'll also add in the natural conversions (ex. the **p** basis to the powersum sym funcs) on the next update.\n\nBest,\n\nTravis",
    "created_at": "2013-10-29T05:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190225",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:70 zabrocki]:
> I think the slice defined in `from_symmetric_function` does not preserve the Hopf structure, but the projection preserves both product and coproduct.


If it doesn't preserve the Hopf structure, we can't have it be a coercion (including the **w** basis to the homogeneous sym funcs). Instead we have to make them all conversions. I'll also add in the natural conversions (ex. the **p** basis to the powersum sym funcs) on the next update.

Best,

Travis



---

archive/issue_comments_190226.json:
```json
{
    "body": "`from_symmetric_function` is already not a coercion.  It is just a method.  Are you saying that you don't want to make the map from Sym -> NCSym<sup>*</sup> a coercion?  It preserves the Hopf structure.\n\nFor NSym/QSym I believe we have the following:\n* NSym -> Sym is a method `to_symmetric_function`\n* Sym -> QSym is a coercion and can be accessed by `B( sfelement )` where `B` is a basis of QSym\n* QSym -> Sym under the condition that the element in QSym `is_symmetric` by `qsymelement.to_symmetric_function()` or (and this is not preferred) `m( qsymelement )`\n\nAll of these maps preserve the Hopf algebra structure.  Similarly for NCSym/NCSym<sup>*</sup> we have\n* NCSym -> Sym is a method `to_symmetric_function`\n* Sym -> NCSym<sup>*</sup> is a coercion and can be accessed by `w( sfelement )`\n* NCSym<sup>*</sup> -> Sym under the condition that the element in NCSym<sup>*</sup> `is_symmetric` by `ncsymdelement.to_symmetric_function()` or (and this is not preferred) `h( ncsymdelement )`\n\nThe maps NCSym -> Sym and NSym -> Sym are not coercions since these maps are projections and hence not invertible.  The inclusions of Sym -> NCSym<sup>*</sup> and Sym -> QSym have an inverse (one sided) and so I think that they can be coercions.  I am not too concerned that `p( ncsymdelement )` doesn't work.  The reason the portal through the `h` basis works is because of the connection with the **w** basis.",
    "created_at": "2013-10-29T12:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190226",
    "user": "https://github.com/zabrocki"
}
```

`from_symmetric_function` is already not a coercion.  It is just a method.  Are you saying that you don't want to make the map from Sym -> NCSym<sup>*</sup> a coercion?  It preserves the Hopf structure.

For NSym/QSym I believe we have the following:
* NSym -> Sym is a method `to_symmetric_function`
* Sym -> QSym is a coercion and can be accessed by `B( sfelement )` where `B` is a basis of QSym
* QSym -> Sym under the condition that the element in QSym `is_symmetric` by `qsymelement.to_symmetric_function()` or (and this is not preferred) `m( qsymelement )`

All of these maps preserve the Hopf algebra structure.  Similarly for NCSym/NCSym<sup>*</sup> we have
* NCSym -> Sym is a method `to_symmetric_function`
* Sym -> NCSym<sup>*</sup> is a coercion and can be accessed by `w( sfelement )`
* NCSym<sup>*</sup> -> Sym under the condition that the element in NCSym<sup>*</sup> `is_symmetric` by `ncsymdelement.to_symmetric_function()` or (and this is not preferred) `h( ncsymdelement )`

The maps NCSym -> Sym and NSym -> Sym are not coercions since these maps are projections and hence not invertible.  The inclusions of Sym -> NCSym<sup>*</sup> and Sym -> QSym have an inverse (one sided) and so I think that they can be coercions.  I am not too concerned that `p( ncsymdelement )` doesn't work.  The reason the portal through the `h` basis works is because of the connection with the **w** basis.



---

archive/issue_comments_190227.json:
```json
{
    "body": "Ah, sorry, I confused myself.\n\nHowever I coercions do not have to be invertible (ex. `ZZ -> QQ`), just are well-defined, preserve the structure, and make commutative diagrams. I think they typically are injections, but this is not a requirement.\n\nThe `QSym -> Sym` can't be a coercion because it is not well-defined (on all elements). Since `NCSym -> Sym` and `NSym -> Sym` preserve the Hopf structure and are well-defined. I don't think there's any danger of breaking coercion commutativity. So I think we should make these coercions. Your thoughts?",
    "created_at": "2013-10-29T17:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190227",
    "user": "https://github.com/tscrim"
}
```

Ah, sorry, I confused myself.

However I coercions do not have to be invertible (ex. `ZZ -> QQ`), just are well-defined, preserve the structure, and make commutative diagrams. I think they typically are injections, but this is not a requirement.

The `QSym -> Sym` can't be a coercion because it is not well-defined (on all elements). Since `NCSym -> Sym` and `NSym -> Sym` preserve the Hopf structure and are well-defined. I don't think there's any danger of breaking coercion commutativity. So I think we should make these coercions. Your thoughts?



---

archive/issue_comments_190228.json:
```json
{
    "body": "I am not comfortable making `NCSym` and `NSym -> Sym` coercions because when I say that they preserve the Hopf structure I mean that the Hopf structure of `NCSym` is mapped onto the Hopf structure of `Sym` but `NCSym` does not exist as a Hopf subalgebra of `Sym`.  For `Sym -> QSym` it is the case that `Sym` exists as a subalgebra of `QSym`.\n\nThat is, let phi : NCSym -> Sym\nthen sometimes we have,\nF != G\nbut \nphi(F) = phi(G) (e.g. F = A*B, G =B*A)\n\nThat is, \"equalities go to equalities, but sometimes inequalities also go to equalities.\" (to my eye, not something I want as a coercion).  This isn't a hard fast rule, but it seems counter-intuitive to be able to coerce from NCSym to Sym rather than use the method `to_symmetric_function` to project onto that space.\n\nFor psi: Sym -> NCSym<sup>*</sup> we have psi(F)=psi(G) iff F=G, that is, \"equalities going to equalities and inequalities going to inequalities\"",
    "created_at": "2013-10-29T18:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190228",
    "user": "https://github.com/zabrocki"
}
```

I am not comfortable making `NCSym` and `NSym -> Sym` coercions because when I say that they preserve the Hopf structure I mean that the Hopf structure of `NCSym` is mapped onto the Hopf structure of `Sym` but `NCSym` does not exist as a Hopf subalgebra of `Sym`.  For `Sym -> QSym` it is the case that `Sym` exists as a subalgebra of `QSym`.

That is, let phi : NCSym -> Sym
then sometimes we have,
F != G
but 
phi(F) = phi(G) (e.g. F = A*B, G =B*A)

That is, "equalities go to equalities, but sometimes inequalities also go to equalities." (to my eye, not something I want as a coercion).  This isn't a hard fast rule, but it seems counter-intuitive to be able to coerce from NCSym to Sym rather than use the method `to_symmetric_function` to project onto that space.

For psi: Sym -> NCSym<sup>*</sup> we have psi(F)=psi(G) iff F=G, that is, "equalities going to equalities and inequalities going to inequalities"



---

archive/issue_comments_190229.json:
```json
{
    "body": "Since it's consistent with `NSym`, I'm fine with `NCSym -> Sym` not being a coercion. So what else needs to be done?",
    "created_at": "2013-10-29T19:50:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190229",
    "user": "https://github.com/tscrim"
}
```

Since it's consistent with `NSym`, I'm fine with `NCSym -> Sym` not being a coercion. So what else needs to be done?



---

archive/issue_comments_190230.json:
```json
{
    "body": "I want to be completely convinced everything works properly and haven't missed any details in the documentation.  Give me another day or two to find minor tweaks.  Otherwise I am extremely happy with it.  Nantel asked just today to use it to compute `m_A(x_0,x_1,...,x_n)` and I sent him installation instructions.",
    "created_at": "2013-10-29T20:01:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190230",
    "user": "https://github.com/zabrocki"
}
```

I want to be completely convinced everything works properly and haven't missed any details in the documentation.  Give me another day or two to find minor tweaks.  Otherwise I am extremely happy with it.  Nantel asked just today to use it to compute `m_A(x_0,x_1,...,x_n)` and I sent him installation instructions.



---

archive/issue_comments_190231.json:
```json
{
    "body": "current version moves `counit_on_basis` to `NCSymOrNCSymDualBases` parent methods and implements `antipode_on_basis` in the **w** parent methods",
    "created_at": "2013-10-30T03:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190231",
    "user": "https://github.com/zabrocki"
}
```

current version moves `counit_on_basis` to `NCSymOrNCSymDualBases` parent methods and implements `antipode_on_basis` in the **w** parent methods



---

archive/issue_comments_190232.json:
```json
{
    "body": "Can you check if `antipode_on_basis` should be a cached method?  I didn't do that, but it computes the antipode using the definition and it is a rather recursive formula.",
    "created_at": "2013-10-30T03:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190232",
    "user": "https://github.com/zabrocki"
}
```

Can you check if `antipode_on_basis` should be a cached method?  I didn't do that, but it computes the antipode using the definition and it is a rather recursive formula.



---

archive/issue_comments_190233.json:
```json
{
    "body": "Attachment [trac_15150-docchanges-mz.patch](tarball://root/attachments/some-uuid/ticket15150/trac_15150-docchanges-mz.patch) by @zabrocki created at 2013-10-30 03:18:35\n\nMy tests on the antipode seems to run pretty fast without caching, but please take a look.  I just added a new version with some minor doc corrections.",
    "created_at": "2013-10-30T03:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190233",
    "user": "https://github.com/zabrocki"
}
```

Attachment [trac_15150-docchanges-mz.patch](tarball://root/attachments/some-uuid/ticket15150/trac_15150-docchanges-mz.patch) by @zabrocki created at 2013-10-30 03:18:35

My tests on the antipode seems to run pretty fast without caching, but please take a look.  I just added a new version with some minor doc corrections.



---

archive/issue_comments_190234.json:
```json
{
    "body": "All tests pass, and documentation looks good. please look over my last version of the patch, fold it with yours, make any last changes, and you have my blessing on a positive review.  Nice work!",
    "created_at": "2013-10-30T04:08:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190234",
    "user": "https://github.com/zabrocki"
}
```

All tests pass, and documentation looks good. please look over my last version of the patch, fold it with yours, make any last changes, and you have my blessing on a positive review.  Nice work!



---

archive/issue_comments_190235.json:
```json
{
    "body": "A couple of things left to change in the version you posted.  Search on *SEEALSO* because it seems to be duplicated in three places.  Also I think that occurrences of `\\kappa \\circ \\chi` should be `\\chi \\circ \\kappa`.",
    "created_at": "2013-10-31T00:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190235",
    "user": "https://github.com/zabrocki"
}
```

A couple of things left to change in the version you posted.  Search on *SEEALSO* because it seems to be duplicated in three places.  Also I think that occurrences of `\kappa \circ \chi` should be `\chi \circ \kappa`.



---

archive/issue_comments_190236.json:
```json
{
    "body": "Good catch; merge issue. Fixed and same with the map composition order.\n\nSince #10963 is finished (yay), I've added it as a dependency since it seems to affect the output of one of the doctests in `bases.py`. Mike, could you double-check to make sure the tests still pass for you? Thanks. And thanks Darij for fixing up the docstrings along the way.\n\nBest,\n\nTravis\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-10-31T05:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190236",
    "user": "https://github.com/tscrim"
}
```

Good catch; merge issue. Fixed and same with the map composition order.

Since #10963 is finished (yay), I've added it as a dependency since it seems to affect the output of one of the doctests in `bases.py`. Mike, could you double-check to make sure the tests still pass for you? Thanks. And thanks Darij for fixing up the docstrings along the way.

Best,

Travis

For patchbot:

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_comments_190237.json:
```json
{
    "body": "Okay, now everything should be squared away wrt the dep on #10963.\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch",
    "created_at": "2013-10-31T05:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190237",
    "user": "https://github.com/tscrim"
}
```

Okay, now everything should be squared away wrt the dep on #10963.

For patchbot:

Apply: trac_15150-ncsym-ts.patch



---

archive/issue_comments_190238.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-11-07T02:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190238",
    "user": "https://github.com/zabrocki"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_190239.json:
```json
{
    "body": "I used sage cloud and git to test this patch.  All tests pass (even with #10963 applied).  I think that we can be confident that once it has a positive review, that this will pass as well.",
    "created_at": "2013-11-07T02:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190239",
    "user": "https://github.com/zabrocki"
}
```

I used sage cloud and git to test this patch.  All tests pass (even with #10963 applied).  I think that we can be confident that once it has a positive review, that this will pass as well.



---

archive/issue_events_043654.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-07T07:22:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14913#event-43654"
}
```



---

archive/issue_comments_190240.json:
```json
{
    "body": "yay milestone tug of war!\n\nIs there an easy way to commute this past #10963 or will that make code slower/buggier/whatever?",
    "created_at": "2013-11-07T07:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190240",
    "user": "https://github.com/darijgr"
}
```

yay milestone tug of war!

Is there an easy way to commute this past #10963 or will that make code slower/buggier/whatever?



---

archive/issue_comments_190241.json:
```json
{
    "body": "Attachment [trac_15150-ncsym-ts.patch](tarball://root/attachments/some-uuid/ticket15150/trac_15150-ncsym-ts.patch) by @tscrim created at 2013-12-10 16:37:33\n\nwith fixes",
    "created_at": "2013-12-10T16:37:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190241",
    "user": "https://github.com/tscrim"
}
```

Attachment [trac_15150-ncsym-ts.patch](tarball://root/attachments/some-uuid/ticket15150/trac_15150-ncsym-ts.patch) by @tscrim created at 2013-12-10 16:37:33

with fixes



---

archive/issue_events_043655.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-12-10T16:38:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14913#event-43655"
}
```



---

archive/issue_events_043656.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-12-10T16:38:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "milestone": "sage-5.13",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14913#event-43656"
}
```



---

archive/issue_comments_190242.json:
```json
{
    "body": "Since #10963 is getting pushed back, I've changed the one doctest output to move this past.\n\nFor patchbot:\n\nApply: trac_15150-ncsym-ts.patch\u200b",
    "created_at": "2013-12-10T16:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190242",
    "user": "https://github.com/tscrim"
}
```

Since #10963 is getting pushed back, I've changed the one doctest output to move this past.

For patchbot:

Apply: trac_15150-ncsym-ts.patch​



---

archive/issue_comments_190243.json:
```json
{
    "body": "I cannot promise this will be merged in Sage 5.13 though. Did you test this well, that will increase the chances?",
    "created_at": "2013-12-10T17:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190243",
    "user": "https://github.com/jdemeyer"
}
```

I cannot promise this will be merged in Sage 5.13 though. Did you test this well, that will increase the chances?



---

archive/issue_comments_190244.json:
```json
{
    "body": "All tests on the file passed for me on `5.13.beta2`, and once `5.13.beta5` is done compiling, I'll check on that as well.",
    "created_at": "2013-12-10T19:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190244",
    "user": "https://github.com/tscrim"
}
```

All tests on the file passed for me on `5.13.beta2`, and once `5.13.beta5` is done compiling, I'll check on that as well.



---

archive/issue_comments_190245.json:
```json
{
    "body": "Works for me on `5.13.beta5`:\n\n```\nsage -t --long bases.py\n    [148 tests, 14.09 s]\nsage -t --long dual.py\n    [74 tests, 6.73 s]\nsage -t --long ncsym.py\n    [197 tests, 26.14 s]\nsage -t --long set_partition.py\n    [266 tests, 45.62 s]\nsage -t --long ncsf.py\n    [381 tests, 15.40 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\n```\nAnd the pdf documentation builds cleanly:\n\n```\nTranscript written on combinat.log.\nBuild finished.  The built documents can be found in /home/travis/sage-5.13.beta5/devel/sage/doc/output/pdf/en/reference/combinat\n```",
    "created_at": "2013-12-11T06:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190245",
    "user": "https://github.com/tscrim"
}
```

Works for me on `5.13.beta5`:

```
sage -t --long bases.py
    [148 tests, 14.09 s]
sage -t --long dual.py
    [74 tests, 6.73 s]
sage -t --long ncsym.py
    [197 tests, 26.14 s]
sage -t --long set_partition.py
    [266 tests, 45.62 s]
sage -t --long ncsf.py
    [381 tests, 15.40 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```
And the pdf documentation builds cleanly:

```
Transcript written on combinat.log.
Build finished.  The built documents can be found in /home/travis/sage-5.13.beta5/devel/sage/doc/output/pdf/en/reference/combinat
```



---

archive/issue_events_043657.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-12-11T11:02:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14913#event-43657"
}
```



---

archive/issue_comments_190246.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-11T11:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14913#issuecomment-190246",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
