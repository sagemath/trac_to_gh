# Issue 11304: PartitionTuples.cardinality has problems

archive/issues_011304.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  sage-combinat\n\nIt works for smaller values.\n\n\n```\nsage: PartitionTuples(100,13).cardinality()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/Volumes/Scratch/Users/duser1/sage/<ipython console> in <module>()\n\n/Users/duser1/sage/local/lib/python2.6/site-packages/sage/combinat/partition.pyc in cardinality(self)\n   3183             185\n   3184         \"\"\"\n-> 3185         return ZZ(gp.eval('polcoeff(1/eta(x)^%s, %s, x)'%(self.k, self.n)))\n   3186 \n   3187 \n\n/Users/duser1/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6820)()\n\n/Users/duser1/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3254)()\n\n/Users/duser1/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3157)()\n\n/Users/duser1/sage/local/lib/python2.6/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__init__ (sage/rings/integer.c:7212)()\n\nTypeError: unable to convert x (=  ***   at top-level: polcoeff(1/eta(x)^13\n  ***                 ^--------------------\n  *** polcoeff: non existent component in truecoeff.) to an integer\nsage: \n\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/11476\n\n",
    "created_at": "2011-06-14T12:39:53Z",
    "labels": [
        "combinatorics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.5",
    "title": "PartitionTuples.cardinality has problems",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11304",
    "user": "pdehaye"
}
```
Assignee: sage-combinat

CC:  sage-combinat

It works for smaller values.


```
sage: PartitionTuples(100,13).cardinality()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/Volumes/Scratch/Users/duser1/sage/<ipython console> in <module>()

/Users/duser1/sage/local/lib/python2.6/site-packages/sage/combinat/partition.pyc in cardinality(self)
   3183             185
   3184         """
-> 3185         return ZZ(gp.eval('polcoeff(1/eta(x)^%s, %s, x)'%(self.k, self.n)))
   3186 
   3187 

/Users/duser1/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6820)()

/Users/duser1/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3254)()

/Users/duser1/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3157)()

/Users/duser1/sage/local/lib/python2.6/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__init__ (sage/rings/integer.c:7212)()

TypeError: unable to convert x (=  ***   at top-level: polcoeff(1/eta(x)^13
  ***                 ^--------------------
  *** polcoeff: non existent component in truecoeff.) to an integer
sage: 

```


Issue created by migration from https://trac.sagemath.org/ticket/11476





---

archive/issue_comments_124794.json:
```json
{
    "body": "This seems to be problem in the pari function call, or possibly a bug in pari. I have [emailed](http://pari.math.u-bordeaux.fr/archives/pari-dev-1209/msg00042.html) the pari development group to ask them about it. \n\nThis failure appears much earlier than the example above suggests:\n\n\n```\nsage: PartitionTuples(17,2).cardinality()\n...\nTypeError: unable to convert x (=  ***   at top-level: polcoeff(1/eta(x)^2,\n  ***                 ^--------------------\n  *** polcoeff: non existent component in truecoeff.) to an integer\n```\n\n\nIf you run pari natively you get the error more quickly:\n\n\n```\nDesktop: sage -gp\nGP/PARI CALCULATOR Version 2.5.2 (development git-b703ee3)\ni386 running darwin (x86-64/GMP-5.0.2 kernel) 64-bit version\ncompiled: Sep 12 2012, gcc-4.6.3 (GCC) \n(readline v6.2 enabled, extended help enabled)\n\nCopyright (C) 2000-2011 The PARI Group\n\nPARI/GP is free software, covered by the GNU General Public License, and comes WITHOUT ANY WARRANTY WHATSOEVER.\n\nType ? for help, \\q to quit.\nType ?12 for how to get moral (and possibly technical) support.\n\nparisize = 8000000, primelimit = 500509\n? polcoeff(1/eta(x)^2, 16, x)\n%1 = 5822\n? polcoeff(1/eta(x)^2, 17, x)\n  ***   at top-level: polcoeff(1/eta(x)^2,\n  ***                 ^--------------------\n  *** polcoeff: non existent component in truecoeff.\n  ***   Break loop: type 'break' to go back to GP\n```\n\n\nThis is a little surprising as the number of 2-tuples of partitions adding to 17 is 8470, which isn't that big.",
    "created_at": "2012-09-21T02:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-124794",
    "user": "@AndrewAtLarge"
}
```

This seems to be problem in the pari function call, or possibly a bug in pari. I have [emailed](http://pari.math.u-bordeaux.fr/archives/pari-dev-1209/msg00042.html) the pari development group to ask them about it. 

This failure appears much earlier than the example above suggests:


```
sage: PartitionTuples(17,2).cardinality()
...
TypeError: unable to convert x (=  ***   at top-level: polcoeff(1/eta(x)^2,
  ***                 ^--------------------
  *** polcoeff: non existent component in truecoeff.) to an integer
```


If you run pari natively you get the error more quickly:


```
Desktop: sage -gp
GP/PARI CALCULATOR Version 2.5.2 (development git-b703ee3)
i386 running darwin (x86-64/GMP-5.0.2 kernel) 64-bit version
compiled: Sep 12 2012, gcc-4.6.3 (GCC) 
(readline v6.2 enabled, extended help enabled)

Copyright (C) 2000-2011 The PARI Group

PARI/GP is free software, covered by the GNU General Public License, and comes WITHOUT ANY WARRANTY WHATSOEVER.

Type ? for help, \q to quit.
Type ?12 for how to get moral (and possibly technical) support.

parisize = 8000000, primelimit = 500509
? polcoeff(1/eta(x)^2, 16, x)
%1 = 5822
? polcoeff(1/eta(x)^2, 17, x)
  ***   at top-level: polcoeff(1/eta(x)^2,
  ***                 ^--------------------
  *** polcoeff: non existent component in truecoeff.
  ***   Break loop: type 'break' to go back to GP
```


This is a little surprising as the number of 2-tuples of partitions adding to 17 is 8470, which isn't that big.



---

archive/issue_comments_124795.json:
```json
{
    "body": "I had a reply from Karim Belabas (UMR 5251) on pari-dev and it is just a matter of increasing the precision:\n\n\n```\n(08:12) gp > 1/eta(x)^2\n%1 = 1 + 2*x + 5*x^2 + 10*x^3 + 20*x^4 + 36*x^5 + 65*x^6 + 110*x^7 + 185*x^8 + 300*x^9 + 481*x^10 + 752*x^11 + 1165*x^12 + 1770*x^13 + 2665*x^14 + 3956*x^15 + 5822*x^16 + O(x^17)\n\nThe series precision is too low, so the 17-th coefficient is unknown. Use\n\n  1/eta(x + O(x^101))\n\nif you want to access its 100-th coefficient (for instance).\n\nCheers,\n\n    K.B.\n```\n\n\nI'll upload a patch shortly.",
    "created_at": "2012-09-21T10:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-124795",
    "user": "@AndrewAtLarge"
}
```

I had a reply from Karim Belabas (UMR 5251) on pari-dev and it is just a matter of increasing the precision:


```
(08:12) gp > 1/eta(x)^2
%1 = 1 + 2*x + 5*x^2 + 10*x^3 + 20*x^4 + 36*x^5 + 65*x^6 + 110*x^7 + 185*x^8 + 300*x^9 + 481*x^10 + 752*x^11 + 1165*x^12 + 1770*x^13 + 2665*x^14 + 3956*x^15 + 5822*x^16 + O(x^17)

The series precision is too low, so the 17-th coefficient is unknown. Use

  1/eta(x + O(x^101))

if you want to access its 100-th coefficient (for instance).

Cheers,

    K.B.
```


I'll upload a patch shortly.



---

archive/issue_comments_124796.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-09-21T12:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-124796",
    "user": "@AndrewAtLarge"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_124797.json:
```json
{
    "body": "Changing keywords from \"\" to \"PartitionTuple, cardinality\".",
    "created_at": "2012-09-21T12:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-124797",
    "user": "@AndrewAtLarge"
}
```

Changing keywords from "" to "PartitionTuple, cardinality".



---

archive/issue_comments_124798.json:
```json
{
    "body": "Changing keywords from \"PartitionTuple, cardinality\" to \"PartitionTuple, cardinality, beginner\".",
    "created_at": "2012-09-21T12:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-124798",
    "user": "@AndrewAtLarge"
}
```

Changing keywords from "PartitionTuple, cardinality" to "PartitionTuple, cardinality, beginner".



---

archive/issue_comments_124799.json:
```json
{
    "body": "Looks good, just do an automatic trac link `:trac:`11476`` in the doc.\n\nThanks.\n\nPS - Its somewhat entertaining to me to compute these huge numbers:\n\n```\nsage: PartitionTuples(162,120).cardinality()\n414170543784152902405501503878656556915420510510717572175693806227335527665907778197451415072951\n```\n",
    "created_at": "2012-10-13T15:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-124799",
    "user": "@tscrim"
}
```

Looks good, just do an automatic trac link `:trac:`11476`` in the doc.

Thanks.

PS - Its somewhat entertaining to me to compute these huge numbers:

```
sage: PartitionTuples(162,120).cardinality()
414170543784152902405501503878656556915420510510717572175693806227335527665907778197451415072951
```




---

archive/issue_comments_124800.json:
```json
{
    "body": "Thanks for catching this...it seems that the version in the queue did this properly but that I hadn't uploaded it here...fixed now.\n\nCheers,\nAndrew\n\nps. I didn't check any of these big numbers by hand:)",
    "created_at": "2012-10-14T13:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-124800",
    "user": "@AndrewAtLarge"
}
```

Thanks for catching this...it seems that the version in the queue did this properly but that I hadn't uploaded it here...fixed now.

Cheers,
Andrew

ps. I didn't check any of these big numbers by hand:)



---

archive/issue_comments_124801.json:
```json
{
    "body": "Thanks! I'll double-check everything once #13072 is fixed up, but basically this is a positive review.",
    "created_at": "2012-10-15T00:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-124801",
    "user": "@tscrim"
}
```

Thanks! I'll double-check everything once #13072 is fixed up, but basically this is a positive review.



---

archive/issue_comments_124802.json:
```json
{
    "body": "I believe this needs to be rebased to remove the fuzz:\n\n```\nHunk #1 succeeded at 1626 with fuzz 1 (offset -1 lines)\n```\n\nbut good otherwise so I am setting it to a positive review.\n\nTravis",
    "created_at": "2012-10-19T22:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-124802",
    "user": "@tscrim"
}
```

I believe this needs to be rebased to remove the fuzz:

```
Hunk #1 succeeded at 1626 with fuzz 1 (offset -1 lines)
```

but good otherwise so I am setting it to a positive review.

Travis



---

archive/issue_comments_124803.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-10-19T22:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-124803",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_124804.json:
```json
{
    "body": "Attachment [trac_11476--fixing-partition-tuples_cardinality-am.patch](tarball://root/attachments/some-uuid/ticket11476/trac_11476--fixing-partition-tuples_cardinality-am.patch) by @AndrewAtLarge created at 2012-10-31 06:38:57\n\nFixing fuzz in applying patch",
    "created_at": "2012-10-31T06:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-124804",
    "user": "@AndrewAtLarge"
}
```

Attachment [trac_11476--fixing-partition-tuples_cardinality-am.patch](tarball://root/attachments/some-uuid/ticket11476/trac_11476--fixing-partition-tuples_cardinality-am.patch) by @AndrewAtLarge created at 2012-10-31 06:38:57

Fixing fuzz in applying patch



---

archive/issue_comments_124805.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-11-13T08:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-124805",
    "user": "@jdemeyer"
}
```

Resolution: fixed
