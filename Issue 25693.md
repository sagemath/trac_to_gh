# Issue 25693: implementation of different basis of WQSym

archive/issues_025693.json:
```json
{
    "body": "CC:  @tscrim @darijgr @zabrocki @alauve amypang hmlodecki fhivert vivianepons @embray @fchapoton @mantepse\n\nKeywords: sagedays@icerm, packed words, ordered set partition, CHAs, WQSym,\n\nThis ticket is created to implement different basis of WQSym defined by Yannic Vargas  (F, G, E, H...) for the autoduality of WQSym.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25930\n\n",
    "created_at": "2018-07-25T21:25:17Z",
    "labels": [
        "combinatorics",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "implementation of different basis of WQSym",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25693",
    "user": "hmlodecki"
}
```
CC:  @tscrim @darijgr @zabrocki @alauve amypang hmlodecki fhivert vivianepons @embray @fchapoton @mantepse

Keywords: sagedays@icerm, packed words, ordered set partition, CHAs, WQSym,

This ticket is created to implement different basis of WQSym defined by Yannic Vargas  (F, G, E, H...) for the autoduality of WQSym.

Issue created by migration from https://trac.sagemath.org/ticket/25930





---

archive/issue_comments_362601.json:
```json
{
    "body": "The first thing I'm going to do is split the `wqsym` file into several files because there will be too many different bases after that.",
    "created_at": "2019-01-17T15:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25693#issuecomment-362601",
    "user": "hmlodecki"
}
```

The first thing I'm going to do is split the `wqsym` file into several files because there will be too many different bases after that.



---

archive/issue_comments_362602.json:
```json
{
    "body": "Replying to [comment:2 hmlodecki]:\n> The first thing I'm going to do is split the `wqsym` file into several files because there will be too many different bases after that.\n\nI might consider thinking a little more on that. If the various bases do not require a lot of code, then the file might still remain (relatively) small. Having one file makes maintenance a little easier by having the code (and hence the documentation) more localized. I am not saying you shouldn't, but just that it might be better to see about splitting it after you add the additional bases.",
    "created_at": "2019-01-17T16:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25693#issuecomment-362602",
    "user": "@tscrim"
}
```

Replying to [comment:2 hmlodecki]:
> The first thing I'm going to do is split the `wqsym` file into several files because there will be too many different bases after that.

I might consider thinking a little more on that. If the various bases do not require a lot of code, then the file might still remain (relatively) small. Having one file makes maintenance a little easier by having the code (and hence the documentation) more localized. I am not saying you shouldn't, but just that it might be better to see about splitting it after you add the additional bases.



---

archive/issue_comments_362603.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2019-01-17T17:17:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25693#issuecomment-362603",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_362604.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-18T14:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25693#issuecomment-362604",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362605.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-21T17:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25693#issuecomment-362605",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362606.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-28T15:12:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25693#issuecomment-362606",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362607.json:
```json
{
    "body": "Made branch public. (I hope I did this correctly.)",
    "created_at": "2019-01-31T23:14:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25693#issuecomment-362607",
    "user": "@alauve"
}
```

Made branch public. (I hope I did this correctly.)



---

archive/issue_comments_362608.json:
```json
{
    "body": "Oh, I see it probably wasn't yet meant for public consumption. My apologies!\nLet me know, Hugo, where I can help.",
    "created_at": "2019-01-31T23:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25693#issuecomment-362608",
    "user": "@alauve"
}
```

Oh, I see it probably wasn't yet meant for public consumption. My apologies!
Let me know, Hugo, where I can help.



---

archive/issue_comments_362609.json:
```json
{
    "body": "The only difference between a public branch and a trac-name branch is that anyone can push to a public. Otherwise they can pull and then set their own branch here.",
    "created_at": "2019-01-31T23:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25693#issuecomment-362609",
    "user": "@tscrim"
}
```

The only difference between a public branch and a trac-name branch is that anyone can push to a public. Otherwise they can pull and then set their own branch here.



---

archive/issue_comments_362610.json:
```json
{
    "body": "Replying to [comment:11 alauve]:\n> Oh, I see it probably wasn't yet meant for public consumption. My apologies!\n> Let me know, Hugo, where I can help.\n\n\nFor now I'm steel working on having a first correct base, I've chosen the H basis, but I'm confronted to some complexity issues that I think is due to the convertions into `PackedWords`...\nI have a lot of comments in french but the main problem is that in this version there is this test \n\n```\nsage: t0 = time.time(); m4HQ = matr_chgmt_base_osp(H,Q,4); print time.time() - t0; m4QH = matr_chgm\n....: t_base_osp(Q,H,4); print time.time() - t0\n16.4242839813\n51.6398468018\n```\n\nand in my personel version where I've impleted WQSym on `Packed Words` I have these times :\n\n```\nsage: t0 = time.time(); m4HQ = matr_chgmt_base_pw(GL,L,4); print\n....:  time.time() - t0; m4QH = matr_chgmt_base_pw(L,GL,4); prin\n....: t time.time() - t0\n6.23473000526\n13.2976300716\n```\n\n\nI do not really know how to get around the problem...",
    "created_at": "2019-02-01T15:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25693#issuecomment-362610",
    "user": "hmlodecki"
}
```

Replying to [comment:11 alauve]:
> Oh, I see it probably wasn't yet meant for public consumption. My apologies!
> Let me know, Hugo, where I can help.


For now I'm steel working on having a first correct base, I've chosen the H basis, but I'm confronted to some complexity issues that I think is due to the convertions into `PackedWords`...
I have a lot of comments in french but the main problem is that in this version there is this test 

```
sage: t0 = time.time(); m4HQ = matr_chgmt_base_osp(H,Q,4); print time.time() - t0; m4QH = matr_chgm
....: t_base_osp(Q,H,4); print time.time() - t0
16.4242839813
51.6398468018
```

and in my personel version where I've impleted WQSym on `Packed Words` I have these times :

```
sage: t0 = time.time(); m4HQ = matr_chgmt_base_pw(GL,L,4); print
....:  time.time() - t0; m4QH = matr_chgmt_base_pw(L,GL,4); prin
....: t time.time() - t0
6.23473000526
13.2976300716
```


I do not really know how to get around the problem...



---

archive/issue_comments_362611.json:
```json
{
    "body": "Do you suppose this is coming from the fact that you cannot simply write \"unitriangular=true\" in the change of basis code to setup the inverse change-of-basis? (For those unaware, the ordering used for PackedWords is different from the ordering on set compositions... at least, for the standard bijection between the two.)\n\nOr do you think it is a different problem?\n\nHow about adding a ``@`cached_method` flag?",
    "created_at": "2019-02-04T14:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25693#issuecomment-362611",
    "user": "@alauve"
}
```

Do you suppose this is coming from the fact that you cannot simply write "unitriangular=true" in the change of basis code to setup the inverse change-of-basis? (For those unaware, the ordering used for PackedWords is different from the ordering on set compositions... at least, for the standard bijection between the two.)

Or do you think it is a different problem?

How about adding a ``@`cached_method` flag?



---

archive/issue_comments_362612.json:
```json
{
    "body": "Replying to [comment:14 alauve]:\n> Do you suppose this is coming from the fact that you cannot simply write \"unitriangular=true\" in the change of basis code to setup the inverse change-of-basis? (For those unaware, the ordering used for `PackedWords` is different from the ordering on set compositions... at least, for the standard bijection between the two.)\n> \n> Or do you think it is a different problem?\n> \n> How about adding a ``@`cached_method` flag?\n\n\nI thought my method was cached but you are right, it was only this... Thank you for suggesting it!\nDo you think this solution of `new_rank` is a good solution ?",
    "created_at": "2019-02-04T15:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25693#issuecomment-362612",
    "user": "hmlodecki"
}
```

Replying to [comment:14 alauve]:
> Do you suppose this is coming from the fact that you cannot simply write "unitriangular=true" in the change of basis code to setup the inverse change-of-basis? (For those unaware, the ordering used for `PackedWords` is different from the ordering on set compositions... at least, for the standard bijection between the two.)
> 
> Or do you think it is a different problem?
> 
> How about adding a ``@`cached_method` flag?


I thought my method was cached but you are right, it was only this... Thank you for suggesting it!
Do you think this solution of `new_rank` is a good solution ?



---

archive/issue_comments_362613.json:
```json
{
    "body": "Replying to [comment:15 hmlodecki]:\n> \n> I thought my method was cached but you are right, it was only this... Thank you for suggesting it!\n> Do you think this solution of `new_rank` is a good solution ?\n\nI thought it was a great idea! Yet, it didn't give you much speedup? \nIn your original code (implemented with packed words), do you have the change of basis method cached or not?\n\nPerhaps it would be good to use `%prun` or `runsnake` to see where most of the time is being spent? ([Profiling](http://doc.sagemath.org/html/en/thematic_tutorials/profiling.html))",
    "created_at": "2019-02-04T15:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25693#issuecomment-362613",
    "user": "@alauve"
}
```

Replying to [comment:15 hmlodecki]:
> 
> I thought my method was cached but you are right, it was only this... Thank you for suggesting it!
> Do you think this solution of `new_rank` is a good solution ?

I thought it was a great idea! Yet, it didn't give you much speedup? 
In your original code (implemented with packed words), do you have the change of basis method cached or not?

Perhaps it would be good to use `%prun` or `runsnake` to see where most of the time is being spent? ([Profiling](http://doc.sagemath.org/html/en/thematic_tutorials/profiling.html))



---

archive/issue_comments_362614.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-13T11:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25693#issuecomment-362614",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362615.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-27T16:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25693#issuecomment-362615",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362616.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-18T13:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25693#issuecomment-362616",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_362617.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-18T13:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25693",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25693#issuecomment-362617",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:
