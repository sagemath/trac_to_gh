# Issue 31345: Some improvements in QuaternionFractionalIdeal_rational

archive/issues_031345.json:
```json
{
    "body": "CC:  @orlitzky\n\nKeywords: quaternion algebra\n\nIn SageMath 9.3.rc0:\n\n```\nsage: BrandtModule(23).right_ideals()[0].parent() is None\nTrue\n```\n\nThe attached branch fixes this by calling `Ideal_fractional.__init__()`.  This also means that the attributes `__basis` and `__quaternion_algebra` are no longer needed.\n\nTwo related improvements:\n- implement `_richcmp_` rather than `__eq__` and `__ne__`\n- add an explicit argument to `__init__` to specify the ambient quaternion algebra, instead of deducing it from the generators.\n\nIssue created by migration from https://trac.sagemath.org/ticket/31582\n\n",
    "created_at": "2021-03-30T18:13:26Z",
    "labels": [
        "component: algebra",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Some improvements in QuaternionFractionalIdeal_rational",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31345",
    "user": "https://github.com/pjbruin"
}
```
CC:  @orlitzky

Keywords: quaternion algebra

In SageMath 9.3.rc0:

```
sage: BrandtModule(23).right_ideals()[0].parent() is None
True
```

The attached branch fixes this by calling `Ideal_fractional.__init__()`.  This also means that the attributes `__basis` and `__quaternion_algebra` are no longer needed.

Two related improvements:
- implement `_richcmp_` rather than `__eq__` and `__ne__`
- add an explicit argument to `__init__` to specify the ambient quaternion algebra, instead of deducing it from the generators.

Issue created by migration from https://trac.sagemath.org/ticket/31582





---

archive/issue_comments_447944.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-03-30T18:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31345#issuecomment-447944",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_447945.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-01T08:58:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31345#issuecomment-447945",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447946.json:
```json
{
    "body": "I didn't know what a Brandt module is, so I found a typo (j,j) in the docs (sage.modular.quatalg.brandt):\n\n\n```\n``A = QuaternionAlgebra(k,a,b)`` returns a quaternion algebra with basis\n`\\{1,i,j,j\\}` over `\\mathbb{K}` such that `i^2=a`, `j^2=b` and `ij=k.`\n```\n\n\nWant to fix that while you're in there? The algebra is over my head, but the refactoring looks reasonable even if I ignore what the words mean.",
    "created_at": "2021-04-02T19:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31345#issuecomment-447946",
    "user": "https://github.com/orlitzky"
}
```

I didn't know what a Brandt module is, so I found a typo (j,j) in the docs (sage.modular.quatalg.brandt):


```
``A = QuaternionAlgebra(k,a,b)`` returns a quaternion algebra with basis
`\{1,i,j,j\}` over `\mathbb{K}` such that `i^2=a`, `j^2=b` and `ij=k.`
```


Want to fix that while you're in there? The algebra is over my head, but the refactoring looks reasonable even if I ignore what the words mean.



---

archive/issue_comments_447947.json:
```json
{
    "body": "Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage",
    "created_at": "2021-04-02T20:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31345#issuecomment-447947",
    "user": "https://github.com/mkoeppe"
}
```

Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage



---

archive/issue_comments_447948.json:
```json
{
    "body": "Replying to [comment:3 mjo]:\n> I didn't know what a Brandt module is, so I found a typo (j,j) in the docs (sage.modular.quatalg.brandt):\n> \n> {{{\n> ``A = QuaternionAlgebra(k,a,b)`` returns a quaternion algebra with basis\n> `\\{1,i,j,j\\}` over `\\mathbb{K}` such that `i^2=a`, `j^2=b` and `ij=k.`\n> }}}\n> \n> Want to fix that while you're in there? The algebra is over my head, but the refactoring looks reasonable even if I ignore what the words mean.\nWhile fixing this I spotted several other things in the documentation and code of `sage.modular.quatalg.brandt` that I would like to fix, so I prefer making that a separate ticket.",
    "created_at": "2021-04-03T09:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31345#issuecomment-447948",
    "user": "https://github.com/pjbruin"
}
```

Replying to [comment:3 mjo]:
> I didn't know what a Brandt module is, so I found a typo (j,j) in the docs (sage.modular.quatalg.brandt):
> 
> {{{
> ``A = QuaternionAlgebra(k,a,b)`` returns a quaternion algebra with basis
> `\{1,i,j,j\}` over `\mathbb{K}` such that `i^2=a`, `j^2=b` and `ij=k.`
> }}}
> 
> Want to fix that while you're in there? The algebra is over my head, but the refactoring looks reasonable even if I ignore what the words mean.
While fixing this I spotted several other things in the documentation and code of `sage.modular.quatalg.brandt` that I would like to fix, so I prefer making that a separate ticket.



---

archive/issue_comments_447949.json:
```json
{
    "body": "The only code changes that I personally would make are,\n\n\n```patch\ndiff --git a/src/sage/algebras/quatalg/quaternion_algebra.py b/src/sage/algebra$\nindex d085639334..969867e67d 100644\n--- a/src/sage/algebras/quatalg/quaternion_algebra.py\n+++ b/src/sage/algebras/quatalg/quaternion_algebra.py\n@@ -1842,7 +1842,7 @@ class QuaternionFractionalIdeal_rational(QuaternionFracti$\n                            (QQ**4).span([Q(v).coefficient_tuple() for v in bas$\n         self.__left_order = left_order\n         self.__right_order = right_order\n-        Ideal_fractional.__init__(self, Q, basis)\n+        super().__init__(Q, basis)\n\n     def scale(self, alpha, left=False):\n         r\"\"\"\n@@ -1897,7 +1897,7 @@ class QuaternionFractionalIdeal_rational(QuaternionFracti$\n             sage: I.quaternion_algebra()\n             Quaternion Algebra (-1, -3) with base ring Rational Field\n         \"\"\"\n-        return Ideal_fractional.ring(self)\n+        return super().ring()\n\n     def _compute_order(self, side='left'):\n```\n\n\nBut either way is fine.\n\nAlso, in your second commit, you added a colon and not a semicolon as the commit message states. Aside from that and pending a ptestlong, it all LGTM.",
    "created_at": "2021-04-03T18:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31345#issuecomment-447949",
    "user": "https://github.com/orlitzky"
}
```

The only code changes that I personally would make are,


```patch
diff --git a/src/sage/algebras/quatalg/quaternion_algebra.py b/src/sage/algebra$
index d085639334..969867e67d 100644
--- a/src/sage/algebras/quatalg/quaternion_algebra.py
+++ b/src/sage/algebras/quatalg/quaternion_algebra.py
@@ -1842,7 +1842,7 @@ class QuaternionFractionalIdeal_rational(QuaternionFracti$
                            (QQ**4).span([Q(v).coefficient_tuple() for v in bas$
         self.__left_order = left_order
         self.__right_order = right_order
-        Ideal_fractional.__init__(self, Q, basis)
+        super().__init__(Q, basis)

     def scale(self, alpha, left=False):
         r"""
@@ -1897,7 +1897,7 @@ class QuaternionFractionalIdeal_rational(QuaternionFracti$
             sage: I.quaternion_algebra()
             Quaternion Algebra (-1, -3) with base ring Rational Field
         """
-        return Ideal_fractional.ring(self)
+        return super().ring()

     def _compute_order(self, side='left'):
```


But either way is fine.

Also, in your second commit, you added a colon and not a semicolon as the commit message states. Aside from that and pending a ptestlong, it all LGTM.



---

archive/issue_comments_447950.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-04-05T11:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31345#issuecomment-447950",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_447951.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:",
    "created_at": "2021-04-06T08:56:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31345#issuecomment-447951",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:



---

archive/issue_comments_447952.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-04-06T08:56:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31345#issuecomment-447952",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_447953.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-04-06T08:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31345#issuecomment-447953",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_447954.json:
```json
{
    "body": "Replying to [comment:6 mjo]:\n> The only code changes that I personally would make are,\n> \n> {{{#!patch\n> diff --git a/src/sage/algebras/quatalg/quaternion_algebra.py b/src/sage/algebra$\n> index d085639334..969867e67d 100644\n> --- a/src/sage/algebras/quatalg/quaternion_algebra.py\n> +++ b/src/sage/algebras/quatalg/quaternion_algebra.py\n> `@``@` -1842,7 +1842,7 `@``@` class QuaternionFractionalIdeal_rational(QuaternionFracti$\n>                             (QQ**4).span([Q(v).coefficient_tuple() for v in bas$\n>          self.__left_order = left_order\n>          self.__right_order = right_order\n> -        Ideal_fractional.__init__(self, Q, basis)\n> +        super().__init__(Q, basis)\n> \n>      def scale(self, alpha, left=False):\n>          r\"\"\"\n> `@``@` -1897,7 +1897,7 `@``@` class QuaternionFractionalIdeal_rational(QuaternionFracti$\n>              sage: I.quaternion_algebra()\n>              Quaternion Algebra (-1, -3) with base ring Rational Field\n>          \"\"\"\n> -        return Ideal_fractional.ring(self)\n> +        return super().ring()\n> \n>      def _compute_order(self, side='left'):\n> }}}\n> \n> But either way is fine.\n\nI personally slightly prefer being explicit about the class instead of using `super()`, but this is just a matter of taste.\n\n> Also, in your second commit, you added a colon and not a semicolon as the commit message states. Aside from that and pending a ptestlong, it all LGTM.\n\nThanks.  I merged this commit into the first one (hence the forced push).",
    "created_at": "2021-04-06T08:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31345#issuecomment-447954",
    "user": "https://github.com/pjbruin"
}
```

Replying to [comment:6 mjo]:
> The only code changes that I personally would make are,
> 
> {{{#!patch
> diff --git a/src/sage/algebras/quatalg/quaternion_algebra.py b/src/sage/algebra$
> index d085639334..969867e67d 100644
> --- a/src/sage/algebras/quatalg/quaternion_algebra.py
> +++ b/src/sage/algebras/quatalg/quaternion_algebra.py
> `@``@` -1842,7 +1842,7 `@``@` class QuaternionFractionalIdeal_rational(QuaternionFracti$
>                             (QQ**4).span([Q(v).coefficient_tuple() for v in bas$
>          self.__left_order = left_order
>          self.__right_order = right_order
> -        Ideal_fractional.__init__(self, Q, basis)
> +        super().__init__(Q, basis)
> 
>      def scale(self, alpha, left=False):
>          r"""
> `@``@` -1897,7 +1897,7 `@``@` class QuaternionFractionalIdeal_rational(QuaternionFracti$
>              sage: I.quaternion_algebra()
>              Quaternion Algebra (-1, -3) with base ring Rational Field
>          """
> -        return Ideal_fractional.ring(self)
> +        return super().ring()
> 
>      def _compute_order(self, side='left'):
> }}}
> 
> But either way is fine.

I personally slightly prefer being explicit about the class instead of using `super()`, but this is just a matter of taste.

> Also, in your second commit, you added a colon and not a semicolon as the commit message states. Aside from that and pending a ptestlong, it all LGTM.

Thanks.  I merged this commit into the first one (hence the forced push).



---

archive/issue_comments_447955.json:
```json
{
    "body": "Promoting the oldest 5 positively reviewed tickets to \"major\"",
    "created_at": "2021-07-19T20:57:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31345#issuecomment-447955",
    "user": "https://github.com/mkoeppe"
}
```

Promoting the oldest 5 positively reviewed tickets to "major"



---

archive/issue_comments_447956.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-23T20:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31345#issuecomment-447956",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_028664.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-23T20:11:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31345",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31345#event-28664"
}
```
