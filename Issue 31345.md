# Issue 31345: Some improvements in QuaternionFractionalIdeal_rational

Issue created by migration from https://trac.sagemath.org/ticket/31582

Original creator: pbruin

Original creation time: 2021-03-30 18:13:26

CC:  mjo

Keywords: quaternion algebra

In SageMath 9.3.rc0:

```
sage: BrandtModule(23).right_ideals()[0].parent() is None
True
```

The attached branch fixes this by calling `Ideal_fractional.__init__()`.  This also means that the attributes `__basis` and `__quaternion_algebra` are no longer needed.

Two related improvements:
- implement `_richcmp_` rather than `__eq__` and `__ne__`
- add an explicit argument to `__init__` to specify the ambient quaternion algebra, instead of deducing it from the generators.


---

Comment by pbruin created at 2021-03-30 18:16:11

Changing status from new to needs_review.


---

Comment by git created at 2021-04-01 08:58:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mjo created at 2021-04-02 19:42:51

I didn't know what a Brandt module is, so I found a typo (j,j) in the docs (sage.modular.quatalg.brandt):


```
``A = QuaternionAlgebra(k,a,b)`` returns a quaternion algebra with basis
`\{1,i,j,j\}` over `\mathbb{K}` such that `i^2=a`, `j^2=b` and `ij=k.`
```


Want to fix that while you're in there? The algebra is over my head, but the refactoring looks reasonable even if I ignore what the words mean.


---

Comment by mkoeppe created at 2021-04-02 20:21:54

Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage


---

Comment by pbruin created at 2021-04-03 09:45:00

Replying to [comment:3 mjo]:
> I didn't know what a Brandt module is, so I found a typo (j,j) in the docs (sage.modular.quatalg.brandt):
> 
> {{{
> ``A = QuaternionAlgebra(k,a,b)`` returns a quaternion algebra with basis
> `\{1,i,j,j\}` over `\mathbb{K}` such that `i^2=a`, `j^2=b` and `ij=k.`
> }}}
> 
> Want to fix that while you're in there? The algebra is over my head, but the refactoring looks reasonable even if I ignore what the words mean.
While fixing this I spotted several other things in the documentation and code of `sage.modular.quatalg.brandt` that I would like to fix, so I prefer making that a separate ticket.


---

Comment by mjo created at 2021-04-03 18:58:30

The only code changes that I personally would make are,


```patch
diff --git a/src/sage/algebras/quatalg/quaternion_algebra.py b/src/sage/algebra$
index d085639334..969867e67d 100644
--- a/src/sage/algebras/quatalg/quaternion_algebra.py
+++ b/src/sage/algebras/quatalg/quaternion_algebra.py
@@ -1842,7 +1842,7 @@ class QuaternionFractionalIdeal_rational(QuaternionFracti$
                            (QQ**4).span([Q(v).coefficient_tuple() for v in bas$
         self.__left_order = left_order
         self.__right_order = right_order
-        Ideal_fractional.__init__(self, Q, basis)
+        super().__init__(Q, basis)

     def scale(self, alpha, left=False):
         r"""
@@ -1897,7 +1897,7 @@ class QuaternionFractionalIdeal_rational(QuaternionFracti$
             sage: I.quaternion_algebra()
             Quaternion Algebra (-1, -3) with base ring Rational Field
         """
-        return Ideal_fractional.ring(self)
+        return super().ring()

     def _compute_order(self, side='left'):
```


But either way is fine.

Also, in your second commit, you added a colon and not a semicolon as the commit message states. Aside from that and pending a ptestlong, it all LGTM.


---

Comment by mjo created at 2021-04-05 11:17:31

Changing status from needs_review to positive_review.


---

Comment by git created at 2021-04-06 08:56:16

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:


---

Comment by git created at 2021-04-06 08:56:16

Changing status from positive_review to needs_review.


---

Comment by pbruin created at 2021-04-06 08:58:58

Changing status from needs_review to positive_review.


---

Comment by pbruin created at 2021-04-06 08:58:58

Replying to [comment:6 mjo]:
> The only code changes that I personally would make are,
> 
> {{{#!patch
> diff --git a/src/sage/algebras/quatalg/quaternion_algebra.py b/src/sage/algebra$
> index d085639334..969867e67d 100644
> --- a/src/sage/algebras/quatalg/quaternion_algebra.py
> +++ b/src/sage/algebras/quatalg/quaternion_algebra.py
> `@``@` -1842,7 +1842,7 `@``@` class QuaternionFractionalIdeal_rational(QuaternionFracti$
>                             (QQ**4).span([Q(v).coefficient_tuple() for v in bas$
>          self.__left_order = left_order
>          self.__right_order = right_order
> -        Ideal_fractional.__init__(self, Q, basis)
> +        super().__init__(Q, basis)
> 
>      def scale(self, alpha, left=False):
>          r"""
> `@``@` -1897,7 +1897,7 `@``@` class QuaternionFractionalIdeal_rational(QuaternionFracti$
>              sage: I.quaternion_algebra()
>              Quaternion Algebra (-1, -3) with base ring Rational Field
>          """
> -        return Ideal_fractional.ring(self)
> +        return super().ring()
> 
>      def _compute_order(self, side='left'):
> }}}
> 
> But either way is fine.

I personally slightly prefer being explicit about the class instead of using `super()`, but this is just a matter of taste.

> Also, in your second commit, you added a colon and not a semicolon as the commit message states. Aside from that and pending a ptestlong, it all LGTM.

Thanks.  I merged this commit into the first one (hence the forced push).


---

Comment by mkoeppe created at 2021-07-19 20:57:02

Promoting the oldest 5 positively reviewed tickets to "major"


---

Comment by mkoeppe created at 2021-07-19 20:57:02

Changing priority from minor to major.


---

Comment by vbraun created at 2021-07-23 20:11:24

Resolution: fixed
