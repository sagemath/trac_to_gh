# Issue 15635: Let cddlib build a shared lib on Cygwin.

archive/issues_015635.json:
```json
{
    "body": "Follow up to #13354 and #13026.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15872\n\n",
    "created_at": "2014-02-27T10:16:02Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Let cddlib build a shared lib on Cygwin.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15635",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```
Follow up to #13354 and #13026.

Issue created by migration from https://trac.sagemath.org/ticket/15872





---

archive/issue_events_046700.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15635#event-46700"
}
```



---

archive/issue_events_046701.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15635#event-46701"
}
```



---

archive/issue_events_046702.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15635#event-46702"
}
```



---

archive/issue_events_046703.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2016-11-23T10:36:33Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15635#event-46703"
}
```



---

archive/issue_comments_202089.json:
```json
{
    "body": "Changing component from packages: standard to porting: Cygwin.",
    "created_at": "2016-11-23T10:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15635#issuecomment-202089",
    "user": "https://github.com/embray"
}
```

Changing component from packages: standard to porting: Cygwin.



---

archive/issue_comments_202090.json:
```json
{
    "body": "Interesting that there's already a ticket for this.  I've basically done the work needed for this, but a mere patch won't suffice--I think the cddlib source package needs to be rebuilt to have any hope at resolving this.  See https://groups.google.com/d/msg/sage-devel/uHsTOd5sTxY/ivpNHT1MAwAJ",
    "created_at": "2016-11-23T10:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15635#issuecomment-202090",
    "user": "https://github.com/embray"
}
```

Interesting that there's already a ticket for this.  I've basically done the work needed for this, but a mere patch won't suffice--I think the cddlib source package needs to be rebuilt to have any hope at resolving this.  See https://groups.google.com/d/msg/sage-devel/uHsTOd5sTxY/ivpNHT1MAwAJ



---

archive/issue_comments_202091.json:
```json
{
    "body": "Set assignee to @embray.",
    "created_at": "2016-11-23T10:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15635#issuecomment-202091",
    "user": "https://github.com/embray"
}
```

Set assignee to @embray.



---

archive/issue_comments_202092.json:
```json
{
    "body": "Changing keywords from \"\" to \"cddlib windows cygwin\".",
    "created_at": "2016-11-23T10:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15635#issuecomment-202092",
    "user": "https://github.com/embray"
}
```

Changing keywords from "" to "cddlib windows cygwin".



---

archive/issue_comments_202093.json:
```json
{
    "body": "FWIW these are the basic changes that are needed:\n\n```diff\ndiff -u a/configure.in b/configure.in\n--- a/configure.in      2016-11-23 11:40:16.064457900 +0100\n+++ b/configure.in      2016-11-22 16:39:29.311747000 +0100\n@@ -7,7 +7,18 @@\n dnl Checks for programs.\n AC_PROG_CC\n AC_PROG_INSTALL\n-LT_INIT\n+LT_INIT([win32-dll])\n+\n+AC_CANONICAL_HOST\n+dnl libtool requires \"-no-undefined\" for win32 dll\n+AC_SUBST(CDD_LDFLAGS)\n+case $host_os in\n+  *cygwin* | *mingw*)\n+    if test x\"$enable_shared\" = xyes; then\n+      CDD_LDFLAGS=\"$CDD_LDFLAGS -no-undefined\"\n+    fi\n+;;\n+esac\n\n dnl Checks for libraries.\n dnl Replace `main' with a function in -lg:\ndiff -u a/lib-src/Makefile.am b/lib-src/Makefile.am\n--- a/lib-src/Makefile.am       2016-11-23 11:40:40.796141400 +0100\n+++ b/lib-src/Makefile.am       2016-11-23 11:43:44.183481400 +0100\n@@ -10,6 +10,8 @@\n setoper.c \\\n random.c\n\n+libcdd_la_LDFLAGS = $(CDD_LDFLAGS)\n+\n include_HEADERS = \\\n cdd.h \\\n cddmp.h \\\ndiff -u a/lib-src-gmp/Makefile.am b/lib-src-gmp/Makefile.am\n--- a/lib-src-gmp/Makefile.am   2016-11-23 11:40:45.065312300 +0100\n+++ b/lib-src-gmp/Makefile.am   2016-11-17 17:00:16.713039400 +0100\n@@ -16,6 +16,8 @@\n setoper.c \\\n random.c\n\n+libcddgmp_la_LDFLAGS = $(CDD_LDFLAGS)\n+\n include_HEADERS = \\\n cdd.h \\\n cddmp.h \\\n```",
    "created_at": "2016-11-23T10:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15635#issuecomment-202093",
    "user": "https://github.com/embray"
}
```

FWIW these are the basic changes that are needed:

```diff
diff -u a/configure.in b/configure.in
--- a/configure.in      2016-11-23 11:40:16.064457900 +0100
+++ b/configure.in      2016-11-22 16:39:29.311747000 +0100
@@ -7,7 +7,18 @@
 dnl Checks for programs.
 AC_PROG_CC
 AC_PROG_INSTALL
-LT_INIT
+LT_INIT([win32-dll])
+
+AC_CANONICAL_HOST
+dnl libtool requires "-no-undefined" for win32 dll
+AC_SUBST(CDD_LDFLAGS)
+case $host_os in
+  *cygwin* | *mingw*)
+    if test x"$enable_shared" = xyes; then
+      CDD_LDFLAGS="$CDD_LDFLAGS -no-undefined"
+    fi
+;;
+esac

 dnl Checks for libraries.
 dnl Replace `main' with a function in -lg:
diff -u a/lib-src/Makefile.am b/lib-src/Makefile.am
--- a/lib-src/Makefile.am       2016-11-23 11:40:40.796141400 +0100
+++ b/lib-src/Makefile.am       2016-11-23 11:43:44.183481400 +0100
@@ -10,6 +10,8 @@
 setoper.c \
 random.c

+libcdd_la_LDFLAGS = $(CDD_LDFLAGS)
+
 include_HEADERS = \
 cdd.h \
 cddmp.h \
diff -u a/lib-src-gmp/Makefile.am b/lib-src-gmp/Makefile.am
--- a/lib-src-gmp/Makefile.am   2016-11-23 11:40:45.065312300 +0100
+++ b/lib-src-gmp/Makefile.am   2016-11-17 17:00:16.713039400 +0100
@@ -16,6 +16,8 @@
 setoper.c \
 random.c

+libcddgmp_la_LDFLAGS = $(CDD_LDFLAGS)
+
 include_HEADERS = \
 cdd.h \
 cddmp.h \
```



---

archive/issue_comments_202094.json:
```json
{
    "body": "Adding the changes needed for building shared libs on Cygwin is going to require #21952.",
    "created_at": "2016-11-23T15:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15635#issuecomment-202094",
    "user": "https://github.com/embray"
}
```

Adding the changes needed for building shared libs on Cygwin is going to require #21952.



---

archive/issue_comments_202095.json:
```json
{
    "body": "If you wouldn't mind, could you propose these changes as an issue at https://github.com/cddlib/cddlib?",
    "created_at": "2018-04-25T11:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15635#issuecomment-202095",
    "user": "https://github.com/saraedum"
}
```

If you wouldn't mind, could you propose these changes as an issue at https://github.com/cddlib/cddlib?



---

archive/issue_comments_202096.json:
```json
{
    "body": "I created https://github.com/cddlib/cddlib/issues/8 to track this issue upstream.",
    "created_at": "2018-05-14T15:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15635#issuecomment-202096",
    "user": "https://github.com/saraedum"
}
```

I created https://github.com/cddlib/cddlib/issues/8 to track this issue upstream.



---

archive/issue_comments_202097.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2018-07-04T17:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15635#issuecomment-202097",
    "user": "https://github.com/saraedum"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_202098.json:
```json
{
    "body": "Can this be closed now?",
    "created_at": "2018-07-04T17:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15635#issuecomment-202098",
    "user": "https://github.com/saraedum"
}
```

Can this be closed now?



---

archive/issue_comments_202099.json:
```json
{
    "body": "I wouldn't until/unless #25344 is closed/fixed.",
    "created_at": "2018-07-10T13:34:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15635#issuecomment-202099",
    "user": "https://github.com/embray"
}
```

I wouldn't until/unless #25344 is closed/fixed.



---

archive/issue_comments_202100.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2018-09-22T03:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15635#issuecomment-202100",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_202101.json:
```json
{
    "body": "#25344 is in.",
    "created_at": "2018-09-22T03:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15635#issuecomment-202101",
    "user": "https://github.com/mkoeppe"
}
```

#25344 is in.



---

archive/issue_events_046704.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-09-22T03:25:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15635#event-46704"
}
```



---

archive/issue_comments_202102.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-22T22:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15635#issuecomment-202102",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_046705.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-24T14:19:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15635#event-46705"
}
```



---

archive/issue_comments_202103.json:
```json
{
    "body": "Resolution: worksforme",
    "created_at": "2018-09-24T14:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15635#issuecomment-202103",
    "user": "https://github.com/embray"
}
```

Resolution: worksforme



---

archive/issue_comments_202104.json:
```json
{
    "body": "Just to confirm, this does appear to (still) have worked with #25344.",
    "created_at": "2018-09-24T14:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15635#issuecomment-202104",
    "user": "https://github.com/embray"
}
```

Just to confirm, this does appear to (still) have worked with #25344.
