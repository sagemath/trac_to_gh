# Issue 15635: Let cddlib build a shared lib on Cygwin.

Issue created by migration from Trac.

Original creator: jpflori

Original creation time: 2014-02-27 10:16:02

Follow up to #13354 and #13026.


---

Comment by embray created at 2016-11-23 10:36:33

Changing component from packages: standard to porting: Cygwin.


---

Comment by embray created at 2016-11-23 10:36:33

Interesting that there's already a ticket for this.  I've basically done the work needed for this, but a mere patch won't suffice--I think the cddlib source package needs to be rebuilt to have any hope at resolving this.  See https://groups.google.com/d/msg/sage-devel/uHsTOd5sTxY/ivpNHT1MAwAJ


---

Comment by embray created at 2016-11-23 10:36:33

Set assignee to embray.


---

Comment by embray created at 2016-11-23 10:37:12

Changing keywords from "" to "cddlib windows cygwin".


---

Comment by embray created at 2016-11-23 10:45:39

FWIW these are the basic changes that are needed:


```diff
diff -u a/configure.in b/configure.in
--- a/configure.in      2016-11-23 11:40:16.064457900 +0100
+++ b/configure.in      2016-11-22 16:39:29.311747000 +0100
`@``@` -7,7 +7,18 `@``@`
 dnl Checks for programs.
 AC_PROG_CC
 AC_PROG_INSTALL
-LT_INIT
+LT_INIT([win32-dll])
+
+AC_CANONICAL_HOST
+dnl libtool requires "-no-undefined" for win32 dll
+AC_SUBST(CDD_LDFLAGS)
+case $host_os in
+  *cygwin* | *mingw*)
+    if test x"$enable_shared" = xyes; then
+      CDD_LDFLAGS="$CDD_LDFLAGS -no-undefined"
+    fi
+;;
+esac

 dnl Checks for libraries.
 dnl Replace `main' with a function in -lg:
diff -u a/lib-src/Makefile.am b/lib-src/Makefile.am
--- a/lib-src/Makefile.am       2016-11-23 11:40:40.796141400 +0100
+++ b/lib-src/Makefile.am       2016-11-23 11:43:44.183481400 +0100
`@``@` -10,6 +10,8 `@``@`
 setoper.c \
 random.c

+libcdd_la_LDFLAGS = $(CDD_LDFLAGS)
+
 include_HEADERS = \
 cdd.h \
 cddmp.h \
diff -u a/lib-src-gmp/Makefile.am b/lib-src-gmp/Makefile.am
--- a/lib-src-gmp/Makefile.am   2016-11-23 11:40:45.065312300 +0100
+++ b/lib-src-gmp/Makefile.am   2016-11-17 17:00:16.713039400 +0100
`@``@` -16,6 +16,8 `@``@`
 setoper.c \
 random.c

+libcddgmp_la_LDFLAGS = $(CDD_LDFLAGS)
+
 include_HEADERS = \
 cdd.h \
 cddmp.h \
```



---

Comment by embray created at 2016-11-23 15:21:50

Adding the changes needed for building shared libs on Cygwin is going to require #21952.


---

Comment by saraedum created at 2018-04-25 11:51:03

If you wouldn't mind, could you propose these changes as an issue at https://github.com/cddlib/cddlib?


---

Comment by saraedum created at 2018-05-14 15:19:06

I created https://github.com/cddlib/cddlib/issues/8 to track this issue upstream.


---

Comment by saraedum created at 2018-07-04 17:10:22

Changing status from new to needs_info.


---

Comment by saraedum created at 2018-07-04 17:10:22

Can this be closed now?


---

Comment by embray created at 2018-07-10 13:34:07

I wouldn't until/unless #25344 is closed/fixed.


---

Comment by mkoeppe created at 2018-09-22 03:25:06

Changing status from needs_info to needs_review.


---

Comment by mkoeppe created at 2018-09-22 03:25:06

#25344 is in.


---

Comment by tscrim created at 2018-09-22 22:50:15

Changing status from needs_review to positive_review.


---

Comment by embray created at 2018-09-24 14:19:37

Resolution: worksforme


---

Comment by embray created at 2018-09-24 14:21:19

Just to confirm, this does appear to (still) have worked with #25344.
