# Issue 30615: remove six

Issue created by migration from https://trac.sagemath.org/ticket/30852

Original creator: tmonteil

Original creation time: 2020-11-02 15:45:31

The `six` package was part of the Python2-to-Python3 migration scaffolding. Since it is unlikely we will move back to supporting Python 2, we should remove it.


---

Comment by tmonteil created at 2020-11-02 18:02:32

Changing status from new to needs_review.


---

Comment by tmonteil created at 2020-11-02 18:02:32

New commits:


---

Comment by chapoton created at 2020-11-02 19:02:02

another unsafe ticket..

Would you please explain the change in character_art.py ?


---

Comment by tmonteil created at 2020-11-02 21:49:40

Replying to [comment:3 chapoton]:
> another unsafe ticket..
> 
> Would you please explain the change in character_art.py ?

According to https://six.readthedocs.io/#six.Iterator, in Python3 `six.Iterator` is an alias for `object`, so i simply removed the `six.Iterator` intermediate class so that `PrependIterator` directly inherits from Python object.


---

Comment by jhpalmieri created at 2020-11-02 22:47:13

Some packages list `six` as a build dependency, but that may be out-of-date information: `prompt_toolkit`, `packaging`, `sphinx`, `tox`, `notedown`, `matplotlib`, `html5lib`, `cycler`, `dateutil`, `traitlets`, `sagenb_export`. I took a very quick look at `sphinx` and `prompt_toolkit`, and I think we can remove `six` from their dependencies. I haven't looked at the others.


---

Comment by git created at 2020-11-03 10:25:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2020-11-03 10:27:54

Changing status from needs_review to needs_work.


---

Comment by tmonteil created at 2020-11-03 10:27:54

You are right. The last commit removes all occurencies of `six` in the dependencies, let me distclean and see the result.


---

Comment by chapoton created at 2020-11-03 13:25:03

at least sagenb_export uses six. I have made pull request there to remove this dependency

https://github.com/vbraun/ExportSageNB


---

Comment by tmonteil created at 2020-11-03 14:37:09

Here is what i have seen regarding packages indicating `six` as a dependency:

- seem not to depend on `six` anymore
  - prompt_toolkit
  - matplotlib

- require an upgrade from our side
  - traitlets
  - packaging (but not yet in a release)
  - cycler (but not in a release, as they did not release since 2016)

- require upstream to adapt
  - notedown
  - dateutil
  - tox
  - sagenb_export

Apparently, some packages depend on six but the dependency is not written in the dependency file (e.g. `sphinxcontrib_websupport`)


---

Comment by tmonteil created at 2020-11-03 14:44:44

Given that updating all packages will require various tickets, shall we restrict the scope of this ticket to "let sagelib not depend on six" (and keep only the first commit) ?


---

Comment by chapoton created at 2020-11-03 14:58:57

I would suggest so.


---

Comment by git created at 2020-11-03 16:33:58

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-11-03 20:03:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2020-11-03 20:04:42

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2020-11-04 10:29:45

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-11-04 10:29:45

ok, ca me parait bon.

Il faudra se debarasser de `iteritems` dans un autre ticket.


---

Comment by tmonteil created at 2020-11-04 15:30:22

Replying to [comment:15 chapoton]:
> ok, ca me parait bon.

Merci.

> Il faudra se debarasser de `iteritems` dans un autre ticket.

It was the plan for #30850, then i noticed that various files from `SAGE_ROOT/build/` were touched by #30627, so in order to avoid useless rebasing and confusion i decided to wait it to be merged before cleaning `__future__` import statements from `SAGE_ROOT/build/`.


---

Comment by tmonteil created at 2020-11-04 15:56:19

Or you mean in the `.pyx` files ?


---

Comment by chapoton created at 2020-11-04 16:45:44

I mean that

```
src/sage/categories/finite_dimensional_lie_algebras_with_basis.py:                            for key, coeff in elt.to_vector().iteritems():
src/sage/categories/finite_dimensional_modules_with_basis.py:            return self._from_dict({order[i]: c for i,c in vector.iteritems()})
src/sage/symbolic/relation.py:                    return [[v._sage_() == ex._sage_() for v,ex in d.iteritems()]
```

and this may involve our own `iteritem` defined somewhere in a pyx file.


---

Comment by vbraun created at 2020-11-22 15:06:16

Resolution: fixed
