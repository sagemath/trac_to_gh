# Issue 33515: Implement solid angle measure for two-dimensional cones

archive/issues_033515.json:
```json
{
    "body": "CC:  @yuan-zhou @mkoeppe\n\nKeywords: solid angle\n\nImplement the solid angle measure (the plane angle) of a two-dimensional cone, using the dot-product (trigonometry) formula. When the cone is not simplicial, it is decomposed into simplicial cones.\n\nFor example, the solid angle of the upper half plane (generated by three rays, hence not simplicial) `solid_angle_2d([[1,0],[0,1],[-1,0]])` is 1/2.\n\nIssue created by migration from https://trac.sagemath.org/ticket/33752\n\n",
    "created_at": "2022-04-25T01:23:21Z",
    "labels": [
        "geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Implement solid angle measure for two-dimensional cones",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33515",
    "user": "@allisonfitisone"
}
```
CC:  @yuan-zhou @mkoeppe

Keywords: solid angle

Implement the solid angle measure (the plane angle) of a two-dimensional cone, using the dot-product (trigonometry) formula. When the cone is not simplicial, it is decomposed into simplicial cones.

For example, the solid angle of the upper half plane (generated by three rays, hence not simplicial) `solid_angle_2d([[1,0],[0,1],[-1,0]])` is 1/2.

Issue created by migration from https://trac.sagemath.org/ticket/33752





---

archive/issue_comments_477181.json:
```json
{
    "body": "The only non-simplicial cones in 2d are the non-pointed cones, i.e., cones that contain a nontrivial subspace. So the answer is either 0, 1/2, or 1; no triangulation is needed.",
    "created_at": "2022-04-25T02:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477181",
    "user": "@mkoeppe"
}
```

The only non-simplicial cones in 2d are the non-pointed cones, i.e., cones that contain a nontrivial subspace. So the answer is either 0, 1/2, or 1; no triangulation is needed.



---

archive/issue_comments_477182.json:
```json
{
    "body": "Merged in #33656.",
    "created_at": "2022-04-26T19:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477182",
    "user": "@yuan-zhou"
}
```

Merged in #33656.



---

archive/issue_comments_477183.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-06T15:23:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477183",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477184.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-12T17:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477184",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477185.json:
```json
{
    "body": "When `P.is_exact() or isinstance(P, sage.rings.abc.SymbolicRing)`, the return type should be `SymbolicConstantsSubring` element",
    "created_at": "2022-05-12T17:28:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477185",
    "user": "@yuan-zhou"
}
```

When `P.is_exact() or isinstance(P, sage.rings.abc.SymbolicRing)`, the return type should be `SymbolicConstantsSubring` element



---

archive/issue_comments_477186.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-17T12:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477186",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477187.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-17T19:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477187",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477188.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-19T19:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477188",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477189.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-19T19:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477189",
    "user": "@allisonfitisone"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_477190.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-25T15:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477190",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477191.json:
```json
{
    "body": "\n```\n+                    var('a b')\n+                    eqn = (-a * v[0][0] - b * v[k][0] - v[j][0] == 0,\n+                           -a * v[0][1] - b * v[k][1] - v[j][1] == 0,\n+                           a >= 0,\n+                           b >= 0)\n+                    if solve(eqn, (a, b)):\n```\n\nBest not to use the general symbolics facility (`var`, `solve`) for linear algebra",
    "created_at": "2022-08-25T16:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477191",
    "user": "@mkoeppe"
}
```


```
+                    var('a b')
+                    eqn = (-a * v[0][0] - b * v[k][0] - v[j][0] == 0,
+                           -a * v[0][1] - b * v[k][1] - v[j][1] == 0,
+                           a >= 0,
+                           b >= 0)
+                    if solve(eqn, (a, b)):
```

Best not to use the general symbolics facility (`var`, `solve`) for linear algebra



---

archive/issue_comments_477192.json:
```json
{
    "body": "Functions that looks like this:\n\n```\n+        matrices = []\n+        for simplex in triangulation:\n+            matrices.append(matrix(A[i] for i in simplex if i != origin))\n+        return matrices\n```\n\n... are best rewritten as generators. https://realpython.com/introduction-to-python-generators/#understanding-generators",
    "created_at": "2022-08-25T16:26:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477192",
    "user": "@mkoeppe"
}
```

Functions that looks like this:

```
+        matrices = []
+        for simplex in triangulation:
+            matrices.append(matrix(A[i] for i in simplex if i != origin))
+        return matrices
```

... are best rewritten as generators. https://realpython.com/introduction-to-python-generators/#understanding-generators



---

archive/issue_comments_477193.json:
```json
{
    "body": "\n```\n+    This example shows that the cone in `\\RR^4` spanned by the rows of ``A``\n+    (which is input as a list of lists) is actually a halfspace of affine\n+    dimension `2`. The triangulation dissects it into three 2-d subcones::\n+\n+        sage: A_in = [[-3,0,5,0],[0,0,1,0],[-4,0,0,0],[-1,0,0,0],[0,0,-4,0]]\n+        sage: simplicial_subcones_decomposition(A_in)\n+        [\n+        [-3  0  5  0]  [-3  0  5  0]  [-4  0  0  0]\n+        [ 0  0  1  0], [-4  0  0  0], [ 0  0 -4  0]\n+        ]\n```\n\nThis decomposition looks correct, but I don't think this is the best way of computing the solid angle - as I explained in comment:1.",
    "created_at": "2022-08-25T16:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477193",
    "user": "@mkoeppe"
}
```


```
+    This example shows that the cone in `\RR^4` spanned by the rows of ``A``
+    (which is input as a list of lists) is actually a halfspace of affine
+    dimension `2`. The triangulation dissects it into three 2-d subcones::
+
+        sage: A_in = [[-3,0,5,0],[0,0,1,0],[-4,0,0,0],[-1,0,0,0],[0,0,-4,0]]
+        sage: simplicial_subcones_decomposition(A_in)
+        [
+        [-3  0  5  0]  [-3  0  5  0]  [-4  0  0  0]
+        [ 0  0  1  0], [-4  0  0  0], [ 0  0 -4  0]
+        ]
```

This decomposition looks correct, but I don't think this is the best way of computing the solid angle - as I explained in comment:1.



---

archive/issue_comments_477194.json:
```json
{
    "body": "All of this can be replaced by just using `Polyhedron(rays=A.rows())`. To see whether it is at least a halfplane, check `lines()`",
    "created_at": "2022-08-25T16:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477194",
    "user": "@mkoeppe"
}
```

All of this can be replaced by just using `Polyhedron(rays=A.rows())`. To see whether it is at least a halfplane, check `lines()`



---

archive/issue_comments_477195.json:
```json
{
    "body": "When using `Polyhedron(rays=A.rows())`, we can't do computations over SR (see below). Any suggestions for a workaround?\n\n```\nsage: A = matrix([[sqrt(2),0],[0,1]])\nsage: solid_angle_2d(A)\nValueError: no default backend for computations with Symbolic Ring\n```\n\n\nReplying to [comment:17 mkoeppe]:\n> All of this can be replaced by just using `Polyhedron(rays=A.rows())`. To see whether it is at least a halfplane, check `lines()`",
    "created_at": "2022-08-30T19:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477195",
    "user": "@allisonfitisone"
}
```

When using `Polyhedron(rays=A.rows())`, we can't do computations over SR (see below). Any suggestions for a workaround?

```
sage: A = matrix([[sqrt(2),0],[0,1]])
sage: solid_angle_2d(A)
ValueError: no default backend for computations with Symbolic Ring
```


Replying to [comment:17 mkoeppe]:
> All of this can be replaced by just using `Polyhedron(rays=A.rows())`. To see whether it is at least a halfplane, check `lines()`



---

archive/issue_comments_477196.json:
```json
{
    "body": "If you only need algebraic numbers, you can use `A = matrix(AA, [[sqrt(2),0],[0,1]])`",
    "created_at": "2022-08-30T19:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477196",
    "user": "@mkoeppe"
}
```

If you only need algebraic numbers, you can use `A = matrix(AA, [[sqrt(2),0],[0,1]])`



---

archive/issue_comments_477197.json:
```json
{
    "body": "Right, if the input is of type AA, then Polyhedron can deal with it, and the output is also of type AA. The question is, what if the input is just `A = matrix([[sqrt(2),0],[0,1]])`? Would it be better to avoid Polyhedron and just use more elementary operations like rank?\nReplying to [comment:19 mkoeppe]:\n> If you only need algebraic numbers, you can use `A = matrix(AA, [[sqrt(2),0],[0,1]])`",
    "created_at": "2022-08-30T20:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477197",
    "user": "@yuan-zhou"
}
```

Right, if the input is of type AA, then Polyhedron can deal with it, and the output is also of type AA. The question is, what if the input is just `A = matrix([[sqrt(2),0],[0,1]])`? Would it be better to avoid Polyhedron and just use more elementary operations like rank?
Replying to [comment:19 mkoeppe]:
> If you only need algebraic numbers, you can use `A = matrix(AA, [[sqrt(2),0],[0,1]])`



---

archive/issue_comments_477198.json:
```json
{
    "body": "Replying to [comment:20 yzh]:\n> Right, if the input is of type AA, then Polyhedron can deal with it, and the output is also of type AA. The question is, what if the input is just `A = matrix([[sqrt(2),0],[0,1]])`? \n\nWell, you can try to convert it to a matrix space over `AA`, and if that fails, just raise an error.\n\n> Would it be better to avoid Polyhedron and just use more elementary operations like rank?\n\nDo you have an application for non-algebraic irrational input?\n\nIf yes, then yes, one would have to either avoid Polyhedron or extend Polyhedron so it can handle well-behaved symbolic elements. After all, this error:\n\n```\nsage: Polyhedron(vertices=[[1], [sqrt(2)]], base_ring=SR, backend='field')\nValueError: the 'field' backend for polyhedron cannot be used with non-exact fields\n```\n\nis artificial - it's there to protect users from weird stuff that can happen.\n\nIf no, then maybe this generality is not worth working on?",
    "created_at": "2022-08-30T20:11:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477198",
    "user": "@mkoeppe"
}
```

Replying to [comment:20 yzh]:
> Right, if the input is of type AA, then Polyhedron can deal with it, and the output is also of type AA. The question is, what if the input is just `A = matrix([[sqrt(2),0],[0,1]])`? 

Well, you can try to convert it to a matrix space over `AA`, and if that fails, just raise an error.

> Would it be better to avoid Polyhedron and just use more elementary operations like rank?

Do you have an application for non-algebraic irrational input?

If yes, then yes, one would have to either avoid Polyhedron or extend Polyhedron so it can handle well-behaved symbolic elements. After all, this error:

```
sage: Polyhedron(vertices=[[1], [sqrt(2)]], base_ring=SR, backend='field')
ValueError: the 'field' backend for polyhedron cannot be used with non-exact fields
```

is artificial - it's there to protect users from weird stuff that can happen.

If no, then maybe this generality is not worth working on?



---

archive/issue_comments_477199.json:
```json
{
    "body": "You are right, I don't have an application where the input is non-algebraic irrationals. \n\nI agree that symbolics facility (`var` and `solve`) should be avoid.\n\nHowever, I thought that checking the special cases of half space and whole space is straightforward enough, which make the use of Polyhedron and the conversion to AA seem overkill. It's just some if else statements, and with that, the input `A = matrix([[sqrt(2),0],[0,1]])` can work. In my option, it's unusual to input `matrix(AA, [[sqrt(2),0],[0,1]])`. \n\nAlso, if we convert the inputs matrix to over AA, what would be the right type of the output? Do we always have AA as output type, never the Symbolic ring or Symbolic Constants Subring?",
    "created_at": "2022-08-30T21:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477199",
    "user": "@yuan-zhou"
}
```

You are right, I don't have an application where the input is non-algebraic irrationals. 

I agree that symbolics facility (`var` and `solve`) should be avoid.

However, I thought that checking the special cases of half space and whole space is straightforward enough, which make the use of Polyhedron and the conversion to AA seem overkill. It's just some if else statements, and with that, the input `A = matrix([[sqrt(2),0],[0,1]])` can work. In my option, it's unusual to input `matrix(AA, [[sqrt(2),0],[0,1]])`. 

Also, if we convert the inputs matrix to over AA, what would be the right type of the output? Do we always have AA as output type, never the Symbolic ring or Symbolic Constants Subring?



---

archive/issue_comments_477200.json:
```json
{
    "body": "Replying to [comment:22 yzh]:\n> Also, if we convert the inputs matrix to over AA, what would be the right type of the output? Do we always have AA as output type, never the Symbolic ring or Symbolic Constants Subring?\n\nYes, it would make sense to convert it back to the ring where it came from if AA is used internally. (That's how we do this for the `Polyhedron(backend='normaliz')`, by the way.)",
    "created_at": "2022-08-30T21:41:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477200",
    "user": "@mkoeppe"
}
```

Replying to [comment:22 yzh]:
> Also, if we convert the inputs matrix to over AA, what would be the right type of the output? Do we always have AA as output type, never the Symbolic ring or Symbolic Constants Subring?

Yes, it would make sense to convert it back to the ring where it came from if AA is used internally. (That's how we do this for the `Polyhedron(backend='normaliz')`, by the way.)



---

archive/issue_comments_477201.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-01T20:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477201",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477202.json:
```json
{
    "body": "Do you mean to use `number_field_elements_from_algebraics` from `sage.rings.qqbar`?\nI still don't see how to convert `AA(sqrt(2))` (interval AA number) back to `sqrt(2)` as output, if the input was in the symbolic ring.\n\nReplying to [comment:23 mkoeppe]:\n> Replying to [comment:22 yzh]:\n> > Also, if we convert the inputs matrix to over AA, what would be the right type of the output? Do we always have AA as output type, never the Symbolic ring or Symbolic Constants Subring?\n> \n> Yes, it would make sense to convert it back to the ring where it came from if AA is used internally. (That's how we do this for the `Polyhedron(backend='normaliz')`, by the way.)",
    "created_at": "2022-09-02T01:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477202",
    "user": "@yuan-zhou"
}
```

Do you mean to use `number_field_elements_from_algebraics` from `sage.rings.qqbar`?
I still don't see how to convert `AA(sqrt(2))` (interval AA number) back to `sqrt(2)` as output, if the input was in the symbolic ring.

Replying to [comment:23 mkoeppe]:
> Replying to [comment:22 yzh]:
> > Also, if we convert the inputs matrix to over AA, what would be the right type of the output? Do we always have AA as output type, never the Symbolic ring or Symbolic Constants Subring?
> 
> Yes, it would make sense to convert it back to the ring where it came from if AA is used internally. (That's how we do this for the `Polyhedron(backend='normaliz')`, by the way.)



---

archive/issue_comments_477203.json:
```json
{
    "body": "First check if `Polyhedron(..., backend='normaliz')` is able to handle the kinds of numbers you'd like to handle and gives back SR elements.",
    "created_at": "2022-09-02T01:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477203",
    "user": "@mkoeppe"
}
```

First check if `Polyhedron(..., backend='normaliz')` is able to handle the kinds of numbers you'd like to handle and gives back SR elements.



---

archive/issue_comments_477204.json:
```json
{
    "body": "Sure, using `backend='normaliz'` solves most cases. The problem is that this is an optional backend. Do we really want to use an optional package that most users don't install to deal with something so elementary -- 2 very special cases in 2D?\n\nReplying to [comment:26 mkoeppe]:\n> First check if `Polyhedron(..., backend='normaliz')` is able to handle the kinds of numbers you'd like to handle and gives back SR elements.",
    "created_at": "2022-09-02T02:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477204",
    "user": "@yuan-zhou"
}
```

Sure, using `backend='normaliz'` solves most cases. The problem is that this is an optional backend. Do we really want to use an optional package that most users don't install to deal with something so elementary -- 2 very special cases in 2D?

Replying to [comment:26 mkoeppe]:
> First check if `Polyhedron(..., backend='normaliz')` is able to handle the kinds of numbers you'd like to handle and gives back SR elements.



---

archive/issue_comments_477205.json:
```json
{
    "body": "Your code would still work without normaliz for rational input.",
    "created_at": "2022-09-02T02:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477205",
    "user": "@mkoeppe"
}
```

Your code would still work without normaliz for rational input.



---

archive/issue_comments_477206.json:
```json
{
    "body": "Yes, that's right. As it's quite usual to have sqrt(2), sqrt(3) in rays (45\u00b0, 60\u00b0), I think the code should work for these cases regardless of having normaliz or not.\n\nReplying to [comment:28 mkoeppe]:\n> Your code would still work without normaliz for rational input.",
    "created_at": "2022-09-02T02:09:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477206",
    "user": "@yuan-zhou"
}
```

Yes, that's right. As it's quite usual to have sqrt(2), sqrt(3) in rays (45°, 60°), I think the code should work for these cases regardless of having normaliz or not.

Replying to [comment:28 mkoeppe]:
> Your code would still work without normaliz for rational input.



---

archive/issue_comments_477207.json:
```json
{
    "body": "I think some more thought on the use cases is needed. Where do your irrational inputs come from? If you already have angles, there's no need to recompute them",
    "created_at": "2022-09-02T02:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477207",
    "user": "@mkoeppe"
}
```

I think some more thought on the use cases is needed. Where do your irrational inputs come from? If you already have angles, there's no need to recompute them



---

archive/issue_comments_477208.json:
```json
{
    "body": "Replying to [comment:27 yzh]:\n> Sure, using `backend='normaliz'` solves most cases. \n\nI mean I know that it can deal with `sqrt(2)`. Have you checked other cases? What are \"most\", are there exceptions that are motivated by an application?",
    "created_at": "2022-09-02T02:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477208",
    "user": "@mkoeppe"
}
```

Replying to [comment:27 yzh]:
> Sure, using `backend='normaliz'` solves most cases. 

I mean I know that it can deal with `sqrt(2)`. Have you checked other cases? What are "most", are there exceptions that are motivated by an application?



---

archive/issue_comments_477209.json:
```json
{
    "body": "I don't really have use cases in 2D, 2D angles are trivial...\n\nIt feels weird that if a Calculus student wants to compute the angle between ray (1, 0) and ray (0, sqrt(3)), they must have normaliz installed. \n\nMy thought is not to use Polyhedron in 2d, but just check for the two special cases.\n\nAlternatively, we can use `P = Polyhedron(rays=A.rows(), base_ring=AA)` which doesn't call normaliz. But then, I don't know how to convert the AA result back to symbolic.",
    "created_at": "2022-09-02T02:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477209",
    "user": "@yuan-zhou"
}
```

I don't really have use cases in 2D, 2D angles are trivial...

It feels weird that if a Calculus student wants to compute the angle between ray (1, 0) and ray (0, sqrt(3)), they must have normaliz installed. 

My thought is not to use Polyhedron in 2d, but just check for the two special cases.

Alternatively, we can use `P = Polyhedron(rays=A.rows(), base_ring=AA)` which doesn't call normaliz. But then, I don't know how to convert the AA result back to symbolic.



---

archive/issue_comments_477210.json:
```json
{
    "body": "Replying to [comment:32 yzh]:\n> Alternatively, we can use `P = Polyhedron(rays=A.rows(), base_ring=AA)` which doesn't call normaliz. But then, I don't know how to convert the AA result back to symbolic.\n\nYou're missing that the conversion code that is in our Normaliz backend does not need Normaliz. We are using it to communicate with Normaliz.",
    "created_at": "2022-09-02T02:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477210",
    "user": "@mkoeppe"
}
```

Replying to [comment:32 yzh]:
> Alternatively, we can use `P = Polyhedron(rays=A.rows(), base_ring=AA)` which doesn't call normaliz. But then, I don't know how to convert the AA result back to symbolic.

You're missing that the conversion code that is in our Normaliz backend does not need Normaliz. We are using it to communicate with Normaliz.



---

archive/issue_comments_477211.json:
```json
{
    "body": "I know that \"conversion code that is in our Normaliz backend does not need Normaliz.\"\nBut how does it help with 2d solid angle? \n\n> Replying to [comment:32 yzh]:\n> > Alternatively, we can use `P = Polyhedron(rays=A.rows(), base_ring=AA)` which doesn't call normaliz. But then, I don't know how to convert the AA result back to symbolic.\n> \n> You're missing that the conversion code that is in our Normaliz backend does not need Normaliz. We are using it to communicate with Normaliz.",
    "created_at": "2022-09-02T02:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477211",
    "user": "@yuan-zhou"
}
```

I know that "conversion code that is in our Normaliz backend does not need Normaliz."
But how does it help with 2d solid angle? 

> Replying to [comment:32 yzh]:
> > Alternatively, we can use `P = Polyhedron(rays=A.rows(), base_ring=AA)` which doesn't call normaliz. But then, I don't know how to convert the AA result back to symbolic.
> 
> You're missing that the conversion code that is in our Normaliz backend does not need Normaliz. We are using it to communicate with Normaliz.



---

archive/issue_comments_477212.json:
```json
{
    "body": "See #34479",
    "created_at": "2022-09-02T02:30:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477212",
    "user": "@mkoeppe"
}
```

See #34479



---

archive/issue_comments_477213.json:
```json
{
    "body": "I agree with #34479. That ticket will become more useful when we write code for solid angle computation in higher dimension. In 2d, it is like shooting butterfly with rifles :P, but why not...",
    "created_at": "2022-09-02T02:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33515#issuecomment-477213",
    "user": "@yuan-zhou"
}
```

I agree with #34479. That ticket will become more useful when we write code for solid angle computation in higher dimension. In 2d, it is like shooting butterfly with rifles :P, but why not...
