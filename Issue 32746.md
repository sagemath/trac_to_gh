# Issue 32746: Reduction method of Elliptic curve over relative numberfield sometimes fails

Issue created by migration from https://trac.sagemath.org/ticket/32983

Original creator: mderickx

Original creation time: 2021-12-06 17:27:00

CC:  slelievre


```
sage: x = polygen(ZZ) 
....: f = x ** 2 - x + 1007 
....: K.<a> = QQ.extension(f) 
....: L.<b> = K.extension(x**2 - 11) 
....: q = L.prime_above(11) 
....: Fq = q.residue_field() 
....: E = EllipticCurve(L,[0,11**3]) 
....: E.reduction(q)                                                            
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:10474)()
   1188         try:
-> 1189             action = self._action_maps.get(xp, yp, op)
   1190         except KeyError:

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/sage/structure/coerce_dict.pyx in sage.structure.coerce_dict.TripleDict.get (build/cythonized/sage/structure/coerce_dict.c:8024)()
   1327         if not valid(cursor.key_id1):
-> 1328             raise KeyError((k1, k2, k3))
   1329         value = <object>cursor.value

KeyError: (Residue field in bbar of Fractional ideal (b), Multivariate Polynomial Ring in x, y, z over Residue field in bbar of Fractional ideal (b), <built-in function mul>)

During handling of the above exception, another exception occurred:

IndexError                                Traceback (most recent call last)
<ipython-input-106-0b37805c90b1> in <module>
      6 Fq = q.residue_field()
      7 E = EllipticCurve(L,[Integer(0),Integer(13)**Integer(3)])
----> 8 E.reduction(q)

...

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.normalize_names (build/cythonized/sage/structure/category_object.c:8487)()
    898         return dir_with_other_class(self, self.category().parent_class)
    899 
--> 900 cpdef normalize_names(Py_ssize_t ngens, names):
    901     r"""
    902     Return a tuple of strings of variable names of length ngens given

/var/tmp/sage-9.4-current/local/lib/python3.9/site-packages/sage/structure/category_object.pyx in sage.structure.category_object.normalize_names (build/cythonized/sage/structure/category_object.c:8361)()
   1018     certify_names(names)
   1019     if ngens >= 0 and len(names) != ngens:
-> 1020        raise IndexError("the number of names must equal the number of generators")
   1021     return tuple(names)
   1022 

IndexError: the number of names must equal the number of generators
```



---

Comment by mderickx created at 2021-12-06 18:00:56

Changing component from elliptic curves to algebra.


---

Comment by slelievre created at 2021-12-07 16:25:42

Changing component from algebra to number fields.


---

Comment by saraedum created at 2022-02-01 20:24:35

The first example works, when writing `x1 * Fq.0` and also if you do `R(Fq.0) * x1`.


---

Comment by saraedum created at 2022-02-01 20:34:04

The underlying problem seems to be that `Fq.construction()` is an "AlgebraicExtensionFunctor".

There's a hack in pushout.py that makes that functor do something completely different in the context of residue fields. However, here, a generic pushout is tried and that then fails.
