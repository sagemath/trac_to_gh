# Issue 12723: Categories: adds support for SubcategoryMethods

Issue created by migration from Trac.

Original creator: nthiery

Original creation time: 2012-05-01 21:43:45

Assignee: nthiery

CC:  sage-combinat simonking

With this patch, a category can implement a nested class SubcategoryMethods that provides methods for all subcategories of this category (similar to ParentMethods that provides methods for all parents of all subcategories of this category).

This is implemented by updating the class of each category C, at the end of its initialization, to insert C.subcategory_class as superclass (like what is done for Parents and Elements).

This is a bit tricky, since the super_categories method needs to be called during the initialization.

The patch is under finalization on http://combinat.sagemath.org/patches/


---

Comment by SimonKing created at 2012-05-03 13:41:12

How can one get the patch? I tried

```
hg qimport http://combinat.sagemath.org/patches/file/2b30dc3e4bf4/trac_12895-subcategory-methods-nt.patch
```

but only get an empty patch.


---

Comment by nthiery created at 2012-05-03 14:01:54

Replying to [comment:1 SimonKing]:
> How can one get the patch? I tried
> {{{
> hg qimport http://combinat.sagemath.org/patches/file/2b30dc3e4bf4/trac_12895-subcategory-methods-nt.patch
> }}}
> but only get an empty patch.

Strange. Anyway, there it is.


---

Comment by nthiery created at 2012-05-03 14:03:01

Changing status from new to needs_review.


---

Comment by nthiery created at 2012-05-03 14:03:01

Oh, and I should mention that basically all tests pass.


---

Attachment

Hi Simon,

I have just been through the patch on the Sage-Combinat queue (same as here previously, but rebased a couple times). I improved a bit the documentation and fixed three remaining doctests failures and reposted. On my side, it's good to go. Please review!

Note: the patch includes two small fixes in sage.combinat.sf which I am going to ask Anne to double check.

Cheers,
                                            Nicolas


---

Comment by nthiery created at 2013-05-22 16:25:35

For the record: all long tests passed with the following patches applied on top of 5.10 beta4 on Ubuntu:

```
trac_14612-gyw_test_speedup-ts.patch
trac_14574-folded.patch
trac_14610-LSenergy-ms.patch
try-as.patch
trac9107_nesting_nested_classes.patch
trac_9107_fix_cross_reference.patch
trac_12876_category_abstract_classes_for_hom.patch
trac_12848-posets-order_ideal_complement_generators_fix-nt-v2.patch
trac_14266_ascii_art_13_05_15_EliX-jbp.patch
trac_14266-ascii_art-review-ts.patch
trac11935_weak_pickling_by_construction-nt.patch
trac_11935-weak_pickling_by_construction-review-ts.patch
trac_12895-subcategory-methods-nt.patch
```



---

Comment by aschilling created at 2013-05-22 18:59:58

The changes to the k-Schur function code look ok. Thanks for catching those!

Anne


---

Comment by nthiery created at 2013-05-23 02:03:31

Replying to [comment:6 aschilling]:
> The changes to the k-Schur function code look ok. Thanks for catching those!

Thanks Anne for the review.

Simon: the ticket's review is all yours now :-)


---

Comment by SimonKing created at 2013-05-24 20:43:27

I see that for `class Category_singleton(Category)`, you replace

```
    `@`lazy_class_attribute
    def __classcall__(object cls):
```

by

```
    `@`staticmethod
    def __classcall__(object cls):
```


The point is that you do `obj.__class__._set_classcall(ConstantFunction(obj))`, so that the lazy class attribute is not needed, right? Just to make sure I understand what you did.


---

Comment by SimonKing created at 2013-05-24 20:45:20

The patch has a couple of old style line continuations.


---

Comment by SimonKing created at 2013-05-24 21:01:05

Crashlog


---

Attachment

See [attachment:Sage_crash_report.txt]. Sage doesn't even start.


---

Comment by SimonKing created at 2013-05-24 21:01:47

Changing status from needs_review to needs_work.


---

Comment by SimonKing created at 2013-05-24 21:06:43

Never mind. I forgot one dependency (it said "fixed", but #12894 is only fixed in sage-5.10.beta1, which I don't have).

Apply trac_12895-subcategory-methods-nt.patch


---

Comment by SimonKing created at 2013-05-24 21:06:43

Changing status from needs_work to needs_review.


---

Comment by nthiery created at 2013-05-24 21:12:59

Replying to [comment:8 SimonKing]:
> I see that for `class Category_singleton(Category)`, you replace
> {{{
>     `@`lazy_class_attribute
>     def __classcall__(object cls):
> }}}
> by
> {{{
>     `@`staticmethod
>     def __classcall__(object cls):
> }}}
> 
> The point is that you do `obj.__class__._set_classcall(ConstantFunction(obj))`, so that the lazy class attribute is not needed, right? Just to make sure I understand what you did.

That's right. If I remember well (that was one year ago), the tricky part is to have the classcall setting work properly both for the original class and its dynamic subclass. And having __classcall__ be a static method deviates a bit less from the standard UniqueRepresentation idiom.


---

Comment by SimonKing created at 2013-05-25 05:25:37

Changing status from needs_review to positive_review.


---

Attachment

Tests pass for me. The patchbot timed out, so I just kicked it. The patch looks fine, except for the line continuation. Hence, I provided a review patch.

Apply trac_12895-subcategory-methods-nt.patch trac_12895-review.patch


---

Comment by nthiery created at 2013-05-25 22:29:33

For the record: I just checked the review patch.

Thanks Simon; one more patch done! Now the ball is on my side :-)


---

Comment by nthiery created at 2013-06-11 15:41:52

Hi Jeroen!

Wow lots of things merged lately. Thanks! Any chance to get this one as well in beta1?

Thanks!


---

Comment by jdemeyer created at 2013-06-11 16:21:06

Replying to [comment:18 nthiery]:
> Hi Jeroen!
> 
> Wow lots of things merged lately. Thanks! Any chance to get this one as well in beta1?

I don't know. In any case, it's all very academic since Sage 5.10 hasn't been released yet.


---

Comment by jdemeyer created at 2013-06-19 12:24:39

Resolution: fixed
