# Issue 11579: make free_module_generic_pid also work for pid's other then integers

Issue created by migration from https://trac.sagemath.org/ticket/11751

Original creator: mderickx

Original creation time: 2011-08-26 21:05:12

Assignee: jason, was




---

Attachment


---

Comment by mderickx created at 2011-09-01 02:38:39

Changing the is into == is needed to make the example in the description work but in introduced some other strange bugs:


	sage -t  devel/sage-main/sage/modules/quotient_module.py # 1 doctests failed
	sage -t  devel/sage-main/sage/modules/fg_pid/fgp_element.py # 3 doctests failed
	sage -t  devel/sage-main/sage/modules/free_module_element.pyx # 3 doctests failed


---

Comment by mderickx created at 2011-09-01 02:58:10

A full output of the errors is shown in http://pastebin.com/4B4xmRDZ


---

Comment by saraedum created at 2011-09-02 07:38:32

It seems that the line `entries = [R(x) for x in entries]` in _coerce.pyx_ (roughly line 3540) is wrong. The components of a element in a free R module may not be in R at all. I'm working on a fix for that.


---

Comment by saraedum created at 2011-09-05 14:22:11

Changing status from new to needs_review.


---

Comment by mderickx created at 2011-09-05 19:08:00

The patch looks good :). Didn't try it yet how it works with doctests and  yet but at least the code looks reasonable.

If this passes all test, then at least I want something like the following as a doctest:


```
sage: L=K^2
sage: R=L.span([[x,1/x]])
sage: R.basis()[0][0]
x
sage: R.basis()[0][0].parent()
Fraction Field of Univariate Polynomial Ring in x over Rational Field
sage: R=L.span([[x,x^2]])
sage: R.basis()[0][0].parent()
Univariate Polynomial Ring in x over Rational Field
```

Since if we are going to look at the parent of one specific element, then we certainly want that it depends in the right way of the other elements. 

A neater way to do this would be to actually store "coefficient_ring" in the parent, since I think that 

```
parent.basis()[0][0].parent()
```

Is way to many steps removed from parent to actually directly acces from the code. But this is just nitpicking. 

I'm now doctesting your patch.


---

Attachment

fixes the failing doctests


---

Comment by mderickx created at 2011-09-10 20:29:09

I added a new patch, since we should also fix sparse modules (they suffer from the exact same bug). Running doctests now.


---

Comment by mderickx created at 2011-09-10 20:45:11

All tests pass so this again needs a review for the added sparse code.


---

Comment by saraedum created at 2011-09-19 13:12:00

Changing status from needs_review to positive_review.


---

Comment by saraedum created at 2011-09-19 13:12:00

the patches apply to 4.7.2.alpha2 and all doctests pass.


---

Comment by mderickx created at 2011-09-19 13:54:54

apply: 11751_free_module_generic_pid-fix.patch, trac_11751_free_module_generic_pid-review.patch and trac_11751_whitespace.patch


---

Comment by leif created at 2011-09-27 17:42:32

Resolution: fixed


---

Comment by jdemeyer created at 2011-10-04 10:16:14

small review patch to fix some whitespace and doc issues


---

Attachment

I really don't like the way how this was fixed. First of all, why is this even a bug? If you need fractions, I think you should use the fraction field from the beginning.

Second, it causes the computation of a basis(!) every time that `vector()` is called.

I am working on initialization of vectors in #17561 and I would actually like to revert this fix and make

```
sage: R.<x> = QQ[] 
sage: L = R^1 
sage: L.span([(1/x,)]) 
```

a `TypeError` again.


---

Comment by jdemeyer created at 2014-12-29 09:24:27

ok, I get it now. The issue is more complex than what the description shows.


---

Comment by jdemeyer created at 2014-12-29 09:38:08

Anyway, I'm fixing the `basis()` issue by adding a new method `basis_ring()` to free modules.
