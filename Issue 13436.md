# Issue 13436: q-numbers coutings flags stable under a nilpotent endomorphism

Issue created by migration from https://trac.sagemath.org/ticket/13640

Original creator: caruso

Original creation time: 2012-10-22 14:03:52

Assignee: sage-combinat

Keywords: combinatorics, q-numbers

Here is a small patch implementing the function q_jordan which computes the number of complete flags in $\F_q^n$ stable under a nilpotent linear endomorphism given by its Jordan type.

This function is used in ticket #13215.


---

Comment by caruso created at 2012-10-22 14:13:02

Changing status from new to needs_review.


---

Comment by chapoton created at 2012-11-09 16:11:04

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2012-11-09 16:11:04

* it does not look good to use a global variable dict_jordan

* You should instead use the decorator `@`cached_function to cache the results of a procedure.

* every procedure should be doctested.

* do you really need two procedures to do that ?


---

Comment by caruso created at 2012-11-09 18:49:57

Changing status from needs_work to needs_info.


---

Comment by caruso created at 2012-11-09 18:49:57

Replying to [comment:3 chapoton]:
> * it does not look good to use a global variable dict_jordan
> * You should instead use the decorator `@`cached_function to cache the results of a procedure.
> * every procedure should be doctested.
> * do you really need two procedures to do that ?

The main problem is that lists are not hashable. Therefore a cached function can't take a list as an argument and, consequently, I can't use the decorator `@`cached_function to cache the result of q_jordan (at least without changing the prototype of this function).
Moreover, working with just one function would imply to check the shape of the inputs at each recursive call (which is of course useless and may cost a lot).

I propose another implementation (using `@`cached_function and a nested function) in trac_13640_qjordan-2.patch. Please tell me whether it's better or not according to you.


---

Comment by chapoton created at 2012-11-09 19:43:28

Thinking again about this, it now seems to me that q_jordan should be a method of the class Partitions. This is really the job of a partition constructor to check that something is a partition.

Maybe this would also solve the hash problem ?


---

Comment by caruso created at 2012-11-12 18:13:36

Ok. I attach a third implementation where q_jordan is a method of Partition. It works but it's quite slow. (I suspect a problem with ``@`cached_method`, but I'm not sure.)


---

Comment by nthiery created at 2012-11-12 20:29:42

Replying to [comment:5 chapoton]:
> Thinking again about this, it now seems to me that q_jordan should be a method of the class Partitions. This is really the job of a partition constructor to check that something is a partition.
> Maybe this would also solve the hash problem ?

Sorry I did not comment earlier; the network at the airport was crappy. It would certainly be natural for the input to q_jordan to be a partition, and it should indeed fix the problem.

That being said, this does not necessarily imply that q_jordan should be a method of partitions. It might be more natural to put instead q_jordan with the other q-analogues, as a function taking a partition as input.

I let you judge which option is best.

Cheers,
                           Nicolas


---

Comment by nthiery created at 2012-11-12 20:33:10

Replying to [comment:6 caruso]:
> Ok. I attach a third implementation where q_jordan is a method of Partition. It works but it's quite slow. (I suspect a problem with ``@`cached_method`, but I'm not sure.)

Did you run it with %prun? Among other things, it will tell you how many times the method is called, from which you can check whether the cache works.

Ah, in this situation, you probably want to use `@`cached_in_parent. Otherwise, the result for p.q_jordan() is cached in p. So if you recreate an identical partition as p2, p2.q_jordan won't see the cache in p.

Cheers,
                                Nicolas


---

Comment by chapoton created at 2012-11-12 21:27:09

apply trac_13640_qjordan-4.patch

ok, here is a new variant. Still slow, I am afraid.


---

Comment by chapoton created at 2012-11-12 21:32:54

apply trac_13640_qjordan-4.patch

here is a new one, thanks to Nicolas comments : with cached_in_parent_method


---

Comment by chapoton created at 2012-11-12 21:34:45

Changing status from needs_info to needs_review.


---

Comment by caruso created at 2012-11-13 09:22:27

Replying to [comment:7 nthiery]:
> That being said, this does not necessarily imply that q_jordan should be a method of partitions. It might be more natural to put instead q_jordan with the other q-analogues, as a function taking a partition as input.
> 
> I let you judge which option is best.

Well, I prefer this. Therefore I propose another new patch with the function q_jordan in q_analogues but taking a Parition as input. (And note that ``@`cached_function` works well with this solution.)


---

Comment by nthiery created at 2012-11-13 09:48:05

Replying to [comment:12 caruso]:
> Well, I prefer this. Therefore I propose another new patch with the function q_jordan in q_analogues but taking a Parition as input.

Sounds good to me.

> (And note that ``@`cached_function` works well with this solution.)

Yup.


---

Attachment

apply trac_13640_qjordan-4.patch

here is a new patch, not touching partition.py at all

this seems ok to me

let us wait for the green light


---

Comment by chapoton created at 2012-11-14 08:16:16

ok, positive review


---

Comment by chapoton created at 2012-11-14 08:16:16

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-11-15 09:00:00

I assume the positive review implies that the work issues have been solved?


---

Comment by chapoton created at 2012-11-15 09:06:47

Yes, indeed. I should have removed them, sorry.


---

Comment by jdemeyer created at 2012-11-16 21:25:27

Resolution: fixed
