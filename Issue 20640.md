# Issue 20640: Meta-ticket: Polyhedral complexes, piecewise functions of several variables

archive/issues_020640.json:
```json
{
    "body": "CC:  @tscrim @rwst @vbraun @videlec @jhpalmieri @kcrisman @paulmasson tmonteil @mo271 @jplab @yuan-zhou\n\nKeywords: piecewise\n\nThis meta-ticket will implement piecewise functions of several real variables. \nThe pieces are polyhedral complexes (not necessarily triangulations).\nIn my application, the functions will be piecewise linear, possibly discontinuous; but the implementation should be general enough for splines.\n\nDiscussion welcome, in particular in regard to how this code should interact with the existing classes for abstract complexes (CW complexes) and `PointConfiguration`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20877\n\n",
    "created_at": "2016-06-24T22:57:30Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Meta-ticket: Polyhedral complexes, piecewise functions of several variables",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20640",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @tscrim @rwst @vbraun @videlec @jhpalmieri @kcrisman @paulmasson tmonteil @mo271 @jplab @yuan-zhou

Keywords: piecewise

This meta-ticket will implement piecewise functions of several real variables. 
The pieces are polyhedral complexes (not necessarily triangulations).
In my application, the functions will be piecewise linear, possibly discontinuous; but the implementation should be general enough for splines.

Discussion welcome, in particular in regard to how this code should interact with the existing classes for abstract complexes (CW complexes) and `PointConfiguration`.

Issue created by migration from https://trac.sagemath.org/ticket/20877





---

archive/issue_events_055930.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-08-14T23:32:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55930"
}
```



---

archive/issue_events_055931.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-03-10T17:40:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55931"
}
```



---

archive/issue_events_055932.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-03-10T17:40:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55932"
}
```



---

archive/issue_events_055933.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-10-20T00:37:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55933"
}
```



---

archive/issue_events_055934.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-10-20T00:37:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55934"
}
```



---

archive/issue_events_055935.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-26T20:11:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55935"
}
```



---

archive/issue_events_055936.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-26T20:11:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55936"
}
```



---

archive/issue_comments_284484.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20640#issuecomment-284484",
    "user": "https://github.com/mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_055937.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55937"
}
```



---

archive/issue_events_055938.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55938"
}
```



---

archive/issue_events_055939.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55939"
}
```



---

archive/issue_events_055940.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55940"
}
```



---

archive/issue_events_055941.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55941"
}
```



---

archive/issue_events_055942.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55942"
}
```



---

archive/issue_events_055943.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55943"
}
```



---

archive/issue_events_055944.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55944"
}
```



---

archive/issue_comments_284485.json:
```json
{
    "body": "I'm interested in implementing piecewise affine functions in one variable with specific methods that are easier to implement in this setting (e.g. `compose`, `is_bijective`, `inverse`, `is_convex`, `convex_hull`, `laplace_transform`, etc.) Mostly, I'm interested in the case where the coefficients of the affine parts are in `QQ` but I might also want to consider the case where they are in a fixed number field.\n\nI'm wondering whether I should derive from the class `sage.functions.piecewise.PiecewiseFunction` (which is mostly concerned with symbolic expressions) or if it is okay if I rewrite my own class from scratch.",
    "created_at": "2022-03-17T10:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20640#issuecomment-284485",
    "user": "https://github.com/xcaruso"
}
```

I'm interested in implementing piecewise affine functions in one variable with specific methods that are easier to implement in this setting (e.g. `compose`, `is_bijective`, `inverse`, `is_convex`, `convex_hull`, `laplace_transform`, etc.) Mostly, I'm interested in the case where the coefficients of the affine parts are in `QQ` but I might also want to consider the case where they are in a fixed number field.

I'm wondering whether I should derive from the class `sage.functions.piecewise.PiecewiseFunction` (which is mostly concerned with symbolic expressions) or if it is okay if I rewrite my own class from scratch.



---

archive/issue_comments_284486.json:
```json
{
    "body": "I have code in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/fast_piecewise.py, based on the old Sage implementation of `piecewise`, which may be a starting point. It is not tied to symbolics and uses the parent-element framework",
    "created_at": "2022-03-17T17:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20640#issuecomment-284486",
    "user": "https://github.com/mkoeppe"
}
```

I have code in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/fast_piecewise.py, based on the old Sage implementation of `piecewise`, which may be a starting point. It is not tied to symbolics and uses the parent-element framework



---

archive/issue_comments_284487.json:
```json
{
    "body": "Also https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/move_semigroup.py",
    "created_at": "2022-03-17T17:56:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20640#issuecomment-284487",
    "user": "https://github.com/mkoeppe"
}
```

Also https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/move_semigroup.py



---

archive/issue_comments_284488.json:
```json
{
    "body": "Replying to [comment:39 mkoeppe]:\n> I have code in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/fast_piecewise.py, based on the old Sage implementation of `piecewise`, which may be a starting point. It is not tied to symbolics and uses the parent-element framework\n\nThat's great! Do you plan to propose this code for integration in sage at some point or not?",
    "created_at": "2022-03-23T07:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20640#issuecomment-284488",
    "user": "https://github.com/xcaruso"
}
```

Replying to [comment:39 mkoeppe]:
> I have code in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/fast_piecewise.py, based on the old Sage implementation of `piecewise`, which may be a starting point. It is not tied to symbolics and uses the parent-element framework

That's great! Do you plan to propose this code for integration in sage at some point or not?



---

archive/issue_comments_284489.json:
```json
{
    "body": "Replying to [comment:42 caruso]:\n> Replying to [comment:39 mkoeppe]:\n> > I have code in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/fast_piecewise.py, based on the old Sage implementation of `piecewise`, which may be a starting point. It is not tied to symbolics and uses the parent-element framework\n\n> That's great! Do you plan to propose this code for integration in sage at some point or not?\n\nI'm familiar with the piecewise linear function code in the above github folder, and I'd love to have that integrated into sage. This has been on my wishlist for a few years, but the integration has never happened, partially because I don't have a clear view on where this new class should be derived from and what methods are useful to general users.\n\nBesides the class hierarchy, I think that the main modification concerns changing the use of close or open or half-open intervals defined in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/intervals.py to `RealSet`.",
    "created_at": "2022-03-23T08:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20640#issuecomment-284489",
    "user": "https://github.com/yuan-zhou"
}
```

Replying to [comment:42 caruso]:
> Replying to [comment:39 mkoeppe]:
> > I have code in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/fast_piecewise.py, based on the old Sage implementation of `piecewise`, which may be a starting point. It is not tied to symbolics and uses the parent-element framework

> That's great! Do you plan to propose this code for integration in sage at some point or not?

I'm familiar with the piecewise linear function code in the above github folder, and I'd love to have that integrated into sage. This has been on my wishlist for a few years, but the integration has never happened, partially because I don't have a clear view on where this new class should be derived from and what methods are useful to general users.

Besides the class hierarchy, I think that the main modification concerns changing the use of close or open or half-open intervals defined in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/intervals.py to `RealSet`.



---

archive/issue_comments_284490.json:
```json
{
    "body": "Replying to [comment:44 yzh]:\n> Besides the class hierarchy, I think that the main modification concerns changing the use of close or open or half-open intervals defined in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/intervals.py to `RealSet`.\n\n\nYes, that's an important task. Related: #32181",
    "created_at": "2022-03-23T19:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20640#issuecomment-284490",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:44 yzh]:
> Besides the class hierarchy, I think that the main modification concerns changing the use of close or open or half-open intervals defined in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/intervals.py to `RealSet`.


Yes, that's an important task. Related: #32181



---

archive/issue_comments_284491.json:
```json
{
    "body": "Right, I notice that #32181 is related, and I added it into the description of this meta-ticket in comment:43.\nReplying to [comment:45 mkoeppe]:\n> Replying to [comment:44 yzh]:\n> > Besides the class hierarchy, I think that the main modification concerns changing the use of close or open or half-open intervals defined in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/intervals.py to `RealSet`.\n\n> \n> Yes, that's an important task. Related: #32181",
    "created_at": "2022-03-23T19:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20640#issuecomment-284491",
    "user": "https://github.com/yuan-zhou"
}
```

Right, I notice that #32181 is related, and I added it into the description of this meta-ticket in comment:43.
Replying to [comment:45 mkoeppe]:
> Replying to [comment:44 yzh]:
> > Besides the class hierarchy, I think that the main modification concerns changing the use of close or open or half-open intervals defined in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/intervals.py to `RealSet`.

> 
> Yes, that's an important task. Related: #32181



---

archive/issue_comments_284492.json:
```json
{
    "body": "Regarding the class hierarchy, `class PiecewiseLinearFunction_1d (ModuleElement)` https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/fast_piecewise.py#L17 for the element is already good, I think. The corresponding parent is https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/fast_piecewise.py#L1221\n\nThere are many details so that it works correctly with all operations provided by the category. \n\nIf this is added to Sage, it would be best to put it somewhere that's not `sage.functions` because this package concerns symbolic functions.\n\nIf the scope remains piecewise linear functions (or even piecewise polynomial functions where the pieces are polyhedra such as box splines or simplex splines), then somewhere in `sage.geometry` would make sense because of its close ties to https://doc.sagemath.org/html/en/reference/discrete_geometry/sage/geometry/polyhedral_complex.html\n\nAnother connection: both `indicator_function` and `convex_indicator_function` (proposed to add in #32201) of polyhedra are, of course, piecewise linear functions.",
    "created_at": "2022-03-23T19:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20640#issuecomment-284492",
    "user": "https://github.com/mkoeppe"
}
```

Regarding the class hierarchy, `class PiecewiseLinearFunction_1d (ModuleElement)` https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/fast_piecewise.py#L17 for the element is already good, I think. The corresponding parent is https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/fast_piecewise.py#L1221

There are many details so that it works correctly with all operations provided by the category. 

If this is added to Sage, it would be best to put it somewhere that's not `sage.functions` because this package concerns symbolic functions.

If the scope remains piecewise linear functions (or even piecewise polynomial functions where the pieces are polyhedra such as box splines or simplex splines), then somewhere in `sage.geometry` would make sense because of its close ties to https://doc.sagemath.org/html/en/reference/discrete_geometry/sage/geometry/polyhedral_complex.html

Another connection: both `indicator_function` and `convex_indicator_function` (proposed to add in #32201) of polyhedra are, of course, piecewise linear functions.



---

archive/issue_events_055945.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55945"
}
```



---

archive/issue_events_055946.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55946"
}
```



---

archive/issue_events_055947.json:
```json
{
    "actor": "https://github.com/NicoleYueqiLi",
    "created_at": "2022-08-31T04:51:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55947"
}
```



---

archive/issue_events_055948.json:
```json
{
    "actor": "https://github.com/NicoleYueqiLi",
    "created_at": "2022-08-31T04:51:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55948"
}
```



---

archive/issue_events_055949.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55949"
}
```



---

archive/issue_events_055950.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20640",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20640#event-55950"
}
```
