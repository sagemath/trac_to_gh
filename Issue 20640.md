# Issue 20640: Meta-ticket: Polyhedral complexes, piecewise functions of several variables

Issue created by migration from https://trac.sagemath.org/ticket/20877

Original creator: mkoeppe

Original creation time: 2016-06-24 22:57:30

CC:  tscrim rws vbraun vdelecroix jhpalmieri kcrisman paulmasson tmonteil moritz jipilab yzh

Keywords: piecewise

This meta-ticket will implement piecewise functions of several real variables. 
The pieces are polyhedral complexes (not necessarily triangulations).
In my application, the functions will be piecewise linear, possibly discontinuous; but the implementation should be general enough for splines.

Discussion welcome, in particular in regard to how this code should interact with the existing classes for abstract complexes (CW complexes) and `PointConfiguration`.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by caruso created at 2022-03-17 10:56:09

I'm interested in implementing piecewise affine functions in one variable with specific methods that are easier to implement in this setting (e.g. `compose`, `is_bijective`, `inverse`, `is_convex`, `convex_hull`, `laplace_transform`, etc.) Mostly, I'm interested in the case where the coefficients of the affine parts are in `QQ` but I might also want to consider the case where they are in a fixed number field.

I'm wondering whether I should derive from the class `sage.functions.piecewise.PiecewiseFunction` (which is mostly concerned with symbolic expressions) or if it is okay if I rewrite my own class from scratch.


---

Comment by mkoeppe created at 2022-03-17 17:53:57

I have code in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/fast_piecewise.py, based on the old Sage implementation of `piecewise`, which may be a starting point. It is not tied to symbolics and uses the parent-element framework


---

Comment by mkoeppe created at 2022-03-17 17:56:08

Also https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/move_semigroup.py


---

Comment by caruso created at 2022-03-23 07:24:44

Replying to [comment:39 mkoeppe]:
> I have code in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/fast_piecewise.py, based on the old Sage implementation of `piecewise`, which may be a starting point. It is not tied to symbolics and uses the parent-element framework
That's great! Do you plan to propose this code for integration in sage at some point or not?


---

Comment by yzh created at 2022-03-23 08:56:32

Replying to [comment:42 caruso]:
> Replying to [comment:39 mkoeppe]:
> > I have code in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/fast_piecewise.py, based on the old Sage implementation of `piecewise`, which may be a starting point. It is not tied to symbolics and uses the parent-element framework
> That's great! Do you plan to propose this code for integration in sage at some point or not?

I'm familiar with the piecewise linear function code in the above github folder, and I'd love to have that integrated into sage. This has been on my wishlist for a few years, but the integration has never happened, partially because I don't have a clear view on where this new class should be derived from and what methods are useful to general users.

Besides the class hierarchy, I think that the main modification concerns changing the use of close or open or half-open intervals defined in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/intervals.py to `RealSet`.


---

Comment by mkoeppe created at 2022-03-23 19:00:39

Replying to [comment:44 yzh]:
> Besides the class hierarchy, I think that the main modification concerns changing the use of close or open or half-open intervals defined in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/intervals.py to `RealSet`.

Yes, that's an important task. Related: #32181


---

Comment by yzh created at 2022-03-23 19:25:42

Right, I notice that #32181 is related, and I added it into the description of this meta-ticket in comment:43.
Replying to [comment:45 mkoeppe]:
> Replying to [comment:44 yzh]:
> > Besides the class hierarchy, I think that the main modification concerns changing the use of close or open or half-open intervals defined in https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/intervals.py to `RealSet`.
> 
> Yes, that's an important task. Related: #32181


---

Comment by mkoeppe created at 2022-03-23 19:37:28

Regarding the class hierarchy, `class PiecewiseLinearFunction_1d (ModuleElement)` https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/fast_piecewise.py#L17 for the element is already good, I think. The corresponding parent is https://github.com/mkoeppe/cutgeneratingfunctionology/blob/master/cutgeneratingfunctionology/igp/fast_piecewise.py#L1221

There are many details so that it works correctly with all operations provided by the category. 

If this is added to Sage, it would be best to put it somewhere that's not `sage.functions` because this package concerns symbolic functions.

If the scope remains piecewise linear functions (or even piecewise polynomial functions where the pieces are polyhedra such as box splines or simplex splines), then somewhere in `sage.geometry` would make sense because of its close ties to https://doc.sagemath.org/html/en/reference/discrete_geometry/sage/geometry/polyhedral_complex.html

Another connection: both `indicator_function` and `convex_indicator_function` (proposed to add in #32201) of polyhedra are, of course, piecewise linear functions.
