# Issue 14937: Permutations and symmetric group algebra: Stopgap for #14885 and noninversions

Issue created by migration from Trac.

Original creator: darij

Original creation time: 2013-09-08 05:04:34

CC:  tscrim sage-combinat nthiery hivert zabrocki ncohen saliola

Keywords: permutation, permutation group, symmetric group, sage-combinat, groups

This patch does the following:

* Open up a way to circumvent the (in the opinion of several people) broken multiplication of permutations (see #14885 and https://groups.google.com/forum/#!searchin/sage-devel/permutations/sage-devel/tAAb42Edh9o/T-htA50IOZEJ ). To remind, the issue is twofold: first, the default order in which Sage multiplies permutation is rather unusual to anyone not from the English school of notation; second, the order depends on a global variable which can be changed at runtime, which makes it unpredictable and a pain to rely on. I don't address the first of these issues in my patch, but I ameliorate the second one: There are now global-independent methods `left_action_product` and `right_action_product` on permutations (these are just aliases for the already existing methods `_left_to_right_multiply_on_left` and `_left_to_right_multiply_on_right`, but are now documented and non-underscored; besides I hope that my names are clearer), and more importantly on symmetric group algebras (these are not just aliases anymore; the only multiplication method which we used to have on symmetric group algebras dependent on the global). These can be used instead of the badly predictable `*` operator (they're even a bit faster by virtue of not branching on the global variable).

* Improve doc at a few places in `combinat/permutation.py` and `combinat/symmetric_group_algebra.py`. These are minor, but constitude most of the size of the patch.

* Add methods related to the Reiner-Saliola-Welker conjectures: The number of noninversions of a permutation; the antipode of the symmetric group algebra; the Reiner-Saliola-Welker shuffling operators (as elements of symmetric group algebras); and some elements which can be used to factor the latter.


---

Comment by darij created at 2013-09-08 05:07:19

Changing status from new to needs_review.


---

Comment by darij created at 2013-09-09 00:02:18

Changing status from needs_review to needs_work.


---

Comment by darij created at 2013-09-09 00:32:31

Changing status from needs_work to needs_review.


---

Comment by darij created at 2013-09-09 00:32:31

New version up (sorry!). Not planning any further edits until this is reviewed.


---

Comment by darij created at 2013-10-27 15:55:03

Rebased over #15309; added docstring to the (ancient) `pi_ik` function.


---

Attachment

rebased again


---

Comment by darij created at 2013-11-15 06:54:31

New attachment improves the docstrings around the strong Bruhat order (fixing an error and preventing its confusion with the weak Bruhat order) and slightly optimizes the test for Bruhat less-or-equal.

for the *patchbot*:

apply trac_15174-symmetric_group_algebra_again-dg.patch​ trac_15174-bruhat-dg.patch​


---

Attachment

additional (mostly doc) improvements


---

Comment by darij created at 2013-11-16 01:13:55

More work done, mostly on the permutohedron order docstrings. I was surprised to learn that "permutohedron order" is the French name for the weak order; this answers my question why the weak order isn't in Sage (it is, under this name...).

The patch is ready for review.


---

Comment by tscrim created at 2013-11-19 19:01:07

Hey Darij,

Here's a review patch which does a few changes and docstring touchups. More specifically:

* I reworked the documentation for `left/right_action_product`,
* added a `noninversions()` methods, and
* changed `noninv()` to `number_of_noninversions()` since it is ambiguous (to me).

If you agree with my changes, you can go ahead and set this to a positive review.

Best,

Travis


---

Comment by darij created at 2013-11-19 19:49:04

Hi Travis,

thanks a lot for reviewing this!

I'm unsure about this:

```
         This is usually denoted by either ``self * lp`` or ``lp * self``
         depending on the conventions used by the author. If permutations
         are to act on numbers from the left in an associative way, the
-        correct notation for this is ``self * lp``. If permutations are
-        to act on numbers from the right in an associatve way, the
-        correct notation for this is ``lp * self``.
+        correct notation for this is ``self * lp``. If permutations are to
+        act on positions from the left in an associative way, the correct
+        notation for this is ``lp * self``.
```

What do you mean by "act on positions"? Something like "pi sends psi to pi \circ psi^(-1)"? But then we would have to add an ^{-1}... IMHO my original docstring was clearer. I don't understand the "More specifically" explanation either...

Also, the docstring of `noninversions` might use an `r"""`. I'm not near a functioning hg installation right now, or I'd do that myself.

  Best regards,\\
  Darij


---

Comment by darij created at 2013-11-19 19:55:56

PS. The reason why I killed the "invalid state" ValueErrors is that `state` is not a user-defined variable but an output of `_icondition`, and the existing code already handles all possible values it can have. The ValueError would appear only if cosmic radiation corrupted the internal state of the sage process. IMHO that's not something we should actively be testing for at runtime...


---

Comment by tscrim created at 2013-11-19 20:38:50

Hey Darij,

There are two ways one permutation can act on another, by position  (or by index) and by value (or by number as you put it). Acting on the right by one is equal to acting on the left by the other and can be seen from the permutation matrix multiplication (see Section 1.4 in Artin's _Algebra_ for example). My "More specifically" block was trying to explain these two different approaches and could likely use improvement. (I'm used to my permutations acting by position.)

Your docstring ended up confusing me since the name of the method is (for example) `left_action_multiply` and it's talking about left and right actions by number. I think we should do the mantra: "Here is how we define the left action". Additionally what I was trying to change was to give justification as to why the other notation would be used and get the same result.

I'll change the docstring of `noninversions` once we settle on the above.

Also since the "invalid state" errors are in an `else:` block, they never get called unless there is an internal error. In other terms, it's not actively testing for anything. I'd be fine changing them to `assert` statements, but that would be a cosmetic change.

Best,

Travis


---

Comment by darij created at 2013-11-19 23:32:11

I was talking about the action of `S_n` on `[n]`, not about an action-by-multiplication of `S_n` on itself. I'll rewrite the docstring to make this maximally explicit, since I see that what I wrote didn't clear up the confusion particularly well.


---

Attachment

response to Travis' review + more edits


---

Comment by darij created at 2013-11-20 03:45:40

Hi Travis,

what do you think about this? Note that I have removed the "More specifically" paragraphs because I couldn't really understand them, but I think I'm as specific as possible now.

I couldn't resist adding a docstring to the Hecke algebra class after noticing that it, too, would break if a nonstandard order of multiplication was chosen (this, too, is fixed now). Sorry for the feature creep! In other news, this patch probably kills all but 2-3 spots in the source where the `mult` global option on `Permutations` is inappropriately used. I'll open further tickets for the rest.

The change of "integral" to "integers" is due to the fact that "integral" means "integral over ZZ" for some people. I was probably over-careful here.

for the *patchbot*:

apply trac_15174-symmetric_group_algebra_again-dg.patch​ trac_15174-bruhat-dg.patch​ trac_15174-review-ts.patch trac_15174-response-dg.patch​


---

Comment by tscrim created at 2013-11-21 15:22:54

Hey Darij,

Ah, now I understand what you were trying to say. However I do think we should include somewhere about if we want to think of permutations acting on positions instead of on numbers, as well as explicitly describing what these actions are. Perhaps at the class level or in the global variables section?

Additionally if there are only a few other spots where the multiplication relies on the global variable being a particular value, I am fine with doing that here (since #14885 is about changing the global option itself).

Best,

Travis


---

Comment by darij created at 2013-11-21 17:17:28

Hi Travis,

Replying to [comment:13 tscrim]:
> Ah, now I understand what you were trying to say. However I do think we should include somewhere about if we want to think of permutations acting on positions instead of on numbers, as well as explicitly describing what these actions are. Perhaps at the class level or in the global variables section?

I didn't want to talk of the multiplication as being an action itself (I talked of the multiplication playing nicely with the action on integers, which is a simpler thing), since IMHO that would only add to the confusion. But if you can explain it nicely, I think it would be a good addition. Can you make a little review patch for this?

> Additionally if there are only a few other spots where the multiplication relies on the global variable being a particular value, I am fine with doing that here (since #14885 is about changing the global option itself).

Good point; I'll do it later today (I hope). Meanwhile do you agree with my last patch? (I'd like to qfold everything we have done so far on the ticket.)

Best regards,\\
Darij


---

Comment by tscrim created at 2013-11-22 02:35:52

Hey Darij,

Replying to [comment:14 darij]:
> I didn't want to talk of the multiplication as being an action itself (I talked of the multiplication playing nicely with the action on integers, which is a simpler thing), since IMHO that would only add to the confusion. But if you can explain it nicely, I think it would be a good addition. Can you make a little review patch for this?

Sure.

> Good point; I'll do it later today (I hope). Meanwhile do you agree with my last patch? (I'd like to qfold everything we have done so far on the ticket.)

Yes, everything looked good in it. Please fold it all together.

Best,

Travis


---

Attachment

qfold of the patches so far; more to come!


---

Attachment

I've tried fixing some of the other places where the global is used, but the work is going overboard: there's way too much to fix in `sage/groups/braid.py`; I don't understand much of `sage/groups/semimonomial_transformations/*`; I don't know the seminormal form well enough for what remains to be done in `sage/combinat/symmetric_group_algebra.py` (this will probably change soon); I have left `sage/combinat/matrices/latin.py` to Nathann in #15439; I had no time left for `sage/graphs/comparability.pyx`, `sage/graphs/generators/intersection.py` and `sage/categories/magmas.py`. This is, I think, a complete list of places where dependence on `mult` should be removed. I'll open up separate tickets for them. Sorry...

Travis, could you perhaps have a look at the last patch I uploaded here and give green (or whatever) light? It's mainly docstrings now. Many thanks again for reviewing this mess.

for the *patchbot*:
apply trac_15174-qfold1.patch​ trac_15174-final-touches-dg.patch​


---

Attachment


---

Comment by tscrim created at 2013-11-23 06:51:58

Hey Darij,

Here's the latest little review patch. I'm happy with the patch right now, so if you're happy with my note, then you can set it to positive review.

Thanks,

Travis

For patchbot:

Apply: trac_15174-qfold1.patch​, trac_15174-final-touches-dg.patch​, trac_15174-review-ts.patch


---

Comment by darij created at 2013-11-23 07:02:10

I still don't get your note about products of permutations. Particularly the second paragraph:


```
 	382	        In more detail using one-line notation, if we have two permutations 
 	383	        `p \cdot q` and multiplying on the right by numbers, then the 
 	384	        resulting permutation is determined for any fixed `j` by sending 
 	385	        `p_j = q_i \mapsto q_{i+1}` for some (unique) `i` where we take the 
 	386	        indices cyclicly (i.e. `n + 1 \equiv 1`). If we consider this as 
 	387	        multiplying on the left by position, we determine the resulting 
 	388	        permutation by `q_{p_i} \mapsto q_{p_{i+1}}` over all `i` (again 
 	389	        taking the indices cyclically).
```


Sorry, but I don't have much of a clue what you mean here :/ What is the `q_i \mapsto q_{i+1}` thing about? Are your permutations supposed to be cycles written in cycle form?

Also, "surpressed" should be "suppressed". The rest of the edits is definitely good.


---

Comment by tscrim created at 2013-11-23 07:17:26

My permutations are "using one-line notation". And the by-value is sending the value `p_j` which equals `q_i` for some `i` to the value `q_{i+1}` as we range over `j`. The by-position is sending the value `q_{p_i}` to the resulting value `q_{p_{i+1}}`. Would it be better if I put primes on the image or called it `r`? Or the notation `r_j = q_{i+1}` where `p_j = q_i` (for by-value) and `r_{p_{i+1}} = q_{p_i}` (for by-position)?

I'll fix the typo when we clarify the above.


---

Comment by darij created at 2013-11-23 23:39:51

additional patch for another piece of code that uses the product of permutations (for no reason)


---

Attachment

I still don't see why (by-value) `p_j = q_i` gets sent to `q_{i+1}`. Shouldn't rather `p_j = i` get sent to `q_i`? Either way, I'm not convinced that viewing multiplication as action is really helpful to get rid of ambiguity. There are only two reasonable ways to multiply permutations, but there are at least six reasonable ways to act on permutations (counting left and right actions), so I fear the whole note does more harm than help.

In other news, here's one more little patch to get rid of the dependency in `sage/graphs/comparability.pyx` and `sage/graphs/generators/intersection.py`. It turns out that `sage/categories/magmas.py` is a non-issue (the dependency exists only in the doctest). This leaves only braids, semimonomial transformations, Latin square isotopisms and the seminormal form to deal with.

for the *patchbot*:

apply trac_15174-qfold1.patch​, trac_15174-final-touches-dg.patch​, trac_15174-review-ts.patch trac_15174-fix-intersection-dg.patch


---

Comment by darij created at 2013-11-29 20:49:19

Changing status from needs_review to needs_info.


---

Comment by darij created at 2013-11-29 20:49:19

Travis?


---

Attachment


---

Comment by darij created at 2013-11-29 23:07:30

all qfolded


---

Attachment

Looks good to me. Thanks Darij.

For patchbot:

Apply: trac_15174-full-qfold.patch​


---

Comment by tscrim created at 2013-11-29 23:08:36

Changing status from needs_info to positive_review.


---

Comment by darij created at 2013-11-29 23:17:58


```
\     /
 \   /
  \o/
```


Thank you, Travis!


---

Comment by jdemeyer created at 2013-12-05 08:01:38

Resolution: fixed
