# Issue 13549: logged out when running two notebooks

Issue created by migration from https://trac.sagemath.org/ticket/13753

Original creator: dkrenn

Original creation time: 2012-11-25 09:26:20

Assignee: jason, mpatel, was

CC:  jason kcrisman

Keywords: notebook logged out

When I run two notebooks (different directories) at the same time, then I am logged out of one, when doing something in the other. More precisely:

- run notebook 1, open worksheet A
- run notebook 2, open worksheet B
- now click 'Home' in worksheet A, and you will be asked to log in again

This happens since 5.2. 


---

Comment by novoselt created at 2013-01-19 00:10:44

Yeap, I've reported it before as well, although without opening a ticket. Still present with 5.6.rc0.


---

Comment by novoselt created at 2013-01-19 00:26:49

Same with 5.6.rc0+#13717


---

Comment by jason created at 2013-01-19 02:50:00

My guess is that this is an issue with the cookies for the servers being confused somehow.


---

Comment by novoselt created at 2013-01-19 03:09:35

I think the problem is that the port number is not taking into account: I am running several servers for different purposes on the same machine and so they have the same domain name - the difference is only in the port.


---

Comment by jason created at 2013-01-19 04:38:55

A long time ago we also had problems with the cookie and I thought Tim Dumol added the port number to the cookie.  But you're right that it should be checked.


---

Comment by jason created at 2013-01-19 04:55:29

See #8249 and #6353 for previous cookie-related work.  In particular, it looks like #6353 was the ticket I was mentioning above.


---

Comment by jason created at 2013-01-19 04:59:57

At first glance, it appears that the cookie should have the port name: https://github.com/sagemath/sagenb/blob/master/flask_version/base.py#L101


---

Comment by novoselt created at 2013-01-20 20:14:23

I can see `nb_session_<port_numer>` cookie mentioned in the code above, but there is also a cookie named just `session` and once I deleted it, I got logged out. I suppose it is created/overwritten by each notebook server and then it works only for the one that was singed into last.


---

Comment by jason created at 2013-01-21 19:19:12

Ah, very interesting.  I spent a few minutes looking at this, and it looks like we may also be using the built-in flask session management (http://flask.pocoo.org/docs/api/#sessions).  I think the default cookie name there is 'session', but it is configurable.  So:

1. Is that right?
2. Do we need both the custom cookie we set in the code above as well as the flask session cookie?
3. How do we set the flask session cookie to include the port? (search for "default_config" at http://flask.pocoo.org/docs/api/ -- it appears we just pass that in to the flask app)


---

Comment by jason created at 2013-01-21 19:20:21

(keep in mind the docs I reference above are for flask 0.9, which might be later than the version we are running, so different info might apply to the version of flask we are running)


---

Comment by dkrenn created at 2013-08-05 08:08:18

Still present with 5.10.


---

Comment by chapoton created at 2020-04-21 19:14:40

Changing status from new to needs_review.


---

Comment by chapoton created at 2020-04-21 19:14:40

Can we close this ancient ticket about sagenb ?


---

Comment by kcrisman created at 2020-04-22 02:03:50

I think we'll have to.


---

Comment by chapoton created at 2020-04-24 13:45:42

Resolution: invalid


---

Comment by chapoton created at 2020-04-24 13:45:42

ok
