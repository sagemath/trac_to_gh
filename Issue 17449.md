# Issue 17449: computel.gp: "unable to start pari because the command 'gp --emacs --quiet --stacksize 10000000' failed"

archive/issues_017449.json:
```json
{
    "body": "I get the following error after a runtime of several minutes. If I change parts of my code, the error occurs in different places. Running just snippets of the code does not produce the error. I'm running sage 6.4 on a fresh installation of Ubuntu 14.04 64bit on a fairly powerful computer.\n\nThe only previous mention of this error that I could find is http://trac.sagemath.org/ticket/9866.\n\nCan anyone suggest workarounds?\n\nLet me know what additional information I can provide to help.\n\n\n```\nTraceback (most recent call last):\n  File \"RHS.py\", line 275, in DokchitserDirichlet\n    L.init_coeffs('chi(k)', 1, 'conj(chi(k))', pari_precode=pari_precode)\n  File \"/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/lfunctions/dokchitser.py\", line 340, in init_coeffs\n    gp = self.gp()\n  File \"/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/lfunctions/dokchitser.py\", line 225, in gp\n    g.read('computel.gp')\n  File \"/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 634, in read\n    self.eval(self._read_in_file_command(filename))\n  File \"/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1223, in eval\n    for L in code.split('\\n') if L != ''])\n  File \"/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/gp.py\", line 400, in _eval_line\n    wait_for_prompt=wait_for_prompt)\n  File \"/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 817, in _eval_line\n    self._start()\n  File \"/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 432, in _start\n    self.name(), cmd, self._install_hints()))\nRuntimeError: unable to start pari because the command 'gp --emacs --quiet --stacksize 10000000' failed\n\nException RuntimeError: RuntimeError('sys.path must be a list of directory names',) in <bound method Dokchitser.__del__ of Dokchitser L-series of conductor 7 and weight 1> ignored\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17686\n\n",
    "created_at": "2015-01-29T00:16:09Z",
    "labels": [
        "number theory",
        "major",
        "bug"
    ],
    "title": "computel.gp: \"unable to start pari because the command 'gp --emacs --quiet --stacksize 10000000' failed\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17449",
    "user": "alexc"
}
```
I get the following error after a runtime of several minutes. If I change parts of my code, the error occurs in different places. Running just snippets of the code does not produce the error. I'm running sage 6.4 on a fresh installation of Ubuntu 14.04 64bit on a fairly powerful computer.

The only previous mention of this error that I could find is http://trac.sagemath.org/ticket/9866.

Can anyone suggest workarounds?

Let me know what additional information I can provide to help.


```
Traceback (most recent call last):
  File "RHS.py", line 275, in DokchitserDirichlet
    L.init_coeffs('chi(k)', 1, 'conj(chi(k))', pari_precode=pari_precode)
  File "/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/lfunctions/dokchitser.py", line 340, in init_coeffs
    gp = self.gp()
  File "/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/lfunctions/dokchitser.py", line 225, in gp
    g.read('computel.gp')
  File "/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 634, in read
    self.eval(self._read_in_file_command(filename))
  File "/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1223, in eval
    for L in code.split('\n') if L != ''])
  File "/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/gp.py", line 400, in _eval_line
    wait_for_prompt=wait_for_prompt)
  File "/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 817, in _eval_line
    self._start()
  File "/home/blatm/sage/sage-6.4.1-x86_64-Linux1404/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 432, in _start
    self.name(), cmd, self._install_hints()))
RuntimeError: unable to start pari because the command 'gp --emacs --quiet --stacksize 10000000' failed

Exception RuntimeError: RuntimeError('sys.path must be a list of directory names',) in <bound method Dokchitser.__del__ of Dokchitser L-series of conductor 7 and weight 1> ignored
```


Issue created by migration from https://trac.sagemath.org/ticket/17686





---

archive/issue_comments_233074.json:
```json
{
    "body": "Replying to [ticket:17686 alexc]:\n> Let me know what additional information I can provide to help.\nA reproducible example...",
    "created_at": "2015-01-29T06:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233074",
    "user": "jdemeyer"
}
```

Replying to [ticket:17686 alexc]:
> Let me know what additional information I can provide to help.
A reproducible example...



---

archive/issue_comments_233075.json:
```json
{
    "body": "Attachment\n\nExample",
    "created_at": "2015-01-30T05:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233075",
    "user": "alexc"
}
```

Attachment

Example



---

archive/issue_comments_233076.json:
```json
{
    "body": "Replying to [comment:1 jdemeyer]:\n> Replying to [ticket:17686 alexc]:\n> > Let me know what additional information I can provide to help.\n> A reproducible example...\n\nI've attached a program which produces the error. The program fails after count = 160 for me.",
    "created_at": "2015-01-30T05:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233076",
    "user": "alexc"
}
```

Replying to [comment:1 jdemeyer]:
> Replying to [ticket:17686 alexc]:
> > Let me know what additional information I can provide to help.
> A reproducible example...

I've attached a program which produces the error. The program fails after count = 160 for me.



---

archive/issue_comments_233077.json:
```json
{
    "body": "Changing component from number theory to interfaces.",
    "created_at": "2015-01-30T11:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233077",
    "user": "jdemeyer"
}
```

Changing component from number theory to interfaces.



---

archive/issue_comments_233078.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-02-02T22:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233078",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_233079.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-02T22:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233079",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_233080.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-03T11:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233080",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_233081.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-25T16:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233081",
    "user": "rws"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_233082.json:
```json
{
    "body": "With #17718 merged:\n\n```\nsage -t --long src/sage/interfaces/sagespawn.pyx  # 2 doctests failed\nsage -t --long src/sage/interfaces/quit.py  # 1 doctest failed\n```\n",
    "created_at": "2015-02-25T16:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233082",
    "user": "rws"
}
```

With #17718 merged:

```
sage -t --long src/sage/interfaces/sagespawn.pyx  # 2 doctests failed
sage -t --long src/sage/interfaces/quit.py  # 1 doctest failed
```




---

archive/issue_comments_233083.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-25T17:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233083",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233084.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-25T17:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233084",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_233085.json:
```json
{
    "body": "Merged #17718 and latest `develop`. I also trivially fixed the `quit.py` failure but I don't get any failures in `sagespawn.pyx`. Can you try again and post the details of the failure if they still occur?",
    "created_at": "2015-02-25T17:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233085",
    "user": "jdemeyer"
}
```

Merged #17718 and latest `develop`. I also trivially fixed the `quit.py` failure but I don't get any failures in `sagespawn.pyx`. Can you try again and post the details of the failure if they still occur?



---

archive/issue_comments_233086.json:
```json
{
    "body": "Yes, `quit.py` is fine but I still get this twice:\n\n```\nFile \"src/sage/interfaces/sagespawn.pyx\", line 69, in sage.interfaces.sagespawn.SageSpawn.__repr__\nFailed example:\n    s  # indirect doctest\nExpected:\n    stupid process with PID ... running /bin/true\nGot:\n    stupid process with PID 3742 running /usr/bin/true\n```\n",
    "created_at": "2015-02-26T06:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233086",
    "user": "rws"
}
```

Yes, `quit.py` is fine but I still get this twice:

```
File "src/sage/interfaces/sagespawn.pyx", line 69, in sage.interfaces.sagespawn.SageSpawn.__repr__
Failed example:
    s  # indirect doctest
Expected:
    stupid process with PID ... running /bin/true
Got:
    stupid process with PID 3742 running /usr/bin/true
```




---

archive/issue_comments_233087.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-26T08:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233087",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233088.json:
```json
{
    "body": "Patchbot says tests are fine, whines about startup time, but on my machine there is no change. My Unix programming doesn't suffice for a code review, however.",
    "created_at": "2015-02-28T14:27:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233088",
    "user": "rws"
}
```

Patchbot says tests are fine, whines about startup time, but on my machine there is no change. My Unix programming doesn't suffice for a code review, however.



---

archive/issue_comments_233089.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-02T14:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233089",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233090.json:
```json
{
    "body": "doesn't merge cleanly againts the latest 6.7.beta4:\n\n```\nCONFLICT (content): Merge conflict in src/doc/en/reference/interfaces/index.rst\n```\n\ncan this be rebased?",
    "created_at": "2015-05-07T09:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233090",
    "user": "dimpase"
}
```

doesn't merge cleanly againts the latest 6.7.beta4:

```
CONFLICT (content): Merge conflict in src/doc/en/reference/interfaces/index.rst
```

can this be rebased?



---

archive/issue_comments_233091.json:
```json
{
    "body": "Replying to [comment:17 dimpase]:\n> doesn't merge cleanly againts the latest 6.7.beta4:\n> {{{\n> CONFLICT (content): Merge conflict in src/doc/en/reference/interfaces/index.rst\n> }}}\n> can this be rebased?\nWill it be reviewed then?",
    "created_at": "2015-05-07T09:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233091",
    "user": "jdemeyer"
}
```

Replying to [comment:17 dimpase]:
> doesn't merge cleanly againts the latest 6.7.beta4:
> {{{
> CONFLICT (content): Merge conflict in src/doc/en/reference/interfaces/index.rst
> }}}
> can this be rebased?
Will it be reviewed then?



---

archive/issue_comments_233092.json:
```json
{
    "body": "Replying to [comment:18 jdemeyer]:\n> Replying to [comment:17 dimpase]:\n> > doesn't merge cleanly againts the latest 6.7.beta4:\n> > {{{\n> > CONFLICT (content): Merge conflict in src/doc/en/reference/interfaces/index.rst\n> > }}}\n> > can this be rebased?\n> Will it be reviewed then?\n\nI will do my best.",
    "created_at": "2015-05-07T09:51:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233092",
    "user": "dimpase"
}
```

Replying to [comment:18 jdemeyer]:
> Replying to [comment:17 dimpase]:
> > doesn't merge cleanly againts the latest 6.7.beta4:
> > {{{
> > CONFLICT (content): Merge conflict in src/doc/en/reference/interfaces/index.rst
> > }}}
> > can this be rebased?
> Will it be reviewed then?

I will do my best.



---

archive/issue_comments_233093.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-05-08T08:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233093",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_233094.json:
```json
{
    "body": "Why is `SageSpawn` written in Cython? Reading over it, I couldn't find a reason, which probably just means I missed it.",
    "created_at": "2015-05-21T08:55:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233094",
    "user": "malb"
}
```

Why is `SageSpawn` written in Cython? Reading over it, I couldn't find a reason, which probably just means I missed it.



---

archive/issue_comments_233095.json:
```json
{
    "body": "Replying to [comment:21 malb]:\n> Why is `SageSpawn` written in Cython?\n1. it uses various system calls (of course, you could argue about using Python's `os` module but I think directly using system calls is better).\n2. it needs `Py_INCREF()` which cannot be done in pure Python.",
    "created_at": "2015-05-21T09:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233095",
    "user": "jdemeyer"
}
```

Replying to [comment:21 malb]:
> Why is `SageSpawn` written in Cython?
1. it uses various system calls (of course, you could argue about using Python's `os` module but I think directly using system calls is better).
2. it needs `Py_INCREF()` which cannot be done in pure Python.



---

archive/issue_comments_233096.json:
```json
{
    "body": "Thanks for explaining, that makes sense.",
    "created_at": "2015-05-21T10:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233096",
    "user": "malb"
}
```

Thanks for explaining, that makes sense.



---

archive/issue_comments_233097.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-05-27T08:21:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233097",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_233098.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-05-29T20:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233098",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_233099.json:
```json
{
    "body": "The original spawn class checks `self.closed` in the dtor:\n\n```\n    def __del__(self):\n        if self.closed:\n            return\n        try:\n            self.close()\n        except:\n            pass\n```\n\nSo why not just set that flag in `_keep_alive`? Or is there another resource managed by an attribute with a non-trivial dtor? This seems better than keeping the spawn instance alive forever... maybe I'm missing something?",
    "created_at": "2015-06-17T12:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233099",
    "user": "vbraun"
}
```

The original spawn class checks `self.closed` in the dtor:

```
    def __del__(self):
        if self.closed:
            return
        try:
            self.close()
        except:
            pass
```

So why not just set that flag in `_keep_alive`? Or is there another resource managed by an attribute with a non-trivial dtor? This seems better than keeping the spawn instance alive forever... maybe I'm missing something?



---

archive/issue_comments_233100.json:
```json
{
    "body": "Replying to [comment:27 vbraun]:\n> So why not just set that flag in `_keep_alive`? Or is there another resource managed by an attribute with a non-trivial dtor? This seems better than keeping the spawn instance alive forever... maybe I'm missing something?\n\n`Py_INCREF(self)` makes no assumptions on how `pexpect.spawn` works internally. Setting `self.closed` would work currently, but it would for example break with a newer version of `pexpect`.",
    "created_at": "2015-06-17T12:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233100",
    "user": "jdemeyer"
}
```

Replying to [comment:27 vbraun]:
> So why not just set that flag in `_keep_alive`? Or is there another resource managed by an attribute with a non-trivial dtor? This seems better than keeping the spawn instance alive forever... maybe I'm missing something?

`Py_INCREF(self)` makes no assumptions on how `pexpect.spawn` works internally. Setting `self.closed` would work currently, but it would for example break with a newer version of `pexpect`.



---

archive/issue_comments_233101.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-17T17:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233101",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_233102.json:
```json
{
    "body": "Fails on OSX:\n\n```\nsage -t --long src/sage/interfaces/expect.py  # 26 doctests failed\nsage -t --long src/sage/interfaces/gap.py  # 95 doctests failed\nsage -t --long src/sage/interfaces/mwrank.py  # 6 doctests failed\n```\n",
    "created_at": "2015-06-17T20:08:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233102",
    "user": "vbraun"
}
```

Fails on OSX:

```
sage -t --long src/sage/interfaces/expect.py  # 26 doctests failed
sage -t --long src/sage/interfaces/gap.py  # 95 doctests failed
sage -t --long src/sage/interfaces/mwrank.py  # 6 doctests failed
```




---

archive/issue_comments_233103.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-06-17T20:08:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233103",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_233104.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-18T08:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233104",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233105.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-18T08:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233105",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_233106.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-18T14:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233106",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_233107.json:
```json
{
    "body": "I got this (with #17924, only randomly fails)\n\n```\nsage -t --long src/sage/interfaces/sagespawn.pyx\n**********************************************************************\nFile \"src/sage/interfaces/sagespawn.pyx\", line 125, in sage.interfaces.sagespawn.SageSpawn.close\nFailed example:\n    while s.isalive():  # long time (5 seconds)\n        sleep(0.1)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.sagespawn.SageSpawn.close[3]>\", line 1, in <module>\n        while s.isalive():  # long time (5 seconds)\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect.py\", line 762, in isalive\n        pid, status = os.waitpid(self.pid, waitpid_options)\n      File \"sage/ext/interrupt/interrupt.pyx\", line 197, in sage.ext.interrupt.interrupt.sage_python_check_interrupt (/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/ext/interrupt/interrupt.c:1743)\n        sig_check()\n      File \"sage/ext/interrupt/interrupt.pyx\", line 86, in sage.ext.interrupt.interrupt.sig_raise_exception (/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/ext/interrupt/interrupt.c:884)\n        raise KeyboardInterrupt\n    KeyboardInterrupt\n**********************************************************************\n1 item had failures:\n   1 of   5 in sage.interfaces.sagespawn.SageSpawn.close\n    [24 tests, 1 failure, 5.08 s]\n```\n",
    "created_at": "2015-06-18T20:27:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233107",
    "user": "vbraun"
}
```

I got this (with #17924, only randomly fails)

```
sage -t --long src/sage/interfaces/sagespawn.pyx
**********************************************************************
File "src/sage/interfaces/sagespawn.pyx", line 125, in sage.interfaces.sagespawn.SageSpawn.close
Failed example:
    while s.isalive():  # long time (5 seconds)
        sleep(0.1)
Exception raised:
    Traceback (most recent call last):
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.sagespawn.SageSpawn.close[3]>", line 1, in <module>
        while s.isalive():  # long time (5 seconds)
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect.py", line 762, in isalive
        pid, status = os.waitpid(self.pid, waitpid_options)
      File "sage/ext/interrupt/interrupt.pyx", line 197, in sage.ext.interrupt.interrupt.sage_python_check_interrupt (/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/ext/interrupt/interrupt.c:1743)
        sig_check()
      File "sage/ext/interrupt/interrupt.pyx", line 86, in sage.ext.interrupt.interrupt.sig_raise_exception (/home/buildslave-sage/slave/sage_git/build/src/build/cythonized/sage/ext/interrupt/interrupt.c:884)
        raise KeyboardInterrupt
    KeyboardInterrupt
**********************************************************************
1 item had failures:
   1 of   5 in sage.interfaces.sagespawn.SageSpawn.close
    [24 tests, 1 failure, 5.08 s]
```




---

archive/issue_comments_233108.json:
```json
{
    "body": "Replying to [comment:34 vbraun]:\n> I got this (with #17924, only randomly fails)\n\nOn which machine?\n\nThis is probably yet another race condition: it looks like we are killing the process group of the child process when it has not yet created a new process group. So, we end up killing ourselves.",
    "created_at": "2015-06-19T08:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233108",
    "user": "jdemeyer"
}
```

Replying to [comment:34 vbraun]:
> I got this (with #17924, only randomly fails)

On which machine?

This is probably yet another race condition: it looks like we are killing the process group of the child process when it has not yet created a new process group. So, we end up killing ourselves.



---

archive/issue_comments_233109.json:
```json
{
    "body": "That was on arando. I'm going to close this ticket and leave the remaining race to you, then ;-)",
    "created_at": "2015-06-19T08:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233109",
    "user": "vbraun"
}
```

That was on arando. I'm going to close this ticket and leave the remaining race to you, then ;-)



---

archive/issue_comments_233110.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-19T08:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233110",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_233111.json:
```json
{
    "body": "Followup at #18741",
    "created_at": "2015-06-19T22:24:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17449#issuecomment-233111",
    "user": "vbraun"
}
```

Followup at #18741
