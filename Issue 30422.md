# Issue 30422: supersingular_j_polynomial does not use cached values

archive/issues_030422.json:
```json
{
    "body": "Keywords: supersingular elliptic curve\n\nIn sage.schemes.elliptic_curves.ell_finite_field.py, there is a function supersingular_j_polynomial() and also a dict cotaining the coefficients of these polynomials for primes p<300, but the function does not use these cached values!  They are used elsewhere in that file.\n\nI'll fix this, being careful that the precomputed cached coefficients are for the polynomials with factors of x and x-1728 removed, but there is a simple recipe for when they should be restored.\n\nAt the same time it might be sensible to replace the implementation of the computation of the polynomials from scratch with something faster.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30659\n\n",
    "created_at": "2020-09-25T09:50:08Z",
    "labels": [
        "component: elliptic curves",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "supersingular_j_polynomial does not use cached values",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30422",
    "user": "https://github.com/JohnCremona"
}
```
Keywords: supersingular elliptic curve

In sage.schemes.elliptic_curves.ell_finite_field.py, there is a function supersingular_j_polynomial() and also a dict cotaining the coefficients of these polynomials for primes p<300, but the function does not use these cached values!  They are used elsewhere in that file.

I'll fix this, being careful that the precomputed cached coefficients are for the polynomials with factors of x and x-1728 removed, but there is a simple recipe for when they should be restored.

At the same time it might be sensible to replace the implementation of the computation of the polynomials from scratch with something faster.

Issue created by migration from https://trac.sagemath.org/ticket/30659





---

archive/issue_comments_433472.json:
```json
{
    "body": "It's not quite as bad as I thought: the function supersingular_j_polynomial() does not use the precomputed coefficients, but the function is_j_supersingular does.\n\nI have rewired this so that supersingular_j_polynomial() uses the cached values unless a new flag (default True) is set to False, for testing, and caches any values computed.  Also the dict holding the precomputed coefficients is not filled at the top level, so it will not happen at startup to save a small amount of startup time.  Instead, it is filled the first time the dict is used, using a new function fill_ss_j_dict().",
    "created_at": "2021-02-03T14:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30422#issuecomment-433472",
    "user": "https://github.com/JohnCremona"
}
```

It's not quite as bad as I thought: the function supersingular_j_polynomial() does not use the precomputed coefficients, but the function is_j_supersingular does.

I have rewired this so that supersingular_j_polynomial() uses the cached values unless a new flag (default True) is set to False, for testing, and caches any values computed.  Also the dict holding the precomputed coefficients is not filled at the top level, so it will not happen at startup to save a small amount of startup time.  Instead, it is filled the first time the dict is used, using a new function fill_ss_j_dict().



---

archive/issue_comments_433473.json:
```json
{
    "body": "Ready for review.  Note that the patch only concerns programming logic, not mathematics, so can be reviewed by people not knowing anything about supersingular j polynomials, except that there is one for each prime p.\n\n---\nNew commits:",
    "created_at": "2021-02-03T15:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30422#issuecomment-433473",
    "user": "https://github.com/JohnCremona"
}
```

Ready for review.  Note that the patch only concerns programming logic, not mathematics, so can be reviewed by people not knowing anything about supersingular j polynomials, except that there is one for each prime p.

---
New commits:



---

archive/issue_comments_433474.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-02-03T15:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30422#issuecomment-433474",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_433475.json:
```json
{
    "body": "Fixing a docstring issue....",
    "created_at": "2021-02-03T15:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30422#issuecomment-433475",
    "user": "https://github.com/JohnCremona"
}
```

Fixing a docstring issue....



---

archive/issue_comments_433476.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-03T15:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30422#issuecomment-433476",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433477.json:
```json
{
    "body": "looks good. a few comments\n\n```\nall([ssjpol(p,True) == ssjpol(p,False) for p in primes(300)])\n```\ncould be without `[...]`\n\nYou could put the explanations above in the doc of `fill_ss_j_dict()`\n\nThis `use_cache = True` should rather be `use_cache=True` \n\n\nMissing line break here `+    r\"\"\"Return` before Return\n\n```\n+    - `use_cache` (boolean, default True) -- use cached coefficients if they exist\n```\nshould be\n\n```\n+    - ``use_cache`` (boolean, default ``True``) -- use cached coefficients if they exist\n```",
    "created_at": "2021-02-04T16:33:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30422#issuecomment-433477",
    "user": "https://github.com/fchapoton"
}
```

looks good. a few comments

```
all([ssjpol(p,True) == ssjpol(p,False) for p in primes(300)])
```
could be without `[...]`

You could put the explanations above in the doc of `fill_ss_j_dict()`

This `use_cache = True` should rather be `use_cache=True` 


Missing line break here `+    r"""Return` before Return

```
+    - `use_cache` (boolean, default True) -- use cached coefficients if they exist
```
should be

```
+    - ``use_cache`` (boolean, default ``True``) -- use cached coefficients if they exist
```



---

archive/issue_comments_433478.json:
```json
{
    "body": "Thanks.  I'll fix those tomorrow unless you ge there first.  I had thought that one *always* had to put spaces around an =, but clearly not!",
    "created_at": "2021-02-04T17:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30422#issuecomment-433478",
    "user": "https://github.com/JohnCremona"
}
```

Thanks.  I'll fix those tomorrow unless you ge there first.  I had thought that one *always* had to put spaces around an =, but clearly not!



---

archive/issue_comments_433479.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-05T09:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30422#issuecomment-433479",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433480.json:
```json
{
    "body": "I hope the last commit deals with those minor issues in a satisfactory way.",
    "created_at": "2021-02-05T09:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30422#issuecomment-433480",
    "user": "https://github.com/JohnCremona"
}
```

I hope the last commit deals with those minor issues in a satisfactory way.



---

archive/issue_comments_433481.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-05T10:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30422#issuecomment-433481",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_433482.json:
```json
{
    "body": "ok, thanks",
    "created_at": "2021-02-05T10:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30422#issuecomment-433482",
    "user": "https://github.com/fchapoton"
}
```

ok, thanks



---

archive/issue_comments_433483.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-03-09T00:00:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30422#issuecomment-433483",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_079748.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-09T00:00:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30422",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30422#event-79748"
}
```
