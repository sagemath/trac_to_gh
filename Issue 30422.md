# Issue 30422: supersingular_j_polynomial does not use cached values

Issue created by migration from https://trac.sagemath.org/ticket/30659

Original creator: cremona

Original creation time: 2020-09-25 09:50:08

Keywords: supersingular elliptic curve

In sage.schemes.elliptic_curves.ell_finite_field.py, there is a function supersingular_j_polynomial() and also a dict cotaining the coefficients of these polynomials for primes p<300, but the function does not use these cached values!  They are used elsewhere in that file.

I'll fix this, being careful that the precomputed cached coefficients are for the polynomials with factors of x and x-1728 removed, but there is a simple recipe for when they should be restored.

At the same time it might be sensible to replace the implementation of the computation of the polynomials from scratch with something faster.


---

Comment by cremona created at 2021-02-03 14:55:45

It's not quite as bad as I thought: the function supersingular_j_polynomial() does not use the precomputed coefficients, but the function is_j_supersingular does.

I have rewired this so that supersingular_j_polynomial() uses the cached values unless a new flag (default True) is set to False, for testing, and caches any values computed.  Also the dict holding the precomputed coefficients is not filled at the top level, so it will not happen at startup to save a small amount of startup time.  Instead, it is filled the first time the dict is used, using a new function fill_ss_j_dict().


---

Comment by cremona created at 2021-02-03 15:00:08

Ready for review.  Note that the patch only concerns programming logic, not mathematics, so can be reviewed by people not knowing anything about supersingular j polynomials, except that there is one for each prime p.
----
New commits:


---

Comment by cremona created at 2021-02-03 15:00:08

Changing status from new to needs_review.


---

Comment by cremona created at 2021-02-03 15:08:26

Fixing a docstring issue....


---

Comment by git created at 2021-02-03 15:27:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2021-02-04 16:33:44

looks good. a few comments


```
all([ssjpol(p,True) == ssjpol(p,False) for p in primes(300)])
```

could be without `[...]`

You could put the explanations above in the doc of `fill_ss_j_dict()`

This `use_cache = True` should rather be `use_cache=True` 


Missing line break here `+    r"""Return` before Return


```
+    - `use_cache` (boolean, default True) -- use cached coefficients if they exist
```

should be

```
+    - ``use_cache`` (boolean, default ``True``) -- use cached coefficients if they exist
```



---

Comment by cremona created at 2021-02-04 17:04:53

Thanks.  I'll fix those tomorrow unless you ge there first.  I had thought that one *always* had to put spaces around an =, but clearly not!


---

Comment by git created at 2021-02-05 09:37:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2021-02-05 09:39:15

I hope the last commit deals with those minor issues in a satisfactory way.


---

Comment by chapoton created at 2021-02-05 10:07:53

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2021-02-05 10:07:53

ok, thanks


---

Comment by vbraun created at 2021-03-09 00:00:46

Resolution: fixed
