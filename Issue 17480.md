# Issue 17480: Failure to reduce int modulo large prime

Issue created by migration from https://trac.sagemath.org/ticket/17717

Original creator: xander.faber

Original creation time: 2015-02-03 02:06:47

Keywords: modular arithmetic


```
sage: p = next_prime(2^32)
sage: p
4294967311
sage: GF(p)(int(p+1))
4294967312
sage: GF(p)(p+1)
1
```


The issue arises in 
sage/rings/finite_rings/integer_mod.pyx

class method
IntegerMod_gmp.set_from_long

On line 1732, the code reduces value (mod modulus) when value < 0 or ( value < modulus ). The latter condition is backward. It should be replaced with ( modulus < value). 

Replace line 1732
        `if value < 0 or mpz_cmp_si(self.__modulus.sageInteger.value, value) >= 0:`
with
        `if value < 0 or mpz_cmp_si(value, self.__modulus.sageInteger.value) >= 0:`


---

Comment by git created at 2015-02-10 01:43:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by xander.faber created at 2015-02-10 01:45:02

Changing status from new to needs_review.


---

Comment by tscrim created at 2015-02-10 08:22:31

Yes, those are indeed the other way around. I think the more consistent solution (at least with `set_from_mpz` above it) is

```python
if value < 0 or mpz_cmp_si(value, self.__modulus.sageInteger.value) >= 0
```

and then if you could also add a doctest to that method

```
"""
EXAMPLES::

    sage: p = next_prime(2^32)
    sage: GF(p)(int(p+1))
    1
"""
```

Thanks.


---

Comment by git created at 2015-02-12 01:22:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by xander.faber created at 2015-02-12 01:23:11

tscrim - The fix you suggest has the wrong syntax for gmp. The mpz_t must be the first argument. 

Doctest added
----
New commits:
----
New commits:


---

Comment by tscrim created at 2015-02-12 05:52:23

Ah, I see, it's a different function. You need to indent the code within the `EXAMPLES::` block one more, and once you do that, you can set a positive review on my behalf. Thanks.


---

Comment by jdemeyer created at 2015-02-12 09:42:55

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-02-12 11:37:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by xander.faber created at 2015-02-12 11:39:49

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2015-02-18 23:22:40

Resolution: fixed
