# Issue 17480: Failure to reduce int modulo large prime

archive/issues_017480.json:
```json
{
    "body": "Keywords: modular arithmetic\n\n\n```\nsage: p = next_prime(2^32)\nsage: p\n4294967311\nsage: GF(p)(int(p+1))\n4294967312\nsage: GF(p)(p+1)\n1\n```\n\n\nThe issue arises in \nsage/rings/finite_rings/integer_mod.pyx\n\nclass method\nIntegerMod_gmp.set_from_long\n\nOn line 1732, the code reduces value (mod modulus) when value < 0 or ( value < modulus ). The latter condition is backward. It should be replaced with ( modulus < value). \n\nReplace line 1732\n        `if value < 0 or mpz_cmp_si(self.__modulus.sageInteger.value, value) >= 0:`\nwith\n        `if value < 0 or mpz_cmp_si(value, self.__modulus.sageInteger.value) >= 0:`\n\nIssue created by migration from https://trac.sagemath.org/ticket/17717\n\n",
    "created_at": "2015-02-03T02:06:47Z",
    "labels": [
        "finite rings",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Failure to reduce int modulo large prime",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17480",
    "user": "xander.faber"
}
```
Keywords: modular arithmetic


```
sage: p = next_prime(2^32)
sage: p
4294967311
sage: GF(p)(int(p+1))
4294967312
sage: GF(p)(p+1)
1
```


The issue arises in 
sage/rings/finite_rings/integer_mod.pyx

class method
IntegerMod_gmp.set_from_long

On line 1732, the code reduces value (mod modulus) when value < 0 or ( value < modulus ). The latter condition is backward. It should be replaced with ( modulus < value). 

Replace line 1732
        `if value < 0 or mpz_cmp_si(self.__modulus.sageInteger.value, value) >= 0:`
with
        `if value < 0 or mpz_cmp_si(value, self.__modulus.sageInteger.value) >= 0:`

Issue created by migration from https://trac.sagemath.org/ticket/17717





---

archive/issue_comments_233566.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-10T01:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17480#issuecomment-233566",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233567.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-10T01:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17480#issuecomment-233567",
    "user": "xander.faber"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_233568.json:
```json
{
    "body": "Yes, those are indeed the other way around. I think the more consistent solution (at least with `set_from_mpz` above it) is\n\n```python\nif value < 0 or mpz_cmp_si(value, self.__modulus.sageInteger.value) >= 0\n```\n\nand then if you could also add a doctest to that method\n\n```\n\"\"\"\nEXAMPLES::\n\n    sage: p = next_prime(2^32)\n    sage: GF(p)(int(p+1))\n    1\n\"\"\"\n```\n\nThanks.",
    "created_at": "2015-02-10T08:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17480#issuecomment-233568",
    "user": "@tscrim"
}
```

Yes, those are indeed the other way around. I think the more consistent solution (at least with `set_from_mpz` above it) is

```python
if value < 0 or mpz_cmp_si(value, self.__modulus.sageInteger.value) >= 0
```

and then if you could also add a doctest to that method

```
"""
EXAMPLES::

    sage: p = next_prime(2^32)
    sage: GF(p)(int(p+1))
    1
"""
```

Thanks.



---

archive/issue_comments_233569.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-12T01:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17480#issuecomment-233569",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233570.json:
```json
{
    "body": "tscrim - The fix you suggest has the wrong syntax for gmp. The mpz_t must be the first argument. \n\nDoctest added\n----\nNew commits:\n----\nNew commits:",
    "created_at": "2015-02-12T01:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17480#issuecomment-233570",
    "user": "xander.faber"
}
```

tscrim - The fix you suggest has the wrong syntax for gmp. The mpz_t must be the first argument. 

Doctest added
----
New commits:
----
New commits:



---

archive/issue_comments_233571.json:
```json
{
    "body": "Ah, I see, it's a different function. You need to indent the code within the `EXAMPLES::` block one more, and once you do that, you can set a positive review on my behalf. Thanks.",
    "created_at": "2015-02-12T05:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17480#issuecomment-233571",
    "user": "@tscrim"
}
```

Ah, I see, it's a different function. You need to indent the code within the `EXAMPLES::` block one more, and once you do that, you can set a positive review on my behalf. Thanks.



---

archive/issue_comments_233572.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-12T09:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17480#issuecomment-233572",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_233573.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-12T11:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17480#issuecomment-233573",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233574.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-02-12T11:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17480#issuecomment-233574",
    "user": "xander.faber"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_233575.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-02-18T23:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17480#issuecomment-233575",
    "user": "@vbraun"
}
```

Resolution: fixed
