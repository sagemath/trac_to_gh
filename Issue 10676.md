# Issue 10676: Singular fails to build on OSX with 64bit kernel

archive/issues_010676.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  @saliola @malb\n\nOSX usually runs a 32bit kernel (`uname -m == 'i386'`), but very new Macs default to a 64bit kernel (`uname -m == `x86_64`). This breaks Singular, since the `singuname.sh` script is not aware of the possibility of `x86_64`. \n\nFrom the OSX 10.6 wikipedia page http://en.wikipedia.org/wiki/Mac_OS_X_Snow_Leopard\n\nNewer Xserve and Mac Pro machines will run a 64-bit kernel by default; newer iMac machines can run a 64-bit kernel, but will not do so by default. Users wishing to use the 64-bit kernel on those machines must hold down the numbers 6 and 4 on the keyboard while booting to get the 64-bit kernel to load.\n\nFranco Saliola on sage-devel (https://groups.google.com/d/msg/sage-release/X1J1ciueT5A/doPR9vPVZVAJ) has checked that modifying singuname.sh to return ix86Mac-darwin (same as other OSX versions) allows Singular to build correctly.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10739\n\n",
    "created_at": "2011-02-04T00:51:46Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.2",
    "title": "Singular fails to build on OSX with 64bit kernel",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10676",
    "user": "https://github.com/vbraun"
}
```
Assignee: GeorgSWeber

CC:  @saliola @malb

OSX usually runs a 32bit kernel (`uname -m == 'i386'`), but very new Macs default to a 64bit kernel (`uname -m == `x86_64`). This breaks Singular, since the `singuname.sh` script is not aware of the possibility of `x86_64`. 

From the OSX 10.6 wikipedia page http://en.wikipedia.org/wiki/Mac_OS_X_Snow_Leopard

Newer Xserve and Mac Pro machines will run a 64-bit kernel by default; newer iMac machines can run a 64-bit kernel, but will not do so by default. Users wishing to use the 64-bit kernel on those machines must hold down the numbers 6 and 4 on the keyboard while booting to get the 64-bit kernel to load.

Franco Saliola on sage-devel (https://groups.google.com/d/msg/sage-release/X1J1ciueT5A/doPR9vPVZVAJ) has checked that modifying singuname.sh to return ix86Mac-darwin (same as other OSX versions) allows Singular to build correctly.

Issue created by migration from https://trac.sagemath.org/ticket/10739





---

archive/issue_comments_112026.json:
```json
{
    "body": "I've reported it upstream at http://www.singular.uni-kl.de:8002/trac/ticket/313",
    "created_at": "2011-02-04T01:06:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10676#issuecomment-112026",
    "user": "https://github.com/vbraun"
}
```

I've reported it upstream at http://www.singular.uni-kl.de:8002/trac/ticket/313



---

archive/issue_events_027675.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-02-04T17:58:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10676",
    "milestone": "sage-4.6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10676#event-27675"
}
```



---

archive/issue_comments_112027.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-02-04T17:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10676#issuecomment-112027",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_112028.json:
```json
{
    "body": "Upstream agrees that the changes are correct, although they want to introduce a new label because it is also used for binary packages. Since we have our own labels for binary distributions, we can just use the original workaround until the next upstream release.\n\nI've made an updated singular spkg. Franco, can you test it?\n\nI also tried to upgrade Singular to 3-1-2, but found that rather complicated since the location of many headers moved.",
    "created_at": "2011-02-04T17:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10676#issuecomment-112028",
    "user": "https://github.com/vbraun"
}
```

Upstream agrees that the changes are correct, although they want to introduce a new label because it is also used for binary packages. Since we have our own labels for binary distributions, we can just use the original workaround until the next upstream release.

I've made an updated singular spkg. Franco, can you test it?

I also tried to upgrade Singular to 3-1-2, but found that rather complicated since the location of many headers moved.



---

archive/issue_comments_112029.json:
```json
{
    "body": "Replying to [comment:3 vbraun]:\n> \n> I've made an updated singular spkg. Franco, can you test it?\n\n\nSure thing, but can you point me to some documentation on how to swap the old spkg with the new one?",
    "created_at": "2011-02-04T20:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10676#issuecomment-112029",
    "user": "https://github.com/saliola"
}
```

Replying to [comment:3 vbraun]:
> 
> I've made an updated singular spkg. Franco, can you test it?


Sure thing, but can you point me to some documentation on how to swap the old spkg with the new one?



---

archive/issue_comments_112030.json:
```json
{
    "body": "You can force-install (-f) the spkg from the command line via\n\n```\nsage -f http://www.stp.dias.ie/~vbraun/Sage/spkg/singular-3-1-1-4.p4.spkg\n```",
    "created_at": "2011-02-04T20:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10676#issuecomment-112030",
    "user": "https://github.com/vbraun"
}
```

You can force-install (-f) the spkg from the command line via

```
sage -f http://www.stp.dias.ie/~vbraun/Sage/spkg/singular-3-1-1-4.p4.spkg
```



---

archive/issue_comments_112031.json:
```json
{
    "body": "Replying to [comment:6 vbraun]:\n> You can force-install (-f) the spkg from the command line via\n> \n> ```\n> sage -f http://www.stp.dias.ie/~vbraun/Sage/spkg/singular-3-1-1-4.p4.spkg\n> ```\n\n\nOh, I see. I thought I was supposed to attempt a fresh install with this spkg in place of the old one.\n\nI'll report back soon.",
    "created_at": "2011-02-04T20:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10676#issuecomment-112031",
    "user": "https://github.com/saliola"
}
```

Replying to [comment:6 vbraun]:
> You can force-install (-f) the spkg from the command line via
> 
> ```
> sage -f http://www.stp.dias.ie/~vbraun/Sage/spkg/singular-3-1-1-4.p4.spkg
> ```


Oh, I see. I thought I was supposed to attempt a fresh install with this spkg in place of the old one.

I'll report back soon.



---

archive/issue_comments_112032.json:
```json
{
    "body": "you can do that too, just put the new singular spkg in `$SAGE_ROOT/spkg/standard`. The build will use the newest version in that directory. But considering that this is just a small build fix I don't think that its necessary to go through a completely fresh build...",
    "created_at": "2011-02-04T20:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10676#issuecomment-112032",
    "user": "https://github.com/vbraun"
}
```

you can do that too, just put the new singular spkg in `$SAGE_ROOT/spkg/standard`. The build will use the newest version in that directory. But considering that this is just a small build fix I don't think that its necessary to go through a completely fresh build...



---

archive/issue_comments_112033.json:
```json
{
    "body": "Replying to [comment:8 vbraun]:\n> just put the new singular spkg in `$SAGE_ROOT/spkg/standard`.\n\n\nI did exactly this. It compiled without a problem. However, there was a doctest failure when I ran `make ptest`:\n\n```\nsage -t -force_lib \"devel/sage/sage/groups/matrix_gps/matrix_group.py\"\n**********************************************************************\nFile \"/Users/saliola/sage-4.6.2.alpha3-trac10739/devel/sage/sage/groups/matrix_gps/matrix_group.py\", line 668:\n    sage: G.random_element()\nExpected:\n    [2 1 1 1]\n    [1 0 2 1]\n    [0 1 1 0]\n    [1 0 0 1]\nGot:\n    [0 1 1 0]\n    [1 2 2 2]\n    [1 1 1 0]\n    [2 0 1 2]\n**********************************************************************\nFile \"/Users/saliola/sage-4.6.2.alpha3-trac10739/devel/sage/sage/groups/matrix_gps/matrix_group.py\", line 679:\n    sage: G.random_element()\nExpected:\n    [1 3]\n    [0 3]\nGot:\n    [4 2]\n    [1 0]\n**********************************************************************\nFile \"/Users/saliola/sage-4.6.2.alpha3-trac10739/devel/sage/sage/groups/matrix_gps/matrix_group.py\", line 682:\n    sage: G.random_element()\nExpected:\n    [2 2]\n    [1 0]\nGot:\n    [4 1]\n    [0 2]\n**********************************************************************\nFile \"/Users/saliola/sage-4.6.2.alpha3-trac10739/devel/sage/sage/groups/matrix_gps/matrix_group.py\", line 685:\n    sage: G.random_element()\nExpected:\n    [4 0]\n    [1 4]\nGot:\n    [2 4]\n    [2 3]\n**********************************************************************\n1 items had failures:\n   4 of  10 in __main__.example_22\n***Test Failed*** 4 failures.\n```\nInterestingly, this is precisely the same error (including the same output) as in #9310. Note that I now have two independent builds of sage-4.6.2.alpha3 on my machine, one in which this test passes and the other in which it fails.\n\nAnyhow, I think this doctest failure is unrelated. Your fix works perfectly, so I am willing to give it a positive review provided that you agree that the above failure is unrelated.",
    "created_at": "2011-02-05T01:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10676#issuecomment-112033",
    "user": "https://github.com/saliola"
}
```

Replying to [comment:8 vbraun]:
> just put the new singular spkg in `$SAGE_ROOT/spkg/standard`.


I did exactly this. It compiled without a problem. However, there was a doctest failure when I ran `make ptest`:

```
sage -t -force_lib "devel/sage/sage/groups/matrix_gps/matrix_group.py"
**********************************************************************
File "/Users/saliola/sage-4.6.2.alpha3-trac10739/devel/sage/sage/groups/matrix_gps/matrix_group.py", line 668:
    sage: G.random_element()
Expected:
    [2 1 1 1]
    [1 0 2 1]
    [0 1 1 0]
    [1 0 0 1]
Got:
    [0 1 1 0]
    [1 2 2 2]
    [1 1 1 0]
    [2 0 1 2]
**********************************************************************
File "/Users/saliola/sage-4.6.2.alpha3-trac10739/devel/sage/sage/groups/matrix_gps/matrix_group.py", line 679:
    sage: G.random_element()
Expected:
    [1 3]
    [0 3]
Got:
    [4 2]
    [1 0]
**********************************************************************
File "/Users/saliola/sage-4.6.2.alpha3-trac10739/devel/sage/sage/groups/matrix_gps/matrix_group.py", line 682:
    sage: G.random_element()
Expected:
    [2 2]
    [1 0]
Got:
    [4 1]
    [0 2]
**********************************************************************
File "/Users/saliola/sage-4.6.2.alpha3-trac10739/devel/sage/sage/groups/matrix_gps/matrix_group.py", line 685:
    sage: G.random_element()
Expected:
    [4 0]
    [1 4]
Got:
    [2 4]
    [2 3]
**********************************************************************
1 items had failures:
   4 of  10 in __main__.example_22
***Test Failed*** 4 failures.
```
Interestingly, this is precisely the same error (including the same output) as in #9310. Note that I now have two independent builds of sage-4.6.2.alpha3 on my machine, one in which this test passes and the other in which it fails.

Anyhow, I think this doctest failure is unrelated. Your fix works perfectly, so I am willing to give it a positive review provided that you agree that the above failure is unrelated.



---

archive/issue_comments_112034.json:
```json
{
    "body": "Yes, the different random seed for matrices must be an unrelated issue.\n\nBut if one build repeatedly passes \"make ptest\" and the other consistently fails, this would be an excellent opportunity to debug #9310. Presumably the only difference is that the first compilation was interrupted at one point, so the order in which spkgs were built is different. This might have changed linked libraries in some components due to (undiscovered) soft dependencies, for example. Can you diff the two trees (excluding log files etc) and find out the difference?",
    "created_at": "2011-02-05T02:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10676#issuecomment-112034",
    "user": "https://github.com/vbraun"
}
```

Yes, the different random seed for matrices must be an unrelated issue.

But if one build repeatedly passes "make ptest" and the other consistently fails, this would be an excellent opportunity to debug #9310. Presumably the only difference is that the first compilation was interrupted at one point, so the order in which spkgs were built is different. This might have changed linked libraries in some components due to (undiscovered) soft dependencies, for example. Can you diff the two trees (excluding log files etc) and find out the difference?



---

archive/issue_comments_112035.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-02-05T03:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10676#issuecomment-112035",
    "user": "https://github.com/saliola"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_112036.json:
```json
{
    "body": "I agree that this is a good opportunity to debug #9310; I'll mark this as positive review and move the conversation to #9310.",
    "created_at": "2011-02-05T03:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10676#issuecomment-112036",
    "user": "https://github.com/saliola"
}
```

I agree that this is a good opportunity to debug #9310; I'll mark this as positive review and move the conversation to #9310.



---

archive/issue_events_027676.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-02-16T09:39:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10676",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10676#event-27676"
}
```



---

archive/issue_comments_112037.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-02-16T09:39:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10676",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10676#issuecomment-112037",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
