# Issue 31286: Fix dependencies of ipywidgets

archive/issues_031286.json:
```json
{
    "body": "CC:  dimpase @kliem simonking slelievre\n\nAfter #31278, which removed heavy dependencies from `widgetsnbextension` (which is a dependency of `ipywidgets`), we have to add some (lighter) dependencies to `ipywidgets`.\n\nhttps://github.com/jupyter-widgets/ipywidgets/blob/master/setup.cfg#L35\nlists:\n\n```\ninstall_requires =\n  ipykernel>=4.5.1\n  ipython>=6.1.0\n  traitlets>=4.3.1\n  nbformat>=4.2.0\n  widgetsnbextension~=4.0a0\n  jupyterlab_widgets~=2.0a0\n```\n\nThese are not reflected in our `dependency` file.\n\nSo far this has not caused a build failure, but it is possible that one could appear in heavily parallelized builds.\n\nThe missing dependency is visible in the testsuite run for optional package `p_group_cohomology` in https://github.com/mkoeppe/sage/runs/2145415988\n\n```\nRunning the test suite for p_group_cohomology-3.3.2...\nMaking check in src\nRunning doctests with ID 2021-03-19-18-58-47-d127e4fd.\nUsing --optional=debian,dochtml,meataxe,memlimit,pip,polylib,pycosat,sage,sage_spkg\nSorting sources by runtime so that slower doctests are run first....\nDoctesting 13 files using 3 threads.\nTraceback (most recent call last):\n  File \"/sage/src/bin/sage-runtests\", line 182, in <module>\n    err = DC.run()\n  File \"/sage/local/lib/python3.9/site-packages/sage/doctest/control.py\", line 1212, in run\n    self.run_doctests()\n  File \"/sage/local/lib/python3.9/site-packages/sage/doctest/control.py\", line 909, in run_doctests\n    self.dispatcher = DocTestDispatcher(self)\n  File \"/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1658, in __init__\n    init_sage(controller)\n  File \"/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 209, in init_sage\n    controller.load_environment()\n  File \"/sage/local/lib/python3.9/site-packages/sage/doctest/control.py\", line 530, in load_environment\n    return import_module(self.options.environment)\n...\n  File \"/sage/local/lib/python3.9/site-packages/sage/repl/ipython_kernel/all_jupyter.py\", line 7, in <module>\n    from .widgets_sagenb import (input_box, text_control, slider,\n  File \"/sage/local/lib/python3.9/site-packages/sage/repl/ipython_kernel/widgets_sagenb.py\", line 31, in <module>\n    from ipywidgets.widgets import (IntSlider, IntRangeSlider, FloatSlider,\n  File \"/sage/local/lib/python3.9/site-packages/ipywidgets/__init__.py\", line 25, in <module>\n    from .widgets import *\n  File \"/sage/local/lib/python3.9/site-packages/ipywidgets/widgets/__init__.py\", line 4, in <module>\n    from .widget import Widget, CallbackDispatcher, register, widget_serialization\n  File \"/sage/local/lib/python3.9/site-packages/ipywidgets/widgets/widget.py\", line 18, in <module>\n    from ipykernel.comm import Comm\nModuleNotFoundError: No module named 'ipykernel'\n********************************************************************************\nError testing pGroupCohomology\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/31523\n\n",
    "created_at": "2021-03-19T19:49:17Z",
    "labels": [
        "packages: standard",
        "critical",
        "bug"
    ],
    "title": "Fix dependencies of ipywidgets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31286",
    "user": "mkoeppe"
}
```
CC:  dimpase @kliem simonking slelievre

After #31278, which removed heavy dependencies from `widgetsnbextension` (which is a dependency of `ipywidgets`), we have to add some (lighter) dependencies to `ipywidgets`.

https://github.com/jupyter-widgets/ipywidgets/blob/master/setup.cfg#L35
lists:

```
install_requires =
  ipykernel>=4.5.1
  ipython>=6.1.0
  traitlets>=4.3.1
  nbformat>=4.2.0
  widgetsnbextension~=4.0a0
  jupyterlab_widgets~=2.0a0
```

These are not reflected in our `dependency` file.

So far this has not caused a build failure, but it is possible that one could appear in heavily parallelized builds.

The missing dependency is visible in the testsuite run for optional package `p_group_cohomology` in https://github.com/mkoeppe/sage/runs/2145415988

```
Running the test suite for p_group_cohomology-3.3.2...
Making check in src
Running doctests with ID 2021-03-19-18-58-47-d127e4fd.
Using --optional=debian,dochtml,meataxe,memlimit,pip,polylib,pycosat,sage,sage_spkg
Sorting sources by runtime so that slower doctests are run first....
Doctesting 13 files using 3 threads.
Traceback (most recent call last):
  File "/sage/src/bin/sage-runtests", line 182, in <module>
    err = DC.run()
  File "/sage/local/lib/python3.9/site-packages/sage/doctest/control.py", line 1212, in run
    self.run_doctests()
  File "/sage/local/lib/python3.9/site-packages/sage/doctest/control.py", line 909, in run_doctests
    self.dispatcher = DocTestDispatcher(self)
  File "/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1658, in __init__
    init_sage(controller)
  File "/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 209, in init_sage
    controller.load_environment()
  File "/sage/local/lib/python3.9/site-packages/sage/doctest/control.py", line 530, in load_environment
    return import_module(self.options.environment)
...
  File "/sage/local/lib/python3.9/site-packages/sage/repl/ipython_kernel/all_jupyter.py", line 7, in <module>
    from .widgets_sagenb import (input_box, text_control, slider,
  File "/sage/local/lib/python3.9/site-packages/sage/repl/ipython_kernel/widgets_sagenb.py", line 31, in <module>
    from ipywidgets.widgets import (IntSlider, IntRangeSlider, FloatSlider,
  File "/sage/local/lib/python3.9/site-packages/ipywidgets/__init__.py", line 25, in <module>
    from .widgets import *
  File "/sage/local/lib/python3.9/site-packages/ipywidgets/widgets/__init__.py", line 4, in <module>
    from .widget import Widget, CallbackDispatcher, register, widget_serialization
  File "/sage/local/lib/python3.9/site-packages/ipywidgets/widgets/widget.py", line 18, in <module>
    from ipykernel.comm import Comm
ModuleNotFoundError: No module named 'ipykernel'
********************************************************************************
Error testing pGroupCohomology
```


Issue created by migration from https://trac.sagemath.org/ticket/31523





---

archive/issue_comments_447145.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-03-19T19:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31286#issuecomment-447145",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_447146.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-03-19T19:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31286#issuecomment-447146",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_447147.json:
```json
{
    "body": "LGTM.",
    "created_at": "2021-03-23T08:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31286#issuecomment-447147",
    "user": "@kliem"
}
```

LGTM.



---

archive/issue_comments_447148.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-03-23T08:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31286#issuecomment-447148",
    "user": "@kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_447149.json:
```json
{
    "body": "Thank you.",
    "created_at": "2021-03-23T17:19:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31286#issuecomment-447149",
    "user": "mkoeppe"
}
```

Thank you.



---

archive/issue_comments_447150.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2021-03-29T23:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31286#issuecomment-447150",
    "user": "mkoeppe"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_447151.json:
```json
{
    "body": "Setting priority to blocker to bring this ticket to the attention of the release bot.",
    "created_at": "2021-03-29T23:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31286#issuecomment-447151",
    "user": "mkoeppe"
}
```

Setting priority to blocker to bring this ticket to the attention of the release bot.



---

archive/issue_comments_447152.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-04-02T22:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31286",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31286#issuecomment-447152",
    "user": "vbraun"
}
```

Resolution: fixed
