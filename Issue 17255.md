# Issue 17255: Speedup k-closure

Issue created by migration from Trac.

Original creator: tscrim

Original creation time: 2014-12-13 02:27:10

Assignee: tscrim

CC:  stefan rudi chaoxu

Keywords: k-closed

Right now, checking for k-closed is slow because it uses Sage sets whereas we only need python sets.


---

Comment by tscrim created at 2014-12-13 02:53:09

With patch:

```
sage: PR4 = RootSystem(['D',4]).root_lattice().positive_roots()
sage: m4 = matrix(map(lambda x: x.to_vector(), PR4)).transpose()
sage: M4 = Matroid(m4)
sage: %timeit M4.is_k_closed(3)
10 loops, best of 3: 147 ms per loop
sage: %timeit M4.is_k_closed(4)
1 loops, best of 3: 413 ms per loop
sage: PR5 = RootSystem(['D',5]).root_lattice().positive_roots()
sage: m5 = matrix(map(lambda x: x.to_vector(), PR5)).transpose()
sage: M5 = Matroid(m5)
sage: %timeit M5.is_k_closed(3)
1 loops, best of 3: 1.45 s per loop
```

Before:

```
sage: %timeit M4.is_k_closed(3)
1 loops, best of 3: 776 ms per loop
sage: %timeit M4.is_k_closed(4)
1 loops, best of 3: 3.09 s per loop
sage: %timeit M5.is_k_closed(3)
1 loops, best of 3: 4.16 s per loop
```

So we are getting a 3x~4x speedup.
----
New commits:


---

Comment by tscrim created at 2014-12-13 02:53:09

Changing status from new to needs_review.


---

Comment by git created at 2014-12-20 01:33:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-05-26 21:19:16

Hi Travis,

I checked out this patch and it all works as advertised. Positive review, except for one thing:

A merge with 'master' was necessary before sage -b would successfully build this on my sage 6.7.  The logical thing would perhaps be to push the merged branch I created, but I hesitate to do this since my recent experience with git tell me that I might not fully understand how things work when it comes to this. Perhaps there is another, better way, and also I do not want to risk messing up your work.

So please update the branch to something that compiles out of the box, or argue that this is unnecessary. Then feel free to set this to 'positive review'.


---

Comment by tscrim created at 2015-05-26 21:33:22

Replying to [comment:5 Rudi]:
> I checked out this patch and it all works as advertised. Positive review, except for one thing:

Thank you for the review.

> A merge with 'master' was necessary before sage -b would successfully build this on my sage 6.7.  The logical thing would perhaps be to push the merged branch I created, but I hesitate to do this since my recent experience with git tell me that I might not fully understand how things work when it comes to this. Perhaps there is another, better way, and also I do not want to risk messing up your work.
> 
> So please update the branch to something that compiles out of the box, or argue that this is unnecessary. Then feel free to set this to 'positive review'.

The branch is merged with the latest `develop` at merge time, so if this works after merging (cleanly, i.e., without having to handle any merge conflicts) with `master` (or now `develop` at 6.8.beta0), there should be no problems.

For the record, my usual workflow is to always merge the branch into my current `develop` branch as my current spkgs might be incompatible with older versions of Sage. Plus it saves on compilation time. Also if you push it to a different branch and set that, there is no way to corrupt my work on my branch.

Thank you again.


---

Comment by tscrim created at 2015-05-26 21:33:22

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-05-26 23:36:29

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2015-05-26 23:36:29

Merge conflict (probably #18429 or #18427).


---

Comment by git created at 2015-05-27 04:41:58

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by tscrim created at 2015-05-27 04:42:47

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2015-05-27 04:42:47

Conflict was #18429, but I also merged in #18427 to be safe.


---

Comment by vbraun created at 2015-05-27 22:09:36

Resolution: fixed
