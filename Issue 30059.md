# Issue 30059: System package information and spkg-configure for mathjax

archive/issues_030059.json:
```json
{
    "body": "CC:  @jcamp0x2a paulmasson slelievre egourgoulhon mjo klee jhpalmieri nthiery enriqueartal fbissey arojas thansen etn40ff @tobiasdiez\n\nWe add an `spkg-configure.m4` script for the standard package `mathjax`, as well as corresponding system package information in `build/pkgs/mathjax/distros/`\n\nIssue created by migration from https://trac.sagemath.org/ticket/30296\n\n",
    "created_at": "2020-08-05T20:02:12Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "title": "System package information and spkg-configure for mathjax",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30059",
    "user": "mkoeppe"
}
```
CC:  @jcamp0x2a paulmasson slelievre egourgoulhon mjo klee jhpalmieri nthiery enriqueartal fbissey arojas thansen etn40ff @tobiasdiez

We add an `spkg-configure.m4` script for the standard package `mathjax`, as well as corresponding system package information in `build/pkgs/mathjax/distros/`

Issue created by migration from https://trac.sagemath.org/ticket/30296





---

archive/issue_comments_427214.json:
```json
{
    "body": "There are numerous unresolved tickets regarding mathjax...\n\n#30296 (System package information and spkg-configure for mathjax) \u2013 Sage\nhttps://trac.sagemath.org/ticket/30296#modify\n\n#30226 (Allow LaTeX in text3d) \u2013 Sage\nhttps://trac.sagemath.org/ticket/30226\n\n#30030 (Prevent JSmol from phoning home) \u2013 Sage\nhttps://trac.sagemath.org/ticket/30030\n\n#29993 (Enable MathJax in the TOC of Sage reference manual) \u2013 Sage\nhttps://trac.sagemath.org/ticket/29993#comment:9\n\n#28547 (Remove hardcoded mathjax path in docs/conf.py) \u2013 Sage\nhttps://trac.sagemath.org/ticket/28547\n\n#28257 (MathJax causing unusual hanging in large notebooks) \u2013 Sage\nhttps://trac.sagemath.org/ticket/28257\n\n#26612 (Remove bad mathjax symlink and bad mathjax directories) \u2013 Sage\nhttps://trac.sagemath.org/ticket/26612\n\n#25833 (Upgrade to MathJax 3) \u2013 Sage\nhttps://trac.sagemath.org/ticket/25833\n\n#24024 (Meta-ticket: Update other packages to using the sage-dist-helpers functions + DESTDIR where applicable) \u2013 Sage\nhttps://trac.sagemath.org/ticket/24024\n\n#24367 (Confusing documentation on MathJax in light of use in Jupyter notebook) \u2013 Sage\nhttps://trac.sagemath.org/ticket/24367\n\n#25015 (Improve introspection capabilities of Sage Jupyter Kernel) \u2013 Sage\nhttps://trac.sagemath.org/ticket/25015\n\n#25111 (In the built documentation, replace duplicate files by symlinks) \u2013 Sage\nhttps://trac.sagemath.org/ticket/25111\n\n#22394 (MathJax javascript loaded more than once) \u2013 Sage\nhttps://trac.sagemath.org/ticket/22394\n\n#18596 (Don't strip MathJax fonts) \u2013 Sage\nhttps://trac.sagemath.org/ticket/18596",
    "created_at": "2020-08-05T20:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427214",
    "user": "mkoeppe"
}
```

There are numerous unresolved tickets regarding mathjax...

#30296 (System package information and spkg-configure for mathjax) – Sage
https://trac.sagemath.org/ticket/30296#modify

#30226 (Allow LaTeX in text3d) – Sage
https://trac.sagemath.org/ticket/30226

#30030 (Prevent JSmol from phoning home) – Sage
https://trac.sagemath.org/ticket/30030

#29993 (Enable MathJax in the TOC of Sage reference manual) – Sage
https://trac.sagemath.org/ticket/29993#comment:9

#28547 (Remove hardcoded mathjax path in docs/conf.py) – Sage
https://trac.sagemath.org/ticket/28547

#28257 (MathJax causing unusual hanging in large notebooks) – Sage
https://trac.sagemath.org/ticket/28257

#26612 (Remove bad mathjax symlink and bad mathjax directories) – Sage
https://trac.sagemath.org/ticket/26612

#25833 (Upgrade to MathJax 3) – Sage
https://trac.sagemath.org/ticket/25833

#24024 (Meta-ticket: Update other packages to using the sage-dist-helpers functions + DESTDIR where applicable) – Sage
https://trac.sagemath.org/ticket/24024

#24367 (Confusing documentation on MathJax in light of use in Jupyter notebook) – Sage
https://trac.sagemath.org/ticket/24367

#25015 (Improve introspection capabilities of Sage Jupyter Kernel) – Sage
https://trac.sagemath.org/ticket/25015

#25111 (In the built documentation, replace duplicate files by symlinks) – Sage
https://trac.sagemath.org/ticket/25111

#22394 (MathJax javascript loaded more than once) – Sage
https://trac.sagemath.org/ticket/22394

#18596 (Don't strip MathJax fonts) – Sage
https://trac.sagemath.org/ticket/18596



---

archive/issue_comments_427215.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-08-05T20:08:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427215",
    "user": "mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_427216.json:
```json
{
    "body": "For availability of mathjax in distributions, see https://repology.org/project/mathjax/versions",
    "created_at": "2020-08-05T20:09:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427216",
    "user": "mkoeppe"
}
```

For availability of mathjax in distributions, see https://repology.org/project/mathjax/versions



---

archive/issue_comments_427217.json:
```json
{
    "body": "The commit only indicates where the system directory should be inserted.\n\nI don't plan to work on this ticket. \n\n\nHoping that people knowledgeable about the Jupyter notebook and/or documentation building will be interesting in working on it.\n\n----\nNew commits:",
    "created_at": "2020-08-05T20:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427217",
    "user": "mkoeppe"
}
```

The commit only indicates where the system directory should be inserted.

I don't plan to work on this ticket. 


Hoping that people knowledgeable about the Jupyter notebook and/or documentation building will be interesting in working on it.

----
New commits:



---

archive/issue_comments_427218.json:
```json
{
    "body": "There is also a pip-installable package https://pypi.org/project/py-mathjax/, but I think using it has not benefits for us.",
    "created_at": "2020-08-06T02:29:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427218",
    "user": "mkoeppe"
}
```

There is also a pip-installable package https://pypi.org/project/py-mathjax/, but I think using it has not benefits for us.



---

archive/issue_comments_427219.json:
```json
{
    "body": "Also `notebook` bundles mathjax ... why do we install another copy?",
    "created_at": "2020-08-08T06:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427219",
    "user": "mkoeppe"
}
```

Also `notebook` bundles mathjax ... why do we install another copy?



---

archive/issue_comments_427220.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2020-08-08T06:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427220",
    "user": "mkoeppe"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_427221.json:
```json
{
    "body": "Replying to [comment:8 mkoeppe]:\n> Also `notebook` bundles mathjax ... why do we install another copy?\n\nThe change\n\n```diff\ndiff --git a/build/make/Makefile.in b/build/make/Makefile.in\nindex ed5294cc4e..3d65767bf7 100644\n--- a/build/make/Makefile.in\n+++ b/build/make/Makefile.in\n@@ -289,7 +289,7 @@ base: $(inst_patch) $(inst_pkgconf)\n # produce plots.\n DOC_DEPENDENCIES = sagelib $(inst_sphinx) \\\n        | $(SAGERUNTIME) $(inst_maxima) $(inst_networkx) $(inst_scipy) $(inst_sympy) \\\n-       $(inst_matplotlib) $(inst_pillow) $(inst_mathjax) $(inst_mpmath) \\\n+       $(inst_matplotlib) $(inst_pillow) $(inst_mpmath) \\\n        $(inst_ipykernel) $(inst_jupyter_client) $(inst_conway_polynomials) \\\n        $(inst_tachyon) $(inst_jmol) $(inst_thebe) $(inst_ipywidgets)\n \ndiff --git a/build/pkgs/mathjax/type b/build/pkgs/mathjax/type\nindex a6a7b9cd72..134d9bc32d 100644\n--- a/build/pkgs/mathjax/type\n+++ b/build/pkgs/mathjax/type\n@@ -1 +1 @@\n-standard\n+optional\n```\n\navoids building mathjax, but then Sphinx doesn't find it when building the documentation. So if we want to use the version bundled with `notebook`, we need to make sure that Sphinx knows where to find it.",
    "created_at": "2020-08-08T22:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427221",
    "user": "jhpalmieri"
}
```

Replying to [comment:8 mkoeppe]:
> Also `notebook` bundles mathjax ... why do we install another copy?

The change

```diff
diff --git a/build/make/Makefile.in b/build/make/Makefile.in
index ed5294cc4e..3d65767bf7 100644
--- a/build/make/Makefile.in
+++ b/build/make/Makefile.in
@@ -289,7 +289,7 @@ base: $(inst_patch) $(inst_pkgconf)
 # produce plots.
 DOC_DEPENDENCIES = sagelib $(inst_sphinx) \
        | $(SAGERUNTIME) $(inst_maxima) $(inst_networkx) $(inst_scipy) $(inst_sympy) \
-       $(inst_matplotlib) $(inst_pillow) $(inst_mathjax) $(inst_mpmath) \
+       $(inst_matplotlib) $(inst_pillow) $(inst_mpmath) \
        $(inst_ipykernel) $(inst_jupyter_client) $(inst_conway_polynomials) \
        $(inst_tachyon) $(inst_jmol) $(inst_thebe) $(inst_ipywidgets)
 
diff --git a/build/pkgs/mathjax/type b/build/pkgs/mathjax/type
index a6a7b9cd72..134d9bc32d 100644
--- a/build/pkgs/mathjax/type
+++ b/build/pkgs/mathjax/type
@@ -1 +1 @@
-standard
+optional
```

avoids building mathjax, but then Sphinx doesn't find it when building the documentation. So if we want to use the version bundled with `notebook`, we need to make sure that Sphinx knows where to find it.



---

archive/issue_comments_427222.json:
```json
{
    "body": "`src/sage/docs/conf.py` expects `sage.env.MATHJAX_DIR` to be set to the location. This is what we'd have to configure if we take mathjax either from a system installation, or some other source.",
    "created_at": "2020-08-08T23:41:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427222",
    "user": "mkoeppe"
}
```

`src/sage/docs/conf.py` expects `sage.env.MATHJAX_DIR` to be set to the location. This is what we'd have to configure if we take mathjax either from a system installation, or some other source.



---

archive/issue_comments_427223.json:
```json
{
    "body": "Changing keywords from \"\" to \"spkg-configure, mathjax\".",
    "created_at": "2020-08-20T01:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427223",
    "user": "slelievre"
}
```

Changing keywords from "" to "spkg-configure, mathjax".



---

archive/issue_comments_427224.json:
```json
{
    "body": "Changing priority from critical to major.",
    "created_at": "2020-09-03T03:02:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427224",
    "user": "mkoeppe"
}
```

Changing priority from critical to major.



---

archive/issue_comments_427225.json:
```json
{
    "body": "Replying to [comment:8 mkoeppe]:\n> Also `notebook` bundles mathjax ... why do we install another copy?\n\nSee\n\n- [Stack Overflow question 28909747: How do I configure mathjax for iPython notebooks?](https://stackoverflow.com/q/28909747)\n\nand the various answers there, including\n\n- [StackOverflow answer 58866858](https://stackoverflow.com/a/58866858)\n\nwhich states\n\n> Jupyter ships with its own (smaller) version of MathJax.\n> This is why it is not able to find the (Computer Modern)\n> 'TeX' font -- there only is the STIX font.\n\nSo it's possible that the smaller version of MathJax\nshipped by Jupyter Notebook is not enough for our Sphinx use.\n\nConfiguring Jupyter Notebook to use Sage's fuller MathJax\nmight have benefits (ability to typeset more math?)\nand/or drawbacks (performance?).",
    "created_at": "2020-09-05T10:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427225",
    "user": "slelievre"
}
```

Replying to [comment:8 mkoeppe]:
> Also `notebook` bundles mathjax ... why do we install another copy?

See

- [Stack Overflow question 28909747: How do I configure mathjax for iPython notebooks?](https://stackoverflow.com/q/28909747)

and the various answers there, including

- [StackOverflow answer 58866858](https://stackoverflow.com/a/58866858)

which states

> Jupyter ships with its own (smaller) version of MathJax.
> This is why it is not able to find the (Computer Modern)
> 'TeX' font -- there only is the STIX font.

So it's possible that the smaller version of MathJax
shipped by Jupyter Notebook is not enough for our Sphinx use.

Configuring Jupyter Notebook to use Sage's fuller MathJax
might have benefits (ability to typeset more math?)
and/or drawbacks (performance?).



---

archive/issue_comments_427226.json:
```json
{
    "body": "Replying to [comment:16 slelievre]:\n> Configuring Jupyter Notebook to use Sage's fuller MathJax\n> might have benefits (ability to typeset more math?)\n\nThis should be investigated.",
    "created_at": "2020-11-29T07:29:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427226",
    "user": "mkoeppe"
}
```

Replying to [comment:16 slelievre]:
> Configuring Jupyter Notebook to use Sage's fuller MathJax
> might have benefits (ability to typeset more math?)

This should be investigated.



---

archive/issue_comments_427227.json:
```json
{
    "body": "Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427227",
    "user": "mkoeppe"
}
```

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_comments_427228.json:
```json
{
    "body": "Changing keywords from \"spkg-configure, mathjax\" to \"spkg-configure, mathjax, sd111\".",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427228",
    "user": "mkoeppe"
}
```

Changing keywords from "spkg-configure, mathjax" to "spkg-configure, mathjax, sd111".



---

archive/issue_comments_427229.json:
```json
{
    "body": "FWIW: On Arch we're unbundling mathjax from Jupyter and using the system one:\n\nhttps://github.com/archlinux/svntogit-community/blob/packages/jupyter-notebook/trunk/PKGBUILD#L40\n\nEverything works fine, even without the /usr/share/jupyter/nbextensions/mathjax symlink installed by sage.",
    "created_at": "2020-12-10T07:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427229",
    "user": "arojas"
}
```

FWIW: On Arch we're unbundling mathjax from Jupyter and using the system one:

https://github.com/archlinux/svntogit-community/blob/packages/jupyter-notebook/trunk/PKGBUILD#L40

Everything works fine, even without the /usr/share/jupyter/nbextensions/mathjax symlink installed by sage.



---

archive/issue_comments_427230.json:
```json
{
    "body": "Thanks. I have created #31035 (Remove mathjax configuration/symlink from jupyter notebook), as it seems what Sage is doing is simply not necessary any more after various updates of Jupyter.",
    "created_at": "2020-12-10T18:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427230",
    "user": "mkoeppe"
}
```

Thanks. I have created #31035 (Remove mathjax configuration/symlink from jupyter notebook), as it seems what Sage is doing is simply not necessary any more after various updates of Jupyter.



---

archive/issue_comments_427231.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2020-12-10T19:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427231",
    "user": "mkoeppe"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_427232.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427232",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_427233.json:
```json
{
    "body": "Here is distro info to hopefully restart things here.\n----\nNew commits:",
    "created_at": "2021-03-22T01:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427233",
    "user": "slelievre"
}
```

Here is distro info to hopefully restart things here.
----
New commits:



---

archive/issue_comments_427234.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427234",
    "user": "mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_427235.json:
```json
{
    "body": "See also #33600: Configure mathjax in sphinx config and upgrade to Mathjax v3",
    "created_at": "2022-03-30T16:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427235",
    "user": "mkoeppe"
}
```

See also #33600: Configure mathjax in sphinx config and upgrade to Mathjax v3



---

archive/issue_comments_427236.json:
```json
{
    "body": "Still no `spkg-configure.m4`?\n\nThis script just needs to rewrite `sage.env.MATHJAX_DIR` to the system mathjax2 directory (`/usr/share/mathjax`?) if found in the system.\n\nPerhaps it also needs to decide if it is really mathjax2 or mathjax3...\n\nI am ready to duplicate it to #25833.",
    "created_at": "2022-04-08T06:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427236",
    "user": "klee"
}
```

Still no `spkg-configure.m4`?

This script just needs to rewrite `sage.env.MATHJAX_DIR` to the system mathjax2 directory (`/usr/share/mathjax`?) if found in the system.

Perhaps it also needs to decide if it is really mathjax2 or mathjax3...

I am ready to duplicate it to #25833.



---

archive/issue_comments_427237.json:
```json
{
    "body": "Replying to [comment:35 klee]:\n> This script just needs to rewrite `sage.env.MATHJAX_DIR` to the system mathjax2 directory (`/usr/share/mathjax`?) if found in the system.\n\nThis may not be true since the system mathjax2 would have all fonts and be too large to use for sage documentation. Sphinx will copy the whole to each `_static` directory of every documentation (reference, tutorial, ...).\n\nThen the conclusion would be that we should not try to use the system mathjax???",
    "created_at": "2022-04-08T07:03:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427237",
    "user": "klee"
}
```

Replying to [comment:35 klee]:
> This script just needs to rewrite `sage.env.MATHJAX_DIR` to the system mathjax2 directory (`/usr/share/mathjax`?) if found in the system.

This may not be true since the system mathjax2 would have all fonts and be too large to use for sage documentation. Sphinx will copy the whole to each `_static` directory of every documentation (reference, tutorial, ...).

Then the conclusion would be that we should not try to use the system mathjax???



---

archive/issue_comments_427238.json:
```json
{
    "body": "Replying to [comment:36 klee]:\n> This may not be true since the system mathjax2 would have all fonts and be too large to use for sage documentation. Sphinx will copy the whole to each `_static` directory of every documentation (reference, tutorial, ...).\n> \n> Then the conclusion would be that we should not try to use the system mathjax??? \n\nOn Arch (and Gentoo, which is where I got the idea from) distro packages we replace all `_static` copies with a symlink to the one in `html/en/_static` post-installation. Perhaps that sould be done on install by default?",
    "created_at": "2022-04-08T07:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427238",
    "user": "arojas"
}
```

Replying to [comment:36 klee]:
> This may not be true since the system mathjax2 would have all fonts and be too large to use for sage documentation. Sphinx will copy the whole to each `_static` directory of every documentation (reference, tutorial, ...).
> 
> Then the conclusion would be that we should not try to use the system mathjax??? 

On Arch (and Gentoo, which is where I got the idea from) distro packages we replace all `_static` copies with a symlink to the one in `html/en/_static` post-installation. Perhaps that sould be done on install by default?



---

archive/issue_comments_427239.json:
```json
{
    "body": "Replying to [comment:37 arojas]:\n> On Arch (and Gentoo, which is where I got the idea from) distro packages we replace all `_static` copies with a symlink to the one in `html/en/_static` post-installation. Perhaps that should be done on install by default?\n\nI guess that could be done for sage, independent of this ticket. Then it would reduce the number of times to copy `$SAGE_SHARE/mathjax` to `_static/`.\n\nNonetheless, `spkg-configure.m4` needs to copy the reduced set of files from the system mathjax to `$SAGE_SHARE/mathjax`.",
    "created_at": "2022-04-08T07:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427239",
    "user": "klee"
}
```

Replying to [comment:37 arojas]:
> On Arch (and Gentoo, which is where I got the idea from) distro packages we replace all `_static` copies with a symlink to the one in `html/en/_static` post-installation. Perhaps that should be done on install by default?

I guess that could be done for sage, independent of this ticket. Then it would reduce the number of times to copy `$SAGE_SHARE/mathjax` to `_static/`.

Nonetheless, `spkg-configure.m4` needs to copy the reduced set of files from the system mathjax to `$SAGE_SHARE/mathjax`.



---

archive/issue_comments_427240.json:
```json
{
    "body": "Replying to [comment:38 klee]:\n> Replying to [comment:37 arojas]:\n> > On Arch (and Gentoo, which is where I got the idea from) distro packages we replace all `_static` copies with a symlink to the one in `html/en/_static` post-installation. Perhaps that should be done on install by default?\n> \n> I guess that could be done for sage, independent of this ticket. Then it would reduce the number of times to copy `$SAGE_SHARE/mathjax` to `_static/`.\n> \n> Nonetheless, `spkg-configure.m4` needs to copy the reduced set of files from the system mathjax to `$SAGE_SHARE/mathjax`.\n\nWell, my point is that once there is just one copy of `_static`, then maybe it's not *that* bad to just copy over the entire contents of the system mathjax dir.",
    "created_at": "2022-04-08T12:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427240",
    "user": "arojas"
}
```

Replying to [comment:38 klee]:
> Replying to [comment:37 arojas]:
> > On Arch (and Gentoo, which is where I got the idea from) distro packages we replace all `_static` copies with a symlink to the one in `html/en/_static` post-installation. Perhaps that should be done on install by default?
> 
> I guess that could be done for sage, independent of this ticket. Then it would reduce the number of times to copy `$SAGE_SHARE/mathjax` to `_static/`.
> 
> Nonetheless, `spkg-configure.m4` needs to copy the reduced set of files from the system mathjax to `$SAGE_SHARE/mathjax`.

Well, my point is that once there is just one copy of `_static`, then maybe it's not *that* bad to just copy over the entire contents of the system mathjax dir.



---

archive/issue_comments_427241.json:
```json
{
    "body": "Replying to [comment:39 arojas]:\n> Well, my point is that once there is just one copy of `_static`, then maybe it's not *that* bad to just copy over the entire contents of the system mathjax dir.\n\nIt would not be just one copy, because you have `_static` directory for each of languages.",
    "created_at": "2022-04-08T12:53:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427241",
    "user": "klee"
}
```

Replying to [comment:39 arojas]:
> Well, my point is that once there is just one copy of `_static`, then maybe it's not *that* bad to just copy over the entire contents of the system mathjax dir.

It would not be just one copy, because you have `_static` directory for each of languages.



---

archive/issue_comments_427242.json:
```json
{
    "body": "Replying to [comment:39 arojas]:\n> Well, my point is that once there is just one copy of `_static`, then maybe it's not *that* bad to just copy over the entire contents of the system mathjax dir.\n\nOne copy to `html/_static` might suffice. \n\nOther question: the location of the system mathjax is `/usr/share/mathjax` on all linux platforms? Or does it vary?",
    "created_at": "2022-04-08T14:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427242",
    "user": "klee"
}
```

Replying to [comment:39 arojas]:
> Well, my point is that once there is just one copy of `_static`, then maybe it's not *that* bad to just copy over the entire contents of the system mathjax dir.

One copy to `html/_static` might suffice. 

Other question: the location of the system mathjax is `/usr/share/mathjax` on all linux platforms? Or does it vary?



---

archive/issue_comments_427243.json:
```json
{
    "body": "The mathjax3 tarball is around 5Mb. I think this is not so big. Then is it worth while to detect the system mathjax and copy it instead of downloading the tarball?",
    "created_at": "2022-04-08T14:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427243",
    "user": "klee"
}
```

The mathjax3 tarball is around 5Mb. I think this is not so big. Then is it worth while to detect the system mathjax and copy it instead of downloading the tarball?



---

archive/issue_comments_427244.json:
```json
{
    "body": "Replying to [comment:41 klee]:\n> Other question: the location of the system mathjax is `/usr/share/mathjax` on all linux platforms? Or does it vary?\n\nmathjax doesn't provide an install script, so unfortunately there's no standard location and it's up to each distro to decide where to install it. On Arch we use `/usr/share/mathjax`, other distros may use `mathjax3` instead if they also ship v2. (But, according to https://repology.org/project/mathjax/versions, no other distro is shipping mathjax 3 yet)",
    "created_at": "2022-04-08T14:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427244",
    "user": "arojas"
}
```

Replying to [comment:41 klee]:
> Other question: the location of the system mathjax is `/usr/share/mathjax` on all linux platforms? Or does it vary?

mathjax doesn't provide an install script, so unfortunately there's no standard location and it's up to each distro to decide where to install it. On Arch we use `/usr/share/mathjax`, other distros may use `mathjax3` instead if they also ship v2. (But, according to https://repology.org/project/mathjax/versions, no other distro is shipping mathjax 3 yet)



---

archive/issue_comments_427245.json:
```json
{
    "body": "Replying to [comment:43 arojas]:\n> Replying to [comment:41 klee]:\n> > Other question: the location of the system mathjax is `/usr/share/mathjax` on all linux platforms? Or does it vary?\n> \n> mathjax doesn't provide an install script, so unfortunately there's no standard location and it's up to each distro to decide where to install it. \n\nmathjax is a javascript library, and perhaps unique in that among sage spkgs. I doubt if `spkg-configure.m4` script is relevant with mathjax. \n\n`@`matthias: would you comment?",
    "created_at": "2022-04-08T15:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427245",
    "user": "klee"
}
```

Replying to [comment:43 arojas]:
> Replying to [comment:41 klee]:
> > Other question: the location of the system mathjax is `/usr/share/mathjax` on all linux platforms? Or does it vary?
> 
> mathjax doesn't provide an install script, so unfortunately there's no standard location and it's up to each distro to decide where to install it. 

mathjax is a javascript library, and perhaps unique in that among sage spkgs. I doubt if `spkg-configure.m4` script is relevant with mathjax. 

`@`matthias: would you comment?



---

archive/issue_comments_427246.json:
```json
{
    "body": "Given that the spread of mathjax 3 in distributions is so low, I don't think that there is a need to support system packages providing it. If this changes in the future, `spkg-configure.m4` would be the correct mechanism though.",
    "created_at": "2022-04-08T16:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427246",
    "user": "mkoeppe"
}
```

Given that the spread of mathjax 3 in distributions is so low, I don't think that there is a need to support system packages providing it. If this changes in the future, `spkg-configure.m4` would be the correct mechanism though.



---

archive/issue_comments_427247.json:
```json
{
    "body": "Replying to [comment:44 klee]:\n> \n> mathjax is a javascript library, and perhaps unique in that among sage spkgs. I doubt if `spkg-configure.m4` script is relevant with mathjax. \n> \n\nIt is kind of an awkward fit, since there's no reliable way of detecting via `spkg-configure.m4` where the the html/js files might live. But we can at the very least check a list of known locations. The gp2c package does that for lack of a better strategy.",
    "created_at": "2022-04-10T20:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427247",
    "user": "mjo"
}
```

Replying to [comment:44 klee]:
> 
> mathjax is a javascript library, and perhaps unique in that among sage spkgs. I doubt if `spkg-configure.m4` script is relevant with mathjax. 
> 

It is kind of an awkward fit, since there's no reliable way of detecting via `spkg-configure.m4` where the the html/js files might live. But we can at the very least check a list of known locations. The gp2c package does that for lack of a better strategy.



---

archive/issue_comments_427248.json:
```json
{
    "body": "One would probably only want to search for the system library when also system `node` is installed, which would give discoverability.",
    "created_at": "2022-04-10T21:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427248",
    "user": "mkoeppe"
}
```

One would probably only want to search for the system library when also system `node` is installed, which would give discoverability.



---

archive/issue_comments_427249.json:
```json
{
    "body": "Replying to [comment:46 mjo]:\n> Replying to [comment:44 klee]:\n> > \n> > mathjax is a javascript library, and perhaps unique in that among sage spkgs. I doubt if `spkg-configure.m4` script is relevant with mathjax. \n> > \n> \n> It is kind of an awkward fit, since there's no reliable way of detecting via `spkg-configure.m4` where the the html/js files might live. But we can at the very least check a list of known locations. The gp2c package does that for lack of a better strategy.\n\nI agree. Still as this mathjax package is not big and does not take time to install, I doubt if it would ever be worth while to put necessary efforts for this package.\n\nHence I suggest closing this ticket as \"won't fix\".",
    "created_at": "2022-04-11T00:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427249",
    "user": "klee"
}
```

Replying to [comment:46 mjo]:
> Replying to [comment:44 klee]:
> > 
> > mathjax is a javascript library, and perhaps unique in that among sage spkgs. I doubt if `spkg-configure.m4` script is relevant with mathjax. 
> > 
> 
> It is kind of an awkward fit, since there's no reliable way of detecting via `spkg-configure.m4` where the the html/js files might live. But we can at the very least check a list of known locations. The gp2c package does that for lack of a better strategy.

I agree. Still as this mathjax package is not big and does not take time to install, I doubt if it would ever be worth while to put necessary efforts for this package.

Hence I suggest closing this ticket as "won't fix".



---

archive/issue_comments_427250.json:
```json
{
    "body": "Replying to [comment:48 klee]:\n>\n> Hence I suggest closing this ticket as \"won't fix\". \n> \n\nSage's mathjax has \"never\" worked for me. This is probably due to font stripping (https://trac.sagemath.org/ticket/18596#comment:4), but undoing that would make the package larger.\n\nSo I'd quite like the ability to use the unbroken copy my distro provides, regardless of any time/bandwidth savings. Ultimately I can write the spkg-configure if no one else does it. I'll probably wait until the mathjax-3.x upgrade is done though.",
    "created_at": "2022-04-12T21:36:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427250",
    "user": "mjo"
}
```

Replying to [comment:48 klee]:
>
> Hence I suggest closing this ticket as "won't fix". 
> 

Sage's mathjax has "never" worked for me. This is probably due to font stripping (https://trac.sagemath.org/ticket/18596#comment:4), but undoing that would make the package larger.

So I'd quite like the ability to use the unbroken copy my distro provides, regardless of any time/bandwidth savings. Ultimately I can write the spkg-configure if no one else does it. I'll probably wait until the mathjax-3.x upgrade is done though.



---

archive/issue_comments_427251.json:
```json
{
    "body": "Replying to [comment:49 mjo]:\n> Replying to [comment:48 klee]:\n> >\n> > Hence I suggest closing this ticket as \"won't fix\". \n> > \n> \n> Sage's mathjax has \"never\" worked for me. This is probably due to font stripping (https://trac.sagemath.org/ticket/18596#comment:4), but undoing that would make the package larger.\n> \n> So I'd quite like the ability to use the unbroken copy my distro provides, regardless of any time/bandwidth savings. Ultimately I can write the spkg-configure if no one else does it. I'll probably wait until the mathjax-3.x upgrade is done though.\n\nOkay. Thanks. Does mathjax3 (#25833) work for you?",
    "created_at": "2022-04-12T23:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427251",
    "user": "klee"
}
```

Replying to [comment:49 mjo]:
> Replying to [comment:48 klee]:
> >
> > Hence I suggest closing this ticket as "won't fix". 
> > 
> 
> Sage's mathjax has "never" worked for me. This is probably due to font stripping (https://trac.sagemath.org/ticket/18596#comment:4), but undoing that would make the package larger.
> 
> So I'd quite like the ability to use the unbroken copy my distro provides, regardless of any time/bandwidth savings. Ultimately I can write the spkg-configure if no one else does it. I'll probably wait until the mathjax-3.x upgrade is done though.

Okay. Thanks. Does mathjax3 (#25833) work for you?



---

archive/issue_comments_427252.json:
```json
{
    "body": "Replying to [comment:50 klee]:\n> \n> Okay. Thanks. Does mathjax3 (#25833) work for you? \n\nYes, thanks, replied there.",
    "created_at": "2022-04-13T20:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427252",
    "user": "mjo"
}
```

Replying to [comment:50 klee]:
> 
> Okay. Thanks. Does mathjax3 (#25833) work for you? 

Yes, thanks, replied there.



---

archive/issue_comments_427253.json:
```json
{
    "body": "Replying to [comment:49 Michael Orlitzky]:\n> Ultimately I can write the spkg-configure if no one else does it. I'll probably wait until the mathjax-3.x upgrade is done though.\n\nNow that mathjax3 is well in place, would you do the work? \n\nFrom Matthias: `src/sage/docs/conf.py` expects sage.env.MATHJAX_DIR to be set to the location. This is what we'd have to configure if we take mathjax either from a system installation, or some other source.",
    "created_at": "2022-11-24T05:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427253",
    "user": "klee"
}
```

Replying to [comment:49 Michael Orlitzky]:
> Ultimately I can write the spkg-configure if no one else does it. I'll probably wait until the mathjax-3.x upgrade is done though.

Now that mathjax3 is well in place, would you do the work? 

From Matthias: `src/sage/docs/conf.py` expects sage.env.MATHJAX_DIR to be set to the location. This is what we'd have to configure if we take mathjax either from a system installation, or some other source.



---

archive/issue_comments_427254.json:
```json
{
    "body": "Replying to [comment:53 Kwankyu Lee]:\n> Replying to [comment:49 Michael Orlitzky]:\n> > Ultimately I can write the spkg-configure if no one else does it. I'll probably wait until the mathjax-3.x upgrade is done though.\n> \n> Now that mathjax3 is well in place, would you do the work?\n\nNow I'm waiting for my distro package to be upgraded (https://bugs.gentoo.org/837722), but yes, I'll get to it eventually.",
    "created_at": "2022-11-24T10:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30059#issuecomment-427254",
    "user": "mjo"
}
```

Replying to [comment:53 Kwankyu Lee]:
> Replying to [comment:49 Michael Orlitzky]:
> > Ultimately I can write the spkg-configure if no one else does it. I'll probably wait until the mathjax-3.x upgrade is done though.
> 
> Now that mathjax3 is well in place, would you do the work?

Now I'm waiting for my distro package to be upgraded (https://bugs.gentoo.org/837722), but yes, I'll get to it eventually.
