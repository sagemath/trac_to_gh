# Issue 29030: enabling thread safety for NTL

Issue created by migration from https://trac.sagemath.org/ticket/29267

Original creator: edgarcosta

Original creation time: 2020-03-02 12:32:55

CC:  fbissey jpflori dimpase @mwageringel arojas

4 years ago, we weren't ready to have NTL built with thread safety because of a lack of support for c++11.
What about now?


```
########## thread safety

NTL_THREADS=on

# Set to 'on' if you want to compile NTL in thread-safe mode.  This requires
# several C++11 features, including atomic types, mutexes, and thread_local
# storage.  Your compiler may not yet support these features.  Setting this
# flag will automatically set the NTL_STD_CXX11 flag (if neither NTL_STD_CXX11
# or NTL_STD_CXX14 is already set). It will also pass -pthread throught to the
# compiler via CXXAUTOFLAGS (if possible).
```


Also do we need to change any cython files? For example, add something like: 
`# distutils: extra_compile_args = -std=c++11`?


---

Comment by edgarcosta created at 2020-03-02 18:52:01

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2020-03-15 18:16:43

According to [our documentation](https://doc.sagemath.org/html/en/installation/source.html#prerequisites), we support gcc 4.8 in which c++ 11 support is experimental. If NTL does not automatically pick-up the correct configuration with old gcc, this is an upstream bug. However, this ought to be tested.


---

Comment by vdelecroix created at 2020-03-15 18:16:43

Changing status from needs_review to needs_info.


---

Comment by vdelecroix created at 2020-03-15 18:22:13

As mentioned in the ticket description, it would be good to have the docutils directive in the Cython headers for ntl. `src/libs/src/sage/libs/ntl/types.pxd` should be enough.


---

Comment by mkoeppe created at 2020-03-19 22:57:33

Needs rebasing


---

Comment by mkoeppe created at 2020-03-19 22:59:50

As noted on duplicate ticket #29340:

Enabling threads in NTL will require work on at least the following:
 - Singular - at least on homebrew (see #29339/#29104).
 - Flint - see #27764


---

Comment by git created at 2020-03-22 22:49:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-03-22 23:01:29

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by edgarcosta created at 2020-03-22 23:02:35

I have rebased on top of develop and added `# distutils: extra_compile_args = -std=c++11` to   `src/libs/src/sage/libs/ntl/types.pxd`.


---

Comment by mkoeppe created at 2020-03-24 16:32:51

Tests run at https://github.com/mkoeppe/sage/actions/runs/62362311


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by mkoeppe created at 2021-03-24 02:04:25

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.


---

Comment by mkoeppe created at 2021-12-18 19:53:12

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.
