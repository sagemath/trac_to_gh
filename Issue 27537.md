# Issue 27537: py3: fix various issues in cplex backend

Issue created by migration from https://trac.sagemath.org/ticket/27774

Original creator: dcoudert

Original creation time: 2019-05-05 16:30:19

CC:  slabbe

Keywords: py3, numerical

Apart from the problems reported in #27773, several doctests are failing in Python 3 in `src/sage/numerical/backends/cplex_backend.pyx` due to:
- bytes versus str
- passing iterator (zip) instead of list in `add_linear_constraint`

and some issues are already here with Python 2:
- `int(CPX_INFBOUND)` give 0 while `CPX_INFBOUND == 1E+20`. Hence, some doctests are failing. Actually, the `int(...)` is not needed
- with a integer variable, `get_variable_value` return `2.0` in py2 and `2` in py3 as `round` has a different behavior. We unify the behavior using `int(...)`.


---

Comment by dcoudert created at 2019-05-05 16:32:17

New commits:


---

Comment by dcoudert created at 2019-05-05 16:32:17

Changing status from new to needs_review.


---

Comment by dcoudert created at 2019-05-06 11:55:00

similar issues may also occur with gurobi...


---

Comment by tscrim created at 2019-05-13 00:16:25

While I am not strictly opposed to these sorts of changes:

```diff
-            sage: p.add_linear_constraint( zip(range(5), range(5)), 1.0, 1.0, name='foo') # optional - CPLEX
+            sage: p.add_linear_constraint([(i, i) for i in range(5)], 1.0, 1.0, name='foo') # optional - CPLEX
```

I think it would be better to have `add_linear_constraint` handle these types of inputs.


---

Comment by git created at 2019-05-13 15:45:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2019-05-13 15:50:31

I did a change in all backends in which `coefficients` was iterated several times. May be there is a smarter way to do it, but at least this one is working.

To show that it's working, I ensured that in all the modified files, the doctest is with `zip(...)` and not `list(zip(...))`.


---

Comment by tscrim created at 2019-05-14 00:48:11

Thank you. I think this is a much better solution (and now the behavior also matches the docstring).


---

Comment by tscrim created at 2019-05-14 00:48:11

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-05-17 11:45:44

Resolution: fixed
