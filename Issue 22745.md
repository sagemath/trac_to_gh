# Issue 22745: Global function fields

Issue created by migration from https://trac.sagemath.org/ticket/22982

Original creator: klee

Original creation time: 2017-05-11 14:38:28

CC:  jsrn danielaugot @brentbaccala

Function fields part of Sage has long been neglected and lacks any significant functionality besides basic arithmetic and frameworks. This ticket improves the situation by doing two things:

1. Add global function fields with lots of useful functionality 

2. Improve docstrings for existing code

There are two dependencies: #16561, #22841.


---

Comment by git created at 2017-05-11 14:42:43

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2017-05-11 21:17:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-05-12 13:21:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2017-05-30 10:34:13

Set assignee to klee.


---

Comment by git created at 2017-05-30 10:46:55

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2017-06-01 11:33:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2017-06-07 04:20:25

Changing keywords from "" to "global function field, algebraic geometry code".


---

Comment by git created at 2017-06-11 23:33:05

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2017-06-18 12:03:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-06-19 04:28:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-06-20 07:56:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2017-06-21 07:32:15

A short introduction to global function fields in Sage


---

Attachment


---

Comment by saraedum created at 2017-06-22 04:15:29

It's great to see progress in the function field code. What are your plans for this branch? Are you in contact with the people who were working on divisors recently at Sage Days 86.5?


---

Comment by git created at 2017-06-22 07:25:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2017-06-22 08:11:44

Replying to [comment:21 saraedum]:
> What are your plans for this branch? 

The branch is essentially a patch bomb, and is not suitable for a regular review yet. But I see no way to split the code as it consists of several parts dependent on one another. My plan is to have people to play with it for some time, and I do bug fixes and improve documentation until there appears someone who can review the whole code. I don't know how long this procedure would take. Though I want it to be merged to Sage as soon as possible from my heart :-)

I have done this task during my sabbatical year, which is going to end soon. After that, I will not have much time but to maintain the code just not to be bitrotting.

> Are you in contact with the people who were working on divisors recently at Sage Days 86.5?

No. I won't have time to cooperate with other people.

I looked at their wiki page. It seems that his(?) task in "basic arithmetic in function fields" may overlap with what I did here. I implemented fractional ideals in the classical way using hermite normal form while he uses OM representation, about which I know nothing. Practically he may use my branch as a tool/base to experiment and build his system. It seems his approach is more suitable for global function fields defined by more complicated equations. Thus it could be the case that the classical approach and the OM representation approach complement each other.


---

Comment by klee created at 2017-06-23 08:06:54

Changing status from new to needs_info.


---

Comment by klee created at 2017-06-23 08:12:31

Some docstrings are not in good style.


---

Comment by klee created at 2017-06-23 08:12:31

Changing status from needs_info to needs_work.


---

Comment by git created at 2017-06-25 07:47:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2017-06-26 15:20:06

Great that you are working on this! This is something I also really want in Sage - I will try to play around with your implementation and provide feedback when I can.


---

Comment by git created at 2017-06-30 06:51:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-07-31 10:07:49

There remains a call to cmp, not compatible with python3 (see patchbot report)


---

Comment by danielaugot created at 2017-08-03 18:42:30

Replying to [comment:27 jsrn]:
> Great that you are working on this! This is something I also really want in Sage - I will try to play around with your implementation and provide feedback when I can.

Yes this is great ! Thank you for this. I will try this and tell the news to colleagues. If it is good, it should be integrated in Sage, even if reviewing the ticket takes time.


---

Comment by git created at 2017-08-04 05:38:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2017-08-04 06:17:04

Replying to [comment:31 danielaugot]:
> If it is good, it should be integrated in Sage, even if reviewing the ticket takes time.

Compared with Magma, the biggest problem is speed. I worked hard to improve this, but I guess there is still wide room for improvement, though certainly there is a limit somewhere due to Python vs C.


---

Comment by git created at 2017-08-09 01:09:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-09-07 04:34:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-09-12 04:39:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-09 00:02:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-19 00:15:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-23 02:24:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-11-25 02:21:21

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2017-12-12 01:15:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2017-12-12 06:56:32

Changing status from needs_work to needs_review.


---

Comment by git created at 2017-12-13 17:28:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-12-25 20:13:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-01-04 07:13:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2018-01-04 07:26:05

Perhaps it would be a good thing to quickly merge this branch to Sage, so that more people try it and we have more chances to fix and improve this part of Sage...


---

Comment by jsrn created at 2018-01-04 09:07:25

Replying to [comment:49 klee]:
> Perhaps it would be a good thing to quickly merge this branch to Sage, so that more people try it and we have more chances to fix and improve this part of Sage...

Hi Kwankyu,
I really appreciate your massive effort here, but I don't think it is realistic that this patch bomb will get quickly merged. Bugs are much better fixed before being introduced into Sage. Why is it not possible to break this ticket into a number of smaller ones? Each one can then be reviewed with the proper care. Some tickets could basically contain just the class structure of some object, while complicated algorithms for a specific task could be tickets by themselves. Possibly keeping this ticket as a wontfix reference ticket, reviewers of the smaller ones can see what your aim is. You could give an overview of the set of tickets on a dedicated subpage on the wiki. 

I want to help out with testing and reviewing, but I don't see any time that I could take out 2 weeks straight to review this beast...

Best,
Johan


---

Comment by klee created at 2018-01-04 11:27:23

Replying to [comment:50 jsrn]:
> Replying to [comment:49 klee]:
> > Perhaps it would be a good thing to quickly merge this branch to Sage, so that more people try it and we have more chances to fix and improve this part of Sage...
> 
> Hi Kwankyu,
> I really appreciate your massive effort here, but I don't think it is realistic that this patch bomb will get quickly merged. Bugs are much better fixed before being introduced into Sage. Why is it not possible to break this ticket into a number of smaller ones? Each one can then be reviewed with the proper care. Some tickets could basically contain just the class structure of some object, while complicated algorithms for a specific task could be tickets by themselves. Possibly keeping this ticket as a wontfix reference ticket, reviewers of the smaller ones can see what your aim is. You could give an overview of the set of tickets on a dedicated subpage on the wiki. 

Thanks for the comments, Johan. You are right. That is what should happen, as no reviewer wants to swallow a patch bomb.

I really had no idea about how to spend a pleasant time splitting the big code, which seems an organic whole, into smaller chunks, even with my humble git skill. 

So while having dinner, I thought about this problem. And now I think I can do something about it. It seems I have to plan carefully before making tickets. 

> I want to help out with testing and reviewing, but I don't see any time that I could take out 2 weeks straight to review this beast...

Let me spend some days to plan this out, so that you won't be deprived of 2 weeks straight :-)


---

Comment by klee created at 2018-01-04 11:27:40

Changing status from needs_review to needs_work.


---

Comment by jsrn created at 2018-01-04 13:41:10

That sounds great :-) Realistically, I won't have much time in most of January (important conference deadlines), but I hope to have some time for smaller tickets in February. You should probably expect that getting all of the functionality of this ticket into Sage will take quite a while, though. 

Some tips from my experience with implementing coding theory during the "ACTIS project": expect that the review process will cause the design to change, and later tickets can be lightly or massively impacted. If you cut this ticket into, say 10 tickets, then consider not setting up all 10 tickets at once with full dependency lattice. The later tickets won't be looked at before the early ones, and each single change to an early ticket would have to propagate down, causing lots of extra work and headache.

Best,
Johan


---

Comment by klee created at 2018-01-04 14:34:54

Replying to [comment:53 jsrn]:
> That sounds great :-) Realistically, I won't have much time in most of January (important conference deadlines), but I hope to have some time for smaller tickets in February. You should probably expect that getting all of the functionality of this ticket into Sage will take quite a while, though. 

I don't intend to rush. Don't worry.

> Some tips from my experience with implementing coding theory during the "ACTIS project": expect that the review process will cause the design to change, and later tickets can be lightly or massively impacted. If you cut this ticket into, say 10 tickets, then consider not setting up all 10 tickets at once with full dependency lattice. The later tickets won't be looked at before the early ones, and each single change to an early ticket would have to propagate down, causing lots of extra work and headache.

Right. Thanks for the tips. Let's see :-)


---

Comment by git created at 2018-01-23 07:17:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-01-25 07:17:33

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by @BrentBaccala created at 2018-05-06 04:46:57

Is there a current branch for this ticket?  `u/klee/22982` seems to have been deleted and then recreated.


---

Comment by klee created at 2018-05-09 05:01:49

Replying to [comment:61 gh-BrentBaccala]:
> Is there a current branch for this ticket?  `u/klee/22982` seems to have been deleted and then recreated.

It was deleted as it would be broken into several small patches to facilitate easy review. The whole patch working with the latest stable Sage is available as `u/klee/22982_stable`.


---

Comment by @BrentBaccala created at 2018-05-09 15:45:48

Replying to [comment:63 klee]:
> Replying to [comment:61 gh-BrentBaccala]:
> > Is there a current branch for this ticket?  `u/klee/22982` seems to have been deleted and then recreated.
> 
> It was deleted as it would be broken into several small patches to facilitate easy review. The whole patch working with the latest stable Sage is available as `u/klee/22982_stable`. 
> 

I'd like to get the divisor basis code (the Hess algorithm) working with function fields over QQ (and QQbar), but I'll wait until this patch gets incorporated into the main branch before trying to add to it.


---

Comment by klee created at 2018-05-10 00:53:38

Replying to [comment:64 gh-BrentBaccala]:
> I'd like to get the divisor basis code (the Hess algorithm) working with function fields over QQ (and QQbar), but I'll wait until this patch gets incorporated into the main branch before trying to add to it.

That would be great. I guess that a crucial step for your aim is to compute the (finite) maximal order, and perhaps also to factor ideals in the order. After that, most of the code in this patch would just carry over. In particular, the Hess algorithm code in this patch would work over Q. 

The current pace of merging this patch to Sage is very slow though. I will think about a least painful way to provide this patch so that you can base your code on this patch.


---

Comment by @BrentBaccala created at 2018-05-16 23:56:13

Replying to [comment:63 klee]:
> The whole patch working with the latest stable Sage is available as `u/klee/22982_stable`. 
> 

I suggest double-checking that.  There's a lot of diffs between `u/klee/22982_stable` and `8.2`.


---

Comment by klee created at 2018-05-17 04:25:53

Replying to [comment:66 gh-BrentBaccala]:
> Replying to [comment:63 klee]:
> > The whole patch working with the latest stable Sage is available as `u/klee/22982_stable`. 
> > 
> 
> I suggest double-checking that.  There's a lot of diffs between `u/klee/22982_stable` and `8.2`.

Thanks!


---

Comment by klee created at 2018-05-17 04:27:54

Replying to [comment:66 gh-BrentBaccala]:
> Replying to [comment:63 klee]:
> > The whole patch working with the latest stable Sage is available as `u/klee/22982_stable`. 
> > 
> 
> I suggest double-checking that.  There's a lot of diffs between `u/klee/22982_stable` and `8.2`.

Now corrected.


---

Comment by @BrentBaccala created at 2018-05-17 22:07:01

Replying to [comment:68 klee]: 
> Now corrected.

Looks good!

Suggestion:

In the documentation for class `FunctionFieldPlace`, `prime` is defined as "prime ideal associated with the place".  I assume this means a prime ideal of an order (as opposed to an ideal of the coordinate ring).  I suggest documenting that more clearly, and perhaps checking when an instance is created if it's the right kind of ideal and throwing an exception otherwise.

I can see someone trying to do this:


```
sage: R.<x,y> = QQ[]
sage: C = Curve(y^2-x^3-1)

sage: FunctionFieldPlace(R*(x-2,y-3))
```


or more sensibly this:


```
sage: R.<x,y,z> = QQ[]
sage: C = Curve((y^2-x^3-1).homogenize(z))

sage: FunctionFieldPlace(R*(x-2,y-3).homogenize(z))
```


Also, is there a way to construct a `FunctionField` from a `Curve`?


---

Comment by klee created at 2018-05-18 11:36:00

Replying to [comment:69 gh-BrentBaccala]:
> Replying to [comment:68 klee]: 
> > Now corrected.
> 
> Looks good!
> 
> Suggestion:
> 
> In the documentation for class `FunctionFieldPlace`, `prime` is defined as "prime ideal associated with the place".  I assume this means a prime ideal of an order (as opposed to an ideal of the coordinate ring).  I suggest documenting that more clearly, and perhaps checking when an instance is created if it's the right kind of ideal and throwing an exception otherwise.
> 
> I can see someone trying to do this:
> 
> {{{
> sage: R.<x,y> = QQ[]
> sage: C = Curve(y<sup>2-x</sup>3-1)
> 
> sage: FunctionFieldPlace(R*(x-2,y-3))
> }}}

For a function field, there is no coordinate ring, and you are not supposed to use the class `FunctionFieldPlace` directly, just like you use the constructor `Curve` rather than a  curve class.

> or more sensibly this:
> 
> {{{
> sage: R.<x,y,z> = QQ[]
> sage: C = Curve((y<sup>2-x</sup>3-1).homogenize(z))
> 
> sage: FunctionFieldPlace(R*(x-2,y-3).homogenize(z))
> }}}
> 
> Also, is there a way to construct a `FunctionField` from a `Curve`?

The function field code is not yet integrated with the curve code. This is something to be done later.


---

Comment by @BrentBaccala created at 2018-05-18 23:35:42

Replying to [comment:70 klee]:

> The function field code is not yet integrated with the curve code. This is something to be done later.

Could we discuss that a bit, since that's a major use case and might affect how the code is designed?

There's two common things to do with a place on a curve that don't seem very easy with the current code:

1. get the coordinates of the point under the place

   We've got `place_below` in `FFP_Global`, that I think should get us to a prime ideal in the coordinate ring, and from there we can get to coordinates of the point, but I don't see anything more straightforward than that

2. compute a series expansion of a function in terms of a uniformizing variable

   We got `local_uniformizer` in `FFP_Rational`, that returns a uniformizing variable, but I don't think there's a method to do a series expansion

Also, what's the difference between a global place and a rational place?


---

Comment by klee created at 2018-05-19 07:06:37

Replying to [comment:71 gh-BrentBaccala]:
> Replying to [comment:70 klee]:
> 
> > The function field code is not yet integrated with the curve code. This is something to be done later.
> 
> Could we discuss that a bit, since that's a major use case and might affect how the code is designed?
> 
> There's two common things to do with a place on a curve that don't seem very easy with the current code:
> 
> 1. get the coordinates of the point under the place

This would be part of the code integrating a curve with its function field.

>    We've got `place_below` in `FFP_Global`, that I think should get us to a prime ideal in the coordinate ring, and from there we can get to coordinates of the point, but I don't see anything more straightforward than that.

No. `place_below` is nothing to do with the coordinate ring. A function field is an extension of a rational function field. `place below` return the place of the rational function field below a place of the function field.

> 2. compute a series expansion of a function in terms of a uniformizing variable
> 
>    We got `local_uniformizer` in `FFP_Rational`, that returns a uniformizing variable, but I don't think there's a method to do a series expansion

I recommend you to read the attached pdf for short introduction to the function field code. Yes, there is a method for series expansion of functions at a place.

> Also, what's the difference between a global place and a rational place?

You seem to mean places of global function fields and places of rational function fields.

If you consult Stichtenoth's book Algebraic Function Fields and Codes, then you would be better prepared to understand and use the function field code of this ticket. That book also explains how curve and function field are related.


---

Comment by @BrentBaccala created at 2018-05-27 17:47:13

There are some changes that I'm considering making here:

1. some doctest failures, due mostly to packages being renamed

2. a Kash interface to implement a lot of these functions (probably selected with `implementation='kash'`)

Should I make those changes to this ticket?  Change this git branch to be public?  Or is there something else you'd suggest?


---

Comment by @BrentBaccala created at 2018-05-27 17:49:56

Replying to [comment:72 klee]:
> Replying to [comment:71 gh-BrentBaccala]:
> 
> > 2. compute a series expansion of a function in terms of a uniformizing variable
> > 
> >    We got `local_uniformizer` in `FFP_Rational`, that returns a uniformizing variable, but I don't think there's a method to do a series expansion
> 
> I recommend you to read the attached pdf for short introduction to the function field code. Yes, there is a method for series expansion of functions at a place.

I read through the PDF, and I'm sorry, I don't see the method for series expansion.  Could you please point it out to me?


---

Comment by klee created at 2018-05-28 00:29:51

Replying to [comment:76 gh-BrentBaccala]:
> There are some changes that I'm considering making here:
> 
> 1. some doctest failures, due mostly to packages being renamed

I guess you mean doctest failures in the stable branch of this ticket. The branch is provided for those who may want to try the global function field code before a full merge of the code to Sage, which would take quite some time. You should expect that it is not completely "stable", though I put some efforts to make it so.

Actual long-term merge process is going on through the child tickets as described in the ticket description. So all necessary fixes would go to the branches in the child tickets.
> 
> 2. a Kash interface to implement a lot of these functions (probably selected with `implementation='kash'`)

The proper parameter name for that is "algorithm" in Sage.

> Should I make those changes to this ticket?  Change this git branch to be public?  

No. Sage development occurs incrementally. You should base your code on either the Sage develop branch or possibly a branch of other ticket. For that, you create your own ticket. It is possible that you make your branch from a branch of some child ticket of the present ticket. In that case, you have to fill the dependencies field of your ticket.


---

Comment by klee created at 2018-05-28 00:33:36

Replying to [comment:77 gh-BrentBaccala]:
> Replying to [comment:72 klee]:
> > Replying to [comment:71 gh-BrentBaccala]:
> > 
> > > 2. compute a series expansion of a function in terms of a uniformizing variable
> > > 
> > >    We got `local_uniformizer` in `FFP_Rational`, that returns a uniformizing variable, but I don't think there's a method to do a series expansion
> > 
> > I recommend you to read the attached pdf for short introduction to the function field code. Yes, there is a method for series expansion of functions at a place.
> 
> I read through the PDF, and I'm sorry, I don't see the method for series expansion.  Could you please point it out to me?

The pdf is for a general introduction. For documentation, you should consult the Sage reference manual. Check out the "completion" method of function fields.


---

Comment by @BrentBaccala created at 2018-06-22 23:43:22

I've created a new ticket #25494 that (partially) implements function fields using `kash`.  Both prime finite fields and QQ are supported as the underlying constant field (no algebraic extensions of them, though).  A lot of the methods aren't implemented, but enough are done to allow Riemann-Roch basis calculations:


```
sage: F.<x> = FunctionField(QQ, implementation='kash')
sage: R.<Y> = F[]
sage: L.<y> = F.extension(Y^2 - x^8 - 1)
sage: O = L.maximal_order()
sage: I = O.ideal(x, y-1)
sage: P = I.place()
sage: D = P.divisor()
sage: D.basis_function_space()
[1]
sage: (4*D).basis_function_space()
[1, 1/x^4*y + 1/x^4]
```


It actually uses Kwankyu Lee's Sage implementation of the Hess algorithm.  Although kash implements the Hess algorithm, it turns out that klee's code works fine; all that kash is needed for is constructing and manipulating orders and ideals.

Since `kash` is closed source, and doesn't support anything like `QQbar` (a major need for my application), this code is probably only useful to verify our results.  We still need a native Sage implementation.

Would you like to add a link to #25494 on this ticket's description?


---

Comment by @BrentBaccala created at 2018-06-22 23:56:49

Some of #25494's code should probably be merged into #22982.  The commit labeled "refactor divisor methods" moves the `divisor`, `divisor_of_zeros`, and `divisor_of_poles` methods into superclasses.  Is there a reason not to do this?  It avoids some code duplication.


---

Comment by @BrentBaccala created at 2018-06-22 23:59:04

Also, what is the `gens` method supposed to do for ideals?  Looking at the test cases in `ideal.py`, it seems like it returns some kind of basis.  My version just returns the generators used to create the ideal, and `basis` needs to be called for an actual basis.  Which is correct?


---

Comment by klee created at 2018-06-23 01:11:41

Replying to [comment:80 gh-BrentBaccala]:
> Would you like to add a link to #25494 on this ticket's description?

No, it should be the other way around. I mean that #25494 should contain a link to this ticket if it depends on this ticket.


---

Comment by klee created at 2018-06-23 01:21:21

Replying to [comment:82 gh-BrentBaccala]:
> Also, what is the `gens` method supposed to do for ideals?  Looking at the test cases in `ideal.py`, it seems like it returns some kind of basis.  My version just returns the generators used to create the ideal, and `basis` needs to be called for an actual basis.  Which is correct?

This comment should be addressed to #25435. Also you could be more specific in your question; `gens` method of what class do you mean?


---

Comment by klee created at 2018-06-23 01:26:11

Replying to [comment:81 gh-BrentBaccala]:
> Some of #25494's code should probably be merged into #22982.  The commit labeled "refactor divisor methods" moves the `divisor`, `divisor_of_zeros`, and `divisor_of_poles` methods into superclasses.  Is there a reason not to do this?  It avoids some code duplication.

As you see, this ticket is just a meta ticket. You comment should be addressed to a (not yet created) sub ticket of this ticket, merging divisor part of the code. I am still waiting for a review of the ticket #25435 dealing with orders and ideals before I create a ticket for divisors.


---

Comment by @BrentBaccala created at 2018-06-24 04:31:00

Replying to [comment:83 klee]:
> Replying to [comment:80 gh-BrentBaccala]:
> > Would you like to add a link to #25494 on this ticket's description?
> 
> No, it should be the other way around. I mean that #25494 should contain a link to this ticket if it depends on this ticket. 


#25494 does contain a link to #22982 in its "dependencies".

I suggest putting a link in this ticket (just like you have links to the sub tickets) so that people will know that we've got a version of this code that works over `QQ`.


---

Comment by dimpase created at 2018-07-10 09:29:52

I don't think working on `kash` makes sense - it's basically dead, it seems.
The last release was 10 years ago, and it's binary only!


---

Comment by klee created at 2018-07-11 01:05:24

Replying to [comment:87 dimpase]:
> I don't think working on `kash` makes sense - it's basically dead, it seems.
> The last release was 10 years ago, and it's binary only!

You read wrong some previous comments. This ticket is not about kash at all!


---

Comment by klee created at 2019-05-10 04:27:19

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2019-05-10 05:45:01

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2019-05-23 19:13:58

Resolution: fixed
