# Issue 17422: make symbolic series subclass of Expression

archive/issues_017422.json:
```json
{
    "body": "Making `Expression.series` create `SymbolicSeries` (a subclass of `Expression`) and moving the series code into a separate file `series.pyx` \n* reflects the fact that expressions and series don't commute\n* allows upcoming fixes that don't clutter `Expression` methods with `if ex.is_a_series():`\n* makes for better documentation via having a `Symbolic Series` ref man page\n\nIssue created by migration from https://trac.sagemath.org/ticket/17659\n\n",
    "created_at": "2015-01-22T14:54:03Z",
    "labels": [
        "component: symbolics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "make symbolic series subclass of Expression",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17422",
    "user": "https://github.com/rwst"
}
```
Making `Expression.series` create `SymbolicSeries` (a subclass of `Expression`) and moving the series code into a separate file `series.pyx` 
* reflects the fact that expressions and series don't commute
* allows upcoming fixes that don't clutter `Expression` methods with `if ex.is_a_series():`
* makes for better documentation via having a `Symbolic Series` ref man page

Issue created by migration from https://trac.sagemath.org/ticket/17659





---

archive/issue_comments_232305.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-22T14:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232305",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_232306.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-01-22T14:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232306",
    "user": "https://github.com/rwst"
}
```

New commits:



---

archive/issue_comments_232307.json:
```json
{
    "body": "I have nothing invested in how symbolics and series interact, but I see some immediate problems that would arise from subclassing Expression for a Series type:\n- when does a SymbolicSeries expression get created? The problem is that the SymbolicRing by itself is a rather untyped environment, so how do you know that an object needs to be made in this specialized class\n- How do SymbolicSeries in different variables interact, e.g.:\n\n```\nF = (1/(x+1))*y+sin(x)*y^2+O(y^3)\nG = (y/(y^2-2)*x + cos(y)*x^2 +O(x^3)\nF+G\n```\n\nIs the result a series? If so, in which variable(s)? One solution would be a SymbolicSeriesRing as a parent, which declares in what variables the series are. I suspect this would be nearly useless for whatever problem the current design tries to solve, though.",
    "created_at": "2015-01-22T20:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232307",
    "user": "https://github.com/nbruin"
}
```

I have nothing invested in how symbolics and series interact, but I see some immediate problems that would arise from subclassing Expression for a Series type:
- when does a SymbolicSeries expression get created? The problem is that the SymbolicRing by itself is a rather untyped environment, so how do you know that an object needs to be made in this specialized class
- How do SymbolicSeries in different variables interact, e.g.:

```
F = (1/(x+1))*y+sin(x)*y^2+O(y^3)
G = (y/(y^2-2)*x + cos(y)*x^2 +O(x^3)
F+G
```

Is the result a series? If so, in which variable(s)? One solution would be a SymbolicSeriesRing as a parent, which declares in what variables the series are. I suspect this would be nearly useless for whatever problem the current design tries to solve, though.



---

archive/issue_comments_232308.json:
```json
{
    "body": "Nils, this is not about creating a ring but simple refactoring. No behaviour change.\n\nhttp://www.refactoring.com/catalog/replaceConditionalWithPolymorphism.html\n\nReplying to [comment:3 nbruin]:\n> I have nothing invested in how symbolics and series interact, but I see some immediate problems that would arise from subclassing Expression for a Series type:\nThese problems already exist, so nothing is new.",
    "created_at": "2015-01-23T06:44:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232308",
    "user": "https://github.com/rwst"
}
```

Nils, this is not about creating a ring but simple refactoring. No behaviour change.

http://www.refactoring.com/catalog/replaceConditionalWithPolymorphism.html

Replying to [comment:3 nbruin]:
> I have nothing invested in how symbolics and series interact, but I see some immediate problems that would arise from subclassing Expression for a Series type:
These problems already exist, so nothing is new.



---

archive/issue_comments_232309.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-23T08:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232309",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232310.json:
```json
{
    "body": "OK, I thought that `f.is_series()` would do some non-trivial logic to see if `f` can be used as a series, but it's just exposing a flag that is held internally somewhere. You could indeed expose that information in the type instead, but with ducktyping, subtyping and sage's parent infrastructure doing so might not be as convenient as it might be in systems that are really governed by explicit types. You'd need to think if this refactoring actually will help for further development.\n\nIndeed, being a \"series\" seems a rather fickle property. It doesn't seem to be preserved under anything:\n\n\n```\nsage: var('x,y');\nsage: f=cos(y).series(y,10)\nsage: g=sin(x).series(x,10)\nsage: var('x,y');\nsage: f=cos(y).series(y,10)\nsage: g=sin(x).series(x,10)\nsage: f.is_series()\nTrue\nsage: (f+f).is_series()\nFalse\nsage: (-f).is_series()\nFalse\nsage: (f+g).series(x,10)\nOrder(1)\n```\n\nThe last result probably follows from interpreting the `Order(x^10)` term in `g` as an order term in `y`, and hence equivalent to `Order(y^0)`.",
    "created_at": "2015-01-23T20:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232310",
    "user": "https://github.com/nbruin"
}
```

OK, I thought that `f.is_series()` would do some non-trivial logic to see if `f` can be used as a series, but it's just exposing a flag that is held internally somewhere. You could indeed expose that information in the type instead, but with ducktyping, subtyping and sage's parent infrastructure doing so might not be as convenient as it might be in systems that are really governed by explicit types. You'd need to think if this refactoring actually will help for further development.

Indeed, being a "series" seems a rather fickle property. It doesn't seem to be preserved under anything:


```
sage: var('x,y');
sage: f=cos(y).series(y,10)
sage: g=sin(x).series(x,10)
sage: var('x,y');
sage: f=cos(y).series(y,10)
sage: g=sin(x).series(x,10)
sage: f.is_series()
True
sage: (f+f).is_series()
False
sage: (-f).is_series()
False
sage: (f+g).series(x,10)
Order(1)
```

The last result probably follows from interpreting the `Order(x^10)` term in `g` as an order term in `y`, and hence equivalent to `Order(y^0)`.



---

archive/issue_comments_232311.json:
```json
{
    "body": "Replying to [comment:8 nbruin]:\n> You'd need to think if this refactoring actually will help for further development.\nIt isolates the code and the documentation.\n> Indeed, being a \"series\" seems a rather fickle property. It doesn't seem to be preserved under anything:\nThere are functions in `pynac-0.3.2/ginac/pseries.cpp` to compare, add, multiply (also with constant), power (to constant). My plan is to only provide conversion to and from `PowerSeries` (#10846, #16203, #17402) and fix the worst bugs (#17400, #16213) and that's it. I'd rather improve `PowerSeries` but symbolic is what people use.",
    "created_at": "2015-01-24T07:22:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232311",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:8 nbruin]:
> You'd need to think if this refactoring actually will help for further development.
It isolates the code and the documentation.
> Indeed, being a "series" seems a rather fickle property. It doesn't seem to be preserved under anything:
There are functions in `pynac-0.3.2/ginac/pseries.cpp` to compare, add, multiply (also with constant), power (to constant). My plan is to only provide conversion to and from `PowerSeries` (#10846, #16203, #17402) and fix the worst bugs (#17400, #16213) and that's it. I'd rather improve `PowerSeries` but symbolic is what people use.



---

archive/issue_comments_232312.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-25T15:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232312",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232313.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-25T16:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232313",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232314.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-05T14:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232314",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232315.json:
```json
{
    "body": "There is a spurious unreprodcible doctest failure in the 6.6beta2 pachbot run.",
    "created_at": "2015-03-30T07:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232315",
    "user": "https://github.com/rwst"
}
```

There is a spurious unreprodcible doctest failure in the 6.6beta2 pachbot run.



---

archive/issue_comments_232316.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-20T15:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232316",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232317.json:
```json
{
    "body": "This now uncovers a regression of #12255 which was not really fixed.\n\n```\nFile \"src/sage/symbolic/expression.pyx\", line 5279, in sage.symbolic.expression.Expression.coefficients\nFailed example:\n    f.coefficients(g)\nException raised:\n    ValueError: The name \"g(t)\" is not a valid Python identifier.\n```\n\nI will now let this ticket (and with it its dependencies) lie in limbo because, as a posting on sage-devel showed, there is no interest in symbolic series.",
    "created_at": "2015-04-20T15:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232317",
    "user": "https://github.com/rwst"
}
```

This now uncovers a regression of #12255 which was not really fixed.

```
File "src/sage/symbolic/expression.pyx", line 5279, in sage.symbolic.expression.Expression.coefficients
Failed example:
    f.coefficients(g)
Exception raised:
    ValueError: The name "g(t)" is not a valid Python identifier.
```

I will now let this ticket (and with it its dependencies) lie in limbo because, as a posting on sage-devel showed, there is no interest in symbolic series.



---

archive/issue_comments_232318.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-20T15:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232318",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_232319.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-18T06:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232319",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232320.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-18T06:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232320",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_232321.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-18T14:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232322.json:
```json
{
    "body": "Hello,\n\nThe ticket looks good.\n\n1. Why do you need all these include\n\n```\ninclude \"sage/ext/interrupt.pxi\"\ninclude \"sage/ext/stdsage.pxi\"\ninclude \"sage/ext/cdefs.pxi\"\ninclude \"sage/ext/python.pxi\"\n```\n\n  As far as I saw you are using none of them.\n\n2. You should fix your mind\n\n```\n... about 0, about `1` ...\n```\n\n   Either ``0`` and ``1`` or `0` and `1`.\n\n3. In the example, instead of `float(expr)` could you use `numerical_approx(expr)`?\n\n4. You should not put `self` as an argument of a method (you did it in `truncate`). Moreover, it is better to avoid `self` in the documentation. Always prefer `this expression` or `this object`.\n\n5. In `coefficients`, the argument `sparse` is not documented in the `INPUT` section\n\n6. In `coefficients`, you should replace `if sparse is True` by `if sparse`.",
    "created_at": "2015-11-28T13:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232322",
    "user": "https://github.com/videlec"
}
```

Hello,

The ticket looks good.

1. Why do you need all these include

```
include "sage/ext/interrupt.pxi"
include "sage/ext/stdsage.pxi"
include "sage/ext/cdefs.pxi"
include "sage/ext/python.pxi"
```

  As far as I saw you are using none of them.

2. You should fix your mind

```
... about 0, about `1` ...
```

   Either ``0`` and ``1`` or `0` and `1`.

3. In the example, instead of `float(expr)` could you use `numerical_approx(expr)`?

4. You should not put `self` as an argument of a method (you did it in `truncate`). Moreover, it is better to avoid `self` in the documentation. Always prefer `this expression` or `this object`.

5. In `coefficients`, the argument `sparse` is not documented in the `INPUT` section

6. In `coefficients`, you should replace `if sparse is True` by `if sparse`.



---

archive/issue_comments_232323.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-11-28T13:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232323",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_232324.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-11-28T16:47:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232324",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_232325.json:
```json
{
    "body": "Thanks for looking at this.\n----\nNew commits:",
    "created_at": "2015-11-28T16:47:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232325",
    "user": "https://github.com/rwst"
}
```

Thanks for looking at this.
----
New commits:



---

archive/issue_comments_232326.json:
```json
{
    "body": "Is the method `is_series` really usefull?",
    "created_at": "2015-11-28T16:51:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232326",
    "user": "https://github.com/videlec"
}
```

Is the method `is_series` really usefull?



---

archive/issue_comments_232327.json:
```json
{
    "body": "Replying to [comment:25 vdelecroix]:\n> Is the method `is_series` really usefull?\nSeries are still expressions. How would you know a symbol holding a specific expression holds a series?",
    "created_at": "2015-11-29T07:13:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232327",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:25 vdelecroix]:
> Is the method `is_series` really usefull?
Series are still expressions. How would you know a symbol holding a specific expression holds a series?



---

archive/issue_comments_232328.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-29T07:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232328",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232329.json:
```json
{
    "body": "Replying to [comment:26 rws]:\n> Replying to [comment:25 vdelecroix]:\n> > Is the method `is_series` really usefull?\n> Series are still expressions. How would you know a symbol holding a specific expression holds a series?\n\n`instance(my_object, SymbolicSeries)`?",
    "created_at": "2015-11-29T12:24:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232329",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:26 rws]:
> Replying to [comment:25 vdelecroix]:
> > Is the method `is_series` really usefull?
> Series are still expressions. How would you know a symbol holding a specific expression holds a series?

`instance(my_object, SymbolicSeries)`?



---

archive/issue_comments_232330.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-30T07:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232330",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232331.json:
```json
{
    "body": "Indeed. Anything else?",
    "created_at": "2015-11-30T07:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232331",
    "user": "https://github.com/rwst"
}
```

Indeed. Anything else?



---

archive/issue_comments_232332.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-11-30T09:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232332",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_232333.json:
```json
{
    "body": "Replying to [comment:30 rws]:\n> Indeed. Anything else?\n\nYes: you are not allowed to remove a public function without (one year) deprecation with an error message that indicates the new procedure: http://doc.sagemath.org/html/en/developer/coding_in_python.html#deprecation",
    "created_at": "2015-11-30T09:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232333",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:30 rws]:
> Indeed. Anything else?

Yes: you are not allowed to remove a public function without (one year) deprecation with an error message that indicates the new procedure: http://doc.sagemath.org/html/en/developer/coding_in_python.html#deprecation



---

archive/issue_comments_232334.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-30T14:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232334",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232335.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-11-30T14:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232335",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_232336.json:
```json
{
    "body": "Isn't it dangerous to expose globally `SymbolicSeries`? If people don't know about classes they do not want to see it. And if they do, they know how to import modules. You can just be explicit in the deprecation message\n\n```\nisinstance(my_expr, sage.symbolic.series.SymbolicSeries)\n```\n\n\n(I would also hide `Expression` from the global namespace but this does not concern this ticket.)",
    "created_at": "2015-11-30T14:43:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232336",
    "user": "https://github.com/videlec"
}
```

Isn't it dangerous to expose globally `SymbolicSeries`? If people don't know about classes they do not want to see it. And if they do, they know how to import modules. You can just be explicit in the deprecation message

```
isinstance(my_expr, sage.symbolic.series.SymbolicSeries)
```


(I would also hide `Expression` from the global namespace but this does not concern this ticket.)



---

archive/issue_comments_232337.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-30T16:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232337",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232338.json:
```json
{
    "body": "Good for me.",
    "created_at": "2015-11-30T18:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232338",
    "user": "https://github.com/videlec"
}
```

Good for me.



---

archive/issue_comments_232339.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-11-30T18:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232339",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_232340.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-12-01T08:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232340",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_232341.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/symbolic/series.pyx\n**********************************************************************\nFile \"src/sage/symbolic/series.pyx\", line 71, in sage.symbolic.series\nFailed example:\n    x*ex1\nExpected:\n    (1*x + (-1/6)*x^3 + Order(x^4))*x\nGot:\n    x*(1*x + (-1/6)*x^3 + Order(x^4))\n**********************************************************************\n1 item had failures:\n   1 of  23 in sage.symbolic.series\n    [42 tests, 1 failure, 0.04 s]\n```\n",
    "created_at": "2015-12-01T08:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232341",
    "user": "https://github.com/vbraun"
}
```


```
sage -t --long src/sage/symbolic/series.pyx
**********************************************************************
File "src/sage/symbolic/series.pyx", line 71, in sage.symbolic.series
Failed example:
    x*ex1
Expected:
    (1*x + (-1/6)*x^3 + Order(x^4))*x
Got:
    x*(1*x + (-1/6)*x^3 + Order(x^4))
**********************************************************************
1 item had failures:
   1 of  23 in sage.symbolic.series
    [42 tests, 1 failure, 0.04 s]
```




---

archive/issue_comments_232342.json:
```json
{
    "body": "That happens in 6 out of 10 attempts here. Bummer.",
    "created_at": "2015-12-01T09:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232342",
    "user": "https://github.com/rwst"
}
```

That happens in 6 out of 10 attempts here. Bummer.



---

archive/issue_comments_232343.json:
```json
{
    "body": "For the record, only when doctesting and in different processes does it fail often enough to be noticed (regardless of if testing in parallel or not). When not leaving the Sage process the results seem always the same. One possbility would be therefore an uninitialized variable in Pynac affecting the result depending on what's in the memory at Sage start.",
    "created_at": "2015-12-01T15:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232343",
    "user": "https://github.com/rwst"
}
```

For the record, only when doctesting and in different processes does it fail often enough to be noticed (regardless of if testing in parallel or not). When not leaving the Sage process the results seem always the same. One possbility would be therefore an uninitialized variable in Pynac affecting the result depending on what's in the memory at Sage start.



---

archive/issue_comments_232344.json:
```json
{
    "body": "Might also depend on Python memory locations (are the underlying ginac objects cached or not?). If its an uninitialized pynac variable then valgrind should find it.",
    "created_at": "2015-12-01T15:54:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232344",
    "user": "https://github.com/vbraun"
}
```

Might also depend on Python memory locations (are the underlying ginac objects cached or not?). If its an uninitialized pynac variable then valgrind should find it.



---

archive/issue_comments_232345.json:
```json
{
    "body": "I would have found it if it were in the upcoming pynac-0.5.2 because I used valgrind extensively there. So it might just disappear with #19312.",
    "created_at": "2015-12-01T16:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232345",
    "user": "https://github.com/rwst"
}
```

I would have found it if it were in the upcoming pynac-0.5.2 because I used valgrind extensively there. So it might just disappear with #19312.



---

archive/issue_comments_232346.json:
```json
{
    "body": "Okay, for some reason printing order here is according to hash value, and hash values of symbols are not preserved over different processes. Putting `sage: hash(x)` in an arbitrary doctest and testing multiple times shows this clearly, also in Sage-6.6. It's just that such series manipulations produced an error until recently, so the differences over time couldn't be observed.",
    "created_at": "2016-01-11T16:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232346",
    "user": "https://github.com/rwst"
}
```

Okay, for some reason printing order here is according to hash value, and hash values of symbols are not preserved over different processes. Putting `sage: hash(x)` in an arbitrary doctest and testing multiple times shows this clearly, also in Sage-6.6. It's just that such series manipulations produced an error until recently, so the differences over time couldn't be observed.



---

archive/issue_comments_232347.json:
```json
{
    "body": "See https://github.com/pynac/pynac/issues/22\n\nThis is now fixed in pynac and depends on the upgrade to pynac-0.6.1.",
    "created_at": "2016-01-12T09:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232347",
    "user": "https://github.com/rwst"
}
```

See https://github.com/pynac/pynac/issues/22

This is now fixed in pynac and depends on the upgrade to pynac-0.6.1.



---

archive/issue_comments_232348.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-01-24T07:26:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232348",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_232349.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-01-28T08:01:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232349",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_232350.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/symbolic/series.pyx\n**********************************************************************\nFile \"src/sage/symbolic/series.pyx\", line 71, in sage.symbolic.series\nFailed example:\n    x*ex1\nExpected:\n    (1*x + (-1/6)*x^3 + Order(x^4))*x\nGot:\n    x*(1*x + (-1/6)*x^3 + Order(x^4))\n**********************************************************************\n1 item had failures:\n   1 of  23 in sage.symbolic.series\n    [42 tests, 1 failure, 0.04 s]\n```\n",
    "created_at": "2016-01-28T08:01:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232350",
    "user": "https://github.com/vbraun"
}
```


```
sage -t --long src/sage/symbolic/series.pyx
**********************************************************************
File "src/sage/symbolic/series.pyx", line 71, in sage.symbolic.series
Failed example:
    x*ex1
Expected:
    (1*x + (-1/6)*x^3 + Order(x^4))*x
Got:
    x*(1*x + (-1/6)*x^3 + Order(x^4))
**********************************************************************
1 item had failures:
   1 of  23 in sage.symbolic.series
    [42 tests, 1 failure, 0.04 s]
```




---

archive/issue_comments_232351.json:
```json
{
    "body": "Beware the dependency!",
    "created_at": "2016-01-28T09:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232351",
    "user": "https://github.com/rwst"
}
```

Beware the dependency!



---

archive/issue_comments_232352.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-01-29T07:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232352",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_232353.json:
```json
{
    "body": "Patchbot also shows failure",
    "created_at": "2016-01-29T13:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232353",
    "user": "https://github.com/vbraun"
}
```

Patchbot also shows failure



---

archive/issue_comments_232354.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-01-29T13:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232354",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_232355.json:
```json
{
    "body": "Yes, a remainder from the time before #19948.\n----\nNew commits:",
    "created_at": "2016-01-29T13:29:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232355",
    "user": "https://github.com/rwst"
}
```

Yes, a remainder from the time before #19948.
----
New commits:



---

archive/issue_comments_232356.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-01-29T13:29:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232356",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_232357.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-01-29T13:33:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232357",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_232358.json:
```json
{
    "body": "Ralf, did you intend for this to wait to 7.2 or did you mean 7.1?",
    "created_at": "2016-01-29T20:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232358",
    "user": "https://github.com/tscrim"
}
```

Ralf, did you intend for this to wait to 7.2 or did you mean 7.1?



---

archive/issue_comments_232359.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-01-30T00:11:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17422#issuecomment-232359",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
