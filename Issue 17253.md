# Issue 17253: Fix tar issue in sagenb

Issue created by migration from Trac.

Original creator: kcrisman

Original creation time: 2014-12-12 17:36:27

CC:  dimpase

If someone uses BSD tar (the default on Mac) to tar up an spkg, it can cause problems on some Linux setups.  See e.g. https://groups.google.com/forum/#!topic/sage-support/IZHC1QeFqBI but also many in the past.


---

Comment by jdemeyer created at 2014-12-12 18:36:41

What about using [https://docs.python.org/2/library/tarfile.html#module-tarfile](https://docs.python.org/2/library/tarfile.html#module-tarfile) to create the tar file?


---

Comment by dimpase created at 2014-12-17 15:42:44

Replying to [comment:2 jdemeyer]:
> What about using [https://docs.python.org/2/library/tarfile.html#module-tarfile](https://docs.python.org/2/library/tarfile.html#module-tarfile) to create the tar file?

Should be doable - and actually should be put into the `spk-src` script, as the creation of the spkg for sagenb is not trivial...


---

Comment by kcrisman created at 2014-12-18 03:47:10

Currently upstream [says](https://github.com/sagemath/sagenb/blob/master/ReleaseInstr.md)

```
mv dist sagenb-<version>
tar cf sagenb-<version>.tar sagenb-<version>
mv sagenb-<version>.tar SAGE_ROOT/upstream
```

but if that were put into an `spkg-src` script that would be fine.  Or maybe the gz file that comes out of [dist.sh](https://github.com/sagemath/sagenb/blob/master/dist.sh) is enough?

Ideally this would go in #10057.


---

Comment by dimpase created at 2014-12-18 10:19:44

Replying to [comment:4 kcrisman]:
> Currently upstream [says](https://github.com/sagemath/sagenb/blob/master/ReleaseInstr.md)
> {{{
> mv dist sagenb-<version>
> tar cf sagenb-<version>.tar sagenb-<version>
> mv sagenb-<version>.tar SAGE_ROOT/upstream
> }}}
> but if that were put into an `spkg-src` script that would be fine.  Or maybe the gz file that comes out of [dist.sh](https://github.com/sagemath/sagenb/blob/master/dist.sh) is enough?
> 

this looks good (I presume that https://docs.python.org/2/distutils/sourcedist.html
does call python's tar rather than the system tar).
You might also want to add option to make tar file rather than tar.gz file.

So, why did you do the tarball creation manually rather than using this script?


---

Comment by kcrisman created at 2014-12-18 13:58:06

??  That is not a script!  It is just instructions.  I am just following instructions from kini and ppurka I know "work", for some value of work.  I didn't have time to test all these other issues.  I will be happy to look at a pull request to change those instructions, especially as I think you have access to a Mac and can test the difference.


---

Comment by dimpase created at 2014-12-18 14:04:27

Replying to [comment:6 kcrisman]:
> ??  That is not a script!  It is just instructions.

I meant `dist.sh` as linked above.


---

Comment by kcrisman created at 2014-12-18 14:17:32

I did use `dist.sh`, but then the instructions said to do this too ... so I did, because I didn't want to miss something.  I believe that the tar.gz in the `dist` is _only_ the sagenb code proper, and the various dependencies are separately in `dist`.  So then the whole thing needs to be tarred up.  I didn't come up with this distribution scheme, for the record!  See #17306 for a first step in possibly going back to making this part of Sage...


---

Comment by dimpase created at 2014-12-18 14:33:41

Replying to [comment:8 kcrisman]:
> I did use `dist.sh`, but then the instructions said to do this too ... so I did, because I didn't want to miss something.  I believe that the tar.gz in the `dist` is _only_ the sagenb code proper, and the various dependencies are separately in `dist`.  So then the whole thing needs to be tarred up. 

Yeah, that's right. Why don't we write the `spkg-src` (python, or your other favourite language that has its own GNU-compatible tar?) script based on these?
 

> I didn't come up with this distribution scheme, for the record!  See #17306 for a first step in possibly going back to making this part of Sage...


---

Comment by kcrisman created at 2014-12-18 14:35:10

> > I did use `dist.sh`, but then the instructions said to do this too ... so I did, because I didn't want to miss something.  I believe that the tar.gz in the `dist` is _only_ the sagenb code proper, and the various dependencies are separately in `dist`.  So then the whole thing needs to be tarred up. 
> 
> Yeah, that's right. Why don't we write the `spkg-src` (python, or your other favourite language that has its own GNU-compatible tar?) script based on these?

Go ahead!  I will review if you do.


---

Comment by kcrisman created at 2014-12-24 02:59:19

In the meantime, as a partial (?) fix, I have committed [this release instructions update](https://github.com/sagemath/sagenb/commit/7f989d3931ae4481e6293a8fb68de569eac733d9), however, it will not be "officially in" #10057 (though I used its advice).


---

Comment by jdemeyer created at 2014-12-24 09:47:55

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2014-12-24 09:47:55

Fixed by #10057.


---

Comment by jdemeyer created at 2014-12-24 09:48:01

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-01-13 01:15:12

Resolution: fixed


---

Comment by kcrisman created at 2015-02-03 04:01:39

[Yet another report](https://groups.google.com/forum/#!topic/sage-support/Nt6AguJaS_g) so I guess this was quite a problem...
