# Issue 11933: RuntimeError: Segmentation fault with nth_root

Issue created by migration from https://trac.sagemath.org/ticket/12105

Original creator: lfousse

Original creation time: 2011-12-01 18:06:36

Assignee: jason, jkantor


```
sage: RealField(53)(0.05).nth_root(7 * 10^8)
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)

/opt/sage-4.7.2/<ipython console> in <module>()

/opt/sage-4.7.2/local/lib/python2.6/site-packages/sage/rings/real_mpfr.so in sage.rings.real_mpfr.RealNumber.nth_root (sage/rings/real_mpfr.c:23889)()

RuntimeError: Segmentation fault
```



---

Comment by johanbosman created at 2011-12-02 14:02:58

The bug is in line 4708 of sage/rings/real_mpfr.pyx:

```
        if algorithm == 0 and fld.__prec * n < 10000:
```

The result of that multiplication as a signed int may become negative and actually does so in your example.


---

Attachment


---

Comment by johanbosman created at 2011-12-02 16:03:33

Changing status from new to needs_review.


---

Comment by kcrisman created at 2012-02-03 03:12:14

On Mac I don't get an error, but it hangs and eventually consumes all resources, so fair enough!  

This patch gives

```
sage: timeit("RealField(53)(0.05).nth_root(7 * 10^8)")
625 loops, best of 3: 69.2 Âµs per loop
```


One question I have is whether this is the most appropriate test with this precision.

```
sage: RealField(53)(0.05).nth_root(7 * 10^8) 
0.999999995720382
sage: _^(7*10^8)
0.0499999991341384
```

Is that good enough?  

Otherwise this is fine, passes tests, etc. on 5.0.beta1.


---

Comment by johanbosman created at 2012-02-03 10:08:28

It'll be difficult to get a more accurate answer with that precision.  Let's turn the last 2 into a 3:

```
sage: 0.999999995720383^(7*10^8)
0.0500000185630449
```



---

Comment by kcrisman created at 2012-02-03 15:55:23

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2012-02-03 15:55:23

> It'll be difficult to get a more accurate answer with that precision.
Well, that's what I figured, but I'm not a numerical analysis expert.  Thanks.

Positive review.


---

Comment by jdemeyer created at 2012-02-06 21:25:33

Resolution: fixed
