# Issue 29318: Upgrade: OpenSSL 3.0

Issue created by migration from https://trac.sagemath.org/ticket/29555

Original creator: slelievre

Original creation time: 2020-04-23 15:49:29

CC:  slelievre dunfield tmonteil mjo dimpase @posita vbraun

Upgrade to OpenSSL 3.0.

License is now Apache 2.0, which is GPL-compatible.
https://github.com/openssl/openssl/blob/master/LICENSE

Once Sage macOS binaries ship OpenSSL,
they will allow easily pip-installing extra packages.


---

Comment by slelievre created at 2020-04-23 15:51:25

OpenSSL 3.0.0-alpha1 is out. Blog post:
https://www.openssl.org/blog/blog/2020/04/23/OpenSSL3.0Alpha1/

OpenSSL 3.0.0-alpha1 tarball:
- https://ftp.openssl.org/source/openssl-3.0.0-alpha1.tar.gz


---

Comment by slelievre created at 2020-04-23 15:53:58

Time to make openssl a standard package too. Related tickets:
- #24107 Inclusion of OpenSSL, stage 1
- #23893 make openssl a dependency for pip packages


---

Comment by slelievre created at 2020-04-23 16:03:17

Changing keywords from "" to "openssl".


---

Comment by mkoeppe created at 2020-06-09 00:33:40

https://www.openssl.org/source/openssl-3.0.0-alpha3.tar.gz is out now


---

Comment by mkoeppe created at 2020-06-09 01:00:35

Of course it's too early to merge, but I wanted to check whether our python3 compiles with it. It does, at least on macOS.
----
New commits:


---

Comment by git created at 2020-06-09 01:03:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-06-09 01:05:16

Next (other than waiting for the release), we need an spkg-configure.m4 for openssl


---

Comment by mkoeppe created at 2020-07-06 23:44:42

Now there's openssl-3.0.0-alpha4


---

Comment by slelievre created at 2020-08-07 00:28:17

OpenSSL 3.0.0.alpha6 is out.


---

Comment by mkoeppe created at 2020-12-15 04:14:21

alpha9 is out...


---

Comment by mkoeppe created at 2021-01-19 21:16:54

alpha10 is out


---

Comment by slelievre created at 2021-01-28 16:06:45

alpha11


---

Comment by git created at 2021-01-31 19:29:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-01-31 21:06:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-01-31 21:11:45

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-01-31 21:11:45

Wondering how people would feel about this one. Solves our openssl license compatibility problem. Includes big fat warning that it's an alpha release. To my understanding, the way that current jupyter depends on the ssl module (via `tornado` - see 30674), it is merely a dependency and no SSL is actually spoken to anyone but possibly localhost.

SSL would still kick in when pip packages are installed - but these are all optional and users have been warned.


---

Comment by tmonteil created at 2021-01-31 21:18:06

I would prefer that we stick to 1.1.1* until openssl 3.0 is released, the current 3.0 is not even beta !


---

Comment by dunfield created at 2021-02-01 03:00:54

Replying to [comment:22 tmonteil]:
> I would prefer that we stick to 1.1.1* until openssl 3.0 is released, the current 3.0 is not even beta !

Currently, the macOS binaries don't have any version of openssl at all.  So there, the choice is 3.0 alpha or nothing, meaning the user is unable to run Jupyter notebooks, which is a pretty core feature of Sage for many users.

I say go for it, the current situation is causing a lot of people problems, see all the posts to sage-support and sage-devel.


---

Comment by tmonteil created at 2021-02-01 10:18:41

Could this be only shipped with macOS binaries ?


---

Comment by dunfield created at 2021-02-01 14:48:56

Replying to [comment:24 tmonteil]:
> Could this be only shipped with macOS binaries ?

On Linux, Sage doesn't need to provide its own copy of openssl, it just uses the system library.  The problem is macOS deprecated openssl in favor of their own APIs and only provides openssl 0.9.8, which is too old to be useful.


---

Comment by mkoeppe created at 2021-02-02 19:12:57

Another idea could be to make openssl 3.0 standard (as on this ticket) but keep the stable (but license-incompatible) openssl 1.1.x as an optional package.  So people who need to deploy a secure system but cannot do so using a system installation of openssl would be enable this optional package.  But it is not clear whether this is a convincing use case that would warrant adding this kind of build system complexity for it.


---

Comment by mkoeppe created at 2021-02-02 19:16:49

Replying to [comment:24 tmonteil]:
> Could this be only shipped with macOS binaries ?
These issues with ssl also affect people who build from source.


---

Comment by dimpase created at 2021-02-03 00:41:05

I suppose this is tested on macOS. On Linux it's fine.


---

Comment by dimpase created at 2021-02-03 00:41:05

Changing status from needs_review to positive_review.


---

Comment by tmonteil created at 2021-02-03 01:28:34

Replying to [comment:27 mkoeppe]:
> Replying to [comment:24 tmonteil]:
> > Could this be only shipped with macOS binaries ?
> These issues with ssl also affect people who build from source.

I imagine the people that build from source use a decent distribution of packages that includes `openssl` like homebrew, as recommended in the Sage installation documenation.

I do not like the current way as it will install an immature implementation of SSL within Sage for most people, since even on some OS that ship `openssl-dev`, this latter is rarely installed by default, see e.g. https://ask.sagemath.org/question/47513/rise-in-jupyter/

The warning are probably not enough (and probably lost among tons of configure lines) since people will just go ahead and "prefer" using the standard `openssl` spkg over installing the lib from their distro.


---

Comment by slelievre created at 2021-02-03 02:02:15

I'm also uneasy with an alpha stage OpenSSL 3 becoming standard.

Maybe we can create an "openssl3" optional package for now?

We should advertise the `fix_mac_sage` scripts by the 3-manifolds group

- https://github.com/3-manifolds/fix_mac_sage/

that can "fix" a Sage install on macOS by adding SSL and tkinter to its Python.

We should advertise it

- in the README file that is shipped with macOS binaries
- on the macOS download page of the SageMath website


---

Comment by vbraun created at 2021-02-20 10:46:30

Resolution: fixed
