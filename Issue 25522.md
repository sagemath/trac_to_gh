# Issue 25522: Patch scipy to fix issue with python3.7

Issue created by migration from https://trac.sagemath.org/ticket/25759

Original creator: vklein

Original creation time: 2018-07-03 14:29:29

Installing `scipy 0.19.1` (source release) with `python 3.7` generate multiple errors of this kind:

```
scipy/cluster/_vq.c: In function ‘__Pyx__ExceptionSave’:
    scipy/cluster/_vq.c:9728:19: error: ‘PyThreadState {aka struct _ts}’ has no member named ‘exc_type’
         *type = tstate->exc_type;
                       ^
    scipy/cluster/_vq.c:9729:20: error: ‘PyThreadState {aka struct _ts}’ has no member named ‘exc_value’
         *value = tstate->exc_value;
                        ^
    scipy/cluster/_vq.c:9730:17: error: ‘PyThreadState {aka struct _ts}’ has no member named ‘exc_traceback’
         *tb = tstate->exc_traceback;
```


This can be fixed by forcing `*.pyx` files to be recythonized.


---

Comment by jdemeyer created at 2018-07-03 17:39:32

Do you have to remove `cythonize.dat`? If so, document why.
----
New commits:


---

Comment by vklein created at 2018-07-03 20:09:07

from ​6df21c3 comment:

```
- Remove cythonize.dat file : That contains the hashcode
used to define if the *.pyx files has been modified
```


You mean in file `fix-scipy-0.19.1-for-python37.patch` ?


---

Comment by git created at 2018-07-04 07:24:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vklein created at 2018-07-04 07:25:32

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-07-22 10:42:37

If you really must remove `cythonize.dat`, I would do it with a `rm -f` instead of a patch. The problem with a patch is that it must be updated every time we upgrade scipy.


---

Comment by jdemeyer created at 2018-07-22 10:45:47

Maybe we should try #24766 first, that might also fix the issue.


---

Comment by vklein created at 2018-07-23 09:44:42

Replying to [comment:7 jdemeyer]:
> Maybe we should try #24766 first, that might also fix the issue.
Yes ! #24766 works.


---

Comment by jdemeyer created at 2018-07-23 10:37:20

Resolution: duplicate


---

Comment by jdemeyer created at 2018-07-23 10:37:20

Sorry for the wasted effort Vincent.


---

Comment by vklein created at 2018-07-23 13:03:47

No problem ! Upgrading is better than patching.
