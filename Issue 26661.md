# Issue 26661: Hashes of some Algebraic Field elements hang indefinitely

Issue created by migration from Trac.

Original creator: @BrentBaccala

Original creation time: 2018-12-14 21:45:47

Keywords: hash, algebraic field

The following code hangs on both Sage 7.5.1 and Sage 8.4:


```
R.<a> = QQ[]
NF.<b> = NumberField(4*a^7 + 27)
for hom in NF.embeddings(QQbar):
   print hash(hom(b))
```





---

Comment by @BrentBaccala created at 2018-12-17 21:31:04

Here's another test case that I constructed after drilling down through the code:


```
from sage.rings.qqbar import AlgebraicGenerator, ANRoot

R.<y> = QQ[]
gen = y^14 - 6*y^7 + 18
NF.<a> = NumberField(gen)

root1 = ANRoot(gen, CIF(NF.embeddings(QQbar)[0](a)))
root2 = ANRoot(gen, CIF(NF.embeddings(QQbar)[1](a)))

ag1 = AlgebraicGenerator(NF, root1)
ag2 = AlgebraicGenerator(NF, root2)

ag1.union(ag2)

```


Changing `gen` around produces different answers.  `gen = y^2+18` produces the answer I'd expect from `union`: a number field defined by y<sup>2</sup> + 18.  `gen = y^3+18` produces a number field defined by a sixth degree polynomial; `gen = y^7 + 18` produces a number field defined by a 42<sup>nd</sup> degree polynomial.

I guess the 14<sup>th</sup> degree polynomial leads to a calculation that takes excessively long, but I think it should be a very simple calculation if the two `AlgebraicGenerator`'s are from the same number field - it should just return that field, right?


---

Comment by @BrentBaccala created at 2018-12-18 00:53:03

Now that I've thought about it more, the number field might not be a splitting field, so it's more complicated than returning the same field.


---

Comment by @BrentBaccala created at 2018-12-18 22:46:13

I found some comments in the code suggesting that when approximations to algebraic numbers are computed, an attempt is made to use 40 extra bits of precision, but it doesn't seem like that every actually got done.

I made the obvious change to actually compute 40 extra bits, and it seems to have solved my problem.
----
New commits:


---

Comment by mmezzarobba created at 2018-12-19 08:57:05

Should the ticket be set to needs_review?


---

Comment by @BrentBaccala created at 2018-12-19 18:54:29

Replying to [comment:4 mmezzarobba]:
> Should the ticket be set to needs_review?

Yes, but I'm waiting for it to clear patchbot.


---

Comment by mmezzarobba created at 2018-12-19 19:18:59

Changing status from new to needs_review.


---

Comment by mmezzarobba created at 2018-12-19 19:18:59

Replying to [comment:5 gh-BrentBaccala]:
> Replying to [comment:4 mmezzarobba]:
> > Should the ticket be set to needs_review?
> 
> Yes, but I'm waiting for it to clear patchbot.

Unless you have your own patchbot with a special configuration, it (probably) won't even run the tests until the ticket needs_review.

But I've done it locally and all is well.


---

Comment by mmezzarobba created at 2018-12-19 19:19:12

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-12-23 23:39:44

Resolution: fixed


---

Comment by embray created at 2018-12-28 14:06:38

This tickets were closed as fixed after the Sage 8.5 release.
