# Issue 28504: Lattice Polytopes: `compute_facets` has its own definition of reflexive and applies it

Issue created by migration from https://trac.sagemath.org/ticket/28741

Original creator: @kliem

Original creation time: 2019-11-15 09:33:11

CC:  jipilab @laisrast novoselt

Keywords: lattice polytopes, reflexive

Currently, computing facets of a lattice polytope, changes whether it is reflexive or not.


```
sage: p = LatticePolytope([], lattice=ToricLattice(3).dual()); p
-1-d lattice polytope in 3-d lattice M
sage: a = p.faces()[0][0]
sage: p = LatticePolytope([], lattice=ToricLattice(3).dual()); p
-1-d lattice polytope in 3-d lattice M
sage: a = p.faces()[0][0]; a
-1-d lattice polytope in 3-d lattice M
sage: a.facet_normals()
Empty collection
in 3-d lattice N
sage: a
-1-d reflexive polytope in 3-d lattice M
```


We fix this by deleting a line in `compute_facets`, which applied a private definition of reflexivity to the polytope.


---

Comment by @kliem created at 2019-11-15 09:38:44

New commits:


---

Comment by @kliem created at 2019-11-15 09:38:44

Changing status from new to needs_review.


---

Comment by novoselt created at 2019-11-15 16:34:26

What do you mean its own definition??? It is the same definition as in other places and it does not overwrite ``is_reflexive`` but rather sets a cached value. However the code failed to check that the polytope is full-dimensional, so I'd much rather keep the old code and add the missing check rather than getting rid of an easy computation and triggering another one right away with `is_reflexive()` call.


---

Comment by @kliem created at 2019-11-15 18:00:07

Sorry. I was completely puzzled about this and exaggerated.

As you can probably tell, I stumbled open this trying to implement incidence matrix.

I still don't get the advantage of the current setup. Is it because we avoid making a copy of the constants?

What currently happens with `is_reflexive` is that it implicitly calls `compute_facets`, which computes the value for `is_reflexive`. However, `is_reflexive` now recomputes the value and returns it. I don't think this is ideal.


---

Comment by @kliem created at 2019-11-15 18:14:04

But my idea isn't perfect either.

It is still double calculation. Just executing the same code now.


---

Comment by @kliem created at 2019-11-15 19:33:08

Anyway. I don't have hard feelings about this. I think we can just fix it in place.


---

Comment by git created at 2019-11-15 19:37:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by novoselt created at 2019-11-15 19:50:01

Sorry for confusing code, believe me it used to be even more convoluted, especially with regard to determining and using reflexivity ;-) It still feels to me that this is a better fix.


---

Comment by novoselt created at 2019-11-15 19:50:01

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2019-11-19 08:26:36

Changing status from positive_review to needs_review.


---

Comment by @kliem created at 2019-11-19 08:26:36

Had to rebase.

This time I did not delete any trailing spaces etc. Implementing the incidence matrix in #28743 will take care of that.
----
New commits:


---

Comment by novoselt created at 2019-11-20 21:35:07

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-11-30 13:36:29

Resolution: fixed
