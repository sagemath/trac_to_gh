# Issue 26029: @interact is broken

Issue created by migration from https://trac.sagemath.org/ticket/26266

Original creator: zerline

Original creation time: 2018-09-13 08:01:42

CC:  embray

Keywords: jupyter interact

Jupyter output with version 8.4.beta4 on Python3 :


```
@interact(x=True, y=1.0)
def g(x, y):
    return (x, y)
----------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-6-72d2e695a5da> in <module>()
----> 1 @interact(x=True, y=RealNumber('1.0'))
      2 def g(x, y):
      3     return (x, y)

.../local/lib/python3.6/site-packages/ipywidgets/widgets/interaction.py in __call__(self, _InteractFactory__interact_f, **kwargs)
    521         #    def f(*args, **kwargs):
    522         #        ...
--> 523         w = self.widget(f)
    524         try:
    525             f.widget = w

.../local/lib/python3.6/site-packages/ipywidgets/widgets/interaction.py in widget(self, f)
    437             The function to which the interactive widgets are tied.
    438         """
--> 439         return self.cls(f, self.opts, **self.kwargs)
    440 
    441     def __call__(self, __interact_f=None, **kwargs):

.../local/lib/python3.6/site-packages/sage/repl/ipython_kernel/interact.py in __init__(*args, **kwds)
     89         # Check for auto_update in signature
     90         sig = signature(f)
---> 91         params = copy(sig.parameters)
     92         try:
     93             p_auto_update = params.pop("auto_update")

.../local/lib/python3.6/copy.py in copy(x)
     94         reductor = getattr(x, "__reduce_ex__", None)
     95         if reductor:
---> 96             rv = reductor(4)
     97         else:
     98             reductor = getattr(x, "__reduce__", None)

TypeError: can't pickle mappingproxy objects
```




---

Comment by embray created at 2018-09-13 10:03:23

Turns out I already have this fixed in my Python 3 branch; I just never pushed the fixes.


---

Comment by embray created at 2018-09-13 10:05:14

Set assignee to embray.


---

Comment by embray created at 2018-09-13 10:05:14

FWIW this is the patch I used


```diff
diff --git a/src/sage/repl/ipython_kernel/interact.py b/src/sage/repl/ipython_kernel/interact.py
index 9372426..d49af6f 100644
--- a/src/sage/repl/ipython_kernel/interact.py
+++ b/src/sage/repl/ipython_kernel/interact.py
@@ -35,8 +35,7 @@ EXAMPLES::

 from ipywidgets.widgets import SelectionSlider, ValueWidget, ToggleButtons
 from ipywidgets.widgets.interaction import interactive, signature
-from copy import copy
-from collections import Iterable, Iterator
+from collections import Iterable, Iterator, OrderedDict
 from .widgets import EvalText, SageColorPicker
 from sage.structure.element import parent
 from sage.symbolic.ring import SR
@@ -88,7 +87,7 @@ class sage_interactive(interactive):

         # Check for auto_update in signature
         sig = signature(f)
-        params = copy(sig.parameters)
+        params = OrderedDict(sig.parameters)
         try:
             p_auto_update = params.pop("auto_update")
         except KeyError:

```


I will make a branch in a bit unless you want to do it first.


---

Comment by zerline created at 2018-09-13 10:24:39

Thanks! Ok then. No hurry!


---

Comment by chapoton created at 2018-09-19 08:00:41

Changing status from new to needs_review.


---

Comment by git created at 2018-09-19 08:01:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-09-19 19:49:31

bot is morally green, please review


---

Comment by embray created at 2018-09-20 11:42:48

It would be best if zerline could confirm the fix.


---

Comment by chapoton created at 2018-10-02 09:40:55

`@`zerline, please have a look


---

Comment by zerline created at 2018-10-04 14:30:14

Replying to [comment:10 chapoton]:
> `@`zerline, please have a look

you're right `@`chapoton, I'll check this asap


---

Comment by zerline created at 2018-10-05 14:33:54

Yes, the fix works :)


---

Comment by zerline created at 2018-10-07 13:07:52

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2018-10-11 07:23:00

please add reviewer fullname


---

Comment by vbraun created at 2018-10-20 11:58:52

Resolution: fixed


---

Comment by embray created at 2018-10-28 14:52:23

This should be re-targeted for 8.5.
