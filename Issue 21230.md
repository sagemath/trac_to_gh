# Issue 21230: Multiplying Lie algebra weights should fail better

archive/issues_021230.json:
```json
{
    "body": "CC:  sage-combinat @nthiery\n\nKeywords: Lie algebra, weights\n\nI understand why this shouldn't work (the representation is `R(w)` rather than `w`) but it should at least fail in a more sensible way than entering an infinite loop:\n\n```\nsage: R = WeylCharacterRing(\"B3\")\nsage: w = R.fundamental_weights()[1]\nsage: w*w\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-3-93da721720b9> in <module>()\n----> 1 w*w\n\n/home/kedlaya/sage-complete/src/sage/categories/coercion_methods.pyx in sage.categories.coercion_methods.Modules__mul__ (/home/kedlaya/sage-complete/src/build/cythonized/sage/categories/coercion_methods.c:2540)()\n    117         Make a better unit test once ``Modules().example()`` is implemented.\n    118     \"\"\"\n--> 119     return coercion_model.bin_op(left, right, operator.mul)\n    120 \n    121 @cython.binding\n\n/home/kedlaya/sage-complete/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (/home/kedlaya/sage-complete/src/build/cythonized/sage/structure/coerce.c:8775)()\n   1029             yp = parent_c(y)\n   1030             if xp is yp:\n-> 1031                 return op(x,y)\n   1032             action = self.get_action(xp, yp, op, x, y)\n   1033             if action is not None:\n\n... last 2 frames repeated, from the frame below ...\n\n/home/kedlaya/sage-complete/src/sage/categories/coercion_methods.pyx in sage.categories.coercion_methods.Modules__mul__ (/home/kedlaya/sage-complete/src/build/cythonized/sage/categories/coercion_methods.c:2540)()\n    117         Make a better unit test once ``Modules().example()`` is implemented.\n    118     \"\"\"\n--> 119     return coercion_model.bin_op(left, right, operator.mul)\n    120 \n    121 @cython.binding\n\nRuntimeError: maximum recursion depth exceeded while calling a Python object\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/21467\n\n",
    "created_at": "2016-09-10T19:59:25Z",
    "labels": [
        "combinatorics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Multiplying Lie algebra weights should fail better",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21230",
    "user": "@kedlaya"
}
```
CC:  sage-combinat @nthiery

Keywords: Lie algebra, weights

I understand why this shouldn't work (the representation is `R(w)` rather than `w`) but it should at least fail in a more sensible way than entering an infinite loop:

```
sage: R = WeylCharacterRing("B3")
sage: w = R.fundamental_weights()[1]
sage: w*w
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-3-93da721720b9> in <module>()
----> 1 w*w

/home/kedlaya/sage-complete/src/sage/categories/coercion_methods.pyx in sage.categories.coercion_methods.Modules__mul__ (/home/kedlaya/sage-complete/src/build/cythonized/sage/categories/coercion_methods.c:2540)()
    117         Make a better unit test once ``Modules().example()`` is implemented.
    118     """
--> 119     return coercion_model.bin_op(left, right, operator.mul)
    120 
    121 @cython.binding

/home/kedlaya/sage-complete/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (/home/kedlaya/sage-complete/src/build/cythonized/sage/structure/coerce.c:8775)()
   1029             yp = parent_c(y)
   1030             if xp is yp:
-> 1031                 return op(x,y)
   1032             action = self.get_action(xp, yp, op, x, y)
   1033             if action is not None:

... last 2 frames repeated, from the frame below ...

/home/kedlaya/sage-complete/src/sage/categories/coercion_methods.pyx in sage.categories.coercion_methods.Modules__mul__ (/home/kedlaya/sage-complete/src/build/cythonized/sage/categories/coercion_methods.c:2540)()
    117         Make a better unit test once ``Modules().example()`` is implemented.
    118     """
--> 119     return coercion_model.bin_op(left, right, operator.mul)
    120 
    121 @cython.binding

RuntimeError: maximum recursion depth exceeded while calling a Python object
```


Issue created by migration from https://trac.sagemath.org/ticket/21467





---

archive/issue_comments_294368.json:
```json
{
    "body": "It comes from the combinatorial free module, but it should fail better. I've updated the description accordingly. This might be fixed by #20767 (I haven't checked).",
    "created_at": "2016-09-10T21:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21230#issuecomment-294368",
    "user": "@tscrim"
}
```

It comes from the combinatorial free module, but it should fail better. I've updated the description accordingly. This might be fixed by #20767 (I haven't checked).



---

archive/issue_comments_294369.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-13T12:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21230#issuecomment-294369",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_294370.json:
```json
{
    "body": "With #20767:\n\n```\nsage: C = CombinatorialFreeModule(ZZ, ['a','b','c'])\nsage: a = C.basis()['a']\nsage: a*a\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-3-55910a9f7205> in <module>()\n----> 1 a*a\n\n/usr/local/src/sage-config/src/sage/structure/element.pyx in sage.structure.element.Element.__mul__ (build/cythonized/sage/structure/element.c:11549)()\n   1486         cdef int cl = classify_elements(left, right)\n   1487         if HAVE_SAME_PARENT(cl):\n-> 1488             return (<Element>left)._mul_(right)\n   1489         if BOTH_ARE_ELEMENT(cl):\n   1490             return coercion_model.bin_op(left, right, mul)\n\n/usr/local/src/sage-config/src/sage/structure/element.pyx in sage.structure.element.Element._mul_ (build/cythonized/sage/structure/element.c:11925)()\n   1525             python_op = (<object>self)._mul_\n   1526         except AttributeError:\n-> 1527             raise bin_op_exception('*', self, other)\n   1528         else:\n   1529             return python_op(other)\n\nTypeError: unsupported operand parent(s) for '*': 'Free module generated by {'a', 'b', 'c'} over Integer Ring' and 'Free module generated by {'a', 'b', 'c'} over Integer Ring'\n```\n",
    "created_at": "2016-09-13T12:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21230#issuecomment-294370",
    "user": "@jdemeyer"
}
```

With #20767:

```
sage: C = CombinatorialFreeModule(ZZ, ['a','b','c'])
sage: a = C.basis()['a']
sage: a*a
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-3-55910a9f7205> in <module>()
----> 1 a*a

/usr/local/src/sage-config/src/sage/structure/element.pyx in sage.structure.element.Element.__mul__ (build/cythonized/sage/structure/element.c:11549)()
   1486         cdef int cl = classify_elements(left, right)
   1487         if HAVE_SAME_PARENT(cl):
-> 1488             return (<Element>left)._mul_(right)
   1489         if BOTH_ARE_ELEMENT(cl):
   1490             return coercion_model.bin_op(left, right, mul)

/usr/local/src/sage-config/src/sage/structure/element.pyx in sage.structure.element.Element._mul_ (build/cythonized/sage/structure/element.c:11925)()
   1525             python_op = (<object>self)._mul_
   1526         except AttributeError:
-> 1527             raise bin_op_exception('*', self, other)
   1528         else:
   1529             return python_op(other)

TypeError: unsupported operand parent(s) for '*': 'Free module generated by {'a', 'b', 'c'} over Integer Ring' and 'Free module generated by {'a', 'b', 'c'} over Integer Ring'
```




---

archive/issue_comments_294371.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-13T12:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21230#issuecomment-294371",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_294372.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2017-01-21T18:03:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21230",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21230#issuecomment-294372",
    "user": "@vbraun"
}
```

Resolution: invalid
