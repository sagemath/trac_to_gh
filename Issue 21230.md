# Issue 21230: Multiplying Lie algebra weights should fail better

Issue created by migration from https://trac.sagemath.org/ticket/21467

Original creator: kedlaya

Original creation time: 2016-09-10 19:59:25

CC:  sage-combinat nthiery

Keywords: Lie algebra, weights

I understand why this shouldn't work (the representation is `R(w)` rather than `w`) but it should at least fail in a more sensible way than entering an infinite loop:

```
sage: R = WeylCharacterRing("B3")
sage: w = R.fundamental_weights()[1]
sage: w*w
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-3-93da721720b9> in <module>()
----> 1 w*w

/home/kedlaya/sage-complete/src/sage/categories/coercion_methods.pyx in sage.categories.coercion_methods.Modules__mul__ (/home/kedlaya/sage-complete/src/build/cythonized/sage/categories/coercion_methods.c:2540)()
    117         Make a better unit test once ``Modules().example()`` is implemented.
    118     """
--> 119     return coercion_model.bin_op(left, right, operator.mul)
    120 
    121 @cython.binding

/home/kedlaya/sage-complete/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (/home/kedlaya/sage-complete/src/build/cythonized/sage/structure/coerce.c:8775)()
   1029             yp = parent_c(y)
   1030             if xp is yp:
-> 1031                 return op(x,y)
   1032             action = self.get_action(xp, yp, op, x, y)
   1033             if action is not None:

... last 2 frames repeated, from the frame below ...

/home/kedlaya/sage-complete/src/sage/categories/coercion_methods.pyx in sage.categories.coercion_methods.Modules__mul__ (/home/kedlaya/sage-complete/src/build/cythonized/sage/categories/coercion_methods.c:2540)()
    117         Make a better unit test once ``Modules().example()`` is implemented.
    118     """
--> 119     return coercion_model.bin_op(left, right, operator.mul)
    120 
    121 @cython.binding

RuntimeError: maximum recursion depth exceeded while calling a Python object
```



---

Comment by tscrim created at 2016-09-10 21:02:07

It comes from the combinatorial free module, but it should fail better. I've updated the description accordingly. This might be fixed by #20767 (I haven't checked).


---

Comment by jdemeyer created at 2016-09-13 12:41:22

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2016-09-13 12:41:22

With #20767:

```
sage: C = CombinatorialFreeModule(ZZ, ['a','b','c'])
sage: a = C.basis()['a']
sage: a*a
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-3-55910a9f7205> in <module>()
----> 1 a*a

/usr/local/src/sage-config/src/sage/structure/element.pyx in sage.structure.element.Element.__mul__ (build/cythonized/sage/structure/element.c:11549)()
   1486         cdef int cl = classify_elements(left, right)
   1487         if HAVE_SAME_PARENT(cl):
-> 1488             return (<Element>left)._mul_(right)
   1489         if BOTH_ARE_ELEMENT(cl):
   1490             return coercion_model.bin_op(left, right, mul)

/usr/local/src/sage-config/src/sage/structure/element.pyx in sage.structure.element.Element._mul_ (build/cythonized/sage/structure/element.c:11925)()
   1525             python_op = (<object>self)._mul_
   1526         except AttributeError:
-> 1527             raise bin_op_exception('*', self, other)
   1528         else:
   1529             return python_op(other)

TypeError: unsupported operand parent(s) for '*': 'Free module generated by {'a', 'b', 'c'} over Integer Ring' and 'Free module generated by {'a', 'b', 'c'} over Integer Ring'
```



---

Comment by jdemeyer created at 2016-09-13 12:41:30

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-01-21 18:03:11

Resolution: invalid
