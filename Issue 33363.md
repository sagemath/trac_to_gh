# Issue 33363: Configure mathjax in sphinx config  public/docs/mathjax_ext

archive/issues_033363.json:
```json
{
    "body": "CC:  klee strogdon schilly mkoeppe\n\nConfigure mathjax in sphinx config, and not in a javascript file. In this way, we can get ride of the custom theme option `mathjax_macros`, which is not understood by other themes. This is preparation to support the furo theme.\n\nIssue created by migration from https://trac.sagemath.org/ticket/33600\n\n",
    "created_at": "2022-03-30T12:43:48Z",
    "labels": [
        "documentation",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Configure mathjax in sphinx config  public/docs/mathjax_ext",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33363",
    "user": "@tobiasdiez"
}
```
CC:  klee strogdon schilly mkoeppe

Configure mathjax in sphinx config, and not in a javascript file. In this way, we can get ride of the custom theme option `mathjax_macros`, which is not understood by other themes. This is preparation to support the furo theme.

Issue created by migration from https://trac.sagemath.org/ticket/33600





---

archive/issue_comments_475008.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-30T13:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475008",
    "user": "@tobiasdiez"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_475009.json:
```json
{
    "body": "This seems to do the job for me. With the disclaimer that I could only test the tutorial and dev guide, since \"reference\" fails with a lot of errors on gitpod. Among them\n\n```\n[tensor_fr] Extension error (matplotlib.sphinxext.plot_directive):\n[tensor_fr] Handler <function _copy_css_file at 0x7f47e225b4c0> for event 'build-finished' threw an exception (exception: [Errno 17] File exists: '/home/gitpod/sage-local/share/doc/sage/html/en/reference/tensor_free_modules/_static')\n```\n",
    "created_at": "2022-03-30T13:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475009",
    "user": "@tobiasdiez"
}
```

This seems to do the job for me. With the disclaimer that I could only test the tutorial and dev guide, since "reference" fails with a lot of errors on gitpod. Among them

```
[tensor_fr] Extension error (matplotlib.sphinxext.plot_directive):
[tensor_fr] Handler <function _copy_css_file at 0x7f47e225b4c0> for event 'build-finished' threw an exception (exception: [Errno 17] File exists: '/home/gitpod/sage-local/share/doc/sage/html/en/reference/tensor_free_modules/_static')
```




---

archive/issue_comments_475010.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-30T13:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475010",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475011.json:
```json
{
    "body": "See #30296 and references within for previous efforts / discussion regarding mathjax 3",
    "created_at": "2022-03-30T16:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475011",
    "user": "mkoeppe"
}
```

See #30296 and references within for previous efforts / discussion regarding mathjax 3



---

archive/issue_comments_475012.json:
```json
{
    "body": "Thanks for the pointer. It seems the issues discussed in that ticket revolve around packaging problems. I circumvent these here by using the CDN.",
    "created_at": "2022-03-30T18:41:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475012",
    "user": "@tobiasdiez"
}
```

Thanks for the pointer. It seems the issues discussed in that ticket revolve around packaging problems. I circumvent these here by using the CDN.



---

archive/issue_comments_475013.json:
```json
{
    "body": "I would expect that people want to keep an offline version without using the CDN.",
    "created_at": "2022-03-30T23:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475013",
    "user": "mkoeppe"
}
```

I would expect that people want to keep an offline version without using the CDN.



---

archive/issue_comments_475014.json:
```json
{
    "body": "Replying to [comment:5 gh-tobiasdiez]:\n> It seems the issues discussed in that ticket revolve around packaging problems.\n\nOne of the \"references within\" is #25833 for the upgrade to 3.x. \nIt would be important to know whether #25833#comment:9 is still current, and whether it is relevant for our use of Sphinx.",
    "created_at": "2022-03-31T01:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475014",
    "user": "mkoeppe"
}
```

Replying to [comment:5 gh-tobiasdiez]:
> It seems the issues discussed in that ticket revolve around packaging problems.

One of the "references within" is #25833 for the upgrade to 3.x. 
It would be important to know whether #25833#comment:9 is still current, and whether it is relevant for our use of Sphinx.



---

archive/issue_comments_475015.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2022-03-31T01:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475015",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_475016.json:
```json
{
    "body": "Replying to [comment:7 mkoeppe]:\n> One of the \"references within\" is #25833 for the upgrade to 3.x. \n> It would be important to know whether #25833#comment:9 is still current, and whether it is relevant for our use of Sphinx.\n\nThat feature (not compatible with latex) of mathjax2 would be relevant only in online use of mathjax, such as in jupyter notebook. \n\nAs far as I know, that \"automatic line breaking\" is not used in our documentation. If there is any, then that is something to be fixed.\n\nFor us, there is no reason not to upgrade to mathjax3.",
    "created_at": "2022-03-31T05:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475016",
    "user": "klee"
}
```

Replying to [comment:7 mkoeppe]:
> One of the "references within" is #25833 for the upgrade to 3.x. 
> It would be important to know whether #25833#comment:9 is still current, and whether it is relevant for our use of Sphinx.

That feature (not compatible with latex) of mathjax2 would be relevant only in online use of mathjax, such as in jupyter notebook. 

As far as I know, that "automatic line breaking" is not used in our documentation. If there is any, then that is something to be fixed.

For us, there is no reason not to upgrade to mathjax3.



---

archive/issue_comments_475017.json:
```json
{
    "body": "Sage cell has moved to mathjax3 (relatively) long time ago. It may be worth while to check the mathjax3 configuration used in sage cell:\n\nhttps://github.com/sagemath/sagecell/blob/master/js/cell.js",
    "created_at": "2022-03-31T05:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475017",
    "user": "klee"
}
```

Sage cell has moved to mathjax3 (relatively) long time ago. It may be worth while to check the mathjax3 configuration used in sage cell:

https://github.com/sagemath/sagecell/blob/master/js/cell.js



---

archive/issue_comments_475018.json:
```json
{
    "body": "You converted single quotes to double quotes. Single quotes are conventionally used for strings containing code (not plain English). You should not change them without compelling reasons.",
    "created_at": "2022-03-31T05:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475018",
    "user": "klee"
}
```

You converted single quotes to double quotes. Single quotes are conventionally used for strings containing code (not plain English). You should not change them without compelling reasons.



---

archive/issue_comments_475019.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2022-03-31T08:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475019",
    "user": "@tobiasdiez"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_475020.json:
```json
{
    "body": "Replying to [comment:8 klee]:\n> Replying to [comment:7 mkoeppe]:\n> > One of the \"references within\" is #25833 for the upgrade to 3.x. \n> > It would be important to know whether #25833#comment:9 is still current, and whether it is relevant for our use of Sphinx.\n> \n> That feature (not compatible with latex) of mathjax2 would be relevant only in online use of mathjax, such as in jupyter notebook. \n> \n> As far as I know, that \"automatic line breaking\" is not used in our documentation. If there is any, then that is something to be fixed.\n> \n> For us, there is no reason not to upgrade to mathjax3.\n\nThanks for the clarification!",
    "created_at": "2022-03-31T08:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475020",
    "user": "@tobiasdiez"
}
```

Replying to [comment:8 klee]:
> Replying to [comment:7 mkoeppe]:
> > One of the "references within" is #25833 for the upgrade to 3.x. 
> > It would be important to know whether #25833#comment:9 is still current, and whether it is relevant for our use of Sphinx.
> 
> That feature (not compatible with latex) of mathjax2 would be relevant only in online use of mathjax, such as in jupyter notebook. 
> 
> As far as I know, that "automatic line breaking" is not used in our documentation. If there is any, then that is something to be fixed.
> 
> For us, there is no reason not to upgrade to mathjax3.

Thanks for the clarification!



---

archive/issue_comments_475021.json:
```json
{
    "body": "Replying to [comment:10 klee]:\n> You converted single quotes to double quotes. Single quotes are conventionally used for strings containing code (not plain English). You should not change them without compelling reasons. \n\nI wasn't aware that such a styleguide rule exists. The existing code in both files doesn't seem to follow it either - it's just a random mix of single and double quotes. I tried to make at least the lines homogeneous that I've touched.",
    "created_at": "2022-03-31T08:37:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475021",
    "user": "@tobiasdiez"
}
```

Replying to [comment:10 klee]:
> You converted single quotes to double quotes. Single quotes are conventionally used for strings containing code (not plain English). You should not change them without compelling reasons. 

I wasn't aware that such a styleguide rule exists. The existing code in both files doesn't seem to follow it either - it's just a random mix of single and double quotes. I tried to make at least the lines homogeneous that I've touched.



---

archive/issue_comments_475022.json:
```json
{
    "body": "Replying to [comment:12 gh-tobiasdiez]:\n> Replying to [comment:10 klee]:\n> > You converted single quotes to double quotes. Single quotes are conventionally used for strings containing code (not plain English). You should not change them without compelling reasons. \n> \n> I wasn't aware that such a style guide rule exists. \n\nI must say it's not a rule. But single quotes are commonly used for code strings.\n\n> The existing code in both files doesn't seem to follow it either - it's just a random mix of single and double quotes. I tried to make at least the lines homogeneous that I've touched.\n\nLeaving single-quoted strings as they are will contribute overall homogeneity of the sage code base.",
    "created_at": "2022-03-31T10:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475022",
    "user": "klee"
}
```

Replying to [comment:12 gh-tobiasdiez]:
> Replying to [comment:10 klee]:
> > You converted single quotes to double quotes. Single quotes are conventionally used for strings containing code (not plain English). You should not change them without compelling reasons. 
> 
> I wasn't aware that such a style guide rule exists. 

I must say it's not a rule. But single quotes are commonly used for code strings.

> The existing code in both files doesn't seem to follow it either - it's just a random mix of single and double quotes. I tried to make at least the lines homogeneous that I've touched.

Leaving single-quoted strings as they are will contribute overall homogeneity of the sage code base.



---

archive/issue_comments_475023.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-31T11:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475023",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475024.json:
```json
{
    "body": "Replying to [comment:13 klee]:\n> Leaving single-quoted strings as they are will contribute overall homogeneity of the sage code base. \n\nSadly there is not much of a homogeneity. For example, latex-macros.py contains\n\n```python\n    args = \"(\"\n    for x in sample_args:\n        count += 1\n        args += str(x) + ','\n    args += ')'\n```\n\n\nAnyway, I've reverted these changes.",
    "created_at": "2022-03-31T11:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475024",
    "user": "@tobiasdiez"
}
```

Replying to [comment:13 klee]:
> Leaving single-quoted strings as they are will contribute overall homogeneity of the sage code base. 

Sadly there is not much of a homogeneity. For example, latex-macros.py contains

```python
    args = "("
    for x in sample_args:
        count += 1
        args += str(x) + ','
    args += ')'
```


Anyway, I've reverted these changes.



---

archive/issue_comments_475025.json:
```json
{
    "body": "Replying to [comment:15 gh-tobiasdiez]:\n> Sadly there is not much of a homogeneity. For example, latex-macros.py contains\n> {{{#!python\n>     args = \"(\"\n>     for x in sample_args:\n>         count += 1\n>         args += str(x) + ','\n>     args += ')'\n> }}}\n\nWell.. that is embarrassing.\n\n> Anyway, I've reverted these changes.\n\nThank you.",
    "created_at": "2022-03-31T12:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475025",
    "user": "klee"
}
```

Replying to [comment:15 gh-tobiasdiez]:
> Sadly there is not much of a homogeneity. For example, latex-macros.py contains
> {{{#!python
>     args = "("
>     for x in sample_args:
>         count += 1
>         args += str(x) + ','
>     args += ')'
> }}}

Well.. that is embarrassing.

> Anyway, I've reverted these changes.

Thank you.



---

archive/issue_comments_475026.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-04-05T00:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475026",
    "user": "klee"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_475027.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-05T14:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475027",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475028.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-04-05T14:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475028",
    "user": "@tobiasdiez"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_475029.json:
```json
{
    "body": "comment:6?",
    "created_at": "2022-04-05T18:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475029",
    "user": "mkoeppe"
}
```

comment:6?



---

archive/issue_comments_475030.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-06T01:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475030",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475031.json:
```json
{
    "body": "Attachment [screen-shot.png](tarball://root/attachments/some-uuid/ticket33600/screen-shot.png) by klee created at 2022-04-06 01:34:32",
    "created_at": "2022-04-06T01:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475031",
    "user": "klee"
}
```

Attachment [screen-shot.png](tarball://root/attachments/some-uuid/ticket33600/screen-shot.png) by klee created at 2022-04-06 01:34:32



---

archive/issue_comments_475032.json:
```json
{
    "body": "My commit contains minor edits. I removed the comment to 'sphinx.ext.mathjax', which seems unnecessary only cluttering code.\n\nOtherwise all looks good to me. But as Matthias points out, this ticket needs to ship MathJax3 for offline users.\n\nI noticed a glitch in `local/share/doc/sage/html/en/index.html`:\n\n![](screen-shot.png)\n\nbut this seems a bug of MathJax3, hopefully temporary.",
    "created_at": "2022-04-06T01:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475032",
    "user": "klee"
}
```

My commit contains minor edits. I removed the comment to 'sphinx.ext.mathjax', which seems unnecessary only cluttering code.

Otherwise all looks good to me. But as Matthias points out, this ticket needs to ship MathJax3 for offline users.

I noticed a glitch in `local/share/doc/sage/html/en/index.html`:

![](screen-shot.png)

but this seems a bug of MathJax3, hopefully temporary.



---

archive/issue_comments_475033.json:
```json
{
    "body": "A question: \n\nmathjax2 config `theme_mathjax_macros` is missing in the new mathjax3 config. Is this never used in sage documentation?",
    "created_at": "2022-04-06T01:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475033",
    "user": "klee"
}
```

A question: 

mathjax2 config `theme_mathjax_macros` is missing in the new mathjax3 config. Is this never used in sage documentation?



---

archive/issue_comments_475034.json:
```json
{
    "body": "Are these \n\n- Remove ignoreHtmlClass/processHtmlClass since they are set to the default values.\n- Remove noerrors extension, which hides error messages. ...\n\ntrue? I don't see them in the code before the patch.",
    "created_at": "2022-04-06T01:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475034",
    "user": "klee"
}
```

Are these 

- Remove ignoreHtmlClass/processHtmlClass since they are set to the default values.
- Remove noerrors extension, which hides error messages. ...

true? I don't see them in the code before the patch.



---

archive/issue_comments_475035.json:
```json
{
    "body": "Replying to [comment:6 mkoeppe]:\n> I would expect that people want to keep an offline version without using the CDN.\n\nIsn't the pdf enough for offline documentation? And if you really need the html docs offline, you can also save them from the browser.\n\nWe can of course download the js file from the cdn and ship it, but that would make the experience for other people less nice since you don't get all the advantages that a central cdn gives you.",
    "created_at": "2022-04-06T19:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475035",
    "user": "@tobiasdiez"
}
```

Replying to [comment:6 mkoeppe]:
> I would expect that people want to keep an offline version without using the CDN.

Isn't the pdf enough for offline documentation? And if you really need the html docs offline, you can also save them from the browser.

We can of course download the js file from the cdn and ship it, but that would make the experience for other people less nice since you don't get all the advantages that a central cdn gives you.



---

archive/issue_comments_475036.json:
```json
{
    "body": "Replying to [comment:22 klee]:\n> My commit contains minor edits. I removed the comment to 'sphinx.ext.mathjax', which seems unnecessary only cluttering code.\n\nDid you forget to push it? Or at least I cannot see your commit.",
    "created_at": "2022-04-06T19:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475036",
    "user": "@tobiasdiez"
}
```

Replying to [comment:22 klee]:
> My commit contains minor edits. I removed the comment to 'sphinx.ext.mathjax', which seems unnecessary only cluttering code.

Did you forget to push it? Or at least I cannot see your commit.



---

archive/issue_comments_475037.json:
```json
{
    "body": "Replying to [comment:23 klee]:\n> A question: \n> \n> mathjax2 config `theme_mathjax_macros` is missing in the new mathjax3 config. Is this never used in sage documentation?\n\nThis was only used to inject the mathjax macros into the `mathjax_sage.js_t` file. Now the macros are directly defined via the new `mathjax3_config` in `docs/conf.py`.\n`",
    "created_at": "2022-04-06T20:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475037",
    "user": "@tobiasdiez"
}
```

Replying to [comment:23 klee]:
> A question: 
> 
> mathjax2 config `theme_mathjax_macros` is missing in the new mathjax3 config. Is this never used in sage documentation?

This was only used to inject the mathjax macros into the `mathjax_sage.js_t` file. Now the macros are directly defined via the new `mathjax3_config` in `docs/conf.py`.
`



---

archive/issue_comments_475038.json:
```json
{
    "body": "Replying to [comment:24 klee]:\n> Are these \n> \n> - Remove ignoreHtmlClass/processHtmlClass since they are set to the default values.\n> - Remove noerrors extension, which hides error messages. ...\n> \n> true? I don't see them in the code before the patch.\n\nI've used the config migration tool https://mathjax.github.io/MathJax-demos-web/convert-configuration/convert-configuration.html, which then output these config options. They might be implicitly defined in the old `config=TeX-AMS_HTML-full`, or it just might be bug in the migration tool.",
    "created_at": "2022-04-06T20:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475038",
    "user": "@tobiasdiez"
}
```

Replying to [comment:24 klee]:
> Are these 
> 
> - Remove ignoreHtmlClass/processHtmlClass since they are set to the default values.
> - Remove noerrors extension, which hides error messages. ...
> 
> true? I don't see them in the code before the patch.

I've used the config migration tool https://mathjax.github.io/MathJax-demos-web/convert-configuration/convert-configuration.html, which then output these config options. They might be implicitly defined in the old `config=TeX-AMS_HTML-full`, or it just might be bug in the migration tool.



---

archive/issue_comments_475039.json:
```json
{
    "body": "Replying to [comment:28 gh-tobiasdiez]:\n> Replying to [comment:24 klee]:\n> > Are these \n> > \n> > - Remove ignoreHtmlClass/processHtmlClass since they are set to the default values.\n> > - Remove noerrors extension, which hides error messages. ...\n> > \n> > true? I don't see them in the code before the patch.\n> \n> I've used the config migration tool https://mathjax.github.io/MathJax-demos-web/convert-configuration/convert-configuration.html, which then output these config options. They might be implicitly defined in the old `config=TeX-AMS_HTML-full`, or it just might be bug in the migration tool.\n\nIf the messages are merely suggesting you to make those changes and you didn't do the manual changes, then the messages copied to the ticket description are just confusing.",
    "created_at": "2022-04-06T21:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475039",
    "user": "klee"
}
```

Replying to [comment:28 gh-tobiasdiez]:
> Replying to [comment:24 klee]:
> > Are these 
> > 
> > - Remove ignoreHtmlClass/processHtmlClass since they are set to the default values.
> > - Remove noerrors extension, which hides error messages. ...
> > 
> > true? I don't see them in the code before the patch.
> 
> I've used the config migration tool https://mathjax.github.io/MathJax-demos-web/convert-configuration/convert-configuration.html, which then output these config options. They might be implicitly defined in the old `config=TeX-AMS_HTML-full`, or it just might be bug in the migration tool.

If the messages are merely suggesting you to make those changes and you didn't do the manual changes, then the messages copied to the ticket description are just confusing.



---

archive/issue_comments_475040.json:
```json
{
    "body": "Replying to [comment:27 gh-tobiasdiez]:\n> Replying to [comment:23 klee]:\n> > A question: \n> > \n> > mathjax2 config `theme_mathjax_macros` is missing in the new mathjax3 config. Is this never used in sage documentation?\n> \n> This was only used to inject the mathjax macros into the `mathjax_sage.js_t` file. Now the macros are directly defined via the new `mathjax3_config` in `docs/conf.py`.\n\nIf it was really used, then it is defined somewhere, and now it must be deleted in you branch. But I don't see them...",
    "created_at": "2022-04-06T21:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475040",
    "user": "klee"
}
```

Replying to [comment:27 gh-tobiasdiez]:
> Replying to [comment:23 klee]:
> > A question: 
> > 
> > mathjax2 config `theme_mathjax_macros` is missing in the new mathjax3 config. Is this never used in sage documentation?
> 
> This was only used to inject the mathjax macros into the `mathjax_sage.js_t` file. Now the macros are directly defined via the new `mathjax3_config` in `docs/conf.py`.

If it was really used, then it is defined somewhere, and now it must be deleted in you branch. But I don't see them...



---

archive/issue_comments_475041.json:
```json
{
    "body": "Replying to [comment:26 gh-tobiasdiez]:\n> Replying to [comment:22 klee]:\n> > My commit contains minor edits. I removed the comment to 'sphinx.ext.mathjax', which seems unnecessary only cluttering code.\n> \n> Did you forget to push it? Or at least I cannot see your commit.\n\nIt is in comment:21.",
    "created_at": "2022-04-06T21:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475041",
    "user": "klee"
}
```

Replying to [comment:26 gh-tobiasdiez]:
> Replying to [comment:22 klee]:
> > My commit contains minor edits. I removed the comment to 'sphinx.ext.mathjax', which seems unnecessary only cluttering code.
> 
> Did you forget to push it? Or at least I cannot see your commit.

It is in comment:21.



---

archive/issue_comments_475042.json:
```json
{
    "body": "Replying to [comment:25 gh-tobiasdiez]:\n> We can of course download the js file from the cdn and ship it, but that would make the experience for other people less nice since you don't get all the advantages that a central cdn gives you.\n\nIt seems we need `./configure --offline-doc` or something.",
    "created_at": "2022-04-06T21:56:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475042",
    "user": "klee"
}
```

Replying to [comment:25 gh-tobiasdiez]:
> We can of course download the js file from the cdn and ship it, but that would make the experience for other people less nice since you don't get all the advantages that a central cdn gives you.

It seems we need `./configure --offline-doc` or something.



---

archive/issue_comments_475043.json:
```json
{
    "body": "See #25833.",
    "created_at": "2022-04-07T05:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475043",
    "user": "klee"
}
```

See #25833.



---

archive/issue_comments_475044.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-07T07:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475044",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475045.json:
```json
{
    "body": "Now the branch at #25833 is merged.\n\nPresently the default is offline mathjax3, to experiment. When everything is okay, we should decide what should be the default.",
    "created_at": "2022-04-07T07:58:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475045",
    "user": "klee"
}
```

Now the branch at #25833 is merged.

Presently the default is offline mathjax3, to experiment. When everything is okay, we should decide what should be the default.



---

archive/issue_comments_475046.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-07T08:08:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475046",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475047.json:
```json
{
    "body": "Replying to [comment:37 klee]:\n> Now the branch at #25833 is merged.\n> \n> Presently the default is offline mathjax3, to experiment. When everything is okay, we should decide what should be the default.\n\nThanks for your work on this!",
    "created_at": "2022-04-07T16:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475047",
    "user": "@tobiasdiez"
}
```

Replying to [comment:37 klee]:
> Now the branch at #25833 is merged.
> 
> Presently the default is offline mathjax3, to experiment. When everything is okay, we should decide what should be the default.

Thanks for your work on this!



---

archive/issue_comments_475048.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-08T01:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475048",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475049.json:
```json
{
    "body": "I think that offline sage documentation should be the default as it has been. So I renamed the config variable to `--use-cdns`. If we change the default to \"online\" in the future, then we can just turn on `--use-cdns`.",
    "created_at": "2022-04-08T01:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475049",
    "user": "klee"
}
```

I think that offline sage documentation should be the default as it has been. So I renamed the config variable to `--use-cdns`. If we change the default to "online" in the future, then we can just turn on `--use-cdns`.



---

archive/issue_comments_475050.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-08T01:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475050",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475051.json:
```json
{
    "body": "To build doc with mathjax cdn, we only need\n\n```diff\ndiff --git a/src/doc/Makefile b/src/doc/Makefile\nindex 90bea5dfac..82134ea3b4 100644\n--- a/src/doc/Makefile\n+++ b/src/doc/Makefile\n@@ -21,7 +21,7 @@ doc-inventory--%:\n \n # Matches doc-html--developer, doc-html--reference-manifolds etc.\n doc-html--%:\n-       cd $(SAGE_ROOT) && ./sage --docbuild --no-pdf-links $(subst -,/,$(subst doc-html--,,$@)) html $(SAGE_DOCBUILD_OPTS)\n+       cd $(SAGE_ROOT) && ./sage --docbuild --use-cdns --no-pdf-links $(subst -,/,$(subst doc-html--,,$@)) html $(SAGE_DOCBUILD_OPTS)\n \n # reference manual, inventory\n ifndef SAGE_ROOT\n```\n\n\nSo `./configure --online-doc` would do the above.",
    "created_at": "2022-04-08T02:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475051",
    "user": "klee"
}
```

To build doc with mathjax cdn, we only need

```diff
diff --git a/src/doc/Makefile b/src/doc/Makefile
index 90bea5dfac..82134ea3b4 100644
--- a/src/doc/Makefile
+++ b/src/doc/Makefile
@@ -21,7 +21,7 @@ doc-inventory--%:
 
 # Matches doc-html--developer, doc-html--reference-manifolds etc.
 doc-html--%:
-       cd $(SAGE_ROOT) && ./sage --docbuild --no-pdf-links $(subst -,/,$(subst doc-html--,,$@)) html $(SAGE_DOCBUILD_OPTS)
+       cd $(SAGE_ROOT) && ./sage --docbuild --use-cdns --no-pdf-links $(subst -,/,$(subst doc-html--,,$@)) html $(SAGE_DOCBUILD_OPTS)
 
 # reference manual, inventory
 ifndef SAGE_ROOT
```


So `./configure --online-doc` would do the above.



---

archive/issue_comments_475052.json:
```json
{
    "body": "Any reason `os.path.join(SAGE_SHARE, 'mathjax3')` is hardcoded in `docs/conf.py` instead of using the `MATHJAX_DIR` defined in `env.py`?",
    "created_at": "2022-04-08T06:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475052",
    "user": "arojas"
}
```

Any reason `os.path.join(SAGE_SHARE, 'mathjax3')` is hardcoded in `docs/conf.py` instead of using the `MATHJAX_DIR` defined in `env.py`?



---

archive/issue_comments_475053.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-08T06:12:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475053",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475054.json:
```json
{
    "body": "Replying to [comment:45 arojas]:\n> Any reason `os.path.join(SAGE_SHARE, 'mathjax3')` is hardcoded in `docs/conf.py` instead of using the `MATHJAX_DIR` defined in `env.py`?\n\nNo. You are right. Thanks.",
    "created_at": "2022-04-08T06:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475054",
    "user": "klee"
}
```

Replying to [comment:45 arojas]:
> Any reason `os.path.join(SAGE_SHARE, 'mathjax3')` is hardcoded in `docs/conf.py` instead of using the `MATHJAX_DIR` defined in `env.py`?

No. You are right. Thanks.



---

archive/issue_comments_475055.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-08T12:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475055",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475056.json:
```json
{
    "body": "Should we merge this ticket with #25833, since you replace the mathjax 2 package there, so one probably should upgrade the config in one go as well. What do you think?",
    "created_at": "2022-04-08T18:31:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475056",
    "user": "@tobiasdiez"
}
```

Should we merge this ticket with #25833, since you replace the mathjax 2 package there, so one probably should upgrade the config in one go as well. What do you think?



---

archive/issue_comments_475057.json:
```json
{
    "body": "Replying to [comment:42 klee]:\n> I think that offline sage documentation should be the default as it has been. So I renamed the config variable to `--use-cdns`. If we change the default to \"online\" in the future, then we can just turn on `--use-cdns`.\n\nI'm not sure what should be the default for developers (but I guess everyone has internet if they contribute to trac...so I guess cdn would make sense), but the server should use the cdn to increase the speed or not? Comparing the loading times from the cdn vs sage's server, the cdn is a factor 10 quicker (13 ms vs 140ms).",
    "created_at": "2022-04-08T19:29:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475057",
    "user": "@tobiasdiez"
}
```

Replying to [comment:42 klee]:
> I think that offline sage documentation should be the default as it has been. So I renamed the config variable to `--use-cdns`. If we change the default to "online" in the future, then we can just turn on `--use-cdns`.

I'm not sure what should be the default for developers (but I guess everyone has internet if they contribute to trac...so I guess cdn would make sense), but the server should use the cdn to increase the speed or not? Comparing the loading times from the cdn vs sage's server, the cdn is a factor 10 quicker (13 ms vs 140ms).



---

archive/issue_comments_475058.json:
```json
{
    "body": "Replying to [comment:49 gh-tobiasdiez]:\n> Should we merge this ticket with #25833, since you replace the mathjax 2 package there, so one probably should upgrade the config in one go as well. What do you think?\n\nI agree. Let's do it. I will upload the branch of this ticket to #25833.",
    "created_at": "2022-04-08T23:42:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475058",
    "user": "klee"
}
```

Replying to [comment:49 gh-tobiasdiez]:
> Should we merge this ticket with #25833, since you replace the mathjax 2 package there, so one probably should upgrade the config in one go as well. What do you think?

I agree. Let's do it. I will upload the branch of this ticket to #25833.



---

archive/issue_comments_475059.json:
```json
{
    "body": "Replying to [comment:50 gh-tobiasdiez]:\n> Replying to [comment:42 klee]:\n> > I think that offline sage documentation should be the default as it has been. So I renamed the config variable to `--use-cdns`. If we change the default to \"online\" in the future, then we can just turn on `--use-cdns`.\n> \n> I'm not sure what should be the default for developers (but I guess everyone has internet if they contribute to trac...so I guess cdn would make sense), but the server should use the cdn to increase the speed or not? Comparing the loading times from the cdn vs sage's server, the cdn is a factor 10 quicker (13 ms vs 140ms).\n\nThe default is aimed at sage users with lowest resources.\n\nI think we need to provide `./configure --online-doc` option so that everyone can choose what he/she wants. Developers would of course have internet resource usually, but sometimes not (on airplane :). Personally I would prefer offline-doc.",
    "created_at": "2022-04-08T23:49:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475059",
    "user": "klee"
}
```

Replying to [comment:50 gh-tobiasdiez]:
> Replying to [comment:42 klee]:
> > I think that offline sage documentation should be the default as it has been. So I renamed the config variable to `--use-cdns`. If we change the default to "online" in the future, then we can just turn on `--use-cdns`.
> 
> I'm not sure what should be the default for developers (but I guess everyone has internet if they contribute to trac...so I guess cdn would make sense), but the server should use the cdn to increase the speed or not? Comparing the loading times from the cdn vs sage's server, the cdn is a factor 10 quicker (13 ms vs 140ms).

The default is aimed at sage users with lowest resources.

I think we need to provide `./configure --online-doc` option so that everyone can choose what he/she wants. Developers would of course have internet resource usually, but sometimes not (on airplane :). Personally I would prefer offline-doc.



---

archive/issue_comments_475060.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-04-08T23:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475060",
    "user": "klee"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_475061.json:
```json
{
    "body": "Replying to [comment:52 klee]:\n> I think we need to provide `./configure --online-doc` option so that everyone can choose what he/she wants. \n\nNo. We already have `SAGE_DOCBUILD_OPTS` environment variable. So we can\n\n```\nexport SAGE_DOCBUILD_OPTS=\"--use-cdns\"\n```\n\nbefore `make`.",
    "created_at": "2022-04-09T11:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475061",
    "user": "klee"
}
```

Replying to [comment:52 klee]:
> I think we need to provide `./configure --online-doc` option so that everyone can choose what he/she wants. 

No. We already have `SAGE_DOCBUILD_OPTS` environment variable. So we can

```
export SAGE_DOCBUILD_OPTS="--use-cdns"
```

before `make`.



---

archive/issue_comments_475062.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-04-09T19:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475062",
    "user": "@tobiasdiez"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_475063.json:
```json
{
    "body": "Replying to [comment:55 gh-tobiasdiez]:\n\nhttps://doc.sagemath.org/html/en/developer/trac.html#reviewing-and-closing-tickets\n\nOkay. Let's close this.",
    "created_at": "2022-04-09T23:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475063",
    "user": "klee"
}
```

Replying to [comment:55 gh-tobiasdiez]:

https://doc.sagemath.org/html/en/developer/trac.html#reviewing-and-closing-tickets

Okay. Let's close this.



---

archive/issue_comments_475064.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2022-05-11T02:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33363",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33363#issuecomment-475064",
    "user": "mkoeppe"
}
```

Resolution: invalid
