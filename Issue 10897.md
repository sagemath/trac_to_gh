# Issue 10897: computing order of a certain subgroup of a permutation group is double dog slow (compared to Magma)

Issue created by migration from Trac.

Original creator: was

Original creation time: 2011-03-21 21:17:24

Assignee: joyner


```
--- sage
def foo(n):
 G = SymmetricGroup(n)
 H = G.stabilizer(n//2)
 return H.order()

time n = foo(200)  // approx 399 seconds

--- magma
n foo(n)
 G := Sym(n);
 H := Stabiliser(G,n div 2);
 return Order(H);
end function;

time n := foo(200);  // approx 0.40 seconds
```


See also trac #10891 which is all about the underlying algorithms and ideas related to this problem.


---

Comment by was created at 2011-08-24 23:41:38

Changing keywords from "" to "sd32".


---

Comment by swenson created at 2012-01-22 19:32:16

I have a workaround I am testing for this (patch coming soon) that recognizes some subgroups of permutation groups (including stabilizer subgroups of the symmetric group), and can compute the order very quickly (~600 microseconds).  The running time of foo(200) above is still about a second, because GAP takes that long to construct the stabilizer group and give us back the generators.

In the future, I can add some more cases, or try to develop a more general theory for quickly computing these group orders (the special case I added is based on a argument from graph theory).


```
sage: def foo(n):
....:     G = SymmetricGroup(n)
....:     H = G.stabilizer(n//2)
....:     return H.order()
....: 
sage: %timeit foo(200)
5 loops, best of 3: 935 ms per loop
```



---

Comment by swenson created at 2012-01-22 19:32:16

Changing assignee from joyner to swenson.


---

Comment by swenson created at 2012-02-07 00:20:29

Changing status from new to needs_review.


---

Comment by swenson created at 2012-02-07 00:20:29

Patch uploaded. Can I get someone to look it over?


---

Comment by novoselt created at 2012-02-07 03:05:16

The format of the patch is not standard (not made by Sage's Mercurial).

It is also the first time I see 

```
Copyright 2012 Google Inc. All Rights Reserved.
```

and I am not sure if that's OK. Traditionally people who edit the file add themselves there, but "all rights reserved" is a bit scary.


---

Comment by swenson created at 2012-02-07 03:28:31

My bad on the patch -- the new one should be in the correct format.

So, unfortunately, this is the copyright statement as required by my agreement with Google. The code is still licensed under GPL, but they require that exact wording in the copyright.


---

Comment by was created at 2012-02-07 15:20:30

Google copyright is fine.  What does "all rights reserved" mean exactly.


---

Comment by swenson created at 2012-02-07 15:33:56

I think it makes lawyers feel better.  Wikipedia says it means nothing.

http://en.wikipedia.org/wiki/All_rights_reserved


---

Comment by was created at 2012-02-07 16:51:08

Just out of curiosity, would it be allowed to do:

```
8	+- Christopher Swenson (2011): Added a special case to compute the order efficiently (This patch Copyright 2012 Google Inc. All Rights Reserved.)
9	+
10	 REFERENCES:
...
```

instead of

```
8	+- Christopher Swenson (2011): Added a special case to compute the order efficiently.
9	+
10	 REFERENCES:
...
17	+# Copyright 2012 Google Inc. All Rights Reserved.
```


Since it looks like Google is copyrighting the whole file otherwise.


---

Comment by swenson created at 2012-02-07 17:48:18

Patch for 10976


---

Attachment

Patch for 10976


---

Attachment

Google said that was fine. I fixed the patch to reflect this.


---

Comment by was created at 2012-02-07 17:52:15

renamed to standard format for patch names


---

Attachment

I changed the name of the patch to our standard format.  In particular, by ending in .patch instead of .txt, it now gets nicely syntax highlighted.  Regarding the actual patch, can you:

  1. Indent four spaces instead of 2 (this is the Python.org standard, which we follow). 

  2. Explain the mathematics behind the algorithm you are using.   For example, if you look at http://trac.sagemath.org/sage_trac/attachment/ticket/11975/trac_11975-part4.patch you'll see that I explain the mathematics behind the algorithm that I've coded.    Alternatively, if the algorithm you coded is very standard, you could give a reference (though I seem to recall you just came up with it from scratch).


---

Comment by was created at 2012-02-07 17:56:23

Changing status from needs_review to needs_work.


---

Attachment


---

Comment by swenson created at 2012-02-08 16:27:14

Changing status from needs_work to needs_review.


---

Comment by swenson created at 2012-02-08 16:27:14

I believe that I have addressed your concerns.


---

Comment by was created at 2012-02-08 17:21:29

I wish we had line-by-line commenting... Anyway:

* Change "that" to "for which" below?

```
        1321	        # Special case: certain subgroups of the symmetric group that Gap reports 
 	1322	        # generators of the form ((1, 2), (1, 3), ..., (1, m))
```


* Delete "the order of " below:

```
        1330      "We then know that the order of this group is isomorphic to S_n" -- rewrite
```


* Is there confusion between "n" and "m" in the comments?

* It would be nice to have a doctest like this:

```
sage: [SymmetricGroup(n).stabilizer(1)._gap_().Size() for n in [2..10]]
[1, 2, 6, 24, 120, 720, 5040, 40320, 362880]
sage: [SymmetricGroup(n).stabilizer(1)._order() for n in [2..10]]
[1, 2, 6, 24, 120, 720, 5040, 40320, 362880]
```



---

Comment by was created at 2012-02-08 17:21:29

Changing status from needs_review to needs_work.


---

Comment by swenson created at 2012-02-08 18:22:28

Changing status from needs_work to needs_review.


---

Attachment

Done.

If we ever move to git, we could use gerrit.  I don't know if there are good line-by-line commenting tools for hg.


---

Comment by was created at 2012-02-08 18:42:40

Replying to [comment:15 swenson]:
> Done.
> 
> If we ever move to git, we could use gerrit.  I don't know if there are good line-by-line commenting tools for hg.

I think it's more an issue of the code review tool we're using, e.g., trac.  For example, http://code.google.com/ has line-by-line code review annotation, and fully supports Mercurial. 

 -- William


---

Comment by was created at 2012-02-08 18:43:04

Replying to [comment:15 swenson]:
> If we ever move to git, ...

I think it is more a "when" than "if".

 -- William


---

Comment by was created at 2012-02-08 18:55:27

Changing status from needs_review to needs_work.


---

Comment by was created at 2012-02-08 18:55:27

I missed two small things:

 * "This means that this graph is isomorphic" --> "This means that this group is isomorphic"  (group, not graph). 

 * "Christopher Swenson (2011)" --> "Christopher Swenson (2012)"

Positive review once those two details are fixed.


---

Attachment

Done.


---

Comment by swenson created at 2012-02-08 19:22:58

Changing status from needs_work to needs_review.


---

Comment by was created at 2012-02-08 19:34:26

Changing status from needs_review to needs_work.


---

Comment by was created at 2012-02-08 19:34:26

Argh: "graoup"


---

Attachment


---

Comment by swenson created at 2012-02-08 19:37:30

Changing status from needs_work to needs_review.


---

Comment by swenson created at 2012-02-08 19:37:30

My bad, must be an off day for me.


---

Comment by was created at 2012-02-08 19:51:37

Thanks!  Positive review.


---

Comment by was created at 2012-02-08 19:51:37

Changing status from needs_review to positive_review.


---

Comment by swenson created at 2012-02-08 20:02:43

Since I'm new here, I don't know what happens now. The developer's guide is a bit murky on what happens after you get a positive review, especially since I don't believe that I have commit privileges?


---

Comment by was created at 2012-02-08 20:12:39

It's now the release manager's job (jdmeyer).  Assuming we didn't forget anything obvious, and he trusts us, he'll apply your patch to one of the releases here (or soon to appear here):
   
  http://sage.math.washington.edu/home/release/?C=M;O=D

Then the buildbot (or release manager) will run build tests all over the place (on dozens of computers).  If any errors pop up, the ticket will get "needs work".  If everything is fine, the patch stays in and will appear in the next Sage release (likely sage-5.0).


---

Comment by novoselt created at 2012-02-08 20:40:53

Replying to [comment:23 swenson]:
> Since I'm new here, I don't know what happens now. The developer's guide is a bit murky on what happens after you get a positive review, especially since I don't believe that I have commit privileges?

This probably means that there should be a ticket clarifying these steps in the developer's guide...


---

Comment by jdemeyer created at 2012-02-09 19:10:49

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2012-02-09 19:10:49

There are several doctest failures with sage-5.0.beta3:

```
The following tests failed:

        sage -t  --long -force_lib devel/sage/doc/en/constructions/graph_theory.rst # 1 doctests failed
        sage -t  --long -force_lib devel/sage/doc/en/thematic_tutorials/group_theory.rst # 1 doctests failed
        sage -t  --long -force_lib devel/sage/sage/groups/perm_gps/partn_ref/data_structures_pyx.pxi # 3 doctests failed
        sage -t  --long -force_lib devel/sage/sage/graphs/generic_graph.py # 1 doctests failed
```


(I'm assuming only the last patch needs to be applied)


---

Comment by jdemeyer created at 2012-02-09 19:13:13

Concerning creating patches: you should use "hg export tip", not "hg diff".  This way, the uploaded patch contains meta-data about the username, the commit message...

If you use Mercurial queues, the commit message can be set using "hg qrefresh -e".  If not, simply use "hg commit".


---

Comment by was created at 2012-02-09 23:20:38

Wow, at least one of those doctest failures shows that there is a mistake in this algorithm:

```
sage: G = DihedralGroup(5).cayley_graph().automorphism_group()
sage: sage: G.order()
6
sage: G._gap_().Order()
10
sage: len(list(G))
10
```


I think that the author was perhaps assuming that the generators are all transpositions, but didn't test this:

```
sage: G.gens()
[(1,8)(2,10)(3,4)(5,6)(7,9), (1,10)(2,3)(4,5)(6,7)(8,9)]
sage: G.gens()[0].cycle_tuples()
[(1, 8), (2, 10), (3, 4), (5, 6), (7, 9)]
```

But in the code in the patch we have

```
1357	            a, b = g.cycle_tuples()[0]
```



---

Comment by swenson created at 2012-02-12 03:06:16

Changing status from needs_work to needs_review.


---

Attachment

I believe I have fixed the errors.

I wasn't able to test against those files on my current box, as they seemed to be giving me a bunch of random, unrelated errors.


---

Comment by was created at 2012-02-13 14:48:32

Looking at the code, I'm pretty confident this is right and will pass tests.   Should the comment
"* All generators have order 2 " be changed to "* All generators are transpositions (i.e., permutations that flip switch two elements and leave everything else fixed)" ?


---

Attachment


---

Comment by swenson created at 2012-03-05 11:20:46

Sorry -- forgot that I still had to fix that comment.

Comment is now fixed in the latest patch set.  Please take a look.


---

Comment by was created at 2012-03-05 14:26:43

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-03-08 08:00:50

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2012-03-08 08:00:50

[attachment:trac_10976.7.patch] doesn't apply to sage-5.0.beta7:

```
applying /mnt/usb1/scratch/jdemeyer/merger/patches/trac_10976.7.patch
patching file sage/groups/perm_gps/permgroup.py
Hunk #1 FAILED at 1330
1 out of 1 hunks FAILED -- saving rejects to file sage/groups/perm_gps/permgroup.py.rej
abort: patch failed to apply
```



---

Attachment

folded the two patches into one; added proper "Trac #10976" to commit message.


---

Comment by was created at 2012-03-08 20:40:24

Replying to [comment:33 jdemeyer]:
> [attachment:trac_10976.7.patch] doesn't apply to sage-5.0.beta7:

It does, sort of, but the .patch file actually had two separate HG commits in it, which "we don't do".  I (the reviewer) have replaced it by a new patch with only one commit, and fixed the patch log description to start with "Trac #10976".


---

Comment by was created at 2012-03-08 20:40:24

Changing status from needs_work to positive_review.


---

Comment by swenson created at 2012-03-09 19:50:27

Thanks. I didn't know about the one-commit-per-patch thing. (In fact, I thought people were arguing against switching to gerrit because it enforces this...)


---

Comment by jdemeyer created at 2012-03-09 20:43:24

Replying to [comment:34 was]:
> It does, sort of, but the .patch file actually had two separate HG commits in it
There's nothing wrong with that _as long as those two commits are in the correct order_ (which wasn't the case).


---

Comment by jdemeyer created at 2012-03-13 08:22:32

Resolution: fixed
