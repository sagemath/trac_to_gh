# Issue 23964: py3: get rid of an hex problem

Issue created by migration from https://trac.sagemath.org/ticket/24201

Original creator: chapoton

Original creation time: 2017-11-12 07:55:38

CC:  fbissey




---

Comment by chapoton created at 2017-11-12 08:44:13

Changing status from new to needs_review.


---

Comment by chapoton created at 2017-11-12 08:44:13

here is a tentative, maybe sufficient ?
----
New commits:


---

Comment by fbissey created at 2017-11-12 08:52:25

Well, that get us a tiny bit further

```
/usr/lib64/python3.6/site-packages/sage/rings/real_mpfr.pyx in init sage.rings.real_mpfr()
   2033 
   2034             sage: [hex(RR(s)) for s in ['+inf', '-inf', 'nan']]
   2035             ['inf', '-inf', 'nan']
   2036         """
   2037         cdef char *s
   2038         cdef int r
   2039         sig_on()
   2040         r = mpfr_asprintf(&s, "%Ra", self.value)
   2041         sig_off()
   2042         if r < 0:  # MPFR free()s its buffer itself in this case
   2043             raise RuntimeError("unable to convert an mpfr number to a string")
   2044         t = str(s)
   2045         mpfr_free_str(s)
   2046         return t
   2047 
-> 2048     def __copy__(self):
        global __copy__ = undefined
        global self = undefined
   2049         """
   2050         Return copy of ``self`` - since ``self`` is immutable, we just return
   2051         ``self`` again.
   2052 
   2053         EXAMPLES::
   2054 
   2055             sage: a = 3.5
   2056             sage: copy(a) is  a
   2057             True
   2058         """
   2059         return self    # since object is immutable.
   2060 
   2061     def _integer_(self, Z=None):
   2062         """
   2063         If this floating-point number is actually an integer, return that

NameError: name '__hex__' is not defined
```

but it now complains about `__exe__`????


---

Comment by chapoton created at 2017-11-12 09:08:06

Well. Could be a circular import problem. Maybe try to apply the changes in 

https://git.sagemath.org/sage.git/diff/src/sage/rings/real_double.pyx?h=public/python3-experiment-8.1.rc0&id=2ffe4e29422d4e331c65d16d7590fd9fb0bbd9b3

Could you also please confirm that using the full branch "public/python3-experiment-8.1.rc0" gives you a starting python3-sage ? Nobody else told me that..


---

Comment by fbissey created at 2017-11-12 09:16:44

I am a dummy, I just applied the patch but didn't re-compile when it is a .pyx file - I won't do much with my sage-on-gentoo install so close to bed time (local time). I will put testing your branch on my TODO list for tomorrow. I need to convert it into a patch first to use in my own build system.


---

Comment by chapoton created at 2017-11-12 10:22:57

green bot


---

Comment by fbissey created at 2017-11-12 21:22:55

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2017-11-12 22:01:15

What an idiot. I changed the description (in my defence it was empty) instead of commenting. So here is the comment:

Once recompiled things go OK, next problem is in `finite_enumerated_sets.py`. I see you already have something for that.

And let's put a description.


---

Comment by vbraun created at 2017-12-11 01:02:44

Resolution: fixed
