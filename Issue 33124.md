# Issue 33124: configure: Handle the case of SAGE_LOCAL = a system directory with gcc better

Issue created by migration from https://trac.sagemath.org/ticket/33361

Original creator: mkoeppe

Original creation time: 2022-02-16 20:47:51

CC:  isuruf @tobiasdiez fbissey mjo dimpase

split out from #30845


---

Comment by mkoeppe created at 2022-02-16 20:54:38

New commits:


---

Comment by mkoeppe created at 2022-02-16 20:54:38

Changing status from new to needs_review.


---

Comment by fbissey created at 2022-02-16 21:00:51

It is difficult for me to comment on that part of the configure script from the point of view of sage-on-gentoo since I don't use it at all.


---

Comment by mkoeppe created at 2022-02-22 02:01:47

Changing priority from major to critical.


---

Comment by mkoeppe created at 2022-02-28 18:30:25

Let's get this in please


---

Comment by dimpase created at 2022-03-04 20:36:23

is there an easy obvious way to test this?


---

Comment by mkoeppe created at 2022-03-04 20:38:21

"Conda for Sage developers" instructions at https://wiki.sagemath.org/Conda?


---

Comment by mkoeppe created at 2022-03-04 20:39:25

Or use `configure --prefix=/usr` in a discardable VM/container


---

Comment by dimpase created at 2022-03-15 16:14:14

Replying to [comment:9 mkoeppe]:
> Or use `configure --prefix=/usr` in a discardable VM/container

just tried in a Docker container, and ran into

```
config.status: /usr/lib64 is not a symlink, see Trac #19782
config.status: error: Cannot perform incremental update, run "make distclean && make"
```

not sure if this is a bug for this branch.


---

Comment by mkoeppe created at 2022-03-15 16:16:54

Not a bug.


---

Comment by mkoeppe created at 2022-03-15 16:17:18

Use a different distro for testing that does not have this


---

Comment by dimpase created at 2022-03-15 16:19:25

I'd say it is a bug in this case. Trying now with

```diff
--- a/configure.ac
+++ b/configure.ac
@@ -530,7 +530,7 @@ AC_CONFIG_COMMANDS(mkdirs,
         if test -d "$SAGE_LOCAL/lib64"; then
             if test ! -L "$SAGE_LOCAL/lib64"; then
                 AC_MSG_NOTICE([[$SAGE_LOCAL/lib64 is not a symlink, see Trac #19782]])
-                AC_MSG_ERROR([[Cannot perform incremental update, run "make distclean && make"]])
+             dnl   AC_MSG_ERROR([[Cannot perform incremental update, run "make distclean && make"]])
             fi
         else
             AC_MSG_NOTICE([[creating symbolic link lib64 -> lib]])
```



---

Comment by dimpase created at 2022-03-15 16:20:49

Replying to [comment:11 mkoeppe]:
> Not a bug.
it ought to work if we don't error out here in case of `--prefix=/usr`.


---

Comment by mkoeppe created at 2022-03-15 16:35:15

... but we do not want to support this configuration for users, it's just a quick way for you to test the ticket. The actual use case is installation into a conda environment, #30845.


---

Comment by dimpase created at 2022-03-15 17:16:20

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2022-03-15 17:16:20

ok, it works


---

Comment by dimpase created at 2022-03-15 17:21:29

by the way, do we know how to report `opensuse-tumbleweed` bugs? There `gphelp`, a part of pari/gp, does not work.
(it doesn't seem to work on the recent homebrew, too)


---

Comment by mkoeppe created at 2022-03-15 18:44:15

Thank you!


---

Comment by mkoeppe created at 2022-03-15 18:46:35

Replying to [comment:17 dimpase]:
> by the way, do we know how to report `opensuse-tumbleweed` bugs?

Yes, https://bugzilla.opensuse.org; so far no competent response to an issue that I reported for #33153 though


---

Comment by vbraun created at 2022-03-21 23:34:51

Resolution: fixed
