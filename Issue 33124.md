# Issue 33124: configure: Handle the case of SAGE_LOCAL = a system directory with gcc better

archive/issues_033124.json:
```json
{
    "body": "CC:  @isuruf @tobiasdiez @kiwifb @orlitzky @dimpase\n\nsplit out from #30845\n\nIssue created by migration from https://trac.sagemath.org/ticket/33361\n\n",
    "created_at": "2022-02-16T20:47:51Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "configure: Handle the case of SAGE_LOCAL = a system directory with gcc better",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33124",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @isuruf @tobiasdiez @kiwifb @orlitzky @dimpase

split out from #30845

Issue created by migration from https://trac.sagemath.org/ticket/33361





---

archive/issue_comments_471456.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-02-16T20:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471456",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_471457.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-16T20:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471457",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_471458.json:
```json
{
    "body": "It is difficult for me to comment on that part of the configure script from the point of view of sage-on-gentoo since I don't use it at all.",
    "created_at": "2022-02-16T21:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471458",
    "user": "https://github.com/kiwifb"
}
```

It is difficult for me to comment on that part of the configure script from the point of view of sage-on-gentoo since I don't use it at all.



---

archive/issue_comments_471459.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2022-02-22T02:01:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471459",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_471460.json:
```json
{
    "body": "Let's get this in please",
    "created_at": "2022-02-28T18:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471460",
    "user": "https://github.com/mkoeppe"
}
```

Let's get this in please



---

archive/issue_comments_471461.json:
```json
{
    "body": "is there an easy obvious way to test this?",
    "created_at": "2022-03-04T20:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471461",
    "user": "https://github.com/dimpase"
}
```

is there an easy obvious way to test this?



---

archive/issue_comments_471462.json:
```json
{
    "body": "\"Conda for Sage developers\" instructions at https://wiki.sagemath.org/Conda?",
    "created_at": "2022-03-04T20:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471462",
    "user": "https://github.com/mkoeppe"
}
```

"Conda for Sage developers" instructions at https://wiki.sagemath.org/Conda?



---

archive/issue_comments_471463.json:
```json
{
    "body": "Or use `configure --prefix=/usr` in a discardable VM/container",
    "created_at": "2022-03-04T20:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471463",
    "user": "https://github.com/mkoeppe"
}
```

Or use `configure --prefix=/usr` in a discardable VM/container



---

archive/issue_comments_471464.json:
```json
{
    "body": "Replying to [comment:9 mkoeppe]:\n> Or use `configure --prefix=/usr` in a discardable VM/container\n\njust tried in a Docker container, and ran into\n\n```\nconfig.status: /usr/lib64 is not a symlink, see Trac #19782\nconfig.status: error: Cannot perform incremental update, run \"make distclean && make\"\n```\n\nnot sure if this is a bug for this branch.",
    "created_at": "2022-03-15T16:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471464",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:9 mkoeppe]:
> Or use `configure --prefix=/usr` in a discardable VM/container

just tried in a Docker container, and ran into

```
config.status: /usr/lib64 is not a symlink, see Trac #19782
config.status: error: Cannot perform incremental update, run "make distclean && make"
```

not sure if this is a bug for this branch.



---

archive/issue_comments_471465.json:
```json
{
    "body": "Not a bug.",
    "created_at": "2022-03-15T16:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471465",
    "user": "https://github.com/mkoeppe"
}
```

Not a bug.



---

archive/issue_comments_471466.json:
```json
{
    "body": "Use a different distro for testing that does not have this",
    "created_at": "2022-03-15T16:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471466",
    "user": "https://github.com/mkoeppe"
}
```

Use a different distro for testing that does not have this



---

archive/issue_comments_471467.json:
```json
{
    "body": "I'd say it is a bug in this case. Trying now with\n\n```diff\n--- a/configure.ac\n+++ b/configure.ac\n@@ -530,7 +530,7 @@ AC_CONFIG_COMMANDS(mkdirs,\n         if test -d \"$SAGE_LOCAL/lib64\"; then\n             if test ! -L \"$SAGE_LOCAL/lib64\"; then\n                 AC_MSG_NOTICE([[$SAGE_LOCAL/lib64 is not a symlink, see Trac #19782]])\n-                AC_MSG_ERROR([[Cannot perform incremental update, run \"make distclean && make\"]])\n+             dnl   AC_MSG_ERROR([[Cannot perform incremental update, run \"make distclean && make\"]])\n             fi\n         else\n             AC_MSG_NOTICE([[creating symbolic link lib64 -> lib]])\n```\n",
    "created_at": "2022-03-15T16:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471467",
    "user": "https://github.com/dimpase"
}
```

I'd say it is a bug in this case. Trying now with

```diff
--- a/configure.ac
+++ b/configure.ac
@@ -530,7 +530,7 @@ AC_CONFIG_COMMANDS(mkdirs,
         if test -d "$SAGE_LOCAL/lib64"; then
             if test ! -L "$SAGE_LOCAL/lib64"; then
                 AC_MSG_NOTICE([[$SAGE_LOCAL/lib64 is not a symlink, see Trac #19782]])
-                AC_MSG_ERROR([[Cannot perform incremental update, run "make distclean && make"]])
+             dnl   AC_MSG_ERROR([[Cannot perform incremental update, run "make distclean && make"]])
             fi
         else
             AC_MSG_NOTICE([[creating symbolic link lib64 -> lib]])
```




---

archive/issue_comments_471468.json:
```json
{
    "body": "Replying to [comment:11 mkoeppe]:\n> Not a bug.\nit ought to work if we don't error out here in case of `--prefix=/usr`.",
    "created_at": "2022-03-15T16:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471468",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:11 mkoeppe]:
> Not a bug.
it ought to work if we don't error out here in case of `--prefix=/usr`.



---

archive/issue_comments_471469.json:
```json
{
    "body": "... but we do not want to support this configuration for users, it's just a quick way for you to test the ticket. The actual use case is installation into a conda environment, #30845.",
    "created_at": "2022-03-15T16:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471469",
    "user": "https://github.com/mkoeppe"
}
```

... but we do not want to support this configuration for users, it's just a quick way for you to test the ticket. The actual use case is installation into a conda environment, #30845.



---

archive/issue_comments_471470.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-15T17:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471470",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_471471.json:
```json
{
    "body": "ok, it works",
    "created_at": "2022-03-15T17:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471471",
    "user": "https://github.com/dimpase"
}
```

ok, it works



---

archive/issue_comments_471472.json:
```json
{
    "body": "by the way, do we know how to report `opensuse-tumbleweed` bugs? There `gphelp`, a part of pari/gp, does not work.\n(it doesn't seem to work on the recent homebrew, too)",
    "created_at": "2022-03-15T17:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471472",
    "user": "https://github.com/dimpase"
}
```

by the way, do we know how to report `opensuse-tumbleweed` bugs? There `gphelp`, a part of pari/gp, does not work.
(it doesn't seem to work on the recent homebrew, too)



---

archive/issue_comments_471473.json:
```json
{
    "body": "Thank you!",
    "created_at": "2022-03-15T18:44:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471473",
    "user": "https://github.com/mkoeppe"
}
```

Thank you!



---

archive/issue_comments_471474.json:
```json
{
    "body": "Replying to [comment:17 dimpase]:\n> by the way, do we know how to report `opensuse-tumbleweed` bugs?\n\nYes, https://bugzilla.opensuse.org; so far no competent response to an issue that I reported for #33153 though",
    "created_at": "2022-03-15T18:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471474",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:17 dimpase]:
> by the way, do we know how to report `opensuse-tumbleweed` bugs?

Yes, https://bugzilla.opensuse.org; so far no competent response to an issue that I reported for #33153 though



---

archive/issue_events_029966.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-03-21T23:34:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33124#event-29966"
}
```



---

archive/issue_comments_471475.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-21T23:34:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33124#issuecomment-471475",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
