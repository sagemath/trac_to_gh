# Issue 16889: Floating-point precision issues fail matrix2.py doctests

archive/issues_016889.json:
```json
{
    "body": "CC:  vbraun\n\nKeywords: doctest failure, floating point, precision, matrix\n\nThis is on the develop branch at version 6.4beta4:\n\n\n```\ndarij@travis-virtualbox:~/gitsage$ ./sage -bt src/sage/matrix/matrix2.pyx\nscons: `install' is up to date.\nUpdating Cython code....\nEnabling Cython debugging support\nFinished Cythonizing, time: 6.46 seconds.\nDiscovering Python source code....\nDiscovered Python source, time: 0.03 seconds.\nCleaning up stale installed files....\n- cleaning /home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages\n- cleaning /home/darij/sage-6.3.beta6/local/lib/site-python\n- cleaning /home/darij/sage-6.3.beta6/src/build/lib.linux-i686-2.7\nFinished cleaning, time: 0.14 seconds.\nrunning install\nrunning build\nrunning build_py\nrunning build_ext\nExecuting 0 commands (using 1 thread)\nTime to execute 0 commands: 0.11 seconds.\nTotal time spent compiling C/C++ extensions: 0.31 seconds.\nrunning install_lib\nrunning install_egg_info\nRemoving /home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage-6.4.beta4-py2.7.egg-info\nWriting /home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage-6.4.beta4-py2.7.egg-info\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2014-10-09-21-38-47-a9d849b9.\nDoctesting 1 file.\nsage -t src/sage/matrix/matrix2.pyx\n**********************************************************************\nFile \"src/sage/matrix/matrix2.pyx\", line 5209, in sage.matrix.matrix2.Matrix.diagonal.eigenspaces_right\nFailed example:\n    eigenvalues = em[0]; eigenvalues.dense_matrix().zero_at(1e-15)\nExpected:\n    [ 13.348469228349...                0.0                 0.0]\n    [                0.0 -1.348469228349...                 0.0]\n    [                0.0                0.0                 0.0]\nGot:\n    [13.348469228349522                0.0                0.0]\n    [               0.0 -1.348469228349534                0.0]\n    [               0.0                0.0                0.0]\n**********************************************************************\nFile \"src/sage/matrix/matrix2.pyx\", line 5689, in sage.matrix.matrix2.Matrix.diagonal.eigenmatrix_right\nFailed example:\n    evalues = em[0]; evalues.dense_matrix().zero_at(2e-15)\nExpected:\n    [ 13.348469228349...                0.0                 0.0]\n    [                0.0 -1.348469228349...                 0.0]\n    [                0.0                0.0                 0.0]\nGot:\n    [13.348469228349522                0.0                0.0]\n    [               0.0 -1.348469228349534                0.0]\n    [               0.0                0.0                0.0]\n**********************************************************************\nFile \"src/sage/matrix/matrix2.pyx\", line 12207, in sage.matrix.matrix2.Matrix.diagonal.norm\nFailed example:\n    A.norm()\nExpected:\n    15.0\nGot:\n    14.999999999999998\n**********************************************************************\n3 items had failures:\n   1 of  19 in sage.matrix.matrix2.Matrix.diagonal.eigenmatrix_right\n   1 of  24 in sage.matrix.matrix2.Matrix.diagonal.eigenspaces_right\n   1 of  18 in sage.matrix.matrix2.Matrix.diagonal.norm\n    [2116 tests, 3 failures, 17.51 s]\n----------------------------------------------------------------------\nsage -t src/sage/matrix/matrix2.pyx  # 3 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 18.4 seconds\n    cpu time: 16.5 seconds\n    cumulative wall time: 17.5 seconds\n```\n\n\nI suspect I should post some system info, but I don't know what kind of, so I fear you'll have to worm it out of me. Here is some random data:\n\n\n```\ndarij@travis-virtualbox:~/gitsage$ lscpu\nArchitecture:          i686\nCPU op-mode(s):        32-bit, 64-bit\nByte Order:            Little Endian\nCPU(s):                2\nOn-line CPU(s) list:   0,1\nThread(s) per core:    1\nCore(s) per socket:    2\nSocket(s):             1\nVendor ID:             GenuineIntel\nCPU family:            6\nModel:                 42\nStepping:              7\nCPU MHz:               1973.427\nBogoMIPS:              3943.87\nL1d cache:             32K\nL1d cache:             32K\nL2d cache:             6144K\ndarij@travis-virtualbox:~/gitsage$ uname -a\nLinux travis-virtualbox 3.2.0-69-generic #103-Ubuntu SMP Tue Sep 2 05:03:16 UTC 2014 i686 i686 i386 GNU/Linux\ndarij@travis-virtualbox:~/gitsage$ uname -m\ni686\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17126\n\n",
    "created_at": "2014-10-10T04:43:22Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "bug"
    ],
    "title": "Floating-point precision issues fail matrix2.py doctests",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16889",
    "user": "darij"
}
```
CC:  vbraun

Keywords: doctest failure, floating point, precision, matrix

This is on the develop branch at version 6.4beta4:


```
darij@travis-virtualbox:~/gitsage$ ./sage -bt src/sage/matrix/matrix2.pyx
scons: `install' is up to date.
Updating Cython code....
Enabling Cython debugging support
Finished Cythonizing, time: 6.46 seconds.
Discovering Python source code....
Discovered Python source, time: 0.03 seconds.
Cleaning up stale installed files....
- cleaning /home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages
- cleaning /home/darij/sage-6.3.beta6/local/lib/site-python
- cleaning /home/darij/sage-6.3.beta6/src/build/lib.linux-i686-2.7
Finished cleaning, time: 0.14 seconds.
running install
running build
running build_py
running build_ext
Executing 0 commands (using 1 thread)
Time to execute 0 commands: 0.11 seconds.
Total time spent compiling C/C++ extensions: 0.31 seconds.
running install_lib
running install_egg_info
Removing /home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage-6.4.beta4-py2.7.egg-info
Writing /home/darij/sage-6.3.beta6/local/lib/python2.7/site-packages/sage-6.4.beta4-py2.7.egg-info
too many failed tests, not using stored timings
Running doctests with ID 2014-10-09-21-38-47-a9d849b9.
Doctesting 1 file.
sage -t src/sage/matrix/matrix2.pyx
**********************************************************************
File "src/sage/matrix/matrix2.pyx", line 5209, in sage.matrix.matrix2.Matrix.diagonal.eigenspaces_right
Failed example:
    eigenvalues = em[0]; eigenvalues.dense_matrix().zero_at(1e-15)
Expected:
    [ 13.348469228349...                0.0                 0.0]
    [                0.0 -1.348469228349...                 0.0]
    [                0.0                0.0                 0.0]
Got:
    [13.348469228349522                0.0                0.0]
    [               0.0 -1.348469228349534                0.0]
    [               0.0                0.0                0.0]
**********************************************************************
File "src/sage/matrix/matrix2.pyx", line 5689, in sage.matrix.matrix2.Matrix.diagonal.eigenmatrix_right
Failed example:
    evalues = em[0]; evalues.dense_matrix().zero_at(2e-15)
Expected:
    [ 13.348469228349...                0.0                 0.0]
    [                0.0 -1.348469228349...                 0.0]
    [                0.0                0.0                 0.0]
Got:
    [13.348469228349522                0.0                0.0]
    [               0.0 -1.348469228349534                0.0]
    [               0.0                0.0                0.0]
**********************************************************************
File "src/sage/matrix/matrix2.pyx", line 12207, in sage.matrix.matrix2.Matrix.diagonal.norm
Failed example:
    A.norm()
Expected:
    15.0
Got:
    14.999999999999998
**********************************************************************
3 items had failures:
   1 of  19 in sage.matrix.matrix2.Matrix.diagonal.eigenmatrix_right
   1 of  24 in sage.matrix.matrix2.Matrix.diagonal.eigenspaces_right
   1 of  18 in sage.matrix.matrix2.Matrix.diagonal.norm
    [2116 tests, 3 failures, 17.51 s]
----------------------------------------------------------------------
sage -t src/sage/matrix/matrix2.pyx  # 3 doctests failed
----------------------------------------------------------------------
Total time for all tests: 18.4 seconds
    cpu time: 16.5 seconds
    cumulative wall time: 17.5 seconds
```


I suspect I should post some system info, but I don't know what kind of, so I fear you'll have to worm it out of me. Here is some random data:


```
darij@travis-virtualbox:~/gitsage$ lscpu
Architecture:          i686
CPU op-mode(s):        32-bit, 64-bit
Byte Order:            Little Endian
CPU(s):                2
On-line CPU(s) list:   0,1
Thread(s) per core:    1
Core(s) per socket:    2
Socket(s):             1
Vendor ID:             GenuineIntel
CPU family:            6
Model:                 42
Stepping:              7
CPU MHz:               1973.427
BogoMIPS:              3943.87
L1d cache:             32K
L1d cache:             32K
L2d cache:             6144K
darij@travis-virtualbox:~/gitsage$ uname -a
Linux travis-virtualbox 3.2.0-69-generic #103-Ubuntu SMP Tue Sep 2 05:03:16 UTC 2014 i686 i686 i386 GNU/Linux
darij@travis-virtualbox:~/gitsage$ uname -m
i686
```


Issue created by migration from https://trac.sagemath.org/ticket/17126





---

archive/issue_comments_223639.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to doctest coverage.",
    "created_at": "2014-10-10T08:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16889#issuecomment-223639",
    "user": "jdemeyer"
}
```

Changing component from PLEASE CHANGE to doctest coverage.



---

archive/issue_comments_223640.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2014-10-10T08:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16889#issuecomment-223640",
    "user": "jdemeyer"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_223641.json:
```json
{
    "body": "Can you please try again with sage-6.4.beta5 just in case something has changed?",
    "created_at": "2014-10-12T18:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16889#issuecomment-223641",
    "user": "jdemeyer"
}
```

Can you please try again with sage-6.4.beta5 just in case something has changed?



---

archive/issue_comments_223642.json:
```json
{
    "body": "Nope. Still the same thing:\n\n\n```\nsage -t src/sage/matrix/matrix2.pyx\n**********************************************************************\nFile \"src/sage/matrix/matrix2.pyx\", line 5209, in sage.matrix.matrix2.Matrix.diagonal.eigenspaces_right\nFailed example:\n    eigenvalues = em[0]; eigenvalues.dense_matrix().zero_at(1e-15)\nExpected:\n    [ 13.348469228349...                0.0                 0.0]\n    [                0.0 -1.348469228349...                 0.0]\n    [                0.0                0.0                 0.0]\nGot:\n    [13.348469228349522                0.0                0.0]\n    [               0.0 -1.348469228349534                0.0]\n    [               0.0                0.0                0.0]\n**********************************************************************\n```\n\netc.",
    "created_at": "2014-10-13T13:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16889#issuecomment-223642",
    "user": "darij"
}
```

Nope. Still the same thing:


```
sage -t src/sage/matrix/matrix2.pyx
**********************************************************************
File "src/sage/matrix/matrix2.pyx", line 5209, in sage.matrix.matrix2.Matrix.diagonal.eigenspaces_right
Failed example:
    eigenvalues = em[0]; eigenvalues.dense_matrix().zero_at(1e-15)
Expected:
    [ 13.348469228349...                0.0                 0.0]
    [                0.0 -1.348469228349...                 0.0]
    [                0.0                0.0                 0.0]
Got:
    [13.348469228349522                0.0                0.0]
    [               0.0 -1.348469228349534                0.0]
    [               0.0                0.0                0.0]
**********************************************************************
```

etc.



---

archive/issue_comments_223643.json:
```json
{
    "body": "The issue is the leading space in front of the 13. Just use  `# abs tol 1e-13` (or so), that takes care of the space as well.",
    "created_at": "2014-10-13T13:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16889#issuecomment-223643",
    "user": "vbraun"
}
```

The issue is the leading space in front of the 13. Just use  `# abs tol 1e-13` (or so), that takes care of the space as well.



---

archive/issue_comments_223644.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-16T09:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16889#issuecomment-223644",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_223645.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-10-16T09:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16889#issuecomment-223645",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_223646.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2014-10-16T13:41:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16889#issuecomment-223646",
    "user": "chapoton"
}
```

Looks good to me.



---

archive/issue_comments_223647.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-10-16T13:41:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16889#issuecomment-223647",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_223648.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-16T21:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16889#issuecomment-223648",
    "user": "vbraun"
}
```

Resolution: fixed
