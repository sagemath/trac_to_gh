# Issue 24135: Map._extra_slots(): do not pass dict

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2017-12-13 14:42:24

In the `Map` method `_extra_slots`, a dict is passed as input. That dict is then modified in-place and also returned as output.

This awkward logic is not needed for anything. We simplify this by not passing a dict as input and creating a new dict from scratch if needed.


---

Comment by jdemeyer created at 2017-12-14 12:04:56

New commits:


---

Comment by jdemeyer created at 2017-12-14 12:04:56

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-12-15 22:40:18

LGTM overall, but I do not feel 100% comfortable relying on an uninitialized `zero_element` being `None` by default:

```
        if self.zero_element is None:
            self.zero_element = self._codomain.zero()
```

So I would add `self.zero_element = None` in the `__init__`.

Probably we should also add the other cdef classes (such as `Z_to_quadratic_field_element`) to the `.pxd` file, but that can be done on a followup.


---

Comment by jdemeyer created at 2017-12-16 08:42:36

Interestingly, http://cython.readthedocs.io/en/latest/src/userguide/special_methods.html#initialisation-methods-cinit-and-init says

"Any Python attributes have also been initialised to `None`, but you probably shouldnâ€™t rely on that."


---

Comment by tscrim created at 2017-12-16 12:56:24

So are you saying we should just leave it be?


---

Comment by jdemeyer created at 2017-12-17 18:55:59

Replying to [comment:5 tscrim]:
> So are you saying we should just leave it be?

I just sent an email to the Cython mailing list to ask for clarification.


---

Comment by jdemeyer created at 2017-12-18 09:05:08

Reply from a Cython developer:
> As long as Cython controls the type hierarchy, you can rely on it. Exposing
> `NULL` values for Python attributes to !Python/Cython code would be unhelpful.
>
> There is one exception: when `__cinit__()` is called, attributes that are
> defined by *subtypes* have not been initialised yet and thus are still `NULL`
> instead of `None`.

In short: what I did is correct.


---

Comment by tscrim created at 2017-12-18 10:58:57

Alright, then positive review.


---

Comment by tscrim created at 2017-12-18 10:58:57

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-12-22 23:29:23

Resolution: fixed
