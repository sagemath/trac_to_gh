# Issue 33149: MR55: Make orders unique parents

Issue created by migration from https://trac.sagemath.org/ticket/33386

Original creator: galois

Original creation time: 2022-02-20 02:54:43

Julian RÃ¼th ([`@`saraedum](https://gitlab.com/sagemath/dev/tracmirror/saraedum)) opened a merge request at https://gitlab.com/sagemath/sage/-/merge_requests/55:
----

```markdown
Orders in number fields are currently not unique parents:

{{{
sage: K.<i> = NumberField(x^2 + 1)
sage: OK = K.order(i)
sage: OK is loads(dumps(OK))
False
sage: K.maximal_order([2, 3]) is K.maximal_order([3, 2])
False
sage: K.maximal_order([2]) is K.maximal_order([2, 2])
False
sage: K.maximal_order([2]) is K.maximal_order([-2])
False
}}}

Also, maximality of orders is sometimes wrong:

{{{
sage: OK = K.maximal_order()
sage: (OK & OK).is_maximal()
False
sage: OK = K.maximal_order(2)
sage: OK == K.maximal_order()
True
sage: OK.is_maximal()
False
}}}

---

Here, we try to do a better job about making orders unique parents by using a unique factory.

Also, we normalize the primes at which we maximize and do not use them anymore to identify the order.

Finally, we keep a more granular cache of maximality assumptions in each order which fixes the above bugs. We still support the old behavior but issue a deprecation warning. Eventually, when creating an order that is maximal at some primes, the default will be `assume_maximal=None`, i.e., we make no assumptions about maximality at other primes.
```



---

Comment by saraedum created at 2022-02-20 03:02:26

Changing component from PLEASE CHANGE to number fields.


---

Comment by saraedum created at 2022-02-20 03:02:26

Changing type from PLEASE CHANGE to defect.


---

Comment by saraedum created at 2022-02-20 03:25:30

Changing status from needs_review to needs_work.


---

Comment by galois created at 2022-02-20 05:22:14

New commits added to merge request.  I updated the commit SHA-1.  New commits:


---

Comment by galois created at 2022-02-20 06:33:37

New commits added to merge request.  I updated the commit SHA-1.  New commits:


---

Comment by galois created at 2022-02-20 06:44:45

New commits added to merge request.  I updated the commit SHA-1.  New commits:


---

Comment by saraedum created at 2022-02-20 06:45:02

Changing status from needs_work to needs_review.


---

Comment by saraedum created at 2022-02-20 06:45:02

New commits:


---

Comment by galois created at 2022-02-20 08:50:14

New commits added to merge request.  I updated the commit SHA-1.  New commits:


---

Comment by galois created at 2022-02-20 21:42:13

New commits added to merge request.  I updated the commit SHA-1.  New commits:


---

Comment by galois created at 2022-02-20 21:42:41

New commits added to merge request.  I updated the commit SHA-1.  New commits:


---

Comment by roed created at 2022-02-20 21:57:31

I ran long tests locally and they passed.  Giving a positive review.


---

Comment by roed created at 2022-02-20 21:57:31

Changing keywords from "" to "pAdicBordeaux".


---

Comment by roed created at 2022-02-20 21:57:31

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-02-27 22:00:16

Resolution: fixed
