# Issue 28256: Update to primecount 5.1

Issue created by migration from https://trac.sagemath.org/ticket/28493

Original creator: arojas

Original creation time: 2019-09-14 15:54:35

CC:  vdelecroix @timokau fbissey isuruf saraedum




---

Comment by arojas created at 2019-09-14 16:11:10

Changing type from PLEASE CHANGE to enhancement.


---

Comment by arojas created at 2019-09-14 16:11:10

----
New commits:


---

Comment by arojas created at 2019-09-14 16:11:10

Changing component from PLEASE CHANGE to packages: optional.


---

Comment by arojas created at 2019-09-14 16:11:51

I can't get it to show the deprecation message - does it not work in cython?


---

Comment by vdelecroix created at 2019-09-14 18:38:43

It should work but I also don't see the deprecation message.

The message shows in the doctest environment since with the following modification the tests pass

```diff
diff --git a/src/sage/interfaces/primecount.pyx b/src/sage/interfaces/primecount.pyx
index fe69d26748..623240d39f 100644
--- a/src/sage/interfaces/primecount.pyx
+++ b/src/sage/interfaces/primecount.pyx
@@ -38,6 +38,13 @@ cpdef int64_t prime_pi(int64_t n, method=None) except -1:
 
         sage: prime_pi(1000) == 168                     # optional - primecount
         True
+
+        sage: prime_pi(1000, method='deleglise_rivat') == 168
+        doctest:warning
+        ...
+        DeprecationWarning: primecount 5.x no longer supports the 'method' parameter
+        See https://trac.sagemath.org/28493 for details.
+        True
     """
     cdef int64_t ans
     if method is not None:
```



---

Comment by vdelecroix created at 2019-09-14 18:44:19

You are right. It seems that all `DeprecationWarning` from Cython code are turned off. Two other examples from `matroids/matroid.pyx` and `matrix/matrix_integer_dense.pyx`.

```
sage: matroids.Uniform(2, 3).is_3connected(separation=True)
(True, None)
sage: matrix(2, [2,1,1,1])._invert_unit()
[ 1 -1]
[-1  2]
```



---

Comment by arojas created at 2019-09-14 18:51:57

Changing status from new to needs_review.


---

Comment by arojas created at 2019-09-14 18:51:57

Setting to needs_review then, since the problem is not in this patch


---

Comment by arojas created at 2019-09-14 18:54:55

CC'ing other packagers, in case they also package this


---

Comment by vdelecroix created at 2019-09-15 13:43:33

Still, the deprecation would better be doctested... see my patch [comment:5].


---

Comment by vdelecroix created at 2019-09-15 13:51:16

See #28500 for the problem with deprecation not showing up.


---

Comment by git created at 2019-09-15 13:52:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2019-09-15 14:01:46

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2019-09-15 14:01:46

thanks


---

Comment by chapoton created at 2019-09-30 08:12:27

moving milestone to 9.0 (after release of 8.9)


---

Comment by vbraun created at 2019-10-05 07:58:02

Resolution: fixed
