# Issue 22315: 2 bugs creating a simple 2-point Polytope

archive/issues_022315.json:
```json
{
    "body": "CC:  jipilab moritz mkoeppe vdelecroix\n\nSara Billey (of Univ of Washington) reported these.\n\n```\n~/Sara$ sage-develop\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 7.6.beta5, Release Date: 2017-02-26               \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: P=Polyhedron(vertices =[(8.3319544851638732, 7.0567045956967727), (6.4876921900819049, 4.8435898415984129)])\nsage: P\nThe empty polyhedron in (Real Field with 57 bits of precision)^2\nsage: # WRONG!  It should not be empty.  Indeed, look:\nsage: P=Polyhedron(vertices =[(8.3319544851638732, 7.0567045956967727), (6.4876921900819049, 4.84358984159841)])\nsage: P\nA 1-dimensional polyhedron in RDF^2 defined as the convex hull of 2 vertices\nsage: # Also, here's a hub traceback for no reason (as a second but maybe related bug):\nsage: P=Polyhedron(vertices =[(8.3319544851638732, 7.0567045956967727), (6.4876921900819049, 4.8435898415984129)], base_ring=RealField(40))\nsage: P.plot()\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\n<ipython-input-8-d297b4e23e6b> in <module>()\n----> 1 P.plot()\n \n/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in plot(self, point, line, polygon, wireframe, fill, projection_direction, **kwds)\n    694                 return polyhedron.projection()\n    695\n--> 696         projection = project(self)\n    697         try:\n    698             plot_method = projection.plot\n \n/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in project(polyhedron)\n    692                 return polyhedron.schlegel_projection()\n    693             else:\n--> 694                 return polyhedron.projection()\n    695\n    696         projection = project(self)\n \n/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in projection(self)\n   3759         \"\"\"\n   3760         from .plot import Projection\n-> 3761         self.projection = Projection(self)\n   3762         return self.projection\n   3763\n \n/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.py in __init__(self, polyhedron, proj)\n    492\n    493         if polyhedron.ambient_dim() == 2:\n--> 494             self._init_from_2d(polyhedron)\n    495         elif polyhedron.ambient_dim() == 3:\n    496             self._init_from_3d(polyhedron)\n \n/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.py in _init_from_2d(self, polyhedron)\n    748         self.dimension = 2\n    749         self._init_points(polyhedron)\n--> 750         self._init_lines_arrows(polyhedron)\n    751         self._init_area_2d(polyhedron)\n    752\n \n/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.py in _init_lines_arrows(self, polyhedron)\n    812             if not obj[i].is_vertex(): continue\n    813             for j in range(len(obj)):\n--> 814                 if polyhedron.vertex_adjacency_matrix()[i,j] == 0: continue\n    815                 if i < j and obj[j].is_vertex():\n    816                     l = [obj[i].vector(), obj[j].vector()]\n \n/projects/sage/sage-dev/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (/projects/sage/sage-dev/src/build/cythonized/sage/misc/cachefunc.c:13453)()\n   2399         if self.cache is None:\n   2400             f = self.f\n-> 2401             self.cache = f(self._instance)\n   2402         return self.cache\n   2403\n \n/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in vertex_adjacency_matrix(self)\n   1933             (0, 0, 1, 1, 0) A vertex at (3, 0)\n   1934         \"\"\"\n-> 1935         return self._vertex_adjacency_matrix()\n   1936\n   1937     adjacency_matrix = vertex_adjacency_matrix\n \n/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in _vertex_adjacency_matrix(self)\n    318             M[j, i] = 1\n    319\n--> 320         face_lattice = self.face_lattice()\n    321         for face in face_lattice:\n    322             Vrep = face.ambient_Vrepresentation()\n \n/projects/sage/sage-dev/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (/projects/sage/sage-dev/src/build/cythonized/sage/misc/cachefunc.c:13453)()\n   2399         if self.cache is None:\n   2400             f = self.f\n-> 2401             self.cache = f(self._instance)\n   2402         return self.cache\n   2403\n \n/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in face_lattice(self)\n   3408         return Hasse_diagram_from_incidences\\\n   3409             (atoms_incidences, coatoms_incidences,\n-> 3410              face_constructor=face_constructor, required_atoms=atoms_vertices)\n   3411\n   3412     def faces(self, face_dimension):\n \n/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/hasse_diagram.pyc in Hasse_diagram_from_incidences(atom_to_coatoms, coatom_to_atoms, face_constructor, required_atoms, key, **kwds)\n    180     # Make sure that coatoms are in the end in proper order\n    181     tail = [faces[atoms, frozenset([coatom])]\n--> 182             for coatom, atoms in enumerate(coatom_to_atoms)]\n    183     tail.append(faces[A, frozenset()])\n    184     new_order = [n for n in new_order if n not in tail] + tail\n \nKeyError: (frozenset([]), frozenset([0]))\nsage: \n```\n\n\nSee public worksheet: https://cloud.sagemath.com/projects/53b9d6b6-ce2c-4007-843a-257cc01bf65b/files/Sara/Polygon%20Bug.sagews\n\nIssue created by migration from https://trac.sagemath.org/ticket/22552\n\n",
    "created_at": "2017-03-09T00:08:50Z",
    "labels": [
        "geometry",
        "minor",
        "bug"
    ],
    "title": "2 bugs creating a simple 2-point Polytope",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22315",
    "user": "was"
}
```
CC:  jipilab moritz mkoeppe vdelecroix

Sara Billey (of Univ of Washington) reported these.

```
~/Sara$ sage-develop
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 7.6.beta5, Release Date: 2017-02-26               │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: P=Polyhedron(vertices =[(8.3319544851638732, 7.0567045956967727), (6.4876921900819049, 4.8435898415984129)])
sage: P
The empty polyhedron in (Real Field with 57 bits of precision)^2
sage: # WRONG!  It should not be empty.  Indeed, look:
sage: P=Polyhedron(vertices =[(8.3319544851638732, 7.0567045956967727), (6.4876921900819049, 4.84358984159841)])
sage: P
A 1-dimensional polyhedron in RDF^2 defined as the convex hull of 2 vertices
sage: # Also, here's a hub traceback for no reason (as a second but maybe related bug):
sage: P=Polyhedron(vertices =[(8.3319544851638732, 7.0567045956967727), (6.4876921900819049, 4.8435898415984129)], base_ring=RealField(40))
sage: P.plot()
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
<ipython-input-8-d297b4e23e6b> in <module>()
----> 1 P.plot()
 
/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in plot(self, point, line, polygon, wireframe, fill, projection_direction, **kwds)
    694                 return polyhedron.projection()
    695
--> 696         projection = project(self)
    697         try:
    698             plot_method = projection.plot
 
/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in project(polyhedron)
    692                 return polyhedron.schlegel_projection()
    693             else:
--> 694                 return polyhedron.projection()
    695
    696         projection = project(self)
 
/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in projection(self)
   3759         """
   3760         from .plot import Projection
-> 3761         self.projection = Projection(self)
   3762         return self.projection
   3763
 
/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.py in __init__(self, polyhedron, proj)
    492
    493         if polyhedron.ambient_dim() == 2:
--> 494             self._init_from_2d(polyhedron)
    495         elif polyhedron.ambient_dim() == 3:
    496             self._init_from_3d(polyhedron)
 
/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.py in _init_from_2d(self, polyhedron)
    748         self.dimension = 2
    749         self._init_points(polyhedron)
--> 750         self._init_lines_arrows(polyhedron)
    751         self._init_area_2d(polyhedron)
    752
 
/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/plot.py in _init_lines_arrows(self, polyhedron)
    812             if not obj[i].is_vertex(): continue
    813             for j in range(len(obj)):
--> 814                 if polyhedron.vertex_adjacency_matrix()[i,j] == 0: continue
    815                 if i < j and obj[j].is_vertex():
    816                     l = [obj[i].vector(), obj[j].vector()]
 
/projects/sage/sage-dev/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (/projects/sage/sage-dev/src/build/cythonized/sage/misc/cachefunc.c:13453)()
   2399         if self.cache is None:
   2400             f = self.f
-> 2401             self.cache = f(self._instance)
   2402         return self.cache
   2403
 
/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in vertex_adjacency_matrix(self)
   1933             (0, 0, 1, 1, 0) A vertex at (3, 0)
   1934         """
-> 1935         return self._vertex_adjacency_matrix()
   1936
   1937     adjacency_matrix = vertex_adjacency_matrix
 
/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in _vertex_adjacency_matrix(self)
    318             M[j, i] = 1
    319
--> 320         face_lattice = self.face_lattice()
    321         for face in face_lattice:
    322             Vrep = face.ambient_Vrepresentation()
 
/projects/sage/sage-dev/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (/projects/sage/sage-dev/src/build/cythonized/sage/misc/cachefunc.c:13453)()
   2399         if self.cache is None:
   2400             f = self.f
-> 2401             self.cache = f(self._instance)
   2402         return self.cache
   2403
 
/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in face_lattice(self)
   3408         return Hasse_diagram_from_incidences\
   3409             (atoms_incidences, coatoms_incidences,
-> 3410              face_constructor=face_constructor, required_atoms=atoms_vertices)
   3411
   3412     def faces(self, face_dimension):
 
/projects/sage/sage-dev/local/lib/python2.7/site-packages/sage/geometry/hasse_diagram.pyc in Hasse_diagram_from_incidences(atom_to_coatoms, coatom_to_atoms, face_constructor, required_atoms, key, **kwds)
    180     # Make sure that coatoms are in the end in proper order
    181     tail = [faces[atoms, frozenset([coatom])]
--> 182             for coatom, atoms in enumerate(coatom_to_atoms)]
    183     tail.append(faces[A, frozenset()])
    184     new_order = [n for n in new_order if n not in tail] + tail
 
KeyError: (frozenset([]), frozenset([0]))
sage: 
```


See public worksheet: https://cloud.sagemath.com/projects/53b9d6b6-ce2c-4007-843a-257cc01bf65b/files/Sara/Polygon%20Bug.sagews

Issue created by migration from https://trac.sagemath.org/ticket/22552





---

archive/issue_comments_310100.json:
```json
{
    "body": "If I understood correctly, #18220 tries to fix this and other problems by disallowing inexact fields completely...",
    "created_at": "2017-03-09T04:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310100",
    "user": "novoselt"
}
```

If I understood correctly, #18220 tries to fix this and other problems by disallowing inexact fields completely...



---

archive/issue_comments_310101.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-17T09:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310101",
    "user": "jipilab"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_310102.json:
```json
{
    "body": "I added tests and some explanation in the documentation of the polyhedron constructor. This complements #18220 also inside the constructor class.\n----\nNew commits:",
    "created_at": "2017-03-17T09:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310102",
    "user": "jipilab"
}
```

I added tests and some explanation in the documentation of the polyhedron constructor. This complements #18220 also inside the constructor class.
----
New commits:



---

archive/issue_comments_310103.json:
```json
{
    "body": "Changing keywords from \"\" to \"base ring, polyhedron\".",
    "created_at": "2017-03-17T09:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310103",
    "user": "jipilab"
}
```

Changing keywords from "" to "base ring, polyhedron".



---

archive/issue_comments_310104.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-17T09:40:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310104",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_310105.json:
```json
{
    "body": "Do you really want to keep this behavior?\n\n```\nIf the input consists of decimal numbers and the `base_ring` is not specified,\nthe base ring is set to be the `RealField` with the precision given by the\nminimal precision of the input. If it has 53 bits of precision, the constructor\nconverts automatically the base ring to `RDF`::\n```\n",
    "created_at": "2017-03-17T11:54:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310105",
    "user": "vdelecroix"
}
```

Do you really want to keep this behavior?

```
If the input consists of decimal numbers and the `base_ring` is not specified,
the base ring is set to be the `RealField` with the precision given by the
minimal precision of the input. If it has 53 bits of precision, the constructor
converts automatically the base ring to `RDF`::
```




---

archive/issue_comments_310106.json:
```json
{
    "body": "Computations over `RDF` and `RR` **are** different!",
    "created_at": "2017-03-17T11:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310106",
    "user": "vdelecroix"
}
```

Computations over `RDF` and `RR` **are** different!



---

archive/issue_comments_310107.json:
```json
{
    "body": "An example\n\n```\nsage: float(\"2.0\") ** -2048r == 0.0r\nTrue\nsage: RR(2.) ** -2048r == RR.zero()\nFalse\n```\n",
    "created_at": "2017-03-17T11:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310107",
    "user": "vdelecroix"
}
```

An example

```
sage: float("2.0") ** -2048r == 0.0r
True
sage: RR(2.) ** -2048r == RR.zero()
False
```




---

archive/issue_comments_310108.json:
```json
{
    "body": "Replying to [comment:6 vdelecroix]:\n> Do you really want to keep this behavior?\n> {{{\n> If the input consists of decimal numbers and the `base_ring` is not specified,\n> the base ring is set to be the `RealField` with the precision given by the\n> minimal precision of the input. If it has 53 bits of precision, the constructor\n> converts automatically the base ring to `RDF`::\n> }}}\n\nNo, not really...\n\nBut at least describing the current behavior may be useful to understand how the constructor works. Is that reasonable?\n\nOnce this behavior is changed, I'd just delete the paragraph.",
    "created_at": "2017-03-17T12:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310108",
    "user": "jipilab"
}
```

Replying to [comment:6 vdelecroix]:
> Do you really want to keep this behavior?
> {{{
> If the input consists of decimal numbers and the `base_ring` is not specified,
> the base ring is set to be the `RealField` with the precision given by the
> minimal precision of the input. If it has 53 bits of precision, the constructor
> converts automatically the base ring to `RDF`::
> }}}

No, not really...

But at least describing the current behavior may be useful to understand how the constructor works. Is that reasonable?

Once this behavior is changed, I'd just delete the paragraph.



---

archive/issue_comments_310109.json:
```json
{
    "body": "This ticket only looks at the bugs, now with #18220 merged, the behavior is changed and the \"bugs\" have now an explanation.\n\nWhat else should be done here?",
    "created_at": "2017-03-17T12:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310109",
    "user": "jipilab"
}
```

This ticket only looks at the bugs, now with #18220 merged, the behavior is changed and the "bugs" have now an explanation.

What else should be done here?



---

archive/issue_comments_310110.json:
```json
{
    "body": "Should the \"Do what I mean\" be changed completely?\n\nOr should the base_ring passed by the constructor to the parent *always* be `RDF` and not `RR`?",
    "created_at": "2017-03-17T12:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310110",
    "user": "jipilab"
}
```

Should the "Do what I mean" be changed completely?

Or should the base_ring passed by the constructor to the parent *always* be `RDF` and not `RR`?



---

archive/issue_comments_310111.json:
```json
{
    "body": "Replying to [comment:9 jipilab]:\n> Replying to [comment:6 vdelecroix]:\n> > Do you really want to keep this behavior?\n> > {{{\n> > If the input consists of decimal numbers and the `base_ring` is not specified,\n> > the base ring is set to be the `RealField` with the precision given by the\n> > minimal precision of the input. If it has 53 bits of precision, the constructor\n> > converts automatically the base ring to `RDF`::\n> > }}}\n> \n> No, not really...\n> \n> But at least describing the current behavior may be useful to understand how the constructor works. Is that reasonable?\n\nWhen documented, a bug becomes a feature! What about\n\n```\n.. WARNING::\n\n    When used with input in the realf field with 53 bits of mantissa precision\n    the input is converted without notice into the machine floating point numbers.\n    This behavior might cause some undesirable effects.\n```\n",
    "created_at": "2017-03-17T12:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310111",
    "user": "vdelecroix"
}
```

Replying to [comment:9 jipilab]:
> Replying to [comment:6 vdelecroix]:
> > Do you really want to keep this behavior?
> > {{{
> > If the input consists of decimal numbers and the `base_ring` is not specified,
> > the base ring is set to be the `RealField` with the precision given by the
> > minimal precision of the input. If it has 53 bits of precision, the constructor
> > converts automatically the base ring to `RDF`::
> > }}}
> 
> No, not really...
> 
> But at least describing the current behavior may be useful to understand how the constructor works. Is that reasonable?

When documented, a bug becomes a feature! What about

```
.. WARNING::

    When used with input in the realf field with 53 bits of mantissa precision
    the input is converted without notice into the machine floating point numbers.
    This behavior might cause some undesirable effects.
```




---

archive/issue_comments_310112.json:
```json
{
    "body": "An example of undesirable feature\n\n```\nsage: a = RR(2.0)**-2048\nsage: b = RR(3.0)**-2048\nsage: Polyhedron([[a],[b]])\nA 0-dimensional polyhedron in RDF^1 defined as the convex hull of 1 vertex\n```\n",
    "created_at": "2017-03-17T12:29:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310112",
    "user": "vdelecroix"
}
```

An example of undesirable feature

```
sage: a = RR(2.0)**-2048
sage: b = RR(3.0)**-2048
sage: Polyhedron([[a],[b]])
A 0-dimensional polyhedron in RDF^1 defined as the convex hull of 1 vertex
```




---

archive/issue_comments_310113.json:
```json
{
    "body": "Okay, yes, that sounds good!",
    "created_at": "2017-03-17T12:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310113",
    "user": "jipilab"
}
```

Okay, yes, that sounds good!



---

archive/issue_comments_310114.json:
```json
{
    "body": "Should I keep the 3 examples showing the difference also?",
    "created_at": "2017-03-17T13:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310114",
    "user": "jipilab"
}
```

Should I keep the 3 examples showing the difference also?



---

archive/issue_comments_310115.json:
```json
{
    "body": "Further, the warning bugs me a bit...\n\nIt does not tell the complete truth about the behaviour: you only need 1 entry to have a 53 bit mentissa to get into floating points not necessary all of them... This is **even** worse I find! This is somehow the source of the weird behavior described in this ticket. The fact that one value had 53 bit of mentissa made it possible to create the object, and I would say lead to the belief that the polyhedron is *well defined*.\n\n\n```\n\nsage: c = 1.00000000000000\nsage: d = 1.000000000000001\nsage: Polyhedron([[c],[d]])\nA 0-dimensional polyhedron in RDF^1 defined as the convex hull of 1 vertex\n\n```\n",
    "created_at": "2017-03-17T13:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310115",
    "user": "jipilab"
}
```

Further, the warning bugs me a bit...

It does not tell the complete truth about the behaviour: you only need 1 entry to have a 53 bit mentissa to get into floating points not necessary all of them... This is **even** worse I find! This is somehow the source of the weird behavior described in this ticket. The fact that one value had 53 bit of mentissa made it possible to create the object, and I would say lead to the belief that the polyhedron is *well defined*.


```

sage: c = 1.00000000000000
sage: d = 1.000000000000001
sage: Polyhedron([[c],[d]])
A 0-dimensional polyhedron in RDF^1 defined as the convex hull of 1 vertex

```




---

archive/issue_comments_310116.json:
```json
{
    "body": "I know not everyone is a fan of issuing a warning, but IMHO, I would find it a useful hint to the user if:\n\n- it gave entries with more than 53 bits of mentissa\n- it also gave entries with exactly 53 bits of mentissa (not in `ZZ` or `QQ`)\n\nTo say:\n\nWarning: some entries had more precision than 53 bits and got converted to 53 bits of precision.\n\nThis would not be issued if no entries had more precision than 53 bits.",
    "created_at": "2017-03-17T13:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310116",
    "user": "jipilab"
}
```

I know not everyone is a fan of issuing a warning, but IMHO, I would find it a useful hint to the user if:

- it gave entries with more than 53 bits of mentissa
- it also gave entries with exactly 53 bits of mentissa (not in `ZZ` or `QQ`)

To say:

Warning: some entries had more precision than 53 bits and got converted to 53 bits of precision.

This would not be issued if no entries had more precision than 53 bits.



---

archive/issue_comments_310117.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-04-04T14:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310117",
    "user": "jipilab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_310118.json:
```json
{
    "body": "We should probably add a dependancy to #22605 because the latter touches the constructor and floats...",
    "created_at": "2017-05-04T10:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310118",
    "user": "jipilab"
}
```

We should probably add a dependancy to #22605 because the latter touches the constructor and floats...



---

archive/issue_comments_310119.json:
```json
{
    "body": "This is indeed fixed in 8.1.beta2 in which #22605 is merged\n\n```\nsage: P=Polyhedron(vertices =[(8.3319544851638732, 7.0567045956967727), (6.4876921900819049, 4.8435898415984129)])\nTraceback (most recent call last):\n...\nValueError: no appropriate backend for computations with Real Field with 57 bits of precision\nsage: P=Polyhedron(vertices =[(8.3319544851638732, 7.0567045956967727), (6.4876921900819049, 4.84358984159841)])\nsage: P\nA 1-dimensional polyhedron in RDF^2 defined as the convex hull of 2 vertices\n```\n",
    "created_at": "2017-08-19T15:47:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310119",
    "user": "vdelecroix"
}
```

This is indeed fixed in 8.1.beta2 in which #22605 is merged

```
sage: P=Polyhedron(vertices =[(8.3319544851638732, 7.0567045956967727), (6.4876921900819049, 4.8435898415984129)])
Traceback (most recent call last):
...
ValueError: no appropriate backend for computations with Real Field with 57 bits of precision
sage: P=Polyhedron(vertices =[(8.3319544851638732, 7.0567045956967727), (6.4876921900819049, 4.84358984159841)])
sage: P
A 1-dimensional polyhedron in RDF^2 defined as the convex hull of 2 vertices
```




---

archive/issue_comments_310120.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-21T21:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310120",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_310121.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-21T22:00:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310121",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_310122.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-21T22:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310122",
    "user": "jipilab"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_310123.json:
```json
{
    "body": "Tests seem to pass on 8.1.beta2 but it would be nice to have feedback on the added documentation.",
    "created_at": "2017-08-21T22:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310123",
    "user": "jipilab"
}
```

Tests seem to pass on 8.1.beta2 but it would be nice to have feedback on the added documentation.



---

archive/issue_comments_310124.json:
```json
{
    "body": "You should be more explicit about what is meant by precision\n\n```\nsage: (1.1).precision()\n53\nsage: (1.143234134123123).precision()\n54\nsage: (1.14323413412312123).precision()\n60\n```\n\nIt is **not** the number of digits but closer to `min(53, bits(x))`.",
    "created_at": "2017-08-22T08:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310124",
    "user": "vdelecroix"
}
```

You should be more explicit about what is meant by precision

```
sage: (1.1).precision()
53
sage: (1.143234134123123).precision()
54
sage: (1.14323413412312123).precision()
60
```

It is **not** the number of digits but closer to `min(53, bits(x))`.



---

archive/issue_comments_310125.json:
```json
{
    "body": "This is not the syntax for test blocks\n\n```\n.. TESTS:\n```\n\nsee http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings",
    "created_at": "2017-08-22T08:45:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310125",
    "user": "vdelecroix"
}
```

This is not the syntax for test blocks

```
.. TESTS:
```

see http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings



---

archive/issue_comments_310126.json:
```json
{
    "body": "Since there is four examples in the examples, I don't see why the 'TESTS' section is relevant in your commit.",
    "created_at": "2017-08-22T08:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310126",
    "user": "vdelecroix"
}
```

Since there is four examples in the examples, I don't see why the 'TESTS' section is relevant in your commit.



---

archive/issue_comments_310127.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-22T08:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310127",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_310128.json:
```json
{
    "body": "Changing keywords from \"base ring, polyhedron\" to \"base ring, polyhedron, days88, IMA coding sprints\".",
    "created_at": "2017-08-22T08:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310128",
    "user": "vdelecroix"
}
```

Changing keywords from "base ring, polyhedron" to "base ring, polyhedron, days88, IMA coding sprints".



---

archive/issue_comments_310129.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-22T15:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310129",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_310130.json:
```json
{
    "body": "Dear Vincent,\n\nI made some corrections addressing your comments. Have a look.",
    "created_at": "2017-08-22T15:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310130",
    "user": "jipilab"
}
```

Dear Vincent,

I made some corrections addressing your comments. Have a look.



---

archive/issue_comments_310131.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-22T15:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310131",
    "user": "jipilab"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_310132.json:
```json
{
    "body": "This sentence is definitely too complicated\n\n```\nIf the input consists of decimal numbers and the `base_ring`\nis not specified, the base ring is set to be the `RealField`\nwith the precision given by the minimal bit precision of the\ninput and 53 (the precision of `RDF`). Then, if the obtained\nminimum was 53 bits of precision, the constructor converts\nautomatically the base ring to `RDF`. Otherwise, it returns an error\n```\n\nI would try to be more informative\n\n```\nBe careful when you construct polyhedra with floating point\nnumbers. The only available backend for such computation is\n`cdd` which uses machine floating point numbers which have\nhave limited precision (24 bits on 32 bits architecture and\n53 bits on 64 bits architecture). Sage behavior \n... etc ... \n```\n\n\nBTW, what is happening on 32 bits?",
    "created_at": "2017-08-22T15:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310132",
    "user": "vdelecroix"
}
```

This sentence is definitely too complicated

```
If the input consists of decimal numbers and the `base_ring`
is not specified, the base ring is set to be the `RealField`
with the precision given by the minimal bit precision of the
input and 53 (the precision of `RDF`). Then, if the obtained
minimum was 53 bits of precision, the constructor converts
automatically the base ring to `RDF`. Otherwise, it returns an error
```

I would try to be more informative

```
Be careful when you construct polyhedra with floating point
numbers. The only available backend for such computation is
`cdd` which uses machine floating point numbers which have
have limited precision (24 bits on 32 bits architecture and
53 bits on 64 bits architecture). Sage behavior 
... etc ... 
```


BTW, what is happening on 32 bits?



---

archive/issue_comments_310133.json:
```json
{
    "body": "> BTW, what is happening on 32 bits?\n\nIt seems that binary64 format from\n\nhttps://en.wikipedia.org/wiki/IEEE_754\n\nhas 53 bits of precision no matter if it was compiled in 32 or 64 bits processors. I'm no expert here but it seems to be safe to say that a `Double` has 53 bits in 32 and 64 bits.",
    "created_at": "2017-08-22T19:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310133",
    "user": "jipilab"
}
```

> BTW, what is happening on 32 bits?

It seems that binary64 format from

https://en.wikipedia.org/wiki/IEEE_754

has 53 bits of precision no matter if it was compiled in 32 or 64 bits processors. I'm no expert here but it seems to be safe to say that a `Double` has 53 bits in 32 and 64 bits.



---

archive/issue_comments_310134.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-22T20:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310134",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_310135.json:
```json
{
    "body": "A (bad) undocumented feature\n\n```\nsage: Polyhedron(vertices =[(8.3319544851638732, 7.0567045956967727), (6.4876921900819049, 4.8435898415984129)], base_ring=RR)\nA 1-dimensional polyhedron in RDF^2 defined as the convex hull of 2 vertices\n```\n\n\nAs agreed with JP, I wrote a commit that makes the above an error.\n----\nNew commits:",
    "created_at": "2017-08-22T22:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310135",
    "user": "vdelecroix"
}
```

A (bad) undocumented feature

```
sage: Polyhedron(vertices =[(8.3319544851638732, 7.0567045956967727), (6.4876921900819049, 4.8435898415984129)], base_ring=RR)
A 1-dimensional polyhedron in RDF^2 defined as the convex hull of 2 vertices
```


As agreed with JP, I wrote a commit that makes the above an error.
----
New commits:



---

archive/issue_comments_310136.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-23T20:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310136",
    "user": "jipilab"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_310137.json:
```json
{
    "body": "The last changes look good to me. I give my green light on the last changes.",
    "created_at": "2017-08-23T20:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310137",
    "user": "jipilab"
}
```

The last changes look good to me. I give my green light on the last changes.



---

archive/issue_comments_310138.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-10T11:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22315#issuecomment-310138",
    "user": "vbraun"
}
```

Resolution: fixed
