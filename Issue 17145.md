# Issue 17145: Show Cython code in IPython tracebacks

Issue created by migration from https://trac.sagemath.org/ticket/17382

Original creator: jdemeyer

Original creation time: 2014-11-22 21:57:41

(this was split off from #71)

To show tracebacks from Cython code, we need to:
1) add `SAGE_SRC` to `sys.path` since Cython uses relative paths in its tracebacks
2) add a patch to IPython to not replace the `.pyx` file with the `.so` file.


---

Comment by jdemeyer created at 2014-11-22 23:27:12

New commits:


---

Comment by jdemeyer created at 2014-11-22 23:34:40

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2014-12-05 13:41:04

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-12-06 10:35:41

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2014-12-06 11:13:01

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2014-12-06 11:25:04

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2014-12-06 15:56:59

Changing component from modular forms to packages: standard.


---

Comment by tscrim created at 2014-12-07 16:52:46

This is so nice to have. Works on pure cython and mixed python/cython tracebacks. Positive review.


---

Comment by tscrim created at 2014-12-07 16:52:46

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-12-12 13:34:53


```
sage -t --long src/sage/repl/interpreter.py
**********************************************************************
File "src/sage/repl/interpreter.py", line 76, in sage.repl.interpreter
Failed example:
    get_test_shell().run_cell('1/0')
Expected:
    ---------------------------------------------------------------------------
    ...
    /usr/local/src/sage-git/src/sage/rings/integer_ring.pyx in sage.rings.integer_ring.IntegerRing_class._div (build/cythonized/sage/rings/integer_ring.c:...)()
        ...         cdef rational.Rational x = PY_NEW(rational.Rational)
        ...         if mpz_sgn(right.value) == 0:
        ...             raise ZeroDivisionError('Rational division by zero')
        ...         mpz_set(mpq_numref(x.value), left.value)
        ...         mpz_set(mpq_denref(x.value), right.value)
    <BLANKLINE>
    ZeroDivisionError: Rational division by zero
Got:
    ---------------------------------------------------------------------------
    ZeroDivisionError                         Traceback (most recent call last)
    <ipython-input-1-6f88eab09598> in <module>()
    ----> 1 Integer(1)/Integer(0)
    <BLANKLINE>
    /home/release/Sage/src/sage/structure/element.pyx in sage.structure.element.RingElement.__div__ (build/cythonized/sage/structure/element.c:17829)()
       1889                 return (<RingElement>self)._idiv_(<RingElement>right)
       1890             else:
    -> 1891                 return (<RingElement>self)._div_(<RingElement>right)
       1892         global coercion_model
       1893         return coercion_model.bin_op(self, right, div)
    <BLANKLINE>
    /home/release/Sage/src/sage/rings/integer.pyx in sage.rings.integer.Integer._div_ (build/cythonized/sage/rings/integer.c:12872)()
       1792         # This is vastly faster than doing it here, since here
       1793         # we can't cimport rationals.
    -> 1794         return the_integer_ring._div(self, right)
       1795 
       1796     def __floordiv__(x, y):
    <BLANKLINE>
    /home/release/Sage/src/sage/rings/integer_ring.pyx in sage.rings.integer_ring.IntegerRing_class._div (build/cythonized/sage/rings/integer_ring.c:4582)()
        443         cdef rational.Rational x = PY_NEW(rational.Rational)
        444         if mpz_sgn(right.value) == 0:
    --> 445             raise ZeroDivisionError('Rational division by zero')
        446         mpz_set(mpq_numref(x.value), left.value)
        447         mpz_set(mpq_denref(x.value), right.value)
    <BLANKLINE>
    ZeroDivisionError: Rational division by zero
```



---

Comment by vbraun created at 2014-12-12 13:34:53

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2014-12-12 13:47:38

Of course...


---

Comment by jdemeyer created at 2014-12-12 14:19:48

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2014-12-12 14:19:48

New commits:


---

Comment by vbraun created at 2014-12-16 13:57:17

Resolution: fixed
