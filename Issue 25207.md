# Issue 25207: update matrix group morphisms

Issue created by migration from https://trac.sagemath.org/ticket/25444

Original creator: sbrandhorst

Original creation time: 2018-05-25 09:05:22

CC:  tscrim

This is a follow up to #24691.

Morphisms for matrix groups are a separate class which offers little functionality. They can be replaced by `libgap_morphism` which unifies matters and allows homomorphisms to other libgap groups.


---

Comment by sbrandhorst created at 2018-05-25 13:25:34

Somehow we drop into an infinite recusion with the coercion system.
Please help.
----
Last 10 new commits:


---

Comment by sbrandhorst created at 2018-05-25 13:25:34

Changing status from new to needs_info.


---

Comment by tscrim created at 2018-05-26 09:21:12

New commits:


---

Comment by git created at 2018-05-28 08:59:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-29 07:12:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-05-29 07:14:16

Changing status from needs_info to needs_review.


---

Comment by sbrandhorst created at 2018-05-29 07:16:08

`MatrixGroupMorphism`
`MatrixGroupHomset` 
etc. are now completely obsolete.They offer zero additional functionality.
And I am not aware of any special functionality for homomorphisms betweeen matrix groups.
 Deprecate?


---

Comment by tscrim created at 2018-05-29 07:17:24

Yes, I agree.


---

Comment by git created at 2018-05-29 07:52:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-05-29 07:53:00

There you go.


---

Comment by tscrim created at 2018-05-29 08:36:55

This docstring does not seem to be correct:

```diff
+    The following tests that the call method was successfully
+    improved in :trac:`10659`::
```

Also, `MatrixGroupMorphism_im_gens` example is not accurate (really, the docstring should just say something to the effect of `Deprecated; use ***` instead; same for `MatrixGroupMorphism`).


---

Comment by git created at 2018-05-29 09:17:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-05-29 09:21:50

Replying to [comment:13 tscrim]:
> This docstring does not seem to be correct:
> {{{#!diff
> +    The following tests that the call method was successfully
> +    improved in :trac:`10659`::
> }}}
Not sure what you mean here?

> Also, `MatrixGroupMorphism_im_gens` example is not accurate (really, the docstring should just say something to the effect of `Deprecated; use ***` instead; same for `MatrixGroupMorphism`).

Good suggestion. I tend to be too quick about such things. I could remove the test entirely, but then the patchbot will complain about coverage going down?


---

Comment by tscrim created at 2018-05-29 09:24:47

Replying to [comment:15 sbrandhorst]:
> Replying to [comment:13 tscrim]:
> > This docstring does not seem to be correct:
> > {{{#!diff
> > +    The following tests that the call method was successfully
> > +    improved in :trac:`10659`::
> > }}}
> Not sure what you mean here?

You have removed the `_call_` method, so the docstring/test no longer applies.

> > Also, `MatrixGroupMorphism_im_gens` example is not accurate (really, the docstring should just say something to the effect of `Deprecated; use ***` instead; same for `MatrixGroupMorphism`).
> 
> Good suggestion. I tend to be too quick about such things. I could remove the test entirely, but then the patchbot will complain about coverage going down?

No, because it is for a class. Ideally you would have a test using the deprecated class, but I don't think that is worth it (actually, you could just lazily import it with a deprecation).


---

Comment by sbrandhorst created at 2018-05-29 09:40:19

Replying to [comment:16 tscrim]:
> You have removed the `_call_` method, so the docstring/test no longer applies.

Okay. But there is a new call method, that replaces the old one. It should pass the same doctests, so I would kepp it.


---

Comment by git created at 2018-05-29 09:41:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-05-29 09:47:54

Thanks. I agree that we should keep those doctests; I just wanted to change the docstring.

However, your lazy doctest is actually useless. You need to actually create an object using the old class and show it doesn't change the behavior. However, I think it is better just to remove the tests altogether. By a lazy import deprecation, I meant `lazy_import(foo, bar, deprecation=25444)` in the file itself instead of an empty class.


---

Comment by sbrandhorst created at 2018-05-29 18:41:48

Replying to [comment:19 tscrim]:
> By a lazy import deprecation, I meant `lazy_import(foo, bar, deprecation=25444)` in the file itself instead of an empty class.

Not sure what exactly you mean here. Guess the easiest way is for you to just push the line of code you mean.


---

Comment by git created at 2018-05-30 07:12:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-05-30 07:12:26

Here you go. I've deprecated the whole file since nothing else remains afterwards.


---

Comment by sbrandhorst created at 2018-05-30 08:57:01

Maybe there is a bug in lazy_import. It does not show the deprecation for me.
Can you reproduce it?

```
sage: G = GO(2,2,e=1)
sage: P = G.Hom(G)
sage: from sage.groups.matrix_gps.morphism import MatrixGroupMorphism_im_gens
sage: MatrixGroupMorphism_im_gens(P,G.gens())
Group endomorphism of General Orthogonal Group of degree 2 and form parameter 1 over Finite Field of size 2
```

If we do not use the class it works:

```
sage: from sage.groups.matrix_gps.morphism import MatrixGroupMorphism_im_gens
sage: MatrixGroupMorphism_im_gens
.... DeprecationWarning: ....
```



---

Comment by tscrim created at 2018-05-30 09:11:32

Perhaps it is being resolved in some way and then the deprecation is getting suppressed? I'm not exactly sure, but this is the correct procedure.

We should also do the same for the `homset.py` file.


---

Comment by git created at 2018-05-30 09:40:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-30 11:10:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-05-30 11:10:43

Thanks. This is what I needed to change to have doctests pass.


---

Comment by sbrandhorst created at 2018-06-05 07:01:58

Are we waiting for something?


---

Comment by tscrim created at 2018-06-05 08:53:50

Mostly for you to verify my changes make the doctests pass on your machine.


---

Comment by git created at 2018-06-05 11:42:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-06-05 11:44:39

positive review on my part if you hare happy with my changes. (doc builds on my machine)


---

Comment by tscrim created at 2018-06-06 01:09:46

LGTM. Thank you.


---

Comment by tscrim created at 2018-06-06 01:09:46

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-06-07 22:15:03

Resolution: fixed


---

Comment by dimpase created at 2019-12-08 10:04:44

I'm now (9.0.beta8) getting 

```
sage -t --long --warn-long 103.2 src/sage/groups/matrix_gps/homset.py
**********************************************************************
File "src/sage/groups/matrix_gps/homset.py", line 44, in sage.groups.matrix_gps.homset.is_MatrixGroupHomset
Failed example:
    is_MatrixGroupHomset(M)
Expected:
    True
Got:
    doctest:warning
...
    :
    DeprecationWarning: MatrixGroupHomset is deprecated. Use GroupHomset_libgap instead.
    See https://trac.sagemath.org/25444 for details.
    True
```

don't know why it didn't pop up earlier - time is up?


---

Comment by dimpase created at 2019-12-08 23:08:58

I should be more specific - this DeprecationWarning started to show up not on beta, but on the branch of #28329, where `with warnings.catch_warnings():` construct was used, which in fact has an undefined behaviour in multi-treaded setting...


---

Comment by sbrandhorst created at 2019-12-09 20:42:42

no clue. But I guess we can remove the old code?


---

Comment by dimpase created at 2019-12-09 20:47:27

yes, the notice was up long enough, the deprecated code can go now.
