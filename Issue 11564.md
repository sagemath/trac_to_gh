# Issue 11564: Linear time implementation of lex_BFS()

archive/issues_011564.json:
```json
{
    "body": "Assignee: jason, ncohen, rlm\n\nCC:  @dcoudert @kliem @orlitzky\n\nKeywords: lexbfs\n\nThe current implementation of lex_BFS() is quadratic, which is not optimal. The usual way to do it in linear time is through a clever use of doubly linked lists, but in [1] there is a way with static arrays, which I coded in Python.\n\nThere is one thing, though: in [2] there is a new algorithm for is_interval() that avoids PQ-trees, and just uses various passes of lex_BFS() (implemented with doubly linked lists).\nSo maybe in the long run it would be better to do it with doubly linked lists in Cython.\n\n[1] Habib, McConnell, Paul and Viennot. Lex-BFS and Partition Refinement, with Applications to Transitive Orientation, Interval Graph Recognition and Consecutive Ones Testing. TCS 234, 2000.\n[2] Corneil, Olariu and Stewart. The LBFS Structure and Recognition of Interval Graphs. SIAMDM 23(4), 2009.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11736\n\n",
    "created_at": "2011-08-24T14:17:20Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Linear time implementation of lex_BFS()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11564",
    "user": "https://github.com/diegode"
}
```
Assignee: jason, ncohen, rlm

CC:  @dcoudert @kliem @orlitzky

Keywords: lexbfs

The current implementation of lex_BFS() is quadratic, which is not optimal. The usual way to do it in linear time is through a clever use of doubly linked lists, but in [1] there is a way with static arrays, which I coded in Python.

There is one thing, though: in [2] there is a new algorithm for is_interval() that avoids PQ-trees, and just uses various passes of lex_BFS() (implemented with doubly linked lists).
So maybe in the long run it would be better to do it with doubly linked lists in Cython.

[1] Habib, McConnell, Paul and Viennot. Lex-BFS and Partition Refinement, with Applications to Transitive Orientation, Interval Graph Recognition and Consecutive Ones Testing. TCS 234, 2000.
[2] Corneil, Olariu and Stewart. The LBFS Structure and Recognition of Interval Graphs. SIAMDM 23(4), 2009.

Issue created by migration from https://trac.sagemath.org/ticket/11736





---

archive/issue_comments_129860.json:
```json
{
    "body": "Changing assignee from jason, ncohen, rlm to @diegode.",
    "created_at": "2011-08-24T14:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129860",
    "user": "https://github.com/diegode"
}
```

Changing assignee from jason, ncohen, rlm to @diegode.



---

archive/issue_comments_129861.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2011-08-24T14:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129861",
    "user": "https://github.com/diegode"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_129862.json:
```json
{
    "body": "Changing assignee from @diegode to jason, ncohen, rlm.",
    "created_at": "2011-08-24T14:20:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129862",
    "user": "https://github.com/diegode"
}
```

Changing assignee from @diegode to jason, ncohen, rlm.



---

archive/issue_comments_129863.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-09-02T09:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129863",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_129864.json:
```json
{
    "body": "Hello Diego !!!\n\nSame comment (see #11738) for this patch about the \"build/\" folder. I also expect that this patch breaks doctests in Sage's library, so please check it too, correcting the doctests themselves if it makes sense `:-)`\n\nNathann",
    "created_at": "2011-09-02T09:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129864",
    "user": "https://github.com/nathanncohen"
}
```

Hello Diego !!!

Same comment (see #11738) for this patch about the "build/" folder. I also expect that this patch breaks doctests in Sage's library, so please check it too, correcting the doctests themselves if it makes sense `:-)`

Nathann



---

archive/issue_comments_129865.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-09-02T09:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129865",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_129866.json:
```json
{
    "body": "Attachment [linear_lex_bfs.patch](tarball://root/attachments/some-uuid/ticket11736/linear_lex_bfs.patch) by @diegode created at 2011-09-06 07:11:18",
    "created_at": "2011-09-06T07:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129866",
    "user": "https://github.com/diegode"
}
```

Attachment [linear_lex_bfs.patch](tarball://root/attachments/some-uuid/ticket11736/linear_lex_bfs.patch) by @diegode created at 2011-09-06 07:11:18



---

archive/issue_comments_129867.json:
```json
{
    "body": "Replying to [comment:4 ncohen]:\nThank you! Here I fixed the \"build/\" thing, but I'm having trouble running the tests (in OSX 10.7 and Ubuntu 11.04), so expect it to break some of them. I'm sorry.",
    "created_at": "2011-09-06T07:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129867",
    "user": "https://github.com/diegode"
}
```

Replying to [comment:4 ncohen]:
Thank you! Here I fixed the "build/" thing, but I'm having trouble running the tests (in OSX 10.7 and Ubuntu 11.04), so expect it to break some of them. I'm sorry.



---

archive/issue_comments_129868.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-09-06T07:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129868",
    "user": "https://github.com/diegode"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_129869.json:
```json
{
    "body": "> Thank you! Here I fixed the \"build/\" thing, but I'm having trouble running the tests (in OSX 10.7 and Ubuntu 11.04), so expect it to break some of them. I'm sorry.\n\nPerhaps I can help you with this test problem ? The thing is that right now the patch does not seem to work :\n\n```\nsage: graphs.RandomInterval(30).is_interval()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/ncohen/sage/devel/sage-3/sage/graphs/<ipython console> in <module>()\n\n/home/ncohen/sage/local/lib/python2.6/site-packages/sage/graphs/generic_graph.pyc in is_interval(self, certificate)\n   9606         # by the way :-)\n   9607 \n-> 9608         if not self.is_chordal():\n   9609             return False\n   9610 \n\n/home/ncohen/sage/local/lib/python2.6/site-packages/sage/graphs/generic_graph.pyc in is_chordal(self, certificate)\n   9492         for v in peo:\n   9493 \n-> 9494             if t_peo.out_degree(v)>0:\n   9495 \n   9496                 x = t_peo.neighbor_out_iterator(v).next()\n\n/home/ncohen/sage/local/lib/python2.6/site-packages/sage/graphs/digraph.pyc in out_degree(self, vertices, labels)\n   1176             return di\n   1177         else:\n-> 1178             return list(self.out_degree_iterator(vertices, labels=labels))\n   1179 \n   1180     def out_degree_iterator(self, vertices=None, labels=False):\n\n/home/ncohen/sage/local/lib/python2.6/site-packages/sage/graphs/digraph.pyc in out_degree_iterator(self, vertices, labels)\n   1221                 yield (v, d)\n   1222         else:\n-> 1223             for v in vertices:\n   1224                 d = 0\n   1225                 for e in self.outgoing_edge_iterator(v):\n\nTypeError: 'int' object is not iterable\nsage: graphs.RandomInterval(30).is_interval()\n---------------------------------------------------------------------------\nIndexError                                Traceback (most recent call last)\n\n/home/ncohen/sage/devel/sage-3/sage/graphs/<ipython console> in <module>()\n\n/home/ncohen/sage/local/lib/python2.6/site-packages/sage/graphs/generic_graph.pyc in is_interval(self, certificate)\n   9606         # by the way :-)\n   9607 \n-> 9608         if not self.is_chordal():\n   9609             return False\n   9610 \n\n/home/ncohen/sage/local/lib/python2.6/site-packages/sage/graphs/generic_graph.pyc in is_chordal(self, certificate)\n   9484                 return all( gg.is_chordal() for gg in self.connected_components_subgraphs() )\n   9485 \n-> 9486         peo,t_peo = self.lex_BFS(tree=True)\n   9487 \n   9488         g = self.copy()\n\n/home/ncohen/sage/local/lib/python2.6/site-packages/sage/graphs/generic_graph.pyc in lex_BFS(self, reverse, tree, initial_vertex)\n  11617                 if subslice[a] < old_k:\n  11618                     subslice[a] = k\n> 11619                     slice_head[k] = l\n  11620                     k += 1\n  11621                 slice_of[l] = subslice[a]\n\nIndexError: list assignment index out of range\n```\n\n\nOn random interval graphs sometimes the is_interval function works, sometimes it does not... `^^;` \n\nI tested you patch after having applied #11738 and #11735 but I do not think this is where the bug comes from. Could you also add some comments to your code, along with a reference to the paper you are following for this implementation ? `:-)`\n\nNathann",
    "created_at": "2011-09-11T13:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129869",
    "user": "https://github.com/nathanncohen"
}
```

> Thank you! Here I fixed the "build/" thing, but I'm having trouble running the tests (in OSX 10.7 and Ubuntu 11.04), so expect it to break some of them. I'm sorry.

Perhaps I can help you with this test problem ? The thing is that right now the patch does not seem to work :

```
sage: graphs.RandomInterval(30).is_interval()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/ncohen/sage/devel/sage-3/sage/graphs/<ipython console> in <module>()

/home/ncohen/sage/local/lib/python2.6/site-packages/sage/graphs/generic_graph.pyc in is_interval(self, certificate)
   9606         # by the way :-)
   9607 
-> 9608         if not self.is_chordal():
   9609             return False
   9610 

/home/ncohen/sage/local/lib/python2.6/site-packages/sage/graphs/generic_graph.pyc in is_chordal(self, certificate)
   9492         for v in peo:
   9493 
-> 9494             if t_peo.out_degree(v)>0:
   9495 
   9496                 x = t_peo.neighbor_out_iterator(v).next()

/home/ncohen/sage/local/lib/python2.6/site-packages/sage/graphs/digraph.pyc in out_degree(self, vertices, labels)
   1176             return di
   1177         else:
-> 1178             return list(self.out_degree_iterator(vertices, labels=labels))
   1179 
   1180     def out_degree_iterator(self, vertices=None, labels=False):

/home/ncohen/sage/local/lib/python2.6/site-packages/sage/graphs/digraph.pyc in out_degree_iterator(self, vertices, labels)
   1221                 yield (v, d)
   1222         else:
-> 1223             for v in vertices:
   1224                 d = 0
   1225                 for e in self.outgoing_edge_iterator(v):

TypeError: 'int' object is not iterable
sage: graphs.RandomInterval(30).is_interval()
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)

/home/ncohen/sage/devel/sage-3/sage/graphs/<ipython console> in <module>()

/home/ncohen/sage/local/lib/python2.6/site-packages/sage/graphs/generic_graph.pyc in is_interval(self, certificate)
   9606         # by the way :-)
   9607 
-> 9608         if not self.is_chordal():
   9609             return False
   9610 

/home/ncohen/sage/local/lib/python2.6/site-packages/sage/graphs/generic_graph.pyc in is_chordal(self, certificate)
   9484                 return all( gg.is_chordal() for gg in self.connected_components_subgraphs() )
   9485 
-> 9486         peo,t_peo = self.lex_BFS(tree=True)
   9487 
   9488         g = self.copy()

/home/ncohen/sage/local/lib/python2.6/site-packages/sage/graphs/generic_graph.pyc in lex_BFS(self, reverse, tree, initial_vertex)
  11617                 if subslice[a] < old_k:
  11618                     subslice[a] = k
> 11619                     slice_head[k] = l
  11620                     k += 1
  11621                 slice_of[l] = subslice[a]

IndexError: list assignment index out of range
```


On random interval graphs sometimes the is_interval function works, sometimes it does not... `^^;` 

I tested you patch after having applied #11738 and #11735 but I do not think this is where the bug comes from. Could you also add some comments to your code, along with a reference to the paper you are following for this implementation ? `:-)`

Nathann



---

archive/issue_comments_129870.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-09-11T13:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129870",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_129871.json:
```json
{
    "body": "Replying to [comment:7 ncohen]:\nHello Nathann, I think the bug is now fixed (it was a very simple mistake). I added the reference, but the comments are still missing.\nThanks!",
    "created_at": "2011-09-14T03:44:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129871",
    "user": "https://github.com/diegode"
}
```

Replying to [comment:7 ncohen]:
Hello Nathann, I think the bug is now fixed (it was a very simple mistake). I added the reference, but the comments are still missing.
Thanks!



---

archive/issue_comments_129872.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-09-14T03:44:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129872",
    "user": "https://github.com/diegode"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_129873.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-09-28T19:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129873",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_129874.json:
```json
{
    "body": "Hello !!\n\nThis patch still produces many errors when running the doctests...\n\n\n```\nsage -t  \"devel/sage-3/sage/graphs/generic_graph.py\"        \nIBM ILOG License Manager: \"IBM ILOG Optimization Suite for Academic Initiative\" is accessing CPLEX 12 with option(s): \"e m b q \".\n**********************************************************************\nFile \"/home/ncohen/.Sage/devel/sage-3/sage/graphs/generic_graph.py\", line 9412:\n    sage: (2*g).is_chordal()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/ncohen/.Sage/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/ncohen/.Sage/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/ncohen/.Sage/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_137[6]>\", line 1, in <module>\n        (Integer(2)*g).is_chordal()###line 9412:\n    sage: (2*g).is_chordal()\n      File \"/home/ncohen/.Sage/local/lib/python/site-packages/sage/graphs/generic_graph.py\", line 9474, in is_chordal\n        return all( gg.is_chordal() for gg in self.connected_components_subgraphs() )\n      File \"/home/ncohen/.Sage/local/lib/python/site-packages/sage/graphs/generic_graph.py\", line 9474, in <genexpr>\n        return all( gg.is_chordal() for gg in self.connected_components_subgraphs() )\n      File \"/home/ncohen/.Sage/local/lib/python/site-packages/sage/graphs/generic_graph.py\", line 9488, in is_chordal\n        if t_peo.out_degree(v)>0 and g.neighbors(v) not in neighbors_subsets[t_peo.neighbor_out_iterator(v).next()]:\n      File \"/home/ncohen/.Sage/local/lib/python/site-packages/sage/graphs/digraph.py\", line 1178, in out_degree\n        return list(self.out_degree_iterator(vertices, labels=labels))\n      File \"/home/ncohen/.Sage/local/lib/python/site-packages/sage/graphs/digraph.py\", line 1223, in out_degree_iterator\n        for v in vertices:\n    TypeError: 'int' object is not iterable\n**********************************************************************\nFile \"/home/ncohen/.Sage/devel/sage-3/sage/graphs/generic_graph.py\", line 9436:\n    sage: hole\nExpected:\n    Subgraph of (Petersen graph): Graph on 5 vertices\nGot:\n    Subgraph of (Petersen graph): Graph on 4 vertices\n**********************************************************************\nFile \"/home/ncohen/.Sage/devel/sage-3/sage/graphs/generic_graph.py\", line 9438:\n    sage: hole.is_isomorphic(graphs.CycleGraph(5))\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"/home/ncohen/.Sage/devel/sage-3/sage/graphs/generic_graph.py\", line 9554:\n    sage: g.is_interval()\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"/home/ncohen/.Sage/devel/sage-3/sage/graphs/generic_graph.py\", line 9562:\n    sage: d = g.is_interval(certificate = True)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/ncohen/.Sage/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n...\n```\n\n\nPerhaps we can help with your problem running doctests ? It something does not work on this side, it is another bug of Sage's ! `;-)`\n\nNathann",
    "created_at": "2011-09-28T19:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129874",
    "user": "https://github.com/nathanncohen"
}
```

Hello !!

This patch still produces many errors when running the doctests...


```
sage -t  "devel/sage-3/sage/graphs/generic_graph.py"        
IBM ILOG License Manager: "IBM ILOG Optimization Suite for Academic Initiative" is accessing CPLEX 12 with option(s): "e m b q ".
**********************************************************************
File "/home/ncohen/.Sage/devel/sage-3/sage/graphs/generic_graph.py", line 9412:
    sage: (2*g).is_chordal()
Exception raised:
    Traceback (most recent call last):
      File "/home/ncohen/.Sage/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/ncohen/.Sage/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/ncohen/.Sage/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_137[6]>", line 1, in <module>
        (Integer(2)*g).is_chordal()###line 9412:
    sage: (2*g).is_chordal()
      File "/home/ncohen/.Sage/local/lib/python/site-packages/sage/graphs/generic_graph.py", line 9474, in is_chordal
        return all( gg.is_chordal() for gg in self.connected_components_subgraphs() )
      File "/home/ncohen/.Sage/local/lib/python/site-packages/sage/graphs/generic_graph.py", line 9474, in <genexpr>
        return all( gg.is_chordal() for gg in self.connected_components_subgraphs() )
      File "/home/ncohen/.Sage/local/lib/python/site-packages/sage/graphs/generic_graph.py", line 9488, in is_chordal
        if t_peo.out_degree(v)>0 and g.neighbors(v) not in neighbors_subsets[t_peo.neighbor_out_iterator(v).next()]:
      File "/home/ncohen/.Sage/local/lib/python/site-packages/sage/graphs/digraph.py", line 1178, in out_degree
        return list(self.out_degree_iterator(vertices, labels=labels))
      File "/home/ncohen/.Sage/local/lib/python/site-packages/sage/graphs/digraph.py", line 1223, in out_degree_iterator
        for v in vertices:
    TypeError: 'int' object is not iterable
**********************************************************************
File "/home/ncohen/.Sage/devel/sage-3/sage/graphs/generic_graph.py", line 9436:
    sage: hole
Expected:
    Subgraph of (Petersen graph): Graph on 5 vertices
Got:
    Subgraph of (Petersen graph): Graph on 4 vertices
**********************************************************************
File "/home/ncohen/.Sage/devel/sage-3/sage/graphs/generic_graph.py", line 9438:
    sage: hole.is_isomorphic(graphs.CycleGraph(5))
Expected:
    True
Got:
    False
**********************************************************************
File "/home/ncohen/.Sage/devel/sage-3/sage/graphs/generic_graph.py", line 9554:
    sage: g.is_interval()
Expected:
    True
Got:
    False
**********************************************************************
File "/home/ncohen/.Sage/devel/sage-3/sage/graphs/generic_graph.py", line 9562:
    sage: d = g.is_interval(certificate = True)
Exception raised:
    Traceback (most recent call last):
      File "/home/ncohen/.Sage/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
...
```


Perhaps we can help with your problem running doctests ? It something does not work on this side, it is another bug of Sage's ! `;-)`

Nathann



---

archive/issue_comments_129875.json:
```json
{
    "body": "I was ready to help with the doctests issues, but I'm unable to install the patch on sage-5.0.beta9.",
    "created_at": "2012-03-26T16:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129875",
    "user": "https://github.com/dcoudert"
}
```

I was ready to help with the doctests issues, but I'm unable to install the patch on sage-5.0.beta9.



---

archive/issue_comments_129876.json:
```json
{
    "body": "Replying to [comment:10 dcoudert]:\n> I was ready to help with the doctests issues, but I'm unable to install the patch on sage-5.0.beta9.\nHello! I'm sorry I disappeared. I will fix this in the next few days.",
    "created_at": "2012-03-26T18:01:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129876",
    "user": "https://github.com/diegode"
}
```

Replying to [comment:10 dcoudert]:
> I was ready to help with the doctests issues, but I'm unable to install the patch on sage-5.0.beta9.
Hello! I'm sorry I disappeared. I will fix this in the next few days.



---

archive/issue_comments_129877.json:
```json
{
    "body": "Attachment [linear_lex_bfs_fixed.patch](tarball://root/attachments/some-uuid/ticket11736/linear_lex_bfs_fixed.patch) by @diegode created at 2012-03-27 06:12:09",
    "created_at": "2012-03-27T06:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129877",
    "user": "https://github.com/diegode"
}
```

Attachment [linear_lex_bfs_fixed.patch](tarball://root/attachments/some-uuid/ticket11736/linear_lex_bfs_fixed.patch) by @diegode created at 2012-03-27 06:12:09



---

archive/issue_comments_129878.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-27T06:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129878",
    "user": "https://github.com/diegode"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_129879.json:
```json
{
    "body": "I think this patch is working now and passes all the doctests. I'm sure the errors I get while doctesting are bugs of Sage 4.8 (for example, on both Ubuntu 10.10 and OS X 10.7 I get an error in line 15146 of generic_graph.py: \"ValueError: Database has no tablegraph_data.\").",
    "created_at": "2012-03-27T23:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129879",
    "user": "https://github.com/diegode"
}
```

I think this patch is working now and passes all the doctests. I'm sure the errors I get while doctesting are bugs of Sage 4.8 (for example, on both Ubuntu 10.10 and OS X 10.7 I get an error in line 15146 of generic_graph.py: "ValueError: Database has no tablegraph_data.").



---

archive/issue_comments_129880.json:
```json
{
    "body": "Helloooooo Diego !!\n\nI'm sorry but your patch can not be applied on top of the latest release of Sage, that is sage-5.0-beta11 (https://groups.google.com/d/topic/sage-release/XnyN3tx4Bow/discussion). Plenty of stuff has been added in the 5.0-beta? series, and that is probably the explanation `:-)`\n\nAbout your path, though : it removes the old code that computed (more slowly) a BFS ordering for the vertices. This being said, I think this code could still be useful to ... check that the new algorithm actually returns a correct BFS ordering ! Of course, as it is slower, this ordering should not be checked by default, but it would be nice to be able to run doctests which check for each computation of BFS ordering whether this ordering is indeed correct. This can be done by actually checking in turn that each vertex of the ordering is maximal at the moment when it is removed.\n\nDo you think it could be possible to comment your code a bit more ? As it is, reading the paper to understand what happens seems to be the only alternative `:-)`\n\nNathann",
    "created_at": "2012-03-30T22:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129880",
    "user": "https://github.com/nathanncohen"
}
```

Helloooooo Diego !!

I'm sorry but your patch can not be applied on top of the latest release of Sage, that is sage-5.0-beta11 (https://groups.google.com/d/topic/sage-release/XnyN3tx4Bow/discussion). Plenty of stuff has been added in the 5.0-beta? series, and that is probably the explanation `:-)`

About your path, though : it removes the old code that computed (more slowly) a BFS ordering for the vertices. This being said, I think this code could still be useful to ... check that the new algorithm actually returns a correct BFS ordering ! Of course, as it is slower, this ordering should not be checked by default, but it would be nice to be able to run doctests which check for each computation of BFS ordering whether this ordering is indeed correct. This can be done by actually checking in turn that each vertex of the ordering is maximal at the moment when it is removed.

Do you think it could be possible to comment your code a bit more ? As it is, reading the paper to understand what happens seems to be the only alternative `:-)`

Nathann



---

archive/issue_comments_129881.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-30T22:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129881",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_129882.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-14T13:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129882",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_129883.json:
```json
{
    "body": "Hello,\n\nThis patch has been sleeping for very very long time.\n\nI did a first git version of the patch with some corrections. This is far from final version and we have currently 2 implementations to ease tests. To use the new version, you need to set parameter `new_version=True`.\n\nSince the code has no comments, it is hard to know whats going on. I have corrected at least one bug (a missing `j = l`), but I have the following issue:\n\n```\nsage: g = graphs.PathGraph(3).lexicographic_product(graphs.CompleteGraph(2))\nsage: g.lex_BFS(reverse=True)\n[(2, 1), (2, 0), (1, 1), (1, 0), (0, 1), (0, 0)]\nsage: g.lex_BFS(reverse=True, new_version=True)\n[(2, 1), (2, 0), (1, 1), (1, 0), (0, 1), (0, 0)]\nsage: g.lex_BFS(reverse=False)\n[(0, 0), (0, 1), (1, 0), (1, 1), (2, 0), (2, 1)]\nsage: g.lex_BFS(reverse=False, new_version=True)\n[(0, 0), (0, 1), (1, 0), (1, 1), (2, 0), (2, 1)]\n```\n\n\nThe new version is more consistant (and also way faster). Furthermore, on this example, both reverse orderings are correct. \nHowever, when making the new version the default one, many tests for `is_chordal` and `is_interval` are broken.\n\nAny help is welcome.\n\nDavid.",
    "created_at": "2015-03-14T13:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129883",
    "user": "https://github.com/dcoudert"
}
```

Hello,

This patch has been sleeping for very very long time.

I did a first git version of the patch with some corrections. This is far from final version and we have currently 2 implementations to ease tests. To use the new version, you need to set parameter `new_version=True`.

Since the code has no comments, it is hard to know whats going on. I have corrected at least one bug (a missing `j = l`), but I have the following issue:

```
sage: g = graphs.PathGraph(3).lexicographic_product(graphs.CompleteGraph(2))
sage: g.lex_BFS(reverse=True)
[(2, 1), (2, 0), (1, 1), (1, 0), (0, 1), (0, 0)]
sage: g.lex_BFS(reverse=True, new_version=True)
[(2, 1), (2, 0), (1, 1), (1, 0), (0, 1), (0, 0)]
sage: g.lex_BFS(reverse=False)
[(0, 0), (0, 1), (1, 0), (1, 1), (2, 0), (2, 1)]
sage: g.lex_BFS(reverse=False, new_version=True)
[(0, 0), (0, 1), (1, 0), (1, 1), (2, 0), (2, 1)]
```


The new version is more consistant (and also way faster). Furthermore, on this example, both reverse orderings are correct. 
However, when making the new version the default one, many tests for `is_chordal` and `is_interval` are broken.

Any help is welcome.

David.



---

archive/issue_comments_129884.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2015-03-14T13:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129884",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_129885.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-03T19:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129885",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_129886.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-03T20:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129886",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_129887.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2020-08-11T18:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129887",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_129888.json:
```json
{
    "body": "New branch based on 9.2.beta8 with:\n- corrected (hope so) version of previous trials for implementing the algorithm of Habib et al 2000. \n- several improvements of the existing code\n\nPlease test it extensively !\n----\nNew commits:",
    "created_at": "2020-08-11T18:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129888",
    "user": "https://github.com/dcoudert"
}
```

New branch based on 9.2.beta8 with:
- corrected (hope so) version of previous trials for implementing the algorithm of Habib et al 2000. 
- several improvements of the existing code

Please test it extensively !
----
New commits:



---

archive/issue_comments_129889.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-12T09:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129889",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_129890.json:
```json
{
    "body": "something wrong :(\n\n```\nFile \"src/sage/graphs/generic_graph.py\", line 13620, in sage.graphs.generic_graph.GenericGraph.is_interval\nFailed example:\n    [sum(1 for g in graphs(i) if g.is_interval()) for i in range(8)]  # long time\nExpected:\n    [1, 1, 2, 4, 10, 27, 92, 369]\nGot:\n    [1, 1, 2, 4, 10, 27, 91, 374]\n```\n\n\nAt least this graph is not recognized as interval graph (actually, not chordal) when using the new version: `Graph(\"ETzw\")`.",
    "created_at": "2020-08-12T09:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129890",
    "user": "https://github.com/dcoudert"
}
```

something wrong :(

```
File "src/sage/graphs/generic_graph.py", line 13620, in sage.graphs.generic_graph.GenericGraph.is_interval
Failed example:
    [sum(1 for g in graphs(i) if g.is_interval()) for i in range(8)]  # long time
Expected:
    [1, 1, 2, 4, 10, 27, 92, 369]
Got:
    [1, 1, 2, 4, 10, 27, 91, 374]
```


At least this graph is not recognized as interval graph (actually, not chordal) when using the new version: `Graph("ETzw")`.



---

archive/issue_comments_129891.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-12T13:32:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129891",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_129892.json:
```json
{
    "body": "The error was a side effect of wrong memory allocation. Should be OK now.",
    "created_at": "2020-08-12T13:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129892",
    "user": "https://github.com/dcoudert"
}
```

The error was a side effect of wrong memory allocation. Should be OK now.



---

archive/issue_comments_129893.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-12T13:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129893",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_129894.json:
```json
{
    "body": "Is it feasible to generate a small random graph, feed it to both algorithms, and check that their outputs agree in a doctest? That would go a long way towards ensuring that the newer implementation is correct (or at least as correct as the old one).",
    "created_at": "2020-09-03T15:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129894",
    "user": "https://github.com/orlitzky"
}
```

Is it feasible to generate a small random graph, feed it to both algorithms, and check that their outputs agree in a doctest? That would go a long way towards ensuring that the newer implementation is correct (or at least as correct as the old one).



---

archive/issue_comments_129895.json:
```json
{
    "body": "The difficulty is that we may have several valid orderings, even with same initial vertex, and that the 2 algorithms may produce different orderings\nFor instance:\n\n```\nsage: for i in range(100): \n....:     G = graphs.RandomChordalGraph(10) \n....:     F = G.lex_BFS(initial_vertex=0, algorithm=\"fast\") \n....:     S = G.lex_BFS(initial_vertex=0, algorithm=\"slow\") \n....:     print(i, \"fast\", F) \n....:     print(i, \"slow\", S) \n....:     if S != F: \n....:         print(G.graph6_string()) \n....:         break \n....:                                                                                                                               \n0 fast [0, 1, 5, 9, 6, 4, 7, 2, 8, 3]\n0 slow [0, 1, 5, 9, 6, 4, 7, 2, 8, 3]\n1 fast [0, 1, 4, 8, 2, 7, 9, 6, 3, 5]\n1 slow [0, 1, 4, 8, 2, 7, 9, 6, 3, 5]\n2 fast [0, 6, 7, 9, 8, 5, 1, 3, 2, 4]\n2 slow [0, 6, 7, 9, 8, 1, 3, 5, 2, 4]\nIAHSCEA_w\n```\n\nIn this example, the last graph is not connected, but it's the same with connected graphs.\nFor instance, take a star with center 0. Then any permutation of the leaves lead to a valid lex BFS ordering.\n\nOne option could be to make an indirect doctest using `is_chordal` on a random chordal graph, but for that me must be able to specify the lex BFS algorithm to use in `is_chordal`. Not sure it's the best way.\n\nBut may be there is an other way to check that a lex BFS ordering is valid ?",
    "created_at": "2020-09-03T16:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129895",
    "user": "https://github.com/dcoudert"
}
```

The difficulty is that we may have several valid orderings, even with same initial vertex, and that the 2 algorithms may produce different orderings
For instance:

```
sage: for i in range(100): 
....:     G = graphs.RandomChordalGraph(10) 
....:     F = G.lex_BFS(initial_vertex=0, algorithm="fast") 
....:     S = G.lex_BFS(initial_vertex=0, algorithm="slow") 
....:     print(i, "fast", F) 
....:     print(i, "slow", S) 
....:     if S != F: 
....:         print(G.graph6_string()) 
....:         break 
....:                                                                                                                               
0 fast [0, 1, 5, 9, 6, 4, 7, 2, 8, 3]
0 slow [0, 1, 5, 9, 6, 4, 7, 2, 8, 3]
1 fast [0, 1, 4, 8, 2, 7, 9, 6, 3, 5]
1 slow [0, 1, 4, 8, 2, 7, 9, 6, 3, 5]
2 fast [0, 6, 7, 9, 8, 5, 1, 3, 2, 4]
2 slow [0, 6, 7, 9, 8, 1, 3, 5, 2, 4]
IAHSCEA_w
```

In this example, the last graph is not connected, but it's the same with connected graphs.
For instance, take a star with center 0. Then any permutation of the leaves lead to a valid lex BFS ordering.

One option could be to make an indirect doctest using `is_chordal` on a random chordal graph, but for that me must be able to specify the lex BFS algorithm to use in `is_chordal`. Not sure it's the best way.

But may be there is an other way to check that a lex BFS ordering is valid ?



---

archive/issue_comments_129896.json:
```json
{
    "body": "Ok, I see the problem. The paper \"LexBFS-orderings and powers of graphs\" (doi:10.1007/3-540-62559-3_15) has a characterization of LBFS orderings in Lemma 1 that looks pretty easy to implement. What do you think about an `_is_lbfs(graph, order)` function that could be used to test the outputs of the fast/slow algorithms? Both would return `True` when fed to `_is_lbfs`, I expect.",
    "created_at": "2020-09-03T19:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129896",
    "user": "https://github.com/orlitzky"
}
```

Ok, I see the problem. The paper "LexBFS-orderings and powers of graphs" (doi:10.1007/3-540-62559-3_15) has a characterization of LBFS orderings in Lemma 1 that looks pretty easy to implement. What do you think about an `_is_lbfs(graph, order)` function that could be used to test the outputs of the fast/slow algorithms? Both would return `True` when fed to `_is_lbfs`, I expect.



---

archive/issue_comments_129897.json:
```json
{
    "body": "Minor comment outside of the scope of the ticket: You might be able to do this for a bit more speed:\n\n```diff\n-        def l_func(x):\n-            return code[x]\n \n         # The initial_vertex is at position 0 and so named 0 in sd\n         code[0].append(n + 1)\n         now = 1\n         while vertices:\n-            v = max(vertices, key=l_func)\n+            v = max(vertices, key=code.__getitem__)\n```\n",
    "created_at": "2020-09-03T23:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129897",
    "user": "https://github.com/tscrim"
}
```

Minor comment outside of the scope of the ticket: You might be able to do this for a bit more speed:

```diff
-        def l_func(x):
-            return code[x]
 
         # The initial_vertex is at position 0 and so named 0 in sd
         code[0].append(n + 1)
         now = 1
         while vertices:
-            v = max(vertices, key=l_func)
+            v = max(vertices, key=code.__getitem__)
```




---

archive/issue_comments_129898.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-04T15:05:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129898",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_129899.json:
```json
{
    "body": "I have added a method to check that a lexBFS ordering is valid in (directed) graphs.\nI'm not yet 100% convinced that it is enough to check this property, so if you are aware of other tests, let me know.",
    "created_at": "2020-09-04T15:09:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129899",
    "user": "https://github.com/dcoudert"
}
```

I have added a method to check that a lexBFS ordering is valid in (directed) graphs.
I'm not yet 100% convinced that it is enough to check this property, so if you are aware of other tests, let me know.



---

archive/issue_comments_129900.json:
```json
{
    "body": "We're working on getting rid of this, but for now, you have to call `set_random_seed()` at the beginning of every doctest where randomness is required (i.e. the ones you've just added). Otherwise the random number generator isn't actually random, and you'll wind up testing the same example every time the tests are run.",
    "created_at": "2020-09-04T20:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129900",
    "user": "https://github.com/orlitzky"
}
```

We're working on getting rid of this, but for now, you have to call `set_random_seed()` at the beginning of every doctest where randomness is required (i.e. the ones you've just added). Otherwise the random number generator isn't actually random, and you'll wind up testing the same example every time the tests are run.



---

archive/issue_comments_129901.json:
```json
{
    "body": "Example:\n\n\n```\nThe nonnegative orthant is a proper cone::\n\n    sage: set_random_seed()\n    sage: ambient_dim = ZZ.random_element(10)\n    sage: K = cones.nonnegative_orthant(ambient_dim)\n    sage: K.is_proper()\n    True\n```\n",
    "created_at": "2020-09-04T20:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129901",
    "user": "https://github.com/orlitzky"
}
```

Example:


```
The nonnegative orthant is a proper cone::

    sage: set_random_seed()
    sage: ambient_dim = ZZ.random_element(10)
    sage: K = cones.nonnegative_orthant(ambient_dim)
    sage: K.is_proper()
    True
```




---

archive/issue_comments_129902.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-04T22:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129902",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_129903.json:
```json
{
    "body": "Thank you. I didn't know that.",
    "created_at": "2020-09-04T22:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129903",
    "user": "https://github.com/dcoudert"
}
```

Thank you. I didn't know that.



---

archive/issue_comments_129904.json:
```json
{
    "body": "I've been playing around with this, here are a few more suggestions:\n\n1. You could use `ZZ.random_element(G.num_verts())` instead of always `0` for the initial vertex in your random tests; that would improve coverage a bit.\n\n2. The documentation for the `cdef` method isn't appearing in the reference manual for me (does anyone know if that's expected?). Since you put a lot of work into the docs for `lex_BFS_fast_short_digraph`, maybe you want to move them into the main `lex_BFS` docstring?\n\n3. (Unrelated to this ticket) While you're in there, please add an extra `:` to the end of `TESTS:` in `maximum_cardinality_search()`. Right now sage doesn't recognize it as a doctest.",
    "created_at": "2020-09-06T12:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129904",
    "user": "https://github.com/orlitzky"
}
```

I've been playing around with this, here are a few more suggestions:

1. You could use `ZZ.random_element(G.num_verts())` instead of always `0` for the initial vertex in your random tests; that would improve coverage a bit.

2. The documentation for the `cdef` method isn't appearing in the reference manual for me (does anyone know if that's expected?). Since you put a lot of work into the docs for `lex_BFS_fast_short_digraph`, maybe you want to move them into the main `lex_BFS` docstring?

3. (Unrelated to this ticket) While you're in there, please add an extra `:` to the end of `TESTS:` in `maximum_cardinality_search()`. Right now sage doesn't recognize it as a doctest.



---

archive/issue_comments_129905.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-06T13:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129905",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_129906.json:
```json
{
    "body": "I have implemented your suggestions. For the algorithm, I made a copy of the description without suppressing it from the cdef method. I think it is easier this way for someone interested in this code to understand it.",
    "created_at": "2020-09-06T13:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129906",
    "user": "https://github.com/dcoudert"
}
```

I have implemented your suggestions. For the algorithm, I made a copy of the description without suppressing it from the cdef method. I think it is easier this way for someone interested in this code to understand it.



---

archive/issue_comments_129907.json:
```json
{
    "body": "Thanks! Here are two more small things:\n\nFirst, in the documentation for `lex_BFS_fast_short_digraph` (and now `lex_BFS`), there's a LaTeX typo at\n\n```\nS = `{u | i \\leq \\sigma(u) \\leq j\\}\n```\n\nThe opening curly brace isn't escaped, so the formula isn't showing up.\n\nSecond, in `_is_valid_lex_BFS_order`, it looks to me like you've figured out the correct directions for the edges to make things work with a digraph, namely `ca`, `cb`, `da`, and `db`. However the docs still have some of them in a different order from when the result was stated for an undirected graph:\n\n\n```\nif `a < b < c` and `ac \\in E` and `bc \\not\\in E`, then there exists `d\\in V`                                                                                             \nsuch that `c < d`, `bd \\in E` and `ad \\not\\in E`.\n```\n",
    "created_at": "2020-09-06T19:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129907",
    "user": "https://github.com/orlitzky"
}
```

Thanks! Here are two more small things:

First, in the documentation for `lex_BFS_fast_short_digraph` (and now `lex_BFS`), there's a LaTeX typo at

```
S = `{u | i \leq \sigma(u) \leq j\}
```

The opening curly brace isn't escaped, so the formula isn't showing up.

Second, in `_is_valid_lex_BFS_order`, it looks to me like you've figured out the correct directions for the edges to make things work with a digraph, namely `ca`, `cb`, `da`, and `db`. However the docs still have some of them in a different order from when the result was stated for an undirected graph:


```
if `a < b < c` and `ac \in E` and `bc \not\in E`, then there exists `d\in V`                                                                                             
such that `c < d`, `bd \in E` and `ad \not\in E`.
```




---

archive/issue_comments_129908.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-06T20:18:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129908",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_129909.json:
```json
{
    "body": "good catch. Hope it will be ok this time.",
    "created_at": "2020-09-06T20:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129909",
    "user": "https://github.com/dcoudert"
}
```

good catch. Hope it will be ok this time.



---

archive/issue_comments_129910.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-07T00:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129910",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_129911.json:
```json
{
    "body": "This looks good to me now, unless anyone else wants to comment. I've checked the implementation of `_is_valid_lex_BFS_order`. It's \"obviously correct\" for undirected graphs, and probably for directed graphs too although I haven't been able to find the corresponding theorem for digraphs written down.\n\nThe implementation of `lex_BFS_fast_short_digraph` is less scrutable but looks reasonable now that I understand how the algorithm works. I trust the doctests more than I trust myself in any case. Since you've been working on this for 8 years I'm inclined to say let's get it over with.",
    "created_at": "2020-09-07T00:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129911",
    "user": "https://github.com/orlitzky"
}
```

This looks good to me now, unless anyone else wants to comment. I've checked the implementation of `_is_valid_lex_BFS_order`. It's "obviously correct" for undirected graphs, and probably for directed graphs too although I haven't been able to find the corresponding theorem for digraphs written down.

The implementation of `lex_BFS_fast_short_digraph` is less scrutable but looks reasonable now that I understand how the algorithm works. I trust the doctests more than I trust myself in any case. Since you've been working on this for 8 years I'm inclined to say let's get it over with.



---

archive/issue_comments_129912.json:
```json
{
    "body": "Thank you for your help.\n\nTo understand the fast algorithm, you need to understand that a slice is nothing else than a label. When creating a subslice of a slice from position p to position q, you place the vertices of the sub slice on positions p...p+I, and the remaining vertices of the original slice at positions p+I+1...q. So the vertices in the sub slice have a larger label than the other vertices of the original slice. The tricks are to associate a position with the current slice name, to maintain the head (left most vertex of a slice) of each slice, and give a name to each  newly created subslice.\n\nTo check the property on directed graphs, its more tricky, but I'm convinced it is correct. An alternative to check the validity is to modify the slow algorith. That is, instead of selecting a vertex with largest label, we identify all candidates (vertices with same largest label), and check that the next vertex in the given order is in this pool of candidates, then select it, update labels of its neighbors and continue.\nWe can add that if needed in a future ticket.",
    "created_at": "2020-09-07T06:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129912",
    "user": "https://github.com/dcoudert"
}
```

Thank you for your help.

To understand the fast algorithm, you need to understand that a slice is nothing else than a label. When creating a subslice of a slice from position p to position q, you place the vertices of the sub slice on positions p...p+I, and the remaining vertices of the original slice at positions p+I+1...q. So the vertices in the sub slice have a larger label than the other vertices of the original slice. The tricks are to associate a position with the current slice name, to maintain the head (left most vertex of a slice) of each slice, and give a name to each  newly created subslice.

To check the property on directed graphs, its more tricky, but I'm convinced it is correct. An alternative to check the validity is to modify the slow algorith. That is, instead of selecting a vertex with largest label, we identify all candidates (vertices with same largest label), and check that the next vertex in the given order is in this pool of candidates, then select it, update labels of its neighbors and continue.
We can add that if needed in a future ticket.



---

archive/issue_comments_129913.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-15T22:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11564#issuecomment-129913",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_011641.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-15T22:00:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11564",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11564#event-11641"
}
```
