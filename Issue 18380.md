# Issue 18380: Implement polynomial number_of_terms method (and deprecate hamming_weight)

Issue created by migration from https://trac.sagemath.org/ticket/18617

Original creator: bruno

Original creation time: 2015-06-05 13:21:06

CC:  cpernet jsrn

Keywords: polynomial

Right now, there is a method `hamming_weight` to compute the number of nonzero coefficients of a polynomial. The goal of this ticket is two-fold:

1. Rename this method into `number_of_terms`: I think the name `hamming_weight` is not excessively standard for this function, thus the function may be unknown form many users. My conviction is comes in part from several discussions I have been involved in where no one seem to know of the existence of this method.

2. Implement a specialized version for sparse polynomials, in the spirit of #18518, #18585, #18600, which is much faster:


```python
sage: R.<x> = PolynomialRing(ZZ,sparse=True)
sage: p = R.random_element(10000)
sage: %timeit p.number_of_terms() # new code
The slowest run took 44.58 times longer than the fastest. This could mean that an intermediate result is being cached 
1000000 loops, best of 3: 203 ns per loop
sage: %timeit Polynomial.number_of_terms(p) # old code
100 loops, best of 3: 2.77 ms per loop
```


_Note._ While I decided to group several modifications for sparse polynomials in a single ticket #18600, I prefer keeping this change in a separate ticket since it involves a deprecation that might be controversial (though I do not expect it will be the case).



---

Comment by bruno created at 2015-06-05 13:38:08

Changing status from new to needs_review.


---

Comment by git created at 2015-06-05 13:39:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-06-05 14:00:58

There are precedents for calling the number of non-zero terms "weight" (but not "Hamming weight" as far as I know, which seems to be reserved for vectors):

1. the function `irreducible_element()` in `src/sage/rings/polynomial/polynomial_ring.py` has a `algorithm="minimal_weight"` option
2. [https://eprint.iacr.org/2007/423.pdf](https://eprint.iacr.org/2007/423.pdf)
3. NTL has a `weight` function for polynomials over `GF(2)`


---

Comment by jsrn created at 2015-06-05 14:07:01

Sparse polynomial people sometimes call this number the "sparsity" of the polynomial. Perhaps we'll get an opinion from ClÃ©ment Pernet (cc'ed). I think "weight" also makes a lot of sense though (and is better than "Hamming weight").


---

Comment by jdemeyer created at 2015-06-05 14:12:41

Replying to [comment:5 jsrn]:
> Sparse polynomial people sometimes call this number the "sparsity" of the polynomial.
My feeling is that "sparsity" should be a ratio (number of non-zero terms divided by number of terms), different from weight.


---

Comment by bruno created at 2015-06-05 14:13:14

Replying to [comment:4 jdemeyer]:
> There are precedents for calling the number of non-zero terms "weight" (but not "Hamming weight" as far as I know, which seems to be reserved for vectors):
> 
> 1. the function `irreducible_element()` in `src/sage/rings/polynomial/polynomial_ring.py` has a `algorithm="minimal_weight"` option
> 2. [https://eprint.iacr.org/2007/423.pdf](https://eprint.iacr.org/2007/423.pdf)
> 3. NTL has a `weight` function for polynomials over `GF(2)`

All your examples are for polynomials over `GF(2)`! (For 1., this is specified in the docstring: `Only implemented for `p = 2``.) I agree that in this special case, the term "weight" may be quite common, but my impression is that it is pretty rare for other base rings.

Other possibilities, in different communities, include "sparsity" (for instance in the complexity theory community) or "0-norm". Yet, I guess the name "number_of_terms" is the one most people will find by "tab exploration". 

Note that I have nothing against creating aliases, for "weight", "sparsity", and maybe to change the `norm` method to make it return the number of terms (rather than an Exception) when its argument is 0.


---

Comment by bruno created at 2015-06-05 14:14:42

Replying to [comment:6 jdemeyer]:
> Replying to [comment:5 jsrn]:
> > Sparse polynomial people sometimes call this number the "sparsity" of the polynomial.
> My feeling is that "sparsity" should be a ratio (number of non-zero terms divided by number of terms), different from weight.

As I wrote above, some people indeed use "sparsity" but I have also quite often encountered a similar reaction to yours that "sparsity" evokes a ratio. So it has the risk to be misleading.


---

Comment by cpernet created at 2015-06-05 14:19:08

I agree that sparsity is too ambiguous: either a ratio or a number of non zero terms.
Weight is maybe better than Hamming weight, but I would much rather have the natural name proposed by Bruno, as it avoids any confusion.


---

Comment by jdemeyer created at 2015-06-05 14:24:22

Replying to [comment:7 bruno]:
> All your examples are for polynomials over `GF(2)`! (For 1., this is specified in the docstring: `Only implemented for `p = 2``.) I agree that in this special case, the term "weight" may be quite common, but my impression is that it is pretty rare for other base rings.

There is no fundamental reason to restrict to `GF(2)`. I think that "weight" is simply _used_ more rarely for other rings besides `GF(2)`. This is for two reasons:
1. a "random" polynomial over `GF(2)` has a low weight (half the degree), while a "random" polynomial over most rings has weight equal to the degree. Thus, finding polynomials with small weight satisfying some property is easiest over `GF(2)`.
2. in computer algebra it often makes sense to specialize algorithms for `GF(2)`.


---

Comment by jsrn created at 2015-06-05 14:29:48

I don't personally like "sparsity" either: I've just seen it in a few papers. I think having "number_of_terms" is good and very clear, and then make "weight" an alias of it (since it is for many, I believe, a natural name to look for when tab-completing).


---

Comment by bruno created at 2015-06-05 14:32:50

Replying to [comment:10 jdemeyer]:
> There is no fundamental reason to restrict to `GF(2)`. I think that "weight" is simply _used_ more rarely for other rings besides `GF(2)`. 

I agree with that, my only point is to know whether people actually use the different possible names. 

With a search on Google for "polynomial weight", most results are about polynomials over `GF(2)`, the few others concern more generally polynomials over `GF(q)`. And furthermore, the thematic of the papers are either irreducibility of polynomials or polynomials related to error-correcting codes.

With a search for "polynomial sparsity", most papers are complexity theory paper on learning polynomials. 

All I say is that though "weight" may be standard in some domains, it is not in other ones. That's why I prefer "number of terms" that I expect to be clear for everyone.


---

Comment by chapoton created at 2015-09-28 16:58:14

does not apply, needs rebase


---

Comment by chapoton created at 2015-09-28 16:58:14

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-09-29 08:28:13

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by bruno created at 2015-09-29 08:29:07

Rebased, need review again!


---

Comment by bruno created at 2015-09-29 08:29:07

Changing status from needs_work to needs_review.


---

Comment by klee created at 2015-10-02 02:18:27

When we say the number of terms, we think of the vector of the coefficients. For the vector, the Hamming weight is a well-established concept in coding theory, and spreading to other areas. So I think the method name `hamming_weight` is well chosen. For a user, `number_of_terms` may be more intuitive, but it would not hurt and indeed be beneficial to learn a mathematical term (no pun intended).

Aside, in the history of Sage, coding theory played some role. The method name seems to be one aspect of the heritage.


---

Comment by bruno created at 2015-10-02 09:16:03

Replying to [comment:16 klee]:
> When we say the number of terms, we think of the vector of the coefficients. For the vector, the Hamming weight is a well-established concept in coding theory, and spreading to other areas. So I think the method name `hamming_weight` is well chosen. For a user, `number_of_terms` may be more intuitive, but it would not hurt and indeed be beneficial to learn a mathematical term (no pun intended).

As you tell, Hamming weight is well established in _some_ mathematical areas, but not all of them. For people working outside these areas, they would not think to look for a method `hamming_weight` and simply think that it is not implemented. (As I wrote somewhere above, I was in this case and not the only one!) With the same arguments, I could say it should be named `sparsity` since in some areas, this is the name people use. (Arguments have been given above for not using `sparsity` and I agree.)

I do not think it is a matter of learning an unknown mathematical term. Coming from theoretical computer science, I know what Hamming weight means but it is (in my mind) related to vector of bits (or boolean words). A very quick search showed that it is mainly used with the finite field `GF(2)`, sometimes with other finite fields `GF(q)`, and very rarely with non-finite fields. So I am not sure the name is generically appropriate for polynomials. (Note also that you mention that Hamming weight _of vectors_ is very standard. Here we are speaking of polynomials!)

Maybe the right solution would be to have aliases, so that coding theorists find the method under the name `hamming_weight` and others find it under the name `number_of_terms`.


> 
> Aside, in the history of Sage, coding theory played some role. The method name seems to be one aspect of the heritage.

You may well be right. But is that a (sufficient) reason to keep this name? I honestly have no opinion about this question.


---

Comment by klee created at 2015-10-02 09:33:56

The notion of Hamming weight is equally applicable to any field or even any ring.

Anyway, I think a proper procedure to add an alias in Sage is to ask in Sage devel. If other people like the idea, it will be in!


---

Comment by tscrim created at 2015-10-02 17:35:18

I would recommend just keeping it in there as an alias for `number_of_terms` (and mention the term "Hamming weight" in the docstring). There's no need to get sage-devel involved for a single (should be) non-controversial alias (which has been a long-standing method) like this.


---

Comment by chapoton created at 2015-10-17 07:03:11

does not apply


---

Comment by chapoton created at 2015-10-17 07:03:11

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-03-02 09:43:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2016-03-02 09:46:46

Changing status from needs_work to needs_review.


---

Comment by bruno created at 2016-03-02 09:46:46

Now applies. I followed [#comment:19 tscrim]'s suggestion: I removed the deprecation and replaced it by an alias. Needs review again!


---

Comment by jdemeyer created at 2016-03-02 09:47:54

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-03-02 09:47:54

Looking at the diff, `hamming_weight` is still being deprecated...


---

Comment by git created at 2016-03-02 09:50:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2016-03-02 09:51:29

Changing status from needs_work to needs_review.


---

Comment by bruno created at 2016-03-02 09:51:29

Replying to [comment:23 jdemeyer]:
> Looking at the diff, `hamming_weight` is still being deprecated...

Well, with the changes committed, this is better!


---

Comment by jdemeyer created at 2016-03-02 09:54:48

In the docstring for `number_of_terms`, mention with an example that `hamming_weight` is an alias. Something like

```
The method :meth:`hamming_weight` is an alias::

    sage: bla.hamming_weight()
    42
```


If you do this and check that doctests pass, you can set this to positive_review.


---

Comment by git created at 2016-03-02 10:08:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2016-03-02 10:10:15

Changing status from needs_review to positive_review.


---

Comment by bruno created at 2016-03-02 10:10:15

Replying to [comment:27 jdemeyer]:
> If you do this and check that doctests pass, you can set this to positive_review.

Done. I checked the doctests, as well as the documentation build. Everything looks fine.


---

Comment by vbraun created at 2016-03-02 23:30:28

Resolution: fixed
