# Issue 18758: Approximate LP solving: do not raise exceptions

archive/issues_018758.json:
```json
{
    "body": "CC:  dimpase dcoudert nmaster@stanford.edu\n\nIt has been reported by Neal Master that when solving a LP with a time limit or an optimality gap, an exception was raised whenever the solution was ... not optimal.\n\nWhich is precisely why people solve problems with such limits: to get a solution when getting an optimal one is too hard.\n\nWith this patch, no exception is raised in such situations. And two new doctests are added.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18995\n\n",
    "created_at": "2015-08-06T09:32:33Z",
    "labels": [
        "numerical",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Approximate LP solving: do not raise exceptions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18758",
    "user": "ncohen"
}
```
CC:  dimpase dcoudert nmaster@stanford.edu

It has been reported by Neal Master that when solving a LP with a time limit or an optimality gap, an exception was raised whenever the solution was ... not optimal.

Which is precisely why people solve problems with such limits: to get a solution when getting an optimal one is too hard.

With this patch, no exception is raised in such situations. And two new doctests are added.

Issue created by migration from https://trac.sagemath.org/ticket/18995





---

archive/issue_comments_256128.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-08-06T09:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18758#issuecomment-256128",
    "user": "ncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_256129.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-08-06T09:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18758#issuecomment-256129",
    "user": "ncohen"
}
```

New commits:



---

archive/issue_comments_256130.json:
```json
{
    "body": "Do any other backends suffer from the same issue?",
    "created_at": "2015-08-06T11:27:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18758#issuecomment-256130",
    "user": "dimpase"
}
```

Do any other backends suffer from the same issue?



---

archive/issue_comments_256131.json:
```json
{
    "body": "> Do any other backends suffer from the same issue?\n\nNo idea. Unfortunately, I was not able to write a solver-independent doctest.\n\nNathann",
    "created_at": "2015-08-06T11:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18758#issuecomment-256131",
    "user": "ncohen"
}
```

> Do any other backends suffer from the same issue?

No idea. Unfortunately, I was not able to write a solver-independent doctest.

Nathann



---

archive/issue_comments_256132.json:
```json
{
    "body": "I have used many times time limits and optimality gaps with cplex without difficulties.\n\n```\nsage: from sage.numerical.mip import MixedIntegerLinearProgram\nsage: g = graphs.CubeGraph(9)\nsage: p = MixedIntegerLinearProgram(solver=\"Cplex\")\nsage: p.solver_parameter(\"CPX_PARAM_EPAGAP\", 100)\nsage: b = p.new_variable(binary=True)\nsage: p.set_objective(p.sum(b[v] for v in g))\nsage: for v in g:\n....:     p.add_constraint(b[v]+p.sum(b[u] for u in g.neighbors(v)) <= 1)\n....:     \nsage: p.add_constraint(b[v] == 1) # Force an easy non-0 solution\nsage: p.solve()\n28.0\n```\n\nWith Coin, we don't have access to optimality gap or timelimit.\n\n```\nsage: p = MixedIntegerLinearProgram(solver=\"Coin\")\nsage: p.solver_parameter(\"mip_gap_tolerance\",100)\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-25-b082f5cd7a90> in <module>()\n----> 1 p.solver_parameter(\"mip_gap_tolerance\",Integer(100))\n\n/Users/dcoudert/sage/src/sage/numerical/mip.pyx in sage.numerical.mip.MixedIntegerLinearProgram.solver_parameter (/Users/dcoudert/sage/src/build/cythonized/sage/numerical/mip.c:14957)()\n   2303             return self._backend.solver_parameter(name)\n   2304         else:\n-> 2305             self._backend.solver_parameter(name, value)\n   2306 \n   2307     cpdef sum(self, L):\n\n/Users/dcoudert/sage/src/sage/numerical/backends/generic_backend.pyx in sage.numerical.backends.generic_backend.GenericBackend.solver_parameter (/Users/dcoudert/sage/src/build/cythonized/sage/numerical/backends/generic_backend.c:7780)()\n    907             sage: p.solver_parameter(\"timelimit\")                   # optional - Nonexistent_LP_solver\n    908         \"\"\"\n--> 909         raise NotImplementedError()\n    910 \n    911 \n\nNotImplementedError: \n```\n\n\nThis patch is working well and passes all tests, but you could change the ticket description to say that it solves the issue for GLPK only.",
    "created_at": "2015-08-06T12:07:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18758#issuecomment-256132",
    "user": "dcoudert"
}
```

I have used many times time limits and optimality gaps with cplex without difficulties.

```
sage: from sage.numerical.mip import MixedIntegerLinearProgram
sage: g = graphs.CubeGraph(9)
sage: p = MixedIntegerLinearProgram(solver="Cplex")
sage: p.solver_parameter("CPX_PARAM_EPAGAP", 100)
sage: b = p.new_variable(binary=True)
sage: p.set_objective(p.sum(b[v] for v in g))
sage: for v in g:
....:     p.add_constraint(b[v]+p.sum(b[u] for u in g.neighbors(v)) <= 1)
....:     
sage: p.add_constraint(b[v] == 1) # Force an easy non-0 solution
sage: p.solve()
28.0
```

With Coin, we don't have access to optimality gap or timelimit.

```
sage: p = MixedIntegerLinearProgram(solver="Coin")
sage: p.solver_parameter("mip_gap_tolerance",100)
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-25-b082f5cd7a90> in <module>()
----> 1 p.solver_parameter("mip_gap_tolerance",Integer(100))

/Users/dcoudert/sage/src/sage/numerical/mip.pyx in sage.numerical.mip.MixedIntegerLinearProgram.solver_parameter (/Users/dcoudert/sage/src/build/cythonized/sage/numerical/mip.c:14957)()
   2303             return self._backend.solver_parameter(name)
   2304         else:
-> 2305             self._backend.solver_parameter(name, value)
   2306 
   2307     cpdef sum(self, L):

/Users/dcoudert/sage/src/sage/numerical/backends/generic_backend.pyx in sage.numerical.backends.generic_backend.GenericBackend.solver_parameter (/Users/dcoudert/sage/src/build/cythonized/sage/numerical/backends/generic_backend.c:7780)()
    907             sage: p.solver_parameter("timelimit")                   # optional - Nonexistent_LP_solver
    908         """
--> 909         raise NotImplementedError()
    910 
    911 

NotImplementedError: 
```


This patch is working well and passes all tests, but you could change the ticket description to say that it solves the issue for GLPK only.



---

archive/issue_comments_256133.json:
```json
{
    "body": "Then the patch is good to go ;)",
    "created_at": "2015-08-06T12:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18758#issuecomment-256133",
    "user": "dcoudert"
}
```

Then the patch is good to go ;)



---

archive/issue_comments_256134.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-08-06T12:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18758#issuecomment-256134",
    "user": "dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_256135.json:
```json
{
    "body": "Thanks !",
    "created_at": "2015-08-06T12:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18758#issuecomment-256135",
    "user": "ncohen"
}
```

Thanks !



---

archive/issue_comments_256136.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-08-06T20:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18758",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18758#issuecomment-256136",
    "user": "vbraun"
}
```

Resolution: fixed
