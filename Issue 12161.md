# Issue 12161: Add back functionality that was inadvertantly deleted from Sage

Issue created by migration from https://trac.sagemath.org/ticket/12333

Original creator: was

Original creation time: 2012-01-21 20:44:17

Assignee: jason

I just tried one of my *favorite* command line options in Sage-4.8:

```
$ sage -grep optional |grep gap # and all kinds of other awesome command line stuff 
```

and was very surprised and disappointed that (a) `sage -grep` is just gone, and (b) there is no other equivalent command line functionality. 

Searching reveals that #12190 removed `sage -grep` from sage.  You can't just remove functionality without any comment.  At a minimum it would have to be deprecated for a year, and should also be discussed on sage-devel.  

I'm able to accomplish what I want via

```
./sage -c "search_src('optional', 'gap')"
```

However, this requires starting up Sage, which is much slower than the old `sage -grep`.   I admit that "-grep" wasn't the best command line option name -- search_src would have been better. 

The optimal fix for this ticket would be to refactor the code in sage/misc/sagedoc.py (if possible) so it can be imported without importing all Sage, then use it to implement a command line "-search_src", and add back "-grep" with a 1-year deprecation. 

Failing that, just revert #12190 for 1 year.


---

Attachment

The patch restore `sage -grep`, and `sage -grepdoc`, but uses a new simpler, one-line grep.  This has the following advantages:

 * It is significantly faster;
 * The files are searched in lexicographical order, rather than putting all the ".py" files before the ".pyx" files, etc.

In addition a new header is provided, which doesn't include the irrelevant "Type notebook() ...", and which shows the branch (if it isn't main).


---

Comment by fwclarke created at 2012-01-25 09:11:27

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2012-01-25 18:14:26

Changing status from needs_review to needs_work.


---

Comment by jhpalmieri created at 2012-01-25 18:14:26

Unfortunately, `grep --recursive ...` does not work on Solaris or OpenSolaris. These are supported platforms for Sage, so we need another approach.

As far as the banner occurs, maybe it shouldn't be there at all? Set `SAGE_BANNER=no`, as in `sage -c ...`, to omit it.

Finally, this should be rebased to some beta release of Ssge 5.0: the script sage-sage is no longer there; instead, patch `SAGE_ROOT/spkg/bin/sage`.


---

Comment by was created at 2012-01-25 18:31:24

Replying to [comment:2 jhpalmieri]:
> Unfortunately, `grep --recursive ...` does not work on Solaris or OpenSolaris. These are supported platforms for Sage, so we need another approach.
> 

But please keep `grep --recursive` for everything but Solaris. 

> As far as the banner occurs, maybe it shouldn't be there at all? Set `SAGE_BANNER=no`, as in `sage -c ...`, to omit it.

Agreed. 

> Finally, this should be rebased to some beta release of Ssge 5.0: the script sage-sage is no longer there; instead, patch `SAGE_ROOT/spkg/bin/sage`.


---

Attachment

apply to root repository


---

Comment by fwclarke created at 2012-01-27 19:37:32

apply to scripts repository


---

Comment by fwclarke created at 2012-01-27 19:58:01

Changing status from needs_work to needs_review.


---

Attachment

Replying to [comment:2 jhpalmieri]:

> Unfortunately, `grep --recursive ...` does not work on Solaris or OpenSolaris.

The code in the new [attachment:trac_12333_restore_grep_scripts.patch] should work much more generally.  It seems to be no slower than the previous approach.

> As far as the banner occurs, maybe it shouldn't be there at all? Set `SAGE_BANNER=no`, as in `sage -c ...`, to omit it. Finally, this should be rebased to some beta release of Sage 5.0: the script sage-sage is no longer there; instead, patch `SAGE_ROOT/spkg/bin/sage`.

The attachment [attachment:trac_12333_restore_grep_root.patch] patches `SAGE_ROOT/spkg/bin/sage`, removes the banner, and allows `-search_src` as a synonym for `-grep`, and `-search_doc` for `-grepdoc`.

One other modification to earlier behaviour: the `grep` option `-i` is no longer hard-wired, but it can be restored, as can other options.  For example:


```
$ sage -search_src -il clarke
sage/rings/morphism.pyx
sage/rings/number_field/number_field.py
sage/rings/number_field/number_field_element.pyx
sage/rings/number_field/number_field_ideal.py
sage/rings/number_field/unit_group.py
sage/rings/polynomial/polynomial_element_generic.py
```



---

Comment by jhpalmieri created at 2012-02-23 20:01:08

Looks good, works on sage.math, OS X, OpenSolaris. So there don't seem to be any cross-platform issues.

I'm happy with the two main patches: positive review for those. What do you think of the attached patch for the reference manual?


---

Comment by jhpalmieri created at 2012-02-23 20:01:26

Sage library


---

Attachment

Replying to [comment:5 jhpalmieri]:

> ... What do you think of the attached patch for the reference manual?

Looks good to me, so positive review for the documentation change.


---

Comment by fwclarke created at 2012-02-26 12:57:08

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-02-27 11:22:33

Resolution: fixed
