# Issue 22565: Symbolic to  SymPy convertion for generic function

archive/issues_022565.json:
```json
{
    "body": "CC:  @egourgoulhon @rwst\n\nKeywords: sympy\n\nImplement generic function coversion from Symbolic to SymPy\n\n\n\n```\nsage: a = function('A')(x,y)\n\nsage: type(A)\n<class 'sage.symbolic.function_factory.NewSymbolicFunction'>\n\nsage: type(a)\n<type 'sage.symbolic.expression.Expression'>\n\nsage: a._sympy_()\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-101-eeb95aeda6e6> in <module>()\n----> 1 a._sympy_()\n\n```\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/22802\n\n",
    "created_at": "2017-04-13T09:40:37Z",
    "labels": [
        "component: symbolics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Symbolic to  SymPy convertion for generic function",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22565",
    "user": "https://github.com/man74cio"
}
```
CC:  @egourgoulhon @rwst

Keywords: sympy

Implement generic function coversion from Symbolic to SymPy



```
sage: a = function('A')(x,y)

sage: type(A)
<class 'sage.symbolic.function_factory.NewSymbolicFunction'>

sage: type(a)
<type 'sage.symbolic.expression.Expression'>

sage: a._sympy_()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-101-eeb95aeda6e6> in <module>()
----> 1 a._sympy_()

```



Issue created by migration from https://trac.sagemath.org/ticket/22802





---

archive/issue_comments_314321.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-04-13T12:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314321",
    "user": "https://github.com/man74cio"
}
```

New commits:



---

archive/issue_comments_314322.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-13T12:56:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314322",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314323.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-14T14:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314323",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314324.json:
```json
{
    "body": "Is this ready for review (other than removing the commented out debugging code)?",
    "created_at": "2017-06-08T22:45:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314324",
    "user": "https://github.com/tscrim"
}
```

Is this ready for review (other than removing the commented out debugging code)?



---

archive/issue_comments_314325.json:
```json
{
    "body": "No, the work is still not finished : composed functions are not coverted.",
    "created_at": "2017-06-09T08:34:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314325",
    "user": "https://github.com/man74cio"
}
```

No, the work is still not finished : composed functions are not coverted.



---

archive/issue_comments_314326.json:
```json
{
    "body": "The inverse transformation was submitted to sympy in the pull request:\n\n\"sympy to sage conversion : Abstract function.\"\nhttps://github.com/sympy/sympy/pull/12826",
    "created_at": "2017-06-28T11:00:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314326",
    "user": "https://github.com/man74cio"
}
```

The inverse transformation was submitted to sympy in the pull request:

"sympy to sage conversion : Abstract function."
https://github.com/sympy/sympy/pull/12826



---

archive/issue_comments_314327.json:
```json
{
    "body": "`@`mmancini: Thanks for the link to that sympy's thread, this is good news! how is that patch incorporated into 'sage's sympy'?\n\nPlease note that there is i think some conflict of commit ff2c44d here, with the branch in #20204.",
    "created_at": "2017-07-01T06:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314327",
    "user": "https://github.com/mforets"
}
```

`@`mmancini: Thanks for the link to that sympy's thread, this is good news! how is that patch incorporated into 'sage's sympy'?

Please note that there is i think some conflict of commit ff2c44d here, with the branch in #20204.



---

archive/issue_comments_314328.json:
```json
{
    "body": "We can do either a patch ticket (i.e., adding it to `build/pkgs/sympy/patches/`) or wait for SymPy to accept the PR, then do an upgrade ticket here.",
    "created_at": "2017-07-01T06:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314328",
    "user": "https://github.com/rwst"
}
```

We can do either a patch ticket (i.e., adding it to `build/pkgs/sympy/patches/`) or wait for SymPy to accept the PR, then do an upgrade ticket here.



---

archive/issue_comments_314329.json:
```json
{
    "body": "The PR on sympy si passed , I added tests and resolved some problems.\nAdd the page will be a great thing but I don't know if it is necessary for the moment.\n\nConcerning the conflicts with #20204 : I did not see this ticket before, but yes, some problems could arrive.",
    "created_at": "2017-07-12T13:47:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314329",
    "user": "https://github.com/man74cio"
}
```

The PR on sympy si passed , I added tests and resolved some problems.
Add the page will be a great thing but I don't know if it is necessary for the moment.

Concerning the conflicts with #20204 : I did not see this ticket before, but yes, some problems could arrive.



---

archive/issue_comments_314330.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-18T14:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314330",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314331.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-18T19:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314331",
    "user": "https://github.com/man74cio"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_314332.json:
```json
{
    "body": "The conversion of generic functions (also derivatives and composed functions) between sage and sympy works fine.\nFor the full operabilty changes in sympy (https://github.com/sympy/sympy/pull/12826) are needed",
    "created_at": "2017-07-18T19:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314332",
    "user": "https://github.com/man74cio"
}
```

The conversion of generic functions (also derivatives and composed functions) between sage and sympy works fine.
For the full operabilty changes in sympy (https://github.com/sympy/sympy/pull/12826) are needed



---

archive/issue_comments_314333.json:
```json
{
    "body": "If you need upstream changes, you will have to add the corresponding patch to our version of sympy. For better granularity, it might be better to do the patching on a separate ticket.",
    "created_at": "2017-07-18T23:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314333",
    "user": "https://github.com/tscrim"
}
```

If you need upstream changes, you will have to add the corresponding patch to our version of sympy. For better granularity, it might be better to do the patching on a separate ticket.



---

archive/issue_comments_314334.json:
```json
{
    "body": "How can I patch the sage version of sympy it is not versioned in git. Have you some doc?",
    "created_at": "2017-07-19T05:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314334",
    "user": "https://github.com/man74cio"
}
```

How can I patch the sage version of sympy it is not versioned in git. Have you some doc?



---

archive/issue_comments_314335.json:
```json
{
    "body": "You create a patch from the git commit. I think the command is something like `git diff -p <commit>`, but it should be easy enough to find examples via Google. From there, you simply add the patch to the `$SAGE_ROOT/build/pkgs/sympy/patches` folder, bump the corresponding `package-version.txt` to `1.0.p3`, and commit. To test, you should simply need to run `make build` and then test as usual.",
    "created_at": "2017-07-19T11:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314335",
    "user": "https://github.com/tscrim"
}
```

You create a patch from the git commit. I think the command is something like `git diff -p <commit>`, but it should be easy enough to find examples via Google. From there, you simply add the patch to the `$SAGE_ROOT/build/pkgs/sympy/patches` folder, bump the corresponding `package-version.txt` to `1.0.p3`, and commit. To test, you should simply need to run `make build` and then test as usual.



---

archive/issue_comments_314336.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-20T11:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314336",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314337.json:
```json
{
    "body": "Hello,\nI don't know if the procedure is correct:\nin $SYMPY \n\n```\ngit diff -p 6929ca35a33ba7813cd6d5828d96bc339ea06cb6 > 02_undeffun_sage.patch\n```\n\nthen \n\n\n```\nmv 02_undeffun_sage.patch $SAGE_ROOT/build/pkgs/sympy/patches/\ncat 1.0.p2 > $SAGE_ROOT/build/pkgs/sympy/package-version.txt\n```\n\n\nThe test are ok. \nI had to modify again sympy : now if the function is known in sympy (like fresneln in calculus.py tests) but not in sage, then the `AttributeError` is raised from sympy and catched in sage as before.",
    "created_at": "2017-07-20T11:39:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314337",
    "user": "https://github.com/man74cio"
}
```

Hello,
I don't know if the procedure is correct:
in $SYMPY 

```
git diff -p 6929ca35a33ba7813cd6d5828d96bc339ea06cb6 > 02_undeffun_sage.patch
```

then 


```
mv 02_undeffun_sage.patch $SAGE_ROOT/build/pkgs/sympy/patches/
cat 1.0.p2 > $SAGE_ROOT/build/pkgs/sympy/package-version.txt
```


The test are ok. 
I had to modify again sympy : now if the function is known in sympy (like fresneln in calculus.py tests) but not in sage, then the `AttributeError` is raised from sympy and catched in sage as before.



---

archive/issue_comments_314338.json:
```json
{
    "body": "It looks okay to me, but I would prefer the sympy patch to go on a separate ticket that this ticket will then depend on. You can just cherry-pick (and squash if desired) your last two commits into a new branch and then merge that branch into this one here.",
    "created_at": "2017-07-20T13:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314338",
    "user": "https://github.com/tscrim"
}
```

It looks okay to me, but I would prefer the sympy patch to go on a separate ticket that this ticket will then depend on. You can just cherry-pick (and squash if desired) your last two commits into a new branch and then merge that branch into this one here.



---

archive/issue_comments_314339.json:
```json
{
    "body": "Changes done as required.\nI hope it is ok.",
    "created_at": "2017-07-20T20:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314339",
    "user": "https://github.com/man74cio"
}
```

Changes done as required.
I hope it is ok.



---

archive/issue_comments_314340.json:
```json
{
    "body": "LGTM (with manually increased my sympy patch level for testing, but that is a change that needs to be done on #23496).",
    "created_at": "2017-07-24T00:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314340",
    "user": "https://github.com/tscrim"
}
```

LGTM (with manually increased my sympy patch level for testing, but that is a change that needs to be done on #23496).



---

archive/issue_comments_314341.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-24T00:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314341",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_314342.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2017-07-26T12:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314342",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_314343.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-07-26T12:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314343",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_314344.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-31T02:57:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314344",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314345.json:
```json
{
    "body": "Just a merge in of the latest #23496. Tests still pass, LGTM, thanks.",
    "created_at": "2017-07-31T02:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314345",
    "user": "https://github.com/tscrim"
}
```

Just a merge in of the latest #23496. Tests still pass, LGTM, thanks.



---

archive/issue_comments_314346.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-31T02:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314346",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_314347.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-08-30T20:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314347",
    "user": "https://github.com/mforets"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_314348.json:
```json
{
    "body": "while this is \"on-hold\", could `derivative` be revised? the docstring has some defects right now:\n\n- no `INPUT`\n- extra spaces that are not conventional in sage library code\n- what is `convertion ::` ?\n\nand why should the debug lines `# print(...)` be kept?",
    "created_at": "2017-08-30T20:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314348",
    "user": "https://github.com/mforets"
}
```

while this is "on-hold", could `derivative` be revised? the docstring has some defects right now:

- no `INPUT`
- extra spaces that are not conventional in sage library code
- what is `convertion ::` ?

and why should the debug lines `# print(...)` be kept?



---

archive/issue_comments_314349.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-31T09:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314349",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314350.json:
```json
{
    "body": "Changed name because typo error",
    "created_at": "2017-09-04T08:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314350",
    "user": "https://github.com/man74cio"
}
```

Changed name because typo error



---

archive/issue_comments_314351.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2017-09-04T08:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314351",
    "user": "https://github.com/man74cio"
}
```

Last 10 new commits:



---

archive/issue_comments_314352.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2017-09-04T09:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314352",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_314353.json:
```json
{
    "body": "The name of the branch was corrected",
    "created_at": "2017-09-04T09:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314353",
    "user": "https://github.com/man74cio"
}
```

The name of the branch was corrected



---

archive/issue_comments_314354.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-05T09:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314354",
    "user": "https://github.com/man74cio"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_314355.json:
```json
{
    "body": "could you please merge again with #23496 ? i haven't checked in detail, but there seem to be differences in the `composition` function,\n\nhttps://git.sagemath.org/sage.git/diff?id=eedf6da36d74e1dd3cc996201a4160d101c3b0a6\n\nand\n\nhttps://git.sagemath.org/sage.git/diff?id2=037272ccbac814ddcacd7f0df60cc68d357d3fa0&id=bc21300122019b04a30dba02aaa2cd728ff7453f\n\nof course in case of conflict we want to keep the changes introduced by #23496.",
    "created_at": "2017-09-05T09:07:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314355",
    "user": "https://github.com/mforets"
}
```

could you please merge again with #23496 ? i haven't checked in detail, but there seem to be differences in the `composition` function,

https://git.sagemath.org/sage.git/diff?id=eedf6da36d74e1dd3cc996201a4160d101c3b0a6

and

https://git.sagemath.org/sage.git/diff?id2=037272ccbac814ddcacd7f0df60cc68d357d3fa0&id=bc21300122019b04a30dba02aaa2cd728ff7453f

of course in case of conflict we want to keep the changes introduced by #23496.



---

archive/issue_comments_314356.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-05T11:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314356",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314357.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-07T00:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314357",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314358.json:
```json
{
    "body": "I did some trivial reviewer changes, but I am getting the same two real failures as on the patchbot:\n\n```\nsage -t src/sage/symbolic/expression_conversions.py\n**********************************************************************\nFile \"src/sage/symbolic/expression_conversions.py\", line 792, in sage.symbolic.expression_conversions.SympyConverter.derivative\nFailed example:\n    df_sympy = df_sage._sympy_(); df_sympy\nException raised:\n    Traceback (most recent call last):\n      File \"/home/travis/sage-build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/travis/sage-build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.symbolic.expression_conversions.SympyConverter.derivative[4]>\", line 1, in <module>\n        df_sympy = df_sage._sympy_(); df_sympy\n      File \"sage/symbolic/expression.pyx\", line 1445, in sage.symbolic.expression.Expression._sympy_ (/home/travis/sage-build/src/build/cythonized/sage/symbolic/expression.cpp:11785)\n        return sympy(self)\n      File \"/home/travis/sage-build/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.py\", line 222, in __call__\n        return self.derivative(ex, operator)\n      File \"/home/travis/sage-build/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.py\", line 815, in derivative\n        return f_sympy.diff(*sympy_arg)\n    AttributeError: 'NoneType' object has no attribute 'diff'\n**********************************************************************\nFile \"src/sage/symbolic/expression_conversions.py\", line 794, in sage.symbolic.expression_conversions.SympyConverter.derivative\nFailed example:\n    df_sympy == f_sympy.diff(x, 2, y, 1)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/travis/sage-build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/travis/sage-build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.symbolic.expression_conversions.SympyConverter.derivative[5]>\", line 1, in <module>\n        df_sympy == f_sympy.diff(x, Integer(2), y, Integer(1))\n    NameError: name 'df_sympy' is not defined\n**********************************************************************\n1 item had failures:\n   2 of   7 in sage.symbolic.expression_conversions.SympyConverter.derivative\n    [489 tests, 2 failures, 2.37 s]\n----------------------------------------------------------------------\nsage -t src/sage/symbolic/expression_conversions.py  # 2 doctests failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2017-09-07T00:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314358",
    "user": "https://github.com/tscrim"
}
```

I did some trivial reviewer changes, but I am getting the same two real failures as on the patchbot:

```
sage -t src/sage/symbolic/expression_conversions.py
**********************************************************************
File "src/sage/symbolic/expression_conversions.py", line 792, in sage.symbolic.expression_conversions.SympyConverter.derivative
Failed example:
    df_sympy = df_sage._sympy_(); df_sympy
Exception raised:
    Traceback (most recent call last):
      File "/home/travis/sage-build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/travis/sage-build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.symbolic.expression_conversions.SympyConverter.derivative[4]>", line 1, in <module>
        df_sympy = df_sage._sympy_(); df_sympy
      File "sage/symbolic/expression.pyx", line 1445, in sage.symbolic.expression.Expression._sympy_ (/home/travis/sage-build/src/build/cythonized/sage/symbolic/expression.cpp:11785)
        return sympy(self)
      File "/home/travis/sage-build/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.py", line 222, in __call__
        return self.derivative(ex, operator)
      File "/home/travis/sage-build/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.py", line 815, in derivative
        return f_sympy.diff(*sympy_arg)
    AttributeError: 'NoneType' object has no attribute 'diff'
**********************************************************************
File "src/sage/symbolic/expression_conversions.py", line 794, in sage.symbolic.expression_conversions.SympyConverter.derivative
Failed example:
    df_sympy == f_sympy.diff(x, 2, y, 1)
Exception raised:
    Traceback (most recent call last):
      File "/home/travis/sage-build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/travis/sage-build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.symbolic.expression_conversions.SympyConverter.derivative[5]>", line 1, in <module>
        df_sympy == f_sympy.diff(x, Integer(2), y, Integer(1))
    NameError: name 'df_sympy' is not defined
**********************************************************************
1 item had failures:
   2 of   7 in sage.symbolic.expression_conversions.SympyConverter.derivative
    [489 tests, 2 failures, 2.37 s]
----------------------------------------------------------------------
sage -t src/sage/symbolic/expression_conversions.py  # 2 doctests failed
----------------------------------------------------------------------
```




---

archive/issue_comments_314359.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-09-07T00:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314359",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_059297.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-09-07T00:56:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22565#event-59297"
}
```



---

archive/issue_comments_314360.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-07T14:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314360",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314361.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-07T15:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314361",
    "user": "https://github.com/man74cio"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_314362.json:
```json
{
    "body": "I do not get any of the errors reported by the patchbot. Positive review.",
    "created_at": "2017-09-08T22:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314362",
    "user": "https://github.com/tscrim"
}
```

I do not get any of the errors reported by the patchbot. Positive review.



---

archive/issue_comments_314363.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-08T22:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314363",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_314364.json:
```json
{
    "body": "there is at least a merge conflict with its dependency, introduced in \u200b5a53e12",
    "created_at": "2017-09-09T07:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314364",
    "user": "https://github.com/mforets"
}
```

there is at least a merge conflict with its dependency, introduced in ​5a53e12



---

archive/issue_comments_314365.json:
```json
{
    "body": "This is already based on the branch on #23496.",
    "created_at": "2017-09-09T14:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314365",
    "user": "https://github.com/tscrim"
}
```

This is already based on the branch on #23496.



---

archive/issue_comments_314366.json:
```json
{
    "body": "the branches do have different code for `composition` (since commit \u200b5a53e12 came after the merge). \n\nanyway, sorry for my confusion. i didn't realize that it will just overwrite the code in the dependency, but without merge conflict,\n\n\n```\n$ git checkout t/22802/public/22802_sympy_abstract_function\nSwitched to branch 't/22802/public/22802_sympy_abstract_function'\nYour branch is up-to-date with 'trac/public/22802_sympy_abstract_function'.\n$ git merge t/23496/public/23496_patch_sympy_abstract_function\nAlready up-to-date. \n```\n",
    "created_at": "2017-09-09T15:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314366",
    "user": "https://github.com/mforets"
}
```

the branches do have different code for `composition` (since commit ​5a53e12 came after the merge). 

anyway, sorry for my confusion. i didn't realize that it will just overwrite the code in the dependency, but without merge conflict,


```
$ git checkout t/22802/public/22802_sympy_abstract_function
Switched to branch 't/22802/public/22802_sympy_abstract_function'
Your branch is up-to-date with 'trac/public/22802_sympy_abstract_function'.
$ git merge t/23496/public/23496_patch_sympy_abstract_function
Already up-to-date. 
```




---

archive/issue_comments_314367.json:
```json
{
    "body": "I had remove the changes in composition because it caused problems in this branch and it was not influent in #23496",
    "created_at": "2017-09-09T15:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314367",
    "user": "https://github.com/man74cio"
}
```

I had remove the changes in composition because it caused problems in this branch and it was not influent in #23496



---

archive/issue_comments_314368.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-10T22:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22565#issuecomment-314368",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_059298.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-10T22:05:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22565",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22565#event-59298"
}
```
