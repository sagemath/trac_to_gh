# Issue 3932: Should we merge the "generate size n trees in linear time" code from  	  Ryan Dingman

archive/issues_003932.json:
```json
{
    "body": "Assignee: rlm\n\nSee http://wiki.wstein.org/2008/480a/theprojects\n\nIssue created by migration from https://trac.sagemath.org/ticket/3932\n\n",
    "created_at": "2008-08-22T18:17:46Z",
    "labels": [
        "graph theory",
        "major",
        "bug"
    ],
    "title": "Should we merge the \"generate size n trees in linear time\" code from  \t  Ryan Dingman",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/3932",
    "user": "jason"
}
```
Assignee: rlm

See http://wiki.wstein.org/2008/480a/theprojects

Issue created by migration from https://trac.sagemath.org/ticket/3932





---

archive/issue_comments_028149.json:
```json
{
    "body": "Hi Jason,\n\nthis question is not for trac, but should be discussed in [sage-devel].\n\nCheers,\n\nMichael",
    "created_at": "2008-08-22T20:03:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28149",
    "user": "mabshoff"
}
```

Hi Jason,

this question is not for trac, but should be discussed in [sage-devel].

Cheers,

Michael



---

archive/issue_comments_028150.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2009-01-22T17:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28150",
    "user": "rlm"
}
```

Changing type from defect to enhancement.



---

archive/issue_comments_028151.json:
```json
{
    "body": "YES we should!",
    "created_at": "2009-04-16T21:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28151",
    "user": "rlm"
}
```

YES we should!



---

archive/issue_comments_028152.json:
```json
{
    "body": "Well, someone ought to change the subject of the tickets Jason opened analog to this, i.e. the 480 tickets, a while ago since they kind of suck (no offense Jason :)). A ticket should have a clear goal and discussions about whether to merge code or not do not belong into trac.\n\nCheers,\n\nMichael",
    "created_at": "2009-04-16T21:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28152",
    "user": "mabshoff"
}
```

Well, someone ought to change the subject of the tickets Jason opened analog to this, i.e. the 480 tickets, a while ago since they kind of suck (no offense Jason :)). A ticket should have a clear goal and discussions about whether to merge code or not do not belong into trac.

Cheers,

Michael



---

archive/issue_comments_028153.json:
```json
{
    "body": "Replying to [comment:4 mabshoff]:\n> Well, someone ought to change the subject of the tickets Jason opened analog to this, i.e. the 480 tickets, a while ago since they kind of suck (no offense Jason :)). A ticket should have a clear goal and discussions about whether to merge code or not do not belong into trac.\n\n+1\n\nI was just touching the ticket, since Ryan is about to post a patch here.",
    "created_at": "2009-04-16T22:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28153",
    "user": "rlm"
}
```

Replying to [comment:4 mabshoff]:
> Well, someone ought to change the subject of the tickets Jason opened analog to this, i.e. the 480 tickets, a while ago since they kind of suck (no offense Jason :)). A ticket should have a clear goal and discussions about whether to merge code or not do not belong into trac.

+1

I was just touching the ticket, since Ryan is about to post a patch here.



---

archive/issue_comments_028154.json:
```json
{
    "body": "Yep, +1 to mabshoff's comments.  Sorry for the noise.  I'm glad the work is getting done, though.",
    "created_at": "2009-04-16T22:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28154",
    "user": "jason"
}
```

Yep, +1 to mabshoff's comments.  Sorry for the noise.  I'm glad the work is getting done, though.



---

archive/issue_comments_028155.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-04-29T04:56:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28155",
    "user": "rdingman"
}
```

Resolution: fixed



---

archive/issue_comments_028156.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2009-04-29T04:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28156",
    "user": "rdingman"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_028157.json:
```json
{
    "body": "Mistakenly closed this enhancement. Only intended to submit a patch.",
    "created_at": "2009-04-29T04:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28157",
    "user": "rdingman"
}
```

Mistakenly closed this enhancement. Only intended to submit a patch.



---

archive/issue_comments_028158.json:
```json
{
    "body": "Changing status from closed to reopened.",
    "created_at": "2009-04-29T04:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28158",
    "user": "rdingman"
}
```

Changing status from closed to reopened.



---

archive/issue_comments_028159.json:
```json
{
    "body": "1. Please change the `cdef void` functions to `cdef int` so that exceptions can be passed through them.\n\n2. You can add a `cdef object G` to `__next__`. Since that's the iteration step, the speed might make a sliver of difference (maybe not).\n\n3. `fixit = True` should probably be `fixit = 1` since `True` would inherit Python noise. You also don't need `if fixit == 1:`, just `if fixit:`\n\n4. This is a great patch. I'll post another patch later today which will tie this into the main tree generator, and we'll see what kind of speedups you get.",
    "created_at": "2009-04-29T15:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28159",
    "user": "rlm"
}
```

1. Please change the `cdef void` functions to `cdef int` so that exceptions can be passed through them.

2. You can add a `cdef object G` to `__next__`. Since that's the iteration step, the speed might make a sliver of difference (maybe not).

3. `fixit = True` should probably be `fixit = 1` since `True` would inherit Python noise. You also don't need `if fixit == 1:`, just `if fixit:`

4. This is a great patch. I'll post another patch later today which will tie this into the main tree generator, and we'll see what kind of speedups you get.



---

archive/issue_comments_028160.json:
```json
{
    "body": "I've made the changes noted above and replaced the patch with the new patch.",
    "created_at": "2009-04-29T15:54:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28160",
    "user": "rdingman"
}
```

I've made the changes noted above and replaced the patch with the new patch.



---

archive/issue_comments_028161.json:
```json
{
    "body": "Here's the timing improvement:\n\n\n```\nN   OLD   NEW\n6   .11   .00\n8   .87   .00\n10  58.   .01\n12  ???   .04\n15  ???   .67\n```\n",
    "created_at": "2009-04-29T16:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28161",
    "user": "rlm"
}
```

Here's the timing improvement:


```
N   OLD   NEW
6   .11   .00
8   .87   .00
10  58.   .01
12  ???   .04
15  ???   .67
```




---

archive/issue_comments_028162.json:
```json
{
    "body": "Apply this patch after trac_3932_tree_generation.patch",
    "created_at": "2009-04-29T16:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28162",
    "user": "rlm"
}
```

Apply this patch after trac_3932_tree_generation.patch



---

archive/issue_comments_028163.json:
```json
{
    "body": "Attachment\n\nPositive review to Ryan's patch. All we need now is someone to check mine.",
    "created_at": "2009-04-29T16:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28163",
    "user": "rlm"
}
```

Attachment

Positive review to Ryan's patch. All we need now is someone to check mine.



---

archive/issue_comments_028164.json:
```json
{
    "body": "`__init__`, `__dealloc__` and `__iter__` are missing docstrings and (indirect) doctests. It would also be a good idea if some of the cdef methods got some docstrings, too. \n\nCheers,\n\nMichael",
    "created_at": "2009-04-30T03:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28164",
    "user": "mabshoff"
}
```

`__init__`, `__dealloc__` and `__iter__` are missing docstrings and (indirect) doctests. It would also be a good idea if some of the cdef methods got some docstrings, too. 

Cheers,

Michael



---

archive/issue_comments_028165.json:
```json
{
    "body": "While I am in pedantic mode:\n\n```\n106\t        self.l = <int *>sage_malloc(self.n * sizeof(int)) \n107\t        self.w = <int *>sage_malloc(self.n * sizeof(int)) \n```\n\nshould verify that the allocation actually worked. If either one of them fails for whatever reason we will have the code go *boom*.\n\nAnd `__next__` also needs a doctest ;)\n\nCheers,\n\nMichael",
    "created_at": "2009-04-30T03:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28165",
    "user": "mabshoff"
}
```

While I am in pedantic mode:

```
106	        self.l = <int *>sage_malloc(self.n * sizeof(int)) 
107	        self.w = <int *>sage_malloc(self.n * sizeof(int)) 
```

should verify that the allocation actually worked. If either one of them fails for whatever reason we will have the code go *boom*.

And `__next__` also needs a doctest ;)

Cheers,

Michael



---

archive/issue_comments_028166.json:
```json
{
    "body": "- Raise a MemoryError if memory allocation fails.\n- Added more docstrings and doctest. Hopefully, the doctests are adequate as I'm still learning my way in Sage wrt doctests ;)",
    "created_at": "2009-05-05T02:28:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28166",
    "user": "rdingman"
}
```

- Raise a MemoryError if memory allocation fails.
- Added more docstrings and doctest. Hopefully, the doctests are adequate as I'm still learning my way in Sage wrt doctests ;)



---

archive/issue_comments_028167.json:
```json
{
    "body": "This patch set causes two doctest failures for me:\n\n```\n        sage -t -long devel/sage/sage/graphs/graph.py # 1 doctests failed\n        sage -t -long devel/sage/sage/graphs/graph_plot.py # 1 doctests failed\n```\n\nSpecifically:\n\n```\nsage -t -long \"devel/sage/sage/graphs/graph.py\"\n**********************************************************************\nFile \"/scratch/mabshoff/sage-4.0.alpha0/devel/sage/sage/graphs/graph.py\", line 6415:\n    sage: t.set_edge_label(0,1,-7)\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mabshoff/sage-4.0.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mabshoff/sage-4.0.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mabshoff/sage-4.0.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_134[57]>\", line 1, in <module>\n        t.set_edge_label(Integer(0),Integer(1),-Integer(7))###line 6415:\n    sage: t.set_edge_label(0,1,-7)\n      File \"/scratch/mabshoff/sage-4.0.alpha0/local/lib/python2.5/site-packages/sage/graphs/graph.py\", line 3571, in set_edge_label\n        self._backend.set_edge_label(u, v, l, self._directed)\n      File \"sparse_graph.pyx\", line 1485, in sage.graphs.base.sparse_graph.SparseGraphBackend.set_edge_label (sage/graphs/base/sparse_graph.c:15129)\n      File \"sparse_graph.pyx\", line 547, in sage.graphs.base.sparse_graph.SparseGraph.add_arc_label (sage/graphs/base/sparse_graph.c:4373)\n    RuntimeError: Label (-7) must be a nonnegative integer.\n**********************************************************************\n1 items had failures:\n   1 of  84 in __main__.example_134\n```\n\nand\n\n```\nsage -t -long \"devel/sage/sage/graphs/graph_plot.py\"        \n**********************************************************************\nFile \"/scratch/mabshoff/sage-4.0.alpha0/devel/sage/sage/graphs/graph_plot.py\", line 729:\n    sage: t.set_edge_label(0,1,-7)\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mabshoff/sage-4.0.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/scratch/mabshoff/sage-4.0.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/scratch/mabshoff/sage-4.0.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_7[53]>\", line 1, in <module>\n        t.set_edge_label(Integer(0),Integer(1),-Integer(7))###line 729:\n    sage: t.set_edge_label(0,1,-7)\n      File \"/scratch/mabshoff/sage-4.0.alpha0/local/lib/python2.5/site-packages/sage/graphs/graph.py\", line 3571, in set_edge_label\n        self._backend.set_edge_label(u, v, l, self._directed)\n      File \"sparse_graph.pyx\", line 1485, in sage.graphs.base.sparse_graph.SparseGraphBackend.set_edge_label (sage/graphs/base/sparse_graph.c:15129)\n      File \"sparse_graph.pyx\", line 547, in sage.graphs.base.sparse_graph.SparseGraph.add_arc_label (sage/graphs/base/sparse_graph.c:4373)\n    RuntimeError: Label (-7) must be a nonnegative integer.\n```\n\n\nCheers,\n\nMichael",
    "created_at": "2009-05-13T18:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28167",
    "user": "mabshoff"
}
```

This patch set causes two doctest failures for me:

```
        sage -t -long devel/sage/sage/graphs/graph.py # 1 doctests failed
        sage -t -long devel/sage/sage/graphs/graph_plot.py # 1 doctests failed
```

Specifically:

```
sage -t -long "devel/sage/sage/graphs/graph.py"
**********************************************************************
File "/scratch/mabshoff/sage-4.0.alpha0/devel/sage/sage/graphs/graph.py", line 6415:
    sage: t.set_edge_label(0,1,-7)
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mabshoff/sage-4.0.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mabshoff/sage-4.0.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mabshoff/sage-4.0.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_134[57]>", line 1, in <module>
        t.set_edge_label(Integer(0),Integer(1),-Integer(7))###line 6415:
    sage: t.set_edge_label(0,1,-7)
      File "/scratch/mabshoff/sage-4.0.alpha0/local/lib/python2.5/site-packages/sage/graphs/graph.py", line 3571, in set_edge_label
        self._backend.set_edge_label(u, v, l, self._directed)
      File "sparse_graph.pyx", line 1485, in sage.graphs.base.sparse_graph.SparseGraphBackend.set_edge_label (sage/graphs/base/sparse_graph.c:15129)
      File "sparse_graph.pyx", line 547, in sage.graphs.base.sparse_graph.SparseGraph.add_arc_label (sage/graphs/base/sparse_graph.c:4373)
    RuntimeError: Label (-7) must be a nonnegative integer.
**********************************************************************
1 items had failures:
   1 of  84 in __main__.example_134
```

and

```
sage -t -long "devel/sage/sage/graphs/graph_plot.py"        
**********************************************************************
File "/scratch/mabshoff/sage-4.0.alpha0/devel/sage/sage/graphs/graph_plot.py", line 729:
    sage: t.set_edge_label(0,1,-7)
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mabshoff/sage-4.0.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/scratch/mabshoff/sage-4.0.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/scratch/mabshoff/sage-4.0.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_7[53]>", line 1, in <module>
        t.set_edge_label(Integer(0),Integer(1),-Integer(7))###line 729:
    sage: t.set_edge_label(0,1,-7)
      File "/scratch/mabshoff/sage-4.0.alpha0/local/lib/python2.5/site-packages/sage/graphs/graph.py", line 3571, in set_edge_label
        self._backend.set_edge_label(u, v, l, self._directed)
      File "sparse_graph.pyx", line 1485, in sage.graphs.base.sparse_graph.SparseGraphBackend.set_edge_label (sage/graphs/base/sparse_graph.c:15129)
      File "sparse_graph.pyx", line 547, in sage.graphs.base.sparse_graph.SparseGraph.add_arc_label (sage/graphs/base/sparse_graph.c:4373)
    RuntimeError: Label (-7) must be a nonnegative integer.
```


Cheers,

Michael



---

archive/issue_comments_028168.json:
```json
{
    "body": "Attachment",
    "created_at": "2009-05-17T03:49:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28168",
    "user": "rdingman"
}
```

Attachment



---

archive/issue_comments_028169.json:
```json
{
    "body": "Robert let me know that the c_graph backend for graphs isn't as functional as the networkx backend. I switched to the tree generation code to use the networkx backend. This change fixes the doctests, but takes is about 2 times slower.",
    "created_at": "2009-05-17T03:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28169",
    "user": "rdingman"
}
```

Robert let me know that the c_graph backend for graphs isn't as functional as the networkx backend. I switched to the tree generation code to use the networkx backend. This change fixes the doctests, but takes is about 2 times slower.



---

archive/issue_comments_028170.json:
```json
{
    "body": "I like the approach here. With luck, our sprint at Sage Days will allow us to use `c_graph` as default, and get that factor of 2 back.",
    "created_at": "2009-05-17T05:52:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28170",
    "user": "rlm"
}
```

I like the approach here. With luck, our sprint at Sage Days will allow us to use `c_graph` as default, and get that factor of 2 back.



---

archive/issue_comments_028171.json:
```json
{
    "body": "Merged both patches in Sage 4.0.rc0.\n\nCheers,\n\nMichael",
    "created_at": "2009-05-18T23:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28171",
    "user": "mabshoff"
}
```

Merged both patches in Sage 4.0.rc0.

Cheers,

Michael



---

archive/issue_comments_028172.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2009-05-18T23:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28172",
    "user": "mabshoff"
}
```

Resolution: fixed



---

archive/issue_comments_028173.json:
```json
{
    "body": "Replying to [comment:11 rlm]:\n> Here's the timing improvement:\n> \n> {{{\n> N   OLD   NEW\n> 6   .11   .00\n> 8   .87   .00\n> 10  58.   .01\n> 12  ???   .04\n> 15  ???   .67\n> }}}\n\n\nHi Robert. I'm writing the release tour for Sage 4.0. To showcase the feature introduced by this ticket, is it possible for you to show me the code you used to obtain the above timing statistics?",
    "created_at": "2009-06-01T16:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28173",
    "user": "mvngu"
}
```

Replying to [comment:11 rlm]:
> Here's the timing improvement:
> 
> {{{
> N   OLD   NEW
> 6   .11   .00
> 8   .87   .00
> 10  58.   .01
> 12  ???   .04
> 15  ???   .67
> }}}


Hi Robert. I'm writing the release tour for Sage 4.0. To showcase the feature introduced by this ticket, is it possible for you to show me the code you used to obtain the above timing statistics?



---

archive/issue_comments_028174.json:
```json
{
    "body": "\n```\nsage: L = list(graphs.trees(n))\n```\n\nor something very similar.",
    "created_at": "2009-06-01T17:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3932#issuecomment-28174",
    "user": "rlm"
}
```


```
sage: L = list(graphs.trees(n))
```

or something very similar.
