# Issue 14752: Conversion failure from `ZZ[i]` to `CC`

archive/issues_014752.json:
```json
{
    "body": "`ComplexField_class._element_constructor_` calls `x.parent().polynomial()` when `isinstance(x, NumberFieldElement_quadratic)`, but not all objects of class `NumberFieldElement_quadratic` have a number field as a parent. As a consequence, the following conversion (that I guess really should work, since it is suggested by `pushout()`) fails.\n\n\n```\nsage: QQi.<i> = NumberField(x^2+1, embedding=1.*I)\nsage: O = QQi.order(i)\nsage: from sage.categories.pushout import pushout\nsage: pushout(O, CC)\nComplex Field with 53 bits of precision\nsage: CC(O.gen(1))\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-23-dbf70e6b573a> in <module>()\n----> 1 CC(O.gen(Integer(1)))\n\n/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/complex_field.pyc in __call__(self, x, im)\n    345         if im is not None:\n    346             x = x, im\n--> 347         return Parent.__call__(self, x)\n    348 \n    349     def _element_constructor_(self, x):\n\n/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8134)()\n\n/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3856)()\n\n/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3757)()\n\n/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/complex_field.pyc in _element_constructor_(self, x)\n    366 \n    367             late_import()\n--> 368             if isinstance(x, NumberFieldElement_quadratic) and list(x.parent().polynomial()) == [1, 0, 1]:\n    369                 (re, im) = list(x)\n    370                 return complex_number.ComplexNumber(self, re, im)\n\n/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__getattr__ (sage/structure/parent.c:6662)()\n\n/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/misc.so in sage.structure.misc.getattr_from_other_class (sage/structure/misc.c:1606)()\n\nAttributeError: 'AbsoluteOrder_with_category' object has no attribute 'polynomial'\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/14989\n\n",
    "created_at": "2013-07-31T16:03:28Z",
    "labels": [
        "misc",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "Conversion failure from `ZZ[i]` to `CC`",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14752",
    "user": "mmezzarobba"
}
```
`ComplexField_class._element_constructor_` calls `x.parent().polynomial()` when `isinstance(x, NumberFieldElement_quadratic)`, but not all objects of class `NumberFieldElement_quadratic` have a number field as a parent. As a consequence, the following conversion (that I guess really should work, since it is suggested by `pushout()`) fails.


```
sage: QQi.<i> = NumberField(x^2+1, embedding=1.*I)
sage: O = QQi.order(i)
sage: from sage.categories.pushout import pushout
sage: pushout(O, CC)
Complex Field with 53 bits of precision
sage: CC(O.gen(1))
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-23-dbf70e6b573a> in <module>()
----> 1 CC(O.gen(Integer(1)))

/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/complex_field.pyc in __call__(self, x, im)
    345         if im is not None:
    346             x = x, im
--> 347         return Parent.__call__(self, x)
    348 
    349     def _element_constructor_(self, x):

/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8134)()

/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3856)()

/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3757)()

/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/complex_field.pyc in _element_constructor_(self, x)
    366 
    367             late_import()
--> 368             if isinstance(x, NumberFieldElement_quadratic) and list(x.parent().polynomial()) == [1, 0, 1]:
    369                 (re, im) = list(x)
    370                 return complex_number.ComplexNumber(self, re, im)

/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__getattr__ (sage/structure/parent.c:6662)()

/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/misc.so in sage.structure.misc.getattr_from_other_class (sage/structure/misc.c:1606)()

AttributeError: 'AbsoluteOrder_with_category' object has no attribute 'polynomial'
```


Issue created by migration from https://trac.sagemath.org/ticket/14989





---

archive/issue_comments_188046.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-08-06T17:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14752#issuecomment-188046",
    "user": "mmezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_188047.json:
```json
{
    "body": "Hmm, the example I gave in the original ticket is not correct, since it sets up an embedding into `SR`. But the same issue occurs with an embedding into `CC`. I updated the description to reflect that.\n\nI *think* the linked patches solve the problem, but I have no idea if the \"spirit\" of the fix is right. So it would be great if someone who understands the coercion system could have a look!",
    "created_at": "2013-08-06T17:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14752#issuecomment-188047",
    "user": "mmezzarobba"
}
```

Hmm, the example I gave in the original ticket is not correct, since it sets up an embedding into `SR`. But the same issue occurs with an embedding into `CC`. I updated the description to reflect that.

I *think* the linked patches solve the problem, but I have no idea if the "spirit" of the fix is right. So it would be great if someone who understands the coercion system could have a look!



---

archive/issue_comments_188048.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-08-09T14:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14752#issuecomment-188048",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_188049.json:
```json
{
    "body": "Thanks, looks good to me",
    "created_at": "2013-08-09T14:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14752#issuecomment-188049",
    "user": "vbraun"
}
```

Thanks, looks good to me



---

archive/issue_comments_188050.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-20T22:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14752#issuecomment-188050",
    "user": "vbraun"
}
```

Resolution: fixed
