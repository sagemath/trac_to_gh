# Issue 34177: Implement Key polynomials

archive/issues_034177.json:
```json
{
    "body": "CC:  @trevorkarn @tscrim\n\nKeywords: gsoc2022 key-polynomial\n\nImplement the Key polynomials as an algebra with basis indexed by compositions.\n\nIssue created by migration from https://trac.sagemath.org/ticket/34414\n\n",
    "created_at": "2022-08-23T13:10:51Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Implement Key polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34177",
    "user": "https://github.com/trevorkarn"
}
```
CC:  @trevorkarn @tscrim

Keywords: gsoc2022 key-polynomial

Implement the Key polynomials as an algebra with basis indexed by compositions.

Issue created by migration from https://trac.sagemath.org/ticket/34414





---

archive/issue_comments_484337.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2022-08-23T13:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484337",
    "user": "https://github.com/trevorkarn"
}
```

Last 10 new commits:



---

archive/issue_comments_484338.json:
```json
{
    "body": "Set assignee to @trevorkarn.",
    "created_at": "2022-08-23T13:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484338",
    "user": "https://github.com/trevorkarn"
}
```

Set assignee to @trevorkarn.



---

archive/issue_comments_484339.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-25T04:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484339",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484340.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-25T19:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484340",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484341.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-08-29T20:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484341",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_484342.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-30T03:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484342",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484343.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-30T03:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484343",
    "user": "https://github.com/trevorkarn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_484344.json:
```json
{
    "body": "There are probably things to do to extend this in the future, but here is a working implementation for the basic computations.",
    "created_at": "2022-08-30T03:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484344",
    "user": "https://github.com/trevorkarn"
}
```

There are probably things to do to extend this in the future, but here is a working implementation for the basic computations.



---

archive/issue_comments_484345.json:
```json
{
    "body": "Some quick comments:\n\n- I might call it `KeyPolynomialBasis` or something like this to indicate that it is a choice of basis for the ring of polynomials in infinitely many variables.\n- No need to declare the metaclass. It comes from `UniqueRepresentation`.\n- In the doc, you should specify that it is indexed by integer vectors with no trailing zeros. (Ideally I would want this for the actual basis elements, but this is not worth the trouble of actually programming it.)\n- You should not need to implement `one()`. That should come from the category.\n- `expand()` should take a number of variables (optional) argument.\n- The divided difference operators are acting on polynomials and only involve polynomials. They should not be methods of the class.\n- A good check would be to show the divided difference operators on the polynomials simply swaps two indices in the weak composition (when in order) of the key polynomial basis index. (Hopefully that makes sense, I don't think I explained it too well.)\n- It would be better to implement `product` instead of `product_on_basis` as doing `(K[A] + K[B]) * (K[C] + K[D])` would go back and forth on each of the 4 products rather than just once on the pair.\n- You seem to be doing a lot of work in `expand()`. I would just do the appropriate divided difference operator as you start sorting. At the end of the day, you're having to do the classical bubble sort algorithm and not gaining anything by first using a smarter sorting algorithm.\n- It might be good to have coercions from the (infinte) polynomial rings over the same base ring implemented using `_coerce_map_from_`. Although I am not yet 100% sold on this because it neglects the name of the polynomials and it might mean dealing with subtleties when the base ring is a polynomial ring.",
    "created_at": "2022-08-30T06:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484345",
    "user": "https://github.com/tscrim"
}
```

Some quick comments:

- I might call it `KeyPolynomialBasis` or something like this to indicate that it is a choice of basis for the ring of polynomials in infinitely many variables.
- No need to declare the metaclass. It comes from `UniqueRepresentation`.
- In the doc, you should specify that it is indexed by integer vectors with no trailing zeros. (Ideally I would want this for the actual basis elements, but this is not worth the trouble of actually programming it.)
- You should not need to implement `one()`. That should come from the category.
- `expand()` should take a number of variables (optional) argument.
- The divided difference operators are acting on polynomials and only involve polynomials. They should not be methods of the class.
- A good check would be to show the divided difference operators on the polynomials simply swaps two indices in the weak composition (when in order) of the key polynomial basis index. (Hopefully that makes sense, I don't think I explained it too well.)
- It would be better to implement `product` instead of `product_on_basis` as doing `(K[A] + K[B]) * (K[C] + K[D])` would go back and forth on each of the 4 products rather than just once on the pair.
- You seem to be doing a lot of work in `expand()`. I would just do the appropriate divided difference operator as you start sorting. At the end of the day, you're having to do the classical bubble sort algorithm and not gaining anything by first using a smarter sorting algorithm.
- It might be good to have coercions from the (infinte) polynomial rings over the same base ring implemented using `_coerce_map_from_`. Although I am not yet 100% sold on this because it neglects the name of the polynomials and it might mean dealing with subtleties when the base ring is a polynomial ring.



---

archive/issue_comments_484346.json:
```json
{
    "body": "Thanks for the comments!\n\nReplying to [comment:9 tscrim]:\n> - `expand()` should take a number of variables (optional) argument.\n\nThis one I think I disagree with. The expansion is always going to be into the infinite variable polynomial ring, and the variable with largest index occuring in the expansion is implied by the composition. The only reason I see to have a number of variables argument is to have a fewer number of variables. Is that a thing that one would ever want to do mathematically? I know there is sometimes a reason to do that for expanding Schur polynomials as GLn characters, which is in my head as an analogous thing.",
    "created_at": "2022-08-30T17:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484346",
    "user": "https://github.com/trevorkarn"
}
```

Thanks for the comments!

Replying to [comment:9 tscrim]:
> - `expand()` should take a number of variables (optional) argument.

This one I think I disagree with. The expansion is always going to be into the infinite variable polynomial ring, and the variable with largest index occuring in the expansion is implied by the composition. The only reason I see to have a number of variables argument is to have a fewer number of variables. Is that a thing that one would ever want to do mathematically? I know there is sometimes a reason to do that for expanding Schur polynomials as GLn characters, which is in my head as an analogous thing.



---

archive/issue_comments_484347.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-08-30T17:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484347",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_484348.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-08-30T18:01:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484348",
    "user": "https://github.com/trevorkarn"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_484349.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-08-30T21:26:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484349",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_484350.json:
```json
{
    "body": "Replying to [comment:10 tkarn]:\n> Replying to [comment:9 tscrim]:\n> > - `expand()` should take a number of variables (optional) argument.\n> \n> This one I think I disagree with. The expansion is always going to be into the infinite variable polynomial ring, and the variable with largest index occuring in the expansion is implied by the composition.\n\nI might want to do the expansion in a finite polynomial ring of my choosing. You will probably have to do something slightly special when the number of variables is less than the natural minimal number.\n\n> The only reason I see to have a number of variables argument is to have a fewer number of variables. Is that a thing that one would ever want to do mathematically? I know there is sometimes a reason to do that for expanding Schur polynomials as GLn characters, which is in my head as an analogous thing.\n\nOn the contrary, you might want it to be living in a larger polynomial ring. You are equating the weak compositions up to trailing zeros, but what if I want to look at all key polynomials in, say, a 4 variable polynomial ring only? This can matter for coercion and substitution purposes.\n\nActually, that makes me think we probably should also implement a true finite number of variables version. Mathematically, you are secretly implementing the projective limit coming from a tower of polynomial rings under the natural projections (which when precomposed with the natural inclusions give the identity map on each component). The key basis with `n` variables is naturally a subset of the key basis of `n + k` variables. The integer vectors are already available:\n\n```\nsage: IV3 = IntegerVectors(k=3)\nsage: IV3\nInteger vectors of length 3\n```\n\nThis might also give some speedups for some of the computations.\n\nLastly, instead of modifying `_element_constructor_`, you are probably better off implementing a new `_monomial` function to strip trailing 0s in the infinite variable case. The infinite polynomial ring would then be handled by the coercion mentioned above. This would make other construction methods more uniform.",
    "created_at": "2022-08-31T00:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484350",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:10 tkarn]:
> Replying to [comment:9 tscrim]:
> > - `expand()` should take a number of variables (optional) argument.
> 
> This one I think I disagree with. The expansion is always going to be into the infinite variable polynomial ring, and the variable with largest index occuring in the expansion is implied by the composition.

I might want to do the expansion in a finite polynomial ring of my choosing. You will probably have to do something slightly special when the number of variables is less than the natural minimal number.

> The only reason I see to have a number of variables argument is to have a fewer number of variables. Is that a thing that one would ever want to do mathematically? I know there is sometimes a reason to do that for expanding Schur polynomials as GLn characters, which is in my head as an analogous thing.

On the contrary, you might want it to be living in a larger polynomial ring. You are equating the weak compositions up to trailing zeros, but what if I want to look at all key polynomials in, say, a 4 variable polynomial ring only? This can matter for coercion and substitution purposes.

Actually, that makes me think we probably should also implement a true finite number of variables version. Mathematically, you are secretly implementing the projective limit coming from a tower of polynomial rings under the natural projections (which when precomposed with the natural inclusions give the identity map on each component). The key basis with `n` variables is naturally a subset of the key basis of `n + k` variables. The integer vectors are already available:

```
sage: IV3 = IntegerVectors(k=3)
sage: IV3
Integer vectors of length 3
```

This might also give some speedups for some of the computations.

Lastly, instead of modifying `_element_constructor_`, you are probably better off implementing a new `_monomial` function to strip trailing 0s in the infinite variable case. The infinite polynomial ring would then be handled by the coercion mentioned above. This would make other construction methods more uniform.



---

archive/issue_comments_484351.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-09-06T21:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484351",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_484352.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-07T00:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484352",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484353.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-08T21:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484353",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484354.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-09-09T03:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484354",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_484355.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-10T21:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484355",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484356.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-10T22:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484356",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484357.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-11T15:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484357",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484358.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-09-11T15:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484358",
    "user": "https://github.com/trevorkarn"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_484359.json:
```json
{
    "body": "It now accepts a specified polynomial ring or a specified number of variables.",
    "created_at": "2022-09-11T15:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484359",
    "user": "https://github.com/trevorkarn"
}
```

It now accepts a specified polynomial ring or a specified number of variables.



---

archive/issue_comments_484360.json:
```json
{
    "body": "You should have a separate function/method that parses the input for `pi` and `divided_difference` so that they handle their inputs in the same way.\n\nThe `_divided_difference()` should not work monomial by monomial, but instead just do the division on the polynomial. I am pretty sure this will be faster for larger polynomials. If this was a deliberate choice, then please provide some timings.\n\nThe string representation of the `Parent` is better saying \u201cKey polynomial basis of {BR}\u201d.\n\nThe docstring of the `Parent` should start with a one line description, and possibly a longer more mathematical description. Afterwards, the lines after `EXAMPLES:` is over-indented.\n\nYou don\u2019t need to hold onto `_basis_keys`. This is already done by `_indices` (or if you want a little less encapsulation breaking, `self.basis().keys()`).",
    "created_at": "2022-09-11T23:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484360",
    "user": "https://github.com/tscrim"
}
```

You should have a separate function/method that parses the input for `pi` and `divided_difference` so that they handle their inputs in the same way.

The `_divided_difference()` should not work monomial by monomial, but instead just do the division on the polynomial. I am pretty sure this will be faster for larger polynomials. If this was a deliberate choice, then please provide some timings.

The string representation of the `Parent` is better saying “Key polynomial basis of {BR}”.

The docstring of the `Parent` should start with a one line description, and possibly a longer more mathematical description. Afterwards, the lines after `EXAMPLES:` is over-indented.

You don’t need to hold onto `_basis_keys`. This is already done by `_indices` (or if you want a little less encapsulation breaking, `self.basis().keys()`).



---

archive/issue_comments_484361.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-09-13T16:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484361",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_484362.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-09-13T16:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484362",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_484363.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-13T18:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484363",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484364.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-09-13T18:57:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484364",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_484365.json:
```json
{
    "body": "Replying to [comment:29 git]:\n> Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n> ||[7e01109](https://git.sagemath.org/sage.git/commit/?id=7e01109ae78f947e010b08b081789267a2944f96)||`rename key polynomial basis and make constructor`||\n> ||[7b43c50](https://git.sagemath.org/sage.git/commit/?id=7b43c5056e5a3d839b65c09a464500ea33b43297)||`First draft of finite polynomial`||\n> ||[136e323](https://git.sagemath.org/sage.git/commit/?id=136e32313022b297bf9fca47c311c542079d8548)||`Replace the strong referernce to _IntegerVectors to deal with specified lengths.`||\n> ||[9f88795](https://git.sagemath.org/sage.git/commit/?id=9f887953743a1b2a9479c9460b258ab60172c580)||`Add trim only when in infinite case`||\n> ||[5876a85](https://git.sagemath.org/sage.git/commit/?id=5876a858ab931c80f3ed581de4d7bbecb5a91835)||`Fix error in self._basis_keys`||\n> ||[a0cd0f0](https://git.sagemath.org/sage.git/commit/?id=a0cd0f0059c47c0bbba5dca1d7ad4d803d57dcb8)||`All tests pass`||\n> ||[e20e2a0](https://git.sagemath.org/sage.git/commit/?id=e20e2a027fc9a928e1e7853f856462a63c0a48d4)||`Combine finite and infinte classes`||\n> ||[fe0f762](https://git.sagemath.org/sage.git/commit/?id=fe0f7624d8ddae6ef16a494f212e1cdcc42c9a4d)||`Fix vector length bug`||\n> ||[124638c](https://git.sagemath.org/sage.git/commit/?id=124638ccb2ab0fafda5dcab1461e177a33cbb2cc)||`Add tests`||\n> ||[af76efb](https://git.sagemath.org/sage.git/commit/?id=af76efb4433159cd2e7b03ff2ce88d8c5d34ec41)||`self._basis_keys -> self._indices, simplify key polynomial basis repr, add a sentence for class level description`||\n\nRebasing off of #34527",
    "created_at": "2022-09-13T18:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484365",
    "user": "https://github.com/trevorkarn"
}
```

Replying to [comment:29 git]:
> Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
> ||[7e01109](https://git.sagemath.org/sage.git/commit/?id=7e01109ae78f947e010b08b081789267a2944f96)||`rename key polynomial basis and make constructor`||
> ||[7b43c50](https://git.sagemath.org/sage.git/commit/?id=7b43c5056e5a3d839b65c09a464500ea33b43297)||`First draft of finite polynomial`||
> ||[136e323](https://git.sagemath.org/sage.git/commit/?id=136e32313022b297bf9fca47c311c542079d8548)||`Replace the strong referernce to _IntegerVectors to deal with specified lengths.`||
> ||[9f88795](https://git.sagemath.org/sage.git/commit/?id=9f887953743a1b2a9479c9460b258ab60172c580)||`Add trim only when in infinite case`||
> ||[5876a85](https://git.sagemath.org/sage.git/commit/?id=5876a858ab931c80f3ed581de4d7bbecb5a91835)||`Fix error in self._basis_keys`||
> ||[a0cd0f0](https://git.sagemath.org/sage.git/commit/?id=a0cd0f0059c47c0bbba5dca1d7ad4d803d57dcb8)||`All tests pass`||
> ||[e20e2a0](https://git.sagemath.org/sage.git/commit/?id=e20e2a027fc9a928e1e7853f856462a63c0a48d4)||`Combine finite and infinte classes`||
> ||[fe0f762](https://git.sagemath.org/sage.git/commit/?id=fe0f7624d8ddae6ef16a494f212e1cdcc42c9a4d)||`Fix vector length bug`||
> ||[124638c](https://git.sagemath.org/sage.git/commit/?id=124638ccb2ab0fafda5dcab1461e177a33cbb2cc)||`Add tests`||
> ||[af76efb](https://git.sagemath.org/sage.git/commit/?id=af76efb4433159cd2e7b03ff2ce88d8c5d34ec41)||`self._basis_keys -> self._indices, simplify key polynomial basis repr, add a sentence for class level description`||

Rebasing off of #34527



---

archive/issue_comments_484366.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-13T21:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484366",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484367.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-09-15T04:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484367",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_484368.json:
```json
{
    "body": "After rebasing off of #34535 all tests pass.",
    "created_at": "2022-09-15T04:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484368",
    "user": "https://github.com/trevorkarn"
}
```

After rebasing off of #34535 all tests pass.



---

archive/issue_comments_484369.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-09-15T22:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484369",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_484370.json:
```json
{
    "body": "Rebased off of #34535 commit 1f0a3d0 and all tests still pass.",
    "created_at": "2022-09-15T22:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484370",
    "user": "https://github.com/trevorkarn"
}
```

Rebased off of #34535 commit 1f0a3d0 and all tests still pass.



---

archive/issue_comments_484371.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-21T17:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484371",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484372.json:
```json
{
    "body": "Is there anything I am forgetting to do on this?",
    "created_at": "2022-09-21T17:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484372",
    "user": "https://github.com/trevorkarn"
}
```

Is there anything I am forgetting to do on this?



---

archive/issue_comments_484373.json:
```json
{
    "body": "Nothing you are forgetting I think, but you can simplify the s<sub>i</sub> action:\n\n```python\nf = # some polynomial\ng = f.parent().gens()\nsf = f.subs({g[i-1]:g[i], g[i]:g[i-1]})\n```\n\nI think works (I cannot test right now). Or `f(**{repr(g[i-1]):g[i], repr(g[i]): g[i-1]})` should work.",
    "created_at": "2022-09-21T23:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484373",
    "user": "https://github.com/tscrim"
}
```

Nothing you are forgetting I think, but you can simplify the s<sub>i</sub> action:

```python
f = # some polynomial
g = f.parent().gens()
sf = f.subs({g[i-1]:g[i], g[i]:g[i-1]})
```

I think works (I cannot test right now). Or `f(**{repr(g[i-1]):g[i], repr(g[i]): g[i-1]})` should work.



---

archive/issue_comments_484374.json:
```json
{
    "body": "Replying to [comment:40 Travis Scrimshaw]:\n> Nothing you are forgetting I think, but you can simplify the s<sub>i</sub> action:\n> {{{#!python\n> f = # some polynomial\n> g = f.parent().gens()\n> sf = f.subs({g[i-1]:g[i], g[i]:g[i-1]})\n> }}}\n> I think works (I cannot test right now). Or `f(**{repr(g[i-1]):g[i], repr(g[i]): g[i-1]})` should work.\n\n\nTurns out this only works in the finite case. In the infinite case:\n\n\n```\nsage: R.<z> = InfinitePolynomialRing(QQ)\nsage: f = z[1] + z[1]*z[2]*z[3]\nsage: f.subs({z[1]:z[0]})\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\nInput In [3], in <cell line: 1>()\n----> 1 f.subs({z[Integer(1)]:z[Integer(0)]})\n\nFile ~/Applications/sage/src/sage/structure/element.pyx:830, in sage.structure.element.Element.subs()\n    828 if str(gen) in kwds:\n    829     variables.append(kwds[str(gen)])\n--> 830 elif in_dict and gen in in_dict:\n    831     variables.append(in_dict[gen])\n    832 else:\n\nTypeError: unhashable type: 'InfinitePolynomialGen'\n```\n\n\nSee #34581.",
    "created_at": "2022-09-24T15:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484374",
    "user": "https://github.com/trevorkarn"
}
```

Replying to [comment:40 Travis Scrimshaw]:
> Nothing you are forgetting I think, but you can simplify the s<sub>i</sub> action:
> {{{#!python
> f = # some polynomial
> g = f.parent().gens()
> sf = f.subs({g[i-1]:g[i], g[i]:g[i-1]})
> }}}
> I think works (I cannot test right now). Or `f(**{repr(g[i-1]):g[i], repr(g[i]): g[i-1]})` should work.


Turns out this only works in the finite case. In the infinite case:


```
sage: R.<z> = InfinitePolynomialRing(QQ)
sage: f = z[1] + z[1]*z[2]*z[3]
sage: f.subs({z[1]:z[0]})
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
Input In [3], in <cell line: 1>()
----> 1 f.subs({z[Integer(1)]:z[Integer(0)]})

File ~/Applications/sage/src/sage/structure/element.pyx:830, in sage.structure.element.Element.subs()
    828 if str(gen) in kwds:
    829     variables.append(kwds[str(gen)])
--> 830 elif in_dict and gen in in_dict:
    831     variables.append(in_dict[gen])
    832 else:

TypeError: unhashable type: 'InfinitePolynomialGen'
```


See #34581.



---

archive/issue_comments_484375.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-24T16:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484375",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484376.json:
```json
{
    "body": "Replying to [comment:40 Travis Scrimshaw]:\n> you can simplify the s<sub>i</sub> action\n\nDone in both cases without using `.subs()` for the infinite case.",
    "created_at": "2022-09-24T16:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484376",
    "user": "https://github.com/trevorkarn"
}
```

Replying to [comment:40 Travis Scrimshaw]:
> you can simplify the s<sub>i</sub> action

Done in both cases without using `.subs()` for the infinite case.



---

archive/issue_comments_484377.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-09-25T00:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484377",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_484378.json:
```json
{
    "body": "Thanks for the updates.\n\nI don't quite understand why that code works for the infinite case. I think depending on #34581 is the right way to go. We should be able to fix that one fairly quickly.\n\nSome more comments on this:\n\n- Rename `poly_gen()` -> `poly_gens()` as it returns all of the generators.\n- `while f.monomials():` seems wasteful; you can simply check `while f:` (is not 0).\n- In `from_polynomial()`, I would separate out the `self._indices(m).trim()` into a separate helper method\n  {{{#!python\nif self._k:\n    def build_index(m):\n        return self._indices(m)\nelse:\n    def build_index(m):\n        return self._indices(m).trim()\n  }}}\n  Furthermore I am not certain that the monomials and exponents will always be given in lex order. While it is a bit more computationally intensive, I think you should call `max(f.exponents())`. You can then use that to build the monomial and/or get the coefficient. This allows you to remove the code duplication.\n- Since you have an element class, you are better implementing `_mul_` there as that avoids some indirection.",
    "created_at": "2022-09-25T00:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484378",
    "user": "https://github.com/tscrim"
}
```

Thanks for the updates.

I don't quite understand why that code works for the infinite case. I think depending on #34581 is the right way to go. We should be able to fix that one fairly quickly.

Some more comments on this:

- Rename `poly_gen()` -> `poly_gens()` as it returns all of the generators.
- `while f.monomials():` seems wasteful; you can simply check `while f:` (is not 0).
- In `from_polynomial()`, I would separate out the `self._indices(m).trim()` into a separate helper method
  {{{#!python
if self._k:
    def build_index(m):
        return self._indices(m)
else:
    def build_index(m):
        return self._indices(m).trim()
  }}}
  Furthermore I am not certain that the monomials and exponents will always be given in lex order. While it is a bit more computationally intensive, I think you should call `max(f.exponents())`. You can then use that to build the monomial and/or get the coefficient. This allows you to remove the code duplication.
- Since you have an element class, you are better implementing `_mul_` there as that avoids some indirection.



---

archive/issue_comments_484379.json:
```json
{
    "body": "Also try when the base ring is something more interesting than `ZZ` or `QQ`.",
    "created_at": "2022-10-14T00:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34177#issuecomment-484379",
    "user": "https://github.com/trevorkarn"
}
```

Also try when the base ring is something more interesting than `ZZ` or `QQ`.
