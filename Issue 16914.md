# Issue 16914: symbolic Laguerre / associated Laguerre polynomials

Issue created by migration from https://trac.sagemath.org/ticket/17151

Original creator: rws

Original creation time: 2014-10-14 16:25:19

Keywords: special, function, holonomic, orthogonal

Not only is `laguerre(n,x)` not symbolic, a naive implementation is already 2x as fast at `n=100` and 10x at `n=1000`:

```
R.<x> = PolynomialRing(QQ, 'x')
def lag(n):
    return R([binomial(n,k)*(-1)^k/factorial(k) for k in xrange(n+1)])
```



---

Comment by rws created at 2014-11-09 16:58:16

New commits:


---

Comment by rws created at 2014-11-09 16:58:16

Changing status from new to needs_review.


---

Comment by git created at 2014-11-26 08:31:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2015-02-03 03:17:59

For some reason this branch is red.


---

Comment by kcrisman created at 2015-02-03 03:17:59

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-02-03 08:23:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2015-02-03 08:24:16

Changing status from needs_work to needs_review.


---

Comment by rws created at 2015-02-24 07:33:24


```
sage -t --long src/sage/symbolic/expression.pyx  # 1 doctest failed
sage -t --long src/sage/matrix/matrix2.pyx  # 1 doctest failed
sage -t --long src/sage/graphs/bipartite_graph.py  # 1 doctest failed
```



---

Comment by rws created at 2015-02-24 07:33:24

Changing status from needs_review to needs_work.


---

Comment by rws created at 2015-02-25 14:44:07

Fixed. Squashed it all into one commit.

EDIT: Or not.
----
New commits:


---

Comment by rws created at 2015-02-25 14:44:07

Changing status from needs_work to needs_review.


---

Comment by mmezzarobba created at 2015-03-12 16:49:33


```
sage: laguerre(-9, 2.)
0.000000000000000
```



```
sage: laguerre(-9, 2).n()
1566.22186244286
```



---

Comment by mmezzarobba created at 2015-03-12 16:56:00

Are the three separate cases in `_pol_laguerre()` necessary? Couldn't one just do something like

```
R = PolynomialRing(QQ, 'x')
pol = R([binomial(n,k)*(-1)**k/factorial(k) for k in xrange(n+1)])
return pol(x)
```

no matter what `x` is?


---

Comment by mmezzarobba created at 2015-03-12 17:07:31


```
sage: gen_laguerre(3, 1, x+1).expand()
-1/6*x^3 + 3/2*x^2 - 5/2*x - 1/6
sage: gen_laguerre(0, 1, x+1).expand()
...
AttributeError: 'sage.rings.integer.Integer' object has no attribute 'expand'
```



---

Comment by mmezzarobba created at 2015-03-12 17:14:51

Otherwise looks good to me overall...


---

Comment by mmezzarobba created at 2015-03-12 17:14:51

Changing status from needs_review to needs_work.


---

Comment by rws created at 2015-03-12 17:26:14

Replying to [comment:14 mmezzarobba]:
> {{{
> sage: gen_laguerre(0, 1, x+1).expand()
> ...
> AttributeError: 'sage.rings.integer.Integer' object has no attribute 'expand'
> }}}
Well that is `ZZ(1)` and cannot be expanded. I don't think we should return `SR(1)`.


---

Comment by mmezzarobba created at 2015-03-12 17:31:30

Replying to [comment:16 rws]:
> Replying to [comment:14 mmezzarobba]:
> > {{{
> > sage: gen_laguerre(0, 1, x+1).expand()
> > ...
> > AttributeError: 'sage.rings.integer.Integer' object has no attribute 'expand'
> > }}}
> Well that is `ZZ(1)` and cannot be expanded. I don't think we should return `SR(1)`.

Why? Having similar calls to the same function return elements of different parents (or even values of different types) is rarely a good idea... That being said, I don't think we should return `SR(1)` in all cases, but perhaps something like `pushout(QQ, parent(x))`.


---

Comment by rws created at 2015-03-13 09:03:53

Replying to [comment:13 mmezzarobba]:
> Are the three separate cases in `_pol_laguerre()` necessary? Couldn't one just do something like
> {{{
> R = PolynomialRing(QQ, 'x')
> pol = R([binomial(n,k)*(-1)**k/factorial(k) for k in xrange(n+1)])
> return pol(x)
> }}}
> no matter what `x` is?
No, because (apart from speed reasons) the R([...]) construction is not available in all parents. However, when investigating this I found that the argument is coerced into `SR` by the superclasses `BuiltinFunction/Function`, so it must be unwrapped for the real parent. OTOH, for simplicity the branch with `sum` would be a catch-all. Let's see if going polynomial really is faster and, if not, do only summing for all parents.


---

Comment by git created at 2015-03-13 16:12:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2015-03-13 16:13:24

> Let's see if going polynomial really is faster and, if not, do only summing for all parents.
Here's the catch: Using `R(...)` for polynomial creation makes for 5x speedup with `L(1000,x)` and 10x with `L(1000,x^2+x+1)` if `x` is a polynomial generator vs. a symbol. OTOH, summing over monomials is faster with `sum` and this is the only way to get a result for other rings.
> I don't thing we should return `SR(1)` in all cases, but perhaps something like `pushout(QQ, parent(x))`.
There is a problem: even if I return `SR(ZZ(1))`, it gets converted back somewhere to `Integer(1)`. This will have to be addressed in another ticket.


---

Comment by rws created at 2015-03-13 16:13:24

Changing status from needs_work to needs_review.


---

Comment by rws created at 2015-03-14 15:19:33

> There is a problem: even if I return `SR(ZZ(1))`, it gets converted back somewhere to `Integer(1)`. This will have to be addressed in another ticket.
See #17953.


---

Comment by rws created at 2015-03-15 16:41:02

Squashed it all into one commit. Please note I'll rename `OrthogonalPolynomial` to `OrthogonalFunction` in the other ticket, so I depend on this being merged first. In the end the type problem required a one liner in #17953 and didn't require any forced result conversion to `SR`.
----
New commits:


---

Comment by rws created at 2015-04-20 06:24:06

Passes all patchbot tests.


---

Comment by mmezzarobba created at 2015-04-22 14:38:02

Replying to [comment:18 rws]:
> Replying to [comment:13 mmezzarobba]:
> > Are the three separate cases in `_pol_laguerre()` necessary? Couldn't one just do something like
> > {{{
> > R = PolynomialRing(QQ, 'x')
> > pol = R([binomial(n,k)*(-1)**k/factorial(k) for k in xrange(n+1)])
> > return pol(x)
> > }}}
> > no matter what `x` is?
> No, because (apart from speed reasons) the R([...]) construction is not available in all parents.

I don't understand what you mean, sorry: I just tried the exact code that I suggested, and it works on all examples in the docstring, except that the result comes out in Horner form (which we could perhaps change if nothing else depends on it or somehow get or get around otherwise). What parents do you have in mind?


---

Comment by mmezzarobba created at 2015-04-22 14:38:58

I also don't like that

```
sage: laguerre(3, polygen(QQ)).parent()
Symbolic Ring
```

while for instance

```
sage: chebyshev_T(3, polygen(QQ)).parent()
Univariate Polynomial Ring in x over Rational Field
sage: pow(polygen(QQ), 3).parent()
Univariate Polynomial Ring in x over Rational Field
```



---

Comment by mmezzarobba created at 2015-04-22 14:50:48

Not a bug, but would be nice to have: the implementation doesn't seem to know that L(n, 0) = 1 and more generally L(n, α, 0) = binomial(n+α,n).


---

Comment by rws created at 2015-04-22 15:27:17

Changing status from needs_review to needs_work.


---

Comment by rws created at 2015-07-02 08:10:30

Replying to [comment:26 mmezzarobba]:
> I also don't like that
> {{{
> sage: laguerre(3, polygen(QQ)).parent()
> Symbolic Ring
> }}}
Equivalently to #16813 this behaviour can only be changed when we have #18832. EDIT: `pow` is not a `BuiltinFunction` and `chebyshev_T` uses its own `__call__` which is frowned upon. I would advise to not make this ticket dependent on the feature you suggest but to open a followup ticket.


---

Comment by rws created at 2015-07-02 13:06:04

With the new branch all other comments were addressed.
----
New commits:


---

Comment by rws created at 2015-07-02 13:06:04

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2015-08-31 13:32:28

needs rebase, does not apply


---

Comment by chapoton created at 2015-08-31 13:32:28

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2015-08-31 18:39:03

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2015-08-31 18:39:03

rebased
----
New commits:


---

Comment by mmezzarobba created at 2015-09-03 11:52:12

As explained in [comment:25 one of my previous comments], I still don't understand why you don't like the idea of using `QQ['x']` to compute the coefficients in `_pol_laguerre()` (especially since #18282 has been merged and the problem with symbolic results being computed in Horner form no longer exists). But that's something that can be fixed later and this ticket has languished long enough already.

Thanks for working on it!


---

Comment by mmezzarobba created at 2015-09-03 11:52:12

Changing status from needs_review to positive_review.


---

Comment by rws created at 2015-09-03 13:48:34

Thanks for the review.


---

Comment by vbraun created at 2015-09-04 23:52:22

Resolution: fixed
