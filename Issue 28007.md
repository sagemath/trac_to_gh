# Issue 28007: Implement Symmetry Classes of Plane Partitions

Issue created by migration from https://trac.sagemath.org/ticket/28244

Original creator: kdilks

Original creation time: 2019-07-24 03:12:14

CC:  jessicapalencia tscrim mantepse

Create classes for the different symmetry classes of plane partitions (Cyclically symmetric, Totally Symmetric, etc.), along with methods taking elements in these symmetry classes to an object in a fundamental domain (usually an order ideal in some associated poset). 


---

Comment by kdilks created at 2019-07-24 03:34:50

Current things to work on:

* I changed `all.py` from being a lazy import to a regular import because I thought it might have been keeping something from working. That change will very likely be reverted once I get a chance to confirm that I was wrong.


* Some of the poset/comparison structures at the beginning of various iterators can be streamlined or replaced with existing code (ie, `posets.ProductOfChains` is a thing, that code doesn't need to be duplicated).

* Iterator code currently saves all the generated objects to a list, sorts the list, and then goes through them one at a time. Instead of adding a generated object to a list, it should just be yielded at that point, and the very last part of each iterator that iterates over the generated list can be removed.

* Commented out existing code for iterating over plane partitions in a box using the SemistandardTableaux iterator with the code iterating over the my using antichain iterator on product of chains poset. Once the new code is cleaned up, the two should be compared.

* Documentation and doc-tests are currently minimal/missing.

* Additional methods need to be added to the various classes giving maps to order ideals in the various fundamental domains.

* Would the various fundamental domains be something that we would really want added to the posets catalog ( http://doc.sagemath.org/html/en/reference/combinat/sage/combinat/posets/poset_examples.html )?
----
New commits:


---

Comment by git created at 2019-07-25 18:12:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-25 18:22:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-25 18:48:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-25 19:36:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-25 19:48:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-26 05:52:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-26 14:47:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-26 15:24:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kdilks created at 2019-07-26 15:30:55

Set assignee to kdilks.


---

Comment by kdilks created at 2019-07-26 15:55:19

Version as of 11am CST July 26


---

Attachment

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-26 16:51:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-26 17:30:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kdilks created at 2019-07-26 19:09:24

Changing keywords from "" to "days99, IMA Coding Sprint".


---

Comment by git created at 2019-10-01 14:33:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-10-01 14:34:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-10-01 22:22:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-10-08 00:15:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-12-07 06:24:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by git created at 2020-04-06 03:38:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by git created at 2020-06-09 00:08:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-13 06:48:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-20 21:21:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-20 22:17:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by git created at 2021-08-24 21:01:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-25 21:32:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kdilks created at 2021-08-25 22:14:16

Main outstanding issues:

- Things with the same underlying plane partition are not being recognized as equal. In particular, for the following examples we want `a == b` and `b == c`, but not `a is b` nor `b is c`.


```python 
a = PlanePartitions()([[2,1],[1]])
b = PlanePartitions([2,2,2])([[2,1],[1]])
c = PlanePartitions(3)([[2,1],[1]])
```


From looking at `partitions.py`, I can see that it shouldn't be necessary to set up some kind of explicit `__equals__` method. But just having `Element = PlanePartition` at the end of the parent classes doesn't seem to be working.

- For the symmetry classes whose elements are in bijection with order ideals in an associated poset, the methods that generate this associated poset and take order ideals/antichains in this poset to plane partitions are not documented.

- Need to make some `__contains__` methods for the various symmetry classes

- Planning on pushing code for going to/from monomial ideals to a later ticket, along with methods that would take a plane partition in a symmetry class and map it to and order ideal/antichain in the associated poset (we currently only go from poset to plane partition).


---

Comment by git created at 2021-09-01 15:58:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-01 22:18:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kdilks created at 2021-09-01 22:45:12

I think the only thing left to do before review (that I am capable of doing on my own) is finishing up the documentation for possible inputs for `PlanePartitions`, likely with symlinks to the different symmetry classes.

Jessica, you can start looking over things when you get a chance. The one thing I wanted to note is that I have the method `to_order_ideal()` for a regular plane partition commented out, because without some kind of order ideal class to wrap around the result in, it's really just giving the same output as `cells()`.

Travis, I'm having issues getting plane partitions that are the same element (but being constructed with different parents) as being recognized as equal.  I.e., for the following examples we want `a == b` and `b == c`, but not `a is b` nor `b is c`.


```python 
a = PlanePartitions()([[2,1],[1]])
b = PlanePartitions([2,2,2])([[2,1],[1]])
c = PlanePartitions(4)([[2,1],[1]])
```


I've been looking at `partitions.py` and `tableau.py` where this functionality works, but I can't see what they're doing that is missing here.


---

Comment by tscrim created at 2021-09-01 23:28:10

Replying to [comment:37 kdilks]:
> Travis, I'm having issues getting plane partitions that are the same element (but being constructed with different parents) as being recognized as equal.  I.e., for the following examples we want `a == b` and `b == c`, but not `a is b` nor `b is c`.
> 
> {{{#!python 
> a = PlanePartitions()([[2,1],[1]])
> b = PlanePartitions([2,2,2])([[2,1],[1]])
> c = PlanePartitions(4)([[2,1],[1]])
> }}}
> 
> I've been looking at `partitions.py` and `tableau.py` where this functionality works, but I can't see what they're doing that is missing here.

How `ClonableArray` rich comparison works is it rejects anything that cannot be coerced into the same parent (this is what the coercion system does in general by default). `Partition` and `Tableau` work differently and implement their own custom comparisons. So either you need to implement coercions to all plane partitions (plus they have to know about it, which is backwards from how coercion is suppose to work, but you can implement a `construction` with a construction functor, which is a heavy-handed way to do this) or you implement your own `__richcmp__` (recommended; just copy `Tableau.__richcmp__` and add the decorator) or `__eq__` (with a trivial `__ne__`).


---

Comment by git created at 2021-09-01 23:42:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-02 15:05:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-02 15:19:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-02 17:43:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-02 18:15:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-02 18:34:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-02 20:09:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kdilks created at 2021-09-03 01:53:54

Changing status from new to needs_review.


---

Comment by jessicapalencia created at 2021-09-08 15:49:10

I don't have time to get my Sage working well enough to pull the ticket to review, but I did look at the code and it looks good overall. Travis, would you like to review the ticket?

One comment on the to_order_ideal thing you mentioned is that I'd still like to have the command for the regular plane partition class, even though it's the same output as the cells command, for consistency with the other classes. Also, even though we don't have order ideals as a class in Sage, we could still have a function to display the order ideal, since we have that function on posets. If it's not clear what I mean, I can write out the couple lines of code I have in mind tomorrow. Let me know.


---

Comment by jessicapalencia created at 2021-09-08 15:52:01

I'm cc'ing Martin Rubey, since he has asked me about the status of this ticket in the past. I am happy to see the progress!


---

Comment by tscrim created at 2021-09-13 04:36:49

I can do the review Jessica.

Remove from `combinat/all.py`:

```
+#from .plane_partition import PlanePartition, PlanePartitions
+
```


We do not want `PlanePartition` to be mutable, so it should still inherit from `ClonableArray`.

You need to justify why you are removing the `box_size` optional input. If we do decide to remove it, it needs to be deprecated.

Following Python conventions, error messages should start with a lowercase letter.

In `contains()`:

```diff
-        for i in range(len(PP)):
-            if len(self[i]) < len(PP[i]):
-                return False
+        if any(len(self[i]) < len(PP[i]) for i in range(len(PP))):
+            return False
         
-        return all([self[i][j] >= PP[i][j] for j in range(len(PP[i])) for i in range(len(PP))])        
+        return all(self[i][j] >= val for i,row in enumerate(PP) for j, val in enumerate(row))
```


Remove the commented out code in `transpose()`.

Please be more consistent about the whitespace (specifically the blanklines). Also, more general PEP8 stuff like spacing around, e.g., comparison operators.

What does `maximal_boxes()` compute? This should be documented. These are the removable corners, right? I feel like there should be a direct way to compute them rather than going through the poset code.

In `cyclically_rotate`, the optional argument is not `preserve_parents`.

In `PlanePartitions`, the symmetry bullet points are over-indented.

`PlanePartitions.to_poset()` is a bad name because it does not convert anything to a poset. I would call it `underlying_poset` or something like this.

In `from_antichain`, `if A != []:` is better as `if not A:`.

I would put the `P_in_shape_iter` before `PP_first_row_iter` just because the latter calls the former, but not the other way around.

Your `PlanePartitions_XYZ` do not need `__classcall_private__`. You are better off normalizing the input (that is, making `box_size` a tuple) in `PlanePartitions.__classcall_private__` so it is done in one place.


---

Comment by tscrim created at 2021-09-13 04:36:49

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-09-14 16:04:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-09-14 18:31:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kdilks created at 2021-09-14 19:04:55

Addressed a number of the comments.

In terms of removing `box_size` as an optional parameter for the element class, I think if a user wants to construct an element with a particular parent, then they should construct the parent and then use that to construct the element (i.e., they should do `PlanePartitions(box_size)(pp)` instead of `PlanePartition(pp, box_size)`. Otherwise, you would have to replicate all the messy code in the `PlanePartitions` factory for parsing possible `box_size` and `symmetry` inputs. I would prefer to go the deprecation route, unless there is some strong convention/reason to be able to pass parameters about a desired parent directly to the element constructor.

Maximal boxes are the removable ones. I can write a better/faster method that just scans the underlying array directly.

I'd argue that the `to_poset()` method is converting the set of plane partition in a box (with whatever symmetry) into the set (of order ideals of) the associated poset. But if it's generally accepted that methods starting with `to` convert objects into objects instead of sets of objects into sets of objects, then I can change it.
----
New commits:


---

Comment by git created at 2021-09-14 19:42:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2021-09-15 01:49:37

Replying to [comment:52 kdilks]:
> Addressed a number of the comments.
> 
> In terms of removing `box_size` as an optional parameter for the element class, I think if a user wants to construct an element with a particular parent, then they should construct the parent and then use that to construct the element (i.e., they should do `PlanePartitions(box_size)(pp)` instead of `PlanePartition(pp, box_size)`. Otherwise, you would have to replicate all the messy code in the `PlanePartitions` factory for parsing possible `box_size` and `symmetry` inputs. I would prefer to go the deprecation route, unless there is some strong convention/reason to be able to pass parameters about a desired parent directly to the element constructor.

You don't have to duplicate this. You can just pass this along to the parent constructor. (From your argument, you could extend it slightly to say that a user should just construct the parent first.)

> Maximal boxes are the removable ones. I can write a better/faster method that just scans the underlying array directly.

Thank you.

> I'd argue that the `to_poset()` method is converting the set of plane partition in a box (with whatever symmetry) into the set (of order ideals of) the associated poset. But if it's generally accepted that methods starting with `to` convert objects into objects instead of sets of objects into sets of objects, then I can change it.

It is the general convention that `to_foo` should result in a `foo` being returned. I found the name of this method initially confusing because of this.


---

Comment by git created at 2021-11-03 17:34:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-11-05 04:54:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jessicapalencia created at 2022-10-28 14:54:30

Any update? Wondering what is left to do to finish this.


---

Comment by tscrim created at 2022-10-29 08:18:16

I think all of my comments were addressed, but I am not 100% certain from the commits. This will need a rebasing to the latest `develop` and any commented out code should be removed. Otherwise it should be good to go.
