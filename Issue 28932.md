# Issue 28932: Maximal and critical angles for cones

archive/issues_028932.json:
```json
{
    "body": "CC:  @jplab @novoselt @tscrim @fchapoton\n\nMy paper with two algorithms for finding the maximal/critical angles between polyhedral convex cones was accepted:\n\n  http://www.optimization-online.org/DB_HTML/2019/01/7048.html\n\nI've already written these algorithms in sage, so it would be nice to add them to the library. I just need to clean up some of the documentation.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29169\n\n",
    "created_at": "2020-02-09T00:40:28Z",
    "labels": [
        "geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Maximal and critical angles for cones",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28932",
    "user": "@orlitzky"
}
```
CC:  @jplab @novoselt @tscrim @fchapoton

My paper with two algorithms for finding the maximal/critical angles between polyhedral convex cones was accepted:

  http://www.optimization-online.org/DB_HTML/2019/01/7048.html

I've already written these algorithms in sage, so it would be nice to add them to the library. I just need to clean up some of the documentation.


Issue created by migration from https://trac.sagemath.org/ticket/29169





---

archive/issue_comments_409499.json:
```json
{
    "body": "Work in progress on `u/mjo/ticket/29169`. Doesn't build or anything yet.",
    "created_at": "2020-02-09T01:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409499",
    "user": "@orlitzky"
}
```

Work in progress on `u/mjo/ticket/29169`. Doesn't build or anything yet.



---

archive/issue_comments_409500.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409500",
    "user": "@mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_409501.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-04-20T10:01:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409501",
    "user": "@jplab"
}
```

New commits:



---

archive/issue_comments_409502.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-23T13:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409502",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_409503.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-23T17:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409503",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_409504.json:
```json
{
    "body": "I can keep tweaking the documentation forever, but I think this is in good condition to get some third-party feedback.",
    "created_at": "2020-06-23T17:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409504",
    "user": "@orlitzky"
}
```

I can keep tweaking the documentation forever, but I think this is in good condition to get some third-party feedback.



---

archive/issue_comments_409505.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-23T17:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409505",
    "user": "@orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_409506.json:
```json
{
    "body": "(You can check the docs with `sage -docbuild --include-tests-blocks --underscore`)",
    "created_at": "2020-06-23T17:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409506",
    "user": "@orlitzky"
}
```

(You can check the docs with `sage -docbuild --include-tests-blocks --underscore`)



---

archive/issue_comments_409507.json:
```json
{
    "body": "* dependency field was missing #\n* Author field is empty",
    "created_at": "2020-06-24T06:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409507",
    "user": "@fchapoton"
}
```

* dependency field was missing #
* Author field is empty



---

archive/issue_comments_409508.json:
```json
{
    "body": "patchbot complains about coverage and unused import",
    "created_at": "2020-06-24T20:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409508",
    "user": "@fchapoton"
}
```

patchbot complains about coverage and unused import



---

archive/issue_comments_409509.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-25T03:01:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409509",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_409510.json:
```json
{
    "body": "The unused import was legit (and is now fixed), but the coverage warning is for the `critical_angles` and `max_angle` functions that are wrapped by the methods of the same name in the cone class. All of the documentation (and unit tests) is on the cone methods, because that's what people will use.\n\n(I can add some trivial tests if a happy coverage report is worth it, but so far I have avoided it as it's a complete waste of CPU time.)",
    "created_at": "2020-06-25T03:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409510",
    "user": "@orlitzky"
}
```

The unused import was legit (and is now fixed), but the coverage warning is for the `critical_angles` and `max_angle` functions that are wrapped by the methods of the same name in the cone class. All of the documentation (and unit tests) is on the cone methods, because that's what people will use.

(I can add some trivial tests if a happy coverage report is worth it, but so far I have avoided it as it's a complete waste of CPU time.)



---

archive/issue_comments_409511.json:
```json
{
    "body": "I think that coverage is mandatory, sorry. Very simple tests would do, and you can tag them with `#indirect doctest` if they do not use the method directly.\n\nMore annoying, the latest patchbot reports a `Timed Out`, which is not acceptable.",
    "created_at": "2020-06-25T08:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409511",
    "user": "@fchapoton"
}
```

I think that coverage is mandatory, sorry. Very simple tests would do, and you can tag them with `#indirect doctest` if they do not use the method directly.

More annoying, the latest patchbot reports a `Timed Out`, which is not acceptable.



---

archive/issue_comments_409512.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-27T01:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409512",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_409513.json:
```json
{
    "body": "I think that will make patchbot happy. I added some trivial tests where they were absent, and fixed the timeout issue (fingers crossed) by adding `# long time` in a bunch of places and reducing the max test size in others.",
    "created_at": "2020-06-27T01:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409513",
    "user": "@orlitzky"
}
```

I think that will make patchbot happy. I added some trivial tests where they were absent, and fixed the timeout issue (fingers crossed) by adding `# long time` in a bunch of places and reducing the max test size in others.



---

archive/issue_comments_409514.json:
```json
{
    "body": "I'm willing to review this, but I'd much rather go through it one by one.\nIs it possible to implement the functions one by one?\n\nI didn't check, maybe it all depends on each other.",
    "created_at": "2020-09-08T06:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409514",
    "user": "@kliem"
}
```

I'm willing to review this, but I'd much rather go through it one by one.
Is it possible to implement the functions one by one?

I didn't check, maybe it all depends on each other.



---

archive/issue_comments_409515.json:
```json
{
    "body": "They're largely intertwined, but I could still commit some of the helper functions individually if that would make reviewing easier.\n\nThe reason for all of the separate functions (and the size of the module) is that `critical_angles` and `max_angle` do a lot of the same stuff. The max angle is a critical angle -- so `critical_angles` will find it -- but if all we're looking for is the biggest one then we can bail out as soon as we find it. That makes `max_angle` faster, but naturally the two share a lot of code, all of which I've tried to factor out into sensibly-named helper functions.\n\nOnce I defined the helper functions, they needed docstrings, tests, and examples.... meaning that a lot of relatively trivial things shared between `critical_angles` and `max_angle` take up a page or two of code. The `inverse_spd` function, for example, is two lines of implementation and a page of docs. If only one of `critical_angles` or `max_angle` were present, all of those functions would be inlined. Some of them make sense out of context, but others like `check_gevp_feasibility` are 100% tied to the implementation of `critical_angles` and `max_angle`, and are separate only to avoid copy/pasting their code.",
    "created_at": "2020-09-08T12:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409515",
    "user": "@orlitzky"
}
```

They're largely intertwined, but I could still commit some of the helper functions individually if that would make reviewing easier.

The reason for all of the separate functions (and the size of the module) is that `critical_angles` and `max_angle` do a lot of the same stuff. The max angle is a critical angle -- so `critical_angles` will find it -- but if all we're looking for is the biggest one then we can bail out as soon as we find it. That makes `max_angle` faster, but naturally the two share a lot of code, all of which I've tried to factor out into sensibly-named helper functions.

Once I defined the helper functions, they needed docstrings, tests, and examples.... meaning that a lot of relatively trivial things shared between `critical_angles` and `max_angle` take up a page or two of code. The `inverse_spd` function, for example, is two lines of implementation and a page of docs. If only one of `critical_angles` or `max_angle` were present, all of those functions would be inlined. Some of them make sense out of context, but others like `check_gevp_feasibility` are 100% tied to the implementation of `critical_angles` and `max_angle`, and are separate only to avoid copy/pasting their code.



---

archive/issue_comments_409516.json:
```json
{
    "body": "Ok. I think I can also just look at the helper functions and work my way up.",
    "created_at": "2020-09-08T12:54:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409516",
    "user": "@kliem"
}
```

Ok. I think I can also just look at the helper functions and work my way up.



---

archive/issue_comments_409517.json:
```json
{
    "body": "- Totally minor: If your in this situation, your cone is probably the trivial cone or the ambient space for real. It sounds like you claim that it isn't:\n\n\n```diff\n-            raise ValueError(\"this cone cannot be trivial or the ambient space\")\n+            raise ValueError(\"the cone may not be trivial or the ambient space\")\n```\n\n\n  or just delete the \"this\"\n\nOther than this, the changes to `src/sage/geometry/cone.py` seem fine to me.",
    "created_at": "2020-09-16T12:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409517",
    "user": "@kliem"
}
```

- Totally minor: If your in this situation, your cone is probably the trivial cone or the ambient space for real. It sounds like you claim that it isn't:


```diff
-            raise ValueError("this cone cannot be trivial or the ambient space")
+            raise ValueError("the cone may not be trivial or the ambient space")
```


  or just delete the "this"

Other than this, the changes to `src/sage/geometry/cone.py` seem fine to me.



---

archive/issue_comments_409518.json:
```json
{
    "body": "I see what you're saying, but in informal English I think \"may not\" suffers from the same problem. Likewise for \"must not\". How about \"the cone should not be...\"? I have been unable to trick my brain into reading that incorrectly =)",
    "created_at": "2020-09-17T12:45:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409518",
    "user": "@orlitzky"
}
```

I see what you're saying, but in informal English I think "may not" suffers from the same problem. Likewise for "must not". How about "the cone should not be..."? I have been unable to trick my brain into reading that incorrectly =)



---

archive/issue_comments_409519.json:
```json
{
    "body": "`the cone should not be` is fine. I wouldn't want to worry about it too much.",
    "created_at": "2020-09-18T06:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409519",
    "user": "@kliem"
}
```

`the cone should not be` is fine. I wouldn't want to worry about it too much.



---

archive/issue_comments_409520.json:
```json
{
    "body": "- `inverse_spd`: Wouldn't that fit better into `matrix/matrix2.pyx`. This is where `cholesky` is defined.\n- `_normalize_gevp_solution`: Fine.\n- This error message is a full sentence.\n\n```diff\n+        ValueError: The ambient dimension must be a positive integer (there\n+        are no nontrivial cones in dimension 0).\n```\n\n  I think just the part in the parenthesis would be a fine error message.\n\n  otherwise `_random_admissible_cone` is fine\n- \n\n```diff\n+    # The standard cone containment tests don't work with normalized\n+    # vectors in QQbar.\n+    u_is_in_P = all( g.inner_product(u) >= 0 for g in P.dual() )\n+    v_is_in_Q = all( h.inner_product(v) >= 0 for h in Q.dual() )\n```\n\n  I would propose fixing this.\n\n```\nsage: 3/2*vector([1,-1,0]) in P                                                                                                                                                     \nTrue\nsage: QQbar(2).sqrt()*vector([1,-1,0]) in P  \n... # very long traceback\nValueError: Cannot coerce non-integral Algebraic Real 1.414213562373095? to Integer\n```\n\n  This is awful and inconsistent. There is no way you can convert the point `[3/2, -3/2, 0]` to be a lattice point.\n  According to the documentation it should have returned `False`.\n  I would propose fixing this as a dependency of this ticket:\n- outsource `dual_rays` or similar from `dual`\n- use `dual_rays` to improve `_contains` to behave coercion-like with your code\n- then you can just compute `u in P`.\n  \n  If I ask whether a rational or real algebraic point is contained in a cone, I want coercion.\n  \n  The second thing: `all( z.inner_product(h) >= 0 for h in Q )` could then be reduced to `z in Q.dual()` (which is a bit wasteful, but not more than the current state). This could be exposed somehow as well as this is the general question whether `Q` satisfies some inequality, but that is probably not a priority.\n\n- `gevp_licis` not fast, but if the time of running this is not relevant, it should be fine.",
    "created_at": "2020-09-18T08:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409520",
    "user": "@kliem"
}
```

- `inverse_spd`: Wouldn't that fit better into `matrix/matrix2.pyx`. This is where `cholesky` is defined.
- `_normalize_gevp_solution`: Fine.
- This error message is a full sentence.

```diff
+        ValueError: The ambient dimension must be a positive integer (there
+        are no nontrivial cones in dimension 0).
```

  I think just the part in the parenthesis would be a fine error message.

  otherwise `_random_admissible_cone` is fine
- 

```diff
+    # The standard cone containment tests don't work with normalized
+    # vectors in QQbar.
+    u_is_in_P = all( g.inner_product(u) >= 0 for g in P.dual() )
+    v_is_in_Q = all( h.inner_product(v) >= 0 for h in Q.dual() )
```

  I would propose fixing this.

```
sage: 3/2*vector([1,-1,0]) in P                                                                                                                                                     
True
sage: QQbar(2).sqrt()*vector([1,-1,0]) in P  
... # very long traceback
ValueError: Cannot coerce non-integral Algebraic Real 1.414213562373095? to Integer
```

  This is awful and inconsistent. There is no way you can convert the point `[3/2, -3/2, 0]` to be a lattice point.
  According to the documentation it should have returned `False`.
  I would propose fixing this as a dependency of this ticket:
- outsource `dual_rays` or similar from `dual`
- use `dual_rays` to improve `_contains` to behave coercion-like with your code
- then you can just compute `u in P`.
  
  If I ask whether a rational or real algebraic point is contained in a cone, I want coercion.
  
  The second thing: `all( z.inner_product(h) >= 0 for h in Q )` could then be reduced to `z in Q.dual()` (which is a bit wasteful, but not more than the current state). This could be exposed somehow as well as this is the general question whether `Q` satisfies some inequality, but that is probably not a priority.

- `gevp_licis` not fast, but if the time of running this is not relevant, it should be fine.



---

archive/issue_comments_409521.json:
```json
{
    "body": "In examples you define this `G_index_sets = list(gevp_licis(G))` without ever using it or printing it.",
    "created_at": "2020-09-18T08:49:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409521",
    "user": "@kliem"
}
```

In examples you define this `G_index_sets = list(gevp_licis(G))` without ever using it or printing it.



---

archive/issue_comments_409522.json:
```json
{
    "body": "Replying to [comment:24 gh-kliem]:\n>   \n> This is awful and inconsistent... If I ask whether a rational or real algebraic point is contained in a cone, I want coercion.\n>   \n\nMe too, but I anticipate that Andrey will object. The cone module is fairly strict; if you want to do anything \"dirty,\" you have to leave the lattice and move to your own vector space. You've probably seen this in other tickets of mine where I have to throw away the lattice structure of (say) a dual cone to be able to treat its rays as objects in the primal space. It's often annoying, but it's consistent within the cone module. And it's technically correct, even from the convex analysis/geometry perspective, so long as you use the traditional definition of \"dual cone\" where the elements lie in a dual vector space. So I've learned to live with it.\n\nIn either case, you are right that it should return `False` as documented.",
    "created_at": "2020-09-18T12:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409522",
    "user": "@orlitzky"
}
```

Replying to [comment:24 gh-kliem]:
>   
> This is awful and inconsistent... If I ask whether a rational or real algebraic point is contained in a cone, I want coercion.
>   

Me too, but I anticipate that Andrey will object. The cone module is fairly strict; if you want to do anything "dirty," you have to leave the lattice and move to your own vector space. You've probably seen this in other tickets of mine where I have to throw away the lattice structure of (say) a dual cone to be able to treat its rays as objects in the primal space. It's often annoying, but it's consistent within the cone module. And it's technically correct, even from the convex analysis/geometry perspective, so long as you use the traditional definition of "dual cone" where the elements lie in a dual vector space. So I've learned to live with it.

In either case, you are right that it should return `False` as documented.



---

archive/issue_comments_409523.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-09-18T12:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409523",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_409524.json:
```json
{
    "body": "How about `def contains(self, coerce=False)` or similar. So Andrey can have his way, but we are still not creating copies of stuff at places where they do not belong.\n\nIt's still strange that it would accept a vector but not a point in the dual lattice as input.\n\nIn a way it makes sense:\n\n```\nsage: 2 in range(2,5)                                                                                                                                                                                                                                                                                                                                                      \nTrue\nsage: 2.5 in range(2,5)                                                                                                                                                                                                                                                                                                                                                    \nFalse\n```\n\nThis is completely natural and I can see that you want this behavior for a cone. However, the other question should still be accessible. As you cannot change the base ring of a cone (can you?) it would be nice for the cone to provide some answer for you.\n\nReplying to [comment:26 mjo]:\n> Replying to [comment:24 gh-kliem]:\n> >   \n> > This is awful and inconsistent... If I ask whether a rational or real algebraic point is contained in a cone, I want coercion.\n> >   \n> \n> Me too, but I anticipate that Andrey will object. The cone module is fairly strict; if you want to do anything \"dirty,\" you have to leave the lattice and move to your own vector space. You've probably seen this in other tickets of mine where I have to throw away the lattice structure of (say) a dual cone to be able to treat its rays as objects in the primal space. It's often annoying, but it's consistent within the cone module. And it's technically correct, even from the convex analysis/geometry perspective, so long as you use the traditional definition of \"dual cone\" where the elements lie in a dual vector space. So I've learned to live with it.\n> \n> In either case, you are right that it should return `False` as documented.",
    "created_at": "2020-09-18T13:00:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409524",
    "user": "@kliem"
}
```

How about `def contains(self, coerce=False)` or similar. So Andrey can have his way, but we are still not creating copies of stuff at places where they do not belong.

It's still strange that it would accept a vector but not a point in the dual lattice as input.

In a way it makes sense:

```
sage: 2 in range(2,5)                                                                                                                                                                                                                                                                                                                                                      
True
sage: 2.5 in range(2,5)                                                                                                                                                                                                                                                                                                                                                    
False
```

This is completely natural and I can see that you want this behavior for a cone. However, the other question should still be accessible. As you cannot change the base ring of a cone (can you?) it would be nice for the cone to provide some answer for you.

Replying to [comment:26 mjo]:
> Replying to [comment:24 gh-kliem]:
> >   
> > This is awful and inconsistent... If I ask whether a rational or real algebraic point is contained in a cone, I want coercion.
> >   
> 
> Me too, but I anticipate that Andrey will object. The cone module is fairly strict; if you want to do anything "dirty," you have to leave the lattice and move to your own vector space. You've probably seen this in other tickets of mine where I have to throw away the lattice structure of (say) a dual cone to be able to treat its rays as objects in the primal space. It's often annoying, but it's consistent within the cone module. And it's technically correct, even from the convex analysis/geometry perspective, so long as you use the traditional definition of "dual cone" where the elements lie in a dual vector space. So I've learned to live with it.
> 
> In either case, you are right that it should return `False` as documented.



---

archive/issue_comments_409525.json:
```json
{
    "body": "Replying to [comment:28 gh-kliem]:\n> It's still strange that it would accept a vector but not a point in the dual lattice as input.\n\nFor any vector space with a basis it is quite natural to have conversion from the set of numbers, i.e. a vector from `ZZ^n` to that vector space. And the backward map is fairly natural as well. However a composition of such maps does not give a natural map between two vector spaces with chosen bases. On that ground dual lattice elements are not accepted as points in the primal lattice. And the reason why this particular case is explicitly prohibited is that it is a fairly common mistake in toric geometry to work with elements/cones of the wrong lattice, so it helps to catch mistakes. Volker's alternative code was actually having completely unrelated classes for a lattice and its dual to make sure that there is no conversion/coercion happening between them.\n\nSo I am strongly against changing this behaviour in any situation. Having explicit non-default way to mix lattices is perfectly fine, of course.",
    "created_at": "2020-09-18T15:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409525",
    "user": "@novoselt"
}
```

Replying to [comment:28 gh-kliem]:
> It's still strange that it would accept a vector but not a point in the dual lattice as input.

For any vector space with a basis it is quite natural to have conversion from the set of numbers, i.e. a vector from `ZZ^n` to that vector space. And the backward map is fairly natural as well. However a composition of such maps does not give a natural map between two vector spaces with chosen bases. On that ground dual lattice elements are not accepted as points in the primal lattice. And the reason why this particular case is explicitly prohibited is that it is a fairly common mistake in toric geometry to work with elements/cones of the wrong lattice, so it helps to catch mistakes. Volker's alternative code was actually having completely unrelated classes for a lattice and its dual to make sure that there is no conversion/coercion happening between them.

So I am strongly against changing this behaviour in any situation. Having explicit non-default way to mix lattices is perfectly fine, of course.



---

archive/issue_comments_409526.json:
```json
{
    "body": "Regarding checking rational/algebraic/float vectors for cone containment - it would be nice for it to work. The problem is, I guess, how to write down the check. For my purposes working with rational numbers was always sufficient and it has the advantage of exact computations, so no need to worry about precision issues. If you can add code to handle more cases - please do it and it has nothing to do with distinction between dual lattices!",
    "created_at": "2020-09-18T15:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409526",
    "user": "@novoselt"
}
```

Regarding checking rational/algebraic/float vectors for cone containment - it would be nice for it to work. The problem is, I guess, how to write down the check. For my purposes working with rational numbers was always sufficient and it has the advantage of exact computations, so no need to worry about precision issues. If you can add code to handle more cases - please do it and it has nothing to do with distinction between dual lattices!



---

archive/issue_comments_409527.json:
```json
{
    "body": "Replying to [comment:29 novoselt]:\n> [...] dual lattice elements are not accepted as points in the primal lattice. And the reason why this particular case is explicitly prohibited is that it is a fairly common mistake in toric geometry to work with elements/cones of the wrong lattice, so it helps to catch mistakes. Volker's alternative code was actually having completely unrelated classes for a lattice and its dual to make sure that there is no conversion/coercion happening between them.\n\nAs a side remark, a weakness of the vector space / free module code in `sage.modules` is that dual spaces / modules are not implemented. The newer code in `sage.tensor.modules` fixes this, and it would be a great improvement if `sage.geometry.cone` and `sage.geometry.toric_lattice` could integrate with that.",
    "created_at": "2020-09-18T16:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409527",
    "user": "@mkoeppe"
}
```

Replying to [comment:29 novoselt]:
> [...] dual lattice elements are not accepted as points in the primal lattice. And the reason why this particular case is explicitly prohibited is that it is a fairly common mistake in toric geometry to work with elements/cones of the wrong lattice, so it helps to catch mistakes. Volker's alternative code was actually having completely unrelated classes for a lattice and its dual to make sure that there is no conversion/coercion happening between them.

As a side remark, a weakness of the vector space / free module code in `sage.modules` is that dual spaces / modules are not implemented. The newer code in `sage.tensor.modules` fixes this, and it would be a great improvement if `sage.geometry.cone` and `sage.geometry.toric_lattice` could integrate with that.



---

archive/issue_comments_409528.json:
```json
{
    "body": "Replying to [comment:30 novoselt]:\n> If you can add code to handle more cases - please do it and it has nothing to do with distinction between dual lattices!\n\nI was mainly worried about being able to take, say, `M(1,1)` and (through coercion) come to the conclusion that it lives in the nonnegative quadrant of the lattice `N`. But thanks to some implementation details, that appears not to be a problem. I'll post something soon.",
    "created_at": "2020-09-18T20:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409528",
    "user": "@orlitzky"
}
```

Replying to [comment:30 novoselt]:
> If you can add code to handle more cases - please do it and it has nothing to do with distinction between dual lattices!

I was mainly worried about being able to take, say, `M(1,1)` and (through coercion) come to the conclusion that it lives in the nonnegative quadrant of the lattice `N`. But thanks to some implementation details, that appears not to be a problem. I'll post something soon.



---

archive/issue_comments_409529.json:
```json
{
    "body": "Replying to [comment:31 mkoeppe]:\n> As a side remark, a weakness of the vector space / free module code in `sage.modules` is that dual spaces / modules are not implemented. The newer code in `sage.tensor.modules` fixes this, and it would be a great improvement if `sage.geometry.cone` and `sage.geometry.toric_lattice` could integrate with that.\n\nThank you so much for the pointer! I surely wished for this when I was implementing toric stuff.",
    "created_at": "2020-09-19T03:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409529",
    "user": "@novoselt"
}
```

Replying to [comment:31 mkoeppe]:
> As a side remark, a weakness of the vector space / free module code in `sage.modules` is that dual spaces / modules are not implemented. The newer code in `sage.tensor.modules` fixes this, and it would be a great improvement if `sage.geometry.cone` and `sage.geometry.toric_lattice` could integrate with that.

Thank you so much for the pointer! I surely wished for this when I was implementing toric stuff.



---

archive/issue_comments_409530.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-09-19T16:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409530",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_409531.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-09-28T14:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409531",
    "user": "@orlitzky"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_409532.json:
```json
{
    "body": "I'll need to rebase this again once #30654 is reviewed.",
    "created_at": "2020-09-28T14:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409532",
    "user": "@orlitzky"
}
```

I'll need to rebase this again once #30654 is reviewed.



---

archive/issue_comments_409533.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-09-29T14:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409533",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_409534.json:
```json
{
    "body": "Cherry-picked the two commits from #30654, and replaced the `inverse_spd` function with the `inverse_positive_definite` method.",
    "created_at": "2020-09-29T15:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409534",
    "user": "@orlitzky"
}
```

Cherry-picked the two commits from #30654, and replaced the `inverse_spd` function with the `inverse_positive_definite` method.



---

archive/issue_comments_409535.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-09-29T15:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409535",
    "user": "@orlitzky"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_409536.json:
```json
{
    "body": "red branch => needs work",
    "created_at": "2020-11-01T18:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409536",
    "user": "@fchapoton"
}
```

red branch => needs work



---

archive/issue_comments_409537.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-11-01T18:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409537",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_409538.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-11-03T14:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409538",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_409539.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-11-03T14:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409539",
    "user": "@orlitzky"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_409540.json:
```json
{
    "body": "Needed a rebase, I think.",
    "created_at": "2020-11-03T14:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409540",
    "user": "@orlitzky"
}
```

Needed a rebase, I think.



---

archive/issue_comments_409541.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409541",
    "user": "@mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_409542.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409542",
    "user": "@mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_409543.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-12-02T00:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409543",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_409544.json:
```json
{
    "body": "Typo: `greather` -> `greater`",
    "created_at": "2022-03-04T06:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409544",
    "user": "@mkoeppe"
}
```

Typo: `greather` -> `greater`



---

archive/issue_comments_409545.json:
```json
{
    "body": "Wondering if there shouldn't be a variant of these methods that returns the tan of the angle rather the angle. Could one then expect that the output would be rational for rational input?",
    "created_at": "2022-03-04T06:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409545",
    "user": "@mkoeppe"
}
```

Wondering if there shouldn't be a variant of these methods that returns the tan of the angle rather the angle. Could one then expect that the output would be rational for rational input?



---

archive/issue_comments_409546.json:
```json
{
    "body": "Another typo: `constuct` -> `construct`.\n\nRun `tox -e codespell`?",
    "created_at": "2022-03-04T06:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409546",
    "user": "@mkoeppe"
}
```

Another typo: `constuct` -> `construct`.

Run `tox -e codespell`?



---

archive/issue_comments_409547.json:
```json
{
    "body": "Replying to [comment:50 mkoeppe]:\n> Wondering if there shouldn't be a variant of these methods that returns the tan of the angle rather the angle. Could one then expect that the output would be rational for rational input?\n\nOr, in the methods that return a witness pair of angles, just do not output the angle, as it is trivial to recover?\n\nThis would eliminate the dependency on `sage.symbolic` (for #32432)",
    "created_at": "2022-03-04T06:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409547",
    "user": "@mkoeppe"
}
```

Replying to [comment:50 mkoeppe]:
> Wondering if there shouldn't be a variant of these methods that returns the tan of the angle rather the angle. Could one then expect that the output would be rational for rational input?

Or, in the methods that return a witness pair of angles, just do not output the angle, as it is trivial to recover?

This would eliminate the dependency on `sage.symbolic` (for #32432)



---

archive/issue_comments_409548.json:
```json
{
    "body": "Also there seems to be no doctest for `exact=False`",
    "created_at": "2022-03-04T06:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409548",
    "user": "@mkoeppe"
}
```

Also there seems to be no doctest for `exact=False`



---

archive/issue_comments_409549.json:
```json
{
    "body": "I'd suggest to get rid of `_lists_equivalent` and just write `set(l1) == set(l2)`",
    "created_at": "2022-03-04T06:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409549",
    "user": "@mkoeppe"
}
```

I'd suggest to get rid of `_lists_equivalent` and just write `set(l1) == set(l2)`



---

archive/issue_comments_409550.json:
```json
{
    "body": "Perhaps `_solve_gevp_naive` and `solve_gevp_nonzero` should be generators?",
    "created_at": "2022-03-04T06:48:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409550",
    "user": "@mkoeppe"
}
```

Perhaps `_solve_gevp_naive` and `solve_gevp_nonzero` should be generators?



---

archive/issue_comments_409551.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-03-06T21:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409551",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_409552.json:
```json
{
    "body": "Replying to [comment:54 mkoeppe]:\n> I'd suggest to get rid of `_lists_equivalent` and just write `set(l1) == set(l2)`\n\nDoesn't work when the lists contain (mutable, not-hashable) vectors unfortunately. I also tried sage's `Set()` in case I had overlooked that originally but it's not checking equality element-wise.\n\nI fixed the typos and converted those methods to generators. I'll add tests for `exact=False` when I get a chance.",
    "created_at": "2022-03-06T21:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409552",
    "user": "@orlitzky"
}
```

Replying to [comment:54 mkoeppe]:
> I'd suggest to get rid of `_lists_equivalent` and just write `set(l1) == set(l2)`

Doesn't work when the lists contain (mutable, not-hashable) vectors unfortunately. I also tried sage's `Set()` in case I had overlooked that originally but it's not checking equality element-wise.

I fixed the typos and converted those methods to generators. I'll add tests for `exact=False` when I get a chance.



---

archive/issue_comments_409553.json:
```json
{
    "body": "Replying to [comment:57 mjo]:\n> Doesn't work when the lists contain (mutable, not-hashable) vectors unfortunately.\n\nPerhaps just change the code so it creates immutable vectors?",
    "created_at": "2022-03-06T21:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409553",
    "user": "@mkoeppe"
}
```

Replying to [comment:57 mjo]:
> Doesn't work when the lists contain (mutable, not-hashable) vectors unfortunately.

Perhaps just change the code so it creates immutable vectors?



---

archive/issue_comments_409554.json:
```json
{
    "body": "Replying to [comment:58 mkoeppe]:\n> \n> Perhaps just change the code so it creates immutable vectors?\n\nThat *still* doesn't work because\n\n\n```\nsage: set([AA(0)]) == set([ZZ(0)])\nFalse\n```\n\n\nThe `_lists_equivalent` function is used to compare eigenvalue/vector results coming from three different places, two of which use `extend=True` and can \"silently\" jump from e.g. the rationals to the algebraic field. I could probably get them all to return eigenvalues in the same field, but it really doesn't matter for the tests. It's a lot easier to compare them with `==` than it would be to make the tests or the functions themselves more complicated.",
    "created_at": "2022-03-07T01:02:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409554",
    "user": "@orlitzky"
}
```

Replying to [comment:58 mkoeppe]:
> 
> Perhaps just change the code so it creates immutable vectors?

That *still* doesn't work because


```
sage: set([AA(0)]) == set([ZZ(0)])
False
```


The `_lists_equivalent` function is used to compare eigenvalue/vector results coming from three different places, two of which use `extend=True` and can "silently" jump from e.g. the rationals to the algebraic field. I could probably get them all to return eigenvalues in the same field, but it really doesn't matter for the tests. It's a lot easier to compare them with `==` than it would be to make the tests or the functions themselves more complicated.



---

archive/issue_comments_409555.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-03-07T01:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409555",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_409556.json:
```json
{
    "body": "Replying to [comment:52 mkoeppe]:\n> Replying to [comment:50 mkoeppe]:\n> > Wondering if there shouldn't be a variant of these methods that returns the tan of the angle rather the angle. Could one then expect that the output would be rational for rational input?\n> \n> Or, in the methods that return a witness pair of angles, just do not output the angle, as it is trivial to recover?\n> \n> This would eliminate the dependency on `sage.symbolic` (for #32432)\n> \n\nThis makes some engineering sense, but I'd prefer to keep the nice interface (e.g `max_angle` versus `min_cos_of_angle`). The internal functions could easily be reworked, but in the user-facing portion, I think we should give people what they're actually looking for and not make them compute it themselves (which would require `sage.symbolic` anyway).",
    "created_at": "2022-03-07T13:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409556",
    "user": "@orlitzky"
}
```

Replying to [comment:52 mkoeppe]:
> Replying to [comment:50 mkoeppe]:
> > Wondering if there shouldn't be a variant of these methods that returns the tan of the angle rather the angle. Could one then expect that the output would be rational for rational input?
> 
> Or, in the methods that return a witness pair of angles, just do not output the angle, as it is trivial to recover?
> 
> This would eliminate the dependency on `sage.symbolic` (for #32432)
> 

This makes some engineering sense, but I'd prefer to keep the nice interface (e.g `max_angle` versus `min_cos_of_angle`). The internal functions could easily be reworked, but in the user-facing portion, I think we should give people what they're actually looking for and not make them compute it themselves (which would require `sage.symbolic` anyway).



---

archive/issue_comments_409557.json:
```json
{
    "body": "\n```\n+            raise ValueError('eigenspace of dimension %d > 1 '\n+                             'corresponding to eigenvalue %s'\n+                              % (mult, cos_theta))\n```\n\nShouldn't this be a `NotImplementedError`?",
    "created_at": "2022-03-07T17:37:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409557",
    "user": "@mkoeppe"
}
```


```
+            raise ValueError('eigenspace of dimension %d > 1 '
+                             'corresponding to eigenvalue %s'
+                              % (mult, cos_theta))
```

Shouldn't this be a `NotImplementedError`?



---

archive/issue_comments_409558.json:
```json
{
    "body": "`gevp_licis` can be replaced by `sage.matroids.linear_matroid.LinearMatroid(G).independent_sets()`",
    "created_at": "2022-03-07T17:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409558",
    "user": "@mkoeppe"
}
```

`gevp_licis` can be replaced by `sage.matroids.linear_matroid.LinearMatroid(G).independent_sets()`



---

archive/issue_comments_409559.json:
```json
{
    "body": "\n```\n+    if exact:\n+        ring = QQbar\n```\n\nDo you really need `QQbar` or is `AA` enough?",
    "created_at": "2022-03-07T18:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409559",
    "user": "@mkoeppe"
}
```


```
+    if exact:
+        ring = QQbar
```

Do you really need `QQbar` or is `AA` enough?



---

archive/issue_comments_409560.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-08T00:25:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409560",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_409561.json:
```json
{
    "body": "Replying to [comment:62 mkoeppe]:\n> Shouldn't this be a `NotImplementedError`?\n\nIIRC I checked the python docs for `NotImplementedError` and thought some other error would be more accurate. It's not that we've chosen not to implement this; rather, we encountered a value that we don't know how to handle while performing some other computation. If you prefer `NotImplementedError` though I don't care all that much.\n\n\n> `gevp_licis` can be replaced by `sage.matroids.linear_matroid.LinearMatroid(G).independent_sets()`\n\nNot entirely, but the latter gives a much faster implementation, thanks! I also added some docs stating that our subsets need to be ordered similarly. It's in the paper but wasn't in the code.\n\n\n> Do you really need `QQbar` or is `AA` enough? \n\nI don't remember why I wrote it that way but I can't find a reason for `QQbar` now, so I've changed it.",
    "created_at": "2022-03-08T00:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409561",
    "user": "@orlitzky"
}
```

Replying to [comment:62 mkoeppe]:
> Shouldn't this be a `NotImplementedError`?

IIRC I checked the python docs for `NotImplementedError` and thought some other error would be more accurate. It's not that we've chosen not to implement this; rather, we encountered a value that we don't know how to handle while performing some other computation. If you prefer `NotImplementedError` though I don't care all that much.


> `gevp_licis` can be replaced by `sage.matroids.linear_matroid.LinearMatroid(G).independent_sets()`

Not entirely, but the latter gives a much faster implementation, thanks! I also added some docs stating that our subsets need to be ordered similarly. It's in the paper but wasn't in the code.


> Do you really need `QQbar` or is `AA` enough? 

I don't remember why I wrote it that way but I can't find a reason for `QQbar` now, so I've changed it.



---

archive/issue_comments_409562.json:
```json
{
    "body": "\n```\n+    for I in G_index_sets:\n+        G_I = G[range(n),I]\n+        I_complement = [ i for i in range(P.nrays()) if not i in I ]\n+        G_I_c_T = G[range(n),I_complement].transpose()\n+\n+        for J in H_index_sets:\n+            J_complement = [ j for j in range(Q.nrays()) if not j in J ]\n```\n\nI think this code would be slightly cleaner if `I` and `J` were just `frozenset`.\nThen you can write `G_I = G[range(n),sorted(I)]` and `I_complement = range(P.nrays()) - I`",
    "created_at": "2022-03-08T00:48:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409562",
    "user": "@mkoeppe"
}
```


```
+    for I in G_index_sets:
+        G_I = G[range(n),I]
+        I_complement = [ i for i in range(P.nrays()) if not i in I ]
+        G_I_c_T = G[range(n),I_complement].transpose()
+
+        for J in H_index_sets:
+            J_complement = [ j for j in range(Q.nrays()) if not j in J ]
```

I think this code would be slightly cleaner if `I` and `J` were just `frozenset`.
Then you can write `G_I = G[range(n),sorted(I)]` and `I_complement = range(P.nrays()) - I`



---

archive/issue_comments_409563.json:
```json
{
    "body": "Replying to [comment:67 mkoeppe]:\n> \n> I think this code would be slightly cleaner if `I` and `J` were just `frozenset`.\n> Then you can write ... `I_complement = range(P.nrays()) - I`\n\nShould that work? I get `unsupported operand type(s) for -: 'range' and 'frozenset'`.\n\nIf you meant `frozenset(range(P.nrays()))`, then that would work; still, we'd have to sort the whole thing again to make sure that `I_complement` has the same order as `I` itself (and that we can use it as a matrix index).",
    "created_at": "2022-03-08T02:19:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409563",
    "user": "@orlitzky"
}
```

Replying to [comment:67 mkoeppe]:
> 
> I think this code would be slightly cleaner if `I` and `J` were just `frozenset`.
> Then you can write ... `I_complement = range(P.nrays()) - I`

Should that work? I get `unsupported operand type(s) for -: 'range' and 'frozenset'`.

If you meant `frozenset(range(P.nrays()))`, then that would work; still, we'd have to sort the whole thing again to make sure that `I_complement` has the same order as `I` itself (and that we can use it as a matrix index).



---

archive/issue_comments_409564.json:
```json
{
    "body": "Replying to [comment:68 mjo]:\n> If you meant `frozenset(range(P.nrays()))`\n\nI guess that's what I meant",
    "created_at": "2022-03-08T02:27:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409564",
    "user": "@mkoeppe"
}
```

Replying to [comment:68 mjo]:
> If you meant `frozenset(range(P.nrays()))`

I guess that's what I meant



---

archive/issue_comments_409565.json:
```json
{
    "body": "Replying to [comment:59 mjo]:\n> {{{\n> sage: set([AA(0)]) == set([ZZ(0)])\n> False\n> }}}\n> \n> The `_lists_equivalent` function is used to compare eigenvalue/vector results coming from three different places, two of which use `extend=True` and can \"silently\" jump from e.g. the rationals to the algebraic field. \n\nThe doctests could be changed to just compare with the results in the correct field, so that you don't run into the hashing contract violation `hash(AA(0)) == hash(ZZ(0)) => False`.",
    "created_at": "2022-03-09T19:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409565",
    "user": "@mkoeppe"
}
```

Replying to [comment:59 mjo]:
> {{{
> sage: set([AA(0)]) == set([ZZ(0)])
> False
> }}}
> 
> The `_lists_equivalent` function is used to compare eigenvalue/vector results coming from three different places, two of which use `extend=True` and can "silently" jump from e.g. the rationals to the algebraic field. 

The doctests could be changed to just compare with the results in the correct field, so that you don't run into the hashing contract violation `hash(AA(0)) == hash(ZZ(0)) => False`.



---

archive/issue_comments_409566.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-09T21:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409566",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_409567.json:
```json
{
    "body": "That should do it. Even if the input vectors are rational we convert them to `AA`, and then the resulting matrix is over `AA`, so there's actually not too many options for the eigenvalue field (the other is `RDF`).",
    "created_at": "2022-03-09T21:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409567",
    "user": "@orlitzky"
}
```

That should do it. Even if the input vectors are rational we convert them to `AA`, and then the resulting matrix is over `AA`, so there's actually not too many options for the eigenvalue field (the other is `RDF`).



---

archive/issue_comments_409568.json:
```json
{
    "body": "Thanks for making this change!",
    "created_at": "2022-03-09T22:23:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409568",
    "user": "@mkoeppe"
}
```

Thanks for making this change!



---

archive/issue_comments_409569.json:
```json
{
    "body": "\n```\n+Finding the maximal (or equivalently, the minimal) angle between two\n```\n\nHow is this equivalent?",
    "created_at": "2022-03-09T22:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409569",
    "user": "@mkoeppe"
}
```


```
+Finding the maximal (or equivalently, the minimal) angle between two
```

How is this equivalent?



---

archive/issue_comments_409570.json:
```json
{
    "body": "Replying to [comment:74 mkoeppe]:\n> How is this equivalent?\n\nThe minimal angle between `P` and `Q` is pi minus the maximal angle between `P` and `-Q`, akin to how minimizing some real `f` is the same as maximizing `-f` and flipping the result.",
    "created_at": "2022-03-09T23:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409570",
    "user": "@orlitzky"
}
```

Replying to [comment:74 mkoeppe]:
> How is this equivalent?

The minimal angle between `P` and `Q` is pi minus the maximal angle between `P` and `-Q`, akin to how minimizing some real `f` is the same as maximizing `-f` and flipping the result.



---

archive/issue_comments_409571.json:
```json
{
    "body": "Thanks.",
    "created_at": "2022-03-10T00:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409571",
    "user": "@mkoeppe"
}
```

Thanks.



---

archive/issue_comments_409572.json:
```json
{
    "body": "Does the change to `src/sage/misc/randstate.pyx` belong here on this ticket?",
    "created_at": "2022-03-10T00:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409572",
    "user": "@mkoeppe"
}
```

Does the change to `src/sage/misc/randstate.pyx` belong here on this ticket?



---

archive/issue_comments_409573.json:
```json
{
    "body": "Looks good to me now, but probably the PEP 8 police may want to have a word",
    "created_at": "2022-03-10T00:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409573",
    "user": "@mkoeppe"
}
```

Looks good to me now, but probably the PEP 8 police may want to have a word



---

archive/issue_comments_409574.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-03-10T01:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409574",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_409575.json:
```json
{
    "body": "Replying to [comment:77 mkoeppe]:\n> Does the change to `src/sage/misc/randstate.pyx` belong here on this ticket?\n\nNope, dropped. There's also a commit titled **UNDO ME** that should be dropped before merging, but for now it allows the docs to build.",
    "created_at": "2022-03-10T01:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409575",
    "user": "@orlitzky"
}
```

Replying to [comment:77 mkoeppe]:
> Does the change to `src/sage/misc/randstate.pyx` belong here on this ticket?

Nope, dropped. There's also a commit titled **UNDO ME** that should be dropped before merging, but for now it allows the docs to build.



---

archive/issue_comments_409576.json:
```json
{
    "body": "You don't need the `\\` here:\n\n```\n            if (other.lattice_dim() != self.lattice_dim()):\n                raise ValueError(\"lattice dimensions of self and other \"\\\n                                 \"must agree\")\n            if other.is_trivial() or other.is_full_space():\n                raise ValueError(\"other cone cannot be trivial or the \"\\\n                                 \"ambient space\")\n```\n\n(The parentheses take care of it.)\n\nNo period/full-stop at the end of `INPUT:` lines.\n\nIn `_normalize_gevp_solution`, do you need to pass the full tuple? I guess this makes the code easier. If so, I would replace `irrelevant` with `ignored`.\n\nNo space around the list; e.g.:\n\n```diff\n-G_index_sets = [ s for s in gevp_licis(G) if not len(s) == n ]\n+G_index_sets = [s for s in gevp_licis(G) if not len(s) == n]\n```\n\n\nSome of your `# long time` are misaligned compared to others in their block (it isn't a big issue, it was just visually jarring for me).",
    "created_at": "2022-03-10T01:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409576",
    "user": "@tscrim"
}
```

You don't need the `\` here:

```
            if (other.lattice_dim() != self.lattice_dim()):
                raise ValueError("lattice dimensions of self and other "\
                                 "must agree")
            if other.is_trivial() or other.is_full_space():
                raise ValueError("other cone cannot be trivial or the "\
                                 "ambient space")
```

(The parentheses take care of it.)

No period/full-stop at the end of `INPUT:` lines.

In `_normalize_gevp_solution`, do you need to pass the full tuple? I guess this makes the code easier. If so, I would replace `irrelevant` with `ignored`.

No space around the list; e.g.:

```diff
-G_index_sets = [ s for s in gevp_licis(G) if not len(s) == n ]
+G_index_sets = [s for s in gevp_licis(G) if not len(s) == n]
```


Some of your `# long time` are misaligned compared to others in their block (it isn't a big issue, it was just visually jarring for me).



---

archive/issue_comments_409577.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-03-10T02:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409577",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_409578.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-10T02:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409578",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_409579.json:
```json
{
    "body": "Replying to [comment:81 mjo]:\n> Nope, dropped. There's also a commit titled **UNDO ME** that should be dropped before merging, but for now it allows the docs to build.\n\nYes, what's up with that?",
    "created_at": "2022-03-17T18:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409579",
    "user": "@mkoeppe"
}
```

Replying to [comment:81 mjo]:
> Nope, dropped. There's also a commit titled **UNDO ME** that should be dropped before merging, but for now it allows the docs to build.

Yes, what's up with that?



---

archive/issue_comments_409580.json:
```json
{
    "body": "Replying to [comment:85 mkoeppe]:\n> Replying to [comment:81 mjo]:\n> > Nope, dropped. There's also a commit titled **UNDO ME** that should be dropped before merging, but for now it allows the docs to build.\n> \n> Yes, what's up with that?\n\nWithout it, the docs aren't built for `cone_critical_angles.py`, so there's no way to tell if the syntax/formatting is totally broken. I can remove it if everyone's happy with the rest.",
    "created_at": "2022-03-17T19:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28932",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28932#issuecomment-409580",
    "user": "@orlitzky"
}
```

Replying to [comment:85 mkoeppe]:
> Replying to [comment:81 mjo]:
> > Nope, dropped. There's also a commit titled **UNDO ME** that should be dropped before merging, but for now it allows the docs to build.
> 
> Yes, what's up with that?

Without it, the docs aren't built for `cone_critical_angles.py`, so there's no way to tell if the syntax/formatting is totally broken. I can remove it if everyone's happy with the rest.
