# Issue 17059: Update autotools to 20141105

archive/issues_017059.json:
```json
{
    "body": "CC:  jdemeyer\n\nSome included software was updated since our last update.\nIn particular the new libtool 2.4.3 needs specific care as it uses pieces from gnulib.\n\nTexinfo is NOT updated to 5.x as these new versions errors out when building old software.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17296\n\n",
    "created_at": "2014-11-05T16:22:28Z",
    "labels": [
        "packages: optional",
        "minor",
        "bug"
    ],
    "title": "Update autotools to 20141105",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17059",
    "user": "jpflori"
}
```
CC:  jdemeyer

Some included software was updated since our last update.
In particular the new libtool 2.4.3 needs specific care as it uses pieces from gnulib.

Texinfo is NOT updated to 5.x as these new versions errors out when building old software.

Issue created by migration from https://trac.sagemath.org/ticket/17296





---

archive/issue_comments_226877.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-11-05T16:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226877",
    "user": "jpflori"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_226878.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-11-05T16:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226878",
    "user": "jpflori"
}
```

New commits:



---

archive/issue_comments_226879.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-11-05T16:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226879",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_226880.json:
```json
{
    "body": "What is the reason for changing\n\n```\nsource bootstrap.sh\n```\n\nto\n\n```\n./bootstrap.sh\n```\n\n\nAnd did you manually change the make rules for `$(SAGE_LOCAL)/automake-1.11.3`? The line continuations looks different.",
    "created_at": "2014-11-05T19:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226880",
    "user": "jdemeyer"
}
```

What is the reason for changing

```
source bootstrap.sh
```

to

```
./bootstrap.sh
```


And did you manually change the make rules for `$(SAGE_LOCAL)/automake-1.11.3`? The line continuations looks different.



---

archive/issue_comments_226881.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-11-05T19:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226881",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_226882.json:
```json
{
    "body": "Replying to [comment:4 jdemeyer]:\n> What is the reason for changing\n> {{{\n> source bootstrap.sh\n> }}}\n> to\n> {{{\n> ./bootstrap.sh\n> }}}\nMy bad, i was playing around and ending up with half broken versions of Sage's autotools and that was a temporary fix for me to use system wide stuff.\nI'll put the `source` version back in.\n> \n> And did you manually change the make rules for `$(SAGE_LOCAL)/automake-1.11.3`? The line continuations looks different.\nI don't think so.\nI'll regenerate everything anyway.",
    "created_at": "2014-11-06T10:07:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226882",
    "user": "jpflori"
}
```

Replying to [comment:4 jdemeyer]:
> What is the reason for changing
> {{{
> source bootstrap.sh
> }}}
> to
> {{{
> ./bootstrap.sh
> }}}
My bad, i was playing around and ending up with half broken versions of Sage's autotools and that was a temporary fix for me to use system wide stuff.
I'll put the `source` version back in.
> 
> And did you manually change the make rules for `$(SAGE_LOCAL)/automake-1.11.3`? The line continuations looks different.
I don't think so.
I'll regenerate everything anyway.



---

archive/issue_comments_226883.json:
```json
{
    "body": "I'm also wondering why you made this change:\n\n```diff\n-if ! env \"AUTOCONF_VERSION=2.62\" autoconf --version | grep >/dev/null '2[.]62'; then\n+if ! env \"AUTOCONF_VERSION=2.59\" autoconf --version | grep >/dev/null '2[.]59'; then\n```\n\n\nThe number \"2.62\" was specifically chosen as being a \"rare\" version, not many operating systems come with that version by default. The version 2.59 is much more widely used, leading to more chances of a false positive.",
    "created_at": "2014-11-06T10:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226883",
    "user": "jdemeyer"
}
```

I'm also wondering why you made this change:

```diff
-if ! env "AUTOCONF_VERSION=2.62" autoconf --version | grep >/dev/null '2[.]62'; then
+if ! env "AUTOCONF_VERSION=2.59" autoconf --version | grep >/dev/null '2[.]59'; then
```


The number "2.62" was specifically chosen as being a "rare" version, not many operating systems come with that version by default. The version 2.59 is much more widely used, leading to more chances of a false positive.



---

archive/issue_comments_226884.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> I'm also wondering why you made this change:\n> {{{\n> #!diff\n> -if ! env \"AUTOCONF_VERSION=2.62\" autoconf --version | grep >/dev/null '2[.]62'; then\n> +if ! env \"AUTOCONF_VERSION=2.59\" autoconf --version | grep >/dev/null '2[.]59'; then\n> }}}\n> \n> The number \"2.62\" was specifically chosen as being a \"rare\" version, not many operating systems come with that version by default. The version 2.59 is much more widely used, leading to more chances of a false positive.\nOh, I thought I went the other way around and changed 59 by 62 for my own testing...\nI'll fix that as well.\nI must admit I did not have the time to check the full diff myself yet.",
    "created_at": "2014-11-06T10:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226884",
    "user": "jpflori"
}
```

Replying to [comment:6 jdemeyer]:
> I'm also wondering why you made this change:
> {{{
> #!diff
> -if ! env "AUTOCONF_VERSION=2.62" autoconf --version | grep >/dev/null '2[.]62'; then
> +if ! env "AUTOCONF_VERSION=2.59" autoconf --version | grep >/dev/null '2[.]59'; then
> }}}
> 
> The number "2.62" was specifically chosen as being a "rare" version, not many operating systems come with that version by default. The version 2.59 is much more widely used, leading to more chances of a false positive.
Oh, I thought I went the other way around and changed 59 by 62 for my own testing...
I'll fix that as well.
I must admit I did not have the time to check the full diff myself yet.



---

archive/issue_comments_226885.json:
```json
{
    "body": "Just to satisfy my curiosity, I'm counting the `autoconf` version numbers of all `configure` files in all Sage packages:\n\n```\n2.13: 7\n2.50: 0\n2.51: 0\n2.52: 3\n2.53: 0\n2.54: 0\n2.55: 0\n2.56: 0\n2.57: 1\n2.58: 0\n2.59: 5\n2.60: 0\n2.61: 3\n2.62: 0\n2.63: 4\n2.64: 30\n2.65: 0\n2.66: 0\n2.67: 1\n2.68: 25\n2.69: 37\n```\n\n\nThis should give a very rough idea how popular various `autoconf` versions are.",
    "created_at": "2014-11-06T10:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226885",
    "user": "jdemeyer"
}
```

Just to satisfy my curiosity, I'm counting the `autoconf` version numbers of all `configure` files in all Sage packages:

```
2.13: 7
2.50: 0
2.51: 0
2.52: 3
2.53: 0
2.54: 0
2.55: 0
2.56: 0
2.57: 1
2.58: 0
2.59: 5
2.60: 0
2.61: 3
2.62: 0
2.63: 4
2.64: 30
2.65: 0
2.66: 0
2.67: 1
2.68: 25
2.69: 37
```


This should give a very rough idea how popular various `autoconf` versions are.



---

archive/issue_comments_226886.json:
```json
{
    "body": "Also note that I fear that the latest libtool bootstrap script must connect to the internet by default to clone the gnulib directory.\nI'll try to check if that can be avoided...",
    "created_at": "2014-11-06T10:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226886",
    "user": "jpflori"
}
```

Also note that I fear that the latest libtool bootstrap script must connect to the internet by default to clone the gnulib directory.
I'll try to check if that can be avoided...



---

archive/issue_comments_226887.json:
```json
{
    "body": "(Hopefully copying the gnulib repo cloned by spkg-src into the libtool build dir may be enough, that's just wishful thinking at the moment as I did not test it.)",
    "created_at": "2014-11-06T10:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226887",
    "user": "jpflori"
}
```

(Hopefully copying the gnulib repo cloned by spkg-src into the libtool build dir may be enough, that's just wishful thinking at the moment as I did not test it.)



---

archive/issue_comments_226888.json:
```json
{
    "body": "I guess we have\n\n```\n    opt_gnulib_srcdir=$GNULIB_SRCDIR\n    opt_skip_git=false\n```\n\nto play with.",
    "created_at": "2014-11-06T10:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226888",
    "user": "jpflori"
}
```

I guess we have

```
    opt_gnulib_srcdir=$GNULIB_SRCDIR
    opt_skip_git=false
```

to play with.



---

archive/issue_comments_226889.json:
```json
{
    "body": "Ok, now I remember why I removed the source thing.\nThe libtool 2.4.3 bootstrap script needs libtoolize, wand with source it points to the not yet available libtool 2.4.3.",
    "created_at": "2014-11-06T13:37:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226889",
    "user": "jpflori"
}
```

Ok, now I remember why I removed the source thing.
The libtool 2.4.3 bootstrap script needs libtoolize, wand with source it points to the not yet available libtool 2.4.3.



---

archive/issue_comments_226890.json:
```json
{
    "body": "Ok we have an issue with `gnulib` and using `source`:\n\n```\n# Override the default configuration, if necessary.\n# Make sure that bootstrap.conf is sourced from the current directory\n# if we were invoked as \"sh bootstrap\".\ncase $0 in\n  */*) test -r \"$0.conf\" && . \"$0.conf\" ;;\n  *) test -r \"$0.conf\" && . ./\"$0.conf\" ;;\nesac\n```\n\nNote that if `source` is used `$0` is `/bin/bash`.\n\nAnyway, is using `source` really mandatory?\nAll needed vars should be exported, aren't they?",
    "created_at": "2014-11-06T16:19:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226890",
    "user": "jpflori"
}
```

Ok we have an issue with `gnulib` and using `source`:

```
# Override the default configuration, if necessary.
# Make sure that bootstrap.conf is sourced from the current directory
# if we were invoked as "sh bootstrap".
case $0 in
  */*) test -r "$0.conf" && . "$0.conf" ;;
  *) test -r "$0.conf" && . ./"$0.conf" ;;
esac
```

Note that if `source` is used `$0` is `/bin/bash`.

Anyway, is using `source` really mandatory?
All needed vars should be exported, aren't they?



---

archive/issue_comments_226891.json:
```json
{
    "body": "The reason for `source` is the `set -e`. Older `bootstrap` scripts sometimes fail ungracefully if `set -e` is not given, braking stuff badly.",
    "created_at": "2014-11-06T16:32:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226891",
    "user": "jdemeyer"
}
```

The reason for `source` is the `set -e`. Older `bootstrap` scripts sometimes fail ungracefully if `set -e` is not given, braking stuff badly.



---

archive/issue_comments_226892.json:
```json
{
    "body": "Ok, then I'll leave `source` in if using some heuristic it does not seem `gnulib` is used.",
    "created_at": "2014-11-06T16:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226892",
    "user": "jpflori"
}
```

Ok, then I'll leave `source` in if using some heuristic it does not seem `gnulib` is used.



---

archive/issue_comments_226893.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-11-06T16:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226893",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_226894.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-11-06T16:54:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226894",
    "user": "jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_226895.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-11-11T11:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226895",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_226896.json:
```json
{
    "body": "I dislike the `bootstrap_launch`/`bootstrap_opts` solution. I would much rather prefer something like\n\n```sh\n# Figure out how to bootstrap\nif [ -f configure ]; then\n    bootstrap=\nelif [ -d gnulib ]; then\n    bootstrap=\"bash bootstrap --skip-git --skip-po --gnulib-srcdir=../../src/gnulib && \"\nelif [ -f bootstrap.sh ]; then\n    bootstrap=\"bash -c 'set -e; source bootstrap.sh' && \"\nelif [ -f bootstrap ]; then\n    bootstrap=\"bash -c 'set -e; source bootstrap' && \"\nelse\n    bootstrap=\"autoreconf -i -I m4 && \"\nfi\n```\n",
    "created_at": "2014-11-11T11:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226896",
    "user": "jdemeyer"
}
```

I dislike the `bootstrap_launch`/`bootstrap_opts` solution. I would much rather prefer something like

```sh
# Figure out how to bootstrap
if [ -f configure ]; then
    bootstrap=
elif [ -d gnulib ]; then
    bootstrap="bash bootstrap --skip-git --skip-po --gnulib-srcdir=../../src/gnulib && "
elif [ -f bootstrap.sh ]; then
    bootstrap="bash -c 'set -e; source bootstrap.sh' && "
elif [ -f bootstrap ]; then
    bootstrap="bash -c 'set -e; source bootstrap' && "
else
    bootstrap="autoreconf -i -I m4 && "
fi
```




---

archive/issue_comments_226897.json:
```json
{
    "body": "If you really want to keep the `bootstrap_launch` logic, the whole string `bash -c 'set -e; source ` should all be part of `bootstrap_launch`.",
    "created_at": "2014-11-11T11:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226897",
    "user": "jdemeyer"
}
```

If you really want to keep the `bootstrap_launch` logic, the whole string `bash -c 'set -e; source ` should all be part of `bootstrap_launch`.



---

archive/issue_comments_226898.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-12T00:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226898",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226899.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-11-12T00:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226899",
    "user": "jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_226900.json:
```json
{
    "body": "While running `spkg-src` I get\n\n```\nCloning into 'gnulib'...\nfatal: unable to connect to git.sv.gnu.org:\ngit.sv.gnu.org[0: 140.186.70.72]: errno=Connection refused\n```\n\n\nI assume this is a temporary problem, I still would like to try it so I'll wait a while and try again.",
    "created_at": "2014-11-12T22:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226900",
    "user": "jdemeyer"
}
```

While running `spkg-src` I get

```
Cloning into 'gnulib'...
fatal: unable to connect to git.sv.gnu.org:
git.sv.gnu.org[0: 140.186.70.72]: errno=Connection refused
```


I assume this is a temporary problem, I still would like to try it so I'll wait a while and try again.



---

archive/issue_comments_226901.json:
```json
{
    "body": "The diff looks good now by the way, so it's just a matter of testing the package.\n\nDo you know of anything which requires libtool 2.4.3?",
    "created_at": "2014-11-12T22:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226901",
    "user": "jdemeyer"
}
```

The diff looks good now by the way, so it's just a matter of testing the package.

Do you know of anything which requires libtool 2.4.3?



---

archive/issue_comments_226902.json:
```json
{
    "body": "Replying to [comment:23 jdemeyer]:\n> The diff looks good now by the way, so it's just a matter of testing the package.\n> \n> Do you know of anything which requires libtool 2.4.3?\nNot really, actually I wanted this for autoreconfiguring GLPK using your scripts, but it seems GLPK used an obscure revision of libtool between 2.4.2 and 2.4.3.",
    "created_at": "2014-11-13T09:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226902",
    "user": "jpflori"
}
```

Replying to [comment:23 jdemeyer]:
> The diff looks good now by the way, so it's just a matter of testing the package.
> 
> Do you know of anything which requires libtool 2.4.3?
Not really, actually I wanted this for autoreconfiguring GLPK using your scripts, but it seems GLPK used an obscure revision of libtool between 2.4.2 and 2.4.3.



---

archive/issue_comments_226903.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-21T22:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226903",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_226904.json:
```json
{
    "body": "OSX 10.10 needs libtool 2.4.3... I'm going to set this to positive review before the 2.4.4 release in a few days.",
    "created_at": "2014-11-21T22:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226904",
    "user": "vbraun"
}
```

OSX 10.10 needs libtool 2.4.3... I'm going to set this to positive review before the 2.4.4 release in a few days.



---

archive/issue_comments_226905.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-11-23T19:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17059",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17059#issuecomment-226905",
    "user": "vbraun"
}
```

Resolution: fixed
