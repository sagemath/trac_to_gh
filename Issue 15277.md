# Issue 15277: adding option for computing a total dominating set

Issue created by migration from https://trac.sagemath.org/ticket/15514

Original creator: azi

Original creation time: 2013-12-12 13:46:29

CC:  ncohen

The attached patch adds a (short) option to dominating_set that let you compute the total dominating set of a graph.




---

Attachment


---

Comment by azi created at 2013-12-12 13:47:00

Changing status from new to needs_review.


---

Comment by ncohen created at 2013-12-12 13:52:18

Yoooooooooo !!

Well, I guess that `independent=True,total=True` does not make much sense, but it will raise an exception sooo... `:-)`

Nathann


---

Comment by ncohen created at 2013-12-12 13:53:37

Oh, could you please add a doctest for that ?

Nathann


---

Comment by ncohen created at 2013-12-12 13:55:06

(I mean, for your new flag. Not for the combination independent/total)

Nathann


---

Attachment


---

Comment by ncohen created at 2013-12-12 14:15:00

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2013-12-12 14:15:46

(oh, and that's totally up to you, but you can replace the big "if" by multiplying `b[v]` by `bool(total)` `:-PPPP`

Nathann


---

Comment by azi created at 2013-12-12 14:18:50

BTW I have added the relevant doctest!

I like your bool thing more than the if statement,  but somehow I am too tired to even open the patch and fix it :-(


---

Comment by ncohen created at 2013-12-12 14:21:42

Hmmmmm... Sorry but would it be possible to have this doctest NOT output the list of vertices, only the cardinal ? That's what usually happens in the LP doctests... We can't be sure that the result will always be the same on all platforms, and even less that all solvers will return the same set `^^;`

Nathann


---

Comment by ncohen created at 2013-12-23 11:55:57

Oh. By the way, I am trying to protect Sage against problems with multiple edges/loops in #15572. And your total dominating set can be impacted by the existence of loops.

You can either handle it, or not care about it and call the new `self._scream_if_not_simple()` function I am creating. Both a fine to me, for as long as Sage does noto give wrong answers `:-P`

Nathann


---

Comment by azi created at 2014-01-08 21:46:09

So should I add this call to this patch and make this ticket dependant on #15572?


---

Comment by ncohen created at 2014-01-09 08:49:55

Only when asked to compute a total dominating set, and only when there are loops, yes. Multiple edges make no difference `:-)`

Nathann


---

Comment by azi created at 2014-11-23 11:37:04

Hey! 

I am trying to learn git by trying to make a change to this patch.

So far I did 


```
git trac checkout 15514
```


which apparently created a new branch but I don't see it. Do you happen to know where can I access that branch so that I can actually push some changes here?

Best,

Jernej


---

Comment by ncohen created at 2014-11-23 11:40:50

I can't really help. I do not use the "git trac" commands.

I would say that this checkout command creates a branch, that you now have to modify what you want in the code and create a commit, then that you have to push it ... But really I do not know what the "git trac" commands do.

Without the git trac commands the following should work:

git checkout -b my_new_branch develop # creates a new branch where develop is
# Do your changes to Sage
git commit -a # turn all your change into a commit (the equivalent of a hg patch)
git push trac HEAD:u/azi/adding_option_for_computing_a_total_dominating_set

Nathann


---

Comment by azi created at 2014-11-23 11:46:09

Hey!

Thanks. Do you happen to know what this error is about?


```
azi@goodegg:~/sage$ git checkout -b total_domination develop
fatal: Cannot update paths and switch to branch 'total_domination' at the same time.
Did you intend to checkout 'develop' which can not be resolved as commit?
```



---

Comment by ncohen created at 2014-11-23 11:47:29

Oh. It seems that no local branch of yours is named "develop" (see output of 'git branch'). Don't really know what to do there O_o

Point is that perhaps you should write to sage-devel or sage-support. If the docs are not clear about that, it is a problem `:-/`

Nathann


---

Comment by git created at 2014-11-23 15:45:49

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2014-11-25 17:35:08

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by azi created at 2014-11-25 17:36:26

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2014-11-26 02:50:41

Excellent ! Well, it all looks good except your optimization for the objective function.

1) Really, you are solving a NP-Hard problem and you are saving on a list ? `:-P`

2) Actually, this code is slower than the previous one:


```
sage: p = MixedIntegerLinearProgram()
sage: b = p.new_variable(binary=True)
sage: %timeit sum(b[x] for x in range(1000))
10 loops, best of 3: 77.1 ms per loop
sage: %timeit p.sum(b[x] for x in range(1000))
1000 loops, best of 3: 1.09 ms per loop
```


This is because a "sum of LP variables" is a "linearfunction" object, and that adding to it another LP variable creates a second linearfunction object, which is mostly a copy of the previous one. Thus, `b[0]+b[1]+....+b[n]` creates `n` linearfunction objects and has a quadratic complexity.

That's why `p.sum` was created: as p.sum is dedicated to linearfunctions, it handles the, in the best way, without creating useless intermediate objects.

Nathann

P.S. : If you fix this in a third commit, you will haev commits which undo what the previous commits do. It is actually possibly, using git, to merge them all into one (called "squash" in git slang).

Two ways:

1) Look at "git rebase -i"

2) If you run "git reset HEAD~1", the last commit is "destroyed" and the changes it contains become "unstaged" chages. This, together with "git commit --amend" is another way to merge the commits.


---

Comment by ncohen created at 2014-11-26 02:50:41

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-11-26 19:17:34

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by azi created at 2014-11-26 19:18:09

Replying to [comment:23 ncohen]:
> Excellent ! Well, it all looks good except your optimization for the objective function.
> 
> 1) Really, you are solving a NP-Hard problem and you are saving on a list ? `:-P`
I think its still fair to do such optimisations. They may come handy for say graphs of order ~100 and high degree. But if its not an actually improvement then ofc you're right and and my bad for not checking it!
> 
> 2) Actually, this code is slower than the previous one:
> 
> {{{
> sage: p = MixedIntegerLinearProgram()
> sage: b = p.new_variable(binary=True)
> sage: %timeit sum(b[x] for x in range(1000))
> 10 loops, best of 3: 77.1 ms per loop
> sage: %timeit p.sum(b[x] for x in range(1000))
> 1000 loops, best of 3: 1.09 ms per loop
> }}}
> 
> This is because a "sum of LP variables" is a "linearfunction" object, and that adding to it another LP variable creates a second linearfunction object, which is mostly a copy of the previous one. Thus, `b[0]+b[1]+....+b[n]` creates `n` linearfunction objects and has a quadratic complexity.
> 
> That's why `p.sum` was created: as p.sum is dedicated to linearfunctions, it handles the, in the best way, without creating useless intermediate objects.
Oooh, I was really wondering why we're using p.sum...

> 
> Nathann
> 
> P.S. : If you fix this in a third commit, you will haev commits which undo what the previous commits do. It is actually possibly, using git, to merge them all into one (called "squash" in git slang).
> 
> Two ways:
> 
> 1) Look at "git rebase -i"
> 
> 2) If you run "git reset HEAD~1", the last commit is "destroyed" and the changes it contains become "unstaged" chages. This, together with "git commit --amend" is another way to merge the commits.

Thanks for that remark. Let's see how the things I now pushed go..
----
New commits:


---

Comment by ncohen created at 2014-11-26 19:42:38

Hello !

> I think its still fair to do such optimisations. They may come handy for say graphs of order ~100 and high degree. But if its not an actually improvement then ofc you're right and and my bad for not checking it!

Ahahah. Well, in that case with the cost of adding all constraints to the LP this objective function may only be 1% of the total. And I am not talking of solving the actual thing ! `:-P`

> Oooh, I was really wondering why we're using p.sum...

Plus it is hard to advertise, as "sum" works. I even cheat a bit by using "sum" when I do a talk about that `^^;`

> Thanks for that remark. Let's see how the things I now pushed go..

It seems to be the same as before. And there is this comment about Petersen's graph which is not followed by an example.

Nathann


---

Comment by git created at 2014-12-13 13:21:33

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by azi created at 2014-12-13 13:22:31

Nathann,

could  you  please check if this new patch makes more sense (code and gitwise)?

Best,

Jernej


---

Comment by ncohen created at 2014-12-13 15:09:54

Hello !

Well, it seems good to me. Except that this `scream if not simple` is only justified when `total=True`. And in this case, it is only a problem when you have loops (multiple edges are okay). Could you change it into `_scream_if_not_simple(allow_multiple_edges=True, allow_loops=not total)` ?

Nathann


---

Comment by git created at 2014-12-13 15:28:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by azi created at 2014-12-13 15:31:12

Do you think thats ok now?


---

Comment by ncohen created at 2014-12-13 15:32:26

> Do you think thats ok now?

Yepyep, I was running the tests. No problem, good to go. Thanks `:-)`

Nathann


---

Comment by ncohen created at 2014-12-13 15:32:26

Changing status from needs_work to positive_review.


---

Comment by azi created at 2014-12-13 15:33:40

Thank you for your review. BTW - Do we need to tell anyone which things to apply?


---

Comment by ncohen created at 2014-12-13 15:39:15

Which things to apply ? Well, the branch's name on the ticket is sufficient for that isn't it ? That is how I applied it myself for the review `:-P`

Nathann


---

Comment by azi created at 2014-12-13 15:40:54

Ooooh right,somehow you had to check something in order to give it a positive review :-) I am  just  confused about this new git system :))


---

Comment by ncohen created at 2014-12-13 15:43:01

> Ooooh right,somehow you had to check something in order to give it a positive review :-) I am  just  confused about this new git system :))

Welcome on the best side of it. You had to discover that it was MUUuuuuuch more complicated to create a branch than to create a .patch file, but you will now slowly find out the small tricks that make it easier to work with `^^;`

Nathann


---

Comment by vbraun created at 2014-12-16 19:04:46

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2014-12-16 19:04:46

Author name missing


---

Comment by azi created at 2014-12-16 20:19:53

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2014-12-18 00:57:10

Resolution: fixed
