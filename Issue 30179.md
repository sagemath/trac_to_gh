# Issue 30179: Make tox a standard package

archive/issues_030179.json:
```json
{
    "body": "CC:  @jhpalmieri @tobiasdiez @fchapoton @slel @orlitzky\n\nsee #30410; this will need a discussion/vote at sage-devel.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30416\n\n",
    "created_at": "2020-08-21T17:43:03Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Make tox a standard package",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30179",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @jhpalmieri @tobiasdiez @fchapoton @slel @orlitzky

see #30410; this will need a discussion/vote at sage-devel.

Issue created by migration from https://trac.sagemath.org/ticket/30416





---

archive/issue_comments_429641.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-09-09T17:03:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429641",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_429642.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-09T17:03:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429642",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_429643.json:
```json
{
    "body": "Should there also be an `spkg-configure.m4` file? (As a policy issue, should all new standard packages be encouraged, required if at all possible, to have such files, to try to maintain the momentum toward working well with distros?)",
    "created_at": "2020-09-09T18:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429643",
    "user": "https://github.com/jhpalmieri"
}
```

Should there also be an `spkg-configure.m4` file? (As a policy issue, should all new standard packages be encouraged, required if at all possible, to have such files, to try to maintain the momentum toward working well with distros?)



---

archive/issue_comments_429644.json:
```json
{
    "body": "That's a good idea, and I would support adding this policy too.",
    "created_at": "2020-09-09T18:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429644",
    "user": "https://github.com/mkoeppe"
}
```

That's a good idea, and I would support adding this policy too.



---

archive/issue_comments_429645.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-09-09T18:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429645",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_429646.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-09T21:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429646",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_429647.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-09-09T21:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429647",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_429648.json:
```json
{
    "body": "Replying to [comment:6 mkoeppe]:\n> That's a good idea, and I would support adding this policy too.\n\nSee #30543 for documentation for spkg-configure.m4 and the statement of this policy.",
    "created_at": "2020-09-09T21:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429648",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:6 mkoeppe]:
> That's a good idea, and I would support adding this policy too.

See #30543 for documentation for spkg-configure.m4 and the statement of this policy.



---

archive/issue_comments_429649.json:
```json
{
    "body": "We're missing some dependencies:\n\n```\ninstall_requires = \n\tfilelock>=3.0.0\n\tpackaging>=14\n\tpluggy>=0.12.0\n\tpy>=1.4.17\n\tsix>=1.14.0 # required when virtualenv>=20\n\ttoml>=0.9.4\n        virtualenv!=20.0.0,!=20.0.1,!=20.0.2,!=20.0.3,!=20.0.4,!=20.0.5,!=20.0.6,!=20.0.7,>=16.0.0\n\tcolorama>=0.4.1 ;platform_system==\"Windows\"\n\timportlib-metadata>=0.12,<2;python_version<\"3.8\"\n```\n\nWhen I run `./sage --tox --version`, I get\n\n```\nModuleNotFoundError: No module named 'pluggy'\n```\n",
    "created_at": "2020-09-09T22:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429649",
    "user": "https://github.com/jhpalmieri"
}
```

We're missing some dependencies:

```
install_requires = 
	filelock>=3.0.0
	packaging>=14
	pluggy>=0.12.0
	py>=1.4.17
	six>=1.14.0 # required when virtualenv>=20
	toml>=0.9.4
        virtualenv!=20.0.0,!=20.0.1,!=20.0.2,!=20.0.3,!=20.0.4,!=20.0.5,!=20.0.6,!=20.0.7,>=16.0.0
	colorama>=0.4.1 ;platform_system=="Windows"
	importlib-metadata>=0.12,<2;python_version<"3.8"
```

When I run `./sage --tox --version`, I get

```
ModuleNotFoundError: No module named 'pluggy'
```




---

archive/issue_comments_429650.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-09-10T00:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429650",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_429651.json:
```json
{
    "body": "Indeed, thanks for catching this.",
    "created_at": "2020-09-10T00:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429651",
    "user": "https://github.com/mkoeppe"
}
```

Indeed, thanks for catching this.



---

archive/issue_comments_429652.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-09-10T00:41:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429652",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_429653.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-12-27T18:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429653",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_429654.json:
```json
{
    "body": "Added these dependencies using the new tool described at https://wiki.sagemath.org/ReleaseTours/sage-9.3#For_developers:_Setting_up_Python_packages_from_PyPI_as_Sage_packages\n\nUntested so far - possibly needs more dependencies\n\nAnd probably the dependencies that are only needed by `tox` should be marked as not required if system tox is found.",
    "created_at": "2020-12-27T18:29:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429654",
    "user": "https://github.com/mkoeppe"
}
```

Added these dependencies using the new tool described at https://wiki.sagemath.org/ReleaseTours/sage-9.3#For_developers:_Setting_up_Python_packages_from_PyPI_as_Sage_packages

Untested so far - possibly needs more dependencies

And probably the dependencies that are only needed by `tox` should be marked as not required if system tox is found.



---

archive/issue_comments_429655.json:
```json
{
    "body": "`virtualenv` has the following additional dependencies:\n\n```\n        appdirs>=1.4.3,<2\n        distlib>=0.3.1,<1\n        filelock>=3.0.0,<4\n        six>=1.9.0,<2   # keep it >=1.9.0 as it may cause problems on LTS platforms\n        importlib-metadata>=0.12;python_version<\"3.8\"\n        importlib-resources>=1.0;python_version<\"3.7\"\n```\n",
    "created_at": "2021-01-02T04:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429655",
    "user": "https://github.com/mkoeppe"
}
```

`virtualenv` has the following additional dependencies:

```
        appdirs>=1.4.3,<2
        distlib>=0.3.1,<1
        filelock>=3.0.0,<4
        six>=1.9.0,<2   # keep it >=1.9.0 as it may cause problems on LTS platforms
        importlib-metadata>=0.12;python_version<"3.8"
        importlib-resources>=1.0;python_version<"3.7"
```




---

archive/issue_comments_429656.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-01-02T04:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429656",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_429657.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-05-27T22:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429657",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_429658.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-27T23:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429658",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_429659.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-05-27T23:12:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429659",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_429660.json:
```json
{
    "body": "`py` doesn't build for me; even if it did, it looks like it's trying to download things at the start of its build process. Log attached.",
    "created_at": "2021-05-28T05:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429660",
    "user": "https://github.com/jhpalmieri"
}
```

`py` doesn't build for me; even if it did, it looks like it's trying to download things at the start of its build process. Log attached.



---

archive/issue_comments_429661.json:
```json
{
    "body": "Attachment [py-1.10.0.log](tarball://root/attachments/some-uuid/ticket30416/py-1.10.0.log) by git created at 2021-05-28 05:35:23\n\nBranch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-28T05:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429661",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Attachment [py-1.10.0.log](tarball://root/attachments/some-uuid/ticket30416/py-1.10.0.log) by git created at 2021-05-28 05:35:23

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_429662.json:
```json
{
    "body": "It's a little unfortunate that the top-level `configure` recognizes that\n\n```\nconfigure:38013: checking for tox >= 2.5.0\nconfigure:38096: result: /usr/local/bin/tox\nconfigure:38107: will use system package and not install SPKG tox\n```\n\nbut our build system isn't smart enough to skip its dependencies.",
    "created_at": "2021-05-28T16:50:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429662",
    "user": "https://github.com/jhpalmieri"
}
```

It's a little unfortunate that the top-level `configure` recognizes that

```
configure:38013: checking for tox >= 2.5.0
configure:38096: result: /usr/local/bin/tox
configure:38107: will use system package and not install SPKG tox
```

but our build system isn't smart enough to skip its dependencies.



---

archive/issue_comments_429663.json:
```json
{
    "body": "Great point! I'll see what I can do about this",
    "created_at": "2021-05-28T16:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429663",
    "user": "https://github.com/mkoeppe"
}
```

Great point! I'll see what I can do about this



---

archive/issue_comments_429664.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-29T00:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429664",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_429665.json:
```json
{
    "body": "Here's something that will avoid installing 4 packages in this case:\n- `appdirs`, `distlib`, `filelock`, `virtualenv`\n\nI haven't added the same logic to the other packages:\n- `pluggy`, `py`, `toml` -- because they will also be needed as dependencies of `pytest` (see #31110)\n- `importlib_resources` -- because it is useful as a backport package (see #31306)",
    "created_at": "2021-05-29T01:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429665",
    "user": "https://github.com/mkoeppe"
}
```

Here's something that will avoid installing 4 packages in this case:
- `appdirs`, `distlib`, `filelock`, `virtualenv`

I haven't added the same logic to the other packages:
- `pluggy`, `py`, `toml` -- because they will also be needed as dependencies of `pytest` (see #31110)
- `importlib_resources` -- because it is useful as a backport package (see #31306)



---

archive/issue_comments_429666.json:
```json
{
    "body": "Okay, thanks, looks good.",
    "created_at": "2021-05-31T03:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429666",
    "user": "https://github.com/jhpalmieri"
}
```

Okay, thanks, looks good.



---

archive/issue_comments_429667.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-05-31T03:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429667",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_429668.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-05-31T05:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429668",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_comments_429669.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-06-20T08:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429669",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_027746.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2021-06-20T08:14:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30179#event-27746"
}
```



---

archive/issue_comments_429670.json:
```json
{
    "body": "Replying to [comment:26 jhpalmieri]:\n> `py` doesn't build for me; even if it did, it looks like it's trying to download things at the start of its build process. Log attached.\n\nWhat was the resolution to this?\n\nI'm getting build failure of sage because of this now. It's not terrible and I guess `py` isn't needed by anything. But I'm also wondering, why it is a dependency of `tox` and `pytest` in the first place. Neither of them lists `py` as a dependency. Where do we use it?",
    "created_at": "2021-06-22T09:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429670",
    "user": "https://github.com/kliem"
}
```

Replying to [comment:26 jhpalmieri]:
> `py` doesn't build for me; even if it did, it looks like it's trying to download things at the start of its build process. Log attached.

What was the resolution to this?

I'm getting build failure of sage because of this now. It's not terrible and I guess `py` isn't needed by anything. But I'm also wondering, why it is a dependency of `tox` and `pytest` in the first place. Neither of them lists `py` as a dependency. Where do we use it?



---

archive/issue_comments_429671.json:
```json
{
    "body": "Replying to [comment:35 gh-kliem]:\n> Replying to [comment:26 jhpalmieri]:\n> > `py` doesn't build for me; even if it did, it looks like it's trying to download things at the start of its build process. Log attached.\n> \n> What was the resolution to this?\n\nThe missing dependency on `setuptools_scm` was added\n\n> I'm getting build failure of sage because of this now. It's not terrible and I guess `py` isn't needed by anything. But I'm also wondering, why it is a dependency of `tox` and `pytest` in the first place. Neither of them lists `py` as a dependency. Where do we use it?\n\nIt's an `install_requires` of tox: https://github.com/tox-dev/tox/blob/master/setup.cfg",
    "created_at": "2021-06-22T13:41:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30179",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30179#issuecomment-429671",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:35 gh-kliem]:
> Replying to [comment:26 jhpalmieri]:
> > `py` doesn't build for me; even if it did, it looks like it's trying to download things at the start of its build process. Log attached.
> 
> What was the resolution to this?

The missing dependency on `setuptools_scm` was added

> I'm getting build failure of sage because of this now. It's not terrible and I guess `py` isn't needed by anything. But I'm also wondering, why it is a dependency of `tox` and `pytest` in the first place. Neither of them lists `py` as a dependency. Where do we use it?

It's an `install_requires` of tox: https://github.com/tox-dev/tox/blob/master/setup.cfg
