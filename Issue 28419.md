# Issue 28419: Incorrect behaviour of diff of an (hold) integral WRT its bounds.

archive/issues_028419.json:
```json
{
    "body": "Seen in this ask.sagemath [question](https://ask.sagemath.org/question/48486/differential-of-a-integral/), clarified in this sage-devel [thread](https://groups.google.com/forum/#!topic/sage-support/X0vI_UPcNF4) :\n\n\n```\nsage: var(\"t, a, b\")\n(t, a, b)\nsage: f=function(\"f\")\nsage: F1(a, b)=integrate(f(t), t, a, b)\nsage: F1(a, b).diff(b)\nf(b)\nsage: F1(a, b).diff(a)\n-f(a)\n```\n\n\nSo far, so good. But:\n\n```\nsage: F2(x)=integrate(f(t),t,0,x)\nsage: F2(x).diff(x)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-20-708f39997373> in <module>()\n----> 1 F2(x).diff(x)\n\n/usr/local/sage-python3/local/lib/python3.7/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.derivative (build/cythonized/sage/symbolic/expression.cpp:25543)()\n   4172             ValueError: No differentiation variable specified.\n   4173         \"\"\"\n-> 4174         return multi_derivative(self, args)\n   4175 \n   4176     diff = differentiate = derivative\n\n/usr/local/sage-python3/local/lib/python3.7/site-packages/sage/misc/derivative.pyx in sage.misc.derivative.multi_derivative (build/cythonized/sage/misc/derivative.c:3118)()\n    220 \n    221     for arg in derivative_parse(args):\n--> 222         F = F._derivative(arg)\n    223     return F\n    224 \n\n/usr/local/sage-python3/local/lib/python3.7/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._derivative (build/cythonized/sage/symbolic/expression.cpp:26060)()\n   4244         sig_on()\n   4245         try:\n-> 4246             x = self._gobj.diff(ex_to_symbol(symbol._gobj), deg)\n   4247         finally:\n   4248             sig_off()\n\n/usr/local/sage-python3/local/lib/python3.7/site-packages/sage/symbolic/integration/integral.py in _tderivative_(self, f, x, a, b, diff_param)\n    254             ans = SR.zero()\n    255         return (ans + f.subs(x == b) * b.diff(diff_param)\n--> 256                     - f.subs(x == a) * a.diff(diff_param))\n    257 \n    258     def _print_latex_(self, f, x, a, b):\n\n/usr/local/sage-python3/local/lib/python3.7/site-packages/sage/structure/element.pyx in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4608)()\n    487             AttributeError: 'LeftZeroSemigroup_with_category.element_class' object has no attribute 'blah_blah'\n    488         \"\"\"\n--> 489         return self.getattr_from_category(name)\n    490 \n    491     cdef getattr_from_category(self, name):\n\n/usr/local/sage-python3/local/lib/python3.7/site-packages/sage/structure/element.pyx in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4717)()\n    500         else:\n    501             cls = P._abstract_element_class\n--> 502         return getattr_from_other_class(self, cls, name)\n    503 \n    504     def __dir__(self):\n\n/usr/local/sage-python3/local/lib/python3.7/site-packages/sage/cpython/getattr.pyx in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2614)()\n    392         dummy_error_message.cls = type(self)\n    393         dummy_error_message.name = name\n--> 394         raise AttributeError(dummy_error_message)\n    395     attribute = <object>attr\n    396     # Check for a descriptor (__get__ in Python)\n\nAttributeError: 'sage.rings.rational.Rational' object has no attribute 'diff'\n```\n\n\nHighly annoying. The explanation given by Nils Bruin seems perfectly reasonable.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28656\n\n",
    "created_at": "2019-10-25T16:41:20Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Incorrect behaviour of diff of an (hold) integral WRT its bounds.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28419",
    "user": "https://github.com/EmmanuelCharpentier"
}
```
Seen in this ask.sagemath [question](https://ask.sagemath.org/question/48486/differential-of-a-integral/), clarified in this sage-devel [thread](https://groups.google.com/forum/#!topic/sage-support/X0vI_UPcNF4) :


```
sage: var("t, a, b")
(t, a, b)
sage: f=function("f")
sage: F1(a, b)=integrate(f(t), t, a, b)
sage: F1(a, b).diff(b)
f(b)
sage: F1(a, b).diff(a)
-f(a)
```


So far, so good. But:

```
sage: F2(x)=integrate(f(t),t,0,x)
sage: F2(x).diff(x)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-20-708f39997373> in <module>()
----> 1 F2(x).diff(x)

/usr/local/sage-python3/local/lib/python3.7/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.derivative (build/cythonized/sage/symbolic/expression.cpp:25543)()
   4172             ValueError: No differentiation variable specified.
   4173         """
-> 4174         return multi_derivative(self, args)
   4175 
   4176     diff = differentiate = derivative

/usr/local/sage-python3/local/lib/python3.7/site-packages/sage/misc/derivative.pyx in sage.misc.derivative.multi_derivative (build/cythonized/sage/misc/derivative.c:3118)()
    220 
    221     for arg in derivative_parse(args):
--> 222         F = F._derivative(arg)
    223     return F
    224 

/usr/local/sage-python3/local/lib/python3.7/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._derivative (build/cythonized/sage/symbolic/expression.cpp:26060)()
   4244         sig_on()
   4245         try:
-> 4246             x = self._gobj.diff(ex_to_symbol(symbol._gobj), deg)
   4247         finally:
   4248             sig_off()

/usr/local/sage-python3/local/lib/python3.7/site-packages/sage/symbolic/integration/integral.py in _tderivative_(self, f, x, a, b, diff_param)
    254             ans = SR.zero()
    255         return (ans + f.subs(x == b) * b.diff(diff_param)
--> 256                     - f.subs(x == a) * a.diff(diff_param))
    257 
    258     def _print_latex_(self, f, x, a, b):

/usr/local/sage-python3/local/lib/python3.7/site-packages/sage/structure/element.pyx in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4608)()
    487             AttributeError: 'LeftZeroSemigroup_with_category.element_class' object has no attribute 'blah_blah'
    488         """
--> 489         return self.getattr_from_category(name)
    490 
    491     cdef getattr_from_category(self, name):

/usr/local/sage-python3/local/lib/python3.7/site-packages/sage/structure/element.pyx in sage.structure.element.Element.getattr_from_category (build/cythonized/sage/structure/element.c:4717)()
    500         else:
    501             cls = P._abstract_element_class
--> 502         return getattr_from_other_class(self, cls, name)
    503 
    504     def __dir__(self):

/usr/local/sage-python3/local/lib/python3.7/site-packages/sage/cpython/getattr.pyx in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2614)()
    392         dummy_error_message.cls = type(self)
    393         dummy_error_message.name = name
--> 394         raise AttributeError(dummy_error_message)
    395     attribute = <object>attr
    396     # Check for a descriptor (__get__ in Python)

AttributeError: 'sage.rings.rational.Rational' object has no attribute 'diff'
```


Highly annoying. The explanation given by Nils Bruin seems perfectly reasonable.

Issue created by migration from https://trac.sagemath.org/ticket/28656





---

archive/issue_comments_400992.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28419#issuecomment-400992",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_400993.json:
```json
{
    "body": "Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.",
    "created_at": "2020-05-01T04:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28419#issuecomment-400993",
    "user": "https://github.com/mkoeppe"
}
```

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.



---

archive/issue_comments_400994.json:
```json
{
    "body": "here is a fix\n----\nNew commits:",
    "created_at": "2020-06-01T13:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28419#issuecomment-400994",
    "user": "https://github.com/fchapoton"
}
```

here is a fix
----
New commits:



---

archive/issue_comments_400995.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-01T13:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28419#issuecomment-400995",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_400996.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-01T17:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28419#issuecomment-400996",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_400997.json:
```json
{
    "body": "On Debian running on core i7 + 16 GB RAM, pulling this branch on top of 9.1 upgrades the latter to 9.2.beta0. When using all system packages recommended by `README.md`, this gives [11 permanent failures](https://groups.google.com/d/msg/sage-release/3mj1UjWf31g/uE7GqdfmAQAJ) ; however, most of them have already been reported for 9.1.rc3 using the same system packages, and explained away ; none of them seems to be integration-related.\n\n==> (tentative) `positive_review`.\n\nHowever, a check on a system using Sage packages would be useful.",
    "created_at": "2020-06-01T17:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28419#issuecomment-400997",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

On Debian running on core i7 + 16 GB RAM, pulling this branch on top of 9.1 upgrades the latter to 9.2.beta0. When using all system packages recommended by `README.md`, this gives [11 permanent failures](https://groups.google.com/d/msg/sage-release/3mj1UjWf31g/uE7GqdfmAQAJ) ; however, most of them have already been reported for 9.1.rc3 using the same system packages, and explained away ; none of them seems to be integration-related.

==> (tentative) `positive_review`.

However, a check on a system using Sage packages would be useful.



---

archive/issue_comments_400998.json:
```json
{
    "body": "reviewer name is missing",
    "created_at": "2020-06-03T22:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28419#issuecomment-400998",
    "user": "https://github.com/vbraun"
}
```

reviewer name is missing



---

archive/issue_comments_400999.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-06-03T22:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28419#issuecomment-400999",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_401000.json:
```json
{
    "body": "Wups ! Fixed...",
    "created_at": "2020-06-03T22:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28419#issuecomment-401000",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Wups ! Fixed...



---

archive/issue_comments_401001.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-06-03T22:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28419#issuecomment-401001",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_401002.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-06-21T22:37:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28419#issuecomment-401002",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_026305.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2020-06-21T22:37:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28419",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28419#event-26305"
}
```
