# Issue 27910: Remove _derivative from Polynomial_template

archive/issues_027910.json:
```json
{
    "body": "Keywords: polynomial\n\nRight now, the class `Polynomial_template` contains a method `_derivative`, called from the generic `derivative` (from `Polynomial`) through the function `multi_derivative` of `misc/derivative.pyx`. This method is quite badly written, with at least the following consequences:\n\n- It is **really** slow:\n\n```python\nsage: R.<x> = GF(65537)[]\nsage: p = R.random_element(10^4)\nsage: %time _ = p.derivative()\nCPU times: user 6.91 s, sys: 3.7 ms, total: 6.91 s\nWall time: 6.91 s\n```\n\n- It breaks the differentiation of power series, cf #26844. \n\n\nAfter removing it, I see no problem, #26844 is not a problem anymore, and we have a more reasonable computation time for the above example:\n\n```python\nsage: R.<x> = GF(65537)[]\nsage: p = R.random_element(10^4)\nsage: %time _ = p.derivative()\nCPU times: user 48.5 ms, sys: 145 \u00b5s, total: 48.7 ms\nWall time: 48.3 ms\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/28147\n\n",
    "created_at": "2019-07-09T18:07:48Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Remove _derivative from Polynomial_template",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27910",
    "user": "https://github.com/bgrenet"
}
```
Keywords: polynomial

Right now, the class `Polynomial_template` contains a method `_derivative`, called from the generic `derivative` (from `Polynomial`) through the function `multi_derivative` of `misc/derivative.pyx`. This method is quite badly written, with at least the following consequences:

- It is **really** slow:

```python
sage: R.<x> = GF(65537)[]
sage: p = R.random_element(10^4)
sage: %time _ = p.derivative()
CPU times: user 6.91 s, sys: 3.7 ms, total: 6.91 s
Wall time: 6.91 s
```

- It breaks the differentiation of power series, cf #26844. 


After removing it, I see no problem, #26844 is not a problem anymore, and we have a more reasonable computation time for the above example:

```python
sage: R.<x> = GF(65537)[]
sage: p = R.random_element(10^4)
sage: %time _ = p.derivative()
CPU times: user 48.5 ms, sys: 145 Âµs, total: 48.7 ms
Wall time: 48.3 ms
```

Issue created by migration from https://trac.sagemath.org/ticket/28147





---

archive/issue_comments_393667.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-10T07:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27910#issuecomment-393667",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393668.json:
```json
{
    "body": "I tried to detect potential problems with the removal of this method, but I didn't find any. Feel free to suggest where to look at!",
    "created_at": "2019-07-10T07:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27910#issuecomment-393668",
    "user": "https://github.com/bgrenet"
}
```

I tried to detect potential problems with the removal of this method, but I didn't find any. Feel free to suggest where to look at!



---

archive/issue_comments_393669.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-07-10T07:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27910#issuecomment-393669",
    "user": "https://github.com/bgrenet"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_393670.json:
```json
{
    "body": "Hi Bruno,\n\nI think you may want to adapt some of the doctests you are removing. Otherwise lgtm...",
    "created_at": "2019-07-23T17:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27910#issuecomment-393670",
    "user": "https://github.com/mezzarobba"
}
```

Hi Bruno,

I think you may want to adapt some of the doctests you are removing. Otherwise lgtm...



---

archive/issue_comments_393671.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-19T16:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27910#issuecomment-393671",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393672.json:
```json
{
    "body": "Hi Marc, \n\nI imported the removed doctests, and had errors... I had to change the error message when one tries to differentiate with respect to something \"weird\". In my view, this improves the current situation. In particular I do not find the following doctest (that I changed) very satisfying:\n\n```\nIn the following example, it doesn't recognise 2\\*x as the\ngenerator, so it tries to differentiate each of the coefficients\nwith respect to 2\\*x, which doesn't work because the integer\ncoefficients don't have a _derivative() method::\n\n    sage: f._derivative(2*x)\n    Traceback (most recent call last):\n    ...\n    AttributeError: 'sage.rings.integer.Integer' object has no attribute '_derivative'\n```\n\nThe new doctest seems more reasonable to me:\n\n```\nIt is not possible to differentiate with respect to 2\\*x for instance::\n\n    sage: f._derivative(2*x)\n    Traceback (most recent call last):\n    ...\n    ValueError: cannot differentiate with respect to 2*x\n```",
    "created_at": "2019-08-19T17:04:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27910#issuecomment-393672",
    "user": "https://github.com/bgrenet"
}
```

Hi Marc, 

I imported the removed doctests, and had errors... I had to change the error message when one tries to differentiate with respect to something "weird". In my view, this improves the current situation. In particular I do not find the following doctest (that I changed) very satisfying:

```
In the following example, it doesn't recognise 2\*x as the
generator, so it tries to differentiate each of the coefficients
with respect to 2\*x, which doesn't work because the integer
coefficients don't have a _derivative() method::

    sage: f._derivative(2*x)
    Traceback (most recent call last):
    ...
    AttributeError: 'sage.rings.integer.Integer' object has no attribute '_derivative'
```

The new doctest seems more reasonable to me:

```
It is not possible to differentiate with respect to 2\*x for instance::

    sage: f._derivative(2*x)
    Traceback (most recent call last):
    ...
    ValueError: cannot differentiate with respect to 2*x
```



---

archive/issue_comments_393673.json:
```json
{
    "body": "Thank you!",
    "created_at": "2019-08-21T07:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27910#issuecomment-393673",
    "user": "https://github.com/mezzarobba"
}
```

Thank you!



---

archive/issue_comments_393674.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-21T07:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27910#issuecomment-393674",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_393675.json:
```json
{
    "body": "Thank you for the review. Could you have a quick look to #26844 to confirm that the bug is indeed fixed by the current ticket?",
    "created_at": "2019-08-21T09:21:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27910#issuecomment-393675",
    "user": "https://github.com/bgrenet"
}
```

Thank you for the review. Could you have a quick look to #26844 to confirm that the bug is indeed fixed by the current ticket?



---

archive/issue_comments_393676.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-08-29T20:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27910#issuecomment-393676",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_069894.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-29T20:02:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27910#event-69894"
}
```
