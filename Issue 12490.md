# Issue 12490: Improve doctest coverage for sage.rings.qqbar

Issue created by migration from https://trac.sagemath.org/ticket/12662

Original creator: davidloeffler

Original creation time: 2012-03-13 12:03:24

Assignee: mvngu

CC:  jstarx

... from its current abysmal 45% (112 of 244) to something a bit more respectable.


---

Attachment

Patch against 5.0.beta7


---

Comment by davidloeffler created at 2012-03-13 17:18:52

Changing status from new to needs_review.


---

Comment by davidloeffler created at 2012-03-13 17:18:52

Here's a patch which gets full doctest coverage.


---

Comment by mjo created at 2012-03-22 16:46:28

Can't we just get rid of this stuff? If anyone misses it, it's in the mercurial history.


```
-    def gens(self):
-        return(QQbar_I, )
-
-    def gen(self, n=0):
-        if n == 0:
-            return QQbar_I
-        else:
-            raise IndexError, "n must be 0"
-
-    def ngens(self):
-        return 1
+# more nonsense -- DL
+#
+#    def gens(self):
+#        return(QQbar_I, )
+#
+#    def gen(self, n=0):
+#        if n == 0:
+#            return QQbar_I
+#        else:
+#            raise IndexError("n must be 0")
+#
+#    def ngens(self):
+#        return 1
```



---

Comment by JStarx created at 2012-03-25 01:47:38

The functions `gen`, `gens`, and `ngens` override methods from `ParentWithGens` and `_is_valid_homomorphism_` overrides a method from `Parent`.  If you don't override them then calling them will return a `NotImplementedError` which doesn't seem wise as they are used, for example `_is_valid_homomorphism_` is called by the init method of `RingHomomorphism_im_gens`.

Also I do think they make mathematical sense.  A field is generated by a single element, the 1 of the field, and for a homomorphism of fields we must send 1 to 1.


---

Comment by davidloeffler created at 2012-03-25 08:30:26

All right, I'll put them back in.


---

Comment by davidloeffler created at 2012-03-25 08:30:26

Changing status from needs_review to needs_work.


---

Comment by davidloeffler created at 2012-03-25 11:09:23

Apply only this patch. Patch against 5.0.beta10


---

Comment by davidloeffler created at 2012-03-25 11:10:13

Changing status from needs_work to needs_review.


---

Attachment

Here's a new patch which adds doctests for these routines instead of commenting them out.


---

Comment by JStarx created at 2012-03-26 01:33:43

Changing status from needs_review to needs_work.


---

Comment by JStarx created at 2012-03-26 01:33:43

I applied this to beta10, running OSX 10.6.8, and got the following two failures:


```
~/sage-dev/devel/sage-main Starx$ ../../sage -t sage/rings/qqbar.py
sage -t  "devel/sage-main/sage/rings/qqbar.py"              
**********************************************************************
File "/Users/Starx/sage-dev/devel/sage-main/sage/rings/qqbar.py", line 535:
    sage: sage.rings.qqbar._late_import()
Exception raised:
    Traceback (most recent call last):
      File "/Users/Starx/sage-dev/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/Starx/sage-dev/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/Starx/sage-dev/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_1[2]>", line 1, in <module>
        sage.rings.qqbar._late_import()###line 535:
    sage: sage.rings.qqbar._late_import()
    AttributeError: 'module' object has no attribute '_late_import'
**********************************************************************
File "/Users/Starx/sage-dev/devel/sage-main/sage/rings/qqbar.py", line 2128:
    sage: qq_generator.pari_field()
Expected:
    Traceback (most recent call last):
    ...
    ValueError: No PARI field attached to trivial generator
Got:
    Traceback (most recent call last):
      File "/Users/Starx/sage-dev/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/Starx/sage-dev/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/Starx/sage-dev/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_68[3]>", line 1, in <module>
        qq_generator.pari_field()###line 2128:
    sage: qq_generator.pari_field()
      File "/Users/Starx/sage-dev/local/lib/python/site-packages/sage/rings/qqbar.py", line 1670, in pari_field
        pari_pol = self._field.pari_polynomial("y")
      File "parent.pyx", line 875, in sage.structure.parent.Parent.__getattr__ (sage/structure/parent.c:6731)
      File "parent.pyx", line 326, in sage.structure.parent.getattr_from_other_class (sage/structure/parent.c:3247)
    AttributeError: 'RationalField_with_category' object has no attribute 'pari_polynomial'
**********************************************************************
2 items had failures:
   1 of   5 in __main__.example_1
   1 of  12 in __main__.example_68
***Test Failed*** 2 failures.
```



---

Comment by davidloeffler created at 2012-03-26 06:53:05

Dear JStarx,

I strongly suspect you applied the patch and ran "sage -t" without running "sage -b" first, which gives exactly these two errors. (They come from the two non-docstring changes in the patch: I renamed ` late_import ` to ` _late_import ` so it wouldn't appear in the reference manual, and added one line to ` AlgebraicGenerator.pari_polynomial ` so it gave a more informative error message when called on the rational field.)

Can you run "sage -b" and then do the test again?


---

Comment by davidloeffler created at 2012-03-26 06:53:05

Changing status from needs_work to needs_info.


---

Comment by JStarx created at 2012-03-26 07:03:14

Yup, silly mistake.  All the tests pass.  It's getting late, but when I get some time this week I'll finish reading through the diff and review it.


---

Comment by JStarx created at 2012-03-26 07:03:14

Changing status from needs_info to needs_review.


---

Comment by JStarx created at 2012-03-27 03:59:49

Ok, it all looks good.  The only minor tweek I would make is to delete the commented stuff on lines 7594 - 7641.  Not sure why that's there or why we wouldn't delete it.

Anyway, I'm gonna set it as a positive review.  If you agree that that commented stuff can be deleted then feel free to keep the ticket marked as a positive review after deleting it.


---

Comment by JStarx created at 2012-03-27 03:59:49

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-03-28 10:05:51

Resolution: fixed
