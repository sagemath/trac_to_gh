# Issue 34107: Update setuptools to 64.0.0

archive/issues_034107.json:
```json
{
    "body": "CC:  fbissey arojas saraedum jhpalmieri\n\nThis brings PEP 660 editable installs.\n\nHere on this ticket, we disable them. The follow-up ticket #34209 will switch editable builds to this new technology.\n\nIssue created by migration from https://trac.sagemath.org/ticket/34344\n\n",
    "created_at": "2022-08-11T19:11:24Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "title": "Update setuptools to 64.0.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34107",
    "user": "mkoeppe"
}
```
CC:  fbissey arojas saraedum jhpalmieri

This brings PEP 660 editable installs.

Here on this ticket, we disable them. The follow-up ticket #34209 will switch editable builds to this new technology.

Issue created by migration from https://trac.sagemath.org/ticket/34344





---

archive/issue_comments_483893.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-08-11T19:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483893",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_483894.json:
```json
{
    "body": "This version of setuptools breaks the build of our numpy-1.22.4 package\n\n```\n    File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/Cython/Distutils/old_build_ext.py\", line 157, in __getattr__\n      return _build_ext.build_ext.__getattr__(self, name)\n    File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/setuptools/_distutils/cmd.py\", line 105, in __getattr__\n      raise AttributeError(attr)\n  AttributeError: fcompiler\n  error: subprocess-exited-with-error\n  \n  \u00d7 python setup.py egg_info did not run successfully.\n  \u2502 exit code: 1\n\n```\n",
    "created_at": "2022-08-11T19:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483894",
    "user": "mkoeppe"
}
```

This version of setuptools breaks the build of our numpy-1.22.4 package

```
    File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/Cython/Distutils/old_build_ext.py", line 157, in __getattr__
      return _build_ext.build_ext.__getattr__(self, name)
    File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/setuptools/_distutils/cmd.py", line 105, in __getattr__
      raise AttributeError(attr)
  AttributeError: fcompiler
  error: subprocess-exited-with-error
  
  × python setup.py egg_info did not run successfully.
  │ exit code: 1

```




---

archive/issue_comments_483895.json:
```json
{
    "body": "Actually it needs to be `SETUPTOOLS_ENABLE_FEATURES` (plural) https://github.com/pypa/setuptools/pull/3538",
    "created_at": "2022-08-26T15:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483895",
    "user": "mkoeppe"
}
```

Actually it needs to be `SETUPTOOLS_ENABLE_FEATURES` (plural) https://github.com/pypa/setuptools/pull/3538



---

archive/issue_comments_483896.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-26T15:27:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483896",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483897.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-26T15:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483897",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483898.json:
```json
{
    "body": "The updated `setuptools` still causes the same build failure with our numpy 1.22.4.",
    "created_at": "2022-08-26T18:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483898",
    "user": "mkoeppe"
}
```

The updated `setuptools` still causes the same build failure with our numpy 1.22.4.



---

archive/issue_comments_483899.json:
```json
{
    "body": "The upgrade to numpy 1.23.3 (#34110) does not help.\n\nIn fact, upstream numpy is moving away from `numpy.distutils` and does not intend to keep it working with newer setuptools - https://github.com/numpy/numpy/pull/22154\n\nBreaking the numpy build system has been raised as  https://github.com/pypa/setuptools/issues/3549 - no solution as of 2022-09-23",
    "created_at": "2022-09-23T23:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483899",
    "user": "mkoeppe"
}
```

The upgrade to numpy 1.23.3 (#34110) does not help.

In fact, upstream numpy is moving away from `numpy.distutils` and does not intend to keep it working with newer setuptools - https://github.com/numpy/numpy/pull/22154

Breaking the numpy build system has been raised as  https://github.com/pypa/setuptools/issues/3549 - no solution as of 2022-09-23



---

archive/issue_comments_483900.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-09-24T01:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483900",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_483901.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-24T01:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483901",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483902.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-09-24T01:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483902",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_483903.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-24T02:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483903",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483904.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-24T23:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483904",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483905.json:
```json
{
    "body": "This almost looks like a straightforward upgrade. My only questions are about `setuptools` vs. `setuptools_wheel`: how does `numpy` (and maybe that's the only relevant package) know not to use `setuptools_wheel`? And could there be there an issue with having mismatched versions of `setuptools` and `setuptools_wheel`?",
    "created_at": "2022-09-25T03:23:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483905",
    "user": "jhpalmieri"
}
```

This almost looks like a straightforward upgrade. My only questions are about `setuptools` vs. `setuptools_wheel`: how does `numpy` (and maybe that's the only relevant package) know not to use `setuptools_wheel`? And could there be there an issue with having mismatched versions of `setuptools` and `setuptools_wheel`?



---

archive/issue_comments_483906.json:
```json
{
    "body": "Since #33789, we use build isolation for all Python packages that use `sdh_pip_install` - except for those that we invoke with `--no-use-pep517` or `--no-build-isolation`.\nWhen build isolation is in use, it does not matter what is installed in `site-packages`, as it creates a fresh build environment using the wheels in `venv/var/lib/sage/wheels/`; this includes the setuptools wheel, which is provided by our `setuptools_wheel` SPKG.\nThe versions don't need to be synchronized - a setuptools-based package uses exactly one of the two.",
    "created_at": "2022-09-25T03:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483906",
    "user": "mkoeppe"
}
```

Since #33789, we use build isolation for all Python packages that use `sdh_pip_install` - except for those that we invoke with `--no-use-pep517` or `--no-build-isolation`.
When build isolation is in use, it does not matter what is installed in `site-packages`, as it creates a fresh build environment using the wheels in `venv/var/lib/sage/wheels/`; this includes the setuptools wheel, which is provided by our `setuptools_wheel` SPKG.
The versions don't need to be synchronized - a setuptools-based package uses exactly one of the two.



---

archive/issue_comments_483907.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-25T04:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483907",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483908.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-26T19:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483908",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_483909.json:
```json
{
    "body": "Okay, let's merge it.",
    "created_at": "2022-09-26T19:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483909",
    "user": "jhpalmieri"
}
```

Okay, let's merge it.



---

archive/issue_comments_483910.json:
```json
{
    "body": "Thanks!",
    "created_at": "2022-09-26T20:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483910",
    "user": "mkoeppe"
}
```

Thanks!



---

archive/issue_comments_483911.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-09-28T23:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34107",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34107#issuecomment-483911",
    "user": "vbraun"
}
```

Resolution: fixed
