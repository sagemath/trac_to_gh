# Issue 15650: Make GSL random distributions seed from Sage's random state

archive/issues_015650.json:
```json
{
    "body": "CC:  @rbeezer\n\nGSL's random state currently seeds from python's random state, not from Sage's random state.  These changes make it so that Sage's set_random_seed() function\naffects the GSL distributions.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15887\n\n",
    "created_at": "2014-03-05T02:42:37Z",
    "labels": [
        "component: misc",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Make GSL random distributions seed from Sage's random state",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15650",
    "user": "https://github.com/jasongrout"
}
```
CC:  @rbeezer

GSL's random state currently seeds from python's random state, not from Sage's random state.  These changes make it so that Sage's set_random_seed() function
affects the GSL distributions.

Issue created by migration from https://trac.sagemath.org/ticket/15887





---

archive/issue_comments_202356.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-03-05T02:46:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202356",
    "user": "https://github.com/jasongrout"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_202357.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-05T03:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202357",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_202358.json:
```json
{
    "body": "I think the changes are correct.  I'm building on another system to make sure what I think is now controllable is actually controllable (especially the random matrix doctests)",
    "created_at": "2014-03-05T03:19:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202358",
    "user": "https://github.com/jasongrout"
}
```

I think the changes are correct.  I'm building on another system to make sure what I think is now controllable is actually controllable (especially the random matrix doctests)



---

archive/issue_comments_202359.json:
```json
{
    "body": "I tested the matrix/constructor.py and the gsl/ directory on a different platform (ubuntu 12.04 and os x mavericks), and they both passed tests.\n\nRob, can you review this?",
    "created_at": "2014-03-05T04:27:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202359",
    "user": "https://github.com/jasongrout"
}
```

I tested the matrix/constructor.py and the gsl/ directory on a different platform (ubuntu 12.04 and os x mavericks), and they both passed tests.

Rob, can you review this?



---

archive/issue_comments_202360.json:
```json
{
    "body": "pinging `@`rbeezer...when you have time, can you take a look at this?  I'd like to get it into Sage so I don't have to carry around that extra patch on the sage cell server to make webwork work :).",
    "created_at": "2014-03-14T14:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202360",
    "user": "https://github.com/jasongrout"
}
```

pinging `@`rbeezer...when you have time, can you take a look at this?  I'd like to get it into Sage so I don't have to carry around that extra patch on the sage cell server to make webwork work :).



---

archive/issue_comments_202361.json:
```json
{
    "body": "Rob - as I am now the one who carries this patch - ping again!",
    "created_at": "2014-06-21T01:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202361",
    "user": "https://github.com/novoselt"
}
```

Rob - as I am now the one who carries this patch - ping again!



---

archive/issue_comments_202362.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-17T22:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202362",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_202363.json:
```json
{
    "body": "On the one hand it needs rebasing, on the other hand it would be really nice to get it merged, so rebasing SageCell to new Sage versions is easier...",
    "created_at": "2014-10-17T22:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202363",
    "user": "https://github.com/novoselt"
}
```

On the one hand it needs rebasing, on the other hand it would be really nice to get it merged, so rebasing SageCell to new Sage versions is easier...



---

archive/issue_comments_202364.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-10-20T23:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202364",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_202365.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-10-20T23:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202365",
    "user": "https://github.com/novoselt"
}
```

New commits:



---

archive/issue_comments_202366.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-21T00:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202366",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_202367.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-21T22:05:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202367",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_202368.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-10-21T22:06:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202368",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_202369.json:
```json
{
    "body": "Fixed output and I think it is a fine solution to the original problem, so positive review.",
    "created_at": "2014-10-21T22:06:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202369",
    "user": "https://github.com/novoselt"
}
```

Fixed output and I think it is a fine solution to the original problem, so positive review.



---

archive/issue_comments_202370.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-10-22T19:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202370",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_202371.json:
```json
{
    "body": "I get the following on Arando (32-bit linux): http://build.sagedev.org/release/builders/%20%20fast%20Oxford%20arando%20%28Ubuntu%2013.04%20i686%29%20incremental/builds/44/steps/shell_4/logs/stdio",
    "created_at": "2014-10-22T19:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202371",
    "user": "https://github.com/vbraun"
}
```

I get the following on Arando (32-bit linux): http://build.sagedev.org/release/builders/%20%20fast%20Oxford%20arando%20%28Ubuntu%2013.04%20i686%29%20incremental/builds/44/steps/shell_4/logs/stdio



---

archive/issue_comments_202372.json:
```json
{
    "body": "Hmmm, any hints on what to do to fix it (and how to test it in the process)?..",
    "created_at": "2014-10-23T05:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202372",
    "user": "https://github.com/novoselt"
}
```

Hmmm, any hints on what to do to fix it (and how to test it in the process)?..



---

archive/issue_comments_202373.json:
```json
{
    "body": "How about always using `2^31` instead of `sys.maxsize` when initializing the gsl rng.",
    "created_at": "2014-10-23T11:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202373",
    "user": "https://github.com/vbraun"
}
```

How about always using `2^31` instead of `sys.maxsize` when initializing the gsl rng.



---

archive/issue_comments_202374.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-27T19:53:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202374",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_202375.json:
```json
{
    "body": "Switched to `2**31`, everything works on a 64-bit system. Should we be concerned that 2<sup>31</sup> may be too much as well, or there are no plans to support bitness of less that 32?-)",
    "created_at": "2014-10-27T19:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202375",
    "user": "https://github.com/novoselt"
}
```

Switched to `2**31`, everything works on a 64-bit system. Should we be concerned that 2<sup>31</sup> may be too much as well, or there are no plans to support bitness of less that 32?-)



---

archive/issue_comments_202376.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-10-27T19:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202376",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_202377.json:
```json
{
    "body": "16 bit is not enough addressable ram to build Sage ;-)",
    "created_at": "2014-10-27T21:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202377",
    "user": "https://github.com/vbraun"
}
```

16 bit is not enough addressable ram to build Sage ;-)



---

archive/issue_comments_202378.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-10-27T21:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202378",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_202379.json:
```json
{
    "body": "I get now the following on our 32-bit machine. It is all just numerical noise, can you add suitable `# rel tol` statements?\n\n```\nsage -t --long src/sage/gsl/probability_distribution.pyx\n**********************************************************************\nFile \"src/sage/gsl/probability_distribution.pyx\", line 188, in sage.gsl.probability_distribution.SphericalDistribution\nFailed example:\n    T.get_random_element()\nExpected:\n    (-0.2922296724828204, -0.9563459345927822, 0.0020668595602153475)\nGot:\n    (-0.2922296724828204, -0.9563459345927822, 0.0020668595602153454)\n**********************************************************************\nFile \"src/sage/gsl/probability_distribution.pyx\", line 191, in sage.gsl.probability_distribution.SphericalDistribution\nFailed example:\n    T.get_random_element()\nExpected:\n    (-0.03633004347616311, 0.6459885817544099, 0.24825817345598164, 0.7209346430129753)\nGot:\n    (-0.0363300434761631, 0.6459885817544098, 0.24825817345598158, 0.7209346430129753)\n**********************************************************************\nFile \"src/sage/gsl/probability_distribution.pyx\", line 215, in sage.gsl.probability_distribution.SphericalDistribution.__init__\nFailed example:\n    T.get_random_element()\nExpected:\n    (-0.2922296724828204, -0.9563459345927822, 0.0020668595602153475)\nGot:\n    (-0.2922296724828204, -0.9563459345927822, 0.0020668595602153454)\n**********************************************************************\nFile \"src/sage/gsl/probability_distribution.pyx\", line 408, in sage.gsl.probability_distribution.RealDistribution\nFailed example:\n    T.get_random_element()\nExpected:\n    -8.404911172800617\nGot:\n    -8.404911172800615\n**********************************************************************\nFile \"src/sage/gsl/probability_distribution.pyx\", line 421, in sage.gsl.probability_distribution.RealDistribution\nFailed example:\n    F.get_random_element()\nExpected:\n    1.2392337861152563\nGot:\n    1.239233786115256\n**********************************************************************\nFile \"src/sage/gsl/probability_distribution.pyx\", line 461, in sage.gsl.probability_distribution.RealDistribution\nFailed example:\n    T.get_random_element()\nExpected:\n    0.7110581877139807\nGot:\n    0.7110581877139808\n**********************************************************************\n3 items had failures:\n   3 of  75 in sage.gsl.probability_distribution.RealDistribution\n   2 of   7 in sage.gsl.probability_distribution.SphericalDistribution\n   1 of  11 in sage.gsl.probability_distribution.SphericalDistribution.__init__\n    [207 tests, 6 failures, 2.03 s]\n```\n",
    "created_at": "2014-10-28T19:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202379",
    "user": "https://github.com/vbraun"
}
```

I get now the following on our 32-bit machine. It is all just numerical noise, can you add suitable `# rel tol` statements?

```
sage -t --long src/sage/gsl/probability_distribution.pyx
**********************************************************************
File "src/sage/gsl/probability_distribution.pyx", line 188, in sage.gsl.probability_distribution.SphericalDistribution
Failed example:
    T.get_random_element()
Expected:
    (-0.2922296724828204, -0.9563459345927822, 0.0020668595602153475)
Got:
    (-0.2922296724828204, -0.9563459345927822, 0.0020668595602153454)
**********************************************************************
File "src/sage/gsl/probability_distribution.pyx", line 191, in sage.gsl.probability_distribution.SphericalDistribution
Failed example:
    T.get_random_element()
Expected:
    (-0.03633004347616311, 0.6459885817544099, 0.24825817345598164, 0.7209346430129753)
Got:
    (-0.0363300434761631, 0.6459885817544098, 0.24825817345598158, 0.7209346430129753)
**********************************************************************
File "src/sage/gsl/probability_distribution.pyx", line 215, in sage.gsl.probability_distribution.SphericalDistribution.__init__
Failed example:
    T.get_random_element()
Expected:
    (-0.2922296724828204, -0.9563459345927822, 0.0020668595602153475)
Got:
    (-0.2922296724828204, -0.9563459345927822, 0.0020668595602153454)
**********************************************************************
File "src/sage/gsl/probability_distribution.pyx", line 408, in sage.gsl.probability_distribution.RealDistribution
Failed example:
    T.get_random_element()
Expected:
    -8.404911172800617
Got:
    -8.404911172800615
**********************************************************************
File "src/sage/gsl/probability_distribution.pyx", line 421, in sage.gsl.probability_distribution.RealDistribution
Failed example:
    F.get_random_element()
Expected:
    1.2392337861152563
Got:
    1.239233786115256
**********************************************************************
File "src/sage/gsl/probability_distribution.pyx", line 461, in sage.gsl.probability_distribution.RealDistribution
Failed example:
    T.get_random_element()
Expected:
    0.7110581877139807
Got:
    0.7110581877139808
**********************************************************************
3 items had failures:
   3 of  75 in sage.gsl.probability_distribution.RealDistribution
   2 of   7 in sage.gsl.probability_distribution.SphericalDistribution
   1 of  11 in sage.gsl.probability_distribution.SphericalDistribution.__init__
    [207 tests, 6 failures, 2.03 s]
```




---

archive/issue_comments_202380.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-10-28T19:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202380",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_202381.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-04T23:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202381",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_202382.json:
```json
{
    "body": "Changed the output to the one you got, so that it is easy to test on 64-bit systems.",
    "created_at": "2014-11-04T23:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202382",
    "user": "https://github.com/novoselt"
}
```

Changed the output to the one you got, so that it is easy to test on 64-bit systems.



---

archive/issue_comments_202383.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-11-04T23:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202383",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_202384.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-05T10:38:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202384",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_202385.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-11-05T10:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202385",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_202386.json:
```json
{
    "body": "Merge conflict with #17278",
    "created_at": "2014-11-05T10:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202386",
    "user": "https://github.com/vbraun"
}
```

Merge conflict with #17278



---

archive/issue_comments_202387.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-05T19:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202387",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_202388.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-11-05T19:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202388",
    "user": "https://github.com/novoselt"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_202389.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-05T19:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202389",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_202390.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-11-06T11:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202390",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_202391.json:
```json
{
    "body": "Hooray, thanks for the quick reviews, Volker!",
    "created_at": "2014-11-06T20:04:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15650#issuecomment-202391",
    "user": "https://github.com/novoselt"
}
```

Hooray, thanks for the quick reviews, Volker!
