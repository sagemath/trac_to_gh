# Issue 15650: Make GSL random distributions seed from Sage's random state

Issue created by migration from https://trac.sagemath.org/ticket/15887

Original creator: jason

Original creation time: 2014-03-05 02:42:37

CC:  rbeezer

GSL's random state currently seeds from python's random state, not from Sage's random state.  These changes make it so that Sage's set_random_seed() function
affects the GSL distributions.


---

Comment by jason created at 2014-03-05 02:46:59

Changing status from new to needs_review.


---

Comment by git created at 2014-03-05 03:07:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jason created at 2014-03-05 03:19:09

I think the changes are correct.  I'm building on another system to make sure what I think is now controllable is actually controllable (especially the random matrix doctests)


---

Comment by jason created at 2014-03-05 04:27:34

I tested the matrix/constructor.py and the gsl/ directory on a different platform (ubuntu 12.04 and os x mavericks), and they both passed tests.

Rob, can you review this?


---

Comment by jason created at 2014-03-14 14:37:25

pinging `@`rbeezer...when you have time, can you take a look at this?  I'd like to get it into Sage so I don't have to carry around that extra patch on the sage cell server to make webwork work :).


---

Comment by novoselt created at 2014-06-21 01:39:21

Rob - as I am now the one who carries this patch - ping again!


---

Comment by novoselt created at 2014-10-17 22:57:49

Changing status from needs_review to needs_work.


---

Comment by novoselt created at 2014-10-17 22:57:49

On the one hand it needs rebasing, on the other hand it would be really nice to get it merged, so rebasing SageCell to new Sage versions is easier...


---

Comment by novoselt created at 2014-10-20 23:52:15

Changing status from needs_work to needs_review.


---

Comment by novoselt created at 2014-10-20 23:52:15

New commits:


---

Comment by novoselt created at 2014-10-21 00:07:49

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-10-21 22:05:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by novoselt created at 2014-10-21 22:06:46

Changing status from needs_work to positive_review.


---

Comment by novoselt created at 2014-10-21 22:06:46

Fixed output and I think it is a fine solution to the original problem, so positive review.


---

Comment by vbraun created at 2014-10-22 19:35:50

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2014-10-22 19:35:50

I get the following on Arando (32-bit linux): http://build.sagedev.org/release/builders/%20%20fast%20Oxford%20arando%20%28Ubuntu%2013.04%20i686%29%20incremental/builds/44/steps/shell_4/logs/stdio


---

Comment by novoselt created at 2014-10-23 05:07:31

Hmmm, any hints on what to do to fix it (and how to test it in the process)?..


---

Comment by vbraun created at 2014-10-23 11:23:35

How about always using `2^31` instead of `sys.maxsize` when initializing the gsl rng.


---

Comment by git created at 2014-10-27 19:53:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by novoselt created at 2014-10-27 19:56:47

Switched to `2**31`, everything works on a 64-bit system. Should we be concerned that 2<sup>31</sup> may be too much as well, or there are no plans to support bitness of less that 32?-)


---

Comment by novoselt created at 2014-10-27 19:56:47

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2014-10-27 21:26:40

16 bit is not enough addressable ram to build Sage ;-)


---

Comment by vbraun created at 2014-10-27 21:26:40

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-10-28 19:35:33

I get now the following on our 32-bit machine. It is all just numerical noise, can you add suitable `# rel tol` statements?

```
sage -t --long src/sage/gsl/probability_distribution.pyx
**********************************************************************
File "src/sage/gsl/probability_distribution.pyx", line 188, in sage.gsl.probability_distribution.SphericalDistribution
Failed example:
    T.get_random_element()
Expected:
    (-0.2922296724828204, -0.9563459345927822, 0.0020668595602153475)
Got:
    (-0.2922296724828204, -0.9563459345927822, 0.0020668595602153454)
**********************************************************************
File "src/sage/gsl/probability_distribution.pyx", line 191, in sage.gsl.probability_distribution.SphericalDistribution
Failed example:
    T.get_random_element()
Expected:
    (-0.03633004347616311, 0.6459885817544099, 0.24825817345598164, 0.7209346430129753)
Got:
    (-0.0363300434761631, 0.6459885817544098, 0.24825817345598158, 0.7209346430129753)
**********************************************************************
File "src/sage/gsl/probability_distribution.pyx", line 215, in sage.gsl.probability_distribution.SphericalDistribution.__init__
Failed example:
    T.get_random_element()
Expected:
    (-0.2922296724828204, -0.9563459345927822, 0.0020668595602153475)
Got:
    (-0.2922296724828204, -0.9563459345927822, 0.0020668595602153454)
**********************************************************************
File "src/sage/gsl/probability_distribution.pyx", line 408, in sage.gsl.probability_distribution.RealDistribution
Failed example:
    T.get_random_element()
Expected:
    -8.404911172800617
Got:
    -8.404911172800615
**********************************************************************
File "src/sage/gsl/probability_distribution.pyx", line 421, in sage.gsl.probability_distribution.RealDistribution
Failed example:
    F.get_random_element()
Expected:
    1.2392337861152563
Got:
    1.239233786115256
**********************************************************************
File "src/sage/gsl/probability_distribution.pyx", line 461, in sage.gsl.probability_distribution.RealDistribution
Failed example:
    T.get_random_element()
Expected:
    0.7110581877139807
Got:
    0.7110581877139808
**********************************************************************
3 items had failures:
   3 of  75 in sage.gsl.probability_distribution.RealDistribution
   2 of   7 in sage.gsl.probability_distribution.SphericalDistribution
   1 of  11 in sage.gsl.probability_distribution.SphericalDistribution.__init__
    [207 tests, 6 failures, 2.03 s]
```



---

Comment by vbraun created at 2014-10-28 19:35:51

Changing status from positive_review to needs_work.


---

Comment by git created at 2014-11-04 23:49:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by novoselt created at 2014-11-04 23:50:11

Changed the output to the one you got, so that it is easy to test on 64-bit systems.


---

Comment by novoselt created at 2014-11-04 23:50:11

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2014-11-05 10:38:51

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-11-05 10:42:04

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2014-11-05 10:42:04

Merge conflict with #17278


---

Comment by git created at 2014-11-05 19:02:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by novoselt created at 2014-11-05 19:04:04

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2014-11-05 19:30:33

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-11-06 11:14:27

Resolution: fixed


---

Comment by novoselt created at 2014-11-06 20:04:05

Hooray, thanks for the quick reviews, Volker!
