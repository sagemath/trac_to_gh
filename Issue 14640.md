# Issue 14640: Implement cluster algebras with universal coefficients

archive/issues_014640.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  gmoose05\n\nKeywords: cluster algebras\n\nThis is a first implementation of cluster algebras with universal coefficients. \n\nIt is far from being optimal for several reasons. The biggest issues comes from an incompatibility between QuiverMutationType and CartanType: there is no clean way to translate one into the other. A more subtle issue is that CartanType does not allow to choose the ordering on simple roots while in a cluster algebra everything is defined up to relabeling. \nTo solve these issues, in this patch,  the set of positive roots is computed by hand. As a consequence the order in which they appear is not the standard one. \n\nFor the overall development of sage we might consider a cleanup and extension of CartanType, RootSystem etc to allow Cartan matrices as input.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14844\n\n",
    "created_at": "2013-07-01T12:23:10Z",
    "labels": [
        "component: combinatorics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Implement cluster algebras with universal coefficients",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14640",
    "user": "https://github.com/etn40ff"
}
```
Assignee: sage-combinat

CC:  gmoose05

Keywords: cluster algebras

This is a first implementation of cluster algebras with universal coefficients. 

It is far from being optimal for several reasons. The biggest issues comes from an incompatibility between QuiverMutationType and CartanType: there is no clean way to translate one into the other. A more subtle issue is that CartanType does not allow to choose the ordering on simple roots while in a cluster algebra everything is defined up to relabeling. 
To solve these issues, in this patch,  the set of positive roots is computed by hand. As a consequence the order in which they appear is not the standard one. 

For the overall development of sage we might consider a cleanup and extension of CartanType, RootSystem etc to allow Cartan matrices as input.

Issue created by migration from https://trac.sagemath.org/ticket/14844





---

archive/issue_comments_186094.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2013-07-04T09:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14640#issuecomment-186094",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_186095.json:
```json
{
    "body": "Some random thoughts:\n\n- if you want a review, set the ticket to needs review, and if you want to ping Gregg or whoever, add his trac name (or plain email address) into the cc box. This makes it easier and quicker to interact...\n\n- arxiv links should be inserted as :arxiv:`1202.1506`\n\n- shouldn't the AND's in\n  {{{\n  if self._m !=0 and not self.is_bipartite() and not self.is_finite(): \n      raise ValueError(\"Universal coefficients are defined only for finite type cluster algebras at a bipartite initial cluster\")\n  }}}\n  rather be OR's?\n\n- isn't there a way to pass around the positive roots issue? Basically by providing a method yourself (in `quiver_mutation_type.py`) which takes a finite quiver mutation type and turns it into a Cartan type. This would at least make it possible to remove the code duplicity for computing positive roots.\n\nCheers, Christian",
    "created_at": "2013-07-04T09:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14640#issuecomment-186095",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Some random thoughts:

- if you want a review, set the ticket to needs review, and if you want to ping Gregg or whoever, add his trac name (or plain email address) into the cc box. This makes it easier and quicker to interact...

- arxiv links should be inserted as :arxiv:`1202.1506`

- shouldn't the AND's in
  {{{
  if self._m !=0 and not self.is_bipartite() and not self.is_finite(): 
      raise ValueError("Universal coefficients are defined only for finite type cluster algebras at a bipartite initial cluster")
  }}}
  rather be OR's?

- isn't there a way to pass around the positive roots issue? Basically by providing a method yourself (in `quiver_mutation_type.py`) which takes a finite quiver mutation type and turns it into a Cartan type. This would at least make it possible to remove the code duplicity for computing positive roots.

Cheers, Christian



---

archive/issue_comments_186096.json:
```json
{
    "body": "Hi Christian,\n\nthank you for the advices on the use of trac: I am quite new to all of it. \nThank you also for catching the problem with the if statement: I uploaded an old version of the patch; sorry about that.\nAs for the last point here is my reasoning:\n\nI agree with you that this is not an optimal way of coding this function; the first idea I had was to add a method to translate  `QuiverMutationType` into `CartanType`. Unfortunately we need slightly more than what `CartanType` provides: it is important to able to choose an ordering of the simple roots (a labeling of the vertices of the quiver if you prefer) and this is not possible in the current implementation. We could translate `QuiverMutationType` into a pair `(CartanType, Permutation)` but I am not sure this would be any better. Slightly annoying is also the fact that  `CartanType` labels nodes from 1 while  `QuiverMutationType` from 0.\n\nI will shortly update a new version of the patch including your observations.\nS.",
    "created_at": "2013-07-04T09:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14640#issuecomment-186096",
    "user": "https://github.com/etn40ff"
}
```

Hi Christian,

thank you for the advices on the use of trac: I am quite new to all of it. 
Thank you also for catching the problem with the if statement: I uploaded an old version of the patch; sorry about that.
As for the last point here is my reasoning:

I agree with you that this is not an optimal way of coding this function; the first idea I had was to add a method to translate  `QuiverMutationType` into `CartanType`. Unfortunately we need slightly more than what `CartanType` provides: it is important to able to choose an ordering of the simple roots (a labeling of the vertices of the quiver if you prefer) and this is not possible in the current implementation. We could translate `QuiverMutationType` into a pair `(CartanType, Permutation)` but I am not sure this would be any better. Slightly annoying is also the fact that  `CartanType` labels nodes from 1 while  `QuiverMutationType` from 0.

I will shortly update a new version of the patch including your observations.
S.



---

archive/issue_comments_186097.json:
```json
{
    "body": "Attachment [trac_14844_universal_coefficients.patch](tarball://root/attachments/some-uuid/ticket14844/trac_14844_universal_coefficients.patch) by @nthiery created at 2013-07-07 21:25:56\n\nHi Salvatore,\n\nReplying to [comment:2 etn40ff]:\n> Unfortunately we need slightly more than what `CartanType` provides:\n> it is important to able to choose an ordering of the simple roots (a\n> labeling of the vertices of the quiver if you prefer) and this is\n> not possible in the current implementation.\n\n\nCan you be specific? Could CartanType([\"A\",4]).relabel(...) be useful?\n\n> Slightly annoying is also the fact that `CartanType` labels nodes\n> from 1 while `QuiverMutationType` from 0.\n\n\nJust to clarify: it turns out that the classical cartan types (A_4,\n...) label their nodes starting from 1 to match the usual\nconventions. But the code makes no assumption whatsoever about this;\nso you don't have to follow the same labeling for your own Cartan\ntypes.\n\nCheers,\n                Nicolas",
    "created_at": "2013-07-07T21:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14640#issuecomment-186097",
    "user": "https://github.com/nthiery"
}
```

Attachment [trac_14844_universal_coefficients.patch](tarball://root/attachments/some-uuid/ticket14844/trac_14844_universal_coefficients.patch) by @nthiery created at 2013-07-07 21:25:56

Hi Salvatore,

Replying to [comment:2 etn40ff]:
> Unfortunately we need slightly more than what `CartanType` provides:
> it is important to able to choose an ordering of the simple roots (a
> labeling of the vertices of the quiver if you prefer) and this is
> not possible in the current implementation.


Can you be specific? Could CartanType(["A",4]).relabel(...) be useful?

> Slightly annoying is also the fact that `CartanType` labels nodes
> from 1 while `QuiverMutationType` from 0.


Just to clarify: it turns out that the classical cartan types (A_4,
...) label their nodes starting from 1 to match the usual
conventions. But the code makes no assumption whatsoever about this;
so you don't have to follow the same labeling for your own Cartan
types.

Cheers,
                Nicolas



---

archive/issue_comments_186098.json:
```json
{
    "body": "Hi Nicolas,\n\n`CartanType([\"A\",4]).relabel(...)` could certanly be useful but it would still require some thin wrapper in `QuiverMutationType` in order to do the translation. Ideally I'd rather be able to produce a `CartanType` (of any type) directly form a `CartanMatrix`: my feeling is that such a feature might be what Vivien was looking for at days49\n\nBest\n\nS.",
    "created_at": "2013-07-08T11:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14640#issuecomment-186098",
    "user": "https://github.com/etn40ff"
}
```

Hi Nicolas,

`CartanType(["A",4]).relabel(...)` could certanly be useful but it would still require some thin wrapper in `QuiverMutationType` in order to do the translation. Ideally I'd rather be able to produce a `CartanType` (of any type) directly form a `CartanMatrix`: my feeling is that such a feature might be what Vivien was looking for at days49

Best

S.



---

archive/issue_events_042634.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14640",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14640#event-42634"
}
```



---

archive/issue_comments_186099.json:
```json
{
    "body": "Here is a git branch, made from the patch.\n\n---\nNew commits:",
    "created_at": "2014-03-05T12:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14640#issuecomment-186099",
    "user": "https://github.com/fchapoton"
}
```

Here is a git branch, made from the patch.

---
New commits:



---

archive/issue_comments_186100.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2014-03-05T19:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14640#issuecomment-186100",
    "user": "https://github.com/etn40ff"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_186101.json:
```json
{
    "body": "Hello,\n\nhere is a tentative, that could work. I have tried to use the CartanMatrix setting to produce the almost positive roots.\n\n\nCould you please tell me if it does what it should ?\n\n---\nNew commits:",
    "created_at": "2014-03-07T20:47:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14640#issuecomment-186101",
    "user": "https://github.com/fchapoton"
}
```

Hello,

here is a tentative, that could work. I have tried to use the CartanMatrix setting to produce the almost positive roots.


Could you please tell me if it does what it should ?

---
New commits:



---

archive/issue_comments_186102.json:
```json
{
    "body": "Hi,\nyour code looks good to me. The only issue I could see is that it was taking the\ntranspose of the matrix A before computing coroots hence constructing roots.\n(This is probably a leftover of my previous implementation.) I am not sure why I\ndid not use CartanMatrix back when I coded this first; was it already in sage?\nS.",
    "created_at": "2014-03-10T02:45:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14640#issuecomment-186102",
    "user": "https://github.com/etn40ff"
}
```

Hi,
your code looks good to me. The only issue I could see is that it was taking the
transpose of the matrix A before computing coroots hence constructing roots.
(This is probably a leftover of my previous implementation.) I am not sure why I
did not use CartanMatrix back when I coded this first; was it already in sage?
S.



---

archive/issue_comments_186103.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-10T02:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14640#issuecomment-186103",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_186104.json:
```json
{
    "body": "There is even an existing method 'almost_positive_roots' in `sage/combinat/root_system/root_lattice_realizations.py`, maybe one should use that.",
    "created_at": "2014-03-11T15:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14640#issuecomment-186104",
    "user": "https://github.com/fchapoton"
}
```

There is even an existing method 'almost_positive_roots' in `sage/combinat/root_system/root_lattice_realizations.py`, maybe one should use that.



---

archive/issue_comments_186105.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-11T16:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14640#issuecomment-186105",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_186106.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-03-11T21:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14640#issuecomment-186106",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_186107.json:
```json
{
    "body": "ok, good enough for me. positive review",
    "created_at": "2014-03-11T21:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14640#issuecomment-186107",
    "user": "https://github.com/fchapoton"
}
```

ok, good enough for me. positive review



---

archive/issue_events_042635.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-03-14T14:47:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14640",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14640#event-42635"
}
```



---

archive/issue_comments_186108.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-03-14T14:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14640",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14640#issuecomment-186108",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
