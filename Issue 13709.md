# Issue 13709: Provide a "stripped" gcc 4.7.2 spkg

Issue created by migration from https://trac.sagemath.org/ticket/13913

Original creator: jpflori

Original creation time: 2013-01-05 14:58:26

Assignee: tbd

CC:  jdemeyer

Keywords: spkg gcc

GCC does not provide separates tarball for each languages for the 4.7.x releases, so we have to cook our own if we do not want to include ADA, GO, JAVA, OBJC...


---

Comment by jpflori created at 2013-01-07 15:29:45

Not sure we should really get rid of the testsuites dir, but gcc, g++ and gfortran (seem to) build without it.


---

Comment by jpflori created at 2013-01-07 15:29:45

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2013-01-07 15:33:36

Wow, we both had almost exactly the same idea.


---

Comment by jdemeyer created at 2013-01-07 15:35:44

My spkg: [http://boxen.math.washington.edu/home/jdemeyer/spkg/gcc-4.7.2.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/gcc-4.7.2.p0.spkg) (also removed Link Time Optimization and Native Language Support).

My `spkg-src` script (don't call it `spkg-dist` as that is really meant for scripts which create a spkg):

```/bin/sh
# Remove some unneeded pieces from GCC, after downloading and
# extracting the sources and renaming the directory to src/.

cd src || exit $?

rm MD5SUMS
rm -r maintainer-scripts

# Remove zlib, since Sage already ships with zlib
# and we build GCC with --with-system-zlib.
rm -r zlib

# Remove Native Language Support
rm -r gcc/po libcpp/po

# Remove support for Link Time Optimization
rm -r lto-plugin

# Remove all files for languages other than C, C++, Fortran.
rm -r libada gnattools libgo libffi libjava boehm-gc libobjc
cd gcc
rm -r ada go java objc objcp testsuite
```



---

Comment by jdemeyer created at 2013-01-07 15:38:20

Not sure whether we should remove [libitm](http://gcc.gnu.org/wiki/TransactionalMemory) (although currently nothing in Sage uses this feature).


---

Comment by jdemeyer created at 2013-01-08 09:23:53

Let's be conservative and keep LTO and ITM.  I really see no need for Native Language Support, so I'd remove that.


---

Comment by jdemeyer created at 2013-01-08 09:37:25

Spkg diff, for review only.


---

Attachment

Jean-Pierre, could you review my package please?


---

Comment by jpflori created at 2013-01-08 09:52:55

Replying to [comment:5 jdemeyer]:
> Let's be conservative and keep LTO and ITM.  I really see no need for Native Language Support, so I'd remove that.
Just a random thought about NLS, shouldn't we try to remove it from as many spkg as possible?
Or is it actually used or necessary somewhere?


---

Comment by jdemeyer created at 2013-01-08 10:37:13

Replying to [comment:8 jpflori]:
> Just a random thought about NLS, shouldn't we try to remove it from as many spkg as possible?
It could be done I guess.  Except of course for user-facing packages, i.e. packages where the user is likely to see the output of.  I know there are some efforts to internationalize the Sage Notebook for example.


---

Comment by jpflori created at 2013-01-08 10:43:03

Little remark: do we need the intl directory?
I guess this is NLS related and in the end is not used because of the --disable-nls flag.
I've just built without it and everything seems fine.
(Without it the --disable-nls flag should not be that useful but let's keep it in anyway.)


---

Comment by jdemeyer created at 2013-01-08 10:52:33

Replying to [comment:10 jpflori]:
> Little remark: do we need the intl directory?
I'm not entirely sure that it's not needed.  It contains gettext library, needed for internationalization.  I don't know whether `--disable-nls` truly disables the use of gettext.  The fact that it works on your system might be because your system already has gettext.  To be on the safe side, I would keep `intl`, it's only 100K compressed anyway.


---

Comment by jpflori created at 2013-01-08 10:54:53

Changing status from needs_review to positive_review.


---

Comment by jpflori created at 2013-01-08 10:54:53

Replying to [comment:11 jdemeyer]:
> Replying to [comment:10 jpflori]:
> > Little remark: do we need the intl directory?
> I'm not entirely sure that it's not needed.  It contains gettext library, needed for internationalization.  I don't know whether `--disable-nls` truly disables the use of gettext.  The fact that it works on your system might be because your system already has gettext.  To be on the safe side, I would keep `intl`, it's only 100K compressed anyway.
Agreed.


---

Comment by jpflori created at 2013-01-08 11:05:13

(But if you wanna test it, I feel it should work without intl as well, not even using system stuff if you don't push configure to do it from what I quickly saw in configure's, makefiles and m4 macros.)


---

Comment by jdemeyer created at 2013-01-09 08:59:09

Resolution: fixed


---

Comment by schilly created at 2013-01-09 14:35:34

optional spkg is updated!


---

Comment by jpflori created at 2013-02-12 21:50:14

Cannot locate the spkg on sage website or on mirrors.
