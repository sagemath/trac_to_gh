# Issue 23868: Deprecate Sage-specific Cython pragmas like #clib

archive/issues_023868.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/24105\n\n",
    "created_at": "2017-10-25T14:47:29Z",
    "labels": [
        "component: misc"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Deprecate Sage-specific Cython pragmas like #clib",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23868",
    "user": "https://github.com/jdemeyer"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/24105





---

archive/issue_comments_334192.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-10-25T16:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23868#issuecomment-334192",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_334193.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-25T16:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23868#issuecomment-334193",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_334194.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-25T22:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23868#issuecomment-334194",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_334195.json:
```json
{
    "body": "Makes sense and LGTM.",
    "created_at": "2017-10-25T22:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23868#issuecomment-334195",
    "user": "https://github.com/tscrim"
}
```

Makes sense and LGTM.



---

archive/issue_comments_334196.json:
```json
{
    "body": "Well my compiler doesn't like it in sage-on-gentoo\n\n```\nsage -t --long --warn-long 73.3 /usr/lib64/python2.7/site-packages/sage/libs/pynac/pynac.pxd\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/libs/pynac/pynac.pxd\", line 10, in sage.libs.pynac.pynac\nFailed example:\n    cython(  # long time; random compiler warnings\n    '''\n    # distutils: language = c++\n    # distutils: libraries = pynac\n    # distutils: extra_compile_args = --std=c++11\n    cimport sage.libs.pynac.pynac\n    ''')\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 518, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib64/python2.7/site-packages/sage/doctest/forker.py\", line 888, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.libs.pynac.pynac[0]>\", line 7, in <module>\n        ''')\n      File \"sage/misc/lazy_import.pyx\", line 354, in sage.misc.lazy_import.LazyImport.__call__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/misc/lazy_import.c:3638)\n        return self.get_object()(*args, **kwds)\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/cython.py\", line 906, in cython_compile\n        create_local_c_file=False)\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/cython.py\", line 816, in cython_import_all\n        create_local_c_file=create_local_c_file)\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/cython.py\", line 793, in cython_import\n        **kwds)\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/cython.py\", line 590, in cython\n        dist.run_command(\"build\")\n      File \"/usr/lib64/python2.7/distutils/dist.py\", line 972, in run_command\n        cmd_obj.run()\n      File \"/usr/lib64/python2.7/distutils/command/build.py\", line 127, in run\n        self.run_command(cmd_name)\n      File \"/usr/lib64/python2.7/distutils/cmd.py\", line 326, in run_command\n        self.distribution.run_command(command)\n      File \"/usr/lib64/python2.7/distutils/dist.py\", line 972, in run_command\n        cmd_obj.run()\n      File \"/usr/lib64/python2.7/distutils/command/build_ext.py\", line 340, in run\n        self.build_extensions()\n      File \"/usr/lib64/python2.7/distutils/command/build_ext.py\", line 449, in build_extensions\n        self.build_extension(ext)\n      File \"/usr/lib64/python2.7/distutils/command/build_ext.py\", line 531, in build_extension\n        target_lang=language)\n      File \"/usr/lib64/python2.7/distutils/ccompiler.py\", line 691, in link_shared_object\n        extra_preargs, extra_postargs, build_temp, target_lang)\n      File \"/usr/lib64/python2.7/distutils/unixccompiler.py\", line 205, in link\n        raise LinkError, msg\n    LinkError: command 'x86_64-pc-linux-gnu-g++' failed with exit status 1\n**********************************************************************\n```\n\nI am on gcc-6.4.0.",
    "created_at": "2017-10-31T03:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23868#issuecomment-334196",
    "user": "https://github.com/kiwifb"
}
```

Well my compiler doesn't like it in sage-on-gentoo

```
sage -t --long --warn-long 73.3 /usr/lib64/python2.7/site-packages/sage/libs/pynac/pynac.pxd
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/libs/pynac/pynac.pxd", line 10, in sage.libs.pynac.pynac
Failed example:
    cython(  # long time; random compiler warnings
    '''
    # distutils: language = c++
    # distutils: libraries = pynac
    # distutils: extra_compile_args = --std=c++11
    cimport sage.libs.pynac.pynac
    ''')
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 518, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib64/python2.7/site-packages/sage/doctest/forker.py", line 888, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.pynac.pynac[0]>", line 7, in <module>
        ''')
      File "sage/misc/lazy_import.pyx", line 354, in sage.misc.lazy_import.LazyImport.__call__ (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/misc/lazy_import.c:3638)
        return self.get_object()(*args, **kwds)
      File "/usr/lib64/python2.7/site-packages/sage/misc/cython.py", line 906, in cython_compile
        create_local_c_file=False)
      File "/usr/lib64/python2.7/site-packages/sage/misc/cython.py", line 816, in cython_import_all
        create_local_c_file=create_local_c_file)
      File "/usr/lib64/python2.7/site-packages/sage/misc/cython.py", line 793, in cython_import
        **kwds)
      File "/usr/lib64/python2.7/site-packages/sage/misc/cython.py", line 590, in cython
        dist.run_command("build")
      File "/usr/lib64/python2.7/distutils/dist.py", line 972, in run_command
        cmd_obj.run()
      File "/usr/lib64/python2.7/distutils/command/build.py", line 127, in run
        self.run_command(cmd_name)
      File "/usr/lib64/python2.7/distutils/cmd.py", line 326, in run_command
        self.distribution.run_command(command)
      File "/usr/lib64/python2.7/distutils/dist.py", line 972, in run_command
        cmd_obj.run()
      File "/usr/lib64/python2.7/distutils/command/build_ext.py", line 340, in run
        self.build_extensions()
      File "/usr/lib64/python2.7/distutils/command/build_ext.py", line 449, in build_extensions
        self.build_extension(ext)
      File "/usr/lib64/python2.7/distutils/command/build_ext.py", line 531, in build_extension
        target_lang=language)
      File "/usr/lib64/python2.7/distutils/ccompiler.py", line 691, in link_shared_object
        extra_preargs, extra_postargs, build_temp, target_lang)
      File "/usr/lib64/python2.7/distutils/unixccompiler.py", line 205, in link
        raise LinkError, msg
    LinkError: command 'x86_64-pc-linux-gnu-g++' failed with exit status 1
**********************************************************************
```

I am on gcc-6.4.0.



---

archive/issue_comments_334197.json:
```json
{
    "body": "Can you run the test manually outside of the doctester? You should see a better error message, which is not shown here because the doctester omits normal output if an exception was raised.",
    "created_at": "2017-10-31T08:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23868#issuecomment-334197",
    "user": "https://github.com/jdemeyer"
}
```

Can you run the test manually outside of the doctester? You should see a better error message, which is not shown here because the doctester omits normal output if an exception was raised.



---

archive/issue_comments_334198.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n> Can you run the test manually outside of the doctester? You should see a better error message, which is not shown here because the doctester omits normal output if an exception was raised.\n\nThanks for that clue! That's caused by my multi-python pynac hack in sage-on-gentoo. The previous doctest was adjusted with a `sed` command and needs adjusting.\n\nGlad I didn't put this back to \"need_work\".",
    "created_at": "2017-10-31T08:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23868#issuecomment-334198",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:7 jdemeyer]:
> Can you run the test manually outside of the doctester? You should see a better error message, which is not shown here because the doctester omits normal output if an exception was raised.

Thanks for that clue! That's caused by my multi-python pynac hack in sage-on-gentoo. The previous doctest was adjusted with a `sed` command and needs adjusting.

Glad I didn't put this back to "need_work".



---

archive/issue_comments_334199.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-11-01T18:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23868#issuecomment-334199",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_061188.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-11-01T18:07:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23868",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23868#event-61188"
}
```
