# Issue 11867: Doctest sage.categories.action

archive/issues_011867.json:
```json
{
    "body": "Assignee: mvngu\n\nCurrently there are no doctests in this file.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12039\n\n",
    "created_at": "2011-11-15T08:50:06Z",
    "labels": [
        "doctest coverage",
        "major",
        "bug"
    ],
    "title": "Doctest sage.categories.action",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11867",
    "user": "roed"
}
```
Assignee: mvngu

Currently there are no doctests in this file.

Issue created by migration from https://trac.sagemath.org/ticket/12039





---

archive/issue_comments_135823.json:
```json
{
    "body": "Attachment [12039_doctests.patch](tarball://root/attachments/some-uuid/ticket12039/12039_doctests.patch) by roed created at 2011-11-17 14:17:47\n\nDoctests and changes sage.categories.action",
    "created_at": "2011-11-17T14:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135823",
    "user": "roed"
}
```

Attachment [12039_doctests.patch](tarball://root/attachments/some-uuid/ticket12039/12039_doctests.patch) by roed created at 2011-11-17 14:17:47

Doctests and changes sage.categories.action



---

archive/issue_comments_135824.json:
```json
{
    "body": "Some changes outside sage.categories.action and sage.categories.action_example",
    "created_at": "2011-11-17T14:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135824",
    "user": "roed"
}
```

Some changes outside sage.categories.action and sage.categories.action_example



---

archive/issue_comments_135825.json:
```json
{
    "body": "Attachment [12039_outside.patch](tarball://root/attachments/some-uuid/ticket12039/12039_outside.patch) by roed created at 2011-11-17 14:18:55",
    "created_at": "2011-11-17T14:18:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135825",
    "user": "roed"
}
```

Attachment [12039_outside.patch](tarball://root/attachments/some-uuid/ticket12039/12039_outside.patch) by roed created at 2011-11-17 14:18:55



---

archive/issue_comments_135826.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-11-17T14:18:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135826",
    "user": "roed"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_135827.json:
```json
{
    "body": "I was googling for `LazyFormat` when I stumbled here.\n\nOne remark: There is no need to use `LazyFormat` if the result is a plain string. Just use the string itself. The purpose of `LazyFormat` is the following: when you have \n\n```\nlz=LazyFormat(\"... %s ...\")%(obj)\n```\n \nit defers the computation of `__repr__(obj)` until one call `__repr__(lz)`. So that, \n\n```\nLazyFormat(\"Message\")%(())\n```\n \nis really some kind of overkill.",
    "created_at": "2011-11-22T23:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135827",
    "user": "hivert"
}
```

I was googling for `LazyFormat` when I stumbled here.

One remark: There is no need to use `LazyFormat` if the result is a plain string. Just use the string itself. The purpose of `LazyFormat` is the following: when you have 

```
lz=LazyFormat("... %s ...")%(obj)
```
 
it defers the computation of `__repr__(obj)` until one call `__repr__(lz)`. So that, 

```
LazyFormat("Message")%(())
```
 
is really some kind of overkill.



---

archive/issue_comments_135828.json:
```json
{
    "body": "A followup for my last remark. The idea of `LazyFormat` is to be able to\nprint counter examples in the error message for `TestSuite` when a property is\nwrong, without drastically slowing down the tests. I would therefore suggest\nto replace\n\n```python\ntester.assertTrue(self(a, self(b, v)) == self(a*b, v), \n                  LazyFormat(\"Multiplication is not associative\")%(())) \n```\n  \nby\n\n```python\ntester.assertTrue(self(a, self(b, v)) == self(a*b, v), \n    LazyFormat(\"Multiplication is not associative: %s*(%s*%s) != (%s*%s)*%s\")%(a,b,v,a,b,v))\n```\n\nAnd similarly for the other one.\n\nAlso in the category directory, the usage is to place the example in the\nsubdirectory examples. An action isn't really a category, but I think it would\nbe good to have all the examples there. Moreover, don't forget to add your\nvery nice example in the reference manual (file: `doc/en/reference/categories.rst`).\n\nBy the way: thanks a lot for writing all this nice documentation.\n\nFlorent",
    "created_at": "2011-11-22T23:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135828",
    "user": "hivert"
}
```

A followup for my last remark. The idea of `LazyFormat` is to be able to
print counter examples in the error message for `TestSuite` when a property is
wrong, without drastically slowing down the tests. I would therefore suggest
to replace

```python
tester.assertTrue(self(a, self(b, v)) == self(a*b, v), 
                  LazyFormat("Multiplication is not associative")%(())) 
```
  
by

```python
tester.assertTrue(self(a, self(b, v)) == self(a*b, v), 
    LazyFormat("Multiplication is not associative: %s*(%s*%s) != (%s*%s)*%s")%(a,b,v,a,b,v))
```

And similarly for the other one.

Also in the category directory, the usage is to place the example in the
subdirectory examples. An action isn't really a category, but I think it would
be good to have all the examples there. Moreover, don't forget to add your
very nice example in the reference manual (file: `doc/en/reference/categories.rst`).

By the way: thanks a lot for writing all this nice documentation.

Florent



---

archive/issue_comments_135829.json:
```json
{
    "body": "More remarks:\n\n- There is an empty `Example::` section for `_extend_G(self, K):`.\n\n- you should put hyperlinks ref for `:class:`sage.matrix.action.MatrixMatrixAction``  line 14 in `sage/categories/action.pyx`, as well as in\n {{{\n 17\tSee sage.structure.coerce_actions and sage.matrix.action for examples of Actions  \n 18\tused in the coercion system, and sage.structure.coerce and sage.structure.parent \n 19\tfor the code that uses them. \n }}}\n Note: I didn't look exhaustively for missing hyperlinks.\n\nSorry for asking all these modifications. More review tomorrow morning, I'm off to bed.\n\nFlorent",
    "created_at": "2011-11-22T23:47:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135829",
    "user": "hivert"
}
```

More remarks:

- There is an empty `Example::` section for `_extend_G(self, K):`.

- you should put hyperlinks ref for `:class:`sage.matrix.action.MatrixMatrixAction``  line 14 in `sage/categories/action.pyx`, as well as in
 {{{
 17	See sage.structure.coerce_actions and sage.matrix.action for examples of Actions  
 18	used in the coercion system, and sage.structure.coerce and sage.structure.parent 
 19	for the code that uses them. 
 }}}
 Note: I didn't look exhaustively for missing hyperlinks.

Sorry for asking all these modifications. More review tomorrow morning, I'm off to bed.

Florent



---

archive/issue_comments_135830.json:
```json
{
    "body": "Attachment [12039_example.patch](tarball://root/attachments/some-uuid/ticket12039/12039_example.patch) by roed created at 2011-11-23 20:44:33\n\nAn extended example of an Action",
    "created_at": "2011-11-23T20:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135830",
    "user": "roed"
}
```

Attachment [12039_example.patch](tarball://root/attachments/some-uuid/ticket12039/12039_example.patch) by roed created at 2011-11-23 20:44:33

An extended example of an Action



---

archive/issue_comments_135831.json:
```json
{
    "body": "Incorporate referee's suggestions so far",
    "created_at": "2011-11-23T20:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135831",
    "user": "roed"
}
```

Incorporate referee's suggestions so far



---

archive/issue_comments_135832.json:
```json
{
    "body": "Attachment [12039_changes.patch](tarball://root/attachments/some-uuid/ticket12039/12039_changes.patch) by roed created at 2011-11-23 20:45:52\n\nI don't mind making changes: I'm glad you're refereeing it.",
    "created_at": "2011-11-23T20:45:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135832",
    "user": "roed"
}
```

Attachment [12039_changes.patch](tarball://root/attachments/some-uuid/ticket12039/12039_changes.patch) by roed created at 2011-11-23 20:45:52

I don't mind making changes: I'm glad you're refereeing it.



---

archive/issue_comments_135833.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-11T11:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135833",
    "user": "davidloeffler"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_135834.json:
```json
{
    "body": "Doesn't apply to latest beta -- it gets as far as patch 12039_changes.patch and then that fails to apply.",
    "created_at": "2012-03-11T11:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135834",
    "user": "davidloeffler"
}
```

Doesn't apply to latest beta -- it gets as far as patch 12039_changes.patch and then that fails to apply.



---

archive/issue_comments_135835.json:
```json
{
    "body": "Aargh, patchbot is interpreting my last comment as an instruction to only apply the last patch...\n\n\nApply 12039_doctests.patch, 12039_outside.patch, 12039_example.patch, 12039_changes.patch",
    "created_at": "2012-03-12T19:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135835",
    "user": "davidloeffler"
}
```

Aargh, patchbot is interpreting my last comment as an instruction to only apply the last patch...


Apply 12039_doctests.patch, 12039_outside.patch, 12039_example.patch, 12039_changes.patch



---

archive/issue_comments_135836.json:
```json
{
    "body": "Attachment [12039_changes_v2.patch](tarball://root/attachments/some-uuid/ticket12039/12039_changes_v2.patch) by davidloeffler created at 2012-03-14 14:53:57\n\nApply this instead of 12039-changes.patch",
    "created_at": "2012-03-14T14:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135836",
    "user": "davidloeffler"
}
```

Attachment [12039_changes_v2.patch](tarball://root/attachments/some-uuid/ticket12039/12039_changes_v2.patch) by davidloeffler created at 2012-03-14 14:53:57

Apply this instead of 12039-changes.patch



---

archive/issue_comments_135837.json:
```json
{
    "body": "The patch I've just uploaded is based on a rebase of 12039_changes.patch, but it also incorporates some reviewer changes: I've corrected the Sphinx formatting in a few places so it builds without errors, added some trivial missing doctests to get coverage up to 100%, and added a few hyperlinks and so on.\n\nApply 12039_doctests.patch, 12039_outside.patch, 12039_example.patch, 12039_changes_v2.patch",
    "created_at": "2012-03-14T14:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135837",
    "user": "davidloeffler"
}
```

The patch I've just uploaded is based on a rebase of 12039_changes.patch, but it also incorporates some reviewer changes: I've corrected the Sphinx formatting in a few places so it builds without errors, added some trivial missing doctests to get coverage up to 100%, and added a few hyperlinks and so on.

Apply 12039_doctests.patch, 12039_outside.patch, 12039_example.patch, 12039_changes_v2.patch



---

archive/issue_comments_135838.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-14T14:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135838",
    "user": "davidloeffler"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_135839.json:
```json
{
    "body": "Thanks for fixing all the action_example -> examples.actions.  Your changes all look good to me.  Feel free to give it a positive review if you're happy with it.",
    "created_at": "2012-03-16T21:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135839",
    "user": "roed"
}
```

Thanks for fixing all the action_example -> examples.actions.  Your changes all look good to me.  Feel free to give it a positive review if you're happy with it.



---

archive/issue_comments_135840.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-17T10:39:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135840",
    "user": "davidloeffler"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_135841.json:
```json
{
    "body": "I'll put this to positive review pending #12048. But is there any chance that you could modify this so it works without #12048? (I think without #12048 the patches apply correctly, but doctests don't pass.)",
    "created_at": "2012-03-17T10:39:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135841",
    "user": "davidloeffler"
}
```

I'll put this to positive review pending #12048. But is there any chance that you could modify this so it works without #12048? (I think without #12048 the patches apply correctly, but doctests don't pass.)



---

archive/issue_comments_135842.json:
```json
{
    "body": "In Sage 5.1.beta0 I get a bunch of errors applying (yes, I did apply #12048)?  Can you confirm this?  Also, it would be really nice to have this not depend on a 'needs work' patch.",
    "created_at": "2012-05-24T21:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135842",
    "user": "kcrisman"
}
```

In Sage 5.1.beta0 I get a bunch of errors applying (yes, I did apply #12048)?  Can you confirm this?  Also, it would be really nice to have this not depend on a 'needs work' patch.



---

archive/issue_comments_135843.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd40.5\".",
    "created_at": "2012-05-25T00:17:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135843",
    "user": "kcrisman"
}
```

Changing keywords from "" to "sd40.5".



---

archive/issue_comments_135844.json:
```json
{
    "body": "Needs work, as discussed in person here - 5.0 is okay, 5.1.beta0 is not.\n\n```\napplying 12039_doctests.patch\npatching file sage/categories/action.pxd\nHunk #1 FAILED at 0\n1 out of 2 hunks FAILED -- saving rejects to file sage/categories/action.pxd.rej\npatching file sage/categories/action.pyx\nHunk #1 FAILED at 6\nHunk #2 FAILED at 25\nHunk #3 FAILED at 41\nHunk #4 succeeded at 107 with fuzz 1 (offset 35 lines).\nHunk #5 FAILED at 119\nHunk #6 FAILED at 174\nHunk #10 FAILED at 391\n6 out of 11 hunks FAILED -- saving rejects to file sage/categories/action.pyx.rej\npatch failed, unable to continue (try -v)\npatch failed, rejects left in working dir\nerrors during apply, please fix and refresh 12039_doctests.patch\n```\n",
    "created_at": "2012-05-25T00:17:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135844",
    "user": "kcrisman"
}
```

Needs work, as discussed in person here - 5.0 is okay, 5.1.beta0 is not.

```
applying 12039_doctests.patch
patching file sage/categories/action.pxd
Hunk #1 FAILED at 0
1 out of 2 hunks FAILED -- saving rejects to file sage/categories/action.pxd.rej
patching file sage/categories/action.pyx
Hunk #1 FAILED at 6
Hunk #2 FAILED at 25
Hunk #3 FAILED at 41
Hunk #4 succeeded at 107 with fuzz 1 (offset 35 lines).
Hunk #5 FAILED at 119
Hunk #6 FAILED at 174
Hunk #10 FAILED at 391
6 out of 11 hunks FAILED -- saving rejects to file sage/categories/action.pyx.rej
patch failed, unable to continue (try -v)
patch failed, rejects left in working dir
errors during apply, please fix and refresh 12039_doctests.patch
```




---

archive/issue_comments_135845.json:
```json
{
    "body": "I guess the problem is that #715 was merged in 5.1.beta0\nThis ticket also brings notable changes to the Action class and adds a bunch of doc to the file, so rebasing this ticket might be non trivial (from what I've seen of the patches, the changes are even more intrusive than what was done in #715).",
    "created_at": "2012-06-11T09:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135845",
    "user": "jpflori"
}
```

I guess the problem is that #715 was merged in 5.1.beta0
This ticket also brings notable changes to the Action class and adds a bunch of doc to the file, so rebasing this ticket might be non trivial (from what I've seen of the patches, the changes are even more intrusive than what was done in #715).



---

archive/issue_comments_135846.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-12-13T02:42:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11867",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11867#issuecomment-135846",
    "user": "kcrisman"
}
```

Changing status from positive_review to needs_work.
