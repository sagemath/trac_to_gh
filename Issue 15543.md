# Issue 15543: Increase Performance in Projective Morphism

archive/issues_015543.json:
```json
{
    "body": "CC:  @bhutz\n\nKeywords: Projective, Morphism\n\nIncrease Performance in Projective Morphism by replacing all evaluation of polynomials with fast_callable from sage.ext.fast_callable\n\nIssue created by migration from https://trac.sagemath.org/ticket/15780\n\n",
    "created_at": "2014-02-03T14:59:50Z",
    "labels": [
        "component: performance"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Increase Performance in Projective Morphism",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15543",
    "user": "https://github.com/dillonmrose"
}
```
CC:  @bhutz

Keywords: Projective, Morphism

Increase Performance in Projective Morphism by replacing all evaluation of polynomials with fast_callable from sage.ext.fast_callable

Issue created by migration from https://trac.sagemath.org/ticket/15780





---

archive/issue_comments_200524.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2014-02-05T17:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200524",
    "user": "https://github.com/dillonmrose"
}
```

Changing priority from major to minor.



---

archive/issue_comments_200525.json:
```json
{
    "body": "Changing component from performance to algebraic geometry.",
    "created_at": "2014-02-05T17:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200525",
    "user": "https://github.com/dillonmrose"
}
```

Changing component from performance to algebraic geometry.



---

archive/issue_comments_200526.json:
```json
{
    "body": "Set assignee to @dillonmrose.",
    "created_at": "2014-02-05T17:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200526",
    "user": "https://github.com/dillonmrose"
}
```

Set assignee to @dillonmrose.



---

archive/issue_comments_200527.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-05T17:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200527",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_200528.json:
```json
{
    "body": "I haven't looked closely at functionality yet, but there are a few things that need to be fixed first.\n\n1) There are several doctests that fail with this:\n\n\n```\nsage -t --long sage/schemes/elliptic_curves/lseries_ell.py  # 1 doctest failed\nsage -t --long sage/schemes/plane_conics/con_field.py  # 3 doctests failed\nsage -t --long sage/schemes/generic/morphism.py  # 3 doctests failed\n```\n\n\nIt looks like most of these are because the `__call__` in generic\\morphism first coerces the input point into the domain and the `__call__` in projective\\morphism does not. Although the elliptic curve failure seems to be a precision issue.\n\n2) The new functions must have appropriate documentation. See the developers guide for the appropriate format.\n\nSCORE projective_morphism.py: 91.9% (34 of 37)\n\nMissing documentation:\n* line 182: def __call__(self, x, check=True)\n* line 187: def _fast_eval(self, x, check=True)\n* line 2625: def _fast_eval(self, x, check=True)\n\n3) There are a number of Tab characters in projective_morphism.py\n\n`sage -t --long sage/schemes/projective/projective_morphism.py  # Tab character found`",
    "created_at": "2014-02-09T23:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200528",
    "user": "https://github.com/bhutz"
}
```

I haven't looked closely at functionality yet, but there are a few things that need to be fixed first.

1) There are several doctests that fail with this:


```
sage -t --long sage/schemes/elliptic_curves/lseries_ell.py  # 1 doctest failed
sage -t --long sage/schemes/plane_conics/con_field.py  # 3 doctests failed
sage -t --long sage/schemes/generic/morphism.py  # 3 doctests failed
```


It looks like most of these are because the `__call__` in generic\morphism first coerces the input point into the domain and the `__call__` in projective\morphism does not. Although the elliptic curve failure seems to be a precision issue.

2) The new functions must have appropriate documentation. See the developers guide for the appropriate format.

SCORE projective_morphism.py: 91.9% (34 of 37)

Missing documentation:
* line 182: def __call__(self, x, check=True)
* line 187: def _fast_eval(self, x, check=True)
* line 2625: def _fast_eval(self, x, check=True)

3) There are a number of Tab characters in projective_morphism.py

`sage -t --long sage/schemes/projective/projective_morphism.py  # Tab character found`



---

archive/issue_comments_200529.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-02-09T23:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200529",
    "user": "https://github.com/bhutz"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_200530.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-02-09T23:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200530",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_200531.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-10T15:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200531",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_200532.json:
```json
{
    "body": "Testing functionality. Everywhere where the evaluation works it gives the right answer. However, there are several places where you can no longer do the evaluation which give a variety of errors. These all previously worked.\n\n\n```\nT.<z>=PowerSeriesRing(ZZ)\nP.<x,y>=ProjectiveSpace(T,1)\nH=End(P)\nf=H([x^2+x*y,y^2])\nQ=P(z,1)\nf(Q)\n```\n\n\n\n```\nT.<z>=LaurentSeriesRing(ZZ)\nP.<x,y>=ProjectiveSpace(T,1)\nH=End(P)\nf=H([x^2+x*y,y^2])\nQ=P(z,1)\nf(Q)\n```\n\n\n\n```\nT.<z>=PolynomialRing(Qp(7))\nI=T.ideal(z^3)\nP.<x,y>=ProjectiveSpace(T.quotient_ring(I),1)\nH=End(P)\nf=H([x^2+x*y,y^2])\nQ=P(z^2,1)\nf(Q)\n```\n\n\n\n```\nT.<z>=PolynomialRing(CC)\nI=T.ideal(z^3)\nP.<x,y>=ProjectiveSpace(T.quotient_ring(I),1)\nH=End(P)\nf=H([x^2+x*y,y^2])\nQ=P(z^2,1)\nf(Q)\n```\n\n\n\n```\nT.<z>=LaurentSeriesRing(CC)\nR.<t>=PolynomialRing(T)\nP.<x,y>=ProjectiveSpace(R,1)\nH=End(P)\nf=H([x^2+x*y,y^2])\nF=f.dehomogenize(1)\nQ=P(t^2,z)\nf(Q)\n```\n",
    "created_at": "2014-02-10T17:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200532",
    "user": "https://github.com/bhutz"
}
```

Testing functionality. Everywhere where the evaluation works it gives the right answer. However, there are several places where you can no longer do the evaluation which give a variety of errors. These all previously worked.


```
T.<z>=PowerSeriesRing(ZZ)
P.<x,y>=ProjectiveSpace(T,1)
H=End(P)
f=H([x^2+x*y,y^2])
Q=P(z,1)
f(Q)
```



```
T.<z>=LaurentSeriesRing(ZZ)
P.<x,y>=ProjectiveSpace(T,1)
H=End(P)
f=H([x^2+x*y,y^2])
Q=P(z,1)
f(Q)
```



```
T.<z>=PolynomialRing(Qp(7))
I=T.ideal(z^3)
P.<x,y>=ProjectiveSpace(T.quotient_ring(I),1)
H=End(P)
f=H([x^2+x*y,y^2])
Q=P(z^2,1)
f(Q)
```



```
T.<z>=PolynomialRing(CC)
I=T.ideal(z^3)
P.<x,y>=ProjectiveSpace(T.quotient_ring(I),1)
H=End(P)
f=H([x^2+x*y,y^2])
Q=P(z^2,1)
f(Q)
```



```
T.<z>=LaurentSeriesRing(CC)
R.<t>=PolynomialRing(T)
P.<x,y>=ProjectiveSpace(R,1)
H=End(P)
f=H([x^2+x*y,y^2])
F=f.dehomogenize(1)
Q=P(t^2,z)
f(Q)
```




---

archive/issue_comments_200533.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-11T00:00:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200533",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_200534.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-11T00:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200534",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_200535.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-11T00:18:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200535",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_200536.json:
```json
{
    "body": "Ticket #16051 fixes the functionality issues. So what remains to be done is the list of issues back in comment 5.",
    "created_at": "2014-04-03T11:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200536",
    "user": "https://github.com/bhutz"
}
```

Ticket #16051 fixes the functionality issues. So what remains to be done is the list of issues back in comment 5.



---

archive/issue_comments_200537.json:
```json
{
    "body": "initialization of the fast_polys should probably be done lazily, unless you can show it is always quick. There are many reasons to create morphisms/rational maps that do not involve evaluating them at points. For instance, you might want to take direct or inverse images of subvarieties. For doing that one does not evaluate the defining polynomials, but one does computations with the polynomials. It would be a shame to waste time on computing fast_polys in those cases.\n\nYou'd also have to experiment to see if doing this really is an improvement: what you're basically doing is representing the polynomials by predetermined straight-line programs, and using those programs regardless of the ring over which the evaluation point is defined. Different rings may benefit from different evaluation strategies. So there's something to be said for deferring the choice of evaluation algorithm until the ring in which this needs to happen is known. Of course, in many common cases the ring for the point is the same as the base ring of the polynomials. Then fast_eval probably does pretty well (also because no intermediate coercions are required).",
    "created_at": "2014-04-03T16:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200537",
    "user": "https://github.com/nbruin"
}
```

initialization of the fast_polys should probably be done lazily, unless you can show it is always quick. There are many reasons to create morphisms/rational maps that do not involve evaluating them at points. For instance, you might want to take direct or inverse images of subvarieties. For doing that one does not evaluate the defining polynomials, but one does computations with the polynomials. It would be a shame to waste time on computing fast_polys in those cases.

You'd also have to experiment to see if doing this really is an improvement: what you're basically doing is representing the polynomials by predetermined straight-line programs, and using those programs regardless of the ring over which the evaluation point is defined. Different rings may benefit from different evaluation strategies. So there's something to be said for deferring the choice of evaluation algorithm until the ring in which this needs to happen is known. Of course, in many common cases the ring for the point is the same as the base ring of the polynomials. Then fast_eval probably does pretty well (also because no intermediate coercions are required).



---

archive/issue_comments_200538.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-07T13:00:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200538",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_200539.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-07T13:04:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200539",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_200540.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-07T13:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200540",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_200541.json:
```json
{
    "body": "I used timeit on a random degree 3 map on P^3 and it took 717 microseconds per loop.  This is very fast and doesn't really warrant lazy initialization.",
    "created_at": "2014-04-07T14:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200541",
    "user": "https://github.com/dillonmrose"
}
```

I used timeit on a random degree 3 map on P^3 and it took 717 microseconds per loop.  This is very fast and doesn't really warrant lazy initialization.



---

archive/issue_comments_200542.json:
```json
{
    "body": "Had some trouble with the rebase, so had to force the push on the branch. I think everything is still correct.\n\nAlthough there are a couple doctest failures that are still present\n\ngeneric/morphism.py\nprojective/projective_morphism.py (from the parallel code #15920)\n----\nLast 10 new commits:",
    "created_at": "2014-04-09T23:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200542",
    "user": "https://github.com/bhutz"
}
```

Had some trouble with the rebase, so had to force the push on the branch. I think everything is still correct.

Although there are a couple doctest failures that are still present

generic/morphism.py
projective/projective_morphism.py (from the parallel code #15920)
----
Last 10 new commits:



---

archive/issue_comments_200543.json:
```json
{
    "body": "Replying to [comment:20 drose]:\n> I used timeit on a random degree 3 map on P<sup>3</sup> and it took 717 microseconds per loop.  This is very fast and doesn't really warrant lazy initialization.\n\nWhether 717 ms is a lot depends on what you compare it to. I'm finding (on 6.0):\n\n```\nsage: P5=ProjectiveSpace(Rationals(),5)\nsage: R=P2.coordinate_ring()\nsage: mon=[R({tuple(a):1}) for a in WeightedIntegerVectors(4,[1,1,1,1,1,1])]\nsage: L=[sum(random_sublist(mon,0.1)) for j in [0..5]]\nsage: %timeit P2.hom(L,P2)\n10000 loops, best of 3: 63.3 us per loop\nsage: %timeit [fast_callable(l) for l in L]\n100 loops, best of 3: 1.94 ms per loop\n```\n\nas you see, creating the fast callables is *much* slower than creating the map. If you increase the polynomials in L (by increasing the degree of the monomials, for instance), the difference gets worse. I'd say that's enough time penalty to hold off on it unless you actually need the fast_callables.",
    "created_at": "2014-04-10T03:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200543",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:20 drose]:
> I used timeit on a random degree 3 map on P<sup>3</sup> and it took 717 microseconds per loop.  This is very fast and doesn't really warrant lazy initialization.

Whether 717 ms is a lot depends on what you compare it to. I'm finding (on 6.0):

```
sage: P5=ProjectiveSpace(Rationals(),5)
sage: R=P2.coordinate_ring()
sage: mon=[R({tuple(a):1}) for a in WeightedIntegerVectors(4,[1,1,1,1,1,1])]
sage: L=[sum(random_sublist(mon,0.1)) for j in [0..5]]
sage: %timeit P2.hom(L,P2)
10000 loops, best of 3: 63.3 us per loop
sage: %timeit [fast_callable(l) for l in L]
100 loops, best of 3: 1.94 ms per loop
```

as you see, creating the fast callables is *much* slower than creating the map. If you increase the polynomials in L (by increasing the degree of the monomials, for instance), the difference gets worse. I'd say that's enough time penalty to hold off on it unless you actually need the fast_callables.



---

archive/issue_comments_200544.json:
```json
{
    "body": "Yes, it is definitely slower than creating the map, but < 1ms didn't seem to be worth bothering over. Note that you wrote 717ms not the actual 717us.\n\nWe could put a try/except in call and init them in the except. Any idea how much overhead a try block adds? As far as I can tell in a couple tests it doesn't actually add an execution time. If that's the case, then there is no reason not to do it lazily.",
    "created_at": "2014-04-10T13:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200544",
    "user": "https://github.com/bhutz"
}
```

Yes, it is definitely slower than creating the map, but < 1ms didn't seem to be worth bothering over. Note that you wrote 717ms not the actual 717us.

We could put a try/except in call and init them in the except. Any idea how much overhead a try block adds? As far as I can tell in a couple tests it doesn't actually add an execution time. If that's the case, then there is no reason not to do it lazily.



---

archive/issue_comments_200545.json:
```json
{
    "body": "Replying to [comment:23 bhutz]:\n> We could put a try/except in call and init them in the except. Any idea how much overhead a try block adds? As far as I can tell in a couple tests it doesn't actually add an execution time. If that's the case, then there is no reason not to do it lazily.\n\nPython is designed to let \"try\" be very fast. If an exception occurs there is a bit larger penalty but in this case it wouldn't be measurable compared to the `fast callable`.\n\nThe recommended way to store the fast_callable would be by accessing them through a `cached_method` or a `lazy_attribute`. See their docstrings for examples. Just don't go sticking `cached_method` decorators on methods arbitrarily. That's how we get memory leaks :-).",
    "created_at": "2014-04-10T14:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200545",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:23 bhutz]:
> We could put a try/except in call and init them in the except. Any idea how much overhead a try block adds? As far as I can tell in a couple tests it doesn't actually add an execution time. If that's the case, then there is no reason not to do it lazily.

Python is designed to let "try" be very fast. If an exception occurs there is a bit larger penalty but in this case it wouldn't be measurable compared to the `fast callable`.

The recommended way to store the fast_callable would be by accessing them through a `cached_method` or a `lazy_attribute`. See their docstrings for examples. Just don't go sticking `cached_method` decorators on methods arbitrarily. That's how we get memory leaks :-).



---

archive/issue_comments_200546.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-04-22T01:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200546",
    "user": "https://github.com/dillonmrose"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_200547.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-04-22T01:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200547",
    "user": "https://github.com/dillonmrose"
}
```

New commits:



---

archive/issue_comments_200548.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-04-23T15:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200548",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_200549.json:
```json
{
    "body": "Functionality all tests out fine. A couple minor issues that need to be addressed\n\n1) _fast_eval does not use the parameter 'check'. Simply remove (from both _fast_eval functions)\n\n2) `@`lazy_attribute function needs the documentation string + an example\n\n2b) in the `@`lazy_attribute. Put the 'prime' and 'degree' inside the 'if' block so they are only computed if they are needed.\n\n3) There is an extra blank line in _fast_eval for finite fields that can be removed\n\n4) I'd like to see a few more doctests in _fast_eval. Maybe\n  a) Powerseries ring\n\n  b) quotient ring\n\nYou can pull them from comment 8 above.",
    "created_at": "2014-04-23T15:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200549",
    "user": "https://github.com/bhutz"
}
```

Functionality all tests out fine. A couple minor issues that need to be addressed

1) _fast_eval does not use the parameter 'check'. Simply remove (from both _fast_eval functions)

2) `@`lazy_attribute function needs the documentation string + an example

2b) in the `@`lazy_attribute. Put the 'prime' and 'degree' inside the 'if' block so they are only computed if they are needed.

3) There is an extra blank line in _fast_eval for finite fields that can be removed

4) I'd like to see a few more doctests in _fast_eval. Maybe
  a) Powerseries ring

  b) quotient ring

You can pull them from comment 8 above.



---

archive/issue_comments_200550.json:
```json
{
    "body": "* justify constant `2**27` as bound on \"no overflow in float\" (you should use doubles).\n* for the sake of defensive programming, would you use\n\n```\nmax(abs(c.lift()) for c in coefficients)\n```\n\ninstead? `max(GF(17)).lift()` happens to work at present, but it doesn't really make mathematical sense.\n\nAlso, if you really want to scrape the bottom on this, you should use balanced representatives, also on the coordinates when you fill them in. That would give you a larger range where you can use float.\n\nWhat you'd really need is a `cdef ulong` domain. Then you could just evaluate with 64-bit integers, which would give you a much better bound than `2^27`.",
    "created_at": "2014-04-23T16:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200550",
    "user": "https://github.com/nbruin"
}
```

* justify constant `2**27` as bound on "no overflow in float" (you should use doubles).
* for the sake of defensive programming, would you use

```
max(abs(c.lift()) for c in coefficients)
```

instead? `max(GF(17)).lift()` happens to work at present, but it doesn't really make mathematical sense.

Also, if you really want to scrape the bottom on this, you should use balanced representatives, also on the coordinates when you fill them in. That would give you a larger range where you can use float.

What you'd really need is a `cdef ulong` domain. Then you could just evaluate with 64-bit integers, which would give you a much better bound than `2^27`.



---

archive/issue_comments_200551.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-25T17:27:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200551",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_200552.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-25T17:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200552",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_200553.json:
```json
{
    "body": "The previous issues all now test out and my concerns were all addressed. In response to Nils, the 27 is now replaced with the system float precision which is 53 on my 64-bit machine. I'm not overly concerned about aggressively optimizing the float usage for speed increase since if the prime is large enough to overrun the height bound for 'reasonable' maps, then the algorithms would never finish anyway (which is what the speed increase is supposed to help). Maps that overrun the bound due to large degree/moderate prime are theoretically fine in the algorithm, but won't get this speed increase and will do the fast_eval over ZZ (or whatever the base ring is).\n\nIf you have any other comments on these changes let me know before I mark this as positive.",
    "created_at": "2014-04-26T21:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200553",
    "user": "https://github.com/bhutz"
}
```

The previous issues all now test out and my concerns were all addressed. In response to Nils, the 27 is now replaced with the system float precision which is 53 on my 64-bit machine. I'm not overly concerned about aggressively optimizing the float usage for speed increase since if the prime is large enough to overrun the height bound for 'reasonable' maps, then the algorithms would never finish anyway (which is what the speed increase is supposed to help). Maps that overrun the bound due to large degree/moderate prime are theoretically fine in the algorithm, but won't get this speed increase and will do the fast_eval over ZZ (or whatever the base ring is).

If you have any other comments on these changes let me know before I mark this as positive.



---

archive/issue_comments_200554.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-05-01T14:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200554",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_200555.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2014-05-01T16:09:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200555",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_200556.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-05-01T16:09:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200556",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_200557.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-01T16:10:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200557",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_200558.json:
```json
{
    "body": "The 16168 changes had not been merged in. Now they are.",
    "created_at": "2014-05-01T16:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200558",
    "user": "https://github.com/bhutz"
}
```

The 16168 changes had not been merged in. Now they are.



---

archive/issue_comments_200559.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-05-08T22:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200559",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_200560.json:
```json
{
    "body": "This passes all tests and the changes look fine.",
    "created_at": "2014-05-08T22:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200560",
    "user": "https://github.com/bhutz"
}
```

This passes all tests and the changes look fine.



---

archive/issue_comments_200561.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-05-09T13:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200561",
    "user": "https://github.com/bhutz"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_200562.json:
```json
{
    "body": "need to clean-up the history",
    "created_at": "2014-05-09T13:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200562",
    "user": "https://github.com/bhutz"
}
```

need to clean-up the history



---

archive/issue_comments_200563.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-05-09T15:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200563",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_200564.json:
```json
{
    "body": "never mind. I think this is ok. I was concerned about commit `6c0149c`, but it's where it is updated to 6.2.beta8",
    "created_at": "2014-05-09T15:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200564",
    "user": "https://github.com/bhutz"
}
```

never mind. I think this is ok. I was concerned about commit `6c0149c`, but it's where it is updated to 6.2.beta8



---

archive/issue_events_015178.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2014-05-12T09:48:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15543#event-15178"
}
```



---

archive/issue_comments_200565.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-05-12T09:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15543",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15543#issuecomment-200565",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
