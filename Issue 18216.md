# Issue 18216: Infinite affine crystals should use extended weight lattice

archive/issues_018216.json:
```json
{
    "body": "CC:  sage-combinat @bsalisbury1 @tscrim @anneschilling @nthiery ptingley\n\nInfinite affine crystals should use the extended weight lattice. This would include both B(infinity) crystals and crystals of integrable representations.\n\nHere is an example.\n\n```\nsage: C = crystals.infinity.NakajimaMonomials(['A',1,1])\nsage: v=C.highest_weight_vector()\nsage: v.f(1).weight()+v.f(0).weight()\n0\n```\n\nThe answer should be `-delta`. The problem is that the extended weight lattice is not being used.\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/18453\n\n",
    "created_at": "2015-05-19T16:27:36Z",
    "labels": [],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Infinite affine crystals should use extended weight lattice",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18216",
    "user": "https://github.com/dwbump"
}
```
CC:  sage-combinat @bsalisbury1 @tscrim @anneschilling @nthiery ptingley

Infinite affine crystals should use the extended weight lattice. This would include both B(infinity) crystals and crystals of integrable representations.

Here is an example.

```
sage: C = crystals.infinity.NakajimaMonomials(['A',1,1])
sage: v=C.highest_weight_vector()
sage: v.f(1).weight()+v.f(0).weight()
0
```

The answer should be `-delta`. The problem is that the extended weight lattice is not being used.



Issue created by migration from https://trac.sagemath.org/ticket/18453





---

archive/issue_comments_245681.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2015-05-19T16:33:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245681",
    "user": "https://github.com/dwbump"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_245682.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2015-05-19T18:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245682",
    "user": "https://github.com/tscrim"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_245683.json:
```json
{
    "body": "Changing keywords from \"\" to \"crystals\".",
    "created_at": "2015-05-19T18:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245683",
    "user": "https://github.com/tscrim"
}
```

Changing keywords from "" to "crystals".



---

archive/issue_comments_245684.json:
```json
{
    "body": "My proposal is to change the default value for the weight lattice to be the extended version by default since it would have the proper dimension and is the more natural thing to do weight computations in. As a result, we should create a new category for U<sub>q</sub>'(g)-crystals which uses the non-extended weight lattice. This would give us:\n\n- greater flexibility long-term to implement generic methods for things like energy, R-matrices, and perfectness,\n- better support once I patch up morphisms (#15463), and\n- allow us to fix a (IMO) hack in the default plotting options of 0 arrows of not reversing them by checking if a crystal is not in the category of highest weight crystals.\n\nAt least to fix this ticket, I don't think there would be much work. However it would be a backwards-incompatible change; although I think it would be mild.",
    "created_at": "2015-05-19T18:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245684",
    "user": "https://github.com/tscrim"
}
```

My proposal is to change the default value for the weight lattice to be the extended version by default since it would have the proper dimension and is the more natural thing to do weight computations in. As a result, we should create a new category for U<sub>q</sub>'(g)-crystals which uses the non-extended weight lattice. This would give us:

- greater flexibility long-term to implement generic methods for things like energy, R-matrices, and perfectness,
- better support once I patch up morphisms (#15463), and
- allow us to fix a (IMO) hack in the default plotting options of 0 arrows of not reversing them by checking if a crystal is not in the category of highest weight crystals.

At least to fix this ticket, I don't think there would be much work. However it would be a backwards-incompatible change; although I think it would be mild.



---

archive/issue_comments_245685.json:
```json
{
    "body": "There may be cases where one does not want the extended weight lattice. For example Kirillov-Reshetikhin crystals, I think it would complicate things if you used the extended weight lattice.\n\nThis is addressed by Travis' proposal since he would create a new category for finite crystals that use the non-extended weight lattice.\n\nThe alternative way of fixing things would be to find the places where the wrong weight lattice is created (for example in the !__classcall_private!__ method o `InfinityCrystalOfNakajimaMonomials` and add `extended=True` to the parameters of `weight_lattice`. Both ways would fix the problem.\n\nOne question is whether we more often than not want affine weight lattices to be extended. I myself do. So I would support Travis' proposal but I am pointing out that there is an alternative.",
    "created_at": "2015-05-19T19:44:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245685",
    "user": "https://github.com/dwbump"
}
```

There may be cases where one does not want the extended weight lattice. For example Kirillov-Reshetikhin crystals, I think it would complicate things if you used the extended weight lattice.

This is addressed by Travis' proposal since he would create a new category for finite crystals that use the non-extended weight lattice.

The alternative way of fixing things would be to find the places where the wrong weight lattice is created (for example in the !__classcall_private!__ method o `InfinityCrystalOfNakajimaMonomials` and add `extended=True` to the parameters of `weight_lattice`. Both ways would fix the problem.

One question is whether we more often than not want affine weight lattices to be extended. I myself do. So I would support Travis' proposal but I am pointing out that there is an alternative.



---

archive/issue_comments_245686.json:
```json
{
    "body": "Okay, here's a rough draft of my proposal that mostly works. I would like some feedback, in particular from Nicolas on the change of the behavior and the reorganization of the code. There also seems to be a subtle issue with subclassing and ``@`cached_method` (with my branch):\n\n```\nsage: P = RootSystem(['A',3,1]).weight_lattice()\nsage: P.fundamental_weight('delta')\ndelta\nsage: P.fundamental_weights()\nFinite family {0: Lambda[0], 1: Lambda[1], 2: Lambda[2], 3: Lambda[3]}\n```\nRestart Sage and do\n\n```\nsage: P = RootSystem(['A',3,1]).weight_lattice()\nsage: P.fundamental_weights()\nFinite family {0: Lambda[0], 1: Lambda[1], 2: Lambda[2], 3: Lambda[3]}\nsage: P.fundamental_weight('delta') # This is now the method of the base class!!!\n...\nValueError: delta is not in the index set\n```\nI have no idea about why this occurs, much less how to fix this.\n\nHowever it does not actually fix the problem noted on this ticket as we compute the weight by `Phi - Epsilon`. I've fixed this directly for LS paths (to which we need to be much more careful with the category) and rigged configurations. For Nakajima monomials, I'm not quite sure how to fix it. I really don't want to special case the affine types. In Kang et al., they construct B(\\infty) by the path realization, and so I think they consider it as a U'<sub>q</sub>(**g**)-crystal (and so is in the non-extended weight lattice).\n\n(Additionally, the weight function isn't correct for the Kyoto path model either, but that is a separate issue.)\n\n---\nNew commits:",
    "created_at": "2015-06-01T01:45:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245686",
    "user": "https://github.com/tscrim"
}
```

Okay, here's a rough draft of my proposal that mostly works. I would like some feedback, in particular from Nicolas on the change of the behavior and the reorganization of the code. There also seems to be a subtle issue with subclassing and ``@`cached_method` (with my branch):

```
sage: P = RootSystem(['A',3,1]).weight_lattice()
sage: P.fundamental_weight('delta')
delta
sage: P.fundamental_weights()
Finite family {0: Lambda[0], 1: Lambda[1], 2: Lambda[2], 3: Lambda[3]}
```
Restart Sage and do

```
sage: P = RootSystem(['A',3,1]).weight_lattice()
sage: P.fundamental_weights()
Finite family {0: Lambda[0], 1: Lambda[1], 2: Lambda[2], 3: Lambda[3]}
sage: P.fundamental_weight('delta') # This is now the method of the base class!!!
...
ValueError: delta is not in the index set
```
I have no idea about why this occurs, much less how to fix this.

However it does not actually fix the problem noted on this ticket as we compute the weight by `Phi - Epsilon`. I've fixed this directly for LS paths (to which we need to be much more careful with the category) and rigged configurations. For Nakajima monomials, I'm not quite sure how to fix it. I really don't want to special case the affine types. In Kang et al., they construct B(\infty) by the path realization, and so I think they consider it as a U'<sub>q</sub>(**g**)-crystal (and so is in the non-extended weight lattice).

(Additionally, the weight function isn't correct for the Kyoto path model either, but that is a separate issue.)

---
New commits:



---

archive/issue_comments_245687.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-09T21:18:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245687",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245688.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-06-10T15:46:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245688",
    "user": "https://github.com/anneschilling"
}
```

New commits:



---

archive/issue_comments_245689.json:
```json
{
    "body": "Ben and I are going to fix this in a different way. I had to fix the Weyl dimension formula (which I guess was written by Nicolas and only worked in the ambient space). So please check. Ben will add fixes to the other crystals, but the Littlemann paths should be fixed now.",
    "created_at": "2015-06-10T15:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245689",
    "user": "https://github.com/anneschilling"
}
```

Ben and I are going to fix this in a different way. I had to fix the Weyl dimension formula (which I guess was written by Nicolas and only worked in the ambient space). So please check. Ben will add fixes to the other crystals, but the Littlemann paths should be fixed now.



---

archive/issue_comments_245690.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-10T16:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245690",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245691.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-10T17:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245691",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245692.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-06-10T17:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245692",
    "user": "https://github.com/anneschilling"
}
```

New commits:



---

archive/issue_comments_245693.json:
```json
{
    "body": "Hi Travis,\n\nlittelmann_paths and generalized_young_walls are fixed. Ben is working on monomials to get the hyperbolic cases working. Could you fix the rigged configuration crystals by implementing the correct weight and weight_lattice_realization? In this ticket we do not want to revamp all the root_system stuff that you added in your previous patch and the category changes for KR crystals.\n\nThanks!\n\nAnne",
    "created_at": "2015-06-10T17:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245693",
    "user": "https://github.com/anneschilling"
}
```

Hi Travis,

littelmann_paths and generalized_young_walls are fixed. Ben is working on monomials to get the hyperbolic cases working. Could you fix the rigged configuration crystals by implementing the correct weight and weight_lattice_realization? In this ticket we do not want to revamp all the root_system stuff that you added in your previous patch and the category changes for KR crystals.

Thanks!

Anne



---

archive/issue_comments_245694.json:
```json
{
    "body": "I'm pretty sure this will not end up fixing most of the problems and it feels like we're hacking around the problem. At the very least as a better patch, I think we could solve a host of issues by just checking if the type is affine and if the crystal is not in finite crystals to pass `extended=True`. However I will fix the RC code and test a bunch of the different models in affine type as soon as I'm able to today.",
    "created_at": "2015-06-10T17:56:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245694",
    "user": "https://github.com/tscrim"
}
```

I'm pretty sure this will not end up fixing most of the problems and it feels like we're hacking around the problem. At the very least as a better patch, I think we could solve a host of issues by just checking if the type is affine and if the crystal is not in finite crystals to pass `extended=True`. However I will fix the RC code and test a bunch of the different models in affine type as soon as I'm able to today.



---

archive/issue_comments_245695.json:
```json
{
    "body": "I've fixed the rigged configurations\n\n- `CrystalOfAlcovePaths` fails outright:\n\n```\nsage: C = crystals.AlcovePaths(La[0])\nsage: C\nHighest weight crystal of alcove paths of type ['A', 1, 1] and weight Lambda[0]\nsage: C.module_generators[0].f_string([0,1])\n((alpha[0], 0), (2*alpha[0] + alpha[1], 1))\nsage: _.weight()\nTypeError\n```\n- We should also explicitly implement a `weight_lattice_realization` for `DirectSumOfCrystals` similar to what we did for tensor products.\n- We have to decide what we want to do with `KyotoPathModel` and if we want to consider it as a U<sub>q</sub>'-crystal or a U<sub>q</sub>-crystal. I think the former is what we should do considering it is a tensor product of U<sub>q</sub>'-crystals. In any case, we will probably have to do something special for this.\n- We have a problem with not distinguishing between elements of the extended and non-extended affine weight lattices. In particular, this causes an issue with creating the highest weight crystals with the same weight but you accidentally first create it in the non-extended affine weight lattice.\n\n```\nsage: LaE = RootSystem(['A',2,1]).weight_space(extended=True).fundamental_weights()sage: La = RootSystem(['A',2,1]).weight_space().fundamental_weights()\nsage: B = crystals.LSPaths(La[0])\nsage: B2 = crystals.LSPaths(LaE[0])\nsage: B is B2\nTrue\n```\nI had changed `crystals.RiggedConfigurations` with inadvertantly triggered this. I don't think we want to enforce that the user must consider weights in the extended affine weight lattice as it is a valid restriction from U<sub>q</sub> to U<sub>q</sub>' (in particular, the Kyoto path model). IMO the solution would be for `__classcall__`/`__classcall_private__` to pass the weight lattice realization with the default to use the parent of the weight given. I feel this gives the user added flexibility for where they want the weights to be printed. Although part of me also thinks there should be some kind of option which could be changed in the method-input/classes/globally which specifies the weight lattice realization.\n\nI will be on skype all day today if you want to talk.",
    "created_at": "2015-06-10T19:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245695",
    "user": "https://github.com/tscrim"
}
```

I've fixed the rigged configurations

- `CrystalOfAlcovePaths` fails outright:

```
sage: C = crystals.AlcovePaths(La[0])
sage: C
Highest weight crystal of alcove paths of type ['A', 1, 1] and weight Lambda[0]
sage: C.module_generators[0].f_string([0,1])
((alpha[0], 0), (2*alpha[0] + alpha[1], 1))
sage: _.weight()
TypeError
```
- We should also explicitly implement a `weight_lattice_realization` for `DirectSumOfCrystals` similar to what we did for tensor products.
- We have to decide what we want to do with `KyotoPathModel` and if we want to consider it as a U<sub>q</sub>'-crystal or a U<sub>q</sub>-crystal. I think the former is what we should do considering it is a tensor product of U<sub>q</sub>'-crystals. In any case, we will probably have to do something special for this.
- We have a problem with not distinguishing between elements of the extended and non-extended affine weight lattices. In particular, this causes an issue with creating the highest weight crystals with the same weight but you accidentally first create it in the non-extended affine weight lattice.

```
sage: LaE = RootSystem(['A',2,1]).weight_space(extended=True).fundamental_weights()sage: La = RootSystem(['A',2,1]).weight_space().fundamental_weights()
sage: B = crystals.LSPaths(La[0])
sage: B2 = crystals.LSPaths(LaE[0])
sage: B is B2
True
```
I had changed `crystals.RiggedConfigurations` with inadvertantly triggered this. I don't think we want to enforce that the user must consider weights in the extended affine weight lattice as it is a valid restriction from U<sub>q</sub> to U<sub>q</sub>' (in particular, the Kyoto path model). IMO the solution would be for `__classcall__`/`__classcall_private__` to pass the weight lattice realization with the default to use the parent of the weight given. I feel this gives the user added flexibility for where they want the weights to be printed. Although part of me also thinks there should be some kind of option which could be changed in the method-input/classes/globally which specifies the weight lattice realization.

I will be on skype all day today if you want to talk.



---

archive/issue_comments_245696.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-10T19:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245696",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245697.json:
```json
{
    "body": "Replying to [comment:13 tscrim]:\n> However I will fix the RC code and test a bunch of the different models in affine type\n\n\nJust random thoughts: will failure be caught by TestSuite? If not could there be new _test methods catching the issue?",
    "created_at": "2015-06-10T20:17:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245697",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:13 tscrim]:
> However I will fix the RC code and test a bunch of the different models in affine type


Just random thoughts: will failure be caught by TestSuite? If not could there be new _test methods catching the issue?



---

archive/issue_comments_245698.json:
```json
{
    "body": "Replying to [comment:8 aschilling]:\n> I had to fix the Weyl dimension formula (which I guess was written by Nicolas and only worked in the ambient space).\n\n\nBy Dan, if I recall correctly.",
    "created_at": "2015-06-10T20:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245698",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:8 aschilling]:
> I had to fix the Weyl dimension formula (which I guess was written by Nicolas and only worked in the ambient space).


By Dan, if I recall correctly.



---

archive/issue_comments_245699.json:
```json
{
    "body": "Replying to [comment:16 nthiery]:\n> Replying to [comment:13 tscrim]:\n> > However I will fix the RC code and test a bunch of the different models in affine type\n\n> \n> Just random thoughts: will failure be caught by TestSuite? If not could there be new _test methods catching the issue?\n\n\nI don't think we could write a `TestSuite` check for this (at least for the highest weight crystals) as the branching rule I mentioned above is valid (and so having the weights in the non-extended weight lattice still makes sense, unless I'm misunderstanding something about U<sub>q</sub>'(**g**) inside of U<sub>q</sub>(**g**)).",
    "created_at": "2015-06-10T20:24:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245699",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:16 nthiery]:
> Replying to [comment:13 tscrim]:
> > However I will fix the RC code and test a bunch of the different models in affine type

> 
> Just random thoughts: will failure be caught by TestSuite? If not could there be new _test methods catching the issue?


I don't think we could write a `TestSuite` check for this (at least for the highest weight crystals) as the branching rule I mentioned above is valid (and so having the weights in the non-extended weight lattice still makes sense, unless I'm misunderstanding something about U<sub>q</sub>'(**g**) inside of U<sub>q</sub>(**g**)).



---

archive/issue_comments_245700.json:
```json
{
    "body": "Replying to [comment:17 nthiery]:\n> Replying to [comment:8 aschilling]:\n> > I had to fix the Weyl dimension formula (which I guess was written by Nicolas and only worked in the ambient space).\n\n> \n> By Dan, if I recall correctly.\n\n\n```\n7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  859)         def weyl_dimension(self, highest_weight):\n7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  860)             \"\"\"\n7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  861)             EXAMPLES::\n7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  862) \n7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  863)                 sage: RootSystem(['A',3]).ambient_lattice().weyl_dimension([2,1,0,0])\n7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  864)                 20\n7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  865) \n7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  866)                 sage: type(RootSystem(['A',3]).ambient_lattice().weyl_dimension([2,1,0,0]))\n7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  867)                 <type 'sage.rings.integer.Integer'>\n7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  868)             \"\"\"\n7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  869)             highest_weight = self(highest_weight)\nf562ca2b (Travis Scrimshaw  2014-10-01 17:16:31 -0700  870)             if not highest_weight.is_dominant():\nf562ca2b (Travis Scrimshaw  2014-10-01 17:16:31 -0700  871)                 raise ValueError(\"the highest weight must be dominant\")\n7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  872)             rho = self.rho()\n7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  873)             n = prod([(rho+highest_weight).dot_product(x) for x in self.positive_roots()])\n7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  874)             d = prod([ rho.dot_product(x) for x in self.positive_roots()])\n7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  875)             from sage.rings.integer import Integer\n7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  876)             return Integer(n/d)\n```\nBut in any case, someone should check!",
    "created_at": "2015-06-11T04:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245700",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:17 nthiery]:
> Replying to [comment:8 aschilling]:
> > I had to fix the Weyl dimension formula (which I guess was written by Nicolas and only worked in the ambient space).

> 
> By Dan, if I recall correctly.


```
7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  859)         def weyl_dimension(self, highest_weight):
7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  860)             """
7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  861)             EXAMPLES::
7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  862) 
7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  863)                 sage: RootSystem(['A',3]).ambient_lattice().weyl_dimension([2,1,0,0])
7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  864)                 20
7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  865) 
7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  866)                 sage: type(RootSystem(['A',3]).ambient_lattice().weyl_dimension([2,1,0,0]))
7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  867)                 <type 'sage.rings.integer.Integer'>
7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  868)             """
7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  869)             highest_weight = self(highest_weight)
f562ca2b (Travis Scrimshaw  2014-10-01 17:16:31 -0700  870)             if not highest_weight.is_dominant():
f562ca2b (Travis Scrimshaw  2014-10-01 17:16:31 -0700  871)                 raise ValueError("the highest weight must be dominant")
7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  872)             rho = self.rho()
7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  873)             n = prod([(rho+highest_weight).dot_product(x) for x in self.positive_roots()])
7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  874)             d = prod([ rho.dot_product(x) for x in self.positive_roots()])
7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  875)             from sage.rings.integer import Integer
7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  876)             return Integer(n/d)
```
But in any case, someone should check!



---

archive/issue_comments_245701.json:
```json
{
    "body": "> - `CrystalOfAlcovePaths` fails outright:\n> \n> ```\n> sage: C = crystals.AlcovePaths(La[0])\n> sage: C\n> Highest weight crystal of alcove paths of type ['A', 1, 1] and weight Lambda[0]\n> sage: C.module_generators[0].f_string([0,1])\n> ((alpha[0], 0), (2*alpha[0] + alpha[1], 1))\n> sage: _.weight()\n> TypeError\n> ```\n\n\nNo, it does not. You did not send how you made the weight La. I assume you used the weight_lattice and not weight_space (which you have to for this model!!)\n\n```\nsage: R = RootSystem(['A',1,1])\nsage: P = R.weight_space()\nsage: La = P.basis()\nsage: C = crystals.AlcovePaths(La[0])\nsage: b = C.module_generators[0].f(0)\nsage: b\n((alpha[0], 0),)\nsage: b.weight()\n-Lambda[0] + 2*Lambda[1]\n```\n\n> - We should also explicitly implement a `weight_lattice_realization` for `DirectSumOfCrystals` similar to what we did for tensor products.\n> - We have to decide what we want to do with `KyotoPathModel` and if we want to consider it as a U<sub>q</sub>'-crystal or a U<sub>q</sub>-crystal. I think the former is what we should do considering it is a tensor product of U<sub>q</sub>'-crystals. In any case, we will probably have to do something special for this.\n\n\nMathematically speaking, the Kyoto path model is a model in the category of highest weight affine crystals. It is a U_q(g)-crystal not a U_q'(g) crystal. Really what one does it take tensor products `B^{r,s} \\otimes u_\\Lambda` with `\\Lambda` of level `s`.",
    "created_at": "2015-06-11T04:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245701",
    "user": "https://github.com/anneschilling"
}
```

> - `CrystalOfAlcovePaths` fails outright:
> 
> ```
> sage: C = crystals.AlcovePaths(La[0])
> sage: C
> Highest weight crystal of alcove paths of type ['A', 1, 1] and weight Lambda[0]
> sage: C.module_generators[0].f_string([0,1])
> ((alpha[0], 0), (2*alpha[0] + alpha[1], 1))
> sage: _.weight()
> TypeError
> ```


No, it does not. You did not send how you made the weight La. I assume you used the weight_lattice and not weight_space (which you have to for this model!!)

```
sage: R = RootSystem(['A',1,1])
sage: P = R.weight_space()
sage: La = P.basis()
sage: C = crystals.AlcovePaths(La[0])
sage: b = C.module_generators[0].f(0)
sage: b
((alpha[0], 0),)
sage: b.weight()
-Lambda[0] + 2*Lambda[1]
```

> - We should also explicitly implement a `weight_lattice_realization` for `DirectSumOfCrystals` similar to what we did for tensor products.
> - We have to decide what we want to do with `KyotoPathModel` and if we want to consider it as a U<sub>q</sub>'-crystal or a U<sub>q</sub>-crystal. I think the former is what we should do considering it is a tensor product of U<sub>q</sub>'-crystals. In any case, we will probably have to do something special for this.


Mathematically speaking, the Kyoto path model is a model in the category of highest weight affine crystals. It is a U_q(g)-crystal not a U_q'(g) crystal. Really what one does it take tensor products `B^{r,s} \otimes u_\Lambda` with `\Lambda` of level `s`.



---

archive/issue_comments_245702.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-11T16:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245702",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245703.json:
```json
{
    "body": "It seems the original error in the monomial crystals code is due to an error in the literature about how the weight function is defined for monomial crystals.  I've checked\n\n- Kang, Kim, and Shin, *Modified Nakajima monomials and the crystal B(infinity),* J. Alg. 308 (2007), 524-535.\n\n- Kashiwara, *Realizations of crystals,* Contemporary Math. 325 (2003), 133-139.\n\n- Kim and Shin, *Nakajima monomials, Young walls, and the Kashiwara embedding,* J. Alg. 330 (2011), 234-250.\n\n- Kim, *Monomial realization of crystal graphs for Uq(An1),* Math. Ann. 332 (2005), 17-35.\n\n- ...\n\nIn none of these references is there a way to get `delta` to appear as a weight.  Perhaps I've missed a reference that does include this information, but I'm thinking about the problem now and planning to discuss it with Peter TIngley, so hopefully we will have a resolution soon.",
    "created_at": "2015-06-11T16:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245703",
    "user": "https://github.com/bsalisbury1"
}
```

It seems the original error in the monomial crystals code is due to an error in the literature about how the weight function is defined for monomial crystals.  I've checked

- Kang, Kim, and Shin, *Modified Nakajima monomials and the crystal B(infinity),* J. Alg. 308 (2007), 524-535.

- Kashiwara, *Realizations of crystals,* Contemporary Math. 325 (2003), 133-139.

- Kim and Shin, *Nakajima monomials, Young walls, and the Kashiwara embedding,* J. Alg. 330 (2011), 234-250.

- Kim, *Monomial realization of crystal graphs for Uq(An1),* Math. Ann. 332 (2005), 17-35.

- ...

In none of these references is there a way to get `delta` to appear as a weight.  Perhaps I've missed a reference that does include this information, but I'm thinking about the problem now and planning to discuss it with Peter TIngley, so hopefully we will have a resolution soon.



---

archive/issue_comments_245704.json:
```json
{
    "body": "Changing keywords from \"crystals\" to \"crystals, days65\".",
    "created_at": "2015-06-11T16:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245704",
    "user": "https://github.com/bsalisbury1"
}
```

Changing keywords from "crystals" to "crystals, days65".



---

archive/issue_comments_245705.json:
```json
{
    "body": "Replying to [comment:20 aschilling]:\n> > - `CrystalOfAlcovePaths` fails outright:\n \n> No, it does not. You did not send how you made the weight La. I assume you used the weight_lattice and not weight_space (which you have to for this model!!)\n\nAh, we do need the `weight_space`, so we should probably make it error out similar for the LS paths if we aren't in the weight space. Also it does work using the extended weight lattice:\n\n```\nsage: La = RootSystem(['A',2,1]).weight_space(extended=True).fundamental_weights()\nsage: C = crystals.AlcovePaths(La[0])\nsage: C.module_generators[0].f_string([0,1])\n((alpha[0], 0), (alpha[0] + alpha[1], 0))\nsage: _.weight()\n-Lambda[1] + 2*Lambda[2] - delta\n```\n\n> > - We should also explicitly implement a `weight_lattice_realization` for `DirectSumOfCrystals` similar to what we did for tensor products.\n> > - We have to decide what we want to do with `KyotoPathModel` and if we want to consider it as a U<sub>q</sub>'-crystal or a U<sub>q</sub>-crystal. I think the former is what we should do considering it is a tensor product of U<sub>q</sub>'-crystals. In any case, we will probably have to do something special for this.\n \n> \n> Mathematically speaking, the Kyoto path model is a model in the category of highest weight affine crystals. It is a U_q(g)-crystal not a U_q'(g) crystal. Really what one does it take tensor products `B^{r,s} \\otimes u_\\Lambda` with `\\Lambda` of level `s`.\n\n\nI agree that it is in highest weight affine crystals, but we don't have a way to get `\\delta` from the elements. The embedding `B(\\lambda) \\to B^{r,s} \\otimes B(\\mu)` has to be as U_q'(g)-crystals as `B^{r,s}` must be a U_q'(g)-crystal as otherwise it breaks the condition for the weight function. Also if `\\Lambda` is of level `s`, then `\\Lambda + k\\delta` is of level `s` for all `k` since `<c, \\delta> = 0`. I still don't quite see how we could figure out what the coefficient of `\\delta` is for an arbitrary element in the Kyoto path model.\n\nReplying to [comment:21 bsalisbury1]:\n> It seems the original error in the monomial crystals code is due to an error in the literature about how the weight function is defined for monomial crystals.\n> ...\n> In none of these references is there a way to get delta to appear as a weight. Perhaps I've missed a reference that does include this information, but I'm thinking about the problem now and planning to discuss it with Peter Tingley, so hopefully we will have a resolution soon.\n\n\nI had poked around on this too when I first looked into this ticket and couldn't find anything (I also looked in *Level 0 monomial crystals* by Hernandez and Kashiwara). Expressing the monomial crystals in the `A`'s isn't a problem since we can just pull the simple roots and `\\alpha_0` is what contributes to `\\delta`. We can always brute-force this computation for highest weight crystals by taking a path to the highest weight and computing the weight from that, but that is going to be *really* slow (but it will be correct). I think the best solution is to follow Hernandez and Kashiwara and add a weight attribute to each element of the crystal, which is easy enough to compute on each application of `e` and `f`.\n\nAlso in a similar vein, I don't think we can compute `\\delta` from doing `Epsilon - Phi` as `Epsilon = \\sum_i \\epsilon_i \\Lambda_i` and similar for `\\Phi` (which comes down to the fact that `<h_i, \\delta> = 0`, where `h_i` is a simple coroot). I think we need to change this, or at least put a stopgap in affine type and the WLR is the extended weight lattice.",
    "created_at": "2015-06-11T16:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245705",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:20 aschilling]:
> > - `CrystalOfAlcovePaths` fails outright:
 
> No, it does not. You did not send how you made the weight La. I assume you used the weight_lattice and not weight_space (which you have to for this model!!)

Ah, we do need the `weight_space`, so we should probably make it error out similar for the LS paths if we aren't in the weight space. Also it does work using the extended weight lattice:

```
sage: La = RootSystem(['A',2,1]).weight_space(extended=True).fundamental_weights()
sage: C = crystals.AlcovePaths(La[0])
sage: C.module_generators[0].f_string([0,1])
((alpha[0], 0), (alpha[0] + alpha[1], 0))
sage: _.weight()
-Lambda[1] + 2*Lambda[2] - delta
```

> > - We should also explicitly implement a `weight_lattice_realization` for `DirectSumOfCrystals` similar to what we did for tensor products.
> > - We have to decide what we want to do with `KyotoPathModel` and if we want to consider it as a U<sub>q</sub>'-crystal or a U<sub>q</sub>-crystal. I think the former is what we should do considering it is a tensor product of U<sub>q</sub>'-crystals. In any case, we will probably have to do something special for this.
 
> 
> Mathematically speaking, the Kyoto path model is a model in the category of highest weight affine crystals. It is a U_q(g)-crystal not a U_q'(g) crystal. Really what one does it take tensor products `B^{r,s} \otimes u_\Lambda` with `\Lambda` of level `s`.


I agree that it is in highest weight affine crystals, but we don't have a way to get `\delta` from the elements. The embedding `B(\lambda) \to B^{r,s} \otimes B(\mu)` has to be as U_q'(g)-crystals as `B^{r,s}` must be a U_q'(g)-crystal as otherwise it breaks the condition for the weight function. Also if `\Lambda` is of level `s`, then `\Lambda + k\delta` is of level `s` for all `k` since `<c, \delta> = 0`. I still don't quite see how we could figure out what the coefficient of `\delta` is for an arbitrary element in the Kyoto path model.

Replying to [comment:21 bsalisbury1]:
> It seems the original error in the monomial crystals code is due to an error in the literature about how the weight function is defined for monomial crystals.
> ...
> In none of these references is there a way to get delta to appear as a weight. Perhaps I've missed a reference that does include this information, but I'm thinking about the problem now and planning to discuss it with Peter Tingley, so hopefully we will have a resolution soon.


I had poked around on this too when I first looked into this ticket and couldn't find anything (I also looked in *Level 0 monomial crystals* by Hernandez and Kashiwara). Expressing the monomial crystals in the `A`'s isn't a problem since we can just pull the simple roots and `\alpha_0` is what contributes to `\delta`. We can always brute-force this computation for highest weight crystals by taking a path to the highest weight and computing the weight from that, but that is going to be *really* slow (but it will be correct). I think the best solution is to follow Hernandez and Kashiwara and add a weight attribute to each element of the crystal, which is easy enough to compute on each application of `e` and `f`.

Also in a similar vein, I don't think we can compute `\delta` from doing `Epsilon - Phi` as `Epsilon = \sum_i \epsilon_i \Lambda_i` and similar for `\Phi` (which comes down to the fact that `<h_i, \delta> = 0`, where `h_i` is a simple coroot). I think we need to change this, or at least put a stopgap in affine type and the WLR is the extended weight lattice.



---

archive/issue_comments_245706.json:
```json
{
    "body": "Replying to [comment:23 tscrim]:\n> Replying to [comment:21 bsalisbury1]:\n> > It seems the original error in the monomial crystals code is due to an error in the literature about how the weight function is defined for monomial crystals.\n> > ...\n> > In none of these references is there a way to get delta to appear as a weight. Perhaps I've missed a reference that does include this information, but I'm thinking about the problem now and planning to discuss it with Peter Tingley, so hopefully we will have a resolution soon.\n\n> \n> I had poked around on this too when I first looked into this ticket and couldn't find anything (I also looked in *Level 0 monomial crystals* by Hernandez and Kashiwara). Expressing the monomial crystals in the `A`'s isn't a problem since we can just pull the simple roots and `\\alpha_0` is what contributes to `\\delta`. We can always brute-force this computation for highest weight crystals by taking a path to the highest weight and computing the weight from that, but that is going to be *really* slow (but it will be correct). I think the best solution is to follow Hernandez and Kashiwara and add a weight attribute to each element of the crystal, which is easy enough to compute on each application of `e` and `f`.\n\n\nI tried doing this using the path to the highest weight vector, but it causes a loop in Sage because of the way the crystal operators are defined in the monomial crystals model.  In particular, we need phi to compute the action of the Kashiwara operators, and phi depends on the weight in the B(infinity) model.",
    "created_at": "2015-06-11T17:02:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245706",
    "user": "https://github.com/bsalisbury1"
}
```

Replying to [comment:23 tscrim]:
> Replying to [comment:21 bsalisbury1]:
> > It seems the original error in the monomial crystals code is due to an error in the literature about how the weight function is defined for monomial crystals.
> > ...
> > In none of these references is there a way to get delta to appear as a weight. Perhaps I've missed a reference that does include this information, but I'm thinking about the problem now and planning to discuss it with Peter Tingley, so hopefully we will have a resolution soon.

> 
> I had poked around on this too when I first looked into this ticket and couldn't find anything (I also looked in *Level 0 monomial crystals* by Hernandez and Kashiwara). Expressing the monomial crystals in the `A`'s isn't a problem since we can just pull the simple roots and `\alpha_0` is what contributes to `\delta`. We can always brute-force this computation for highest weight crystals by taking a path to the highest weight and computing the weight from that, but that is going to be *really* slow (but it will be correct). I think the best solution is to follow Hernandez and Kashiwara and add a weight attribute to each element of the crystal, which is easy enough to compute on each application of `e` and `f`.


I tried doing this using the path to the highest weight vector, but it causes a loop in Sage because of the way the crystal operators are defined in the monomial crystals model.  In particular, we need phi to compute the action of the Kashiwara operators, and phi depends on the weight in the B(infinity) model.



---

archive/issue_comments_245707.json:
```json
{
    "body": "Replying to [comment:24 bsalisbury1]:\n> Replying to [comment:23 tscrim]:\n> > I had poked around on this too when I first looked into this ticket and couldn't find anything (I also looked in *Level 0 monomial crystals* by Hernandez and Kashiwara). Expressing the monomial crystals in the `A`'s isn't a problem since we can just pull the simple roots and `\\alpha_0` is what contributes to `\\delta`. We can always brute-force this computation for highest weight crystals by taking a path to the highest weight and computing the weight from that, but that is going to be *really* slow (but it will be correct). I think the best solution is to follow Hernandez and Kashiwara and add a weight attribute to each element of the crystal, which is easy enough to compute on each application of `e` and `f`.\n\n> \n> I tried doing this using the path to the highest weight vector, but it causes a loop in Sage because of the way the crystal operators are defined in the monomial crystals model.  In particular, we need phi to compute the action of the Kashiwara operators, and phi depends on the weight in the B(infinity) model.\n\n\nRight...I'm now fairly convinced it will be best to simply store the weight as an attribute of the elements. This might also result in a speedup as we wouldn't need to (re)compute the weight everytime we call `phi()`.",
    "created_at": "2015-06-11T17:27:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245707",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:24 bsalisbury1]:
> Replying to [comment:23 tscrim]:
> > I had poked around on this too when I first looked into this ticket and couldn't find anything (I also looked in *Level 0 monomial crystals* by Hernandez and Kashiwara). Expressing the monomial crystals in the `A`'s isn't a problem since we can just pull the simple roots and `\alpha_0` is what contributes to `\delta`. We can always brute-force this computation for highest weight crystals by taking a path to the highest weight and computing the weight from that, but that is going to be *really* slow (but it will be correct). I think the best solution is to follow Hernandez and Kashiwara and add a weight attribute to each element of the crystal, which is easy enough to compute on each application of `e` and `f`.

> 
> I tried doing this using the path to the highest weight vector, but it causes a loop in Sage because of the way the crystal operators are defined in the monomial crystals model.  In particular, we need phi to compute the action of the Kashiwara operators, and phi depends on the weight in the B(infinity) model.


Right...I'm now fairly convinced it will be best to simply store the weight as an attribute of the elements. This might also result in a speedup as we wouldn't need to (re)compute the weight everytime we call `phi()`.



---

archive/issue_comments_245708.json:
```json
{
    "body": "Replying to [comment:19 aschilling]:\n\n> But in any case, someone should check!\n\n\nI will check it.",
    "created_at": "2015-06-11T21:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245708",
    "user": "https://github.com/dwbump"
}
```

Replying to [comment:19 aschilling]:

> But in any case, someone should check!


I will check it.



---

archive/issue_comments_245709.json:
```json
{
    "body": "> Right...I'm now fairly convinced it will be best to simply store the weight as an attribute of the elements. This might also result in a speedup as we wouldn't need to (re)compute the weight everytime we call `phi()`.\n\n\nBen and I found a different way which fixes the problem. A new commit will follow soon!",
    "created_at": "2015-06-11T21:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245709",
    "user": "https://github.com/anneschilling"
}
```

> Right...I'm now fairly convinced it will be best to simply store the weight as an attribute of the elements. This might also result in a speedup as we wouldn't need to (re)compute the weight everytime we call `phi()`.


Ben and I found a different way which fixes the problem. A new commit will follow soon!



---

archive/issue_comments_245710.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-11T22:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245710",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245711.json:
```json
{
    "body": "We have the following behavior in root systems (as Travis mentioned):\n\n```\nsage: R = RootSystem(['B',2,1])\nsage: La = R.weight_space().basis()\nsage: LaE = R.weight_space(extended=True).basis()\nsage: La[0] == LaE[0]\nTrue\nsage: La[0].parent() == LaE[0].parent()\nFalse\n```\nThis yields to the behavior that LS paths labeled by extended fundamental weights and nonextended ones are considered to be the same crystal. Should we fix the weight issue or pass another (fake) argument in the init method to distinguish the crystals?\n\nNicolas, do you have an opinion on the above?",
    "created_at": "2015-06-11T22:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245711",
    "user": "https://github.com/anneschilling"
}
```

We have the following behavior in root systems (as Travis mentioned):

```
sage: R = RootSystem(['B',2,1])
sage: La = R.weight_space().basis()
sage: LaE = R.weight_space(extended=True).basis()
sage: La[0] == LaE[0]
True
sage: La[0].parent() == LaE[0].parent()
False
```
This yields to the behavior that LS paths labeled by extended fundamental weights and nonextended ones are considered to be the same crystal. Should we fix the weight issue or pass another (fake) argument in the init method to distinguish the crystals?

Nicolas, do you have an opinion on the above?



---

archive/issue_comments_245712.json:
```json
{
    "body": "Replying to [comment:26 bump]:\n> Replying to [comment:19 aschilling]:\n> \n> > But in any case, someone should check!\n\n> \n> I will check it.\n\n\nI would if I could \u2026 I pulled the branch, built and can't run it it because of some problem with ascii_art. I'll make distclean and try again.\n\nI'm a little worried that if the changes required replacing the inner product in weyl_dimension method there could also be failures in weyl_characters.py too which also depend on the same inner product.",
    "created_at": "2015-06-12T00:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245712",
    "user": "https://github.com/dwbump"
}
```

Replying to [comment:26 bump]:
> Replying to [comment:19 aschilling]:
> 
> > But in any case, someone should check!

> 
> I will check it.


I would if I could … I pulled the branch, built and can't run it it because of some problem with ascii_art. I'll make distclean and try again.

I'm a little worried that if the changes required replacing the inner product in weyl_dimension method there could also be failures in weyl_characters.py too which also depend on the same inner product.



---

archive/issue_comments_245713.json:
```json
{
    "body": "Replying to [comment:30 bump]:\n> Replying to [comment:26 bump]:\n> > Replying to [comment:19 aschilling]:\n> > \n> > > But in any case, someone should check!\n\n> > \n> > I will check it.\n\n> \n> I would if I could \u2026 I pulled the branch, built and can't run it it because of some problem with ascii_art. I'll make distclean and try again.\n\n\nStrange. It works for both myself and Ben.\n\n> I'm a little worried that if the changes required replacing the inner product in weyl_dimension method there could also be failures in weyl_characters.py too which also depend on the same inner product.\n\n\nThe only problem with it was that it only worked for the ambient space and we want it for all weight lattices. If that is not an issue for weyl_character, then it hopefully does not change anything there!",
    "created_at": "2015-06-12T13:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245713",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:30 bump]:
> Replying to [comment:26 bump]:
> > Replying to [comment:19 aschilling]:
> > 
> > > But in any case, someone should check!

> > 
> > I will check it.

> 
> I would if I could … I pulled the branch, built and can't run it it because of some problem with ascii_art. I'll make distclean and try again.


Strange. It works for both myself and Ben.

> I'm a little worried that if the changes required replacing the inner product in weyl_dimension method there could also be failures in weyl_characters.py too which also depend on the same inner product.


The only problem with it was that it only worked for the ambient space and we want it for all weight lattices. If that is not an issue for weyl_character, then it hopefully does not change anything there!



---

archive/issue_comments_245714.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-12T15:21:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245714",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245715.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-12T16:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245715",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245716.json:
```json
{
    "body": "In the last commit, `weight_lattice_realization()` for `DirectSumOfCrystals` was added, too.",
    "created_at": "2015-06-12T16:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245716",
    "user": "https://github.com/bsalisbury1"
}
```

In the last commit, `weight_lattice_realization()` for `DirectSumOfCrystals` was added, too.



---

archive/issue_comments_245717.json:
```json
{
    "body": "Also, original example is now fixed!\n\n```\nsage: C = crystals.infinity.NakajimaMonomials(['A',1,1])\nsage: v=C.highest_weight_vector()\nsage: v.f(1).weight()+v.f(0).weight()\n-delta\n```",
    "created_at": "2015-06-12T16:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245717",
    "user": "https://github.com/bsalisbury1"
}
```

Also, original example is now fixed!

```
sage: C = crystals.infinity.NakajimaMonomials(['A',1,1])
sage: v=C.highest_weight_vector()
sage: v.f(1).weight()+v.f(0).weight()
-delta
```



---

archive/issue_comments_245718.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-12T16:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245718",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245719.json:
```json
{
    "body": "There are doctest failures in non_symmetric_macdonald_polynomials.py. There are quite a few but for example:\n\n```\n\nFailed example:\n\u00a0\u00a0\u00a0 for d in range(1,2):\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 # long time (41s)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 for a,b,c,d in !IntegerVectors(d,4):\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 weight = a*La![1]+b*La![2]+c*La![3]+d*La![4]\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 weight0 = -a*omega![1]-b*omega![2]-c*omega![3]-d*omega![4]\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 LS = crystals.ProjectedLevelZeroLSPaths(weight)\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 assert E[weight0].map_coefficients(lambda !x:x.subs(t=0)) == LS.one_dimensional_configuration_sum(q)\nException raised:\n\u00a0\u00a0\u00a0 Traceback (most recent call last):\n\u00a0\u00a0\u00a0\u00a0\u00a0 File \"/home/bump/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 self.compile_and_execute(example, compiler, test.globs)\n\u00a0\u00a0\u00a0\u00a0\u00a0 File \"/home/bump/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 exec(compiled, globs)\n\u00a0\u00a0\u00a0\u00a0\u00a0 File \"<doctest sage.combinat.root_system.non_symmetric_macdonald_polynomials.!NonSymmetricMacdonaldPolynomials![201]>\", line 6, in <module>\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 assert E[weight0].map_coefficients(lambda !x:x.subs(t=Integer(0))) == LS.one_dimensional_configuration_sum(q)\n\u00a0\u00a0\u00a0 !AssertionError\n```",
    "created_at": "2015-06-12T16:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245719",
    "user": "https://github.com/dwbump"
}
```

There are doctest failures in non_symmetric_macdonald_polynomials.py. There are quite a few but for example:

```

Failed example:
    for d in range(1,2):                                  # long time (41s)
        for a,b,c,d in !IntegerVectors(d,4):
            weight = a*La![1]+b*La![2]+c*La![3]+d*La![4]
            weight0 = -a*omega![1]-b*omega![2]-c*omega![3]-d*omega![4]
            LS = crystals.ProjectedLevelZeroLSPaths(weight)
            assert E[weight0].map_coefficients(lambda !x:x.subs(t=0)) == LS.one_dimensional_configuration_sum(q)
Exception raised:
    Traceback (most recent call last):
      File "/home/bump/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/bump/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.root_system.non_symmetric_macdonald_polynomials.!NonSymmetricMacdonaldPolynomials![201]>", line 6, in <module>
        assert E[weight0].map_coefficients(lambda !x:x.subs(t=Integer(0))) == LS.one_dimensional_configuration_sum(q)
    !AssertionError
```



---

archive/issue_comments_245720.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-12T17:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245720",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245721.json:
```json
{
    "body": "Dan,\n\nI think you are not using the latest branch! Please pull again and then try again!\n\nAnne\n\n---\nNew commits:",
    "created_at": "2015-06-12T17:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245721",
    "user": "https://github.com/anneschilling"
}
```

Dan,

I think you are not using the latest branch! Please pull again and then try again!

Anne

---
New commits:



---

archive/issue_comments_245722.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-06-12T17:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245722",
    "user": "https://github.com/bsalisbury1"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_245723.json:
```json
{
    "body": "All tests passed on my and Anne's machine.  Travis' changes look good, too.  We think it's ready for review.  \n\nDan, would you mind reviewing the ticket?\n\nBest,\nBen",
    "created_at": "2015-06-12T17:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245723",
    "user": "https://github.com/bsalisbury1"
}
```

All tests passed on my and Anne's machine.  Travis' changes look good, too.  We think it's ready for review.  

Dan, would you mind reviewing the ticket?

Best,
Ben



---

archive/issue_comments_245724.json:
```json
{
    "body": "All tests pass with !`sage --testall`.\n\nI will look at it some more.",
    "created_at": "2015-06-12T22:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245724",
    "user": "https://github.com/dwbump"
}
```

All tests pass with !`sage --testall`.

I will look at it some more.



---

archive/issue_comments_245725.json:
```json
{
    "body": "From the thematic tutorial at http://doc.sagemath.org/html/en/thematic_tutorials/lie/affine_hw_crystals.html\nwe have:\n\n```\nsage: sage: La = RootSystem(['C',3,1]).weight_space().fundamental_weights()\nsage: sage: LS = crystals.LSPaths(2*La[1]+La[2])\nsage: sage: SL = LS.subcrystal(max_depth=3)\nsage: sage: GL = LS.digraph(subset=SL)\nsage: sage: La = RootSystem(['C',3,1]).weight_lattice().fundamental_weights()\nsage: sage: M = crystals.NakajimaMonomials(['C',3,1], 2*La[1]+La[2])\nsage: sage: SM = M.subcrystal(max_depth=3)\nsage: sage: GM = M.digraph(subset=SM)\nsage: sage: GL.is_isomorphic(GM, edge_labels=True)\nTrue\n```\n\nWhy do we use weight_space for one and weight_lattice for the other? (Maybe the thematic tutorial should explain.)\n\nAfter this:\n\n```\nsage: LS.weight_lattice_realization().is_extended()\nFalse\nsage: M.weight_lattice_realization().is_extended()\nTrue\n```\n\nI think the point of the example in the tutorial is that the two crystals are isomorphic, but one uses the extended lattice and the other does not.\n\nI think that the user should be encouraged to use extended lattice for crystals of integrable representations of affine Lie algebras and therefore the example in the thematic tutorial should be changed. The tutorial goes on and shows another affine crystal in the Littelmann path model that does use the extended lattice. I think the patch is good but it would be good if some revisions to the above page in the thematic tutorial are made. Here are some suggestions for change to the tutorial that could be part of this patch.\n\n(1) Change the first example to use the extended lattice unless there is a reason not to.\n(2) Tell the user just a bit more about the issue. The following is my understanding: roughly, the extended lattice is the weight lattice of the full Kac-Moody Lie algebra and the unextended lattice is the weight lattice of the derived algebra.  If the highest weight is a nonzero dominant weight then the crystal is infinite and it is preferrable to use the extended lattice. These are the crystals of integrable representations. A contrasting situation is with Kirillov-Reshetikhin crystals where there is an advantage to working with the unextended lattice, namely that the derived algebra has a finite dimensional crystal where the full Kac-Moody Lie algebra has an infinite one. So there is an advantage in this case to using the derived Lie algebra and its weight lattice is the unextended one.\n(3) Explain why we use weight_space in the LS path model but weight_lattice in the monomial model.",
    "created_at": "2015-06-13T04:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245725",
    "user": "https://github.com/dwbump"
}
```

From the thematic tutorial at http://doc.sagemath.org/html/en/thematic_tutorials/lie/affine_hw_crystals.html
we have:

```
sage: sage: La = RootSystem(['C',3,1]).weight_space().fundamental_weights()
sage: sage: LS = crystals.LSPaths(2*La[1]+La[2])
sage: sage: SL = LS.subcrystal(max_depth=3)
sage: sage: GL = LS.digraph(subset=SL)
sage: sage: La = RootSystem(['C',3,1]).weight_lattice().fundamental_weights()
sage: sage: M = crystals.NakajimaMonomials(['C',3,1], 2*La[1]+La[2])
sage: sage: SM = M.subcrystal(max_depth=3)
sage: sage: GM = M.digraph(subset=SM)
sage: sage: GL.is_isomorphic(GM, edge_labels=True)
True
```

Why do we use weight_space for one and weight_lattice for the other? (Maybe the thematic tutorial should explain.)

After this:

```
sage: LS.weight_lattice_realization().is_extended()
False
sage: M.weight_lattice_realization().is_extended()
True
```

I think the point of the example in the tutorial is that the two crystals are isomorphic, but one uses the extended lattice and the other does not.

I think that the user should be encouraged to use extended lattice for crystals of integrable representations of affine Lie algebras and therefore the example in the thematic tutorial should be changed. The tutorial goes on and shows another affine crystal in the Littelmann path model that does use the extended lattice. I think the patch is good but it would be good if some revisions to the above page in the thematic tutorial are made. Here are some suggestions for change to the tutorial that could be part of this patch.

(1) Change the first example to use the extended lattice unless there is a reason not to.
(2) Tell the user just a bit more about the issue. The following is my understanding: roughly, the extended lattice is the weight lattice of the full Kac-Moody Lie algebra and the unextended lattice is the weight lattice of the derived algebra.  If the highest weight is a nonzero dominant weight then the crystal is infinite and it is preferrable to use the extended lattice. These are the crystals of integrable representations. A contrasting situation is with Kirillov-Reshetikhin crystals where there is an advantage to working with the unextended lattice, namely that the derived algebra has a finite dimensional crystal where the full Kac-Moody Lie algebra has an infinite one. So there is an advantage in this case to using the derived Lie algebra and its weight lattice is the unextended one.
(3) Explain why we use weight_space in the LS path model but weight_lattice in the monomial model.



---

archive/issue_comments_245726.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-13T23:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245726",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245727.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-14T00:39:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245727",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245728.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-14T00:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245728",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245729.json:
```json
{
    "body": "Hi Dan,\n\nGood points! I fixed the examples in the thematic tutorial (and also the picture since it was missing the deltas as well) and put some extra explanations.\n\nAnne\n\nPS: I also rebased on top of sage-6.5.beta4.",
    "created_at": "2015-06-14T00:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245729",
    "user": "https://github.com/anneschilling"
}
```

Hi Dan,

Good points! I fixed the examples in the thematic tutorial (and also the picture since it was missing the deltas as well) and put some extra explanations.

Anne

PS: I also rebased on top of sage-6.5.beta4.



---

archive/issue_comments_245730.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-14T03:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245730",
    "user": "https://github.com/dwbump"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_245731.json:
```json
{
    "body": "I gave this a positive review. Here is a (temporary) link to the revised tutorial.\n\nhttp://match.stanford.edu/thematic_tutorials/lie.html\n\nI am currently unable to run tests for some reason, but I ran sage -testall before the rebase.",
    "created_at": "2015-06-14T04:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245731",
    "user": "https://github.com/dwbump"
}
```

I gave this a positive review. Here is a (temporary) link to the revised tutorial.

http://match.stanford.edu/thematic_tutorials/lie.html

I am currently unable to run tests for some reason, but I ran sage -testall before the rebase.



---

archive/issue_comments_245732.json:
```json
{
    "body": "```\nsage -t --long src/sage/combinat/crystals/littelmann_path.py  # 3 doctests failed\nsage -t --long src/sage/combinat/crystals/tensor_product.py  # 1 doctest failed\nsage -t --long src/sage/combinat/root_system/non_symmetric_macdonald_polynomials.py  # 10 doctests failed\n```",
    "created_at": "2015-06-14T14:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245732",
    "user": "https://github.com/vbraun"
}
```

```
sage -t --long src/sage/combinat/crystals/littelmann_path.py  # 3 doctests failed
sage -t --long src/sage/combinat/crystals/tensor_product.py  # 1 doctest failed
sage -t --long src/sage/combinat/root_system/non_symmetric_macdonald_polynomials.py  # 10 doctests failed
```



---

archive/issue_comments_245733.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-06-14T14:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245733",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_245734.json:
```json
{
    "body": "Here's the problem:\n\n```\nsage: La = RootSystem(['A',2,1]).weight_space().basis()\nsage: LS = crystals.ProjectedLevelZeroLSPaths(2*La[1])\nsage: LS.weight_lattice_realization()\nWeight space over the Rational Field of the Root system of type ['A', 2, 1]\nsage: CS = LS.one_dimensional_configuration_sum()\nsage: CS\nB[-2*Lambda[1] + 2*Lambda[2]] + (q+1)*B[-Lambda[1]] + (q+1)*B[Lambda[1] - Lambda[2]] + B[2*Lambda[1]] + B[-2*Lambda[2]] + (q+1)*B[Lambda[2]]\nsage: K = crystals.KirillovReshetikhin(['A',2,1], 1,1)\nsage: T = K.tensor(K)\nsage: CSK = T.one_dimensional_configuration_sum()\nsage: CSK\nB[-2*Lambda[1] + 2*Lambda[2]] + (q+1)*B[-Lambda[1]] + (q+1)*B[Lambda[1] - Lambda[2]] + B[2*Lambda[1]] + B[-2*Lambda[2]] + (q+1)*B[Lambda[2]]\nsage: CS == CSK\nFalse\nsage: CS.parent()\nGroup algebra of the Weight space over the Rational Field of the Root system of type ['A', 2] over Univariate Polynomial Ring in q over Rational Field\nsage: CSK.parent()\nGroup algebra of the Weight lattice of the Root system of type ['A', 2] over Univariate Polynomial Ring in q over Rational Field\nsage: CS.parent().has_coerce_map_from(CSK.parent())\nFalse\n```\nThe group algebra, by its functoriality, should have a coercion when the underlying groups have a coercion:\n\n```\nsage: CS.parent()._indices.has_coerce_map_from(CSK.parent()._indices)\nTrue\n```\nThis is now #18700.",
    "created_at": "2015-06-14T15:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245734",
    "user": "https://github.com/tscrim"
}
```

Here's the problem:

```
sage: La = RootSystem(['A',2,1]).weight_space().basis()
sage: LS = crystals.ProjectedLevelZeroLSPaths(2*La[1])
sage: LS.weight_lattice_realization()
Weight space over the Rational Field of the Root system of type ['A', 2, 1]
sage: CS = LS.one_dimensional_configuration_sum()
sage: CS
B[-2*Lambda[1] + 2*Lambda[2]] + (q+1)*B[-Lambda[1]] + (q+1)*B[Lambda[1] - Lambda[2]] + B[2*Lambda[1]] + B[-2*Lambda[2]] + (q+1)*B[Lambda[2]]
sage: K = crystals.KirillovReshetikhin(['A',2,1], 1,1)
sage: T = K.tensor(K)
sage: CSK = T.one_dimensional_configuration_sum()
sage: CSK
B[-2*Lambda[1] + 2*Lambda[2]] + (q+1)*B[-Lambda[1]] + (q+1)*B[Lambda[1] - Lambda[2]] + B[2*Lambda[1]] + B[-2*Lambda[2]] + (q+1)*B[Lambda[2]]
sage: CS == CSK
False
sage: CS.parent()
Group algebra of the Weight space over the Rational Field of the Root system of type ['A', 2] over Univariate Polynomial Ring in q over Rational Field
sage: CSK.parent()
Group algebra of the Weight lattice of the Root system of type ['A', 2] over Univariate Polynomial Ring in q over Rational Field
sage: CS.parent().has_coerce_map_from(CSK.parent())
False
```
The group algebra, by its functoriality, should have a coercion when the underlying groups have a coercion:

```
sage: CS.parent()._indices.has_coerce_map_from(CSK.parent()._indices)
True
```
This is now #18700.



---

archive/issue_comments_245735.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-14T15:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245735",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245736.json:
```json
{
    "body": "The problem is that the weight are now in the weight space rather than the weight lattice. I fixed this in one dimensional configuration sums directly, so we do not need 18700.",
    "created_at": "2015-06-14T15:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245736",
    "user": "https://github.com/anneschilling"
}
```

The problem is that the weight are now in the weight space rather than the weight lattice. I fixed this in one dimensional configuration sums directly, so we do not need 18700.



---

archive/issue_comments_245737.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-14T15:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245737",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_245738.json:
```json
{
    "body": "I ran doctests again in /combinat and /categories and did not have any failures after Anne's changes.  In particular:\n\n```\nsage -t --warn-long 69.0 src/sage/combinat/crystals/littelmann_path.py\n    [242 tests, 5.61 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 5.7 seconds\n    cpu time: 5.6 seconds\n    cumulative wall time: 5.6 seconds\nBenBook:sage-git Ben$ sage -tp src/sage/combinat/crystals/littelmann_path.py \nRunning doctests with ID 2015-06-14-12-03-41-3453f2af.\nGit branch: t/18453/public/crystal/18453\nUsing --optional=gcc,mpir,python2,sage,scons\nDoctesting 1 file using 8 threads.\nsage -t --warn-long 68.9 src/sage/combinat/crystals/littelmann_path.py\n    [242 tests, 5.26 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 5.3 seconds\n    cpu time: 5.3 seconds\n    cumulative wall time: 5.3 seconds\nBenBook:sage-git Ben$ sage -tp src/sage/combinat/crystals/tensor_product.py \nRunning doctests with ID 2015-06-14-12-08-45-ab879d56.\nGit branch: t/18453/public/crystal/18453\nUsing --optional=gcc,mpir,python2,sage,scons\nDoctesting 1 file using 8 threads.\nsage -t --warn-long 69.0 src/sage/combinat/crystals/tensor_product.py\n    [439 tests, 2.39 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 2.5 seconds\n    cpu time: 2.4 seconds\n    cumulative wall time: 2.4 seconds\nBenBook:sage-git Ben$ sage -tp src/sage/combinat/root_system/non_symmetric_macdonald_polynomials.py \nRunning doctests with ID 2015-06-14-12-04-16-dbb764b5.\nGit branch: t/18453/public/crystal/18453\nUsing --optional=gcc,mpir,python2,sage,scons\nDoctesting 1 file using 8 threads.\nsage -t --warn-long 68.9 src/sage/combinat/root_system/non_symmetric_macdonald_polynomials.py\n    [533 tests, 8.01 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 8.1 seconds\n    cpu time: 7.9 seconds\n    cumulative wall time: 8.0 seconds\n```",
    "created_at": "2015-06-14T16:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245738",
    "user": "https://github.com/bsalisbury1"
}
```

I ran doctests again in /combinat and /categories and did not have any failures after Anne's changes.  In particular:

```
sage -t --warn-long 69.0 src/sage/combinat/crystals/littelmann_path.py
    [242 tests, 5.61 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 5.7 seconds
    cpu time: 5.6 seconds
    cumulative wall time: 5.6 seconds
BenBook:sage-git Ben$ sage -tp src/sage/combinat/crystals/littelmann_path.py 
Running doctests with ID 2015-06-14-12-03-41-3453f2af.
Git branch: t/18453/public/crystal/18453
Using --optional=gcc,mpir,python2,sage,scons
Doctesting 1 file using 8 threads.
sage -t --warn-long 68.9 src/sage/combinat/crystals/littelmann_path.py
    [242 tests, 5.26 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 5.3 seconds
    cpu time: 5.3 seconds
    cumulative wall time: 5.3 seconds
BenBook:sage-git Ben$ sage -tp src/sage/combinat/crystals/tensor_product.py 
Running doctests with ID 2015-06-14-12-08-45-ab879d56.
Git branch: t/18453/public/crystal/18453
Using --optional=gcc,mpir,python2,sage,scons
Doctesting 1 file using 8 threads.
sage -t --warn-long 69.0 src/sage/combinat/crystals/tensor_product.py
    [439 tests, 2.39 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 2.5 seconds
    cpu time: 2.4 seconds
    cumulative wall time: 2.4 seconds
BenBook:sage-git Ben$ sage -tp src/sage/combinat/root_system/non_symmetric_macdonald_polynomials.py 
Running doctests with ID 2015-06-14-12-04-16-dbb764b5.
Git branch: t/18453/public/crystal/18453
Using --optional=gcc,mpir,python2,sage,scons
Doctesting 1 file using 8 threads.
sage -t --warn-long 68.9 src/sage/combinat/root_system/non_symmetric_macdonald_polynomials.py
    [533 tests, 8.01 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 8.1 seconds
    cpu time: 7.9 seconds
    cumulative wall time: 8.0 seconds
```



---

archive/issue_comments_245739.json:
```json
{
    "body": "These tests are marked `# long time`, so you need to run them with the `--long` option (`--warn-long` just notifies you if a test took over a certain time (the default being 1 second)).",
    "created_at": "2015-06-14T17:13:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245739",
    "user": "https://github.com/tscrim"
}
```

These tests are marked `# long time`, so you need to run them with the `--long` option (`--warn-long` just notifies you if a test took over a certain time (the default being 1 second)).



---

archive/issue_comments_245740.json:
```json
{
    "body": "Thanks, Travis.  Here is the updated proof of passed tests:\n\n```\nBenBook:sage-git Ben$ sage -tp --long src/sage/combinat/crystals/littelmann_path.py \nRunning doctests with ID 2015-06-14-13-18-12-ce4dd0f9.\nGit branch: t/18453/public/crystal/18453\nUsing --optional=gcc,mpir,python2,sage,scons\nDoctesting 1 file using 8 threads.\nsage -t --long --warn-long 69.0 src/sage/combinat/crystals/littelmann_path.py\n    [254 tests, 31.08 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 31.2 seconds\n    cpu time: 31.0 seconds\n    cumulative wall time: 31.1 seconds\nBenBook:sage-git Ben$ sage -tp --long src/sage/combinat/crystals/tensor_product.py \nRunning doctests with ID 2015-06-14-13-19-01-4e6d8c8e.\nGit branch: t/18453/public/crystal/18453\nUsing --optional=gcc,mpir,python2,sage,scons\nDoctesting 1 file using 8 threads.\nsage -t --long --warn-long 69.1 src/sage/combinat/crystals/tensor_product.py\n    [441 tests, 3.40 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 3.5 seconds\n    cpu time: 3.4 seconds\n    cumulative wall time: 3.4 seconds\nBenBook:sage-git Ben$ sage -tp --long src/sage/combinat/root_system/non_symmetric_macdonald_polynomials.py \nRunning doctests with ID 2015-06-14-13-19-21-7bd8f158.\nGit branch: t/18453/public/crystal/18453\nUsing --optional=gcc,mpir,python2,sage,scons\nDoctesting 1 file using 8 threads.\nsage -t --long --warn-long 69.1 src/sage/combinat/root_system/non_symmetric_macdonald_polynomials.py\n**********************************************************************\nFile \"src/sage/combinat/root_system/non_symmetric_macdonald_polynomials.py\", line 695, in sage.combinat.root_system.non_symmetric_macdonald_polynomials.NonSymmetricMacdonaldPolynomials\nWarning, slow doctest:\n    E[-2*omega[1]-omega[2]].map_coefficients(lambda x:x.subs(t=0)) == LS.one_dimensional_configuration_sum(q) # long time\nTest ran for 84.13 s\n    [562 tests, 149.57 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 149.7 seconds\n    cpu time: 149.4 seconds\n    cumulative wall time: 149.6 seconds\n```",
    "created_at": "2015-06-14T18:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245740",
    "user": "https://github.com/bsalisbury1"
}
```

Thanks, Travis.  Here is the updated proof of passed tests:

```
BenBook:sage-git Ben$ sage -tp --long src/sage/combinat/crystals/littelmann_path.py 
Running doctests with ID 2015-06-14-13-18-12-ce4dd0f9.
Git branch: t/18453/public/crystal/18453
Using --optional=gcc,mpir,python2,sage,scons
Doctesting 1 file using 8 threads.
sage -t --long --warn-long 69.0 src/sage/combinat/crystals/littelmann_path.py
    [254 tests, 31.08 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 31.2 seconds
    cpu time: 31.0 seconds
    cumulative wall time: 31.1 seconds
BenBook:sage-git Ben$ sage -tp --long src/sage/combinat/crystals/tensor_product.py 
Running doctests with ID 2015-06-14-13-19-01-4e6d8c8e.
Git branch: t/18453/public/crystal/18453
Using --optional=gcc,mpir,python2,sage,scons
Doctesting 1 file using 8 threads.
sage -t --long --warn-long 69.1 src/sage/combinat/crystals/tensor_product.py
    [441 tests, 3.40 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 3.5 seconds
    cpu time: 3.4 seconds
    cumulative wall time: 3.4 seconds
BenBook:sage-git Ben$ sage -tp --long src/sage/combinat/root_system/non_symmetric_macdonald_polynomials.py 
Running doctests with ID 2015-06-14-13-19-21-7bd8f158.
Git branch: t/18453/public/crystal/18453
Using --optional=gcc,mpir,python2,sage,scons
Doctesting 1 file using 8 threads.
sage -t --long --warn-long 69.1 src/sage/combinat/root_system/non_symmetric_macdonald_polynomials.py
**********************************************************************
File "src/sage/combinat/root_system/non_symmetric_macdonald_polynomials.py", line 695, in sage.combinat.root_system.non_symmetric_macdonald_polynomials.NonSymmetricMacdonaldPolynomials
Warning, slow doctest:
    E[-2*omega[1]-omega[2]].map_coefficients(lambda x:x.subs(t=0)) == LS.one_dimensional_configuration_sum(q) # long time
Test ran for 84.13 s
    [562 tests, 149.57 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 149.7 seconds
    cpu time: 149.4 seconds
    cumulative wall time: 149.6 seconds
```



---

archive/issue_comments_245741.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-15T05:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245741",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_245742.json:
```json
{
    "body": "This change is okay.",
    "created_at": "2015-06-15T05:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245742",
    "user": "https://github.com/tscrim"
}
```

This change is okay.



---

archive/issue_comments_245743.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-15T21:56:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245743",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_051950.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-06-15T21:56:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18216#event-51950"
}
```



---

archive/issue_comments_245744.json:
```json
{
    "body": "Replying to [comment:19 aschilling]:\n> Replying to [comment:17 nthiery]:\n> > Replying to [comment:8 aschilling]:\n> > > I had to fix the Weyl dimension formula (which I guess was written by Nicolas and only worked in the ambient space).\n\n> > \n> > By Dan, if I recall correctly.\n\n> \n> {{{\n> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  859)         def weyl_dimension(self, highest_weight):\n> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  860)             \"\"\"\n> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  861)             EXAMPLES::\n> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  862) \n> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  863)                 sage: RootSystem(['A',3]).ambient_lattice().weyl_dimension([2,1,0,0])\n> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  864)                 20\n> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  865) \n> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  866)                 sage: type(RootSystem(['A',3]).ambient_lattice().weyl_dimension([2,1,0,0]))\n> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  867)                 <type 'sage.rings.integer.Integer'>\n> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  868)             \"\"\"\n> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  869)             highest_weight = self(highest_weight)\n> f562ca2b (Travis Scrimshaw  2014-10-01 17:16:31 -0700  870)             if not highest_weight.is_dominant():\n> f562ca2b (Travis Scrimshaw  2014-10-01 17:16:31 -0700  871)                 raise ValueError(\"the highest weight must be dominant\")\n> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  872)             rho = self.rho()\n> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  873)             n = prod([(rho+highest_weight).dot_product(x) for x in self.positive_roots()])\n> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  874)             d = prod([ rho.dot_product(x) for x in self.positive_roots()])\n> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  875)             from sage.rings.integer import Integer\n> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  876)             return Integer(n/d)\n> }}}\n\n\nThis got me curious about my memory failing. Digging back in history ended up in a mercurial patch from early 2008 from which one can't extract the author. As far as I remember, I refactored this code at different occasions (in the above to move it from\nweight_lattice_realization to weight_lattice_realizations when\ncreating the categories), but the original code was by Dan in the `WeylDim` function. Anyway just ranting this has no relevance.",
    "created_at": "2015-06-17T17:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245744",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:19 aschilling]:
> Replying to [comment:17 nthiery]:
> > Replying to [comment:8 aschilling]:
> > > I had to fix the Weyl dimension formula (which I guess was written by Nicolas and only worked in the ambient space).

> > 
> > By Dan, if I recall correctly.

> 
> {{{
> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  859)         def weyl_dimension(self, highest_weight):
> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  860)             """
> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  861)             EXAMPLES::
> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  862) 
> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  863)                 sage: RootSystem(['A',3]).ambient_lattice().weyl_dimension([2,1,0,0])
> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  864)                 20
> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  865) 
> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  866)                 sage: type(RootSystem(['A',3]).ambient_lattice().weyl_dimension([2,1,0,0]))
> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  867)                 <type 'sage.rings.integer.Integer'>
> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  868)             """
> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  869)             highest_weight = self(highest_weight)
> f562ca2b (Travis Scrimshaw  2014-10-01 17:16:31 -0700  870)             if not highest_weight.is_dominant():
> f562ca2b (Travis Scrimshaw  2014-10-01 17:16:31 -0700  871)                 raise ValueError("the highest weight must be dominant")
> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  872)             rho = self.rho()
> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  873)             n = prod([(rho+highest_weight).dot_product(x) for x in self.positive_roots()])
> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  874)             d = prod([ rho.dot_product(x) for x in self.positive_roots()])
> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  875)             from sage.rings.integer import Integer
> 7d693534 (Nicolas M. Thiery 2012-03-19 21:38:26 +0100  876)             return Integer(n/d)
> }}}


This got me curious about my memory failing. Digging back in history ended up in a mercurial patch from early 2008 from which one can't extract the author. As far as I remember, I refactored this code at different occasions (in the above to move it from
weight_lattice_realization to weight_lattice_realizations when
creating the categories), but the original code was by Dan in the `WeylDim` function. Anyway just ranting this has no relevance.



---

archive/issue_comments_245745.json:
```json
{
    "body": "This agrees with my recollection.\n\n> As far as I remember, I refactored this code at different occasions (in the above to move it from weight_lattice_realization to weight_lattice_realizations when creating the categories), but the original code was by Dan in the WeylDim function.",
    "created_at": "2015-06-29T14:01:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18216#issuecomment-245745",
    "user": "https://github.com/dwbump"
}
```

This agrees with my recollection.

> As far as I remember, I refactored this code at different occasions (in the above to move it from weight_lattice_realization to weight_lattice_realizations when creating the categories), but the original code was by Dan in the WeylDim function.
