# Issue 21956: Port cypari2 documentation as a standalone doctests

archive/issues_021956.json:
```json
{
    "body": "CC:  defeo jdemeyer\n\nSince cypari2 is aimed to become an external module we should move the doctest of its documentation in a standalone file.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22193\n\n",
    "created_at": "2017-01-16T18:39:02Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Port cypari2 documentation as a standalone doctests",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21956",
    "user": "vdelecroix"
}
```
CC:  defeo jdemeyer

Since cypari2 is aimed to become an external module we should move the doctest of its documentation in a standalone file.

Issue created by migration from https://trac.sagemath.org/ticket/22193





---

archive/issue_comments_305233.json:
```json
{
    "body": "We already have `src/sage/libs/pari/tests.py`. That would be a good place to put those tests.",
    "created_at": "2017-01-17T09:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305233",
    "user": "jdemeyer"
}
```

We already have `src/sage/libs/pari/tests.py`. That would be a good place to put those tests.



---

archive/issue_comments_305234.json:
```json
{
    "body": "doing that...",
    "created_at": "2017-01-17T10:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305234",
    "user": "vdelecroix"
}
```

doing that...



---

archive/issue_comments_305235.json:
```json
{
    "body": "Attachment [pari_doctests.py](tarball://root/attachments/some-uuid/ticket22193/pari_doctests.py) by vdelecroix created at 2017-01-17 18:14:55\n\nI joined the script I used to generate the files.",
    "created_at": "2017-01-17T18:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305235",
    "user": "vdelecroix"
}
```

Attachment [pari_doctests.py](tarball://root/attachments/some-uuid/ticket22193/pari_doctests.py) by vdelecroix created at 2017-01-17 18:14:55

I joined the script I used to generate the files.



---

archive/issue_comments_305236.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-01-17T18:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305236",
    "user": "vdelecroix"
}
```

New commits:



---

archive/issue_comments_305237.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-01-17T18:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305237",
    "user": "vdelecroix"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_305238.json:
```json
{
    "body": "I don't really like that this is automatic. I think we should manually figure out which doctests should be kept in cypari2 and which ones should be moved to Sage.",
    "created_at": "2017-01-18T17:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305238",
    "user": "jdemeyer"
}
```

I don't really like that this is automatic. I think we should manually figure out which doctests should be kept in cypari2 and which ones should be moved to Sage.



---

archive/issue_comments_305239.json:
```json
{
    "body": "I think that the tests in `convert.pyx` don't really involve Sage at all (except for the preparser, so `2^64` should be changed to `2**64` for example).",
    "created_at": "2017-01-18T17:35:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305239",
    "user": "jdemeyer"
}
```

I think that the tests in `convert.pyx` don't really involve Sage at all (except for the preparser, so `2^64` should be changed to `2**64` for example).



---

archive/issue_comments_305240.json:
```json
{
    "body": "What's the status of this? Anyone working on it?",
    "created_at": "2017-02-03T16:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305240",
    "user": "defeo"
}
```

What's the status of this? Anyone working on it?



---

archive/issue_comments_305241.json:
```json
{
    "body": "It's been extremely painful, but I've manually gone through all docstrings. As Jeroen suspected, very few of them were Sage-specific, but most of them needed to be de-Saged.\n\nI moved the few Sage-specific tests to `test.py`, and also duplicated there some tests that could have been done entirely in CyPari2, but that used to activate some code-paths in Sage that wouldn't be activated otherwise.\n\nThere's two notable bits of docstring I haven't touched yet:\n\n1. The \"Guide to real precision\" in the module docstring of `pari_instance.pyx`. This is very Sage-specific, and it's more than just a testsuite. Where shall we move it?\n\n2. The `Gen.sage()`, which of course has no place in CyPari. Did we decide anything on subclassing `Gen`, though?\n\nFor the rest, I hopefully changed all `^` to `**` at the right spots, and removed all dependencies on Sage (except for the `sage:` prompt and the import statements). If I forgot something, we will notice anyway when setting up tests outside of Sage. I also fear that some doctests may fail in Python3, but that should also be easy to fix.\n\nIn my doctest trip, I saw a lot of very archaic code, esp. in the number field and the elliptic curve methods. For example `nfbasis` has a very weird docstring, and takes a flag parameter that seems to be undocumented in PARI.\n----\nNew commits:",
    "created_at": "2017-02-06T22:00:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305241",
    "user": "defeo"
}
```

It's been extremely painful, but I've manually gone through all docstrings. As Jeroen suspected, very few of them were Sage-specific, but most of them needed to be de-Saged.

I moved the few Sage-specific tests to `test.py`, and also duplicated there some tests that could have been done entirely in CyPari2, but that used to activate some code-paths in Sage that wouldn't be activated otherwise.

There's two notable bits of docstring I haven't touched yet:

1. The "Guide to real precision" in the module docstring of `pari_instance.pyx`. This is very Sage-specific, and it's more than just a testsuite. Where shall we move it?

2. The `Gen.sage()`, which of course has no place in CyPari. Did we decide anything on subclassing `Gen`, though?

For the rest, I hopefully changed all `^` to `**` at the right spots, and removed all dependencies on Sage (except for the `sage:` prompt and the import statements). If I forgot something, we will notice anyway when setting up tests outside of Sage. I also fear that some doctests may fail in Python3, but that should also be easy to fix.

In my doctest trip, I saw a lot of very archaic code, esp. in the number field and the elliptic curve methods. For example `nfbasis` has a very weird docstring, and takes a flag parameter that seems to be undocumented in PARI.
----
New commits:



---

archive/issue_comments_305242.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-06T22:00:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305242",
    "user": "defeo"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_305243.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-08T18:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305243",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305244.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-08T18:18:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305244",
    "user": "defeo"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_305245.json:
```json
{
    "body": "Just had a quick look and it looks good on first sight. I need to check a bit better in order to give positive_review though.\n\nDoes the documentation from `src/sage/libs/pari/__init__.py` actually appear anywhere?",
    "created_at": "2017-02-08T19:52:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305245",
    "user": "jdemeyer"
}
```

Just had a quick look and it looks good on first sight. I need to check a bit better in order to give positive_review though.

Does the documentation from `src/sage/libs/pari/__init__.py` actually appear anywhere?



---

archive/issue_comments_305246.json:
```json
{
    "body": "> Does the documentation from `src/sage/libs/pari/__init__.py` actually appear anywhere?\n\nI don't think so, but all documentation from `cypari2` seems to have disappeared from the reference manual anyway. I thought that was a deliberate choice?",
    "created_at": "2017-02-08T22:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305246",
    "user": "defeo"
}
```

> Does the documentation from `src/sage/libs/pari/__init__.py` actually appear anywhere?

I don't think so, but all documentation from `cypari2` seems to have disappeared from the reference manual anyway. I thought that was a deliberate choice?



---

archive/issue_comments_305247.json:
```json
{
    "body": "Please rebase to 7.6.beta3",
    "created_at": "2017-02-09T08:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305247",
    "user": "jdemeyer"
}
```

Please rebase to 7.6.beta3



---

archive/issue_comments_305248.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-09T08:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305248",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_305249.json:
```json
{
    "body": "Replying to [comment:14 defeo]:\n> all documentation from `cypari2` seems to have disappeared from the reference manual anyway.\n\nThe code for `src/sage/libs/cypari2` will be removed from Sage anyway, so I don't consider it a problem that the doc is not in Sage anymore.\n\nHowever, the doc for `src/sage/libs/pari` should remain in Sage. It is currently not.",
    "created_at": "2017-02-09T08:41:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305249",
    "user": "jdemeyer"
}
```

Replying to [comment:14 defeo]:
> all documentation from `cypari2` seems to have disappeared from the reference manual anyway.

The code for `src/sage/libs/cypari2` will be removed from Sage anyway, so I don't consider it a problem that the doc is not in Sage anymore.

However, the doc for `src/sage/libs/pari` should remain in Sage. It is currently not.



---

archive/issue_comments_305250.json:
```json
{
    "body": "Rebased (and fixed a typo in the commit message).\n----\nNew commits:",
    "created_at": "2017-02-09T11:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305250",
    "user": "jdemeyer"
}
```

Rebased (and fixed a typo in the commit message).
----
New commits:



---

archive/issue_comments_305251.json:
```json
{
    "body": "I'm having a look at the documentation right now.",
    "created_at": "2017-02-09T11:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305251",
    "user": "jdemeyer"
}
```

I'm having a look at the documentation right now.



---

archive/issue_comments_305252.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-09T15:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305252",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305253.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-09T15:32:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305253",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_305254.json:
```json
{
    "body": "Thanks for the rebase.\n\nWe could improve the documentation of `sage.libs.pari`, but that's probably best kept for another ticket.",
    "created_at": "2017-02-09T17:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305254",
    "user": "defeo"
}
```

Thanks for the rebase.

We could improve the documentation of `sage.libs.pari`, but that's probably best kept for another ticket.



---

archive/issue_comments_305255.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-09T17:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305255",
    "user": "defeo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_305256.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-02-10T08:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305256",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_305257.json:
```json
{
    "body": "Some details...\n\n1. You forgot to remove one `int()` here:\n\n```\nsage: int(2) ** pari(-5)\n```\n\n\n2. Why did you remove this?\n\n```\nsage: bnr = pari(\"K = bnfinit(x^4 - 4*x^2 + 1); bnrinit(K, 2*x)\")\nsage: bnr.nf_get_pol()\n```\n\n\n3. This sentence is no longer relevant:\n\n```\nHowever, beware that ``pari(L)`` returns an absolute number field::\n```\n\n\n4. This is a significant change:\n\n```\n-            sage: two = RealField(256)(2)._pari_()\n+            sage: two = pari(2)\n```\n\nInstead, you could use\n\n```\ntwo = pari(\"2.0000000000000000000000000000000000000000000000000000000000000000000000000000\")\n```\n\n\n5. This is confusing since the `5/3` is not the fraction 5/3 in Python!\n\n```\nsage: pari([-1, 5/3, -8.0]).vecmin()\n```\n\nYou could keep the original test with quotes: `pari(\"[1, -5/3, 8.0]\").vecmin()`",
    "created_at": "2017-02-10T08:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305257",
    "user": "jdemeyer"
}
```

Some details...

1. You forgot to remove one `int()` here:

```
sage: int(2) ** pari(-5)
```


2. Why did you remove this?

```
sage: bnr = pari("K = bnfinit(x^4 - 4*x^2 + 1); bnrinit(K, 2*x)")
sage: bnr.nf_get_pol()
```


3. This sentence is no longer relevant:

```
However, beware that ``pari(L)`` returns an absolute number field::
```


4. This is a significant change:

```
-            sage: two = RealField(256)(2)._pari_()
+            sage: two = pari(2)
```

Instead, you could use

```
two = pari("2.0000000000000000000000000000000000000000000000000000000000000000000000000000")
```


5. This is confusing since the `5/3` is not the fraction 5/3 in Python!

```
sage: pari([-1, 5/3, -8.0]).vecmin()
```

You could keep the original test with quotes: `pari("[1, -5/3, 8.0]").vecmin()`



---

archive/issue_comments_305258.json:
```json
{
    "body": "> 1. You forgot to remove one `int()` here:\n> {{{\n> sage: int(2) ** pari(-5)\n> }}}\n\nThis breaks in Sage, unless we positive review #22321. But I wanted to explore that ticket a bit more before setting it to needs review.\n\nOn the other hand, it doesn't hurt Python.\n\n> 2. Why did you remove this?\n> {{{\n> sage: bnr = pari(\"K = bnfinit(x^4 - 4*x^2 + 1); bnrinit(K, 2*x)\")\n> sage: bnr.nf_get_pol()\n> }}}\n\nI did not remove it. I changed it to\n\n\n```\nsage: x = pari('x')                                                                                                         \nsage: K = (x**4 - 4*x**2 + 1).nfinit()\nsage: K.nf_get_pol()                                                                                                        \n```\n\n\nwhich seems to be functionally equivalent and more concise. However, you know PARI better than me. If you think that's more appropriate, I can change it to\n \n\n```\nsage: x = pari('x')                                                                                                         \nsage: K = (x**4 - 4*x**2 + 1).bnfinit().bnrinit(2*x)                                                                        \nsage: K.nf_get_pol()                                                                                                        \n```\n",
    "created_at": "2017-02-10T15:06:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305258",
    "user": "defeo"
}
```

> 1. You forgot to remove one `int()` here:
> {{{
> sage: int(2) ** pari(-5)
> }}}

This breaks in Sage, unless we positive review #22321. But I wanted to explore that ticket a bit more before setting it to needs review.

On the other hand, it doesn't hurt Python.

> 2. Why did you remove this?
> {{{
> sage: bnr = pari("K = bnfinit(x^4 - 4*x^2 + 1); bnrinit(K, 2*x)")
> sage: bnr.nf_get_pol()
> }}}

I did not remove it. I changed it to


```
sage: x = pari('x')                                                                                                         
sage: K = (x**4 - 4*x**2 + 1).nfinit()
sage: K.nf_get_pol()                                                                                                        
```


which seems to be functionally equivalent and more concise. However, you know PARI better than me. If you think that's more appropriate, I can change it to
 

```
sage: x = pari('x')                                                                                                         
sage: K = (x**4 - 4*x**2 + 1).bnfinit().bnrinit(2*x)                                                                        
sage: K.nf_get_pol()                                                                                                        
```




---

archive/issue_comments_305259.json:
```json
{
    "body": "fixed the rest\n----\nNew commits:",
    "created_at": "2017-02-10T15:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305259",
    "user": "defeo"
}
```

fixed the rest
----
New commits:



---

archive/issue_comments_305260.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-10T15:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305260",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305261.json:
```json
{
    "body": "Replying to [comment:24 defeo]:\n> > 1. You forgot to remove one `int()` here:\n> > {{{\n> > sage: int(2) ** pari(-5)\n> > }}}\n> \n> This breaks in Sage, unless we positive review #22321.\n\nWait, no, I got confused: it just needs #22319, which is positive reviewed. Fixed now.",
    "created_at": "2017-02-10T15:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305261",
    "user": "defeo"
}
```

Replying to [comment:24 defeo]:
> > 1. You forgot to remove one `int()` here:
> > {{{
> > sage: int(2) ** pari(-5)
> > }}}
> 
> This breaks in Sage, unless we positive review #22321.

Wait, no, I got confused: it just needs #22319, which is positive reviewed. Fixed now.



---

archive/issue_comments_305262.json:
```json
{
    "body": "Replying to [comment:24 defeo]:\n> ... which seems to be functionally equivalent\n\nBut the `bnrinit()` call is gone, so it's clearly a different test.\n\nWhy not keep the original test? It should work as written in CyPari2.",
    "created_at": "2017-02-10T15:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305262",
    "user": "jdemeyer"
}
```

Replying to [comment:24 defeo]:
> ... which seems to be functionally equivalent

But the `bnrinit()` call is gone, so it's clearly a different test.

Why not keep the original test? It should work as written in CyPari2.



---

archive/issue_comments_305263.json:
```json
{
    "body": "Replying to [comment:29 jdemeyer]:\n> Replying to [comment:24 defeo]:\n> > ... which seems to be functionally equivalent\n> \n> But the `bnrinit()` call is gone, so it's clearly a different test.\n> \n> Why not keep the original test? It should work as written in CyPari2.\n\nBecause examples in the documentation should show the proper way to do things, not the ugly one.\n\nI admit I do not understand the reason for the call to `bnrinit()`, maybe you can elucidate.\n\nWe can put the old test in `TESTS::`, however, if you wish to keep it.",
    "created_at": "2017-02-10T15:56:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305263",
    "user": "defeo"
}
```

Replying to [comment:29 jdemeyer]:
> Replying to [comment:24 defeo]:
> > ... which seems to be functionally equivalent
> 
> But the `bnrinit()` call is gone, so it's clearly a different test.
> 
> Why not keep the original test? It should work as written in CyPari2.

Because examples in the documentation should show the proper way to do things, not the ugly one.

I admit I do not understand the reason for the call to `bnrinit()`, maybe you can elucidate.

We can put the old test in `TESTS::`, however, if you wish to keep it.



---

archive/issue_comments_305264.json:
```json
{
    "body": "Replying to [comment:30 defeo]:\n> I admit I do not understand the reason for the call to `bnrinit()`, maybe you can elucidate.\n\nIt shows that `nf_get_pol()` works when given a bnr (the output of `bnrinit()`) as input. So it is an important test which really should not be removed.",
    "created_at": "2017-02-10T16:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305264",
    "user": "jdemeyer"
}
```

Replying to [comment:30 defeo]:
> I admit I do not understand the reason for the call to `bnrinit()`, maybe you can elucidate.

It shows that `nf_get_pol()` works when given a bnr (the output of `bnrinit()`) as input. So it is an important test which really should not be removed.



---

archive/issue_comments_305265.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-10T16:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305265",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305266.json:
```json
{
    "body": "what about this?",
    "created_at": "2017-02-10T16:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305266",
    "user": "defeo"
}
```

what about this?



---

archive/issue_comments_305267.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-10T16:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305267",
    "user": "defeo"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_305268.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-11T09:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305268",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_305269.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-02-12T22:08:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305269",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_305270.json:
```json
{
    "body": "fails on 32-bit:\n\n```\nsage -t --long src/sage/libs/cypari2/pari_instance.pyx\n3569**********************************************************************\n3570File \"src/sage/libs/cypari2/pari_instance.pyx\", line 112, in sage.libs.cypari2.pari_instance\n3571Failed example:\n3572    pari(float(1.0)).sin(precision=180) - pari(1).sin(precision=180)\n3573Expected:\n3574    5.42101086242752 E-20\n3575Got:\n3576    5.42101086 E-20\n3577**********************************************************************\n35781 item had failures:\n3579   1 of  31 in sage.libs.cypari2.pari_instance\n3580    [151 tests, 1 failure, 0.33 s]\n```\n",
    "created_at": "2017-02-13T19:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305270",
    "user": "vbraun"
}
```

fails on 32-bit:

```
sage -t --long src/sage/libs/cypari2/pari_instance.pyx
3569**********************************************************************
3570File "src/sage/libs/cypari2/pari_instance.pyx", line 112, in sage.libs.cypari2.pari_instance
3571Failed example:
3572    pari(float(1.0)).sin(precision=180) - pari(1).sin(precision=180)
3573Expected:
3574    5.42101086242752 E-20
3575Got:
3576    5.42101086 E-20
3577**********************************************************************
35781 item had failures:
3579   1 of  31 in sage.libs.cypari2.pari_instance
3580    [151 tests, 1 failure, 0.33 s]
```




---

archive/issue_comments_305271.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2017-02-13T19:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305271",
    "user": "vbraun"
}
```

Changing status from closed to new.



---

archive/issue_comments_305272.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2017-02-13T19:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305272",
    "user": "vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_305273.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-02-15T11:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305273",
    "user": "defeo"
}
```

New commits:



---

archive/issue_comments_305274.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-15T11:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305274",
    "user": "defeo"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_305275.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-15T11:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305275",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_305276.json:
```json
{
    "body": "I think  it would be better to keep the spirit of the original examples instead of inventing a pointless example like `pari(float(1.0)).sin(precision=180) - pari(1).sin(precision=180) == 0`. Remember that these doctests are meant as *documentation* and I don't see what you are documenting there...",
    "created_at": "2017-02-15T11:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305276",
    "user": "jdemeyer"
}
```

I think  it would be better to keep the spirit of the original examples instead of inventing a pointless example like `pari(float(1.0)).sin(precision=180) - pari(1).sin(precision=180) == 0`. Remember that these doctests are meant as *documentation* and I don't see what you are documenting there...



---

archive/issue_comments_305277.json:
```json
{
    "body": "Replying to [comment:39 jdemeyer]:\n> I think  it would be better to keep the spirit of the original examples instead of inventing a pointless example like `pari(float(1.0)).sin(precision=180) - pari(1).sin(precision=180) == 0`. Remember that these doctests are meant as *documentation* and I don't see what you are documenting there...\n\nThe original documentation said\n\n\n```\nIn the third case, the precision is determined only by the inexact\ninputs and the ``precision`` argument is ignored::\n                                                  \n    sage: pari(1.0).sin(precision=180).sage()\n    0.841470984807896507\n    sage: pari(1.0).sin(precision=40).sage()\n    0.841470984807896507\n    sage: pari(RealField(100).one()).sin().sage()\n    0.84147098480789650665250232163029899962\n```\n\n\nwhich has no equivalent in CyPari. Would you find this clearer?\n\n\n```\n    sage: d = pari(float(1.0)).sin(precision=180); d\n    0.8414709848078965067\n    sage: d.bitprecision()                                 \n    64\n```\n\n\nHowever this test is also architecture dependent.",
    "created_at": "2017-02-15T12:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305277",
    "user": "defeo"
}
```

Replying to [comment:39 jdemeyer]:
> I think  it would be better to keep the spirit of the original examples instead of inventing a pointless example like `pari(float(1.0)).sin(precision=180) - pari(1).sin(precision=180) == 0`. Remember that these doctests are meant as *documentation* and I don't see what you are documenting there...

The original documentation said


```
In the third case, the precision is determined only by the inexact
inputs and the ``precision`` argument is ignored::
                                                  
    sage: pari(1.0).sin(precision=180).sage()
    0.841470984807896507
    sage: pari(1.0).sin(precision=40).sage()
    0.841470984807896507
    sage: pari(RealField(100).one()).sin().sage()
    0.84147098480789650665250232163029899962
```


which has no equivalent in CyPari. Would you find this clearer?


```
    sage: d = pari(float(1.0)).sin(precision=180); d
    0.8414709848078965067
    sage: d.bitprecision()                                 
    64
```


However this test is also architecture dependent.



---

archive/issue_comments_305278.json:
```json
{
    "body": "`@`jdemeyer ping?\n\nReplying to [comment:40 defeo]:\n> Replying to [comment:39 jdemeyer]:\n> Would you find this clearer?\n> \n> {{{\n>     sage: d = pari(float(1.0)).sin(precision=180); d\n>     0.8414709848078965067\n>     sage: d.bitprecision()                                 \n>     64\n> }}}\n> \n> However this test is also architecture dependent.",
    "created_at": "2017-02-16T21:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305278",
    "user": "defeo"
}
```

`@`jdemeyer ping?

Replying to [comment:40 defeo]:
> Replying to [comment:39 jdemeyer]:
> Would you find this clearer?
> 
> {{{
>     sage: d = pari(float(1.0)).sin(precision=180); d
>     0.8414709848078965067
>     sage: d.bitprecision()                                 
>     64
> }}}
> 
> However this test is also architecture dependent.



---

archive/issue_comments_305279.json:
```json
{
    "body": "Replying to [comment:40 defeo]:\n> which has no equivalent in CyPari.\n\nI disagree with this.\n\nThere are plenty of ways to create high-precision numbers in CyPari:\n\n```\nsage: n = pari(\"1.0000000000000000000000000000\"); n.bitprecision()\n128\nsage: n = pari(\"localbitprec(100); 1.0\"); n.bitprecision()\n128\nsage: n = pari(1.0).bitprecision(100); n.bitprecision()\n128\n```\n\n\nPersonally, I would prefer the third way.\n\nSo I think that you can mostly keep the old doctests, just replacing `pari(RealField(100)(1.0))` by `pari(1.0).bitprecision(100)`.",
    "created_at": "2017-02-17T13:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305279",
    "user": "jdemeyer"
}
```

Replying to [comment:40 defeo]:
> which has no equivalent in CyPari.

I disagree with this.

There are plenty of ways to create high-precision numbers in CyPari:

```
sage: n = pari("1.0000000000000000000000000000"); n.bitprecision()
128
sage: n = pari("localbitprec(100); 1.0"); n.bitprecision()
128
sage: n = pari(1.0).bitprecision(100); n.bitprecision()
128
```


Personally, I would prefer the third way.

So I think that you can mostly keep the old doctests, just replacing `pari(RealField(100)(1.0))` by `pari(1.0).bitprecision(100)`.



---

archive/issue_comments_305280.json:
```json
{
    "body": "Looking at the documentation of precision more carefully, I think you should actually restore larger parts of the docs. For example, the first part of \"Internal representation and conversion between Sage and PARI\" and all of \"Output precision for printing\" should be kept for CyPari2.",
    "created_at": "2017-02-17T13:44:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305280",
    "user": "jdemeyer"
}
```

Looking at the documentation of precision more carefully, I think you should actually restore larger parts of the docs. For example, the first part of "Internal representation and conversion between Sage and PARI" and all of "Output precision for printing" should be kept for CyPari2.



---

archive/issue_comments_305281.json:
```json
{
    "body": "Replying to [comment:43 jdemeyer]:\n> For example, the first part of \"Internal representation and conversion between Sage and PARI\" \n\nThere's pretty much nothing that can be salvaged from this section: precision in PARI is in multiples of 32 or 64. That's it.\n\n> and all of \"Output precision for printing\" should be kept for CyPari2.\n\nI think this section is completely misleading, and the more I try to understand, the less I get it. It talks about \"printing\" precision, `set_real_precision` seems to affect more than printing:\n\n\n```\nsage: pari.set_real_precision_bits(1000)\nsage: a = pari('Pi')\nsage: \nsage: pari.set_real_precision_bits(10)\nsage: b = pari('Pi')\nsage: a - b\n-2.17 E-19\nsage: pari.set_real_precision_bits(1000)\nsage: a - b\n-2.168404344971008868 E-19\nsage: a - b.bitprecision(1000)\n-5.016557612668332023557327080330757013833665769218359371379100137196517465788293201785191348671769335290615539044941776827464059187151888254971589729806147889444035537705104506961803557118902433406655387152435176621321683472879809085435143307653965138954567335178660639273975085872627541300 E-20\n```\n\n\nI think this whole part needs to be rewritten, not translated from the old docs. Problem is, I'm not sure I understand what it does.",
    "created_at": "2017-02-17T15:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305281",
    "user": "defeo"
}
```

Replying to [comment:43 jdemeyer]:
> For example, the first part of "Internal representation and conversion between Sage and PARI" 

There's pretty much nothing that can be salvaged from this section: precision in PARI is in multiples of 32 or 64. That's it.

> and all of "Output precision for printing" should be kept for CyPari2.

I think this section is completely misleading, and the more I try to understand, the less I get it. It talks about "printing" precision, `set_real_precision` seems to affect more than printing:


```
sage: pari.set_real_precision_bits(1000)
sage: a = pari('Pi')
sage: 
sage: pari.set_real_precision_bits(10)
sage: b = pari('Pi')
sage: a - b
-2.17 E-19
sage: pari.set_real_precision_bits(1000)
sage: a - b
-2.168404344971008868 E-19
sage: a - b.bitprecision(1000)
-5.016557612668332023557327080330757013833665769218359371379100137196517465788293201785191348671769335290615539044941776827464059187151888254971589729806147889444035537705104506961803557118902433406655387152435176621321683472879809085435143307653965138954567335178660639273975085872627541300 E-20
```


I think this whole part needs to be rewritten, not translated from the old docs. Problem is, I'm not sure I understand what it does.



---

archive/issue_comments_305282.json:
```json
{
    "body": "Can you explain me what you don't understand?\n\nI could certainly try to improve the docs, but then I need to know what's wrong with the current docs.",
    "created_at": "2017-02-17T18:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305282",
    "user": "jdemeyer"
}
```

Can you explain me what you don't understand?

I could certainly try to improve the docs, but then I need to know what's wrong with the current docs.



---

archive/issue_comments_305283.json:
```json
{
    "body": "Replying to [comment:44 defeo]:\n> There's pretty much nothing that can be salvaged from this section: precision in PARI is in multiples of 32 or 64. That's it.\n\n...but that is a very important fact to mention which is certainly more than \"pretty much nothing\".",
    "created_at": "2017-02-17T18:47:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305283",
    "user": "jdemeyer"
}
```

Replying to [comment:44 defeo]:
> There's pretty much nothing that can be salvaged from this section: precision in PARI is in multiples of 32 or 64. That's it.

...but that is a very important fact to mention which is certainly more than "pretty much nothing".



---

archive/issue_comments_305284.json:
```json
{
    "body": "Replying to [comment:44 defeo]:\n> I think this section is completely misleading, and the more I try to understand, the less I get it. It talks about \"printing\" precision, `set_real_precision` seems to affect more than printing:\n\nI hope that \"completely misleading\" is an exaggeration. The sentence \"The maximum number of digits when printing a PARI real can be set using the methods `Pari.set_real_precision_bits` or `Pari.set_real_precision`\" is correct but it's true that `set_real_precision_bits` affects more than just printing. It also affects precision for numbers parsed using the string interface, which is documented in the \"Input precision for function calls\" section. So I wonder where your confusion comes from.",
    "created_at": "2017-02-17T18:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305284",
    "user": "jdemeyer"
}
```

Replying to [comment:44 defeo]:
> I think this section is completely misleading, and the more I try to understand, the less I get it. It talks about "printing" precision, `set_real_precision` seems to affect more than printing:

I hope that "completely misleading" is an exaggeration. The sentence "The maximum number of digits when printing a PARI real can be set using the methods `Pari.set_real_precision_bits` or `Pari.set_real_precision`" is correct but it's true that `set_real_precision_bits` affects more than just printing. It also affects precision for numbers parsed using the string interface, which is documented in the "Input precision for function calls" section. So I wonder where your confusion comes from.



---

archive/issue_comments_305285.json:
```json
{
    "body": "Sorry, I shouldn't be doing so many things in parallel. I'll try to frame my doubts better.\n\nFor one, I do not understand this:\n\n\n```\nsage: pi = pari('Pi')\nsage: a = pari(float(1.0))\nsage: pari.set_real_precision(500)\n15\nsage: pi\n3.141592653589793239\nsage: a\n1.0000000000000000000\nsage: pi.bitprecision(1000)\n3.1415926535897932385128089594061862044327426701784133911132812500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\nsage: a.bitprecision(1000)\n1.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n```\n\n\nHow does PARI decide what bits to add when calling `bitprecision()`? Why does `Pi` have junk digits before all the zeros, while `1.0` gets only added zeros?",
    "created_at": "2017-02-17T22:12:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305285",
    "user": "defeo"
}
```

Sorry, I shouldn't be doing so many things in parallel. I'll try to frame my doubts better.

For one, I do not understand this:


```
sage: pi = pari('Pi')
sage: a = pari(float(1.0))
sage: pari.set_real_precision(500)
15
sage: pi
3.141592653589793239
sage: a
1.0000000000000000000
sage: pi.bitprecision(1000)
3.1415926535897932385128089594061862044327426701784133911132812500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
sage: a.bitprecision(1000)
1.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
```


How does PARI decide what bits to add when calling `bitprecision()`? Why does `Pi` have junk digits before all the zeros, while `1.0` gets only added zeros?



---

archive/issue_comments_305286.json:
```json
{
    "body": "Then, there's the fact that I expect (too optimistically) `Pi` to be a *symbolic* quantity, i.e. that incrementing precision (with `pi.bitprecision(1000)`) would compute correctly the new digits instead of adding random junk.\n\nThat's probably asking too much from PARI, but I got bad habits from Sage :)\n\nThe same behavior from `pari.pi()` surprises me much less: when I see a function call, I understand that's a function supposed to compute \u03c0 up to a fixed precision.\n\nAnyway, not much we can do here: that's the way PARI it is.",
    "created_at": "2017-02-17T22:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305286",
    "user": "defeo"
}
```

Then, there's the fact that I expect (too optimistically) `Pi` to be a *symbolic* quantity, i.e. that incrementing precision (with `pi.bitprecision(1000)`) would compute correctly the new digits instead of adding random junk.

That's probably asking too much from PARI, but I got bad habits from Sage :)

The same behavior from `pari.pi()` surprises me much less: when I see a function call, I understand that's a function supposed to compute π up to a fixed precision.

Anyway, not much we can do here: that's the way PARI it is.



---

archive/issue_comments_305287.json:
```json
{
    "body": "And, finally, when I read\n\n> The maximum number of digits when printing a PARI real can be set using the methods :meth:`Pari.set_real_precision_bits` or :meth:`Pari.set_real_precision`.\n\nI understand that's the SOLE role of `set_real_precision`: controlling output precision. Then, when I go further down, I discover that it also controls input precision for strings.\n\nI would find it clearer, if it was stated right away that `set_real_precision` controls input and output precision for strings.",
    "created_at": "2017-02-17T22:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305287",
    "user": "defeo"
}
```

And, finally, when I read

> The maximum number of digits when printing a PARI real can be set using the methods :meth:`Pari.set_real_precision_bits` or :meth:`Pari.set_real_precision`.

I understand that's the SOLE role of `set_real_precision`: controlling output precision. Then, when I go further down, I discover that it also controls input precision for strings.

I would find it clearer, if it was stated right away that `set_real_precision` controls input and output precision for strings.



---

archive/issue_comments_305288.json:
```json
{
    "body": "Replying to [comment:48 defeo]:\n> Sorry, I shouldn't be doing so many things in parallel. I'll try to frame my doubts better.\n> \n> For one, I do not understand this:\n> \n> {{{\n> sage: pi = pari('Pi')\n> sage: a = pari(float(1.0))\n> sage: pari.set_real_precision(500)\n> 15\n> sage: pi\n> 3.141592653589793239\n> sage: a\n> 1.0000000000000000000\n> sage: pi.bitprecision(1000)\n> 3.1415926535897932385128089594061862044327426701784133911132812500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n> sage: a.bitprecision(1000)\n> 1.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\n> }}}\n> \n> How does PARI decide what bits to add when calling `bitprecision()`?\n\nIt just adds zero bits.\n\n> Why does `Pi` have junk digits before all the zeros, while `1.0` gets only added zeros?\n\nYou should not make any conclusions from the *decimal* representation of the number, in binary it's just zeros.\n\nReplying to [comment:49 defeo]:\n> Then, there's the fact that I expect (too optimistically) `Pi` to be a *symbolic* quantity, i.e. that incrementing precision (with `pi.bitprecision(1000)`) would compute correctly the new digits instead of adding random junk.\n\nPARI doesn't really do symbolic computations. `Pi` does a computation returning a floating-point approximation of \u03c0.\n\n> The same behavior from `pari.pi()` surprises me much less: when I see a function call, I understand that's a function supposed to compute \u03c0 up to a fixed precision.\n\nActually, `Pi` is a function call. This works:\n\n```\ngp> Pi()\n%1 = 3.1415926535897932384626433832795028842\n```\n\nIt's just that the GP parser turns `Pi` into `Pi()` to improve user-friendliness.",
    "created_at": "2017-02-18T08:51:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305288",
    "user": "jdemeyer"
}
```

Replying to [comment:48 defeo]:
> Sorry, I shouldn't be doing so many things in parallel. I'll try to frame my doubts better.
> 
> For one, I do not understand this:
> 
> {{{
> sage: pi = pari('Pi')
> sage: a = pari(float(1.0))
> sage: pari.set_real_precision(500)
> 15
> sage: pi
> 3.141592653589793239
> sage: a
> 1.0000000000000000000
> sage: pi.bitprecision(1000)
> 3.1415926535897932385128089594061862044327426701784133911132812500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> sage: a.bitprecision(1000)
> 1.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
> }}}
> 
> How does PARI decide what bits to add when calling `bitprecision()`?

It just adds zero bits.

> Why does `Pi` have junk digits before all the zeros, while `1.0` gets only added zeros?

You should not make any conclusions from the *decimal* representation of the number, in binary it's just zeros.

Replying to [comment:49 defeo]:
> Then, there's the fact that I expect (too optimistically) `Pi` to be a *symbolic* quantity, i.e. that incrementing precision (with `pi.bitprecision(1000)`) would compute correctly the new digits instead of adding random junk.

PARI doesn't really do symbolic computations. `Pi` does a computation returning a floating-point approximation of π.

> The same behavior from `pari.pi()` surprises me much less: when I see a function call, I understand that's a function supposed to compute π up to a fixed precision.

Actually, `Pi` is a function call. This works:

```
gp> Pi()
%1 = 3.1415926535897932384626433832795028842
```

It's just that the GP parser turns `Pi` into `Pi()` to improve user-friendliness.



---

archive/issue_comments_305289.json:
```json
{
    "body": "> > Why does `Pi` have junk digits before all the zeros, while `1.0` gets only added zeros?\n> \n> You should not make any conclusions from the *decimal* representation of the number, in binary it's just zeros.\n\nRight. So I think \n\n\n```\nn = pari(1.0).bitprecision(100)\n```\n\n\nis giving bad advice to the user: it only gets the intended value by chance, and the doctstring of `bitprecision` does nothing to help the user guess what the result would be.\n\n> It's just that the GP parser turns `Pi` into `Pi()` to improve user-friendliness.\n\nI call this user-hateness.",
    "created_at": "2017-02-18T16:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305289",
    "user": "defeo"
}
```

> > Why does `Pi` have junk digits before all the zeros, while `1.0` gets only added zeros?
> 
> You should not make any conclusions from the *decimal* representation of the number, in binary it's just zeros.

Right. So I think 


```
n = pari(1.0).bitprecision(100)
```


is giving bad advice to the user: it only gets the intended value by chance, and the doctstring of `bitprecision` does nothing to help the user guess what the result would be.

> It's just that the GP parser turns `Pi` into `Pi()` to improve user-friendliness.

I call this user-hateness.



---

archive/issue_comments_305290.json:
```json
{
    "body": "Feel free to complain to the PARI developers for anything that you don't like...",
    "created_at": "2017-02-18T17:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305290",
    "user": "jdemeyer"
}
```

Feel free to complain to the PARI developers for anything that you don't like...



---

archive/issue_comments_305291.json:
```json
{
    "body": "Luca, are you going to work on this, or should I?",
    "created_at": "2017-02-21T07:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305291",
    "user": "jdemeyer"
}
```

Luca, are you going to work on this, or should I?



---

archive/issue_comments_305292.json:
```json
{
    "body": "Sorry, I was busy teaching. I was meaning to finalize this, but if I don't make it by today, it will have to wait until Fri.\n\nOf course, if you have time to donate to this, feel free to jump in.",
    "created_at": "2017-02-21T10:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305292",
    "user": "defeo"
}
```

Sorry, I was busy teaching. I was meaning to finalize this, but if I don't make it by today, it will have to wait until Fri.

Of course, if you have time to donate to this, feel free to jump in.



---

archive/issue_comments_305293.json:
```json
{
    "body": "OK, I will try to have a look today.",
    "created_at": "2017-02-22T11:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305293",
    "user": "jdemeyer"
}
```

OK, I will try to have a look today.



---

archive/issue_comments_305294.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-22T16:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305294",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305295.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-22T16:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305295",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_305296.json:
```json
{
    "body": "I hope this helps...",
    "created_at": "2017-02-22T16:06:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305296",
    "user": "jdemeyer"
}
```

I hope this helps...



---

archive/issue_comments_305297.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-25T14:22:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305297",
    "user": "defeo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_305298.json:
```json
{
    "body": "Sorry for the delay. It is clearer now, thanks for the patch.\n\nAre you sure the doctests pass on 32-bits? This, for example:\n\n\n```\nsage: c = pari(1).sin(); c\n0.841470984807897\nsage: c.bitprecision()\n64\n```\n",
    "created_at": "2017-02-25T14:22:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305298",
    "user": "defeo"
}
```

Sorry for the delay. It is clearer now, thanks for the patch.

Are you sure the doctests pass on 32-bits? This, for example:


```
sage: c = pari(1).sin(); c
0.841470984807897
sage: c.bitprecision()
64
```




---

archive/issue_comments_305299.json:
```json
{
    "body": "> Are you sure the doctests pass on 32-bits? This, for example:\n> \n> {{{\n> sage: c = pari(1).sin(); c\n> 0.841470984807897\n> sage: c.bitprecision()\n> 64\n> }}}\n\nOk, went again through the examples, and this example is obviously not a problem. The only problematic tests are those that do `pari(1.0)`: that's not arch dependent in Sage (because 1.0 is a real), but it is in Python.\n\nAnyway, they are ok for now. We shall see when we bring this to cypari.",
    "created_at": "2017-02-26T22:20:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305299",
    "user": "defeo"
}
```

> Are you sure the doctests pass on 32-bits? This, for example:
> 
> {{{
> sage: c = pari(1).sin(); c
> 0.841470984807897
> sage: c.bitprecision()
> 64
> }}}

Ok, went again through the examples, and this example is obviously not a problem. The only problematic tests are those that do `pari(1.0)`: that's not arch dependent in Sage (because 1.0 is a real), but it is in Python.

Anyway, they are ok for now. We shall see when we bring this to cypari.



---

archive/issue_comments_305300.json:
```json
{
    "body": "Replying to [comment:62 defeo]:\n> The only problematic tests are those that do `pari(1.0)`: that's not arch dependent in Sage (because 1.0 is a real), but it is in Python.\n\nNo, Python floats are the same on 32-bit and 64-bit. It's true that certain *computations* involving floats might give different results. But for a conversion, the results should be the same on 32-bit and 64-bit.",
    "created_at": "2017-02-27T07:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305300",
    "user": "jdemeyer"
}
```

Replying to [comment:62 defeo]:
> The only problematic tests are those that do `pari(1.0)`: that's not arch dependent in Sage (because 1.0 is a real), but it is in Python.

No, Python floats are the same on 32-bit and 64-bit. It's true that certain *computations* involving floats might give different results. But for a conversion, the results should be the same on 32-bit and 64-bit.



---

archive/issue_comments_305301.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/libs/cypari2/pari_instance.pyx\n**********************************************************************\nFile \"src/sage/libs/cypari2/pari_instance.pyx\", line 91, in sage.libs.cypari2.pari_instance\nFailed example:\n    pari(\"Pi\") - p\nExpected:\n    1.22514845490862 E-16\nGot:\n    1.225148455 E-16\n**********************************************************************\nFile \"src/sage/libs/cypari2/pari_instance.pyx\", line 94, in sage.libs.cypari2.pari_instance\nFailed example:\n    pari(\"Pi\") - p\nExpected:\n    1.22514845490862 E-16\nGot:\n    1.225148455 E-16\n**********************************************************************\n1 item had failures:\n   2 of  54 in sage.libs.cypari2.pari_instance\n    [174 tests, 2 failures, 0.22 s]\n```\n",
    "created_at": "2017-02-28T23:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305301",
    "user": "vbraun"
}
```


```
sage -t --long src/sage/libs/cypari2/pari_instance.pyx
**********************************************************************
File "src/sage/libs/cypari2/pari_instance.pyx", line 91, in sage.libs.cypari2.pari_instance
Failed example:
    pari("Pi") - p
Expected:
    1.22514845490862 E-16
Got:
    1.225148455 E-16
**********************************************************************
File "src/sage/libs/cypari2/pari_instance.pyx", line 94, in sage.libs.cypari2.pari_instance
Failed example:
    pari("Pi") - p
Expected:
    1.22514845490862 E-16
Got:
    1.225148455 E-16
**********************************************************************
1 item had failures:
   2 of  54 in sage.libs.cypari2.pari_instance
    [174 tests, 2 failures, 0.22 s]
```




---

archive/issue_comments_305302.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-02-28T23:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305302",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_305303.json:
```json
{
    "body": "Sorry for that.",
    "created_at": "2017-03-01T07:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305303",
    "user": "jdemeyer"
}
```

Sorry for that.



---

archive/issue_comments_305304.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-01T07:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305304",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_305305.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-01T07:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305305",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_305306.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-01T12:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305306",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_305307.json:
```json
{
    "body": "This fixes the 32-bit tests.",
    "created_at": "2017-03-01T12:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305307",
    "user": "jdemeyer"
}
```

This fixes the 32-bit tests.



---

archive/issue_comments_305308.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-03-02T17:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21956",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21956#issuecomment-305308",
    "user": "vbraun"
}
```

Resolution: fixed
