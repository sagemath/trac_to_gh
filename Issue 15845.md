# Issue 15845: Python 3 preparation: The semantics of the zip() function is changed

Issue created by migration from https://trac.sagemath.org/ticket/16082

Original creator: wluebbe

Original creation time: 2014-04-07 09:09:23

CC:  embray tscrim jmantysalo jdemeyer jhpalmieri

Keywords: python3

In Py2 `zip()` returns a list, while in Py3 `zip()` returns an iterator (as `itertools.izip()` does in Py2).

The tool 2to3 wraps `zip()` usages with a call to `list()`.


An alternative approach is to add `from future_builtins import zip` and to check where a wrapping with `list()` is required.

There are 54 effected modules. 

This ticket is tracked as a dependency of meta-ticket ticket:16052.


---

Comment by jdemeyer created at 2016-05-02 13:36:21

Changing component from distribution to python3.


---

Comment by chapoton created at 2016-09-22 20:19:20

one step in #21568


---

Comment by chapoton created at 2017-01-06 21:46:07

as of sage 7.5.rc2

running all doctests with "from future_builtins import zip" does not give any error

I propose therefore to close this ticket

EDIT: this needs to be checked very carefully.


---

Comment by chapoton created at 2017-01-06 21:46:07

Changing status from new to needs_review.


---

Comment by saraedum created at 2017-01-24 21:36:57

Could you elaborate on what you meant by "This needs to be checked very carefully."


---

Comment by chapoton created at 2017-01-25 07:45:11

Yes, I can.

What I mean is the following: one should find a way to run all doctests with the py3 behaviour of zip activated **both in doctests and in code**. I have not been able to do that so far, as it seems that adding an import line to src/sage/all.py is not enough.

Same thing for range in #16081


---

Comment by chapoton created at 2017-01-26 19:56:20

Here is a test branch, displaying the issue : how to trigger future zip behaviour in globally in the code ?
----
New commits:


---

Comment by saraedum created at 2017-01-27 01:20:04

Could you patch `globals()['__builtins__'].zip` in `sage.all`?


---

Comment by jdemeyer created at 2017-01-27 07:12:20

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2017-01-27 07:12:20

You should really think about putting `from six.moves import zip` in `sage.all`. That will affect everybody using Sage. Doing something like that should be explicitly discussed on sage-devel (and not in a thread called "how to check zip, map, range, print for Python3").


---

Comment by chapoton created at 2017-01-27 07:30:11

Replying to [comment:11 jdemeyer]:
> You should really think about putting `from six.moves import zip` in `sage.all`. That will affect everybody using Sage. Doing something like that should be explicitly discussed on sage-devel (and not in a thread called "how to check zip, map, range, print for Python3").

This is a ***f#### test ticket***, with milestone wontfix. It has never been my intention to make this enter sage. Could you please make a more useful contribution ?


---

Comment by jdemeyer created at 2017-01-27 07:56:24

Was it *really* necessary to be so unpolite?

It seems that the _only_ indication that it was a test ticket is the milestone. Nothing in the title nor the description nor in your sage-devel thread was making it clear that this was a test ticket. So that could easily be overlooked.


---

Comment by jdemeyer created at 2017-01-27 07:56:24

Changing status from needs_info to needs_review.


---

Comment by jdemeyer created at 2017-01-27 07:57:49

Replying to [comment:12 chapoton]:
> Could you please make a more useful contribution ?

After being insulted like that? Why would I?


---

Comment by chapoton created at 2017-01-27 08:04:49

Sorry for my rough reaction. All my apologies. Early morning's bad mood.

Could you please, given all that you know that I don't, tell if you think that the goal of this ticket is reachable ?


---

Comment by git created at 2017-01-28 12:14:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-01-28 16:27:39

ok, this works and discovers a lot of issues: two notable ones being

```
    for op,i in reversed(zip(ef, indices)):
    TypeError: argument to reversed() must be a sequence
```


```
return Factorization(zip(pols, exps), leading_coeff)
      File "/home/u1/chapoton/sage/local/lib/python2.7/site-packages/sage/structure/factorization.py", line 294, in __init__
        raise TypeError("x must be a list")
```



---

Comment by chapoton created at 2017-01-29 10:39:52

see #22271 for a partial cure


---

Comment by chapoton created at 2017-02-10 19:41:24

see #22350 for the next pill in the cure


---

Comment by chapoton created at 2017-02-27 08:05:48

then #22385


---

Comment by chapoton created at 2017-02-27 09:56:20

then #22457


---

Comment by chapoton created at 2017-03-05 14:15:26

then #22519


---

Comment by saraedum created at 2017-03-14 15:28:12

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2017-03-14 15:28:12

I find it always confusing that this "needs review". Can we leave it as "needs work" until all the zip problems are fixed?


---

Comment by chapoton created at 2017-03-14 15:29:28

They are now fixed, or should be. This really needs review now (but I admit it was set to needs review before reaching this state).


---

Comment by saraedum created at 2017-03-14 16:11:40

Changing keywords from "python3" to "python3, days85".


---

Comment by saraedum created at 2017-03-14 19:24:34

So is the question here now whether the patchbot is happy?


---

Comment by chapoton created at 2017-03-14 19:32:10

Yes, exactly. And sadly it seems not to be the case. At least this one failure seems related and needs investigation:

```
sage -t --long --warn-long 75.6 src/sage/graphs/generic_graph.py
**********************************************************************
File "src/sage/graphs/generic_graph.py", line 6558, in sage.graphs.generic_graph.GenericGraph.longest_path
Failed example:
    g.longest_path(algorithm="backtrack").edges()
Expected:
    [(0, 1, None), (1, 2, None), (2, 3, None), (3, 4, None), (4, 9, None), (5, 7, None), (5, 8, None), (6, 8, None), (6, 9, None)]
Got:
    []
```



---

Comment by chapoton created at 2017-03-15 12:32:19

see #22603 for maybe the last step


---

Comment by chapoton created at 2017-04-01 06:44:05

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2017-04-01 06:44:05

green bot, which means that all zip problems have been taken care of


---

Comment by chapoton created at 2017-05-04 09:52:28

can we please close this as duplicate, now that everything is in order ?


---

Comment by tscrim created at 2017-05-04 15:12:26

Do you want to keep this ticket around as a general test ticket against regressions or do you have another methodology for that?


---

Comment by chapoton created at 2017-05-04 18:02:39

I have no other methodology. Maybe it is better to keep it open so that patchbots can be launched on it. The patchbots should now be very reluctant to test closed tickets indeed.


---

Comment by chapoton created at 2017-06-02 09:10:08

so let us rather put that into needs_info status


---

Comment by chapoton created at 2017-06-02 09:10:08

Changing status from needs_review to needs_info.


---

Comment by chapoton created at 2018-01-19 16:41:52

Changing status from needs_info to positive_review.


---

Comment by chapoton created at 2018-01-19 16:41:52

I now propose to close this one. If somebody ever reintroduces a bad zip, we will see that when running all doctests with python3.


---

Comment by chapoton created at 2018-01-22 09:50:01

Erik, could you please close this one ?


---

Comment by embray created at 2018-01-22 13:16:56

Resolution: wontfix
