# Issue 19655: Face semigroup of hyperplane arrangement

archive/issues_019655.json:
```json
{
    "body": "CC:  dperkinson stefan @nathanncohen @rbeezer @vbraun @nthiery @saliola\n\nKeywords: hyperplane arrangements, semigroups, polyhedra\n\nThe branch implements the closed faces of a hyperplane arrangement, the multiplication of the face semigroup, and its semigroup algebra.\n\nThe semigroup itself is not implemented, since I cannot find a way to build a finite semigroup (or magma) out of a multiplication table. I could make this myself, but I feel stupid doing this, as I would likely just duplicate something existing (and not very well, as I still don't grok the category framework). I *can* add it if you want me to.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19892\n\n",
    "created_at": "2016-01-15T00:20:51Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "Face semigroup of hyperplane arrangement",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19655",
    "user": "https://github.com/darijgr"
}
```
CC:  dperkinson stefan @nathanncohen @rbeezer @vbraun @nthiery @saliola

Keywords: hyperplane arrangements, semigroups, polyhedra

The branch implements the closed faces of a hyperplane arrangement, the multiplication of the face semigroup, and its semigroup algebra.

The semigroup itself is not implemented, since I cannot find a way to build a finite semigroup (or magma) out of a multiplication table. I could make this myself, but I feel stupid doing this, as I would likely just duplicate something existing (and not very well, as I still don't grok the category framework). I *can* add it if you want me to.

Issue created by migration from https://trac.sagemath.org/ticket/19892





---

archive/issue_comments_269916.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-01-22T03:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269916",
    "user": "https://github.com/darijgr"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_269917.json:
```json
{
    "body": "I am getting errors when generating the documentation:\n\n\n```\n...\n[geometry ] loading cross citations...\n[geometry ] /home/mmarco/sage/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement/arrangement.py:docstring of sage.geometry.hyperplane_arrangement.arrangement:27: ERROR: Unexpected indentation.\n[geometry ] /home/mmarco/sage/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement/arrangement.py:docstring of sage.geometry.hyperplane_arrangement.arrangement.HyperplaneArrangementElement.face_semigroup_algebra:42: WARNING: Block quote ends without a blank line; unexpected unindent.\nError building the documentation.\n```\n",
    "created_at": "2016-01-27T17:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269917",
    "user": "https://github.com/miguelmarco"
}
```

I am getting errors when generating the documentation:


```
...
[geometry ] loading cross citations...
[geometry ] /home/mmarco/sage/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement/arrangement.py:docstring of sage.geometry.hyperplane_arrangement.arrangement:27: ERROR: Unexpected indentation.
[geometry ] /home/mmarco/sage/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement/arrangement.py:docstring of sage.geometry.hyperplane_arrangement.arrangement.HyperplaneArrangementElement.face_semigroup_algebra:42: WARNING: Block quote ends without a blank line; unexpected unindent.
Error building the documentation.
```




---

archive/issue_comments_269918.json:
```json
{
    "body": "I am going through the code, but there are some explanations I don't fully understand. For instance, can you give an example of the phnomenon explained in \n\n\n```\n                    # Do not append ``zero_part`` yet! It might be\n                    # redundant (in the sense that some of its defining\n                    # inequalities are always equalities on it). Check for\n                    # this:\n```\n\n\nplease?",
    "created_at": "2016-01-27T17:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269918",
    "user": "https://github.com/miguelmarco"
}
```

I am going through the code, but there are some explanations I don't fully understand. For instance, can you give an example of the phnomenon explained in 


```
                    # Do not append ``zero_part`` yet! It might be
                    # redundant (in the sense that some of its defining
                    # inequalities are always equalities on it). Check for
                    # this:
```


please?



---

archive/issue_comments_269919.json:
```json
{
    "body": "Replying to [comment:4 mmarco]:\n> I am going through the code, but there are some explanations I don't fully understand. For instance, can you give an example of the phnomenon explained in \n> \n> {{{\n>                     # Do not append ``zero_part`` yet! It might be\n>                     # redundant (in the sense that some of its defining\n>                     # inequalities are always equalities on it). Check for\n>                     # this:\n> }}}\n> \n> please?\n> \n\nWhen your hyperplanes have the equations x == 0, y == 0 and x + y == 0, then the face (x == 0 & y == 0) of the hyperplane arrangement formed by the first two will intersect the halfspace x + y >= 0 in itself, and we want to record this as a 0 sign, not as a +1 sign. Remember that all the faces here are closed faces.\n\nSorry for the doc bug! If you could fix this (in the hopefully obvious way; I tend to get the \"::\"s wrong in docstrings), I'd be really grateful.",
    "created_at": "2016-01-27T18:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269919",
    "user": "https://github.com/darijgr"
}
```

Replying to [comment:4 mmarco]:
> I am going through the code, but there are some explanations I don't fully understand. For instance, can you give an example of the phnomenon explained in 
> 
> {{{
>                     # Do not append ``zero_part`` yet! It might be
>                     # redundant (in the sense that some of its defining
>                     # inequalities are always equalities on it). Check for
>                     # this:
> }}}
> 
> please?
> 

When your hyperplanes have the equations x == 0, y == 0 and x + y == 0, then the face (x == 0 & y == 0) of the hyperplane arrangement formed by the first two will intersect the halfspace x + y >= 0 in itself, and we want to record this as a 0 sign, not as a +1 sign. Remember that all the faces here are closed faces.

Sorry for the doc bug! If you could fix this (in the hopefully obvious way; I tend to get the "::"s wrong in docstrings), I'd be really grateful.



---

archive/issue_comments_269920.json:
```json
{
    "body": "(I think it's the EXAMPLES with only one colon in the docstring face_semigroup_algebra that is breaking the docbuild.)",
    "created_at": "2016-01-27T18:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269920",
    "user": "https://github.com/darijgr"
}
```

(I think it's the EXAMPLES with only one colon in the docstring face_semigroup_algebra that is breaking the docbuild.)



---

archive/issue_comments_269921.json:
```json
{
    "body": "Replying to [comment:6 darij]:\n> (I think it's the EXAMPLES with only one colon in the docstring face_semigroup_algebra that is breaking the docbuild.)\n\nThat appears to be the problem from my quick look over.",
    "created_at": "2016-01-27T22:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269921",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:6 darij]:
> (I think it's the EXAMPLES with only one colon in the docstring face_semigroup_algebra that is breaking the docbuild.)

That appears to be the problem from my quick look over.



---

archive/issue_comments_269922.json:
```json
{
    "body": "> When your hyperplanes have the equations x == 0, y == 0 and x + y == 0, then the face (x == 0 & y == 0) of the hyperplane arrangement formed by the first two will intersect the halfspace x + y >= 0 in itself, and we want to record this as a 0 sign, not as a +1 sign. Remember that all the faces here are closed faces.\n> \n\nBut wouldn't that case already be covered by this section?\n\n\n```\n                if zero_part_dim == face_dim:\n                    # If the intersection of ``face`` with ``hyperplane``\n                    # has the same dimension as ``face``, then this\n                    # intersection *is* ``face``, so we can continue\n                    # (without adding the other two intersections, since\n                    # those are empty):\n                    subdivided.append((signs + (0,), face))\n                    continue\n```\n\n\nAlso, I added the missing colons, but still the doc building complains.",
    "created_at": "2016-01-28T09:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269922",
    "user": "https://github.com/miguelmarco"
}
```

> When your hyperplanes have the equations x == 0, y == 0 and x + y == 0, then the face (x == 0 & y == 0) of the hyperplane arrangement formed by the first two will intersect the halfspace x + y >= 0 in itself, and we want to record this as a 0 sign, not as a +1 sign. Remember that all the faces here are closed faces.
> 

But wouldn't that case already be covered by this section?


```
                if zero_part_dim == face_dim:
                    # If the intersection of ``face`` with ``hyperplane``
                    # has the same dimension as ``face``, then this
                    # intersection *is* ``face``, so we can continue
                    # (without adding the other two intersections, since
                    # those are empty):
                    subdivided.append((signs + (0,), face))
                    continue
```


Also, I added the missing colons, but still the doc building complains.



---

archive/issue_comments_269923.json:
```json
{
    "body": "Nevermind, I understood the logic behind it now.\n\nThe code looks correct to me. But I have a couple suggestions/comments/questions:\n\n- The way to construct the closed faces seems a bit overcomplicated. My impression is that a recursive approach (take the delition of the last hyperplane, compute the closed faces, and then intersect them with the three sides of the deleted hyperplane) would probably be simpler (but maybe slower). Did you consider it?\n\n- I think that the semigroup algebra should provide an option to provide the names of the generators.",
    "created_at": "2016-01-28T11:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269923",
    "user": "https://github.com/miguelmarco"
}
```

Nevermind, I understood the logic behind it now.

The code looks correct to me. But I have a couple suggestions/comments/questions:

- The way to construct the closed faces seems a bit overcomplicated. My impression is that a recursive approach (take the delition of the last hyperplane, compute the closed faces, and then intersect them with the three sides of the deleted hyperplane) would probably be simpler (but maybe slower). Did you consider it?

- I think that the semigroup algebra should provide an option to provide the names of the generators.



---

archive/issue_comments_269924.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-01-28T11:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269924",
    "user": "https://github.com/miguelmarco"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_269925.json:
```json
{
    "body": "Thanks for looking through this, Miguel!\n\nReplying to [comment:9 mmarco]:\n> The code looks correct to me. But I have a couple suggestions/comments/questions:\n> \n>  - The way to construct the closed faces seems a bit overcomplicated. My impression is that a recursive approach (take the delition of the last hyperplane, compute the closed faces, and then intersect them with the three sides of the deleted hyperplane) would probably be simpler (but maybe slower). Did you consider it?\n\nIsn't this what I am doing? Or do you want me to make the method fully recursive, i.e., build a hyperplane arrangement out of the first n-1 hyperplanes, then call the `closed_faces` method on that, and then just cut with the last hyperplane? I think that wouldn't be any faster than what I have done, plus I am not sure that it would work, because when you call `HyperplaneArrangement` the hyperplanes are getting sorted in some way, and I'm not sure whether removing a hyperplane wouldn't mess up the order of the remaining ones.\n\n>  - I think that the semigroup algebra should provide an option to provide the names of the generators.\n\nGood point, done.\n\nI'll take care of the doc shortly, once it's done building.",
    "created_at": "2016-01-28T16:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269925",
    "user": "https://github.com/darijgr"
}
```

Thanks for looking through this, Miguel!

Replying to [comment:9 mmarco]:
> The code looks correct to me. But I have a couple suggestions/comments/questions:
> 
>  - The way to construct the closed faces seems a bit overcomplicated. My impression is that a recursive approach (take the delition of the last hyperplane, compute the closed faces, and then intersect them with the three sides of the deleted hyperplane) would probably be simpler (but maybe slower). Did you consider it?

Isn't this what I am doing? Or do you want me to make the method fully recursive, i.e., build a hyperplane arrangement out of the first n-1 hyperplanes, then call the `closed_faces` method on that, and then just cut with the last hyperplane? I think that wouldn't be any faster than what I have done, plus I am not sure that it would work, because when you call `HyperplaneArrangement` the hyperplanes are getting sorted in some way, and I'm not sure whether removing a hyperplane wouldn't mess up the order of the remaining ones.

>  - I think that the semigroup algebra should provide an option to provide the names of the generators.

Good point, done.

I'll take care of the doc shortly, once it's done building.



---

archive/issue_comments_269926.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-28T16:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269926",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_269927.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-28T16:15:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269927",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_269928.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-01-28T16:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269928",
    "user": "https://github.com/darijgr"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_269929.json:
```json
{
    "body": "The doc seems to build now -- canyou confirm?",
    "created_at": "2016-01-28T16:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269929",
    "user": "https://github.com/darijgr"
}
```

The doc seems to build now -- canyou confirm?



---

archive/issue_comments_269930.json:
```json
{
    "body": "The doc seems to build now -- canyou confirm?",
    "created_at": "2016-01-28T16:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269930",
    "user": "https://github.com/darijgr"
}
```

The doc seems to build now -- canyou confirm?



---

archive/issue_comments_269931.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-28T16:17:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269931",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_269932.json:
```json
{
    "body": "> Isn't this what I am doing? Or do you want me to make the method fully recursive, i.e., build a hyperplane arrangement out of the first n-1 hyperplanes, then call the `closed_faces` method on that, and then just cut with the last hyperplane? I think that wouldn't be any faster than what I have done, plus I am not sure that it would work, because when you call `HyperplaneArrangement` the hyperplanes are getting sorted in some way, and I'm not sure whether removing a hyperplane wouldn't mess up the order of the remaining ones.\n> \n\nYes, that is what i meant. I don't think it will be faster than what you do, but maybe more readable. Anyways, if there is some problem with the ordering, it is probably better to leave it the way it is.",
    "created_at": "2016-01-28T16:22:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269932",
    "user": "https://github.com/miguelmarco"
}
```

> Isn't this what I am doing? Or do you want me to make the method fully recursive, i.e., build a hyperplane arrangement out of the first n-1 hyperplanes, then call the `closed_faces` method on that, and then just cut with the last hyperplane? I think that wouldn't be any faster than what I have done, plus I am not sure that it would work, because when you call `HyperplaneArrangement` the hyperplanes are getting sorted in some way, and I'm not sure whether removing a hyperplane wouldn't mess up the order of the remaining ones.
> 

Yes, that is what i meant. I don't think it will be faster than what you do, but maybe more readable. Anyways, if there is some problem with the ordering, it is probably better to leave it the way it is.



---

archive/issue_comments_269933.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-01-28T23:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269933",
    "user": "https://github.com/miguelmarco"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_269934.json:
```json
{
    "body": "Aaand thanks again!!",
    "created_at": "2016-01-28T23:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269934",
    "user": "https://github.com/darijgr"
}
```

Aaand thanks again!!



---

archive/issue_comments_269935.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-01-30T00:11:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19655#issuecomment-269935",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_018725.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-01-30T00:11:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19655",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19655#event-18725"
}
```
