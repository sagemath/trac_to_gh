# Issue 19655: Face semigroup of hyperplane arrangement

Issue created by migration from https://trac.sagemath.org/ticket/19892

Original creator: darij

Original creation time: 2016-01-15 00:20:51

CC:  dperkinson stefan ncohen rbeezer vbraun nthiery saliola

Keywords: hyperplane arrangements, semigroups, polyhedra

The branch implements the closed faces of a hyperplane arrangement, the multiplication of the face semigroup, and its semigroup algebra.

The semigroup itself is not implemented, since I cannot find a way to build a finite semigroup (or magma) out of a multiplication table. I could make this myself, but I feel stupid doing this, as I would likely just duplicate something existing (and not very well, as I still don't grok the category framework). I *can* add it if you want me to.


---

Comment by darij created at 2016-01-22 03:07:55

Changing status from new to needs_review.


---

Comment by mmarco created at 2016-01-27 17:08:02

I am getting errors when generating the documentation:


```
...
[geometry ] loading cross citations...
[geometry ] /home/mmarco/sage/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement/arrangement.py:docstring of sage.geometry.hyperplane_arrangement.arrangement:27: ERROR: Unexpected indentation.
[geometry ] /home/mmarco/sage/local/lib/python2.7/site-packages/sage/geometry/hyperplane_arrangement/arrangement.py:docstring of sage.geometry.hyperplane_arrangement.arrangement.HyperplaneArrangementElement.face_semigroup_algebra:42: WARNING: Block quote ends without a blank line; unexpected unindent.
Error building the documentation.
```



---

Comment by mmarco created at 2016-01-27 17:51:17

I am going through the code, but there are some explanations I don't fully understand. For instance, can you give an example of the phnomenon explained in 


```
                    # Do not append ``zero_part`` yet! It might be
                    # redundant (in the sense that some of its defining
                    # inequalities are always equalities on it). Check for
                    # this:
```


please?


---

Comment by darij created at 2016-01-27 18:17:07

Replying to [comment:4 mmarco]:
> I am going through the code, but there are some explanations I don't fully understand. For instance, can you give an example of the phnomenon explained in 
> 
> {{{
>                     # Do not append ``zero_part`` yet! It might be
>                     # redundant (in the sense that some of its defining
>                     # inequalities are always equalities on it). Check for
>                     # this:
> }}}
> 
> please?
> 

When your hyperplanes have the equations x == 0, y == 0 and x + y == 0, then the face (x == 0 & y == 0) of the hyperplane arrangement formed by the first two will intersect the halfspace x + y >= 0 in itself, and we want to record this as a 0 sign, not as a +1 sign. Remember that all the faces here are closed faces.

Sorry for the doc bug! If you could fix this (in the hopefully obvious way; I tend to get the "::"s wrong in docstrings), I'd be really grateful.


---

Comment by darij created at 2016-01-27 18:19:24

(I think it's the EXAMPLES with only one colon in the docstring face_semigroup_algebra that is breaking the docbuild.)


---

Comment by tscrim created at 2016-01-27 22:49:46

Replying to [comment:6 darij]:
> (I think it's the EXAMPLES with only one colon in the docstring face_semigroup_algebra that is breaking the docbuild.)

That appears to be the problem from my quick look over.


---

Comment by mmarco created at 2016-01-28 09:43:49

> When your hyperplanes have the equations x == 0, y == 0 and x + y == 0, then the face (x == 0 & y == 0) of the hyperplane arrangement formed by the first two will intersect the halfspace x + y >= 0 in itself, and we want to record this as a 0 sign, not as a +1 sign. Remember that all the faces here are closed faces.
> 

But wouldn't that case already be covered by this section?


```
                if zero_part_dim == face_dim:
                    # If the intersection of ``face`` with ``hyperplane``
                    # has the same dimension as ``face``, then this
                    # intersection *is* ``face``, so we can continue
                    # (without adding the other two intersections, since
                    # those are empty):
                    subdivided.append((signs + (0,), face))
                    continue
```


Also, I added the missing colons, but still the doc building complains.


---

Comment by mmarco created at 2016-01-28 11:05:33

Nevermind, I understood the logic behind it now.

The code looks correct to me. But I have a couple suggestions/comments/questions:

 - The way to construct the closed faces seems a bit overcomplicated. My impression is that a recursive approach (take the delition of the last hyperplane, compute the closed faces, and then intersect them with the three sides of the deleted hyperplane) would probably be simpler (but maybe slower). Did you consider it?

 - I think that the semigroup algebra should provide an option to provide the names of the generators.


---

Comment by mmarco created at 2016-01-28 11:05:33

Changing status from needs_review to needs_work.


---

Comment by darij created at 2016-01-28 16:01:31

Thanks for looking through this, Miguel!

Replying to [comment:9 mmarco]:
> The code looks correct to me. But I have a couple suggestions/comments/questions:
> 
>  - The way to construct the closed faces seems a bit overcomplicated. My impression is that a recursive approach (take the delition of the last hyperplane, compute the closed faces, and then intersect them with the three sides of the deleted hyperplane) would probably be simpler (but maybe slower). Did you consider it?

Isn't this what I am doing? Or do you want me to make the method fully recursive, i.e., build a hyperplane arrangement out of the first n-1 hyperplanes, then call the `closed_faces` method on that, and then just cut with the last hyperplane? I think that wouldn't be any faster than what I have done, plus I am not sure that it would work, because when you call `HyperplaneArrangement` the hyperplanes are getting sorted in some way, and I'm not sure whether removing a hyperplane wouldn't mess up the order of the remaining ones.

>  - I think that the semigroup algebra should provide an option to provide the names of the generators.

Good point, done.

I'll take care of the doc shortly, once it's done building.


---

Comment by git created at 2016-01-28 16:02:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-01-28 16:15:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2016-01-28 16:16:18

Changing status from needs_work to needs_review.


---

Comment by darij created at 2016-01-28 16:16:18

The doc seems to build now -- canyou confirm?


---

Comment by darij created at 2016-01-28 16:16:22

The doc seems to build now -- canyou confirm?


---

Comment by git created at 2016-01-28 16:17:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2016-01-28 16:22:15

> Isn't this what I am doing? Or do you want me to make the method fully recursive, i.e., build a hyperplane arrangement out of the first n-1 hyperplanes, then call the `closed_faces` method on that, and then just cut with the last hyperplane? I think that wouldn't be any faster than what I have done, plus I am not sure that it would work, because when you call `HyperplaneArrangement` the hyperplanes are getting sorted in some way, and I'm not sure whether removing a hyperplane wouldn't mess up the order of the remaining ones.
> 

Yes, that is what i meant. I don't think it will be faster than what you do, but maybe more readable. Anyways, if there is some problem with the ordering, it is probably better to leave it the way it is.


---

Comment by mmarco created at 2016-01-28 23:34:16

Changing status from needs_review to positive_review.


---

Comment by darij created at 2016-01-28 23:36:06

Aaand thanks again!!


---

Comment by vbraun created at 2016-01-30 00:11:03

Resolution: fixed
