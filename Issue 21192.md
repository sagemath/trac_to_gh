# Issue 21192: Rational log not working

Issue created by migration from https://trac.sagemath.org/ticket/21429

Original creator: rws

Original creation time: 2016-09-06 05:41:29


```
sage: ZZ(8).log(2)
3

sage: QQ(8/27).log(2/3)
...
AttributeError: 'sage.rings.rational.Rational' object has no attribute 'log'
```

This can be done fast using `mpz_remove` (or `ZZ.log`) on numerator and denominator.


---

Comment by rws created at 2016-09-18 07:18:29

Changing component from calculus to numerical.


---

Comment by rws created at 2016-09-29 08:53:42

Changing status from new to needs_review.


---

Comment by rws created at 2016-09-29 08:53:42

New commits:


---

Comment by tscrim created at 2016-09-29 14:34:03

Some micro-optimizations (I slightly care because this could be used in tight loops):

- You call `Rational(m)` twice.
- You call the `perfect_power` of `anum` and the like twice.
- `an` (and other like variables) are integers, correct? IIRC, a faster way to construct rational numbers is `Rational(an, bn)`.
- It is likely faster to extract the numerator and denominator than to use a try/except block:
  {{{#!sage
sage: def foo(q):
....:     try:
....:         return ZZ(q)
....:     except (ValueError, TypeError):
....:         return None
sage: def bar(q):
....:     if q.denom() == ZZ.one():
....:         return q.numer()
....:     else:
....:         return None
sage: q = 4 / 3
sage: %timeit foo(q)
The slowest run took 7.89 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 1.24 Âµs per loop
sage: %timeit bar(q)
The slowest run took 42.67 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 212 ns per loop
sage: q = 4 / 1
sage: %timeit foo(q)
The slowest run took 35.47 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 202 ns per loop
sage: %timeit bar(q)
The slowest run took 37.56 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 292 ns per loop
  }}}
  You might be able to get even a bit more out of this by not going through `numer` and `denom`, but using the actual mpir data.

A cosmetic change:


```diff
-        -  ``m`` - default: natural log base e
+        -  ``m`` -- (default: natural log base `e`) the base
 
-        -  ``prec`` - integer (default: None): if None, return
+        -  ``prec`` -- integer (default: ``None``); if ``None``, return
            symbolic, else to given bits of precision as in RealField
```



---

Comment by rws created at 2016-09-30 06:50:48

This version also looks much better.
----
New commits:


---

Comment by cheuberg created at 2017-01-12 07:02:11

failing doctests (see patchbot).


---

Comment by cheuberg created at 2017-01-12 07:02:11

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-01-15 08:19:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-01-15 08:19:57

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-01-15 16:02:46

Sorry for having this fall off my radar. I made some fixes to the doc and some other small cosmetic changes. If you agree, then you can set a positive review.
----
New commits:


---

Comment by rws created at 2017-01-16 07:17:04

Thanks!


---

Comment by rws created at 2017-01-16 07:17:04

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-01-21 16:35:18

Resolution: fixed
