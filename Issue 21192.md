# Issue 21192: Rational log not working

archive/issues_021192.json:
```json
{
    "body": "\n```\nsage: ZZ(8).log(2)\n3\n\nsage: QQ(8/27).log(2/3)\n...\nAttributeError: 'sage.rings.rational.Rational' object has no attribute 'log'\n```\n\nThis can be done fast using `mpz_remove` (or `ZZ.log`) on numerator and denominator.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21429\n\n",
    "created_at": "2016-09-06T05:41:29Z",
    "labels": [
        "calculus",
        "major",
        "bug"
    ],
    "title": "Rational log not working",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21192",
    "user": "rws"
}
```

```
sage: ZZ(8).log(2)
3

sage: QQ(8/27).log(2/3)
...
AttributeError: 'sage.rings.rational.Rational' object has no attribute 'log'
```

This can be done fast using `mpz_remove` (or `ZZ.log`) on numerator and denominator.

Issue created by migration from https://trac.sagemath.org/ticket/21429





---

archive/issue_comments_293701.json:
```json
{
    "body": "Changing component from calculus to numerical.",
    "created_at": "2016-09-18T07:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21192#issuecomment-293701",
    "user": "rws"
}
```

Changing component from calculus to numerical.



---

archive/issue_comments_293702.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-29T08:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21192#issuecomment-293702",
    "user": "rws"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_293703.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-09-29T08:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21192#issuecomment-293703",
    "user": "rws"
}
```

New commits:



---

archive/issue_comments_293704.json:
```json
{
    "body": "Some micro-optimizations (I slightly care because this could be used in tight loops):\n\n- You call `Rational(m)` twice.\n- You call the `perfect_power` of `anum` and the like twice.\n- `an` (and other like variables) are integers, correct? IIRC, a faster way to construct rational numbers is `Rational(an, bn)`.\n- It is likely faster to extract the numerator and denominator than to use a try/except block:\n  {{{#!sage\nsage: def foo(q):\n....:     try:\n....:         return ZZ(q)\n....:     except (ValueError, TypeError):\n....:         return None\nsage: def bar(q):\n....:     if q.denom() == ZZ.one():\n....:         return q.numer()\n....:     else:\n....:         return None\nsage: q = 4 / 3\nsage: %timeit foo(q)\nThe slowest run took 7.89 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 1.24 \u00b5s per loop\nsage: %timeit bar(q)\nThe slowest run took 42.67 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 212 ns per loop\nsage: q = 4 / 1\nsage: %timeit foo(q)\nThe slowest run took 35.47 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 202 ns per loop\nsage: %timeit bar(q)\nThe slowest run took 37.56 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 292 ns per loop\n  }}}\n  You might be able to get even a bit more out of this by not going through `numer` and `denom`, but using the actual mpir data.\n\nA cosmetic change:\n\n\n```diff\n-        -  ``m`` - default: natural log base e\n+        -  ``m`` -- (default: natural log base `e`) the base\n \n-        -  ``prec`` - integer (default: None): if None, return\n+        -  ``prec`` -- integer (default: ``None``); if ``None``, return\n            symbolic, else to given bits of precision as in RealField\n```\n",
    "created_at": "2016-09-29T14:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21192#issuecomment-293704",
    "user": "tscrim"
}
```

Some micro-optimizations (I slightly care because this could be used in tight loops):

- You call `Rational(m)` twice.
- You call the `perfect_power` of `anum` and the like twice.
- `an` (and other like variables) are integers, correct? IIRC, a faster way to construct rational numbers is `Rational(an, bn)`.
- It is likely faster to extract the numerator and denominator than to use a try/except block:
  {{{#!sage
sage: def foo(q):
....:     try:
....:         return ZZ(q)
....:     except (ValueError, TypeError):
....:         return None
sage: def bar(q):
....:     if q.denom() == ZZ.one():
....:         return q.numer()
....:     else:
....:         return None
sage: q = 4 / 3
sage: %timeit foo(q)
The slowest run took 7.89 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 1.24 Âµs per loop
sage: %timeit bar(q)
The slowest run took 42.67 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 212 ns per loop
sage: q = 4 / 1
sage: %timeit foo(q)
The slowest run took 35.47 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 202 ns per loop
sage: %timeit bar(q)
The slowest run took 37.56 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 292 ns per loop
  }}}
  You might be able to get even a bit more out of this by not going through `numer` and `denom`, but using the actual mpir data.

A cosmetic change:


```diff
-        -  ``m`` - default: natural log base e
+        -  ``m`` -- (default: natural log base `e`) the base
 
-        -  ``prec`` - integer (default: None): if None, return
+        -  ``prec`` -- integer (default: ``None``); if ``None``, return
            symbolic, else to given bits of precision as in RealField
```




---

archive/issue_comments_293705.json:
```json
{
    "body": "This version also looks much better.\n----\nNew commits:",
    "created_at": "2016-09-30T06:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21192#issuecomment-293705",
    "user": "rws"
}
```

This version also looks much better.
----
New commits:



---

archive/issue_comments_293706.json:
```json
{
    "body": "failing doctests (see patchbot).",
    "created_at": "2017-01-12T07:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21192#issuecomment-293706",
    "user": "cheuberg"
}
```

failing doctests (see patchbot).



---

archive/issue_comments_293707.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-01-12T07:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21192#issuecomment-293707",
    "user": "cheuberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_293708.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-15T08:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21192#issuecomment-293708",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_293709.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-15T08:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21192#issuecomment-293709",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_293710.json:
```json
{
    "body": "Sorry for having this fall off my radar. I made some fixes to the doc and some other small cosmetic changes. If you agree, then you can set a positive review.\n----\nNew commits:",
    "created_at": "2017-01-15T16:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21192#issuecomment-293710",
    "user": "tscrim"
}
```

Sorry for having this fall off my radar. I made some fixes to the doc and some other small cosmetic changes. If you agree, then you can set a positive review.
----
New commits:



---

archive/issue_comments_293711.json:
```json
{
    "body": "Thanks!",
    "created_at": "2017-01-16T07:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21192#issuecomment-293711",
    "user": "rws"
}
```

Thanks!



---

archive/issue_comments_293712.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-16T07:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21192#issuecomment-293712",
    "user": "rws"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_293713.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-01-21T16:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21192#issuecomment-293713",
    "user": "vbraun"
}
```

Resolution: fixed
