# Issue 12026: is_squarefree() over multivariate rings does not work

archive/issues_012026.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @malb @burcin jpflori\n\nThe following examples demonstrate the problem:\n\n\n```\nsage: R.<x,y>=PolynomialRing(ZZ,'x','y')\nsage: R(1).is_squarefree()\nFalse\nsage: R(x^2+y^2).is_squarefree()\nFalse\nsage: R(x^2+1).is_squarefree()\nFalse\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12198\n\n",
    "created_at": "2011-12-20T10:54:35Z",
    "labels": [
        "component: please change",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "is_squarefree() over multivariate rings does not work",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12026",
    "user": "https://trac.sagemath.org/admin/accounts/users/MvanBeek"
}
```
Assignee: tbd

CC:  @malb @burcin jpflori

The following examples demonstrate the problem:


```
sage: R.<x,y>=PolynomialRing(ZZ,'x','y')
sage: R(1).is_squarefree()
False
sage: R(x^2+y^2).is_squarefree()
False
sage: R(x^2+1).is_squarefree()
False
```


Issue created by migration from https://trac.sagemath.org/ticket/12198





---

archive/issue_comments_138770.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to algebraic geometry.",
    "created_at": "2011-12-20T13:08:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12026#issuecomment-138770",
    "user": "https://github.com/vbraun"
}
```

Changing component from PLEASE CHANGE to algebraic geometry.



---

archive/issue_comments_138771.json:
```json
{
    "body": "Singular seems to have issues with square-free factorization over ZZ:\n\n```\n                     SINGULAR                                 /  Development\n A Computer Algebra System for Polynomial Computations       /   version 3-1-3\n                                                           0<\n by: W. Decker, G.-M. Greuel, G. Pfister, H. Schoenemann     \\   March 2011\nFB Mathematik der Universitaet, D-67653 Kaiserslautern        \\\n> ring R = integer,(x,y), dp;\n> poly p = x^2+y^2;\n> sqrfree(p);\n   ? not implemented\n   ? error occurred in or before STDIN line 3: `sqrfree(p);`\n```\n\nThis might be implemented in a more recent version, don't know about that. Looking at the Singular source there is a `isSqrFreeZ` function in the factory that should do the right thing. Its not clear to me why the code path doesn't end up there.\n\nOver QQ it works fine:\n\n```\n> ring Q = 0,(x,y),dp;\n> poly p = x^2+y^2;\n> sqrfree(p);\n_[1]=x2+y2\n```\n\nI haven't found a way to test square-freeness (as opposed to compute the squarefree factorization) from the Singular command line, is this function not exposed to the Singular interpreter?",
    "created_at": "2011-12-20T13:08:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12026#issuecomment-138771",
    "user": "https://github.com/vbraun"
}
```

Singular seems to have issues with square-free factorization over ZZ:

```
                     SINGULAR                                 /  Development
 A Computer Algebra System for Polynomial Computations       /   version 3-1-3
                                                           0<
 by: W. Decker, G.-M. Greuel, G. Pfister, H. Schoenemann     \   March 2011
FB Mathematik der Universitaet, D-67653 Kaiserslautern        \
> ring R = integer,(x,y), dp;
> poly p = x^2+y^2;
> sqrfree(p);
   ? not implemented
   ? error occurred in or before STDIN line 3: `sqrfree(p);`
```

This might be implemented in a more recent version, don't know about that. Looking at the Singular source there is a `isSqrFreeZ` function in the factory that should do the right thing. Its not clear to me why the code path doesn't end up there.

Over QQ it works fine:

```
> ring Q = 0,(x,y),dp;
> poly p = x^2+y^2;
> sqrfree(p);
_[1]=x2+y2
```

I haven't found a way to test square-freeness (as opposed to compute the squarefree factorization) from the Singular command line, is this function not exposed to the Singular interpreter?



---

archive/issue_comments_138772.json:
```json
{
    "body": "Changing assignee from tbd to @aghitza.",
    "created_at": "2011-12-20T13:08:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12026#issuecomment-138772",
    "user": "https://github.com/vbraun"
}
```

Changing assignee from tbd to @aghitza.



---

archive/issue_comments_138773.json:
```json
{
    "body": "Changing component from algebraic geometry to basic arithmetic.",
    "created_at": "2011-12-20T14:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12026#issuecomment-138773",
    "user": "https://github.com/burcin"
}
```

Changing component from algebraic geometry to basic arithmetic.



---

archive/issue_comments_138774.json:
```json
{
    "body": "Integer coefficients are relatively new in Singular. Many fuctions do not work with them. In this case, Singular raises an error using a callback function (see `sage.libs.singular.singular.libsingular_error_callback`). Unfortunately we do not check for it and return wrong results.\n\nA workaround, suggested by Martin Lee, for this immediate problem is to `change_ring(QQ)` and call `is_squarefree()` there.\n\nIf there isn't a ticket already about handling errors raised in libsingular, we should open one. Note that the magical function interface (the one you get through `sage.libs.singular.ff.*`) can handle Singular errors. It's only direct C library calls that should check explicitly if Singular raised an error. Perhaps we can solve it by wrapping the declarations in `sage/libs/singular/singular-cdefs.pxi` in a preprocessor macro which calls `PyErr_Occured()` after raising an exception in `libsingular_error_callback()`.",
    "created_at": "2011-12-20T14:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12026#issuecomment-138774",
    "user": "https://github.com/burcin"
}
```

Integer coefficients are relatively new in Singular. Many fuctions do not work with them. In this case, Singular raises an error using a callback function (see `sage.libs.singular.singular.libsingular_error_callback`). Unfortunately we do not check for it and return wrong results.

A workaround, suggested by Martin Lee, for this immediate problem is to `change_ring(QQ)` and call `is_squarefree()` there.

If there isn't a ticket already about handling errors raised in libsingular, we should open one. Note that the magical function interface (the one you get through `sage.libs.singular.ff.*`) can handle Singular errors. It's only direct C library calls that should check explicitly if Singular raised an error. Perhaps we can solve it by wrapping the declarations in `sage/libs/singular/singular-cdefs.pxi` in a preprocessor macro which calls `PyErr_Occured()` after raising an exception in `libsingular_error_callback()`.



---

archive/issue_comments_138775.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2011-12-20T14:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12026#issuecomment-138775",
    "user": "https://github.com/burcin"
}
```

Changing priority from major to critical.



---

archive/issue_comments_138776.json:
```json
{
    "body": "Changing keywords from \"\" to \"squarefree, singular\".",
    "created_at": "2011-12-20T14:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12026#issuecomment-138776",
    "user": "https://github.com/burcin"
}
```

Changing keywords from "" to "squarefree, singular".



---

archive/issue_comments_138777.json:
```json
{
    "body": "the same problem happens over finite fields:\n\n```\nsage: R.<x,y> = GF(2)[]\nsage: f=x+y\nsage: f.is_squarefree()\nFalse\n```\n\nIf `is_squarefree` is wrong, it should be simply disabled.\n\nSee also #12404.\n\nPaul",
    "created_at": "2012-05-11T07:17:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12026#issuecomment-138777",
    "user": "https://github.com/zimmermann6"
}
```

the same problem happens over finite fields:

```
sage: R.<x,y> = GF(2)[]
sage: f=x+y
sage: f.is_squarefree()
False
```

If `is_squarefree` is wrong, it should be simply disabled.

See also #12404.

Paul



---

archive/issue_comments_138778.json:
```json
{
    "body": "see also #12129.\n\nPaul",
    "created_at": "2012-05-11T07:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12026#issuecomment-138778",
    "user": "https://github.com/zimmermann6"
}
```

see also #12129.

Paul



---

archive/issue_comments_138779.json:
```json
{
    "body": "The Singular error output has changed in 4.0.0:\n\n```\n                     SINGULAR                                 /  Development\n A Computer Algebra System for Polynomial Computations       /   version 4.0.0\n                                                           0<\n by: W. Decker, G.-M. Greuel, G. Pfister, H. Schoenemann     \\   Dec 2013\nFB Mathematik der Universitaet, D-67653 Kaiserslautern        \\\n// ** executing /home/ralf/Sources-Singular_4.0.0/Singular/LIB/.singularrc\n> ring R = integer,(x,y), dp;\n> poly p = x^2+y^2;\n> sqrfree(p);\n   ? not implemented for rings with rings as coeffients\n   ? error occurred in or before STDIN line 3: `sqrfree(p);`\n```\n",
    "created_at": "2014-03-01T08:27:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12026#issuecomment-138779",
    "user": "https://github.com/rwst"
}
```

The Singular error output has changed in 4.0.0:

```
                     SINGULAR                                 /  Development
 A Computer Algebra System for Polynomial Computations       /   version 4.0.0
                                                           0<
 by: W. Decker, G.-M. Greuel, G. Pfister, H. Schoenemann     \   Dec 2013
FB Mathematik der Universitaet, D-67653 Kaiserslautern        \
// ** executing /home/ralf/Sources-Singular_4.0.0/Singular/LIB/.singularrc
> ring R = integer,(x,y), dp;
> poly p = x^2+y^2;
> sqrfree(p);
   ? not implemented for rings with rings as coeffients
   ? error occurred in or before STDIN line 3: `sqrfree(p);`
```




---

archive/issue_comments_138780.json:
```json
{
    "body": "This can surely be closed since the incorrect results reported are now computed correctly.  Same at #12129.",
    "created_at": "2017-11-12T13:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12026#issuecomment-138780",
    "user": "https://github.com/JohnCremona"
}
```

This can surely be closed since the incorrect results reported are now computed correctly.  Same at #12129.



---

archive/issue_comments_138781.json:
```json
{
    "body": "Agreed.",
    "created_at": "2017-11-13T00:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12026#issuecomment-138781",
    "user": "https://github.com/tscrim"
}
```

Agreed.



---

archive/issue_comments_138782.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-11-13T00:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12026#issuecomment-138782",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_138783.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-13T00:53:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12026#issuecomment-138783",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_138784.json:
```json
{
    "body": "A doctest is being added at #12129 which covers this too.",
    "created_at": "2017-11-13T09:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12026#issuecomment-138784",
    "user": "https://github.com/JohnCremona"
}
```

A doctest is being added at #12129 which covers this too.



---

archive/issue_comments_138785.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2017-12-12T08:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12026",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12026#issuecomment-138785",
    "user": "https://github.com/embray"
}
```

Resolution: wontfix



---

archive/issue_events_012062.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:23:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12026",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12026#event-12062"
}
```
