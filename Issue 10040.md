# Issue 10040: Doctest failure in sage/tensor/differential_forms.py

archive/issues_010040.json:
```json
{
    "body": "Assignee: mvngu\n\nCC:  jason jvkersch mhampton niles\n\nWith the forthcoming 4.6.alpha2, I get this doctest failure on the Skynet machines cicero (x86-Linux-pentium4-fc) and fulvia (x86_64-SunOS-core2):\n\n```python\nsage -t -long \"devel/sage/sage/tensor/differential_forms.py\"\n**********************************************************************\nFile \"/home/mpatel/build/cicero/sage-4.6.alpha2/devel/sage/sage/tensor/differential_forms.py\", line 132:\n    sage: cmp(F, G)\nExpected:\n    1\nGot:\n    -1\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/10041\n\n",
    "created_at": "2010-09-30T21:43:00Z",
    "labels": [
        "doctest coverage",
        "blocker",
        "bug"
    ],
    "title": "Doctest failure in sage/tensor/differential_forms.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10040",
    "user": "mpatel"
}
```
Assignee: mvngu

CC:  jason jvkersch mhampton niles

With the forthcoming 4.6.alpha2, I get this doctest failure on the Skynet machines cicero (x86-Linux-pentium4-fc) and fulvia (x86_64-SunOS-core2):

```python
sage -t -long "devel/sage/sage/tensor/differential_forms.py"
**********************************************************************
File "/home/mpatel/build/cicero/sage-4.6.alpha2/devel/sage/sage/tensor/differential_forms.py", line 132:
    sage: cmp(F, G)
Expected:
    1
Got:
    -1
```


Issue created by migration from https://trac.sagemath.org/ticket/10041





---

archive/issue_comments_101064.json:
```json
{
    "body": "I will need to think some more about this.  After hearing about this bug, I built 4.6.alpha2 on my Mac OS 10.6 machine and ran the doctests there, all of which passed without errors.\n\n\n```\n./sage -t -long \"devel/sage/sage/tensor/differential_forms.py\"\nsage -t -long \"devel/sage/sage/tensor/differential_forms.py\"\n\t [4.8 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 4.8 seconds\n```\n\n\nI am currently building Sage on my Linux machine and hope to be able to reproduce that bug shortly.  In the meantime, could this be due to `cmp` behaving differently on different platforms?  This would seem very weird to me...",
    "created_at": "2010-10-01T17:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10040#issuecomment-101064",
    "user": "jvkersch"
}
```

I will need to think some more about this.  After hearing about this bug, I built 4.6.alpha2 on my Mac OS 10.6 machine and ran the doctests there, all of which passed without errors.


```
./sage -t -long "devel/sage/sage/tensor/differential_forms.py"
sage -t -long "devel/sage/sage/tensor/differential_forms.py"
	 [4.8 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 4.8 seconds
```


I am currently building Sage on my Linux machine and hope to be able to reproduce that bug shortly.  In the meantime, could this be due to `cmp` behaving differently on different platforms?  This would seem very weird to me...



---

archive/issue_comments_101065.json:
```json
{
    "body": "The problem seems to be in the coordinate patch code, I think.\n\nNotice that:\n\n\n```\nsage: var('x,y,z')\n(x, y, z)\nsage: (x,y,z)<(y,x,z)\nx < y\n```\n\n\nI think that comparing tuples of symbolic variables is not well-defined.  Instead, you might compare strings (i.e., call str() on each tuple)",
    "created_at": "2010-10-01T18:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10040#issuecomment-101065",
    "user": "jason"
}
```

The problem seems to be in the coordinate patch code, I think.

Notice that:


```
sage: var('x,y,z')
(x, y, z)
sage: (x,y,z)<(y,x,z)
x < y
```


I think that comparing tuples of symbolic variables is not well-defined.  Instead, you might compare strings (i.e., call str() on each tuple)



---

archive/issue_comments_101066.json:
```json
{
    "body": "Do you really want to force an order on these things, or would it be enough to only define an equality-checking function?",
    "created_at": "2010-10-01T18:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10040#issuecomment-101066",
    "user": "jason"
}
```

Do you really want to force an order on these things, or would it be enough to only define an equality-checking function?



---

archive/issue_comments_101067.json:
```json
{
    "body": "Thanks Jason!  I am uploading a patch to convert the tuples of coordinates to strings before comparing and I hope this solves the issue.  I'm not sure we should ignore the order in coordinate tuples.  For instance, T(T*Q) has natural bundle coordinates (q, p, q', p') whereas T*(TQ) naturally has coordinates (q, q', p, p').  The two bundles are isomorphic by switching the relevant coordinates, but it would be good to keep the distinction.\n\nTime permitting, I will build Sage again on my Linux machine to make sure that the issue is resolved.",
    "created_at": "2010-10-01T19:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10040#issuecomment-101067",
    "user": "jvkersch"
}
```

Thanks Jason!  I am uploading a patch to convert the tuples of coordinates to strings before comparing and I hope this solves the issue.  I'm not sure we should ignore the order in coordinate tuples.  For instance, T(T*Q) has natural bundle coordinates (q, p, q', p') whereas T*(TQ) naturally has coordinates (q, q', p, p').  The two bundles are isomorphic by switching the relevant coordinates, but it would be good to keep the distinction.

Time permitting, I will build Sage again on my Linux machine to make sure that the issue is resolved.



---

archive/issue_comments_101068.json:
```json
{
    "body": "Attachment [trac_10041_doctest_failure_differential_forms.patch](tarball://root/attachments/some-uuid/ticket10041/trac_10041_doctest_failure_differential_forms.patch) by jhpalmieri created at 2010-10-01 19:55:01\n\nThe failing doctest now passes for me on cicero and fulvia.  If someone else can confirm that it passes on some other machines (on ones where it passed before, we should make sure it still passes), feel free to give it a positive review.\n\nShould this ticket be marked as \"needs review\"?",
    "created_at": "2010-10-01T19:55:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10040#issuecomment-101068",
    "user": "jhpalmieri"
}
```

Attachment [trac_10041_doctest_failure_differential_forms.patch](tarball://root/attachments/some-uuid/ticket10041/trac_10041_doctest_failure_differential_forms.patch) by jhpalmieri created at 2010-10-01 19:55:01

The failing doctest now passes for me on cicero and fulvia.  If someone else can confirm that it passes on some other machines (on ones where it passed before, we should make sure it still passes), feel free to give it a positive review.

Should this ticket be marked as "needs review"?



---

archive/issue_comments_101069.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-10-01T20:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10040#issuecomment-101069",
    "user": "jason"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_101070.json:
```json
{
    "body": "Replying to [comment:5 jvkersch]:\n> Thanks Jason!  I am uploading a patch to convert the tuples of coordinates to strings before comparing and I hope this solves the issue.  I'm not sure we should ignore the order in coordinate tuples.  For instance, T(T*Q) has natural bundle coordinates (q, p, q', p') whereas T*(TQ) naturally has coordinates (q, q', p, p').  The two bundles are isomorphic by switching the relevant coordinates, but it would be good to keep the distinction.\n> \n\nI meant, do you want to force a total order on the set of coordinates?  In other words, what does (q,q',p,p')<(q,p,q',p') mean?  Or do you just want to have equality testing, i.e., you can tell that (q,q',p,p') != (q,p,q',p')?\n\nRegardless, I think resolving that design issue should be a separate ticket.",
    "created_at": "2010-10-01T20:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10040#issuecomment-101070",
    "user": "jason"
}
```

Replying to [comment:5 jvkersch]:
> Thanks Jason!  I am uploading a patch to convert the tuples of coordinates to strings before comparing and I hope this solves the issue.  I'm not sure we should ignore the order in coordinate tuples.  For instance, T(T*Q) has natural bundle coordinates (q, p, q', p') whereas T*(TQ) naturally has coordinates (q, q', p, p').  The two bundles are isomorphic by switching the relevant coordinates, but it would be good to keep the distinction.
> 

I meant, do you want to force a total order on the set of coordinates?  In other words, what does (q,q',p,p')<(q,p,q',p') mean?  Or do you just want to have equality testing, i.e., you can tell that (q,q',p,p') != (q,p,q',p')?

Regardless, I think resolving that design issue should be a separate ticket.



---

archive/issue_comments_101071.json:
```json
{
    "body": "Replying to [comment:7 jason]:\n> \n> I meant, do you want to force a total order on the set of coordinates? \n>\n\nGood point -- that wouldn't make sense indeed.\n\n> \n> Regardless, I think resolving that design issue should be a separate ticket.\n> \n\nI've put this up for review as #10053.  This patch just takes out the calls to the `__cmp__` member functions and replaces them with equivalent calls to `__eq__`.",
    "created_at": "2010-10-02T00:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10040#issuecomment-101071",
    "user": "jvkersch"
}
```

Replying to [comment:7 jason]:
> 
> I meant, do you want to force a total order on the set of coordinates? 
>

Good point -- that wouldn't make sense indeed.

> 
> Regardless, I think resolving that design issue should be a separate ticket.
> 

I've put this up for review as #10053.  This patch just takes out the calls to the `__cmp__` member functions and replaces them with equivalent calls to `__eq__`.



---

archive/issue_comments_101072.json:
```json
{
    "body": "I also see this on OpenSolaris on x86 on the clean 4.6.alpha1 code. I don't feel able to comment on the patches. \n\n\n```\nsage -t  -long devel/sage/sage/tensor/differential_forms.py\n**********************************************************************\nFile \"/export/home/drkirkby/sage-4.6.alpha2/devel/sage-main/sage/tensor/differential_forms.py\", line 132:\n    sage: cmp(F, G)\nExpected:\n    1\nGot:\n    -1\n**********************************************************************\n1 items had failures:\n   1 of  11 in __main__.example_3\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /export/home/drkirkby/.sage//tmp/.doctest_differential_forms.py\n```\n",
    "created_at": "2010-10-02T16:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10040#issuecomment-101072",
    "user": "drkirkby"
}
```

I also see this on OpenSolaris on x86 on the clean 4.6.alpha1 code. I don't feel able to comment on the patches. 


```
sage -t  -long devel/sage/sage/tensor/differential_forms.py
**********************************************************************
File "/export/home/drkirkby/sage-4.6.alpha2/devel/sage-main/sage/tensor/differential_forms.py", line 132:
    sage: cmp(F, G)
Expected:
    1
Got:
    -1
**********************************************************************
1 items had failures:
   1 of  11 in __main__.example_3
***Test Failed*** 1 failures.
For whitespace errors, see the file /export/home/drkirkby/.sage//tmp/.doctest_differential_forms.py
```




---

archive/issue_comments_101073.json:
```json
{
    "body": "The patch works for me (tests in that one file pass, which used to fail);  I have not tested the whole library, just sage/tensor/*.  This is on 32-bit ubuntu.",
    "created_at": "2010-10-03T11:02:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10040#issuecomment-101073",
    "user": "cremona"
}
```

The patch works for me (tests in that one file pass, which used to fail);  I have not tested the whole library, just sage/tensor/*.  This is on 32-bit ubuntu.



---

archive/issue_comments_101074.json:
```json
{
    "body": "For what it's worth, `make ptestlong` tells me that all tests passed on my 64bit Linux machine (CentOS Linux 5.5).",
    "created_at": "2010-10-04T23:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10040#issuecomment-101074",
    "user": "jvkersch"
}
```

For what it's worth, `make ptestlong` tells me that all tests passed on my 64bit Linux machine (CentOS Linux 5.5).



---

archive/issue_comments_101075.json:
```json
{
    "body": "I applied this patch, and the one at #10053.  With these, sage passes all (`-long`) doctests (linux, with Red Hat Enterprise).  Note that the remaining issue, [comment 9](http://trac.sagemath.org/sage_trac/ticket/10041#comment:9) above, appears because this patch addresses comparison only for coordinate patches, not differential form algebras or differential form elements.  Since these *are* addressed by #10053, this ticket can get positive review when that one does.",
    "created_at": "2010-10-05T14:58:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10040#issuecomment-101075",
    "user": "niles"
}
```

I applied this patch, and the one at #10053.  With these, sage passes all (`-long`) doctests (linux, with Red Hat Enterprise).  Note that the remaining issue, [comment 9](http://trac.sagemath.org/sage_trac/ticket/10041#comment:9) above, appears because this patch addresses comparison only for coordinate patches, not differential form algebras or differential form elements.  Since these *are* addressed by #10053, this ticket can get positive review when that one does.



---

archive/issue_comments_101076.json:
```json
{
    "body": "Replying to [comment:12 niles]:\n> I applied this patch, and the one at #10053.  With these, sage passes all (`-long`) doctests (linux, with Red Hat Enterprise).  Note that the remaining issue, [comment 9](http://trac.sagemath.org/sage_trac/ticket/10041#comment:9) above, appears because this patch addresses comparison only for coordinate patches, not differential form algebras or differential form elements.  Since these *are* addressed by #10053, this ticket can get positive review when that one does.\n\n\n#10053 now has positive review.",
    "created_at": "2010-10-11T21:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10040#issuecomment-101076",
    "user": "niles"
}
```

Replying to [comment:12 niles]:
> I applied this patch, and the one at #10053.  With these, sage passes all (`-long`) doctests (linux, with Red Hat Enterprise).  Note that the remaining issue, [comment 9](http://trac.sagemath.org/sage_trac/ticket/10041#comment:9) above, appears because this patch addresses comparison only for coordinate patches, not differential form algebras or differential form elements.  Since these *are* addressed by #10053, this ticket can get positive review when that one does.


#10053 now has positive review.



---

archive/issue_comments_101077.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-10-11T21:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10040#issuecomment-101077",
    "user": "niles"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_101078.json:
```json
{
    "body": "Just for the record:\n\nI now get this doctest error after upgrade-testing (#9896) with Sage 4.6.alpha3 (in-place upgrade from 4.5.3) on Ubuntu 9.04 x86, Pentium4 Prescott with SSE enabled (in CFLAGS and CXXFLAGS).\n\nIn the build from scratch on the same machine, with the same settings, I didn't get that error.",
    "created_at": "2010-10-21T02:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10040#issuecomment-101078",
    "user": "leif"
}
```

Just for the record:

I now get this doctest error after upgrade-testing (#9896) with Sage 4.6.alpha3 (in-place upgrade from 4.5.3) on Ubuntu 9.04 x86, Pentium4 Prescott with SSE enabled (in CFLAGS and CXXFLAGS).

In the build from scratch on the same machine, with the same settings, I didn't get that error.



---

archive/issue_comments_101079.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-10-21T08:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10040",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10040#issuecomment-101079",
    "user": "mpatel"
}
```

Resolution: fixed
