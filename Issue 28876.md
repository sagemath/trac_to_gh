# Issue 28876: Reimplement `sage -i SPKG` as `configure --enable-SPKG && make build`

archive/issues_028876.json:
```json
{
    "body": "CC:  @dimpase @embray @jhpalmieri\n\n#28095 adds `configure --enable-SPKG`.\n\nAs a follow-up, using this new interface we reimplement `sage -i`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29113\n\n",
    "created_at": "2020-01-30T17:50:26Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Reimplement `sage -i SPKG` as `configure --enable-SPKG && make build`",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28876",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @dimpase @embray @jhpalmieri

#28095 adds `configure --enable-SPKG`.

As a follow-up, using this new interface we reimplement `sage -i`.

Issue created by migration from https://trac.sagemath.org/ticket/29113





---

archive/issue_comments_408283.json:
```json
{
    "body": "Ah, I misread this at first--I thought you were proposing to *replace* `sage -i` as the way to install optional packages.\n\nIf I understand correctly though, you are just proposing a change to how it works internally.  If so I'm +1.",
    "created_at": "2020-01-31T14:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28876#issuecomment-408283",
    "user": "https://github.com/embray"
}
```

Ah, I misread this at first--I thought you were proposing to *replace* `sage -i` as the way to install optional packages.

If I understand correctly though, you are just proposing a change to how it works internally.  If so I'm +1.



---

archive/issue_comments_408284.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-03-18T21:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28876#issuecomment-408284",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_408285.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-18T21:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28876#issuecomment-408285",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_408286.json:
```json
{
    "body": "I took a fresh tarball and merged this branch. When I ran `./sage -i meataxe`, it ran `configure` three times in a row. Is this expected?",
    "created_at": "2020-03-23T21:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28876#issuecomment-408286",
    "user": "https://github.com/jhpalmieri"
}
```

I took a fresh tarball and merged this branch. When I ran `./sage -i meataxe`, it ran `configure` three times in a row. Is this expected?



---

archive/issue_comments_408287.json:
```json
{
    "body": "By the way, after running `./sage -i meataxe` or `./configure --enable-meataxe`, `config.log` still says\n\n```\nconfigure:30333: result: meataxe-1.0.p0: does not support check for system package; optional, use \"./configure --enable-meataxe\" to install\n```\n\nIt would be nice if this actually noted that the user has requested its installation.",
    "created_at": "2020-03-23T22:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28876#issuecomment-408287",
    "user": "https://github.com/jhpalmieri"
}
```

By the way, after running `./sage -i meataxe` or `./configure --enable-meataxe`, `config.log` still says

```
configure:30333: result: meataxe-1.0.p0: does not support check for system package; optional, use "./configure --enable-meataxe" to install
```

It would be nice if this actually noted that the user has requested its installation.



---

archive/issue_comments_408288.json:
```json
{
    "body": "Replying to [comment:6 jhpalmieri]:\n> I took a fresh tarball and merged this branch. When I ran `./sage -i meataxe`, it ran `configure` three times in a row. Is this expected?\nThat's clearly too much.",
    "created_at": "2020-03-23T22:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28876#issuecomment-408288",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:6 jhpalmieri]:
> I took a fresh tarball and merged this branch. When I ran `./sage -i meataxe`, it ran `configure` three times in a row. Is this expected?
That's clearly too much.



---

archive/issue_comments_408289.json:
```json
{
    "body": "Replying to [comment:7 jhpalmieri]:\n> By the way, after running `./sage -i meataxe` or `./configure --enable-meataxe`, `config.log` still says\n> {{{\n> configure:30333: result: meataxe-1.0.p0: does not support check for system package; optional, use \"./configure --enable-meataxe\" to install\n> }}}\n> It would be nice if this actually noted that the user has requested its installation.\nThat's #29363 \"At the end of configure, indicate which optional/experimental packages are configured to be installed\"",
    "created_at": "2020-03-23T22:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28876#issuecomment-408289",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:7 jhpalmieri]:
> By the way, after running `./sage -i meataxe` or `./configure --enable-meataxe`, `config.log` still says
> {{{
> configure:30333: result: meataxe-1.0.p0: does not support check for system package; optional, use "./configure --enable-meataxe" to install
> }}}
> It would be nice if this actually noted that the user has requested its installation.
That's #29363 "At the end of configure, indicate which optional/experimental packages are configured to be installed"



---

archive/issue_comments_408290.json:
```json
{
    "body": "Replying to [comment:8 mkoeppe]:\n> Replying to [comment:6 jhpalmieri]:\n> > I took a fresh tarball and merged this branch. When I ran `./sage -i meataxe`, it ran `configure` three times in a row. Is this expected?\n> That's clearly too much.\n\nWith a fully built Sage, running `./sage -i -p_group_cohomology` just ran `configure` once.\n\nLet me clarify about the other case. I took a fresh tarball for *9.1.beta8*, got this branch and ran `git rebase develop`. That's when `configure` ran three times. The first time:\n\n```\n% ./sage -i meataxe                           \nmake -j6 build/make/Makefile --stop\nmake[1]: warning: -jN forced in submake: disabling jobserver mode.\nrm -f config.log\nmkdir -p logs/pkgs\nln -s logs/pkgs/config.log config.log\nchecking for a BSD-compatible install... /usr/bin/install -c\nchecking whether build environment is sane... yes\nchecking for a thread-safe mkdir -p... config/install-sh -c -d\nchecking for gawk... no\n...\n```\n\nThe second time:\n\n```\nreal\t0m0.206s\nuser\t0m0.156s\nsys\t0m0.038s\nSage build/upgrade complete!\n\nrunning ./configure   '--enable-meataxe'\nchecking for a BSD-compatible install... /usr/bin/install -c\nchecking whether build environment is sane... yes\nchecking for a thread-safe mkdir -p... config/install-sh -c -d\nchecking for gawk... no\n```\n\nThe third time:\n\n```\nchecking for the package system in use... homebrew\nconfigure: No equivalent system packages for homebrew are known to Sage\nmake -j6 build/make/Makefile --stop\nmake[1]: warning: -jN forced in submake: disabling jobserver mode.\nrm -f config.log\nmkdir -p logs/pkgs\nln -s logs/pkgs/config.log config.log\nrunning CONFIG_SHELL=/bin/sh /bin/sh ./configure --enable-meataxe --no-create --no-recursion\nchecking for a BSD-compatible install... /usr/bin/install -c\nchecking whether build environment is sane... yes\nchecking for a thread-safe mkdir -p... config/install-sh -c -d\nchecking for gawk... no\n```\n\nIf I start with a 9.1.beta7 tarball and use this branch, `configure` only runs twice.",
    "created_at": "2020-03-23T23:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28876#issuecomment-408290",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:8 mkoeppe]:
> Replying to [comment:6 jhpalmieri]:
> > I took a fresh tarball and merged this branch. When I ran `./sage -i meataxe`, it ran `configure` three times in a row. Is this expected?
> That's clearly too much.

With a fully built Sage, running `./sage -i -p_group_cohomology` just ran `configure` once.

Let me clarify about the other case. I took a fresh tarball for *9.1.beta8*, got this branch and ran `git rebase develop`. That's when `configure` ran three times. The first time:

```
% ./sage -i meataxe                           
make -j6 build/make/Makefile --stop
make[1]: warning: -jN forced in submake: disabling jobserver mode.
rm -f config.log
mkdir -p logs/pkgs
ln -s logs/pkgs/config.log config.log
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... config/install-sh -c -d
checking for gawk... no
...
```

The second time:

```
real	0m0.206s
user	0m0.156s
sys	0m0.038s
Sage build/upgrade complete!

running ./configure   '--enable-meataxe'
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... config/install-sh -c -d
checking for gawk... no
```

The third time:

```
checking for the package system in use... homebrew
configure: No equivalent system packages for homebrew are known to Sage
make -j6 build/make/Makefile --stop
make[1]: warning: -jN forced in submake: disabling jobserver mode.
rm -f config.log
mkdir -p logs/pkgs
ln -s logs/pkgs/config.log config.log
running CONFIG_SHELL=/bin/sh /bin/sh ./configure --enable-meataxe --no-create --no-recursion
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... config/install-sh -c -d
checking for gawk... no
```

If I start with a 9.1.beta7 tarball and use this branch, `configure` only runs twice.



---

archive/issue_comments_408291.json:
```json
{
    "body": "these multiple runs of configure, in some cases up to 3 times, also happen without this branch. so this is not a regression.",
    "created_at": "2020-03-24T02:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28876#issuecomment-408291",
    "user": "https://github.com/dimpase"
}
```

these multiple runs of configure, in some cases up to 3 times, also happen without this branch. so this is not a regression.



---

archive/issue_comments_408292.json:
```json
{
    "body": "Replying to [comment:11 dimpase]:\n> these multiple runs of configure, in some cases up to 3 times, also happen without this branch. so this is not a regression.\nI agree. But independent of this ticket, we should probably look at some point how to clean this up a bit.",
    "created_at": "2020-03-24T02:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28876#issuecomment-408292",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:11 dimpase]:
> these multiple runs of configure, in some cases up to 3 times, also happen without this branch. so this is not a regression.
I agree. But independent of this ticket, we should probably look at some point how to clean this up a bit.



---

archive/issue_comments_408293.json:
```json
{
    "body": "Well, I'm happy with this. Positive review from me. Dima (or `@`embray, if you're active these days), if you want to look at it more, feel free to set back to needs review.",
    "created_at": "2020-03-24T02:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28876#issuecomment-408293",
    "user": "https://github.com/jhpalmieri"
}
```

Well, I'm happy with this. Positive review from me. Dima (or `@`embray, if you're active these days), if you want to look at it more, feel free to set back to needs review.



---

archive/issue_comments_408294.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-24T02:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28876#issuecomment-408294",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_408295.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-29T00:24:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28876#issuecomment-408295",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_026706.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-29T00:24:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28876",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28876#event-26706"
}
```
