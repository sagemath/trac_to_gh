# Issue 21772: sage -t src/sage/misc/latex.py opens 2 sage.pdf file

Issue created by migration from https://trac.sagemath.org/ticket/22009

Original creator: slabbe

Original creation time: 2016-12-02 07:20:33

CC:  moritz jepperlein

This was introduced in #21947.


---

Comment by slabbe created at 2016-12-02 07:30:40

Changing status from new to needs_review.


---

Comment by slabbe created at 2016-12-02 07:30:40

New commits:


---

Comment by fbissey created at 2016-12-02 07:37:16

Something that happened to me with those tests as well is that I got a more verbose output the first time

```
File "/usr/lib64/python2.7/site-packages/sage/misc/latex.py", line 2157, in sage.misc.latex.?
Failed example:
    view(4, margin=5, debug=True)
Expected:
    \documentclass{article}
    ...
    \usepackage[tightpage,active]{preview}
    \PreviewEnvironment{page}
    \setlength\PreviewBorder{5.000000mm}
    \begin{document}\begin{page}$4$\end{page}
    \end{document}
    ...
Got:
    This is XeTeX, Version 3.14159265-2.6-0.99991 (TeX Live 2014) (preloaded format=xelatex)
     restricted \write18 enabled.
    entering extended mode
    LaTeX2e <2014/05/01>
    Babel <3.9l> and hyphenation patterns for 48 languages loaded.
...
```

It ends up being a super set of the expected output. I didn't get it when running the test remotely. I will have to check if you need to be on the machine to see that.


---

Comment by slabbe created at 2016-12-02 08:11:42

It must be because of the `debug=True` option that is given to many subcommands in the view function. What does `debug=True` mean anyway, printing which info? Since it is not well defined, it seems not the proper way to doctest the view function.

Also, we do not know where the .tex and the .pdf files are generated. And there is no way to run the view function without opening the generated .pdf file. So, it is difficult to test the `view` function properly.

Personnally, I will not spend to much time trying to improve how `view` is tested. I would rather replace `view` by something more object oriented like [slabbe/tikz_picture.py](https://github.com/seblabbe/slabbe/blob/master/slabbe/tikz_picture.py). I intend to make the module `tikz_picture.py` in my package more general during the next year. Then, I will propose, if there is interest, to include this into Sage.


---

Comment by fbissey created at 2016-12-02 08:17:25

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2016-12-02 08:17:25

OK, in any case the change is rather trivial. I don't like seeing windows poping up either in the middle of what I am doing because doctests are running in the background. Which is exactly what happened to me this afternoon.

Can you fill in the author section please.


---

Comment by jepperlein created at 2016-12-02 08:23:47

I fully agree with slabbe's statement, view is definitely the wrong place to generate latex code, as it can for example not be tested without popping up windows. Sorry for introducing this doctest.


---

Comment by jdemeyer created at 2016-12-03 16:25:50

Changing priority from major to blocker.


---

Comment by vbraun created at 2016-12-05 00:44:34

Resolution: fixed
