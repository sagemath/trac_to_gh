# Issue 15765: matplotlib-1.3.1 does not install

archive/issues_015765.json:
```json
{
    "body": "CC:  jason vbraun fbissey jhpalmieri\n\nKeywords: install, package, matplotlib\n\nThis breaks the upgrade to 6.2.beta5.\n\nLogfile: https://www.dropbox.com/s/wmfrp13mnm148i1/matplotlib-1.3.1.log\n\nSystem is Ubuntu 12.04.4 LTS in a virtualbox on a 64bit machine. Would upgrading help?\n\nIssue created by migration from https://trac.sagemath.org/ticket/16002\n\n",
    "created_at": "2014-03-23T22:27:44Z",
    "labels": [
        "packages: standard",
        "critical",
        "bug"
    ],
    "title": "matplotlib-1.3.1 does not install",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15765",
    "user": "darij"
}
```
CC:  jason vbraun fbissey jhpalmieri

Keywords: install, package, matplotlib

This breaks the upgrade to 6.2.beta5.

Logfile: https://www.dropbox.com/s/wmfrp13mnm148i1/matplotlib-1.3.1.log

System is Ubuntu 12.04.4 LTS in a virtualbox on a 64bit machine. Would upgrading help?

Issue created by migration from https://trac.sagemath.org/ticket/16002





---

archive/issue_comments_204167.json:
```json
{
    "body": "Hum...\n\n```\nbuilding 'matplotlib.ft2font' extension\ncreating build/temp.linux-i686-2.7\ncreating build/temp.linux-i686-2.7/src\ncreating build/temp.linux-i686-2.7/CXX\ngcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -DPY_ARRAY_UNIQUE_SYMBOL=MPL_matplotlib_ft2font_ARRAY_API -DPYCXX_ISO_CPP_LIB=1 -I/home/darij/gitsage/sage-5.13.beta1/local/lib/python2.7/site-packages/numpy/core/include -I/home/darij/gitsage/sage-5.13.beta1/local/include -I. -I/home/darij/gitsage/sage-5.13.beta1/local/include/freetype2 -I/home/darij/gitsage/sage-5.13.beta1/local/include/python2.7 -c src/ft2font.cpp -o build/temp.linux-i686-2.7/src/ft2font.o\nIn file included from src/ft2font.h:16:0,\n                 from src/ft2font.cpp:3:\n/home/darij/gitsage/sage-5.13.beta1/local/include/ft2build.h\n:56:38: fatal error: freetype/config/ftheader.h: No such file or directory\ncompilation terminated.\nerror: command 'gcc' failed with exit status 1\n```\n\nWhen you say upgrading, you mean from sage 5.13? Then yes definitely. Or was this upgraded in place numerous times?\nIt looks to me like there is cruft in your install:\n\n\n```\n/home/darij/gitsage/sage-5.13.beta1/local/include/ft2build.h\n```\n\nis not in this location in my sage install but in the freetype2 sub-folder. If you one in the this sub folder consider removing the one in local/include and try again.",
    "created_at": "2014-03-23T22:39:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204167",
    "user": "fbissey"
}
```

Hum...

```
building 'matplotlib.ft2font' extension
creating build/temp.linux-i686-2.7
creating build/temp.linux-i686-2.7/src
creating build/temp.linux-i686-2.7/CXX
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -DPY_ARRAY_UNIQUE_SYMBOL=MPL_matplotlib_ft2font_ARRAY_API -DPYCXX_ISO_CPP_LIB=1 -I/home/darij/gitsage/sage-5.13.beta1/local/lib/python2.7/site-packages/numpy/core/include -I/home/darij/gitsage/sage-5.13.beta1/local/include -I. -I/home/darij/gitsage/sage-5.13.beta1/local/include/freetype2 -I/home/darij/gitsage/sage-5.13.beta1/local/include/python2.7 -c src/ft2font.cpp -o build/temp.linux-i686-2.7/src/ft2font.o
In file included from src/ft2font.h:16:0,
                 from src/ft2font.cpp:3:
/home/darij/gitsage/sage-5.13.beta1/local/include/ft2build.h
:56:38: fatal error: freetype/config/ftheader.h: No such file or directory
compilation terminated.
error: command 'gcc' failed with exit status 1
```

When you say upgrading, you mean from sage 5.13? Then yes definitely. Or was this upgraded in place numerous times?
It looks to me like there is cruft in your install:


```
/home/darij/gitsage/sage-5.13.beta1/local/include/ft2build.h
```

is not in this location in my sage install but in the freetype2 sub-folder. If you one in the this sub folder consider removing the one in local/include and try again.



---

archive/issue_comments_204168.json:
```json
{
    "body": "OK, I'm going to reinstall. I'm upgrading sage from 6.2beta4, but you're right in that this has been gathering cruft for ages and I should probably rebuild it from scratch.",
    "created_at": "2014-03-23T22:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204168",
    "user": "darij"
}
```

OK, I'm going to reinstall. I'm upgrading sage from 6.2beta4, but you're right in that this has been gathering cruft for ages and I should probably rebuild it from scratch.



---

archive/issue_comments_204169.json:
```json
{
    "body": "Certainly, but there may be something to fix in the upgrade process. The file I pointed out shouldn't be there and we may be able to do something about it. So I would very much like you to check there is another version in local/include/freetype2 and then remove the one in local/include and try again.",
    "created_at": "2014-03-23T23:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204169",
    "user": "fbissey"
}
```

Certainly, but there may be something to fix in the upgrade process. The file I pointed out shouldn't be there and we may be able to do something about it. So I would very much like you to check there is another version in local/include/freetype2 and then remove the one in local/include and try again.



---

archive/issue_comments_204170.json:
```json
{
    "body": "Not sure what you mean...\n\n```\ndarij@travis-virtualbox:~/gitsage/sage-5.13.beta1/local/include/freetype2$ ls\nconfig      ftautoh.h   ftbzip2.h     ftcid.h     ftglyph.h  ftincrem.h  ftmac.h     ftotval.h   ftsizes.h   ftsystem.h  ftwinfnt.h  tttables.h\nfreetype.h  ftbbox.h    ftcache.h     fterrdef.h  ftgxval.h  ftlcdfil.h  ftmm.h      ftoutln.h   ftsnames.h  fttrigon.h  ftxf86.h    tttags.h\nft2build.h  ftbdf.h     ftcffdrv.h    fterrors.h  ftgzip.h   ftlist.h    ftmodapi.h  ftpfr.h     ftstroke.h  ftttdrv.h   t1tables.h  ttunpat.h\nftadvanc.h  ftbitmap.h  ftchapters.h  ftgasp.h    ftimage.h  ftlzw.h     ftmoderr.h  ftrender.h  ftsynth.h   fttypes.h   ttnameid.h\n```\n\n\nEDIT: Got it! Yes, it seems to build now.",
    "created_at": "2014-03-23T23:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204170",
    "user": "darij"
}
```

Not sure what you mean...

```
darij@travis-virtualbox:~/gitsage/sage-5.13.beta1/local/include/freetype2$ ls
config      ftautoh.h   ftbzip2.h     ftcid.h     ftglyph.h  ftincrem.h  ftmac.h     ftotval.h   ftsizes.h   ftsystem.h  ftwinfnt.h  tttables.h
freetype.h  ftbbox.h    ftcache.h     fterrdef.h  ftgxval.h  ftlcdfil.h  ftmm.h      ftoutln.h   ftsnames.h  fttrigon.h  ftxf86.h    tttags.h
ft2build.h  ftbdf.h     ftcffdrv.h    fterrors.h  ftgzip.h   ftlist.h    ftmodapi.h  ftpfr.h     ftstroke.h  ftttdrv.h   t1tables.h  ttunpat.h
ftadvanc.h  ftbitmap.h  ftchapters.h  ftgasp.h    ftimage.h  ftlzw.h     ftmoderr.h  ftrender.h  ftsynth.h   fttypes.h   ttnameid.h
```


EDIT: Got it! Yes, it seems to build now.



---

archive/issue_comments_204171.json:
```json
{
    "body": "You have both \"local/include/ft2build.h\" and \"local/include/freetype2/ft2build.h\". The first one shouldn't be there and is probably old cruft. I want you to remove it and retry to install matplotlib 1.3.1.",
    "created_at": "2014-03-23T23:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204171",
    "user": "fbissey"
}
```

You have both "local/include/ft2build.h" and "local/include/freetype2/ft2build.h". The first one shouldn't be there and is probably old cruft. I want you to remove it and retry to install matplotlib 1.3.1.



---

archive/issue_comments_204172.json:
```json
{
    "body": "Didn't see your update. OK this now becomes a ticket to remove that files when you upgrade freetype.",
    "created_at": "2014-03-23T23:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204172",
    "user": "fbissey"
}
```

Didn't see your update. OK this now becomes a ticket to remove that files when you upgrade freetype.



---

archive/issue_comments_204173.json:
```json
{
    "body": "Thanks, Francois, for acting on this (strictly speaking non-)issue!",
    "created_at": "2014-03-23T23:21:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204173",
    "user": "darij"
}
```

Thanks, Francois, for acting on this (strictly speaking non-)issue!



---

archive/issue_comments_204174.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-03-24T19:58:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204174",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_204175.json:
```json
{
    "body": "How about this as a fix: after freetype has been successfully installed, remove the old file ft2build.h?\n----\nNew commits:",
    "created_at": "2014-03-24T19:58:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204175",
    "user": "jhpalmieri"
}
```

How about this as a fix: after freetype has been successfully installed, remove the old file ft2build.h?
----
New commits:



---

archive/issue_comments_204176.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-03-24T20:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204176",
    "user": "jhpalmieri"
}
```

New commits:



---

archive/issue_comments_204177.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-03-24T20:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204177",
    "user": "fbissey"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_204178.json:
```json
{
    "body": "I would do it before the install but in that case it is just a matter of taste. Can you bump the spkg because we want the thing to rebuild to remove the file before anyone gets hurt again.",
    "created_at": "2014-03-24T20:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204178",
    "user": "fbissey"
}
```

I would do it before the install but in that case it is just a matter of taste. Can you bump the spkg because we want the thing to rebuild to remove the file before anyone gets hurt again.



---

archive/issue_comments_204179.json:
```json
{
    "body": "Okay, I bumped the version number -- good point. By the way, I'm deleting the file after the install because if the installation fails, I don't want to break the old version.\n----\nNew commits:",
    "created_at": "2014-03-24T20:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204179",
    "user": "jhpalmieri"
}
```

Okay, I bumped the version number -- good point. By the way, I'm deleting the file after the install because if the installation fails, I don't want to break the old version.
----
New commits:



---

archive/issue_comments_204180.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-03-24T20:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204180",
    "user": "jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_204181.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-03-24T20:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204181",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_204182.json:
```json
{
    "body": "good point. positive that.",
    "created_at": "2014-03-24T20:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204182",
    "user": "fbissey"
}
```

good point. positive that.



---

archive/issue_comments_204183.json:
```json
{
    "body": "reviewer names, kids ;)",
    "created_at": "2014-03-31T12:26:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204183",
    "user": "vbraun"
}
```

reviewer names, kids ;)



---

archive/issue_comments_204184.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-03-31T15:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204184",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_204185.json:
```json
{
    "body": "Replying to [comment:13 vbraun]:\n> reviewer names, kids ;)\nyeah I am bad at those :)",
    "created_at": "2014-03-31T20:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204185",
    "user": "fbissey"
}
```

Replying to [comment:13 vbraun]:
> reviewer names, kids ;)
yeah I am bad at those :)



---

archive/issue_comments_204186.json:
```json
{
    "body": "Ah, kiwifb - is this likely the problem I am having at [on my ancient Mac](https://groups.google.com/d/msg/sage-release/q1DPhL8WQiM/kHbvgjLzovgJ)?  Though you are right that I'm not upgrading...  and the message *was*\n\n```\n              freetype: no  [The C/C++ header for freetype2 (ft2build.h)\n                        could not be found.  You may need to install the\n                        development package.]\n```\n\nI can open a ticket for this otherwise, but eventually I'll try this version just on some very strange off-chance...",
    "created_at": "2014-04-02T02:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204186",
    "user": "kcrisman"
}
```

Ah, kiwifb - is this likely the problem I am having at [on my ancient Mac](https://groups.google.com/d/msg/sage-release/q1DPhL8WQiM/kHbvgjLzovgJ)?  Though you are right that I'm not upgrading...  and the message *was*

```
              freetype: no  [The C/C++ header for freetype2 (ft2build.h)
                        could not be found.  You may need to install the
                        development package.]
```

I can open a ticket for this otherwise, but eventually I'll try this version just on some very strange off-chance...



---

archive/issue_comments_204187.json:
```json
{
    "body": "I am fairly certain it isn't. It is very difficult to know what happened without going through the configuration step by step. I think it found an incorrect version of freetype but I am at a lose as to how it happens for you and not anyone else. You know the small revealing detail.",
    "created_at": "2014-04-02T02:11:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204187",
    "user": "fbissey"
}
```

I am fairly certain it isn't. It is very difficult to know what happened without going through the configuration step by step. I think it found an incorrect version of freetype but I am at a lose as to how it happens for you and not anyone else. You know the small revealing detail.



---

archive/issue_comments_204188.json:
```json
{
    "body": "Replying to [comment:16 kcrisman]:\n> Ah, kiwifb - is this likely the problem I am having at [on my ancient Mac](https://groups.google.com/forum/#!msg/sage-release/q1DPhL8WQiM/AtJIZlVhO-MJ)?  Though you are right that I'm not upgrading...  and the message *was*\n> {{{\n>               freetype: no  [The C/C++ header for freetype2 (ft2build.h)\n>                         could not be found.  You may need to install the\n>                         development package.]\n> }}}\n> I can open a ticket for this otherwise, but eventually I'll try this version just on some very strange off-chance...\nfreetype changed it's header files recently breaking many downstream packages. For example, the patch to gimp [is here](https://git.gnome.org/browse/gimp/patch/?id=6c73f28b6d87a2afd11974552a075bffec52347f) and shows clearly what changed.",
    "created_at": "2014-04-02T13:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204188",
    "user": "ppurka"
}
```

Replying to [comment:16 kcrisman]:
> Ah, kiwifb - is this likely the problem I am having at [on my ancient Mac](https://groups.google.com/forum/#!msg/sage-release/q1DPhL8WQiM/AtJIZlVhO-MJ)?  Though you are right that I'm not upgrading...  and the message *was*
> {{{
>               freetype: no  [The C/C++ header for freetype2 (ft2build.h)
>                         could not be found.  You may need to install the
>                         development package.]
> }}}
> I can open a ticket for this otherwise, but eventually I'll try this version just on some very strange off-chance...
freetype changed it's header files recently breaking many downstream packages. For example, the patch to gimp [is here](https://git.gnome.org/browse/gimp/patch/?id=6c73f28b6d87a2afd11974552a075bffec52347f) and shows clearly what changed.



---

archive/issue_comments_204189.json:
```json
{
    "body": "Thanks, ppurka.  So are you saying that this is what happened?   See #16047, where I think I have a lot more evidence you are right.",
    "created_at": "2014-04-02T14:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15765#issuecomment-204189",
    "user": "kcrisman"
}
```

Thanks, ppurka.  So are you saying that this is what happened?   See #16047, where I think I have a lot more evidence you are right.
