# Issue 15765: matplotlib-1.3.1 does not install

Issue created by migration from Trac.

Original creator: darij

Original creation time: 2014-03-23 22:27:44

CC:  jason vbraun fbissey jhpalmieri

Keywords: install, package, matplotlib

This breaks the upgrade to 6.2.beta5.

Logfile: https://www.dropbox.com/s/wmfrp13mnm148i1/matplotlib-1.3.1.log

System is Ubuntu 12.04.4 LTS in a virtualbox on a 64bit machine. Would upgrading help?


---

Comment by fbissey created at 2014-03-23 22:39:30

Hum...

```
building 'matplotlib.ft2font' extension
creating build/temp.linux-i686-2.7
creating build/temp.linux-i686-2.7/src
creating build/temp.linux-i686-2.7/CXX
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -DPY_ARRAY_UNIQUE_SYMBOL=MPL_matplotlib_ft2font_ARRAY_API -DPYCXX_ISO_CPP_LIB=1 -I/home/darij/gitsage/sage-5.13.beta1/local/lib/python2.7/site-packages/numpy/core/include -I/home/darij/gitsage/sage-5.13.beta1/local/include -I. -I/home/darij/gitsage/sage-5.13.beta1/local/include/freetype2 -I/home/darij/gitsage/sage-5.13.beta1/local/include/python2.7 -c src/ft2font.cpp -o build/temp.linux-i686-2.7/src/ft2font.o
In file included from src/ft2font.h:16:0,
                 from src/ft2font.cpp:3:
/home/darij/gitsage/sage-5.13.beta1/local/include/ft2build.h
:56:38: fatal error: freetype/config/ftheader.h: No such file or directory
compilation terminated.
error: command 'gcc' failed with exit status 1
```

When you say upgrading, you mean from sage 5.13? Then yes definitely. Or was this upgraded in place numerous times?
It looks to me like there is cruft in your install:


```
/home/darij/gitsage/sage-5.13.beta1/local/include/ft2build.h
```

is not in this location in my sage install but in the freetype2 sub-folder. If you one in the this sub folder consider removing the one in local/include and try again.


---

Comment by darij created at 2014-03-23 22:44:09

OK, I'm going to reinstall. I'm upgrading sage from 6.2beta4, but you're right in that this has been gathering cruft for ages and I should probably rebuild it from scratch.


---

Comment by fbissey created at 2014-03-23 23:05:16

Certainly, but there may be something to fix in the upgrade process. The file I pointed out shouldn't be there and we may be able to do something about it. So I would very much like you to check there is another version in local/include/freetype2 and then remove the one in local/include and try again.


---

Comment by darij created at 2014-03-23 23:08:32

Not sure what you mean...

```
darij`@`travis-virtualbox:~/gitsage/sage-5.13.beta1/local/include/freetype2$ ls
config      ftautoh.h   ftbzip2.h     ftcid.h     ftglyph.h  ftincrem.h  ftmac.h     ftotval.h   ftsizes.h   ftsystem.h  ftwinfnt.h  tttables.h
freetype.h  ftbbox.h    ftcache.h     fterrdef.h  ftgxval.h  ftlcdfil.h  ftmm.h      ftoutln.h   ftsnames.h  fttrigon.h  ftxf86.h    tttags.h
ft2build.h  ftbdf.h     ftcffdrv.h    fterrors.h  ftgzip.h   ftlist.h    ftmodapi.h  ftpfr.h     ftstroke.h  ftttdrv.h   t1tables.h  ttunpat.h
ftadvanc.h  ftbitmap.h  ftchapters.h  ftgasp.h    ftimage.h  ftlzw.h     ftmoderr.h  ftrender.h  ftsynth.h   fttypes.h   ttnameid.h
```


EDIT: Got it! Yes, it seems to build now.


---

Comment by fbissey created at 2014-03-23 23:17:29

You have both "local/include/ft2build.h" and "local/include/freetype2/ft2build.h". The first one shouldn't be there and is probably old cruft. I want you to remove it and retry to install matplotlib 1.3.1.


---

Comment by fbissey created at 2014-03-23 23:18:31

Didn't see your update. OK this now becomes a ticket to remove that files when you upgrade freetype.


---

Comment by darij created at 2014-03-23 23:21:46

Thanks, Francois, for acting on this (strictly speaking non-)issue!


---

Comment by jhpalmieri created at 2014-03-24 19:58:08

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2014-03-24 19:58:08

How about this as a fix: after freetype has been successfully installed, remove the old file ft2build.h?
----
New commits:


---

Comment by jhpalmieri created at 2014-03-24 20:01:15

New commits:


---

Comment by fbissey created at 2014-03-24 20:38:53

Changing status from needs_review to needs_work.


---

Comment by fbissey created at 2014-03-24 20:38:53

I would do it before the install but in that case it is just a matter of taste. Can you bump the spkg because we want the thing to rebuild to remove the file before anyone gets hurt again.


---

Comment by jhpalmieri created at 2014-03-24 20:46:09

Okay, I bumped the version number -- good point. By the way, I'm deleting the file after the install because if the installation fails, I don't want to break the old version.
----
New commits:


---

Comment by jhpalmieri created at 2014-03-24 20:46:09

Changing status from needs_work to needs_review.


---

Comment by fbissey created at 2014-03-24 20:47:58

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2014-03-24 20:47:58

good point. positive that.


---

Comment by vbraun created at 2014-03-31 12:26:03

reviewer names, kids ;)


---

Comment by vbraun created at 2014-03-31 15:00:29

Resolution: fixed


---

Comment by fbissey created at 2014-03-31 20:16:57

Replying to [comment:13 vbraun]:
> reviewer names, kids ;)
yeah I am bad at those :)


---

Comment by kcrisman created at 2014-04-02 02:08:30

Ah, kiwifb - is this likely the problem I am having at [on my ancient Mac](https://groups.google.com/d/msg/sage-release/q1DPhL8WQiM/kHbvgjLzovgJ)?  Though you are right that I'm not upgrading...  and the message *was*

```
              freetype: no  [The C/C++ header for freetype2 (ft2build.h)
                        could not be found.  You may need to install the
                        development package.]
```

I can open a ticket for this otherwise, but eventually I'll try this version just on some very strange off-chance...


---

Comment by fbissey created at 2014-04-02 02:11:50

I am fairly certain it isn't. It is very difficult to know what happened without going through the configuration step by step. I think it found an incorrect version of freetype but I am at a lose as to how it happens for you and not anyone else. You know the small revealing detail.


---

Comment by ppurka created at 2014-04-02 13:03:59

Replying to [comment:16 kcrisman]:
> Ah, kiwifb - is this likely the problem I am having at [on my ancient Mac](https://groups.google.com/forum/#!msg/sage-release/q1DPhL8WQiM/AtJIZlVhO-MJ)?  Though you are right that I'm not upgrading...  and the message *was*
> {{{
>               freetype: no  [The C/C++ header for freetype2 (ft2build.h)
>                         could not be found.  You may need to install the
>                         development package.]
> }}}
> I can open a ticket for this otherwise, but eventually I'll try this version just on some very strange off-chance...
freetype changed it's header files recently breaking many downstream packages. For example, the patch to gimp [is here](https://git.gnome.org/browse/gimp/patch/?id=6c73f28b6d87a2afd11974552a075bffec52347f) and shows clearly what changed.


---

Comment by kcrisman created at 2014-04-02 14:58:03

Thanks, ppurka.  So are you saying that this is what happened?   See #16047, where I think I have a lot more evidence you are right.
