# Issue 11357: Rooted trees

archive/issues_011357.json:
```json
{
    "body": "Assignee: hivert\n\nCC:  sage-combinat tscrim darij\n\nKeywords: rooted trees, Cayley\n\nImplement combinatorial rooted trees also know as Cayley trees\n\nPatch in preparation on sage-combinat\n\nIssue created by migration from https://trac.sagemath.org/ticket/11529\n\n",
    "created_at": "2011-06-21T20:00:20Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "title": "Rooted trees",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11357",
    "user": "hivert"
}
```
Assignee: hivert

CC:  sage-combinat tscrim darij

Keywords: rooted trees, Cayley

Implement combinatorial rooted trees also know as Cayley trees

Patch in preparation on sage-combinat

Issue created by migration from https://trac.sagemath.org/ticket/11529





---

archive/issue_comments_125747.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-11-21T17:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125747",
    "user": "hivert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_125748.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-02-26T00:02:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125748",
    "user": "dkrenn"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_125749.json:
```json
{
    "body": "Attachment [trac_11529-rooted_trees-fh.patch](tarball://root/attachments/some-uuid/ticket11529/trac_11529-rooted_trees-fh.patch) by dkrenn created at 2012-02-26 00:02:00\n\nPatch cannot be applied. If this is just because of the unfinished #10194 (I don't know the current status of that), then it can be set back to \"need review\".",
    "created_at": "2012-02-26T00:02:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125749",
    "user": "dkrenn"
}
```

Attachment [trac_11529-rooted_trees-fh.patch](tarball://root/attachments/some-uuid/ticket11529/trac_11529-rooted_trees-fh.patch) by dkrenn created at 2012-02-26 00:02:00

Patch cannot be applied. If this is just because of the unfinished #10194 (I don't know the current status of that), then it can be set back to "need review".



---

archive/issue_comments_125750.json:
```json
{
    "body": "Florent, is this the latest patch from the sage-combinat queue ? If not, it would be good to refresh, so that one can start working on it here.",
    "created_at": "2014-04-16T10:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125750",
    "user": "chapoton"
}
```

Florent, is this the latest patch from the sage-combinat queue ? If not, it would be good to refresh, so that one can start working on it here.



---

archive/issue_comments_125751.json:
```json
{
    "body": "I have made a branch from the latest sage-combinat patch, plus some details corrected.\n----\nNew commits:",
    "created_at": "2014-04-20T09:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125751",
    "user": "chapoton"
}
```

I have made a branch from the latest sage-combinat patch, plus some details corrected.
----
New commits:



---

archive/issue_comments_125752.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-21T08:01:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125752",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125753.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-21T08:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125753",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125754.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-21T08:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125754",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125755.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-02T19:35:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125755",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125756.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-08T18:12:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125756",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125757.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-08T20:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125757",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125758.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-09T07:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125758",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125759.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-06T17:27:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125759",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125760.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-16T15:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125760",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_125761.json:
```json
{
    "body": "I have removed the dependency to the ticket #10194. Now progress is possible here.\n\nThere is current interest in this matter, see https://groups.google.com/forum/#!topic/sage-combinat-devel/oi4VtGr1g5A\n----\nNew commits:",
    "created_at": "2015-02-16T15:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125761",
    "user": "chapoton"
}
```

I have removed the dependency to the ticket #10194. Now progress is possible here.

There is current interest in this matter, see https://groups.google.com/forum/#!topic/sage-combinat-devel/oi4VtGr1g5A
----
New commits:



---

archive/issue_comments_125762.json:
```json
{
    "body": "These are (rooted) trees modulo permutation of children, right? I'm asking because I don't see much of a documentation here.\n\n(Let me add that I have never seen them called \"Cayley trees\" in my life. This notation contradicts http://en.wikipedia.org/wiki/Bethe_lattice and http://mathworld.wolfram.com/CayleyTree.html .)",
    "created_at": "2015-02-16T17:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125762",
    "user": "darij"
}
```

These are (rooted) trees modulo permutation of children, right? I'm asking because I don't see much of a documentation here.

(Let me add that I have never seen them called "Cayley trees" in my life. This notation contradicts http://en.wikipedia.org/wiki/Bethe_lattice and http://mathworld.wolfram.com/CayleyTree.html .)



---

archive/issue_comments_125763.json:
```json
{
    "body": "Replying to [comment:18 darij]:\n> These are (rooted) trees modulo permutation of children, right? I'm asking because I don't see much of a documentation here.\n\nFrom looking at the code and the `normalize()` doctest, that is right (i.e., they are not ordered/planer trees). I think we need to expand the documentation before this can get into Sage.\n\n> (Let me add that I have never seen them called \"Cayley trees\" in my life. This notation contradicts http://en.wikipedia.org/wiki/Bethe_lattice and http://mathworld.wolfram.com/CayleyTree.html .)\n\n+1 from me to removing this terminology (at least for now since Cayley trees aren't implemented).",
    "created_at": "2015-02-16T19:35:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125763",
    "user": "tscrim"
}
```

Replying to [comment:18 darij]:
> These are (rooted) trees modulo permutation of children, right? I'm asking because I don't see much of a documentation here.

From looking at the code and the `normalize()` doctest, that is right (i.e., they are not ordered/planer trees). I think we need to expand the documentation before this can get into Sage.

> (Let me add that I have never seen them called "Cayley trees" in my life. This notation contradicts http://en.wikipedia.org/wiki/Bethe_lattice and http://mathworld.wolfram.com/CayleyTree.html .)

+1 from me to removing this terminology (at least for now since Cayley trees aren't implemented).



---

archive/issue_comments_125764.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-16T20:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125764",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125765.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-16T21:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125765",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125766.json:
```json
{
    "body": "OK. Are you sure `on_fly` is a good idea? It behaves nondeterministically:\n\n```\nsage: OT = OrderedTree\nsage: OT([[[],[]], [[],[],[]]]).normalize()\n[[[], []], [[], [], []]]\nsage: OT([[[],[],[]], [[],[]]]).normalize()\n[[[], []], [[], [], []]]\nsage: \nExiting Sage (CPU time 0m0.29s, Wall time 1m31.05s).\nskraeling@angband ~/sage $ ./sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Sage Version 6.5.rc1, Release Date: 2015-02-08                     \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: OT = OrderedTree\nsage: OT([[[],[],[]], [[],[]]]).normalize()\n[[[], [], []], [[], []]]\nsage: OT([[[],[]], [[],[],[]]]).normalize()\n[[[], [], []], [[], []]]\n```\n\nIs this what we want? And does it behave well in regard to the other features of our tree classes, such as the `clone` context manager?\n\nIf we just want a comparison method for normalization, we can compare two trees \"lexicographically\" by number of children, number of children of the leftmost child, etc.. If we want an actual ranker, then this is not enough...\n\nAlso, the doc of `LabelledRootedTrees` says that this class is a parent stub to be inherited from by classes of labelled rooted trees with specific properties; but the `unlabelled_trees` and `cardinality` methods look like they are specific to the class of *all* labelled rooted trees. Shouldn't they go into `LabelledRootedTrees_all`?",
    "created_at": "2015-02-17T05:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125766",
    "user": "darij"
}
```

OK. Are you sure `on_fly` is a good idea? It behaves nondeterministically:

```
sage: OT = OrderedTree
sage: OT([[[],[]], [[],[],[]]]).normalize()
[[[], []], [[], [], []]]
sage: OT([[[],[],[]], [[],[]]]).normalize()
[[[], []], [[], [], []]]
sage: 
Exiting Sage (CPU time 0m0.29s, Wall time 1m31.05s).
skraeling@angband ~/sage $ ./sage
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 6.5.rc1, Release Date: 2015-02-08                     │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: OT = OrderedTree
sage: OT([[[],[],[]], [[],[]]]).normalize()
[[[], [], []], [[], []]]
sage: OT([[[],[]], [[],[],[]]]).normalize()
[[[], [], []], [[], []]]
```

Is this what we want? And does it behave well in regard to the other features of our tree classes, such as the `clone` context manager?

If we just want a comparison method for normalization, we can compare two trees "lexicographically" by number of children, number of children of the leftmost child, etc.. If we want an actual ranker, then this is not enough...

Also, the doc of `LabelledRootedTrees` says that this class is a parent stub to be inherited from by classes of labelled rooted trees with specific properties; but the `unlabelled_trees` and `cardinality` methods look like they are specific to the class of *all* labelled rooted trees. Shouldn't they go into `LabelledRootedTrees_all`?



---

archive/issue_comments_125767.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-17T13:39:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125767",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125768.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-17T14:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125768",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125769.json:
```json
{
    "body": "Hello,\n\nconcerning the ranker, I do not care about the possible non-deterministic aspect. There is no clear canonical way to generate and number all rooted trees, so there is no best choice.\n\nconcerning the methods of `LabelledRootedTrees`, well, there is no `LabelledRootedTrees_all`. And I do not think one need that for now.\n\nAt some point later, it would be good to have classes for labelled rooted trees with labels in a fixed set. So far, all possible labels are allowed. This is needed for operads.\n\nIt is true that the content of this ticket is rather minimalistic. But it is enough for #15635, which is my main motivation.",
    "created_at": "2015-02-17T14:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125769",
    "user": "chapoton"
}
```

Hello,

concerning the ranker, I do not care about the possible non-deterministic aspect. There is no clear canonical way to generate and number all rooted trees, so there is no best choice.

concerning the methods of `LabelledRootedTrees`, well, there is no `LabelledRootedTrees_all`. And I do not think one need that for now.

At some point later, it would be good to have classes for labelled rooted trees with labels in a fixed set. So far, all possible labels are allowed. This is needed for operads.

It is true that the content of this ticket is rather minimalistic. But it is enough for #15635, which is my main motivation.



---

archive/issue_comments_125770.json:
```json
{
    "body": "OK, I am not saying that this nondeterminism is bad, but I think it is avoidable in this specific setting. When it comes to building combinatorial Hopf algebras, I don't want to have to harden all the doctests because a change somewhere else might lead to all trees getting rotated. What do you think about my deterministic normalization method in public/combinat/11529 ?",
    "created_at": "2015-02-17T21:07:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125770",
    "user": "darij"
}
```

OK, I am not saying that this nondeterminism is bad, but I think it is avoidable in this specific setting. When it comes to building combinatorial Hopf algebras, I don't want to have to harden all the doctests because a change somewhere else might lead to all trees getting rotated. What do you think about my deterministic normalization method in public/combinat/11529 ?



---

archive/issue_comments_125771.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-02-17T21:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125771",
    "user": "darij"
}
```

New commits:



---

archive/issue_comments_125772.json:
```json
{
    "body": "This proposal of yours will not work (at least in its current state) for labelled rooted trees. Besides, if I remember well (this is already a few years old), the recursive approach was tried and rejected for being slower than the ranker approach.",
    "created_at": "2015-02-18T08:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125772",
    "user": "chapoton"
}
```

This proposal of yours will not work (at least in its current state) for labelled rooted trees. Besides, if I remember well (this is already a few years old), the recursive approach was tried and rejected for being slower than the ranker approach.



---

archive/issue_comments_125773.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-18T15:58:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125773",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125774.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-02-18T15:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125774",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_125775.json:
```json
{
    "body": "Ah, I see. I've reinstated your definition of normalization, while keeping mine as a method for doctesting pruposes.",
    "created_at": "2015-02-18T16:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125775",
    "user": "darij"
}
```

Ah, I see. I've reinstated your definition of normalization, while keeping mine as a method for doctesting pruposes.



---

archive/issue_comments_125776.json:
```json
{
    "body": "\n```\n+        with self.clone() as t:\n+            t.append(other)\n+            resu = t\n+        return resu\n```\n\nWhy not remove the \"resu = t\" line and just return t? I'm wondering because I'm not sure if my understanding of the clone context manager is correct.\n\nAlso, is it OK if I split `LabelledRootedTrees` into an abstract base class and a concrete class?",
    "created_at": "2015-02-19T04:52:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125776",
    "user": "darij"
}
```


```
+        with self.clone() as t:
+            t.append(other)
+            resu = t
+        return resu
```

Why not remove the "resu = t" line and just return t? I'm wondering because I'm not sure if my understanding of the clone context manager is correct.

Also, is it OK if I split `LabelledRootedTrees` into an abstract base class and a concrete class?



---

archive/issue_comments_125777.json:
```json
{
    "body": "Replying to [comment:32 darij]:\n> {{{\n> +        with self.clone() as t:\n> +            t.append(other)\n> +            resu = t\n> +        return resu\n> }}}\n> Why not remove the \"resu = t\" line and just return t? I'm wondering because I'm not sure if my understanding of the clone context manager is correct.\n\nYes, I guess one can return t. I am not very sure either to understand the clone mantra.\n\n> Also, is it OK if I split `LabelledRootedTrees` into an abstract base class and a concrete class?\n\nYes, please do as you want, but try to keep things simple enough for me :)",
    "created_at": "2015-02-19T10:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125777",
    "user": "chapoton"
}
```

Replying to [comment:32 darij]:
> {{{
> +        with self.clone() as t:
> +            t.append(other)
> +            resu = t
> +        return resu
> }}}
> Why not remove the "resu = t" line and just return t? I'm wondering because I'm not sure if my understanding of the clone context manager is correct.

Yes, I guess one can return t. I am not very sure either to understand the clone mantra.

> Also, is it OK if I split `LabelledRootedTrees` into an abstract base class and a concrete class?

Yes, please do as you want, but try to keep things simple enough for me :)



---

archive/issue_comments_125778.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-19T21:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125778",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125779.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-19T22:15:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125779",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125780.json:
```json
{
    "body": "Is this:\n\n```\n        tst = (children.__class__ is self.__class__\n               and children.parent() == parent)\n        if not tst:\n            children = [self.__class__(parent, x) for x in children]\n```\n\nsupposed to catch the case of `children` being a rooted tree? Because I'm not sure I understand the logic. `childen` is a list; maybe you want `x.__class__ for x in children` instead of `children.__class__`?\n\nAlso, as usual, I don't understand the classcall metaclass magic, so I am just reading past it.",
    "created_at": "2015-02-19T22:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125780",
    "user": "darij"
}
```

Is this:

```
        tst = (children.__class__ is self.__class__
               and children.parent() == parent)
        if not tst:
            children = [self.__class__(parent, x) for x in children]
```

supposed to catch the case of `children` being a rooted tree? Because I'm not sure I understand the logic. `childen` is a list; maybe you want `x.__class__ for x in children` instead of `children.__class__`?

Also, as usual, I don't understand the classcall metaclass magic, so I am just reading past it.



---

archive/issue_comments_125781.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-19T22:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125781",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125782.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-20T06:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125782",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125783.json:
```json
{
    "body": "OK, almost positive_review. I leave the following functions to someone who understands our OOP better:\n\n- `RootedTree.__classcall_private__`\n\n- `RootedTree.__init__` (see also http://trac.sagemath.org/ticket/11529#comment:37 )\n\n- `RootedTree.normalize`\n\n- `LabelledRootedTree.__classcall_private__`",
    "created_at": "2015-02-20T06:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125783",
    "user": "darij"
}
```

OK, almost positive_review. I leave the following functions to someone who understands our OOP better:

- `RootedTree.__classcall_private__`

- `RootedTree.__init__` (see also http://trac.sagemath.org/ticket/11529#comment:37 )

- `RootedTree.normalize`

- `LabelledRootedTree.__classcall_private__`



---

archive/issue_comments_125784.json:
```json
{
    "body": "I will try to take a look at them over the weekend (unless someone beats me to it).",
    "created_at": "2015-02-20T06:58:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125784",
    "user": "tscrim"
}
```

I will try to take a look at them over the weekend (unless someone beats me to it).



---

archive/issue_comments_125785.json:
```json
{
    "body": "Changing keywords from \"rooted trees, Cayley\" to \"rooted trees\".",
    "created_at": "2015-02-23T19:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125785",
    "user": "chapoton"
}
```

Changing keywords from "rooted trees, Cayley" to "rooted trees".



---

archive/issue_comments_125786.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-27T20:23:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125786",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125787.json:
```json
{
    "body": "I made some minor changes, so if you're happy with them, then positive review since the class heirachy looks good. (Sorry it's almost the following weekend.)",
    "created_at": "2015-02-27T20:25:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125787",
    "user": "tscrim"
}
```

I made some minor changes, so if you're happy with them, then positive review since the class heirachy looks good. (Sorry it's almost the following weekend.)



---

archive/issue_comments_125788.json:
```json
{
    "body": "The changes look OK to me (except I still don't understand the\n\n```\nif not (children.__class__ is self.__class__\n        and children.parent() == parent):\n```\n\ncheck). What about you, Frederic?\n\nThank you for looking at this, Travis!",
    "created_at": "2015-02-27T21:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125788",
    "user": "darij"
}
```

The changes look OK to me (except I still don't understand the

```
if not (children.__class__ is self.__class__
        and children.parent() == parent):
```

check). What about you, Frederic?

Thank you for looking at this, Travis!



---

archive/issue_comments_125789.json:
```json
{
    "body": "Replying to [comment:46 darij]:\n> The changes look OK to me (except I still don't understand the\n> {{{\n> if not (children.__class__ is self.__class__\n>         and children.parent() == parent):\n> }}}\n> check).\n\nThat is making sure that the children are also rooted subtrees of the same parent (you can think of it like a linked list, but instead of a separate class for nodes, it links to a smaller list).\n\n> Thank you for looking at this, Travis!\n\nThe least I could do.",
    "created_at": "2015-02-28T06:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125789",
    "user": "tscrim"
}
```

Replying to [comment:46 darij]:
> The changes look OK to me (except I still don't understand the
> {{{
> if not (children.__class__ is self.__class__
>         and children.parent() == parent):
> }}}
> check).

That is making sure that the children are also rooted subtrees of the same parent (you can think of it like a linked list, but instead of a separate class for nodes, it links to a smaller list).

> Thank you for looking at this, Travis!

The least I could do.



---

archive/issue_comments_125790.json:
```json
{
    "body": "But isn't `children` a list by the moment this check is happening?",
    "created_at": "2015-02-28T07:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125790",
    "user": "darij"
}
```

But isn't `children` a list by the moment this check is happening?



---

archive/issue_comments_125791.json:
```json
{
    "body": "Replying to [comment:48 darij]:\n> But isn't `children` a list by the moment this check is happening?\n\nYou're right; this check is worthless. An artifact of refactoring out #10194 perhaps?",
    "created_at": "2015-02-28T07:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125791",
    "user": "tscrim"
}
```

Replying to [comment:48 darij]:
> But isn't `children` a list by the moment this check is happening?

You're right; this check is worthless. An artifact of refactoring out #10194 perhaps?



---

archive/issue_comments_125792.json:
```json
{
    "body": "Maybe. Would you suggest fixing it or just blanket casting `children` to the appropriate class?",
    "created_at": "2015-02-28T07:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125792",
    "user": "darij"
}
```

Maybe. Would you suggest fixing it or just blanket casting `children` to the appropriate class?



---

archive/issue_comments_125793.json:
```json
{
    "body": "I'd comment out the `if` and do the blanket casting. Want me to do it?",
    "created_at": "2015-02-28T07:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125793",
    "user": "tscrim"
}
```

I'd comment out the `if` and do the blanket casting. Want me to do it?



---

archive/issue_comments_125794.json:
```json
{
    "body": "Yeah, I'm slowly going to bed so I'd rather not fire up the virtual machine. Feel free to set this to positive_review then!",
    "created_at": "2015-02-28T07:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125794",
    "user": "darij"
}
```

Yeah, I'm slowly going to bed so I'd rather not fire up the virtual machine. Feel free to set this to positive_review then!



---

archive/issue_comments_125795.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-28T07:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125795",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125796.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-28T07:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125796",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_125797.json:
```json
{
    "body": "Done, thanks.",
    "created_at": "2015-02-28T07:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125797",
    "user": "tscrim"
}
```

Done, thanks.



---

archive/issue_comments_125798.json:
```json
{
    "body": "just as a general PSA, i'm not merging tickets that are milestone: sage-pending",
    "created_at": "2015-03-12T23:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125798",
    "user": "vbraun"
}
```

just as a general PSA, i'm not merging tickets that are milestone: sage-pending



---

archive/issue_comments_125799.json:
```json
{
    "body": "sorry, wrong ticket ;-)",
    "created_at": "2015-03-12T23:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125799",
    "user": "vbraun"
}
```

sorry, wrong ticket ;-)



---

archive/issue_comments_125800.json:
```json
{
    "body": "Follow-up ticket at #15635",
    "created_at": "2015-03-25T20:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125800",
    "user": "chapoton"
}
```

Follow-up ticket at #15635



---

archive/issue_comments_125801.json:
```json
{
    "body": "Hello Volker :)",
    "created_at": "2015-04-15T02:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125801",
    "user": "darij"
}
```

Hello Volker :)



---

archive/issue_comments_125802.json:
```json
{
    "body": "Don't make pre-git tickets a dependency if you want auutomatic merging to work...",
    "created_at": "2015-04-15T16:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125802",
    "user": "vbraun"
}
```

Don't make pre-git tickets a dependency if you want auutomatic merging to work...



---

archive/issue_comments_125803.json:
```json
{
    "body": "Conflict, probably with #18179",
    "created_at": "2015-04-15T16:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125803",
    "user": "vbraun"
}
```

Conflict, probably with #18179



---

archive/issue_comments_125804.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-04-15T16:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125804",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_125805.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-15T16:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125805",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125806.json:
```json
{
    "body": "I don't see any conflict, but here is a merge for convenience.\n----\nNew commits:",
    "created_at": "2015-04-15T16:48:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125806",
    "user": "darij"
}
```

I don't see any conflict, but here is a merge for convenience.
----
New commits:



---

archive/issue_comments_125807.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-04-15T16:48:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125807",
    "user": "darij"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_125808.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-04-15T21:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125808",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_125809.json:
```json
{
    "body": "If you didn't get a conflict then the conflict was elsewhere. Try 6.7.beta1",
    "created_at": "2015-04-15T21:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125809",
    "user": "vbraun"
}
```

If you didn't get a conflict then the conflict was elsewhere. Try 6.7.beta1



---

archive/issue_comments_125810.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-15T21:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125810",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125811.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-04-15T22:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125811",
    "user": "darij"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_125812.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-04-18T07:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125812",
    "user": "chapoton"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_125813.json:
```json
{
    "body": "Damn, there is a failing doctest !",
    "created_at": "2015-04-18T07:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125813",
    "user": "chapoton"
}
```

Damn, there is a failing doctest !



---

archive/issue_comments_125814.json:
```json
{
    "body": "I am working on that..",
    "created_at": "2015-04-18T20:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125814",
    "user": "chapoton"
}
```

I am working on that..



---

archive/issue_comments_125815.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-19T09:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125815",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125816.json:
```json
{
    "body": "ok, I have got rid of ranker, so that the order is now deterministic.\n\nMaybe it will be slow, but speed can be taken care later on.\n\nI have tried to use cached_method for the sort_key function, but it does not interact well with the ClonableTree setup.\n\nThe patchbot should be happy, let us see.",
    "created_at": "2015-04-19T09:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125816",
    "user": "chapoton"
}
```

ok, I have got rid of ranker, so that the order is now deterministic.

Maybe it will be slow, but speed can be taken care later on.

I have tried to use cached_method for the sort_key function, but it does not interact well with the ClonableTree setup.

The patchbot should be happy, let us see.



---

archive/issue_comments_125817.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-19T09:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125817",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_125818.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-19T15:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125818",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125819.json:
```json
{
    "body": "Stupid question: If a class inherits both from `LabelledOrderedTree` and another subclass of `OrderedTree`, then is there a way to tell which class's `sort_key` method it will get? Because if it gets it from `OrderedTree`, then its normalization won't work properly (`sort_key` will ignore the labels).\n\nSame for methods such as `left_right_symmetry`.",
    "created_at": "2015-04-19T17:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125819",
    "user": "darij"
}
```

Stupid question: If a class inherits both from `LabelledOrderedTree` and another subclass of `OrderedTree`, then is there a way to tell which class's `sort_key` method it will get? Because if it gets it from `OrderedTree`, then its normalization won't work properly (`sort_key` will ignore the labels).

Same for methods such as `left_right_symmetry`.



---

archive/issue_comments_125820.json:
```json
{
    "body": "Well, I do not know. Do you think that it matters for the present ticket ?\n\nBy the way, do you you want to keep the \"dendrographical\" stuff ?",
    "created_at": "2015-04-20T19:33:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125820",
    "user": "chapoton"
}
```

Well, I do not know. Do you think that it matters for the present ticket ?

By the way, do you you want to keep the "dendrographical" stuff ?



---

archive/issue_comments_125821.json:
```json
{
    "body": "I am slightly biased towards keeping things that work -- or do you see the dendrographical stuff as broken in some way? (When we get to combinatorial Hopf algerbas based on trees and transfers between different bases, every order will be useful...)\n\nI don't know if the double inheritance (MRO) issue is a problem; this is why I'm asking. I would default to adding some warnings into the docstring, but I know of some people that are allergic to my warnings, and some other people who might find them not sufficient, so I prefer to ask...",
    "created_at": "2015-04-20T19:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125821",
    "user": "darij"
}
```

I am slightly biased towards keeping things that work -- or do you see the dendrographical stuff as broken in some way? (When we get to combinatorial Hopf algerbas based on trees and transfers between different bases, every order will be useful...)

I don't know if the double inheritance (MRO) issue is a problem; this is why I'm asking. I would default to adding some warnings into the docstring, but I know of some people that are allergic to my warnings, and some other people who might find them not sufficient, so I prefer to ask...



---

archive/issue_comments_125822.json:
```json
{
    "body": "No problem, let us keep the 'dendrographical' stuff. The name sounds somewhat funny to me.\n\nI am not sure I see the point on warning about issues that look not very likely to be met  in the near future. But if you want to add them, I will not resist.\n\nMy aim now is to have this ticket in, as soon as possible, so that I can start to work on\nthe algebraic follow-up ticket #15635.",
    "created_at": "2015-04-20T19:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125822",
    "user": "chapoton"
}
```

No problem, let us keep the 'dendrographical' stuff. The name sounds somewhat funny to me.

I am not sure I see the point on warning about issues that look not very likely to be met  in the near future. But if you want to add them, I will not resist.

My aim now is to have this ticket in, as soon as possible, so that I can start to work on
the algebraic follow-up ticket #15635.



---

archive/issue_comments_125823.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-20T20:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125823",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125824.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-20T21:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125824",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125825.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-20T21:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125825",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125826.json:
```json
{
    "body": "Done. Are you OK with my changes?\n\nI've added documentation for the pitfall I have mentioned in comment:72. Generally, I think Sage is lacking many warnings and implementation notes that would make it easier (or even possible) to extend from the existing classes as opposed to implementing new things from scratch because one doesn't understand the old classes' structure. In many cases, they would also help the reviewers review the patches (although in the current case this was simple enough).\n\nI'm also waiting for #15635 to be ready, but alas I cannot help with the coercion :(",
    "created_at": "2015-04-20T21:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125826",
    "user": "darij"
}
```

Done. Are you OK with my changes?

I've added documentation for the pitfall I have mentioned in comment:72. Generally, I think Sage is lacking many warnings and implementation notes that would make it easier (or even possible) to extend from the existing classes as opposed to implementing new things from scratch because one doesn't understand the old classes' structure. In many cases, they would also help the reviewers review the patches (although in the current case this was simple enough).

I'm also waiting for #15635 to be ready, but alas I cannot help with the coercion :(



---

archive/issue_comments_125827.json:
```json
{
    "body": "ok, the bot is happy. Darij, I agree with your changes (even if they make me think about the keyword \"verbosity\").\n\nSo, please put that into positive review, if you want ?",
    "created_at": "2015-04-21T18:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125827",
    "user": "chapoton"
}
```

ok, the bot is happy. Darij, I agree with your changes (even if they make me think about the keyword "verbosity").

So, please put that into positive review, if you want ?



---

archive/issue_comments_125828.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-21T21:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125828",
    "user": "darij"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_125829.json:
```json
{
    "body": "Thank you!",
    "created_at": "2015-04-21T21:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125829",
    "user": "darij"
}
```

Thank you!



---

archive/issue_comments_125830.json:
```json
{
    "body": "On 32-bit:\n\n```\nsage -t --long src/sage/combinat/rooted_tree.py\n**********************************************************************\nFile \"src/sage/combinat/rooted_tree.py\", line 259, in sage.combinat.rooted_tree.RootedTree.__hash__\nFailed example:\n    hash(RT([[],[[]]]))  # indirect doctest\nExpected:\n    2578595415271398032\nGot:\n    1119083152\n**********************************************************************\nFile \"src/sage/combinat/rooted_tree.py\", line 891, in sage.combinat.rooted_tree.LabelledRootedTree.__hash__\nFailed example:\n    hash(lb)  # indirect doctest\nExpected:\n    686798862222558969\nGot:\n    652936953\n**********************************************************************\n2 items had failures:\n   1 of   3 in sage.combinat.rooted_tree.LabelledRootedTree.__hash__\n   1 of   3 in sage.combinat.rooted_tree.RootedTree.__hash__\n    [155 tests, 2 failures, 1.79 s]\n```\n",
    "created_at": "2015-04-22T01:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125830",
    "user": "vbraun"
}
```

On 32-bit:

```
sage -t --long src/sage/combinat/rooted_tree.py
**********************************************************************
File "src/sage/combinat/rooted_tree.py", line 259, in sage.combinat.rooted_tree.RootedTree.__hash__
Failed example:
    hash(RT([[],[[]]]))  # indirect doctest
Expected:
    2578595415271398032
Got:
    1119083152
**********************************************************************
File "src/sage/combinat/rooted_tree.py", line 891, in sage.combinat.rooted_tree.LabelledRootedTree.__hash__
Failed example:
    hash(lb)  # indirect doctest
Expected:
    686798862222558969
Got:
    652936953
**********************************************************************
2 items had failures:
   1 of   3 in sage.combinat.rooted_tree.LabelledRootedTree.__hash__
   1 of   3 in sage.combinat.rooted_tree.RootedTree.__hash__
    [155 tests, 2 failures, 1.79 s]
```




---

archive/issue_comments_125831.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-04-22T01:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125831",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_125832.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-22T02:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125832",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125833.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-04-22T02:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125833",
    "user": "darij"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_125834.json:
```json
{
    "body": "Good call -- I don't know how I missed them.",
    "created_at": "2015-04-22T02:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125834",
    "user": "darij"
}
```

Good call -- I don't know how I missed them.



---

archive/issue_comments_125835.json:
```json
{
    "body": "No, no ! This hash should be different for 32 and 64 bits !",
    "created_at": "2015-04-22T06:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125835",
    "user": "chapoton"
}
```

No, no ! This hash should be different for 32 and 64 bits !



---

archive/issue_comments_125836.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-04-22T06:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125836",
    "user": "chapoton"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_125837.json:
```json
{
    "body": "You mean \"should be\" or \"is\"? What is going on here? Why should a hash (computed via sort_key) be machine-dependent?",
    "created_at": "2015-04-22T06:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125837",
    "user": "darij"
}
```

You mean "should be" or "is"? What is going on here? Why should a hash (computed via sort_key) be machine-dependent?



---

archive/issue_comments_125838.json:
```json
{
    "body": "The hash **is** different.\nSee many places, for example:\n\n```\n            sage: F = CombinatorialFreeModule(QQ, ['a','b','c'])\n            sage: B = F.basis()\n            sage: f = B['a'] + 3*B['c']\n            sage: hash(f)\n            6429418278783588506           # 64-bit\n            726440090                     # 32-bit\n```\n",
    "created_at": "2015-04-22T06:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125838",
    "user": "chapoton"
}
```

The hash **is** different.
See many places, for example:

```
            sage: F = CombinatorialFreeModule(QQ, ['a','b','c'])
            sage: B = F.basis()
            sage: f = B['a'] + 3*B['c']
            sage: hash(f)
            6429418278783588506           # 64-bit
            726440090                     # 32-bit
```




---

archive/issue_comments_125839.json:
```json
{
    "body": "Oh! Should it be marked #random?",
    "created_at": "2015-04-22T06:37:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125839",
    "user": "darij"
}
```

Oh! Should it be marked #random?



---

archive/issue_comments_125840.json:
```json
{
    "body": "No, it should have the two possible answers as in the example above.",
    "created_at": "2015-04-22T06:38:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125840",
    "user": "chapoton"
}
```

No, it should have the two possible answers as in the example above.



---

archive/issue_comments_125841.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-22T06:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125841",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_125842.json:
```json
{
    "body": "good for me on 64-bit",
    "created_at": "2015-04-22T06:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125842",
    "user": "chapoton"
}
```

good for me on 64-bit



---

archive/issue_comments_125843.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-04-22T06:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125843",
    "user": "chapoton"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_125844.json:
```json
{
    "body": "Thank you!",
    "created_at": "2015-04-22T06:50:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125844",
    "user": "darij"
}
```

Thank you!



---

archive/issue_comments_125845.json:
```json
{
    "body": "The easier test to make sure the hash is working is to do something like `hash(x) == hash(x)` (unless of course you're expecting a specific value, like `hash(1) == 1`), and it doesn't cause trivial doctest failures for changes to the hash function, but it probably doesn't really matter here.",
    "created_at": "2015-04-22T07:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125845",
    "user": "tscrim"
}
```

The easier test to make sure the hash is working is to do something like `hash(x) == hash(x)` (unless of course you're expecting a specific value, like `hash(1) == 1`), and it doesn't cause trivial doctest failures for changes to the hash function, but it probably doesn't really matter here.



---

archive/issue_comments_125846.json:
```json
{
    "body": "Replying to [comment:93 tscrim]:\n> The easier test to make sure the hash is working is to do something like `hash(x) == hash(x)` (unless of course you're expecting a specific value, like `hash(1) == 1`), and it doesn't cause trivial doctest failures for changes to the hash function, but it probably doesn't really matter here.\n\nIf you use the same `x` then you are not testing anything serious. A good test would be  `hash(x) == hash(y)` with `x` and `y` two distinct but equal objects. \n\nFlorent which is coming back to Sage after a long absence. \n\nBy the way : Tanks to all of you for finishing this one !",
    "created_at": "2015-04-22T07:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125846",
    "user": "hivert"
}
```

Replying to [comment:93 tscrim]:
> The easier test to make sure the hash is working is to do something like `hash(x) == hash(x)` (unless of course you're expecting a specific value, like `hash(1) == 1`), and it doesn't cause trivial doctest failures for changes to the hash function, but it probably doesn't really matter here.

If you use the same `x` then you are not testing anything serious. A good test would be  `hash(x) == hash(y)` with `x` and `y` two distinct but equal objects. 

Florent which is coming back to Sage after a long absence. 

By the way : Tanks to all of you for finishing this one !



---

archive/issue_comments_125847.json:
```json
{
    "body": "Hello Florent. Glad to see you back.\n\nTo finish this ticket, I had to get rid of the dependency to #10194.\nIf I could suggest something, that would be to take care of #10194. It would certainly\nhelp several people, that have based many of their tickets on that one.",
    "created_at": "2015-04-22T08:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125847",
    "user": "chapoton"
}
```

Hello Florent. Glad to see you back.

To finish this ticket, I had to get rid of the dependency to #10194.
If I could suggest something, that would be to take care of #10194. It would certainly
help several people, that have based many of their tickets on that one.



---

archive/issue_comments_125848.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-23T03:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11357",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11357#issuecomment-125848",
    "user": "vbraun"
}
```

Resolution: fixed
