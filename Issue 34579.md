# Issue 34579: Update numpy to 1.24

Issue created by migration from https://trac.sagemath.org/ticket/34816

Original creator: mkoeppe

Original creation time: 2022-12-01 22:54:32

CC:  arojas fbissey tornaria

1.24.0rc1 is out


---

Comment by mkoeppe created at 2022-12-02 00:02:14

There are a bunch of new `FutureWarning`s:

```
    FutureWarning: In the future `np.bool` will be defined as the corresponding NumPy scalar.  (This may have returned Python scalars in past versions.

    FutureWarning: In the future `np.bytes` will be defined as the corresponding NumPy scalar.  (This may have returned Python scalars in past versions.
```

and also:

```
sage -t --random-seed=208794765845619979520719224489586219359 src/sage/plot/histogram.py
**********************************************************************
File "src/sage/plot/histogram.py", line 94, in sage.plot.histogram.Histogram.get_minmax_data
Failed example:
    h.get_minmax_data()
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.histogram.Histogram.get_minmax_data[9]>", line 1, in <module>
        h.get_minmax_data()
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/plot/histogram.py", line 116, in get_minmax_data
        ydata, xdata = numpy.histogram(self.datalist, **opt)
      File "<__array_function__ internals>", line 198, in histogram
    TypeError: histogram() got an unexpected keyword argument 'normed'

sage -t --random-seed=208794765845619979520719224489586219359 src/sage/plot/plot_field.py
**********************************************************************
File "src/sage/plot/plot_field.py", line 51, in sage.plot.plot_field.PlotField.__init__
Failed example:
    r.yvec_array
Expected:
    masked_array(data=[0.0, 0.70710678118..., 0.70710678118...,
                       0.89442719...],
                 mask=[False, False, False, False],
           fill_value=1e+20)
Got:
    masked_array(data=[0.        , 0.70710678, 0.70710678, 0.89442719],
                 mask=False,
           fill_value=1e+20)

sage -t --random-seed=208794765845619979520719224489586219359 src/sage/misc/persist.pyx
**********************************************************************
File "src/sage/misc/persist.pyx", line 159, in sage.misc.persist.load
Failed example:
    hello
Expected:
    <fortran object>
Got:
    <fortran function hello>

sage -t --random-seed=208794765845619979520719224489586219359 src/sage/plot/complex_plot.pyx
**********************************************************************
File "src/sage/plot/complex_plot.pyx", line 1025, in sage.plot.complex_plot.?
Failed example:
    complex_plot(f, (0, 1), (0, 1), plot_points=300,
                 contoured=True, contour_type='linear', contour_base=1)
Expected:
    Graphics object consisting of 1 graphics primitive
Got:
    doctest:warning
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/bin/sage-runtests", line 154, in <module>
        err = DC.run()
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/doctest/control.py", line 1384, in run
        self.run_doctests()
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/doctest/control.py", line 1059, in run_doctests
        self.dispatcher.dispatch()
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/doctest/forker.py", line 2021, in dispatch
        self.parallel_dispatch()
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/doctest/forker.py", line 1916, in parallel_dispatch
        w.start()  # This might take some time
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/doctest/forker.py", line 2190, in start
        super().start()
      File "/usr/local/Cellar/python@3.10/3.10.8/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 121, in start
        self._popen = self._Popen(self)
      File "/usr/local/Cellar/python@3.10/3.10.8/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/context.py", line 224, in _Popen
        return _default_context.get_context().Process._Popen(process_obj)
      File "/usr/local/Cellar/python@3.10/3.10.8/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/context.py", line 281, in _Popen
        return Popen(process_obj)
      File "/usr/local/Cellar/python@3.10/3.10.8/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/popen_fork.py", line 19, in __init__
        self._launch(process_obj)
      File "/usr/local/Cellar/python@3.10/3.10.8/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/popen_fork.py", line 71, in _launch
        code = process_obj._bootstrap(parent_sentinel=child_r)
      File "/usr/local/Cellar/python@3.10/3.10.8/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 314, in _bootstrap
        self.run()
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/doctest/forker.py", line 2162, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/doctest/forker.py", line 2492, in __call__
        doctests, extras = self._run(runner, options, results)
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/doctest/forker.py", line 2544, in _run
        result = runner.run(test)
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/doctest/forker.py", line 866, in run
        return self._run(test, compileflags, out)
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.complex_plot.?[14]>", line 1, in <module>
        complex_plot(f, (Integer(0), Integer(1)), (Integer(0), Integer(1)), plot_points=Integer(300),
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/repl/rich_output/display_manager.py", line 827, in displayhook
        plain_text, rich_output = self._rich_output_formatter(obj, dict())
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/repl/rich_output/display_manager.py", line 645, in _rich_output_formatter
        rich_output = self._call_rich_repr(obj, rich_repr_kwds)
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/repl/rich_output/display_manager.py", line 605, in _call_rich_repr
        return obj._rich_repr_(self)
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/plot/graphics.py", line 1001, in _rich_repr_
        return display_manager.graphics_from_save(
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/repl/rich_output/display_manager.py", line 733, in graphics_from_save
        save_function(filename, **kwds)
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/misc/decorators.py", line 410, in wrapper
        return func(*args, **kwds)
      File "/Users/mkoeppe/s/sage/sage-rebasing/src/sage/plot/graphics.py", line 3358, in save
        figure.savefig(filename, **opts)
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/matplotlib/figure.py", line 3046, in savefig
        self.canvas.print_figure(fname, **kwargs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/matplotlib/backend_bases.py", line 2295, in print_figure
        self.figure.draw(renderer)
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/matplotlib/artist.py", line 73, in draw_wrapper
        result = draw(artist, renderer, *args, **kwargs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/matplotlib/artist.py", line 50, in draw_wrapper
        return draw(artist, renderer)
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/matplotlib/figure.py", line 2837, in draw
        mimage._draw_list_compositing_images(
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/matplotlib/image.py", line 132, in _draw_list_compositing_images
        a.draw(renderer)
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/matplotlib/artist.py", line 50, in draw_wrapper
        return draw(artist, renderer)
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/matplotlib/axes/_base.py", line 3091, in draw
        mimage._draw_list_compositing_images(
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/matplotlib/image.py", line 132, in _draw_list_compositing_images
        a.draw(renderer)
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/matplotlib/artist.py", line 50, in draw_wrapper
        return draw(artist, renderer)
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/matplotlib/image.py", line 646, in draw
        im, l, b, trans = self.make_image(
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/matplotlib/image.py", line 956, in make_image
        return self._make_image(self._A, bbox, transformed_bbox, clip,
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/matplotlib/image.py", line 564, in _make_image
        output = self.to_rgba(output, bytes=True, norm=False)
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/matplotlib/cm.py", line 440, in to_rgba
        xx = (xx * 255).astype(np.uint8)
      File "/usr/local/Cellar/python@3.10/3.10.8/Frameworks/Python.framework/Versions/3.10/lib/python3.10/warnings.py", line 109, in _showwarnmsg
        sw(msg.message, msg.category, msg.filename, msg.lineno,
    :
    RuntimeWarning: invalid value encountered in cast

```

----
New commits:


---

Comment by git created at 2022-12-13 01:33:23

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-12-21 01:49:09

Branch pushed to git repo; I updated commit sha1. New commits:
