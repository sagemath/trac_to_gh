# Issue 28904: Meta-ticket: Upgrades and other changes that require dropping py2 support or separate package versions for py2/py3

Issue created by migration from https://trac.sagemath.org/ticket/29141

Original creator: mkoeppe

Original creation time: 2020-02-02 14:14:20

CC:  chapoton embray jdemeyer slelievre arojas fbissey @timokau jhpalmieri tscrim isuruf nbruin mjo vbraun dimpase vdelecroix @kliem

From https://groups.google.com/forum/#!topic/sage-devel/vYlbnAwKATM "drop python2 compatibility in 9.1' (thread Jan 5-22, 2020).

Tickets:

- #28197- upgrade to ipython 7 / prompt-toolkit 2

Goals without tickets:

- compatibility with python 3.8... needs details
  * "at this point the major issues are python 3.8 and ipython 7, and I don't see how one could support several versions of them without forking hundreds of doctests. Both updates require multi-thousand-lines patches, due to changes in dict sorting and hashes."
- packages upgrades:
  * matplotlib-3
  * sphinx-2
  * numpy-1.17
  * scipy-1.3+
  * rpy2: sage has rpy2 2.8.2. rpy2 latest is 3.2.4 but 3.x series is python 3 only and sage requires breaking changes to support rpy2 3.x. See #28494#comment:6
While python2 support for rpy2 is required, sage codebase can't be updated to 3.x (unless someone adds code to detect rpy2 version and support both 2.8.2 and 3.2.4). See also #28988.
 
- deprecation warning when people use './configure --with-python=2'.
- document milestone 9.2 or 10 as py3-only

Separate package versions:

- #28190: Allow different versions of python modules depending on the python version used


---

Comment by arojas created at 2020-02-02 14:36:06

python 3.8 update is tracked in #27754, there is a list of issues that need fixing. rpy3 support is merged already in 9.1.beta2 (#28988), as well as networkx 2.4, which is also py3-only (#28450). IMO #28190 is no longer worth the effort at this point, provided that python2 support is to be dropped at 9.2 in the worst case.


---

Comment by mkoeppe created at 2020-02-02 14:37:25

Please feel free to update the ticket description.


---

Comment by mkoeppe created at 2020-04-08 20:45:54

I have just updated https://wiki.sagemath.org/Python3-Switch to say that the upcoming 9.1 will still support Python 2


---

Comment by fbissey created at 2020-05-23 09:56:57

I am working on #29042 and I noticed that neither #28000 or #29669 remove `# py2` and  `# py3` for doctesting. Is there a ticket for that which should then be in the summary, or is it something that is planned to be removed on the longer term?


---

Comment by jhpalmieri created at 2020-05-25 03:10:33

`@`fbissey: I don't know of any ticket for removing `py2` and `py3` tags.


---

Comment by fbissey created at 2020-05-26 09:20:48

Another thing that I spotted scanning stuff in #29633. We have a lot python feature backport packages in our tree. We may want to get rid of them as we get rid of python 2.7 and anything older than python 3.7 in fact. Look at `enum34` if you don't get what I mean.


---

Comment by slelievre created at 2020-05-26 12:43:48

> Another thing that I spotted scanning stuff in #29633.
> We have a lot of Python feature backport packages in our tree.
> We may want to get rid of them as we get rid of Python 2.7
> and anything older than Python 3.7 in fact. Look at `enum34`
> if you don't get what I mean.

Consider keeping support Python 3.6, whose official support is till 2021-12-23. See #29033.

Python 3.5 support ends in 2020-09, so fine to drop it. See life cycle of Python versions:

- currently or recently supported versions: https://www.python.org/downloads/
- older versions: https://devguide.python.org/devcycle/#end-of-life-branches


---

Comment by mkoeppe created at 2020-05-28 06:05:55

Changing keywords from "" to "sd109".


---

Comment by jhpalmieri created at 2020-05-28 17:59:25

Replying to [comment:16 fbissey]:
> Another thing that I spotted scanning stuff in #29633. We have a lot python feature backport packages in our tree. We may want to get rid of them as we get rid of python 2.7 and anything older than python 3.7 in fact. Look at `enum34` if you don't get what I mean. 

I'm working on this. I'll open up a ticket and post a link here some time soon.


---

Comment by jhpalmieri created at 2020-05-28 20:33:13

Replying to [comment:19 jhpalmieri]:
> I'm working on this. I'll open up a ticket and post a link here some time soon.

See #29754.


---

Comment by mkoeppe created at 2020-08-18 15:35:56

We can close this ticket as completed.


---

Comment by mkoeppe created at 2020-08-18 15:35:56

Changing status from new to needs_review.


---

Comment by dimpase created at 2020-08-21 17:51:53

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-08-22 08:52:15

Resolution: worksforme
