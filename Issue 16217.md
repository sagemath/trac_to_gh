# Issue 16217: Update openssl package to latest version.

Issue created by migration from Trac.

Original creator: tmonteil

Original creation time: 2014-06-07 12:11:58

CC:  ​jhpalmieri mariah ​was




---

Comment by tmonteil created at 2014-06-07 12:13:48

Changing type from PLEASE CHANGE to defect.


---

Comment by tmonteil created at 2014-06-07 12:13:48

Changing component from PLEASE CHANGE to packages: optional.


---

Comment by tmonteil created at 2014-06-07 12:48:28

Changing status from new to needs_review.


---

Comment by tmonteil created at 2014-06-07 12:48:28

Changing priority from major to critical.


---

Comment by tmonteil created at 2014-06-07 12:48:28

New commits:


---

Comment by slabbe created at 2014-06-10 18:51:27

Why do you delete the changelog part?


---

Comment by tmonteil created at 2014-06-10 19:17:49

See http://www.sagemath.org/doc/developer/packaging.html#the-spkg-txt-file (last sentence) and https://groups.google.com/forum/#!searchin/sage-devel/numpy/sage-devel/FNjYGRCxaUc/WDKM0pM9QJYJ

By the way, could you check whether the `Configure.patch` is still needed for Darwin (looks like the same `-arch` fix as in `pyzmq`) ?


---

Comment by slabbe created at 2014-06-10 20:23:24

With the current branch, running `./sage -i openssl` on my (32bit) machine ends with the following error:


```
Found local metadata for openssl-1.0.1h
Found local sources at /Users/slabbe/Applications/sage-review/upstream/openssl-1.0.1h.tar.gz
Checksum: 8d6d684a9430d5cc98a62a5d8fbda8cf vs 8d6d684a9430d5cc98a62a5d8fbda8cf
openssl-1.0.1h
====================================================
Setting up build directory for openssl-1.0.1h
Finished set up
****************************************************
Host system:
Darwin pol 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:55:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_I386 i386
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=/Users/slabbe/Applications/sage-review/local/bin/gcc
COLLECT_LTO_WRAPPER=/Users/slabbe/Applications/sage-review/local/libexec/gcc/i386-apple-darwin9.8.0/4.7.3/lto-wrapper
Target: i386-apple-darwin9.8.0
Configured with: ../src/configure --prefix=/Users/slabbe/Applications/sage-review/local --with-local-prefix=/Users/slabbe/Applications/sage-review/local --with-gmp=/Users/slabbe/Applications/sage-review/local --with-mpfr=/Users/slabbe/Applications/sage-review/local --with-mpc=/Users/slabbe/Applications/sage-review/local --with-system-zlib --disable-multilib --disable-nls  
Thread model: posix
gcc version 4.7.3 (GCC) 
****************************************************

[...]
Configured for darwin64-x86_64-cc.
[...]
x86_64cpuid.s:85:`movzbq' is only supported in 64-bit mode
[...]
x86_64cpuid.s:209:bad register name `%xmm14'
x86_64cpuid.s:210:bad register name `%xmm15'
x86_64cpuid.s:211:bad register name `%rcx'
x86_64cpuid.s:212:bad register name `%rdx'
x86_64cpuid.s:213:bad register name `%rsi'
x86_64cpuid.s:214:bad register name `%rdi'
x86_64cpuid.s:215:bad register name `%r8'
x86_64cpuid.s:216:bad register name `%r9'
x86_64cpuid.s:217:bad register name `%r10'
x86_64cpuid.s:218:bad register name `%r11'
x86_64cpuid.s:219:bad register name `%rsp)'
x86_64cpuid.s:232:bad register name `%rax'
x86_64cpuid.s:233:bad register name `%rcx'
make[1]: *** [x86_64cpuid.o] Error 1
make: *** [build_crypto] Error 1
Error building openssl.

real	0m8.937s
user	0m3.822s
sys	0m1.561s
************************************************************************
Error installing package openssl-1.0.1h
************************************************************************
```


As you suggested me, I tried after deleting the `Configure.patch`, and it worked:


```
$ ./sage -i openssl

[...]

real	4m9.688s
user	2m47.278s
sys	0m49.557s
Successfully installed openssl-1.0.1h
```


Here is my git status:


```
10 slabbe`@`pol ~/Applications/sage-review $ git status
# On branch t/16454
# Changes not staged for commit:
#   (use "git add/rm <file>..." to update what will be committed)
#   (use "git checkout -- <file>..." to discard changes in working directory)
#
#	deleted:    build/pkgs/openssl/patches/Configure.patch
#
no changes added to commit (use "git add" and/or "git commit -a")
```



---

Comment by git created at 2014-06-11 09:38:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2014-06-11 09:42:26

Thanks for testing, so i removed `Configure.patch`. Could you also try if tests work without the patch:


```
export SAGE_CHECK='yes'
sage -f openssl
```



---

Comment by slabbe created at 2014-06-13 08:50:01


```
$ export SAGE_CHECK='yes'
$ ./sage -f openssl

[...]

real	1m34.519s
user	0m16.406s
sys	0m18.216s
Successfully installed openssl-1.0.1h
Running the test suite for openssl-1.0.1h...

[...]

data content test streaming PEM format: OK
encrypted content test streaming PEM format, 128 bit RC2 key: OK
encrypted content test streaming PEM format, 40 bit RC2 key: OK
encrypted content test streaming PEM format, triple DES key: OK
encrypted content test streaming PEM format, 128 bit AES key: OK
Zlib not supported: compression tests skipped
ALL TESTS SUCCESSFUL.
../util/shlib_wrap.sh ./heartbeat_test
OPENSSL_CONF=apps/openssl.cnf util/opensslwrap.sh version -a
OpenSSL 1.0.1h 5 Jun 2014
built on: Fri Jun 13 10:36:56 CEST 2014
platform: darwin64-x86_64-cc
options:  bn(64,64) rc4(ptr,char) des(idx,cisc,16,int) idea(int) blowfish(idx) 
compiler: gcc -fPIC -fno-common -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -arch x86_64 -O3 -DL_ENDIAN -Wall -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM
OPENSSLDIR: "/Users/slabbe/Applications/sage-review/local/openssl"

real	1m17.717s
user	0m40.606s
sys	0m31.799s
Deleting temporary build directory
/Users/slabbe/Applications/sage-review/local/var/tmp/sage/build/openssl-1.0.1h
Finished installing openssl-1.0.1h.spkg
```


It works! ... on my old 32 bit machine. For me it is a positive review. Do jhpalmieri, mariah or ​was want to double check on other machine before closing this ticket?


---

Comment by slabbe created at 2014-07-01 13:56:42

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-07-02 00:34:11

Reviewer name


---

Comment by vbraun created at 2014-07-02 00:34:20

Changing status from positive_review to needs_work.


---

Comment by slabbe created at 2014-07-02 14:49:02

Changing status from needs_work to positive_review.


---

Comment by slabbe created at 2014-07-02 14:49:02

Sorry, my bad.

Sébastien


---

Comment by vbraun created at 2014-07-03 12:41:32

Resolution: fixed
