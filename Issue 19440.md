# Issue 19440: Let Graph.matching(value_only=True) always return an integer

Issue created by migration from https://trac.sagemath.org/ticket/19677

Original creator: tmonteil

Original creation time: 2015-12-07 16:59:02

CC:  dcoudert

Currently the `Graph.matching` method returns a float or an integer when called with `value_only` set to `True`, while, as a cardinality, it should always return an integer.


```
sage: G = graphs.RandomBipartite(10,10,0.5)
sage: type(G.matching(value_only=True))
<type 'float'>

sage: type(G.matching(use_edge_labels=False,value_only=True))
<type 'sage.rings.integer.Integer'>
```



---

Comment by tmonteil created at 2015-12-07 17:05:38

Changing status from new to needs_review.


---

Comment by tmonteil created at 2015-12-07 17:05:38

Forget about it, i did not see that `use_edge_labels` was set to `True` by default and that in this case, it makes sense not to consider the value as a cardinal.


---

Comment by tmonteil created at 2015-12-09 10:12:29

Finally i think that something is missing in the doc so that we do not have to read the source code to predict the output.


---

Comment by tmonteil created at 2015-12-09 10:12:29

Changing status from needs_review to needs_work.


---

Comment by @vipul79321 created at 2020-03-31 08:45:54

Replying to [comment:2 tmonteil]:
> Finally i think that something is missing in the doc so that we do not have to read the source code to predict the output.

Following are the possible outputs, when calling `g.matching()`://

Case 1: `value_only=False`, Only available output type is `<class 'list'>`//

Case 2: `value_only=True`
- Now if `use_edge_labels=False`, output is of type `<class 'sage.rings.integer.Integer'>`

- Now if `use_edge_labels=True`, output can be:
   

(1) `<class 'sage.rings.real_mpfr.RealNumber'>`,
    `<class'sage.rings.real_mpfr.RealLiteral'>`,                               
  `<class 'sage.rings.integer.Integer'>`
    using `algorithm = Edmonds`. 


(2) `<class 'float'>` using  `algorithm = LP`

I want to know what's the scope for this ticket, is it to modify documentation to give possible output cases(list and values) or different output types (as mentioned above) or is it to modify code to give uniform outputs over different algorithms?


---

Comment by @vipul79321 created at 2020-03-31 08:45:54

Changing status from needs_work to needs_info.


---

Comment by dcoudert created at 2020-03-31 10:51:41

If simple modifications could help unifying the outputs, it's a plus.


---

Comment by @vipul79321 created at 2020-04-01 13:22:49

Changing status from needs_info to needs_review.


---

Comment by git created at 2020-04-01 13:23:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vipul79321 created at 2020-04-01 13:26:19

By default method `matching` gives a `list`. When `value_only=True`, methods gives `integer` when `use_edge_label=False` and `float` when `use_edge_label=False`.
----

Single edge, integer label 

```
sage: edge = [(1,2,4)]
sage: g = Graph(edge)
sage: type(g.matching(algorithm='LP',use_edge_labels=True,value_only=True))
<class 'float'>
sage: type(g.matching(algorithm='Edmonds',use_edge_labels=True,value_only=True))
....: 
<class 'float'>
```


----

Single edge, float label

```
sage: edge = [(1,2,4.5)]
sage: g = Graph(edge)
sage: type(g.matching(algorithm='LP',use_edge_labels=True,value_only=True))
<class 'float'>
sage: type(g.matching(algorithm='Edmonds',use_edge_labels=True,value_only=True))
....: 
<class 'float'>
}}} 

----

Multiple edges, all integer labels
{{{
sage: edge = [(1,2,4), (2,3,5), (3,4,6), (4,1,2)]
sage: g = Graph(edge)
sage: type(g.matching(algorithm='LP',use_edge_labels=True,value_only=True))
<class 'float'>
sage: type(g.matching(algorithm='Edmonds',use_edge_labels=True,value_only=True))
....: 
<class 'float'>
}}}

----

Multiple edges, all non integer labels, but output becomes integer(only zero after decimal)
{{{
sage: edge = [(1,2,4.5), (2,3,5.5), (3,4,6.5), (4,1,2.5)]
sage: g = Graph(edge)
sage: g.matching(algorithm='LP',use_edge_labels=True,value_only=True)
11.0
sage: type(g.matching(algorithm='Edmonds',use_edge_labels=True,value_only=True))
....: 
<class 'float'>
sage: type(g.matching(algorithm='LP',use_edge_labels=True,value_only=True))
<class 'float'>
}}}

----

Multiple edges, all non integer labels and output also non integer
{{{
sage: edge = [(1,2,4.1), (2,3,5.5), (3,4,6.4), (4,1,2.7)]
sage: g = Graph(edge)
sage: g.matching(algorithm='LP',use_edge_labels=True,value_only=True)
10.5
sage: type(g.matching(algorithm='LP',use_edge_labels=True,value_only=True))
<class 'float'>
sage: type(g.matching(algorithm='Edmonds',use_edge_labels=True,value_only=True))
....: 
<class 'float'>
}}}


---

Comment by @vipul79321 created at 2020-04-01 13:27:33

Replying to [comment:4 dcoudert]:
> If simple modifications could help unifying the outputs, it's a plus.
Now, do we need to modify the documentation too? 
In my opinion current documentation conveys the output information quite well.


---

Comment by dcoudert created at 2020-04-02 08:22:30

I'm not ok with proposed change. Currently, we have

```
sage: edge = [(1,2,4)]
sage: g = Graph(edge)
sage: type(g.matching(algorithm='LP',use_edge_labels=True,value_only=True))
<class 'float'>
sage: type(g.matching(algorithm='LP',use_edge_labels=True,value_only=True, solver='GLPK'))
<class 'float'>
sage: type(g.matching(algorithm='LP',use_edge_labels=True,value_only=True, solver='Cplex'))
<class 'float'>
sage: type(g.matching(algorithm='LP',use_edge_labels=True,value_only=True, solver='Gurobi'))
<class 'float'>
sage: type(g.matching(algorithm='LP',use_edge_labels=True,value_only=True, solver='PPL'))
<class 'sage.rings.rational.Rational'>
```

and it is important to let the output be a rational when using PPL.

Actually, when all edge weights are integers, one could expect the output to be an integer (or a rational). So a more suitable solution could be to try to return an integer (or a rational) whenever possible, and a float otherwise.


---

Comment by @vipul79321 created at 2020-04-02 13:38:17

Replying to [comment:9 dcoudert]:
> I'm not ok with proposed change. Currently, we have
> {{{
> sage: edge = [(1,2,4)]
> sage: g = Graph(edge)
> sage: type(g.matching(algorithm='LP',use_edge_labels=True,value_only=True))
> <class 'float'>
> sage: type(g.matching(algorithm='LP',use_edge_labels=True,value_only=True, solver='GLPK'))
> <class 'float'>
> sage: type(g.matching(algorithm='LP',use_edge_labels=True,value_only=True, solver='Cplex'))
> <class 'float'>
> sage: type(g.matching(algorithm='LP',use_edge_labels=True,value_only=True, solver='Gurobi'))
> <class 'float'>
> sage: type(g.matching(algorithm='LP',use_edge_labels=True,value_only=True, solver='PPL'))
> <class 'sage.rings.rational.Rational'>
> }}}
> and it is important to let the output be a rational when using PPL.
> 
The change that  I proposed is in the output of `Edmonds` algorithm, so there will be no change in output of `LP` algorithm. Correct me, if I am wrong.

> Actually, when all edge weights are integers, one could expect the output to be an integer (or a rational). So a more suitable solution could be to try to return an integer (or a rational) whenever possible, and a float otherwise


Now, to get integer value from `Edmonds` whenever possible, we can try the following:

```
s = sum(W[frozenset(e)] for e in d)
if(isinstance(s,sage.rings.integer.Integer)
    return s
else
    return float(s)
```



---

Comment by @vipul79321 created at 2020-04-04 14:46:30

Changing status from needs_review to needs_info.


---

Comment by dcoudert created at 2020-04-05 08:09:25

The solution you propose does not help. For instance, 

```
sage: s = 3.0
sage: isinstance(s, sage.rings.integer.Integer)
False
```

and

```
sage: G = Graph([(1,2,3), (2,3,1.5)])
sage: G.matching(use_edge_labels=True, value_only=True)
3
sage: H = Graph([(1,2,3), (2,3,3.5)])
sage: H.matching(use_edge_labels=True, value_only=True)
3.50000000000000
sage: H = Graph([(1,2,3), (2,3,7/2)])
sage: H.matching(use_edge_labels=True, value_only=True)
7/2
sage: H = Graph([(1,2,3.1), (2,3,7/2)])
sage: H.matching(use_edge_labels=True, value_only=True)
7/2
```


The original goal of this ticket is to document that the type of the output varies depending on the types of the edge labels and also on the algorithm. I see no reason to force the output to float when it's not already an integer value.


---

Comment by git created at 2020-04-12 06:29:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vipul79321 created at 2020-04-12 06:31:30

Replying to [comment:12 dcoudert]:
> The solution you propose does not help. For instance, 
> {{{
> sage: s = 3.0
> sage: isinstance(s, sage.rings.integer.Integer)
> False
> }}}
> and
> {{{
> sage: G = Graph([(1,2,3), (2,3,1.5)])
> sage: G.matching(use_edge_labels=True, value_only=True)
> 3
> sage: H = Graph([(1,2,3), (2,3,3.5)])
> sage: H.matching(use_edge_labels=True, value_only=True)
> 3.50000000000000
> sage: H = Graph([(1,2,3), (2,3,7/2)])
> sage: H.matching(use_edge_labels=True, value_only=True)
> 7/2
> sage: H = Graph([(1,2,3.1), (2,3,7/2)])
> sage: H.matching(use_edge_labels=True, value_only=True)
> 7/2
> }}}
> 
> The original goal of this ticket is to document that the type of the output varies depending on the types of the edge labels and also on the algorithm. I see no reason to force the output to float when it's not already an integer value.

I have tried documenting the output. 
We can also add some examples of comment17 in EXAMPLE block describing different output types.
Any suggestions on this will be helpful.


---

Comment by @vipul79321 created at 2020-04-12 11:31:17

Changing status from needs_info to needs_review.


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by dcoudert created at 2020-04-15 16:58:00

This might be better (make sure to align on 80 columns).

```diff
-        - When ``value_only=False``, this method returns :class:`list` object
-          containing edges in maximum matching of `G`.
-
-        - When ``value_only=True``, this method returns,
-          sum of edge labels (default: ``1``) in maximum matching of `G`.
-          Output type may vary according to edge labels or algorithm used.
+        - When ``value_only=False``, this method returns the list of edges
+          of a maximum matching of `G`.
+
+        - When ``value_only=True`` (default), this method returns the sum
+          of the weights (default: ``1``) of the edges of a maximum matching of `G`.
+          The type of the output may vary according to the type of the edge labels and the algorithm used.
```



---

Comment by git created at 2020-04-16 14:30:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2020-04-17 10:09:47

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2020-04-17 10:09:47

LGTM. I don't know how to document more precisely the large number of different cases anyway.


---

Comment by vbraun created at 2020-04-19 19:25:25

Resolution: fixed
