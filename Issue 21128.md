# Issue 21128: Plot of cot() fails on real axis

Issue created by migration from https://trac.sagemath.org/ticket/21365

Original creator: paulmasson

Original creation time: 2016-08-29 20:33:42

Sample output:


```
sage: set_verbose(1)
sage: plot(cot(x),(x,.1,.5),plot_points=5)
verbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float
Unable to compute f(0.1) (time = 1.604825)
verbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float
Unable to compute f(0.199629500548) (time = 1.615858)
verbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float
Unable to compute f(0.263010079144) (time = 1.616164)
verbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float
Unable to compute f(0.373209060982) (time = 1.616497)
verbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float
Unable to compute f(0.5) (time = 1.616673)
verbose 0 (3743: plot.py, generate_plot_points) WARNING: When plotting, failed to evaluate function at 5 points.
verbose 0 (3743: plot.py, generate_plot_points) Last error message: 'can't convert complex to float'
Launched png viewer for Graphics object consisting of 0 graphics primitives
```


This is peculiar because the individual points look fine:


```
sage: cot(.5)
1.83048772171245
sage: type(cot(.5))
<type 'sage.rings.real_mpfr.RealNumber'>
```


Some type of coercion error somewhere? There is no problem plotting 1/tan().


---

Comment by rws created at 2016-09-02 13:11:32

Changing component from symbolics to graphics.


---

Comment by rws created at 2016-09-02 13:13:58

`real(cot(x))` works too.


---

Comment by rws created at 2016-09-02 13:38:36

When inserting a print at this line:
https://github.com/pynac/pynac/blob/master/ginac/inifcns_trig.cpp#L777
in order to print what is returned there I get:

```
9.96664442325922
verbose 1 (3743: plot.py, generate_plot_points) can't convert complex to float
Unable to compute f(0.1) (time = 0.176)
...
```

which is exactly `cot(0.1)` and does not look complex. So Pynac does not seem the direct cause of it.


---

Comment by paulmasson created at 2016-09-06 21:06:37

I downloaded older binaries to determine the version in which this error first occurs. The cotangent plots just fine in 7.1 and fails in 7.2.

Sage 7.2.rc1 included Pynac 0.6.5, which is precisely the last time the cotangent function was modified in Pynac. That is unlikely to be a coincidence.

This is not a graphics issue. The plotting method returning the error hasn't been modified in years. And this is not the first time in my experience a change in Pynac has had consequences for plotting (#20818).


---

Comment by paulmasson created at 2016-09-06 21:06:37

Changing component from graphics to symbolics.


---

Comment by tscrim created at 2016-09-06 21:19:53

The issue is when you pass a floating point, not a `sage.rings.real_mpfr.RealLiteral`:

```sage
sage: cot(float(0.5))
(1.8304877217124513+0j)
```

in contrast with:

```sage
sage: type(sin(float(1.1)))
<type 'float'>
```

Thus the bug is likely coming from that the internal plot functions use python/machine floating points as they are Python (i.e., not run through the Sage preparser).


---

Comment by tscrim created at 2016-09-06 21:31:03

Tracing slightly further, the python `math` (which is the first place the code checks) does not have a `cot` function. Looking into it more now.


---

Comment by tscrim created at 2016-09-06 22:36:24

Okay, I'm not quite sure what happens. It seems to fall into the generic `Function.__call__`, but I'm just tracing through the logical output at this point.


---

Comment by paulmasson created at 2016-09-16 21:01:56

Will be fixed in the next release of Pynac.


---

Comment by paulmasson created at 2016-09-16 21:01:56

Changing status from new to needs_info.


---

Comment by rws created at 2016-10-06 12:54:50

Changing status from needs_info to needs_review.


---

Comment by rws created at 2016-10-06 12:54:50

I confirm this is fixed in #21623 so this ticked is duplicate.


---

Comment by tscrim created at 2016-10-06 13:53:02

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2016-10-06 13:53:02

Confirmed as well.


---

Comment by rws created at 2016-11-05 16:24:23

I'll reuse this ticket for the doctests.


---

Comment by rws created at 2016-11-05 16:24:23

Changing status from positive_review to needs_work.


---

Comment by rws created at 2016-11-05 16:34:04

Changing status from needs_work to needs_review.


---

Comment by rws created at 2016-11-05 16:34:04

New commits:


---

Comment by tscrim created at 2016-11-05 16:35:14

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-11-08 23:42:25

Resolution: fixed
