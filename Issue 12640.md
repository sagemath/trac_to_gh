# Issue 12640: Bug in summation of toric divisors

Issue created by migration from https://trac.sagemath.org/ticket/12812

Original creator: novoselt

Original creation time: 2012-04-05 17:37:50

Assignee: AlexGhitza

CC:  vbraun

Here is the problem:

```
sage: P1 = toric_varieties.P1()
sage: print sum([P1.divisor(1)])
V(s) + V(t)
```

Which I think comes from

```
sage: print P1.divisor(1).parent()(0)
V(s)
```

Perhaps, we can allow creation of divisors by indices of rays/variables, but only in the form `P1.divisor(0)`? Since zero in the group of divisors should be just zero and other integers don't really make sense.


---

Comment by novoselt created at 2012-04-06 17:46:21

Hi Volker,

I looked through the code and a possible solution is to catch integers in `_element_constructor_` of `ToricDivisorGroup` instead of passing them down to `ToricDivisor`. "Catch" means replace 0 with `None` to construct the trivial divisor and raise an exception for anything else.

It is not very elegant, but keeps current functionality and `X.divisor(i)` returning the divisor of the i-th ray still seems quite reasonable to me, while `X.divisor_group()(i)` is questionable.

If you agree, I'll make the change and try to make it clear in the documentation of all the methods involved.


---

Comment by vbraun created at 2012-04-06 19:15:06

The whole `ToricDivisor(X, int)` construction is a bit wonky. Thinking about it, the fact that  `ToricDivisor(X,0)` is not the trivial element in this Abelian group is just confusing. I'd prefer to get rid of integer arguments in it altogether, there are already enough ways to construct a toric divisor. And you can always replace it with `ToricDivisorGroup(X).gen(int)`, so its not like its a big loss. I'd like to keep the convenience method `X.divisor(i)`, mind you. What do you think?


---

Comment by novoselt created at 2012-04-06 20:11:48

Sounds good! Will post a patch over the weekend.


---

Attachment


---

Comment by novoselt created at 2012-04-07 14:20:14

Changing status from new to needs_review.


---

Comment by novoselt created at 2012-04-07 14:20:14

Changing keywords from "" to "toric".


---

Comment by vbraun created at 2012-04-19 14:40:40

Looks good!


---

Comment by vbraun created at 2012-04-19 14:40:40

Changing status from needs_review to positive_review.


---

Comment by novoselt created at 2012-04-23 22:14:43

Why can't this go into 5.0? It is a bugfix, not an enhancement, and it is small and non-invasive.


---

Comment by jdemeyer created at 2012-04-26 21:57:49

Resolution: fixed


---

Comment by jdemeyer created at 2012-04-29 14:12:58

sage-5.0.beta15 == sage-5.0.rc0
