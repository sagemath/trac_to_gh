# Issue 24609: Make the face lattice of a polyhedron a lattice

Issue created by migration from Trac.

Original creator: jipilab

Original creation time: 2018-02-26 21:53:14

CC:  vdelecroix moritz mkoeppe chapoton jmantysalo

Keywords: days93, poset, polytope

Currently, the output object of the method `face_lattice` is not a lattice but a finite poset. This is also a good opportunity to revamp the method `Hasse_diagram_from_incidences` which is ill-named.




---

Comment by novoselt created at 2018-02-26 23:15:02

Is it ill-named or ill-implemented, if it is in need of a revamp?-)


---

Comment by jipilab created at 2018-02-27 08:06:36

I'd say it is not an exclusive "or" in this case...!

The Hasse diagram is an oriented acyclic graph, whereas what is returned is a poset, not the Hasse diagram of that poset... So this is misleading. And I do not see why we could not readily return a LatticePoset object if it is already. (Maybe there are some reasons not to do this?)

This function is very handy sometimes and could be used for (abstract) combinatorial polytopes.


---

Comment by novoselt created at 2018-02-28 04:59:02

I'm not aware of any reasons to avoid `LatticePoset`. The current output is either inherited from the old implementation or it was the best I found when rewriting it. One thing I do remember however - some tricks were necessary to construct the poset object fast, naive call to the constructor was taking several times more time than computing that acyclic graph itself.


---

Comment by jipilab created at 2018-02-28 08:22:44

Replying to [comment:3 novoselt]:
> I'm not aware of any reasons to avoid `LatticePoset`. The current output is either inherited from the old implementation or it was the best I found when rewriting it. One thing I do remember however - some tricks were necessary to construct the poset object fast, naive call to the constructor was taking several times more time than computing that acyclic graph itself.

Ah! Ok, good to know! It will be worth benchmarking the difference.


---

Comment by chapoton created at 2018-06-25 20:05:56

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-06-25 20:05:56

New commits:


---

Comment by novoselt created at 2018-06-25 20:34:45

So since I mentioned it before - was there any benchmarking/profiling looking into the speed of creating this lattice? It used to matter a lot to me when I was working with thousands of (quite small) polytopes.


---

Comment by jmantysalo created at 2018-06-26 04:37:15

The comment


```
# In principle, it is recommended to use Poset or in this case perhaps
# even LatticePoset, but it seems to take several times more time
# than the above computation, makes unnecessary copies, and crashes.
```


can now be removed.

I suppose this is not going to change the speed (meets and joins will be lazy evaluated), but haven't tested that.


---

Comment by git created at 2018-06-26 05:05:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-06-26 07:17:43

Please, could someone who is interested do the benchmarking ?


---

Comment by git created at 2018-06-26 08:36:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-27 08:01:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-06-27 08:23:19

timings, before:

```
sage: P = polytopes.hypercube(4)
sage: %time P.face_lattice()
CPU times: user 44.7 ms, sys: 4.22 ms, total: 48.9 ms
Wall time: 40.8 ms
Finite poset containing 82 elements with distinguished linear extension
sage: P = polytopes.associahedron(['A',4])
sage: %time P.face_lattice()
CPU times: user 95.7 ms, sys: 8.17 ms, total: 104 ms
Wall time: 98.6 ms
Finite poset containing 198 elements with distinguished linear extension
```

and after

```
sage: P = polytopes.hypercube(4)
sage: %time P.face_lattice()
CPU times: user 33.4 ms, sys: 8.65 ms, total: 42.1 ms
Wall time: 37.9 ms
Finite lattice containing 82 elements with distinguished linear extension
sage: P = polytopes.associahedron(['A',4])
sage: %time P.face_lattice()
CPU times: user 96.1 ms, sys: 3.9 ms, total: 100 ms
Wall time: 95.6 ms
Finite lattice containing 198 elements with distinguished linear extension
```



---

Comment by jmantysalo created at 2018-06-28 09:22:14

Changing status from needs_review to positive_review.


---

Comment by jmantysalo created at 2018-06-28 09:22:14

All seems to be OK.


---

Comment by vbraun created at 2018-06-30 15:21:20

Resolution: fixed
