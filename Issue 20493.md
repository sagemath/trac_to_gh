# Issue 20493: Break up sage_setup.autogen.interpreters into a package

archive/issues_020493.json:
```json
{
    "body": "`sage_setup.autogen.interpreters` was getting a bit long (over 4000 lines) and it was hard to understand how some of it was organized.  So I split it up into several logical modules.  This seemed to have [some support](https://groups.google.com/d/msg/sage-devel/RB4-A-p5pRI/0T8ZtGpzCwAJ).\n\nHow exactly I chose to break it up is certainly up for debate, but I thought this was fairly logical to start.  In the `__init__.py` I still import all from all submodules so that the API for the `sage_setup.autogen.interpreters` module is unchanged.\n\nI would like to get some version of this accepted soon, as I have a few tasks to work on in this module and it would be easier (though not necessary) to work on it on top of this change.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20730\n\n",
    "created_at": "2016-05-31T10:42:55Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "enhancement"
    ],
    "title": "Break up sage_setup.autogen.interpreters into a package",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20493",
    "user": "embray"
}
```
`sage_setup.autogen.interpreters` was getting a bit long (over 4000 lines) and it was hard to understand how some of it was organized.  So I split it up into several logical modules.  This seemed to have [some support](https://groups.google.com/d/msg/sage-devel/RB4-A-p5pRI/0T8ZtGpzCwAJ).

How exactly I chose to break it up is certainly up for debate, but I thought this was fairly logical to start.  In the `__init__.py` I still import all from all submodules so that the API for the `sage_setup.autogen.interpreters` module is unchanged.

I would like to get some version of this accepted soon, as I have a few tasks to work on in this module and it would be easier (though not necessary) to work on it on top of this change.

Issue created by migration from https://trac.sagemath.org/ticket/20730





---

archive/issue_comments_282703.json:
```json
{
    "body": "I suggest to add `from __future__ import absolute_import, print_function` to all those modules.",
    "created_at": "2016-05-31T10:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282703",
    "user": "jdemeyer"
}
```

I suggest to add `from __future__ import absolute_import, print_function` to all those modules.



---

archive/issue_comments_282704.json:
```json
{
    "body": "Replying to [comment:1 jdemeyer]:\n> I suggest to add `from __future__ import absolute_import, print_function` to all those modules.\n\nFunny, I actually did that at first but then took it out since it wasn't strictly needed.  No problem adding them back in though.",
    "created_at": "2016-05-31T12:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282704",
    "user": "embray"
}
```

Replying to [comment:1 jdemeyer]:
> I suggest to add `from __future__ import absolute_import, print_function` to all those modules.

Funny, I actually did that at first but then took it out since it wasn't strictly needed.  No problem adding them back in though.



---

archive/issue_comments_282705.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-05-31T12:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282705",
    "user": "embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_282706.json:
```json
{
    "body": "Not sure what component to put this under.  There isn't one for `fast_callable`.",
    "created_at": "2016-05-31T12:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282706",
    "user": "embray"
}
```

Not sure what component to put this under.  There isn't one for `fast_callable`.



---

archive/issue_comments_282707.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-31T12:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282707",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_282708.json:
```json
{
    "body": "Now there is ;-)",
    "created_at": "2016-06-01T00:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282708",
    "user": "vdelecroix"
}
```

Now there is ;-)



---

archive/issue_comments_282709.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to fast_callable.",
    "created_at": "2016-06-01T00:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282709",
    "user": "vdelecroix"
}
```

Changing component from PLEASE CHANGE to fast_callable.



---

archive/issue_comments_282710.json:
```json
{
    "body": "Trying to play with your branch I got\n\n```\n[install] [sagelib-7.3.beta2] make[3]: Entering directory '/opt/sage/src'\n[install] [sagelib-7.3.beta2] make[3]: warning: -jN forced in submake: disabling jobserver mode.\n[install] [sagelib-7.3.beta2] make[3]: *** No rule to make target 'sage_setup/autogen/interpreters.py', needed by 'sage/ext/interpreters/__init__.py'.  Stop.\n[install] [sagelib-7.3.beta2] make[3]: Leaving directory '/opt/sage/src'\n```\n",
    "created_at": "2016-06-01T00:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282710",
    "user": "vdelecroix"
}
```

Trying to play with your branch I got

```
[install] [sagelib-7.3.beta2] make[3]: Entering directory '/opt/sage/src'
[install] [sagelib-7.3.beta2] make[3]: warning: -jN forced in submake: disabling jobserver mode.
[install] [sagelib-7.3.beta2] make[3]: *** No rule to make target 'sage_setup/autogen/interpreters.py', needed by 'sage/ext/interpreters/__init__.py'.  Stop.
[install] [sagelib-7.3.beta2] make[3]: Leaving directory '/opt/sage/src'
```




---

archive/issue_comments_282711.json:
```json
{
    "body": "Replying to [comment:6 vdelecroix]:\n> Trying to play with your branch I got\n> {{{\n> [install] [sagelib-7.3.beta2] make[3]: Entering directory '/opt/sage/src'\n> [install] [sagelib-7.3.beta2] make[3]: warning: -jN forced in submake: disabling jobserver mode.\n> [install] [sagelib-7.3.beta2] make[3]: *** No rule to make target 'sage_setup/autogen/interpreters.py', needed by 'sage/ext/interpreters/__init__.py'.  Stop.\n> [install] [sagelib-7.3.beta2] make[3]: Leaving directory '/opt/sage/src'\n> }}}\n\nThanks. I don't run `make` that often for building sagelib (as opposed to just running `setup.py ` directly) so I didn't catch this.",
    "created_at": "2016-06-01T11:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282711",
    "user": "embray"
}
```

Replying to [comment:6 vdelecroix]:
> Trying to play with your branch I got
> {{{
> [install] [sagelib-7.3.beta2] make[3]: Entering directory '/opt/sage/src'
> [install] [sagelib-7.3.beta2] make[3]: warning: -jN forced in submake: disabling jobserver mode.
> [install] [sagelib-7.3.beta2] make[3]: *** No rule to make target 'sage_setup/autogen/interpreters.py', needed by 'sage/ext/interpreters/__init__.py'.  Stop.
> [install] [sagelib-7.3.beta2] make[3]: Leaving directory '/opt/sage/src'
> }}}

Thanks. I don't run `make` that often for building sagelib (as opposed to just running `setup.py ` directly) so I didn't catch this.



---

archive/issue_comments_282712.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-06-01T14:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282712",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_282713.json:
```json
{
    "body": "That should fix it.",
    "created_at": "2016-06-01T14:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282713",
    "user": "embray"
}
```

That should fix it.



---

archive/issue_comments_282714.json:
```json
{
    "body": "Why did you make `src/Makefile` so complicated? I find it hard to understand what you're doing there.",
    "created_at": "2016-06-01T15:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282714",
    "user": "jdemeyer"
}
```

Why did you make `src/Makefile` so complicated? I find it hard to understand what you're doing there.



---

archive/issue_comments_282715.json:
```json
{
    "body": "Which part is hard to understand?  The most important change is that since there is not a single `interpreters.py`, if any file in the `sage.autogen.inteprreters` package is changed the interpreter sources should be regenerated.  Even that's a rough approximation :)",
    "created_at": "2016-06-02T09:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282715",
    "user": "embray"
}
```

Which part is hard to understand?  The most important change is that since there is not a single `interpreters.py`, if any file in the `sage.autogen.inteprreters` package is changed the interpreter sources should be regenerated.  Even that's a rough approximation :)



---

archive/issue_comments_282716.json:
```json
{
    "body": "Replying to [comment:11 embray]:\n> if any file in the `sage.autogen.intepreters` package is changed the interpreter sources should be regenerated.\n\nThat can be done with a single wildcard like we already do for the PARI stuff:\n\n```\nsage/libs/pari/auto_gen.pxi: $(SAGE_LOCAL)/share/pari/pari.desc \\\n        sage/libs/pari/decl.pxi sage_setup/autogen/pari/*.py\n    python -c \"from sage_setup.autogen.pari import rebuild; rebuild()\"\n```\n",
    "created_at": "2016-06-02T09:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282716",
    "user": "jdemeyer"
}
```

Replying to [comment:11 embray]:
> if any file in the `sage.autogen.intepreters` package is changed the interpreter sources should be regenerated.

That can be done with a single wildcard like we already do for the PARI stuff:

```
sage/libs/pari/auto_gen.pxi: $(SAGE_LOCAL)/share/pari/pari.desc \
        sage/libs/pari/decl.pxi sage_setup/autogen/pari/*.py
    python -c "from sage_setup.autogen.pari import rebuild; rebuild()"
```




---

archive/issue_comments_282717.json:
```json
{
    "body": "The current layout I came up with has a `sage_setup.autogen.interpreters.specs` subpackage, so a single wildcard would not work.\n\nI could do away with the subpackage and that's arguable.  I think it makes it easier to find the implementations for the individual interpreter specs, rather than intermingling them with support modules.",
    "created_at": "2016-06-02T13:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282717",
    "user": "embray"
}
```

The current layout I came up with has a `sage_setup.autogen.interpreters.specs` subpackage, so a single wildcard would not work.

I could do away with the subpackage and that's arguable.  I think it makes it easier to find the implementations for the individual interpreter specs, rather than intermingling them with support modules.



---

archive/issue_comments_282718.json:
```json
{
    "body": "One thing I could do that would definitely simplify this a bit would be instead of the `interpreters.print_names()` function I added, the interpreters module could (and probably should) have a function that returns the names of all the files it generates.  That way this wouldn't have to be duplicated in the Makefile, and it would be made simpler.",
    "created_at": "2016-06-02T13:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282718",
    "user": "embray"
}
```

One thing I could do that would definitely simplify this a bit would be instead of the `interpreters.print_names()` function I added, the interpreters module could (and probably should) have a function that returns the names of all the files it generates.  That way this wouldn't have to be duplicated in the Makefile, and it would be made simpler.



---

archive/issue_comments_282719.json:
```json
{
    "body": "Even with the subdirectory you could still use wildcards...\n\nAnyway, there should be a solution which doesn't involve 20 new lines added to `src/Makefile`.",
    "created_at": "2016-06-02T13:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282719",
    "user": "jdemeyer"
}
```

Even with the subdirectory you could still use wildcards...

Anyway, there should be a solution which doesn't involve 20 new lines added to `src/Makefile`.



---

archive/issue_comments_282720.json:
```json
{
    "body": "Well it's a difference of one `find` or two wildcard patterns.  I suppose the latter has the slight advantage of being more explicit.  I could try it and see how it looks.",
    "created_at": "2016-06-02T13:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282720",
    "user": "embray"
}
```

Well it's a difference of one `find` or two wildcard patterns.  I suppose the latter has the slight advantage of being more explicit.  I could try it and see how it looks.



---

archive/issue_comments_282721.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-06-13T14:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282721",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_282722.json:
```json
{
    "body": "Simplified the Makefile a smidge.  It's actually better this way than I had it before, because now `sage_setup.autogen.interpreters` alone is responsible for knowing the names of the files it outputs, reducing the need to keep track of that information in multiple places.",
    "created_at": "2016-06-13T14:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282722",
    "user": "embray"
}
```

Simplified the Makefile a smidge.  It's actually better this way than I had it before, because now `sage_setup.autogen.interpreters` alone is responsible for knowing the names of the files it outputs, reducing the need to keep track of that information in multiple places.



---

archive/issue_comments_282723.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-08-16T11:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282723",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_282724.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2016-08-24T09:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282724",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_282725.json:
```json
{
    "body": "Rebased again (incorporating some small Python3-compat fixes that were made in the meantime) and fixed some issues that were causing some tests to fail in the sage_setup package.",
    "created_at": "2016-08-24T09:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282725",
    "user": "embray"
}
```

Rebased again (incorporating some small Python3-compat fixes that were made in the meantime) and fixed some issues that were causing some tests to fail in the sage_setup package.



---

archive/issue_comments_282726.json:
```json
{
    "body": "Jeroen, are you going to be finishing the review of this ticket?",
    "created_at": "2016-09-09T13:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282726",
    "user": "tscrim"
}
```

Jeroen, are you going to be finishing the review of this ticket?



---

archive/issue_comments_282727.json:
```json
{
    "body": "We should have talked about this ticket this week. I know I'm repeating myself, but I still don't like what you did to `src/Makefile`.\n\nAnyway, I'll look at the rest.",
    "created_at": "2016-09-09T13:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282727",
    "user": "jdemeyer"
}
```

We should have talked about this ticket this week. I know I'm repeating myself, but I still don't like what you did to `src/Makefile`.

Anyway, I'll look at the rest.



---

archive/issue_comments_282728.json:
```json
{
    "body": "What's the point of this:\n\n```\n# nodoctest -- __main__ modules are just for running the module from the\n# command line and should not be doctested\n```\n\n\nIt doesn't matter since the file doesn't have doctests anyway.",
    "created_at": "2016-09-09T13:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282728",
    "user": "jdemeyer"
}
```

What's the point of this:

```
# nodoctest -- __main__ modules are just for running the module from the
# command line and should not be doctested
```


It doesn't matter since the file doesn't have doctests anyway.



---

archive/issue_comments_282729.json:
```json
{
    "body": "Replying to [comment:24 jdemeyer]:\n> What's the point of this:\n> {{{\n> # nodoctest -- __main__ modules are just for running the module from the\n> # command line and should not be doctested\n> }}}\n> \n> It doesn't matter since the file doesn't have doctests anyway.\n\nIf it didn't matter I wouldn't have even thought to put such a thing.  The doctest runner still imports a module to determine if there are any doctests in the module.  Since everything in a `__main__` module is is executed upon import, we don't want the doctest runner to even import it (there is no `if __name__ == '__main__'` equivalent since it's a tautology in this case).",
    "created_at": "2016-09-09T14:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282729",
    "user": "embray"
}
```

Replying to [comment:24 jdemeyer]:
> What's the point of this:
> {{{
> # nodoctest -- __main__ modules are just for running the module from the
> # command line and should not be doctested
> }}}
> 
> It doesn't matter since the file doesn't have doctests anyway.

If it didn't matter I wouldn't have even thought to put such a thing.  The doctest runner still imports a module to determine if there are any doctests in the module.  Since everything in a `__main__` module is is executed upon import, we don't want the doctest runner to even import it (there is no `if __name__ == '__main__'` equivalent since it's a tautology in this case).



---

archive/issue_comments_282730.json:
```json
{
    "body": "I agree with Jeroen (comment 23) that these Makefile tricks seem unnecessarily complicated.\nJust the list the few files that are there one by one in the Makefile.\n\nBy the way, #21480 puts this interpreter source generation business under control of setup.sh. So there would be an option to do these kind of things in Python, rather than in Makefile.",
    "created_at": "2016-09-16T04:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282730",
    "user": "mkoeppe"
}
```

I agree with Jeroen (comment 23) that these Makefile tricks seem unnecessarily complicated.
Just the list the few files that are there one by one in the Makefile.

By the way, #21480 puts this interpreter source generation business under control of setup.sh. So there would be an option to do these kind of things in Python, rather than in Makefile.



---

archive/issue_comments_282731.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-09-18T21:17:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282731",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_282732.json:
```json
{
    "body": "Sorry but I really need to push back on this one.  Earlier I did have a version of this that listed the files manually and then later one that was a little less manual but even then Jeroen complained that it made the file \"too long\" or something.\n\nI also reject the characterization of this has Makefile \"tricks\".  These are standard features of make that have been around forever.  These objections just sound like you've never encountered a non-trivial makefile before (which I know isn't true).\n\nHonestly I would just as soon get rid of this makefile entirely, but as long as it's there I see no problem here.",
    "created_at": "2016-09-22T15:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282732",
    "user": "embray"
}
```

Sorry but I really need to push back on this one.  Earlier I did have a version of this that listed the files manually and then later one that was a little less manual but even then Jeroen complained that it made the file "too long" or something.

I also reject the characterization of this has Makefile "tricks".  These are standard features of make that have been around forever.  These objections just sound like you've never encountered a non-trivial makefile before (which I know isn't true).

Honestly I would just as soon get rid of this makefile entirely, but as long as it's there I see no problem here.



---

archive/issue_comments_282733.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-09-22T15:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282733",
    "user": "embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_282734.json:
```json
{
    "body": "In the meantime you're holding up real work by bikeshedding over code that you arbitrarily think is \"too complicated\".",
    "created_at": "2016-09-22T15:36:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282734",
    "user": "embray"
}
```

In the meantime you're holding up real work by bikeshedding over code that you arbitrarily think is "too complicated".



---

archive/issue_comments_282735.json:
```json
{
    "body": "Replying to [comment:28 embray]:\n> I also reject the characterization of this has Makefile \"tricks\".  These are standard features of make that have been around forever.  These objections just sound like you've never encountered a non-trivial makefile before (which I know isn't true).\n\nI've encountered too many.",
    "created_at": "2016-09-22T16:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282735",
    "user": "mkoeppe"
}
```

Replying to [comment:28 embray]:
> I also reject the characterization of this has Makefile "tricks".  These are standard features of make that have been around forever.  These objections just sound like you've never encountered a non-trivial makefile before (which I know isn't true).

I've encountered too many.



---

archive/issue_comments_282736.json:
```json
{
    "body": "Replying to [comment:29 embray]:\n> In the meantime you're holding up real work by bikeshedding over code that you arbitrarily think is \"too complicated\".\n\nI understand but it's not just bikeshedding. It's also about readability. Every time I look at that `src/Makefile` I really have to think hard to understand what is going on. And usually, that is a bad sign.\n\nIf you convince me that all that extra complexity is really needed, then I don't mind to merge this. But at this point, I am not yet convinced.",
    "created_at": "2016-09-23T09:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282736",
    "user": "jdemeyer"
}
```

Replying to [comment:29 embray]:
> In the meantime you're holding up real work by bikeshedding over code that you arbitrarily think is "too complicated".

I understand but it's not just bikeshedding. It's also about readability. Every time I look at that `src/Makefile` I really have to think hard to understand what is going on. And usually, that is a bad sign.

If you convince me that all that extra complexity is really needed, then I don't mind to merge this. But at this point, I am not yet convinced.



---

archive/issue_comments_282737.json:
```json
{
    "body": "I find that unconvincing--have you ever looked at sage's toplevel Makefile?  *That's* confusing.  Given the other complexities of sage I do find nitpicking over the (highly subjective) \"readability\" of one makefile confusing.  Maybe you're just not used to reading makefiles that happen to make use of these features, but I have seen plenty before I don't think it's unreadable at all.\n\nIf we're going to remove this makefile eventually anyways, which we should, then just let it be.",
    "created_at": "2016-09-23T11:25:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282737",
    "user": "embray"
}
```

I find that unconvincing--have you ever looked at sage's toplevel Makefile?  *That's* confusing.  Given the other complexities of sage I do find nitpicking over the (highly subjective) "readability" of one makefile confusing.  Maybe you're just not used to reading makefiles that happen to make use of these features, but I have seen plenty before I don't think it's unreadable at all.

If we're going to remove this makefile eventually anyways, which we should, then just let it be.



---

archive/issue_comments_282738.json:
```json
{
    "body": "And yes, it's needed, because the previous file was actually wrong.  I already demonstrated this to you before weeks ago.  If you're going to use make to require that generated files are up to date, then you have to actually provide the names of those generated files.  Most of the time that can be provided implicitly by a pattern (e.g. `%.c => %.o`) but that's not the case here.  In part because make was really not designed for stuff like this in the first place.",
    "created_at": "2016-09-23T11:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282738",
    "user": "embray"
}
```

And yes, it's needed, because the previous file was actually wrong.  I already demonstrated this to you before weeks ago.  If you're going to use make to require that generated files are up to date, then you have to actually provide the names of those generated files.  Most of the time that can be provided implicitly by a pattern (e.g. `%.c => %.o`) but that's not the case here.  In part because make was really not designed for stuff like this in the first place.



---

archive/issue_comments_282739.json:
```json
{
    "body": "On further reflection, by my own logic if my preference is to remove the makefile entirely then it doesn't matter what's in there. So if it'll help get this done I'll remove the changes changes and focus on helping the efforts to improve Sage's build.",
    "created_at": "2016-09-23T21:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282739",
    "user": "embray"
}
```

On further reflection, by my own logic if my preference is to remove the makefile entirely then it doesn't matter what's in there. So if it'll help get this done I'll remove the changes changes and focus on helping the efforts to improve Sage's build.



---

archive/issue_comments_282740.json:
```json
{
    "body": "OK, maybe I already I asked you this, but why run a Python command to determine `INTERP_SOURCES`? Why not a simple wildcard?\n\nEdit: never mind, this `INTERP_SOURCES` has **generated** sources.",
    "created_at": "2016-09-24T13:33:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282740",
    "user": "jdemeyer"
}
```

OK, maybe I already I asked you this, but why run a Python command to determine `INTERP_SOURCES`? Why not a simple wildcard?

Edit: never mind, this `INTERP_SOURCES` has **generated** sources.



---

archive/issue_comments_282741.json:
```json
{
    "body": "Replying to [comment:33 embray]:\n> And yes, it's needed, because the previous file was actually wrong.\n\nMaybe *technically* wrong but right for all practical purposes. Given that all these files are generated at the same time together, there is really nothing wrong with relying on the timestamp of just file.",
    "created_at": "2016-09-24T13:37:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282741",
    "user": "jdemeyer"
}
```

Replying to [comment:33 embray]:
> And yes, it's needed, because the previous file was actually wrong.

Maybe *technically* wrong but right for all practical purposes. Given that all these files are generated at the same time together, there is really nothing wrong with relying on the timestamp of just file.



---

archive/issue_comments_282742.json:
```json
{
    "body": "Replying to [comment:25 embray]:\n> The doctest runner still imports a module to determine if there are any doctests in the module.\n\nSorry to say this, but that can't be right. The Sage doctester looks at the files textually to determine the doctests. If what you say is true, we would have the same problem for the docbuilder (`src/sage_setup/docbuild/__main__.py`) but we don't...\n\nFor the sake of simplicity, I would remove that `nodoctests` block.",
    "created_at": "2016-09-24T13:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282742",
    "user": "jdemeyer"
}
```

Replying to [comment:25 embray]:
> The doctest runner still imports a module to determine if there are any doctests in the module.

Sorry to say this, but that can't be right. The Sage doctester looks at the files textually to determine the doctests. If what you say is true, we would have the same problem for the docbuilder (`src/sage_setup/docbuild/__main__.py`) but we don't...

For the sake of simplicity, I would remove that `nodoctests` block.



---

archive/issue_comments_282743.json:
```json
{
    "body": "However the doctester determines the doctests, the fact remains that at some point it *imports* the module.  That happens here: https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/doctest/sources.py#n670\n\nThe reason that isn't a problem for `src/sage_setup/docbuild/__main__.py` (and believe me, this had me pulling my hair out) is that it is listed in this insidious [`in_lib`](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/doctest/sources.py#n575) attribute.  I described more problems with this in #20729.\n\nBut if you don't believe me try removing it yourself and see.  Like I said, I wouldn't have even thought to add such a thing in the first place if I didn't have a good reason.",
    "created_at": "2016-09-26T11:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282743",
    "user": "embray"
}
```

However the doctester determines the doctests, the fact remains that at some point it *imports* the module.  That happens here: https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/doctest/sources.py#n670

The reason that isn't a problem for `src/sage_setup/docbuild/__main__.py` (and believe me, this had me pulling my hair out) is that it is listed in this insidious [`in_lib`](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/doctest/sources.py#n575) attribute.  I described more problems with this in #20729.

But if you don't believe me try removing it yourself and see.  Like I said, I wouldn't have even thought to add such a thing in the first place if I didn't have a good reason.



---

archive/issue_comments_282744.json:
```json
{
    "body": "Replying to [comment:36 jdemeyer]:\n> Replying to [comment:33 embray]:\n> > And yes, it's needed, because the previous file was actually wrong.\n> \n> Maybe *technically* wrong but right for all practical purposes. Given that all these files are generated at the same time together, there is really nothing wrong with relying on the timestamp of just file.\n\nI encountered cases in practice where this was not reliable.  But that was months ago now and I can't recall the specifics.  Like I said, it doesn't matter. I don't care anymore since I'm going to work on getting rid of the makefile anyways.",
    "created_at": "2016-09-26T11:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282744",
    "user": "embray"
}
```

Replying to [comment:36 jdemeyer]:
> Replying to [comment:33 embray]:
> > And yes, it's needed, because the previous file was actually wrong.
> 
> Maybe *technically* wrong but right for all practical purposes. Given that all these files are generated at the same time together, there is really nothing wrong with relying on the timestamp of just file.

I encountered cases in practice where this was not reliable.  But that was months ago now and I can't recall the specifics.  Like I said, it doesn't matter. I don't care anymore since I'm going to work on getting rid of the makefile anyways.



---

archive/issue_comments_282745.json:
```json
{
    "body": "Replying to [comment:38 embray]:\n> However the doctester determines the doctests, the fact remains that at some point it *imports* the module.  That happens here: https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/doctest/sources.py#n670\n> \n> The reason that isn't a problem for `src/sage_setup/docbuild/__main__.py` (and believe me, this had me pulling my hair out) is that it is listed in this insidious [`in_lib`](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/doctest/sources.py#n575) attribute.  I described more problems with this in #20729.\n\nOK, I commented on that ticket. Let me know what you think.",
    "created_at": "2016-09-26T15:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282745",
    "user": "jdemeyer"
}
```

Replying to [comment:38 embray]:
> However the doctester determines the doctests, the fact remains that at some point it *imports* the module.  That happens here: https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/doctest/sources.py#n670
> 
> The reason that isn't a problem for `src/sage_setup/docbuild/__main__.py` (and believe me, this had me pulling my hair out) is that it is listed in this insidious [`in_lib`](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/doctest/sources.py#n575) attribute.  I described more problems with this in #20729.

OK, I commented on that ticket. Let me know what you think.



---

archive/issue_comments_282746.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-01-09T09:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282746",
    "user": "embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_282747.json:
```json
{
    "body": "Needs to be rebased again...\n\nAll the argument about the makefile is a moot point now that that makefile has been removed.",
    "created_at": "2017-03-03T13:59:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282747",
    "user": "embray"
}
```

Needs to be rebased again...

All the argument about the makefile is a moot point now that that makefile has been removed.



---

archive/issue_comments_282748.json:
```json
{
    "body": "Also #20729 has been fixed in the mean time, so you shouldn't need to mess with the doctester anymore...",
    "created_at": "2017-03-03T14:09:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282748",
    "user": "jdemeyer"
}
```

Also #20729 has been fixed in the mean time, so you shouldn't need to mess with the doctester anymore...



---

archive/issue_comments_282749.json:
```json
{
    "body": "Right, thanks for the reminder.  I'll work on this when I get back from vacation.",
    "created_at": "2017-03-03T14:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282749",
    "user": "embray"
}
```

Right, thanks for the reminder.  I'll work on this when I get back from vacation.



---

archive/issue_comments_282750.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-04-07T12:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282750",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_282751.json:
```json
{
    "body": "Rebased again, on top of current develop.  That made this ticket much simpler, now that it doesn't require any build system changes.\n\nThere's not much to this now other than refactoring and code reformatting--no real substantive changes.  I made sure to incorporate changes to the `interpreters` module that have been made since I last worked on this.",
    "created_at": "2017-04-07T12:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282751",
    "user": "embray"
}
```

Rebased again, on top of current develop.  That made this ticket much simpler, now that it doesn't require any build system changes.

There's not much to this now other than refactoring and code reformatting--no real substantive changes.  I made sure to incorporate changes to the `interpreters` module that have been made since I last worked on this.



---

archive/issue_comments_282752.json:
```json
{
    "body": "Back to needs review?",
    "created_at": "2017-04-07T15:03:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282752",
    "user": "tscrim"
}
```

Back to needs review?



---

archive/issue_comments_282753.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-04-07T15:07:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282753",
    "user": "embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_282754.json:
```json
{
    "body": "Yeah, meant to do that.",
    "created_at": "2017-04-07T15:07:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282754",
    "user": "embray"
}
```

Yeah, meant to do that.



---

archive/issue_comments_282755.json:
```json
{
    "body": "Would be nice to get this taken care of finally.",
    "created_at": "2017-04-11T12:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282755",
    "user": "embray"
}
```

Would be nice to get this taken care of finally.



---

archive/issue_comments_282756.json:
```json
{
    "body": "Conflicts with #20238 in various ways....",
    "created_at": "2017-04-11T13:10:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282756",
    "user": "jdemeyer"
}
```

Conflicts with #20238 in various ways....



---

archive/issue_comments_282757.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2017-04-11T13:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282757",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_282758.json:
```json
{
    "body": "Only minor conflicts.  I've rebased on your branch in #20238.",
    "created_at": "2017-04-11T13:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282758",
    "user": "embray"
}
```

Only minor conflicts.  I've rebased on your branch in #20238.



---

archive/issue_comments_282759.json:
```json
{
    "body": "This looks like a good addition and will allow to close #21459 as a temporary but quick solution for Cygwin.\n\nWhat about the dependency on #20238?\nCan we make the dependency the other way around?\nOr will #20238 be finished soon?",
    "created_at": "2017-04-25T11:28:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282759",
    "user": "jpflori"
}
```

This looks like a good addition and will allow to close #21459 as a temporary but quick solution for Cygwin.

What about the dependency on #20238?
Can we make the dependency the other way around?
Or will #20238 be finished soon?



---

archive/issue_comments_282760.json:
```json
{
    "body": "Replying to [comment:53 jpflori]:\n> Or will #20238 be finished soon?\n\nIt is finished already since almost a month.",
    "created_at": "2017-04-25T12:05:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282760",
    "user": "jdemeyer"
}
```

Replying to [comment:53 jpflori]:
> Or will #20238 be finished soon?

It is finished already since almost a month.



---

archive/issue_comments_282761.json:
```json
{
    "body": "Now that you've given #20238 a positive review this should be fine as is.",
    "created_at": "2017-04-25T14:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282761",
    "user": "embray"
}
```

Now that you've given #20238 a positive review this should be fine as is.



---

archive/issue_comments_282762.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-27T11:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282762",
    "user": "jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_282763.json:
```json
{
    "body": "The split here is a very good idea.\nThe autogenerating file was huge and a pain to parse for a human.",
    "created_at": "2017-04-27T11:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282763",
    "user": "jpflori"
}
```

The split here is a very good idea.
The autogenerating file was huge and a pain to parse for a human.



---

archive/issue_comments_282764.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-28T23:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20493#issuecomment-282764",
    "user": "vbraun"
}
```

Resolution: fixed
