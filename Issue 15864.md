# Issue 15864: double_description

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2014-04-08 16:00:20

CC:  dimpase nthiery jkeitel




---

Comment by git created at 2014-04-11 15:50:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-04-13 10:17:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-04-13 13:39:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2014-04-13 19:32:09

Changing component from PLEASE CHANGE to geometry.


---

Comment by vbraun created at 2014-04-13 19:32:09

Changing status from new to needs_review.


---

Comment by vbraun created at 2014-04-13 19:32:09

Changing type from PLEASE CHANGE to defect.


---

Comment by vbraun created at 2014-04-13 19:32:18

Changing type from defect to enhancement.


---

Comment by dimpase created at 2014-04-13 19:41:31

Wow, cool! Have you written your own double description in P/Cython?


---

Comment by vbraun created at 2014-04-13 19:45:06

Changing keywords from "" to "days57".


---

Comment by vbraun created at 2014-04-13 19:45:06

Python for now. It first has to be correct, then we can make it faster ;-)  This is work done last week during Sage Days 57 in Cernay.


---

Comment by rws created at 2014-05-10 05:35:53

Changing status from needs_review to needs_work.


---

Comment by jkeitel created at 2014-05-20 11:40:41

Last 10 new commits:


---

Comment by jkeitel created at 2014-05-20 11:41:05

Changing status from needs_work to needs_review.


---

Comment by git created at 2014-05-20 12:17:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jkeitel created at 2014-05-20 12:19:19

I've rebased the branch and made a few very minor changes (almost all formatting). I'd like to review the patch, but since
- there's still a `DEBUG=True`
- I don't know much about polyhedra
that's probably not the best idea. The code looks good though.


---

Comment by vbraun created at 2014-05-20 12:56:46

I renamed `DEBUG` into `VERIFY_RESULT`. Just a less scary name. The rationale for defaulting to true (for now) is explained in the comment above it.
----
New commits:


---

Comment by git created at 2014-05-30 10:56:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by leif created at 2014-05-30 16:16:22

Is it intentional that one `.verify()` uses `assert` while the other prints "incorrect!" (along with the differences) but doesn't raise an exception?


---

Comment by vbraun created at 2014-05-30 16:39:43

Yes


---

Comment by dimpase created at 2014-06-02 16:32:18

Can we have in Examples a nontrivial example of a polytope with irrational vertices, e.g. the [600-cell](http://en.wikipedia.org/wiki/600-cell) ?


---

Comment by vbraun created at 2014-06-02 20:32:38

All examples that can't be defined over QQ should be moved to the new backend, but thats for another ticket.


---

Comment by dimpase created at 2014-06-02 21:04:37

Replying to [comment:22 vbraun]:
> All examples that can't be defined over QQ should be moved to the new backend, but thats for another ticket.

For this ticket any serious examples/tests are lacking; that's why it would be great to have something substantially bigger than a triangle.


---

Comment by vbraun created at 2014-06-03 11:23:04

Really big examples probably need some further improvements to the implementation. But I'm obviously not going to work on these until the base implementation is in Sage. We can of course wait years/forever until everything is perfect and only then merge it with Sage. Or we can release early, and release often.


---

Comment by dimpase created at 2014-06-03 11:30:19

Replying to [comment:24 vbraun]:
> Really big examples probably need some further improvements to the implementation. But I'm obviously not going to work on these until the base implementation is in Sage. We can of course wait years/forever until everything is perfect and only then merge it with Sage. Or we can release early, and release often. 

I don't think that 600-cell is a big example; it is a 4-dimensional polytope with 120 vertices!
If about the only example the new codepath is checked on is a plane triangle, then I say no, this needs work...

Would you like me to construct this test?


---

Comment by chapoton created at 2014-06-03 12:02:44

There is already some code for the vertices of the 120 and 600-cell in graphs.Cell600 and graphs.Cell120. Not a very fast code, alas. But maybe that could help to build the polytope.


---

Comment by jkeitel created at 2014-06-03 12:02:57

I just tried constructing it by simply passing the list of 120 vertices and after 12 minutes and 9 GB of consumed RAM, I killed the computation.


---

Comment by vbraun created at 2014-06-03 12:33:03

You'd have to use `QQ[phi]` instead of `AA` as the base field, otherwise its going to blow up for sure.


---

Comment by vbraun created at 2014-06-03 12:36:57

PS: There are many higher dimensional tests for the double description implementation, so saying that "only the triangle is tested" is completely wrong.


---

Comment by leif created at 2014-06-03 14:14:59

Replying to [comment:28 vbraun]:
> You'd have to use `QQ[phi]` instead of `AA` as the base field, otherwise its going to blow up for sure.

... which could be seen as an argument to add that example (properly). ;-)


---

Comment by vbraun created at 2014-06-03 14:57:58

Replying to [comment:30 leif]:
> ... which could be seen as an argument to add that example (properly). ;-)

Feel free to open a ticket for your feature request.

Also, even if it were fast enough for a doctest, the 600-cell would be a terrible way to test the functionality. Field arithmetic is tested elsewhere, so for *testing* you should use examples over QQ where you actually have something to compare to...


---

Comment by jkeitel created at 2014-06-03 15:02:44

In any case, although using `QQ[phi]` helps enormously with the RAM usage, two hours of runtime still haven't produced a result for me.

However, I do believe that Volker is making a reasonable point. While it would be desirable to have a fast implementation, at least the proposed patch is adding functionality that could eventually be made faster.


---

Comment by leif created at 2014-06-03 15:04:05

Or add the *example* with `AA` (and an explanation) and `# don't try this at home` (aka `# not tested`).


---

Comment by dimpase created at 2014-06-03 15:31:31

Replying to [comment:32 jkeitel]:
> In any case, although using `QQ[phi]` helps enormously with the RAM usage, two hours of runtime still haven't produced a result for me.
> 
> However, I do believe that Volker is making a reasonable point. While it would be desirable to have a fast implementation, at least the proposed patch is adding functionality that could eventually be made faster.

absence of a sizeable example with irrational numbers suggests that there could be memory leaks which only manifest themselves on such an example; you might make the example a bit smaller by only taking the 96 vertices with irrational coordinates, constructing the [snub 24-cell](http://en.wikipedia.org/wiki/Snub_24-cell).


---

Comment by vbraun created at 2014-06-03 15:33:00

Replying to [comment:33 leif]:
> Or add the *example* with `AA` (and an explanation) and `# don't try this at home` (aka `# not tested`).

I'd rather spend my time improving things than documenting what currently doesn't work. Of course feel free to add it yourself if you really want it.


---

Comment by dimpase created at 2014-06-03 15:35:46

Replying to [comment:35 vbraun]:
> Replying to [comment:33 leif]:
> > Or add the *example* with `AA` (and an explanation) and `# don't try this at home` (aka `# not tested`).
> 
> I'd rather spend my time improving things than documenting what currently doesn't work. Of course feel free to add it yourself if you really want it.

Well, it would be OK adding a line in the docs saying that this is a prototype implementation, and might be painfully slow on largish examples. This would be better than a impression that things work great already.


---

Comment by vbraun created at 2014-06-03 15:41:31

Replying to [comment:36 dimpase]:
> Well, it would be OK adding a line in the docs saying that this is a prototype implementation, and might be painfully slow on largish examples. This would be better than a impression that things work great already.

How about "this is the world's fastest code for polyhedra over degree > 2 extensions". Because, as far as I know, there is nothing else. IMHO it does work great.

Also, nothing in the computation really knows about whether a number is rational or not. There might be memory leaks, or really all kinds of bugs, in the underlying field implementation. In fact, since there is a whole load of different fields in Sage it is quite certain that there is a bug in at least one of them. But whats the point of trying to test field implementations in the polyhedra module?


---

Comment by chapoton created at 2014-06-03 15:51:39

Some pyflakes warnings in the new files:

```
src/sage/geometry/polyhedron/backend_field.py:24: 'QQ' imported but unused
src/sage/geometry/polyhedron/backend_field.py:24: 'ZZ' imported but unused
src/sage/geometry/polyhedron/backend_field.py:25: 'LCM_list' imported but unused
src/sage/geometry/polyhedron/backend_field.py:26: 'matrix' imported but unused
```



---

Comment by chapoton created at 2014-06-03 15:52:58

and some pep8 comments also:

```
1       E201 whitespace after '['
8       E225 missing whitespace around operator
1       E231 missing whitespace after ':'
2       E301 expected 1 blank line, found 0
4       E303 too many blank lines (3)
70      E501 line too long (80 characters)
27      W291 trailing whitespace
46      W293 blank line contains whitespace
1       W391 blank line at end of file
```



---

Comment by vbraun created at 2014-06-03 16:06:53

This is consistent with our written whitespace policy.

Replying to [comment:39 chapoton]:
> and some pep8 comments also:
> {{{
> 1       E201 whitespace after '['
> 8       E225 missing whitespace around operator
> 1       E231 missing whitespace after ':'
> 2       E301 expected 1 blank line, found 0
> 4       E303 too many blank lines (3)
> 70      E501 line too long (80 characters)
> 27      W291 trailing whitespace
> 46      W293 blank line contains whitespace
> 1       W391 blank line at end of file
> }}}


---

Comment by git created at 2014-06-03 16:10:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-06-03 16:20:20

Well, ok, I understand that it is better not to touch whitespaces to avoid conflicts, but maybe you could still make the effort to remove blanks (pep8 errors `W***`) in the new files that you introduce ?


---

Comment by dimpase created at 2014-06-03 16:37:33

Replying to [comment:37 vbraun]:
> Replying to [comment:36 dimpase]:
> > Well, it would be OK adding a line in the docs saying that this is a prototype implementation, and might be painfully slow on largish examples. This would be better than a impression that things work great already.
> 
> How about "this is the world's fastest code for polyhedra over degree > 2 extensions". 

well, this will work, if you add `:-)` (or `8-)`) at the end :-)


---

Comment by vbraun created at 2014-06-03 17:50:30

Replying to [comment:42 chapoton]:
> Well, ok, I understand that it is better not to touch whitespaces to avoid conflicts, but maybe you could still make the effort to remove blanks (pep8 errors `W***`) in the new files that you introduce ?

If you care about trailing whitespace then write a commit hook. But I don't have any intention of removing inconspicuous trailing whitespace by hand. If you want to talk about whitespace policies then bring it up on sage-devel.


---

Comment by chapoton created at 2014-06-03 19:19:02

I did the whitespace removal for you, plus found a few other very minor typos.
----
New commits:


---

Comment by nthiery created at 2014-06-03 20:09:17

Replying to [comment:44 vbraun]:
> ... But I don't have any intention of removing inconspicuous trailing whitespace by hand.

M-x delete-trailing-whitespace :-)


---

Comment by vbraun created at 2014-06-04 09:28:20

Its still worth less than nothing to go around and try to hold up tickets until Frederic Chapoton gets around to detect and fix trailing whitespace. At a rate of about one a day we'll have finally tackled the evils of trailing whitespace in just about 5 years. Seriously, we'll never possibly lose as much developer time over the tiny annoyance of [End] moving you past the last non-whitespace character of the line. If you care about this then you need to develop a process, anything else is just bullshit.

In any case, I'm still waiting for a review.


---

Comment by dimpase created at 2014-06-04 11:45:51

Replying to [comment:47 vbraun]:

> In any case, I'm still waiting for a review.
I am ready to give it a positive review, provided that the comment about the code speed you agreed to add gets `:-)` attached at the end.


---

Comment by leif created at 2014-06-04 12:05:47

Replying to [comment:48 dimpase]:
> Replying to [comment:47 vbraun]:
> 
> > In any case, I'm still waiting for a review.
> I am ready to give it a positive review, provided that the comment about the code speed you agreed to add gets `:-)` attached at the end.

Write a commit hook that automatically augments such sentences.


---

Comment by dimpase created at 2014-06-04 13:43:32

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2014-06-04 13:43:32

Replying to [comment:49 leif]:
> Replying to [comment:48 dimpase]:
> > Replying to [comment:47 vbraun]:
> > 
> > > In any case, I'm still waiting for a review.
> > I am ready to give it a positive review, provided that the comment about the code speed you agreed to add gets `:-)` attached at the end.
> 
> Write a commit hook that automatically augments such sentences.
I will file this as a git-trac issue...


---

Comment by vbraun created at 2014-06-04 22:02:20

Resolution: fixed
