# Issue 32984: Add example of projective space to manifold catalog

Issue created by migration from https://trac.sagemath.org/ticket/33221

Original creator: tkarn

Original creation time: 2022-01-23 19:29:24

CC:  tscrim tkarn @mjungmath

Keywords: projective, manifolds, catalog

Add projective space and charts in the manifold catalog


---

Comment by tkarn created at 2022-01-23 19:32:49

Still has an issue with the domain of transition maps causing one test to fail.
----
New commits:


---

Comment by @mjungmath created at 2022-01-23 20:21:27

For now this approach is all right. I am curious at which dimension this implementation becomes problematic in view of computational times.


---

Comment by git created at 2022-01-23 20:57:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-01-23 21:06:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tkarn created at 2022-01-23 21:07:56

Changing status from new to needs_review.


---

Comment by tscrim created at 2022-01-23 23:53:15

Some trivial comments:

Why not use `gens()`?

Also, this should be split over 2 lines*

```
Ci, Cj = P.atlas()[i], P.atlas()[j]
```


I feel like the more standard latex would be to make it (blackboard?) bold. However, we should match what happens elsewhere, such as for Euclidean space and spheres. (This is more of a bikeshedding comment.) Should this also have a normal name being passed too?


---

Comment by tkarn created at 2022-01-24 02:24:26

Replying to [comment:6 tscrim]:
> Some trivial comments:
> 
> Why not use `gens()`?

It appears that no such method exists for charts - am I missing something?

```
sage: P = manifolds.RealProjectiveSpace(3)
sage: A = P.atlas(); A
[Chart (U0, (x_1, x_2, x_3)),
 Chart (U1, (x_0, x_2, x_3)),
 Chart (U2, (x_0, x_1, x_3)),
 Chart (U3, (x_0, x_1, x_2)),
 Chart (U0_inter_U1, (x_1, x_2, x_3)),
 Chart (U0_inter_U1, (x_0, x_2, x_3)),
 Chart (U0_inter_U2, (x_1, x_2, x_3)),
 Chart (U0_inter_U2, (x_0, x_1, x_3)),
 Chart (U0_inter_U3, (x_1, x_2, x_3)),
 Chart (U0_inter_U3, (x_0, x_1, x_2)),
 Chart (U1_inter_U2, (x_0, x_2, x_3)),
 Chart (U1_inter_U2, (x_0, x_1, x_3)),
 Chart (U1_inter_U3, (x_0, x_2, x_3)),
 Chart (U1_inter_U3, (x_0, x_1, x_2)),
 Chart (U2_inter_U3, (x_0, x_1, x_3)),
 Chart (U2_inter_U3, (x_0, x_1, x_2))]
sage: A[0].gens()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-3-eff7e167b774> in <module>
----> 1 A[Integer(0)].gens()

AttributeError: 'RealChart' object has no attribute 'gens'
```


> Should this also have a normal name being passed too?

I was thinking that it has the normal name "P", unless I misunderstand what you meant by "normal name"


---

Comment by git created at 2022-01-24 02:35:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tkarn created at 2022-01-24 02:37:46

Replying to [comment:6 tscrim]:
> I feel like the more standard latex would be to make it (blackboard?) bold. However, we should match what happens elsewhere, such as for Euclidean space and spheres. 

Spheres do appear to use `\mathbb` (see https://sagemanifolds.obspm.fr/examples/pdf/SM_sphere_S2.pdf) so I adjusted accordingly, reflected in most recent commit.


---

Comment by egourgoulhon created at 2022-01-24 19:51:30

Replying to [comment:9 tkarn]:
> Replying to [comment:6 tscrim]:
> > I feel like the more standard latex would be to make it (blackboard?) bold. However, we should match what happens elsewhere, such as for Euclidean space and spheres. 
> 
> Spheres do appear to use `\mathbb` (see https://sagemanifolds.obspm.fr/examples/pdf/SM_sphere_S2.pdf) so I adjusted accordingly, reflected in most recent commit.

Indeed, at the moment, we have

```
sage: latex(EuclideanSpace(2))
\mathbb{E}^{2}
sage: latex(manifolds.Sphere(3))
\mathbb{S}^{3}
```

So please use `\mathbb{P}` for projective spaces as well.

PS: there is some inconsistency with the above in 

```
sage: latex(manifolds.RealLine())
\Bold{R}
```

This should probably be fixed/discussed in another ticket. I guess this was to be consistent with 

```
sage: latex(RR)
\Bold{R}
```

but this may not be necessary, because after all `RR` and `manifolds.RealLine()` are two different beasts and having a distinction in the LaTeX output might not be a bad thing. Also in the long term, IMHO we should get rid of this `\Bold` extra command, which unnecessarily pollutes the Jupyter notebooks.


---

Comment by egourgoulhon created at 2022-01-24 19:59:18

BTW, thanks for having opened this ticket! I've added it to the metaticket #30525. Feel free to perform such an addition yourself next time you are opening a ticket connected to manifolds. It helps to keep track of what's going on and to prepare the [release tour](https://wiki.sagemath.org/ReleaseTours/sage-9.5).


---

Comment by tkarn created at 2022-01-24 20:19:49

Replying to [comment:11 egourgoulhon]:
> BTW, thanks for having opened this ticket! I've added it to the metaticket #30525. Feel free to perform such an addition yourself next time you are opening a ticket connected to manifolds. It helps to keep track of what's going on and to prepare the [release tour](https://wiki.sagemath.org/ReleaseTours/sage-9.5). 

Will do! And thanks for the advice on latex representation.


---

Comment by tscrim created at 2022-01-25 00:21:33

Ah right, that was done as a workaround to get the `X.<a,b> = M.chart()` preparser syntax working. You should just use `X[:]` instead (which is what `_first_ngens()` does).

For the standard name, I meant pass a `name="RP{}".format(dim)`. However, as you said, it is already implicitly there with the unnamed `"P"` input. I had missed that, sorry. For consistency, I think it should follow the latex name.

You also need `{}` for the latex in case the dimension is at least 10, so `latex_name=r"\mathbb{{RP}}^``".format(dim)`.

I would use a nested `for` loop instead of `combinations`:

```python
A = P.atlas()
for i in range(dim+1):
    Ci = A[i]
    gi = Ci[:]
    for j in range(i,dim+1):
        Cj = A[j]
        gj = Cj[:]
```

and so on. Although being slightly clever, you can combine this with the previous `for` loop for creating the charts (this might not be the best option in terms of code presentation; only in terms of optimization). I also might not rely on `atlas` being in a particular order either and instead just store the charts you make in a list you make.

It will also be faster if you explicitly set the inverse rather than having Sage compute it (and you can skip the checks too in the final version).

It might be good to also give a latex name to the subsets of `U_{i}`.


---

Comment by git created at 2022-01-25 05:43:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tkarn created at 2022-01-25 05:44:48

Replying to [comment:13 tscrim]:
Thanks for all the suggestions! They are incorporated in the latest commit.


---

Comment by tscrim created at 2022-01-25 07:52:51

Other than the fact that this is using the real numbers, making the documentation incorrect (there is no ```field```), I have no further comments. Anyone else?


---

Comment by git created at 2022-01-25 14:48:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2022-01-26 17:10:25

Replying to [comment:16 tscrim]:
> I have no further comments. Anyone else?
A minor typo in the documentation, which prevents the display of `dim`:

```diff
-    - ``P`` -- the projective space `RP^d` where `d =```dim``.
+    - ``P`` -- the projective space `RP^d` where `d =``dim``.
```



---

Comment by tkarn created at 2022-01-26 18:21:24

Replying to [comment:18 egourgoulhon]:
> Replying to [comment:16 tscrim]:
> > I have no further comments. Anyone else?
> A minor typo in the documentation, which prevents the display of `dim`:
> {{{
> #!diff
> -    - ``P`` -- the projective space `RP^d` where `d =```dim``.
> +    - ``P`` -- the projective space `RP^d` where `d =``dim``.
> }}}

Thanks for the catch. I am hoping that `d=` is in math mode and `dim` is in fixed-width font. Will adding a space between `=` and `dim` 

```
`d=` ``dim``
}}} 

work for that?


---

Comment by egourgoulhon created at 2022-01-26 18:34:41

Replying to [comment:19 tkarn]:
> 
> Thanks for the catch. I am hoping that `d=` is in math mode and `dim` is in fixed-width font. 

Ah yes, I see.

>Will adding a space between `=` and `dim` 
> {{{
> `d=` ``dim``
> }}} 
> 
> work for that?
> 
I would say yes, but Sphinx is sometimes touchy. You can try by yourself: implement the change and run

```
sage -b
sage -docbuild reference/manifolds html
```

This is faster than running `make doc`.


---

Comment by git created at 2022-01-26 19:02:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tkarn created at 2022-01-26 19:06:56

Replying to [comment:20 egourgoulhon]:
> Replying to [comment:19 tkarn]:
> > 
> > Thanks for the catch. I am hoping that `d=` is in math mode and `dim` is in fixed-width font. 
> 
> Ah yes, I see.
> 
> >Will adding a space between `=` and `dim` 
> > {{{
> > `d=` ``dim``
> > }}} 
> > 
> > work for that?
> > 
> I would say yes, but Sphinx is sometimes touchy. You can try by yourself: implement the change and run
> {{{
> sage -b
> sage -docbuild reference/manifolds html
> }}}
> This is faster than running `make doc`.

Adding the space does work, and is reflected in the most recent commit. Thanks for the tip on doc building.


---

Comment by tscrim created at 2022-01-27 00:43:55

Instead of using `\Bold{R}`, you can just use the Sage-specific macro `\RR` (good for uniformity and easy if we decide to change our minds).


---

Comment by git created at 2022-01-28 22:37:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tkarn created at 2022-01-28 22:38:18

Replying to [comment:23 tscrim]:
> Instead of using `\Bold{R}`, you can just use the Sage-specific macro `\RR` (good for uniformity and easy if we decide to change our minds).

Fixed! Thanks!


---

Comment by git created at 2022-01-28 23:30:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-01-29 05:57:40

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-01-29 05:57:40

In regards to comment:2, this seems to be reasonably fast up to dimension 10 (I didn't check further):

```
sage: P4 = manifolds.RealProjectiveSpace(4)
sage: %time P = manifolds.RealProjectiveSpace(3)
CPU times: user 448 ms, sys: 16 ms, total: 464 ms
Wall time: 387 ms
sage: %time P = manifolds.RealProjectiveSpace(4)
CPU times: user 888 ms, sys: 24 ms, total: 912 ms
Wall time: 778 ms
sage: %time P = manifolds.RealProjectiveSpace(5)
CPU times: user 1.53 s, sys: 44 ms, total: 1.57 s
Wall time: 1.35 s
sage: %time P = manifolds.RealProjectiveSpace(6)
CPU times: user 2.47 s, sys: 56 ms, total: 2.53 s
Wall time: 2.17 s
sage: %time P = manifolds.RealProjectiveSpace(7)
CPU times: user 3.81 s, sys: 112 ms, total: 3.92 s
Wall time: 3.38 s
sage: %time P = manifolds.RealProjectiveSpace(8)
CPU times: user 5.44 s, sys: 128 ms, total: 5.56 s
Wall time: 4.78 s
sage: %time P = manifolds.RealProjectiveSpace(9)
CPU times: user 7.54 s, sys: 168 ms, total: 7.71 s
Wall time: 6.6 s
sage: %time P = manifolds.RealProjectiveSpace(10)
CPU times: user 10.2 s, sys: 224 ms, total: 10.4 s
Wall time: 8.95 s
```

This will be a good placeholder until projective space has its own class.


---

Comment by vbraun created at 2022-02-13 10:16:42

Resolution: fixed


---

Comment by egourgoulhon created at 2022-02-14 10:23:01

Now that the ticket branch has been merged in Sage 9.6.beta1, there remains a last thing to do: preparing some examples of use for the [Sage 9.6 release tour](https://wiki.sagemath.org/ReleaseTours/sage-9.6), on the same footing as what has been done for Sage 9.5:
https://wiki.sagemath.org/ReleaseTours/sage-9.5#Manifolds.


---

Comment by egourgoulhon created at 2022-04-03 21:19:06

Replying to [comment:29 egourgoulhon]:
> Now that the ticket branch has been merged in Sage 9.6.beta1, there remains a last thing to do: preparing some examples of use for the [Sage 9.6 release tour](https://wiki.sagemath.org/ReleaseTours/sage-9.6), on the same footing as what has been done for Sage 9.5:
> https://wiki.sagemath.org/ReleaseTours/sage-9.5#Manifolds. 

Ping (since the release of Sage 9.6 seems to be close).


---

Comment by tkarn created at 2022-04-04 13:01:34

Thanks for the ping. Just took care of it! https://wiki.sagemath.org/ReleaseTours/sage-9.6#Projective_spaces


---

Comment by egourgoulhon created at 2022-04-04 13:11:06

Replying to [comment:31 tkarn]:
> Thanks for the ping. Just took care of it! https://wiki.sagemath.org/ReleaseTours/sage-9.6#Projective_spaces

Thanks a lot!
