# Issue 20051: Arithmetic in QQbar mutates elements

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2016-03-25 12:30:21

CC:  vdelecroix

When doing arithmetic with a `QQbar` element, operations subtly mutate the elements which should be constant.

In the example below, we see that `M^2` is displayed differently after we compute the rank of `M`:

```
sage: M = matrix(QQbar, 2, 2, [1, sqrt(-3), -sqrt(-3), 3])
sage: M^2
[   4.000000000000000?  6.928203230275509?*I]
[-6.928203230275509?*I    12.00000000000000?]
sage: rank(M)
1
sage: M^2
[                    4  6.928203230275509?*I]
[-6.928203230275509?*I                    12]
```



---

Comment by vdelecroix created at 2016-03-28 01:02:44

Simpler example

```
sage: a = AA(3).sqrt() + AA(2).sqrt() - AA(3).sqrt() - AA(2).sqrt()
sage: a
0.?e-18
sage: a == 0
True
sage: a
0
```

But what is wrong with it? It is just a change in the display? You think that we should have a string representation that is independent of what is known about the number?


---

Comment by jdemeyer created at 2016-03-28 08:35:27

I agree that it's not a major problem. But I did find it confusing.

> You think that we should have a string representation that is independent of what is known about the number?

That would of course be better, but I don't know how feasible that is.


---

Comment by vdelecroix created at 2016-03-28 11:40:11

Replying to [comment:3 jdemeyer]:
> I agree that it's not a major problem. But I did find it confusing.
> 
> > You think that we should have a string representation that is independent of what is known about the number?
> 
> That would of course be better, but I don't know how feasible that is.

Look at the method `interval_exact`: exactification will occur only when the number looks like an exact float. Though, using this approach will change representations of elements in `QQ`. And without exactification, we have no way to detect rationality...


---

Comment by mkoeppe created at 2020-08-17 04:06:36

Works as intended, we should close it as "wontfix".


---

Comment by mkoeppe created at 2020-08-17 04:06:36

Changing status from new to needs_review.


---

Comment by @mwageringel created at 2020-08-17 17:08:52

Changing status from needs_review to positive_review.


---

Comment by @mwageringel created at 2020-08-17 17:08:52

This is a duplicate of #25458.


---

Comment by chapoton created at 2020-08-17 18:42:00

Resolution: duplicate
