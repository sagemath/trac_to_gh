# Issue 30767: Add full codestyle as recommendation

Issue created by migration from https://trac.sagemath.org/ticket/31004

Original creator: @tobiasdiez

Original creation time: 2020-12-04 12:19:51

CC:  mkoeppe jipilab chapoton

The current pycodestyle configuration only covers a few rules that are also enforced by the patchbot. While this is a good starting point, IDEs pick up this configuration and only show warnings for these rules. In order to make sage's code adhere more to the pep8 recommendations, it is desirable to get warnings for all code style errors. Thus, in this ticket, we enable all pycodestyle warnings. These can be tested as usually by calling `pycodestyle` or `tox -e pycodestyle`. Moreover, the current minimal ruleset is tested via the new environment `tox -e pycodestyle_minimal`, which is also used in the new lint github action workflow.


---

Comment by @tobiasdiez created at 2020-12-04 12:20:03

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-12-04 18:06:57

This is a good idea. Two points:

1) I think using `pycodestyle-minimal` would be more tox-ic (tox factor conditions)


2) I think `envlist` at the top should do `pycodestyle-minimal`, not `pycodestyle`. This affects the default when `-e` is not used.


---

Comment by mkoeppe created at 2020-12-04 18:07:17

Changing type from PLEASE CHANGE to enhancement.


---

Comment by git created at 2020-12-05 11:33:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2020-12-05 11:36:45

Thanks for the review! I've now implemented your suggestions.


---

Comment by mkoeppe created at 2020-12-05 17:55:04

In `lint.yml`, I think you don't need to install `relint` or `pycodestyle` because tox will take care of that in its virtual environment


---

Comment by mkoeppe created at 2020-12-05 17:58:11

Also, the help message shown by `sage -advanced` needs some cosmetic adjustments because the longest environment name is longer now


---

Comment by mkoeppe created at 2020-12-06 00:11:38

Changing status from needs_review to needs_work.


---

Comment by @tobiasdiez created at 2020-12-07 21:20:32

Replying to [comment:7 mkoeppe]:
> In `lint.yml`, I think you don't need to install `relint` or `pycodestyle` because tox will take care of that in its virtual environment

You are probably right, but that's not really related to this ticket.


---

Comment by @tobiasdiez created at 2020-12-07 21:27:02

Replying to [comment:8 mkoeppe]:
> Also, the help message shown by `sage -advanced` needs some cosmetic adjustments because the longest environment name is longer now

I'm not sure what you mean, but `sage -advanced` doesn't show any tox-related infos for me (but the indent for example ecl is off). Maybe it's because I also get the following error when running `sage`:

```
/mnt/d/Programming/sage/src/.venv/bin/sage-version.sh: line 3: __requires__: command not found
/mnt/d/Programming/sage/src/.venv/bin/sage-version.sh: line 4: syntax error near unexpected token `'pkg_resources''
/mnt/d/Programming/sage/src/.venv/bin/sage-version.sh: line 4: `__import__('pkg_resources').require('sage==9.3b2')'
```



---

Comment by @tobiasdiez created at 2020-12-07 21:27:59

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2020-12-07 22:59:14

Replying to [comment:11 gh-tobiasdiez]:
> I also get the following error when running `sage`:
> {{{
> /mnt/d/Programming/sage/src/.venv/bin/sage-version.sh: line 3: __requires__: command not found
> /mnt/d/Programming/sage/src/.venv/bin/sage-version.sh: line 4: syntax error near unexpected token `'pkg_resources''
> /mnt/d/Programming/sage/src/.venv/bin/sage-version.sh: line 4: `__import__('pkg_resources').require('sage==9.3b2')'
> }}}

This is an interesting error - something seems to be rewriting this shell scripts as if it is a Python script - perhaps the newest version of pip?


---

Comment by git created at 2020-12-07 23:24:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-12-07 23:24:53

Replying to [comment:8 mkoeppe]:
> Also, the help message shown by `sage -advanced` needs some cosmetic adjustments because the longest environment name is longer now
Done


---

Comment by @tobiasdiez created at 2020-12-07 23:31:25

Replying to [comment:15 mkoeppe]:
> Replying to [comment:8 mkoeppe]:
> > Also, the help message shown by `sage -advanced` needs some cosmetic adjustments because the longest environment name is longer now
> Done

Thanks!


---

Comment by @tobiasdiez created at 2020-12-07 23:32:25

Replying to [comment:13 mkoeppe]:
> Replying to [comment:11 gh-tobiasdiez]:
> > I also get the following error when running `sage`:
> > {{{
> > /mnt/d/Programming/sage/src/.venv/bin/sage-version.sh: line 3: __requires__: command not found
> > /mnt/d/Programming/sage/src/.venv/bin/sage-version.sh: line 4: syntax error near unexpected token `'pkg_resources''
> > /mnt/d/Programming/sage/src/.venv/bin/sage-version.sh: line 4: `__import__('pkg_resources').require('sage==9.3b2')'
> > }}}
> 
> This is an interesting error - something seems to be rewriting this shell scripts as if it is a Python script - perhaps the newest version of pip?

Maybe because I invoke `sage` from within `pipenv shell` (to activate the correct venv)?


---

Comment by mkoeppe created at 2020-12-14 18:14:58

Let's investigate this in #31049. It's not related to this ticket.


---

Comment by mkoeppe created at 2020-12-14 18:15:28

Ready for review...


---

Comment by mkoeppe created at 2020-12-22 15:54:54

Is there a reviewer for my changes on this ticket?


---

Comment by @tobiasdiez created at 2021-01-06 12:27:41

Changing status from needs_review to positive_review.


---

Comment by @tobiasdiez created at 2021-01-06 12:27:41

The other changes look good to me as well. Thanks!


---

Comment by vbraun created at 2021-01-17 13:46:02

Resolution: fixed
