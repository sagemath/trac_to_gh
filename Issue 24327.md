# Issue 24327: Primitive extension of lattices

Issue created by migration from https://trac.sagemath.org/ticket/24564

Original creator: pmenegat

Original creation time: 2018-01-19 10:07:02

Keywords: lattices

Let L1,L2 two integer lattices and A_L1, A_L2 their discriminant groups.
If G1,G2 are subgroups of A_L1 and AL2 respectively and f:G1-->G2 an isomorphisme of group we could define the "gluing" L, a primitive extension of L1+L2-->L


---

Comment by sbrandhorst created at 2018-01-19 10:11:56

Changing component from PLEASE CHANGE to quadratic forms.


---

Comment by sbrandhorst created at 2018-01-19 10:11:56

Changing keywords from "lattices" to "IntegralLattice".


---

Comment by git created at 2018-02-09 22:58:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-02-16 18:09:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pmenegat created at 2018-02-16 18:12:32

New commits:


---

Comment by pmenegat created at 2018-02-16 18:12:32

Changing status from new to needs_review.


---

Comment by sbrandhorst created at 2018-02-19 06:35:52

Changing status from needs_review to needs_work.


---

Comment by sbrandhorst created at 2018-02-19 06:35:52

The mul function is a good idea. But please make it a separate ticket.

What you define is an extension - but it is not primitive.
For this consider your first example

```
    sage: from sage.modules.free_quadratic_module_integer_symmetric import PrimitiveExtension
    sage: L1 = IntegralLattice(matrix([[4]]))
    sage: g1 = L1.discriminant_group().gens()[0]
    sage: glue = [[2*g1]]
    sage: PrimitiveExtension([L1],glue)
    Lattice of degree 1 and rank 1 over Integer Ring
    Basis matrix:
    [1]
    Inner product matrix:
    [1]
    ....
```

A single lattice does not have any primitive extensions.

Your code breaks if the lattices have a given basis different from the standard one.
It is not enough to just consider the gram matrices.:

```
sage: from sage.modules.free_quadratic_module_integer_symmetric import PrimitiveExtension
sage: A = IntegralLattice(matrix.identity(2),basis=[(2,2)])
sage: g = A.discriminant_group().gens()
sage: PrimitiveExtension([A,A],[g,g])
.....
TypeError: unsupported operand parent(s) for *: 'Full MatrixSpace of 2 by 1 dense matrices over Integer Ring' and 'Free module of degree 2 and rank 1 over Integer Ring
Echelon basis matrix:
[1/4 1/4]'
```


- I would suggest to enhance the `.direct_sum` method to eat a list of lattices (or a single lattice) - best make it a separate ticket.
- For me a primitive extension is defined as follows:

Let `L1`, `L2` be two lattices. Then a primitive extension is an overlattice `L`
`L1 + L2 -- > L` such that `L1 * QQ` intersected with `L` is L1 and likewise for `L2`.
Then Nikulin proved:
A primitive extension is the same as giving a homomorphism
`phi: AL1 -- > AL2` on the discriminant groups reversing the sign of the discriminant form:
`q(x) = -q(phi(x))`.

Then my suggestion is to define a method. 


```
def primitive_extension(self, L2, phi):

   1. check that phi is a homomorphism reversing the sign
   2. take the direct sum of L1 and L2
   3. take the graph Gamma of phi inside A_L1 + A_L2
   4. return (L1.direct_sum(L2)).overlattice(Gamma)
```

And maybe the morphisms defining the embeddings.


---

Comment by git created at 2018-02-22 13:05:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-02-23 09:50:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-02-23 10:59:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-02-23 11:19:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-02-23 15:56:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pmenegat created at 2018-03-02 14:06:56

Changing status from needs_work to needs_review.


---

Comment by sbrandhorst created at 2018-03-03 10:16:20

Changing status from needs_review to needs_work.


---

Comment by sbrandhorst created at 2018-03-03 10:16:20

I think that the ambient spaces should be preserved. If the user has given the lattice a specific basis/ambient space, she probably had a good reason and wants to keep it. 
As a general rule: We should not forget any information - unless the user explicitly requests it.

Hence, the overlattice (=glued lattice) should live in the direct sum of the respective ambient spaces. 
I do like that you provide the embeddings. That is a good feature.
As a suggestion: 
- Improve the `direct_sum` method to take a list of lattices as input and output the inclusions as well.
- In a second step use `overlattice` to create the glueing.
- Please add input checks.


---

Comment by git created at 2018-03-29 08:21:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-29 09:08:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-29 11:39:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-29 13:25:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pmenegat created at 2018-03-29 13:25:24

Changing status from needs_work to needs_review.


---

Comment by sbrandhorst created at 2018-04-03 19:52:29

you can give it a positive review if you are happy with my changes.
----
New commits:


---

Comment by pmenegat created at 2018-04-17 08:36:04

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-05-08 17:26:41

Resolution: fixed
