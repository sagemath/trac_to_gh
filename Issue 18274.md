# Issue 18274: LatticePoset: add is_sublattice()

Issue created by migration from https://trac.sagemath.org/ticket/18511

Original creator: jmantysalo

Original creation time: 2015-05-26 05:02:12

CC:  chapoton

Add function to check if a given iterable (like another lattice or poset, or just a list of elements) is a sublattice of the lattice. There should be nothing complicated with this.


---

Comment by jmantysalo created at 2015-05-26 07:30:01

I would like to get some comments about this. 1) Should it be at all possible to check if given _list_ of elements form a sublattice of the lattice? 2.1) If not, should I change the order of `self` and `other`? 2.2 If yes, should I change name from `is_sublattice()` to `has_sublattice()`? (Compare to `is_subgraph()` on generic graphs.)
----
New commits:


---

Comment by ncohen created at 2015-05-26 11:49:58

Yo,

> I would like to get some comments about this. 1) Should it be at all possible to check if given _list_ of elements form a sublattice of the lattice? 2.1) If not, should I change the order of `self` and `other`? 2.2 If yes, should I change name from `is_sublattice()` to `has_sublattice()`? (Compare to `is_subgraph()` on generic graphs.)

the way it is implemented, your function works for both. And I do not personally mind if  `is_sublattice`  also works on lists.

On the other hand, with the current implementation the antichain on 5 elements is a sublattice of the chain on 5 elements.

Nathann


---

Comment by ncohen created at 2015-05-26 11:50:58

ARGGGGGGGGGGGGG. OKay, please merge those two functions into one.

Nathann


---

Comment by jmantysalo created at 2015-05-26 12:00:53

Replying to [comment:4 ncohen]:

> ARGGGGGGGGGGGGG. OKay, please merge those two functions into one.

This and `sublattice()`? Why? For example for sets we have a function to get subsets and another checking if a set is a subset of another set.


---

Comment by ncohen created at 2015-05-26 12:02:00

NOnono. I mean the `hasse_diagram.is_sublattice` which is called by `Lattice.is_sublattice` but does not check that 'other' is a subposet of self.


---

Comment by jmantysalo created at 2015-05-26 16:47:02

Replying to [comment:3 ncohen]:

> the way it is implemented, your function works for both. And I do not personally mind if  `is_sublattice`  also works on lists.

OK. How about the name of the function?

> On the other hand, with the current implementation the antichain on 5 elements is a sublattice of the chain on 5 elements.

??


```
sage: L=Posets.ChainPoset(5)
sage: M=Posets.AntichainPoset(5)
sage: L.is_sublattice(M)
False
```


Replying to [comment:6 ncohen]:

> I mean the `hasse_diagram.is_sublattice` which is called by `Lattice.is_sublattice` but does not check that 'other' is a subposet of self.

But that is checked on `lattices.py`. Isn't it slower to access elements of _hasse_diagram on a loop from another file?


---

Comment by ncohen created at 2015-05-27 08:03:28

Yo !

> OK. How about the name of the function?

I'd say that it is fine. You think it's wrong in some way?

> > On the other hand, with the current implementation the antichain on 5 elements is a sublattice of the chain on 5 elements.

After that comment I added a big 'ARGGGGGGG' which indicated that for the tenth time I had only read the code of the undocumented `is_sublattice` function from `hasse_diagram.py`. Could you please merge the two? The second function, by itself, is incorrect.

> But that is checked on `lattices.py`. Isn't it slower to access elements of _hasse_diagram on a loop from another file?

I do not see why. To say it differently, I do not think that Python is smart enough to optimize anything due to the fact that everything is in the same file `:-P`

Nathann


---

Comment by jmantysalo created at 2015-05-27 09:07:44

About the name: If `A` and `B` are graphs, then `A.is_subgraph(B)` means "A is a subgraph of B". If they are lattices, then `A.is_sublattice(B)` means "B is a sublattice of A". So it is somewhat surprising difference. But of course we can't add `is_sublattice()` to all iterables.


---

Comment by ncohen created at 2015-05-27 11:30:55

Well, it's up to you. For as long as `B` can be a Lattice object, I'd say that we are fine.

Nathann


---

Comment by git created at 2015-05-29 09:41:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2015-05-29 09:47:40

Changing status from new to needs_review.


---

Comment by jmantysalo created at 2015-05-29 09:47:40

Replying to [comment:8 ncohen]:

> > OK. How about the name of the function?
> 
> I'd say that it is fine. You think it's wrong in some way?

Semantics are wrong if A.is_sublattice(B) means that B is a sublattice of A. Changed to `has_sublattice`. I also removed possibility to check of being a really sublattice, i.e. input is only assumed to be a list or like.

> Could you please merge the two? The second function, by itself, is incorrect.

I corrected the (stupid) bug in hasse_diagram.

If I constantly call `meet()` it will slow down computation. If I directly reference to `_meet`, I'll break encapsulation. Then for example changing hasse_diagram to use list of lists instead of matrix will break the function.


---

Comment by ncohen created at 2015-05-29 12:50:29

The branch does not merge with the latest beta.

Nathann


---

Comment by git created at 2015-05-29 13:03:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2015-05-29 13:05:05

Now it should work again. It was `sublattice()` at the end of file that made a conflict with this `is_sublattice()` also added to end of file.


---

Comment by darij created at 2015-05-29 22:28:31

Uploading my review patch. If you're fine with it, feel free to mark as pos_rev.
----
New commits:


---

Comment by git created at 2015-05-29 22:32:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2015-05-30 05:24:45

There has been discussion about not using ``self`` in docstrings. For example "- - of the lattice ``self``." should be just "- - of the lattice." That's because we don't expect all users to know about python.


---

Comment by ncohen created at 2015-05-30 06:44:35

Hello !

Could you add an example when the 'lattice' is given as a `Lattice` object? Logically, it could even be the first kind of examples you give, and you could then add that "it also works when 'other' is any iterable'".

Also, it seems that the code does not work as expected when 'other' contains points which are not in `self`. That's a trivial 'no', but it should not be an exception.

Nathann


---

Comment by git created at 2015-05-30 12:08:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2015-05-30 12:11:48

Nathann: done and done, although I'm not sure if I've done it the way you've liked (please check).

Jori: I don't believe in this being of any help to users. Pronouns like "this" become ambiguous very quickly when several objects are involved. Here we have two lattices floating around and it's more or less clear which one is meant, but I'd say that `self` makes it clearer. And when the situation is more complicated, it is downright impossible to circumlocute `self`. And the ugly truth is, users who don't know about Python are screwed when they try to use our poset infrastructure anyway...


---

Comment by ncohen created at 2015-05-30 12:25:29

> Nathann: done and done, although I'm not sure if I've done it the way you've liked (please check).

Right right. Thanks for adding this warning in `HasseDiagram.is_has_sublattice`.

Jori also mentionned that there was now an index of Lattice functions. In this case, this method should be added to it.

Nathann


---

Comment by jmantysalo created at 2015-06-01 13:24:03

Replying to [comment:21 ncohen]:

> Also, it seems that the code does not work as expected when 'other' contains points which are not in `self`. That's a trivial 'no', but it should not be an exception.

I guess that it is mostly an error from the user if he/she ask if `{1,2}` is a sublattice of a lattice containing `a`, `b` and `a`. So raising an exceptions sounds better.

But totally another thing is a list vs. a lattice as a parameter. They feels two different things.


---

Comment by jmantysalo created at 2015-06-01 13:25:31

Replying to [comment:23 darij]:

> Jori: I don't believe in this being of any help to users. Pronouns like "this" become ambiguous very quickly when several objects are involved.

Sometimes, maybe. It I think it's good to at least try. I a recent discussion vbraun referred to 
http://sphinx-doc.org/latest/ext/example_google.html which says "Do not include the `self` parameter in the ``Args`` section."


---

Comment by ncohen created at 2015-06-01 13:32:50

> I guess that it is mostly an error from the user if he/she ask if `{1,2}` is a sublattice of a lattice containing `a`, `b` and `a`. So raising an exceptions sounds better.

That's an inconsistency between graphs and posets

```
sage: p = Poset()
sage: p.le(1,3)
...
ValueError: element (=1) not in poset
sage: g = Graph()
sage: g.has_edge(1,3)
False
```


Soooooo okay for an exception!
 
> But totally another thing is a list vs. a lattice as a parameter. They feels two different things.

Well, a `Lattice` is an iterable container of vertices, isn't it? And you just can't have a `.has_sublattice(X)` function that does not accept a lattice as input `O_o`

Nathann


---

Comment by jmantysalo created at 2015-06-01 13:38:37

Replying to [comment:27 ncohen]:

> That's an inconsistency between graphs and posets

Duh.

> Well, a `Lattice` is an iterable container of vertices, isn't it? And you just can't have a `.has_sublattice(X)` function that does not accept a lattice as input `O_o`

But it would mean that after `L1=LatticePoset({1:[2]}); L2=L2.dual()` we would have `L2` _not_ a subposet of L1 but `L1.has_sublattice(L2)` would return `True`.


---

Comment by ncohen created at 2015-06-01 13:47:42

> But it would mean that after `L1=LatticePoset({1:[2]}); L2=L2.dual()` we would have `L2` _not_ a subposet of L1 but `L1.has_sublattice(L2)` would return `True`.

Right, right. And returning `True` is precisely what your branch does:


```
sage: L1=LatticePoset({1:[2]})
sage: L2=L1.dual()
sage: L1.has_sublattice(L2)
True
```


Nathann


---

Comment by jmantysalo created at 2015-06-02 06:58:38

Replying to [comment:29 ncohen]:
> > But it would mean that after `L1=LatticePoset({1:[2]}); L2=L2.dual()` we would have `L2` _not_ a subposet of L1 but `L1.has_sublattice(L2)` would return `True`.
> 
> Right, right. And returning `True` is precisely what your branch does:

True. Hence my branch needs correcting.

I think that this relates also with `sublattice()` and `random_maximal_sublattice()` (see #18562). Should there be "public" functions on `lattices.py` returning lists? This would be kind of optimization for some computations. Other way is to have them on `hasse_diagram.py`, so that advanced user might use them directly.


---

Comment by jmantysalo created at 2015-08-14 08:45:37

Returning to this one... We have `is_subgraph` and there is `is_subposet` on #15875 waiting for review. So I guess this should be also `is_sublattice()`.

On the other hand, then testing if a list `l` of elements of `L` is closed under meet and join must be done like `LatticePoset(L.subposet(l)).is_sublattice(L)`. But maybe we can live with it.


---

Comment by jmantysalo created at 2015-08-14 08:45:37

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-09-30 10:24:32

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jmantysalo created at 2015-09-30 10:26:07

This is not ready, as I wait to see how should


```
L = LatticePoset({1:[2]})
P = Poset(L)
L == P
```


work.


---

Comment by git created at 2016-08-25 07:32:51

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-08-25 07:33:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-25 07:39:20

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jmantysalo created at 2016-08-25 07:40:48

Changing status from needs_work to needs_review.


---

Comment by jmantysalo created at 2016-08-25 07:40:48

Had some errors with git, but now this old ticket should be ready for (easy) review.


---

Comment by tscrim created at 2016-08-25 13:56:30

Could you add a test for when `other` is not a lattice? I'm slightly worried about

```sage
if not hasattr(other, 'meet') or not hasattr(other, 'join'):
    raise TypeError('other is not a lattice')
```

Somewhat independent, I think it would be better to do something like:

```sage
try:
    M, J = other.meet, other.join
except (AttributeError):
    raise TypeError('other is not a lattice')
```

which is more Pythonic and easily extends if `meet` and `join` end up raising other errors at some point.


---

Comment by git created at 2016-08-25 14:13:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2016-08-25 14:14:39

Replying to [comment:39 tscrim]:
> Could you add a test for when `other` is not a lattice? I'm slightly worried about - 

Done this.


---

Comment by tscrim created at 2016-08-25 14:19:56

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-08-27 08:38:11

Resolution: fixed
