# Issue 27763: Remove python 2 support

Issue created by migration from https://trac.sagemath.org/ticket/28000

Original creator: embray

Original creation time: 2019-06-16 17:04:46

CC:  @timokau chapoton dimpase




---

Comment by jhpalmieri created at 2019-06-17 20:14:29

What needs to be done for this ticket?


---

Comment by embray created at 2019-06-17 21:31:15

Go through and remove all hacks related to supporting Python 2.  It will be interesting to see how big a change it takes even now.  It's rather early to go through and do that in earnest, but it would be fun to just try and see what it takes.


---

Comment by slelievre created at 2019-06-19 23:24:46

Changing keywords from "" to "days101".


---

Comment by jhpalmieri created at 2019-06-27 21:44:10

One example: #27696 (remove the doctesting hack for "long", which just converts it to "int" when using Python 3.


---

Comment by slelievre created at 2019-06-28 08:57:58

Also, this ticket can be set as a dependency for other tickets that depend on the
removal of Python 2 support. Many dependency upgrades will depend on that.

Might it make sense to migrate the whole Jupyter part to Python3-only versions
before completely removing Python 3 support? Even when building Sage for
Python 2, we ship Python 3 too anyway.


---

Comment by embray created at 2019-07-01 12:59:41

I made some progress at days101 removing all dependency on the `six` module for Python 2/3 support and that alone was a HUGE change (and not even quite finished yet).  Will post a branch once I'm done with that.


---

Comment by embray created at 2019-08-18 10:30:36

Here's some of my progress on this so far: Probably one of the biggest, most pervasive steps, being complete removal of dependency on `six`.

Of course, this step is optional--we can keep using `six` while otherwise dropping support for Python 2.  But this makes it quite explicit.

It's pretty hard to avoid making a patch bomb of this.  It's not all bad though--I started this months ago, and then once I got it finished I rebased on current develop and only had about a dozen minor merge conflicts.


---

Comment by git created at 2019-08-18 10:31:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-08-18 11:06:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2019-09-16 22:19:19

Other tasks:

- remove or revise the doctests labeled `# py2`. Ideally, all such tests should be evaluated on a case-by-case basis, some should just be removed, but perhaps some should be modified to work with Python 3.
- #28426: with a Python 3 build, do not build Python 2.
- remove some packages which are only necessary with Python 2: `typing` (#28499) is the only one I know of currently, but I wouldn't be surprised if there were others.
- remove the legacy Sage notebook — at least, I don't think it works with Python 3 now, and I don't think anyone is working on it. This means we should deprecate it ASAP. (#25837)


---

Comment by embray created at 2019-09-18 10:26:25

My branch for this has some other in-progress changes that it seems I haven't pushed yet.  I'll do so next time I rebase this branch.


---

Comment by embray created at 2019-09-18 10:29:49

Oh right, one of the changes I started was to remove unnecessary `from __future__` imports, but it seems until we have #26403, to my slight surprise, some of them are still needed in Cython modules, e.g. to have the `print()` function by default.


---

Comment by git created at 2019-09-18 10:37:13

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2019-09-18 10:38:02

Rebased, but no guarantee there are no new bugs or new uses of `six` I didn't miss.  I didn't check yet.


---

Comment by git created at 2019-09-18 11:20:16

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2019-09-18 11:20:32

Updated again after removing two new uses of `six` that have since appeared.


---

Comment by jhpalmieri created at 2019-11-18 22:29:02

Do we remove all doctests tagged `# py2` here or on a separate ticket?


---

Comment by embray created at 2019-11-19 14:00:58

You could do it here, or a separate ticket (and make it a dependency of this ticket).  It's going to be a patch bomb no matter what, but I don't see the harm in trying to split it up wehre possible.


---

Comment by git created at 2020-01-06 16:33:00

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2020-01-06 16:34:48

Rebased on 9.0


---

Comment by mkoeppe created at 2020-05-09 19:01:13

Needs rebasing!


---

Comment by jhpalmieri created at 2020-05-11 17:37:03

Related: #27826


---

Comment by jhpalmieri created at 2020-05-13 03:05:03

Rebased. I haven't seen activity from embray for a while. Perhaps this is ready for review?
----
New commits:


---

Comment by mkoeppe created at 2020-05-19 03:02:25

Let's see if this finds a reviewer


---

Comment by mkoeppe created at 2020-05-19 03:02:25

Changing status from new to needs_review.


---

Comment by dimpase created at 2020-05-19 11:41:15

testing.


---

Comment by dimpase created at 2020-05-20 08:27:46

OK, this makes sense and appears to work. A long, but straightforward patch, also touching quite a bit of whitespace (which probably could have waited for another place, but OK).

Should removing Python2 spkg be done elsewhere?


---

Comment by dimpase created at 2020-05-20 08:27:46

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-05-20 15:43:08

Replying to [comment:34 dimpase]:
> Should removing Python2 spkg be done elsewhere?

Yes, see #29141 (Meta-ticket: Remove Python 2 support for Sage 9.2; upgrades enabled by the removal)


---

Comment by vbraun created at 2020-05-26 21:49:45

Resolution: fixed


---

Comment by @timokau created at 2020-05-27 15:55:08

＼(＾O＾)／

Hopefully the divergence between sage-the-distribution and sage-on-distro will decrease now and packaging will become simpler again.


---

Comment by embray created at 2020-05-28 14:53:45

Thanks for finally getting this ticket merged!  Sorry I haven't had much time to work on it.  As others have noted this does not take care of all tasks related to dropping Python 2 support--it was just me doing as much as I could in one place.  Took hours!


---

Comment by vbraun created at 2020-05-28 19:18:59

This breaks on Python 3.5, I've created #29753 for that


---

Comment by jhpalmieri created at 2020-05-28 19:57:03

Does anyone know of any docker setups from tox.ini that have Python 3.5?


---

Comment by dimpase created at 2020-05-28 20:26:40

Python 3.5 will be gone in Sept, why would wr spend time trying to support it?


---

Comment by @mwageringel created at 2020-05-29 19:50:32

This accidentally broke the Macaulay2 interface. Follow up at #29759 with a trivial fix.
