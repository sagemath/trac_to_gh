# Issue 27763: Remove python 2 support

archive/issues_027763.json:
```json
{
    "body": "CC:  @timokau @fchapoton @dimpase\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/28000\n\n",
    "created_at": "2019-06-16T17:04:46Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Remove python 2 support",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27763",
    "user": "https://github.com/embray"
}
```
CC:  @timokau @fchapoton @dimpase



Issue created by migration from https://trac.sagemath.org/ticket/28000





---

archive/issue_comments_391764.json:
```json
{
    "body": "What needs to be done for this ticket?",
    "created_at": "2019-06-17T20:14:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391764",
    "user": "https://github.com/jhpalmieri"
}
```

What needs to be done for this ticket?



---

archive/issue_comments_391765.json:
```json
{
    "body": "Go through and remove all hacks related to supporting Python 2.  It will be interesting to see how big a change it takes even now.  It's rather early to go through and do that in earnest, but it would be fun to just try and see what it takes.",
    "created_at": "2019-06-17T21:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391765",
    "user": "https://github.com/embray"
}
```

Go through and remove all hacks related to supporting Python 2.  It will be interesting to see how big a change it takes even now.  It's rather early to go through and do that in earnest, but it would be fun to just try and see what it takes.



---

archive/issue_comments_391766.json:
```json
{
    "body": "Changing keywords from \"\" to \"days101\".",
    "created_at": "2019-06-19T23:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391766",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "days101".



---

archive/issue_comments_391767.json:
```json
{
    "body": "One example: #27696 (remove the doctesting hack for \"long\", which just converts it to \"int\" when using Python 3.",
    "created_at": "2019-06-27T21:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391767",
    "user": "https://github.com/jhpalmieri"
}
```

One example: #27696 (remove the doctesting hack for "long", which just converts it to "int" when using Python 3.



---

archive/issue_comments_391768.json:
```json
{
    "body": "Also, this ticket can be set as a dependency for other tickets that depend on the\nremoval of Python 2 support. Many dependency upgrades will depend on that.\n\nMight it make sense to migrate the whole Jupyter part to Python3-only versions\nbefore completely removing Python 3 support? Even when building Sage for\nPython 2, we ship Python 3 too anyway.",
    "created_at": "2019-06-28T08:57:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391768",
    "user": "https://github.com/slel"
}
```

Also, this ticket can be set as a dependency for other tickets that depend on the
removal of Python 2 support. Many dependency upgrades will depend on that.

Might it make sense to migrate the whole Jupyter part to Python3-only versions
before completely removing Python 3 support? Even when building Sage for
Python 2, we ship Python 3 too anyway.



---

archive/issue_comments_391769.json:
```json
{
    "body": "I made some progress at days101 removing all dependency on the `six` module for Python 2/3 support and that alone was a HUGE change (and not even quite finished yet).  Will post a branch once I'm done with that.",
    "created_at": "2019-07-01T12:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391769",
    "user": "https://github.com/embray"
}
```

I made some progress at days101 removing all dependency on the `six` module for Python 2/3 support and that alone was a HUGE change (and not even quite finished yet).  Will post a branch once I'm done with that.



---

archive/issue_comments_391770.json:
```json
{
    "body": "Here's some of my progress on this so far: Probably one of the biggest, most pervasive steps, being complete removal of dependency on `six`.\n\nOf course, this step is optional--we can keep using `six` while otherwise dropping support for Python 2.  But this makes it quite explicit.\n\nIt's pretty hard to avoid making a patch bomb of this.  It's not all bad though--I started this months ago, and then once I got it finished I rebased on current develop and only had about a dozen minor merge conflicts.",
    "created_at": "2019-08-18T10:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391770",
    "user": "https://github.com/embray"
}
```

Here's some of my progress on this so far: Probably one of the biggest, most pervasive steps, being complete removal of dependency on `six`.

Of course, this step is optional--we can keep using `six` while otherwise dropping support for Python 2.  But this makes it quite explicit.

It's pretty hard to avoid making a patch bomb of this.  It's not all bad though--I started this months ago, and then once I got it finished I rebased on current develop and only had about a dozen minor merge conflicts.



---

archive/issue_comments_391771.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-18T10:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391771",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_391772.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-18T11:06:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391772",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_391773.json:
```json
{
    "body": "Other tasks:\n\n- remove or revise the doctests labeled `# py2`. Ideally, all such tests should be evaluated on a case-by-case basis, some should just be removed, but perhaps some should be modified to work with Python 3.\n- #28426: with a Python 3 build, do not build Python 2.\n- remove some packages which are only necessary with Python 2: `typing` (#28499) is the only one I know of currently, but I wouldn't be surprised if there were others.\n- remove the legacy Sage notebook \u2014 at least, I don't think it works with Python 3 now, and I don't think anyone is working on it. This means we should deprecate it ASAP. (#25837)",
    "created_at": "2019-09-16T22:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391773",
    "user": "https://github.com/jhpalmieri"
}
```

Other tasks:

- remove or revise the doctests labeled `# py2`. Ideally, all such tests should be evaluated on a case-by-case basis, some should just be removed, but perhaps some should be modified to work with Python 3.
- #28426: with a Python 3 build, do not build Python 2.
- remove some packages which are only necessary with Python 2: `typing` (#28499) is the only one I know of currently, but I wouldn't be surprised if there were others.
- remove the legacy Sage notebook — at least, I don't think it works with Python 3 now, and I don't think anyone is working on it. This means we should deprecate it ASAP. (#25837)



---

archive/issue_comments_391774.json:
```json
{
    "body": "My branch for this has some other in-progress changes that it seems I haven't pushed yet.  I'll do so next time I rebase this branch.",
    "created_at": "2019-09-18T10:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391774",
    "user": "https://github.com/embray"
}
```

My branch for this has some other in-progress changes that it seems I haven't pushed yet.  I'll do so next time I rebase this branch.



---

archive/issue_comments_391775.json:
```json
{
    "body": "Oh right, one of the changes I started was to remove unnecessary `from __future__` imports, but it seems until we have #26403, to my slight surprise, some of them are still needed in Cython modules, e.g. to have the `print()` function by default.",
    "created_at": "2019-09-18T10:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391775",
    "user": "https://github.com/embray"
}
```

Oh right, one of the changes I started was to remove unnecessary `from __future__` imports, but it seems until we have #26403, to my slight surprise, some of them are still needed in Cython modules, e.g. to have the `print()` function by default.



---

archive/issue_comments_391776.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-09-18T10:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391776",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_391777.json:
```json
{
    "body": "Rebased, but no guarantee there are no new bugs or new uses of `six` I didn't miss.  I didn't check yet.",
    "created_at": "2019-09-18T10:38:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391777",
    "user": "https://github.com/embray"
}
```

Rebased, but no guarantee there are no new bugs or new uses of `six` I didn't miss.  I didn't check yet.



---

archive/issue_comments_391778.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-09-18T11:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391778",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_391779.json:
```json
{
    "body": "Updated again after removing two new uses of `six` that have since appeared.",
    "created_at": "2019-09-18T11:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391779",
    "user": "https://github.com/embray"
}
```

Updated again after removing two new uses of `six` that have since appeared.



---

archive/issue_comments_391780.json:
```json
{
    "body": "Do we remove all doctests tagged `# py2` here or on a separate ticket?",
    "created_at": "2019-11-18T22:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391780",
    "user": "https://github.com/jhpalmieri"
}
```

Do we remove all doctests tagged `# py2` here or on a separate ticket?



---

archive/issue_comments_391781.json:
```json
{
    "body": "You could do it here, or a separate ticket (and make it a dependency of this ticket).  It's going to be a patch bomb no matter what, but I don't see the harm in trying to split it up wehre possible.",
    "created_at": "2019-11-19T14:00:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391781",
    "user": "https://github.com/embray"
}
```

You could do it here, or a separate ticket (and make it a dependency of this ticket).  It's going to be a patch bomb no matter what, but I don't see the harm in trying to split it up wehre possible.



---

archive/issue_comments_391782.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-01-06T16:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391782",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_391783.json:
```json
{
    "body": "Rebased on 9.0",
    "created_at": "2020-01-06T16:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391783",
    "user": "https://github.com/embray"
}
```

Rebased on 9.0



---

archive/issue_events_069396.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-09T18:59:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27763#event-69396"
}
```



---

archive/issue_comments_391784.json:
```json
{
    "body": "Needs rebasing!",
    "created_at": "2020-05-09T19:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391784",
    "user": "https://github.com/mkoeppe"
}
```

Needs rebasing!



---

archive/issue_comments_391785.json:
```json
{
    "body": "Related: #27826",
    "created_at": "2020-05-11T17:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391785",
    "user": "https://github.com/jhpalmieri"
}
```

Related: #27826



---

archive/issue_comments_391786.json:
```json
{
    "body": "Rebased. I haven't seen activity from embray for a while. Perhaps this is ready for review?\n  \n---\nNew commits:",
    "created_at": "2020-05-13T03:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391786",
    "user": "https://github.com/jhpalmieri"
}
```

Rebased. I haven't seen activity from embray for a while. Perhaps this is ready for review?
  
---
New commits:



---

archive/issue_comments_391787.json:
```json
{
    "body": "Let's see if this finds a reviewer",
    "created_at": "2020-05-19T03:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391787",
    "user": "https://github.com/mkoeppe"
}
```

Let's see if this finds a reviewer



---

archive/issue_comments_391788.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-05-19T03:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391788",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_391789.json:
```json
{
    "body": "testing.",
    "created_at": "2020-05-19T11:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391789",
    "user": "https://github.com/dimpase"
}
```

testing.



---

archive/issue_comments_391790.json:
```json
{
    "body": "OK, this makes sense and appears to work. A long, but straightforward patch, also touching quite a bit of whitespace (which probably could have waited for another place, but OK).\n\nShould removing Python2 spkg be done elsewhere?",
    "created_at": "2020-05-20T08:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391790",
    "user": "https://github.com/dimpase"
}
```

OK, this makes sense and appears to work. A long, but straightforward patch, also touching quite a bit of whitespace (which probably could have waited for another place, but OK).

Should removing Python2 spkg be done elsewhere?



---

archive/issue_comments_391791.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-05-20T08:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391791",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_391792.json:
```json
{
    "body": "Replying to [comment:34 dimpase]:\n> Should removing Python2 spkg be done elsewhere?\n\n\nYes, see #29141 (Meta-ticket: Remove Python 2 support for Sage 9.2; upgrades enabled by the removal)",
    "created_at": "2020-05-20T15:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391792",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:34 dimpase]:
> Should removing Python2 spkg be done elsewhere?


Yes, see #29141 (Meta-ticket: Remove Python 2 support for Sage 9.2; upgrades enabled by the removal)



---

archive/issue_comments_391793.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-05-26T21:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391793",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_069397.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-05-26T21:49:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27763#event-69397"
}
```



---

archive/issue_comments_391794.json:
```json
{
    "body": "\uff3c(\uff3eO\uff3e)\uff0f\n\nHopefully the divergence between sage-the-distribution and sage-on-distro will decrease now and packaging will become simpler again.",
    "created_at": "2020-05-27T15:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391794",
    "user": "https://github.com/timokau"
}
```

＼(＾O＾)／

Hopefully the divergence between sage-the-distribution and sage-on-distro will decrease now and packaging will become simpler again.



---

archive/issue_comments_391795.json:
```json
{
    "body": "Thanks for finally getting this ticket merged!  Sorry I haven't had much time to work on it.  As others have noted this does not take care of all tasks related to dropping Python 2 support--it was just me doing as much as I could in one place.  Took hours!",
    "created_at": "2020-05-28T14:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391795",
    "user": "https://github.com/embray"
}
```

Thanks for finally getting this ticket merged!  Sorry I haven't had much time to work on it.  As others have noted this does not take care of all tasks related to dropping Python 2 support--it was just me doing as much as I could in one place.  Took hours!



---

archive/issue_comments_391796.json:
```json
{
    "body": "This breaks on Python 3.5, I've created #29753 for that",
    "created_at": "2020-05-28T19:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391796",
    "user": "https://github.com/vbraun"
}
```

This breaks on Python 3.5, I've created #29753 for that



---

archive/issue_comments_391797.json:
```json
{
    "body": "Does anyone know of any docker setups from tox.ini that have Python 3.5?",
    "created_at": "2020-05-28T19:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391797",
    "user": "https://github.com/jhpalmieri"
}
```

Does anyone know of any docker setups from tox.ini that have Python 3.5?



---

archive/issue_comments_391798.json:
```json
{
    "body": "Python 3.5 will be gone in Sept, why would wr spend time trying to support it?",
    "created_at": "2020-05-28T20:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391798",
    "user": "https://github.com/dimpase"
}
```

Python 3.5 will be gone in Sept, why would wr spend time trying to support it?



---

archive/issue_comments_391799.json:
```json
{
    "body": "This accidentally broke the Macaulay2 interface. Follow up at #29759 with a trivial fix.",
    "created_at": "2020-05-29T19:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27763",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27763#issuecomment-391799",
    "user": "https://github.com/mwageringel"
}
```

This accidentally broke the Macaulay2 interface. Follow up at #29759 with a trivial fix.
