# Issue 21852: Patch python to accept openSSL >= 1.1

Issue created by migration from https://trac.sagemath.org/ticket/22089

Original creator: charpent

Original creation time: 2016-12-22 09:46:44

CC:  slelievre jdemeyer

Keywords: SSL pip packages

Rationale : see [this thread](https://groups.google.com/forum/#!topic/sage-devel/JPpJvUpP1TQ).

In short, OpenSSL development interface have changed incompatibly with versions<1.1. A lot of applications have been affected. That includes "our" python (see [this python ticket](https://bugs.python.org/issue26470)) and "our" git (see #22058), which are now unable to use SSL transport when compiled against OpenSSL>=1.1. This notably impedes the use of pip.

This library has now entered mainstream Linux distributions (e. g. Debian testing) (I dunno about Windows/cygwin and Mac OS X). These distributions can no longer compile Sagemath with a functional pip.


---

Comment by slelievre created at 2016-12-22 11:33:42

Upgrade to Python 2.7.12 is done at #19735.

Upgrade to Python 2.7.13 is in progress at #22037.


---

Comment by charpent created at 2016-12-22 11:41:58

Replying to [comment:2 slelievre]:
> Upgrade to Python 2.7.12 is done at #19735.
> 
> Upgrade to Python 2.7.13 is in progress at #22037.

<DonsBrownPaperBagOnHead>
Aaaarghhh ! You are right.
</DonsBrownPaperBagOnHead>

I can't test this right now (my Sage installation dates back from before the time openSSL entered the game...). I'll upgrade it to 7.5rc0 (which includes #19735), and see how well this goes.

I'll have a look at a pristine VM tonight.


---

Comment by charpent created at 2016-12-22 13:54:19

Replying to [comment:3 charpent]:

> I can't test this right now (my Sage installation dates back from before the time openSSL entered the game...). I'll upgrade it to 7.5rc0 (which includes #19735), and see how well this goes.

Well... testing this on a machine that used to have a functional `_ssl` module in python, I now get :

```
charpent@SAP5057241:/usr/local/sage-7$ sage -python
Python 2.7.12 (default, Dec 22 2016, 11:47:35) 
[GCC 6.2.1 20161124] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> quit()
charpent@SAP5057241:/usr/local/sage-7$ sage -pip search lalala
Exception:
Traceback (most recent call last):
  File "/usr/local/sage-7/local/lib/python2.7/site-packages/pip/basecommand.py", line 215, in main
    status = self.run(options, args)
  File "/usr/local/sage-7/local/lib/python2.7/site-packages/pip/commands/search.py", line 43, in run
    pypi_hits = self.search(query, options)
  File "/usr/local/sage-7/local/lib/python2.7/site-packages/pip/commands/search.py", line 60, in search
    hits = pypi.search({'name': query, 'summary': query}, 'or')
  File "/usr/local/sage-7/local/lib/python/xmlrpclib.py", line 1243, in __call__
    return self.__send(self.__name, args)
  File "/usr/local/sage-7/local/lib/python/xmlrpclib.py", line 1602, in __request
    verbose=self.__verbose
  File "/usr/local/sage-7/local/lib/python2.7/site-packages/pip/download.py", line 764, in request
    headers=headers, stream=True)
  File "/usr/local/sage-7/local/lib/python2.7/site-packages/pip/_vendor/requests/sessions.py", line 518, in post
    return self.request('POST', url, data=data, json=json, **kwargs)
  File "/usr/local/sage-7/local/lib/python2.7/site-packages/pip/download.py", line 378, in request
    return super(PipSession, self).request(method, url, *args, **kwargs)
  File "/usr/local/sage-7/local/lib/python2.7/site-packages/pip/_vendor/requests/sessions.py", line 475, in request
    resp = self.send(prep, **send_kwargs)
  File "/usr/local/sage-7/local/lib/python2.7/site-packages/pip/_vendor/requests/sessions.py", line 585, in send
    r = adapter.send(request, **kwargs)
  File "/usr/local/sage-7/local/lib/python2.7/site-packages/pip/_vendor/cachecontrol/adapter.py", line 46, in send
    resp = super(CacheControlAdapter, self).send(request, **kw)
  File "/usr/local/sage-7/local/lib/python2.7/site-packages/pip/_vendor/requests/adapters.py", line 477, in send
    raise SSLError(e, request=request)
SSLError: Can't connect to HTTPS URL because the SSL module is not available.
```


The issue still stands (and is worse than previously thought of...).


---

Comment by charpent created at 2017-01-03 22:40:50

My attempts at using the upstream patch have failed. I think now that the only realistic option is #22037.

This ticket should be closed as Invalid/Wontfix...


---

Comment by jdemeyer created at 2017-01-04 08:05:52

Does #22037 actually fix this ticket? I.e. does Python 2.7.13 work with the latest OpenSSL?


---

Comment by charpent created at 2017-01-04 08:21:25

Replying to [comment:6 jdemeyer]:
> Does #22037 actually fix this ticket? I.e. does Python 2.7.13 work with the latest OpenSSL?

Ah. I was waiting for #22037 to be marked "needs_review". I'll test that tonight.


---

Comment by embray created at 2017-01-04 13:33:53

+1 for going with #22037


---

Comment by charpent created at 2017-02-27 07:28:23

Reviewing other tickets, I find this one, that I had mentallt noted as "Fixed".

Replying to [comment:7 charpent]:
> Replying to [comment:6 jdemeyer]:
> > Does #22037 actually fix this ticket? I.e. does Python 2.7.13 work with the latest OpenSSL?
> 
> Ah. I was waiting for #22037 to be marked "needs_review". I'll test that tonight.

Indeed, #22037 does fix the problem. This ticket should be marked as invalid/won't fix and closed. Someting I can't do myself.

I'm marking this ticket as "needs review" : plan is to mark it as "positive review" to get the attention of the release manager who *can* mar it as invalid/won't fix and close it.


---

Comment by charpent created at 2017-02-27 07:28:23

Changing status from new to needs_review.


---

Comment by charpent created at 2017-02-27 07:30:44

Changing status from needs_review to positive_review.


---

Comment by charpent created at 2017-02-27 07:30:44

Morking it as `positive_review` to get it reviewed by the release manager. Who should mark it as invalid and close it.


---

Comment by tscrim created at 2017-02-27 16:57:25

Don't forget to set the milestone to invalid. ;)


---

Comment by charpent created at 2017-02-27 17:03:53

Thanks !

Replying to [comment:11 tscrim]:
> Don't forget to set the milestone to invalid. ;)

<Blush>

That was the piece of information I missed (consistently...). It is probably documented in a doc that I studiously missed ;-).

</Blush>


---

Comment by embray created at 2017-07-13 07:54:31

Resolution: wontfix


---

Comment by embray created at 2017-07-13 07:54:31

Closing tickets in the sage-duplicate/invalid/wontfix module with positive_review (i.e. someone has confirmed they should be closed).
