# Issue 16712: Improve abelian_group() for elliptic curves over a finite field

Issue created by migration from https://trac.sagemath.org/ticket/16949

Original creator: jdemeyer

Original creation time: 2014-09-09 13:10:14

CC:  jpflori cremona




---

Attachment


---

Comment by cremona created at 2015-12-10 16:53:52

What improvement do you have in mind?


---

Comment by jdemeyer created at 2015-12-11 13:36:26

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-12-11 13:36:26

New commits:


---

Comment by cremona created at 2015-12-11 13:53:59

I will trust you that there are cases where this is all that the users needs.

Can we add to the documentation more from the documentation of pari's ellgroup() function?  As I understand that, if ellgroup()[2] has length 1 then the group is cyclic and this point does generate it;  while if it has length 2 then the first point has order d1 = exponent, the structure is [d1,d2] with d2>1 and d1|d1, and the Weil pairing between the points has order exactly d2 even though the second "generator" may have order not d2 (its order must then be a multiple of d2 and a divisor of d1).

As the pari doc says, this avoids the possibly expensive Weil pairing step.

I will be testing this shortly.


---

Comment by cremona created at 2015-12-11 15:32:09

Perhaps this ticket should be dependent on #16931, which is referred to in comments in the code?

I would like to see and Example where the product of the orders of the two generators is greater than the cardinality.  But maybe since the gens returned are random, this cannot be tested deterministically.  That is a pity, but we could have something like

```
sage: E = EllipticCurve(GF(41),[2,5])
sage: P,Q = E.gens()
sage: P.order()
22
sage: Q.order()
22
sage: P.order()*Q.order(), E.cardinality()
(484, 44)
```


More importantly: suppose that I had done this before calling E.gens():

```
sage: E.abelian_group()
Additive abelian group isomorphic to Z/22 + Z/2 embedded in Abelian group of points on Elliptic Curve defined by y^2 = x^3 + 2*x + 5 over Finite Field of size 41
sage: E.abelian_group().gens()
((35 : 33 : 1), (10 : 0 : 1))
sage: P,Q = E.abelian_group().gens()
sage: P.order(),Q.order()
(22, 2)
```


i.e. I had done the hard work, but it was ignored.  Surely the new faster E.gens() would be even faster in this case if it checked whether generators were already known?


---

Comment by jdemeyer created at 2015-12-11 15:39:45

Replying to [comment:6 cremona]:
> Perhaps this ticket should be dependent on #16931, which is referred to in comments in the code?
I could do that, but does it really matter that much if #16931 depends on this one or the other way around?


---

Comment by git created at 2015-12-11 15:43:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-12-11 15:49:43

Replying to [comment:5 cremona]:
> As I understand that, if ellgroup()[2] has length 1 then the group is cyclic and this point does generate it;  while if it has length 2 then the first point has order d1 = exponent

At least the above info is in the docstring. I also think this is the important part.


---

Comment by jdemeyer created at 2015-12-11 21:37:30

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-08-18 09:43:39

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-08-18 13:37:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-08-18 13:38:04

Changing status from needs_work to needs_review.


---

Comment by jpflori created at 2016-11-17 14:29:01

As the cardinality is computed here, shouldn't we take the opportunity to store it?


---

Comment by cremona created at 2016-11-17 15:40:52

Definitely yes.  And when the cardinality is known and can be factored the abelian_group() method will work faster.


---

Comment by chapoton created at 2016-12-14 19:55:53

failing doctests, probably random ?


---

Comment by chapoton created at 2016-12-14 19:55:53

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2017-04-15 09:52:33

needs work, because of deprecated `_pari_`


---

Comment by klui created at 2017-07-19 05:32:24

I convert `_pari_` to `__pari__` which fixed some of the failing doctests.

The doctests for `E.gens()` sometimes fails but I've verified that in those case, the outputs are still generators of the elliptic curve. I think it was mentioned earlier that the outputs are expected to be random. Is there a better way to do the doctest in L1248 and L1251 of ell_finite_field.py?
----
New commits:


---

Comment by git created at 2017-07-19 15:47:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klui created at 2017-07-19 15:50:25

I still get this failure

```
sage -t elliptic_curves/ell_finite_field.py
**********************************************************************
File "elliptic_curves/ell_finite_field.py", line 1391, in sage.schemes.elliptic_curves.ell_finite_field.EllipticCurve_finite_field.abelian_group
Failed example:
    E.abelian_group()
Expected:
    Additive abelian group isomorphic to Z/10 embedded in Abelian group of points on Elliptic Curve defined by y^2 = x^3 + 2*x + 5 over Finite Field of size
11
Got:
    (Multiplicative Abelian group isomorphic to C10, ((3 : 4 : 1),))
**********************************************************************
1 item had failures:
   1 of  23 in sage.schemes.elliptic_curves.ell_finite_field.EllipticCurve_finite_field.abelian_group
    [306 tests, 1 failure, 3.44 s]
```

But when I manually compute the doctest, it gives the expected answer.


---

Comment by git created at 2017-07-20 03:51:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klui created at 2017-07-20 03:53:08

David Roe is awesome. He figured out the bug.

I think all doctests should pass now.


---

Comment by klui created at 2017-07-20 04:02:03

I haven't actually read much of the code. I just fixed the failing doctests. Hopefully this is okay.


---

Comment by klui created at 2017-07-20 04:02:03

Changing status from needs_work to needs_review.


---

Comment by klui created at 2017-07-20 04:11:41

Changing keywords from "" to "elliptic curves, sd87".


---

Comment by cremona created at 2017-07-20 08:07:46

This looks better: I looked at the code but have not had time for testing.  I would prefer the docstring which now says "Unlike :meth:`abelian_group`, this works even over large finite fields" to say "this works over larger finite fields where :meth:`abelian_group` may be too expensive".


---

Comment by cremona created at 2017-07-20 08:08:38

By the way I think the conventions is to add names to lists of AUTHORS but not delete them.


---

Comment by git created at 2017-07-20 15:26:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klui created at 2017-07-20 15:28:08

I added your suggestion. I didn't see where AUTHORS was changed.


---

Comment by cremona created at 2017-07-20 15:39:33

Thanks.  (In the diffs you can see

```
-        AUTHORS:
+        - if the group is trivial: an empty tuple.
 
-        - John Cremona
+        - if the group is cyclic: a tuple with 1 point, a generator.
+
```

;)


---

Comment by cremona created at 2017-07-20 15:39:44

Changing status from needs_review to positive_review.


---

Comment by gpark created at 2017-07-20 15:56:19

All test passed.


---

Comment by cremona created at 2017-07-20 16:05:01

Thanks for adding me as referee.  (Do we normally include as referees people who have not commented on the ticket as well?  I don't know who gpark is, but assume there's a reason for them adding their name.)


---

Comment by vbraun created at 2017-07-26 22:13:43

Resolution: fixed
