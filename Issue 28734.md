# Issue 28734: tachyon syntax error when building doc

archive/issues_028734.json:
```json
{
    "body": "Keywords: tachyon syntax error locale documentation\n\nWhen building the documentation on a system\n\n* whose locale uses commas as a decimal separator (in the tested case `LC_NUMERIC=\"fr_FR.UTF-8\"`); and\n* where jmol is not available (for instance if java is not installed),\n\ntachyon, which is used to produced images of 3d objects for the documentation when jmol is not available, returns a syntax error. The error is caused by the presence of float numbers with commas (instead of dots) in the input string of tachyon. Curiously this bug seems to only happen when building the doc. See https://groups.google.com/forum/#!topic/sage-devel/peTGEjzS2eA .\n\nThis ticket fixes the bug by setting the locale before producing plots for the documentation.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28971\n\n",
    "created_at": "2020-01-08T09:46:01Z",
    "labels": [
        "documentation",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "tachyon syntax error when building doc",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28734",
    "user": "@jfraymond"
}
```
Keywords: tachyon syntax error locale documentation

When building the documentation on a system

* whose locale uses commas as a decimal separator (in the tested case `LC_NUMERIC="fr_FR.UTF-8"`); and
* where jmol is not available (for instance if java is not installed),

tachyon, which is used to produced images of 3d objects for the documentation when jmol is not available, returns a syntax error. The error is caused by the presence of float numbers with commas (instead of dots) in the input string of tachyon. Curiously this bug seems to only happen when building the doc. See https://groups.google.com/forum/#!topic/sage-devel/peTGEjzS2eA .

This ticket fixes the bug by setting the locale before producing plots for the documentation.

Issue created by migration from https://trac.sagemath.org/ticket/28971





---

archive/issue_comments_405807.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-08T10:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28734#issuecomment-405807",
    "user": "@jfraymond"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_405808.json:
```json
{
    "body": "Could this have issues if the `en_US.UTF-8` locale is unavailable? Would it be better to set `LC_ALL=C`?",
    "created_at": "2020-01-09T12:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28734#issuecomment-405808",
    "user": "Konrad127123"
}
```

Could this have issues if the `en_US.UTF-8` locale is unavailable? Would it be better to set `LC_ALL=C`?



---

archive/issue_comments_405809.json:
```json
{
    "body": "Yes, you are right.\nI fixed it in a new commit (I set `LC_NUMERIC` to `'C'`). No problem building the documentation on my system after this change.\n----\nNew commits:",
    "created_at": "2020-01-13T08:34:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28734#issuecomment-405809",
    "user": "@jfraymond"
}
```

Yes, you are right.
I fixed it in a new commit (I set `LC_NUMERIC` to `'C'`). No problem building the documentation on my system after this change.
----
New commits:



---

archive/issue_comments_405810.json:
```json
{
    "body": "Can this problem be reproduced outside the doc build?  Or is it a more general problem?  I think it seems strange to try to fix this just in the doc build.",
    "created_at": "2020-01-21T10:16:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28734#issuecomment-405810",
    "user": "embray"
}
```

Can this problem be reproduced outside the doc build?  Or is it a more general problem?  I think it seems strange to try to fix this just in the doc build.



---

archive/issue_comments_405811.json:
```json
{
    "body": "Replying to [comment:6 embray]:\n> Can this problem be reproduced outside the doc build?  Or is it a more general problem?  I think it seems strange to try to fix this just in the doc build.\n\nAnswering my own question: I can't seem to reproduce the problem outside the docbuild, even after confirming that I have `os.environ['LC_NUMERIC'] == 'fr_FR.UTF-8'`.  The question though is *why*?",
    "created_at": "2020-01-21T10:20:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28734#issuecomment-405811",
    "user": "embray"
}
```

Replying to [comment:6 embray]:
> Can this problem be reproduced outside the doc build?  Or is it a more general problem?  I think it seems strange to try to fix this just in the doc build.

Answering my own question: I can't seem to reproduce the problem outside the docbuild, even after confirming that I have `os.environ['LC_NUMERIC'] == 'fr_FR.UTF-8'`.  The question though is *why*?



---

archive/issue_comments_405812.json:
```json
{
    "body": "I did not manage to reproduce it outside of the doc build. When I execute in sage exactly the same commands as those used to produce plots for the doc, no problem occurs.",
    "created_at": "2020-01-21T10:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28734#issuecomment-405812",
    "user": "@jfraymond"
}
```

I did not manage to reproduce it outside of the doc build. When I execute in sage exactly the same commands as those used to produce plots for the doc, no problem occurs.



---

archive/issue_comments_405813.json:
```json
{
    "body": "I got this error while building the documentation (using the locale `nl_NL.utf8`; Dutch also uses commas as decimal separator) and this ticket fixes it.",
    "created_at": "2020-03-30T09:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28734#issuecomment-405813",
    "user": "pbruin"
}
```

I got this error while building the documentation (using the locale `nl_NL.utf8`; Dutch also uses commas as decimal separator) and this ticket fixes it.



---

archive/issue_comments_405814.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-30T09:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28734#issuecomment-405814",
    "user": "pbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_405815.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-16T22:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28734",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28734#issuecomment-405815",
    "user": "vbraun"
}
```

Resolution: fixed
