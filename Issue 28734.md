# Issue 28734: tachyon syntax error when building doc

Issue created by migration from https://trac.sagemath.org/ticket/28971

Original creator: @jfraymond

Original creation time: 2020-01-08 09:46:01

Keywords: tachyon syntax error locale documentation

When building the documentation on a system

  * whose locale uses commas as a decimal separator (in the tested case `LC_NUMERIC="fr_FR.UTF-8"`); and
  * where jmol is not available (for instance if java is not installed),

tachyon, which is used to produced images of 3d objects for the documentation when jmol is not available, returns a syntax error. The error is caused by the presence of float numbers with commas (instead of dots) in the input string of tachyon. Curiously this bug seems to only happen when building the doc. See https://groups.google.com/forum/#!topic/sage-devel/peTGEjzS2eA .

This ticket fixes the bug by setting the locale before producing plots for the documentation.


---

Comment by @jfraymond created at 2020-01-08 10:14:57

Changing status from new to needs_review.


---

Comment by Konrad127123 created at 2020-01-09 12:15:07

Could this have issues if the `en_US.UTF-8` locale is unavailable? Would it be better to set `LC_ALL=C`?


---

Comment by @jfraymond created at 2020-01-13 08:34:31

Yes, you are right.
I fixed it in a new commit (I set `LC_NUMERIC` to `'C'`). No problem building the documentation on my system after this change.
----
New commits:


---

Comment by embray created at 2020-01-21 10:16:45

Can this problem be reproduced outside the doc build?  Or is it a more general problem?  I think it seems strange to try to fix this just in the doc build.


---

Comment by embray created at 2020-01-21 10:20:15

Replying to [comment:6 embray]:
> Can this problem be reproduced outside the doc build?  Or is it a more general problem?  I think it seems strange to try to fix this just in the doc build.

Answering my own question: I can't seem to reproduce the problem outside the docbuild, even after confirming that I have `os.environ['LC_NUMERIC'] == 'fr_FR.UTF-8'`.  The question though is _why_?


---

Comment by @jfraymond created at 2020-01-21 10:21:16

I did not manage to reproduce it outside of the doc build. When I execute in sage exactly the same commands as those used to produce plots for the doc, no problem occurs.


---

Comment by pbruin created at 2020-03-30 09:33:55

I got this error while building the documentation (using the locale `nl_NL.utf8`; Dutch also uses commas as decimal separator) and this ticket fixes it.


---

Comment by pbruin created at 2020-03-30 09:33:55

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-04-16 22:33:00

Resolution: fixed
