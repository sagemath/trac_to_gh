# Issue 21618: LaurentPolynomialRing: incorrect conversion of base ring element

Issue created by migration from Trac.

Original creator: dkrenn

Original creation time: 2016-11-10 16:06:51

CC:  cheuberg


```
sage: P = LaurentPolynomialRing(QQ, 'a, b')
sage: Q = LaurentPolynomialRing(P, 'c, d')
sage: Q(P.gens()[0])
c
```

but the expected result is `a` as it is with polynomial rings:

```
sage: P = PolynomialRing(QQ, 'a, b')
sage: Q = PolynomialRing(P, 'c, d')
sage: Q(P.gens()[0])
a
```



---

Comment by dkrenn created at 2016-11-11 08:17:02

Changing status from new to needs_review.


---

Comment by dkrenn created at 2016-11-11 08:17:02

Let's see what the patchbot says...
----
Last 10 new commits:


---

Comment by git created at 2016-11-11 09:03:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-11-11 14:53:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-11-11 17:02:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-11-21 09:14:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-11-21 09:15:26

Replying to [comment:9 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[ac104da](https://git.sagemath.org/sage.git/commit/?id=ac104da972c4a0eeebc0d5c4de43bac0bae8a226)||`cleanup is_constant`||
> ||[8fa1916](https://git.sagemath.org/sage.git/commit/?id=8fa1916db496f3a9ee4c22e4a83e9f66f989ffb1)||`simplify _integer_ and _rational_ (using existing methods better)`||

Some code simplifications.


---

Comment by git created at 2016-11-21 09:19:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-11-21 11:31:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-11-21 11:48:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-11-21 11:48:44

Two more bug-fixes...ticket needs review now.


---

Comment by tscrim created at 2017-01-03 13:55:35

Since (multivariate) polynomial and Laurent polynomial rings should have essentially the same coercions, how difficult would it be to pull out the code to find the coercions into standalone functions (or as a mixin-class)? Or are there some subtle differences that I am not quite considering? I feel like this could make code maintenance easier in the long-run.

Some other small things:

- Please make sure your `INPUT` blocks are in the proper format (sorry to sound like a broken record)
- (Short) Error messages should not have periods.
- It is with a capital letter "Laurent".
- This is a cleaner way of doing multiline statements
  {{{#!python
        return (self._mon == ETuple({}, int(self.parent().ngens()))
                and self._poly.is_constant())
  }}}


---

Comment by chapoton created at 2017-01-19 17:14:23

did some partial work on Travis comments
----
New commits:


---

Comment by chapoton created at 2017-02-01 13:12:30

does not apply
----
New commits:


---

Comment by chapoton created at 2017-02-01 13:12:30

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-02-03 17:07:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2017-02-03 17:08:18

Replying to [comment:18 chapoton]:
> does not apply

Merged in 7.6.beta2.


---

Comment by dkrenn created at 2017-02-09 09:14:58

Replying to [comment:16 tscrim]:
> Some other small things:
> 
> - Please make sure your `INPUT` blocks are in the proper format (sorry to sound like a broken record)

[comment:17 chapoton] thanks for doing this.

> - (Short) Error messages should not have periods.

I am for a correct punctation. Thus if it is a proper English sentence (short or longer), there should be a period. E.g.

```
ValueError: a is not constant.
```

Thus either we (meaning I) add the period again or we rewrite this to `a not constant`. What do you prefer? (FYI, I prefer the former as it sound "more round".)

> - It is with a capital letter "Laurent".

Thank you for doing.

> - This is a cleaner way of doing multiline statements
>   {{{#!python
>         return (self._mon == ETuple({}, int(self.parent().ngens()))
>                 and self._poly.is_constant())
>   }}}

Ok, I am fine with it.


---

Comment by dkrenn created at 2017-02-09 09:21:06

Replying to [comment:16 tscrim]:
> Since (multivariate) polynomial and Laurent polynomial rings should have essentially the same coercions, how difficult would it be to pull out the code to find the coercions into standalone functions (or as a mixin-class)? Or are there some subtle differences that I am not quite considering? I feel like this could make code maintenance easier in the long-run.

I agree that this is desirable. As I am not that familiar with the polynomial ring code (and it will need some effort to do), I have put this into the follow up ticket #22333.


---

Comment by dkrenn created at 2017-02-09 09:21:22

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-02-09 14:56:22

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-02-09 14:56:22

Replying to [comment:21 dkrenn]:
> Replying to [comment:16 tscrim]:
> > - (Short) Error messages should not have periods.
> 
> I am for a correct punctation. Thus if it is a proper English sentence (short or longer), there should be a period. E.g.
> {{{
> ValueError: a is not constant.
> }}}
> Thus either we (meaning I) add the period again or we rewrite this to `a not constant`. What do you prefer? (FYI, I prefer the former as it sound "more round".)

The short version is that this is a Python convention that we (should) try to adhere to. The more technical reason: while they could be considered full sentences, they technically don't begin with a capital letter (the type of error is taken more as a bullet point).

LGTM. Thanks.


---

Comment by dkrenn created at 2017-02-09 15:11:57

Replying to [comment:24 tscrim]:
> The short version is that this is a Python convention that we (should) try to adhere to.

Is this really so? I have not found this convention, so it would be great if you could provide a link etc.

By just looking what Python does, it seems not to be clear, what the rule is: E.g. `rational division by zero` (which is produced by `1/int(0)`) could also mean "use correct punctation and capitalization", i.e. if not a proper English sentence start small and end with `.`, and that does not exclude, if a proper English sentence, then start capitalized and end with period.

> The more technical reason: while they could be considered full sentences, they technically don't begin with a capital letter (the type of error is taken more as a bullet point).

So, this means `a is not constant.` should not start with a formula, but something like `The input a is not constant.` should be fine. ;)

> LGTM. Thanks.

Ok, thank you; then let it be as it is for this ticket (However, I'd really like to see a reference for the above.)


---

Comment by tscrim created at 2017-02-09 15:18:18

Replying to [comment:25 dkrenn]:
> Replying to [comment:24 tscrim]:
> > The short version is that this is a Python convention that we (should) try to adhere to.
> 
> Is this really so? I have not found this convention, so it would be great if you could provide a link etc.
> 
> By just looking what Python does, it seems not to be clear, what the rule is: E.g. `rational division by zero` (which is produced by `1/int(0)`) could also mean "use correct punctation and capitalization", i.e. if not a proper English sentence start small and end with `.`, and that does not exclude, if a proper English sentence, then start capitalized and end with period.

I don't think this is officially documented, but is just something all Python error messages use. It is also a convention most error messages in Sage use as well.

> > The more technical reason: while they could be considered full sentences, they technically don't begin with a capital letter (the type of error is taken more as a bullet point).
> 
> So, this means `a is not constant.` should not start with a formula, but something like `The input a is not constant.` should be fine. ;)

Good math papers should never start sentences with formulas. :P We can also always change sentences into clauses too. ;)


---

Comment by vbraun created at 2017-02-11 10:22:39

Resolution: fixed
