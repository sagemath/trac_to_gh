# Issue 21618: LaurentPolynomialRing: incorrect conversion of base ring element

archive/issues_021618.json:
```json
{
    "body": "CC:  @cheuberg\n\n\n```\nsage: P = LaurentPolynomialRing(QQ, 'a, b')\nsage: Q = LaurentPolynomialRing(P, 'c, d')\nsage: Q(P.gens()[0])\nc\n```\n\nbut the expected result is `a` as it is with polynomial rings:\n\n```\nsage: P = PolynomialRing(QQ, 'a, b')\nsage: Q = PolynomialRing(P, 'c, d')\nsage: Q(P.gens()[0])\na\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/21855\n\n",
    "created_at": "2016-11-10T16:06:51Z",
    "labels": [
        "algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "LaurentPolynomialRing: incorrect conversion of base ring element",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21618",
    "user": "@dkrenn"
}
```
CC:  @cheuberg


```
sage: P = LaurentPolynomialRing(QQ, 'a, b')
sage: Q = LaurentPolynomialRing(P, 'c, d')
sage: Q(P.gens()[0])
c
```

but the expected result is `a` as it is with polynomial rings:

```
sage: P = PolynomialRing(QQ, 'a, b')
sage: Q = PolynomialRing(P, 'c, d')
sage: Q(P.gens()[0])
a
```


Issue created by migration from https://trac.sagemath.org/ticket/21855





---

archive/issue_comments_300059.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-11-11T08:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300059",
    "user": "@dkrenn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_300060.json:
```json
{
    "body": "Let's see what the patchbot says...\n----\nLast 10 new commits:",
    "created_at": "2016-11-11T08:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300060",
    "user": "@dkrenn"
}
```

Let's see what the patchbot says...
----
Last 10 new commits:



---

archive/issue_comments_300061.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-11T09:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300061",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300062.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-11T14:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300062",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300063.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-11T17:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300063",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300064.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-21T09:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300064",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300065.json:
```json
{
    "body": "Replying to [comment:9 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[ac104da](https://git.sagemath.org/sage.git/commit/?id=ac104da972c4a0eeebc0d5c4de43bac0bae8a226)||`cleanup is_constant`||\n> ||[8fa1916](https://git.sagemath.org/sage.git/commit/?id=8fa1916db496f3a9ee4c22e4a83e9f66f989ffb1)||`simplify _integer_ and _rational_ (using existing methods better)`||\n\nSome code simplifications.",
    "created_at": "2016-11-21T09:15:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300065",
    "user": "@dkrenn"
}
```

Replying to [comment:9 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[ac104da](https://git.sagemath.org/sage.git/commit/?id=ac104da972c4a0eeebc0d5c4de43bac0bae8a226)||`cleanup is_constant`||
> ||[8fa1916](https://git.sagemath.org/sage.git/commit/?id=8fa1916db496f3a9ee4c22e4a83e9f66f989ffb1)||`simplify _integer_ and _rational_ (using existing methods better)`||

Some code simplifications.



---

archive/issue_comments_300066.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-21T09:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300066",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300067.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-21T11:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300067",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300068.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-21T11:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300068",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300069.json:
```json
{
    "body": "Two more bug-fixes...ticket needs review now.",
    "created_at": "2016-11-21T11:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300069",
    "user": "@dkrenn"
}
```

Two more bug-fixes...ticket needs review now.



---

archive/issue_comments_300070.json:
```json
{
    "body": "Since (multivariate) polynomial and Laurent polynomial rings should have essentially the same coercions, how difficult would it be to pull out the code to find the coercions into standalone functions (or as a mixin-class)? Or are there some subtle differences that I am not quite considering? I feel like this could make code maintenance easier in the long-run.\n\nSome other small things:\n\n- Please make sure your `INPUT` blocks are in the proper format (sorry to sound like a broken record)\n- (Short) Error messages should not have periods.\n- It is with a capital letter \"Laurent\".\n- This is a cleaner way of doing multiline statements\n  {{{#!python\n        return (self._mon == ETuple({}, int(self.parent().ngens()))\n                and self._poly.is_constant())\n  }}}",
    "created_at": "2017-01-03T13:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300070",
    "user": "@tscrim"
}
```

Since (multivariate) polynomial and Laurent polynomial rings should have essentially the same coercions, how difficult would it be to pull out the code to find the coercions into standalone functions (or as a mixin-class)? Or are there some subtle differences that I am not quite considering? I feel like this could make code maintenance easier in the long-run.

Some other small things:

- Please make sure your `INPUT` blocks are in the proper format (sorry to sound like a broken record)
- (Short) Error messages should not have periods.
- It is with a capital letter "Laurent".
- This is a cleaner way of doing multiline statements
  {{{#!python
        return (self._mon == ETuple({}, int(self.parent().ngens()))
                and self._poly.is_constant())
  }}}



---

archive/issue_comments_300071.json:
```json
{
    "body": "did some partial work on Travis comments\n----\nNew commits:",
    "created_at": "2017-01-19T17:14:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300071",
    "user": "@fchapoton"
}
```

did some partial work on Travis comments
----
New commits:



---

archive/issue_comments_300072.json:
```json
{
    "body": "does not apply\n----\nNew commits:",
    "created_at": "2017-02-01T13:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300072",
    "user": "@fchapoton"
}
```

does not apply
----
New commits:



---

archive/issue_comments_300073.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-01T13:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300073",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_300074.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-03T17:07:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300074",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300075.json:
```json
{
    "body": "Replying to [comment:18 chapoton]:\n> does not apply\n\nMerged in 7.6.beta2.",
    "created_at": "2017-02-03T17:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300075",
    "user": "@dkrenn"
}
```

Replying to [comment:18 chapoton]:
> does not apply

Merged in 7.6.beta2.



---

archive/issue_comments_300076.json:
```json
{
    "body": "Replying to [comment:16 tscrim]:\n> Some other small things:\n> \n> - Please make sure your `INPUT` blocks are in the proper format (sorry to sound like a broken record)\n\n[comment:17 chapoton] thanks for doing this.\n\n> - (Short) Error messages should not have periods.\n\nI am for a correct punctation. Thus if it is a proper English sentence (short or longer), there should be a period. E.g.\n\n```\nValueError: a is not constant.\n```\n\nThus either we (meaning I) add the period again or we rewrite this to `a not constant`. What do you prefer? (FYI, I prefer the former as it sound \"more round\".)\n\n> - It is with a capital letter \"Laurent\".\n\nThank you for doing.\n\n> - This is a cleaner way of doing multiline statements\n>   {{{#!python\n>         return (self._mon == ETuple({}, int(self.parent().ngens()))\n>                 and self._poly.is_constant())\n>   }}}\n\nOk, I am fine with it.",
    "created_at": "2017-02-09T09:14:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300076",
    "user": "@dkrenn"
}
```

Replying to [comment:16 tscrim]:
> Some other small things:
> 
> - Please make sure your `INPUT` blocks are in the proper format (sorry to sound like a broken record)

[comment:17 chapoton] thanks for doing this.

> - (Short) Error messages should not have periods.

I am for a correct punctation. Thus if it is a proper English sentence (short or longer), there should be a period. E.g.

```
ValueError: a is not constant.
```

Thus either we (meaning I) add the period again or we rewrite this to `a not constant`. What do you prefer? (FYI, I prefer the former as it sound "more round".)

> - It is with a capital letter "Laurent".

Thank you for doing.

> - This is a cleaner way of doing multiline statements
>   {{{#!python
>         return (self._mon == ETuple({}, int(self.parent().ngens()))
>                 and self._poly.is_constant())
>   }}}

Ok, I am fine with it.



---

archive/issue_comments_300077.json:
```json
{
    "body": "Replying to [comment:16 tscrim]:\n> Since (multivariate) polynomial and Laurent polynomial rings should have essentially the same coercions, how difficult would it be to pull out the code to find the coercions into standalone functions (or as a mixin-class)? Or are there some subtle differences that I am not quite considering? I feel like this could make code maintenance easier in the long-run.\n\nI agree that this is desirable. As I am not that familiar with the polynomial ring code (and it will need some effort to do), I have put this into the follow up ticket #22333.",
    "created_at": "2017-02-09T09:21:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300077",
    "user": "@dkrenn"
}
```

Replying to [comment:16 tscrim]:
> Since (multivariate) polynomial and Laurent polynomial rings should have essentially the same coercions, how difficult would it be to pull out the code to find the coercions into standalone functions (or as a mixin-class)? Or are there some subtle differences that I am not quite considering? I feel like this could make code maintenance easier in the long-run.

I agree that this is desirable. As I am not that familiar with the polynomial ring code (and it will need some effort to do), I have put this into the follow up ticket #22333.



---

archive/issue_comments_300078.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-09T09:21:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300078",
    "user": "@dkrenn"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_300079.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-09T14:56:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300079",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_300080.json:
```json
{
    "body": "Replying to [comment:21 dkrenn]:\n> Replying to [comment:16 tscrim]:\n> > - (Short) Error messages should not have periods.\n> \n> I am for a correct punctation. Thus if it is a proper English sentence (short or longer), there should be a period. E.g.\n> {{{\n> ValueError: a is not constant.\n> }}}\n> Thus either we (meaning I) add the period again or we rewrite this to `a not constant`. What do you prefer? (FYI, I prefer the former as it sound \"more round\".)\n\nThe short version is that this is a Python convention that we (should) try to adhere to. The more technical reason: while they could be considered full sentences, they technically don't begin with a capital letter (the type of error is taken more as a bullet point).\n\nLGTM. Thanks.",
    "created_at": "2017-02-09T14:56:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300080",
    "user": "@tscrim"
}
```

Replying to [comment:21 dkrenn]:
> Replying to [comment:16 tscrim]:
> > - (Short) Error messages should not have periods.
> 
> I am for a correct punctation. Thus if it is a proper English sentence (short or longer), there should be a period. E.g.
> {{{
> ValueError: a is not constant.
> }}}
> Thus either we (meaning I) add the period again or we rewrite this to `a not constant`. What do you prefer? (FYI, I prefer the former as it sound "more round".)

The short version is that this is a Python convention that we (should) try to adhere to. The more technical reason: while they could be considered full sentences, they technically don't begin with a capital letter (the type of error is taken more as a bullet point).

LGTM. Thanks.



---

archive/issue_comments_300081.json:
```json
{
    "body": "Replying to [comment:24 tscrim]:\n> The short version is that this is a Python convention that we (should) try to adhere to.\n\nIs this really so? I have not found this convention, so it would be great if you could provide a link etc.\n\nBy just looking what Python does, it seems not to be clear, what the rule is: E.g. `rational division by zero` (which is produced by `1/int(0)`) could also mean \"use correct punctation and capitalization\", i.e. if not a proper English sentence start small and end with `.`, and that does not exclude, if a proper English sentence, then start capitalized and end with period.\n\n> The more technical reason: while they could be considered full sentences, they technically don't begin with a capital letter (the type of error is taken more as a bullet point).\n\nSo, this means `a is not constant.` should not start with a formula, but something like `The input a is not constant.` should be fine. ;)\n\n> LGTM. Thanks.\n\nOk, thank you; then let it be as it is for this ticket (However, I'd really like to see a reference for the above.)",
    "created_at": "2017-02-09T15:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300081",
    "user": "@dkrenn"
}
```

Replying to [comment:24 tscrim]:
> The short version is that this is a Python convention that we (should) try to adhere to.

Is this really so? I have not found this convention, so it would be great if you could provide a link etc.

By just looking what Python does, it seems not to be clear, what the rule is: E.g. `rational division by zero` (which is produced by `1/int(0)`) could also mean "use correct punctation and capitalization", i.e. if not a proper English sentence start small and end with `.`, and that does not exclude, if a proper English sentence, then start capitalized and end with period.

> The more technical reason: while they could be considered full sentences, they technically don't begin with a capital letter (the type of error is taken more as a bullet point).

So, this means `a is not constant.` should not start with a formula, but something like `The input a is not constant.` should be fine. ;)

> LGTM. Thanks.

Ok, thank you; then let it be as it is for this ticket (However, I'd really like to see a reference for the above.)



---

archive/issue_comments_300082.json:
```json
{
    "body": "Replying to [comment:25 dkrenn]:\n> Replying to [comment:24 tscrim]:\n> > The short version is that this is a Python convention that we (should) try to adhere to.\n> \n> Is this really so? I have not found this convention, so it would be great if you could provide a link etc.\n> \n> By just looking what Python does, it seems not to be clear, what the rule is: E.g. `rational division by zero` (which is produced by `1/int(0)`) could also mean \"use correct punctation and capitalization\", i.e. if not a proper English sentence start small and end with `.`, and that does not exclude, if a proper English sentence, then start capitalized and end with period.\n\nI don't think this is officially documented, but is just something all Python error messages use. It is also a convention most error messages in Sage use as well.\n\n> > The more technical reason: while they could be considered full sentences, they technically don't begin with a capital letter (the type of error is taken more as a bullet point).\n> \n> So, this means `a is not constant.` should not start with a formula, but something like `The input a is not constant.` should be fine. ;)\n\nGood math papers should never start sentences with formulas. :P We can also always change sentences into clauses too. ;)",
    "created_at": "2017-02-09T15:18:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300082",
    "user": "@tscrim"
}
```

Replying to [comment:25 dkrenn]:
> Replying to [comment:24 tscrim]:
> > The short version is that this is a Python convention that we (should) try to adhere to.
> 
> Is this really so? I have not found this convention, so it would be great if you could provide a link etc.
> 
> By just looking what Python does, it seems not to be clear, what the rule is: E.g. `rational division by zero` (which is produced by `1/int(0)`) could also mean "use correct punctation and capitalization", i.e. if not a proper English sentence start small and end with `.`, and that does not exclude, if a proper English sentence, then start capitalized and end with period.

I don't think this is officially documented, but is just something all Python error messages use. It is also a convention most error messages in Sage use as well.

> > The more technical reason: while they could be considered full sentences, they technically don't begin with a capital letter (the type of error is taken more as a bullet point).
> 
> So, this means `a is not constant.` should not start with a formula, but something like `The input a is not constant.` should be fine. ;)

Good math papers should never start sentences with formulas. :P We can also always change sentences into clauses too. ;)



---

archive/issue_comments_300083.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-02-11T10:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21618#issuecomment-300083",
    "user": "@vbraun"
}
```

Resolution: fixed
