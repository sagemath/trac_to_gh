# Issue 27267: all_simple_paths method not returning all paths in case of multiedges

Issue created by migration from https://trac.sagemath.org/ticket/27504

Original creator: @rajat1433

Original creation time: 2019-03-17 05:31:57

CC:  dcoudert

similar to ticket:27501 all_simple_paths  also fails to output all simple paths (as per definition) in case of multiple edges present inside the Digraph.


```
....: sage: eg = DiGraph(multiedges=True)
....: sage: eg.add_edge(0,1,1)
....: sage: eg.add_edge(0,2,3)
....: sage: eg.add_edge(1,4,3)
....: sage: eg.add_edge(2,3,5)
....: sage: eg.add_edge(2,4,15)
....: sage: eg.add_edge(2,4,12)
....: sage: eg.add_edge(4,5,7)
....: sage: eg.add_edge(4,5,8)
....: sage: eg.add_edge(5,6,2)
....: sage: eg.all_simple_paths(starting_vertices=[0],ending_vertices=[6])
```


it currently returns -


```
[[0, 1, 4, 5, 6], [0, 2, 4, 5, 6]]
```

 
but should return 



```
[[0, 1, 4, 5, 6],
 [0, 1, 4, 5, 6],
 [0, 2, 4, 5, 6],
 [0, 2, 4, 5, 6],
 [0, 2, 4, 5, 6],
 [0, 2, 4, 5, 6]]
```


Functions like all_paths_iterator also require some changes.


---

Comment by @rajat1433 created at 2019-03-17 11:31:35

Set assignee to @rajat1433.


---

Comment by git created at 2019-03-17 11:54:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-03-17 11:55:07

Changing status from new to needs_review.


---

Comment by dcoudert created at 2019-03-18 07:44:49

There is a merge conflict in this branch.

I think you should not add several times a path to the queue, and only yield it a sufficient number of times. Note however that this will work for unweighted paths only, but this is enough for now.


---

Comment by git created at 2019-03-18 09:21:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-03-18 09:24:21

I don't know why merge is failing , I am creating new branch before editing the code from develop branch. Also I am using sage-8.7.beta6.


---

Comment by @rajat1433 created at 2019-03-18 09:37:17


```
I think you should not add several times a path to the queue, and only yield it a sufficient number of times.
```


I got the catch regarding not adding to queue a path that is occuring multiple times if it is not be going to a part of our answer. Any ideas on how to avoid that? I am also thinking through some alternate approach.


---

Comment by git created at 2019-03-18 10:05:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-03-18 10:09:03

I tried to get latest version of sage digraph.py file from https://github.com/sagemath/sage/blob/develop/src/sage/graphs/digraph.py but still fail to merge.


---

Comment by dcoudert created at 2019-03-18 13:23:26

You should not just get last version of `digraph.py`.

You should first update your develop branch

```
git checkout develop
git pull
make
```

And then rebase your branch on last beta, for instance like that

```
git checkout -b tmp develop
git fetch trac u/gh-rajat1433/27504_all_simple_paths_multi:tmp2
git merge tmp2 -m "trac #27504: Merged with 8.7.beta7"
```

you will get a message indicating that merge failed.

Then, open file digraph.py and search for `<<<<` to go to the line with the merge conflict. Fix it, and then commit the changes.


---

Comment by git created at 2019-03-19 04:30:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-03-19 04:41:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-03-19 04:57:49

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-03-19 05:03:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-03-19 05:07:13

following the approach in ticket:27501 , I've done here similar thing to return a path multiple times depending on the multiplicity of an edge in the path.


---

Comment by @rajat1433 created at 2019-03-19 05:07:22

Changing status from needs_work to needs_review.


---

Comment by @rajat1433 created at 2019-03-22 18:13:11

Should I add the parameters use_multiedges , report_edges and labels as in ticket:27501  to each of the 3 methods (2 iterators and all_simple_paths) or just add these parameters only to all_simple_paths method?


---

Comment by dcoudert created at 2019-03-22 18:20:07

I might be better to add these parameters here as well. You know how to do it now ;)


---

Comment by @rajat1433 created at 2019-03-23 09:52:26

Changing keywords from "" to "multiedges, edge_paths".


---

Comment by git created at 2019-03-23 09:52:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-03-23 09:57:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-03-23 09:59:33

I have updated the all_simple_paths and its iterator codes.
Also added examples in all_simple_paths.
Next thing is to add examples in iterators.
If this gets reviewed I can start doing that.


---

Comment by dcoudert created at 2019-03-24 17:48:13

- what does `empty` mean

```
         - ``data`` -- dictionary (default: ``empty``); optional parameter to
```

  it's not a Python keyword, right? By default you just have nothing. An alternative is to use `data=None` instead of `**data`...

- a more direct code

```diff
-                                edge_paths=[]
-                                edge_paths.extend(cartesian_product([my_dict[e] for e in zip(newpath[:-1], newpath[1:])]))
-                                for p in edge_paths:
+                                for p in cartesian_product([my_dict[e] for e in zip(newpath[:-1], newpath[1:])])
```

- simpler code with less tests

```diff
-                                if report_edges:
-                                    ep = list(zip(newpath[:-1], newpath[1:]))
-                                for _ in range(m):
-                                    if report_edges:
-                                        yield ep
-                                    else:
-                                        yield newpath
+                                if report_edges:
+                                    newpath = list(zip(newpath[:-1], newpath[1:]))
+                                for _ in range(m):
+                                    yield newpath
```


- instead of `if (e[0], e[1]) in my_dict.keys():`, you can do directly `if (e[0], e[1]) in my_dict: `

- You create `my_dict = {}` and later `dat = my_dict`. Why not using a single variable called `data` ?

- why are you converting the `Counter` to a `dict` ? I think you can pass the Counter to `_all_paths_iterator`. And just call it `data`.


- don't add uncessary empty lines

```diff
+
+
```



---

Comment by git created at 2019-03-25 04:07:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-03-25 04:09:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-03-25 04:12:34

Thanks for the review. I have updated the code.


---

Comment by git created at 2019-03-26 17:16:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-03-26 17:19:22

I have added examples to all_paths_iterator and _all_paths_iterator methods.


---

Comment by dcoudert created at 2019-03-27 10:31:25

my only remark in that you could move

```
+                    yield path      # yield good path
```

at the top of the block, so just after `if path[-1] in ending_vertices:`


---

Comment by git created at 2019-03-27 11:52:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-03-27 11:53:43

Replying to [comment:37 dcoudert]:
> my only remark in that you could move
> {{{
> +                    yield path      # yield good path
> }}}
> at the top of the block, so just after `if path[-1] in ending_vertices:`

done


---

Comment by dcoudert created at 2019-03-27 12:05:26

I was just asking to do e.g.

```
if path[-1] in ending_vertices:
    # yield good path
    ...
```

because the comment was place here because we had only one kind of returned format. Now that we have several, we can move the comment.


---

Comment by @rajat1433 created at 2019-03-27 12:12:59

Oh I should have asked you to make that clearðŸ˜….
I have made the changes.


---

Comment by git created at 2019-03-27 12:13:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2019-03-27 16:25:59

LGTM.


---

Comment by dcoudert created at 2019-03-27 16:25:59

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-03-30 20:38:06

Resolution: fixed
