# Issue 15356: sqlalchemy and gdmodule should not be standard packages

archive/issues_015356.json:
```json
{
    "body": "CC:  @jdemeyer\n\nThey are not really used in any core way in the sage distribution (nor or they mathematics/scientific software).\n\nIssue created by migration from https://trac.sagemath.org/ticket/15593\n\n",
    "created_at": "2013-12-26T23:07:10Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "sqlalchemy and gdmodule should not be standard packages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15356",
    "user": "@ohanar"
}
```
CC:  @jdemeyer

They are not really used in any core way in the sage distribution (nor or they mathematics/scientific software).

Issue created by migration from https://trac.sagemath.org/ticket/15593





---

archive/issue_comments_197928.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-26T23:07:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197928",
    "user": "@ohanar"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_197929.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-09T06:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197929",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_197930.json:
```json
{
    "body": "I dislike\n\n```\nfn = open(filename, 'wb') # check filename\nfn.close()\n\ncdef FILE *out = fopen(filename, 'wb')\n\ngdImagePng(im, out)\n\nfclose(out)\n```\n\nYou can open the file using Python and access its `FILE*` with [PyFile_AsFile](http://docs.python.org/2/c-api/file.html#PyFile_AsFile).",
    "created_at": "2014-02-09T09:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197930",
    "user": "@jdemeyer"
}
```

I dislike

```
fn = open(filename, 'wb') # check filename
fn.close()

cdef FILE *out = fopen(filename, 'wb')

gdImagePng(im, out)

fclose(out)
```

You can open the file using Python and access its `FILE*` with [PyFile_AsFile](http://docs.python.org/2/c-api/file.html#PyFile_AsFile).



---

archive/issue_comments_197931.json:
```json
{
    "body": "Replying to [comment:4 jdemeyer]:\n> I dislike ...\nSure, I didn't really rethink any of the code, just refactored what was already there a bit.",
    "created_at": "2014-02-09T09:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197931",
    "user": "@ohanar"
}
```

Replying to [comment:4 jdemeyer]:
> I dislike ...
Sure, I didn't really rethink any of the code, just refactored what was already there a bit.



---

archive/issue_comments_197932.json:
```json
{
    "body": "I don't want to use `PyFile_AsFile` though since it isn't python 3 compatible.",
    "created_at": "2014-02-09T09:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197932",
    "user": "@ohanar"
}
```

I don't want to use `PyFile_AsFile` though since it isn't python 3 compatible.



---

archive/issue_comments_197933.json:
```json
{
    "body": "Since I need sqlalchemy (or at least *some* database), I'll not review it. Just some questions: Is there the plan to turn the current standard sqlalchemy spkg into an optional one? Will the current standard spkg (version 0.5.8) be upgraded when being made an optional spkg (version 0.9.3)?",
    "created_at": "2014-03-11T14:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197933",
    "user": "@simon-king-jena"
}
```

Since I need sqlalchemy (or at least *some* database), I'll not review it. Just some questions: Is there the plan to turn the current standard sqlalchemy spkg into an optional one? Will the current standard spkg (version 0.5.8) be upgraded when being made an optional spkg (version 0.9.3)?



---

archive/issue_comments_197934.json:
```json
{
    "body": "Replying to [comment:7 SimonKing]:\n> Since I need sqlalchemy (or at least *some* database), I'll not review it. Just some questions: Is there the plan to turn the current standard sqlalchemy spkg into an optional one? Will the current standard spkg (version 0.5.8) be upgraded when being made an optional spkg (version 0.9.3)?\n\nI've not removed sqlalchemy from the repository, so it will remain as an optional spkg (although not upgraded, probably a trivial upgrade though). sqlalchemy is not a database, but rather a wrapper for sql databases to give them a unified interface. We currently ship sqlite as our database of choice.",
    "created_at": "2014-04-02T17:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197934",
    "user": "@ohanar"
}
```

Replying to [comment:7 SimonKing]:
> Since I need sqlalchemy (or at least *some* database), I'll not review it. Just some questions: Is there the plan to turn the current standard sqlalchemy spkg into an optional one? Will the current standard spkg (version 0.5.8) be upgraded when being made an optional spkg (version 0.9.3)?

I've not removed sqlalchemy from the repository, so it will remain as an optional spkg (although not upgraded, probably a trivial upgrade though). sqlalchemy is not a database, but rather a wrapper for sql databases to give them a unified interface. We currently ship sqlite as our database of choice.



---

archive/issue_comments_197935.json:
```json
{
    "body": "Remark on sqlalchemy: As noted on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/4HvpjPCdARw), the current spkg-install of sqlalchemy contains a bug. It says\n\n```\nrm -rf \"$SAGE_LOCAL/lib/python/site-packages/SQLAlchemy*\"\n```\n\nbut should say\n\n```\nrm -rf \"$SAGE_LOCAL\"/lib/python/site-packages/SQLAlchemy*\n```\n\nas otherwise the old sqlalchemy version will not be removed and will still be used even when installing a new version.\n\nOtherwise, upgrading sqlalchemy-spkg is trivial. Shall I open a separate ticket?",
    "created_at": "2014-04-12T16:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197935",
    "user": "@simon-king-jena"
}
```

Remark on sqlalchemy: As noted on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/4HvpjPCdARw), the current spkg-install of sqlalchemy contains a bug. It says

```
rm -rf "$SAGE_LOCAL/lib/python/site-packages/SQLAlchemy*"
```

but should say

```
rm -rf "$SAGE_LOCAL"/lib/python/site-packages/SQLAlchemy*
```

as otherwise the old sqlalchemy version will not be removed and will still be used even when installing a new version.

Otherwise, upgrading sqlalchemy-spkg is trivial. Shall I open a separate ticket?



---

archive/issue_comments_197936.json:
```json
{
    "body": "If I understand the sqlalchemy spkg files correctly, this spkg-install does nothing more than a standard \"python setup.py install\".  Over the years, there have been a fair number of such packages, or at least requests for such packages.  How about we make \"sage -i\" try to \"pip install\" a package if it can't find the corresponding spkg?  Then \"standard python installs\" don't need to be maintained as spkgs, but people still have a transparent way to install them.\n\n(of course, that presumes we have pip as a package---perhaps that's the first external package to be installed...)",
    "created_at": "2014-04-25T17:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197936",
    "user": "@jasongrout"
}
```

If I understand the sqlalchemy spkg files correctly, this spkg-install does nothing more than a standard "python setup.py install".  Over the years, there have been a fair number of such packages, or at least requests for such packages.  How about we make "sage -i" try to "pip install" a package if it can't find the corresponding spkg?  Then "standard python installs" don't need to be maintained as spkgs, but people still have a transparent way to install them.

(of course, that presumes we have pip as a package---perhaps that's the first external package to be installed...)



---

archive/issue_comments_197937.json:
```json
{
    "body": "Replying to [comment:10 jason]:\n> (of course, that presumes we have pip as a package---perhaps that's the first external package to be installed...)\n\nThat's what someone (actually William, IIRC) has suggested on sage-devel.",
    "created_at": "2014-04-25T17:41:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197937",
    "user": "@simon-king-jena"
}
```

Replying to [comment:10 jason]:
> (of course, that presumes we have pip as a package---perhaps that's the first external package to be installed...)

That's what someone (actually William, IIRC) has suggested on sage-devel.



---

archive/issue_comments_197938.json:
```json
{
    "body": "Yep, +1 to that. I've wanted pip to be a standard spkg for a long time.",
    "created_at": "2014-04-25T17:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197938",
    "user": "@jasongrout"
}
```

Yep, +1 to that. I've wanted pip to be a standard spkg for a long time.



---

archive/issue_comments_197939.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-09T08:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197939",
    "user": "@rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_197940.json:
```json
{
    "body": "pip is in the meantime standard.  See also #8757.  Where is sqlalchemy used, anyway (in the Sage library, I mean, not disregarding Simon's point).",
    "created_at": "2015-01-06T14:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197940",
    "user": "@kcrisman"
}
```

pip is in the meantime standard.  See also #8757.  Where is sqlalchemy used, anyway (in the Sage library, I mean, not disregarding Simon's point).



---

archive/issue_comments_197941.json:
```json
{
    "body": "See also https://groups.google.com/forum/#!topic/sage-notebook/LiQEgxT3TWo for removing sqlalchemy altogether.",
    "created_at": "2015-01-06T14:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197941",
    "user": "@kcrisman"
}
```

See also https://groups.google.com/forum/#!topic/sage-notebook/LiQEgxT3TWo for removing sqlalchemy altogether.



---

archive/issue_comments_197942.json:
```json
{
    "body": "See also #4268, which is probably invalid at this point.",
    "created_at": "2015-01-06T14:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197942",
    "user": "@kcrisman"
}
```

See also #4268, which is probably invalid at this point.



---

archive/issue_comments_197943.json:
```json
{
    "body": "Shouldn't \"sqlalchemy should not be a standard package\" and \"gdmodule should not be a standard package\" be 2 different tickets?",
    "created_at": "2015-01-06T15:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197943",
    "user": "@jdemeyer"
}
```

Shouldn't "sqlalchemy should not be a standard package" and "gdmodule should not be a standard package" be 2 different tickets?



---

archive/issue_comments_197944.json:
```json
{
    "body": "Probably at this point, yes.",
    "created_at": "2015-01-06T15:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197944",
    "user": "@kcrisman"
}
```

Probably at this point, yes.



---

archive/issue_comments_197945.json:
```json
{
    "body": "By the way, sqlalchemy was added in #2205 and [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/HEL7HkyjIjA), where no one ever actually *needed* it!  It was just ... useful.  But apparently not enough so to use it for any of our databases.",
    "created_at": "2015-01-06T15:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197945",
    "user": "@kcrisman"
}
```

By the way, sqlalchemy was added in #2205 and [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/HEL7HkyjIjA), where no one ever actually *needed* it!  It was just ... useful.  But apparently not enough so to use it for any of our databases.



---

archive/issue_comments_197946.json:
```json
{
    "body": "See #17591 for gdmodule.",
    "created_at": "2015-01-06T15:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197946",
    "user": "@kcrisman"
}
```

See #17591 for gdmodule.



---

archive/issue_comments_197947.json:
```json
{
    "body": "I am finishing a kind of audit of packages in Sage, and noticed sqlalchemy was useless (and bitrotting for a while). Since there is no interaction with Sage (nor sagenb), i think removing it is a better option than updating it and make it optional. There will be less work to do, and `sage -pip install sqlalchemy` will let the user have the latest version (or even any other version if needed).",
    "created_at": "2015-01-06T15:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197947",
    "user": "tmonteil"
}
```

I am finishing a kind of audit of packages in Sage, and noticed sqlalchemy was useless (and bitrotting for a while). Since there is no interaction with Sage (nor sagenb), i think removing it is a better option than updating it and make it optional. There will be less work to do, and `sage -pip install sqlalchemy` will let the user have the latest version (or even any other version if needed).



---

archive/issue_comments_197948.json:
```json
{
    "body": "That's fine, I just figured people who know more about this than I do should be the ones to change it to 'remove' :)",
    "created_at": "2015-01-06T16:01:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197948",
    "user": "@kcrisman"
}
```

That's fine, I just figured people who know more about this than I do should be the ones to change it to 'remove' :)



---

archive/issue_comments_197949.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-01-06T16:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197949",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_197950.json:
```json
{
    "body": "I haven't actually tested it, but this should work...\n----\nNew commits:",
    "created_at": "2015-01-06T16:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197950",
    "user": "@jdemeyer"
}
```

I haven't actually tested it, but this should work...
----
New commits:



---

archive/issue_comments_197951.json:
```json
{
    "body": "I would actually not get rid of the line in the db file, since (in principle) someone ambitious could do that someday and it's only in a todo list.  We aren't saying we hate sqlalchemy, just that there is no reason to include it in sage-the-distro right now.",
    "created_at": "2015-01-06T16:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197951",
    "user": "@kcrisman"
}
```

I would actually not get rid of the line in the db file, since (in principle) someone ambitious could do that someday and it's only in a todo list.  We aren't saying we hate sqlalchemy, just that there is no reason to include it in sage-the-distro right now.



---

archive/issue_comments_197952.json:
```json
{
    "body": "`make distclean && make ptestlong` passed without problems",
    "created_at": "2015-01-06T22:02:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197952",
    "user": "@jdemeyer"
}
```

`make distclean && make ptestlong` passed without problems



---

archive/issue_comments_197953.json:
```json
{
    "body": "I don't really care about this so much, but just be sure that sagenb does indeed work fine (though I have no reason to expect it not to!).",
    "created_at": "2015-01-07T02:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197953",
    "user": "@kcrisman"
}
```

I don't really care about this so much, but just be sure that sagenb does indeed work fine (though I have no reason to expect it not to!).



---

archive/issue_comments_197954.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-01-15T07:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197954",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_197955.json:
```json
{
    "body": "I just rebuild Sage, testall, reinstall the notebook and ran it...\n\nVincent",
    "created_at": "2015-01-15T07:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197955",
    "user": "@videlec"
}
```

I just rebuild Sage, testall, reinstall the notebook and ran it...

Vincent



---

archive/issue_comments_197956.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-01-18T07:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197956",
    "user": "tmonteil"
}
```

New commits:



---

archive/issue_comments_197957.json:
```json
{
    "body": "Thanks Thierry. I somehow skip the comment of Karl-Dieter.",
    "created_at": "2015-01-18T08:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197957",
    "user": "@videlec"
}
```

Thanks Thierry. I somehow skip the comment of Karl-Dieter.



---

archive/issue_comments_197958.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-01-23T23:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15356",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15356#issuecomment-197958",
    "user": "@vbraun"
}
```

Resolution: fixed
