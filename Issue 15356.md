# Issue 15356: sqlalchemy and gdmodule should not be standard packages

Issue created by migration from Trac.

Original creator: ohanar

Original creation time: 2013-12-26 23:07:10

CC:  jdemeyer

They are not really used in any core way in the sage distribution (nor or they mathematics/scientific software).


---

Comment by ohanar created at 2013-12-26 23:07:54

Changing status from new to needs_review.


---

Comment by git created at 2014-02-09 06:09:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2014-02-09 09:44:56

I dislike

```
fn = open(filename, 'wb') # check filename
fn.close()

cdef FILE *out = fopen(filename, 'wb')

gdImagePng(im, out)

fclose(out)
```

You can open the file using Python and access its `FILE*` with [PyFile_AsFile](http://docs.python.org/2/c-api/file.html#PyFile_AsFile).


---

Comment by ohanar created at 2014-02-09 09:49:40

Replying to [comment:4 jdemeyer]:
> I dislike ...
Sure, I didn't really rethink any of the code, just refactored what was already there a bit.


---

Comment by ohanar created at 2014-02-09 09:55:25

I don't want to use `PyFile_AsFile` though since it isn't python 3 compatible.


---

Comment by SimonKing created at 2014-03-11 14:45:25

Since I need sqlalchemy (or at least *some* database), I'll not review it. Just some questions: Is there the plan to turn the current standard sqlalchemy spkg into an optional one? Will the current standard spkg (version 0.5.8) be upgraded when being made an optional spkg (version 0.9.3)?


---

Comment by ohanar created at 2014-04-02 17:01:10

Replying to [comment:7 SimonKing]:
> Since I need sqlalchemy (or at least *some* database), I'll not review it. Just some questions: Is there the plan to turn the current standard sqlalchemy spkg into an optional one? Will the current standard spkg (version 0.5.8) be upgraded when being made an optional spkg (version 0.9.3)?

I've not removed sqlalchemy from the repository, so it will remain as an optional spkg (although not upgraded, probably a trivial upgrade though). sqlalchemy is not a database, but rather a wrapper for sql databases to give them a unified interface. We currently ship sqlite as our database of choice.


---

Comment by SimonKing created at 2014-04-12 16:48:04

Remark on sqlalchemy: As noted on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/4HvpjPCdARw), the current spkg-install of sqlalchemy contains a bug. It says

```
rm -rf "$SAGE_LOCAL/lib/python/site-packages/SQLAlchemy*"
```

but should say

```
rm -rf "$SAGE_LOCAL"/lib/python/site-packages/SQLAlchemy*
```

as otherwise the old sqlalchemy version will not be removed and will still be used even when installing a new version.

Otherwise, upgrading sqlalchemy-spkg is trivial. Shall I open a separate ticket?


---

Comment by jason created at 2014-04-25 17:23:09

If I understand the sqlalchemy spkg files correctly, this spkg-install does nothing more than a standard "python setup.py install".  Over the years, there have been a fair number of such packages, or at least requests for such packages.  How about we make "sage -i" try to "pip install" a package if it can't find the corresponding spkg?  Then "standard python installs" don't need to be maintained as spkgs, but people still have a transparent way to install them.

(of course, that presumes we have pip as a package---perhaps that's the first external package to be installed...)


---

Comment by SimonKing created at 2014-04-25 17:41:11

Replying to [comment:10 jason]:
> (of course, that presumes we have pip as a package---perhaps that's the first external package to be installed...)

That's what someone (actually William, IIRC) has suggested on sage-devel.


---

Comment by jason created at 2014-04-25 17:47:20

Yep, +1 to that. I've wanted pip to be a standard spkg for a long time.


---

Comment by rws created at 2014-05-09 08:19:37

Changing status from needs_review to needs_work.


---

Comment by kcrisman created at 2015-01-06 14:32:01

pip is in the meantime standard.  See also #8757.  Where is sqlalchemy used, anyway (in the Sage library, I mean, not disregarding Simon's point).


---

Comment by kcrisman created at 2015-01-06 14:50:55

See also https://groups.google.com/forum/#!topic/sage-notebook/LiQEgxT3TWo for removing sqlalchemy altogether.


---

Comment by kcrisman created at 2015-01-06 14:57:52

See also #4268, which is probably invalid at this point.


---

Comment by jdemeyer created at 2015-01-06 15:00:23

Shouldn't "sqlalchemy should not be a standard package" and "gdmodule should not be a standard package" be 2 different tickets?


---

Comment by kcrisman created at 2015-01-06 15:04:53

Probably at this point, yes.


---

Comment by kcrisman created at 2015-01-06 15:15:53

By the way, sqlalchemy was added in #2205 and [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/HEL7HkyjIjA), where no one ever actually _needed_ it!  It was just ... useful.  But apparently not enough so to use it for any of our databases.


---

Comment by kcrisman created at 2015-01-06 15:16:35

See #17591 for gdmodule.


---

Comment by tmonteil created at 2015-01-06 15:50:12

I am finishing a kind of audit of packages in Sage, and noticed sqlalchemy was useless (and bitrotting for a while). Since there is no interaction with Sage (nor sagenb), i think removing it is a better option than updating it and make it optional. There will be less work to do, and `sage -pip install sqlalchemy` will let the user have the latest version (or even any other version if needed).


---

Comment by kcrisman created at 2015-01-06 16:01:30

That's fine, I just figured people who know more about this than I do should be the ones to change it to 'remove' :)


---

Comment by jdemeyer created at 2015-01-06 16:32:31

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2015-01-06 16:32:31

I haven't actually tested it, but this should work...
----
New commits:


---

Comment by kcrisman created at 2015-01-06 16:45:21

I would actually not get rid of the line in the db file, since (in principle) someone ambitious could do that someday and it's only in a todo list.  We aren't saying we hate sqlalchemy, just that there is no reason to include it in sage-the-distro right now.


---

Comment by jdemeyer created at 2015-01-06 22:02:47

`make distclean && make ptestlong` passed without problems


---

Comment by kcrisman created at 2015-01-07 02:53:27

I don't really care about this so much, but just be sure that sagenb does indeed work fine (though I have no reason to expect it not to!).


---

Comment by vdelecroix created at 2015-01-15 07:08:02

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2015-01-15 07:08:02

I just rebuild Sage, testall, reinstall the notebook and ran it...

Vincent


---

Comment by tmonteil created at 2015-01-18 07:18:56

New commits:


---

Comment by vdelecroix created at 2015-01-18 08:12:54

Thanks Thierry. I somehow skip the comment of Karl-Dieter.


---

Comment by vbraun created at 2015-01-23 23:40:51

Resolution: fixed
