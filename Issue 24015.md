# Issue 24015: Fake Integer interface

Issue created by migration from https://trac.sagemath.org/ticket/24252

Original creator: jdemeyer

Original creation time: 2017-11-20 16:24:10

Work around the cyclic dependency of the Sage `Integer` class and the coercion model by introducing a new Cython header `integer_fake` with a minimal interface to `Integer` by doing a lazy import of `sage.rings.integer`.


---

Comment by jdemeyer created at 2017-11-20 18:56:34

New commits:


---

Comment by jdemeyer created at 2017-11-20 18:56:34

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-11-20 23:31:44

Is the only dependency of the `Integer` on the coercion model from the ``@`coerce_binop` of `xgcd`? If so, I think we should do the import and manually call the coercion within `xgcd`. We might get a little performance hit, but I think it is a much more sustainable solution than hacking around the lack of good ways to break circular dependencies (i.e., header files or pre-declarations). Or is it more structural because `integer.p*` imports from `element.p*`?


---

Comment by jdemeyer created at 2017-11-21 08:04:33

Replying to [comment:4 tscrim]:
> Is the only dependency of the `Integer` on the coercion model from the ``@`coerce_binop` of `xgcd`?

Maybe it's not used a lot currently, but I would like to use it more. For example, #24247 requires this because you really want to special-case powering to an integer exponent. So that ticket is the real motivation for this one.


---

Comment by jdemeyer created at 2017-11-21 08:09:37

And note that breaking circular `cimports` is even harder since Cython gives you less control over the order. And you cannot locally do a `cimport` inside a function.


---

Comment by tscrim created at 2017-11-22 05:20:54

Okay, let us add this in. Although if we need to break more circular imports later, we might want to push Cython to treat the `.pxd` files as C header files and make predeclarations accordingly (granted, this is probably a big undertaking).


---

Comment by tscrim created at 2017-11-22 05:20:54

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-12-13 17:38:28

Resolution: fixed
