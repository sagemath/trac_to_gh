# Issue 15147: Improvements to root systems

Issue created by migration from Trac.

Original creator: tscrim

Original creation time: 2013-11-08 20:46:03

Assignee: sage-combinat

CC:  sage-combinat aschilling nthiery darij bsalisbury1 bump

Keywords: root systems

Implement various things for affine root systems and other commonly used operations and things (the `( | )` product for example).


---

Comment by tscrim created at 2013-11-08 20:50:05

New commits:


---

Comment by tscrim created at 2013-11-09 00:12:25

Changing keywords from "root systems" to "root systems, days54".


---

Comment by git created at 2013-11-15 03:45:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2013-11-18 07:27:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-03-04 18:14:28

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2014-03-13 05:21:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-04-15 02:20:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-05-06 21:26:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-05-07 00:30:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-05-07 03:57:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-05-07 04:03:57

Hey Dan,

I've fixed it. The (first `r`) columns are given by `P.simple_roots()`, and it's the inverse matrix should have the Kac labels (which it does).


---

Comment by tscrim created at 2014-05-07 04:03:57

Changing status from new to needs_review.


---

Comment by bump created at 2014-05-08 20:35:18

Glad you got it fixed. I'll start looking at the patch.


---

Comment by nthiery created at 2014-05-08 21:59:28

Travis: do you mind updating the description of the ticket to give an overview of the changes?

Thanks!


---

Comment by bump created at 2014-05-09 20:27:05

The scalar product that was implemented is fundamental in Kac' book and for that alone this is an important patch.

I got one doctest failure in weight_space.py:


```
sage -t weight_space.py
**********************************************************************
File "weight_space.py", line 131, in sage.combinat.root_system.weight_space.WeightSpace
Failed example:
    for ct in CartanType.samples(crystallographic=True)+[CartanType(["A",2],["C",5,1])]:
          TestSuite(ct.root_system().weight_lattice()).run()
          TestSuite(ct.root_system().weight_space()).run()
Expected nothing
Got:
    Failure in _test_not_implemented_methods:
    Traceback (most recent call last):
    [snip]
    AssertionError: Not implemented method: _symmetric_form_matrix
```

In `cartan_type.py` you could delete the sentence on line 108 since you do implement Coxeter numbers!

For the positive roots, imaginary roots, etc. The user might like to know how to get a list of them. For *untwisted* types you can do this.


```
sage: PR=RootSystem(['A',3,1]).root_lattice().positive_real_roots()
sage: [PR.unrank(i) for i in [0..4]]
[alpha[1], alpha[2], alpha[3], alpha[1] + alpha[2], alpha[2] + alpha[3]]
```


Is there a more obvious way? And should something like this be in the doctest?

In the method basic_imaginary_roots the docstring still refers to simple imaginary roots (twice).

It would be good if there were pointers to Kac' book in some places. For example, in symmetric_form, the doc could have a pointer to Chapter 6. The Coxeter number method could have a pointer to Bourbaki, Lie Groups and Lie Algebras V.6.1.


---

Comment by tscrim created at 2014-05-10 02:33:29

I've created #16320 to make it easier to access elements in an infinite list (but I have not merged it in so it's not a dependency). I'm not sure if at the end of the day we want to keep using `DisjointUnionEnumeratedSets` and possibly adding better general support for those or making our own special subclasses and having them be better targeted for the roots here. Nicolas, do you have any thoughts/comments on this?

IMO this can be left for a follow-up ticket unless there is a simple and clear better solution. Although if #16320 is a good way to go, I'll merge that in and update the doctests accordingly.


---

Comment by git created at 2014-05-10 02:33:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bump created at 2014-05-10 15:42:58

Still two doctest failures in `root_lattice_realizations.py`.


```
sage -t root_lattice_realizations.py
**********************************************************************
File "root_lattice_realizations.py", line 634, in sage.combinat.root_system.root_lattice_realizations.RootLatticeRealizations.ParentMethods.positive_real_roots
Failed example:
    PRR = L.positive_real_roots(); PRR
Expected nothing
Got:
    Positive real roots of type ['A', 3, 1]
**********************************************************************
File "root_lattice_realizations.py", line 635, in sage.combinat.root_system.root_lattice_realizations.RootLatticeRealizations.ParentMethods.positive_real_roots
Failed example:
    [PRR.unrank(i) for i in range(10)]
Expected:
    Positive real roots of type ['A', 3, 1]
    [alpha[1],

   -snip-
```



---

Comment by git created at 2014-05-10 15:47:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-05-10 15:49:18

Whoops, forgot to commit.


---

Comment by bump created at 2014-05-10 16:24:51

All tests passed!

The following breaks:

[RootSystem(['A',2,2]).root_lattice().positive_roots().unrank(x) for x in [0..10]]

It works for untwisted types. Is this a limitation of the patch or an unexpected failure?

If it is a limitation of the patch maybe it should be noted in the patch description. Also it
might be better to fail with a not implemented error than with:


```
TypeError: unsupported operand type(s) for //: 'RootSpace_with_category.element_class' and 'int'
```



---

Comment by git created at 2014-05-10 16:56:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-05-10 16:58:00

That was an error. Fixed now.


---

Comment by bump created at 2014-05-10 19:03:36

What about this?


```
sage: RootSystem(['D',4,2]).root_lattice().positive_roots()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-11-ea364fc7aada> in <module>()
----> 1 RootSystem(['D',Integer(4),Integer(2)]).root_lattice().positive_roots()

-snip -

AttributeError: 'NoneType' object has no attribute 'dual'
```


BTW Sage reports this root system as Root lattice of the Root system of type ['C', 3, 1]^*

If I have my facts straight Macdonald introduced a classification of affine root systems in his
paper "Affine root systems and the Dedekind eta function" Inventiones 1972 but
Kac didn't follow Macdonald. He introduced his own classification. So we are
entering root systems in Kac' notation and they are getting converted automatically
to Macdonald's notation. Of course that policy was not introduced by this patch but
I mention that I've personally found it a little confusing.


---

Comment by git created at 2014-05-10 22:43:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-05-10 22:46:27

Another (stupid) error on my part. Fixed.

Also if you want to display in Kac's notation, you can do the following (it's somewhat hidden at the bottom of `CatanType?`):

```
sage: CartanType.global_options(notation='Kac')
sage: CartanType(['D',4,2])
['D', 4, 2]
```



---

Comment by git created at 2014-05-21 00:26:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bump created at 2014-05-23 18:45:33

The following returns an error:


```
sage: sr=RootSystem(['A',6,2]).weight_lattice().simple_roots()
sage: sr[0].symmetric_form(sr[1])
...
TypeError: no conversion of this rational to integer
```


There is no error if we use the root_lattice.


---

Comment by git created at 2014-05-26 02:58:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-05-26 03:06:20

Hey Dan,

I've fixed the issue; the matrix `stack()` command doesn't coerce (well, it's more of I've worked around it and is now #16399). I've added some more doctests about this. I'll merge in the latest beta later tonight.


---

Comment by git created at 2014-05-26 04:07:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bump created at 2014-05-29 02:09:01

Changing status from needs_review to positive_review.


---

Comment by bump created at 2014-05-29 02:09:01

This patch implements some important things from Chapter 6 of Kac' book for both twisted and untwisted affine Lie algebras, as methods of the root_lattice_realization or the weight_lattice_realization. These include a method of enumerating the positive roots (both real and imaginary), the invariant bilinear form, and a few other things. I tested with Kac' book in front of me, and all the problems I found have been addressed.


---

Comment by tscrim created at 2014-05-29 05:47:08

Thank you for doing the review Dan.


---

Comment by vbraun created at 2014-05-29 14:52:53

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2014-05-29 14:52:53

Doctests fail


---

Comment by git created at 2014-05-29 16:48:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-05-29 16:50:10

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2014-05-29 16:50:10

Bad merging on my part; ended up overwriting `simple_roots_tilde()`.


---

Comment by vbraun created at 2014-05-30 11:35:42

Resolution: fixed
