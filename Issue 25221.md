# Issue 25221: Inconsistent printing of algebraic numbers

archive/issues_025221.json:
```json
{
    "body": "CC:  slelievre\n\n\n```\nsage: QQbar(2*I)^(1/2)\n1 + 1*I\nsage: type(_)\n<class 'sage.rings.qqbar.AlgebraicNumber'>\nsage: QQbar(I)+1\nI + 1\nsage: type(_)\n<class 'sage.rings.qqbar.AlgebraicNumber'>\n```\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/25458\n\n",
    "created_at": "2018-05-29T06:02:27Z",
    "labels": [
        "numerical",
        "major",
        "bug"
    ],
    "title": "Inconsistent printing of algebraic numbers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25221",
    "user": "rws"
}
```
CC:  slelievre


```
sage: QQbar(2*I)^(1/2)
1 + 1*I
sage: type(_)
<class 'sage.rings.qqbar.AlgebraicNumber'>
sage: QQbar(I)+1
I + 1
sage: type(_)
<class 'sage.rings.qqbar.AlgebraicNumber'>
```



Issue created by migration from https://trac.sagemath.org/ticket/25458





---

archive/issue_comments_355250.json:
```json
{
    "body": "Notice that:\n\n\n```\nsage: AA.options.display_format = 'radical'\n```\n\n\nrecently introduced (#25210) fixes the problem:\n\n\n```\nsage: QQbar(2*I)^(1/2)\nI + 1\nsage: QQbar(I)+1\nI + 1\n```\n",
    "created_at": "2018-05-29T08:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25221#issuecomment-355250",
    "user": "slabbe"
}
```

Notice that:


```
sage: AA.options.display_format = 'radical'
```


recently introduced (#25210) fixes the problem:


```
sage: QQbar(2*I)^(1/2)
I + 1
sage: QQbar(I)+1
I + 1
```




---

archive/issue_comments_355251.json:
```json
{
    "body": "Replying to [comment:1 slabbe]:\n> Notice that:\n> \n> {{{\n> sage: AA.options.display_format = 'radical'\n> }}}\n> \n> recently introduced (#25210) fixes the problem:\n\nIt is not a fix if you have to set it every time to get a consistent result. The fix would be to make it the default from the start. Until that ticket the output was consistent, so #25210 actually introduced a bug.",
    "created_at": "2018-05-30T07:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25221#issuecomment-355251",
    "user": "rws"
}
```

Replying to [comment:1 slabbe]:
> Notice that:
> 
> {{{
> sage: AA.options.display_format = 'radical'
> }}}
> 
> recently introduced (#25210) fixes the problem:

It is not a fix if you have to set it every time to get a consistent result. The fix would be to make it the default from the start. Until that ticket the output was consistent, so #25210 actually introduced a bug.



---

archive/issue_comments_355252.json:
```json
{
    "body": "Replying to [comment:2 rws]:\n> It is not a fix if you have to set it every time to get a consistent result. \n\nIt was not intended to be a fix, just a side note.\n\n> The fix would be to make it the default from the start.\n\nThis is one possibility. Maybe there is a another possibility that would fix the default display format without using the radical display format.\n\n> Until that ticket the output was consistent, so #25210 actually introduced a bug.\n\nTo my knowledge (I reviewed #25210), the default behavior was not affected by #25210. Moreover, on 8.0 and on [sagecell](http://sagecell.sagemath.org/?q=mlfmio) currently running 8.2, I am able to reproduce the inconsistency. Therefore, it seems on the contrary that the bug was present *before* #25210:\n\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 8.0, Release Date: 2017-07-21                     \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nsage: QQbar(2*I)^(1/2)\n1 + 1*I\nsage: QQbar(I)+1\nI + 1\n```\n",
    "created_at": "2018-05-30T19:01:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25221#issuecomment-355252",
    "user": "slabbe"
}
```

Replying to [comment:2 rws]:
> It is not a fix if you have to set it every time to get a consistent result. 

It was not intended to be a fix, just a side note.

> The fix would be to make it the default from the start.

This is one possibility. Maybe there is a another possibility that would fix the default display format without using the radical display format.

> Until that ticket the output was consistent, so #25210 actually introduced a bug.

To my knowledge (I reviewed #25210), the default behavior was not affected by #25210. Moreover, on 8.0 and on [sagecell](http://sagecell.sagemath.org/?q=mlfmio) currently running 8.2, I am able to reproduce the inconsistency. Therefore, it seems on the contrary that the bug was present *before* #25210:


```
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 8.0, Release Date: 2017-07-21                     │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
sage: QQbar(2*I)^(1/2)
1 + 1*I
sage: QQbar(I)+1
I + 1
```




---

archive/issue_comments_355253.json:
```json
{
    "body": "So do you have any idea to fix the print inconsistency?\n\nMaking\n\n```\nsage: AA.options.display_format = 'radical'\n```\n\nthe default is a solution, but maybe it should be discussed on sage-devel first?",
    "created_at": "2018-07-05T08:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25221#issuecomment-355253",
    "user": "slabbe"
}
```

So do you have any idea to fix the print inconsistency?

Making

```
sage: AA.options.display_format = 'radical'
```

the default is a solution, but maybe it should be discussed on sage-devel first?



---

archive/issue_comments_355254.json:
```json
{
    "body": "The elements print differently depending on how they are represented internally (see `AlgebraicNumber_base._repr_`).\n\n1. This element is represented exactly as an element of `QuadraticField(-1)`:\n   {{{\n   sage: QQbar(1 + I)\n   I + 1\n   }}}\n\n2. This element is represented implicitly as a root of a polynomial, so the `CIF` approximation is used for printing:\n   {{{\n   sage: QQbar(2*I)^(1/2)\n   1 + 1*I\n   }}}\n\n3. If the display format is `radical`, the representation as a radical symbolic expression in `SR` is printed instead:\n   {{{\n   sage: (QQbar(2*I)^(1/2)).radical_expression()\n   I + 1\n   }}}\n   (This is rather inefficient in general, so should not become the default.)\n\nIt is difficult to unify these three cases. It would not be too hard to change the order of real and imaginary part in (1) to appear the same as (2), but then (3) would look different. The radical expressions in `SR` in (3) are not in general written in terms of real and imaginary part, so this cannot easily be changed to look like (2); for example:\n\n```\nsage: QQbar(sqrt(2) + I).radical_expression()\nsqrt(2*I*sqrt(2) + 1)\n```\n\n\nOn the other hand, making (2) look the same as (1) is also not trivial, as it would require special cases if the imaginary part is exactly 1 or -1, and even then, there are more differences between the representations, for example:\n\n```\nsage: QQbar(1 + I) * 2^60\n1152921504606846976*I + 1152921504606846976\nsage: QQbar(2*I)^(1/2) * 2^60\n1.1529215046068470?e18 + 1.1529215046068470?e18*I\n```\n",
    "created_at": "2019-12-21T10:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25221#issuecomment-355254",
    "user": "@mwageringel"
}
```

The elements print differently depending on how they are represented internally (see `AlgebraicNumber_base._repr_`).

1. This element is represented exactly as an element of `QuadraticField(-1)`:
   {{{
   sage: QQbar(1 + I)
   I + 1
   }}}

2. This element is represented implicitly as a root of a polynomial, so the `CIF` approximation is used for printing:
   {{{
   sage: QQbar(2*I)^(1/2)
   1 + 1*I
   }}}

3. If the display format is `radical`, the representation as a radical symbolic expression in `SR` is printed instead:
   {{{
   sage: (QQbar(2*I)^(1/2)).radical_expression()
   I + 1
   }}}
   (This is rather inefficient in general, so should not become the default.)

It is difficult to unify these three cases. It would not be too hard to change the order of real and imaginary part in (1) to appear the same as (2), but then (3) would look different. The radical expressions in `SR` in (3) are not in general written in terms of real and imaginary part, so this cannot easily be changed to look like (2); for example:

```
sage: QQbar(sqrt(2) + I).radical_expression()
sqrt(2*I*sqrt(2) + 1)
```


On the other hand, making (2) look the same as (1) is also not trivial, as it would require special cases if the imaginary part is exactly 1 or -1, and even then, there are more differences between the representations, for example:

```
sage: QQbar(1 + I) * 2^60
1152921504606846976*I + 1152921504606846976
sage: QQbar(2*I)^(1/2) * 2^60
1.1529215046068470?e18 + 1.1529215046068470?e18*I
```




---

archive/issue_comments_355255.json:
```json
{
    "body": "Changing component from numerical to number fields.",
    "created_at": "2020-04-14T10:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25221#issuecomment-355255",
    "user": "slelievre"
}
```

Changing component from numerical to number fields.



---

archive/issue_comments_355256.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25221#issuecomment-355256",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.
