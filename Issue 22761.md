# Issue 22761: Unable to parse hypergeometric result from mathematica_free

Issue created by migration from https://trac.sagemath.org/ticket/22998

Original creator: mforets

Original creation time: 2017-05-14 09:59:48

CC:  rws kcrisman

Keywords: integrate, hypergeometric


```
sage: integrate(e^(-x^2)*log(x), x, algorithm='mathematica_free')
Traceback (most recent call last):
...
ValueError: Unable to parse: -(x*HypergeometricPFQ[{1/2,1/2},{3/2,3/2},-x^2])+(Sqrt[Pi]*Erf[x]*Log[x])/2
```



---

Comment by mforets created at 2017-05-14 10:41:10

the result i was expecting is the sage object:
 

```
result = -(x*hypergeometric((1/2,1/2),(3/2,3/2),-x^2))+(sqrt(pi)*erf(x)*log(x))/2
```



maybe one can substitute the line in `mma_free_integrator`:


```
ans = SR(mexpr.lower().replace('[', '(').replace(']', ')'))
```


with the some of the code at the mathematica interface in `_sage_` ?

(we don't need Mathematica to be installed!)

as you can see, there are two issues with the line above in this example. it transforms: 


```
-(x*HypergeometricPFQ[{1/2,1/2},{3/2,3/2},-x^2])+(Sqrt[Pi]*Erf[x]*Log[x])/2
```


into 


```
'-(x*hypergeometricpfq({1/2,1/2},{3/2,3/2},-x^2))+(sqrt(pi)*erf(x)*log(x))/2'
```


these are (i) curly braces, (ii) the special function is not transformed properly (no use of the conversions dictionary)


---

Comment by mforets created at 2017-05-14 15:10:48

New commits:


---

Comment by mforets created at 2017-05-14 15:10:48

Changing status from new to needs_review.


---

Comment by git created at 2017-05-14 19:14:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-05-14 19:21:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mforets created at 2017-05-14 19:30:42

notice that this change has an (arguably) adverse effect in test at lines 492-495 of `symbolic/integration/integral.py`. 

indeed, instead of 


```
sage: _ = var('x, y, z')
sage: f = sin(x^2) + y^z
sage: f.integrate(x, algorithm="mathematica_free")   # optional - internet
x*y^z + sqrt(1/2)*sqrt(pi)*fresnels(sqrt(2)*x/sqrt(pi))
```


one has:


```
sage: _ = var('x, y, z')
sage: f = sin(x^2) + y^z
sage: f.integrate(x, algorithm="mathematica_free")   # optional - internet
Traceback (most recent call last):
NotImplementedError: Don't know a Sage equivalent for Mathematica function 'FresnelS'.
```


the new issue is because Fresnel integrals are not implemented in Sage (right?) -- in other words, one cannot do much with the former result. 

That said, Sage could return a more verbose message like:


```
"Don't know a Sage equivalent for Mathematica function '%s'.

Unable to parse: %s" % m.group() % mexpr
```



---

Comment by rws created at 2017-05-15 08:25:20

Replying to [comment:5 mforets]:
> the new issue is because Fresnel integrals are not implemented in Sage (right?)

Right. You can see all symbolic function tickets at https://trac.sagemath.org/wiki/symbolics/functions


---

Comment by mforets created at 2017-05-16 05:35:30

thanks for pointing out that page. i've added an entry in [Tickets to make](https://trac.sagemath.org/wiki/symbolics/functions#Ticketstomake) for future reference.


---

Comment by rws created at 2017-05-16 14:46:11

Looks good, and tests in relevant directories pass. Please fill in the Authors field.


---

Comment by rws created at 2017-05-16 14:46:11

Changing status from needs_review to positive_review.


---

Comment by mforets created at 2017-05-16 14:47:05

Thanks :)


---

Comment by mforets created at 2017-05-16 16:48:18

do you want me to update (in a new ticket) the doctest from comment:5? the patchbots, do they test with `optional - internet`?


---

Comment by vbraun created at 2017-05-19 22:13:37

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2017-05-19 22:13:37

merge conflict


---

Comment by rws created at 2017-05-20 05:13:41

Changing status from needs_work to positive_review.


---

Comment by rws created at 2017-05-20 05:13:41

New commits:


---

Comment by vbraun created at 2017-05-21 10:08:27

Resolution: fixed
