# Issue 21845: Automatic variable names for finite fields are not normalized

Issue created by migration from https://trac.sagemath.org/ticket/22082

Original creator: caruso

Original creation time: 2016-12-20 21:27:55

CC:  jpflori erousseau

Keywords: name normalization, finite fields

There is a problem with the normalization of names of variables which are given automatically for finite fields.


```
sage: K = GF(4)
sage: K._factory_data
(<class 'sage.rings.finite_rings.finite_field_constructor.FiniteFieldFactory'>,
 (7, 5, 'beta6'),
 (4, 'z2', x^2 + x + 1, 'givaro', "{'prefix': 'z'}", 2, 2, True), {'prefix': 'z'})
     ^^^^
```


Here the name of the variable(s) is not normalized and should be `('z2',)`. Compare with:


```
sage: L = GF(4, name='z2')
sage: L._factory_data
(<class 'sage.rings.finite_rings.finite_field_constructor.FiniteFieldFactory'>,
 (7, 5, 'beta6'),
 (4, ('z2',), x^2 + x + 1, 'givaro', '{}', 2, 2, True),
 {})
```


By the way, should `K == L`. Currently, it is false.


---

Comment by caruso created at 2016-12-20 21:29:59

Changing type from PLEASE CHANGE to defect.


---

Comment by caruso created at 2016-12-20 21:29:59

New commits:


---

Comment by caruso created at 2016-12-20 21:29:59

Changing status from new to needs_review.


---

Comment by saraedum created at 2016-12-20 21:36:27

I think it's our policy that changes should come with a doctest. I think `K == L` and `K._factory_data` would be nice doctests.


---

Comment by saraedum created at 2016-12-20 21:36:27

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-12-20 21:56:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-12-20 23:36:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pbruin created at 2016-12-21 09:36:31

I have two comments:

1) The following should definitely NOT return True:

```
sage: GF(17^180) == GF(17^180, 'z180')
False
```

The first syntax (which was enabled "on popular request", but is too seductive in my opinion) creates the finite field as a subfield of an algebraic closure, which is expensive because it has to create a system of compatible (pseudo-Conway) polynomials.  Compare the following timings:

```
sage: %time GF(17^180, 'z180')
CPU times: user 64 ms, sys: 8 ms, total: 72 ms
Wall time: 71 ms
Finite Field in a of size 17^180
sage: %time GF(17^180)
CPU times: user 8.62 s, sys: 36 ms, total: 8.66 s
Wall time: 8.66 s
Finite Field in z180 of size 17^180
```


2) The `prefix` parameter was introduced to store the name used for (subfields of) an algebraic closure.  I don't think it should be added to every finite field regardless of whether it is embedded in an algebraic closure.

I propose to limit this ticket to just normalising the variable (with a doctest showing the correct factory data), nothing else.


---

Comment by erousseau created at 2017-06-05 23:22:06

Hello,

Should we go back to commit [82bf26c](https://git.sagemath.org/sage.git/commit?id=82bf26cb4d5f330dc47a03d912cf38a78993e748/) with a doctest testing `._factory_data` then ?

Edouard


---

Comment by saraedum created at 2017-06-06 21:59:37

erousseau, if you have a proposal for a fix, I think that you can just go ahead and push it to this ticket. The old implementation is not lost, so we could always go back if we wanted to.


---

Comment by saraedum created at 2017-06-06 21:59:57

Changing keywords from "name normalization, finite fields" to "name normalization, finite fields, sd86.5".


---

Comment by git created at 2017-06-08 19:57:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2017-06-08 19:59:32

Changing status from needs_work to needs_review.


---

Comment by caruso created at 2017-06-08 19:59:32

Fine, I agree for limiting this ticket to name normalization.


---

Comment by roed created at 2017-06-09 00:35:41

`(7, 5, 'beta6')` should be replaced by `...`.


---

Comment by roed created at 2017-06-09 00:35:41

Changing status from needs_review to needs_work.
