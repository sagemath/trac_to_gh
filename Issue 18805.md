# Issue 18805: Default SAT solver in Sage

archive/issues_018805.json:
```json
{
    "body": "CC:  @malb @videlec tmonteil\n\nThis ticket implements a SAT solver by relying upon the MILP features of Sage.\n\nThis is not glorious, but at least the feature is available by default and we can assume it exists in all cases.\n\nNathann\n\nIssue created by migration from https://trac.sagemath.org/ticket/19042\n\n",
    "created_at": "2015-08-16T18:33:42Z",
    "labels": [
        "component: numerical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Default SAT solver in Sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18805",
    "user": "https://github.com/nathanncohen"
}
```
CC:  @malb @videlec tmonteil

This ticket implements a SAT solver by relying upon the MILP features of Sage.

This is not glorious, but at least the feature is available by default and we can assume it exists in all cases.

Nathann

Issue created by migration from https://trac.sagemath.org/ticket/19042





---

archive/issue_comments_256861.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-08-16T18:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256861",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_256862.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-08-16T18:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256862",
    "user": "https://github.com/nathanncohen"
}
```

New commits:



---

archive/issue_comments_256863.json:
```json
{
    "body": "Since cryptominisat is optional for (much) more than one year, why not make it standard ?",
    "created_at": "2015-08-16T20:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256863",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Since cryptominisat is optional for (much) more than one year, why not make it standard ?



---

archive/issue_comments_256864.json:
```json
{
    "body": "Check the license and if it is compatible write to sage-devel. It may still be useful to have a LP backend to double-check results.",
    "created_at": "2015-08-16T20:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256864",
    "user": "https://github.com/nathanncohen"
}
```

Check the license and if it is compatible write to sage-devel. It may still be useful to have a LP backend to double-check results.



---

archive/issue_comments_256865.json:
```json
{
    "body": "Why call it \"LP\" when it's an ILP?",
    "created_at": "2015-08-26T20:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256865",
    "user": "https://github.com/mkoeppe"
}
```

Why call it "LP" when it's an ILP?



---

archive/issue_comments_256866.json:
```json
{
    "body": "> Why call it \"LP\" when it's an ILP?\n\nI use it as a generic term. LP, MILP, ILP... As long as people understand what it is about ..",
    "created_at": "2015-08-27T06:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256866",
    "user": "https://github.com/nathanncohen"
}
```

> Why call it "LP" when it's an ILP?

I use it as a generic term. LP, MILP, ILP... As long as people understand what it is about ..



---

archive/issue_comments_256867.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-30T12:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256867",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_256868.json:
```json
{
    "body": "Just a comment: why is `src/sage/sat/solvers/sat_lp.pyx` a Cython file? You don't seem to use any Cython features...\n\nI also don't like the `except KeyboardInterrupt`. Why did you add that?",
    "created_at": "2015-09-30T12:55:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256868",
    "user": "https://github.com/jdemeyer"
}
```

Just a comment: why is `src/sage/sat/solvers/sat_lp.pyx` a Cython file? You don't seem to use any Cython features...

I also don't like the `except KeyboardInterrupt`. Why did you add that?



---

archive/issue_comments_256869.json:
```json
{
    "body": "We now have `PackageNotFoundError` (in `src/sage/misc/package.py`) for this:\n\n```\n        except ImportError:\n            raise ImportError(\"To enable this feature, run 'sage -i cryptominisat'.\")\n```\n\n\nI remind you that this is an expensive check: `is_package_installed('cryptominisat')`\nChecking whether the `import` succeeds is a lot more efficient.",
    "created_at": "2015-09-30T12:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256869",
    "user": "https://github.com/jdemeyer"
}
```

We now have `PackageNotFoundError` (in `src/sage/misc/package.py`) for this:

```
        except ImportError:
            raise ImportError("To enable this feature, run 'sage -i cryptominisat'.")
```


I remind you that this is an expensive check: `is_package_installed('cryptominisat')`
Checking whether the `import` succeeds is a lot more efficient.



---

archive/issue_comments_256870.json:
```json
{
    "body": "> Just a comment: why is `src/sage/sat/solvers/sat_lp.pyx` a Cython file? You don't seem to use any Cython features...\n\nProbably because it used to be a copy/paste of the cryptominisat file. I can change it if you prefer.\n\n> I also don't like the `except KeyboardInterrupt`. Why did you add that?\n\nI do not like it either. But the doc of the same function in cryptominisat says that the function returns None when it is interrupted.\n\nNathann",
    "created_at": "2015-09-30T12:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256870",
    "user": "https://github.com/nathanncohen"
}
```

> Just a comment: why is `src/sage/sat/solvers/sat_lp.pyx` a Cython file? You don't seem to use any Cython features...

Probably because it used to be a copy/paste of the cryptominisat file. I can change it if you prefer.

> I also don't like the `except KeyboardInterrupt`. Why did you add that?

I do not like it either. But the doc of the same function in cryptominisat says that the function returns None when it is interrupted.

Nathann



---

archive/issue_comments_256871.json:
```json
{
    "body": "Replying to [comment:10 ncohen]:\n> But the doc of the same function in cryptominisat says that the function returns None when it is interrupted.\n\nI don't believe that doc. From an example based on a doctest:\n\n```\nsage: from sage.sat.solvers import CryptoMiniSat          # optional - cryptominisat\nsage: from sage.sat.converters.polybori import CNFEncoder # optional - cryptominisat\nsage: set_random_seed( 22 )                               # optional - cryptominisat\nsage: sr = mq.SR(1,4,4,4,gf2=True,polybori=True)          # optional - cryptominisat\nsage: F,s = sr.polynomial_system()                        # optional - cryptominisat\nsage: cms = CryptoMiniSat(maxrestarts=10,verbosity=0)     # optional - cryptominisat\nsage: phi = CNFEncoder(cms, F.ring())(F)                  # optional - cryptominisat\nsage: alarm(0.2); cms()\n---------------------------------------------------------------------------\nAlarmInterrupt                            Traceback (most recent call last)\n<ipython-input-8-257eb3253d78> in <module>()\n----> 1 alarm(RealNumber('0.2')); cms()\n\n/usr/local/src/sage-config/src/sage/sat/solvers/cryptominisat/cryptominisat.pyx in sage.sat.solvers.cryptominisat.cryptominisat.CryptoMiniSat.__call__ (build/cythonized/sage/sat/solvers/cryptominisat/cryptominisat.cpp:2211)()\n    299         cdef lbool r\n    300         if assumptions is None:\n--> 301              sig_on()\n    302              r = self._solver.solve()\n    303              sig_off()\n\n/usr/local/src/sage-config/src/sage/ext/interrupt/interrupt.pyx in sage.ext.interrupt.interrupt.sig_raise_exception (build/cythonized/sage/ext/interrupt/interrupt.c:957)()\n     88         raise KeyboardInterrupt\n     89     if sig == SIGALRM:\n---> 90         raise AlarmInterrupt\n     91     if sig == SIGILL:\n     92         if msg == NULL:\n\nAlarmInterrupt: \n```\n",
    "created_at": "2015-09-30T13:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256871",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:10 ncohen]:
> But the doc of the same function in cryptominisat says that the function returns None when it is interrupted.

I don't believe that doc. From an example based on a doctest:

```
sage: from sage.sat.solvers import CryptoMiniSat          # optional - cryptominisat
sage: from sage.sat.converters.polybori import CNFEncoder # optional - cryptominisat
sage: set_random_seed( 22 )                               # optional - cryptominisat
sage: sr = mq.SR(1,4,4,4,gf2=True,polybori=True)          # optional - cryptominisat
sage: F,s = sr.polynomial_system()                        # optional - cryptominisat
sage: cms = CryptoMiniSat(maxrestarts=10,verbosity=0)     # optional - cryptominisat
sage: phi = CNFEncoder(cms, F.ring())(F)                  # optional - cryptominisat
sage: alarm(0.2); cms()
---------------------------------------------------------------------------
AlarmInterrupt                            Traceback (most recent call last)
<ipython-input-8-257eb3253d78> in <module>()
----> 1 alarm(RealNumber('0.2')); cms()

/usr/local/src/sage-config/src/sage/sat/solvers/cryptominisat/cryptominisat.pyx in sage.sat.solvers.cryptominisat.cryptominisat.CryptoMiniSat.__call__ (build/cythonized/sage/sat/solvers/cryptominisat/cryptominisat.cpp:2211)()
    299         cdef lbool r
    300         if assumptions is None:
--> 301              sig_on()
    302              r = self._solver.solve()
    303              sig_off()

/usr/local/src/sage-config/src/sage/ext/interrupt/interrupt.pyx in sage.ext.interrupt.interrupt.sig_raise_exception (build/cythonized/sage/ext/interrupt/interrupt.c:957)()
     88         raise KeyboardInterrupt
     89     if sig == SIGALRM:
---> 90         raise AlarmInterrupt
     91     if sig == SIGILL:
     92         if msg == NULL:

AlarmInterrupt: 
```




---

archive/issue_comments_256872.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-30T13:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256872",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_256873.json:
```json
{
    "body": "Here it is.\n\nNathann",
    "created_at": "2015-09-30T13:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256873",
    "user": "https://github.com/nathanncohen"
}
```

Here it is.

Nathann



---

archive/issue_comments_256874.json:
```json
{
    "body": "I asked #418 about the `KeyboardInterrupt`, in case somebody remembers there.",
    "created_at": "2015-09-30T13:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256874",
    "user": "https://github.com/jdemeyer"
}
```

I asked #418 about the `KeyboardInterrupt`, in case somebody remembers there.



---

archive/issue_comments_256875.json:
```json
{
    "body": "The correct call is\n\n```\nraise PackageNotFoundError(\"cryptominisat\")\n```\n",
    "created_at": "2015-09-30T13:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256875",
    "user": "https://github.com/jdemeyer"
}
```

The correct call is

```
raise PackageNotFoundError("cryptominisat")
```




---

archive/issue_comments_256876.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-09-30T13:31:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256876",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_256877.json:
```json
{
    "body": "Oh. Automatic error message. Cool.",
    "created_at": "2015-09-30T13:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256877",
    "user": "https://github.com/nathanncohen"
}
```

Oh. Automatic error message. Cool.



---

archive/issue_comments_256878.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-30T13:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256878",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_256879.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-09-30T13:32:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256879",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_256880.json:
```json
{
    "body": "In turns out that the word \"interrupt\" has a specific meaning in cryptominisat, which is unrelated to `KeyboardInterrupt`.",
    "created_at": "2015-09-30T13:55:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256880",
    "user": "https://github.com/jdemeyer"
}
```

In turns out that the word "interrupt" has a specific meaning in cryptominisat, which is unrelated to `KeyboardInterrupt`.



---

archive/issue_comments_256881.json:
```json
{
    "body": "Why the `# random`?\n\n```\nsage: solver = SAT() # random\n```\n",
    "created_at": "2015-09-30T20:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256881",
    "user": "https://github.com/jdemeyer"
}
```

Why the `# random`?

```
sage: solver = SAT() # random
```




---

archive/issue_comments_256882.json:
```json
{
    "body": "I would prefer this to be a lazy import:\n\n```\nfrom solvers.satsolver import SAT\n```\n",
    "created_at": "2015-09-30T20:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256882",
    "user": "https://github.com/jdemeyer"
}
```

I would prefer this to be a lazy import:

```
from solvers.satsolver import SAT
```




---

archive/issue_comments_256883.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-30T20:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256883",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_256884.json:
```json
{
    "body": "About random: I wrongly believed that Cryptominisat always printed information when instanciated.",
    "created_at": "2015-09-30T20:23:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256884",
    "user": "https://github.com/nathanncohen"
}
```

About random: I wrongly believed that Cryptominisat always printed information when instanciated.



---

archive/issue_comments_256885.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-10-01T08:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256885",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_256886.json:
```json
{
    "body": "A few more details:\n\n1. It's ugly that your ILP solver returns values as `0.0` and `1.0`. It should be converted to `True`/`False`.\n\n2. `Its performances` -> `Its performance`\n\n3. `cryptominisat_available = True` -> `solver = 'cryptominisat'` and `cryptominisat_available = False` -> `solver = 'LP'`. That's a lot cleaner: you can remove the `solver is None` checks.\n\n4. Please fix the `deicison` typo also in `src/sage/sat/converters/polybori.py`",
    "created_at": "2015-10-01T08:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256886",
    "user": "https://github.com/jdemeyer"
}
```

A few more details:

1. It's ugly that your ILP solver returns values as `0.0` and `1.0`. It should be converted to `True`/`False`.

2. `Its performances` -> `Its performance`

3. `cryptominisat_available = True` -> `solver = 'cryptominisat'` and `cryptominisat_available = False` -> `solver = 'LP'`. That's a lot cleaner: you can remove the `solver is None` checks.

4. Please fix the `deicison` typo also in `src/sage/sat/converters/polybori.py`



---

archive/issue_comments_256887.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-01T09:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256887",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_256888.json:
```json
{
    "body": "> 1. It's ugly that your ILP solver returns values as `0.0` and `1.0`. It should be converted to `True`/`False`.\n\nRight.\n\n> 2. `Its performances` -> `Its performance`\n\nDone.\n\n> 3. `cryptominisat_available = True` -> `solver = 'cryptominisat'` and `cryptominisat_available = False` -> `solver = 'LP'`. That's a lot cleaner: you can remove the `solver is None` checks.\n\nI'm an idiot.\n\n> 4. Please fix the `deicison` typo also in `src/sage/sat/converters/polybori.py`\n\nDone.",
    "created_at": "2015-10-01T09:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256888",
    "user": "https://github.com/nathanncohen"
}
```

> 1. It's ugly that your ILP solver returns values as `0.0` and `1.0`. It should be converted to `True`/`False`.

Right.

> 2. `Its performances` -> `Its performance`

Done.

> 3. `cryptominisat_available = True` -> `solver = 'cryptominisat'` and `cryptominisat_available = False` -> `solver = 'LP'`. That's a lot cleaner: you can remove the `solver is None` checks.

I'm an idiot.

> 4. Please fix the `deicison` typo also in `src/sage/sat/converters/polybori.py`

Done.



---

archive/issue_comments_256889.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-10-01T09:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256889",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_256890.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-01T09:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256890",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_256891.json:
```json
{
    "body": "Thanks !",
    "created_at": "2015-10-01T09:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256891",
    "user": "https://github.com/nathanncohen"
}
```

Thanks !



---

archive/issue_events_052993.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-12T07:16:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18805#event-52993"
}
```



---

archive/issue_comments_256892.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-12T07:16:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18805#issuecomment-256892",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
