# Issue 24883: dot2tex edge coloring is broken

archive/issues_024883.json:
```json
{
    "body": "CC:  @seblabbe @nthiery\n\nKeywords: thursdaysbdx\n\nFrom the documentation\n\n```\nsage: sage.graphs.graph_latex.GraphLatex.set_option?\n...\n    - ``edge_colors`` -- a dictionary whose keys are edges of the\n      graph and whose values are colors. \n...\n```\nThough\n\n```\nsage: G = Graph([(0,1)])\nsage: G.set_latex_options(format='dot2tex', edge_colors = {(0,1): 'red'})\nsage: view(G)\n---------------------------------------------------------------------------\nAssertionError                            Traceback (most recent call last)\n<ipython-input-46-e13ee6ead400> in <module>()\n----> 1 view(G)\n\n/opt/sage/local/lib/python2.7/site-packages/sage/misc/latex.pyc in view(objects, title, debug, sep, tiny, pdflatex, engine, viewer, tightpage, margin, mode, combine_all, **kwds)\n   2201         latex_options = {}\n   2202 \n-> 2203     s = _latex_file_(objects, title=title, sep=sep, tiny=tiny, debug=debug, **latex_options)\n   2204     if engine is None:\n   2205         engine = _Latex_prefs._option[\"engine\"]\n\n/opt/sage/local/lib/python2.7/site-packages/sage/misc/latex.pyc in _latex_file_(objects, title, debug, sep, tiny, math_left, math_right, extra_preamble)\n   1767         for i in range(len(objects)):\n   1768             x = objects[i]\n-> 1769             L = latex(x)\n   1770             if '\\\\begin{pgfpicture}' in L:\n   1771                 # Resize the pgf figure to the text width if larger.\n\n/opt/sage/local/lib/python2.7/site-packages/sage/misc/latex.pyc in __call__(self, x, combine_all)\n    921         \"\"\"\n    922         if has_latex_attr(x):\n--> 923             return LatexExpr(x._latex_())\n    924         try:\n    925             f = latex_table[type(x)]\n\n/opt/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in _latex_(self)\n    768         setup_latex_preamble()\n    769 \n--> 770         return self.latex_options().latex()\n    771 \n    772     def _matrix_(self, R=None):\n\n/opt/sage/local/lib/python2.7/site-packages/sage/graphs/graph_latex.pyc in latex(self)\n   1302             return self.tkz_picture()\n   1303         elif format == \"dot2tex\":\n-> 1304             return self.dot2tex_picture()\n   1305 \n   1306     def dot2tex_picture(self):\n\n/opt/sage/local/lib/python2.7/site-packages/sage/graphs/graph_latex.pyc in dot2tex_picture(self)\n   1356         options = self.__graphlatex_options.copy()\n   1357         options.update(self._options)\n-> 1358         dotdata = self._graph.graphviz_string(labels=\"latex\", **options)\n   1359         import dot2tex\n   1360         return dot2tex.dot2tex(dotdata,\n/opt/sage/local/lib/python2.7/site-packages/sage/misc/decorators.pyc in wrapper(*args, **kwds)\n    562                 options['__original_opts'] = kwds\n    563             options.update(kwds)\n--> 564             return func(*args, **options)\n    565 \n    566         #Add the options specified by @options to the signature of the wrapped\n\n/opt/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in graphviz_string(self, **options)\n  20705                 for edge in options['edge_colors'][color]:\n  20706                     assert isinstance(edge, (list, tuple)) and len(edge) >= 2 and len(edge) <= 3,\\\n> 20707                         \"%s is not a valid format for edge\"%(edge)\n  20708                     u = edge[0]\n  20709                     v = edge[1]\n\nAssertionError: r is not a valid format for edge\n```\n\nThe confusion comes from the fact that the convention for `edge_colors` with `.plot()` is the reverse\n\n```\nsage: G.plot?\n...\n   * \"edge_colors\" - a dictionary specifying edge colors: each key\n     is a color recognized by matplotlib, and each entry is a list of\n     edges.\n...\n```\nSo is the case for `graphviz_string`\n\n```\nsage: G.graphviz_string?\n...\n   * \"edge_colors\" -- (default: None) a dictionary whose keys are\n     colors and values are list of edges. }\n...\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/25120\n\n",
    "closed_at": "2018-05-12T11:46:13Z",
    "created_at": "2018-04-08T18:04:31Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "dot2tex edge coloring is broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24883",
    "user": "https://github.com/videlec"
}
```
CC:  @seblabbe @nthiery

Keywords: thursdaysbdx

From the documentation

```
sage: sage.graphs.graph_latex.GraphLatex.set_option?
...
    - ``edge_colors`` -- a dictionary whose keys are edges of the
      graph and whose values are colors. 
...
```
Though

```
sage: G = Graph([(0,1)])
sage: G.set_latex_options(format='dot2tex', edge_colors = {(0,1): 'red'})
sage: view(G)
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
<ipython-input-46-e13ee6ead400> in <module>()
----> 1 view(G)

/opt/sage/local/lib/python2.7/site-packages/sage/misc/latex.pyc in view(objects, title, debug, sep, tiny, pdflatex, engine, viewer, tightpage, margin, mode, combine_all, **kwds)
   2201         latex_options = {}
   2202 
-> 2203     s = _latex_file_(objects, title=title, sep=sep, tiny=tiny, debug=debug, **latex_options)
   2204     if engine is None:
   2205         engine = _Latex_prefs._option["engine"]

/opt/sage/local/lib/python2.7/site-packages/sage/misc/latex.pyc in _latex_file_(objects, title, debug, sep, tiny, math_left, math_right, extra_preamble)
   1767         for i in range(len(objects)):
   1768             x = objects[i]
-> 1769             L = latex(x)
   1770             if '\\begin{pgfpicture}' in L:
   1771                 # Resize the pgf figure to the text width if larger.

/opt/sage/local/lib/python2.7/site-packages/sage/misc/latex.pyc in __call__(self, x, combine_all)
    921         """
    922         if has_latex_attr(x):
--> 923             return LatexExpr(x._latex_())
    924         try:
    925             f = latex_table[type(x)]

/opt/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in _latex_(self)
    768         setup_latex_preamble()
    769 
--> 770         return self.latex_options().latex()
    771 
    772     def _matrix_(self, R=None):

/opt/sage/local/lib/python2.7/site-packages/sage/graphs/graph_latex.pyc in latex(self)
   1302             return self.tkz_picture()
   1303         elif format == "dot2tex":
-> 1304             return self.dot2tex_picture()
   1305 
   1306     def dot2tex_picture(self):

/opt/sage/local/lib/python2.7/site-packages/sage/graphs/graph_latex.pyc in dot2tex_picture(self)
   1356         options = self.__graphlatex_options.copy()
   1357         options.update(self._options)
-> 1358         dotdata = self._graph.graphviz_string(labels="latex", **options)
   1359         import dot2tex
   1360         return dot2tex.dot2tex(dotdata,
/opt/sage/local/lib/python2.7/site-packages/sage/misc/decorators.pyc in wrapper(*args, **kwds)
    562                 options['__original_opts'] = kwds
    563             options.update(kwds)
--> 564             return func(*args, **options)
    565 
    566         #Add the options specified by @options to the signature of the wrapped

/opt/sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in graphviz_string(self, **options)
  20705                 for edge in options['edge_colors'][color]:
  20706                     assert isinstance(edge, (list, tuple)) and len(edge) >= 2 and len(edge) <= 3,\
> 20707                         "%s is not a valid format for edge"%(edge)
  20708                     u = edge[0]
  20709                     v = edge[1]

AssertionError: r is not a valid format for edge
```

The confusion comes from the fact that the convention for `edge_colors` with `.plot()` is the reverse

```
sage: G.plot?
...
   * "edge_colors" - a dictionary specifying edge colors: each key
     is a color recognized by matplotlib, and each entry is a list of
     edges.
...
```
So is the case for `graphviz_string`

```
sage: G.graphviz_string?
...
   * "edge_colors" -- (default: None) a dictionary whose keys are
     colors and values are list of edges. }
...
```

Issue created by migration from https://trac.sagemath.org/ticket/25120





---

archive/issue_comments_349294.json:
```json
{
    "body": "Any better idea welcome!\n\n---\nNew commits:",
    "created_at": "2018-04-08T18:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24883#issuecomment-349294",
    "user": "https://github.com/videlec"
}
```

Any better idea welcome!

---
New commits:



---

archive/issue_comments_349295.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-08T18:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24883#issuecomment-349295",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_349296.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-04-08T18:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24883#issuecomment-349296",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_349297.json:
```json
{
    "body": "Hi Vincent,\n\nOuch, this clash of option format is annoying indeed. I went through the code and patch, and not sure what's the best way out. Especially since I am pretty sure there is code around using `set_latex_options` with `edge_options` already in the graphviz_string format.\n\nI am available for a phone brainstorm this morning if you are available.",
    "created_at": "2018-04-09T07:27:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24883#issuecomment-349297",
    "user": "https://github.com/nthiery"
}
```

Hi Vincent,

Ouch, this clash of option format is annoying indeed. I went through the code and patch, and not sure what's the best way out. Especially since I am pretty sure there is code around using `set_latex_options` with `edge_options` already in the graphviz_string format.

I am available for a phone brainstorm this morning if you are available.



---

archive/issue_comments_349298.json:
```json
{
    "body": "What if we rather change the documentation of `sage.graphs.graph_latex.GraphLatex.set_option` so that it takes a dict `colors -> list of edges` like the others. Then, this ticket would do some modification of the `tkz_picture` code to revert the dict the other way around?\n\nThis way, the dict `edge_colors` would always have the same form as input.",
    "created_at": "2018-04-09T09:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24883#issuecomment-349298",
    "user": "https://github.com/seblabbe"
}
```

What if we rather change the documentation of `sage.graphs.graph_latex.GraphLatex.set_option` so that it takes a dict `colors -> list of edges` like the others. Then, this ticket would do some modification of the `tkz_picture` code to revert the dict the other way around?

This way, the dict `edge_colors` would always have the same form as input.



---

archive/issue_comments_349299.json:
```json
{
    "body": "This clash of option was there and will remain after the ticket. I will not try to fix it. Would it be possible to review this ticket (which does fix an issue) without discussing the option clash?",
    "created_at": "2018-04-11T15:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24883#issuecomment-349299",
    "user": "https://github.com/videlec"
}
```

This clash of option was there and will remain after the ticket. I will not try to fix it. Would it be possible to review this ticket (which does fix an issue) without discussing the option clash?



---

archive/issue_comments_349300.json:
```json
{
    "body": "Indeed, I realised soon after that my suggestion would have been backward incompatible.\n\nOnce stuff are in Sage we can not change their interface anymore. This is why I am keeping my `TikzPicture` in my personnal package for now, because I am still sometimes changing its interface.\n\nTo make sure all the test are tested in the file, I did:\n\n```\nsage -t --show-skipped --optional=dot2tex,sage,graphviz src/sage/graphs/graph_latex.py\n```\n\nThanks for digging this problem and fixing this issue. I may have stumble over this many years ago. But, once I realized that `color_by_labels=True` was working and I have always been using this way and forgot about the problem you are fixing.",
    "created_at": "2018-04-12T08:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24883#issuecomment-349300",
    "user": "https://github.com/seblabbe"
}
```

Indeed, I realised soon after that my suggestion would have been backward incompatible.

Once stuff are in Sage we can not change their interface anymore. This is why I am keeping my `TikzPicture` in my personnal package for now, because I am still sometimes changing its interface.

To make sure all the test are tested in the file, I did:

```
sage -t --show-skipped --optional=dot2tex,sage,graphviz src/sage/graphs/graph_latex.py
```

Thanks for digging this problem and fixing this issue. I may have stumble over this many years ago. But, once I realized that `color_by_labels=True` was working and I have always been using this way and forgot about the problem you are fixing.



---

archive/issue_comments_349301.json:
```json
{
    "body": "Changing keywords from \"\" to \"thursdaysbdx\".",
    "created_at": "2018-04-12T08:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24883#issuecomment-349301",
    "user": "https://github.com/seblabbe"
}
```

Changing keywords from "" to "thursdaysbdx".



---

archive/issue_comments_349302.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-12T08:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24883#issuecomment-349302",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_063022.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-12T11:46:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24883",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24883#event-63022"
}
```



---

archive/issue_comments_349303.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-12T11:46:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24883#issuecomment-349303",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
