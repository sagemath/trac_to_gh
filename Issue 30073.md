# Issue 30073: Immutability of chart functions

Issue created by migration from https://trac.sagemath.org/ticket/30310

Original creator: @mjungmath

Original creation time: 2020-08-07 12:28:27

CC:  egourgoulhon tscrim mkoeppe




---

Comment by @mjungmath created at 2020-08-07 12:57:38

Changing type from PLEASE CHANGE to enhancement.


---

Comment by @mjungmath created at 2020-08-07 12:57:38

Changing component from PLEASE CHANGE to manifolds.


---

Comment by @mjungmath created at 2020-08-07 12:57:38

New commits:


---

Comment by @mjungmath created at 2020-08-07 12:57:38

Changing keywords from "" to "immutability".


---

Comment by @mjungmath created at 2020-08-07 12:57:38

Changing status from new to needs_review.


---

Comment by egourgoulhon created at 2020-08-07 14:47:12

Why is #30181 a dependency of this ticket? A priori chart functions are totally independent from tensor fields. They even exist on pure topological manifolds.


---

Comment by @mjungmath created at 2020-08-07 15:45:27

It is because of


```diff
-from sage.structure.element import AlgebraElement
+from sage.structure.element import AlgebraElement, ModuleElementWithMutability
...
-class ChartFunction(AlgebraElement):
+class ChartFunction(AlgebraElement, ModuleElementWithMutability):
```



---

Comment by @mjungmath created at 2020-08-07 16:08:59

`ModuleElementWithMutability` is first introduced in #30181.


---

Comment by tscrim created at 2020-08-07 22:41:14

I feel like the `MultiCoordFunction` should inherit from `Mutability` rather than copy the same code.


---

Comment by @mjungmath created at 2020-08-07 22:47:34

It'd be the same issue like we had for affine connections (#30280): `__reduce__` (#30281).


---

Comment by tscrim created at 2020-08-07 22:57:39

I know, but as a stop-gap, you could instead implement a `__reduce__`. I don't really like this duplication. Hopefully this week I can get around to properly doing #30281...


---

Comment by egourgoulhon created at 2020-08-09 12:50:02

Replying to [comment:5 gh-mjungmath]:
> It is because of
> 
> {{{
> #!diff
> -from sage.structure.element import AlgebraElement
> +from sage.structure.element import AlgebraElement, ModuleElementWithMutability
> ...
> -class ChartFunction(AlgebraElement):
> +class ChartFunction(AlgebraElement, ModuleElementWithMutability):
> }}}

Ah yes, thanks.


---

Comment by @mjungmath created at 2021-01-04 17:30:44

I tried to remove the redundant code and inherit from `Mutability` after #30281. For some reason, I still get a pickling error during doctest.

Furthermore, the code seems broken: `is_immutable` does not return anything:


```python
    def is_immutable(self):
        """
        ...
        """
        self._is_immutable
```


When did that happen?


---

Comment by @mjungmath created at 2021-01-04 20:16:05

I opened a ticket for the missing `return`: #31181.

Furthermore, I've opened a ticket for the still remaining pickling test error: #31182.


---

Comment by git created at 2021-01-07 11:27:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-01-21 16:36:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-01-21 16:39:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2021-01-21 20:08:49

Green patchbot.


---

Comment by tscrim created at 2021-01-21 23:03:01

I think you are better off explicitly calling

```
ModuleElementWithMutability.__init__(self, parent)
```



---

Comment by @mjungmath created at 2021-01-21 23:11:32

Yes thanks, this should be better.


---

Comment by @mjungmath created at 2021-01-21 23:12:39

Pushed.


---

Comment by git created at 2021-01-21 23:12:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2021-01-22 00:18:59

Green bot => positive review.


---

Comment by tscrim created at 2021-01-22 03:51:09

Changing status from needs_review to positive_review.


---

Comment by @mjungmath created at 2021-01-22 09:41:56

Thank you.


---

Comment by vbraun created at 2021-03-09 00:02:27

Resolution: fixed
