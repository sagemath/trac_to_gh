# Issue 12588: gfan 0.4plus [p1] fails to build with GCC 4.7.0

Issue created by migration from https://trac.sagemath.org/ticket/12760

Original creator: leif

Original creation time: 2012-03-27 18:03:56

Assignee: leif

CC:  mhampton was mariah

Keywords: spkg C++11

This is due to a trivial programming error.  I already have an spkg fixing this, along with a major clean-up of the spkg.


---

Attachment

Diff between the previous spkg in Sage and my new p2 spkg. For reference / review only.


---

Comment by leif created at 2012-03-27 19:30:33

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2012-03-28 08:37:50

This should be reported upstream.


---

Comment by leif created at 2012-03-28 16:06:08

Replying to [comment:3 jdemeyer]:
> This should be reported upstream.

That's one reason why I cc'ed the spkg maintainers... ;-) 

Note that Gfan 0.4plus is of late 2009; Gfan 0.5 was released more than a year ago.  Haven't checked whether the latter fixes the C++11 issues, but since it introduces new functionality (and probably also new bugs), I haven't tried using that.


---

Comment by mhampton created at 2012-03-28 16:18:37

Putting in Gfan 0.5 has been on my todo list for a long time but I haven't had a chance to concentrate on it.  The whole interface could use a good overhaul.  If no one else beats me to it I hope to tackle that this summer.  The ticket for that is:

[http://trac.sagemath.org/sage_trac/ticket/11395](http://trac.sagemath.org/sage_trac/ticket/11395)


---

Comment by leif created at 2012-04-05 21:34:47

Wuuuuu... Cleaned up a bit too much.

Needs correction w.r.t. exporting `CFLAG64` and especially `CXXFLAG64` (which is used in the patched Makefile), otherwise build fails on ia64 and most probably also 32-bit systems.


---

Comment by leif created at 2012-04-05 23:58:14

Replying to [comment:6 leif]:
> Needs correction w.r.t. exporting `CFLAG64` and especially `CXXFLAG64` (which is used in the patched Makefile), otherwise build fails on ia64 and most probably also 32-bit systems.

Now fixed in a new p3.


---

Comment by leif created at 2012-04-06 00:05:53

Diff between the previous spkg in Sage and my new p3 spkg. For reference / review only.


---

Attachment

Diff between my p2 and my p3 spkg.  For reference / review only.


---

Comment by leif created at 2012-04-08 02:27:15

From my updated `SPKG.txt`:

```
TODO:
 * Use `patch` to apply patches (then also add GNU patch to the dependencies).
 * Clean up `spkg-install` further w.r.t. installation etc.
 * Probably remove `CXXFLAG64` from the (patched) Makefile; instead put it
   into `LDFLAGS` and use these in the Makefile.
 * The Makefile is still suboptimal; e.g. Sage-specific values shouldn't be
   hardcoded into it.  That way we could provide a clean patch for upstream,
   and would later only have to change/set `make` variables in `spkg-install`,
   without the need to patch the Makefile at all for Sage.
   Also `CXXFLAGS` aren't used in, i.e. ignored by the current Makefile.
```


I'll probably fix _some_ of these _here_ *later*<sup>TM</sup> as well, especially item 1, and perhaps also items 3 and 2, but because of #11395, I won't do much more at the moment.


---

Comment by jdemeyer created at 2012-04-26 22:54:07

You should make all files in `src` world-readable:

```
chmod -R ugo+r src
```



---

Comment by leif created at 2012-04-27 00:08:45

Replying to [comment:10 jdemeyer]:
> You should make all files in `src` world-readable:
> {{{
> chmod -R ugo+r src
> }}}

Well, these have been in before (and the respective files were of course user-readable, and they don't get installed anyway).

Anyway, fixed; new spkg, same place.


---

Comment by Snark created at 2012-05-14 14:01:49

I managed to install :
2bb0b5f4cd0081c1af939294ba2e1859  gfan-0.4plus.p3.spkg
on my debian x86_64 box, using gcc 4.7.0.


---

Comment by jdemeyer created at 2012-05-25 21:09:06

Looks good to me.


---

Comment by jdemeyer created at 2012-05-25 21:09:06

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-05-25 21:09:38

Changing keywords from "spkg C++11" to "spkg C++11 sd40.5".


---

Comment by jdemeyer created at 2012-05-31 13:42:12

Resolution: fixed
