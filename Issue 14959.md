# Issue 14959: Use mpmath for numerical evaluation of the beta function

archive/issues_014959.json:
```json
{
    "body": "CC:  burcin paulmasson rws\n\nCurrently,\n\n\n```\nsage: beta(-1.3,-0.4)\nNaN\nsage: (gamma(-1.3) * gamma(-0.4)) / gamma(-1.3 - 0.4) # expected functionality\n-4.92909641669610\n```\n\n\nThis is because GiNaC uses `exp(log_gamma(-1.3)+log_gamma(-0.4)-log_gamma(-1.3-0.4))` to evaluate, and `log_gamma` is broken for some input (see #12521). Using mpmath is faster and avoids roundoff errors as well.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15196\n\n",
    "created_at": "2013-09-14T21:07:05Z",
    "labels": [
        "numerical",
        "major",
        "bug"
    ],
    "title": "Use mpmath for numerical evaluation of the beta function",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14959",
    "user": "eviatarbach"
}
```
CC:  burcin paulmasson rws

Currently,


```
sage: beta(-1.3,-0.4)
NaN
sage: (gamma(-1.3) * gamma(-0.4)) / gamma(-1.3 - 0.4) # expected functionality
-4.92909641669610
```


This is because GiNaC uses `exp(log_gamma(-1.3)+log_gamma(-0.4)-log_gamma(-1.3-0.4))` to evaluate, and `log_gamma` is broken for some input (see #12521). Using mpmath is faster and avoids roundoff errors as well.

Issue created by migration from https://trac.sagemath.org/ticket/15196





---

archive/issue_comments_191069.json:
```json
{
    "body": "Ralf, could you have a look at this issue? I noted in my review of [12521](https://trac.sagemath.org/ticket/12521#comment:34) that even after that fix there are still issues around poles of the beta function.",
    "created_at": "2016-07-10T17:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14959#issuecomment-191069",
    "user": "paulmasson"
}
```

Ralf, could you have a look at this issue? I noted in my review of [12521](https://trac.sagemath.org/ticket/12521#comment:34) that even after that fix there are still issues around poles of the beta function.



---

archive/issue_comments_191070.json:
```json
{
    "body": "I will fix this in Pynac by using arb.",
    "created_at": "2016-07-11T05:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14959#issuecomment-191070",
    "user": "rws"
}
```

I will fix this in Pynac by using arb.



---

archive/issue_comments_191071.json:
```json
{
    "body": "I will add a doctest to the Pynac upgrade ticket, so there is no more to do here.",
    "created_at": "2016-07-11T07:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14959#issuecomment-191071",
    "user": "rws"
}
```

I will add a doctest to the Pynac upgrade ticket, so there is no more to do here.



---

archive/issue_comments_191072.json:
```json
{
    "body": "Adding [link](https://github.com/pynac/pynac/commit/af4f16d41c0433d6223ea46baa63cf74f36024f2) to Pynac commit for future reference.\n\nWhat is arb?",
    "created_at": "2016-07-11T20:33:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14959#issuecomment-191072",
    "user": "paulmasson"
}
```

Adding [link](https://github.com/pynac/pynac/commit/af4f16d41c0433d6223ea46baa63cf74f36024f2) to Pynac commit for future reference.

What is arb?



---

archive/issue_comments_191073.json:
```json
{
    "body": "Replying to [comment:8 paulmasson]:\n> What is arb?\n\nhttp://doc.sagemath.org/html/en/reference/rings_numerical/sage/rings/real_arb.html\nhttp://doc.sagemath.org/html/en/reference/rings_numerical/sage/rings/complex_arb.html",
    "created_at": "2016-07-12T07:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14959#issuecomment-191073",
    "user": "rws"
}
```

Replying to [comment:8 paulmasson]:
> What is arb?

http://doc.sagemath.org/html/en/reference/rings_numerical/sage/rings/real_arb.html
http://doc.sagemath.org/html/en/reference/rings_numerical/sage/rings/complex_arb.html



---

archive/issue_comments_191074.json:
```json
{
    "body": "Waiting for pynac 0.6.8",
    "created_at": "2016-07-17T02:01:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14959#issuecomment-191074",
    "user": "paulmasson"
}
```

Waiting for pynac 0.6.8



---

archive/issue_comments_191075.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2016-07-17T02:01:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14959#issuecomment-191075",
    "user": "paulmasson"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_191076.json:
```json
{
    "body": "Replying to [comment:10 paulmasson]:\n> Waiting for pynac 0.6.8\n\nYes Yes 8-)) I was at it all the time but had to rewrite things.",
    "created_at": "2016-07-17T06:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14959#issuecomment-191076",
    "user": "rws"
}
```

Replying to [comment:10 paulmasson]:
> Waiting for pynac 0.6.8

Yes Yes 8-)) I was at it all the time but had to rewrite things.



---

archive/issue_comments_191077.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2016-07-17T06:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14959#issuecomment-191077",
    "user": "rws"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_191078.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-07-27T21:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14959#issuecomment-191078",
    "user": "paulmasson"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_191079.json:
```json
{
    "body": "Fixed in #21034",
    "created_at": "2016-07-27T21:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14959#issuecomment-191079",
    "user": "paulmasson"
}
```

Fixed in #21034



---

archive/issue_comments_191080.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2016-08-14T19:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14959#issuecomment-191080",
    "user": "vbraun"
}
```

Resolution: duplicate
