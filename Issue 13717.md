# Issue 13717: Make the GP executable work with SAGE_DEBUG on Darwin

archive/issues_013717.json:
```json
{
    "body": "Assignee: @williamstein\n\nCC:  @jdemeyer\n\nKeywords: pari gp debug\n\nOn bsd.math (hence, Darwin), there is a problem with the GP executable when building Sage (or: only the pari/gp spkg) with SAGE_DEBUG=yes.\n\nAs Jeroen found, a crash occurs as follows:\n\n```\n$ ./sage --gp\n? factor(-70665476079756004438844153774)\n```\n\nWith gdb, one then gets\n\n```\nProgram received signal EXC_BAD_ACCESS, Could not access memory.\nReason: 13 at address: 0x0000000000000000\n0x00007fff8a66cfc1 in dyld_stub_binder ()\n(gdb) bt\n#0  0x00007fff8a66cfc1 in dyld_stub_binder ()\n#1  0x000000010040e398 in  stub helpers ()\n```\n\nA smaller testcase is `? factor(10356613*10694706299664611221)`\n\nAccording to Jeroen, the problem vanishes with Apple's gcc.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13921\n\n",
    "created_at": "2013-01-07T10:35:25Z",
    "labels": [
        "component: number theory",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.6",
    "title": "Make the GP executable work with SAGE_DEBUG on Darwin",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13717",
    "user": "https://github.com/simon-king-jena"
}
```
Assignee: @williamstein

CC:  @jdemeyer

Keywords: pari gp debug

On bsd.math (hence, Darwin), there is a problem with the GP executable when building Sage (or: only the pari/gp spkg) with SAGE_DEBUG=yes.

As Jeroen found, a crash occurs as follows:

```
$ ./sage --gp
? factor(-70665476079756004438844153774)
```

With gdb, one then gets

```
Program received signal EXC_BAD_ACCESS, Could not access memory.
Reason: 13 at address: 0x0000000000000000
0x00007fff8a66cfc1 in dyld_stub_binder ()
(gdb) bt
#0  0x00007fff8a66cfc1 in dyld_stub_binder ()
#1  0x000000010040e398 in  stub helpers ()
```

A smaller testcase is `? factor(10356613*10694706299664611221)`

According to Jeroen, the problem vanishes with Apple's gcc.

Issue created by migration from https://trac.sagemath.org/ticket/13921





---

archive/issue_comments_169953.json:
```json
{
    "body": "It seems to be an upstream bug, either in pari/gp or in gcc. But who is upstream? How to contact them?",
    "created_at": "2013-01-07T10:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13717#issuecomment-169953",
    "user": "https://github.com/simon-king-jena"
}
```

It seems to be an upstream bug, either in pari/gp or in gcc. But who is upstream? How to contact them?



---

archive/issue_comments_169954.json:
```json
{
    "body": "I am building GCC-4.7.2 to see whether that solves the problem.",
    "created_at": "2013-01-07T10:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13717#issuecomment-169954",
    "user": "https://github.com/jdemeyer"
}
```

I am building GCC-4.7.2 to see whether that solves the problem.



---

archive/issue_comments_169955.json:
```json
{
    "body": "Thank you, Jeroen!",
    "created_at": "2013-01-07T10:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13717#issuecomment-169955",
    "user": "https://github.com/simon-king-jena"
}
```

Thank you, Jeroen!



---

archive/issue_comments_169956.json:
```json
{
    "body": "Same problem with GCC-4.7.2.",
    "created_at": "2013-01-07T12:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13717#issuecomment-169956",
    "user": "https://github.com/jdemeyer"
}
```

Same problem with GCC-4.7.2.



---

archive/issue_comments_169957.json:
```json
{
    "body": "The offending file in `mp.c`. Another workaround is to compile that file always with `-O1`.",
    "created_at": "2013-01-07T14:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13717#issuecomment-169957",
    "user": "https://github.com/jdemeyer"
}
```

The offending file in `mp.c`. Another workaround is to compile that file always with `-O1`.



---

archive/issue_comments_169958.json:
```json
{
    "body": "Attachment [pari-2.5.3.p2.diff](tarball://root/attachments/some-uuid/ticket13921/pari-2.5.3.p2.diff) by @jdemeyer created at 2013-01-07 15:30:30\n\nDiff for the PARI spkg, for review only",
    "created_at": "2013-01-07T15:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13717#issuecomment-169958",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [pari-2.5.3.p2.diff](tarball://root/attachments/some-uuid/ticket13921/pari-2.5.3.p2.diff) by @jdemeyer created at 2013-01-07 15:30:30

Diff for the PARI spkg, for review only



---

archive/issue_comments_169959.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-01-07T15:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13717#issuecomment-169959",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_169960.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2013-01-08T13:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13717#issuecomment-169960",
    "user": "https://github.com/vbraun"
}
```

Looks good to me.



---

archive/issue_comments_169961.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-08T13:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13717#issuecomment-169961",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_169962.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-01-12T08:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13717#issuecomment-169962",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_039091.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-12T08:53:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13717",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13717#event-39091"
}
```
