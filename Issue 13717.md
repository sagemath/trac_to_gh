# Issue 13717: Make the GP executable work with SAGE_DEBUG on Darwin

Issue created by migration from https://trac.sagemath.org/ticket/13921

Original creator: SimonKing

Original creation time: 2013-01-07 10:35:25

Assignee: was

CC:  jdemeyer

Keywords: pari gp debug

On bsd.math (hence, Darwin), there is a problem with the GP executable when building Sage (or: only the pari/gp spkg) with SAGE_DEBUG=yes.

As Jeroen found, a crash occurs as follows:

```
$ ./sage --gp
? factor(-70665476079756004438844153774)
```

With gdb, one then gets

```
Program received signal EXC_BAD_ACCESS, Could not access memory.
Reason: 13 at address: 0x0000000000000000
0x00007fff8a66cfc1 in dyld_stub_binder ()
(gdb) bt
#0  0x00007fff8a66cfc1 in dyld_stub_binder ()
#1  0x000000010040e398 in  stub helpers ()
```

A smaller testcase is `? factor(10356613*10694706299664611221)`

According to Jeroen, the problem vanishes with Apple's gcc.


---

Comment by SimonKing created at 2013-01-07 10:36:09

It seems to be an upstream bug, either in pari/gp or in gcc. But who is upstream? How to contact them?


---

Comment by jdemeyer created at 2013-01-07 10:41:26

I am building GCC-4.7.2 to see whether that solves the problem.


---

Comment by SimonKing created at 2013-01-07 10:42:56

Thank you, Jeroen!


---

Comment by jdemeyer created at 2013-01-07 12:38:11

Same problem with GCC-4.7.2.


---

Comment by jdemeyer created at 2013-01-07 14:48:06

The offending file in `mp.c`. Another workaround is to compile that file always with `-O1`.


---

Attachment

Diff for the PARI spkg, for review only


---

Comment by jdemeyer created at 2013-01-07 15:30:39

Changing status from new to needs_review.


---

Comment by vbraun created at 2013-01-08 13:32:04

Looks good to me.


---

Comment by vbraun created at 2013-01-08 13:32:04

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-01-12 08:53:27

Resolution: fixed
