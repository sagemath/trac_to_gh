# Issue 30814: change AC_MSG_ERROR to AC_MSG_ERROR in the configuration of gp2c

archive/issues_030814.json:
```json
{
    "body": "CC:  @dimpase @slel @orlitzky\n\nWithout this change, I can not run `./bootstrap` on fedora 32, and so I can not compile\n\nIssue created by migration from https://trac.sagemath.org/ticket/31051\n\n",
    "created_at": "2020-12-15T15:09:52Z",
    "labels": [
        "component: packages: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "change AC_MSG_ERROR to AC_MSG_ERROR in the configuration of gp2c",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30814",
    "user": "https://github.com/dcoudert"
}
```
CC:  @dimpase @slel @orlitzky

Without this change, I can not run `./bootstrap` on fedora 32, and so I can not compile

Issue created by migration from https://trac.sagemath.org/ticket/31051





---

archive/issue_comments_439960.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-12-15T15:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439960",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_439961.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-12-15T15:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439961",
    "user": "https://github.com/dcoudert"
}
```

New commits:



---

archive/issue_comments_439962.json:
```json
{
    "body": "Changing keywords from \"\" to \"gp2c\".",
    "created_at": "2020-12-15T15:39:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439962",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "gp2c".



---

archive/issue_comments_439963.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-12-15T19:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439963",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_439964.json:
```json
{
    "body": "OK",
    "created_at": "2020-12-15T19:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439964",
    "user": "https://github.com/dimpase"
}
```

OK



---

archive/issue_comments_439965.json:
```json
{
    "body": "Do I get it right that the compilation goes through with the change on Fedora 32, right?",
    "created_at": "2020-12-15T19:57:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439965",
    "user": "https://github.com/dimpase"
}
```

Do I get it right that the compilation goes through with the change on Fedora 32, right?



---

archive/issue_comments_439966.json:
```json
{
    "body": "Yes, I was able to compile with this change (plus the use of upstream url for libsemigroups).",
    "created_at": "2020-12-15T20:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439966",
    "user": "https://github.com/dcoudert"
}
```

Yes, I was able to compile with this change (plus the use of upstream url for libsemigroups).



---

archive/issue_comments_439967.json:
```json
{
    "body": "I don't think this is the correct fix. When `gp2c` is enabled to be installed, then this should be a hard error",
    "created_at": "2020-12-15T21:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439967",
    "user": "https://github.com/mkoeppe"
}
```

I don't think this is the correct fix. When `gp2c` is enabled to be installed, then this should be a hard error



---

archive/issue_comments_439968.json:
```json
{
    "body": "Replying to [comment:7 mkoeppe]:\n> I don't think this is the correct fix. When `gp2c` is enabled to be installed, then this should be a hard error\n\nTrue, and building gp2c should also fail since we don't know where pari.cfg is. Like the comment says, \"If we can't find pari.cfg, gp2c isn't going to work.\"\n\nWhat was the original `./configure` command, and what did it output? What does it output after the message was changed to a warning? Something is fishy.",
    "created_at": "2020-12-15T22:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439968",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:7 mkoeppe]:
> I don't think this is the correct fix. When `gp2c` is enabled to be installed, then this should be a hard error

True, and building gp2c should also fail since we don't know where pari.cfg is. Like the comment says, "If we can't find pari.cfg, gp2c isn't going to work."

What was the original `./configure` command, and what did it output? What does it output after the message was changed to a warning? Something is fishy.



---

archive/issue_comments_439969.json:
```json
{
    "body": "I tried to upgrade from 9.3.beta3. After `git pull` on develop branch, I tried `make build` and it fails during configuration. the config.log can be found in the message https://groups.google.com/g/sage-release/c/dmqD6CIRUVo/m/9oCozIMkAwAJ.\nand in this message https://groups.google.com/g/sage-release/c/dmqD6CIRUVo/m/CM7JJqJNAwAJ you can find the config.log with this modification.\n\nI agree that this might be a symptom of another issue.",
    "created_at": "2020-12-15T23:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439969",
    "user": "https://github.com/dcoudert"
}
```

I tried to upgrade from 9.3.beta3. After `git pull` on develop branch, I tried `make build` and it fails during configuration. the config.log can be found in the message https://groups.google.com/g/sage-release/c/dmqD6CIRUVo/m/9oCozIMkAwAJ.
and in this message https://groups.google.com/g/sage-release/c/dmqD6CIRUVo/m/CM7JJqJNAwAJ you can find the config.log with this modification.

I agree that this might be a symptom of another issue.



---

archive/issue_comments_439970.json:
```json
{
    "body": "Ok, there are two things weird:\n\n1. Why is it trying to install the (optional) gp2c package when you haven't enabled it with `--enable-gp2c`?\n2. Why can't it find your system `pari.cfg`?\n\nThe real problem is the first item... but, I'm curious. Your config log shows...\n\n\n```\nconfigure:17361: checking for gp\nconfigure:17379: found /bin/gp\n```\n\n\nIs that really where `gp` lives, or is it a symlink to `/usr/bin/gp`? Perhaps `/bin` is a symlink to `/usr/bin`? We use that path when guessing the location of `pari.cfg`, so having it return `/bin/gp` instead of `/usr/bin/gp` would throw a wrench into things. It's an easy fix however.\n\n(But regardless, you haven't enabled gp2c at all, so you shouldn't be hitting this problem.)",
    "created_at": "2020-12-16T00:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439970",
    "user": "https://github.com/orlitzky"
}
```

Ok, there are two things weird:

1. Why is it trying to install the (optional) gp2c package when you haven't enabled it with `--enable-gp2c`?
2. Why can't it find your system `pari.cfg`?

The real problem is the first item... but, I'm curious. Your config log shows...


```
configure:17361: checking for gp
configure:17379: found /bin/gp
```


Is that really where `gp` lives, or is it a symlink to `/usr/bin/gp`? Perhaps `/bin` is a symlink to `/usr/bin`? We use that path when guessing the location of `pari.cfg`, so having it return `/bin/gp` instead of `/usr/bin/gp` would throw a wrench into things. It's an easy fix however.

(But regardless, you haven't enabled gp2c at all, so you shouldn't be hitting this problem.)



---

archive/issue_comments_439971.json:
```json
{
    "body": "You get it right, `/bin` is a symlink\n\n```\ngelati:/home/dcoudert>ls -ll /bin \nlrwxrwxrwx. 1 root root 7 Jan 28  2020 /bin -> usr/bin\ngelati:/home/dcoudert> ls -l /usr/bin/gp*  \nlrwxrwxrwx  1 root root       7 Nov 12 23:19 /usr/bin/gp -> gp-2.11\n-rwxr-xr-x  1 root root  132936 Nov 12 23:19 /usr/bin/gp-2.11\n...\n```\n\n\nI haven't enabled `gp2c`. May be it's a dependency of another package ? I haven't check that. I have (ok, it's certainly not the best way to get the list): \n\n```\ngelati:/home/dcoudert/sage> ./sage -t src/sage/graphs/print_graphs.py \ntoo few successful tests, not using stored timings\nRunning doctests with ID 2020-12-16-01-44-24-894c14a1.\nGit branch: develop\nUsing --optional=benzene,bliss,buckygen,build,cryptominisat,csdp,dochtml,dot2tex,fedora,gap_packages,glucose,libsemigroups,mcqd,memlimit,pip,plantri,python_igraph,rubiks,sage,sage_numerical_backends_cplex,sage_spkg,tdlib,texttable\nDoctesting 1 file.\nsage -t --random-seed=0 src/sage/graphs/print_graphs.py\n    [12 tests, 0.02 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 0.0 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\n```\n",
    "created_at": "2020-12-16T00:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439971",
    "user": "https://github.com/dcoudert"
}
```

You get it right, `/bin` is a symlink

```
gelati:/home/dcoudert>ls -ll /bin 
lrwxrwxrwx. 1 root root 7 Jan 28  2020 /bin -> usr/bin
gelati:/home/dcoudert> ls -l /usr/bin/gp*  
lrwxrwxrwx  1 root root       7 Nov 12 23:19 /usr/bin/gp -> gp-2.11
-rwxr-xr-x  1 root root  132936 Nov 12 23:19 /usr/bin/gp-2.11
...
```


I haven't enabled `gp2c`. May be it's a dependency of another package ? I haven't check that. I have (ok, it's certainly not the best way to get the list): 

```
gelati:/home/dcoudert/sage> ./sage -t src/sage/graphs/print_graphs.py 
too few successful tests, not using stored timings
Running doctests with ID 2020-12-16-01-44-24-894c14a1.
Git branch: develop
Using --optional=benzene,bliss,buckygen,build,cryptominisat,csdp,dochtml,dot2tex,fedora,gap_packages,glucose,libsemigroups,mcqd,memlimit,pip,plantri,python_igraph,rubiks,sage,sage_numerical_backends_cplex,sage_spkg,tdlib,texttable
Doctesting 1 file.
sage -t --random-seed=0 src/sage/graphs/print_graphs.py
    [12 tests, 0.02 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.0 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
```




---

archive/issue_comments_439972.json:
```json
{
    "body": "This should fix the second problem, and allow `--enable-gp2c` to work on systems where `/bin` is a symlink to `/usr/bin`. I still have no idea about the larger issue, though.\n----\nNew commits:",
    "created_at": "2020-12-16T01:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439972",
    "user": "https://github.com/orlitzky"
}
```

This should fix the second problem, and allow `--enable-gp2c` to work on systems where `/bin` is a symlink to `/usr/bin`. I still have no idea about the larger issue, though.
----
New commits:



---

archive/issue_comments_439973.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-12-16T01:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439973",
    "user": "https://github.com/orlitzky"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_439974.json:
```json
{
    "body": "Replying to [comment:11 dcoudert]:\n> I haven't enabled `gp2c`. May be it's a dependency of another package ?\n\nFor all packages, including non-enabled optional packages, the presence of system packages is checked. Wishlist tickets #29372, #29498 propose to change this.",
    "created_at": "2020-12-16T01:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439974",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:11 dcoudert]:
> I haven't enabled `gp2c`. May be it's a dependency of another package ?

For all packages, including non-enabled optional packages, the presence of system packages is checked. Wishlist tickets #29372, #29498 propose to change this.



---

archive/issue_comments_439975.json:
```json
{
    "body": "Replying to [comment:13 mkoeppe]:\n> For all packages, including non-enabled optional packages, the presence of system packages is checked. Wishlist tickets #29372, #29498 propose to change this.\n\nThis failure is within an `AS_IF([test \"x$sage_spkg_install_gp2c\" = \"xyes\"]...` block. Should that be passing when gp2c is not enabled?",
    "created_at": "2020-12-16T01:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439975",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:13 mkoeppe]:
> For all packages, including non-enabled optional packages, the presence of system packages is checked. Wishlist tickets #29372, #29498 propose to change this.

This failure is within an `AS_IF([test "x$sage_spkg_install_gp2c" = "xyes"]...` block. Should that be passing when gp2c is not enabled?



---

archive/issue_comments_439976.json:
```json
{
    "body": "It's working for me on that desktop. Thanks!\n\nI let you decide if we can set back to positive review and how to change authors/reviewers.",
    "created_at": "2020-12-16T09:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439976",
    "user": "https://github.com/dcoudert"
}
```

It's working for me on that desktop. Thanks!

I let you decide if we can set back to positive review and how to change authors/reviewers.



---

archive/issue_comments_439977.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-12-16T12:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439977",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_439978.json:
```json
{
    "body": "Looks good to me. Please add the names :-)\n\nLet me also point out that the fact that my fix worked too is an indication that there could be  a better way to discover `pari.cfg` than the one currently implemented in spkg-configure of gp2c.",
    "created_at": "2020-12-16T12:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439978",
    "user": "https://github.com/dimpase"
}
```

Looks good to me. Please add the names :-)

Let me also point out that the fact that my fix worked too is an indication that there could be  a better way to discover `pari.cfg` than the one currently implemented in spkg-configure of gp2c.



---

archive/issue_comments_439979.json:
```json
{
    "body": "I would still very much prefer that we not do these checks at all when gp2c is disabled, but if everyone's content to do that in some other ticket, this is still an improvement.\n\nUltimately, pari itself should tell us where pari.cfg is installed, via either pkg-config or something like `gp --pari-cfg`. Nobody thinks enumerating all possible locations is a good way to do it, but the build would eventually fail if gp2c was enabled and if we allowed the check to proceed with a warning. The previous way of running `find` on all of `/usr` and then waiting five minutes was even worse.",
    "created_at": "2020-12-16T14:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439979",
    "user": "https://github.com/orlitzky"
}
```

I would still very much prefer that we not do these checks at all when gp2c is disabled, but if everyone's content to do that in some other ticket, this is still an improvement.

Ultimately, pari itself should tell us where pari.cfg is installed, via either pkg-config or something like `gp --pari-cfg`. Nobody thinks enumerating all possible locations is a good way to do it, but the build would eventually fail if gp2c was enabled and if we allowed the check to proceed with a warning. The previous way of running `find` on all of `/usr` and then waiting five minutes was even worse.



---

archive/issue_comments_439980.json:
```json
{
    "body": "pari.cfg file can be found in the PARI object directory and is installed in $prefix/lib/pari/.\n\nthis is in gp2c docs of the Par project:\nhttps://pari.math.u-bordeaux.fr/pub/pari/manuals/gp2c/gp2c.html\n\nFedora is wrong about the location it installs pari.cfg to",
    "created_at": "2020-12-19T11:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439980",
    "user": "https://github.com/dimpase"
}
```

pari.cfg file can be found in the PARI object directory and is installed in $prefix/lib/pari/.

this is in gp2c docs of the Par project:
https://pari.math.u-bordeaux.fr/pub/pari/manuals/gp2c/gp2c.html

Fedora is wrong about the location it installs pari.cfg to



---

archive/issue_comments_439981.json:
```json
{
    "body": "And those docs are wrong =)\n\npari.cfg is installed to `$(sysdatadir)`, which defaults to (but is not guaranteed to be) `$prefix/lib/pari`",
    "created_at": "2020-12-19T15:06:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439981",
    "user": "https://github.com/orlitzky"
}
```

And those docs are wrong =)

pari.cfg is installed to `$(sysdatadir)`, which defaults to (but is not guaranteed to be) `$prefix/lib/pari`



---

archive/issue_events_081088.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-27T00:23:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30814#event-81088"
}
```



---

archive/issue_comments_439982.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-12-27T00:23:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30814#issuecomment-439982",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
