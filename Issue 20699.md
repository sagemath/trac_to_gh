# Issue 20699: Adding conversion for Divide and Product class in Sage/M2 interface

archive/issues_020699.json:
```json
{
    "body": "Keywords: Macaulay2, interface\n\nThis adds the method sage_prodstring(), which is similar to sage_polystring, except that it is for properly converting the macaulay2 Product object to a string following python's math programming conventions, so that I could add conversion of Product objects from M2 in the to_sage() function\n\nThere were also additions to the to_sage() function. I added an elif statement for converting Product objects, and an elif for converting Divide objects from M2 to Sage. Both of their outputs are as strings. \n\nIssue created by migration from https://trac.sagemath.org/ticket/20936\n\n",
    "created_at": "2016-07-04T17:26:16Z",
    "labels": [
        "interfaces",
        "major",
        "enhancement"
    ],
    "title": "Adding conversion for Divide and Product class in Sage/M2 interface",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20699",
    "user": "zonova"
}
```
Keywords: Macaulay2, interface

This adds the method sage_prodstring(), which is similar to sage_polystring, except that it is for properly converting the macaulay2 Product object to a string following python's math programming conventions, so that I could add conversion of Product objects from M2 in the to_sage() function

There were also additions to the to_sage() function. I added an elif statement for converting Product objects, and an elif for converting Divide objects from M2 to Sage. Both of their outputs are as strings. 

Issue created by migration from https://trac.sagemath.org/ticket/20936





---

archive/issue_comments_286023.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-07-04T17:31:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286023",
    "user": "zonova"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_286024.json:
```json
{
    "body": "Attachment",
    "created_at": "2016-07-04T17:31:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286024",
    "user": "zonova"
}
```

Attachment



---

archive/issue_comments_286025.json:
```json
{
    "body": "I think you should create a proper git branch, based on the current beta, rather than this.",
    "created_at": "2016-07-04T22:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286025",
    "user": "dimpase"
}
```

I think you should create a proper git branch, based on the current beta, rather than this.



---

archive/issue_comments_286026.json:
```json
{
    "body": "Does that work? \n----\nNew commits:",
    "created_at": "2016-07-06T19:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286026",
    "user": "zonova"
}
```

Does that work? 
----
New commits:



---

archive/issue_comments_286027.json:
```json
{
    "body": "Why do you **remove** `from __future__ import print_function` and revert Python3-compatible `print` statements back to old form? Did you work with an old file?\nYou should merge your work with the current beta.",
    "created_at": "2016-07-06T20:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286027",
    "user": "dimpase"
}
```

Why do you **remove** `from __future__ import print_function` and revert Python3-compatible `print` statements back to old form? Did you work with an old file?
You should merge your work with the current beta.



---

archive/issue_comments_286028.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-07-07T01:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286028",
    "user": "zonova"
}
```

New commits:



---

archive/issue_comments_286029.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-07T02:18:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286029",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286030.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-07T02:22:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286030",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286031.json:
```json
{
    "body": "After a bunch of git based atrocities(my own lack of experience), I think I finally fixed it. Does it look okay? Do I need to add more comments anywhere? I didn't know if I had to include my name with the edit in the comments. Thanks for the patience.",
    "created_at": "2016-07-07T02:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286031",
    "user": "zonova"
}
```

After a bunch of git based atrocities(my own lack of experience), I think I finally fixed it. Does it look okay? Do I need to add more comments anywhere? I didn't know if I had to include my name with the edit in the comments. Thanks for the patience.



---

archive/issue_comments_286032.json:
```json
{
    "body": "You should test your changes using Sage's doctesting framework. (`sage -t`). With your branch I get\n\n```\nsage -t src/sage/interfaces/macaulay2.py\n    Error: TAB character found at lines 840,856,857,858,1190\n    [28 tests, 0.04 s]\n----------------------------------------------------------------------\nsage -t src/sage/interfaces/macaulay2.py  # Tab character found\n```\n\nDo not use tabs, only use spaces for formatting (it should be easy to tell your editor to map tab key to 4 spaces).",
    "created_at": "2016-07-07T13:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286032",
    "user": "dimpase"
}
```

You should test your changes using Sage's doctesting framework. (`sage -t`). With your branch I get

```
sage -t src/sage/interfaces/macaulay2.py
    Error: TAB character found at lines 840,856,857,858,1190
    [28 tests, 0.04 s]
----------------------------------------------------------------------
sage -t src/sage/interfaces/macaulay2.py  # Tab character found
```

Do not use tabs, only use spaces for formatting (it should be easy to tell your editor to map tab key to 4 spaces).



---

archive/issue_comments_286033.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-07-07T13:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286033",
    "user": "dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_286034.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-09T19:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286034",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_286035.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-07-10T23:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286035",
    "user": "zonova"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_286036.json:
```json
{
    "body": "How does it look?",
    "created_at": "2016-07-15T03:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286036",
    "user": "zonova"
}
```

How does it look?



---

archive/issue_comments_286037.json:
```json
{
    "body": "It seems you have broken some working parts, e.g.:\n\n```\nsage: macaulay2('5/4').to_sage()\n5/4\nsage: type(macaulay2('5/4').to_sage())\n<type 'sage.rings.rational.Rational'>\n```\n\nmakes perfect sense, while your patch makes this result a string.",
    "created_at": "2016-07-20T08:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286037",
    "user": "dimpase"
}
```

It seems you have broken some working parts, e.g.:

```
sage: macaulay2('5/4').to_sage()
5/4
sage: type(macaulay2('5/4').to_sage())
<type 'sage.rings.rational.Rational'>
```

makes perfect sense, while your patch makes this result a string.



---

archive/issue_comments_286038.json:
```json
{
    "body": "So, I've realized that M2 has a function, toString, that can be used to convert the ASCII art version of a polynomial into a polynomial following python's math syntax. Given this new knowledge, do you think that I should just delete this branch and perhaps later try writing a version that converts objects of the Divide and Product class into elements of SR in Sage? Or would it still be worth it to fix this version that converts it to strings? I can't think of a reason why, but if you can think of one, I'm happy to do it.",
    "created_at": "2016-08-31T03:39:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286038",
    "user": "zonova"
}
```

So, I've realized that M2 has a function, toString, that can be used to convert the ASCII art version of a polynomial into a polynomial following python's math syntax. Given this new knowledge, do you think that I should just delete this branch and perhaps later try writing a version that converts objects of the Divide and Product class into elements of SR in Sage? Or would it still be worth it to fix this version that converts it to strings? I can't think of a reason why, but if you can think of one, I'm happy to do it.



---

archive/issue_comments_286039.json:
```json
{
    "body": "one way or another, I don't see why you ever want an interface to Sage SR objects rather than to its multivariate polynomial arithmetic. E.g. you would be stuck if on M2 side the Divide or the Product object you want to convert is defined over a field of positive characteristic, something that SR does not handle.",
    "created_at": "2016-08-31T08:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286039",
    "user": "dimpase"
}
```

one way or another, I don't see why you ever want an interface to Sage SR objects rather than to its multivariate polynomial arithmetic. E.g. you would be stuck if on M2 side the Divide or the Product object you want to convert is defined over a field of positive characteristic, something that SR does not handle.



---

archive/issue_comments_286040.json:
```json
{
    "body": "Hmm, okay. How would I check if the object is defined over a field of positive characteristic in Macaulay? Or, would converting it into a multivariate polynomial do that automatically? I guess my question is, why does it work with MPA but not with SR?",
    "created_at": "2016-08-31T15:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286040",
    "user": "zonova"
}
```

Hmm, okay. How would I check if the object is defined over a field of positive characteristic in Macaulay? Or, would converting it into a multivariate polynomial do that automatically? I guess my question is, why does it work with MPA but not with SR?



---

archive/issue_comments_286041.json:
```json
{
    "body": "Replying to [comment:18 zonova]:\n> Hmm, okay. How would I check if the object is defined over a field of positive characteristic in Macaulay? Or, would converting it into a multivariate polynomial do that automatically? I guess my question is, why does it work with MPA but not with SR? \n\nSR only works in characteristic 0, by design. Why do you even need SR?",
    "created_at": "2016-08-31T15:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286041",
    "user": "dimpase"
}
```

Replying to [comment:18 zonova]:
> Hmm, okay. How would I check if the object is defined over a field of positive characteristic in Macaulay? Or, would converting it into a multivariate polynomial do that automatically? I guess my question is, why does it work with MPA but not with SR? 

SR only works in characteristic 0, by design. Why do you even need SR?



---

archive/issue_comments_286042.json:
```json
{
    "body": "I was basing it off of this:\nhttps://groups.google.com/forum/#!topic/sage-support/oVXR3fURslY\n\nBut, you are right, it would make more sense to leave it at the first two steps you show in that post rather than changing it to SR. I had just assumed that using SR would have made it easier to treat it as a function, but that is likely my ignorance. \n\nReplying to [comment:15 dimpase]:\n> It seems you have broken some working parts, e.g.:\n> {{{\n> sage: macaulay2('5/4').to_sage()\n> 5/4\n> sage: type(macaulay2('5/4').to_sage())\n> <type 'sage.rings.rational.Rational'>\n> }}}\n> makes perfect sense, while your patch makes this result a string.\n\nI don't understand why rationals like that have cls_str == \"Divide\", instead of having cls_str == \"QQ\"... The numerator and denomenator don't have properly defined repr_str's. Should I simply make run a search for a variable if it has cls_Str == \"Divide\", to differentiate between rational polynomials and rational numbers?",
    "created_at": "2016-09-01T13:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286042",
    "user": "zonova"
}
```

I was basing it off of this:
https://groups.google.com/forum/#!topic/sage-support/oVXR3fURslY

But, you are right, it would make more sense to leave it at the first two steps you show in that post rather than changing it to SR. I had just assumed that using SR would have made it easier to treat it as a function, but that is likely my ignorance. 

Replying to [comment:15 dimpase]:
> It seems you have broken some working parts, e.g.:
> {{{
> sage: macaulay2('5/4').to_sage()
> 5/4
> sage: type(macaulay2('5/4').to_sage())
> <type 'sage.rings.rational.Rational'>
> }}}
> makes perfect sense, while your patch makes this result a string.

I don't understand why rationals like that have cls_str == "Divide", instead of having cls_str == "QQ"... The numerator and denomenator don't have properly defined repr_str's. Should I simply make run a search for a variable if it has cls_Str == "Divide", to differentiate between rational polynomials and rational numbers?



---

archive/issue_comments_286043.json:
```json
{
    "body": "Also, bigger question, how exactly is a rational function supposed to be a polynomial? Because, if it's a Divide type object in M2, then the numerator and denominator may be polynomials, but the whole thing certainly isn't, as far as I know...",
    "created_at": "2016-09-02T16:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286043",
    "user": "zonova"
}
```

Also, bigger question, how exactly is a rational function supposed to be a polynomial? Because, if it's a Divide type object in M2, then the numerator and denominator may be polynomials, but the whole thing certainly isn't, as far as I know...



---

archive/issue_comments_286044.json:
```json
{
    "body": "of course a rational function need not be a polynomial. Here is an example:\n\n```\nsage: R.<x,y>=GF(5)[]\nsage: x^2/y\nx^2/y\nsage: type(x^2/y)\n<type 'sage.rings.fraction_field_element.FractionFieldElement'>\nsage: R.fraction_field()\nFraction Field of Multivariate Polynomial Ring in x, y over Finite Field of size 5\nsage: x^2 in R.fraction_field()\nTrue\nsage: x^2/y in R.fraction_field()\nTrue\nsage: x^2/y in R\nFalse\n```\n\n\nso you get two polynomials p and q from M2, numerator and denominator of a Divide object, p/q, construct in Sage a polynomial ring R containing p and q, and then p/q is an element of R.fractional_field(). This is the plan.",
    "created_at": "2016-09-02T19:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286044",
    "user": "dimpase"
}
```

of course a rational function need not be a polynomial. Here is an example:

```
sage: R.<x,y>=GF(5)[]
sage: x^2/y
x^2/y
sage: type(x^2/y)
<type 'sage.rings.fraction_field_element.FractionFieldElement'>
sage: R.fraction_field()
Fraction Field of Multivariate Polynomial Ring in x, y over Finite Field of size 5
sage: x^2 in R.fraction_field()
True
sage: x^2/y in R.fraction_field()
True
sage: x^2/y in R
False
```


so you get two polynomials p and q from M2, numerator and denominator of a Divide object, p/q, construct in Sage a polynomial ring R containing p and q, and then p/q is an element of R.fractional_field(). This is the plan.



---

archive/issue_comments_286045.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-03-13T07:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286045",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_286046.json:
```json
{
    "body": "indentation is incorrect in the new method.",
    "created_at": "2017-03-13T07:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20699#issuecomment-286046",
    "user": "chapoton"
}
```

indentation is incorrect in the new method.
