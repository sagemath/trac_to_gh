# Issue 31681: various details in combinat

Issue created by migration from https://trac.sagemath.org/ticket/31918

Original creator: chapoton

Original creation time: 2021-06-06 12:21:49

CC:  tscrim slelievre tkarn

* about range(0, *)
* about isinstance() or isinstance()


---

Comment by chapoton created at 2021-06-06 12:22:41

New commits:


---

Comment by chapoton created at 2021-06-06 12:22:41

Changing status from new to needs_review.


---

Comment by git created at 2021-06-06 12:27:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2021-06-07 11:43:38

bot is morally green, please review


---

Comment by tkarn created at 2021-06-07 14:50:55

Looks good to me.


---

Comment by tkarn created at 2021-06-07 14:50:55

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-06-29 17:40:25

Resolution: fixed


---

Comment by @darijgr created at 2021-07-26 08:30:11


```
-        result = [None] * len(grouping)
+        result = []
         j = 0
-        for i in range(len(grouping)):
-            result[i] = sum(self[j:j+grouping[i]])
-            j += grouping[i]
+        for gi in grouping:
+            result.append(sum(self[j:j + gi]))
+            j += gi
```


Sure this is an improvement?

```
sage: def xfun():
....:     a = []
....:     for i in range(10000):
....:         a.append(i)
....:     return a
....:
sage: def yfun():
....:     a = [None]*10000
....:     for i in range(10000):
....:         a[i] = i
....:     return a
....:
sage:
sage: timeit.eval("xfun()")
625 loops, best of 3: 1.6 ms per loop
sage: timeit.eval("yfun()")
625 loops, best of 3: 1.32 ms per loop
```

(I get even starker differences on occasion.)
Appending to a list over and over might be worse than initializing it to the right length.


---

Comment by chapoton created at 2021-07-30 09:33:43

indeed. Undone among the other changes in #32310.
