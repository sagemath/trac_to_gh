# Issue 30675: sagelib: Update metadata for PyPI deployment

archive/issues_030675.json:
```json
{
    "body": "CC:  dimpase jhpalmieri mmasdeu vdelecroix malb fbissey embray dunfield slelievre mjo chapoton vbraun slabbe was @mwageringel saraedum\n\nWe update the following items in `build/pkgs/sagelib/src/`:\n- Add README\n- `setup.py` metadata (author, license, compatibility, ....)\n\nWe switch from distutils to setuptools so we can put the new metadata in the `setup.cfg` format.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30912\n\n",
    "created_at": "2020-11-14T04:14:52Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "sagelib: Update metadata for PyPI deployment",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30675",
    "user": "mkoeppe"
}
```
CC:  dimpase jhpalmieri mmasdeu vdelecroix malb fbissey embray dunfield slelievre mjo chapoton vbraun slabbe was @mwageringel saraedum

We update the following items in `build/pkgs/sagelib/src/`:
- Add README
- `setup.py` metadata (author, license, compatibility, ....)

We switch from distutils to setuptools so we can put the new metadata in the `setup.cfg` format.

Issue created by migration from https://trac.sagemath.org/ticket/30912





---

archive/issue_comments_438440.json:
```json
{
    "body": "Currently, `setup.py` thinks that the name of the distribution is `sage`.\n- `sage` is taken - see #28796\tClaim \"sage\" package on PyPI, replace unexplained package \"sage 0.0.0\"\n- `sagemath` is taken - https://pypi.org/project/sagemath/ \"This is a dummy package that checks that Sage is installed in the system\"\n- various other related and unrelated packages are published as sage-* - https://pypi.org/search/?q=sage\n\nI was planning to change it to `sagelib`. But we could also try a systematic approach regarding branding and call it `sagemath-standard` (in anticipation of the modularization project's smaller distributions that could be called `sagemath-core`, `sagemath-ntl`, etc., see #29705).",
    "created_at": "2020-11-14T04:37:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438440",
    "user": "mkoeppe"
}
```

Currently, `setup.py` thinks that the name of the distribution is `sage`.
- `sage` is taken - see #28796	Claim "sage" package on PyPI, replace unexplained package "sage 0.0.0"
- `sagemath` is taken - https://pypi.org/project/sagemath/ "This is a dummy package that checks that Sage is installed in the system"
- various other related and unrelated packages are published as sage-* - https://pypi.org/search/?q=sage

I was planning to change it to `sagelib`. But we could also try a systematic approach regarding branding and call it `sagemath-standard` (in anticipation of the modularization project's smaller distributions that could be called `sagemath-core`, `sagemath-ntl`, etc., see #29705).



---

archive/issue_comments_438441.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-11-14T05:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438441",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_438442.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-14T05:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438442",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_438443.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-14T06:19:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438443",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438444.json:
```json
{
    "body": "should we also claim https://pypi.org/project/sagemath/  ?",
    "created_at": "2020-11-14T11:41:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438444",
    "user": "dimpase"
}
```

should we also claim https://pypi.org/project/sagemath/  ?



---

archive/issue_comments_438445.json:
```json
{
    "body": "The dummy package on pypi.org/project/sagemath was created so that other projects could be made to depend on it, and thus allow a user to install a custom package without having to recompile Sage. This has worked well to this day, you can install the darmonpoints package with a one-liner and alongside it checks that the installed version of Sage is the correct one.\n\nAt the time (2016 maybe?) we thought that this was a good idea, since it seemed like it was a long time until modularization would be a reality.\n\nThe dummy package only has one function (`check_version`) which compares the version passed as parameter with the sage version (via `from sage.all import version`).\n\nI don't mind giving away this package if modularity is happening, since then there would a proper way to check for each of the required packages (there should be a way to check for the \"whole sage\" being installed, since it may be hard to decide on all the dependencies).\n\nHow should we go about it? I would rather have this kind of functionality (and I am assuming that the other two package maintainers that use the dummy package would be with me) available during the transition, specially if it takes more than a week or two...",
    "created_at": "2020-11-15T16:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438445",
    "user": "mmasdeu"
}
```

The dummy package on pypi.org/project/sagemath was created so that other projects could be made to depend on it, and thus allow a user to install a custom package without having to recompile Sage. This has worked well to this day, you can install the darmonpoints package with a one-liner and alongside it checks that the installed version of Sage is the correct one.

At the time (2016 maybe?) we thought that this was a good idea, since it seemed like it was a long time until modularization would be a reality.

The dummy package only has one function (`check_version`) which compares the version passed as parameter with the sage version (via `from sage.all import version`).

I don't mind giving away this package if modularity is happening, since then there would a proper way to check for each of the required packages (there should be a way to check for the "whole sage" being installed, since it may be hard to decide on all the dependencies).

How should we go about it? I would rather have this kind of functionality (and I am assuming that the other two package maintainers that use the dummy package would be with me) available during the transition, specially if it takes more than a week or two...



---

archive/issue_comments_438446.json:
```json
{
    "body": "I certainly don't need the `sagemath` name itself any time soon - I would use suffixed names such as `sagemath-standard`.",
    "created_at": "2020-11-15T23:20:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438446",
    "user": "mkoeppe"
}
```

I certainly don't need the `sagemath` name itself any time soon - I would use suffixed names such as `sagemath-standard`.



---

archive/issue_comments_438447.json:
```json
{
    "body": "What's the reason that this new metadata is only in build/.../sagelib and not (also?) under `src`?\nOther than that, the changes look good to me.\n\nMoreover, FYI, [PEP 621](https://www.python.org/dev/peps/pep-0621/) for Storing project metadata in pyproject.toml has been provisionally accepted (and will be fully accepted latest on 2021-03-01). Once setuptools supports this, I would propose to follow it and put the metadata in pyproject.toml.",
    "created_at": "2020-11-27T11:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438447",
    "user": "@tobiasdiez"
}
```

What's the reason that this new metadata is only in build/.../sagelib and not (also?) under `src`?
Other than that, the changes look good to me.

Moreover, FYI, [PEP 621](https://www.python.org/dev/peps/pep-0621/) for Storing project metadata in pyproject.toml has been provisionally accepted (and will be fully accepted latest on 2021-03-01). Once setuptools supports this, I would propose to follow it and put the metadata in pyproject.toml.



---

archive/issue_comments_438448.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-27T21:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438448",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438449.json:
```json
{
    "body": "Replying to [comment:13 gh-tobiasdiez]:\n> What's the reason that this new metadata is only in build/.../sagelib and not (also?) under `src`?\n\nI guess I had wanted to avoid merge conflicts with #30371, but here you go.",
    "created_at": "2020-11-27T21:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438449",
    "user": "mkoeppe"
}
```

Replying to [comment:13 gh-tobiasdiez]:
> What's the reason that this new metadata is only in build/.../sagelib and not (also?) under `src`?

I guess I had wanted to avoid merge conflicts with #30371, but here you go.



---

archive/issue_comments_438450.json:
```json
{
    "body": "Replying to [comment:13 gh-tobiasdiez]:\n> Moreover, FYI, [PEP 621](https://www.python.org/dev/peps/pep-0621/) for Storing project metadata in pyproject.toml has been provisionally accepted (and will be fully accepted latest on 2021-03-01). Once setuptools supports this, I would propose to follow it and put the metadata in pyproject.toml.\n\nYes, it's good to see the progress in this direction.",
    "created_at": "2020-11-27T21:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438450",
    "user": "mkoeppe"
}
```

Replying to [comment:13 gh-tobiasdiez]:
> Moreover, FYI, [PEP 621](https://www.python.org/dev/peps/pep-0621/) for Storing project metadata in pyproject.toml has been provisionally accepted (and will be fully accepted latest on 2021-03-01). Once setuptools supports this, I would propose to follow it and put the metadata in pyproject.toml.

Yes, it's good to see the progress in this direction.



---

archive/issue_comments_438451.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-27T21:29:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438451",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438452.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-12-06T17:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438452",
    "user": "mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_comments_438453.json:
```json
{
    "body": "Replying to [comment:7 mmasdeu]:\n> The dummy package on pypi.org/project/sagemath was created so that\n> other projects could be made to depend on it, and thus allow a user\n> to install a custom package without having to recompile Sage.\n> This has worked well to this day, you can install the darmonpoints\n> package with a one-liner and alongside it checks that the installed\n> version of Sage is the correct one.\n> \n> At the time (2016 maybe?) we thought that this was a good idea,\n> since it seemed like it was a long time until modularization\n> would be a reality.\n> \n> The dummy package only has one function (`check_version`) which\n> compares the version passed as parameter with the sage version\n> (via `from sage.all import version`).\n> \n> I don't mind giving away this package if modularity is happening,\n> since then there would a proper way to check for each of the required\n> packages (there should be a way to check for the \"whole sage\" being\n> installed, since it may be hard to decide on all the dependencies).\n> \n> How should we go about it? I would rather have this kind of\n> functionality (and I am assuming that the other two package\n> maintainers that use the dummy package would be with me) available\n> during the transition, specially if it takes more than a week or two...\n\nMaybe there could be a package with a more\ndescriptive name for that use case?\n\nMaybe one of the following names, or something similar?\n- `sagemath_installed`\n- `sagemath_version`\n- `sagemath_checkinstalled`\n- `sagemath_checkversion`\n- `sagemath_probe`\n\nSome users assume from the name that it actually installs Sage,\nand are surprised after installing it that things don't work as\nexpected; this comes up once in a while on the help and support\nchannels such as Ask Sage, sage-support, Stack Overflow...\n\nNot an emergency, but something to consider.",
    "created_at": "2020-12-09T15:20:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438453",
    "user": "slelievre"
}
```

Replying to [comment:7 mmasdeu]:
> The dummy package on pypi.org/project/sagemath was created so that
> other projects could be made to depend on it, and thus allow a user
> to install a custom package without having to recompile Sage.
> This has worked well to this day, you can install the darmonpoints
> package with a one-liner and alongside it checks that the installed
> version of Sage is the correct one.
> 
> At the time (2016 maybe?) we thought that this was a good idea,
> since it seemed like it was a long time until modularization
> would be a reality.
> 
> The dummy package only has one function (`check_version`) which
> compares the version passed as parameter with the sage version
> (via `from sage.all import version`).
> 
> I don't mind giving away this package if modularity is happening,
> since then there would a proper way to check for each of the required
> packages (there should be a way to check for the "whole sage" being
> installed, since it may be hard to decide on all the dependencies).
> 
> How should we go about it? I would rather have this kind of
> functionality (and I am assuming that the other two package
> maintainers that use the dummy package would be with me) available
> during the transition, specially if it takes more than a week or two...

Maybe there could be a package with a more
descriptive name for that use case?

Maybe one of the following names, or something similar?
- `sagemath_installed`
- `sagemath_version`
- `sagemath_checkinstalled`
- `sagemath_checkversion`
- `sagemath_probe`

Some users assume from the name that it actually installs Sage,
and are surprised after installing it that things don't work as
expected; this comes up once in a while on the help and support
channels such as Ask Sage, sage-support, Stack Overflow...

Not an emergency, but something to consider.



---

archive/issue_comments_438454.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-11T23:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438454",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_438455.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-12T00:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438455",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438456.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-12-12T00:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438456",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_438457.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-22T15:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438457",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_438458.json:
```json
{
    "body": "Still hoping for someone with recent Python packaging experience to review this ticket.",
    "created_at": "2020-12-22T15:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438458",
    "user": "mkoeppe"
}
```

Still hoping for someone with recent Python packaging experience to review this ticket.



---

archive/issue_comments_438459.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-12-29T00:34:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438459",
    "user": "mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_438460.json:
```json
{
    "body": "Needs review.",
    "created_at": "2021-01-16T19:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438460",
    "user": "mkoeppe"
}
```

Needs review.



---

archive/issue_comments_438461.json:
```json
{
    "body": "Can we please get this into 9.3?",
    "created_at": "2021-02-02T17:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438461",
    "user": "mkoeppe"
}
```

Can we please get this into 9.3?



---

archive/issue_comments_438462.json:
```json
{
    "body": "I'm seeing a doctest failure:\n\n```\nsage -t --warn-long 95.5 --random-seed=0 src/sage/all.py\n**********************************************************************\nFile \"src/sage/all.py\", line 333, in sage.all._write_started_file\nFailed example:\n    os.path.isfile(started_file)  # optional - build\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n```\n\nIs it spurious or could it be caused by this ticket?",
    "created_at": "2021-02-05T02:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438462",
    "user": "jhpalmieri"
}
```

I'm seeing a doctest failure:

```
sage -t --warn-long 95.5 --random-seed=0 src/sage/all.py
**********************************************************************
File "src/sage/all.py", line 333, in sage.all._write_started_file
Failed example:
    os.path.isfile(started_file)  # optional - build
Expected:
    True
Got:
    False
**********************************************************************
```

Is it spurious or could it be caused by this ticket?



---

archive/issue_comments_438463.json:
```json
{
    "body": "If the docbuild fails with an error, then `make` does not get to the target that creates the started_file. You can fix this with `make build-start`",
    "created_at": "2021-02-05T02:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438463",
    "user": "mkoeppe"
}
```

If the docbuild fails with an error, then `make` does not get to the target that creates the started_file. You can fix this with `make build-start`



---

archive/issue_comments_438464.json:
```json
{
    "body": "That's too bad. I thought, but maybe I'm wrong about this, that starting Sage used to create the started_file, and I made sure to run Sage before rerunning this doctest. You're right, in any case: `make build-start` fixed the doctest.",
    "created_at": "2021-02-05T03:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438464",
    "user": "jhpalmieri"
}
```

That's too bad. I thought, but maybe I'm wrong about this, that starting Sage used to create the started_file, and I made sure to run Sage before rerunning this doctest. You're right, in any case: `make build-start` fixed the doctest.



---

archive/issue_comments_438465.json:
```json
{
    "body": "I don't think starting sage creates the started file. It's only happening as part of the build in `build/bin/sage-starts`",
    "created_at": "2021-02-05T03:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438465",
    "user": "mkoeppe"
}
```

I don't think starting sage creates the started file. It's only happening as part of the build in `build/bin/sage-starts`



---

archive/issue_comments_438466.json:
```json
{
    "body": "since #13988",
    "created_at": "2021-02-05T03:33:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438466",
    "user": "mkoeppe"
}
```

since #13988



---

archive/issue_comments_438467.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-05T04:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438467",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_438468.json:
```json
{
    "body": "I am far from an expert in `setuptools`, but this looks okay to me.",
    "created_at": "2021-02-05T04:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438468",
    "user": "jhpalmieri"
}
```

I am far from an expert in `setuptools`, but this looks okay to me.



---

archive/issue_comments_438469.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-02-05T04:29:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438469",
    "user": "mkoeppe"
}
```

Thanks!



---

archive/issue_comments_438470.json:
```json
{
    "body": "This is fun. Volker is in the process of merging the ticket, which means I get to test it in sage-on-gentoo\n\n```\n>>> Compiling source in /dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src ...\n * python3_7: running distutils-r1_run_phase python_compile\npython3.7 setup.py build -j 8\ndistributions = ['', 'sage-bliss', 'sage-meataxe']\nDiscovering Python/Cython source code....\nDiscovered Python/Cython sources, time: 0.20 seconds.\n************************************************************************\nTraceback (most recent call last):\n  File \"setup.py\", line 153, in <module>\n    ext_modules = cython_modules)\n  File \"/usr/lib/python3.7/site-packages/setuptools/__init__.py\", line 153, in setup\n    return distutils.core.setup(**attrs)\n  File \"/usr/lib/python3.7/distutils/core.py\", line 121, in setup\n    dist.parse_config_files()\n  File \"/usr/lib/python3.7/site-packages/setuptools/dist.py\", line 668, in parse_config_files\n    ignore_option_errors=ignore_option_errors)\n  File \"/usr/lib/python3.7/site-packages/setuptools/config.py\", line 157, in parse_configuration\n    meta.parse()\n  File \"/usr/lib/python3.7/site-packages/setuptools/config.py\", line 463, in parse\n    section_parser_method(section_options)\n  File \"/usr/lib/python3.7/site-packages/setuptools/config.py\", line 436, in parse_section\n    self[name] = value\n  File \"/usr/lib/python3.7/site-packages/setuptools/config.py\", line 220, in __setitem__\n    value = parser(value)\n  File \"/usr/lib/python3.7/site-packages/setuptools/config.py\", line 548, in _parse_version\n    raise DistutilsOptionError(tmpl.format(**locals()))\ndistutils.errors.DistutilsOptionError: Version loaded from file: VERSION.txt does not comply with PEP 440: SageMath version 9.3.beta7, Release Date: 2021-02-07\n************************************************************************\nError building the Sage library\n```\n\nYou can read the PEP in question here [https://www.python.org/dev/peps/pep-0440/](https://www.python.org/dev/peps/pep-0440/). I am currently using the Gentoo stable setuptools which is 50.3.0. sage is shipping 51.1.1 so I am guessing someone had a change of heart about strict enforcement between those two. I'll check by updating my own to the latest in Gentoo's tree (53.0.0).\n\nBut if the PEP get enforced the days of naming release .betaN and .rcN are numbered.",
    "created_at": "2021-02-14T03:00:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438470",
    "user": "fbissey"
}
```

This is fun. Volker is in the process of merging the ticket, which means I get to test it in sage-on-gentoo

```
>>> Compiling source in /dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src ...
 * python3_7: running distutils-r1_run_phase python_compile
python3.7 setup.py build -j 8
distributions = ['', 'sage-bliss', 'sage-meataxe']
Discovering Python/Cython source code....
Discovered Python/Cython sources, time: 0.20 seconds.
************************************************************************
Traceback (most recent call last):
  File "setup.py", line 153, in <module>
    ext_modules = cython_modules)
  File "/usr/lib/python3.7/site-packages/setuptools/__init__.py", line 153, in setup
    return distutils.core.setup(**attrs)
  File "/usr/lib/python3.7/distutils/core.py", line 121, in setup
    dist.parse_config_files()
  File "/usr/lib/python3.7/site-packages/setuptools/dist.py", line 668, in parse_config_files
    ignore_option_errors=ignore_option_errors)
  File "/usr/lib/python3.7/site-packages/setuptools/config.py", line 157, in parse_configuration
    meta.parse()
  File "/usr/lib/python3.7/site-packages/setuptools/config.py", line 463, in parse
    section_parser_method(section_options)
  File "/usr/lib/python3.7/site-packages/setuptools/config.py", line 436, in parse_section
    self[name] = value
  File "/usr/lib/python3.7/site-packages/setuptools/config.py", line 220, in __setitem__
    value = parser(value)
  File "/usr/lib/python3.7/site-packages/setuptools/config.py", line 548, in _parse_version
    raise DistutilsOptionError(tmpl.format(**locals()))
distutils.errors.DistutilsOptionError: Version loaded from file: VERSION.txt does not comply with PEP 440: SageMath version 9.3.beta7, Release Date: 2021-02-07
************************************************************************
Error building the Sage library
```

You can read the PEP in question here [https://www.python.org/dev/peps/pep-0440/](https://www.python.org/dev/peps/pep-0440/). I am currently using the Gentoo stable setuptools which is 50.3.0. sage is shipping 51.1.1 so I am guessing someone had a change of heart about strict enforcement between those two. I'll check by updating my own to the latest in Gentoo's tree (53.0.0).

But if the PEP get enforced the days of naming release .betaN and .rcN are numbered.



---

archive/issue_comments_438471.json:
```json
{
    "body": "Reading more closely `a`, `b` and `rc` are allowed.",
    "created_at": "2021-02-14T03:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438471",
    "user": "fbissey"
}
```

Reading more closely `a`, `b` and `rc` are allowed.



---

archive/issue_comments_438472.json:
```json
{
    "body": "Still broken for me with setuptools-53.0.0.",
    "created_at": "2021-02-14T03:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438472",
    "user": "fbissey"
}
```

Still broken for me with setuptools-53.0.0.



---

archive/issue_comments_438473.json:
```json
{
    "body": "This does not affect the Sage distribution (it uses the other copy of `setup.py`) and is fixed already in #31357.",
    "created_at": "2021-02-14T03:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438473",
    "user": "mkoeppe"
}
```

This does not affect the Sage distribution (it uses the other copy of `setup.py`) and is fixed already in #31357.



---

archive/issue_comments_438474.json:
```json
{
    "body": "I see. Switching to that copy is possible but that messes up how I currently do the documentation. I am not quite sure how much effort yet but it probably should be done.",
    "created_at": "2021-02-14T03:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438474",
    "user": "fbissey"
}
```

I see. Switching to that copy is possible but that messes up how I currently do the documentation. I am not quite sure how much effort yet but it probably should be done.



---

archive/issue_comments_438475.json:
```json
{
    "body": "Replying to [comment:47 fbissey]:\n> I see. Switching to that copy is possible but that messes up how I currently do the documentation. I am not quite sure how much effort yet but it probably should be done.\n\nLesson of the day, patch doesn't like symbolic links which means that I am better off waiting for #31357.",
    "created_at": "2021-02-14T04:28:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438475",
    "user": "fbissey"
}
```

Replying to [comment:47 fbissey]:
> I see. Switching to that copy is possible but that messes up how I currently do the documentation. I am not quite sure how much effort yet but it probably should be done.

Lesson of the day, patch doesn't like symbolic links which means that I am better off waiting for #31357.



---

archive/issue_comments_438476.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-02-20T10:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30675",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30675#issuecomment-438476",
    "user": "vbraun"
}
```

Resolution: fixed
