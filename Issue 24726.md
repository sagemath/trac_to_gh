# Issue 24726: Doctests write to /tmp

Issue created by migration from https://trac.sagemath.org/ticket/24963

Original creator: jdemeyer

Original creation time: 2018-03-13 12:45:57

CC:  tscrim cremona

Doctests should not write to `/tmp`:

```
sage -t --long src/doc/en/thematic_tutorials/lie/crystals.rst
**********************************************************************
File "src/doc/en/thematic_tutorials/lie/crystals.rst", line 360, in doc.en.thematic_tutorials.lie.crystals
Failed example:
    crystals.Tableaux("A2", shape=[2,1]).latex_file("/tmp/a2rho.tex")
Exception raised:
    Traceback (most recent call last):
      File "/home/jec/sagedev/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 537, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/jec/sagedev/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 947, in compile_and_execute
        exec(compiled, globs)
      File "<doctest doc.en.thematic_tutorials.lie.crystals[0]>", line 1, in <module>
        crystals.Tableaux("A2", shape=[Integer(2),Integer(1)]).latex_file("/tmp/a2rho.tex")
      File "/home/jec/sagedev/local/lib/python2.7/site-packages/sage/categories/crystals.py", line 949, in latex_file
        f = open(filename, 'w')
    IOError: [Errno 13] Permission denied: '/tmp/a2rho.tex'
**********************************************************************
```


```
sage -t --long src/sage/categories/crystals.py
**********************************************************************
File "src/sage/categories/crystals.py", line 931, in sage.categories.crystals.Crystals.ParentMethods.latex_file
Failed example:
    C.latex_file('/tmp/test.tex')
Exception raised:
    Traceback (most recent call last):
      File "/home/jec/sagedev/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 537, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/jec/sagedev/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 947, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.categories.crystals.Crystals.ParentMethods.latex_file[1]>", line 1, in <module>
        C.latex_file('/tmp/test.tex')
      File "/home/jec/sagedev/local/lib/python2.7/site-packages/sage/categories/crystals.py", line 949, in latex_file
        f = open(filename, 'w')
    IOError: [Errno 13] Permission denied: '/tmp/test.tex'
**********************************************************************
```



---

Comment by slelievre created at 2018-03-13 13:46:28

In many places the function `sage.misc.temporary_file.tmp_dir` is used.
Could it be used here too to solve this?


---

Comment by jdemeyer created at 2018-03-13 14:10:59

Yes.


---

Comment by chapoton created at 2018-03-13 15:47:23

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-03-13 15:47:23

New commits:


---

Comment by cremona created at 2018-03-13 16:48:02

I am testing the patch on the machine where this failed before, and will report here.


---

Comment by cremona created at 2018-03-14 08:37:20

Changing status from needs_review to positive_review.


---

Comment by cremona created at 2018-03-14 08:37:20

With this patch "make ptestlong" worked fine.


---

Comment by vbraun created at 2018-03-21 06:19:13

Resolution: fixed
