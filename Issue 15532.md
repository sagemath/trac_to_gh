# Issue 15532: SetSystem._isomorphism fails on an empty Setsystem

Issue created by migration from https://trac.sagemath.org/ticket/15769

Original creator: Rudi

Original creation time: 2014-01-30 22:22:03

CC:  stefan yomcat

The following produces an error:

```
from sage.matroids.set_system import SetSystem
S=SetSystem([],[])
S._isomorphism(S)
```

_equivalence() has a similar problem.



---

Comment by ncohen created at 2014-01-31 11:53:31

SetSystem ?... Guys, there is a Hypergraph class in Sage. Perhaps we should do something ?


---

Comment by Rudi created at 2014-01-31 23:03:42

Replying to [comment:1 ncohen]:
> SetSystem ?... Guys, there is a Hypergraph class in Sage. Perhaps we should do something ?
Hi Nathan, the SetSystem is just an internal datastucture. The end user only has access to them as an iterator over a set of sets, and we reserve the right to replace them with something that does the same job better or faster. But while we have them, they better not fail when they are empty :) Internally, we do use them to test for matroid isomorphism.

Of course it's easy enough to turn these SetSystems into Hypergraphs, since they behave as iterators.

```
M=matroids.named_matroids.NonFano()
H=Hypergraph(M.bases())
```

BTW there seems to be no way to get vertices that are not in some hyperedge into a Hypergraph.


---

Comment by ncohen created at 2014-01-31 23:33:14

Yooooo !!!

> Hi Nathan, the SetSystem is just an internal datastucture. The end user only has access to them as an iterator over a set of sets, and we reserve the right to replace them with something that does the same job better or faster. But while we have them, they better not fail when they are empty :) Internally, we do use them to test for matroid isomorphism.

Makes sense !

> Of course it's easy enough to turn these SetSystems into Hypergraphs, since they behave as iterators.
> {{{
> M=matroids.named_matroids.NonFano()
> H=Hypergraph(M.bases())
> }}}
> BTW there seems to be no way to get vertices that are not in some hyperedge into a Hypergraph. 

Well right now hypergraphs do absokutely nothing smart. Some coloring, and some plot with view(). But if some of us want to work on them it would be better to do the job only once ! I only wrote this because I needed it, but some isomorphism check would be nice indeed. Plus basic things like enumerating the vertices, as you say. I am working on some design patches as the same time, which do not return hypergraphs but list of lists... I am not very set on what this class should do, to be honest `:-)` 

Nathann


---

Comment by Rudi created at 2014-02-01 10:12:42

> Well right now hypergraphs do absokutely nothing smart. Some coloring, and some plot with view(). But if some of us want to work on them it would be better to do the job only once ! I only wrote this because I needed it, but some isomorphism check would be nice indeed. Plus basic things like enumerating the vertices, as you say. I am working on some design patches as the same time, which do not return hypergraphs but list of lists... I am not very set on what this class should do, to be honest `:-)` 
>

You could use SetSystem as a back-end to Hypergraph. SetSystem is hardly more than an array of bitsets, so it is good at storing many subsets of a relatively small set (internally the subsets are represented as bitsets). It would not be memory-efficient as a way to store small subsets of a big groundset --- in that case, class Hypergraph better choose another way to store its stuff. 

Currently, the isomorphism test of SetSystem is my own partial implementation of the partition-refinement algorithm of McKay, just some 300 lines of code. Until I complete that implementation, my code will not be able to compute the automorphism group. Nauty and other complete implementations can do that. 
I am not sure whether I should finish my implementation or learn my code to call other parts of Sage for this. It depends on how directly I can call such code from my own. I care a lot about efficiency, so I want to avoid unnecessary translation steps where possible. Another ticket, I guess.


---

Comment by Rudi created at 2014-02-03 17:47:52

Changing status from new to needs_review.


---

Comment by Rudi created at 2014-02-03 17:47:52

This should do it.
----
New commits:


---

Comment by ncohen created at 2014-02-04 12:20:02

If you agree with this small modification (and merge) you can set the ticket to `positive_review`.

Nathann
----
New commits:


---

Comment by Rudi created at 2014-02-04 12:41:58

Changing status from needs_review to positive_review.


---

Comment by Rudi created at 2014-02-04 12:41:58

Looks fine, thanks Nathann!


---

Comment by vbraun created at 2014-02-08 17:04:03

Resolution: fixed
