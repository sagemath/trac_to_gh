# Issue 15532: SetSystem._isomorphism fails on an empty Setsystem

archive/issues_015532.json:
```json
{
    "body": "CC:  stefan yomcat\n\nThe following produces an error:\n\n```\nfrom sage.matroids.set_system import SetSystem\nS=SetSystem([],[])\nS._isomorphism(S)\n```\n\n_equivalence() has a similar problem.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/15769\n\n",
    "created_at": "2014-01-30T22:22:03Z",
    "labels": [
        "component: matroid theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "SetSystem._isomorphism fails on an empty Setsystem",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15532",
    "user": "https://trac.sagemath.org/admin/accounts/users/Rudi"
}
```
CC:  stefan yomcat

The following produces an error:

```
from sage.matroids.set_system import SetSystem
S=SetSystem([],[])
S._isomorphism(S)
```

_equivalence() has a similar problem.


Issue created by migration from https://trac.sagemath.org/ticket/15769





---

archive/issue_comments_200453.json:
```json
{
    "body": "SetSystem ?... Guys, there is a Hypergraph class in Sage. Perhaps we should do something ?",
    "created_at": "2014-01-31T11:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15532#issuecomment-200453",
    "user": "https://github.com/nathanncohen"
}
```

SetSystem ?... Guys, there is a Hypergraph class in Sage. Perhaps we should do something ?



---

archive/issue_comments_200454.json:
```json
{
    "body": "Replying to [comment:1 ncohen]:\n> SetSystem ?... Guys, there is a Hypergraph class in Sage. Perhaps we should do something ?\nHi Nathan, the SetSystem is just an internal datastucture. The end user only has access to them as an iterator over a set of sets, and we reserve the right to replace them with something that does the same job better or faster. But while we have them, they better not fail when they are empty :) Internally, we do use them to test for matroid isomorphism.\n\nOf course it's easy enough to turn these SetSystems into Hypergraphs, since they behave as iterators.\n\n```\nM=matroids.named_matroids.NonFano()\nH=Hypergraph(M.bases())\n```\n\nBTW there seems to be no way to get vertices that are not in some hyperedge into a Hypergraph.",
    "created_at": "2014-01-31T23:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15532#issuecomment-200454",
    "user": "https://trac.sagemath.org/admin/accounts/users/Rudi"
}
```

Replying to [comment:1 ncohen]:
> SetSystem ?... Guys, there is a Hypergraph class in Sage. Perhaps we should do something ?
Hi Nathan, the SetSystem is just an internal datastucture. The end user only has access to them as an iterator over a set of sets, and we reserve the right to replace them with something that does the same job better or faster. But while we have them, they better not fail when they are empty :) Internally, we do use them to test for matroid isomorphism.

Of course it's easy enough to turn these SetSystems into Hypergraphs, since they behave as iterators.

```
M=matroids.named_matroids.NonFano()
H=Hypergraph(M.bases())
```

BTW there seems to be no way to get vertices that are not in some hyperedge into a Hypergraph.



---

archive/issue_comments_200455.json:
```json
{
    "body": "Yooooo !!!\n\n> Hi Nathan, the SetSystem is just an internal datastucture. The end user only has access to them as an iterator over a set of sets, and we reserve the right to replace them with something that does the same job better or faster. But while we have them, they better not fail when they are empty :) Internally, we do use them to test for matroid isomorphism.\n\nMakes sense !\n\n> Of course it's easy enough to turn these SetSystems into Hypergraphs, since they behave as iterators.\n> {{{\n> M=matroids.named_matroids.NonFano()\n> H=Hypergraph(M.bases())\n> }}}\n> BTW there seems to be no way to get vertices that are not in some hyperedge into a Hypergraph. \n\nWell right now hypergraphs do absokutely nothing smart. Some coloring, and some plot with view(). But if some of us want to work on them it would be better to do the job only once ! I only wrote this because I needed it, but some isomorphism check would be nice indeed. Plus basic things like enumerating the vertices, as you say. I am working on some design patches as the same time, which do not return hypergraphs but list of lists... I am not very set on what this class should do, to be honest `:-)` \n\nNathann",
    "created_at": "2014-01-31T23:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15532#issuecomment-200455",
    "user": "https://github.com/nathanncohen"
}
```

Yooooo !!!

> Hi Nathan, the SetSystem is just an internal datastucture. The end user only has access to them as an iterator over a set of sets, and we reserve the right to replace them with something that does the same job better or faster. But while we have them, they better not fail when they are empty :) Internally, we do use them to test for matroid isomorphism.

Makes sense !

> Of course it's easy enough to turn these SetSystems into Hypergraphs, since they behave as iterators.
> {{{
> M=matroids.named_matroids.NonFano()
> H=Hypergraph(M.bases())
> }}}
> BTW there seems to be no way to get vertices that are not in some hyperedge into a Hypergraph. 

Well right now hypergraphs do absokutely nothing smart. Some coloring, and some plot with view(). But if some of us want to work on them it would be better to do the job only once ! I only wrote this because I needed it, but some isomorphism check would be nice indeed. Plus basic things like enumerating the vertices, as you say. I am working on some design patches as the same time, which do not return hypergraphs but list of lists... I am not very set on what this class should do, to be honest `:-)` 

Nathann



---

archive/issue_comments_200456.json:
```json
{
    "body": "> Well right now hypergraphs do absokutely nothing smart. Some coloring, and some plot with view(). But if some of us want to work on them it would be better to do the job only once ! I only wrote this because I needed it, but some isomorphism check would be nice indeed. Plus basic things like enumerating the vertices, as you say. I am working on some design patches as the same time, which do not return hypergraphs but list of lists... I am not very set on what this class should do, to be honest `:-)` \n>\n\nYou could use SetSystem as a back-end to Hypergraph. SetSystem is hardly more than an array of bitsets, so it is good at storing many subsets of a relatively small set (internally the subsets are represented as bitsets). It would not be memory-efficient as a way to store small subsets of a big groundset --- in that case, class Hypergraph better choose another way to store its stuff. \n\nCurrently, the isomorphism test of SetSystem is my own partial implementation of the partition-refinement algorithm of McKay, just some 300 lines of code. Until I complete that implementation, my code will not be able to compute the automorphism group. Nauty and other complete implementations can do that. \nI am not sure whether I should finish my implementation or learn my code to call other parts of Sage for this. It depends on how directly I can call such code from my own. I care a lot about efficiency, so I want to avoid unnecessary translation steps where possible. Another ticket, I guess.",
    "created_at": "2014-02-01T10:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15532#issuecomment-200456",
    "user": "https://trac.sagemath.org/admin/accounts/users/Rudi"
}
```

> Well right now hypergraphs do absokutely nothing smart. Some coloring, and some plot with view(). But if some of us want to work on them it would be better to do the job only once ! I only wrote this because I needed it, but some isomorphism check would be nice indeed. Plus basic things like enumerating the vertices, as you say. I am working on some design patches as the same time, which do not return hypergraphs but list of lists... I am not very set on what this class should do, to be honest `:-)` 
>

You could use SetSystem as a back-end to Hypergraph. SetSystem is hardly more than an array of bitsets, so it is good at storing many subsets of a relatively small set (internally the subsets are represented as bitsets). It would not be memory-efficient as a way to store small subsets of a big groundset --- in that case, class Hypergraph better choose another way to store its stuff. 

Currently, the isomorphism test of SetSystem is my own partial implementation of the partition-refinement algorithm of McKay, just some 300 lines of code. Until I complete that implementation, my code will not be able to compute the automorphism group. Nauty and other complete implementations can do that. 
I am not sure whether I should finish my implementation or learn my code to call other parts of Sage for this. It depends on how directly I can call such code from my own. I care a lot about efficiency, so I want to avoid unnecessary translation steps where possible. Another ticket, I guess.



---

archive/issue_comments_200457.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-02-03T17:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15532#issuecomment-200457",
    "user": "https://trac.sagemath.org/admin/accounts/users/Rudi"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_200458.json:
```json
{
    "body": "This should do it.\n----\nNew commits:",
    "created_at": "2014-02-03T17:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15532#issuecomment-200458",
    "user": "https://trac.sagemath.org/admin/accounts/users/Rudi"
}
```

This should do it.
----
New commits:



---

archive/issue_comments_200459.json:
```json
{
    "body": "If you agree with this small modification (and merge) you can set the ticket to `positive_review`.\n\nNathann\n----\nNew commits:",
    "created_at": "2014-02-04T12:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15532#issuecomment-200459",
    "user": "https://github.com/nathanncohen"
}
```

If you agree with this small modification (and merge) you can set the ticket to `positive_review`.

Nathann
----
New commits:



---

archive/issue_comments_200460.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-02-04T12:41:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15532#issuecomment-200460",
    "user": "https://trac.sagemath.org/admin/accounts/users/Rudi"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_200461.json:
```json
{
    "body": "Looks fine, thanks Nathann!",
    "created_at": "2014-02-04T12:41:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15532#issuecomment-200461",
    "user": "https://trac.sagemath.org/admin/accounts/users/Rudi"
}
```

Looks fine, thanks Nathann!



---

archive/issue_comments_200462.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-08T17:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15532",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15532#issuecomment-200462",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_015170.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-08T17:04:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15532",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15532#event-15170"
}
```
