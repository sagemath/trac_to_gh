# Issue 31979: Update the developers guide for implicitly fuzzing doctests

archive/issues_031979.json:
```json
{
    "body": "CC:  @nbruin @orlitzky\n\nKeywords: random_seed, fuzz\n\nFrom #29935#comment:139:\n\nWe updated the developers guide to point out that doctests are expected to pass for any random seed.\n\nIssue created by migration from https://trac.sagemath.org/ticket/32216\n\n",
    "created_at": "2021-07-16T19:58:49Z",
    "labels": [
        "doctest framework",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Update the developers guide for implicitly fuzzing doctests",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31979",
    "user": "@kliem"
}
```
CC:  @nbruin @orlitzky

Keywords: random_seed, fuzz

From #29935#comment:139:

We updated the developers guide to point out that doctests are expected to pass for any random seed.

Issue created by migration from https://trac.sagemath.org/ticket/32216





---

archive/issue_comments_456951.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-16T19:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31979#issuecomment-456951",
    "user": "@kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_456952.json:
```json
{
    "body": "*While we're in there...* could we just give the example that it's alluding to? The suggestion can even be simplified a bit, e.g.:\n\n\n```\n...\nsage: hash(c)  # random\nThis doctest passes too, as the output is not checked\n```\n\n\n> When possible, avoid the problem. For example, rather than printing the (unpredictable) value of the hash in a doctest, one could check that `hash()` successfully returns an integer:\n\n\n```\nsage: c = CombinatorialObject([1,2,3])\nsage: hash(c) in ZZ                                                             \nTrue\n```\n\n\n> This eliminates the randomness from the output, which is important because all doctests are expected to pass with any state of the pseudorandom number generators (PRNGs).",
    "created_at": "2021-07-19T02:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31979#issuecomment-456952",
    "user": "@orlitzky"
}
```

*While we're in there...* could we just give the example that it's alluding to? The suggestion can even be simplified a bit, e.g.:


```
...
sage: hash(c)  # random
This doctest passes too, as the output is not checked
```


> When possible, avoid the problem. For example, rather than printing the (unpredictable) value of the hash in a doctest, one could check that `hash()` successfully returns an integer:


```
sage: c = CombinatorialObject([1,2,3])
sage: hash(c) in ZZ                                                             
True
```


> This eliminates the randomness from the output, which is important because all doctests are expected to pass with any state of the pseudorandom number generators (PRNGs).



---

archive/issue_comments_456953.json:
```json
{
    "body": "I am going to nitpick this to death, sorry:\n\n\n```\nsage: while ZZ.random_element() != 0:\n....:     pass\nsage: total = ZZ.random_element(-2, 3)\nsage: count = 1\nsage: while abs(total/count) > 0.01:\n....:     total += ZZ.random_element(-2, 3)\n....:     count += 1\n```\n\n\nWhy skip an initial sequence of zeros? If it's because we don't want the test to pass immediately... is it any more reassuring if our sequence is `[-1,1]`? I think this only tests the mean of the distribution, and if we really want to claim we've tested *that*, then we should insist on some minimum number of loops.\n\nI'm not really suggesting that we go crazy on this example... could we test something simpler that's more obviously doing the right thing? Like checking that each element of `[-2,-1,0,1,2]` is generated eventually?",
    "created_at": "2021-07-19T02:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31979#issuecomment-456953",
    "user": "@orlitzky"
}
```

I am going to nitpick this to death, sorry:


```
sage: while ZZ.random_element() != 0:
....:     pass
sage: total = ZZ.random_element(-2, 3)
sage: count = 1
sage: while abs(total/count) > 0.01:
....:     total += ZZ.random_element(-2, 3)
....:     count += 1
```


Why skip an initial sequence of zeros? If it's because we don't want the test to pass immediately... is it any more reassuring if our sequence is `[-1,1]`? I think this only tests the mean of the distribution, and if we really want to claim we've tested *that*, then we should insist on some minimum number of loops.

I'm not really suggesting that we go crazy on this example... could we test something simpler that's more obviously doing the right thing? Like checking that each element of `[-2,-1,0,1,2]` is generated eventually?



---

archive/issue_comments_456954.json:
```json
{
    "body": "I wanted to illustrate two tests here and this apparently is not clear at all. (Edit: Typo)\n\nOne test is, you can test that a certain element is found. E.g. `0` appears as a random element.\n\nThe next test calculates the mean. I didn't care too much, if the tests passes immediately. This happens, but if the test is run on random seeds, it would still be meaningful.\n\nI like the simpler test. If I state that distribution can be checked like this, people can figure this out themselves and I have also some examples like this in the `ZZ.random_element` documentation prepared in #29979.",
    "created_at": "2021-07-19T06:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31979#issuecomment-456954",
    "user": "@kliem"
}
```

I wanted to illustrate two tests here and this apparently is not clear at all. (Edit: Typo)

One test is, you can test that a certain element is found. E.g. `0` appears as a random element.

The next test calculates the mean. I didn't care too much, if the tests passes immediately. This happens, but if the test is run on random seeds, it would still be meaningful.

I like the simpler test. If I state that distribution can be checked like this, people can figure this out themselves and I have also some examples like this in the `ZZ.random_element` documentation prepared in #29979.



---

archive/issue_comments_456955.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-19T06:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31979#issuecomment-456955",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_456956.json:
```json
{
    "body": "Ok, LGTM now. I can make the change in comment:2 myself later if I care enough about it.\n\nOne last question though: I think this should depend on 29935, and not the other way around? Otherwise this\n\n\n```\nsage: while not all(found.values()):\n....:     found[ZZ.random_element(-2, 3)] = True\n```\n\n\nis going to loop forever as `ZZ.random_element(-2, 3)` generates the same number over and over again.",
    "created_at": "2021-07-19T14:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31979#issuecomment-456956",
    "user": "@orlitzky"
}
```

Ok, LGTM now. I can make the change in comment:2 myself later if I care enough about it.

One last question though: I think this should depend on 29935, and not the other way around? Otherwise this


```
sage: while not all(found.values()):
....:     found[ZZ.random_element(-2, 3)] = True
```


is going to loop forever as `ZZ.random_element(-2, 3)` generates the same number over and over again.



---

archive/issue_comments_456957.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-19T14:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31979#issuecomment-456957",
    "user": "@orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_456958.json:
```json
{
    "body": "Replying to [comment:6 mjo]:\n> Ok, LGTM now. I can make the change in comment:2 myself later if I care enough about it.\n> \n> One last question though: I think this should depend on 29935, and not the other way around? \n\n\nNevermind, it generates the same sequence, not the same number each time...",
    "created_at": "2021-07-19T14:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31979#issuecomment-456958",
    "user": "@orlitzky"
}
```

Replying to [comment:6 mjo]:
> Ok, LGTM now. I can make the change in comment:2 myself later if I care enough about it.
> 
> One last question though: I think this should depend on 29935, and not the other way around? 


Nevermind, it generates the same sequence, not the same number each time...



---

archive/issue_comments_456959.json:
```json
{
    "body": "Thank you. I didn't read comment:2 until later, when I was only on the smartphone and couldn't do anything about it anymore.",
    "created_at": "2021-07-19T20:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31979#issuecomment-456959",
    "user": "@kliem"
}
```

Thank you. I didn't read comment:2 until later, when I was only on the smartphone and couldn't do anything about it anymore.



---

archive/issue_comments_456960.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-25T13:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31979",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31979#issuecomment-456960",
    "user": "@vbraun"
}
```

Resolution: fixed
