# Issue 21463: latte_int: Add order-only dependencies

archive/issues_021463.json:
```json
{
    "body": "CC:  tscrim dimpase vdelecroix jhpalmieri slelievre\n\nThe `latte_int` configure script detects lrslib and lidia if they are installed, so these packages should be order-only dependencies.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21700\n\n",
    "created_at": "2016-10-13T17:01:39Z",
    "labels": [
        "packages: experimental",
        "major",
        "enhancement"
    ],
    "title": "latte_int: Add order-only dependencies",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21463",
    "user": "mkoeppe"
}
```
CC:  tscrim dimpase vdelecroix jhpalmieri slelievre

The `latte_int` configure script detects lrslib and lidia if they are installed, so these packages should be order-only dependencies.

Issue created by migration from https://trac.sagemath.org/ticket/21700





---

archive/issue_comments_297905.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-10-13T17:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297905",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_297906.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-13T17:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297906",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_297907.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-13T17:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297907",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_297908.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-10-13T17:30:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297908",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_297909.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-10-14T07:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297909",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_297910.json:
```json
{
    "body": "Given that `lrslib` and `lidia` are libraries, they should be real dependencies.",
    "created_at": "2016-10-14T07:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297910",
    "user": "jdemeyer"
}
```

Given that `lrslib` and `lidia` are libraries, they should be real dependencies.



---

archive/issue_comments_297911.json:
```json
{
    "body": "They are optional for latte_int. This means that one can build latte_int with or without them.",
    "created_at": "2016-10-14T07:14:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297911",
    "user": "mkoeppe"
}
```

They are optional for latte_int. This means that one can build latte_int with or without them.



---

archive/issue_comments_297912.json:
```json
{
    "body": "Replying to [comment:6 mkoeppe]:\n> They are optional for latte_int. This means that one can build latte_int with or without them.\n\nThat is an argument for *not* adding those dependencies. It's not an argument for adding them as *order-only* dependencies.",
    "created_at": "2016-10-14T07:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297912",
    "user": "jdemeyer"
}
```

Replying to [comment:6 mkoeppe]:
> They are optional for latte_int. This means that one can build latte_int with or without them.

That is an argument for *not* adding those dependencies. It's not an argument for adding them as *order-only* dependencies.



---

archive/issue_comments_297913.json:
```json
{
    "body": "If the user types \"make latte_int lidia\", then that user should get a latte built with lidia. Hence, an order only dependency.",
    "created_at": "2016-10-14T07:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297913",
    "user": "mkoeppe"
}
```

If the user types "make latte_int lidia", then that user should get a latte built with lidia. Hence, an order only dependency.



---

archive/issue_comments_297914.json:
```json
{
    "body": "Replying to [comment:8 mkoeppe]:\n> If the user types \"make latte_int lidia\", then that user should get a latte built with lidia. Hence, an order only dependency.\n\nThat works with a real dependency as well as an order-only dependency, so it's still not an argument for an order-only dependency.",
    "created_at": "2016-10-14T07:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297914",
    "user": "jdemeyer"
}
```

Replying to [comment:8 mkoeppe]:
> If the user types "make latte_int lidia", then that user should get a latte built with lidia. Hence, an order only dependency.

That works with a real dependency as well as an order-only dependency, so it's still not an argument for an order-only dependency.



---

archive/issue_comments_297915.json:
```json
{
    "body": "I see what you want now, but what you want doesn't work. There is no way to tell `make` that something should be a dependency only if it's installed. An order-only dependency is really the opposite of that: an order-only dependency is a dependency if it's *not* installed.",
    "created_at": "2016-10-14T07:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297915",
    "user": "jdemeyer"
}
```

I see what you want now, but what you want doesn't work. There is no way to tell `make` that something should be a dependency only if it's installed. An order-only dependency is really the opposite of that: an order-only dependency is a dependency if it's *not* installed.



---

archive/issue_comments_297916.json:
```json
{
    "body": "If the user types \"make latte_int\" and lidia is not installed, then lidia should not be installed.\nHence an order only dependency, not a real dependency.",
    "created_at": "2016-10-14T07:32:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297916",
    "user": "mkoeppe"
}
```

If the user types "make latte_int" and lidia is not installed, then lidia should not be installed.
Hence an order only dependency, not a real dependency.



---

archive/issue_comments_297917.json:
```json
{
    "body": "I think you may be right, but it's past midnight here, so I can't be sure.",
    "created_at": "2016-10-14T07:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297917",
    "user": "mkoeppe"
}
```

I think you may be right, but it's past midnight here, so I can't be sure.



---

archive/issue_comments_297918.json:
```json
{
    "body": "Replying to [comment:11 mkoeppe]:\n> If the user types \"make latte_int\" and lidia is not installed, then lidia should not be installed.\n> Hence an order only dependency, not a real dependency.\n\nLike I said in [comment:10], order-only dependencies don't work that way.",
    "created_at": "2016-10-14T08:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297918",
    "user": "jdemeyer"
}
```

Replying to [comment:11 mkoeppe]:
> If the user types "make latte_int" and lidia is not installed, then lidia should not be installed.
> Hence an order only dependency, not a real dependency.

Like I said in [comment:10], order-only dependencies don't work that way.



---

archive/issue_comments_297919.json:
```json
{
    "body": "Thanks. You are right. I was confused about order-only dependencies. \n\nI'll update the ticket description",
    "created_at": "2016-10-15T01:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297919",
    "user": "mkoeppe"
}
```

Thanks. You are right. I was confused about order-only dependencies. 

I'll update the ticket description



---

archive/issue_comments_297920.json:
```json
{
    "body": "I suppose a simple solution could be to have two packages:\n- `latte_int` (which perhaps disables `lrslib` and `lidia` detection in the name of reproducibility of the build) and `latte_int_full` (which has `lrslib` and `lidia` as dependencies).\n- and likewise `polymake` (a minimal configuration) and `polymake_full` (which pulls in a dozen packages).",
    "created_at": "2016-10-15T02:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297920",
    "user": "mkoeppe"
}
```

I suppose a simple solution could be to have two packages:
- `latte_int` (which perhaps disables `lrslib` and `lidia` detection in the name of reproducibility of the build) and `latte_int_full` (which has `lrslib` and `lidia` as dependencies).
- and likewise `polymake` (a minimal configuration) and `polymake_full` (which pulls in a dozen packages).



---

archive/issue_comments_297921.json:
```json
{
    "body": "Why not add `lrslib` and `lidia` unconditionally as dependencies of `latte_int`?",
    "created_at": "2016-10-15T07:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297921",
    "user": "jdemeyer"
}
```

Why not add `lrslib` and `lidia` unconditionally as dependencies of `latte_int`?



---

archive/issue_comments_297922.json:
```json
{
    "body": "Replying to [comment:17 jdemeyer]:\n> Why not add `lrslib` and `lidia` unconditionally as dependencies of `latte_int`?\n\nSee #22491 for such an implementation (it does not pretend to address the general issue mentioned in the current ticket).\n\nAccording to Matthias, one reason for not doing that could be that lidia is rather big and long to compile.",
    "created_at": "2017-03-02T10:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297922",
    "user": "tmonteil"
}
```

Replying to [comment:17 jdemeyer]:
> Why not add `lrslib` and `lidia` unconditionally as dependencies of `latte_int`?

See #22491 for such an implementation (it does not pretend to address the general issue mentioned in the current ticket).

According to Matthias, one reason for not doing that could be that lidia is rather big and long to compile.



---

archive/issue_comments_297923.json:
```json
{
    "body": "Changing component from packages: experimental to build: configure.",
    "created_at": "2020-09-13T19:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297923",
    "user": "mkoeppe"
}
```

Changing component from packages: experimental to build: configure.



---

archive/issue_comments_297924.json:
```json
{
    "body": "Regarding this part of the ticket description:\n\nReplying to [ticket:21700 mkoeppe]:\n> Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int`, but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.\n\nIt is better to do `make lidia && make latte_int` since `sage -i lidia` will build `lidia` and everything after it. (So if you have a fresh tarball, `sage -i lidia` will build all of Sage). So `sage -i lidia && sage -i latte_int` may cause some packages to be built twice.\n\n(This isn't questioning the main point, that the order in which these are built is important and not taken care of with the current build system.)",
    "created_at": "2020-09-14T16:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297924",
    "user": "jhpalmieri"
}
```

Regarding this part of the ticket description:

Replying to [ticket:21700 mkoeppe]:
> Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int`, but **we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used**.

It is better to do `make lidia && make latte_int` since `sage -i lidia` will build `lidia` and everything after it. (So if you have a fresh tarball, `sage -i lidia` will build all of Sage). So `sage -i lidia && sage -i latte_int` may cause some packages to be built twice.

(This isn't questioning the main point, that the order in which these are built is important and not taken care of with the current build system.)



---

archive/issue_comments_297925.json:
```json
{
    "body": "Thanks, I have updated the ticket description",
    "created_at": "2020-09-14T19:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297925",
    "user": "mkoeppe"
}
```

Thanks, I have updated the ticket description



---

archive/issue_comments_297926.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297926",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_297927.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21463",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21463#issuecomment-297927",
    "user": "mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.
