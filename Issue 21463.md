# Issue 21463: latte_int: Add order-only dependencies

Issue created by migration from Trac.

Original creator: mkoeppe

Original creation time: 2016-10-13 17:01:39

CC:  tscrim dimpase vdelecroix jhpalmieri slelievre

The `latte_int` configure script detects lrslib and lidia if they are installed, so these packages should be order-only dependencies.


---

Comment by mkoeppe created at 2016-10-13 17:10:23

New commits:


---

Comment by mkoeppe created at 2016-10-13 17:10:23

Changing status from new to needs_review.


---

Comment by git created at 2016-10-13 17:12:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-10-13 17:30:13

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2016-10-14 07:11:06

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2016-10-14 07:11:06

Given that `lrslib` and `lidia` are libraries, they should be real dependencies.


---

Comment by mkoeppe created at 2016-10-14 07:14:58

They are optional for latte_int. This means that one can build latte_int with or without them.


---

Comment by jdemeyer created at 2016-10-14 07:20:58

Replying to [comment:6 mkoeppe]:
> They are optional for latte_int. This means that one can build latte_int with or without them.

That is an argument for _not_ adding those dependencies. It's not an argument for adding them as _order-only_ dependencies.


---

Comment by mkoeppe created at 2016-10-14 07:24:28

If the user types "make latte_int lidia", then that user should get a latte built with lidia. Hence, an order only dependency.


---

Comment by jdemeyer created at 2016-10-14 07:26:44

Replying to [comment:8 mkoeppe]:
> If the user types "make latte_int lidia", then that user should get a latte built with lidia. Hence, an order only dependency.

That works with a real dependency as well as an order-only dependency, so it's still not an argument for an order-only dependency.


---

Comment by jdemeyer created at 2016-10-14 07:31:15

I see what you want now, but what you want doesn't work. There is no way to tell `make` that something should be a dependency only if it's installed. An order-only dependency is really the opposite of that: an order-only dependency is a dependency if it's _not_ installed.


---

Comment by mkoeppe created at 2016-10-14 07:32:50

If the user types "make latte_int" and lidia is not installed, then lidia should not be installed.
Hence an order only dependency, not a real dependency.


---

Comment by mkoeppe created at 2016-10-14 07:40:34

I think you may be right, but it's past midnight here, so I can't be sure.


---

Comment by jdemeyer created at 2016-10-14 08:43:56

Replying to [comment:11 mkoeppe]:
> If the user types "make latte_int" and lidia is not installed, then lidia should not be installed.
> Hence an order only dependency, not a real dependency.

Like I said in [comment:10], order-only dependencies don't work that way.


---

Comment by mkoeppe created at 2016-10-15 01:38:56

Thanks. You are right. I was confused about order-only dependencies. 

I'll update the ticket description


---

Comment by mkoeppe created at 2016-10-15 02:05:28

I suppose a simple solution could be to have two packages:
 - `latte_int` (which perhaps disables `lrslib` and `lidia` detection in the name of reproducibility of the build) and `latte_int_full` (which has `lrslib` and `lidia` as dependencies).
 - and likewise `polymake` (a minimal configuration) and `polymake_full` (which pulls in a dozen packages).


---

Comment by jdemeyer created at 2016-10-15 07:29:18

Why not add `lrslib` and `lidia` unconditionally as dependencies of `latte_int`?


---

Comment by tmonteil created at 2017-03-02 10:36:23

Replying to [comment:17 jdemeyer]:
> Why not add `lrslib` and `lidia` unconditionally as dependencies of `latte_int`?

See #22491 for such an implementation (it does not pretend to address the general issue mentioned in the current ticket).

According to Matthias, one reason for not doing that could be that lidia is rather big and long to compile.


---

Comment by mkoeppe created at 2020-09-13 19:45:36

Changing component from packages: experimental to build: configure.


---

Comment by jhpalmieri created at 2020-09-14 16:31:40

Regarding this part of the ticket description:

Replying to [ticket:21700 mkoeppe]:
> Of course, the user can just work around this issue by doing `sage -i lidia && sage -i latte_int`, but *we must find a proper solution that ensures reproducible (deterministic) builds when a parallelized make is used*.

It is better to do `make lidia && make latte_int` since `sage -i lidia` will build `lidia` and everything after it. (So if you have a fresh tarball, `sage -i lidia` will build all of Sage). So `sage -i lidia && sage -i latte_int` may cause some packages to be built twice.

(This isn't questioning the main point, that the order in which these are built is important and not taken care of with the current build system.)


---

Comment by mkoeppe created at 2020-09-14 19:00:44

Thanks, I have updated the ticket description


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.
