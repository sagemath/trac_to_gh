# Issue 29424: Some optimizations for method regions of hyperplane arrangements

archive/issues_029424.json:
```json
{
    "body": "CC:  @jplab @laisrast @sophiasage\n\nKeywords: hyerplane arrangements, regions\n\nThere are some easy optimzations that speed up the computation of regions of hyperplane arrangements:\n\n- To see if an hyperplane intersects a polyhedron non-trivially can be done by quickly checking the evaluation of the hyperplane normal on the Vrepresentation. This is much faster than computing two new polyhedra every time.\n- In case of a linear hyperplane arrangement, we can only consider the upper half space with respect to the first hyperplane and then append to each region the negative.\n\nBefore this ticket:\n\n\n```\nsage: from itertools import product\nsage: def zero_one(d):\n....:     for x in product([0,1], repeat=d):\n....:         if any(y for y in x):\n....:             yield [0] + list(x)\n....:          \nsage: K.<x,y,z> = HyperplaneArrangements(QQ)\nsage: A = K(*zero_one(3))\nsage: %time len(A.regions())\nCPU times: user 141 ms, sys: 7.6 ms, total: 148 ms\nWall time: 146 ms\n32\nsage: K.<x,y,z,w> = HyperplaneArrangements(QQ)\nsage: A = K(*zero_one(4))\nsage: %time len(A.regions())\nCPU times: user 1.64 s, sys: 18.2 ms, total: 1.66 s\nWall time: 1.66 s\n370\nsage: K.<x,y,z,w,r> = HyperplaneArrangements(QQ)\nsage: A = K(*zero_one(5))\nsage: %time len(A.regions())\nCPU times: user 2min 2s, sys: 298 ms, total: 2min 2s\nWall time: 2min 2s\n11292\n```\n\n\nWith this ticket:\n\n\n```\nsage: K.<x,y,z,w,r> = HyperplaneArrangements(QQ)\nsage: A = K(*zero_one(5))\nsage: %time len(A.regions())\nCPU times: user 22.7 s, sys: 73.1 ms, total: 22.8 s\nWall time: 22.8 s\n11292\nsage: K.<x,y,z> = HyperplaneArrangements(QQ)\nsage: A = K(*zero_one(3))\nsage: %time len(A.regions())\nCPU times: user 46.4 ms, sys: 8.03 ms, total: 54.4 ms\nWall time: 53 ms\n32\nsage: K.<x,y,z,w> = HyperplaneArrangements(QQ)\nsage: A = K(*zero_one(4))\nsage: %time len(A.regions())\nCPU times: user 1.05 s, sys: 4.01 ms, total: 1.05 s\nWall time: 1.05 s\n370\nsage: K.<x,y,z,w,r> = HyperplaneArrangements(QQ)\nsage: A = K(*zero_one(5))\nsage: %time len(A.regions())\nCPU times: user 22.2 s, sys: 31.8 ms, total: 22.2 s\nWall time: 22.2 s\n11292\nsage: %time y = tuple(-P for P in A.regions())\nCPU times: user 10.7 s, sys: 124 ms, total: 10.8 s\nWall time: 10.8 s\n```\n\n\nThe last timing indicates that half of the time in this example is taken just to create the object and cannot be improved (in this method).\n\nIssue created by migration from https://trac.sagemath.org/ticket/29661\n\n",
    "created_at": "2020-05-07T19:03:04Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Some optimizations for method regions of hyperplane arrangements",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29424",
    "user": "https://github.com/kliem"
}
```
CC:  @jplab @laisrast @sophiasage

Keywords: hyerplane arrangements, regions

There are some easy optimzations that speed up the computation of regions of hyperplane arrangements:

- To see if an hyperplane intersects a polyhedron non-trivially can be done by quickly checking the evaluation of the hyperplane normal on the Vrepresentation. This is much faster than computing two new polyhedra every time.
- In case of a linear hyperplane arrangement, we can only consider the upper half space with respect to the first hyperplane and then append to each region the negative.

Before this ticket:


```
sage: from itertools import product
sage: def zero_one(d):
....:     for x in product([0,1], repeat=d):
....:         if any(y for y in x):
....:             yield [0] + list(x)
....:          
sage: K.<x,y,z> = HyperplaneArrangements(QQ)
sage: A = K(*zero_one(3))
sage: %time len(A.regions())
CPU times: user 141 ms, sys: 7.6 ms, total: 148 ms
Wall time: 146 ms
32
sage: K.<x,y,z,w> = HyperplaneArrangements(QQ)
sage: A = K(*zero_one(4))
sage: %time len(A.regions())
CPU times: user 1.64 s, sys: 18.2 ms, total: 1.66 s
Wall time: 1.66 s
370
sage: K.<x,y,z,w,r> = HyperplaneArrangements(QQ)
sage: A = K(*zero_one(5))
sage: %time len(A.regions())
CPU times: user 2min 2s, sys: 298 ms, total: 2min 2s
Wall time: 2min 2s
11292
```


With this ticket:


```
sage: K.<x,y,z,w,r> = HyperplaneArrangements(QQ)
sage: A = K(*zero_one(5))
sage: %time len(A.regions())
CPU times: user 22.7 s, sys: 73.1 ms, total: 22.8 s
Wall time: 22.8 s
11292
sage: K.<x,y,z> = HyperplaneArrangements(QQ)
sage: A = K(*zero_one(3))
sage: %time len(A.regions())
CPU times: user 46.4 ms, sys: 8.03 ms, total: 54.4 ms
Wall time: 53 ms
32
sage: K.<x,y,z,w> = HyperplaneArrangements(QQ)
sage: A = K(*zero_one(4))
sage: %time len(A.regions())
CPU times: user 1.05 s, sys: 4.01 ms, total: 1.05 s
Wall time: 1.05 s
370
sage: K.<x,y,z,w,r> = HyperplaneArrangements(QQ)
sage: A = K(*zero_one(5))
sage: %time len(A.regions())
CPU times: user 22.2 s, sys: 31.8 ms, total: 22.2 s
Wall time: 22.2 s
11292
sage: %time y = tuple(-P for P in A.regions())
CPU times: user 10.7 s, sys: 124 ms, total: 10.8 s
Wall time: 10.8 s
```


The last timing indicates that half of the time in this example is taken just to create the object and cannot be improved (in this method).

Issue created by migration from https://trac.sagemath.org/ticket/29661





---

archive/issue_comments_416970.json:
```json
{
    "body": "Note that this ticket is motivated by a new implementation in polymake by Lars Kastner and Marta Panizzut, see [https://arxiv.org/pdf/2003.13548.pdf](https://arxiv.org/pdf/2003.13548.pdf).\n\nThe example to benchmark is taken from their paper.\n----\nNew commits:",
    "created_at": "2020-05-07T19:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416970",
    "user": "https://github.com/kliem"
}
```

Note that this ticket is motivated by a new implementation in polymake by Lars Kastner and Marta Panizzut, see [https://arxiv.org/pdf/2003.13548.pdf](https://arxiv.org/pdf/2003.13548.pdf).

The example to benchmark is taken from their paper.
----
New commits:



---

archive/issue_comments_416971.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-05-07T19:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416971",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_416972.json:
```json
{
    "body": "One comment:\n\nProbably a comment like\n\n```diff\n+                # Determine if all vertices lie on one side of the hyperplane.\n+                splits = False\n+                direction = 0\n```\n\n\nWould complete the following one:\n\n\n```diff\n+                if not splits:\n+                    # All vertices lie in one closed halfspace of the hyperplane.\n```\n\n\nI am a bit perturbed by the for loop followed by an if statement that ultimately modify the value of `splits`. Is there a way to fusion them and keep the efficiency provided by the `break`?\n\nBut now that I look at it more, probably it is the best way to do so. Hm.\n\nAnother thing: if the algorithm you wrote is described in the article you mention, it should be added in the documentation of the function.",
    "created_at": "2020-05-11T11:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416972",
    "user": "https://github.com/jplab"
}
```

One comment:

Probably a comment like

```diff
+                # Determine if all vertices lie on one side of the hyperplane.
+                splits = False
+                direction = 0
```


Would complete the following one:


```diff
+                if not splits:
+                    # All vertices lie in one closed halfspace of the hyperplane.
```


I am a bit perturbed by the for loop followed by an if statement that ultimately modify the value of `splits`. Is there a way to fusion them and keep the efficiency provided by the `break`?

But now that I look at it more, probably it is the best way to do so. Hm.

Another thing: if the algorithm you wrote is described in the article you mention, it should be added in the documentation of the function.



---

archive/issue_comments_416973.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-05-11T11:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416973",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_416974.json:
```json
{
    "body": "No, it's not their algorithm. It's exactly the algorithm that Volker Braun implemented back in 2013 (according to `git blame`). It's just that I looked at the paper and their timings and compared it to Sage. Sage was faster, but I realized that with the above two simple observations we can make it even faster. I would expect their algorithm to perform better asymptotically and/or on some other classes of hyperplane arrangements. Their algorithm computes first a full-dimensional cell and then works it's way through the region by \"reflecting\" on the hyperplanes. So I would guess that they pay a big penalty for that, which only pays  of in large examples.\n\nI came up with both ideas optimizing Sage's approach myself. I don't see anything like this mentioned in their paper, but I will ask them about that.",
    "created_at": "2020-05-11T11:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416974",
    "user": "https://github.com/kliem"
}
```

No, it's not their algorithm. It's exactly the algorithm that Volker Braun implemented back in 2013 (according to `git blame`). It's just that I looked at the paper and their timings and compared it to Sage. Sage was faster, but I realized that with the above two simple observations we can make it even faster. I would expect their algorithm to perform better asymptotically and/or on some other classes of hyperplane arrangements. Their algorithm computes first a full-dimensional cell and then works it's way through the region by "reflecting" on the hyperplanes. So I would guess that they pay a big penalty for that, which only pays  of in large examples.

I came up with both ideas optimizing Sage's approach myself. I don't see anything like this mentioned in their paper, but I will ask them about that.



---

archive/issue_comments_416975.json:
```json
{
    "body": "Replying to [comment:3 gh-kliem]:\n> No, it's not their algorithm. It's exactly the algorithm that Volker Braun implemented back in 2013 (according to `git blame`). It's just that I looked at the paper and their timings and compared it to Sage. Sage was faster, but I realized that with the above two simple observations we can make it even faster. I would expect their algorithm to perform better asymptotically and/or on some other classes of hyperplane arrangements. Their algorithm computes first a full-dimensional cell and then works it's way through the region by \"reflecting\" on the hyperplanes. So I would guess that they pay a big penalty for that, which only pays  of in large examples.\n> \n> I came up with both ideas optimizing Sage's approach myself. I don't see anything like this mentioned in their paper, but I will ask them about that.\n\nOk, fine. Just making sure.",
    "created_at": "2020-05-11T12:26:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416975",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:3 gh-kliem]:
> No, it's not their algorithm. It's exactly the algorithm that Volker Braun implemented back in 2013 (according to `git blame`). It's just that I looked at the paper and their timings and compared it to Sage. Sage was faster, but I realized that with the above two simple observations we can make it even faster. I would expect their algorithm to perform better asymptotically and/or on some other classes of hyperplane arrangements. Their algorithm computes first a full-dimensional cell and then works it's way through the region by "reflecting" on the hyperplanes. So I would guess that they pay a big penalty for that, which only pays  of in large examples.
> 
> I came up with both ideas optimizing Sage's approach myself. I don't see anything like this mentioned in their paper, but I will ask them about that.

Ok, fine. Just making sure.



---

archive/issue_comments_416976.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-05-11T12:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416976",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_416977.json:
```json
{
    "body": "Btw, is there a way to obtain a n-dimensional hyperplane arrangement without concretely specifying the generators?\n----\nNew commits:",
    "created_at": "2020-05-11T12:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416977",
    "user": "https://github.com/kliem"
}
```

Btw, is there a way to obtain a n-dimensional hyperplane arrangement without concretely specifying the generators?
----
New commits:



---

archive/issue_comments_416978.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-11T12:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416978",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416979.json:
```json
{
    "body": "Replying to [comment:5 gh-kliem]:\n> Btw, is there a way to obtain a n-dimensional hyperplane arrangement without concretely specifying the generators?\n\nYou mean for example something like a library of hyperplane arrangements?\n\nThere is\n\n\n```\nsage: p = polytopes.simplex()\nsage: p.hyperplane_arrangement()\nArrangement of 5 hyperplanes of dimension 4 and rank 4\n```\n\n\nDo you mean whether hyperplane arrangements accept other types of input?",
    "created_at": "2020-05-11T12:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416979",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:5 gh-kliem]:
> Btw, is there a way to obtain a n-dimensional hyperplane arrangement without concretely specifying the generators?

You mean for example something like a library of hyperplane arrangements?

There is


```
sage: p = polytopes.simplex()
sage: p.hyperplane_arrangement()
Arrangement of 5 hyperplanes of dimension 4 and rank 4
```


Do you mean whether hyperplane arrangements accept other types of input?



---

archive/issue_comments_416980.json:
```json
{
    "body": "Thanks. That's not exactly what I meant. But it helped.\n\nI was looking for something like\n\n```\nHyperplaneArrangements(ZZ, dim=5)\n```\n\nthat just figures out some meaningful generators, but I guess one extra line does the job (as is illustrated in the method `hyperplane_arrangement`):\n\n```\nnames = tuple('t' + str(i) for i in range(5))\nHyperplaneArrangements(ZZ, names)\n```\n",
    "created_at": "2020-05-11T12:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416980",
    "user": "https://github.com/kliem"
}
```

Thanks. That's not exactly what I meant. But it helped.

I was looking for something like

```
HyperplaneArrangements(ZZ, dim=5)
```

that just figures out some meaningful generators, but I guess one extra line does the job (as is illustrated in the method `hyperplane_arrangement`):

```
names = tuple('t' + str(i) for i in range(5))
HyperplaneArrangements(ZZ, names)
```




---

archive/issue_comments_416981.json:
```json
{
    "body": "Replying to [comment:8 gh-kliem]:\n> Thanks. That's not exactly what I meant. But it helped.\n> \n> I was looking for something like\n> {{{\n> HyperplaneArrangements(ZZ, dim=5)\n> }}}\n> that just figures out some meaningful generators, but I guess one extra line does the job (as is illustrated in the method `hyperplane_arrangement`):\n> {{{\n> names = tuple('t' + str(i) for i in range(5))\n> HyperplaneArrangements(ZZ, names)\n> }}}\n\nAhhh. Yes, I got you. Yes... I like this method too, it is better for internal usage...",
    "created_at": "2020-05-11T13:01:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416981",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:8 gh-kliem]:
> Thanks. That's not exactly what I meant. But it helped.
> 
> I was looking for something like
> {{{
> HyperplaneArrangements(ZZ, dim=5)
> }}}
> that just figures out some meaningful generators, but I guess one extra line does the job (as is illustrated in the method `hyperplane_arrangement`):
> {{{
> names = tuple('t' + str(i) for i in range(5))
> HyperplaneArrangements(ZZ, names)
> }}}

Ahhh. Yes, I got you. Yes... I like this method too, it is better for internal usage...



---

archive/issue_comments_416982.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-11T16:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416982",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416983.json:
```json
{
    "body": "Two minor comments:\n\n\n```diff\n-Example 6 of [KP2020]::\n+Example 6 of [KP2020]_::\n```\n\nin order to get the link.\n\nTo avoid some repeated calls:\n\n```diff\n+                    region_lines = region.lines()\n                     if direction == 0:\n                         # In this case all vertices lie on the hyperplane and we must\n                         # check if rays are contained in one closed halfspace given by the hyperplane.\n                         valuations = tuple(ieq[1:]*ray[:] for ray in region.rays())\n-                        if region.lines():\n-                            valuations += tuple(ieq[1:]*line[:] for line in region.lines())\n-                            valuations += tuple(-ieq[1:]*line[:] for line in region.lines())\n+                        if region_lines:\n+                            valuations += tuple(ieq[1:]*line[:] for line in region_lines)\n+                            valuations += tuple(-ieq[1:]*line[:] for line in region_lines)\n                         if any(x > 0 for x in valuations) and any(x < 0 for x in valuations):\n                             splits = True\n                     else:\n                         # In this case, at least one of the vertices is not on the hyperplane.\n                         # So we check if any ray or line pokes the hyperplane.\n-                        if any(ieq[1:]*r[:]*direction < 0 for r in region.rays()) or \\\n-                                any(ieq[1:]*l[:] != 0 for l in region.lines()):\n+                        if any(ieq[1:]*r[:]*direction < 0 for r in region.rays()) or\n+                               any(ieq[1:]*l[:] != 0 for l in region_lines):\n                             splits = True\n```\n",
    "created_at": "2020-05-12T01:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416983",
    "user": "https://github.com/tscrim"
}
```

Two minor comments:


```diff
-Example 6 of [KP2020]::
+Example 6 of [KP2020]_::
```

in order to get the link.

To avoid some repeated calls:

```diff
+                    region_lines = region.lines()
                     if direction == 0:
                         # In this case all vertices lie on the hyperplane and we must
                         # check if rays are contained in one closed halfspace given by the hyperplane.
                         valuations = tuple(ieq[1:]*ray[:] for ray in region.rays())
-                        if region.lines():
-                            valuations += tuple(ieq[1:]*line[:] for line in region.lines())
-                            valuations += tuple(-ieq[1:]*line[:] for line in region.lines())
+                        if region_lines:
+                            valuations += tuple(ieq[1:]*line[:] for line in region_lines)
+                            valuations += tuple(-ieq[1:]*line[:] for line in region_lines)
                         if any(x > 0 for x in valuations) and any(x < 0 for x in valuations):
                             splits = True
                     else:
                         # In this case, at least one of the vertices is not on the hyperplane.
                         # So we check if any ray or line pokes the hyperplane.
-                        if any(ieq[1:]*r[:]*direction < 0 for r in region.rays()) or \
-                                any(ieq[1:]*l[:] != 0 for l in region.lines()):
+                        if any(ieq[1:]*r[:]*direction < 0 for r in region.rays()) or
+                               any(ieq[1:]*l[:] != 0 for l in region_lines):
                             splits = True
```




---

archive/issue_comments_416984.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-12T05:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416984",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416985.json:
```json
{
    "body": "Thank you. I applied that.\n\nThe backslash in the if clause is needed though.\nI also don't understand why I should adjust the alignment the way you suggested.\nIt looks nicer, but it suggests that the second clause is part of the any-clause, doesn't it?\n\nReplying to [comment:11 tscrim]:\n> Two minor comments:\n> \n> {{{#!diff\n> -Example 6 of [KP2020]::\n> +Example 6 of [KP2020]_::\n> }}}\n> in order to get the link.\n> \n> To avoid some repeated calls:\n> {{{#!diff\n> +                    region_lines = region.lines()\n>                      if direction == 0:\n>                          # In this case all vertices lie on the hyperplane and we must\n>                          # check if rays are contained in one closed halfspace given by the hyperplane.\n>                          valuations = tuple(ieq[1:]*ray[:] for ray in region.rays())\n> -                        if region.lines():\n> -                            valuations += tuple(ieq[1:]*line[:] for line in region.lines())\n> -                            valuations += tuple(-ieq[1:]*line[:] for line in region.lines())\n> +                        if region_lines:\n> +                            valuations += tuple(ieq[1:]*line[:] for line in region_lines)\n> +                            valuations += tuple(-ieq[1:]*line[:] for line in region_lines)\n>                          if any(x > 0 for x in valuations) and any(x < 0 for x in valuations):\n>                              splits = True\n>                      else:\n>                          # In this case, at least one of the vertices is not on the hyperplane.\n>                          # So we check if any ray or line pokes the hyperplane.\n> -                        if any(ieq[1:]*r[:]*direction < 0 for r in region.rays()) or \\\n> -                                any(ieq[1:]*l[:] != 0 for l in region.lines()):\n> +                        if any(ieq[1:]*r[:]*direction < 0 for r in region.rays()) or\n> +                               any(ieq[1:]*l[:] != 0 for l in region_lines):\n>                              splits = True\n> }}}",
    "created_at": "2020-05-12T05:38:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416985",
    "user": "https://github.com/kliem"
}
```

Thank you. I applied that.

The backslash in the if clause is needed though.
I also don't understand why I should adjust the alignment the way you suggested.
It looks nicer, but it suggests that the second clause is part of the any-clause, doesn't it?

Replying to [comment:11 tscrim]:
> Two minor comments:
> 
> {{{#!diff
> -Example 6 of [KP2020]::
> +Example 6 of [KP2020]_::
> }}}
> in order to get the link.
> 
> To avoid some repeated calls:
> {{{#!diff
> +                    region_lines = region.lines()
>                      if direction == 0:
>                          # In this case all vertices lie on the hyperplane and we must
>                          # check if rays are contained in one closed halfspace given by the hyperplane.
>                          valuations = tuple(ieq[1:]*ray[:] for ray in region.rays())
> -                        if region.lines():
> -                            valuations += tuple(ieq[1:]*line[:] for line in region.lines())
> -                            valuations += tuple(-ieq[1:]*line[:] for line in region.lines())
> +                        if region_lines:
> +                            valuations += tuple(ieq[1:]*line[:] for line in region_lines)
> +                            valuations += tuple(-ieq[1:]*line[:] for line in region_lines)
>                          if any(x > 0 for x in valuations) and any(x < 0 for x in valuations):
>                              splits = True
>                      else:
>                          # In this case, at least one of the vertices is not on the hyperplane.
>                          # So we check if any ray or line pokes the hyperplane.
> -                        if any(ieq[1:]*r[:]*direction < 0 for r in region.rays()) or \
> -                                any(ieq[1:]*l[:] != 0 for l in region.lines()):
> +                        if any(ieq[1:]*r[:]*direction < 0 for r in region.rays()) or
> +                               any(ieq[1:]*l[:] != 0 for l in region_lines):
>                              splits = True
> }}}



---

archive/issue_comments_416986.json:
```json
{
    "body": "Replying to [comment:13 gh-kliem]:\n> The backslash in the if clause is needed though.\n\nAh right. I miscounted the number of parentheses.\n\n> I also don't understand why I should adjust the alignment the way you suggested.\n> It looks nicer, but it suggests that the second clause is part of the any-clause, doesn't it?\n\nSee the previous point. I agree with not changing the alignment. If I was coding this, I would have done it like this:\n\n```python\n                        if (any(ieq[1:]*r[:]*direction < 0 for r in region.rays())\n                            or any(ieq[1:]*l[:] != 0 for l in region_lines)):\n```\n\nHowever, that is my style and my general desire to avoid the `\\` so it generates an error if things are not properly matched. So don't feel you have to change it.",
    "created_at": "2020-05-12T05:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416986",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:13 gh-kliem]:
> The backslash in the if clause is needed though.

Ah right. I miscounted the number of parentheses.

> I also don't understand why I should adjust the alignment the way you suggested.
> It looks nicer, but it suggests that the second clause is part of the any-clause, doesn't it?

See the previous point. I agree with not changing the alignment. If I was coding this, I would have done it like this:

```python
                        if (any(ieq[1:]*r[:]*direction < 0 for r in region.rays())
                            or any(ieq[1:]*l[:] != 0 for l in region_lines)):
```

However, that is my style and my general desire to avoid the `\` so it generates an error if things are not properly matched. So don't feel you have to change it.



---

archive/issue_comments_416987.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-12T06:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416987",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416988.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-12T06:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416988",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416989.json:
```json
{
    "body": "I never thought about using parenthesis to avoid backslash. I like that.\n\nThe reason that I often do something like `or` or `+` at the end of the line, is that it makes it easier to align both lines alike:\n\n\n```\nif (any(ieq[1:]*r[:]*direction < 0 for r in region.rays()) or\n    any(ieq[1:]*l[:]          != 0 for l in region_lines)):\n```\n",
    "created_at": "2020-05-12T06:37:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416989",
    "user": "https://github.com/kliem"
}
```

I never thought about using parenthesis to avoid backslash. I like that.

The reason that I often do something like `or` or `+` at the end of the line, is that it makes it easier to align both lines alike:


```
if (any(ieq[1:]*r[:]*direction < 0 for r in region.rays()) or
    any(ieq[1:]*l[:]          != 0 for l in region_lines)):
```




---

archive/issue_comments_416990.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-12T06:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416990",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_416991.json:
```json
{
    "body": "Changing keywords from \"hyerplane arrangements, regions\" to \"hyperplane arrangements, regions\".",
    "created_at": "2020-05-12T09:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416991",
    "user": "https://github.com/jplab"
}
```

Changing keywords from "hyerplane arrangements, regions" to "hyperplane arrangements, regions".



---

archive/issue_comments_416992.json:
```json
{
    "body": "It looks good to me. If Travis agrees, I suggest to give positive review.",
    "created_at": "2020-05-12T09:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416992",
    "user": "https://github.com/jplab"
}
```

It looks good to me. If Travis agrees, I suggest to give positive review.



---

archive/issue_comments_416993.json:
```json
{
    "body": "Yep, I am happy with it. Thanks.",
    "created_at": "2020-05-12T09:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416993",
    "user": "https://github.com/tscrim"
}
```

Yep, I am happy with it. Thanks.



---

archive/issue_comments_416994.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-05-12T09:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416994",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_416995.json:
```json
{
    "body": "Thank you.",
    "created_at": "2020-05-12T10:12:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416995",
    "user": "https://github.com/kliem"
}
```

Thank you.



---

archive/issue_events_075833.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-06-03T22:32:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29424#event-75833"
}
```



---

archive/issue_comments_416996.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-06-03T22:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29424#issuecomment-416996",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
