# Issue 19144: Refactor Graph.__init__

Issue created by migration from https://trac.sagemath.org/ticket/19381

Original creator: ncohen

Original creation time: 2015-10-09 10:53:10

CC:  borassi dcoudert dimpase vdelecroix

This (very unpleasant) ticket attempts to clean a bit more the content of `Graph.__init__`.

To this end, it creates a `graph_input` modules that gathers into individual functions the different pieces of code that build a graph from <any other data>.

Admittedly, this is just one step toward a cleaner graph constructor, but we are not there yet.

Nothing smart is done in this branch: the pieces of code from `Graph.__init__` are moved to new individual functions (some variables/parameters are renamed). One from `DiGraph.__init__` is moved too.

In particular, some pieces of code from `DiGraph.__init__` may eventually be merged with the functions that this branch creates, but this will be done later.

This branch is already sufficiently long and sufficiently unpleasant to write/review `:-/`

Nathann


---

Comment by ncohen created at 2015-10-09 10:54:25

Last 10 new commits:


---

Comment by ncohen created at 2015-10-09 10:54:25

Changing status from new to needs_review.


---

Comment by tscrim created at 2015-10-09 11:54:42

Would it be possible in this ticket to add support for constructing a graph by `[V, E]` like this:

```
sage: V = [1,2,3,4]
sage: E = [[1,2]]
sage: Graph([V, E])
```

I know I can do it like this

```
sage: G = Graph({1:[2], 2:[], 3:[], 4:[]})
sage: G.vertices()
[1, 2, 3, 4]
```

but this is somewhat cumbersome (and doesn't work for graphs with labeled (multiple) edges). The other way I know how to do this is I have to pass the edge set, then add the vertices.

The reason I ask is because I have wanted to create immutable graphs with larger vertex sets than the connectivity of the edges and I don't want to have to waste time copying a mutable graph backend into the static backend. (As an additional reason, it also follows the basic intro to combinatorics definition of a graph.)

I should also be able to review this ticket too (and I definitely will if you make the above change).


---

Comment by ncohen created at 2015-10-09 12:01:01

> Would it be possible in this ticket to add support for constructing a graph by `[V, E]` like this:

Certainly not in this ticket. It refactors code, and it is already (as you can see) a lot to review. I guess it can be done in another ticket, though, I don't thing that there is any problem. With 5-6 lines any ambiguity with the other kind of inputs can be cleared ([V,f], list_of_edges, ...)

> I know I can do it like this
> {{{
> sage: G = Graph({1:[2], 2:[], 3:[], 4:[]})
> sage: G.vertices()
> [1, 2, 3, 4]
> }}}
> but this is somewhat cumbersome (and doesn't work for graphs with labeled (multiple) edges).


```
sage: Graph({1:{2:['l1','l2']}},multiedges=True).edges()
[(1, 2, 'l1'), (1, 2, 'l2')]
```


See also `Graph.to_dictionary` which generates this kind of output.

Nathann


---

Comment by dcoudert created at 2015-10-09 14:03:55

- `Note: This is a internal...` -> 'an internal`?

Preliminary tests are ok and the doc build and display properly.
I'm currently running tests on `sage/graphs/`. I'll let you know soon.


---

Comment by git created at 2015-10-09 14:30:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2015-10-09 16:27:14

hey, your commit messages have the ticket number wrong...


---

Comment by dcoudert created at 2015-10-09 16:30:03

For me the patch is good to go, but I don't know if Nathann has something to do about the commit ticket numbers...

Note: the (possible) segfault in the test `src/sage/graphs` is independent from this patch and is resolved in #19337.


---

Comment by git created at 2015-10-09 16:31:38

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by dimpase created at 2015-10-09 16:39:22

Replying to [comment:7 dcoudert]:
> For me the patch is good to go, but I don't know if Nathann has something to do about the commit ticket numbers...

well, he adds these numbers by hand. 
If you think it's OK, then it's OK with me, too.

> 
> Note: the (possible) segfault in the test `src/sage/graphs` is independent from this patch and is resolved in #19337.


---

Comment by dcoudert created at 2015-10-09 16:40:16

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2015-10-09 16:40:16

Then let's go!


---

Comment by ncohen created at 2015-10-09 18:21:52

Thaaaaaaaaanks for this quick review `O_O`

Nathann


---

Comment by vbraun created at 2015-10-14 00:59:19

Resolution: fixed
