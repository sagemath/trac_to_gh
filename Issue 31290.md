# Issue 31290: spkg-configure.m4 for polymake

archive/issues_031290.json:
```json
{
    "body": "CC:  @videlec @jplab @kliem paffenholz@opt.tu-darmstadt.de @antonio-rojas @dimpase @orlitzky\n\nPolymake is available on a number of systems (https://repology.org/project/polymake/versions) and also on Homebrew via a custom tap: https://polymake.org/doku.php/download/start#binary_releases\n\nWe add system package info and `spkg-configure.m4`\n\nIssue created by migration from https://trac.sagemath.org/ticket/31527\n\n",
    "created_at": "2021-03-20T04:55:42Z",
    "labels": [
        "component: packages: optional"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "spkg-configure.m4 for polymake",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31290",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @videlec @jplab @kliem paffenholz@opt.tu-darmstadt.de @antonio-rojas @dimpase @orlitzky

Polymake is available on a number of systems (https://repology.org/project/polymake/versions) and also on Homebrew via a custom tap: https://polymake.org/doku.php/download/start#binary_releases

We add system package info and `spkg-configure.m4`

Issue created by migration from https://trac.sagemath.org/ticket/31527





---

archive/issue_comments_446652.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-03-20T06:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446652",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_446653.json:
```json
{
    "body": "With polymake from Andreas's tap, need to do `export PERL5LIB=\"/usr/local/Cellar/polymake/4.3_1/libexec/perl5/lib/perl5/darwin-thread-multi-2level:/usr/local/Cellar/polymake/4.3_1/libexec/perl5/lib/perl5\"` (this is done in the `polymake` script but we use the callable library through jupymake)",
    "created_at": "2021-03-20T06:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446653",
    "user": "https://github.com/mkoeppe"
}
```

With polymake from Andreas's tap, need to do `export PERL5LIB="/usr/local/Cellar/polymake/4.3_1/libexec/perl5/lib/perl5/darwin-thread-multi-2level:/usr/local/Cellar/polymake/4.3_1/libexec/perl5/lib/perl5"` (this is done in the `polymake` script but we use the callable library through jupymake)



---

archive/issue_comments_446654.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-03-20T06:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446654",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_446655.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-20T07:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446655",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446656.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-20T07:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446656",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446657.json:
```json
{
    "body": "Replying to [comment:3 mkoeppe]:\n> With polymake from Andreas's tap, need to do `export PERL5LIB=\"/usr/local/Cellar/polymake/4.3_1/libexec/perl5/lib/perl5/darwin-thread-multi-2level:/usr/local/Cellar/polymake/4.3_1/libexec/perl5/lib/perl5\"` (this is done in the `polymake` script but we use the callable library through jupymake)\n\nSetting this globally unfortunately breaks autotools (`aclocal`) from homebrew:\n\n```\nUsage: DynaLoader::dl_find_symbol(libhandle, symbolname) at /usr/local/Cellar/polymake/4.3_1/libexec/perl5/lib/perl5/darwin-thread-multi-2level/XSLoader.pm line 89.\nCompilation failed in require at /usr/local/Cellar/polymake/4.3_1/libexec/perl5/lib/perl5/File/Path.pm line 6.\nBEGIN failed--compilation aborted at /usr/local/Cellar/polymake/4.3_1/libexec/perl5/lib/perl5/File/Path.pm line 6.\nCompilation failed in require at /usr/local/bin/aclocal line 33.\nBEGIN failed--compilation aborted at /usr/local/bin/aclocal line 33.\n```\n\nToo bad that `polymake-config` does not advertise the necessary Perl library path...",
    "created_at": "2021-03-20T16:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446657",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:3 mkoeppe]:
> With polymake from Andreas's tap, need to do `export PERL5LIB="/usr/local/Cellar/polymake/4.3_1/libexec/perl5/lib/perl5/darwin-thread-multi-2level:/usr/local/Cellar/polymake/4.3_1/libexec/perl5/lib/perl5"` (this is done in the `polymake` script but we use the callable library through jupymake)

Setting this globally unfortunately breaks autotools (`aclocal`) from homebrew:

```
Usage: DynaLoader::dl_find_symbol(libhandle, symbolname) at /usr/local/Cellar/polymake/4.3_1/libexec/perl5/lib/perl5/darwin-thread-multi-2level/XSLoader.pm line 89.
Compilation failed in require at /usr/local/Cellar/polymake/4.3_1/libexec/perl5/lib/perl5/File/Path.pm line 6.
BEGIN failed--compilation aborted at /usr/local/Cellar/polymake/4.3_1/libexec/perl5/lib/perl5/File/Path.pm line 6.
Compilation failed in require at /usr/local/bin/aclocal line 33.
BEGIN failed--compilation aborted at /usr/local/bin/aclocal line 33.
```

Too bad that `polymake-config` does not advertise the necessary Perl library path...



---

archive/issue_comments_446658.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-20T21:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446658",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_082827.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-02T20:21:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31290#event-82827"
}
```



---

archive/issue_comments_446659.json:
```json
{
    "body": "Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage",
    "created_at": "2021-04-02T20:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446659",
    "user": "https://github.com/mkoeppe"
}
```

Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage



---

archive/issue_comments_446660.json:
```json
{
    "body": "Saving the continuation:\n\nJuPyMake/JuPyMake.cpp at master \u00b7 sebasguts/JuPyMake\nhttps://github.com/sebasguts/JuPyMake/blob/master/JuPyMake.cpp\n\njupyter-polymake/kernel.py at master \u00b7 polymake/jupyter-polymake\nhttps://github.com/polymake/jupyter-polymake/blob/master/jupyter_kernel_polymake/kernel.py\n\njupyter-kernel-polymake \u00b7 PyPI\nhttps://pypi.org/project/jupyter-kernel-polymake/\n\nFailed to install on OSX Mojave Mac::SystemDirectory is not installed. \u00b7 Issue #39 \u00b7 sqitchers/homebrew-sqitch\nhttps://github.com/sqitchers/homebrew-sqitch/issues/39\n\ntokuhirom/plenv: Perl binary manager\nhttps://github.com/tokuhirom/plenv\n\npolymake Downloads [polymake wiki]\nhttps://polymake.org/doku.php/download/start",
    "created_at": "2021-04-12T23:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446660",
    "user": "https://github.com/mkoeppe"
}
```

Saving the continuation:

JuPyMake/JuPyMake.cpp at master · sebasguts/JuPyMake
https://github.com/sebasguts/JuPyMake/blob/master/JuPyMake.cpp

jupyter-polymake/kernel.py at master · polymake/jupyter-polymake
https://github.com/polymake/jupyter-polymake/blob/master/jupyter_kernel_polymake/kernel.py

jupyter-kernel-polymake · PyPI
https://pypi.org/project/jupyter-kernel-polymake/

Failed to install on OSX Mojave Mac::SystemDirectory is not installed. · Issue #39 · sqitchers/homebrew-sqitch
https://github.com/sqitchers/homebrew-sqitch/issues/39

tokuhirom/plenv: Perl binary manager
https://github.com/tokuhirom/plenv

polymake Downloads [polymake wiki]
https://polymake.org/doku.php/download/start



---

archive/issue_comments_446661.json:
```json
{
    "body": "Perlbrew\nhttps://perlbrew.pl/\n\ngugod/App-perlbrew: Manage perl installations in your $HOME\nhttps://github.com/gugod/App-perlbrew\n\nApp::perlbrew - Manage perl installations in your $HOME - metacpan.org\nhttps://metacpan.org/pod/App::perlbrew\n\npolymake Downloads [polymake wiki]\nhttps://polymake.org/doku.php/download/start#binary_releases\n\nperl:mongodb package versions - Repology\nhttps://repology.org/project/perl:mongodb/versions",
    "created_at": "2021-04-12T23:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446661",
    "user": "https://github.com/mkoeppe"
}
```

Perlbrew
https://perlbrew.pl/

gugod/App-perlbrew: Manage perl installations in your $HOME
https://github.com/gugod/App-perlbrew

App::perlbrew - Manage perl installations in your $HOME - metacpan.org
https://metacpan.org/pod/App::perlbrew

polymake Downloads [polymake wiki]
https://polymake.org/doku.php/download/start#binary_releases

perl:mongodb package versions - Repology
https://repology.org/project/perl:mongodb/versions



---

archive/issue_comments_446662.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-05-18T01:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446662",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_events_082828.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-11T22:19:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31290#event-82828"
}
```



---

archive/issue_events_082829.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-11T22:19:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31290#event-82829"
}
```



---

archive/issue_comments_446663.json:
```json
{
    "body": "Replying to [comment:3 mkoeppe]:\n> With polymake from Andreas's tap, need to do `export PERL5LIB=\"[...]\"` (this is done in the `polymake` script but we use the callable library through jupymake)\n\nFixed in latest version of the homebrew formula according to https://github.com/polymake/polybundle/issues/19#issuecomment-938612849",
    "created_at": "2021-10-08T16:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446663",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:3 mkoeppe]:
> With polymake from Andreas's tap, need to do `export PERL5LIB="[...]"` (this is done in the `polymake` script but we use the callable library through jupymake)

Fixed in latest version of the homebrew formula according to https://github.com/polymake/polybundle/issues/19#issuecomment-938612849



---

archive/issue_comments_446664.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-10-08T16:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446664",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_446665.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-10-08T21:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446665",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_446666.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-08T21:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446666",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446667.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-08T21:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446667",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_446668.json:
```json
{
    "body": "Tested successfully on homebrew",
    "created_at": "2021-10-08T21:22:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446668",
    "user": "https://github.com/mkoeppe"
}
```

Tested successfully on homebrew



---

archive/issue_comments_446669.json:
```json
{
    "body": "Testing with `tox -e docker-ubuntu-groovy-maximal`, where `configure` accepts system polymake 4.1-4build1, gives many doctest failures of the form:\n\n```\n      File \"/sage/local/lib/python3.8/site-packages/sage/interfaces/polymake.py\", line 2598, in _start\n        InitializePolymake()          # Can only be called once\n    JuPyMake.PolymakeError: polymake::Main - /usr/lib/polymake/shared is not a symlink\n```\n\nIndeed: \n\n```\nls -l /usr/lib/polymake/\ntotal 12\n-rw-r--r-- 1 root root 2024 Aug 17  2020 config.ninja\ndrwxr-xr-x 2 root root 4096 Oct  8 21:18 lib\ndrwxr-xr-x 3 root root 4096 Oct  8 21:18 perlx\n```\n",
    "created_at": "2021-10-09T00:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446669",
    "user": "https://github.com/mkoeppe"
}
```

Testing with `tox -e docker-ubuntu-groovy-maximal`, where `configure` accepts system polymake 4.1-4build1, gives many doctest failures of the form:

```
      File "/sage/local/lib/python3.8/site-packages/sage/interfaces/polymake.py", line 2598, in _start
        InitializePolymake()          # Can only be called once
    JuPyMake.PolymakeError: polymake::Main - /usr/lib/polymake/shared is not a symlink
```

Indeed: 

```
ls -l /usr/lib/polymake/
total 12
-rw-r--r-- 1 root root 2024 Aug 17  2020 config.ninja
drwxr-xr-x 2 root root 4096 Oct  8 21:18 lib
drwxr-xr-x 3 root root 4096 Oct  8 21:18 perlx
```




---

archive/issue_comments_446670.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-10-09T00:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446670",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_446671.json:
```json
{
    "body": "... so clearly we need to extend `spkg-configure.m4` to test that libpolymake has not been debianized to death",
    "created_at": "2021-10-09T00:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446671",
    "user": "https://github.com/mkoeppe"
}
```

... so clearly we need to extend `spkg-configure.m4` to test that libpolymake has not been debianized to death



---

archive/issue_comments_446672.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-09T00:48:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446672",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446673.json:
```json
{
    "body": "Now correctly rejects polymake on this system (`tox -e docker-ubuntu-groovy-maximal -- config.status`)",
    "created_at": "2021-10-09T00:49:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446673",
    "user": "https://github.com/mkoeppe"
}
```

Now correctly rejects polymake on this system (`tox -e docker-ubuntu-groovy-maximal -- config.status`)



---

archive/issue_comments_446674.json:
```json
{
    "body": "Same on `ubuntu-impish-maximal` (with system polymake 4.3)",
    "created_at": "2021-10-09T00:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446674",
    "user": "https://github.com/mkoeppe"
}
```

Same on `ubuntu-impish-maximal` (with system polymake 4.3)



---

archive/issue_comments_446675.json:
```json
{
    "body": "On `fedora-34-maximal`:\n\n```\nconfigure:34443: checking whether libpolymake works\nconfigure:34479: g++ -o conftest  -I/usr/include/polymake/external -I/usr/include/arb -I/usr/include/eigen3 -I/usr/include/gfanlib -I/usr/include/nauty -I/usr/include -I/usr/include -DPOLYMAKE_VERSION=404 -fPIC -pipe -O2 -flto=auto -ffat-lto-objects -fexceptions -g -grecord-gcc-switches -pipe -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1 -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -Wno-unused-local-typedefs -std=c++14 -ftemplate-depth-200 -fno-strict-aliasing -fopenmp -Wshadow -Wlogical-op -Wconversion -Wzero-as-null-pointer-constant -Wno-parentheses -Wno-error=unused-function -Wno-stringop-overflow -Wno-array-bounds -Wno-maybe-uninitialized -Wno-free-nonheap-object -DPOLYMAKE_WITH_FLINT -O2 -DPOLYMAKE_DEBUG=0   -Dlinux   -I/usr/include -lpolymake -Wl,-z,relro -Wl,--as-needed -lnormaliz -ldl -fuse-ld=gold -fopenmp -L/usr/lib64 -Wl,-E  conftest.cpp -lmpfi -lmpc -lm4rie -llrcalc -lnauty -lhomfly -liml -lgiac -lecm -lpari -lcurl -lcliquer -lcddgmp -lbz2 -lflint -lmpfr -lglpk -lgmp -lm  -lntl -lLfunction >&5\ncc1plus: error: '-Wformat-security' ignored without '-Wformat' [-Werror=format-security]\ncc1plus: some warnings being treated as errors\n```\n",
    "created_at": "2021-10-09T01:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446675",
    "user": "https://github.com/mkoeppe"
}
```

On `fedora-34-maximal`:

```
configure:34443: checking whether libpolymake works
configure:34479: g++ -o conftest  -I/usr/include/polymake/external -I/usr/include/arb -I/usr/include/eigen3 -I/usr/include/gfanlib -I/usr/include/nauty -I/usr/include -I/usr/include -DPOLYMAKE_VERSION=404 -fPIC -pipe -O2 -flto=auto -ffat-lto-objects -fexceptions -g -grecord-gcc-switches -pipe -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1 -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -Wno-unused-local-typedefs -std=c++14 -ftemplate-depth-200 -fno-strict-aliasing -fopenmp -Wshadow -Wlogical-op -Wconversion -Wzero-as-null-pointer-constant -Wno-parentheses -Wno-error=unused-function -Wno-stringop-overflow -Wno-array-bounds -Wno-maybe-uninitialized -Wno-free-nonheap-object -DPOLYMAKE_WITH_FLINT -O2 -DPOLYMAKE_DEBUG=0   -Dlinux   -I/usr/include -lpolymake -Wl,-z,relro -Wl,--as-needed -lnormaliz -ldl -fuse-ld=gold -fopenmp -L/usr/lib64 -Wl,-E  conftest.cpp -lmpfi -lmpc -lm4rie -llrcalc -lnauty -lhomfly -liml -lgiac -lecm -lpari -lcurl -lcliquer -lcddgmp -lbz2 -lflint -lmpfr -lglpk -lgmp -lm  -lntl -lLfunction >&5
cc1plus: error: '-Wformat-security' ignored without '-Wformat' [-Werror=format-security]
cc1plus: some warnings being treated as errors
```




---

archive/issue_comments_446676.json:
```json
{
    "body": "Same on `fedora-35-maximal`\n\nSo system polymake is rejected. This is correct because building jupymake would fail with the same error.",
    "created_at": "2021-10-09T02:07:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446676",
    "user": "https://github.com/mkoeppe"
}
```

Same on `fedora-35-maximal`

So system polymake is rejected. This is correct because building jupymake would fail with the same error.



---

archive/issue_comments_446677.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-09T02:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446677",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446678.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-09T02:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446678",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446679.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-10-09T03:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446679",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_446680.json:
```json
{
    "body": "needs a rebase",
    "created_at": "2021-10-12T09:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446680",
    "user": "https://github.com/dimpase"
}
```

needs a rebase



---

archive/issue_comments_446681.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-12T17:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446681",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446682.json:
```json
{
    "body": "gentoo's polymake is too old atm, it's 3.0_p2 there (and broken).",
    "created_at": "2021-10-12T20:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446682",
    "user": "https://github.com/dimpase"
}
```

gentoo's polymake is too old atm, it's 3.0_p2 there (and broken).



---

archive/issue_comments_446683.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-12T21:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446683",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446684.json:
```json
{
    "body": "Let's get this in please",
    "created_at": "2021-10-19T22:11:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446684",
    "user": "https://github.com/mkoeppe"
}
```

Let's get this in please



---

archive/issue_comments_446685.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-10-20T10:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446685",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_446686.json:
```json
{
    "body": "fails to recognize polymake on Fedora 34 with polymake package installed, due to\n`-Werror=format-security` in `g++` call from `./configure`.\n\n\n```\nconfigure:36908: checking for polymake-config >= 3.5\nconfigure:36984: result: /usr/bin/polymake-config\nconfigure:36989: checking whether libpolymake works\nconfigure:37025: g++ -o conftest  -I/usr/include/polymake/external -I/usr/include/arb -I/usr/include/eigen3 -I/usr/include/gfanlib -I/usr/include/nauty -I/usr/include -I/usr/include -DPOLYMAKE_VERSION=404 -fPIC -pipe -O2 -flto=auto -ffat-lto-objects -fexceptions -g -grecord-gcc-switches -pipe -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1 -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -Wno-unused-local-typedefs -std=c++14 -ftemplate-depth-200 -fno-strict-aliasing -fopenmp -Wshadow -Wlogical-op -Wconversion -Wzero-as-null-pointer-constant -Wno-parentheses -Wno-error=unused-function -Wno-stringop-overflow -Wno-array-bounds -Wno-maybe-uninitialized -Wno-free-nonheap-object -DPOLYMAKE_WITH_FLINT -O2 -DPOLYMAKE_DEBUG=0   -Dlinux   -I/usr/include -lpolymake -Wl,-z,relro -Wl,--as-needed -lnormaliz -ldl -fuse-ld=gold -fopenmp -L/usr/lib64 -Wl,-E  conftest.cpp -lmpfi -lmpc -lm4rie -llrcalc -lnauty -lhomfly -liml -lgiac -lecm -lpari -lcurl -lcliquer -lcddgmp -lbz2 -lflint -lmpfr -lglpk -lgmp -lm  -lntl -lLfunction >&5\ncc1plus: error: '-Wformat-security' ignored without '-Wformat' [-Werror=format-security]\ncc1plus: some warnings being treated as errors\n```\n\n\nAnd `Werror` gets there from `polymake-config --cflags` call.\n\n```\n$ polymake-config --cflags\n-DPOLYMAKE_VERSION=404 -fPIC -pipe -O2 -flto=auto -ffat-lto-objects -fexceptions -g -grecord-gcc-switches -pipe -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1 -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -Wno-unused-local-typedefs -std=c++14 -ftemplate-depth-200 -fno-strict-aliasing -fopenmp -Wshadow -Wlogical-op -Wconversion -Wzero-as-null-pointer-constant -Wno-parentheses -Wno-error=unused-function -Wno-stringop-overflow -Wno-array-bounds -Wno-maybe-uninitialized -Wno-free-nonheap-object -DPOLYMAKE_WITH_FLINT -O2 -DPOLYMAKE_DEBUG=0\n```\n",
    "created_at": "2021-10-20T10:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446686",
    "user": "https://github.com/dimpase"
}
```

fails to recognize polymake on Fedora 34 with polymake package installed, due to
`-Werror=format-security` in `g++` call from `./configure`.


```
configure:36908: checking for polymake-config >= 3.5
configure:36984: result: /usr/bin/polymake-config
configure:36989: checking whether libpolymake works
configure:37025: g++ -o conftest  -I/usr/include/polymake/external -I/usr/include/arb -I/usr/include/eigen3 -I/usr/include/gfanlib -I/usr/include/nauty -I/usr/include -I/usr/include -DPOLYMAKE_VERSION=404 -fPIC -pipe -O2 -flto=auto -ffat-lto-objects -fexceptions -g -grecord-gcc-switches -pipe -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1 -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -Wno-unused-local-typedefs -std=c++14 -ftemplate-depth-200 -fno-strict-aliasing -fopenmp -Wshadow -Wlogical-op -Wconversion -Wzero-as-null-pointer-constant -Wno-parentheses -Wno-error=unused-function -Wno-stringop-overflow -Wno-array-bounds -Wno-maybe-uninitialized -Wno-free-nonheap-object -DPOLYMAKE_WITH_FLINT -O2 -DPOLYMAKE_DEBUG=0   -Dlinux   -I/usr/include -lpolymake -Wl,-z,relro -Wl,--as-needed -lnormaliz -ldl -fuse-ld=gold -fopenmp -L/usr/lib64 -Wl,-E  conftest.cpp -lmpfi -lmpc -lm4rie -llrcalc -lnauty -lhomfly -liml -lgiac -lecm -lpari -lcurl -lcliquer -lcddgmp -lbz2 -lflint -lmpfr -lglpk -lgmp -lm  -lntl -lLfunction >&5
cc1plus: error: '-Wformat-security' ignored without '-Wformat' [-Werror=format-security]
cc1plus: some warnings being treated as errors
```


And `Werror` gets there from `polymake-config --cflags` call.

```
$ polymake-config --cflags
-DPOLYMAKE_VERSION=404 -fPIC -pipe -O2 -flto=auto -ffat-lto-objects -fexceptions -g -grecord-gcc-switches -pipe -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1 -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -Wno-unused-local-typedefs -std=c++14 -ftemplate-depth-200 -fno-strict-aliasing -fopenmp -Wshadow -Wlogical-op -Wconversion -Wzero-as-null-pointer-constant -Wno-parentheses -Wno-error=unused-function -Wno-stringop-overflow -Wno-array-bounds -Wno-maybe-uninitialized -Wno-free-nonheap-object -DPOLYMAKE_WITH_FLINT -O2 -DPOLYMAKE_DEBUG=0
```




---

archive/issue_comments_446687.json:
```json
{
    "body": "If I clean up CPPFLAGS as follows\n\n```diff\n--- a/build/pkgs/polymake/spkg-configure.m4\n+++ b/build/pkgs/polymake/spkg-configure.m4\n@@ -20,6 +20,7 @@ SAGE_SPKG_CONFIGURE([polymake], [\n            saved_LDFLAGS=\"$LDFLAGS\"\n            CXX=\"$($ac_cv_path_POLYMAKE_CONFIG --cc)\"\n            CPPFLAGS=\"$($ac_cv_path_POLYMAKE_CONFIG --includes) $($ac_cv_path_POLYMAKE_CONFIG --cflags) $CPPFLAGS\"\n+           CPPFLAGS=${CPPFLAGS//\\-Werror=format\\-security/}\n            LDFLAGS=\"-lpolymake $($ac_cv_path_POLYMAKE_CONFIG --ldflags) $LDFLAGS\"\n            AC_RUN_IFELSE([AC_LANG_PROGRAM([[\n                #include <polymake/Main.h>\n```\n\n then I still get\n\n\n\n```\nconfigure:36989: checking whether libpolymake works\nconfigure:37026: g++ -o conftest  -I/usr/include/polymake/external -I/usr/include/arb -I/usr/include/eigen3 -I/usr/include/gfanlib -I/usr/include/nauty -I/usr/include -I/usr/include -DPOLYMAKE_VERSION=404 -fPIC -pipe -O2 -flto=auto -ffat-lto-objects -fexceptions -g -grecord-gcc-switches -pipe  -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1 -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -Wno-unused-local-typedefs -std=c++14 -ftemplate-depth-200 -fno-strict-aliasing -fopenmp -Wshadow -Wlogical-op -Wconversion -Wzero-as-null-pointer-constant -Wno-parentheses -Wno-error=unused-function -Wno-stringop-overflow -Wno-array-bounds -Wno-maybe-uninitialized -Wno-free-nonheap-object -DPOLYMAKE_WITH_FLINT -O2 -DPOLYMAKE_DEBUG=0   -Dlinux   -I/usr/include -lpolymake -Wl,-z,relro -Wl,--as-needed -lnormaliz -ldl -fuse-ld=gold -fopenmp -L/usr/lib64 -Wl,-E  conftest.cpp -lmpfi -lmpc -lm4rie -llrcalc -lnauty -lhomfly -liml -lgiac -lecm -lpari -lcurl -lcliquer -lcddgmp -lbz2 -lflint -lmpfr -lglpk -lgmp -lm  -lntl -lLfunction >&5\nconfigure:37026: $? = 0\nconfigure:37026: ./conftest\nCan't locate Polymake/Main.pm in @INC (you may need to install the Polymake::Main module) (@INC contains: /share/polymake/perllib /lib64/polymake/perlx/5.32.1/x86_64-linux-thread-multi /lib64/polymake/perlx/5.32.1 /lib64/polymake/perlx /users/dimpase/perl5/lib/perl5/x86_64-linux-thread-multi /users/dimpase/perl5/lib/perl5 /usr/local/lib64/perl5/5.32 /usr/local/share/perl5/5.32 /usr/lib64/perl5/vendor_perl /usr/share/perl5/vendor_perl /usr/lib64/perl5 /usr/share/perl5) at /builddir/build/BUILD/polymake-4.4/lib/callable/src/perl/Main.cc line 146.\nBEGIN failed--compilation aborted at /builddir/build/BUILD/polymake-4.4/lib/callable/src/perl/Main.cc line 146.\nterminate called after throwing an instance of 'std::runtime_error'\n  what():  could not initialize the perl interpreter\n./configure: line 3495: 1808668 Aborted                 (core dumped) ./conftest$ac_exeext\nconfigure:37026: $? = 134\nconfigure: program exited with status 134\n```\n",
    "created_at": "2021-10-20T13:52:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446687",
    "user": "https://github.com/dimpase"
}
```

If I clean up CPPFLAGS as follows

```diff
--- a/build/pkgs/polymake/spkg-configure.m4
+++ b/build/pkgs/polymake/spkg-configure.m4
@@ -20,6 +20,7 @@ SAGE_SPKG_CONFIGURE([polymake], [
            saved_LDFLAGS="$LDFLAGS"
            CXX="$($ac_cv_path_POLYMAKE_CONFIG --cc)"
            CPPFLAGS="$($ac_cv_path_POLYMAKE_CONFIG --includes) $($ac_cv_path_POLYMAKE_CONFIG --cflags) $CPPFLAGS"
+           CPPFLAGS=${CPPFLAGS//\-Werror=format\-security/}
            LDFLAGS="-lpolymake $($ac_cv_path_POLYMAKE_CONFIG --ldflags) $LDFLAGS"
            AC_RUN_IFELSE([AC_LANG_PROGRAM([[
                #include <polymake/Main.h>
```

 then I still get



```
configure:36989: checking whether libpolymake works
configure:37026: g++ -o conftest  -I/usr/include/polymake/external -I/usr/include/arb -I/usr/include/eigen3 -I/usr/include/gfanlib -I/usr/include/nauty -I/usr/include -I/usr/include -DPOLYMAKE_VERSION=404 -fPIC -pipe -O2 -flto=auto -ffat-lto-objects -fexceptions -g -grecord-gcc-switches -pipe  -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -specs=/usr/lib/rpm/redhat/redhat-annobin-cc1 -m64 -mtune=generic -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection -Wno-unused-local-typedefs -std=c++14 -ftemplate-depth-200 -fno-strict-aliasing -fopenmp -Wshadow -Wlogical-op -Wconversion -Wzero-as-null-pointer-constant -Wno-parentheses -Wno-error=unused-function -Wno-stringop-overflow -Wno-array-bounds -Wno-maybe-uninitialized -Wno-free-nonheap-object -DPOLYMAKE_WITH_FLINT -O2 -DPOLYMAKE_DEBUG=0   -Dlinux   -I/usr/include -lpolymake -Wl,-z,relro -Wl,--as-needed -lnormaliz -ldl -fuse-ld=gold -fopenmp -L/usr/lib64 -Wl,-E  conftest.cpp -lmpfi -lmpc -lm4rie -llrcalc -lnauty -lhomfly -liml -lgiac -lecm -lpari -lcurl -lcliquer -lcddgmp -lbz2 -lflint -lmpfr -lglpk -lgmp -lm  -lntl -lLfunction >&5
configure:37026: $? = 0
configure:37026: ./conftest
Can't locate Polymake/Main.pm in @INC (you may need to install the Polymake::Main module) (@INC contains: /share/polymake/perllib /lib64/polymake/perlx/5.32.1/x86_64-linux-thread-multi /lib64/polymake/perlx/5.32.1 /lib64/polymake/perlx /users/dimpase/perl5/lib/perl5/x86_64-linux-thread-multi /users/dimpase/perl5/lib/perl5 /usr/local/lib64/perl5/5.32 /usr/local/share/perl5/5.32 /usr/lib64/perl5/vendor_perl /usr/share/perl5/vendor_perl /usr/lib64/perl5 /usr/share/perl5) at /builddir/build/BUILD/polymake-4.4/lib/callable/src/perl/Main.cc line 146.
BEGIN failed--compilation aborted at /builddir/build/BUILD/polymake-4.4/lib/callable/src/perl/Main.cc line 146.
terminate called after throwing an instance of 'std::runtime_error'
  what():  could not initialize the perl interpreter
./configure: line 3495: 1808668 Aborted                 (core dumped) ./conftest$ac_exeext
configure:37026: $? = 134
configure: program exited with status 134
```




---

archive/issue_comments_446688.json:
```json
{
    "body": "Replying to [comment:44 dimpase]:\n> fails to recognize polymake on Fedora 34 with polymake package installed, due to\n> `-Werror=format-security` in `g++` call from `./configure`.\n\nYes, see comment:33.",
    "created_at": "2021-10-20T15:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446688",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:44 dimpase]:
> fails to recognize polymake on Fedora 34 with polymake package installed, due to
> `-Werror=format-security` in `g++` call from `./configure`.

Yes, see comment:33.



---

archive/issue_comments_446689.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-10-20T15:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446689",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_446690.json:
```json
{
    "body": "Changing component from packages: optional to build: configure.",
    "created_at": "2021-10-21T16:55:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446690",
    "user": "https://github.com/dimpase"
}
```

Changing component from packages: optional to build: configure.



---

archive/issue_comments_446691.json:
```json
{
    "body": "Is there any Linux distro with working for the purposes of this ticket Polymake package?",
    "created_at": "2021-10-21T17:36:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446691",
    "user": "https://github.com/dimpase"
}
```

Is there any Linux distro with working for the purposes of this ticket Polymake package?



---

archive/issue_comments_446692.json:
```json
{
    "body": "I don't remember if I tested with `arch`, `opensuse`, or `nix`.",
    "created_at": "2021-10-21T17:42:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446692",
    "user": "https://github.com/mkoeppe"
}
```

I don't remember if I tested with `arch`, `opensuse`, or `nix`.



---

archive/issue_comments_446693.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-21T20:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446693",
    "user": "https://github.com/antonio-rojas"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_446694.json:
```json
{
    "body": "Works fine on Arch. Picks up system polymake, Jupymake spkg installs correctly and all tests pass in `interfaces.polymake`",
    "created_at": "2021-10-21T20:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446694",
    "user": "https://github.com/antonio-rojas"
}
```

Works fine on Arch. Picks up system polymake, Jupymake spkg installs correctly and all tests pass in `interfaces.polymake`



---

archive/issue_comments_446695.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-10-21T20:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446695",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_comments_446696.json:
```json
{
    "body": "Replying to [comment:50 dimpase]:\n> Is there any Linux distro with working for the purposes of this ticket Polymake package?\n>\nGentoo with https://github.com/gentoo/gentoo/pull/17925\n\n```\nsage -t --long --random-seed=0 src/sage/interfaces/polymake.py\n    [54 tests, 0.63 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 0.7 seconds\n    cpu time: 0.1 seconds\n    cumulative wall time: 0.6 seconds\nTraceback (most recent call last):\n  File \"/usr/lib/python-exec/python3.10/sage-runtests\", line 159, in <module>\n    exit_code_pytest = pytest.main(pytest_options + args)\nTypeError: can only concatenate list (not \"Namespace\") to list\n```\n",
    "created_at": "2021-10-21T21:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446696",
    "user": "https://github.com/sheerluck"
}
```

Replying to [comment:50 dimpase]:
> Is there any Linux distro with working for the purposes of this ticket Polymake package?
>
Gentoo with https://github.com/gentoo/gentoo/pull/17925

```
sage -t --long --random-seed=0 src/sage/interfaces/polymake.py
    [54 tests, 0.63 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.7 seconds
    cpu time: 0.1 seconds
    cumulative wall time: 0.6 seconds
Traceback (most recent call last):
  File "/usr/lib/python-exec/python3.10/sage-runtests", line 159, in <module>
    exit_code_pytest = pytest.main(pytest_options + args)
TypeError: can only concatenate list (not "Namespace") to list
```




---

archive/issue_comments_446697.json:
```json
{
    "body": "Excellent!",
    "created_at": "2021-10-21T23:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446697",
    "user": "https://github.com/mkoeppe"
}
```

Excellent!



---

archive/issue_comments_446698.json:
```json
{
    "body": "The present branch appears to need `polymake` explictly listed in the list `--optional=`, if it's not installed. On arch I have:\n\n```\n$ ./sage -tp  src/sage/geometry/polyhedron/backend_polymake.py\nRunning doctests with ID 2021-10-22-08-52-35-89300609.\nGit branch: wip\nUsing --optional=arch,argcomplete,build,dochtml,jupymake,pip,sage,sage.rings.real_double,sage_spkg\nDoctesting 1 file using 4 threads.\nsage -t --warn-long 105.2 --random-seed=111795974516996210666725135263478181348 src/sage/geometry/polyhedron/backend_polymake.py\n    [9 tests, 0.52 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 0.6 seconds\n    cpu time: 0.5 seconds\n    cumulative wall time: 0.5 seconds\nPytest is not installed, skip checking tests that rely on it.\n```\n\nbut\n\n```\n$ ./sage -tp --optional=arch,argcomplete,build,dochtml,pip,sage,sage.rings.real_double,sage_spkg,polymake src/sage/geometry/polyhedron/backend_polymake.py\nRunning doctests with ID 2021-10-22-08-52-45-3599c25d.\nGit branch: wip\nUsing --optional=arch,argcomplete,build,dochtml,pip,polymake,sage,sage.rings.real_double,sage_spkg\nDoctesting 1 file using 4 threads.\nsage -t --warn-long 105.2 --random-seed=65107005796673777637867553513561507930 src/sage/geometry/polyhedron/backend_polymake.py\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/backend_polymake.py\", line 665, in sage.geometry.polyhedron.backend_polymake.Polyhedron_polymake.__setstate__\nFailed example:\n    print(\"Possible output\"); P = polytopes.dodecahedron(backend='polymake')  # optional - polymake\nException raised:\n    Traceback (most recent call last):\n      File \"/home/dima/sagetrac-mirror/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/interface.py\", line 732, in __init__\n        self._name = parent._create(value, name=name)\n      File \"/home/dima/sagetrac-mirror/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/polymake.py\", line 549, in _create\n        self.set(name, value)\n      File \"/home/dima/sagetrac-mirror/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/polymake.py\", line 638, in set\n        self.eval(cmd)\n      File \"/home/dima/sagetrac-mirror/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/polymake.py\", line 2712, in eval\n        raise PolymakeError(error)\n    sage.interfaces.polymake.PolymakeError: C++/perl Interface module compilation failed; most likely due to a type mismatch.\n    Set the variable $Polymake::User::Verbose::cpp to a positive value and repeat for more details.\n\n\n    During handling of the above exception, another exception occurred:\n...\n   TypeError: C++/perl Interface module compilation failed; most likely due to a type mismatch.\n    Set the variable $Polymake::User::Verbose::cpp to a positive value and repeat for more details.\n\n**********************************************************************\n1 item had failures:\n   1 of  21 in sage.geometry.polyhedron.backend_polymake.Polyhedron_polymake.__setstate__\n    [106 tests, 1 failure, 13.32 s]\n----------------------------------------------------------------------\nsage -t --warn-long 105.2 --random-seed=65107005796673777637867553513561507930 src/sage/geometry/polyhedron/backend_polymake.py  # 1 doctest failed\n```\n\n\nthere is a similar test failure in `src/sage/geometry/polyhedron/base.py`",
    "created_at": "2021-10-22T08:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446698",
    "user": "https://github.com/dimpase"
}
```

The present branch appears to need `polymake` explictly listed in the list `--optional=`, if it's not installed. On arch I have:

```
$ ./sage -tp  src/sage/geometry/polyhedron/backend_polymake.py
Running doctests with ID 2021-10-22-08-52-35-89300609.
Git branch: wip
Using --optional=arch,argcomplete,build,dochtml,jupymake,pip,sage,sage.rings.real_double,sage_spkg
Doctesting 1 file using 4 threads.
sage -t --warn-long 105.2 --random-seed=111795974516996210666725135263478181348 src/sage/geometry/polyhedron/backend_polymake.py
    [9 tests, 0.52 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.6 seconds
    cpu time: 0.5 seconds
    cumulative wall time: 0.5 seconds
Pytest is not installed, skip checking tests that rely on it.
```

but

```
$ ./sage -tp --optional=arch,argcomplete,build,dochtml,pip,sage,sage.rings.real_double,sage_spkg,polymake src/sage/geometry/polyhedron/backend_polymake.py
Running doctests with ID 2021-10-22-08-52-45-3599c25d.
Git branch: wip
Using --optional=arch,argcomplete,build,dochtml,pip,polymake,sage,sage.rings.real_double,sage_spkg
Doctesting 1 file using 4 threads.
sage -t --warn-long 105.2 --random-seed=65107005796673777637867553513561507930 src/sage/geometry/polyhedron/backend_polymake.py
**********************************************************************
File "src/sage/geometry/polyhedron/backend_polymake.py", line 665, in sage.geometry.polyhedron.backend_polymake.Polyhedron_polymake.__setstate__
Failed example:
    print("Possible output"); P = polytopes.dodecahedron(backend='polymake')  # optional - polymake
Exception raised:
    Traceback (most recent call last):
      File "/home/dima/sagetrac-mirror/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/interface.py", line 732, in __init__
        self._name = parent._create(value, name=name)
      File "/home/dima/sagetrac-mirror/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/polymake.py", line 549, in _create
        self.set(name, value)
      File "/home/dima/sagetrac-mirror/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/polymake.py", line 638, in set
        self.eval(cmd)
      File "/home/dima/sagetrac-mirror/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/sage/interfaces/polymake.py", line 2712, in eval
        raise PolymakeError(error)
    sage.interfaces.polymake.PolymakeError: C++/perl Interface module compilation failed; most likely due to a type mismatch.
    Set the variable $Polymake::User::Verbose::cpp to a positive value and repeat for more details.


    During handling of the above exception, another exception occurred:
...
   TypeError: C++/perl Interface module compilation failed; most likely due to a type mismatch.
    Set the variable $Polymake::User::Verbose::cpp to a positive value and repeat for more details.

**********************************************************************
1 item had failures:
   1 of  21 in sage.geometry.polyhedron.backend_polymake.Polyhedron_polymake.__setstate__
    [106 tests, 1 failure, 13.32 s]
----------------------------------------------------------------------
sage -t --warn-long 105.2 --random-seed=65107005796673777637867553513561507930 src/sage/geometry/polyhedron/backend_polymake.py  # 1 doctest failed
```


there is a similar test failure in `src/sage/geometry/polyhedron/base.py`



---

archive/issue_comments_446699.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-10-22T09:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446699",
    "user": "https://github.com/dimpase"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_446700.json:
```json
{
    "body": "We see that tests mentioned in comment:54 were not complete, as `polymake` was not in `--optional=` - if it were, we'd see many more tests (this is on Arch, again):\n\n```\n$ ./sage -tp --optional=arch,argcomplete,build,dochtml,pip,sage,sage.rings.real_double,sage_spkg,polymake src/sage/interfaces/polymake.py                 \nRunning doctests with ID 2021-10-22-08-58-24-8cc8a0d8.\nGit branch: wip\nUsing --optional=arch,argcomplete,build,dochtml,pip,polymake,sage,sage.rings.real_double,sage_spkg\nDoctesting 1 file using 4 threads.\nsage -t --warn-long 105.2 --random-seed=106731483408083137921384584724619392983 src/sage/interfaces/polymake.py\n    [253 tests, 5.28 s]\n----------------------------------------------------------------------\nAll tests passed!\n```\n",
    "created_at": "2021-10-22T09:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446700",
    "user": "https://github.com/dimpase"
}
```

We see that tests mentioned in comment:54 were not complete, as `polymake` was not in `--optional=` - if it were, we'd see many more tests (this is on Arch, again):

```
$ ./sage -tp --optional=arch,argcomplete,build,dochtml,pip,sage,sage.rings.real_double,sage_spkg,polymake src/sage/interfaces/polymake.py                 
Running doctests with ID 2021-10-22-08-58-24-8cc8a0d8.
Git branch: wip
Using --optional=arch,argcomplete,build,dochtml,pip,polymake,sage,sage.rings.real_double,sage_spkg
Doctesting 1 file using 4 threads.
sage -t --warn-long 105.2 --random-seed=106731483408083137921384584724619392983 src/sage/interfaces/polymake.py
    [253 tests, 5.28 s]
----------------------------------------------------------------------
All tests passed!
```




---

archive/issue_comments_446701.json:
```json
{
    "body": "`jupymake` should be in `build/pkgs/polymake/dependencies`, as `polymake` tests fail if it's not installed.\n\nAs well, `spkg-configure.m4` perhaps needs to at least print a warning if system's polymake it selected, or, better, use some (missing?) mechanism to trigger installation of `jupymake` in this case.",
    "created_at": "2021-10-22T09:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446701",
    "user": "https://github.com/dimpase"
}
```

`jupymake` should be in `build/pkgs/polymake/dependencies`, as `polymake` tests fail if it's not installed.

As well, `spkg-configure.m4` perhaps needs to at least print a warning if system's polymake it selected, or, better, use some (missing?) mechanism to trigger installation of `jupymake` in this case.



---

archive/issue_comments_446702.json:
```json
{
    "body": "Replying to [comment:57 dimpase]:\n> we'd see many more tests (this is on Arch, again):\n>     [253 tests, 5.28 s]\nyes, with that long `--optional=` I see all 253 tests passed too (on Gentoo)",
    "created_at": "2021-10-22T11:24:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446702",
    "user": "https://github.com/sheerluck"
}
```

Replying to [comment:57 dimpase]:
> we'd see many more tests (this is on Arch, again):
>     [253 tests, 5.28 s]
yes, with that long `--optional=` I see all 253 tests passed too (on Gentoo)



---

archive/issue_comments_446703.json:
```json
{
    "body": "Replying to [comment:58 dimpase]:\n> `jupymake` should be in `build/pkgs/polymake/dependencies`, as `polymake` tests fail if it's not installed.\n\nNo, this makes no sense. `jupymake` depends (at compile time) on `polymake`.",
    "created_at": "2021-10-22T15:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446703",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:58 dimpase]:
> `jupymake` should be in `build/pkgs/polymake/dependencies`, as `polymake` tests fail if it's not installed.

No, this makes no sense. `jupymake` depends (at compile time) on `polymake`.



---

archive/issue_comments_446704.json:
```json
{
    "body": "Replying to [comment:58 dimpase]:\n>  use some (missing?) mechanism to trigger installation of `jupymake` in this case.\n\nThis is a valid wishlist item.",
    "created_at": "2021-10-22T15:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446704",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:58 dimpase]:
>  use some (missing?) mechanism to trigger installation of `jupymake` in this case.

This is a valid wishlist item.



---

archive/issue_comments_446705.json:
```json
{
    "body": "then tag jupymake-dependent tests as such.",
    "created_at": "2021-10-22T16:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446705",
    "user": "https://github.com/dimpase"
}
```

then tag jupymake-dependent tests as such.



---

archive/issue_comments_446706.json:
```json
{
    "body": "The failure in comment:56, \n\n```\n   TypeError: C++/perl Interface module compilation failed; most likely due to a type mismatch.\n    Set the variable $Polymake::User::Verbose::cpp to a positive value and repeat for more details.\n```\n\nhas got nothing to do with jupymake vs. the polymake pexpect interface.\n\nLooks to me like a packaging bug in arch.",
    "created_at": "2021-10-22T17:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446706",
    "user": "https://github.com/mkoeppe"
}
```

The failure in comment:56, 

```
   TypeError: C++/perl Interface module compilation failed; most likely due to a type mismatch.
    Set the variable $Polymake::User::Verbose::cpp to a positive value and repeat for more details.
```

has got nothing to do with jupymake vs. the polymake pexpect interface.

Looks to me like a packaging bug in arch.



---

archive/issue_comments_446707.json:
```json
{
    "body": "Replying to [comment:61 mkoeppe]:\n> Replying to [comment:58 dimpase]:\n> >  use some (missing?) mechanism to trigger installation of `jupymake` in this case.\n> \n> This is a valid wishlist item.\n\nI have opened #32741 for this.",
    "created_at": "2021-10-22T17:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446707",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:61 mkoeppe]:
> Replying to [comment:58 dimpase]:
> >  use some (missing?) mechanism to trigger installation of `jupymake` in this case.
> 
> This is a valid wishlist item.

I have opened #32741 for this.



---

archive/issue_comments_446708.json:
```json
{
    "body": "Replying to [comment:41 dimpase]:\n> gentoo's polymake is too old atm, it's 3.0_p2 there (and broken).\n\nI've just updated it to polymake-4.5. Send bug reports if it's still broken.",
    "created_at": "2021-10-23T01:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446708",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:41 dimpase]:
> gentoo's polymake is too old atm, it's 3.0_p2 there (and broken).

I've just updated it to polymake-4.5. Send bug reports if it's still broken.



---

archive/issue_comments_446709.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-10-23T01:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446709",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_446710.json:
```json
{
    "body": "Replying to [comment:64 mkoeppe]:\n> Replying to [comment:61 mkoeppe]:\n> > Replying to [comment:58 dimpase]:\n> > >  use some (missing?) mechanism to trigger installation of `jupymake` in this case.\n> > \n> > This is a valid wishlist item.\n> \n> I have opened #32741 for this.\n\nI explained there to how to fix this in this particular case - with jupymake getting spkg-configure.m4",
    "created_at": "2021-10-23T09:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446710",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:64 mkoeppe]:
> Replying to [comment:61 mkoeppe]:
> > Replying to [comment:58 dimpase]:
> > >  use some (missing?) mechanism to trigger installation of `jupymake` in this case.
> > 
> > This is a valid wishlist item.
> 
> I have opened #32741 for this.

I explained there to how to fix this in this particular case - with jupymake getting spkg-configure.m4



---

archive/issue_comments_446711.json:
```json
{
    "body": "I hope #32741 is not preventing this ticket to get positive review. I mean all 253 tests passed on several systems.",
    "created_at": "2021-10-23T09:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446711",
    "user": "https://github.com/sheerluck"
}
```

I hope #32741 is not preventing this ticket to get positive review. I mean all 253 tests passed on several systems.



---

archive/issue_comments_446712.json:
```json
{
    "body": "well, the reason for not giving it a positive review are doctests failing due to accidentally not having jupymake installed, which is not forced now.",
    "created_at": "2021-10-23T09:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446712",
    "user": "https://github.com/dimpase"
}
```

well, the reason for not giving it a positive review are doctests failing due to accidentally not having jupymake installed, which is not forced now.



---

archive/issue_comments_446713.json:
```json
{
    "body": "Dima, comment:63 -- since you tested on arch, could you please investigate the failure mode?  These doctests are NOT dependent on jupymake.",
    "created_at": "2021-10-23T14:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446713",
    "user": "https://github.com/mkoeppe"
}
```

Dima, comment:63 -- since you tested on arch, could you please investigate the failure mode?  These doctests are NOT dependent on jupymake.



---

archive/issue_comments_446714.json:
```json
{
    "body": "Let's move this forward please",
    "created_at": "2021-10-31T21:36:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446714",
    "user": "https://github.com/mkoeppe"
}
```

Let's move this forward please



---

archive/issue_comments_446715.json:
```json
{
    "body": "Replying to [comment:65 mjo]:\n> Replying to [comment:41 dimpase]:\n> > gentoo's polymake is too old atm, it's 3.0_p2 there (and broken).\n> \n> I've just updated it to polymake-4.5. Send bug reports if it's still broken.\n\n```\n# emerge --ask polymake\n\nThese are the packages that would be merged, in order:\n\nCalculating dependencies -\n\n!!! Problem resolving dependencies for sci-mathematics/polymake             ... done!\n\n!!! The ebuild selected to satisfy \"polymake\" has unmet requirements.\n- sci-mathematics/polymake-4.5::gentoo USE=\"cdd flint normaliz -bliss -libpolymake -lrs -nauty -ppl -singular\"\n\n  The following REQUIRED_USE flag constraints are unsatisfied:\n    exactly-one-of ( bliss nauty )\n\n```\n",
    "created_at": "2021-10-31T21:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446715",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:65 mjo]:
> Replying to [comment:41 dimpase]:
> > gentoo's polymake is too old atm, it's 3.0_p2 there (and broken).
> 
> I've just updated it to polymake-4.5. Send bug reports if it's still broken.

```
# emerge --ask polymake

These are the packages that would be merged, in order:

Calculating dependencies -

!!! Problem resolving dependencies for sci-mathematics/polymake             ... done!

!!! The ebuild selected to satisfy "polymake" has unmet requirements.
- sci-mathematics/polymake-4.5::gentoo USE="cdd flint normaliz -bliss -libpolymake -lrs -nauty -ppl -singular"

  The following REQUIRED_USE flag constraints are unsatisfied:
    exactly-one-of ( bliss nauty )

```




---

archive/issue_comments_446716.json:
```json
{
    "body": "Replying to [comment:71 mkoeppe]:\n> Let's move this forward please\nsorry, my arch lxc vm is gone (I guess I forgot to make it persistent?). Let me try \"native\" Gentoo instead.",
    "created_at": "2021-10-31T22:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446716",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:71 mkoeppe]:
> Let's move this forward please
sorry, my arch lxc vm is gone (I guess I forgot to make it persistent?). Let me try "native" Gentoo instead.



---

archive/issue_comments_446717.json:
```json
{
    "body": "Time to work on #29283 (tox.ini: Add test environments using LXC)",
    "created_at": "2021-10-31T22:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446717",
    "user": "https://github.com/mkoeppe"
}
```

Time to work on #29283 (tox.ini: Add test environments using LXC)



---

archive/issue_comments_446718.json:
```json
{
    "body": "Replying to [comment:72 dimpase]:\n> Replying to [comment:65 mjo]:\n> > Replying to [comment:41 dimpase]:\n> > > gentoo's polymake is too old atm, it's 3.0_p2 there (and broken).\n> > \n> > I've just updated it to polymake-4.5. Send bug reports if it's still broken.\n\n\n```\nUSE=\"cdd flint normaliz libpolymake lrs nauty ppl singular\" emerge --ask polymake\n```\n\ndoesn't work, there is a problem with `lrs` (and Sage installs `polymake` with `lrs`)\nApparently, it's known to Sage, as `spkg-install.in` has a comment:\n\n```\n# Since polymake v3.4, it does not find our lrs installation if we do not provide --with-lrs explicitly.\n```\n\n\nOnce this is fixed in Gentoo (sorry, I don't grok its ebuilds), `distros/gentoo.txt` should be provided (with appropriate `[..]` options?).",
    "created_at": "2021-10-31T22:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446718",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:72 dimpase]:
> Replying to [comment:65 mjo]:
> > Replying to [comment:41 dimpase]:
> > > gentoo's polymake is too old atm, it's 3.0_p2 there (and broken).
> > 
> > I've just updated it to polymake-4.5. Send bug reports if it's still broken.


```
USE="cdd flint normaliz libpolymake lrs nauty ppl singular" emerge --ask polymake
```

doesn't work, there is a problem with `lrs` (and Sage installs `polymake` with `lrs`)
Apparently, it's known to Sage, as `spkg-install.in` has a comment:

```
# Since polymake v3.4, it does not find our lrs installation if we do not provide --with-lrs explicitly.
```


Once this is fixed in Gentoo (sorry, I don't grok its ebuilds), `distros/gentoo.txt` should be provided (with appropriate `[..]` options?).



---

archive/issue_comments_446719.json:
```json
{
    "body": "Replying to [comment:72 dimpase]:\n> {{{\n> \n>   The following REQUIRED_USE flag constraints are unsatisfied:\n>     exactly-one-of ( bliss nauty )\n> \n> }}}\n\nYou have to set `USE=bliss` or `USE=nauty`, but not both, to pick a backend for graph automorphism computations.",
    "created_at": "2021-10-31T22:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446719",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:72 dimpase]:
> {{{
> 
>   The following REQUIRED_USE flag constraints are unsatisfied:
>     exactly-one-of ( bliss nauty )
> 
> }}}

You have to set `USE=bliss` or `USE=nauty`, but not both, to pick a backend for graph automorphism computations.



---

archive/issue_comments_446720.json:
```json
{
    "body": "Replying to [comment:76 mjo]:\n> Replying to [comment:72 dimpase]:\n> > {{{\n> > \n> >   The following REQUIRED_USE flag constraints are unsatisfied:\n> >     exactly-one-of ( bliss nauty )\n> > \n> > }}}\n> \n> You have to set `USE=bliss` or `USE=nauty`, but not both, to pick a backend for graph automorphism computations.\n\nsure, but the default `USE` flags shouldn't fail! As well, how about `lrs`?",
    "created_at": "2021-10-31T22:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446720",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:76 mjo]:
> Replying to [comment:72 dimpase]:
> > {{{
> > 
> >   The following REQUIRED_USE flag constraints are unsatisfied:
> >     exactly-one-of ( bliss nauty )
> > 
> > }}}
> 
> You have to set `USE=bliss` or `USE=nauty`, but not both, to pick a backend for graph automorphism computations.

sure, but the default `USE` flags shouldn't fail! As well, how about `lrs`?



---

archive/issue_comments_446721.json:
```json
{
    "body": "Replying to [comment:77 dimpase]:\n> \n> sure, but the default `USE` flags shouldn't fail! As well, how about `lrs`?\n\nThey don't \"fail,\" portage tells you to pick one because you have to pick one =P\n\nIf one is a significantly better choice than the other, we would normally enable that one by default, but I don't know enough about polymake to say that either is better.\n\nWhat's wrong with lrs?",
    "created_at": "2021-10-31T23:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446721",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:77 dimpase]:
> 
> sure, but the default `USE` flags shouldn't fail! As well, how about `lrs`?

They don't "fail," portage tells you to pick one because you have to pick one =P

If one is a significantly better choice than the other, we would normally enable that one by default, but I don't know enough about polymake to say that either is better.

What's wrong with lrs?



---

archive/issue_comments_446722.json:
```json
{
    "body": "\n```\nUSE=\"cdd flint normaliz libpolymake lrs nauty ppl singular\" emerge --ask polymake\n\nThese are the packages that would be merged, in order:\n\nCalculating dependencies... done!\n[ebuild   R    ] sci-mathematics/polymake-4.5  USE=\"lrs*\" \n\nWould you like to merge these packages? [Yes/No] \n\n>>> Verifying ebuild manifests\n\n>>> Emerging (1 of 1) sci-mathematics/polymake-4.5::gentoo\n * polymake-4.5-minimal.tar.bz2 BLAKE2B SHA512 size ;-) ...            [ ok ]\n>>> Unpacking source...\n>>> Unpacking polymake-4.5-minimal.tar.bz2 to /var/tmp/portage/sci-mathematics/polymake-4.5/work\n>>> Source unpacked in /var/tmp/portage/sci-mathematics/polymake-4.5/work\n>>> Preparing source in /var/tmp/portage/sci-mathematics/polymake-4.5/work/polymake-4.5 ...\n>>> Source prepared.\n>>> Configuring source in /var/tmp/portage/sci-mathematics/polymake-4.5/work/polymake-4.5 ...\nchecking C++ compiler ... ok (x86_64-pc-linux-gnu-g++ is GCC 8.3.1)\nchecking C++ library ... ok (GNU libstdc++ 20190518, C++ 201402)\ndetermining architecture ... ok (x86_64)\ndetermining compiler flags ... ok\n   CFLAGS=-march=native -O3 -fomit-frame-pointer -pipe\n   CXXFLAGS=-march=native -O3 -fomit-frame-pointer -pipe -std=c++14 -ftemplate-depth-200 -fno-strict-aliasing -fopenmp -Wshadow -Wlogical-op -Wconversion -Wzero-as-null-pointer-constant -Wno-parentheses -Wno-error=unused-function\n   LDFLAGS=-Wl,-O1 -Wl,--as-needed -fuse-ld=gold -fopenmp\nchecking gmp installation ... ok\nchecking mpfr installation ... ok\nchecking boost installation ... ok\nchecking perl module XML::SAX ... ok\nchecking perl module Term::ReadKey ... ok\nchecking perl module Term::ReadLine ... ok\nchecking perl module JSON ... ok\nchecking shared perl library ... ok\n\nConfiguring bundled extensions:\nbundled extension java ... disabled by command-line\nbundled extension javaview ... disabled by command-line\nbundled extension scip ... disabled by command-line\nbundled extension soplex ... disabled by command-line\nbundled extension bliss ... disabled by command-line\nbundled extension cdd ... ok (0.94m @ /usr)\nbundled extension flint ... ok (ok (2.7.1 @ /usr))\nbundled extension libnormaliz ... ok (3.8.1 @ /usr)\nbundled extension lrs ... failed\n\nERROR:\nThe bundled extension lrs was explicitly requested but failed to configure.\nPlease recheck your argument (--with-lrs=/usr) and build/bundled.log .\nYou can also disable it by specifying --without-lrs instead.\n * ERROR: sci-mathematics/polymake-4.5::gentoo failed (configure phase):\n *   (no error message)\n * \n * Call stack:\n *     ebuild.sh, line 127:  Called src_configure\n *   environment, line 1598:  Called die\n * The specific snippet of code:\n *       ./configure --prefix=\"${EPREFIX}/usr\" --libdir=\"${EPREFIX}/usr/$(get_libdir)\" --libexecdir=\"${EPREFIX}/usr/$(get_libdir)/polymake\" $(usev !libpolymake \"--without-callable\") --without-java --without-javaview --without-native --without-scip --without-soplex $(use_with bliss bliss \"${EPREFIX}/usr\") $(use_with cdd cdd \"${EPREFIX}/usr\") $(use_with flint flint \"${EPREFIX}/usr\") $(use_with lrs lrs \"${EPREFIX}/usr\") $(use_with nauty nauty \"${EPREFIX}/usr\") $(use_with normaliz libnormaliz \"${EPREFIX}/usr\") $(use_with ppl ppl \"${EPREFIX}/usr\") $(use_with singular singular \"${EPREFIX}/usr\") || die\n * \n * If you need support, post the output of `emerge --info '=sci-mathematics/polymake-4.5::gentoo'`,\n * the complete build log and the output of `emerge -pqv '=sci-mathematics/polymake-4.5::gentoo'`.\n * The complete build log is located at '/var/tmp/portage/sci-mathematics/polymake-4.5/temp/build.log'.\n * The ebuild environment file is located at '/var/tmp/portage/sci-mathematics/polymake-4.5/temp/environment'.\n * Working directory: '/var/tmp/portage/sci-mathematics/polymake-4.5/work/polymake-4.5'\n * S: '/var/tmp/portage/sci-mathematics/polymake-4.5/work/polymake-4.5'\n\n>>> Failed to emerge sci-mathematics/polymake-4.5, Log file:\n\n>>>  '/var/tmp/portage/sci-mathematics/polymake-4.5/temp/build.log'\n\n * Messages for package sci-mathematics/polymake-4.5:\n\n * ERROR: sci-mathematics/polymake-4.5::gentoo failed (configure phase):\n *   (no error message)\n * \n * Call stack:\n *     ebuild.sh, line 127:  Called src_configure\n *   environment, line 1598:  Called die\n * The specific snippet of code:\n *       ./configure --prefix=\"${EPREFIX}/usr\" --libdir=\"${EPREFIX}/usr/$(get_libdir)\" --libexecdir=\"${EPREFIX}/usr/$(get_libdir)/polymake\" $(usev !libpolymake \"--without-callable\") --without-java --without-javaview --without-native --without-scip --without-soplex $(use_with bliss bliss \"${EPREFIX}/usr\") $(use_with cdd cdd \"${EPREFIX}/usr\") $(use_with flint flint \"${EPREFIX}/usr\") $(use_with lrs lrs \"${EPREFIX}/usr\") $(use_with nauty nauty \"${EPREFIX}/usr\") $(use_with normaliz libnormaliz \"${EPREFIX}/usr\") $(use_with ppl ppl \"${EPREFIX}/usr\") $(use_with singular singular \"${EPREFIX}/usr\") || die\n * \n * If you need support, post the output of `emerge --info '=sci-mathematics/polymake-4.5::gentoo'`,\n * the complete build log and the output of `emerge -pqv '=sci-mathematics/polymake-4.5::gentoo'`.\n * The complete build log is located at '/var/tmp/portage/sci-mathematics/polymake-4.5/temp/build.log'.\n * The ebuild environment file is located at '/var/tmp/portage/sci-mathematics/polymake-4.5/temp/environment'.\n * Working directory: '/var/tmp/portage/sci-mathematics/polymake-4.5/work/polymake-4.5'\n * S: '/var/tmp/portage/sci-mathematics/polymake-4.5/work/polymake-4.5'\nhilbert /tmp # \n\n```\n\n\nI guess one needs to do what's done in `spkg-install` to pass the `lrs` prefix more explicitly.",
    "created_at": "2021-10-31T23:39:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446722",
    "user": "https://github.com/dimpase"
}
```


```
USE="cdd flint normaliz libpolymake lrs nauty ppl singular" emerge --ask polymake

These are the packages that would be merged, in order:

Calculating dependencies... done!
[ebuild   R    ] sci-mathematics/polymake-4.5  USE="lrs*" 

Would you like to merge these packages? [Yes/No] 

>>> Verifying ebuild manifests

>>> Emerging (1 of 1) sci-mathematics/polymake-4.5::gentoo
 * polymake-4.5-minimal.tar.bz2 BLAKE2B SHA512 size ;-) ...            [ ok ]
>>> Unpacking source...
>>> Unpacking polymake-4.5-minimal.tar.bz2 to /var/tmp/portage/sci-mathematics/polymake-4.5/work
>>> Source unpacked in /var/tmp/portage/sci-mathematics/polymake-4.5/work
>>> Preparing source in /var/tmp/portage/sci-mathematics/polymake-4.5/work/polymake-4.5 ...
>>> Source prepared.
>>> Configuring source in /var/tmp/portage/sci-mathematics/polymake-4.5/work/polymake-4.5 ...
checking C++ compiler ... ok (x86_64-pc-linux-gnu-g++ is GCC 8.3.1)
checking C++ library ... ok (GNU libstdc++ 20190518, C++ 201402)
determining architecture ... ok (x86_64)
determining compiler flags ... ok
   CFLAGS=-march=native -O3 -fomit-frame-pointer -pipe
   CXXFLAGS=-march=native -O3 -fomit-frame-pointer -pipe -std=c++14 -ftemplate-depth-200 -fno-strict-aliasing -fopenmp -Wshadow -Wlogical-op -Wconversion -Wzero-as-null-pointer-constant -Wno-parentheses -Wno-error=unused-function
   LDFLAGS=-Wl,-O1 -Wl,--as-needed -fuse-ld=gold -fopenmp
checking gmp installation ... ok
checking mpfr installation ... ok
checking boost installation ... ok
checking perl module XML::SAX ... ok
checking perl module Term::ReadKey ... ok
checking perl module Term::ReadLine ... ok
checking perl module JSON ... ok
checking shared perl library ... ok

Configuring bundled extensions:
bundled extension java ... disabled by command-line
bundled extension javaview ... disabled by command-line
bundled extension scip ... disabled by command-line
bundled extension soplex ... disabled by command-line
bundled extension bliss ... disabled by command-line
bundled extension cdd ... ok (0.94m @ /usr)
bundled extension flint ... ok (ok (2.7.1 @ /usr))
bundled extension libnormaliz ... ok (3.8.1 @ /usr)
bundled extension lrs ... failed

ERROR:
The bundled extension lrs was explicitly requested but failed to configure.
Please recheck your argument (--with-lrs=/usr) and build/bundled.log .
You can also disable it by specifying --without-lrs instead.
 * ERROR: sci-mathematics/polymake-4.5::gentoo failed (configure phase):
 *   (no error message)
 * 
 * Call stack:
 *     ebuild.sh, line 127:  Called src_configure
 *   environment, line 1598:  Called die
 * The specific snippet of code:
 *       ./configure --prefix="${EPREFIX}/usr" --libdir="${EPREFIX}/usr/$(get_libdir)" --libexecdir="${EPREFIX}/usr/$(get_libdir)/polymake" $(usev !libpolymake "--without-callable") --without-java --without-javaview --without-native --without-scip --without-soplex $(use_with bliss bliss "${EPREFIX}/usr") $(use_with cdd cdd "${EPREFIX}/usr") $(use_with flint flint "${EPREFIX}/usr") $(use_with lrs lrs "${EPREFIX}/usr") $(use_with nauty nauty "${EPREFIX}/usr") $(use_with normaliz libnormaliz "${EPREFIX}/usr") $(use_with ppl ppl "${EPREFIX}/usr") $(use_with singular singular "${EPREFIX}/usr") || die
 * 
 * If you need support, post the output of `emerge --info '=sci-mathematics/polymake-4.5::gentoo'`,
 * the complete build log and the output of `emerge -pqv '=sci-mathematics/polymake-4.5::gentoo'`.
 * The complete build log is located at '/var/tmp/portage/sci-mathematics/polymake-4.5/temp/build.log'.
 * The ebuild environment file is located at '/var/tmp/portage/sci-mathematics/polymake-4.5/temp/environment'.
 * Working directory: '/var/tmp/portage/sci-mathematics/polymake-4.5/work/polymake-4.5'
 * S: '/var/tmp/portage/sci-mathematics/polymake-4.5/work/polymake-4.5'

>>> Failed to emerge sci-mathematics/polymake-4.5, Log file:

>>>  '/var/tmp/portage/sci-mathematics/polymake-4.5/temp/build.log'

 * Messages for package sci-mathematics/polymake-4.5:

 * ERROR: sci-mathematics/polymake-4.5::gentoo failed (configure phase):
 *   (no error message)
 * 
 * Call stack:
 *     ebuild.sh, line 127:  Called src_configure
 *   environment, line 1598:  Called die
 * The specific snippet of code:
 *       ./configure --prefix="${EPREFIX}/usr" --libdir="${EPREFIX}/usr/$(get_libdir)" --libexecdir="${EPREFIX}/usr/$(get_libdir)/polymake" $(usev !libpolymake "--without-callable") --without-java --without-javaview --without-native --without-scip --without-soplex $(use_with bliss bliss "${EPREFIX}/usr") $(use_with cdd cdd "${EPREFIX}/usr") $(use_with flint flint "${EPREFIX}/usr") $(use_with lrs lrs "${EPREFIX}/usr") $(use_with nauty nauty "${EPREFIX}/usr") $(use_with normaliz libnormaliz "${EPREFIX}/usr") $(use_with ppl ppl "${EPREFIX}/usr") $(use_with singular singular "${EPREFIX}/usr") || die
 * 
 * If you need support, post the output of `emerge --info '=sci-mathematics/polymake-4.5::gentoo'`,
 * the complete build log and the output of `emerge -pqv '=sci-mathematics/polymake-4.5::gentoo'`.
 * The complete build log is located at '/var/tmp/portage/sci-mathematics/polymake-4.5/temp/build.log'.
 * The ebuild environment file is located at '/var/tmp/portage/sci-mathematics/polymake-4.5/temp/environment'.
 * Working directory: '/var/tmp/portage/sci-mathematics/polymake-4.5/work/polymake-4.5'
 * S: '/var/tmp/portage/sci-mathematics/polymake-4.5/work/polymake-4.5'
hilbert /tmp # 

```


I guess one needs to do what's done in `spkg-install` to pass the `lrs` prefix more explicitly.



---

archive/issue_comments_446723.json:
```json
{
    "body": "> I guess one needs to do what's done in spkg-install to pass the lrs prefix more explicitly. \n\nYou may need to upgrade to lrslib-071b or lrslib-071b-r1. Those versions (I added them to the tree along with polymake-4.5) fix a critical bug in v071. I don't know if v062 works because it doesn't even build anymore. Comically, we can't remove it though because it's \"stable\" and no one has stabilized v071b on x86 yet.",
    "created_at": "2021-11-01T00:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446723",
    "user": "https://github.com/orlitzky"
}
```

> I guess one needs to do what's done in spkg-install to pass the lrs prefix more explicitly. 

You may need to upgrade to lrslib-071b or lrslib-071b-r1. Those versions (I added them to the tree along with polymake-4.5) fix a critical bug in v071. I don't know if v062 works because it doesn't even build anymore. Comically, we can't remove it though because it's "stable" and no one has stabilized v071b on x86 yet.



---

archive/issue_comments_446724.json:
```json
{
    "body": "Replying to [comment:80 mjo]:\n> > I guess one needs to do what's done in spkg-install to pass the lrs prefix more explicitly. \n> \n> You may need to upgrade to lrslib-071b or lrslib-071b-r1. Those versions (I added them to the tree along with polymake-4.5) fix a critical bug in v071. I don't know if v062 works because it doesn't even build anymore. Comically, we can't remove it though because it's \"stable\" and no one has stabilized v071b on x86 yet.\n\nThis does not take away the problem that polymake's configure fails, I cannot imagine it's due to lrs's version.",
    "created_at": "2021-11-01T09:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446724",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:80 mjo]:
> > I guess one needs to do what's done in spkg-install to pass the lrs prefix more explicitly. 
> 
> You may need to upgrade to lrslib-071b or lrslib-071b-r1. Those versions (I added them to the tree along with polymake-4.5) fix a critical bug in v071. I don't know if v062 works because it doesn't even build anymore. Comically, we can't remove it though because it's "stable" and no one has stabilized v071b on x86 yet.

This does not take away the problem that polymake's configure fails, I cannot imagine it's due to lrs's version.



---

archive/issue_comments_446725.json:
```json
{
    "body": "Oops, I take it back - lrslib-071b-r1 allows configure to pass.\n\nI don't know whether Gentoo has such a flexibility in configurations, but ideally it should refuse to even start building with an old lrs version.",
    "created_at": "2021-11-01T09:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446725",
    "user": "https://github.com/dimpase"
}
```

Oops, I take it back - lrslib-071b-r1 allows configure to pass.

I don't know whether Gentoo has such a flexibility in configurations, but ideally it should refuse to even start building with an old lrs version.



---

archive/issue_comments_446726.json:
```json
{
    "body": "but I still have bad news, in Gentoo case in particular, but also\nin general. Perl's MongoDB module is at EOL.\n\n```\n# emerge dev-perl/MongoDB\nCalculating dependencies... done!\n\n!!! All ebuilds that could satisfy \"dev-perl/MongoDB\" have been masked.\n!!! One of the following masked packages is required to complete your request:\n- dev-perl/MongoDB-1.8.0::gentoo (masked by: package.mask)\n/usr/portage/profiles/package.mask:\n# Sam James <sam@gentoo.org> (2021-10-25)\n# Fails to build with glibc-2.30(!) and was abandoned upstream\n# a few years ago. No reverse dependencies in tree.\n# bug #728556. Removal on 2021-11-25.\n\n\nFor more information, see the MASKED PACKAGES section in the emerge\nman page or refer to the Gentoo Handbook.\n```\n\nhttps://packages.gentoo.org/packages/dev-perl/MongoDB mentions version 2.2.2, and\nhttps://metacpan.org/dist/MongoDB says\n\n```\n Changes for version v2.2.2 - 2020-08-13\n\n    !!! END OF LIFE NOTICE !!!\n        As of August 13, 2020, the MongoDB Perl driver has reached end of life and is no longer supported by MongoDB.\n\n```\n",
    "created_at": "2021-11-01T13:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446726",
    "user": "https://github.com/dimpase"
}
```

but I still have bad news, in Gentoo case in particular, but also
in general. Perl's MongoDB module is at EOL.

```
# emerge dev-perl/MongoDB
Calculating dependencies... done!

!!! All ebuilds that could satisfy "dev-perl/MongoDB" have been masked.
!!! One of the following masked packages is required to complete your request:
- dev-perl/MongoDB-1.8.0::gentoo (masked by: package.mask)
/usr/portage/profiles/package.mask:
# Sam James <sam@gentoo.org> (2021-10-25)
# Fails to build with glibc-2.30(!) and was abandoned upstream
# a few years ago. No reverse dependencies in tree.
# bug #728556. Removal on 2021-11-25.


For more information, see the MASKED PACKAGES section in the emerge
man page or refer to the Gentoo Handbook.
```

https://packages.gentoo.org/packages/dev-perl/MongoDB mentions version 2.2.2, and
https://metacpan.org/dist/MongoDB says

```
 Changes for version v2.2.2 - 2020-08-13

    !!! END OF LIFE NOTICE !!!
        As of August 13, 2020, the MongoDB Perl driver has reached end of life and is no longer supported by MongoDB.

```




---

archive/issue_comments_446727.json:
```json
{
    "body": "Shouldn't `perl_cpan_polymake_prereq` (and other deps?) be in `SAGE_SPKG_DEPCHECK` for polymake?",
    "created_at": "2021-11-01T14:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446727",
    "user": "https://github.com/dimpase"
}
```

Shouldn't `perl_cpan_polymake_prereq` (and other deps?) be in `SAGE_SPKG_DEPCHECK` for polymake?



---

archive/issue_comments_446728.json:
```json
{
    "body": "MongoDB cannot deprive this ticket of positive review",
    "created_at": "2021-11-01T14:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446728",
    "user": "https://github.com/sheerluck"
}
```

MongoDB cannot deprive this ticket of positive review



---

archive/issue_comments_446729.json:
```json
{
    "body": "We should check that `polymake` is working, not only `polymake-config`.\n(As some Perl deps might be broken - e.g. I ran into\n\n```\n$ polymake\nWelcome to polymake version 4.5\nCopyright (c) 1997-2021\nEwgenij Gawrilow, Michael Joswig, and the polymake team\nTechnische Universit\u00e4t Berlin, Germany\nhttps://polymake.org\n\nThis is free software licensed under GPL; see the source for copying conditions.\nThere is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n\nLoading applications now...polymake:  ERROR: \"/usr/share/polymake/apps/common/perllib/PolyDB.pm\", line 23: Can't locate MongoDB.pm in @INC (you may need to install the MongoDB module) (@INC contains: Polymake::Core::Application=ARRAY(0x5589c39eea50) /usr/share/polymake/perllib /usr/lib64/polymake/perlx/5.34.0/x86_64-linux-thread-multi /usr/lib64/polymake/perlx/5.34.0 /usr/lib64/polymake/perlx /etc/perl /usr/local/lib64/perl5/5.34/x86_64-linux-thread-multi /usr/local/lib64/perl5/5.34 /usr/lib64/perl5/vendor_perl/5.34/x86_64-linux-thread-multi /usr/lib64/perl5/vendor_perl/5.34 /usr/lib64/perl5/5.34/x86_64-linux-thread-multi /usr/lib64/perl5/5.34 /usr/lib64/perl5/5.32 /usr/lib64/perl5/vendor_perl/5.32 /usr/lib64/perl5/vendor_perl/5.30.3 /usr/lib64/perl5/vendor_perl/5.30.0)\n```\n",
    "created_at": "2021-11-01T14:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446729",
    "user": "https://github.com/dimpase"
}
```

We should check that `polymake` is working, not only `polymake-config`.
(As some Perl deps might be broken - e.g. I ran into

```
$ polymake
Welcome to polymake version 4.5
Copyright (c) 1997-2021
Ewgenij Gawrilow, Michael Joswig, and the polymake team
Technische Universität Berlin, Germany
https://polymake.org

This is free software licensed under GPL; see the source for copying conditions.
There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

Loading applications now...polymake:  ERROR: "/usr/share/polymake/apps/common/perllib/PolyDB.pm", line 23: Can't locate MongoDB.pm in @INC (you may need to install the MongoDB module) (@INC contains: Polymake::Core::Application=ARRAY(0x5589c39eea50) /usr/share/polymake/perllib /usr/lib64/polymake/perlx/5.34.0/x86_64-linux-thread-multi /usr/lib64/polymake/perlx/5.34.0 /usr/lib64/polymake/perlx /etc/perl /usr/local/lib64/perl5/5.34/x86_64-linux-thread-multi /usr/local/lib64/perl5/5.34 /usr/lib64/perl5/vendor_perl/5.34/x86_64-linux-thread-multi /usr/lib64/perl5/vendor_perl/5.34 /usr/lib64/perl5/5.34/x86_64-linux-thread-multi /usr/lib64/perl5/5.34 /usr/lib64/perl5/5.32 /usr/lib64/perl5/vendor_perl/5.32 /usr/lib64/perl5/vendor_perl/5.30.3 /usr/lib64/perl5/vendor_perl/5.30.0)
```




---

archive/issue_comments_446730.json:
```json
{
    "body": "I was able to install the missing perl module on Gentoo by doing as root\n\n```\n# emerge App-cpanminus\n# cpanm MongoDB\n```\n\n\nthis needs another ticket.",
    "created_at": "2021-11-01T14:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446730",
    "user": "https://github.com/dimpase"
}
```

I was able to install the missing perl module on Gentoo by doing as root

```
# emerge App-cpanminus
# cpanm MongoDB
```


this needs another ticket.



---

archive/issue_comments_446731.json:
```json
{
    "body": "Please see #32808 for Perl MongoDB package/spkg issues.",
    "created_at": "2021-11-01T14:54:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446731",
    "user": "https://github.com/dimpase"
}
```

Please see #32808 for Perl MongoDB package/spkg issues.



---

archive/issue_comments_446732.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-11-01T14:55:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446732",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_446733.json:
```json
{
    "body": "See also #31830 (`perl_cpan_polymake_prereq`: Update install instructions).",
    "created_at": "2021-11-01T15:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446733",
    "user": "https://github.com/mkoeppe"
}
```

See also #31830 (`perl_cpan_polymake_prereq`: Update install instructions).



---

archive/issue_comments_446734.json:
```json
{
    "body": "Replying to [comment:84 dimpase]:\n> Shouldn't `perl_cpan_polymake_prereq` (and other deps?) be in `SAGE_SPKG_DEPCHECK` for polymake?\n`perl_cpan_polymake_prereq` does not make sense in `SAGE_SPKG_DEPCHECK` because it is a dummy script package -- we provide no spkg-install for it.\n\nYou can add `SAGE_SPKG_DEPCHECK` for `bliss`, `cddlib`, `lrslib`, `readline`, `ppl`, which bring shared libraries.",
    "created_at": "2021-11-01T15:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446734",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:84 dimpase]:
> Shouldn't `perl_cpan_polymake_prereq` (and other deps?) be in `SAGE_SPKG_DEPCHECK` for polymake?
`perl_cpan_polymake_prereq` does not make sense in `SAGE_SPKG_DEPCHECK` because it is a dummy script package -- we provide no spkg-install for it.

You can add `SAGE_SPKG_DEPCHECK` for `bliss`, `cddlib`, `lrslib`, `readline`, `ppl`, which bring shared libraries.



---

archive/issue_comments_446735.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-01T17:01:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446735",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446736.json:
```json
{
    "body": "Replying to [comment:86 dimpase]:\n> We should check that `polymake` is working, not only `polymake-config`.\n> (As some Perl deps might be broken [...])\n\nI have instead added some initialization steps to the existing run test of the polymake library. Please try if it correctly rejects your broken installation",
    "created_at": "2021-11-01T17:02:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446736",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:86 dimpase]:
> We should check that `polymake` is working, not only `polymake-config`.
> (As some Perl deps might be broken [...])

I have instead added some initialization steps to the existing run test of the polymake library. Please try if it correctly rejects your broken installation



---

archive/issue_comments_446737.json:
```json
{
    "body": "Replying to [comment:91 mkoeppe]:\n> You can add `SAGE_SPKG_DEPCHECK` for `bliss`, `cddlib`, `lrslib`, `readline`, `ppl`, which bring shared libraries.\nHowever, this would reject polymake on homebrew, which does not provide all of these libraries. So let's not do this -- unless someone is actually running into shared library conflicts.",
    "created_at": "2021-11-01T17:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446737",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:91 mkoeppe]:
> You can add `SAGE_SPKG_DEPCHECK` for `bliss`, `cddlib`, `lrslib`, `readline`, `ppl`, which bring shared libraries.
However, this would reject polymake on homebrew, which does not provide all of these libraries. So let's not do this -- unless someone is actually running into shared library conflicts.



---

archive/issue_comments_446738.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-11-01T17:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446738",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_446739.json:
```json
{
    "body": "Testing on arch using `EXTRA_CONFIGURE_ARGS=\"--disable-notebook\" tox -e docker-archlinux-latest-maximal`.\n\nThere seems to be a packaging bug that breaks polymake when `TERM` is set to `dumb` (as we do in the (deprecated) polymake pexpect interface):\n\n```\n[root@ab9af06251dd sage]# TERM=dumb polymake\nWelcome to polymake version 4.5\nCopyright (c) 1997-2021\nEwgenij Gawrilow, Michael Joswig, and the polymake team\nTechnische Universit\u00e4t Berlin, Germany\nhttps://polymake.org\n\nThis is free software licensed under GPL; see the source for copying conditions.\nThere is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n\nLoading applications now...Can't locate object method \"new\" via package \"Term::ReadLine::Gnu\" at /usr/share/polymake/perllib/Polymake/Core/Shell.pm line 30.\n```\n",
    "created_at": "2021-11-01T19:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446739",
    "user": "https://github.com/mkoeppe"
}
```

Testing on arch using `EXTRA_CONFIGURE_ARGS="--disable-notebook" tox -e docker-archlinux-latest-maximal`.

There seems to be a packaging bug that breaks polymake when `TERM` is set to `dumb` (as we do in the (deprecated) polymake pexpect interface):

```
[root@ab9af06251dd sage]# TERM=dumb polymake
Welcome to polymake version 4.5
Copyright (c) 1997-2021
Ewgenij Gawrilow, Michael Joswig, and the polymake team
Technische Universität Berlin, Germany
https://polymake.org

This is free software licensed under GPL; see the source for copying conditions.
There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

Loading applications now...Can't locate object method "new" via package "Term::ReadLine::Gnu" at /usr/share/polymake/perllib/Polymake/Core/Shell.pm line 30.
```




---

archive/issue_comments_446740.json:
```json
{
    "body": "Replying to [comment:93 mkoeppe]:\n> Replying to [comment:86 dimpase]:\n> > We should check that `polymake` is working, not only `polymake-config`.\n> > (As some Perl deps might be broken [...])\n> \n> I have instead added some initialization steps to the existing run test of the polymake library. Please try if it correctly rejects your broken installation\n\nit does, I get the same error as from `polymake` in terminal. I get\n\n```\nconfigure:39826: ./conftest\nterminate called after throwing an instance of 'pm::perl::exception'\n  what():  \"/usr/share/polymake/apps/common/perllib/PolyDB.pm\", line 23: Can't locate MongoDB.pm in @INC (you may need to install the MongoDB module)\n...\n```\n\n\nHowever, I don't get why you need this extra hack, rather than the result of `perl_mongodb/spkg-configure.m4`, which could be added into `SAGE_SPKG_DEPCHECK`, and which duly reports\n\n```\nperl_mongodb-none:                           no suitable system package; optional\n```\n\nThese perl module packages aren't so dummy after all.",
    "created_at": "2021-11-01T23:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446740",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:93 mkoeppe]:
> Replying to [comment:86 dimpase]:
> > We should check that `polymake` is working, not only `polymake-config`.
> > (As some Perl deps might be broken [...])
> 
> I have instead added some initialization steps to the existing run test of the polymake library. Please try if it correctly rejects your broken installation

it does, I get the same error as from `polymake` in terminal. I get

```
configure:39826: ./conftest
terminate called after throwing an instance of 'pm::perl::exception'
  what():  "/usr/share/polymake/apps/common/perllib/PolyDB.pm", line 23: Can't locate MongoDB.pm in @INC (you may need to install the MongoDB module)
...
```


However, I don't get why you need this extra hack, rather than the result of `perl_mongodb/spkg-configure.m4`, which could be added into `SAGE_SPKG_DEPCHECK`, and which duly reports

```
perl_mongodb-none:                           no suitable system package; optional
```

These perl module packages aren't so dummy after all.



---

archive/issue_comments_446741.json:
```json
{
    "body": "Replying to [comment:91 mkoeppe]:\n> Replying to [comment:84 dimpase]:\n> > Shouldn't `perl_cpan_polymake_prereq` (and other deps?) be in `SAGE_SPKG_DEPCHECK` for polymake?\n> `perl_cpan_polymake_prereq` does not make sense in `SAGE_SPKG_DEPCHECK` because it is a dummy script package -- we provide no spkg-install for it.\n\nWhat do you mean it's `dummy` - it does the check for the needed modules!\nSee also comment:98.",
    "created_at": "2021-11-01T23:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446741",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:91 mkoeppe]:
> Replying to [comment:84 dimpase]:
> > Shouldn't `perl_cpan_polymake_prereq` (and other deps?) be in `SAGE_SPKG_DEPCHECK` for polymake?
> `perl_cpan_polymake_prereq` does not make sense in `SAGE_SPKG_DEPCHECK` because it is a dummy script package -- we provide no spkg-install for it.

What do you mean it's `dummy` - it does the check for the needed modules!
See also comment:98.



---

archive/issue_comments_446742.json:
```json
{
    "body": "\"Dummy\" means we have no `spkg-install` script; the package only exists for running the `spkg-configure.m4`.",
    "created_at": "2021-11-02T00:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446742",
    "user": "https://github.com/mkoeppe"
}
```

"Dummy" means we have no `spkg-install` script; the package only exists for running the `spkg-configure.m4`.



---

archive/issue_comments_446743.json:
```json
{
    "body": "The `perl_mongodb` package is not required. Only users who want to use PolyDB need it.\nThat's why I split it out from `perl_cpan_polymake_prereq` in #31840.",
    "created_at": "2021-11-02T00:10:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446743",
    "user": "https://github.com/mkoeppe"
}
```

The `perl_mongodb` package is not required. Only users who want to use PolyDB need it.
That's why I split it out from `perl_cpan_polymake_prereq` in #31840.



---

archive/issue_comments_446744.json:
```json
{
    "body": "Replying to [comment:100 mkoeppe]:\n> \"Dummy\" means we have no `spkg-install` script; the package only exists for running the `spkg-configure.m4`.\n\nanyhow, these packages do useful tests on suitability of system `polymake`, as we have discovered here, why not add them to `SAGE_SPKG_DEPCHECK` ?",
    "created_at": "2021-11-02T00:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446744",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:100 mkoeppe]:
> "Dummy" means we have no `spkg-install` script; the package only exists for running the `spkg-configure.m4`.

anyhow, these packages do useful tests on suitability of system `polymake`, as we have discovered here, why not add them to `SAGE_SPKG_DEPCHECK` ?



---

archive/issue_comments_446745.json:
```json
{
    "body": "You are confused about `SAGE_SPKG_DEPCHECK`. This macro implements the logic \"dependency library B is installed from SPKG ==> must install package A from SPKG too\".",
    "created_at": "2021-11-02T00:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446745",
    "user": "https://github.com/mkoeppe"
}
```

You are confused about `SAGE_SPKG_DEPCHECK`. This macro implements the logic "dependency library B is installed from SPKG ==> must install package A from SPKG too".



---

archive/issue_comments_446746.json:
```json
{
    "body": "Replying to [comment:101 mkoeppe]:\n> The `perl_mongodb` package is not required. Only users who want to use PolyDB need it.\n> That's why I split it out from `perl_cpan_polymake_prereq` in #31840.\n> \nI don't know what `PolyDB` is, it seems to be an integral part of polymake now.\n(At least on Gentoo there seems to be no option to have polymake not dependent on it)",
    "created_at": "2021-11-02T00:17:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446746",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:101 mkoeppe]:
> The `perl_mongodb` package is not required. Only users who want to use PolyDB need it.
> That's why I split it out from `perl_cpan_polymake_prereq` in #31840.
> 
I don't know what `PolyDB` is, it seems to be an integral part of polymake now.
(At least on Gentoo there seems to be no option to have polymake not dependent on it)



---

archive/issue_comments_446747.json:
```json
{
    "body": "Replying to [comment:103 mkoeppe]:\n> You are confused about `SAGE_SPKG_DEPCHECK`. This macro implements the logic \"dependency library B is installed from SPKG ==> must install package A from SPKG too\".\n\nNote that X->Y <=> \u00acY->\u00acX (i.e. A from system needs B from system)",
    "created_at": "2021-11-02T00:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446747",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:103 mkoeppe]:
> You are confused about `SAGE_SPKG_DEPCHECK`. This macro implements the logic "dependency library B is installed from SPKG ==> must install package A from SPKG too".

Note that X->Y <=> ¬Y->¬X (i.e. A from system needs B from system)



---

archive/issue_comments_446748.json:
```json
{
    "body": "As I said, you are confused.",
    "created_at": "2021-11-02T00:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446748",
    "user": "https://github.com/mkoeppe"
}
```

As I said, you are confused.



---

archive/issue_comments_446749.json:
```json
{
    "body": "No, I wrote the macro `SAGE_SPKG_CONFIGURE`, in fact, and it's you who are confused. :-)\nIf I do\n\n```diff\n--- a/build/pkgs/polymake/spkg-configure.m4\n+++ b/build/pkgs/polymake/spkg-configure.m4\n@@ -1,6 +1,7 @@\n SAGE_SPKG_CONFIGURE([polymake], [\n     dnl Need polymake >= 3.5 for \"improve callable library compatibility with threads\"\n     m4_pushdef([POLYMAKE_VERSION_MIN], [3.5])\n+SAGE_SPKG_DEPCHECK([perl_mongodb], [\n     AC_CACHE_CHECK([for polymake-config >= ]POLYMAKE_VERSION_MIN, [ac_cv_path_POLYMAKE_CONFIG], [\n         AC_PATH_PROGS_FEATURE_CHECK([POLYMAKE_CONFIG], [polymake-config], [\n             polymake_config_version=$($ac_path_POLYMAKE_CONFIG --version 2>&1)\n@@ -41,5 +42,6 @@ SAGE_SPKG_CONFIGURE([polymake], [\n            LDFLAGS=\"$saved_LDFLAGS\"\n            AC_LANG_POP([C++])\n           ])\n+])\n     m4_popdef([POLYMAKE_VERSION_MIN])\n ])\n```\n\nthen I get\n\n```\n## --------------------------------------------------------- ##\n## Checking whether SageMath should install SPKG polymake... ##\n## --------------------------------------------------------- ##\nconfigure:39701: checking whether any of perl_mongodb is installed as or will be installed as SPKG\nconfigure:39706: result: yes; install polymake as well\nconfigure:39897: no suitable system package found for SPKG polymake\n```\n",
    "created_at": "2021-11-02T00:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446749",
    "user": "https://github.com/dimpase"
}
```

No, I wrote the macro `SAGE_SPKG_CONFIGURE`, in fact, and it's you who are confused. :-)
If I do

```diff
--- a/build/pkgs/polymake/spkg-configure.m4
+++ b/build/pkgs/polymake/spkg-configure.m4
@@ -1,6 +1,7 @@
 SAGE_SPKG_CONFIGURE([polymake], [
     dnl Need polymake >= 3.5 for "improve callable library compatibility with threads"
     m4_pushdef([POLYMAKE_VERSION_MIN], [3.5])
+SAGE_SPKG_DEPCHECK([perl_mongodb], [
     AC_CACHE_CHECK([for polymake-config >= ]POLYMAKE_VERSION_MIN, [ac_cv_path_POLYMAKE_CONFIG], [
         AC_PATH_PROGS_FEATURE_CHECK([POLYMAKE_CONFIG], [polymake-config], [
             polymake_config_version=$($ac_path_POLYMAKE_CONFIG --version 2>&1)
@@ -41,5 +42,6 @@ SAGE_SPKG_CONFIGURE([polymake], [
            LDFLAGS="$saved_LDFLAGS"
            AC_LANG_POP([C++])
           ])
+])
     m4_popdef([POLYMAKE_VERSION_MIN])
 ])
```

then I get

```
## --------------------------------------------------------- ##
## Checking whether SageMath should install SPKG polymake... ##
## --------------------------------------------------------- ##
configure:39701: checking whether any of perl_mongodb is installed as or will be installed as SPKG
configure:39706: result: yes; install polymake as well
configure:39897: no suitable system package found for SPKG polymake
```




---

archive/issue_comments_446750.json:
```json
{
    "body": "Yes, I agree that `checking whether any of perl_mongodb is installed as or will be installed as SPKG` message is misleading, but, well...",
    "created_at": "2021-11-02T00:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446750",
    "user": "https://github.com/dimpase"
}
```

Yes, I agree that `checking whether any of perl_mongodb is installed as or will be installed as SPKG` message is misleading, but, well...



---

archive/issue_comments_446751.json:
```json
{
    "body": "But it's late night in Europe, and your change there implements the wrong logic.",
    "created_at": "2021-11-02T00:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446751",
    "user": "https://github.com/mkoeppe"
}
```

But it's late night in Europe, and your change there implements the wrong logic.



---

archive/issue_comments_446752.json:
```json
{
    "body": "Replying to [comment:109 mkoeppe]:\n> But it's late night in Europe, and your change there implements the wrong logic.\n> \n> \nit's not yet 1am here, and \nit's only wrong if `perl_mongodb` is optional for the latest polymake. Note that Gentoo builds polymake just fine, while there is no Perl MongoDB installed (and the result of the build is broken).",
    "created_at": "2021-11-02T00:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446752",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:109 mkoeppe]:
> But it's late night in Europe, and your change there implements the wrong logic.
> 
> 
it's not yet 1am here, and 
it's only wrong if `perl_mongodb` is optional for the latest polymake. Note that Gentoo builds polymake just fine, while there is no Perl MongoDB installed (and the result of the build is broken).



---

archive/issue_comments_446753.json:
```json
{
    "body": "1. `perl_mongodb` *is* optional for polymake.\n\n2. Whether system `perl_mongodb` is available or not, we can use system `polymake`.\n\n3. Even if we add an installation script for `perl_mongodb`, installing it as an SPKG does NOT make it necessary to stop using the system polymake (which is what `SAGE_SPKG_DEPCHECK` implements).",
    "created_at": "2021-11-02T00:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446753",
    "user": "https://github.com/mkoeppe"
}
```

1. `perl_mongodb` *is* optional for polymake.

2. Whether system `perl_mongodb` is available or not, we can use system `polymake`.

3. Even if we add an installation script for `perl_mongodb`, installing it as an SPKG does NOT make it necessary to stop using the system polymake (which is what `SAGE_SPKG_DEPCHECK` implements).



---

archive/issue_comments_446754.json:
```json
{
    "body": "Replying to [comment:98 dimpase]:\n> Replying to [comment:93 mkoeppe]:\n> > Replying to [comment:86 dimpase]:\n> > > We should check that `polymake` is working, not only `polymake-config`.\n> > > (As some Perl deps might be broken [...])\n> > \n> > I have instead added some initialization steps to the existing run test of the polymake library. Please try if it correctly rejects your broken installation\n> \n> it does, I get the same error as from `polymake` in terminal.\n\nGood, then `spkg-configure.m4` (= the scope of this ticket) does its job correctly.\n\n> However, I don't get why you need this extra hack\n\nNot a hack, just a proper runtest for the polymake library.",
    "created_at": "2021-11-02T01:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446754",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:98 dimpase]:
> Replying to [comment:93 mkoeppe]:
> > Replying to [comment:86 dimpase]:
> > > We should check that `polymake` is working, not only `polymake-config`.
> > > (As some Perl deps might be broken [...])
> > 
> > I have instead added some initialization steps to the existing run test of the polymake library. Please try if it correctly rejects your broken installation
> 
> it does, I get the same error as from `polymake` in terminal.

Good, then `spkg-configure.m4` (= the scope of this ticket) does its job correctly.

> However, I don't get why you need this extra hack

Not a hack, just a proper runtest for the polymake library.



---

archive/issue_comments_446755.json:
```json
{
    "body": "I don't know how `Loading applications now...` works but I get\n\n```\nApplication polytope currently uses following contributed and third-party software packages:\n4ti2, bliss, cdd, flint, graphviz, libnormaliz, lrs, permlib, povray, ppl, qhull, singular, sketch, sympol, threejs, tikz, tosimplex\nFor more details:  show_credits;\npolytope > \n```\n\nso I guess I never touch PolyDB.pm somehow  (I use `dev-perl/MongoDB` for our docker images only)",
    "created_at": "2021-11-02T06:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446755",
    "user": "https://github.com/sheerluck"
}
```

I don't know how `Loading applications now...` works but I get

```
Application polytope currently uses following contributed and third-party software packages:
4ti2, bliss, cdd, flint, graphviz, libnormaliz, lrs, permlib, povray, ppl, qhull, singular, sketch, sympol, threejs, tikz, tosimplex
For more details:  show_credits;
polytope > 
```

so I guess I never touch PolyDB.pm somehow  (I use `dev-perl/MongoDB` for our docker images only)



---

archive/issue_comments_446756.json:
```json
{
    "body": "I hope this ticket stays not about `perl_mongodb` in any way. Somehow it wasn't about `perl_mongodb` for Arch Linux users.",
    "created_at": "2021-11-02T06:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446756",
    "user": "https://github.com/sheerluck"
}
```

I hope this ticket stays not about `perl_mongodb` in any way. Somehow it wasn't about `perl_mongodb` for Arch Linux users.



---

archive/issue_comments_446757.json:
```json
{
    "body": "Replying to [comment:111 mkoeppe]:\n> 1. `perl_mongodb` *is* optional for polymake.\n> \n> 2. Whether system `perl_mongodb` is available or not, we can use system `polymake`.\n\nexcept that we can't in some cases, see above.\n\n> \n> 3. Even if we add an installation script for `perl_mongodb`, installing it as an SPKG does NOT make it necessary to stop using the system polymake (which is what `SAGE_SPKG_DEPCHECK` implements).\n\nHopefully this is not happening on my watch :-)\n\n----------------\n\nAnyhow it's good enough now.",
    "created_at": "2021-11-02T09:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446757",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:111 mkoeppe]:
> 1. `perl_mongodb` *is* optional for polymake.
> 
> 2. Whether system `perl_mongodb` is available or not, we can use system `polymake`.

except that we can't in some cases, see above.

> 
> 3. Even if we add an installation script for `perl_mongodb`, installing it as an SPKG does NOT make it necessary to stop using the system polymake (which is what `SAGE_SPKG_DEPCHECK` implements).

Hopefully this is not happening on my watch :-)

----------------

Anyhow it's good enough now.



---

archive/issue_comments_446758.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-11-02T09:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446758",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_446759.json:
```json
{
    "body": "Thanks.",
    "created_at": "2021-11-02T17:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446759",
    "user": "https://github.com/mkoeppe"
}
```

Thanks.



---

archive/issue_comments_446760.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-11-07T09:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31290#issuecomment-446760",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_082830.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-11-07T09:36:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31290",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31290#event-82830"
}
```
