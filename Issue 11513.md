# Issue 11513: Pari finite field extension created by list not recognised as zero

archive/issues_011513.json:
```json
{
    "body": "Assignee: AlexGhitza\n\nKeywords: finite fields\n\nIn sage-4.7.1.rc1:\n\n```\nsage: K.<a> = GF(3^11)\nsage: K([0])\n0\nsage: K([0]) == 0\nFalse\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/11685\n\n",
    "created_at": "2011-08-12T23:02:00Z",
    "labels": [
        "algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "Pari finite field extension created by list not recognised as zero",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11513",
    "user": "johanbosman"
}
```
Assignee: AlexGhitza

Keywords: finite fields

In sage-4.7.1.rc1:

```
sage: K.<a> = GF(3^11)
sage: K([0])
0
sage: K([0]) == 0
False
```


Issue created by migration from https://trac.sagemath.org/ticket/11685





---

archive/issue_comments_128943.json:
```json
{
    "body": "Changing keywords from \"finite fields\" to \"finite fields, pari\".",
    "created_at": "2011-08-13T10:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128943",
    "user": "johanbosman"
}
```

Changing keywords from "finite fields" to "finite fields, pari".



---

archive/issue_comments_128944.json:
```json
{
    "body": "Attachment [trac_11685_pari_zero_list.patch](tarball://root/attachments/some-uuid/ticket11685/trac_11685_pari_zero_list.patch) by johanbosman created at 2011-08-13 12:28:26",
    "created_at": "2011-08-13T12:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128944",
    "user": "johanbosman"
}
```

Attachment [trac_11685_pari_zero_list.patch](tarball://root/attachments/some-uuid/ticket11685/trac_11685_pari_zero_list.patch) by johanbosman created at 2011-08-13 12:28:26



---

archive/issue_comments_128945.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-08-13T12:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128945",
    "user": "johanbosman"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_128946.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-08-14T13:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128946",
    "user": "SimonKing"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_128947.json:
```json
{
    "body": "Looking at the value of the attribute `__value`, I can confirm that there has been a bug, and I can confirm that your patch fixes it. The fix is tested, and the long doctests of both devel/sage-main/doc and devel/sage-main/sage pass.\n\nHence, I give it a positive review.",
    "created_at": "2011-08-14T13:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128947",
    "user": "SimonKing"
}
```

Looking at the value of the attribute `__value`, I can confirm that there has been a bug, and I can confirm that your patch fixes it. The fix is tested, and the long doctests of both devel/sage-main/doc and devel/sage-main/sage pass.

Hence, I give it a positive review.



---

archive/issue_comments_128948.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-08-16T12:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128948",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_128949.json:
```json
{
    "body": "I add an alternative patch which IMHO fixes the problem in a better way, adds more tests and simplifies some other code regarding zero elements.",
    "created_at": "2011-08-16T12:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128949",
    "user": "jdemeyer"
}
```

I add an alternative patch which IMHO fixes the problem in a better way, adds more tests and simplifies some other code regarding zero elements.



---

archive/issue_comments_128950.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-08-16T12:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128950",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_128951.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-08-16T13:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128951",
    "user": "johanbosman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_128952.json:
```json
{
    "body": "There are doctests that fail: \n\n```\nsage -t  1.rc1/devel/sage-main/sage/rings/polynomial/polynomial_zz_pex.pyx # 9 doctests failed\n```\n",
    "created_at": "2011-08-16T13:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128952",
    "user": "johanbosman"
}
```

There are doctests that fail: 

```
sage -t  1.rc1/devel/sage-main/sage/rings/polynomial/polynomial_zz_pex.pyx # 9 doctests failed
```




---

archive/issue_comments_128953.json:
```json
{
    "body": "Replying to [comment:7 johanbosman]:\n> There are doctests that fail: \n> {{{\n> sage -t  1.rc1/devel/sage-main/sage/rings/polynomial/polynomial_zz_pex.pyx # 9 doctests failed\n> }}}\nIn combination with the fixes in #11684, that is.",
    "created_at": "2011-08-16T13:11:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128953",
    "user": "johanbosman"
}
```

Replying to [comment:7 johanbosman]:
> There are doctests that fail: 
> {{{
> sage -t  1.rc1/devel/sage-main/sage/rings/polynomial/polynomial_zz_pex.pyx # 9 doctests failed
> }}}
In combination with the fixes in #11684, that is.



---

archive/issue_comments_128954.json:
```json
{
    "body": "Replying to [comment:8 johanbosman]:\n> \n> In combination with the fixes in #11684, that is.\n\nIf it is only in combination with #11684, then please test whether the problem persists if only the patch from here is applied.",
    "created_at": "2011-08-16T14:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128954",
    "user": "SimonKing"
}
```

Replying to [comment:8 johanbosman]:
> 
> In combination with the fixes in #11684, that is.

If it is only in combination with #11684, then please test whether the problem persists if only the patch from here is applied.



---

archive/issue_comments_128955.json:
```json
{
    "body": "Replying to [comment:8 johanbosman]:\n> Replying to [comment:7 johanbosman]:\n> > There are doctests that fail: \n> > {{{\n> > sage -t  1.rc1/devel/sage-main/sage/rings/polynomial/polynomial_zz_pex.pyx # 9 doctests failed\n> > }}}\n> In combination with the fixes in #11684, that is.\n\nAgreed.  The problem here is the empty list `[]`.  I did not realize this was a legal argument to the constructor.",
    "created_at": "2011-08-16T14:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128955",
    "user": "jdemeyer"
}
```

Replying to [comment:8 johanbosman]:
> Replying to [comment:7 johanbosman]:
> > There are doctests that fail: 
> > {{{
> > sage -t  1.rc1/devel/sage-main/sage/rings/polynomial/polynomial_zz_pex.pyx # 9 doctests failed
> > }}}
> In combination with the fixes in #11684, that is.

Agreed.  The problem here is the empty list `[]`.  I did not realize this was a legal argument to the constructor.



---

archive/issue_comments_128956.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-08-16T15:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128956",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_128957.json:
```json
{
    "body": "With [attachment:trac_11685_pari_zero_list.patch], we have (correctly)\n\n```\nsage: K.<a>=GF(next_prime(2**60)**3)\nsage: b = K([0])\nsage: K([b._FiniteField_ext_pariElement__value])._FiniteField_ext_pariElement__value\nMod(Mod(0, 1152921504606847009), Mod(1, 1152921504606847009)*a^3 + Mod(1132330333307175281, 1152921504606847009)*a^2 + Mod(564283687250211459, 1152921504606847009)*a + Mod(455334297379199858, 1152921504606847009))\n```\n\n\nWith [attachment:11685.patch], that example fails as follows:\n\n```\nsage: K.<a>=GF(next_prime(2**60)**3)                                            \nsage: b = K([0])\nsage: K([b._FiniteField_ext_pariElement__value])._FiniteField_ext_pariElement__value  \nERROR: An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: ('EOF in multi-line statement', (1140, 0))\n\n---------------------------------------------------------------------------\nPariError                                 Traceback (most recent call last)\n...\nPariError: incorrect type (11)\n```\n\n\nI think it *should* be possible to use the value of a pari element for the creation of a pari element. Hence, either we use the first patch, or the second patch needs work.\n\nPerhaps, one could merge the two patches and use Johan's algorithm together with Jeroen's examples?",
    "created_at": "2011-08-16T15:18:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128957",
    "user": "SimonKing"
}
```

With [attachment:trac_11685_pari_zero_list.patch], we have (correctly)

```
sage: K.<a>=GF(next_prime(2**60)**3)
sage: b = K([0])
sage: K([b._FiniteField_ext_pariElement__value])._FiniteField_ext_pariElement__value
Mod(Mod(0, 1152921504606847009), Mod(1, 1152921504606847009)*a^3 + Mod(1132330333307175281, 1152921504606847009)*a^2 + Mod(564283687250211459, 1152921504606847009)*a + Mod(455334297379199858, 1152921504606847009))
```


With [attachment:11685.patch], that example fails as follows:

```
sage: K.<a>=GF(next_prime(2**60)**3)                                            
sage: b = K([0])
sage: K([b._FiniteField_ext_pariElement__value])._FiniteField_ext_pariElement__value  
ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (1140, 0))

---------------------------------------------------------------------------
PariError                                 Traceback (most recent call last)
...
PariError: incorrect type (11)
```


I think it *should* be possible to use the value of a pari element for the creation of a pari element. Hence, either we use the first patch, or the second patch needs work.

Perhaps, one could merge the two patches and use Johan's algorithm together with Jeroen's examples?



---

archive/issue_comments_128958.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-08-16T15:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128958",
    "user": "SimonKing"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_128959.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-08-16T15:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128959",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_128960.json:
```json
{
    "body": "New code, new tests to implement Simon King's suggestion.",
    "created_at": "2011-08-16T15:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128960",
    "user": "jdemeyer"
}
```

New code, new tests to implement Simon King's suggestion.



---

archive/issue_comments_128961.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2011-08-16T16:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128961",
    "user": "SimonKing"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_128962.json:
```json
{
    "body": "The error has changed, but there's still an error:\n\n```\nsage: K.<a>=GF(next_prime(2**60)**3)                                            \nsage: b = K([0])\nsage: K([b._FiniteField_ext_pariElement__value])._FiniteField_ext_pariElement__value\nERROR: An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: ('EOF in multi-line statement', (1140, 0))\n\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: unable to coerce\n```\n\n\n*If* we want to make that kind of conversion work (perhaps Johan can express his point of view?) then something needs to be done.",
    "created_at": "2011-08-16T16:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128962",
    "user": "SimonKing"
}
```

The error has changed, but there's still an error:

```
sage: K.<a>=GF(next_prime(2**60)**3)                                            
sage: b = K([0])
sage: K([b._FiniteField_ext_pariElement__value])._FiniteField_ext_pariElement__value
ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (1140, 0))

---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: unable to coerce
```


*If* we want to make that kind of conversion work (perhaps Johan can express his point of view?) then something needs to be done.



---

archive/issue_comments_128963.json:
```json
{
    "body": "Also, we should keep speed in mind.  I've done some timings:\n\nWith my patch:\n\n```\nsage: K.<a> = GF(3^11)\nsage: timeit('K([])')\n625 loops, best of 3: 38.7 \u00b5s per loop\n```\n\n\nWith Jeroen's current patch:\n\n```\nsage: K.<a> = GF(3^11)\nsage: timeit('K([])')\n625 loops, best of 3: 153 \u00b5s per loop\n```\n",
    "created_at": "2011-08-16T16:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128963",
    "user": "johanbosman"
}
```

Also, we should keep speed in mind.  I've done some timings:

With my patch:

```
sage: K.<a> = GF(3^11)
sage: timeit('K([])')
625 loops, best of 3: 38.7 µs per loop
```


With Jeroen's current patch:

```
sage: K.<a> = GF(3^11)
sage: timeit('K([])')
625 loops, best of 3: 153 µs per loop
```




---

archive/issue_comments_128964.json:
```json
{
    "body": "Replying to [comment:17 SimonKing]:\n> The error has changed, but there's still an error:\n> {{{\n> sage: K.<a>=GF(next_prime(2**60)**3)                                            \n> sage: b = K([0])\n> sage: K([b._FiniteField_ext_pariElement__value])._FiniteField_ext_pariElement__value\n> ERROR: An unexpected error occurred while tokenizing input\n> The following traceback may be corrupted or invalid\n> The error message is: ('EOF in multi-line statement', (1140, 0))\n> \n> ---------------------------------------------------------------------------\n> TypeError                                 Traceback (most recent call last)\n> ...\n> TypeError: unable to coerce\n> }}}\n> \n> *If* we want to make that kind of conversion work (perhaps Johan can express his point of view?) then something needs to be done.\nYes, I certainly think it is a good idea to have such a conversion work.",
    "created_at": "2011-08-16T16:34:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128964",
    "user": "johanbosman"
}
```

Replying to [comment:17 SimonKing]:
> The error has changed, but there's still an error:
> {{{
> sage: K.<a>=GF(next_prime(2**60)**3)                                            
> sage: b = K([0])
> sage: K([b._FiniteField_ext_pariElement__value])._FiniteField_ext_pariElement__value
> ERROR: An unexpected error occurred while tokenizing input
> The following traceback may be corrupted or invalid
> The error message is: ('EOF in multi-line statement', (1140, 0))
> 
> ---------------------------------------------------------------------------
> TypeError                                 Traceback (most recent call last)
> ...
> TypeError: unable to coerce
> }}}
> 
> *If* we want to make that kind of conversion work (perhaps Johan can express his point of view?) then something needs to be done.
Yes, I certainly think it is a good idea to have such a conversion work.



---

archive/issue_comments_128965.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2011-08-16T16:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128965",
    "user": "SimonKing"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_128966.json:
```json
{
    "body": "If both the stability and the timings speak for the first patch, then I'd say y'all should merge your two patches into one. I do believe that the doc tests from the second patch are more thorough, and it would also be nice to include the corner cases that came up in the discussion.",
    "created_at": "2011-08-16T16:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128966",
    "user": "SimonKing"
}
```

If both the stability and the timings speak for the first patch, then I'd say y'all should merge your two patches into one. I do believe that the doc tests from the second patch are more thorough, and it would also be nice to include the corner cases that came up in the discussion.



---

archive/issue_comments_128967.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-08-16T16:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128967",
    "user": "SimonKing"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_128968.json:
```json
{
    "body": "Replying to [comment:20 SimonKing]:\n> If both the stability and the timings speak for the first patch, then I'd say y'all should merge your two patches into one.\nI think that the fact that your example works for the first patch is an unintentional side-effect and not really an intended feature.  I believe my code is much more clear and simple.\n\nI believe that I am fixing much more than what the ticket requires, but I will fix my patch anyway.",
    "created_at": "2011-08-16T16:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128968",
    "user": "jdemeyer"
}
```

Replying to [comment:20 SimonKing]:
> If both the stability and the timings speak for the first patch, then I'd say y'all should merge your two patches into one.
I think that the fact that your example works for the first patch is an unintentional side-effect and not really an intended feature.  I believe my code is much more clear and simple.

I believe that I am fixing much more than what the ticket requires, but I will fix my patch anyway.



---

archive/issue_comments_128969.json:
```json
{
    "body": "Replying to [comment:22 jdemeyer]:\n> I think that the fact that your example works for the first patch is an unintentional side-effect and not really an intended feature. \n\nIntended or not doesn't matter. It is a feature, I think.\n\n> I believe that I am fixing much more than what the ticket requires, ...\n\nIndeed it does, namely:\n\n```\nsage: k.<x> = GF(3^11)\nsage: k([ k(0),k(1) ]) \nx \nsage: k([0,1/2]) \n2 \nsage: R.<y> = PolynomialRing(k) \nsage: k([ R(0),R(1) ]) \nx\n```\n\n\nIt a strength of your patch that the examples above work (they wouldn't, with the other patch).\n\nDo you see a way to make *both* work?\n\nI wouldn't say that your patch is simpler, because you first convert into a list of prime field elements and then convert into pari; a double conversion, so it seems to me, tends to be fragile.\n\nI mean, the only problem with `k([k([0])._FiniteField_ext_pariElement__value])` in your patch is the fact that the pari value (which, after all, is zero) can not be converted into the zero of a finite field. There could be a work around, such as\n\n```\nvalue = [GFp(c) for c in value if c else GFp.zero_element()] \n```\n\n\nConcerning speed, one should test whether `k([])` is the only case in which your patch is slower. Since you have a special case for `k([])` anyway, it would be perfectly fine to have a short-cut, such as\n\n```\nif not value:  # or value==[], if that's faster\n    self.__value = (pari(0) * parent._pari_one()).Mod(parent._pari_modulus()) \n```\n",
    "created_at": "2011-08-16T17:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128969",
    "user": "SimonKing"
}
```

Replying to [comment:22 jdemeyer]:
> I think that the fact that your example works for the first patch is an unintentional side-effect and not really an intended feature. 

Intended or not doesn't matter. It is a feature, I think.

> I believe that I am fixing much more than what the ticket requires, ...

Indeed it does, namely:

```
sage: k.<x> = GF(3^11)
sage: k([ k(0),k(1) ]) 
x 
sage: k([0,1/2]) 
2 
sage: R.<y> = PolynomialRing(k) 
sage: k([ R(0),R(1) ]) 
x
```


It a strength of your patch that the examples above work (they wouldn't, with the other patch).

Do you see a way to make *both* work?

I wouldn't say that your patch is simpler, because you first convert into a list of prime field elements and then convert into pari; a double conversion, so it seems to me, tends to be fragile.

I mean, the only problem with `k([k([0])._FiniteField_ext_pariElement__value])` in your patch is the fact that the pari value (which, after all, is zero) can not be converted into the zero of a finite field. There could be a work around, such as

```
value = [GFp(c) for c in value if c else GFp.zero_element()] 
```


Concerning speed, one should test whether `k([])` is the only case in which your patch is slower. Since you have a special case for `k([])` anyway, it would be perfectly fine to have a short-cut, such as

```
if not value:  # or value==[], if that's faster
    self.__value = (pari(0) * parent._pari_one()).Mod(parent._pari_modulus()) 
```




---

archive/issue_comments_128970.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-08-16T18:15:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128970",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_128971.json:
```json
{
    "body": "Replying to [comment:23 SimonKing]:\n> I mean, the only problem with `k([k([0])._FiniteField_ext_pariElement__value])` in your patch is the fact that the pari value (which, after all, is zero) can not be converted into the zero of a finite field.\n\nThis is not true, because this problem is not specific to zero.  The problem really is that conversion of PARI finite field elements to `ZZ` fails.  I rewrote the PARI -> ZZ conversion to fix this (the old code used strings(!) for the conversion)",
    "created_at": "2011-08-16T18:15:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128971",
    "user": "jdemeyer"
}
```

Replying to [comment:23 SimonKing]:
> I mean, the only problem with `k([k([0])._FiniteField_ext_pariElement__value])` in your patch is the fact that the pari value (which, after all, is zero) can not be converted into the zero of a finite field.

This is not true, because this problem is not specific to zero.  The problem really is that conversion of PARI finite field elements to `ZZ` fails.  I rewrote the PARI -> ZZ conversion to fix this (the old code used strings(!) for the conversion)



---

archive/issue_comments_128972.json:
```json
{
    "body": "Replying to [comment:23 SimonKing]:\n> I wouldn't say that your patch is simpler, because you first convert into a list of prime field elements and then convert into pari; a double conversion, so it seems to me, tends to be fragile.\n\nI would rather argue the opposite: I break the conversion down to two simpler independent steps.\n\nIt is probably true that my code is slower, but it all depends on what you want.  Pick two:\n- Fast code\n- Simple code\n- Code with many features",
    "created_at": "2011-08-16T18:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128972",
    "user": "jdemeyer"
}
```

Replying to [comment:23 SimonKing]:
> I wouldn't say that your patch is simpler, because you first convert into a list of prime field elements and then convert into pari; a double conversion, so it seems to me, tends to be fragile.

I would rather argue the opposite: I break the conversion down to two simpler independent steps.

It is probably true that my code is slower, but it all depends on what you want.  Pick two:
- Fast code
- Simple code
- Code with many features



---

archive/issue_comments_128973.json:
```json
{
    "body": "Note that most of the timing overhead in my latest patch is due to the creation of the `FiniteField` object.  Maybe we could add a `prime_field()` cached method and use that?",
    "created_at": "2011-08-16T18:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128973",
    "user": "jdemeyer"
}
```

Note that most of the timing overhead in my latest patch is due to the creation of the `FiniteField` object.  Maybe we could add a `prime_field()` cached method and use that?



---

archive/issue_comments_128974.json:
```json
{
    "body": "Let me add that I discovered this bug while working on #11684, which is a speed issue.  Normally I don't care so much about speed, but in this case things are really *far* too slow already; we should definitely not make them any slower, especially since this is not necessary.  Seemingly innocent computations in Sage are often dominated by enormous chains of type conversions rather than the actual computations they intend to be.\n\nIn conclusion: it may be a good idea to either use such a cached method or avoid creating FiniteFields at all. ;).",
    "created_at": "2011-08-16T19:00:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128974",
    "user": "johanbosman"
}
```

Let me add that I discovered this bug while working on #11684, which is a speed issue.  Normally I don't care so much about speed, but in this case things are really *far* too slow already; we should definitely not make them any slower, especially since this is not necessary.  Seemingly innocent computations in Sage are often dominated by enormous chains of type conversions rather than the actual computations they intend to be.

In conclusion: it may be a good idea to either use such a cached method or avoid creating FiniteFields at all. ;).



---

archive/issue_comments_128975.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-08-16T19:00:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128975",
    "user": "johanbosman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_128976.json:
```json
{
    "body": "Replying to [comment:26 jdemeyer]:\n> Note that most of the timing overhead in my latest patch is due to the creation of the `FiniteField` object.  Maybe we could add a `prime_field()` cached method and use that?\n\nThere is a `prime_subfield()` method, and you are perfectly right that it ought to be a cached method. Hopefully someone finally manages to review #11115: It would make cached methods *very* fast.\n\n\"Breaking down into two simpler steps\" makes sense. But one should keep in mind that it will now be *two* steps that could break. And if you measure simplicity in lines of code: Both patches have six lines of code in the section we are now talking about (if I did not miscount).\n\nPerhaps we should clarify what we want to do with a list.\n\nLet K be a finite field that is not a prime field. To the very least, we want: If L is a list of elements of the prime subfield k of K then K(L) should first interprete L as the list of coefficients of a polynomial, and interprete the polynomial as an element of K.\n\nIdeally, we also want to allow in L objects that can be converted into k, even though their parent is not k in the first place. We seem to disagree on how that conversion is best done.\n\n 1) The first patch seems to argue that, ultimately, we want to put stuff into pari, and so we should start to put it into pari as soon as possible, and do all further conversions there: We can put a list of field elements into pari, and we can easily convert things like pari(K(0)) into an element of pari(k).\n\n 2) The second patch seems to argue that we are Sage programmers, and thus the conversion should follow Sage standards, not pari standards. Thus, k is a finite prime field in Sage, and we only accept things that can be converted into that prime field. Apparently, an element of pari(K) that happens to belong to pari(k) fails to convert into k, sadly.\n\nI think that both approaches are equally simple, and both approaches make sense.\n\nSo, I suggest to decide based on (a) speed and (b) generality. (b) could be problematic, since at the moment we have examples that only work with the first patch and examples that only work with the second patch.\n\nAccording to Johan, things are already quite slow, so, speed should really matter most.\n\nBy the way, I'd prefer fast code with many features, if I can pick only two out of three...",
    "created_at": "2011-08-16T19:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128976",
    "user": "SimonKing"
}
```

Replying to [comment:26 jdemeyer]:
> Note that most of the timing overhead in my latest patch is due to the creation of the `FiniteField` object.  Maybe we could add a `prime_field()` cached method and use that?

There is a `prime_subfield()` method, and you are perfectly right that it ought to be a cached method. Hopefully someone finally manages to review #11115: It would make cached methods *very* fast.

"Breaking down into two simpler steps" makes sense. But one should keep in mind that it will now be *two* steps that could break. And if you measure simplicity in lines of code: Both patches have six lines of code in the section we are now talking about (if I did not miscount).

Perhaps we should clarify what we want to do with a list.

Let K be a finite field that is not a prime field. To the very least, we want: If L is a list of elements of the prime subfield k of K then K(L) should first interprete L as the list of coefficients of a polynomial, and interprete the polynomial as an element of K.

Ideally, we also want to allow in L objects that can be converted into k, even though their parent is not k in the first place. We seem to disagree on how that conversion is best done.

 1) The first patch seems to argue that, ultimately, we want to put stuff into pari, and so we should start to put it into pari as soon as possible, and do all further conversions there: We can put a list of field elements into pari, and we can easily convert things like pari(K(0)) into an element of pari(k).

 2) The second patch seems to argue that we are Sage programmers, and thus the conversion should follow Sage standards, not pari standards. Thus, k is a finite prime field in Sage, and we only accept things that can be converted into that prime field. Apparently, an element of pari(K) that happens to belong to pari(k) fails to convert into k, sadly.

I think that both approaches are equally simple, and both approaches make sense.

So, I suggest to decide based on (a) speed and (b) generality. (b) could be problematic, since at the moment we have examples that only work with the first patch and examples that only work with the second patch.

According to Johan, things are already quite slow, so, speed should really matter most.

By the way, I'd prefer fast code with many features, if I can pick only two out of three...



---

archive/issue_comments_128977.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-08-17T10:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128977",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_128978.json:
```json
{
    "body": "New patch uses PARI if possible with a generic fallback if PARI fails.  This should be quite fast and still work in general.",
    "created_at": "2011-08-17T10:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128978",
    "user": "jdemeyer"
}
```

New patch uses PARI if possible with a generic fallback if PARI fails.  This should be quite fast and still work in general.



---

archive/issue_comments_128979.json:
```json
{
    "body": "The patch passes all long doctests, the speed is okay, and it works in combination with #11684.  Conclusion: positive review. :).",
    "created_at": "2011-08-17T12:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128979",
    "user": "johanbosman"
}
```

The patch passes all long doctests, the speed is okay, and it works in combination with #11684.  Conclusion: positive review. :).



---

archive/issue_comments_128980.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-08-17T12:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128980",
    "user": "johanbosman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_128981.json:
```json
{
    "body": "I tend to a positive review as well.\n\nHowever, I have one question (thus \"needs info\"): Why did you remove the `if not check: ...` section? If one knows that the input is sane then it is very common to use `check=False` in order to save time.",
    "created_at": "2011-08-17T12:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128981",
    "user": "SimonKing"
}
```

I tend to a positive review as well.

However, I have one question (thus "needs info"): Why did you remove the `if not check: ...` section? If one knows that the input is sane then it is very common to use `check=False` in order to save time.



---

archive/issue_comments_128982.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2011-08-17T12:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128982",
    "user": "SimonKing"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_128983.json:
```json
{
    "body": "Replying to [comment:31 SimonKing]:\n> I tend to a positive review as well.\n> \n> However, I have one question (thus \"needs info\"): Why did you remove the `if not check: ...` section? If one knows that the input is sane then it is very common to use `check=False` in order to save time.\n\n1) That option and the code was completely undocumented and the purpose is not clear.\n\n2) The logic seems backward: executing more code when *not* checking?\n\n3) The ``check`` code changes the functionality of the function, which is usually not desired.  To me checking should be something read-only, checking for invalid input and throwing exceptions.  But not modifying the input.\n\n4) the ``check`` code is related to the handling of zero inputs which is anyway handled separately in the code below.",
    "created_at": "2011-08-17T13:05:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128983",
    "user": "jdemeyer"
}
```

Replying to [comment:31 SimonKing]:
> I tend to a positive review as well.
> 
> However, I have one question (thus "needs info"): Why did you remove the `if not check: ...` section? If one knows that the input is sane then it is very common to use `check=False` in order to save time.

1) That option and the code was completely undocumented and the purpose is not clear.

2) The logic seems backward: executing more code when *not* checking?

3) The ``check`` code changes the functionality of the function, which is usually not desired.  To me checking should be something read-only, checking for invalid input and throwing exceptions.  But not modifying the input.

4) the ``check`` code is related to the handling of zero inputs which is anyway handled separately in the code below.



---

archive/issue_comments_128984.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2011-08-17T13:05:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128984",
    "user": "jdemeyer"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_128985.json:
```json
{
    "body": "First of all, note that the option `check==False` is used, as you can see by studying the arithmetic operations on finite field elements. And it is clearly beneficial! For example:\n\nWithout patches, I get\n\n```\nsage: K.<a> = GF(5^9)\nsage: b = 4*a^7 + 2*a^5 + 4*a^4 + 4*a^3 + 3*a^2 + 3*a\nsage: %timeit b+3  # here, you will find that \"check=False\".\n625 loops, best of 3: 30.9 \u00b5s per loop\nsage: %timeit copy(b)\n625 loops, best of 3: 14.3 \u00b5s per loop\n```\n\nWith your patch, it takes 42 \u00b5s resp. 25.9 \u00b5s per loop.\n\n25-30% difference is relevant. Thus, I'd prefer to keep the \"check=False\" code.\n\nMoreover, I can still not understand your rationale for removing the code:\n\nReplying to [comment:32 jdemeyer]:\n> 1) That option and the code was completely undocumented and the purpose is not clear.\n\nIf code is not documented then it should be documented, not removed.\n\nThe purpose is very clear: Provide better speed by avoiding any tests (or conversions, in this case). I think it is fairly common to have that option in Sage, of course for internal use only.\n\nThe price to pay for the speed is that one needs to provide very specific input: It must be pari.\n\n> 2) The logic seems backward: executing more code when *not* checking?\n\nYou can't be serious.\n\nIf one has `check=False` then one just has\n\n```\n        if not check:\n            if not value:  # see comment below about this workaround\n                self.__value = pari(0).Mod(parent._pari_modulus())*parent._pari_one()\n            else:\n                self.__value = value\n            return\n```\n\nand nothing more: Note the \"return\" in the last line.\n\n> 3) The ``check`` code changes the functionality of the function, which is usually not desired.\n\nIt is quite usual that the check option does change the behaviour of the function, in the sense that a very specific input is expected, and it is not tested whether the user really got it right.\n\nHere, check=False means that the input must be an element in the pari interface. Only since \"zero\" is a special case (see comments in the code), you have the test \"if not value\". As a side effect, the input `[]` or `None` or `False` would result in a zero element as well.\n\n>  To me checking should be something read-only, checking for invalid input and throwing exceptions.  But not modifying the input.\n\nSometimes you have two separate options `check` and `coerce`. Here, indeed, checking means that the input is also converted, when necessary. `convert_to_pari` might be a better name than `check`.\n\nBut since it is for internal use anyway, I see not much reason to change the name.\n\n> 4) the ``check`` code is related to the handling of zero inputs which is anyway handled separately in the code below.\n\nNo. The check code simply provides a short cut for pari input. Only since pari is inconsistent in the way how different types of zero are dealt with, a special case is needed.\n\nI suggest to use your patch without removing the `if check:` part. Can you please update it? And since the arguments of the `__init__` method are not documented at all, I suggest that I create a referee patch that fixes the documentation.",
    "created_at": "2011-08-17T14:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128985",
    "user": "SimonKing"
}
```

First of all, note that the option `check==False` is used, as you can see by studying the arithmetic operations on finite field elements. And it is clearly beneficial! For example:

Without patches, I get

```
sage: K.<a> = GF(5^9)
sage: b = 4*a^7 + 2*a^5 + 4*a^4 + 4*a^3 + 3*a^2 + 3*a
sage: %timeit b+3  # here, you will find that "check=False".
625 loops, best of 3: 30.9 µs per loop
sage: %timeit copy(b)
625 loops, best of 3: 14.3 µs per loop
```

With your patch, it takes 42 µs resp. 25.9 µs per loop.

25-30% difference is relevant. Thus, I'd prefer to keep the "check=False" code.

Moreover, I can still not understand your rationale for removing the code:

Replying to [comment:32 jdemeyer]:
> 1) That option and the code was completely undocumented and the purpose is not clear.

If code is not documented then it should be documented, not removed.

The purpose is very clear: Provide better speed by avoiding any tests (or conversions, in this case). I think it is fairly common to have that option in Sage, of course for internal use only.

The price to pay for the speed is that one needs to provide very specific input: It must be pari.

> 2) The logic seems backward: executing more code when *not* checking?

You can't be serious.

If one has `check=False` then one just has

```
        if not check:
            if not value:  # see comment below about this workaround
                self.__value = pari(0).Mod(parent._pari_modulus())*parent._pari_one()
            else:
                self.__value = value
            return
```

and nothing more: Note the "return" in the last line.

> 3) The ``check`` code changes the functionality of the function, which is usually not desired.

It is quite usual that the check option does change the behaviour of the function, in the sense that a very specific input is expected, and it is not tested whether the user really got it right.

Here, check=False means that the input must be an element in the pari interface. Only since "zero" is a special case (see comments in the code), you have the test "if not value". As a side effect, the input `[]` or `None` or `False` would result in a zero element as well.

>  To me checking should be something read-only, checking for invalid input and throwing exceptions.  But not modifying the input.

Sometimes you have two separate options `check` and `coerce`. Here, indeed, checking means that the input is also converted, when necessary. `convert_to_pari` might be a better name than `check`.

But since it is for internal use anyway, I see not much reason to change the name.

> 4) the ``check`` code is related to the handling of zero inputs which is anyway handled separately in the code below.

No. The check code simply provides a short cut for pari input. Only since pari is inconsistent in the way how different types of zero are dealt with, a special case is needed.

I suggest to use your patch without removing the `if check:` part. Can you please update it? And since the arguments of the `__init__` method are not documented at all, I suggest that I create a referee patch that fixes the documentation.



---

archive/issue_comments_128986.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-08-17T14:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128986",
    "user": "SimonKing"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_128987.json:
```json
{
    "body": "SimonKing: I agree with your comments, I somehow totally misread the ``check=False`` code.",
    "created_at": "2011-08-17T14:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128987",
    "user": "jdemeyer"
}
```

SimonKing: I agree with your comments, I somehow totally misread the ``check=False`` code.



---

archive/issue_comments_128988.json:
```json
{
    "body": "I see, so you change `check` into `value_from_pari`. So, I'll change my (not yet submitted) referee patch accordingly, and will run full doc tests. And then it'll hopefully be fine...",
    "created_at": "2011-08-17T15:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128988",
    "user": "SimonKing"
}
```

I see, so you change `check` into `value_from_pari`. So, I'll change my (not yet submitted) referee patch accordingly, and will run full doc tests. And then it'll hopefully be fine...



---

archive/issue_comments_128989.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-08-17T15:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128989",
    "user": "SimonKing"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_128990.json:
```json
{
    "body": "I see that you just do\n\n```\nif value_from_pari: \n    self.__value = value\n```\n\nwithout a special case for a vanishing value.\n\nI assume that the special case `if not value:` was there on purpose. Let's see what the tests say...",
    "created_at": "2011-08-17T16:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128990",
    "user": "SimonKing"
}
```

I see that you just do

```
if value_from_pari: 
    self.__value = value
```

without a special case for a vanishing value.

I assume that the special case `if not value:` was there on purpose. Let's see what the tests say...



---

archive/issue_comments_128991.json:
```json
{
    "body": "Referee patch, adding documentation",
    "created_at": "2011-08-17T16:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128991",
    "user": "SimonKing"
}
```

Referee patch, adding documentation



---

archive/issue_comments_128992.json:
```json
{
    "body": "Attachment [11685_referee.patch](tarball://root/attachments/some-uuid/ticket11685/11685_referee.patch) by SimonKing created at 2011-08-17 16:53:55\n\nThe tests pass, hence, it was not necessary to have a special case for zero if `value_from_pari==True`.\n\nI have attached a referee patch, that documents the arguments and adds a few examples. I hope my words are clear and concise enough, as the possible input can be very different.\n\nIf you think that my referee patch needs work, then feel free to complain.\n\nApply 11685.patch 11685_referee.patch",
    "created_at": "2011-08-17T16:53:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128992",
    "user": "SimonKing"
}
```

Attachment [11685_referee.patch](tarball://root/attachments/some-uuid/ticket11685/11685_referee.patch) by SimonKing created at 2011-08-17 16:53:55

The tests pass, hence, it was not necessary to have a special case for zero if `value_from_pari==True`.

I have attached a referee patch, that documents the arguments and adds a few examples. I hope my words are clear and concise enough, as the possible input can be very different.

If you think that my referee patch needs work, then feel free to complain.

Apply 11685.patch 11685_referee.patch



---

archive/issue_comments_128993.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-08-17T16:53:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128993",
    "user": "SimonKing"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_128994.json:
```json
{
    "body": "Replying to [comment:36 SimonKing]:\n> I assume that the special case `if not value:` was there on purpose. Let's see what the tests say...\n\nI guess the special case was needed precisely because of some earlier badly-initialized zero.  If we don't start with a bad zero, we cannot somehow end up with a bad zero (I hope).",
    "created_at": "2011-08-17T16:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128994",
    "user": "jdemeyer"
}
```

Replying to [comment:36 SimonKing]:
> I assume that the special case `if not value:` was there on purpose. Let's see what the tests say...

I guess the special case was needed precisely because of some earlier badly-initialized zero.  If we don't start with a bad zero, we cannot somehow end up with a bad zero (I hope).



---

archive/issue_comments_128995.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-08-22T16:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128995",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_128996.json:
```json
{
    "body": "I changed the patch by re-enabling the use of PARI's exponentiation.  There was a warning which does not apply any more.  The only change is in the `__pow__()` method, needs review.",
    "created_at": "2011-08-22T16:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128996",
    "user": "jdemeyer"
}
```

I changed the patch by re-enabling the use of PARI's exponentiation.  There was a warning which does not apply any more.  The only change is in the `__pow__()` method, needs review.



---

archive/issue_comments_128997.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-08-22T16:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128997",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_128998.json:
```json
{
    "body": "Attachment [11685.patch](tarball://root/attachments/some-uuid/ticket11685/11685.patch) by jdemeyer created at 2011-08-22 16:08:01\n\nNew alternative patch, rewrites PARI->Integer coercion, fast and many features",
    "created_at": "2011-08-22T16:08:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128998",
    "user": "jdemeyer"
}
```

Attachment [11685.patch](tarball://root/attachments/some-uuid/ticket11685/11685.patch) by jdemeyer created at 2011-08-22 16:08:01

New alternative patch, rewrites PARI->Integer coercion, fast and many features



---

archive/issue_comments_128999.json:
```json
{
    "body": "I do get some fuzz applying the patch to sage-4.6.2.alpha1:\n\n```\napplying 11685.patch\npatching file sage/rings/integer.pyx\nHunk #2 succeeded at 3081 with fuzz 2 (offset 2525 lines).\nHunk #4 succeeded at 610 with fuzz 2 (offset -24 lines).\nnow at: 11685.patch\n```\n\nHow bad is that?",
    "created_at": "2011-08-24T12:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-128999",
    "user": "johanbosman"
}
```

I do get some fuzz applying the patch to sage-4.6.2.alpha1:

```
applying 11685.patch
patching file sage/rings/integer.pyx
Hunk #2 succeeded at 3081 with fuzz 2 (offset 2525 lines).
Hunk #4 succeeded at 610 with fuzz 2 (offset -24 lines).
now at: 11685.patch
```

How bad is that?



---

archive/issue_comments_129000.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2011-08-24T12:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129000",
    "user": "johanbosman"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_129001.json:
```json
{
    "body": "Replying to [comment:41 johanbosman]:\n> I do get some fuzz applying the patch to sage-4.6.2.alpha1:\n\nDo you mean \"sage-4.7.2.alpha1\" (not 4.6.2 but 4.7.2)?\n\n> Hunk #2 succeeded at 3081 with fuzz 2 (offset 2525 lines).\n> Hunk #4 succeeded at 610 with fuzz 2 (offset -24 lines).\n\nIf I remember correctly, fuzz 2 will not be accepted by the release manager, because it is not improbable that the patch was applied in the wrong location - in particular when the offset is a couple of thousand lines.",
    "created_at": "2011-08-24T12:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129001",
    "user": "SimonKing"
}
```

Replying to [comment:41 johanbosman]:
> I do get some fuzz applying the patch to sage-4.6.2.alpha1:

Do you mean "sage-4.7.2.alpha1" (not 4.6.2 but 4.7.2)?

> Hunk #2 succeeded at 3081 with fuzz 2 (offset 2525 lines).
> Hunk #4 succeeded at 610 with fuzz 2 (offset -24 lines).

If I remember correctly, fuzz 2 will not be accepted by the release manager, because it is not improbable that the patch was applied in the wrong location - in particular when the offset is a couple of thousand lines.



---

archive/issue_comments_129002.json:
```json
{
    "body": "> Do you mean \"sage-4.7.2.alpha1\" (not 4.6.2 but 4.7.2)?\nYes, I meant that indeed. :).\n\n> \n> > Hunk #2 succeeded at 3081 with fuzz 2 (offset 2525 lines).\n> > Hunk #4 succeeded at 610 with fuzz 2 (offset -24 lines).\n> \n> If I remember correctly, fuzz 2 will not be accepted by the release manager, because it is not improbable that the patch was applied in the wrong location - in particular when the offset is a couple of thousand lines.\n\nOkay, so in that case it needs to be rebased.",
    "created_at": "2011-08-24T12:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129002",
    "user": "johanbosman"
}
```

> Do you mean "sage-4.7.2.alpha1" (not 4.6.2 but 4.7.2)?
Yes, I meant that indeed. :).

> 
> > Hunk #2 succeeded at 3081 with fuzz 2 (offset 2525 lines).
> > Hunk #4 succeeded at 610 with fuzz 2 (offset -24 lines).
> 
> If I remember correctly, fuzz 2 will not be accepted by the release manager, because it is not improbable that the patch was applied in the wrong location - in particular when the offset is a couple of thousand lines.

Okay, so in that case it needs to be rebased.



---

archive/issue_comments_129003.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2011-08-28T16:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129003",
    "user": "johanbosman"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_129004.json:
```json
{
    "body": "I've uploaded a rebased patch.  If someone can double-check it, then we can give this ticket a positive review again.",
    "created_at": "2011-08-28T16:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129004",
    "user": "johanbosman"
}
```

I've uploaded a rebased patch.  If someone can double-check it, then we can give this ticket a positive review again.



---

archive/issue_comments_129005.json:
```json
{
    "body": "negative_review because the patch is applied in the wrong place (as was hinted in a comment above).",
    "created_at": "2011-08-28T21:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129005",
    "user": "jdemeyer"
}
```

negative_review because the patch is applied in the wrong place (as was hinted in a comment above).



---

archive/issue_comments_129006.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-08-28T21:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129006",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_129007.json:
```json
{
    "body": "What do you mean by \"applied in the wrong place\"?",
    "created_at": "2011-08-28T21:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129007",
    "user": "johanbosman"
}
```

What do you mean by "applied in the wrong place"?



---

archive/issue_comments_129008.json:
```json
{
    "body": "11685.patch rebased against sage-4.7.2.alpha1",
    "created_at": "2011-08-31T12:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129008",
    "user": "johanbosman"
}
```

11685.patch rebased against sage-4.7.2.alpha1



---

archive/issue_comments_129009.json:
```json
{
    "body": "Attachment [11685_against_4.7.2.alpha1.patch](tarball://root/attachments/some-uuid/ticket11685/11685_against_4.7.2.alpha1.patch) by johanbosman created at 2011-08-31 12:56:42\n\nIt appears that I'm blind. :P.  Second try. ;).",
    "created_at": "2011-08-31T12:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129009",
    "user": "johanbosman"
}
```

Attachment [11685_against_4.7.2.alpha1.patch](tarball://root/attachments/some-uuid/ticket11685/11685_against_4.7.2.alpha1.patch) by johanbosman created at 2011-08-31 12:56:42

It appears that I'm blind. :P.  Second try. ;).



---

archive/issue_comments_129010.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-08-31T12:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129010",
    "user": "johanbosman"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_129011.json:
```json
{
    "body": "What patches are to be applied? That's to say, shouldn't the ticket description be changed, so that 11685_against_4.7.2.alpha1.patch is applied instead of 11685.patch?",
    "created_at": "2011-09-08T15:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129011",
    "user": "SimonKing"
}
```

What patches are to be applied? That's to say, shouldn't the ticket description be changed, so that 11685_against_4.7.2.alpha1.patch is applied instead of 11685.patch?



---

archive/issue_comments_129012.json:
```json
{
    "body": "Replying to [comment:48 SimonKing]:\n> What patches are to be applied? That's to say, shouldn't the ticket description be changed, so that 11685_against_4.7.2.alpha1.patch is applied instead of 11685.patch?\nThat depends on the release manager, I guess.  I do not really know which of those 2 patches should be in the description, i.e. either the patch that applies against the latest stable release or the patch that applies against the latest alpha release.  But in any case, 11685_against_4.7.2.alpha1.patch is most likely the one that is going to be applied.",
    "created_at": "2011-09-08T15:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129012",
    "user": "johanbosman"
}
```

Replying to [comment:48 SimonKing]:
> What patches are to be applied? That's to say, shouldn't the ticket description be changed, so that 11685_against_4.7.2.alpha1.patch is applied instead of 11685.patch?
That depends on the release manager, I guess.  I do not really know which of those 2 patches should be in the description, i.e. either the patch that applies against the latest stable release or the patch that applies against the latest alpha release.  But in any case, 11685_against_4.7.2.alpha1.patch is most likely the one that is going to be applied.



---

archive/issue_comments_129013.json:
```json
{
    "body": "Latest devel of course.",
    "created_at": "2011-09-12T11:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129013",
    "user": "leif"
}
```

Latest devel of course.



---

archive/issue_comments_129014.json:
```json
{
    "body": "Anyone to review this? #11684 depends on it.",
    "created_at": "2011-09-12T11:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129014",
    "user": "leif"
}
```

Anyone to review this? #11684 depends on it.



---

archive/issue_comments_129015.json:
```json
{
    "body": "I have read the patches, applied them, checked by hand whether it worked and tested the whole Sage installation.  Everything runs without problems in version 4.7.1.  I am now going to test it with 4.7.2.alpha1 before giving it a positive review.",
    "created_at": "2011-09-13T09:40:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129015",
    "user": "pbruin"
}
```

I have read the patches, applied them, checked by hand whether it worked and tested the whole Sage installation.  Everything runs without problems in version 4.7.1.  I am now going to test it with 4.7.2.alpha1 before giving it a positive review.



---

archive/issue_comments_129016.json:
```json
{
    "body": "Replying to [comment:52 pbruin]:\n> I have read the patches, applied them, checked by hand whether it worked and tested the whole Sage installation.  Everything runs without problems in version 4.7.1.  I am now going to test it with 4.7.2.alpha1 before giving it a positive review.\nFYI: the patch against 4.7.2.alpha1 should also work against 4.7.2.alpha2, which is the most recent development version. ;)",
    "created_at": "2011-09-13T10:00:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129016",
    "user": "johanbosman"
}
```

Replying to [comment:52 pbruin]:
> I have read the patches, applied them, checked by hand whether it worked and tested the whole Sage installation.  Everything runs without problems in version 4.7.1.  I am now going to test it with 4.7.2.alpha1 before giving it a positive review.
FYI: the patch against 4.7.2.alpha1 should also work against 4.7.2.alpha2, which is the most recent development version. ;)



---

archive/issue_comments_129017.json:
```json
{
    "body": "Replying to [comment:53 johanbosman]:\n> FYI: the patch against 4.7.2.alpha1 should also work against 4.7.2.alpha2, which is the most recent development version. ;)\nOK, I'm now testing it with 4.7.2.alpha2 instead.",
    "created_at": "2011-09-13T13:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129017",
    "user": "pbruin"
}
```

Replying to [comment:53 johanbosman]:
> FYI: the patch against 4.7.2.alpha1 should also work against 4.7.2.alpha2, which is the most recent development version. ;)
OK, I'm now testing it with 4.7.2.alpha2 instead.



---

archive/issue_comments_129018.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-09-14T09:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129018",
    "user": "pbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_129019.json:
```json
{
    "body": "All tests passed in 4.7.2.alpha2 as well, so I'm giving it a positive review.",
    "created_at": "2011-09-14T09:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129019",
    "user": "pbruin"
}
```

All tests passed in 4.7.2.alpha2 as well, so I'm giving it a positive review.



---

archive/issue_comments_129020.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-09-17T05:04:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11513#issuecomment-129020",
    "user": "leif"
}
```

Resolution: fixed
