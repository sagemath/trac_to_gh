# Issue 31039: Tensor Product Method for FiniteRankFreeModule

archive/issues_031039.json:
```json
{
    "body": "CC:  tscrim egourgoulhon jhpalmieri mkoeppe chapoton\n\nWe introduce the methods `tensor_product` and `tensor_power` as per #30373.\n\nFurthermore, we introduce a method `tensor_product`for elements.\n\nIssue created by migration from https://trac.sagemath.org/ticket/31276\n\n",
    "created_at": "2021-01-21T20:47:46Z",
    "labels": [
        "algebra",
        "major",
        "enhancement"
    ],
    "title": "Tensor Product Method for FiniteRankFreeModule",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31039",
    "user": "@mjungmath"
}
```
CC:  tscrim egourgoulhon jhpalmieri mkoeppe chapoton

We introduce the methods `tensor_product` and `tensor_power` as per #30373.

Furthermore, we introduce a method `tensor_product`for elements.

Issue created by migration from https://trac.sagemath.org/ticket/31276





---

archive/issue_comments_443317.json:
```json
{
    "body": "Turns out that this is not as easy as expected.\n\n1. `FiniteRankFreeModule` has no attribute (or method) `tensor_type` in contrast to `TensorFreeModule`. If it had, one could just add the tensor types and return the corresponding module. However, I see no point why `FiniteRankFreeModule` should have such a method/attribute apart from this single purpose.\n2. Trying to wrap the patch over, it turns out that `TensorFreeModule` inherits from `FiniteRankFreeModule` and therefore inherits all methods and attributes. So far so good, but as I understand the code, instances of `TensorFreeModule` are not intended to use most of these methods. `FiniteRankFreeModule` is intended to be the \"control center\" that takes care of things. This leads to somewhat strange (and probably unwanted) behavior:\n   {{{\n   sage: M = FiniteRankFreeModule(QQ, 3)\n   sage: T11 = M.tensor_module(1, 1)\n   sage: T11 is M.tensor_module(1, 1)\n   True\n   sage: T11 is T11.tensor_module(1, 1)\n   False\n   }}}\n\n   and\n   {{{\n   sage: M = FiniteRankFreeModule(ZZ, 2)\n   sage: e = M.basis('e')\n   sage: f = M.basis('f', from_family=(e[0]-e[1], -2*e[0]+3*e[1]))\n   sage: M.change_of_basis(e, f)\n   Automorphism of the Rank-2 free module over the Integer Ring\n   sage: T11 = M.tensor_module(1, 1)\n   sage: T11.change_of_basis(e, f)\n   Traceback (most recent call last):\n   ...\n   TypeError: Basis (e_0,e_1) on the Rank-2 free module over the Integer Ring is not a basis of the Free module of type-(1,1) tensors on the Rank-2 free module over the Integer Ring\n   }}}\n  \n   The latter might be acceptable because `e` and `f` are, strictly speaking, no bases of `T11`. However, this methods has then no use in `TensorFreeModule`. Nevertheless, these are just two examples and there is a lot more. Furthermore, `TensorFreeModule` initializes a bunch of dictionaries, sets and further attributes that are not used anywhere else. I think this should be changed.",
    "created_at": "2021-01-21T21:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443317",
    "user": "@mjungmath"
}
```

Turns out that this is not as easy as expected.

1. `FiniteRankFreeModule` has no attribute (or method) `tensor_type` in contrast to `TensorFreeModule`. If it had, one could just add the tensor types and return the corresponding module. However, I see no point why `FiniteRankFreeModule` should have such a method/attribute apart from this single purpose.
2. Trying to wrap the patch over, it turns out that `TensorFreeModule` inherits from `FiniteRankFreeModule` and therefore inherits all methods and attributes. So far so good, but as I understand the code, instances of `TensorFreeModule` are not intended to use most of these methods. `FiniteRankFreeModule` is intended to be the "control center" that takes care of things. This leads to somewhat strange (and probably unwanted) behavior:
   {{{
   sage: M = FiniteRankFreeModule(QQ, 3)
   sage: T11 = M.tensor_module(1, 1)
   sage: T11 is M.tensor_module(1, 1)
   True
   sage: T11 is T11.tensor_module(1, 1)
   False
   }}}

   and
   {{{
   sage: M = FiniteRankFreeModule(ZZ, 2)
   sage: e = M.basis('e')
   sage: f = M.basis('f', from_family=(e[0]-e[1], -2*e[0]+3*e[1]))
   sage: M.change_of_basis(e, f)
   Automorphism of the Rank-2 free module over the Integer Ring
   sage: T11 = M.tensor_module(1, 1)
   sage: T11.change_of_basis(e, f)
   Traceback (most recent call last):
   ...
   TypeError: Basis (e_0,e_1) on the Rank-2 free module over the Integer Ring is not a basis of the Free module of type-(1,1) tensors on the Rank-2 free module over the Integer Ring
   }}}
  
   The latter might be acceptable because `e` and `f` are, strictly speaking, no bases of `T11`. However, this methods has then no use in `TensorFreeModule`. Nevertheless, these are just two examples and there is a lot more. Furthermore, `TensorFreeModule` initializes a bunch of dictionaries, sets and further attributes that are not used anywhere else. I think this should be changed.



---

archive/issue_comments_443318.json:
```json
{
    "body": "Replying to [comment:1 gh-mjungmath]:\n> \n> 2. Trying to wrap the patch over, it turns out that `TensorFreeModule` inherits from `FiniteRankFreeModule` and therefore inherits all methods and attributes. So far so good, but as I understand the code, instances of `TensorFreeModule` are not intended to use most of these methods.\n\nIndeed, so maybe a better inheritance structure should be devised.\n\n> `FiniteRankFreeModule` is intended to be the \"control center\" that takes care of things. \n\nYes. This avoids information redundancy, in particular regarding the bases.\n\n>This leads to somewhat strange (and probably unwanted) behavior:\n>   {{{\n>   sage: M = FiniteRankFreeModule(QQ, 3)\n>   sage: T11 = M.tensor_module(1, 1)\n>   sage: T11 is M.tensor_module(1, 1)\n>   True\n>   sage: T11 is T11.tensor_module(1, 1)\n>   False\n>   }}}\n\nWhy do you call this strange behavior? Both answers, `True` and `False`, are mathematically correct.\n\n>   and\n>   {{{\n>   sage: M = FiniteRankFreeModule(ZZ, 2)\n>   sage: e = M.basis('e')\n>   sage: f = M.basis('f', from_family=(e[0]-e[1], -2*e[0]+3*e[1]))\n>   sage: M.change_of_basis(e, f)\n>   Automorphism of the Rank-2 free module over the Integer Ring\n>   sage: T11 = M.tensor_module(1, 1)\n>   sage: T11.change_of_basis(e, f)\n>   Traceback (most recent call last):\n>   ...\n>   TypeError: Basis (e_0,e_1) on the Rank-2 free module over the Integer Ring is not a basis of the Free module of type-(1,1) tensors on the Rank-2 free module over the Integer Ring\n>   }}}\n>   \n>   The latter might be acceptable because `e` and `f` are, strictly speaking, no bases of `T11`. \n\nYes, the `TypeError` sounds correct here.\n\n>However, this methods has then no use in `TensorFreeModule`. Nevertheless, these are just two examples and there is a lot more. Furthermore, `TensorFreeModule` initializes a bunch of dictionaries, sets and further attributes that are not used anywhere else.\n\nYou mean those attributes inherited from `FiniteRankFreeModule`?",
    "created_at": "2021-01-21T23:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443318",
    "user": "egourgoulhon"
}
```

Replying to [comment:1 gh-mjungmath]:
> 
> 2. Trying to wrap the patch over, it turns out that `TensorFreeModule` inherits from `FiniteRankFreeModule` and therefore inherits all methods and attributes. So far so good, but as I understand the code, instances of `TensorFreeModule` are not intended to use most of these methods.

Indeed, so maybe a better inheritance structure should be devised.

> `FiniteRankFreeModule` is intended to be the "control center" that takes care of things. 

Yes. This avoids information redundancy, in particular regarding the bases.

>This leads to somewhat strange (and probably unwanted) behavior:
>   {{{
>   sage: M = FiniteRankFreeModule(QQ, 3)
>   sage: T11 = M.tensor_module(1, 1)
>   sage: T11 is M.tensor_module(1, 1)
>   True
>   sage: T11 is T11.tensor_module(1, 1)
>   False
>   }}}

Why do you call this strange behavior? Both answers, `True` and `False`, are mathematically correct.

>   and
>   {{{
>   sage: M = FiniteRankFreeModule(ZZ, 2)
>   sage: e = M.basis('e')
>   sage: f = M.basis('f', from_family=(e[0]-e[1], -2*e[0]+3*e[1]))
>   sage: M.change_of_basis(e, f)
>   Automorphism of the Rank-2 free module over the Integer Ring
>   sage: T11 = M.tensor_module(1, 1)
>   sage: T11.change_of_basis(e, f)
>   Traceback (most recent call last):
>   ...
>   TypeError: Basis (e_0,e_1) on the Rank-2 free module over the Integer Ring is not a basis of the Free module of type-(1,1) tensors on the Rank-2 free module over the Integer Ring
>   }}}
>   
>   The latter might be acceptable because `e` and `f` are, strictly speaking, no bases of `T11`. 

Yes, the `TypeError` sounds correct here.

>However, this methods has then no use in `TensorFreeModule`. Nevertheless, these are just two examples and there is a lot more. Furthermore, `TensorFreeModule` initializes a bunch of dictionaries, sets and further attributes that are not used anywhere else.

You mean those attributes inherited from `FiniteRankFreeModule`?



---

archive/issue_comments_443319.json:
```json
{
    "body": "Replying to [comment:2 egourgoulhon]:\n> Why do you call this strange behavior? Both answers, `True` and `False`, are mathematically correct.\n\nOf course, right, it's the tensor module of the tensor module. But we also have:\n\n\n```\nsage: T22 = T11.tensor_module(1, 1)\nsage: T22 is M.tensor_module(1, 1)\nFalse\n```\n\n\nBut one could argue here that these objects are different mathematical entities which are just isomorphic. On the other hand, they behave exactly the same as instances of `TensorFreeModule`.\n\n\n> \n> You mean those attributes inherited from `FiniteRankFreeModule`?\n> \n\nIndeed. At least those that are not needed in `TensorFreeModule`.",
    "created_at": "2021-01-21T23:29:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443319",
    "user": "@mjungmath"
}
```

Replying to [comment:2 egourgoulhon]:
> Why do you call this strange behavior? Both answers, `True` and `False`, are mathematically correct.

Of course, right, it's the tensor module of the tensor module. But we also have:


```
sage: T22 = T11.tensor_module(1, 1)
sage: T22 is M.tensor_module(1, 1)
False
```


But one could argue here that these objects are different mathematical entities which are just isomorphic. On the other hand, they behave exactly the same as instances of `TensorFreeModule`.


> 
> You mean those attributes inherited from `FiniteRankFreeModule`?
> 

Indeed. At least those that are not needed in `TensorFreeModule`.



---

archive/issue_comments_443320.json:
```json
{
    "body": "Replying to [comment:3 gh-mjungmath]:\n> Replying to [comment:2 egourgoulhon]:\n> > Why do you call this strange behavior? Both answers, `True` and `False`, are mathematically correct.\n> \n> Of course, right, it's the tensor module of the tensor module. But we also have:\n> \n> {{{\n> sage: T22 = T11.tensor_module(1, 1)\n> sage: T22 is M.tensor_module(1, 1)\n> False\n> }}}\n> \nI guess you mean \n\n```\nsage: T22 = T11.tensor_module(1, 1)\nsage: T22 is M.tensor_module(2, 2)\nFalse\n```\n\nWhat would be the purpose to implement such an identification? Do you have a use case in mind?",
    "created_at": "2021-01-22T10:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443320",
    "user": "egourgoulhon"
}
```

Replying to [comment:3 gh-mjungmath]:
> Replying to [comment:2 egourgoulhon]:
> > Why do you call this strange behavior? Both answers, `True` and `False`, are mathematically correct.
> 
> Of course, right, it's the tensor module of the tensor module. But we also have:
> 
> {{{
> sage: T22 = T11.tensor_module(1, 1)
> sage: T22 is M.tensor_module(1, 1)
> False
> }}}
> 
I guess you mean 

```
sage: T22 = T11.tensor_module(1, 1)
sage: T22 is M.tensor_module(2, 2)
False
```

What would be the purpose to implement such an identification? Do you have a use case in mind?



---

archive/issue_comments_443321.json:
```json
{
    "body": "Replying to [comment:4 egourgoulhon]:\n> I guess you mean \n> {{{\n> sage: T22 = T11.tensor_module(1, 1)\n> sage: T22 is M.tensor_module(2, 2)\n> False\n> }}}\n\nYes, indeed...it was late yesterday..\n\n> What would be the purpose to implement such an identification? Do you have a use case in mind?\n\nAlright, it should be fine. I totally missed the tensor module inception going on here. Then, it would be nice to have at least the canonical isomorphism from `T11.tensor_module(1, 1)` to `M.tensor_module(2, 2)` implemented, in particular make the following work:\n\n\n```\nsage: t = T11.tensor((1,1))\nsage: M.tensor_module(2,2)(t)\nTraceback (most recent call last):\n...\nStopIteration:\n```\n\n\nand the other way around.\n\nNevertheless, what do we do about my first point in comment:1? An `instanceof` check for each object coming in?",
    "created_at": "2021-01-22T11:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443321",
    "user": "@mjungmath"
}
```

Replying to [comment:4 egourgoulhon]:
> I guess you mean 
> {{{
> sage: T22 = T11.tensor_module(1, 1)
> sage: T22 is M.tensor_module(2, 2)
> False
> }}}

Yes, indeed...it was late yesterday..

> What would be the purpose to implement such an identification? Do you have a use case in mind?

Alright, it should be fine. I totally missed the tensor module inception going on here. Then, it would be nice to have at least the canonical isomorphism from `T11.tensor_module(1, 1)` to `M.tensor_module(2, 2)` implemented, in particular make the following work:


```
sage: t = T11.tensor((1,1))
sage: M.tensor_module(2,2)(t)
Traceback (most recent call last):
...
StopIteration:
```


and the other way around.

Nevertheless, what do we do about my first point in comment:1? An `instanceof` check for each object coming in?



---

archive/issue_comments_443322.json:
```json
{
    "body": "Replying to [comment:5 gh-mjungmath]:\n> Replying to [comment:4 egourgoulhon]:\n> \n> Nevertheless, what do we do about my first point in comment:1? An `instanceof` check for each object coming in? \n\nI see no reason why `FiniteRankFreeModule` should not have a `tensor_type()` method (returning `(1, 0)`), as `TensorFreeModule`.",
    "created_at": "2021-01-22T17:04:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443322",
    "user": "egourgoulhon"
}
```

Replying to [comment:5 gh-mjungmath]:
> Replying to [comment:4 egourgoulhon]:
> 
> Nevertheless, what do we do about my first point in comment:1? An `instanceof` check for each object coming in? 

I see no reason why `FiniteRankFreeModule` should not have a `tensor_type()` method (returning `(1, 0)`), as `TensorFreeModule`.



---

archive/issue_comments_443323.json:
```json
{
    "body": "Alright, then let's do this. This method would also be beneficial to introduce the above coercion.",
    "created_at": "2021-01-22T17:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443323",
    "user": "@mjungmath"
}
```

Alright, then let's do this. This method would also be beneficial to introduce the above coercion.



---

archive/issue_comments_443324.json:
```json
{
    "body": "Relevant previous discussions: #30241, #30229#comment:6",
    "created_at": "2021-01-22T19:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443324",
    "user": "mkoeppe"
}
```

Relevant previous discussions: #30241, #30229#comment:6



---

archive/issue_comments_443325.json:
```json
{
    "body": "Replying to [comment:9 mkoeppe]:\n> Relevant previous discussions: #30241, #30229#comment:6\n\nThanks for pointing out this! Especially the [comment:2](https://trac.sagemath.org/ticket/30229#comment:2) in the second ticket provides details for the *\"Yes. This avoids information redundancy, in particular regarding the bases\"* in comment:2 of the current ticket.",
    "created_at": "2021-01-22T19:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443325",
    "user": "egourgoulhon"
}
```

Replying to [comment:9 mkoeppe]:
> Relevant previous discussions: #30241, #30229#comment:6

Thanks for pointing out this! Especially the [comment:2](https://trac.sagemath.org/ticket/30229#comment:2) in the second ticket provides details for the *"Yes. This avoids information redundancy, in particular regarding the bases"* in comment:2 of the current ticket.



---

archive/issue_comments_443326.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443326",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_443327.json:
```json
{
    "body": "Narrowed the ticket description to parent methods only, not element methods",
    "created_at": "2022-08-23T06:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443327",
    "user": "mkoeppe"
}
```

Narrowed the ticket description to parent methods only, not element methods



---

archive/issue_comments_443328.json:
```json
{
    "body": "Replying to [comment:6 egourgoulhon]:\n> I see no reason why `FiniteRankFreeModule` should not have a `tensor_type()` method (returning `(1, 0)`), as `TensorFreeModule`. \n\nDone now\n----\nNew commits:",
    "created_at": "2022-08-23T06:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443328",
    "user": "mkoeppe"
}
```

Replying to [comment:6 egourgoulhon]:
> I see no reason why `FiniteRankFreeModule` should not have a `tensor_type()` method (returning `(1, 0)`), as `TensorFreeModule`. 

Done now
----
New commits:



---

archive/issue_comments_443329.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-23T07:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443329",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_443330.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-23T07:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443330",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_443331.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-23T07:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443331",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_443332.json:
```json
{
    "body": "Thanks for this enhancement. LGTM.",
    "created_at": "2022-08-23T09:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443332",
    "user": "egourgoulhon"
}
```

Thanks for this enhancement. LGTM.



---

archive/issue_comments_443333.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-23T09:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443333",
    "user": "egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_443334.json:
```json
{
    "body": "Thanks!",
    "created_at": "2022-08-23T13:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443334",
    "user": "mkoeppe"
}
```

Thanks!



---

archive/issue_comments_443335.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-08-29T11:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443335",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_443336.json:
```json
{
    "body": "See #34471 for a follow-up.",
    "created_at": "2022-09-01T10:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31039#issuecomment-443336",
    "user": "egourgoulhon"
}
```

See #34471 for a follow-up.
