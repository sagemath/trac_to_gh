# Issue 25947: Broken regression test on search_doc

Issue created by migration from https://trac.sagemath.org/ticket/26184

Original creator: jdemeyer

Original creation time: 2018-09-03 08:07:08

CC:  embray saraedum

The tests added by #26017 do not pass:

```
$ ./sage -t --long --optional=dochtml,sage src/sage/misc/sagedoc.py 
too many failed tests, not using stored timings
Running doctests with ID 2018-09-03-10-02-38-192a29c9.
Git branch: HEAD
Using --optional=dochtml,memlimit,sage
Doctesting 1 file.
sage -t --long src/sage/misc/sagedoc.py
**********************************************************************
File "src/sage/misc/sagedoc.py", line 1179, in sage.misc.sagedoc.?
Failed example:
    len(L) < N  # optional - dochtml, long time
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/misc/sagedoc.py", line 1183, in sage.misc.sagedoc.?
Failed example:
    all(tree_re.search(l) for l in L) # optional - dochtml, long time
Expected:
    True
Got:
    False
**********************************************************************
```


Due to a bug in the doctest framework (#26110), these tests are not run by default.


---

Comment by embray created at 2018-09-03 08:30:38

To clarify something: these tests _did_ pass when I wrote them.  I can confirm this because when I added them `optional - dochtml` didn't exist yet (that was only added on #26017 after I rebased the branch later to include that feature).

I confirmed manually that it passed then, and it also passes for me now when run manually (on 8.4.beta2).  Of course, by nature, it _will not_ pass if not run against a complete build of the docs.  #26017 made it less sensitive to specific magic numbers, but it still doesn't make sense without a full build of the html docs to run against.


---

Comment by jdemeyer created at 2018-09-03 08:59:53

Replying to [comment:1 embray]:
> I confirmed manually that it passed then, and it also passes for me now when run manually (on 8.4.beta2).

Do you mean 8.4.beta3? Because that's when #26017 was merged.


---

Comment by jdemeyer created at 2018-09-03 09:09:22

By the way, for me both numbers `len(L)` and `N` are equal to 9495 in 8.4.beta3.


---

Comment by embray created at 2018-09-03 09:15:24

No, I mean beta2.  I haven't pulled beta3 yet.  What I mean is that if I run those lines manually in Sage the tests pass.  Perhaps there is something else that changed in beta3 that caused it to start failing anew.  #24784 would be a likely candidate.


---

Comment by embray created at 2018-09-03 09:21:30

Yep, I see the problem.


---

Comment by embray created at 2018-09-03 09:28:28

New commits:


---

Comment by embray created at 2018-09-03 09:28:28

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-09-03 10:08:51

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-09-05 16:43:57

Resolution: fixed
