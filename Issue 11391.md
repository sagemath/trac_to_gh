# Issue 11391: Make lrcalc a standard package

Issue created by migration from Trac.

Original creator: nthiery

Original creation time: 2011-07-01 10:58:18

Assignee: sage-combinat

CC:  sage-combinat fbissey asbuch saliola

#10333 implements an interface to lrcalc, using an optional spkg.
According to the vote on http://groups.google.com/group/sage-devel/browse_thread/thread/2e7114375f6f88a5/, there is a consensus on making lrcalc a standard spkg, after a one release probation period in order to follow the official rule.


---

Comment by nthiery created at 2012-05-10 02:58:07

Changing keywords from "" to "lrcalc, symmetric functions".


---

Comment by nthiery created at 2012-05-10 02:58:07

Changing status from new to needs_review.


---

Comment by aschilling created at 2012-05-10 19:55:02

Changing keywords from "lrcalc, symmetric functions" to "lrcalc, symmetric functions, days38".


---

Comment by aschilling created at 2012-05-10 20:08:20

Changing status from needs_review to positive_review.


---

Comment by aschilling created at 2012-05-10 20:08:20

I ran the tests and looked at the documentation. Everything looks fine.

Anne


---

Comment by nthiery created at 2012-05-10 20:56:18

Thanks Anne!

Same comment as Mike :-)


---

Comment by jdemeyer created at 2012-05-11 11:43:52

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2012-05-11 11:43:52

This needs patches to `spkg/install` and `spkg/standard/deps`.


---

Comment by nthiery created at 2012-05-11 21:15:21

Hi Jeroen,

Replying to [comment:7 jdemeyer]:
> This needs patches to `spkg/install` and `spkg/standard/deps`.

Ah sorry, I missed that (that's my first standard spkg). Do you mind reviewing my changes?
You probably know better than anyone about them :-)

Thanks in advance!

Cheers,
                                  Nicolas


---

Comment by aschilling created at 2012-05-18 08:20:54

Replying to [comment:8 nthiery]:
>     Hi Jeroen,
> 
> Replying to [comment:7 jdemeyer]:
> > This needs patches to `spkg/install` and `spkg/standard/deps`.
> 
> Ah sorry, I missed that (that's my first standard spkg). Do you mind reviewing my changes?
> You probably know better than anyone about them :-)
> 
> Thanks in advance!
> 
> Cheers,
>                                   Nicolas

What is the status on this? It would be good to get this patch into sage soon so we can build on it (and avoid using symmetrica).

Thanks,

Anne


---

Comment by jdemeyer created at 2012-05-18 13:20:34

You should use `$MAKE` instead of `make` in `spkg-install` and `spkg-check`.

Some of the files in the spkg are not world-readable.  Please fix this with

```
chmod ugo+rX -R src
```


The `SAGE_ROOT` patch [attachment:trac_11563-lrcalc-sageroot-nt.patch] gets positive_review from me.

Finally: adding a new *standard* package should always be discussed on the sage-devel mailing list.


---

Comment by nthiery created at 2012-05-19 04:37:42

Changing status from needs_work to needs_review.


---

Comment by nthiery created at 2012-05-19 04:37:42

Replying to [comment:10 jdemeyer]:
> You should use `$MAKE` instead of `make` in `spkg-install` and `spkg-check`.
> 
> Some of the files in the spkg are not world-readable.  Please fix this with
> {{{
> chmod ugo+rX -R src
> }}}

Thanks for catching those. Done. Anne: may I let you set the final
positive review? Here is the diff in the updated version I am about to
upload (sorry, it does not show up permission changes):


```
diff --git a/spkg-check b/spkg-check
--- a/spkg-check
+++ b/spkg-check
`@``@` -8,7 +8,7 `@``@` fi
 
 cd src
 
-make check
+$MAKE check
 if [ $? -ne 0 ]; then
    echo "Error testing lrcalc."
    exit 1
diff --git a/spkg-install b/spkg-install
--- a/spkg-install
+++ b/spkg-install
`@``@` -14,13 +14,13 `@``@` if [ $? -ne 0 ]; then
    exit 1
 fi
 
-make
+$MAKE
 if [ $? -ne 0 ]; then
    echo "Error building lrcalc."
    exit 1
 fi
 
-make install
+$MAKE install
 if [ $? -ne 0 ]; then
    echo "Error installing lrcalc."
    exit 1
```


> The `SAGE_ROOT` patch [attachment:trac_11563-lrcalc-sageroot-nt.patch] gets positive_review from me.

Thanks.

> Finally: adding a new *standard* package should always be discussed on the sage-devel mailing list.

We did it a long time ago :-)

http://groups.google.com/group/sage-devel/browse_thread/thread/2e7114375f6f88a5/ca4e2ecb49fcc1cd?lnk=gst&q=lrcalc#ca4e2ecb49fcc1cd

Cheers,
                    Nicolas


---

Comment by aschilling created at 2012-05-19 17:15:08

Replying to [comment:13 nthiery]:

Looks good to me if Jeroen is happy!

Anne


---

Comment by aschilling created at 2012-05-19 17:15:28

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-05-26 17:32:20

When you change a package, you should change the version number (say, to `lrcalc-1.1.6beta.p0.spkg`) and change `SPKG.txt` accordingly.


---

Comment by jdemeyer created at 2012-05-26 17:32:20

Changing status from positive_review to needs_work.


---

Comment by nthiery created at 2012-06-15 20:06:30

Replying to [comment:16 jdemeyer]:
> When you change a package, you should change the version number (say, to `lrcalc-1.1.6beta.p0.spkg`) and change `SPKG.txt` accordingly.

Ok, there it is ...


---

Comment by nthiery created at 2012-06-15 20:07:35

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2012-06-15 20:31:42

I think that in SPKG.txt, at the top it should just say "lrcalc" rather than "lrcalc 1.1.6 beta p0": the version number should just be in the ChangeLog (for ease of updating later). I took the liberty of creating a new spkg (committed in your name, Nicolas). I'm also attaching a patch showing the changes.


---

Comment by nthiery created at 2012-06-15 20:41:48

Replying to [comment:19 jhpalmieri]:
> I think that in SPKG.txt, at the top it should just say "lrcalc" rather than "lrcalc 1.1.6 beta p0": the version number should just be in the ChangeLog (for ease of updating later). I took the liberty of creating a new spkg (committed in your name, Nicolas). I'm also attaching a patch showing the changes.

All good for me. Thanks.


---

Comment by jhpalmieri created at 2012-06-15 21:03:15

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-06-28 08:36:01

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2012-06-28 08:36:01

This needs to be rebased to sage-5.1.beta6:

```
patching file doc/en/reference/libs.rst
Hunk #1 FAILED at 26.
1 out of 1 hunk FAILED -- saving rejects to file doc/en/reference/libs.rst.rej
patching file sage/libs/lrcalc/lrcalc.pyx
```



---

Comment by nthiery created at 2012-06-28 15:53:18

Replying to [comment:25 jdemeyer]:
> This needs to be rebased to sage-5.1.beta6:
> {{{
> patching file doc/en/reference/libs.rst
> Hunk #1 FAILED at 26.
> 1 out of 1 hunk FAILED -- saving rejects to file doc/en/reference/libs.rst.rej
> patching file sage/libs/lrcalc/lrcalc.pyx
> }}}

Arr, what a pain; we are being soooo inefficient on this one.

Ok, I am downloading 5.1.rc0, and rebase this patch this afternoon or so. It would be good to have this spkg in 5.1 for Sage Days 40!


---

Attachment


---

Comment by nthiery created at 2012-06-29 06:14:20

Replying to [comment:26 nthiery]:
> Arr, what a pain; we are being soooo inefficient on this one.
> 
> Ok, I am downloading 5.1.rc0, and rebase this patch this afternoon or so. It would be good to have this spkg in 5.1 for Sage Days 40!

Ok, I just updated the patch, rebased on 5.1.rc0. The only change I had to do was:

```diff
diff --git a/doc/en/reference/libs.rst b/doc/en/reference/libs.rst
--- a/doc/en/reference/libs.rst
+++ b/doc/en/reference/libs.rst
`@``@` -27,6 +27,7 `@``@` to be aware of the modules described in 
    
    sage/libs/flint/fmpz_poly
    sage/libs/libecm
+   sage/libs/lrcalc/lrcalc
    sage/libs/pari/gen
    sage/libs/ntl/all
    sage/libs/mwrank/all
```


Back to needs review ...

Jeroen: if you feel like it, feel free to do such trivial rebases directly; it probably will take you less time than going through this whole process.

Cheers,
                            Nicolas


---

Comment by nthiery created at 2012-06-29 06:14:20

Changing status from needs_work to needs_review.


---

Comment by aschilling created at 2012-06-29 06:18:14

Changing status from needs_review to positive_review.


---

Attachment


---

Comment by jdemeyer created at 2012-07-03 07:28:31

`SAGE_ROOT` patch rebased to the upcoming sage-5.2.beta0.


---

Comment by nthiery created at 2012-07-05 05:12:47

Replying to [comment:29 jdemeyer]:
> `SAGE_ROOT` patch rebased to the upcoming sage-5.2.beta0.

Thanks!


---

Comment by jdemeyer created at 2012-07-07 22:29:30

Resolution: fixed


---

Comment by jdemeyer created at 2012-07-12 20:37:07

Resolution changed from fixed to 


---

Comment by jdemeyer created at 2012-07-12 20:37:07

Changing status from closed to new.


---

Comment by jdemeyer created at 2012-07-12 20:37:07

`lrcalc` fails on `hawk` (OpenSolaris 06.2009-32):

```
buildbot`@`hawk:~/sage-5.2.beta0$ ./sage --gdb
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
/export/home/buildbot/sage-5.2.beta0/local/bin/sage-ipython
GNU gdb 6.8
Copyright (C) 2008 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "i386-pc-solaris2.11"...
warning: Lowest section in /lib/libdl.so.1 is .dynamic at 00000074
Python 2.7.3 (default, Jul 11 2012, 15:59:32)
[GCC 4.4.3 20100112 (prerelease)] on sunos5
Type "help", "copyright", "credits" or "license" for more information.
warning: Lowest section in /lib/libintl.so.1 is .dynamic at 00000074
warning: Lowest section in /lib/libpthread.so.1 is .dynamic at 00000074
sage: from sage.libs.lrcalc import lrcalc
sage: lrcalc.mult([Integer(3),Integer(2),Integer(1)], [Integer(3),Integer(2),Integer(1)], Integer(3),Integer(2))
| Sage Version 5.2.beta0, Release Date: 2012-07-09                   |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
Program received signal SIGSEGV, Segmentation fault.
0x00000064 in ?? ()
(gdb) bt
#0  0x00000064 in ?? ()
#1  0xfd699fb1 in hash_insert (h=0xc107940, k=0xc108c58, v=0x1) at ../src/language/hash.c:52
#2  0xf6504bac in fusion_reduce (lc=0xc107940, rows=3, cols=2, opt_zero=0) at symfcn.c:866
#3  0xf6529a7f in __pyx_pf_4sage_4libs_6lrcalc_6lrcalc_4mult (__pyx_self=0x0, __pyx_args=0x8102374, __pyx_kwds=0x0)
    at sage/libs/lrcalc/lrcalc.c:2370
#4  0xfee7d7a0 in PyCFunction_Call (func=0xc0de02c, arg=0x8102374, kw=0xc108c58) at Objects/methodobject.c:85
#5  0xfeed917b in PyEval_EvalFrameEx (f=0xc1372ec, throwflag=0) at Python/ceval.c:4021
#6  0xfeed9c8b in PyEval_EvalCodeEx (co=0xc0da020, globals=0x851eb54, locals=0x851eb54, args=0x0, argcount=0, kws=0x0, kwcount=0,
    defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:3253
[...]
```



---

Comment by aschilling created at 2012-07-12 20:46:30

Could Nicolas and I get an account on hawk to investigate this? Or will you?

Thanks,

Anne


---

Comment by nthiery created at 2012-07-13 04:34:14

Thank to John, I could login on hawk and investigate. It turned out to be a C-level name conflict with a function called `hash_insert`. I used a macro to rename that function in the lrcalc sources. 

I also used the occasion to add examples of fusion and quantum calculations in the README and testsuite.

I bumped lrcalc's version accordingly. Anders: please finish up version 1.1.6 from there!

The updated spkg also only installs the lrcalc libraries and headers, not the binaries. Thanks John for pointing this out!

See the attached diff for the changes.

Quick review would be most appreciated to get this in 5.2!!!

Thanks,
                                   Nicolas


---

Comment by nthiery created at 2012-07-13 04:34:14

Changing status from new to needs_review.


---

Comment by nthiery created at 2012-07-13 04:41:58

I should mention: installation and tests passed smoothly on hawk and a ubuntu machine.


---

Comment by jhpalmieri created at 2012-07-13 05:00:08

Since the binaries are no longer installed, the test suite for the package fails (that is, running `sage -i -c lrcalc...`):

```
Successfully installed lrcalc-1.1.6beta1
Running the test suite for lrcalc-1.1.6beta1...
Making check in mathlib
make[1]: warning: -jN forced in submake: disabling jobserver mode.
make[1]: Nothing to be done for `check'.
Making check in lrcoef
make[1]: warning: -jN forced in submake: disabling jobserver mode.
make[1]: Nothing to be done for `check'.
Making check in schubert
make[1]: warning: -jN forced in submake: disabling jobserver mode.
make[1]: Nothing to be done for `check'.
make[1]: warning: -jN forced in submake: disabling jobserver mode.
make -j2  check-TESTS
make[2]: warning: -jN forced in submake: disabling jobserver mode.
-n testing lrcoef/lrcoef 3 2 1 - 2 1 - 2 1  ... 
ok
-n testing lrcoef/skew 3 2 1 - 2 1          ... 
ok
-n testing lrcoef/skew -r 2 3 2 1 / 2 1     ... 
ok
-n testing lrcoef/mult 2 1 - 2 1            ... 
ok
./testsuite: line 7: mult: command not found
-n testing mult -f 3,2 3 2 1 - 3 2 1        ... 
failed:
  Expected: 1  (4, 4, 4)
1  (5, 4, 3)
  Got: 
./testsuite: line 7: mult: command not found
-n testing mult -q 3,2 3 2 1 - 3 2 1        ... 
failed:
  Expected: 1  (2)
1  (1, 1)
  Got: 
-n testing lrcoef/coprod 3 2 1              ... 
ok
-n testing schubert/schubmult 1 3 2 - 1 3 2 ... 
ok
FAIL: testsuite
=======================================================
1 of 1 test failed
Please report to asbuch at math dot rutgers period edu 
=======================================================
```

Otherwise, all tests passed for me on hawk also, and on OS X 10.7. I think that since this had a positive review before, if you can fix spkg-check so self-tests pass, then it should get a positive review.


---

Attachment


---

Comment by nthiery created at 2012-07-13 05:46:28

Diff to previous positive reviewed spkg


---

Attachment

Replying to [comment:39 jhpalmieri]:
> Since the binaries are no longer installed, the test suite for the package fails

Oops, fixed (I was calling mult incorrectly in the new tests). Thanks for catching this! Updated spkg and diff attached.

Thanks for the super quick review :-)

Cheers,
                          Nicolas


---

Comment by jhpalmieri created at 2012-07-13 13:53:21

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2012-07-13 13:53:21

Looks good now. Passes its test suite and lrcalc.pyx passes doctests on sage.math, hawk, and OS X 10.7.


---

Comment by aschilling created at 2012-07-13 14:12:53

Replying to [comment:41 jhpalmieri]:
> Looks good now. Passes its test suite and lrcalc.pyx passes doctests on sage.math, hawk, and OS X 10.7.

Thanks, John, for running the final tests and giving access to hawk! You should add yourself to the list of reviewers!


---

Comment by jdemeyer created at 2012-07-16 16:36:03

Resolution: fixed


---

Comment by pcpa created at 2012-09-07 21:11:32

Is there some prevision of an official release of lrcalc 1.1.6?
I would like to package it in fedora, and believe the sagemath spkg is not mean't to be the upstream tarball. It should be good enough if upstream can make the 1.1.6beta tarball available.
But it has plenty of time as I deferred my fedora sagemath package to after fedora 18.


---

Comment by jdemeyer created at 2014-08-04 14:38:02

Please review the trivial follow-up ticket #16756.
