# Issue 30143: add option 'algorithm' to VectorPartitions

archive/issues_030143.json:
```json
{
    "body": "CC:  @amritanshu-prasad @fchapoton @tscrim\n\n\nI have added an option 'algorithm' to the class `VectorPartitions`.\n\nIf invoked as \n\n```\nVectorParitions(vec, algorithm = 'yorgey'),\n```\n\nit will use the function `fast_vector_partitions()` internally.\n\nDefault value is `None`.\n\nThis is the minimally invasive approach. Alternatively, one could make 'yorgey' the default, which would break some old code, but is much faster, so it would be preferred for new code. A middle way would be to add deprecation warnings.\n\nI will update the documentation once the best way forward is apparent.\n\nCf. Ticket [ticket:29221].\n\nIssue created by migration from https://trac.sagemath.org/ticket/30380\n\n",
    "created_at": "2020-08-17T12:08:49Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "add option 'algorithm' to VectorPartitions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30143",
    "user": "@denissunko"
}
```
CC:  @amritanshu-prasad @fchapoton @tscrim


I have added an option 'algorithm' to the class `VectorPartitions`.

If invoked as 

```
VectorParitions(vec, algorithm = 'yorgey'),
```

it will use the function `fast_vector_partitions()` internally.

Default value is `None`.

This is the minimally invasive approach. Alternatively, one could make 'yorgey' the default, which would break some old code, but is much faster, so it would be preferred for new code. A middle way would be to add deprecation warnings.

I will update the documentation once the best way forward is apparent.

Cf. Ticket [ticket:29221].

Issue created by migration from https://trac.sagemath.org/ticket/30380





---

archive/issue_comments_429479.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2020-08-17T15:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429479",
    "user": "@denissunko"
}
```

Changing priority from major to minor.



---

archive/issue_comments_429480.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-17T15:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429480",
    "user": "@denissunko"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_429481.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-08-17T15:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429481",
    "user": "@denissunko"
}
```

New commits:



---

archive/issue_comments_429482.json:
```json
{
    "body": "One thing you need to do is instead of yielding a list, you need to yield an element in the parent. So it needs to be something like this:\n\n```python\nfor p in fast_vector_partitions(self._vec, self._min):\n    yield self.element_class(self, p)\n```\n\n\nNow there is an issue with lexicographic ordering. My thought is to not worry about that and just change the iterator order. However, perhaps something out there is using that somehow, but I am a bit skeptical. I wouldn't add an option to the parent class. Instead, what I would do is add an the `algorithm` parameter to the `__iter__` method and add an `iterator = __iter__` alias.",
    "created_at": "2020-08-18T00:20:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429482",
    "user": "@tscrim"
}
```

One thing you need to do is instead of yielding a list, you need to yield an element in the parent. So it needs to be something like this:

```python
for p in fast_vector_partitions(self._vec, self._min):
    yield self.element_class(self, p)
```


Now there is an issue with lexicographic ordering. My thought is to not worry about that and just change the iterator order. However, perhaps something out there is using that somehow, but I am a bit skeptical. I wouldn't add an option to the parent class. Instead, what I would do is add an the `algorithm` parameter to the `__iter__` method and add an `iterator = __iter__` alias.



---

archive/issue_comments_429483.json:
```json
{
    "body": "Thanks for the comment. I did the yield part. I agree in principle that the container class need not know about the algorithm which created the content, so in this sense 'min' and 'algorithm' are qualitatively different options. However, I do not understand how `__iter__` would function with a parameter. I looked around the net and it seems that people who want to do that are mostly advised to add an option to the class, or implement a `__call__` method. Can you please elaborate a little?",
    "created_at": "2020-08-18T12:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429483",
    "user": "@denissunko"
}
```

Thanks for the comment. I did the yield part. I agree in principle that the container class need not know about the algorithm which created the content, so in this sense 'min' and 'algorithm' are qualitatively different options. However, I do not understand how `__iter__` would function with a parameter. I looked around the net and it seems that people who want to do that are mostly advised to add an option to the class, or implement a `__call__` method. Can you please elaborate a little?



---

archive/issue_comments_429484.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-18T19:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429484",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_429485.json:
```json
{
    "body": "I have gone along with all suggestions as far as I know how. Who wants the original algorithm must use `algorithm = 'original'` now. I have refactored the `__iter__` method in anticipation of understanding the parameter/alias approach.",
    "created_at": "2020-08-18T19:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429485",
    "user": "@denissunko"
}
```

I have gone along with all suggestions as far as I know how. Who wants the original algorithm must use `algorithm = 'original'` now. I have refactored the `__iter__` method in anticipation of understanding the parameter/alias approach.



---

archive/issue_comments_429486.json:
```json
{
    "body": "Replying to [comment:5 gh-denissunko]:\n> Thanks for the comment. I did the yield part. I agree in principle that the container class need not know about the algorithm which created the content, so in this sense 'min' and 'algorithm' are qualitatively different options. However, I do not understand how `__iter__` would function with a parameter.\n\n\n```python\ndef __iter__(self, algorithm=\"lex\"):\n    if algorithm == \"lex\":\n        return self.iter_lex()\n    elif algorithm == \"yorgey\":\n        return self.iter_yorgey()\n    else:\n        raise ValueError(\"invalid algorithm\")\n```\n\n(Your current solution is better for the `__iter__`, this is just a proof-of-concept.)\n\n> I looked around the net and it seems that people who want to do that are mostly advised to add an option to the class, or implement a `__call__` method. Can you please elaborate a little?\n\nAnd they would be wrong here because they are likely thinking of the class as an iterator, not as a (abstract) container (which has certain uniqueness properties).  I advise applying fire and holy water to the idea of attaching a parameter to the class to control the iteration.",
    "created_at": "2020-08-18T23:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429486",
    "user": "@tscrim"
}
```

Replying to [comment:5 gh-denissunko]:
> Thanks for the comment. I did the yield part. I agree in principle that the container class need not know about the algorithm which created the content, so in this sense 'min' and 'algorithm' are qualitatively different options. However, I do not understand how `__iter__` would function with a parameter.


```python
def __iter__(self, algorithm="lex"):
    if algorithm == "lex":
        return self.iter_lex()
    elif algorithm == "yorgey":
        return self.iter_yorgey()
    else:
        raise ValueError("invalid algorithm")
```

(Your current solution is better for the `__iter__`, this is just a proof-of-concept.)

> I looked around the net and it seems that people who want to do that are mostly advised to add an option to the class, or implement a `__call__` method. Can you please elaborate a little?

And they would be wrong here because they are likely thinking of the class as an iterator, not as a (abstract) container (which has certain uniqueness properties).  I advise applying fire and holy water to the idea of attaching a parameter to the class to control the iteration.



---

archive/issue_comments_429487.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-19T10:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429487",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_429488.json:
```json
{
    "body": "I am done here, up to possible further comments.\n\nI have\n- changed the names of options to 'lex' and 'neglex' (the default);\n- updated the documentation and ran the doctests;\n- changed two doc lines in `fast_vector_partitions.py` so as not to break the doctests there with the new default;\n- checked that the class `VectorPartitions` is not referred to anywhere else in the 9.2beta8 source tree;\n- added a warning that the default 'lex' has changed to 'neglex' between 9.1 and 9.2;\n- ran the source code through yapf3.\n\nHoping for a positive review now.",
    "created_at": "2020-08-19T10:25:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429488",
    "user": "@denissunko"
}
```

I am done here, up to possible further comments.

I have
- changed the names of options to 'lex' and 'neglex' (the default);
- updated the documentation and ran the doctests;
- changed two doc lines in `fast_vector_partitions.py` so as not to break the doctests there with the new default;
- checked that the class `VectorPartitions` is not referred to anywhere else in the 9.2beta8 source tree;
- added a warning that the default 'lex' has changed to 'neglex' between 9.1 and 9.2;
- ran the source code through yapf3.

Hoping for a positive review now.



---

archive/issue_comments_429489.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-19T15:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429489",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_429490.json:
```json
{
    "body": "aargh there is always something - I forgot to tag iter_lex and iter_neglex with underlines to hide them from the doc builder, corrected that now",
    "created_at": "2020-08-19T15:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429490",
    "user": "@denissunko"
}
```

aargh there is always something - I forgot to tag iter_lex and iter_neglex with underlines to hide them from the doc builder, corrected that now



---

archive/issue_comments_429491.json:
```json
{
    "body": "Let me be very clear, I strongly oppose adding an `algorithm` option to the class. This should be something that the `__iter__` method handles and only that. Right now two sets of vector partitions with the same input except for the iteration order are different objects, which should not be the case.\n\nFor the change in iteration order, I would do this:\n\n```python\ndef __iter__(self, algorithm=None):\n    if algorithm is None:\n        deprecation(30380, \"the default iteration order has changed to neglex\")\n        algorithm = \"neglex\"\n    ...\n```\n\nrather than having a `.. WARNING::` message. That way the user will see it at least once and it will show up in any doctests that use it. You can then supress it in the codebase by making the iterator call explicit (until the deprecation period is over).\n\nAlso, your new methods `_iter_type_()` I think are better as public `iter_type()` (if you want them to be private, it should be `_iter_type()` as they are not special Sage methods). They also need docstrings and doctests.",
    "created_at": "2020-08-19T23:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429491",
    "user": "@tscrim"
}
```

Let me be very clear, I strongly oppose adding an `algorithm` option to the class. This should be something that the `__iter__` method handles and only that. Right now two sets of vector partitions with the same input except for the iteration order are different objects, which should not be the case.

For the change in iteration order, I would do this:

```python
def __iter__(self, algorithm=None):
    if algorithm is None:
        deprecation(30380, "the default iteration order has changed to neglex")
        algorithm = "neglex"
    ...
```

rather than having a `.. WARNING::` message. That way the user will see it at least once and it will show up in any doctests that use it. You can then supress it in the codebase by making the iterator call explicit (until the deprecation period is over).

Also, your new methods `_iter_type_()` I think are better as public `iter_type()` (if you want them to be private, it should be `_iter_type()` as they are not special Sage methods). They also need docstrings and doctests.



---

archive/issue_comments_429492.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-19T23:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429492",
    "user": "@tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_429493.json:
```json
{
    "body": "I misunderstood your previous comment, sorry. But maybe I was not clear either. To repeat, I do not understand how `__iter__` would function with a parameter. I do not mean how to program it with a parameter, I mean use it. Right now I can take an instance of the class, call it VP, and write VP[44] to get the 45th partition in lex or neglex order, depending on how VP was initialized (by `__init__`). Please just give me an example of the same when `__iter__` has a second argument.\n\nNote also that VP[44] is unambiguous only as long as a single algorithm is used. What will happen to the container when I write VP[44], change the algorithm, and then ask for VP[56]? It seems to me that once one has the VP[...] syntax one is pretty much married to the initial algorithm anyway.\n\nI suppose it stores values 0 to n when it computes VP[n], so it does not have to recompute for a smaller value. If that is the case, changing the algorithm after computing VP[56] will give the wrong answer for VP[44] (from the point of view of the new algorithm).\n\nI have no problem doing it your way, as long as the class is as easy to use as it is now, which was my main motivation to extend its functionality.",
    "created_at": "2020-08-20T05:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429493",
    "user": "@denissunko"
}
```

I misunderstood your previous comment, sorry. But maybe I was not clear either. To repeat, I do not understand how `__iter__` would function with a parameter. I do not mean how to program it with a parameter, I mean use it. Right now I can take an instance of the class, call it VP, and write VP[44] to get the 45th partition in lex or neglex order, depending on how VP was initialized (by `__init__`). Please just give me an example of the same when `__iter__` has a second argument.

Note also that VP[44] is unambiguous only as long as a single algorithm is used. What will happen to the container when I write VP[44], change the algorithm, and then ask for VP[56]? It seems to me that once one has the VP[...] syntax one is pretty much married to the initial algorithm anyway.

I suppose it stores values 0 to n when it computes VP[n], so it does not have to recompute for a smaller value. If that is the case, changing the algorithm after computing VP[56] will give the wrong answer for VP[44] (from the point of view of the new algorithm).

I have no problem doing it your way, as long as the class is as easy to use as it is now, which was my main motivation to extend its functionality.



---

archive/issue_comments_429494.json:
```json
{
    "body": "`VP[n]` does not, a priori, use the `__iter__`. In practice here, the default `__getitem__` does use it, and subsequently, random access of elements in the iteration order this way has limited uses IMO. The two most typical uses are constructing specific elements using input data or iterating over all of them.\n\nIf you want to iterate using another algorithm, you can do `for v in VP.__iter__(\"lex\")`. However, by having the public facing `iter_*` methods, this largely becomes moot because you would do `for v in VP.iter_neglex()`.\n\nNote that the current proposal actually makes the class harder to use because of the subtleties with unique representation (which is something we want to have). By using the method I proposed, the class will remain as easy to use as it is right now. It will also more seamlessly move to the new iterator.",
    "created_at": "2020-08-22T22:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429494",
    "user": "@tscrim"
}
```

`VP[n]` does not, a priori, use the `__iter__`. In practice here, the default `__getitem__` does use it, and subsequently, random access of elements in the iteration order this way has limited uses IMO. The two most typical uses are constructing specific elements using input data or iterating over all of them.

If you want to iterate using another algorithm, you can do `for v in VP.__iter__("lex")`. However, by having the public facing `iter_*` methods, this largely becomes moot because you would do `for v in VP.iter_neglex()`.

Note that the current proposal actually makes the class harder to use because of the subtleties with unique representation (which is something we want to have). By using the method I proposed, the class will remain as easy to use as it is right now. It will also more seamlessly move to the new iterator.



---

archive/issue_comments_429495.json:
```json
{
    "body": "Thanks for the explanation. It raises a question of principle: would your objections disappear if the class were called `VectorPartitionsList`?\n\nTo expand a little, a list is a container class with a built-in ordering: [1, 2] and [2, 1] are not the same object. One can think of a list as a pair (content, ordering) where the ordering function is given as a table, fixed at initialization in terms of the content. The present class `VectorPartitions` is designed to give the same functionality with lazy evaluation, so the ordering function is not a table but a function 'algorithm'. Choosing the ordering at initialization is natural for a list.\n\nFor me the comfort afforded by the random-access syntax is the only real advantage of this class, using iterator functions directly is the same as using fast_vector_partitions() directly.",
    "created_at": "2020-08-27T07:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429495",
    "user": "@denissunko"
}
```

Thanks for the explanation. It raises a question of principle: would your objections disappear if the class were called `VectorPartitionsList`?

To expand a little, a list is a container class with a built-in ordering: [1, 2] and [2, 1] are not the same object. One can think of a list as a pair (content, ordering) where the ordering function is given as a table, fixed at initialization in terms of the content. The present class `VectorPartitions` is designed to give the same functionality with lazy evaluation, so the ordering function is not a table but a function 'algorithm'. Choosing the ordering at initialization is natural for a list.

For me the comfort afforded by the random-access syntax is the only real advantage of this class, using iterator functions directly is the same as using fast_vector_partitions() directly.



---

archive/issue_comments_429496.json:
```json
{
    "body": "Replying to [comment:16 gh-denissunko]:\n> Thanks for the explanation. It raises a question of principle: would your objections disappear if the class were called `VectorPartitionsList`?\n\nYes, but I would object to having such an object in Sage because that isn't what we want to model here. You might as well just have a function that calls `list(fast_vector_partitions(input))` for that.\n\n> To expand a little, a list is a container class with a built-in ordering: [1, 2] and [2, 1] are not the same object. One can think of a list as a pair (content, ordering) where the ordering function is given as a table, fixed at initialization in terms of the content. The present class `VectorPartitions` is designed to give the same functionality with lazy evaluation, so the ordering function is not a table but a function 'algorithm'. Choosing the ordering at initialization is natural for a list.\n\nIt is not a list, it is a set that we have a chosen (preferred) enumeration order. So changing the enumeration does not mean it is a different object as it is still the same set. !Lists/Tuples also do not have the uniqueness properties that `VectorPartitions` has to contend with.\n\n> For me the comfort afforded by the random-access syntax is the only real advantage of this class, using iterator functions directly is the same as using fast_vector_partitions() directly.\n\nI am not opposed to changing the enumeration order. In fact, I am proposing something stronger: to remove the option for the `__getitem__` using the lex order (another option might be that we could have the `i < 0` case appeal to the lex iterator).",
    "created_at": "2020-08-28T00:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429496",
    "user": "@tscrim"
}
```

Replying to [comment:16 gh-denissunko]:
> Thanks for the explanation. It raises a question of principle: would your objections disappear if the class were called `VectorPartitionsList`?

Yes, but I would object to having such an object in Sage because that isn't what we want to model here. You might as well just have a function that calls `list(fast_vector_partitions(input))` for that.

> To expand a little, a list is a container class with a built-in ordering: [1, 2] and [2, 1] are not the same object. One can think of a list as a pair (content, ordering) where the ordering function is given as a table, fixed at initialization in terms of the content. The present class `VectorPartitions` is designed to give the same functionality with lazy evaluation, so the ordering function is not a table but a function 'algorithm'. Choosing the ordering at initialization is natural for a list.

It is not a list, it is a set that we have a chosen (preferred) enumeration order. So changing the enumeration does not mean it is a different object as it is still the same set. !Lists/Tuples also do not have the uniqueness properties that `VectorPartitions` has to contend with.

> For me the comfort afforded by the random-access syntax is the only real advantage of this class, using iterator functions directly is the same as using fast_vector_partitions() directly.

I am not opposed to changing the enumeration order. In fact, I am proposing something stronger: to remove the option for the `__getitem__` using the lex order (another option might be that we could have the `i < 0` case appeal to the lex iterator).



---

archive/issue_comments_429497.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429497",
    "user": "@mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_429498.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30143#issuecomment-429498",
    "user": "@mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.
