# Issue 14756: Upgrade matplotlib to 1.3.0

archive/issues_014756.json:
```json
{
    "body": "Matplotlib 1.3.0 was released today.  Here is what is new: http://matplotlib.org/1.3.0/users/whats_new.html#new-in-matplotlib-1-3\n\nOf particular note is that pytz, dateutil, and pyparsing are no longer included and need to be installed separately: http://matplotlib.org/1.3.0/users/whats_new.html#new-setup-script\n\nIssue created by migration from https://trac.sagemath.org/ticket/14993\n\n",
    "created_at": "2013-07-31T18:08:05Z",
    "labels": [
        "graphics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Upgrade matplotlib to 1.3.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14756",
    "user": "jason"
}
```
Matplotlib 1.3.0 was released today.  Here is what is new: http://matplotlib.org/1.3.0/users/whats_new.html#new-in-matplotlib-1-3

Of particular note is that pytz, dateutil, and pyparsing are no longer included and need to be installed separately: http://matplotlib.org/1.3.0/users/whats_new.html#new-setup-script

Issue created by migration from https://trac.sagemath.org/ticket/14993





---

archive/issue_comments_188151.json:
```json
{
    "body": "I just gave it a try but gave up not very long after\n1) Sage patches matplotlib for some libpng detection issue, and this patch does not apply\n2) As it only seemed useful on Mac OS X I tried without that patch\n3) There is an error during the installation because of some \"https\" protocol that isn't supported\n\nThat's when I lost hope `^^;`\n\nNathann",
    "created_at": "2013-12-19T19:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188151",
    "user": "ncohen"
}
```

I just gave it a try but gave up not very long after
1) Sage patches matplotlib for some libpng detection issue, and this patch does not apply
2) As it only seemed useful on Mac OS X I tried without that patch
3) There is an error during the installation because of some "https" protocol that isn't supported

That's when I lost hope `^^;`

Nathann



---

archive/issue_comments_188152.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-20T19:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188152",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_188153.json:
```json
{
    "body": "I'm trying to attach the branch `u/jhpalmieri/14993` to this ticket, but trac isn't letting me. I'm attaching a diff, in case it helps with reviewing (and because I find the git/trac interface very slow).\n\nEdit: The branch `u/jhpalmieri/14993` exists, so you can test out my changes, but at the moment I can't attach it to this ticket in the `Branch` field.",
    "created_at": "2013-12-20T19:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188153",
    "user": "jhpalmieri"
}
```

I'm trying to attach the branch `u/jhpalmieri/14993` to this ticket, but trac isn't letting me. I'm attaching a diff, in case it helps with reviewing (and because I find the git/trac interface very slow).

Edit: The branch `u/jhpalmieri/14993` exists, so you can test out my changes, but at the moment I can't attach it to this ticket in the `Branch` field.



---

archive/issue_comments_188154.json:
```json
{
    "body": "Attachment [trac_14933.patch](tarball://root/attachments/some-uuid/ticket14993/trac_14933.patch) by jhpalmieri created at 2013-12-20 21:30:59\n\ndiff file, since I'm having problems uploading the relevant branch...",
    "created_at": "2013-12-20T21:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188154",
    "user": "jhpalmieri"
}
```

Attachment [trac_14933.patch](tarball://root/attachments/some-uuid/ticket14993/trac_14933.patch) by jhpalmieri created at 2013-12-20 21:30:59

diff file, since I'm having problems uploading the relevant branch...



---

archive/issue_comments_188155.json:
```json
{
    "body": "Sorry, I had a typo: it's `u/jhpalmieri/14993` (not `14933`). I can't set the branch to this: it leads to the error mentioned by Travis [on sage-devel](https://groups.google.com/d/topic/sage-devel/_fuMME8gUbk/discussion).",
    "created_at": "2013-12-21T00:22:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188155",
    "user": "jhpalmieri"
}
```

Sorry, I had a typo: it's `u/jhpalmieri/14993` (not `14933`). I can't set the branch to this: it leads to the error mentioned by Travis [on sage-devel](https://groups.google.com/d/topic/sage-devel/_fuMME8gUbk/discussion).



---

archive/issue_comments_188156.json:
```json
{
    "body": "HellooooooooooooO !\n\nCould you also provide the .tar.gz files for each package ? I tried to make mine but the hashes don't match, soo... `^^;`\n\nNathann",
    "created_at": "2013-12-21T09:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188156",
    "user": "ncohen"
}
```

HellooooooooooooO !

Could you also provide the .tar.gz files for each package ? I tried to make mine but the hashes don't match, soo... `^^;`

Nathann



---

archive/issue_comments_188157.json:
```json
{
    "body": "The links for the tarballs are in the ticket description. Is that what you're looking for?",
    "created_at": "2013-12-21T16:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188157",
    "user": "jhpalmieri"
}
```

The links for the tarballs are in the ticket description. Is that what you're looking for?



---

archive/issue_comments_188158.json:
```json
{
    "body": "New commits:",
    "created_at": "2013-12-21T16:12:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188158",
    "user": "jhpalmieri"
}
```

New commits:



---

archive/issue_comments_188159.json:
```json
{
    "body": "Helloooooo !\n\n> The links for the tarballs are in the ticket description. Is that what you're looking for?\n\nOoops sorry, I had not noticed you had updated it.\n\nWell, I gave it another try with those files and this part worked fine, but I still get the error I saw when I first tried it by myself :\nhttp://www.steinertriples.fr/m.log\n\nBy the way, for some reason the .log file that Sage claims should be located at /home/ncohen/.Sage/logs/pkgs/matplotlib-1.3.1.log does not exist.. But well `O_o`\n\nNathann",
    "created_at": "2013-12-22T10:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188159",
    "user": "ncohen"
}
```

Helloooooo !

> The links for the tarballs are in the ticket description. Is that what you're looking for?

Ooops sorry, I had not noticed you had updated it.

Well, I gave it another try with those files and this part worked fine, but I still get the error I saw when I first tried it by myself :
http://www.steinertriples.fr/m.log

By the way, for some reason the .log file that Sage claims should be located at /home/ncohen/.Sage/logs/pkgs/matplotlib-1.3.1.log does not exist.. But well `O_o`

Nathann



---

archive/issue_comments_188160.json:
```json
{
    "body": "I don't know why the error is occurring, but it looks like it is happening because of downloading the `distribute` package. \n\nOn one hand, I think if you updated `setuptools` (that is, ticket #15510), it would avoid this error. On the other hand, updating `setuptools` will cause problems with building and (if you get past that) doctesting the notebook.\n\nMaybe you can try downloading and installing `distribute` manually:\n\n```\ncurl -O http://pypi.python.org/packages/source/d/distribute/distribute-0.6.28.tar.gz\ntar xfz distribute-0.6.28.tar.gz\ncd distribute-0.6.28\nsage -sh\npython setup.py install\nexit\n```\n\n?",
    "created_at": "2013-12-22T16:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188160",
    "user": "jhpalmieri"
}
```

I don't know why the error is occurring, but it looks like it is happening because of downloading the `distribute` package. 

On one hand, I think if you updated `setuptools` (that is, ticket #15510), it would avoid this error. On the other hand, updating `setuptools` will cause problems with building and (if you get past that) doctesting the notebook.

Maybe you can try downloading and installing `distribute` manually:

```
curl -O http://pypi.python.org/packages/source/d/distribute/distribute-0.6.28.tar.gz
tar xfz distribute-0.6.28.tar.gz
cd distribute-0.6.28
sage -sh
python setup.py install
exit
```

?



---

archive/issue_comments_188161.json:
```json
{
    "body": "HMmmm... Well I prefer to keep my Sage install \"bad\", this way I will really be able to check whether this patch is okay when I will test it. If I install distribute I guess I won't be able to come back without recompiling Sage from scratch. So I guess my distribution is more useful, broken, to test this ticket `:-D`\n\nNathann",
    "created_at": "2013-12-22T16:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188161",
    "user": "ncohen"
}
```

HMmmm... Well I prefer to keep my Sage install "bad", this way I will really be able to check whether this patch is okay when I will test it. If I install distribute I guess I won't be able to come back without recompiling Sage from scratch. So I guess my distribution is more useful, broken, to test this ticket `:-D`

Nathann



---

archive/issue_comments_188162.json:
```json
{
    "body": "Now #15510 should be okay to install, along with the new sagenb (#15569).",
    "created_at": "2013-12-24T06:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188162",
    "user": "jhpalmieri"
}
```

Now #15510 should be okay to install, along with the new sagenb (#15569).



---

archive/issue_comments_188163.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-26T20:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188163",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_188164.json:
```json
{
    "body": "I have been using it in sage-on-gentoo not long after it was released. There is no problem with it. The only issue here is because of matplotlib unbundling we have so many packages coming. I am positiving this.",
    "created_at": "2013-12-26T20:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188164",
    "user": "fbissey"
}
```

I have been using it in sage-on-gentoo not long after it was released. There is no problem with it. The only issue here is because of matplotlib unbundling we have so many packages coming. I am positiving this.



---

archive/issue_comments_188165.json:
```json
{
    "body": "Hmmmmmmm `O_o`\n\nAnd so you have no problem with `distribute` it seems `O_o`\n\nNathann",
    "created_at": "2013-12-26T20:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188165",
    "user": "ncohen"
}
```

Hmmmmmmm `O_o`

And so you have no problem with `distribute` it seems `O_o`

Nathann



---

archive/issue_comments_188166.json:
```json
{
    "body": "I am cheating but going to a version of setuptools that is that recent is not necessary I believe but you need something more recent than 0.6.16 that I and Steve Trogdon put in sage for the upgrade to python 2.7 in sage 5.0 :)\nYou can blame me for the current version of setuptools in sage.",
    "created_at": "2013-12-26T22:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188166",
    "user": "fbissey"
}
```

I am cheating but going to a version of setuptools that is that recent is not necessary I believe but you need something more recent than 0.6.16 that I and Steve Trogdon put in sage for the upgrade to python 2.7 in sage 5.0 :)
You can blame me for the current version of setuptools in sage.



---

archive/issue_comments_188167.json:
```json
{
    "body": "Oh, you think it is solved by #15510 and #15569 ? I'll try !\n\nNathann",
    "created_at": "2013-12-27T09:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188167",
    "user": "ncohen"
}
```

Oh, you think it is solved by #15510 and #15569 ? I'll try !

Nathann



---

archive/issue_comments_188168.json:
```json
{
    "body": "Merge conflict in build/pkgs/sagenb/checksums.ini, please fix",
    "created_at": "2014-01-31T23:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188168",
    "user": "vbraun"
}
```

Merge conflict in build/pkgs/sagenb/checksums.ini, please fix



---

archive/issue_comments_188169.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-01-31T23:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188169",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_188170.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2014-01-31T23:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188170",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_188171.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-31T23:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188171",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_188172.json:
```json
{
    "body": "That should take care of it.",
    "created_at": "2014-01-31T23:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188172",
    "user": "jhpalmieri"
}
```

That should take care of it.



---

archive/issue_comments_188173.json:
```json
{
    "body": "Fails to install with an infinite recursion\n\n```\n[...]\n                libagg: yes [pkg-config information for 'libagg' could not\n                        be found. Using local copy.]\n              freetype: yes [version 17.1.11]\nTraceback (most recent call last):\n  File \"setup.py\", line 148, in <module>\n    result = package.check()\n  File \"/home/release/Sage/local/var/tmp/sage/build/matplotlib-1.3.1/src/setupext.py\", line 915, in check\n    min_version='1.2')\n  File \"/home/release/Sage/local/var/tmp/sage/build/matplotlib-1.3.1/src/setupext.py\", line 434, in _check_for_pkg_config\n    ext = self.get_extension()\n  File \"/home/release/Sage/local/var/tmp/sage/build/matplotlib-1.3.1/src/setupext.py\", line 925, in get_extension\n    if self.check().find('Using unknown') == -1:\n  File \"/home/release/Sage/local/var/tmp/sage/build/matplotlib-1.3.1/src/setupext.py\", line 915, in check\n    min_version='1.2')\n  File \"/home/release/Sage/local/var/tmp/sage/build/matplotlib-1.3.1/src/setupext.py\", line 434, in _check_for_pkg_config\n[... repeat unil recursion limit...]\n```\n",
    "created_at": "2014-02-01T21:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188173",
    "user": "vbraun"
}
```

Fails to install with an infinite recursion

```
[...]
                libagg: yes [pkg-config information for 'libagg' could not
                        be found. Using local copy.]
              freetype: yes [version 17.1.11]
Traceback (most recent call last):
  File "setup.py", line 148, in <module>
    result = package.check()
  File "/home/release/Sage/local/var/tmp/sage/build/matplotlib-1.3.1/src/setupext.py", line 915, in check
    min_version='1.2')
  File "/home/release/Sage/local/var/tmp/sage/build/matplotlib-1.3.1/src/setupext.py", line 434, in _check_for_pkg_config
    ext = self.get_extension()
  File "/home/release/Sage/local/var/tmp/sage/build/matplotlib-1.3.1/src/setupext.py", line 925, in get_extension
    if self.check().find('Using unknown') == -1:
  File "/home/release/Sage/local/var/tmp/sage/build/matplotlib-1.3.1/src/setupext.py", line 915, in check
    min_version='1.2')
  File "/home/release/Sage/local/var/tmp/sage/build/matplotlib-1.3.1/src/setupext.py", line 434, in _check_for_pkg_config
[... repeat unil recursion limit...]
```




---

archive/issue_comments_188174.json:
```json
{
    "body": "Very strange. Is pkg-config on the machine? That's the only thing I can think of looking at the code.",
    "created_at": "2014-02-02T02:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188174",
    "user": "fbissey"
}
```

Very strange. Is pkg-config on the machine? That's the only thing I can think of looking at the code.



---

archive/issue_comments_188175.json:
```json
{
    "body": "Yes, pkg-config is installed like on every modern machine.",
    "created_at": "2014-02-11T15:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188175",
    "user": "vbraun"
}
```

Yes, pkg-config is installed like on every modern machine.



---

archive/issue_comments_188176.json:
```json
{
    "body": "I think we should try to drop the setupext.py patch. I think it is responsible for the problem Volker sees and I am not sure why it is needed at all.\nIf we end up with a problem without it, then ok we patch but in this case it will need revision. Even so I am not sure how it generates the recursion.",
    "created_at": "2014-02-24T01:30:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188176",
    "user": "fbissey"
}
```

I think we should try to drop the setupext.py patch. I think it is responsible for the problem Volker sees and I am not sure why it is needed at all.
If we end up with a problem without it, then ok we patch but in this case it will need revision. Even so I am not sure how it generates the recursion.



---

archive/issue_comments_188177.json:
```json
{
    "body": "I think that's a fine idea, but I don't have time to work on it right now. Can someone else produce a new version to see if that fixes Volker's problem (and also whether it builds on OS X)?",
    "created_at": "2014-02-24T03:28:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188177",
    "user": "jhpalmieri"
}
```

I think that's a fine idea, but I don't have time to work on it right now. Can someone else produce a new version to see if that fixes Volker's problem (and also whether it builds on OS X)?



---

archive/issue_comments_188178.json:
```json
{
    "body": "OK so I tried things out a little bit. I reproduced Volker's problem locally (yuck). Removing setupext.py.patch enabled it to build and install on my linux x86_64 box. For various reasons I won't be starting testing things on maverick before Wednesday (OK Tuesday for most of you).",
    "created_at": "2014-02-24T09:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188178",
    "user": "fbissey"
}
```

OK so I tried things out a little bit. I reproduced Volker's problem locally (yuck). Removing setupext.py.patch enabled it to build and install on my linux x86_64 box. For various reasons I won't be starting testing things on maverick before Wednesday (OK Tuesday for most of you).



---

archive/issue_comments_188179.json:
```json
{
    "body": "I guess the big question is if it will build and work on an OS X machine without pkg-config.\n\nWhat's the status of Sage distributing pkg-config as a standard package?  That would make the patch a moot point.",
    "created_at": "2014-02-24T13:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188179",
    "user": "jason"
}
```

I guess the big question is if it will build and work on an OS X machine without pkg-config.

What's the status of Sage distributing pkg-config as a standard package?  That would make the patch a moot point.



---

archive/issue_comments_188180.json:
```json
{
    "body": "There was an easier way of checking that. I renamed the pkg-config executable(s) on my system and tried to re-install matplotlib. It failed. So we either need a work around or make pkg-config a dependency of this ticket. I am favouring the later.",
    "created_at": "2014-02-25T00:28:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188180",
    "user": "fbissey"
}
```

There was an easier way of checking that. I renamed the pkg-config executable(s) on my system and tried to re-install matplotlib. It failed. So we either need a work around or make pkg-config a dependency of this ticket. I am favouring the later.



---

archive/issue_comments_188181.json:
```json
{
    "body": "Also if we really want to patch, let's just not make it as a fallback but as a full blown configuration. After all the default you feed to build on OS X are just as valid on other platforms. I also notice that the building recommendations for matplotlib upstream for OS X will lead you to have pkg-config installed, either explicitly or as a dependency.",
    "created_at": "2014-02-25T07:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188181",
    "user": "fbissey"
}
```

Also if we really want to patch, let's just not make it as a fallback but as a full blown configuration. After all the default you feed to build on OS X are just as valid on other platforms. I also notice that the building recommendations for matplotlib upstream for OS X will lead you to have pkg-config installed, either explicitly or as a dependency.



---

archive/issue_comments_188182.json:
```json
{
    "body": "Actually I am not even sure how that patch is supposed to work on OS X, feels fishy to me. It certainly fail with that patch if I hide pkg-config.",
    "created_at": "2014-02-26T02:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188182",
    "user": "fbissey"
}
```

Actually I am not even sure how that patch is supposed to work on OS X, feels fishy to me. It certainly fail with that patch if I hide pkg-config.



---

archive/issue_comments_188183.json:
```json
{
    "body": "Just confirmed, this doesn't work on my maverick laptop.",
    "created_at": "2014-02-26T08:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188183",
    "user": "fbissey"
}
```

Just confirmed, this doesn't work on my maverick laptop.



---

archive/issue_comments_188184.json:
```json
{
    "body": "IMHO pkgconfig #15742 is ready to be merged. Just to clarify, Maverics with pkgconfig works for you?",
    "created_at": "2014-02-26T10:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188184",
    "user": "vbraun"
}
```

IMHO pkgconfig #15742 is ready to be merged. Just to clarify, Maverics with pkgconfig works for you?



---

archive/issue_comments_188185.json:
```json
{
    "body": "Didn't try that but I don't see how it wouldn't. Probably no time to test this tonight but will endeavour to do it sometimes tomorrow (past 11pm in my time zone).",
    "created_at": "2014-02-26T10:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188185",
    "user": "fbissey"
}
```

Didn't try that but I don't see how it wouldn't. Probably no time to test this tonight but will endeavour to do it sometimes tomorrow (past 11pm in my time zone).



---

archive/issue_comments_188186.json:
```json
{
    "body": "Of course using pkg-config this ticket needs updating to reflect the dependency and remove the patch. I guess it needs a clean up.",
    "created_at": "2014-02-26T10:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188186",
    "user": "fbissey"
}
```

Of course using pkg-config this ticket needs updating to reflect the dependency and remove the patch. I guess it needs a clean up.



---

archive/issue_comments_188187.json:
```json
{
    "body": "OK so #15742 is a good help here. With it we can remove the setupext.py.patch and things install as they are meant too. I am not quite ready to make and push the two changes needed for this ticket:\n* Add pkgconf to matplotlib's dependencies\n* Remove the patch\nI'll give this a positive review if those things are done by someone else before me.",
    "created_at": "2014-02-27T09:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188187",
    "user": "fbissey"
}
```

OK so #15742 is a good help here. With it we can remove the setupext.py.patch and things install as they are meant too. I am not quite ready to make and push the two changes needed for this ticket:
* Add pkgconf to matplotlib's dependencies
* Remove the patch
I'll give this a positive review if those things are done by someone else before me.



---

archive/issue_comments_188188.json:
```json
{
    "body": "This fixes one or two other things: it adds licensing information for the new packages (tornado, etc.), it updates licensing information for matplotlib, it removes discussion of the deleted patch from SPKG.txt, and it fixes an error of mine in spkg-install.\n----\nNew commits:",
    "created_at": "2014-02-27T16:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188188",
    "user": "jhpalmieri"
}
```

This fixes one or two other things: it adds licensing information for the new packages (tornado, etc.), it updates licensing information for matplotlib, it removes discussion of the deleted patch from SPKG.txt, and it fixes an error of mine in spkg-install.
----
New commits:



---

archive/issue_comments_188189.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-27T21:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188189",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_188190.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2014-02-28T13:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188190",
    "user": "vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_188191.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2014-02-28T13:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188191",
    "user": "vbraun"
}
```

Changing status from closed to new.



---

archive/issue_comments_188192.json:
```json
{
    "body": "Fails on SPARC Solaris:\n\n```\n/home/buildbot/build/sage/mark-1/sage_git/build/local/lib/python2.7/site-packages/numpy/core/include/numpy/npy_deprecated_api.h:11:2: warning: #warning \"Using deprecated NumPy API, disable it by #defining NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION\" [-Wcpp]\nIn file included from lib/matplotlib/tri/_tri.cpp:8:0:\nlib/matplotlib/tri/_tri.h:821:33: error: expected unqualified-id before numeric constant\nlib/matplotlib/tri/_tri.cpp: In constructor 'RandomNumberGenerator::RandomNumberGenerator(long unsigned int)':\nlib/matplotlib/tri/_tri.cpp:2180:28: error: expected identifier before numeric constant\nlib/matplotlib/tri/_tri.cpp:2180:28: error: expected '{' before numeric constant\nlib/matplotlib/tri/_tri.cpp: At global scope:\nlib/matplotlib/tri/_tri.cpp:2180:28: error: expected unqualified-id before numeric constant\nerror: command 'gcc' failed with exit status 1\n```\n\nSee http://build.sagemath.org/sage/builders/%20%20slow%20Skynet%20mark%20%28SunOS%205.10-32%29%20incremental/builds/26/steps/compile/logs/matplotlib",
    "created_at": "2014-02-28T13:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188192",
    "user": "vbraun"
}
```

Fails on SPARC Solaris:

```
/home/buildbot/build/sage/mark-1/sage_git/build/local/lib/python2.7/site-packages/numpy/core/include/numpy/npy_deprecated_api.h:11:2: warning: #warning "Using deprecated NumPy API, disable it by #defining NPY_NO_DEPRECATED_API NPY_1_7_API_VERSION" [-Wcpp]
In file included from lib/matplotlib/tri/_tri.cpp:8:0:
lib/matplotlib/tri/_tri.h:821:33: error: expected unqualified-id before numeric constant
lib/matplotlib/tri/_tri.cpp: In constructor 'RandomNumberGenerator::RandomNumberGenerator(long unsigned int)':
lib/matplotlib/tri/_tri.cpp:2180:28: error: expected identifier before numeric constant
lib/matplotlib/tri/_tri.cpp:2180:28: error: expected '{' before numeric constant
lib/matplotlib/tri/_tri.cpp: At global scope:
lib/matplotlib/tri/_tri.cpp:2180:28: error: expected unqualified-id before numeric constant
error: command 'gcc' failed with exit status 1
```

See http://build.sagemath.org/sage/builders/%20%20slow%20Skynet%20mark%20%28SunOS%205.10-32%29%20incremental/builds/26/steps/compile/logs/matplotlib



---

archive/issue_comments_188193.json:
```json
{
    "body": "Hum, compiling c++ with a c compiler as well that was potential trouble anyway. Who has contact upstream?",
    "created_at": "2014-02-28T18:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188193",
    "user": "fbissey"
}
```

Hum, compiling c++ with a c compiler as well that was potential trouble anyway. Who has contact upstream?



---

archive/issue_comments_188194.json:
```json
{
    "body": "Fixed in this commit: https://github.com/matplotlib/matplotlib/pull/2464",
    "created_at": "2014-02-28T20:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188194",
    "user": "vbraun"
}
```

Fixed in this commit: https://github.com/matplotlib/matplotlib/pull/2464



---

archive/issue_comments_188195.json:
```json
{
    "body": "Okay, I've imported their patch.\n----\nNew commits:",
    "created_at": "2014-02-28T21:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188195",
    "user": "jhpalmieri"
}
```

Okay, I've imported their patch.
----
New commits:



---

archive/issue_comments_188196.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-02-28T21:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188196",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_188197.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-28T22:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188197",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_188198.json:
```json
{
    "body": "Hum - oops let it slip. Now that all is well let's put it back to positive :)",
    "created_at": "2014-03-15T06:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188198",
    "user": "fbissey"
}
```

Hum - oops let it slip. Now that all is well let's put it back to positive :)



---

archive/issue_comments_188199.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-03-15T06:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188199",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_188200.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-03-19T18:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188200",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_188201.json:
```json
{
    "body": "This ticket seems to cause massive problems with view, dot2tex and latex. None of the crystal viewing tools work any longer! See comments on http://trac.sagemath.org/ticket/16026 . For example\n\n```\nd184:sage anne$ sage -i dot2tex\nAttempting to download package dot2tex\n>>> Checking online list of optional packages.\n[.]\n>>> Found dot2tex-2.8.7.p2\nPackage dot2tex-2.8.7.p2 is already installed.\nUse 'sage -f http://www.sagemath.org/spkg/optional/dot2tex-2.8.7.p2.spkg' to force a reinstallation.\nd184:sage anne$ sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Sage Version 6.2.beta5, Release Date: 2014-03-23                   \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: C = KirillovReshetikhinCrystal(['A',5,2], 3,1)\nsage: view(C)\ndot2tex not available.  Install after running 'sage -sh'\n```\n",
    "created_at": "2014-03-29T16:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188201",
    "user": "aschilling"
}
```

This ticket seems to cause massive problems with view, dot2tex and latex. None of the crystal viewing tools work any longer! See comments on http://trac.sagemath.org/ticket/16026 . For example

```
d184:sage anne$ sage -i dot2tex
Attempting to download package dot2tex
>>> Checking online list of optional packages.
[.]
>>> Found dot2tex-2.8.7.p2
Package dot2tex-2.8.7.p2 is already installed.
Use 'sage -f http://www.sagemath.org/spkg/optional/dot2tex-2.8.7.p2.spkg' to force a reinstallation.
d184:sage anne$ sage
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 6.2.beta5, Release Date: 2014-03-23                   │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: C = KirillovReshetikhinCrystal(['A',5,2], 3,1)
sage: view(C)
dot2tex not available.  Install after running 'sage -sh'
```




---

archive/issue_comments_188202.json:
```json
{
    "body": "I am having the same problem as Anne.\n\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Sage Version 6.2.beta5, Release Date: 2014-03-23                   \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: C = crystals.Tableaux(\"B2\",shape=[2,1])\nsage: view(C)\ndot2tex not available.  Install after running 'sage -sh'\nsage: quit\nBenBook:sage-git Ben$ sage -i dot2tex\nFound package dot2tex in /Users/Ben/sage-git/upstream/dot2tex-2.8.7.p2.spkg\nPackage dot2tex-2.8.7.p2 is already installed.\n```\n\n\nThe same problem also occurred after a forced reinstallation of dot2tex using `sage -i -f dot2tex`.  It should be noted that this problem only occurred after the upgrade from 6.2.beta4 to 6.2.beta5.",
    "created_at": "2014-03-29T16:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188202",
    "user": "bsalisbury1"
}
```

I am having the same problem as Anne.


```
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 6.2.beta5, Release Date: 2014-03-23                   │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: C = crystals.Tableaux("B2",shape=[2,1])
sage: view(C)
dot2tex not available.  Install after running 'sage -sh'
sage: quit
BenBook:sage-git Ben$ sage -i dot2tex
Found package dot2tex in /Users/Ben/sage-git/upstream/dot2tex-2.8.7.p2.spkg
Package dot2tex-2.8.7.p2 is already installed.
```


The same problem also occurred after a forced reinstallation of dot2tex using `sage -i -f dot2tex`.  It should be noted that this problem only occurred after the upgrade from 6.2.beta4 to 6.2.beta5.



---

archive/issue_comments_188203.json:
```json
{
    "body": "Note that #16047 is adding a patch to matplotlib (already in upstream) so if there is something similar to do to fix this crystal viewing problem with dot2tex one could add it at the same time.",
    "created_at": "2014-04-02T16:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188203",
    "user": "kcrisman"
}
```

Note that #16047 is adding a patch to matplotlib (already in upstream) so if there is something similar to do to fix this crystal viewing problem with dot2tex one could add it at the same time.



---

archive/issue_comments_188204.json:
```json
{
    "body": "Replying to [comment:50 kcrisman]:\n> Note that #16047 is adding a patch to matplotlib (already in upstream) so if there is something similar to do to fix this crystal viewing problem with dot2tex one could add it at the same time.\n\nThe KR problem with dot2tex was fixed in #16026.",
    "created_at": "2014-04-02T20:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14756#issuecomment-188204",
    "user": "aschilling"
}
```

Replying to [comment:50 kcrisman]:
> Note that #16047 is adding a patch to matplotlib (already in upstream) so if there is something similar to do to fix this crystal viewing problem with dot2tex one could add it at the same time.

The KR problem with dot2tex was fixed in #16026.
