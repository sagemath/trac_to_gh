# Issue 22208: doctest: Make sage.doctest.sources.get_basename work in more situations

archive/issues_022208.json:
```json
{
    "body": "Keywords: debian\n\nThis lets you specify `SAGE_SRC` like `/path/to/test/dir/../../src/dir`, which\navoids post-install test failures in `sage/doctest/test.py`\n\nProbably will be helpful for #21507.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22445\n\n",
    "created_at": "2017-02-25T15:36:16Z",
    "labels": [
        "component: doctest framework",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "doctest: Make sage.doctest.sources.get_basename work in more situations",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22208",
    "user": "https://github.com/infinity0"
}
```
Keywords: debian

This lets you specify `SAGE_SRC` like `/path/to/test/dir/../../src/dir`, which
avoids post-install test failures in `sage/doctest/test.py`

Probably will be helpful for #21507.

Issue created by migration from https://trac.sagemath.org/ticket/22445





---

archive/issue_comments_308163.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2017-02-25T15:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308163",
    "user": "https://github.com/infinity0"
}
```

Changing priority from major to minor.



---

archive/issue_comments_308164.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-02-25T15:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308164",
    "user": "https://github.com/infinity0"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_308165.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to doctest framework.",
    "created_at": "2017-02-25T15:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308165",
    "user": "https://github.com/infinity0"
}
```

Changing component from PLEASE CHANGE to doctest framework.



---

archive/issue_comments_308166.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2017-02-25T15:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308166",
    "user": "https://github.com/infinity0"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_308167.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-25T17:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308167",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_308168.json:
```json
{
    "body": "Hi, no branch again...",
    "created_at": "2017-02-25T17:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308168",
    "user": "https://github.com/videlec"
}
```

Hi, no branch again...



---

archive/issue_comments_308169.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-25T17:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308169",
    "user": "https://github.com/infinity0"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_308170.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-02-25T17:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308170",
    "user": "https://github.com/infinity0"
}
```

New commits:



---

archive/issue_comments_308171.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-25T19:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308171",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_308172.json:
```json
{
    "body": "Wouldn't it be better to use `normpath()` on the variables `SAGE_LOCAL` and `SAGE_SRC` directly in `sage/env.py`? I can imagine that the same issue could happen in other places.",
    "created_at": "2017-02-25T19:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308172",
    "user": "https://github.com/jdemeyer"
}
```

Wouldn't it be better to use `normpath()` on the variables `SAGE_LOCAL` and `SAGE_SRC` directly in `sage/env.py`? I can imagine that the same issue could happen in other places.



---

archive/issue_comments_308173.json:
```json
{
    "body": "It might be better, but I didn't want to risk making such a big change like that, which could break quite a lot of things. Would you prefer I try that bigger change rather than just committing this smaller one?",
    "created_at": "2017-03-11T17:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308173",
    "user": "https://github.com/infinity0"
}
```

It might be better, but I didn't want to risk making such a big change like that, which could break quite a lot of things. Would you prefer I try that bigger change rather than just committing this smaller one?



---

archive/issue_comments_308174.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2018-04-01T20:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308174",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_308175.json:
```json
{
    "body": "infinity0: why do tests in `sage/doctest/test.py` break without this?\n\nI am not sure about using `normpath` as it can change the actual path when symlinks are involved.",
    "created_at": "2018-04-01T20:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308175",
    "user": "https://github.com/saraedum"
}
```

infinity0: why do tests in `sage/doctest/test.py` break without this?

I am not sure about using `normpath` as it can change the actual path when symlinks are involved.



---

archive/issue_comments_308176.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2018-04-29T17:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308176",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_308177.json:
```json
{
    "body": "So, I don't think that normpath is a great idea here. Also it is not clear to me what this ticket is really trying to fix.",
    "created_at": "2018-04-29T17:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308177",
    "user": "https://github.com/saraedum"
}
```

So, I don't think that normpath is a great idea here. Also it is not clear to me what this ticket is really trying to fix.



---

archive/issue_events_058709.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-05-11T14:46:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22208#event-58709"
}
```



---

archive/issue_comments_308178.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-05-11T14:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308178",
    "user": "https://github.com/saraedum"
}
```

New commits:



---

archive/issue_comments_308179.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-05-11T14:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308179",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_308180.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-11T14:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308180",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_308181.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-18T22:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308181",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_308182.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-21T10:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308182",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_308183.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-06-21T10:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308183",
    "user": "https://github.com/saraedum"
}
```

New commits:



---

archive/issue_comments_308184.json:
```json
{
    "body": "Changing keywords from \"\" to \"debian\".",
    "created_at": "2018-07-04T16:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308184",
    "user": "https://github.com/saraedum"
}
```

Changing keywords from "" to "debian".



---

archive/issue_comments_308185.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-07T14:18:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308185",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_308186.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-16T10:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308186",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_308187.json:
```json
{
    "body": "The failing doctests reported by the patchbot are unrelated.\n\n---\nNew commits:",
    "created_at": "2018-07-16T10:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308187",
    "user": "https://github.com/saraedum"
}
```

The failing doctests reported by the patchbot are unrelated.

---
New commits:



---

archive/issue_comments_308188.json:
```json
{
    "body": "The cygwin patchbot failed for an unrelated reason. The other patchbot errors are a known sympow bug that is not related to this ticket's changes. This is still ready for review.",
    "created_at": "2018-07-28T12:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308188",
    "user": "https://github.com/saraedum"
}
```

The cygwin patchbot failed for an unrelated reason. The other patchbot errors are a known sympow bug that is not related to this ticket's changes. This is still ready for review.



---

archive/issue_comments_308189.json:
```json
{
    "body": "#27191 also touches this code. So in any case, it needs to be rebased on #27191. If you want to continue with this, I still think that [comment:5] is the way to go.",
    "created_at": "2019-02-01T16:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308189",
    "user": "https://github.com/jdemeyer"
}
```

#27191 also touches this code. So in any case, it needs to be rebased on #27191. If you want to continue with this, I still think that [comment:5] is the way to go.



---

archive/issue_comments_308190.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-02-01T16:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22208",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22208#issuecomment-308190",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.
