# Issue 27865: Refactor GraphicsArray, fixing various issues

archive/issues_027628.json:
```json
{
    "assignees": [],
    "body": "This ticket makes `GraphicsArray` derive from a new class, `MultiGraphics`, which is more generic (arbitrary positions of graphics objects on a canvas) and paves the way towards graphics insets in #27866.\n\n`GraphicsArray` is now endowed with a `matplotlib()` function (inheritated from  `MultiGraphics`). This fixes the issues reported in #10466, #10657, #11160 and #12591 (see :comment:3 and [comment:5](#comment%3A5) below for a summary). \nMoreover, this simplifies `sphinx_plot()` (defined in `src/doc/common/conf.py`), avoiding code duplication. \n\nBeside introducing `matplotlib()` at the graphics array level, two bugs had to be corrected in `Graphics.matplotlib()`:\n\n- `_set_scale` was called on the whole figure, while it should be called on the current subplot\n- `tick_params` was called on `figure.get_axes()[0]`, i.e. the first subplot of the figure, while it should be called on the current subplot.\n\nThe documentation of `Graphics.matplotlib()` is also improved in this ticket. \n\nAnother bug has been corrected in `Graphics.save()`: contrary to what was claimed in the documentation `g.save(\"filename\")` with `\"filename\"` having no extension did not save in a `sobj` file but yielded to an error. \n\nAnother modification is the introduction of the helper function `_parse_figsize()` in `src/sage/plot/graphics.py` to avoid code duplication: it is used in `Graphics.matplotlib()`, `MultiGraphics.matplotlib()` and `sphinx_plot()`.\n\nSince the file `src/sage/plot/graphics.py` was already quite long (3736 lines!), the class `GraphicsArray` was moved to the new file `src/sage/plot/multigraphics.py`, which contains the definition of the base class `MultiGraphics`. This makes things more consistent:\n- `src/sage/plot/graphics.py`: only `Graphics` objects\n- `src/sage/plot/multigraphics.py`: only `MultiGraphics` objects\n\nBesides the bugs reported in the tickets #10466, #10657, #11160 and #12591, this ticket fixes two other bugs:\n\n- if any plot in the array had a log scale, the latter was erroneously applied to the first plot of the array\n\n- the computation of `nrows` and `ncols` in the function `graphics_array()` (defined in `src/sage/plot/plot.py`) yielded unnecessary large numbers in certain cases. For instance we have in Sage 8.7:\n\n```\nsage: graphics_array([plot(sin)]*4, ncols=4)\nGraphics Array of size 2 x 4\n```\n  with the second raw that is entirely blank. With the code in this ticket the output is \n\n```\nGraphics Array of size 1 x 4\n```\n  This fix explains the change of doctest outputs in `src/sage/categories/finite_posets.py` and `src/sage/repl/rich_output/pretty_print.py`\n\nA preview (including the functionalities introduced in #27866) is available [here](https://sagemanifolds.obspm.fr/preview/graphics_inset/reference/plotting/sage/plot/multigraphics.html).\n\nCC:  @kcrisman @fchapoton @dkrenn @jdemeyer @embray\n\nComponent: **graphics**\n\nKeywords: **graphics_array, matplotlib**\n\nAuthor: **Eric Gourgoulhon**\n\nBranch/Commit: **[`36c0f17`](https://github.com/sagemath/sagetrac-mirror/commit/36c0f178353017ac12573ff038c40ed55a24ba2d)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27865_\n\n",
    "closed_at": "2019-06-27T20:13:31Z",
    "created_at": "2019-05-24T12:12:57Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graphics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Refactor GraphicsArray, fixing various issues",
    "type": "issue",
    "updated_at": "2019-07-03T11:34:48Z",
    "url": "https://github.com/sagemath/sage/issues/27865",
    "user": "https://github.com/egourgoulhon"
}
```
This ticket makes `GraphicsArray` derive from a new class, `MultiGraphics`, which is more generic (arbitrary positions of graphics objects on a canvas) and paves the way towards graphics insets in #27866.

`GraphicsArray` is now endowed with a `matplotlib()` function (inheritated from  `MultiGraphics`). This fixes the issues reported in #10466, #10657, #11160 and #12591 (see :comment:3 and [comment:5](#comment%3A5) below for a summary). 
Moreover, this simplifies `sphinx_plot()` (defined in `src/doc/common/conf.py`), avoiding code duplication. 

Beside introducing `matplotlib()` at the graphics array level, two bugs had to be corrected in `Graphics.matplotlib()`:

- `_set_scale` was called on the whole figure, while it should be called on the current subplot
- `tick_params` was called on `figure.get_axes()[0]`, i.e. the first subplot of the figure, while it should be called on the current subplot.

The documentation of `Graphics.matplotlib()` is also improved in this ticket. 

Another bug has been corrected in `Graphics.save()`: contrary to what was claimed in the documentation `g.save("filename")` with `"filename"` having no extension did not save in a `sobj` file but yielded to an error. 

Another modification is the introduction of the helper function `_parse_figsize()` in `src/sage/plot/graphics.py` to avoid code duplication: it is used in `Graphics.matplotlib()`, `MultiGraphics.matplotlib()` and `sphinx_plot()`.

Since the file `src/sage/plot/graphics.py` was already quite long (3736 lines!), the class `GraphicsArray` was moved to the new file `src/sage/plot/multigraphics.py`, which contains the definition of the base class `MultiGraphics`. This makes things more consistent:
- `src/sage/plot/graphics.py`: only `Graphics` objects
- `src/sage/plot/multigraphics.py`: only `MultiGraphics` objects

Besides the bugs reported in the tickets #10466, #10657, #11160 and #12591, this ticket fixes two other bugs:

- if any plot in the array had a log scale, the latter was erroneously applied to the first plot of the array

- the computation of `nrows` and `ncols` in the function `graphics_array()` (defined in `src/sage/plot/plot.py`) yielded unnecessary large numbers in certain cases. For instance we have in Sage 8.7:

```
sage: graphics_array([plot(sin)]*4, ncols=4)
Graphics Array of size 2 x 4
```
  with the second raw that is entirely blank. With the code in this ticket the output is 

```
Graphics Array of size 1 x 4
```
  This fix explains the change of doctest outputs in `src/sage/categories/finite_posets.py` and `src/sage/repl/rich_output/pretty_print.py`

A preview (including the functionalities introduced in #27866) is available [here](https://sagemanifolds.obspm.fr/preview/graphics_inset/reference/plotting/sage/plot/multigraphics.html).

CC:  @kcrisman @fchapoton @dkrenn @jdemeyer @embray

Component: **graphics**

Keywords: **graphics_array, matplotlib**

Author: **Eric Gourgoulhon**

Branch/Commit: **[`36c0f17`](https://github.com/sagemath/sagetrac-mirror/commit/36c0f178353017ac12573ff038c40ed55a24ba2d)**

Reviewer: **Frédéric Chapoton**

_Issue created by migration from https://trac.sagemath.org/ticket/27865_





---

archive/issue_events_379221.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-05-24T12:12:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27865#event-379221"
}
```



---

archive/issue_events_379222.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-05-24T12:12:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graphics",
    "label_color": "0000ff",
    "label_name": "c: graphics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27865#event-379222"
}
```



---

archive/issue_events_379223.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-05-24T12:12:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27865#event-379223"
}
```



---

archive/issue_events_379224.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-05-24T12:12:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27865#event-379224"
}
```



---

archive/issue_comments_432686.json:
```json
{
    "body": "Commit: **[`3a5ef55`](https://github.com/sagemath/sagetrac-mirror/commit/3a5ef55af4d104c840107f46abbcba90fa401a18)**",
    "created_at": "2019-05-24T12:14:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432686",
    "user": "https://github.com/egourgoulhon"
}
```

Commit: **[`3a5ef55`](https://github.com/sagemath/sagetrac-mirror/commit/3a5ef55af4d104c840107f46abbcba90fa401a18)**



---

archive/issue_comments_432687.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4bbdf8861bd938d06abc0fa4545cd1f92fa317ec\"><code>4bbdf88</code></a></td><td><code>Add helper function _parse_figsize in module graphics and use it in matplotlib() methods of classes Graphics and MultiGraphics</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/788a53d8c05800efb930436572f50e600425069d\"><code>788a53d</code></a></td><td><code>Add documentation in module multigraphics</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7d61e86d02212d8dde7bcc68e72404d2fee5817e\"><code>7d61e86</code></a></td><td><code>Improve documentation of GraphicsArray</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af6d312b97d49316a59106246574206fecff256e\"><code>af6d312</code></a></td><td><code>More documentation in classes MultiGraphics and GraphicsArray</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/58b3ca39afefdabe3d490269e7559bf8875f883b\"><code>58b3ca3</code></a></td><td><code>Completed documentation of MultiGraphics and GraphicsArray</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1bf8ad16bd29211742090e1c1b7c54bb309abd2e\"><code>1bf8ad1</code></a></td><td><code>Small cleaning in MultiGraphics</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccff60c7fb3b4aaf554fea1b924407dd9161d84d\"><code>ccff60c</code></a></td><td><code>Fix some doctests after the improved computation of nrows and ncols in graphics_array</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/26180ab93d915320eba64be8edd53b53b61dc10f\"><code>26180ab</code></a></td><td><code>Some cleaning in MultiGraphics.matplotlib</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3bd6a56484edb3782c828d490246f546e3e5e7c7\"><code>3bd6a56</code></a></td><td><code>Minor cleaning in GraphicsArray</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a5ef55af4d104c840107f46abbcba90fa401a18\"><code>3a5ef55</code></a></td><td><code>Change index range in GraphicsArray._add_subplot()</code></td></tr></table>\n",
    "created_at": "2019-05-24T12:14:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432687",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:1"></div>

Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4bbdf8861bd938d06abc0fa4545cd1f92fa317ec"><code>4bbdf88</code></a></td><td><code>Add helper function _parse_figsize in module graphics and use it in matplotlib() methods of classes Graphics and MultiGraphics</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/788a53d8c05800efb930436572f50e600425069d"><code>788a53d</code></a></td><td><code>Add documentation in module multigraphics</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7d61e86d02212d8dde7bcc68e72404d2fee5817e"><code>7d61e86</code></a></td><td><code>Improve documentation of GraphicsArray</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af6d312b97d49316a59106246574206fecff256e"><code>af6d312</code></a></td><td><code>More documentation in classes MultiGraphics and GraphicsArray</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/58b3ca39afefdabe3d490269e7559bf8875f883b"><code>58b3ca3</code></a></td><td><code>Completed documentation of MultiGraphics and GraphicsArray</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1bf8ad16bd29211742090e1c1b7c54bb309abd2e"><code>1bf8ad1</code></a></td><td><code>Small cleaning in MultiGraphics</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccff60c7fb3b4aaf554fea1b924407dd9161d84d"><code>ccff60c</code></a></td><td><code>Fix some doctests after the improved computation of nrows and ncols in graphics_array</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/26180ab93d915320eba64be8edd53b53b61dc10f"><code>26180ab</code></a></td><td><code>Some cleaning in MultiGraphics.matplotlib</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3bd6a56484edb3782c828d490246f546e3e5e7c7"><code>3bd6a56</code></a></td><td><code>Minor cleaning in GraphicsArray</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a5ef55af4d104c840107f46abbcba90fa401a18"><code>3a5ef55</code></a></td><td><code>Change index range in GraphicsArray._add_subplot()</code></td></tr></table>




---

archive/issue_comments_432688.json:
```json
{
    "body": "Branch: **[public/graphics/multi_graphics](https://github.com/sagemath/sagetrac-mirror/tree/public/graphics/multi_graphics)**",
    "created_at": "2019-05-24T12:14:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432688",
    "user": "https://github.com/egourgoulhon"
}
```

Branch: **[public/graphics/multi_graphics](https://github.com/sagemath/sagetrac-mirror/tree/public/graphics/multi_graphics)**



---

archive/issue_comments_432689.json:
```json
{
    "body": "Author: **Eric Gourgoulhon**",
    "created_at": "2019-05-24T12:14:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432689",
    "user": "https://github.com/egourgoulhon"
}
```

Author: **Eric Gourgoulhon**



---

archive/issue_comments_432690.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This ticket makes `GraphicsArray` derive from a new class, `MultiGraphics`, which is more generic (arbitrary positions of graphics objects on a canvas) and paves the way towards graphics insets in #...\n+This ticket makes `GraphicsArray` derive from a new class, `MultiGraphics`, which is more generic (arbitrary positions of graphics objects on a canvas) and paves the way towards graphics insets in #27866.\n \n `GraphicsArray` is now endowed with a `matplotlib()` function (inheritated from  `MultiGraphics`). This fixes the issues reported in #10466, #10657, #11160 and #12591. \n Moreover, this simplifies `sphinx_plot()` (defined in `src/doc/common/conf.py`), avoiding code duplication. \n@@ -35,4 +35,4 @@\n ```\n   This fix explains the change of doctest outputs in `src/sage/categories/finite_posets.py` and `src/sage/repl/rich_output/pretty_print.py`\n \n-A preview (including the functionalities introduced in #...) is available [here](https://sagemanifolds.obspm.fr/preview/graphics_inset/reference/plotting/sage/plot/multigraphics.html).\n+A preview (including the functionalities introduced in #27866) is available [here](https://sagemanifolds.obspm.fr/preview/graphics_inset/reference/plotting/sage/plot/multigraphics.html).\n``````\n",
    "created_at": "2019-05-24T12:14:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432690",
    "user": "https://github.com/egourgoulhon"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This ticket makes `GraphicsArray` derive from a new class, `MultiGraphics`, which is more generic (arbitrary positions of graphics objects on a canvas) and paves the way towards graphics insets in #...
+This ticket makes `GraphicsArray` derive from a new class, `MultiGraphics`, which is more generic (arbitrary positions of graphics objects on a canvas) and paves the way towards graphics insets in #27866.
 
 `GraphicsArray` is now endowed with a `matplotlib()` function (inheritated from  `MultiGraphics`). This fixes the issues reported in #10466, #10657, #11160 and #12591. 
 Moreover, this simplifies `sphinx_plot()` (defined in `src/doc/common/conf.py`), avoiding code duplication. 
@@ -35,4 +35,4 @@
 ```
   This fix explains the change of doctest outputs in `src/sage/categories/finite_posets.py` and `src/sage/repl/rich_output/pretty_print.py`
 
-A preview (including the functionalities introduced in #...) is available [here](https://sagemanifolds.obspm.fr/preview/graphics_inset/reference/plotting/sage/plot/multigraphics.html).
+A preview (including the functionalities introduced in #27866) is available [here](https://sagemanifolds.obspm.fr/preview/graphics_inset/reference/plotting/sage/plot/multigraphics.html).
``````




---

archive/issue_comments_432691.json:
```json
{
    "body": "Attachment: **[graphics_array_bug.png](https://github.com/sagemath/sage/files/ticket27865/graphics_array_bug.png)**",
    "created_at": "2019-05-24T12:19:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432691",
    "user": "https://github.com/egourgoulhon"
}
```

Attachment: **[graphics_array_bug.png](https://github.com/sagemath/sage/files/ticket27865/graphics_array_bug.png)**



---

archive/issue_comments_432692.json:
```json
{
    "body": "Attachment: **[graphics_array_ok.png](https://github.com/sagemath/sage/files/ticket27865/graphics_array_ok.png)**",
    "created_at": "2019-05-24T12:19:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432692",
    "user": "https://github.com/egourgoulhon"
}
```

Attachment: **[graphics_array_ok.png](https://github.com/sagemath/sage/files/ticket27865/graphics_array_ok.png)**



---

archive/issue_comments_432693.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nHere is an example summarizing some the `GraphicsArray` issues. In Sage 8.7, the following code:\n\n```\nsage: g1 = plot(sin(x^2), (x, 0, 6), \n....:           axes_labels=[r'$\\theta$', r'$\\sin(\\theta^2)$'], fontsize=14)\nsage: g2 = circle((0,0), 1, fill=True, color='red', alpha=0.4, axes=False) \\\n....:      + text(\"This is a disk\", (0.9, 1.1), color='red', alpha=0.4, \n....:             fontsize=12)\nsage: g3 = plot(x^3, (x, 1, 100), axes_labels=[r'$x$', r'$y$'], \n....:           legend_label=r'$y = x^3$', scale='semilogy', frame=True, \n....:           gridlines='minor') \\\n....:      + text(\"This is a semilogy plot\", (80, 1e5), color='red', alpha=0.4, \n....:             fontsize=12)\nsage: graphics_array([g1, g2, g3])\n```\nresults in this figure:\n\n![](https://github.com/sagemath/sage/files/ticket27865/graphics_array_bug.png)\n\nWe see that \n- the `semilogy` scale asked for `g3` is actually applied to `g1`\n- the fontsize asked for `g1` is not taken into account (this is #10657)\n- the option `axes=False` asked for `g2` is not taken into account (#10466 and #10657)\n- the legend of `g3` is doubled (#12591) \n- the color of the text in `g3` is not the same as in `g2`, while they both defined as `color='red', alpha=0.4` (#12591)\n\nWith the code introduced in this ticket, the output becomes\n\n![](https://github.com/sagemath/sage/files/ticket27865/graphics_array_ok.png)\n\nWe see that all the above issues are gone.",
    "created_at": "2019-05-24T12:36:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432693",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:3" align="right">comment:3</div>

Here is an example summarizing some the `GraphicsArray` issues. In Sage 8.7, the following code:

```
sage: g1 = plot(sin(x^2), (x, 0, 6), 
....:           axes_labels=[r'$\theta$', r'$\sin(\theta^2)$'], fontsize=14)
sage: g2 = circle((0,0), 1, fill=True, color='red', alpha=0.4, axes=False) \
....:      + text("This is a disk", (0.9, 1.1), color='red', alpha=0.4, 
....:             fontsize=12)
sage: g3 = plot(x^3, (x, 1, 100), axes_labels=[r'$x$', r'$y$'], 
....:           legend_label=r'$y = x^3$', scale='semilogy', frame=True, 
....:           gridlines='minor') \
....:      + text("This is a semilogy plot", (80, 1e5), color='red', alpha=0.4, 
....:             fontsize=12)
sage: graphics_array([g1, g2, g3])
```
results in this figure:

![](https://github.com/sagemath/sage/files/ticket27865/graphics_array_bug.png)

We see that 
- the `semilogy` scale asked for `g3` is actually applied to `g1`
- the fontsize asked for `g1` is not taken into account (this is #10657)
- the option `axes=False` asked for `g2` is not taken into account (#10466 and #10657)
- the legend of `g3` is doubled (#12591) 
- the color of the text in `g3` is not the same as in `g2`, while they both defined as `color='red', alpha=0.4` (#12591)

With the code introduced in this ticket, the output becomes

![](https://github.com/sagemath/sage/files/ticket27865/graphics_array_ok.png)

We see that all the above issues are gone.



---

archive/issue_events_379225.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-05-24T12:38:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27865#event-379225"
}
```



---

archive/issue_comments_432694.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAnother bug fixed by this ticket regards the options passed to the method `GraphicsArray.show()`. This bug shows up in the\n[2D plotting section](http://doc.sagemath.org/html/en/reference/plotting/sage/plot/plot.html) of the reference manual. In the example starting with *\"The basic options for filling a plot\"*, the figure resulting from\n\n```\nsage: p1 = plot(sin(x), -pi, pi, fill='axis')\nsage: p2 = plot(sin(x), -pi, pi, fill='min', fillalpha=1)\nsage: p3 = plot(sin(x), -pi, pi, fill='max')\nsage: p4 = plot(sin(x), -pi, pi, fill=(1-x)/3, fillcolor='blue', fillalpha=.2)\nsage: graphics_array([[p1, p2], [p3, p4]]).show(frame=True, axes=False)\n```\nhas obviously some axes and no frame...\n\nCompare with the figure produced by the code in this ticket [here](https://sagemanifolds.obspm.fr/preview/graphics_inset/reference/plotting/sage/plot/plot.html).",
    "created_at": "2019-05-24T12:56:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432694",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:5" align="right">comment:5</div>

Another bug fixed by this ticket regards the options passed to the method `GraphicsArray.show()`. This bug shows up in the
[2D plotting section](http://doc.sagemath.org/html/en/reference/plotting/sage/plot/plot.html) of the reference manual. In the example starting with *"The basic options for filling a plot"*, the figure resulting from

```
sage: p1 = plot(sin(x), -pi, pi, fill='axis')
sage: p2 = plot(sin(x), -pi, pi, fill='min', fillalpha=1)
sage: p3 = plot(sin(x), -pi, pi, fill='max')
sage: p4 = plot(sin(x), -pi, pi, fill=(1-x)/3, fillcolor='blue', fillalpha=.2)
sage: graphics_array([[p1, p2], [p3, p4]]).show(frame=True, axes=False)
```
has obviously some axes and no frame...

Compare with the figure produced by the code in this ticket [here](https://sagemanifolds.obspm.fr/preview/graphics_inset/reference/plotting/sage/plot/plot.html).



---

archive/issue_comments_432695.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n This ticket makes `GraphicsArray` derive from a new class, `MultiGraphics`, which is more generic (arbitrary positions of graphics objects on a canvas) and paves the way towards graphics insets in #27866.\n \n-`GraphicsArray` is now endowed with a `matplotlib()` function (inheritated from  `MultiGraphics`). This fixes the issues reported in #10466, #10657, #11160 and #12591. \n+`GraphicsArray` is now endowed with a `matplotlib()` function (inheritated from  `MultiGraphics`). This fixes the issues reported in #10466, #10657, #11160 and #12591 (see :comment:3 and [comment:5](#comment%3A5) below for a summary). \n Moreover, this simplifies `sphinx_plot()` (defined in `src/doc/common/conf.py`), avoiding code duplication. \n \n Beside introducing `matplotlib()` at the graphics array level, two bugs had to be corrected in `Graphics.matplotlib()`:\n``````\n",
    "created_at": "2019-05-24T13:10:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432695",
    "user": "https://github.com/egourgoulhon"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 This ticket makes `GraphicsArray` derive from a new class, `MultiGraphics`, which is more generic (arbitrary positions of graphics objects on a canvas) and paves the way towards graphics insets in #27866.
 
-`GraphicsArray` is now endowed with a `matplotlib()` function (inheritated from  `MultiGraphics`). This fixes the issues reported in #10466, #10657, #11160 and #12591. 
+`GraphicsArray` is now endowed with a `matplotlib()` function (inheritated from  `MultiGraphics`). This fixes the issues reported in #10466, #10657, #11160 and #12591 (see :comment:3 and [comment:5](#comment%3A5) below for a summary). 
 Moreover, this simplifies `sphinx_plot()` (defined in `src/doc/common/conf.py`), avoiding code duplication. 
 
 Beside introducing `matplotlib()` at the graphics array level, two bugs had to be corrected in `Graphics.matplotlib()`:
``````




---

archive/issue_comments_432696.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nTHIS IS AMAZING!\n\n---\nI (as usual the past few years, I am sorry) will not be able to provide code review.  But I think this is a great improvement.  The multigraphics examples at the end of [the example page](https://sagemanifolds.obspm.fr/preview/graphics_inset/reference/plotting/sage/plot/multigraphics.html) are particularly impressive, and bring us a long ways toward having a \"mathematical\" way to interface with the stuff matplotlib provides - I could imagine it being particularly helpful with SageTeX.  Thank you.\n\nAs my only suggestion, I would just urge you to be sure all previously \"wrong\" behavior shows up in the tests section, and that any errors be tested as well.  As an example, you mention\n> For instance, G[0, 1] will throw an error.\n\nso might as well put in \n\n```\nsage: G[0,1]\nIndexError ...\n```\nor whatever is appropriate.  We've definitely caught subtle things over the years with those kinds of tests.",
    "created_at": "2019-05-24T13:55:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432696",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:7" align="right">comment:7</div>

THIS IS AMAZING!

---
I (as usual the past few years, I am sorry) will not be able to provide code review.  But I think this is a great improvement.  The multigraphics examples at the end of [the example page](https://sagemanifolds.obspm.fr/preview/graphics_inset/reference/plotting/sage/plot/multigraphics.html) are particularly impressive, and bring us a long ways toward having a "mathematical" way to interface with the stuff matplotlib provides - I could imagine it being particularly helpful with SageTeX.  Thank you.

As my only suggestion, I would just urge you to be sure all previously "wrong" behavior shows up in the tests section, and that any errors be tested as well.  As an example, you mention
> For instance, G[0, 1] will throw an error.

so might as well put in 

```
sage: G[0,1]
IndexError ...
```
or whatever is appropriate.  We've definitely caught subtle things over the years with those kinds of tests.



---

archive/issue_comments_432697.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@kcrisman](#comment%3A7):\n> As my only suggestion, I would just urge you to be sure all previously \"wrong\" behavior shows up in the tests section, and that any errors be tested as well.  As an example, you mention\n> > For instance, G[0, 1] will throw an error.\n\n> so might as well put in \n> \n> ```\n> sage: G[0,1]\n> IndexError ...\n> ```\n> or whatever is appropriate.  We've definitely caught subtle things over the years with those kinds of tests.\n\nOK, no problem, I'll introduce these tests. \nAnd thanks for your comments.",
    "created_at": "2019-05-24T14:49:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432697",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@kcrisman](#comment%3A7):
> As my only suggestion, I would just urge you to be sure all previously "wrong" behavior shows up in the tests section, and that any errors be tested as well.  As an example, you mention
> > For instance, G[0, 1] will throw an error.

> so might as well put in 
> 
> ```
> sage: G[0,1]
> IndexError ...
> ```
> or whatever is appropriate.  We've definitely caught subtle things over the years with those kinds of tests.

OK, no problem, I'll introduce these tests. 
And thanks for your comments.



---

archive/issue_comments_432698.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nDuring the preparation of this ticket, two questions arose:\n- the method `Graphics.matplotlib()` has the optional argument `filename=None`, which is not used in the function body; can we get rid of it?\n- the method `Graphics.save_image()` merely falls back to `Graphics.save()`; can we remove it (after some deprecation period of course) ?",
    "created_at": "2019-05-25T06:41:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432698",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:10" align="right">comment:10</div>

During the preparation of this ticket, two questions arose:
- the method `Graphics.matplotlib()` has the optional argument `filename=None`, which is not used in the function body; can we get rid of it?
- the method `Graphics.save_image()` merely falls back to `Graphics.save()`; can we remove it (after some deprecation period of course) ?



---

archive/issue_comments_432699.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nsome failing doctests, see patchbot reports",
    "created_at": "2019-06-05T18:46:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432699",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:11" align="right">comment:11</div>

some failing doctests, see patchbot reports



---

archive/issue_comments_432700.json:
```json
{
    "body": "Changed commit from **[`3a5ef55`](https://github.com/sagemath/sagetrac-mirror/commit/3a5ef55af4d104c840107f46abbcba90fa401a18)** to **[`af2bf46`](https://github.com/sagemath/sagetrac-mirror/commit/af2bf46ee0fc9cc5d24a696d55f4a1af1cc45f52)**",
    "created_at": "2019-06-06T22:20:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432700",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3a5ef55`](https://github.com/sagemath/sagetrac-mirror/commit/3a5ef55af4d104c840107f46abbcba90fa401a18)** to **[`af2bf46`](https://github.com/sagemath/sagetrac-mirror/commit/af2bf46ee0fc9cc5d24a696d55f4a1af1cc45f52)**



---

archive/issue_comments_432701.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ebebd4fb84c0f8fc3e0dd58ef2782dbcba5aa782\"><code>ebebd4f</code></a></td><td><code>Merge branch 'public/graphics/multi_graphics' of git://trac.sagemath.org/sage into Sage 8.8.beta7.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af2bf46ee0fc9cc5d24a696d55f4a1af1cc45f52\"><code>af2bf46</code></a></td><td><code>Restore 'not tested' flag on MultiGraphics._latex_() + example of error in GraphicsArray.__getitem__()</code></td></tr></table>\n",
    "created_at": "2019-06-06T22:20:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432701",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ebebd4fb84c0f8fc3e0dd58ef2782dbcba5aa782"><code>ebebd4f</code></a></td><td><code>Merge branch 'public/graphics/multi_graphics' of git://trac.sagemath.org/sage into Sage 8.8.beta7.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af2bf46ee0fc9cc5d24a696d55f4a1af1cc45f52"><code>af2bf46</code></a></td><td><code>Restore 'not tested' flag on MultiGraphics._latex_() + example of error in GraphicsArray.__getitem__()</code></td></tr></table>




---

archive/issue_comments_432702.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@fchapoton](#comment%3A11):\n> some failing doctests, see patchbot reports\n\nFrom all the errors reported bu the patchbots, it seems that only one pertains to this ticket:\n\n```\nFile \"src/sage/plot/multigraphics.py\", line 427, in \nsage.plot.multigraphics.MultiGraphics._latex_\nFailed example:\n    A._latex_()[:40]\nException raised:\n...\n      File \"/Users/jpalmier/Desktop/Sage/git/patchbot/sage/local/lib/python2.7/site-packages/matplotlib/backends/backend_pgf.py\", line 315, in __init__\n        \"or error in preamble:\\n%s\" % stdout)\n    LatexError: LaTeX returned an error, probably missing font or error in preamble:\n...\n    ! Package fontspec Error: The font \"Bitstream Vera Serif\" cannot be found.\n```\nThis doctest is passed on my computer (Ubuntu 18.04). It fails on macOS patchbots. The reason seems to be this Matplotlib issue:\nhttps://github.com/matplotlib/matplotlib/issues/10307\n\nActually, this doctest was borrowed from the previous method `GraphicsArray._latex_()`, since now the method `_latex_()` is defined at the level of the base class `MultiGraphics`. Its failure had not been revealed previously by the macOS patchbots because the doctest was marked with `# not tested`. When I transferred the method `_latex_()` from `GraphicsArray` to `MultiGraphics`, I suppressed the marker `# not tested` because the doctest passed on my computer and I though there was then no reason for such a marker.\n\nI have restored the `# not tested` marker in the above commit, along with a comment about the Matplotlib issue on macOS.\n\nThe patchbots also complain about 4 pyflakes issues. However, these reports are spurious for 2 of them:\n- \n\n```\nsrc/doc/common/conf.py:4: 'sage.misc.sagedoc.extlinks' imported but unused\n```\n  => if one suppresses this import, then the documentation fails to build (stating that `:trac:` is unknown)\n- \n\n```\nsrc/sage/plot/plot.py:585: 'sage.plot.line.line2d' imported but unused\n```\n  => this line is preceded by the following comment: \n\n```\n# import of line2d below is only for redirection of imports\n```\n  so I guess one should keep it.\n\nThe other 2 pyflakes errors are \n\n```\nsrc/sage/repl/rich_output/pretty_print.py:34: 'types' imported but unused\nsrc/sage/repl/rich_output/pretty_print.py:35: 'collections' imported but unused\n```\nThese imports have not been introduced by the currrent ticket and I am not sure whether one could removed them without any subtle side effect... \n\nBesides, the above commit implements the `G[0, 1]` error example suggested by Karl-Dieter in [comment:7](#comment%3A7).",
    "created_at": "2019-06-06T22:57:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432702",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@fchapoton](#comment%3A11):
> some failing doctests, see patchbot reports

From all the errors reported bu the patchbots, it seems that only one pertains to this ticket:

```
File "src/sage/plot/multigraphics.py", line 427, in 
sage.plot.multigraphics.MultiGraphics._latex_
Failed example:
    A._latex_()[:40]
Exception raised:
...
      File "/Users/jpalmier/Desktop/Sage/git/patchbot/sage/local/lib/python2.7/site-packages/matplotlib/backends/backend_pgf.py", line 315, in __init__
        "or error in preamble:\n%s" % stdout)
    LatexError: LaTeX returned an error, probably missing font or error in preamble:
...
    ! Package fontspec Error: The font "Bitstream Vera Serif" cannot be found.
```
This doctest is passed on my computer (Ubuntu 18.04). It fails on macOS patchbots. The reason seems to be this Matplotlib issue:
https://github.com/matplotlib/matplotlib/issues/10307

Actually, this doctest was borrowed from the previous method `GraphicsArray._latex_()`, since now the method `_latex_()` is defined at the level of the base class `MultiGraphics`. Its failure had not been revealed previously by the macOS patchbots because the doctest was marked with `# not tested`. When I transferred the method `_latex_()` from `GraphicsArray` to `MultiGraphics`, I suppressed the marker `# not tested` because the doctest passed on my computer and I though there was then no reason for such a marker.

I have restored the `# not tested` marker in the above commit, along with a comment about the Matplotlib issue on macOS.

The patchbots also complain about 4 pyflakes issues. However, these reports are spurious for 2 of them:
- 

```
src/doc/common/conf.py:4: 'sage.misc.sagedoc.extlinks' imported but unused
```
  => if one suppresses this import, then the documentation fails to build (stating that `:trac:` is unknown)
- 

```
src/sage/plot/plot.py:585: 'sage.plot.line.line2d' imported but unused
```
  => this line is preceded by the following comment: 

```
# import of line2d below is only for redirection of imports
```
  so I guess one should keep it.

The other 2 pyflakes errors are 

```
src/sage/repl/rich_output/pretty_print.py:34: 'types' imported but unused
src/sage/repl/rich_output/pretty_print.py:35: 'collections' imported but unused
```
These imports have not been introduced by the currrent ticket and I am not sure whether one could removed them without any subtle side effect... 

Besides, the above commit implements the `G[0, 1]` error example suggested by Karl-Dieter in [comment:7](#comment%3A7).



---

archive/issue_comments_432703.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36c0f178353017ac12573ff038c40ed55a24ba2d\"><code>36c0f17</code></a></td><td><code>Error message valid for py3 only in a multigraphics doctest</code></td></tr></table>\n",
    "created_at": "2019-06-07T08:34:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432703",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36c0f178353017ac12573ff038c40ed55a24ba2d"><code>36c0f17</code></a></td><td><code>Error message valid for py3 only in a multigraphics doctest</code></td></tr></table>




---

archive/issue_comments_432704.json:
```json
{
    "body": "Changed commit from **[`af2bf46`](https://github.com/sagemath/sagetrac-mirror/commit/af2bf46ee0fc9cc5d24a696d55f4a1af1cc45f52)** to **[`36c0f17`](https://github.com/sagemath/sagetrac-mirror/commit/36c0f178353017ac12573ff038c40ed55a24ba2d)**",
    "created_at": "2019-06-07T08:34:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432704",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`af2bf46`](https://github.com/sagemath/sagetrac-mirror/commit/af2bf46ee0fc9cc5d24a696d55f4a1af1cc45f52)** to **[`36c0f17`](https://github.com/sagemath/sagetrac-mirror/commit/36c0f178353017ac12573ff038c40ed55a24ba2d)**



---

archive/issue_comments_432705.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@egourgoulhon](#comment%3A13):\n> Besides, the above commit implements the `G[0, 1]` error example suggested by Karl-Dieter in [comment:7](#comment%3A7).\n\nI've prepared the `G[0, 1]` example with py3 Sage and it turns out that the error message is different in py2. This triggered a new doctest error for the py2 patchbot. The above commit (comment:14) fixes this.",
    "created_at": "2019-06-07T08:39:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432705",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@egourgoulhon](#comment%3A13):
> Besides, the above commit implements the `G[0, 1]` error example suggested by Karl-Dieter in [comment:7](#comment%3A7).

I've prepared the `G[0, 1]` example with py3 Sage and it turns out that the error message is different in py2. This triggered a new doctest error for the py2 patchbot. The above commit (comment:14) fixes this.



---

archive/issue_comments_432706.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@kcrisman](#comment%3A7):\n> \n> As my only suggestion, I would just urge you to be sure all previously \"wrong\" behavior shows up in the tests section\n\nActually, the previous wrong behaviors were \"silent\" errors, which showed up only in the figures, as illustrated in [comment:3](#comment%3A3). Their fixes therefore cannot be checked in doctests. I've however chosen the doctests in the EXAMPLES section of `sage.plot.plot.graphics_array` and `sage.plot.multigraphics.GraphicsArray` to include most of (if not all) the issues exhibited in [comment:3](#comment%3A3) and [comment:5](#comment%3A5). But at the end, the fix can only be judged by a human eye.",
    "created_at": "2019-06-14T13:43:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432706",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@kcrisman](#comment%3A7):
> 
> As my only suggestion, I would just urge you to be sure all previously "wrong" behavior shows up in the tests section

Actually, the previous wrong behaviors were "silent" errors, which showed up only in the figures, as illustrated in [comment:3](#comment%3A3). Their fixes therefore cannot be checked in doctests. I've however chosen the doctests in the EXAMPLES section of `sage.plot.plot.graphics_array` and `sage.plot.multigraphics.GraphicsArray` to include most of (if not all) the issues exhibited in [comment:3](#comment%3A3) and [comment:5](#comment%3A5). But at the end, the fix can only be judged by a human eye.



---

archive/issue_comments_432707.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nIt seems there is no longer any failing doctest reported by the patchbots (except for spurious ones, i.e. failures that appear on the ticket 0 as well: https://patchbot.sagemath.org/ticket/0/)...",
    "created_at": "2019-06-14T13:50:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432707",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:17" align="right">comment:17</div>

It seems there is no longer any failing doctest reported by the patchbots (except for spurious ones, i.e. failures that appear on the ticket 0 as well: https://patchbot.sagemath.org/ticket/0/)...



---

archive/issue_comments_432708.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\n> > As my only suggestion, I would just urge you to be sure all previously \"wrong\" behavior shows up in the tests section\n\n> \n> Actually, the previous wrong behaviors were \"silent\" errors, which showed up only in the figures, as illustrated in [comment:3](#comment%3A3). Their fixes therefore cannot be checked in doctests. I've however chosen the doctests in the EXAMPLES section of `sage.plot.plot.graphics_array` and `sage.plot.multigraphics.GraphicsArray` to include most of (if not all) the issues exhibited in [comment:3](#comment%3A3) and [comment:5](#comment%3A5). But at the end, the fix can only be judged by a human eye. \n\nOh, that was all I meant.  Yes, at one point we considered trying to automate doctesting the images themselves (!) but especially now that a lot of images are created for the documentation, regressions should be easier to identify, and we would like to have those available.  Thanks!",
    "created_at": "2019-06-14T14:59:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432708",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:18" align="right">comment:18</div>

> > As my only suggestion, I would just urge you to be sure all previously "wrong" behavior shows up in the tests section

> 
> Actually, the previous wrong behaviors were "silent" errors, which showed up only in the figures, as illustrated in [comment:3](#comment%3A3). Their fixes therefore cannot be checked in doctests. I've however chosen the doctests in the EXAMPLES section of `sage.plot.plot.graphics_array` and `sage.plot.multigraphics.GraphicsArray` to include most of (if not all) the issues exhibited in [comment:3](#comment%3A3) and [comment:5](#comment%3A5). But at the end, the fix can only be judged by a human eye. 

Oh, that was all I meant.  Yes, at one point we considered trying to automate doctesting the images themselves (!) but especially now that a lot of images are created for the documentation, regressions should be easier to identify, and we would like to have those available.  Thanks!



---

archive/issue_comments_432709.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI am giving a positive review. This is a very nice progress, that fixes a whole lot of long-standing bugs. Fixed tickets will have to be closed later, with appropriate doctests if necessary.",
    "created_at": "2019-06-19T14:07:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432709",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:19" align="right">comment:19</div>

I am giving a positive review. This is a very nice progress, that fixes a whole lot of long-standing bugs. Fixed tickets will have to be closed later, with appropriate doctests if necessary.



---

archive/issue_events_379226.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-06-19T14:07:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27865#event-379226"
}
```



---

archive/issue_events_379227.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-06-19T14:07:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27865#event-379227"
}
```



---

archive/issue_comments_432710.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2019-06-19T14:07:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432710",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: **Frédéric Chapoton**



---

archive/issue_comments_432711.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@fchapoton](#comment%3A19):\n> I am giving a positive review. This is a very nice progress, that fixes a whole lot of long-standing bugs. Fixed tickets will have to be closed later, with appropriate doctests if necessary.\n\n\nThanks for the review!",
    "created_at": "2019-06-19T16:18:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432711",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@fchapoton](#comment%3A19):
> I am giving a positive review. This is a very nice progress, that fixes a whole lot of long-standing bugs. Fixed tickets will have to be closed later, with appropriate doctests if necessary.


Thanks for the review!



---

archive/issue_comments_432712.json:
```json
{
    "body": "Changed branch from **[public/graphics/multi_graphics](https://github.com/sagemath/sagetrac-mirror/tree/public/graphics/multi_graphics)** to **[`36c0f17`](https://github.com/sagemath/sagetrac-mirror/commit/36c0f178353017ac12573ff038c40ed55a24ba2d)**",
    "created_at": "2019-06-27T20:13:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432712",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/graphics/multi_graphics](https://github.com/sagemath/sagetrac-mirror/tree/public/graphics/multi_graphics)** to **[`36c0f17`](https://github.com/sagemath/sagetrac-mirror/commit/36c0f178353017ac12573ff038c40ed55a24ba2d)**



---

archive/issue_events_379228.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-27T20:13:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27865#event-379228"
}
```



---

archive/issue_events_379229.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "fe381ff49765856c119e05dc00da9e8125b83683",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-06-27T20:13:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27865#event-379229"
}
```



---

archive/issue_events_379230.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:34:48Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27865#event-379230"
}
```



---

archive/issue_events_379231.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:34:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27865#event-379231"
}
```



---

archive/issue_comments_432713.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nNot in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were *actually* included, especially when closing tickets.",
    "created_at": "2019-07-03T11:34:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27865#issuecomment-432713",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">comment:22</div>

Not in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were *actually* included, especially when closing tickets.
