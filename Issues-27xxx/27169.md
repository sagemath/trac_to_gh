# Issue 27169: Upgrade to FreeType 2.9.1

archive/issues_026932.json:
```json
{
    "body": "This ticket is to upgrade to FreeType 2.9.1.\n\n- **Tarball**: https://download.savannah.gnu.org/releases/freetype/freetype-2.9.1.tar.bz2\n\nNote that downloading from that url works in a browser but not with\n`curl -O $URL` which results in a zero byte file. Some redirection must be going on.\n\nOur last upgrade was to FreeType 2.8.1 in #24240\n(merged in [SageMath](SageMath) 8.2.beta0).\n\nThis might help with #27163, see comment 27 there.\n\n\nCC:  @antonio-rojas @EmmanuelCharpentier @dimpase @embray @kiwifb @timokau @infinity0 @novoselt @slel @tobihan\n\nKeywords: upgrade, freetype\n\nBranch/Commit: 4c0c33816b155d6775f6d99318e6f9d9249add9b\n\nReviewer: Fran\u00e7ois Bissey, Dima Pasechnik\n\nAuthor: Samuel Leli\u00e8vre, Dima Pasechnik\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27169\n\n",
    "closed_at": "2019-02-04T23:01:42Z",
    "created_at": "2019-01-29T16:58:32Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Upgrade to FreeType 2.9.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27169",
    "user": "https://github.com/slel"
}
```
This ticket is to upgrade to FreeType 2.9.1.

- **Tarball**: https://download.savannah.gnu.org/releases/freetype/freetype-2.9.1.tar.bz2

Note that downloading from that url works in a browser but not with
`curl -O $URL` which results in a zero byte file. Some redirection must be going on.

Our last upgrade was to FreeType 2.8.1 in #24240
(merged in [SageMath](SageMath) 8.2.beta0).

This might help with #27163, see comment 27 there.


CC:  @antonio-rojas @EmmanuelCharpentier @dimpase @embray @kiwifb @timokau @infinity0 @novoselt @slel @tobihan

Keywords: upgrade, freetype

Branch/Commit: 4c0c33816b155d6775f6d99318e6f9d9249add9b

Reviewer: François Bissey, Dima Pasechnik

Author: Samuel Lelièvre, Dima Pasechnik

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27169





---

archive/issue_comments_403507.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,13 +1,12 @@\n-This ticket is to upgrade to Freetype 2.9.1.\n+This ticket is to upgrade to FreeType 2.9.1.\n \n-**Tarball**\n+- **Tarball**: https://download.savannah.gnu.org/releases/freetype/freetype-2.9.1.tar.bz2\n \n-- https://download.savannah.gnu.org/releases/freetype/freetype-2.9.1.tar.bz2\n-\n-Our last upgrade was to Freetype 2.8.1 in #24240\n+Our last upgrade was to FreeType 2.8.1 in #24240\n (merged in [SageMath](SageMath) 8.2.beta0).\n \n-This might help with #27163.\n+This might help with #27163, see comment 27 there.\n+\n \n Comment: 1\n \n```\n",
    "created_at": "2019-01-29T18:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403507",
    "user": "https://github.com/slel"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,13 +1,12 @@
-This ticket is to upgrade to Freetype 2.9.1.
+This ticket is to upgrade to FreeType 2.9.1.
 
-**Tarball**
+- **Tarball**: https://download.savannah.gnu.org/releases/freetype/freetype-2.9.1.tar.bz2
 
-- https://download.savannah.gnu.org/releases/freetype/freetype-2.9.1.tar.bz2
-
-Our last upgrade was to Freetype 2.8.1 in #24240
+Our last upgrade was to FreeType 2.8.1 in #24240
 (merged in [SageMath](SageMath) 8.2.beta0).
 
-This might help with #27163.
+This might help with #27163, see comment 27 there.
+
 
 Comment: 1
 
```




---

archive/issue_comments_403508.json:
```json
{
    "body": "<a id='comment:2'></a>To upgrade, I downloaded the new tarball to `upstream` and then ran\n\n```\nsage --package update freetype 2.9.1\n```\n\n---\nNew commits:",
    "created_at": "2019-01-29T18:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403508",
    "user": "https://github.com/slel"
}
```

<a id='comment:2'></a>To upgrade, I downloaded the new tarball to `upstream` and then ran

```
sage --package update freetype 2.9.1
```

---
New commits:



---

archive/issue_comments_403509.json:
```json
{
    "body": "<a id='comment:3'></a>The `spkg-install` has something about harfbuzz.\n\nSomeone knowledgeable should check if that is still needed.\n\n- harfbuzz issues on the Savannah issue tracker:\n  https://savannah.nongnu.org/search/?Search=Search&words=harfbuzz&type_of_search=bugs&exact=1&max_rows=200&type=2#options",
    "created_at": "2019-01-29T18:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403509",
    "user": "https://github.com/slel"
}
```

<a id='comment:3'></a>The `spkg-install` has something about harfbuzz.

Someone knowledgeable should check if that is still needed.

- harfbuzz issues on the Savannah issue tracker:
  https://savannah.nongnu.org/search/?Search=Search&words=harfbuzz&type_of_search=bugs&exact=1&max_rows=200&type=2#options



---

archive/issue_comments_403510.json:
```json
{
    "body": "<a id='comment:4'></a>According to [FreeType documentation](https://www.freetype.org/freetype2/docs/),\n\n> FreeType is released under two open-source licenses:\n> our own BSD-like FreeType License and the GNU Public\n> License, Version 2. It can thus be used by any kind\n> of projects, be they proprietary or not.\n\n\nNot sure if this double licensing was already the case when\nFreeType was first included as a standard package, and\nwhether we should update the `SPKG.txt` to mention that.",
    "created_at": "2019-01-29T19:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403510",
    "user": "https://github.com/slel"
}
```

<a id='comment:4'></a>According to [FreeType documentation](https://www.freetype.org/freetype2/docs/),

> FreeType is released under two open-source licenses:
> our own BSD-like FreeType License and the GNU Public
> License, Version 2. It can thus be used by any kind
> of projects, be they proprietary or not.


Not sure if this double licensing was already the case when
FreeType was first included as a standard package, and
whether we should update the `SPKG.txt` to mention that.



---

archive/issue_comments_403511.json:
```json
{
    "body": "<a id='comment:5'></a>Yes, I thought I did the harfbuzz thing https://github.com/sagemath/sage/commit/4afa106419b7a603d77bb2c316f776226dd87fc0 \n\nThat's from 2015, I am hoping it is fixed but I cannot dig into it right now.\n\nFor the license I think we should update `SPKG.txt` as this is relevant for redistribution.",
    "created_at": "2019-01-29T19:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403511",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>Yes, I thought I did the harfbuzz thing https://github.com/sagemath/sage/commit/4afa106419b7a603d77bb2c316f776226dd87fc0 

That's from 2015, I am hoping it is fixed but I cannot dig into it right now.

For the license I think we should update `SPKG.txt` as this is relevant for redistribution.



---

archive/issue_comments_403512.json:
```json
{
    "body": "<a id='comment:6'></a>There is a mirror of freetype on github so I could check. And the answer is yes. harfbuzz minimal version detection is now done. So it is fixed.",
    "created_at": "2019-01-29T19:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403512",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>There is a mirror of freetype on github so I could check. And the answer is yes. harfbuzz minimal version detection is now done. So it is fixed.



---

archive/issue_comments_403513.json:
```json
{
    "body": "<a id='comment:7'></a>Something is not right - check that one gets freetype-config script installed to SAGE_LOCAL/bin. This is needed for other libs using freetype, and seems to be broken by this update.",
    "created_at": "2019-01-29T19:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403513",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>Something is not right - check that one gets freetype-config script installed to SAGE_LOCAL/bin. This is needed for other libs using freetype, and seems to be broken by this update.



---

archive/issue_comments_403514.json:
```json
{
    "body": "<a id='comment:8'></a>Thanks Fran\u00e7ois for mentioning that the FreeType code repo is mirrored\non GitHub; the main mirror and one such mirror are at:\n\n- http://git.savannah.gnu.org/cgit/freetype\n- https://github.com/aseprite/freetype2/\n\nThe [FreeType README](http://git.savannah.gnu.org/cgit/freetype/freetype2.git/tree/README)\nsuggests:\n\n> Please read the `docs/CHANGES` file, it contains IMPORTANT INFORMATION.\n\n>\n> Read the files `docs/INSTALL` for installation instructions; see the file\n> `docs/LICENSE.TXT` for the available licenses.\n\n>\n> The FreeType 2 API reference is located in `docs/reference`; use the file\n> `ft2-toc.html` as the top entry point. Additional documentation is available\n> as a separate package from our sites. Go to\n\n>\n> -  https://download.savannah.gnu.org/releases/freetype/\n \n>\n> and download one of the following files.\n\n>\n> - `freetype-doc-2.9.1.tar.bz2`\n> - `freetype-doc-2.9.1.tar.gz`\n> - `ftdoc291.zip`\n \n>\n> To view the documentation online, go to\n\n>\n> - https://www.freetype.org/freetype2/docs/\n\n\nAccording to the\n[FreeType CHANGES file](http://git.savannah.gnu.org/cgit/freetype/freetype2.git/tree/docs/CHANGES)\n(also [mirrored on GitHub](https://github.com/aseprite/freetype2/blob/master/docs/CHANGES)):\n\n> - Use of the `freetype-config` script to get compilation and linking\n>   options is deprecated since it doesn't support cross-compiling, among\n>   other deficiencies. Instead, you should use the `pkg-config` interface.\n \n>\n>   The `configure` script no longer installs `freetype-config` by\n>   default. For backwards compatibility, a new configure option\n>   `--enable-freetype-config` is provided that reverts this decision.\n\n\nIt might be worth going through the other changes listed there.\n\nI feel a little bit out of my depth here, if someone wants to take over.",
    "created_at": "2019-01-29T22:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403514",
    "user": "https://github.com/slel"
}
```

<a id='comment:8'></a>Thanks François for mentioning that the FreeType code repo is mirrored
on GitHub; the main mirror and one such mirror are at:

- http://git.savannah.gnu.org/cgit/freetype
- https://github.com/aseprite/freetype2/

The [FreeType README](http://git.savannah.gnu.org/cgit/freetype/freetype2.git/tree/README)
suggests:

> Please read the `docs/CHANGES` file, it contains IMPORTANT INFORMATION.

>
> Read the files `docs/INSTALL` for installation instructions; see the file
> `docs/LICENSE.TXT` for the available licenses.

>
> The FreeType 2 API reference is located in `docs/reference`; use the file
> `ft2-toc.html` as the top entry point. Additional documentation is available
> as a separate package from our sites. Go to

>
> -  https://download.savannah.gnu.org/releases/freetype/
 
>
> and download one of the following files.

>
> - `freetype-doc-2.9.1.tar.bz2`
> - `freetype-doc-2.9.1.tar.gz`
> - `ftdoc291.zip`
 
>
> To view the documentation online, go to

>
> - https://www.freetype.org/freetype2/docs/


According to the
[FreeType CHANGES file](http://git.savannah.gnu.org/cgit/freetype/freetype2.git/tree/docs/CHANGES)
(also [mirrored on GitHub](https://github.com/aseprite/freetype2/blob/master/docs/CHANGES)):

> - Use of the `freetype-config` script to get compilation and linking
>   options is deprecated since it doesn't support cross-compiling, among
>   other deficiencies. Instead, you should use the `pkg-config` interface.
 
>
>   The `configure` script no longer installs `freetype-config` by
>   default. For backwards compatibility, a new configure option
>   `--enable-freetype-config` is provided that reverts this decision.


It might be worth going through the other changes listed there.

I feel a little bit out of my depth here, if someone wants to take over.



---

archive/issue_comments_403515.json:
```json
{
    "body": "<a id='comment:9'></a>I've got past this issue by\n\n```diff\ndiff --git a/build/pkgs/freetype/spkg-install b/build/pkgs/freetype/spkg-install\nindex 49450d4944..b2713060ac 100644\n--- a/build/pkgs/freetype/spkg-install\n+++ b/build/pkgs/freetype/spkg-install\n@@ -1,7 +1,7 @@\n cd src\n \n # Disabling harfbuzz until upstream properly check for suitable version\n-GNUMAKE=${MAKE} sdh_configure --with-harfbuzz=no\n+GNUMAKE=${MAKE} sdh_configure --enable-freetype-config\n sdh_make\n sdh_make_install\n```\n\n(no need to worry about `harfbuzz` any more.)\n\nI think the rest of updates are enhancements, we don't need to worry about them.",
    "created_at": "2019-01-29T22:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403515",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>I've got past this issue by

```diff
diff --git a/build/pkgs/freetype/spkg-install b/build/pkgs/freetype/spkg-install
index 49450d4944..b2713060ac 100644
--- a/build/pkgs/freetype/spkg-install
+++ b/build/pkgs/freetype/spkg-install
@@ -1,7 +1,7 @@
 cd src
 
 # Disabling harfbuzz until upstream properly check for suitable version
-GNUMAKE=${MAKE} sdh_configure --with-harfbuzz=no
+GNUMAKE=${MAKE} sdh_configure --enable-freetype-config
 sdh_make
 sdh_make_install
```

(no need to worry about `harfbuzz` any more.)

I think the rest of updates are enhancements, we don't need to worry about them.



---

archive/issue_comments_403516.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-29T23:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403516",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_403517.json:
```json
{
    "body": "<a id='comment:11'></a>I edited `SPKG.txt`. Dima, would you push your change to `spkg-install` and set to `needs_review`?\n\n---\nNew commits:",
    "created_at": "2019-01-29T23:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403517",
    "user": "https://github.com/slel"
}
```

<a id='comment:11'></a>I edited `SPKG.txt`. Dima, would you push your change to `spkg-install` and set to `needs_review`?

---
New commits:



---

archive/issue_comments_403518.json:
```json
{
    "body": "<a id='comment:12'></a>I can't push to your personal branch. As this is the only difference so far, and hopefully stays this way, I'd rather let you add this change yourself.",
    "created_at": "2019-01-29T23:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403518",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>I can't push to your personal branch. As this is the only difference so far, and hopefully stays this way, I'd rather let you add this change yourself.



---

archive/issue_comments_403519.json:
```json
{
    "body": "<a id='comment:13'></a>OK, this also appears to fix #27163\n\nSubject to adding patch in comment 9, positive review.",
    "created_at": "2019-01-29T23:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403519",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>OK, this also appears to fix #27163

Subject to adding patch in comment 9, positive review.



---

archive/issue_comments_403520.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-30T00:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403520",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_403521.json:
```json
{
    "body": "<a id='comment:15'></a>Should have used a public branch, sorry. Added your change now.",
    "created_at": "2019-01-30T00:24:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403521",
    "user": "https://github.com/slel"
}
```

<a id='comment:15'></a>Should have used a public branch, sorry. Added your change now.



---

archive/issue_comments_403522.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-01-30T00:24:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403522",
    "user": "https://github.com/slel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_403523.json:
```json
{
    "body": "<a id='comment:16'></a>Cc-ing Andrey Novoseltsev in case this might impact SageCell.",
    "created_at": "2019-01-30T00:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403523",
    "user": "https://github.com/slel"
}
```

<a id='comment:16'></a>Cc-ing Andrey Novoseltsev in case this might impact SageCell.



---

archive/issue_comments_403524.json:
```json
{
    "body": "<a id='comment:17'></a>Looks good to me. Let's see if Andrey has something to say before putting it to positive review.",
    "created_at": "2019-01-30T01:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403524",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>Looks good to me. Let's see if Andrey has something to say before putting it to positive review.



---

archive/issue_comments_403525.json:
```json
{
    "body": "<a id='comment:18'></a>I hope that SageMathCell will not be affected, so please go ahead!",
    "created_at": "2019-01-30T04:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403525",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:18'></a>I hope that SageMathCell will not be affected, so please go ahead!



---

archive/issue_comments_403526.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-30T06:39:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403526",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_403527.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2019-01-30T09:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403527",
    "user": "https://github.com/slel"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_403528.json:
```json
{
    "body": "<a id='comment:21'></a>On Debian **`testing`**, neither develop+#27169 nor develop+#25674+#27169 give a fincyional results. In both cases :\n\n```\n> capabilities()\n       jpeg         png        tiff       tcltk         X11        aqua \n      FALSE       FALSE       FALSE        TRUE       FALSE       FALSE \n   http/ftp     sockets      libxml        fifo      cledit       iconv \n       TRUE        TRUE        TRUE        TRUE        TRUE        TRUE \n        NLS     profmem       cairo         ICU long.double     libcurl \n       TRUE       FALSE       FALSE        TRUE        TRUE        TRUE \nWarning message:\nIn doTryCatch(return(expr), name, parentenv, handler) :\n  impossible de charger l'objet partag\u00e9 '/usr/local/sage-8/local/lib/R//modules//R_X11.so':\n  /usr/lib/x86_64-linux-gnu/libcairo.so.2: undefined symbol: FT_Done_MM_Var\n```\n\nand\n\n```\n> install.packages(\"Cairo\")\n--- SVP s\u00e9lectionner un miroir CRAN pour cette session ---\nSecure CRAN mirrors \n\n 1: 0-Cloud [https]                   2: Algeria [https]                \n 3: Australia (Canberra) [https]      4: Australia (Melbourne 1) [https]\n 5: Australia (Melbourne 2) [https]   6: Australia (Perth) [https]      \n 7: Austria [https]                   8: Belgium (Ghent) [https]        \n 9: Brazil (PR) [https]              10: Brazil (RJ) [https]            \n11: Brazil (SP 1) [https]            12: Brazil (SP 2) [https]          \n13: Bulgaria [https]                 14: Chile 1 [https]                \n15: Chile 2 [https]                  16: China (Hong Kong) [https]      \n17: China (Guangzhou) [https]        18: China (Lanzhou) [https]        \n19: China (Shanghai 1) [https]       20: China (Shanghai 2) [https]     \n21: Colombia (Cali) [https]          22: Czech Republic [https]         \n23: Denmark [https]                  24: East Asia [https]              \n25: Ecuador (Cuenca) [https]         26: Ecuador (Quito) [https]        \n27: Estonia [https]                  28: France (Lyon 1) [https]        \n29: France (Lyon 2) [https]          30: France (Marseille) [https]     \n31: France (Montpellier) [https]     32: France (Paris 2) [https]       \n33: Germany (Erlangen) [https]       34: Germany (G\u00f6ttingen) [https]    \n35: Germany (M\u00fcnster) [https]        36: Greece [https]                 \n37: Iceland [https]                  38: India [https]                  \n39: Indonesia (Jakarta) [https]      40: Ireland [https]                \n41: Italy (Padua) [https]            42: Japan (Tokyo) [https]          \n43: Japan (Yonezawa) [https]         44: Korea (Busan) [https]          \n45: Korea (Gyeongsan-si) [https]     46: Korea (Seoul 1) [https]        \n47: Korea (Ulsan) [https]            48: Malaysia [https]               \n49: Mexico (Mexico City) [https]     50: Norway [https]                 \n51: Philippines [https]              52: Serbia [https]                 \n53: Spain (A Coru\u00f1a) [https]         54: Spain (Madrid) [https]         \n55: Sweden [https]                   56: Switzerland [https]            \n57: Turkey (Denizli) [https]         58: Turkey (Mersin) [https]        \n59: UK (Bristol) [https]             60: UK (London 1) [https]          \n61: USA (CA 1) [https]               62: USA (IA) [https]               \n63: USA (KS) [https]                 64: USA (MI 1) [https]             \n65: USA (OR) [https]                 66: USA (TN) [https]               \n67: USA (TX 1) [https]               68: Uruguay [https]                \n69: (other mirrors)                  \n\nSelection: 32\nessai de l'URL 'https://cran.univ-paris1.fr/src/contrib/Cairo_1.5-9.tar.gz'\nContent type 'application/x-gzip' length 86982 bytes (84 KB)\n==================================================\ndownloaded 84 KB\n\n* installing *source* package \u2018Cairo\u2019 ...\n** package \u2018Cairo\u2019 correctement d\u00e9compress\u00e9 et sommes MD5 v\u00e9rifi\u00e9es\nchecking for gcc... gcc\nchecking whether the C compiler works... yes\nchecking for C compiler default output file name... a.out\nchecking for suffix of executables... \nchecking whether we are cross compiling... no\nchecking for suffix of object files... o\nchecking whether we are using the GNU C compiler... yes\nchecking whether gcc accepts -g... yes\nchecking for gcc option to accept ISO C89... none needed\nchecking how to run the C preprocessor... gcc -E\nchecking for grep that handles long lines and -e... /bin/grep\nchecking for egrep... /bin/grep -E\nchecking for ANSI C header files... yes\nchecking for sys/wait.h that is POSIX.1 compatible... yes\nchecking for sys/types.h... yes\nchecking for sys/stat.h... yes\nchecking for stdlib.h... yes\nchecking for string.h... yes\nchecking for memory.h... yes\nchecking for strings.h... yes\nchecking for inttypes.h... yes\nchecking for stdint.h... yes\nchecking for unistd.h... yes\nchecking for string.h... (cached) yes\nchecking sys/time.h usability... yes\nchecking sys/time.h presence... yes\nchecking for sys/time.h... yes\nchecking for unistd.h... (cached) yes\nchecking for an ANSI C-conforming const... yes\nchecking for pkg-config... /usr/local/sage-8/local/bin/pkg-config\nchecking whether pkg-config knows about cairo... yes\nchecking for configurable backends... cairo cairo-ft cairo-pdf cairo-png cairo-ps cairo-xlib cairo-xlib-xrender\nconfigure: CAIRO_CFLAGS=-I/usr/local/sage-8/local/include -I/usr/local/sage-8/local/include/freetype2 -I/usr/local/sage-8/local/include -I/usr/local/sage-8/local/include/libpng16 -I/usr/include/cairo -I/usr/include/glib-2.0 -I/usr/lib/x86_64-linux-gnu/glib-2.0/include -I/usr/include/pixman-1 -I/usr/include/uuid\nchecking if R was compiled with the RConn patch... no\nchecking cairo.h usability... yes\nchecking cairo.h presence... yes\nchecking for cairo.h... yes\nchecking for PNG support in Cairo... yes\nchecking for ATS font support in Cairo... no\nconfigure: CAIRO_LIBS=-L/usr/local/sage-8/local/lib -lfreetype -lz -lpng16 -lz -lcairo -lXext -lXrender -lX11\nchecking for library containing deflate... no\nchecking whether Cairo programs can be compiled... configure: error: Cannot compile a simple Cairo program. See config.log for details.\nERROR: configuration failed for package \u2018Cairo\u2019\n* removing \u2018/usr/local/sage-8/local/lib/R/library/Cairo\u2019\n\nLes packages source t\u00e9l\u00e9charg\u00e9s sont dans\n\t\u2018/tmp/RtmpDoPTkq/downloaded_packages\u2019\nWarning message:\nIn install.packages(\"Cairo\") :\n  l'installation du package \u2018Cairo\u2019 a eu un statut de sortie non nul\n```",
    "created_at": "2019-01-30T11:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403528",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:21'></a>On Debian **`testing`**, neither develop+#27169 nor develop+#25674+#27169 give a fincyional results. In both cases :

```
> capabilities()
       jpeg         png        tiff       tcltk         X11        aqua 
      FALSE       FALSE       FALSE        TRUE       FALSE       FALSE 
   http/ftp     sockets      libxml        fifo      cledit       iconv 
       TRUE        TRUE        TRUE        TRUE        TRUE        TRUE 
        NLS     profmem       cairo         ICU long.double     libcurl 
       TRUE       FALSE       FALSE        TRUE        TRUE        TRUE 
Warning message:
In doTryCatch(return(expr), name, parentenv, handler) :
  impossible de charger l'objet partagé '/usr/local/sage-8/local/lib/R//modules//R_X11.so':
  /usr/lib/x86_64-linux-gnu/libcairo.so.2: undefined symbol: FT_Done_MM_Var
```

and

```
> install.packages("Cairo")
--- SVP sélectionner un miroir CRAN pour cette session ---
Secure CRAN mirrors 

 1: 0-Cloud [https]                   2: Algeria [https]                
 3: Australia (Canberra) [https]      4: Australia (Melbourne 1) [https]
 5: Australia (Melbourne 2) [https]   6: Australia (Perth) [https]      
 7: Austria [https]                   8: Belgium (Ghent) [https]        
 9: Brazil (PR) [https]              10: Brazil (RJ) [https]            
11: Brazil (SP 1) [https]            12: Brazil (SP 2) [https]          
13: Bulgaria [https]                 14: Chile 1 [https]                
15: Chile 2 [https]                  16: China (Hong Kong) [https]      
17: China (Guangzhou) [https]        18: China (Lanzhou) [https]        
19: China (Shanghai 1) [https]       20: China (Shanghai 2) [https]     
21: Colombia (Cali) [https]          22: Czech Republic [https]         
23: Denmark [https]                  24: East Asia [https]              
25: Ecuador (Cuenca) [https]         26: Ecuador (Quito) [https]        
27: Estonia [https]                  28: France (Lyon 1) [https]        
29: France (Lyon 2) [https]          30: France (Marseille) [https]     
31: France (Montpellier) [https]     32: France (Paris 2) [https]       
33: Germany (Erlangen) [https]       34: Germany (Göttingen) [https]    
35: Germany (Münster) [https]        36: Greece [https]                 
37: Iceland [https]                  38: India [https]                  
39: Indonesia (Jakarta) [https]      40: Ireland [https]                
41: Italy (Padua) [https]            42: Japan (Tokyo) [https]          
43: Japan (Yonezawa) [https]         44: Korea (Busan) [https]          
45: Korea (Gyeongsan-si) [https]     46: Korea (Seoul 1) [https]        
47: Korea (Ulsan) [https]            48: Malaysia [https]               
49: Mexico (Mexico City) [https]     50: Norway [https]                 
51: Philippines [https]              52: Serbia [https]                 
53: Spain (A Coruña) [https]         54: Spain (Madrid) [https]         
55: Sweden [https]                   56: Switzerland [https]            
57: Turkey (Denizli) [https]         58: Turkey (Mersin) [https]        
59: UK (Bristol) [https]             60: UK (London 1) [https]          
61: USA (CA 1) [https]               62: USA (IA) [https]               
63: USA (KS) [https]                 64: USA (MI 1) [https]             
65: USA (OR) [https]                 66: USA (TN) [https]               
67: USA (TX 1) [https]               68: Uruguay [https]                
69: (other mirrors)                  

Selection: 32
essai de l'URL 'https://cran.univ-paris1.fr/src/contrib/Cairo_1.5-9.tar.gz'
Content type 'application/x-gzip' length 86982 bytes (84 KB)
==================================================
downloaded 84 KB

* installing *source* package ‘Cairo’ ...
** package ‘Cairo’ correctement décompressé et sommes MD5 vérifiées
checking for gcc... gcc
checking whether the C compiler works... yes
checking for C compiler default output file name... a.out
checking for suffix of executables... 
checking whether we are cross compiling... no
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether gcc accepts -g... yes
checking for gcc option to accept ISO C89... none needed
checking how to run the C preprocessor... gcc -E
checking for grep that handles long lines and -e... /bin/grep
checking for egrep... /bin/grep -E
checking for ANSI C header files... yes
checking for sys/wait.h that is POSIX.1 compatible... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking for string.h... (cached) yes
checking sys/time.h usability... yes
checking sys/time.h presence... yes
checking for sys/time.h... yes
checking for unistd.h... (cached) yes
checking for an ANSI C-conforming const... yes
checking for pkg-config... /usr/local/sage-8/local/bin/pkg-config
checking whether pkg-config knows about cairo... yes
checking for configurable backends... cairo cairo-ft cairo-pdf cairo-png cairo-ps cairo-xlib cairo-xlib-xrender
configure: CAIRO_CFLAGS=-I/usr/local/sage-8/local/include -I/usr/local/sage-8/local/include/freetype2 -I/usr/local/sage-8/local/include -I/usr/local/sage-8/local/include/libpng16 -I/usr/include/cairo -I/usr/include/glib-2.0 -I/usr/lib/x86_64-linux-gnu/glib-2.0/include -I/usr/include/pixman-1 -I/usr/include/uuid
checking if R was compiled with the RConn patch... no
checking cairo.h usability... yes
checking cairo.h presence... yes
checking for cairo.h... yes
checking for PNG support in Cairo... yes
checking for ATS font support in Cairo... no
configure: CAIRO_LIBS=-L/usr/local/sage-8/local/lib -lfreetype -lz -lpng16 -lz -lcairo -lXext -lXrender -lX11
checking for library containing deflate... no
checking whether Cairo programs can be compiled... configure: error: Cannot compile a simple Cairo program. See config.log for details.
ERROR: configuration failed for package ‘Cairo’
* removing ‘/usr/local/sage-8/local/lib/R/library/Cairo’

Les packages source téléchargés sont dans
	‘/tmp/RtmpDoPTkq/downloaded_packages’
Warning message:
In install.packages("Cairo") :
  l'installation du package ‘Cairo’ a eu un statut de sortie non nul
```



---

archive/issue_comments_403529.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-01-30T11:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403529",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_403530.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 charpent]:\n\nPlease forget that. Apparently, the tarbal download didn't work an *I didn't see that*. I'll have to retry.\n\nMy most sincere apologies...\n\n[ Lots of bollocks : Snip... ]",
    "created_at": "2019-01-30T11:25:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403530",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:22'></a>Replying to [comment:21 charpent]:

Please forget that. Apparently, the tarbal download didn't work an *I didn't see that*. I'll have to retry.

My most sincere apologies...

[ Lots of bollocks : Snip... ]



---

archive/issue_comments_403531.json:
```json
{
    "body": "<a id='comment:23'></a>You can always check what version of freetype you have installed in Sage by calling, at `sage -sh` prompt, `freetype-config  --ftversion`. E.g.\n\n```\n$ sage -sh\n...\n$ freetype-config  --ftversion\n2.9.1\n```\nby the way, no need to post lists of CRAN mirrors---you probably also know\nthat\n\n```\ninstall.packages('Cairo', repos='https://cran.univ-paris1.fr')\n```\nwould automatically get to the repo of your choice.",
    "created_at": "2019-01-30T11:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403531",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:23'></a>You can always check what version of freetype you have installed in Sage by calling, at `sage -sh` prompt, `freetype-config  --ftversion`. E.g.

```
$ sage -sh
...
$ freetype-config  --ftversion
2.9.1
```
by the way, no need to post lists of CRAN mirrors---you probably also know
that

```
install.packages('Cairo', repos='https://cran.univ-paris1.fr')
```
would automatically get to the repo of your choice.



---

archive/issue_comments_403532.json:
```json
{
    "body": "<a id='comment:24'></a>After squelching my coroirate firewall's BS and *correctly* installing the source tarball, I now get graphical capabilities with both R 3.4.4 and  R 3.5.3 ; in both cases, teh R Cairo package installs correctly.\n\n`ptestlong` underway (with 3.5.2). That will take a bit of time...",
    "created_at": "2019-01-30T11:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403532",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:24'></a>After squelching my coroirate firewall's BS and *correctly* installing the source tarball, I now get graphical capabilities with both R 3.4.4 and  R 3.5.3 ; in both cases, teh R Cairo package installs correctly.

`ptestlong` underway (with 3.5.2). That will take a bit of time...



---

archive/issue_comments_403533.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2019-01-30T11:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403533",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_403534.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:23 dimpase]:\n> You can always check what version of freetype you have installed in Sage by calling, at `sage -sh` prompt, `freetype-config  --ftversion`. E.g.\n> \n> ```\n> $ sage -sh\n> ...\n> $ freetype-config  --ftversion\n> 2.9.1\n> ```\n\n\nI didn't knew that. Thanks for the tip !\n\n> by the way, no need to post lists of CRAN mirrors\n\n\nIndeed. I was typing too fast...\n\n> ---you probably also know that\n> \n> ```\n> install.packages('Cairo', repos='https://cran.univ-paris1.fr')\n> ```\n> would automatically get to the repo of your choice.\n\n\nIndeed also. But the damn firewall tries to nanny us, which seriously interferes with the availability of a given site, *changing with time*... So I tend to systematically let R search for a suitable repository.\n\nWhat troubles me more is that ` make` didn't display any error when I recompiled without the proper `freetype` source tarball. It should have complained, no ?",
    "created_at": "2019-01-30T11:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403534",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:25'></a>Replying to [comment:23 dimpase]:
> You can always check what version of freetype you have installed in Sage by calling, at `sage -sh` prompt, `freetype-config  --ftversion`. E.g.
> 
> ```
> $ sage -sh
> ...
> $ freetype-config  --ftversion
> 2.9.1
> ```


I didn't knew that. Thanks for the tip !

> by the way, no need to post lists of CRAN mirrors


Indeed. I was typing too fast...

> ---you probably also know that
> 
> ```
> install.packages('Cairo', repos='https://cran.univ-paris1.fr')
> ```
> would automatically get to the repo of your choice.


Indeed also. But the damn firewall tries to nanny us, which seriously interferes with the availability of a given site, *changing with time*... So I tend to systematically let R search for a suitable repository.

What troubles me more is that ` make` didn't display any error when I recompiled without the proper `freetype` source tarball. It should have complained, no ?



---

archive/issue_comments_403535.json:
```json
{
    "body": "<a id='comment:26'></a>Forgot to warn that downloading from that url works in a browser but not with\n`curl -O $URL` which results in a zero byte file. Some redirection must be going on.",
    "created_at": "2019-01-30T12:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403535",
    "user": "https://github.com/slel"
}
```

<a id='comment:26'></a>Forgot to warn that downloading from that url works in a browser but not with
`curl -O $URL` which results in a zero byte file. Some redirection must be going on.



---

archive/issue_comments_403536.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,14 @@\n+This ticket is to upgrade to FreeType 2.9.1.\n+\n+- **Tarball**: https://download.savannah.gnu.org/releases/freetype/freetype-2.9.1.tar.bz2\n+\n+Note that downloading from that url works in a browser but not with\n+\\`curl -O $URL\\` which results in a zero byte file. Some redirection must be going on.\n+\n+Our last upgrade was to FreeType 2.8.1 in #24240\n+(merged in [SageMath](SageMath) 8.2.beta0).\n+\n+This might help with #27163, see comment 27 there.\n \n \n Comment: 1\n```\n",
    "created_at": "2019-01-30T12:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403536",
    "user": "https://github.com/slel"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,14 @@
+This ticket is to upgrade to FreeType 2.9.1.
+
+- **Tarball**: https://download.savannah.gnu.org/releases/freetype/freetype-2.9.1.tar.bz2
+
+Note that downloading from that url works in a browser but not with
+\`curl -O $URL\` which results in a zero byte file. Some redirection must be going on.
+
+Our last upgrade was to FreeType 2.8.1 in #24240
+(merged in [SageMath](SageMath) 8.2.beta0).
+
+This might help with #27163, see comment 27 there.
 
 
 Comment: 1
```




---

archive/issue_comments_403537.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:25 charpent]:\n\n> What troubles me more is that ` make` didn't display any error when I recompiled without the proper `freetype` source tarball. It should have complained, no ?\n\n\nSage's dependencies resolution is far from ideal. The first thing I'd to to test a new package is to run `./sage -f <package_name>` followed by `make build`.",
    "created_at": "2019-01-30T12:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403537",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'></a>Replying to [comment:25 charpent]:

> What troubles me more is that ` make` didn't display any error when I recompiled without the proper `freetype` source tarball. It should have complained, no ?


Sage's dependencies resolution is far from ideal. The first thing I'd to to test a new package is to run `./sage -f <package_name>` followed by `make build`.



---

archive/issue_comments_403538.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-04T23:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27169#issuecomment-403538",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_067467.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-04T23:01:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27169",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27169#event-67467"
}
```
