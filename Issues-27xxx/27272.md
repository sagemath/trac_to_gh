# Issue 27272: spkg-configure.m4 for iml

archive/issues_027035.json:
```json
{
    "body": "iml only works with MP_LIBRARY provided in SAGE_LOCAL, at least this is the case on Debian 9.\n\nthey have a very old autoconf macro to detect GMP, which it particular won't work for libgmp in some arch-specfic location such as /usr/lib64/.\n \nThis breaks #27212. It works with GMP provided by the system if I just remove the call to their macro, re-run their bootstrap, repackage tarball. \n\n```\n--- a/configure.ac\n+++ b/configure.ac\n@@ -68,13 +68,6 @@ AC_CHECK_FUNCS(calloc floor)\n \n IML_VERBOSE_MODE\n IML_DEFAULT_PATH\n-IML_CHECK_GMP(,,[AC_MSG_ERROR(\n-GMP not found! \n-GMP version 3.1.1 or greater is required for this library to compile. \n-Please make sure GMP is installed and specify the header and libraries \n-location with the options --with-gmp-include=<path> and --with-gmp-lib=<path>\n-respectively when running configure.\n-)])\n \n IML_CHECK_CBLAS(,,[AC_MSG_WARN(\n CBLAS not found!\n```\n\nWhile we are at it, it makes sense to update iml to the latest version 1.0.5 (we are at 1.0.4).\n\nIt should also get spkg-configure.m4\n\ntarball: http://www.cs.uwaterloo.ca/~astorjoh/iml-1.0.5.tar.bz2\n\n\nCC:  @embray @orlitzky @mkoeppe @isuruf\n\nKeywords: spkg-configure, freebsd\n\nBranch/Commit: 5a34c90e99e7f2a5ac437b46965987d57852368e\n\nReviewer: Isuru Fernando\n\nAuthor: Dima Pasechnik\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27272\n\n",
    "closed_at": "2020-04-16T22:33:35Z",
    "created_at": "2019-02-13T14:06:34Z",
    "labels": [
        "component: build: configure",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "spkg-configure.m4 for iml",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27272",
    "user": "https://github.com/dimpase"
}
```
iml only works with MP_LIBRARY provided in SAGE_LOCAL, at least this is the case on Debian 9.

they have a very old autoconf macro to detect GMP, which it particular won't work for libgmp in some arch-specfic location such as /usr/lib64/.
 
This breaks #27212. It works with GMP provided by the system if I just remove the call to their macro, re-run their bootstrap, repackage tarball. 

```
--- a/configure.ac
+++ b/configure.ac
@@ -68,13 +68,6 @@ AC_CHECK_FUNCS(calloc floor)
 
 IML_VERBOSE_MODE
 IML_DEFAULT_PATH
-IML_CHECK_GMP(,,[AC_MSG_ERROR(
-GMP not found! 
-GMP version 3.1.1 or greater is required for this library to compile. 
-Please make sure GMP is installed and specify the header and libraries 
-location with the options --with-gmp-include=<path> and --with-gmp-lib=<path>
-respectively when running configure.
-)])
 
 IML_CHECK_CBLAS(,,[AC_MSG_WARN(
 CBLAS not found!
```

While we are at it, it makes sense to update iml to the latest version 1.0.5 (we are at 1.0.4).

It should also get spkg-configure.m4

tarball: http://www.cs.uwaterloo.ca/~astorjoh/iml-1.0.5.tar.bz2


CC:  @embray @orlitzky @mkoeppe @isuruf

Keywords: spkg-configure, freebsd

Branch/Commit: 5a34c90e99e7f2a5ac437b46965987d57852368e

Reviewer: Isuru Fernando

Author: Dima Pasechnik

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27272





---

archive/issue_comments_405517.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -25,6 +25,9 @@\n \n While we are at it, it makes sense to update iml to the latest version 1.0.5 (we are at 1.0.4).\n \n+It should also get spkg-configure.m4\n+\n+\n Comment: 1\n \n Component: packages: standard\n```\n",
    "created_at": "2019-02-13T17:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405517",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -25,6 +25,9 @@
 
 While we are at it, it makes sense to update iml to the latest version 1.0.5 (we are at 1.0.4).
 
+It should also get spkg-configure.m4
+
+
 Comment: 1
 
 Component: packages: standard
```




---

archive/issue_comments_405518.json:
```json
{
    "body": "Changing keywords from \"\" to \"spkg-configure\".",
    "created_at": "2019-02-13T17:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405518",
    "user": "https://github.com/dimpase"
}
```

Changing keywords from "" to "spkg-configure".



---

archive/issue_comments_405519.json:
```json
{
    "body": "<a id='comment:3'></a>The easiest fix would be to skip the iml's testing for MP_LIBRARY if we use the one from the system.\n\nBut how does one test for this? Is there a variable (provided by #27212) in the environment that can be tested?",
    "created_at": "2019-02-13T20:56:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405519",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>The easiest fix would be to skip the iml's testing for MP_LIBRARY if we use the one from the system.

But how does one test for this? Is there a variable (provided by #27212) in the environment that can be tested?



---

archive/issue_comments_405520.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,33 @@\n+iml only works with MP_LIBRARY provided in SAGE_LOCAL, at least this is the case on Debian 9.\n+\n+they have a very only autoconf macro to detect GMP, which it particular won't work for libgmp in some arch-specfic location such as /usr/lib64/.\n+ \n+This breaks #27212. It works with GMP provided by the system if I just remove the call to their macro, re-run their bootstrap, repackage tarball. \n+\n+```\n+--- a/configure.ac\n++++ b/configure.ac\n+@@ -68,13 +68,6 @@ AC_CHECK_FUNCS(calloc floor)\n+ \n+ IML_VERBOSE_MODE\n+ IML_DEFAULT_PATH\n+-IML_CHECK_GMP(,,[AC_MSG_ERROR(\n+-GMP not found! \n+-GMP version 3.1.1 or greater is required for this library to compile. \n+-Please make sure GMP is installed and specify the header and libraries \n+-location with the options --with-gmp-include=<path> and --with-gmp-lib=<path>\n+-respectively when running configure.\n+-)])\n+ \n+ IML_CHECK_CBLAS(,,[AC_MSG_WARN(\n+ CBLAS not found!\n+```\n+\n+While we are at it, it makes sense to update iml to the latest version 1.0.5 (we are at 1.0.4).\n+\n+It should also get spkg-configure.m4\n+\n+tarball: http://www.cs.uwaterloo.ca/~astorjoh/iml-1.0.5.tar.bz2\n \n \n Comment: 1\n```\n",
    "created_at": "2019-02-13T21:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405520",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,33 @@
+iml only works with MP_LIBRARY provided in SAGE_LOCAL, at least this is the case on Debian 9.
+
+they have a very only autoconf macro to detect GMP, which it particular won't work for libgmp in some arch-specfic location such as /usr/lib64/.
+ 
+This breaks #27212. It works with GMP provided by the system if I just remove the call to their macro, re-run their bootstrap, repackage tarball. 
+
+```
+--- a/configure.ac
++++ b/configure.ac
+@@ -68,13 +68,6 @@ AC_CHECK_FUNCS(calloc floor)
+ 
+ IML_VERBOSE_MODE
+ IML_DEFAULT_PATH
+-IML_CHECK_GMP(,,[AC_MSG_ERROR(
+-GMP not found! 
+-GMP version 3.1.1 or greater is required for this library to compile. 
+-Please make sure GMP is installed and specify the header and libraries 
+-location with the options --with-gmp-include=<path> and --with-gmp-lib=<path>
+-respectively when running configure.
+-)])
+ 
+ IML_CHECK_CBLAS(,,[AC_MSG_WARN(
+ CBLAS not found!
+```
+
+While we are at it, it makes sense to update iml to the latest version 1.0.5 (we are at 1.0.4).
+
+It should also get spkg-configure.m4
+
+tarball: http://www.cs.uwaterloo.ca/~astorjoh/iml-1.0.5.tar.bz2
 
 
 Comment: 1
```




---

archive/issue_comments_405521.json:
```json
{
    "body": "<a id='comment:5'></a>the patch I generate to conditionally disable checks for GMP is kind of big, as it's the result of autoreconf running... \n\n---\nNew commits:",
    "created_at": "2019-02-14T15:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405521",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>the patch I generate to conditionally disable checks for GMP is kind of big, as it's the result of autoreconf running... 

---
New commits:



---

archive/issue_comments_405522.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-02-14T15:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405522",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_405523.json:
```json
{
    "body": "<a id='comment:6'></a>spkg-configure.m4 has to wait until BLAS/LAPACK is sorted out",
    "created_at": "2019-02-14T15:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405523",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>spkg-configure.m4 has to wait until BLAS/LAPACK is sorted out



---

archive/issue_comments_405524.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-02-14T17:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405524",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_405525.json:
```json
{
    "body": "<a id='comment:7'></a>errors in linbox - one package that uses iml\n\n```\nsage -t --long --warn-long 84.1 src/sage/matrix/matrix_integer_dense.pyx  # 1 doctest failed\nsage -t --long --warn-long 84.1 src/sage/matrix/matrix_modn_sparse.pyx  # 1 doctest failed\nsage -t --long --warn-long 84.1 src/sage/matrix/matrix_integer_sparse.pyx  # 1 doctest failed\n```",
    "created_at": "2019-02-14T17:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405525",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>errors in linbox - one package that uses iml

```
sage -t --long --warn-long 84.1 src/sage/matrix/matrix_integer_dense.pyx  # 1 doctest failed
sage -t --long --warn-long 84.1 src/sage/matrix/matrix_modn_sparse.pyx  # 1 doctest failed
sage -t --long --warn-long 84.1 src/sage/matrix/matrix_integer_sparse.pyx  # 1 doctest failed
```



---

archive/issue_comments_405526.json:
```json
{
    "body": "<a id='comment:8'></a>this is the patch to be applied to the original imp directory, before\n`./bootstrap && autoreconf -ivf`:\n\n```diff\ndiff --git a/configure.ac b/configure.ac\nindex 2a1d666..d362f31 100644\n--- a/configure.ac\n+++ b/configure.ac\n@@ -68,6 +68,7 @@ AC_CHECK_FUNCS(calloc floor)\n \n IML_VERBOSE_MODE\n IML_DEFAULT_PATH\n+AS_IF([test \"x$SAGE_GMP_PREFIX\" = \"x$SAGE_LOCAL\"], [\n IML_CHECK_GMP(,,[AC_MSG_ERROR(\n GMP not found! \n GMP version 3.1.1 or greater is required for this library to compile. \n@@ -75,6 +76,7 @@ Please make sure GMP is installed and specify the header and libraries\n location with the options --with-gmp-include=<path> and --with-gmp-lib=<path>\n respectively when running configure.\n )])\n+])\n \n IML_CHECK_CBLAS(,,[AC_MSG_WARN(\n CBLAS not found!\n```",
    "created_at": "2019-02-14T18:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405526",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>this is the patch to be applied to the original imp directory, before
`./bootstrap && autoreconf -ivf`:

```diff
diff --git a/configure.ac b/configure.ac
index 2a1d666..d362f31 100644
--- a/configure.ac
+++ b/configure.ac
@@ -68,6 +68,7 @@ AC_CHECK_FUNCS(calloc floor)
 
 IML_VERBOSE_MODE
 IML_DEFAULT_PATH
+AS_IF([test "x$SAGE_GMP_PREFIX" = "x$SAGE_LOCAL"], [
 IML_CHECK_GMP(,,[AC_MSG_ERROR(
 GMP not found! 
 GMP version 3.1.1 or greater is required for this library to compile. 
@@ -75,6 +76,7 @@ Please make sure GMP is installed and specify the header and libraries
 location with the options --with-gmp-include=<path> and --with-gmp-lib=<path>
 respectively when running configure.
 )])
+])
 
 IML_CHECK_CBLAS(,,[AC_MSG_WARN(
 CBLAS not found!
```



---

archive/issue_comments_405527.json:
```json
{
    "body": "1.0.4 log - configure is run twice (sic!)",
    "created_at": "2019-02-14T23:59:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405527",
    "user": "https://github.com/dimpase"
}
```

1.0.4 log - configure is run twice (sic!)



---

archive/issue_comments_405528.json:
```json
{
    "body": "<a id='comment:9'></a>Attachment [iml-1.0.4p1.p2.log](tarball://root/attachments/some-uuid/ticket27272/iml-1.0.4p1.p2.log) by @dimpase created at 2019-02-15 00:03:04\n\nsee attachment for failed attempt to go back to the current Sage IML and doing the same patch there - configure is run twice, and the 2nd time it's invoked by make, with wrong parameters, leading to a failure in case of system GMP.",
    "created_at": "2019-02-15T00:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405528",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>Attachment [iml-1.0.4p1.p2.log](tarball://root/attachments/some-uuid/ticket27272/iml-1.0.4p1.p2.log) by @dimpase created at 2019-02-15 00:03:04

see attachment for failed attempt to go back to the current Sage IML and doing the same patch there - configure is run twice, and the 2nd time it's invoked by make, with wrong parameters, leading to a failure in case of system GMP.



---

archive/issue_comments_405529.json:
```json
{
    "body": "<a id='comment:10'></a>Pruned output of `make -d`:\n\n```\nUpdating makefiles....\n Considering target file 'Makefile'.\n   Considering target file 'Makefile.in'.\n     Considering target file 'aclocal.m4'.\n      Prerequisite 'config/libtool.m4' is newer than target 'aclocal.m4'.\n      Prerequisite 'config/ltoptions.m4' is newer than target 'aclocal.m4'.\n      Prerequisite 'config/ltsugar.m4' is newer than target 'aclocal.m4'.\n      Prerequisite 'config/ltversion.m4' is newer than target 'aclocal.m4'.\n      Prerequisite 'config/lt~obsolete.m4' is newer than target 'aclocal.m4'.\n     Must remake target 'aclocal.m4'.\nCDPATH=\"${ZSH_VERSION+.}:\" && cd . && /bin/bash /home/marc/tmp/iml-1.0.4p1/missing aclocal-1.16 -I config\n     Successfully remade target file 'aclocal.m4'.\n    Prerequisite 'aclocal.m4' is newer than target 'Makefile.in'.\n   Must remake target 'Makefile.in'.\n cd . && /bin/bash /home/marc/tmp/iml-1.0.4p1/missing automake-1.16 --gnu\n   Successfully remade target file 'Makefile.in'.\n   Considering target file 'config.status'.\n     Considering target file 'configure'.\n      Prerequisite 'aclocal.m4' is newer than target 'configure'.\n     Must remake target 'configure'.\nCDPATH=\"${ZSH_VERSION+.}:\" && cd . && /bin/bash /home/marc/tmp/iml-1.0.4p1/missing autoconf\n    Prerequisite 'configure' is newer than target 'config.status'.\n   Must remake target 'config.status'.\n/bin/bash ./config.status --recheck\nrunning CONFIG_SHELL=/bin/bash /bin/bash ./configure --no-create --no-recursion\n```",
    "created_at": "2019-02-15T08:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405529",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:10'></a>Pruned output of `make -d`:

```
Updating makefiles....
 Considering target file 'Makefile'.
   Considering target file 'Makefile.in'.
     Considering target file 'aclocal.m4'.
      Prerequisite 'config/libtool.m4' is newer than target 'aclocal.m4'.
      Prerequisite 'config/ltoptions.m4' is newer than target 'aclocal.m4'.
      Prerequisite 'config/ltsugar.m4' is newer than target 'aclocal.m4'.
      Prerequisite 'config/ltversion.m4' is newer than target 'aclocal.m4'.
      Prerequisite 'config/lt~obsolete.m4' is newer than target 'aclocal.m4'.
     Must remake target 'aclocal.m4'.
CDPATH="${ZSH_VERSION+.}:" && cd . && /bin/bash /home/marc/tmp/iml-1.0.4p1/missing aclocal-1.16 -I config
     Successfully remade target file 'aclocal.m4'.
    Prerequisite 'aclocal.m4' is newer than target 'Makefile.in'.
   Must remake target 'Makefile.in'.
 cd . && /bin/bash /home/marc/tmp/iml-1.0.4p1/missing automake-1.16 --gnu
   Successfully remade target file 'Makefile.in'.
   Considering target file 'config.status'.
     Considering target file 'configure'.
      Prerequisite 'aclocal.m4' is newer than target 'configure'.
     Must remake target 'configure'.
CDPATH="${ZSH_VERSION+.}:" && cd . && /bin/bash /home/marc/tmp/iml-1.0.4p1/missing autoconf
    Prerequisite 'configure' is newer than target 'config.status'.
   Must remake target 'config.status'.
/bin/bash ./config.status --recheck
running CONFIG_SHELL=/bin/bash /bin/bash ./configure --no-create --no-recursion
```



---

archive/issue_comments_405530.json:
```json
{
    "body": "<a id='comment:11'></a>So this has to do with timestamps being wrong. I have success with applying the patch in comment 8, followed by autoreconf -ivf, and packaging the result. Such a tarball does not trigger the 2nd run of configure.",
    "created_at": "2019-02-15T14:25:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405530",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>So this has to do with timestamps being wrong. I have success with applying the patch in comment 8, followed by autoreconf -ivf, and packaging the result. Such a tarball does not trigger the 2nd run of configure.



---

archive/issue_comments_405531.json:
```json
{
    "body": "<a id='comment:12'></a>I'm sort of confused by this patch.  Why are we patching even the INSTALL instructions?  Many of the files being patched here are also generated files that probably don't need to be patched so much, as they have nothing to do with the change you made to configure.ac.   Perhaps I can take a look at this more later tomorrow or something.",
    "created_at": "2019-02-18T17:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405531",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>I'm sort of confused by this patch.  Why are we patching even the INSTALL instructions?  Many of the files being patched here are also generated files that probably don't need to be patched so much, as they have nothing to do with the change you made to configure.ac.   Perhaps I can take a look at this more later tomorrow or something.



---

archive/issue_comments_405532.json:
```json
{
    "body": "<a id='comment:13'></a>So the problem I'm having with iml, at least on Debian, is simply the fact that for blas and for GMP it has some kind of overwrought non-standard macros for detecting them, that run into the same kinds of problems that led me to declare in the first place that I did *not* want to provide some mechanism to search for the exact path to the GMP shared object (as opposed to just trying `-lgmp` and seeing if it works as `AC_CHECK_LIB` and the like do).\n\nInstead, iml's autoconf macros (see e.g. `config/gmp-check.m4` in the iml source) really wants to check the full path for the header files and libraries, and check that those files exist at some specific path.  To do this it has a list of default prefixes it checks in (`/usr` and `/usr/local`), which in the Sage `spkg-install` we also prepend `$SAGE_LOCAL` to with `--with-default=$SAGE_LOCAL`.\n\nHowever, on Debian and Ubuntu which use a multiarch layout this fails: The default settings will not find the GMP headers and shared object under `/usr/include/x86_64-linux-gnu` and `/usr/lib/x86_64-linux-gnu` (for example) to use the system lib.\n\nI was able to get iml to build in Sage with the system GMP by configuring it like:\n\n```\n./configure --with-gmp-include=/usr/include/$(gcc -print-multiarch) \\\n            --with-gmp-lib=/usr/lib/$(gcc -print-multiarch) \\\n            --with-cblas=\"$(pkg-config --libs cblas)\" \\\n            --with-cblas-includes=\"$(pkg-config --cflags cblas)\"\n```\n\n(for BLAS just using pkg-config works fine).\n\nSo I think the best thing to do, while annoying, is to simply pass the correct `--with-gmp-include` and `--with-gmp-lib` flags for the platform we're building on.  Which kind of stinks because in principle those could take any possible value.  In practice, however, for most systems it will be in one of just a few places, and I have some more generic code elsewhere I can integrate here that will work for most platforms.\n\nIn other words, we need some custom code here that works similarly to what iml's `configure.ac` is doing, but checks in a wider range of locations, including multi-arch directories where they exist, then pass the correct values for these flags.",
    "created_at": "2019-02-18T18:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405532",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>So the problem I'm having with iml, at least on Debian, is simply the fact that for blas and for GMP it has some kind of overwrought non-standard macros for detecting them, that run into the same kinds of problems that led me to declare in the first place that I did *not* want to provide some mechanism to search for the exact path to the GMP shared object (as opposed to just trying `-lgmp` and seeing if it works as `AC_CHECK_LIB` and the like do).

Instead, iml's autoconf macros (see e.g. `config/gmp-check.m4` in the iml source) really wants to check the full path for the header files and libraries, and check that those files exist at some specific path.  To do this it has a list of default prefixes it checks in (`/usr` and `/usr/local`), which in the Sage `spkg-install` we also prepend `$SAGE_LOCAL` to with `--with-default=$SAGE_LOCAL`.

However, on Debian and Ubuntu which use a multiarch layout this fails: The default settings will not find the GMP headers and shared object under `/usr/include/x86_64-linux-gnu` and `/usr/lib/x86_64-linux-gnu` (for example) to use the system lib.

I was able to get iml to build in Sage with the system GMP by configuring it like:

```
./configure --with-gmp-include=/usr/include/$(gcc -print-multiarch) \
            --with-gmp-lib=/usr/lib/$(gcc -print-multiarch) \
            --with-cblas="$(pkg-config --libs cblas)" \
            --with-cblas-includes="$(pkg-config --cflags cblas)"
```

(for BLAS just using pkg-config works fine).

So I think the best thing to do, while annoying, is to simply pass the correct `--with-gmp-include` and `--with-gmp-lib` flags for the platform we're building on.  Which kind of stinks because in principle those could take any possible value.  In practice, however, for most systems it will be in one of just a few places, and I have some more generic code elsewhere I can integrate here that will work for most platforms.

In other words, we need some custom code here that works similarly to what iml's `configure.ac` is doing, but checks in a wider range of locations, including multi-arch directories where they exist, then pass the correct values for these flags.



---

archive/issue_comments_405533.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:12 embray]:\n> I'm sort of confused by this patch.  Why are we patching even the INSTALL instructions?  Many of the files being patched here are also generated files that probably don't need to be patched so much, as they have nothing to do with the change you made to configure.ac.   Perhaps I can take a look at this more later tomorrow or something.\n\n\nthis is what happens if you run autoreconf after editing configure.ac\n(perhaps using the matching autoconf version would lead to a smaller patch...)",
    "created_at": "2019-02-18T21:16:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405533",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>Replying to [comment:12 embray]:
> I'm sort of confused by this patch.  Why are we patching even the INSTALL instructions?  Many of the files being patched here are also generated files that probably don't need to be patched so much, as they have nothing to do with the change you made to configure.ac.   Perhaps I can take a look at this more later tomorrow or something.


this is what happens if you run autoreconf after editing configure.ac
(perhaps using the matching autoconf version would lead to a smaller patch...)



---

archive/issue_comments_405534.json:
```json
{
    "body": "<a id='comment:15'></a>Even the install instructions though?\n\nIn any case, I don't think anything needs to be patched here.  IML already has a mechanism for pointing to the correct GMP.  It's just a bit needlessly cumbersome, since there's no reason it *needs* to have the exact paths to the headers in order to just find that there is a `gmp.h` on the standard include paths (as something like `AC_CHECK_HEADERS` does).\n\nSo now we have the additional burden, at least when building iml against a system GMP, of grubbing around for the right system include path in the correct order, make sure `gmp.h` is in one of them, and return that path.  I think we can do this easily enough.  It's just an extra hassle.\n\nIf I'm reading the implementation of `IML_CHECK_GMP` correctly we only need to do this for the header too, since it literally reads `test -r \"${GMP_HEADER}/gmp.h\"` (where `GMP_HEADER` is something like `/usr/include`).",
    "created_at": "2019-02-19T15:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405534",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>Even the install instructions though?

In any case, I don't think anything needs to be patched here.  IML already has a mechanism for pointing to the correct GMP.  It's just a bit needlessly cumbersome, since there's no reason it *needs* to have the exact paths to the headers in order to just find that there is a `gmp.h` on the standard include paths (as something like `AC_CHECK_HEADERS` does).

So now we have the additional burden, at least when building iml against a system GMP, of grubbing around for the right system include path in the correct order, make sure `gmp.h` is in one of them, and return that path.  I think we can do this easily enough.  It's just an extra hassle.

If I'm reading the implementation of `IML_CHECK_GMP` correctly we only need to do this for the header too, since it literally reads `test -r "${GMP_HEADER}/gmp.h"` (where `GMP_HEADER` is something like `/usr/include`).



---

archive/issue_comments_405535.json:
```json
{
    "body": "<a id='comment:16'></a>Compiling a one-liner with `#include <gmp.h>` using `gcc -M` ought to produce the right include path. Not sure about clang.",
    "created_at": "2019-02-19T16:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405535",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>Compiling a one-liner with `#include <gmp.h>` using `gcc -M` ought to produce the right include path. Not sure about clang.



---

archive/issue_comments_405536.json:
```json
{
    "body": "<a id='comment:17'></a>I found a macro that does essentially this.  It should work for clang as well: http://git.savannah.gnu.org/gitweb/?p=autoconf-archive.git;a=blob_plain;f=m4/ax_absolute_header.m4\n\nI just experimented with it and it looks like it gets the job done.  I'm going to try it with iml now.",
    "created_at": "2019-02-19T16:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405536",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>I found a macro that does essentially this.  It should work for clang as well: http://git.savannah.gnu.org/gitweb/?p=autoconf-archive.git;a=blob_plain;f=m4/ax_absolute_header.m4

I just experimented with it and it looks like it gets the job done.  I'm going to try it with iml now.



---

archive/issue_comments_405537.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:15 embray]:\n> Even the install instructions though?\n> \n\nyep, it's one from autotools, and apparently it evolved...\n\n> In any case, I don't think anything needs to be patched here.  IML already has a mechanism for pointing to the correct GMP.  It's just a bit needlessly cumbersome, since there's no reason it *needs* to have the exact paths to the headers in order to just find that there is a `gmp.h` on the standard include paths (as something like `AC_CHECK_HEADERS` does).\n> \n> So now we have the additional burden, at least when building iml against a system GMP, of grubbing around for the right system include path in the correct order, make sure `gmp.h` is in one of them, and return that path.  I think we can do this easily enough.  It's just an extra hassle.\n> \n> If I'm reading the implementation of `IML_CHECK_GMP` correctly we only need to do this for the header too, since it literally reads `test -r \"${GMP_HEADER}/gmp.h\"` (where `GMP_HEADER` is something like `/usr/include`).\n\n\nI don't think that `IML_CHECK_GMP` will work if the compiler does not have `/usr/local/include` in its list of default paths, or the linker does not know about libs in `/usr/local/lib` without being supplied with the `-L` pointing there---something that might be the case on *BSD (and our favourite, OSX :-))\n\nIt might be easier just to replace it by something that works in all cases.",
    "created_at": "2019-02-19T21:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405537",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>Replying to [comment:15 embray]:
> Even the install instructions though?
> 

yep, it's one from autotools, and apparently it evolved...

> In any case, I don't think anything needs to be patched here.  IML already has a mechanism for pointing to the correct GMP.  It's just a bit needlessly cumbersome, since there's no reason it *needs* to have the exact paths to the headers in order to just find that there is a `gmp.h` on the standard include paths (as something like `AC_CHECK_HEADERS` does).
> 
> So now we have the additional burden, at least when building iml against a system GMP, of grubbing around for the right system include path in the correct order, make sure `gmp.h` is in one of them, and return that path.  I think we can do this easily enough.  It's just an extra hassle.
> 
> If I'm reading the implementation of `IML_CHECK_GMP` correctly we only need to do this for the header too, since it literally reads `test -r "${GMP_HEADER}/gmp.h"` (where `GMP_HEADER` is something like `/usr/include`).


I don't think that `IML_CHECK_GMP` will work if the compiler does not have `/usr/local/include` in its list of default paths, or the linker does not know about libs in `/usr/local/lib` without being supplied with the `-L` pointing there---something that might be the case on *BSD (and our favourite, OSX :-))

It might be easier just to replace it by something that works in all cases.



---

archive/issue_comments_405538.json:
```json
{
    "body": "<a id='comment:19'></a>I made this work (I think) as part of #27212.",
    "created_at": "2019-02-20T16:12:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405538",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'></a>I made this work (I think) as part of #27212.



---

archive/issue_comments_405539.json:
```json
{
    "body": "<a id='comment:20'></a>To be clear what I meant, on FreeBSD, where GMP lives in `/usr/local`,  to make IML's configure to pass GMP checks, I need to do\n\n```\nCC=\"cc -I/usr/local/include\" ./configure \n```\nas without setting `CC` this way  it fails with\n\n```\nDefault checking path = /usr /usr/local\nchecking for GMP >= 3.1.1... not found\nconfigure: error: GMP not found!\nGMP version 3.1.1 or greater is required for this library to compile.\nPlease make sure GMP is installed and specify the header and libraries\nlocation with the options --with-gmp-include=<path> and --with-gmp-lib=<path>\nrespectively when running configure.\n```\nNote that specifying `--with-gmp-include=/usr/local/include --with-gmp-lib=/usr/local/lib ` without setting `CC` as above fails just the same.\n\nThe reason is as I said: /usr/local/include is not in the default cc's path:\n\n```\n$ cat t.c\n#include <gmp.h>\n$ cc -c t.c                      # fails\nt.c:1:10: fatal error: 'gmp.h' file not found\n#include <gmp.h>\n         ^~~~~~~\n1 error generated.\n$ cc -I/usr/local/include -c t.c # OK\n```",
    "created_at": "2019-02-20T20:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405539",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>To be clear what I meant, on FreeBSD, where GMP lives in `/usr/local`,  to make IML's configure to pass GMP checks, I need to do

```
CC="cc -I/usr/local/include" ./configure 
```
as without setting `CC` this way  it fails with

```
Default checking path = /usr /usr/local
checking for GMP >= 3.1.1... not found
configure: error: GMP not found!
GMP version 3.1.1 or greater is required for this library to compile.
Please make sure GMP is installed and specify the header and libraries
location with the options --with-gmp-include=<path> and --with-gmp-lib=<path>
respectively when running configure.
```
Note that specifying `--with-gmp-include=/usr/local/include --with-gmp-lib=/usr/local/lib ` without setting `CC` as above fails just the same.

The reason is as I said: /usr/local/include is not in the default cc's path:

```
$ cat t.c
#include <gmp.h>
$ cc -c t.c                      # fails
t.c:1:10: fatal error: 'gmp.h' file not found
#include <gmp.h>
         ^~~~~~~
1 error generated.
$ cc -I/usr/local/include -c t.c # OK
```



---

archive/issue_comments_405540.json:
```json
{
    "body": "<a id='comment:21'></a>Up to this point you never said anything about FreeBSD on this ticket, only Debian 9.  That seems like a totally unrelated issue.\n\nThere does seem to be an annoyance in IML's configure that it just assumes `/usr/local/include` is on the compiler's default include path.  ISTM that could be resolved by passing it in `CFLAGS` and not overriding `CC` but I'm not sure.\n\nIn any case, that does not seem to be the issue you're describing in the ticket description.",
    "created_at": "2019-02-21T10:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405540",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>Up to this point you never said anything about FreeBSD on this ticket, only Debian 9.  That seems like a totally unrelated issue.

There does seem to be an annoyance in IML's configure that it just assumes `/usr/local/include` is on the compiler's default include path.  ISTM that could be resolved by passing it in `CFLAGS` and not overriding `CC` but I'm not sure.

In any case, that does not seem to be the issue you're describing in the ticket description.



---

archive/issue_comments_405541.json:
```json
{
    "body": "<a id='comment:22'></a>It is related to how exactly IML_CHECK_GMP is broken, but I am fine with dealing with this on another ticket.",
    "created_at": "2019-02-21T11:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405541",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>It is related to how exactly IML_CHECK_GMP is broken, but I am fine with dealing with this on another ticket.



---

archive/issue_comments_405542.json:
```json
{
    "body": "<a id='comment:23'></a>I agree that, as implemented, it's not good.\n\nWhy does GMP live in /usr/local though?",
    "created_at": "2019-02-21T11:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405542",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'></a>I agree that, as implemented, it's not good.

Why does GMP live in /usr/local though?



---

archive/issue_comments_405543.json:
```json
{
    "body": "<a id='comment:24'></a>that's a typical *BSD (and Solaris) thing, they keep extra packages in various places out of the main tree, see e.g. https://unix.stackexchange.com/questions/332764/role-of-the-usr-local-directory-in-freebsd",
    "created_at": "2019-02-21T19:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405543",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>that's a typical *BSD (and Solaris) thing, they keep extra packages in various places out of the main tree, see e.g. https://unix.stackexchange.com/questions/332764/role-of-the-usr-local-directory-in-freebsd



---

archive/issue_comments_405544.json:
```json
{
    "body": "<a id='comment:25'></a>OK, let's keep this on the wishlist. Ideally it's got to be fixed upstream.",
    "created_at": "2019-02-22T08:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405544",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'></a>OK, let's keep this on the wishlist. Ideally it's got to be fixed upstream.



---

archive/issue_events_067696.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-22T08:01:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27272#event-67696"
}
```



---

archive/issue_comments_405545.json:
```json
{
    "body": "Changing keywords from \"spkg-configure\" to \"spkg-configure, freebsd\".",
    "created_at": "2019-02-22T08:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405545",
    "user": "https://github.com/dimpase"
}
```

Changing keywords from "spkg-configure" to "spkg-configure, freebsd".



---

archive/issue_comments_405546.json:
```json
{
    "body": "<a id='comment:26'></a>In this case I'm still fine with applying a patch, but all it needs is a simple and generic patch to not just *assume* that `/usr/include` and `/usr/local/include` must be on the compiler's default include path.",
    "created_at": "2019-02-22T13:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405546",
    "user": "https://github.com/embray"
}
```

<a id='comment:26'></a>In this case I'm still fine with applying a patch, but all it needs is a simple and generic patch to not just *assume* that `/usr/include` and `/usr/local/include` must be on the compiler's default include path.



---

archive/issue_comments_405547.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,33 @@\n+iml only works with MP_LIBRARY provided in SAGE_LOCAL, at least this is the case on Debian 9.\n+\n+they have a very old autoconf macro to detect GMP, which it particular won't work for libgmp in some arch-specfic location such as /usr/lib64/.\n+ \n+This breaks #27212. It works with GMP provided by the system if I just remove the call to their macro, re-run their bootstrap, repackage tarball. \n+\n+```\n+--- a/configure.ac\n++++ b/configure.ac\n+@@ -68,13 +68,6 @@ AC_CHECK_FUNCS(calloc floor)\n+ \n+ IML_VERBOSE_MODE\n+ IML_DEFAULT_PATH\n+-IML_CHECK_GMP(,,[AC_MSG_ERROR(\n+-GMP not found! \n+-GMP version 3.1.1 or greater is required for this library to compile. \n+-Please make sure GMP is installed and specify the header and libraries \n+-location with the options --with-gmp-include=<path> and --with-gmp-lib=<path>\n+-respectively when running configure.\n+-)])\n+ \n+ IML_CHECK_CBLAS(,,[AC_MSG_WARN(\n+ CBLAS not found!\n+```\n+\n+While we are at it, it makes sense to update iml to the latest version 1.0.5 (we are at 1.0.4).\n+\n+It should also get spkg-configure.m4\n+\n+tarball: http://www.cs.uwaterloo.ca/~astorjoh/iml-1.0.5.tar.bz2\n \n \n Comment: 1\n```\n",
    "created_at": "2019-02-28T17:00:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405547",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,33 @@
+iml only works with MP_LIBRARY provided in SAGE_LOCAL, at least this is the case on Debian 9.
+
+they have a very old autoconf macro to detect GMP, which it particular won't work for libgmp in some arch-specfic location such as /usr/lib64/.
+ 
+This breaks #27212. It works with GMP provided by the system if I just remove the call to their macro, re-run their bootstrap, repackage tarball. 
+
+```
+--- a/configure.ac
++++ b/configure.ac
+@@ -68,13 +68,6 @@ AC_CHECK_FUNCS(calloc floor)
+ 
+ IML_VERBOSE_MODE
+ IML_DEFAULT_PATH
+-IML_CHECK_GMP(,,[AC_MSG_ERROR(
+-GMP not found! 
+-GMP version 3.1.1 or greater is required for this library to compile. 
+-Please make sure GMP is installed and specify the header and libraries 
+-location with the options --with-gmp-include=<path> and --with-gmp-lib=<path>
+-respectively when running configure.
+-)])
+ 
+ IML_CHECK_CBLAS(,,[AC_MSG_WARN(
+ CBLAS not found!
+```
+
+While we are at it, it makes sense to update iml to the latest version 1.0.5 (we are at 1.0.4).
+
+It should also get spkg-configure.m4
+
+tarball: http://www.cs.uwaterloo.ca/~astorjoh/iml-1.0.5.tar.bz2
 
 
 Comment: 1
```




---

archive/issue_comments_405548.json:
```json
{
    "body": "<a id='comment:28'></a>I talked to upstream, and they would be happy to get patches for that GMP business.",
    "created_at": "2020-03-04T00:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405548",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'></a>I talked to upstream, and they would be happy to get patches for that GMP business.



---

archive/issue_comments_405549.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-04-11T00:39:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405549",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_405550.json:
```json
{
    "body": "<a id='comment:29'></a>here is a simple spkg-configure, working on Debian buster (which has iml 1.0.4).\n\n---\nNew commits:",
    "created_at": "2020-04-11T00:39:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405550",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'></a>here is a simple spkg-configure, working on Debian buster (which has iml 1.0.4).

---
New commits:



---

archive/issue_events_067697.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-04-11T00:44:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27272#event-67697"
}
```



---

archive/issue_events_067698.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-04-11T00:44:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27272#event-67698"
}
```



---

archive/issue_comments_405551.json:
```json
{
    "body": "Changing component from packages: standard to build: configure.",
    "created_at": "2020-04-11T00:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405551",
    "user": "https://github.com/dimpase"
}
```

Changing component from packages: standard to build: configure.



---

archive/issue_comments_405552.json:
```json
{
    "body": "<a id='comment:31'></a>Works on Gentoo with `sci-libs/iml`. Is that `SAGE_IML_MINVER` doing anything?",
    "created_at": "2020-04-11T01:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405552",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:31'></a>Works on Gentoo with `sci-libs/iml`. Is that `SAGE_IML_MINVER` doing anything?



---

archive/issue_comments_405553.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-04-11T01:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405553",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_405554.json:
```json
{
    "body": "<a id='comment:32'></a>Needs distros/",
    "created_at": "2020-04-11T01:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405554",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>Needs distros/



---

archive/issue_comments_405555.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-11T13:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405555",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405556.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-11T14:02:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405556",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405557.json:
```json
{
    "body": "<a id='comment:35'></a>Addded the distro info I could find for iml. Note that both versions 1.0.4 and 1.0.5 appear to work with Sage just fine.",
    "created_at": "2020-04-11T14:05:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405557",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:35'></a>Addded the distro info I could find for iml. Note that both versions 1.0.4 and 1.0.5 appear to work with Sage just fine.



---

archive/issue_comments_405558.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-04-11T14:05:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405558",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_405559.json:
```json
{
    "body": "<a id='comment:36'></a>By the way, are you getting email notifications from trac?\nI don't get any since a day or two.",
    "created_at": "2020-04-11T14:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405559",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'></a>By the way, are you getting email notifications from trac?
I don't get any since a day or two.



---

archive/issue_comments_405560.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [comment:36 dimpase]:\n> By the way, are you getting email notifications from trac?\n> I don't get any since a day or two.\n\n\nThis has been an ongoing problem with SendGrid for as long as I can remember. They claim to retry 4xx errors for 72 hours, but they don't -- at least not in the cases where I get a phone call because some email from them went missing, which is often. I've attempted to whitelist their IP space on our servers, but identifying new IPs requires us to first miss a message from that IP. Anyone whose mail administrator enjoys whack-a-mole less than I do is likely to have even more problems.",
    "created_at": "2020-04-11T14:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405560",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:37'></a>Replying to [comment:36 dimpase]:
> By the way, are you getting email notifications from trac?
> I don't get any since a day or two.


This has been an ongoing problem with SendGrid for as long as I can remember. They claim to retry 4xx errors for 72 hours, but they don't -- at least not in the cases where I get a phone call because some email from them went missing, which is often. I've attempted to whitelist their IP space on our servers, but identifying new IPs requires us to first miss a message from that IP. Anyone whose mail administrator enjoys whack-a-mole less than I do is likely to have even more problems.



---

archive/issue_comments_405561.json:
```json
{
    "body": "<a id='comment:38'></a>I now no longer use an gmail address for trac notifications, and it started to work.\nPerhaps gmail started dropping SendGrid emails for me, as a special service, arrrgh...",
    "created_at": "2020-04-11T14:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405561",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:38'></a>I now no longer use an gmail address for trac notifications, and it started to work.
Perhaps gmail started dropping SendGrid emails for me, as a special service, arrrgh...



---

archive/issue_comments_405562.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-11T19:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405562",
    "user": "https://github.com/isuruf"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_405563.json:
```json
{
    "body": "<a id='comment:40'></a>Some of the SendGrid servers that  we *do* have whitelisted are on a bunch of blacklists, which may be why those messages went missing. If I hadn't given them an explicit pass, we would have rejected them too. Normally sending to gmail is pretty reliable, because if you can't send to gmail, you go out of business. But the downside is that when things go wrong at gmail you'll never find out why.",
    "created_at": "2020-04-11T21:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405563",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:40'></a>Some of the SendGrid servers that  we *do* have whitelisted are on a bunch of blacklists, which may be why those messages went missing. If I hadn't given them an explicit pass, we would have rejected them too. Normally sending to gmail is pretty reliable, because if you can't send to gmail, you go out of business. But the downside is that when things go wrong at gmail you'll never find out why.



---

archive/issue_comments_405564.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-16T22:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27272#issuecomment-405564",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_067699.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-16T22:33:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27272",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27272#event-67699"
}
```
