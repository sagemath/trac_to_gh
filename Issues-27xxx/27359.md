# Issue 27359: Test for sage_makedirs breaks Sage on Windows

archive/issues_027122.json:
```json
{
    "body": "#27196 modified a test for `sage_makedirs` to try to make a directory in place of the actual Python executable (`sys.executable`).\n\nThis test has a number of problems, not the least of which being that it will fail for permission reasons when run in a distro like Python.\n\nBut it actually breaks Sage on Windows because it *succeeds* in creating a directory called \"python2\" alongside the actual executable \"python2.exe\".\n\nI think the test itself is a bit silly since it's just testing standard functionality of the stdlib's `os.makedirs`, but if we want to keep it for example purposes I would rewrite it to actually use a temp file and not try to overwrite a real file used by the system.\n\nBranch/Commit: 87bc8177ff587434d61c05a4889e89aecdc29f74\n\nReviewer: Jeroen Demeyer\n\nAuthor: Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27359\n\n",
    "closed_at": "2019-03-13T18:29:37Z",
    "created_at": "2019-02-26T10:52:26Z",
    "labels": [
        "component: misc",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Test for sage_makedirs breaks Sage on Windows",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27359",
    "user": "https://github.com/embray"
}
```
#27196 modified a test for `sage_makedirs` to try to make a directory in place of the actual Python executable (`sys.executable`).

This test has a number of problems, not the least of which being that it will fail for permission reasons when run in a distro like Python.

But it actually breaks Sage on Windows because it *succeeds* in creating a directory called "python2" alongside the actual executable "python2.exe".

I think the test itself is a bit silly since it's just testing standard functionality of the stdlib's `os.makedirs`, but if we want to keep it for example purposes I would rewrite it to actually use a temp file and not try to overwrite a real file used by the system.

Branch/Commit: 87bc8177ff587434d61c05a4889e89aecdc29f74

Reviewer: Jeroen Demeyer

Author: Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27359





---

archive/issue_comments_520721.json:
```json
{
    "body": "Changing branch from \"\" to \"u/embray/ticket-27359\"",
    "created_at": "2019-02-26T11:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-520721",
    "user": "https://github.com/embray"
}
```

Changing branch from "" to "u/embray/ticket-27359"



---

archive/issue_comments_520722.json:
```json
{
    "body": "Changing commit from \"\" to \"a6bc173a66694b6c914932c7c5b15dacdf9309e1\"",
    "created_at": "2019-02-26T11:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-520722",
    "user": "https://github.com/embray"
}
```

Changing commit from "" to "a6bc173a66694b6c914932c7c5b15dacdf9309e1"



---

archive/issue_comments_520723.json:
```json
{
    "body": "<a id='comment:1'></a>\nStill confirming that the updated test works on Python 3, but I believe it will.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                   |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|\n|[a6bc173](https://github.com/sagemath/sagetrac-mirror/commit/a6bc173a66694b6c914932c7c5b15dacdf9309e1)|`Trac #27359: Rewrite this test to use a temp file instead of risk`|",
    "created_at": "2019-02-26T11:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-520723",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>
Still confirming that the updated test works on Python 3, but I believe it will.

---
New commits:
|                                                                                                                                          |                                                                   |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|
|[a6bc173](https://github.com/sagemath/sagetrac-mirror/commit/a6bc173a66694b6c914932c7c5b15dacdf9309e1)|`Trac #27359: Rewrite this test to use a temp file instead of risk`|



---

archive/issue_comments_520724.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-02-26T11:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-520724",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_520725.json:
```json
{
    "body": "Changing author from \"\" to \"Erik Bray\"",
    "created_at": "2019-02-26T11:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-520725",
    "user": "https://github.com/embray"
}
```

Changing author from "" to "Erik Bray"



---

archive/issue_comments_520726.json:
```json
{
    "body": "<a id='comment:2'></a>\n`tmp_filename()` already creates the file. There is no need to open and close it a second time.",
    "created_at": "2019-02-26T11:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-520726",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
`tmp_filename()` already creates the file. There is no need to open and close it a second time.



---

archive/issue_comments_520727.json:
```json
{
    "body": "Replying to [ticket:27359 embray]:\n> I think the test itself is a bit silly since it's just testing standard functionality of the stdlib's `os.makedirs`\n\n\nNot really, as `os.makedirs` fails if the directory already exists. (In Python 3, this was improved by adding support for an `exist_ok=True` flag)",
    "created_at": "2019-02-26T11:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-520727",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:27359 embray]:
> I think the test itself is a bit silly since it's just testing standard functionality of the stdlib's `os.makedirs`


Not really, as `os.makedirs` fails if the directory already exists. (In Python 3, this was improved by adding support for an `exist_ok=True` flag)



---

archive/issue_comments_520728.json:
```json
{
    "body": "<a id='comment:4'></a>\nConfirmed this passes for me on Python 3.",
    "created_at": "2019-02-26T12:10:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-520728",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>
Confirmed this passes for me on Python 3.



---

archive/issue_comments_520729.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [jdemeyer](#comment%3A2):\n> `tmp_filename()` already creates the file. There is no need to open and close it a second time.\n\n\nAh, so it does.  I'll just fix that real quick.",
    "created_at": "2019-02-26T12:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-520729",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>
Replying to [jdemeyer](#comment%3A2):
> `tmp_filename()` already creates the file. There is no need to open and close it a second time.


Ah, so it does.  I'll just fix that real quick.



---

archive/issue_comments_520730.json:
```json
{
    "body": "Changing commit from \"a6bc173a66694b6c914932c7c5b15dacdf9309e1\" to \"87bc8177ff587434d61c05a4889e89aecdc29f74\"",
    "created_at": "2019-02-26T12:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-520730",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a6bc173a66694b6c914932c7c5b15dacdf9309e1" to "87bc8177ff587434d61c05a4889e89aecdc29f74"



---

archive/issue_comments_520731.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|\n|[a971864](https://github.com/sagemath/sagetrac-mirror/commit/a971864aec5d477b02266c92a71be8e7fa1f53ff)|`Trac #27359: Rewrite this test to use a temp file instead of risk`|\n|[87bc817](https://github.com/sagemath/sagetrac-mirror/commit/87bc8177ff587434d61c05a4889e89aecdc29f74)|`trivial: change argument name in this function to not shadow the `dir` builtin`|",
    "created_at": "2019-02-26T12:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-520731",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------|
|[a971864](https://github.com/sagemath/sagetrac-mirror/commit/a971864aec5d477b02266c92a71be8e7fa1f53ff)|`Trac #27359: Rewrite this test to use a temp file instead of risk`|
|[87bc817](https://github.com/sagemath/sagetrac-mirror/commit/87bc8177ff587434d61c05a4889e89aecdc29f74)|`trivial: change argument name in this function to not shadow the `dir` builtin`|



---

archive/issue_comments_520732.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-11T11:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-520732",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_520733.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2019-03-11T11:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-520733",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_520734.json:
```json
{
    "body": "Changing branch from \"u/embray/ticket-27359\" to \"87bc8177ff587434d61c05a4889e89aecdc29f74\"",
    "created_at": "2019-03-13T18:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-520734",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/embray/ticket-27359" to "87bc8177ff587434d61c05a4889e89aecdc29f74"



---

archive/issue_events_084925.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-13T18:29:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27359#event-84925"
}
```



---

archive/issue_comments_520735.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-03-13T18:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-520735",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
