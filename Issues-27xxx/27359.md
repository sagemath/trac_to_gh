# Issue 27359: Test for sage_makedirs breaks Sage on Windows

archive/issues_027122.json:
```json
{
    "body": "#27196 modified a test for `sage_makedirs` to try to make a directory in place of the actual Python executable (`sys.executable`).\n\nThis test has a number of problems, not the least of which being that it will fail for permission reasons when run in a distro like Python.\n\nBut it actually breaks Sage on Windows because it *succeeds* in creating a directory called \"python2\" alongside the actual executable \"python2.exe\".\n\nI think the test itself is a bit silly since it's just testing standard functionality of the stdlib's `os.makedirs`, but if we want to keep it for example purposes I would rewrite it to actually use a temp file and not try to overwrite a real file used by the system.\n\nBranch/Commit: 87bc8177ff587434d61c05a4889e89aecdc29f74\n\nReviewer: Jeroen Demeyer\n\nAuthor: Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27359\n\n",
    "closed_at": "2019-03-13T18:29:37Z",
    "created_at": "2019-02-26T10:52:26Z",
    "labels": [
        "component: misc",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Test for sage_makedirs breaks Sage on Windows",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27359",
    "user": "https://github.com/embray"
}
```
#27196 modified a test for `sage_makedirs` to try to make a directory in place of the actual Python executable (`sys.executable`).

This test has a number of problems, not the least of which being that it will fail for permission reasons when run in a distro like Python.

But it actually breaks Sage on Windows because it *succeeds* in creating a directory called "python2" alongside the actual executable "python2.exe".

I think the test itself is a bit silly since it's just testing standard functionality of the stdlib's `os.makedirs`, but if we want to keep it for example purposes I would rewrite it to actually use a temp file and not try to overwrite a real file used by the system.

Branch/Commit: 87bc8177ff587434d61c05a4889e89aecdc29f74

Reviewer: Jeroen Demeyer

Author: Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27359





---

archive/issue_comments_527260.json:
```json
{
    "body": "Changing branch from \"\" to \"u/embray/ticket-27359\"",
    "created_at": "2019-02-26T11:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-527260",
    "user": "https://github.com/embray"
}
```

Changing branch from "" to "u/embray/ticket-27359"



---

archive/issue_comments_527261.json:
```json
{
    "body": "Changing commit from \"\" to \"a6bc173a66694b6c914932c7c5b15dacdf9309e1\"",
    "created_at": "2019-02-26T11:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-527261",
    "user": "https://github.com/embray"
}
```

Changing commit from "" to "a6bc173a66694b6c914932c7c5b15dacdf9309e1"



---

archive/issue_comments_527262.json:
```json
{
    "body": "<a id='comment:1'></a>Still confirming that the updated test works on Python 3, but I believe it will.\n\n---\nNew commits:",
    "created_at": "2019-02-26T11:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-527262",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>Still confirming that the updated test works on Python 3, but I believe it will.

---
New commits:



---

archive/issue_comments_527263.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-02-26T11:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-527263",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_527264.json:
```json
{
    "body": "Changing author from \"\" to \"Erik Bray\"",
    "created_at": "2019-02-26T11:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-527264",
    "user": "https://github.com/embray"
}
```

Changing author from "" to "Erik Bray"



---

archive/issue_comments_527265.json:
```json
{
    "body": "<a id='comment:2'></a>`tmp_filename()` already creates the file. There is no need to open and close it a second time.",
    "created_at": "2019-02-26T11:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-527265",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>`tmp_filename()` already creates the file. There is no need to open and close it a second time.



---

archive/issue_comments_527266.json:
```json
{
    "body": "Replying to [ticket:27359 embray]:\n> I think the test itself is a bit silly since it's just testing standard functionality of the stdlib's `os.makedirs`\n\n\nNot really, as `os.makedirs` fails if the directory already exists. (In Python 3, this was improved by adding support for an `exist_ok=True` flag)",
    "created_at": "2019-02-26T11:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-527266",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:27359 embray]:
> I think the test itself is a bit silly since it's just testing standard functionality of the stdlib's `os.makedirs`


Not really, as `os.makedirs` fails if the directory already exists. (In Python 3, this was improved by adding support for an `exist_ok=True` flag)



---

archive/issue_comments_527267.json:
```json
{
    "body": "<a id='comment:4'></a>Confirmed this passes for me on Python 3.",
    "created_at": "2019-02-26T12:10:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-527267",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>Confirmed this passes for me on Python 3.



---

archive/issue_comments_527268.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:2 jdemeyer]:\n> `tmp_filename()` already creates the file. There is no need to open and close it a second time.\n\n\nAh, so it does.  I'll just fix that real quick.",
    "created_at": "2019-02-26T12:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-527268",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>Replying to [comment:2 jdemeyer]:
> `tmp_filename()` already creates the file. There is no need to open and close it a second time.


Ah, so it does.  I'll just fix that real quick.



---

archive/issue_comments_527269.json:
```json
{
    "body": "Changing commit from \"a6bc173a66694b6c914932c7c5b15dacdf9309e1\" to \"87bc8177ff587434d61c05a4889e89aecdc29f74\"",
    "created_at": "2019-02-26T12:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-527269",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a6bc173a66694b6c914932c7c5b15dacdf9309e1" to "87bc8177ff587434d61c05a4889e89aecdc29f74"



---

archive/issue_comments_527270.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-26T12:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-527270",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_527271.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-11T11:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-527271",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_527272.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2019-03-11T11:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-527272",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_527273.json:
```json
{
    "body": "Changing branch from \"u/embray/ticket-27359\" to \"87bc8177ff587434d61c05a4889e89aecdc29f74\"",
    "created_at": "2019-03-13T18:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-527273",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/embray/ticket-27359" to "87bc8177ff587434d61c05a4889e89aecdc29f74"



---

archive/issue_events_067938.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-13T18:29:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27359#event-67938"
}
```



---

archive/issue_comments_527274.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-03-13T18:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27359#issuecomment-527274",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
