# Issue 27644: Sage Jupyter Kernel vs EIN (Emacs Jupyter Interface)

archive/issues_027407.json:
```json
{
    "body": "Sage's Jupyter Kernel doesn't work with EIN: \n\nhttps://github.com/millejoh/emacs-ipython-notebook/issues/466\n\nIt seems this is mainly down to the Sage kernel not declaring its language in the kernel spec. For example, this seems to do the trick:\n\n```diff\ndiff --git a/src/sage/repl/ipython_kernel/install.py b/src/sage/repl/ipython_kernel/install.py\nindex dc3dd6ed4a..1e03a1cf85 100644\n--- a/src/sage/repl/ipython_kernel/install.py\n+++ b/src/sage/repl/ipython_kernel/install.py\n@@ -212,6 +212,7 @@ class SageKernelSpec(object):\n         return dict(\n             argv=self._kernel_cmd(),\n             display_name=self._display_name,\n+            language=\"python\",\n         )\n \n     def _install_spec(self):\n```\n\nHowever, I have actually no idea how the whole architecture works. Thus, is thee above \"fix\" or workaround acceptable?\n\nCC:  @jdemeyer @slel zerline\n\nBranch/Commit: 0f73439980c33e5e482b9725de4766384648110b\n\nReviewer: Martin Albrecht\n\nAuthor: Odile B\u00e9nassy\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27644\n\n",
    "closed_at": "2019-05-17T11:45:22Z",
    "created_at": "2019-04-11T12:45:57Z",
    "labels": [
        "component: notebook",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Sage Jupyter Kernel vs EIN (Emacs Jupyter Interface)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27644",
    "user": "https://github.com/malb"
}
```
Sage's Jupyter Kernel doesn't work with EIN: 

https://github.com/millejoh/emacs-ipython-notebook/issues/466

It seems this is mainly down to the Sage kernel not declaring its language in the kernel spec. For example, this seems to do the trick:

```diff
diff --git a/src/sage/repl/ipython_kernel/install.py b/src/sage/repl/ipython_kernel/install.py
index dc3dd6ed4a..1e03a1cf85 100644
--- a/src/sage/repl/ipython_kernel/install.py
+++ b/src/sage/repl/ipython_kernel/install.py
@@ -212,6 +212,7 @@ class SageKernelSpec(object):
         return dict(
             argv=self._kernel_cmd(),
             display_name=self._display_name,
+            language="python",
         )
 
     def _install_spec(self):
```

However, I have actually no idea how the whole architecture works. Thus, is thee above "fix" or workaround acceptable?

CC:  @jdemeyer @slel zerline

Branch/Commit: 0f73439980c33e5e482b9725de4766384648110b

Reviewer: Martin Albrecht

Author: Odile Bénassy

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27644





---

archive/issue_comments_385985.json:
```json
{
    "body": "<a id='comment:2'></a>In effect the language is normally stated in the \"kernel.json\" specification file. For python3 for example:\n\n./local/share/jupyter/kernels/python3/kernel.json\n\n--%<\n\n\"display_name\": \"Python 3\",\n\n\"language\": \"python\"\n\n--%<\n\nand yes, apparently, the Sagemath kernel fails to do that",
    "created_at": "2019-04-15T11:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27644#issuecomment-385985",
    "user": "https://trac.sagemath.org/admin/accounts/users/zerline"
}
```

<a id='comment:2'></a>In effect the language is normally stated in the "kernel.json" specification file. For python3 for example:

./local/share/jupyter/kernels/python3/kernel.json

--%<

"display_name": "Python 3",

"language": "python"

--%<

and yes, apparently, the Sagemath kernel fails to do that



---

archive/issue_comments_385986.json:
```json
{
    "body": "<a id='comment:3'></a>According to [the docs on Kernel Specs](https://jupyter-client.readthedocs.io/en/stable/kernels.html#kernel-specs):\n\n> **language**: The name of the language of the kernel. When loading notebooks, if no matching kernelspec key (may differ across machines) is found, a kernel with a matching *language* will be used. This allows a notebook written on any Python or Julia kernel to be properly associated with the user\u2019s Python or Julia kernel, even if they aren\u2019t listed under the same name as the author\u2019s.\n\n\nTherefore this should probably be `language=\"sage\"` or something like that.  `language=\"python\"` would not be appropriate as a Sage kernel notebook does not have a good chance of working on a generic Python kernel.",
    "created_at": "2019-04-15T12:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27644#issuecomment-385986",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>According to [the docs on Kernel Specs](https://jupyter-client.readthedocs.io/en/stable/kernels.html#kernel-specs):

> **language**: The name of the language of the kernel. When loading notebooks, if no matching kernelspec key (may differ across machines) is found, a kernel with a matching *language* will be used. This allows a notebook written on any Python or Julia kernel to be properly associated with the user’s Python or Julia kernel, even if they aren’t listed under the same name as the author’s.


Therefore this should probably be `language="sage"` or something like that.  `language="python"` would not be appropriate as a Sage kernel notebook does not have a good chance of working on a generic Python kernel.



---

archive/issue_comments_385987.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-04-17T19:45:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27644#issuecomment-385987",
    "user": "https://trac.sagemath.org/admin/accounts/users/zerline"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_385988.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2019-04-17T19:45:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27644#issuecomment-385988",
    "user": "https://trac.sagemath.org/admin/accounts/users/zerline"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_385989.json:
```json
{
    "body": "<a id='comment:5'></a>This patch + the workaround (on the Emacs-side) suggested at https://github.com/millejoh/emacs-ipython-notebook/issues/466 does the trick for me.",
    "created_at": "2019-04-18T14:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27644#issuecomment-385989",
    "user": "https://github.com/malb"
}
```

<a id='comment:5'></a>This patch + the workaround (on the Emacs-side) suggested at https://github.com/millejoh/emacs-ipython-notebook/issues/466 does the trick for me.



---

archive/issue_comments_385990.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-04-18T14:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27644#issuecomment-385990",
    "user": "https://github.com/malb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_385991.json:
```json
{
    "body": "<a id='comment:6'></a>LGTM as well.  Let's see what the buildbots say.",
    "created_at": "2019-04-19T16:54:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27644#issuecomment-385991",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>LGTM as well.  Let's see what the buildbots say.



---

archive/issue_comments_385992.json:
```json
{
    "body": "<a id='comment:7'></a>Author name missing",
    "created_at": "2019-04-24T06:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27644#issuecomment-385992",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>Author name missing



---

archive/issue_comments_385993.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-04-24T11:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27644#issuecomment-385993",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_385994.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-05-10T13:28:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27644#issuecomment-385994",
    "user": "https://trac.sagemath.org/admin/accounts/users/zerline"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_385995.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-14T10:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27644#issuecomment-385995",
    "user": "https://github.com/malb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_068603.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-05-17T11:45:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27644",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27644#event-68603"
}
```



---

archive/issue_comments_385996.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-05-17T11:45:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27644",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27644#issuecomment-385996",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
