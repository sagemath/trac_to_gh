# Issue 27829: Mark some tests involving `long` using the `# py2` tag

archive/issues_027592.json:
```json
{
    "body": "Since `long` is not available in Python 3, we should mark tests involving it as for Python 2 only. This is part of #27696.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27829\n\n",
    "closed_at": "2020-08-17T18:36:51Z",
    "created_at": "2019-05-13T22:42:28Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Mark some tests involving `long` using the `# py2` tag",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27829",
    "user": "https://github.com/jhpalmieri"
}
```
Since `long` is not available in Python 3, we should mark tests involving it as for Python 2 only. This is part of #27696.


Issue created by migration from https://trac.sagemath.org/ticket/27829





---

archive/issue_comments_388957.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-05-13T22:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388957",
    "user": "https://github.com/jhpalmieri"
}
```

New commits:



---

archive/issue_comments_388958.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-13T22:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388958",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_388959.json:
```json
{
    "body": "There are a few cases I didn't know what to do with. In the following, I don't think `long(...)` adds much, so I think it's okay to make these changes. I have not yet done so. Opinions?\n\n```diff\ndiff --git a/src/sage/rings/complex_double.pyx b/src/sage/rings/complex_double.pyx\nindex ec43d0e199..21c9818780 100644\n--- a/src/sage/rings/complex_double.pyx\n+++ b/src/sage/rings/complex_double.pyx\n@@ -398,7 +398,7 @@ cdef class ComplexDoubleField_class(sage.rings.ring.Field):\n \n             sage: CDF(1) + RR(1)\n             2.0\n-            sage: CDF.0 - CC(1) - long(1) - RR(1) - QQbar(1)\n+            sage: CDF.0 - CC(1) - ZZ(1) - RR(1) - QQbar(1)\n             -4.0 + 1.0*I\n             sage: CDF.has_coerce_map_from(ComplexField(20))\n             False\ndiff --git a/src/sage/modules/free_module_element.pyx b/src/sage/modules/free_module_element.pyx\nindex 03d4d57a28..e069377806 100644\n--- a/src/sage/modules/free_module_element.pyx\n+++ b/src/sage/modules/free_module_element.pyx\n@@ -382,7 +382,7 @@ def vector(arg0, arg1=None, arg2=None, sparse=None):\n         (0, 1, 2, 3, 4, 5, 6, 7, 8, 9)\n         sage: v[3].parent()\n         Integer Ring\n-        sage: v = vector([float(23.4), int(2), complex(2+7*I), long(1)]); v\n+        sage: v = vector([float(23.4), int(2), complex(2+7*I), 1]); v\n         (23.4, 2.0, 2.0 + 7.0*I, 1.0)\n         sage: v[1].parent()\n         Complex Double Field\ndiff --git a/src/sage/rings/real_mpfr.pyx b/src/sage/rings/real_mpfr.pyx\nindex ae74119795..a579b5a575 100644\n--- a/src/sage/rings/real_mpfr.pyx\n+++ b/src/sage/rings/real_mpfr.pyx\n@@ -719,7 +719,7 @@ cdef class RealField_class(sage.rings.ring.Field):\n \n         TESTS::\n \n-            sage: 1.0 - ZZ(1) - int(1) - long(1) - QQ(1) - RealField(100)(1) - AA(1) - RLF(1)\n+            sage: 1.0 - ZZ(1) - int(1) - 1 - QQ(1) - RealField(100)(1) - AA(1) - RLF(1)\n             -6.00000000000000\n             sage: R = RR['x']   # Hold reference to avoid garbage collection, see Trac #24709\n             sage: R.get_action(ZZ)\n```",
    "created_at": "2019-05-13T22:52:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388959",
    "user": "https://github.com/jhpalmieri"
}
```

There are a few cases I didn't know what to do with. In the following, I don't think `long(...)` adds much, so I think it's okay to make these changes. I have not yet done so. Opinions?

```diff
diff --git a/src/sage/rings/complex_double.pyx b/src/sage/rings/complex_double.pyx
index ec43d0e199..21c9818780 100644
--- a/src/sage/rings/complex_double.pyx
+++ b/src/sage/rings/complex_double.pyx
@@ -398,7 +398,7 @@ cdef class ComplexDoubleField_class(sage.rings.ring.Field):
 
             sage: CDF(1) + RR(1)
             2.0
-            sage: CDF.0 - CC(1) - long(1) - RR(1) - QQbar(1)
+            sage: CDF.0 - CC(1) - ZZ(1) - RR(1) - QQbar(1)
             -4.0 + 1.0*I
             sage: CDF.has_coerce_map_from(ComplexField(20))
             False
diff --git a/src/sage/modules/free_module_element.pyx b/src/sage/modules/free_module_element.pyx
index 03d4d57a28..e069377806 100644
--- a/src/sage/modules/free_module_element.pyx
+++ b/src/sage/modules/free_module_element.pyx
@@ -382,7 +382,7 @@ def vector(arg0, arg1=None, arg2=None, sparse=None):
         (0, 1, 2, 3, 4, 5, 6, 7, 8, 9)
         sage: v[3].parent()
         Integer Ring
-        sage: v = vector([float(23.4), int(2), complex(2+7*I), long(1)]); v
+        sage: v = vector([float(23.4), int(2), complex(2+7*I), 1]); v
         (23.4, 2.0, 2.0 + 7.0*I, 1.0)
         sage: v[1].parent()
         Complex Double Field
diff --git a/src/sage/rings/real_mpfr.pyx b/src/sage/rings/real_mpfr.pyx
index ae74119795..a579b5a575 100644
--- a/src/sage/rings/real_mpfr.pyx
+++ b/src/sage/rings/real_mpfr.pyx
@@ -719,7 +719,7 @@ cdef class RealField_class(sage.rings.ring.Field):
 
         TESTS::
 
-            sage: 1.0 - ZZ(1) - int(1) - long(1) - QQ(1) - RealField(100)(1) - AA(1) - RLF(1)
+            sage: 1.0 - ZZ(1) - int(1) - 1 - QQ(1) - RealField(100)(1) - AA(1) - RLF(1)
             -6.00000000000000
             sage: R = RR['x']   # Hold reference to avoid garbage collection, see Trac #24709
             sage: R.get_action(ZZ)
```



---

archive/issue_comments_388960.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-05-15T20:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388960",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_388961.json:
```json
{
    "body": "I don't think that `# optional - fricas py2` works the way you think it does: you need `# py2` not `# optional - py2`.",
    "created_at": "2019-05-16T12:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388961",
    "user": "https://github.com/jdemeyer"
}
```

I don't think that `# optional - fricas py2` works the way you think it does: you need `# py2` not `# optional - py2`.



---

archive/issue_comments_388962.json:
```json
{
    "body": "For large numbers (which don't fit in a Python 2 `int` anyway), you can replace `long()` by `int()`, for example\n\n```\na = long(-901824309821093821093812093810928309183091832091)\n```\nbecomes\n\n```\na = int(-901824309821093821093812093810928309183091832091)\n```\n(unless the goal of the doctest is precisely testing `__long__` which is not the case here).",
    "created_at": "2019-05-16T12:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388962",
    "user": "https://github.com/jdemeyer"
}
```

For large numbers (which don't fit in a Python 2 `int` anyway), you can replace `long()` by `int()`, for example

```
a = long(-901824309821093821093812093810928309183091832091)
```
becomes

```
a = int(-901824309821093821093812093810928309183091832091)
```
(unless the goal of the doctest is precisely testing `__long__` which is not the case here).



---

archive/issue_comments_388963.json:
```json
{
    "body": "Replying to [comment:5 jdemeyer]:\n> I don't think that `# optional - fricas py2` works the way you think it does: you need `# py2` not `# optional - py2`.\n\n\nIt works exactly the way I think it does, I just made a mistake.",
    "created_at": "2019-05-16T15:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388963",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:5 jdemeyer]:
> I don't think that `# optional - fricas py2` works the way you think it does: you need `# py2` not `# optional - py2`.


It works exactly the way I think it does, I just made a mistake.



---

archive/issue_comments_388964.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-05-16T20:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388964",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_388965.json:
```json
{
    "body": "Any changes in #27826 are likely to affect this ticket, so marking as \"needs work\" until #27826 has stabilized.",
    "created_at": "2019-05-16T20:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388965",
    "user": "https://github.com/jhpalmieri"
}
```

Any changes in #27826 are likely to affect this ticket, so marking as "needs work" until #27826 has stabilized.



---

archive/issue_events_068987.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27829#event-68987"
}
```



---

archive/issue_comments_388966.json:
```json
{
    "body": "Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388966",
    "user": "https://github.com/embray"
}
```

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_comments_388967.json:
```json
{
    "body": "Surely these all have been fixed by now and this ticket can be closed?",
    "created_at": "2019-11-30T11:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388967",
    "user": "https://github.com/vbraun"
}
```

Surely these all have been fixed by now and this ticket can be closed?



---

archive/issue_comments_388968.json:
```json
{
    "body": "No, because we still have \n\n```\n    if six.PY2:\n        extra_globals = {}\n    else:\n        extra_globals = {'long': int}\n```\nin `doctest/forker.py`, so tests involving `long` can still pass with Python 3.\n\n#27826 should be resolved first, and then this ticket afterwards.",
    "created_at": "2019-11-30T17:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388968",
    "user": "https://github.com/jhpalmieri"
}
```

No, because we still have 

```
    if six.PY2:
        extra_globals = {}
    else:
        extra_globals = {'long': int}
```
in `doctest/forker.py`, so tests involving `long` can still pass with Python 3.

#27826 should be resolved first, and then this ticket afterwards.



---

archive/issue_events_068988.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27829#event-68988"
}
```



---

archive/issue_events_068989.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27829#event-68989"
}
```



---

archive/issue_comments_388969.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388969",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_events_068990.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T04:28:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27829#event-68990"
}
```



---

archive/issue_events_068991.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T04:28:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27829#event-68991"
}
```



---

archive/issue_comments_388970.json:
```json
{
    "body": "Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.",
    "created_at": "2020-05-01T04:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388970",
    "user": "https://github.com/mkoeppe"
}
```

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.



---

archive/issue_comments_388971.json:
```json
{
    "body": "Replying to [comment:11 jhpalmieri]:\n> #27826 should be resolved first, and then this ticket afterwards.\n\nThis has happened",
    "created_at": "2020-07-19T05:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388971",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:11 jhpalmieri]:
> #27826 should be resolved first, and then this ticket afterwards.

This has happened



---

archive/issue_comments_388972.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-07-19T19:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388972",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_068992.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-07-19T19:06:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27829#event-68992"
}
```



---

archive/issue_events_068993.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-07-19T19:06:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27829#event-68993"
}
```



---

archive/issue_comments_388973.json:
```json
{
    "body": "I think we can close this as invalid now that we don't build Python 2 anymore.",
    "created_at": "2020-07-19T19:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388973",
    "user": "https://github.com/jhpalmieri"
}
```

I think we can close this as invalid now that we don't build Python 2 anymore.



---

archive/issue_comments_388974.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-20T02:06:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388974",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_388975.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2020-08-17T18:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27829#issuecomment-388975",
    "user": "https://github.com/fchapoton"
}
```

Resolution: invalid



---

archive/issue_events_068994.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-08-17T18:36:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27829",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27829#event-68994"
}
```
