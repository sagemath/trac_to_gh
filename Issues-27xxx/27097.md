# Issue 27097: Remove IndexedFreeModuleElement._coefficient_fast

archive/issues_026860.json:
```json
{
    "body": "The method `IndexedFreeModuleElement._coefficient_fast` serves no purpose at all:\n\n1. It actually makes `__getitem__` slower because of the extra indirection.\n\n2. Special methods like `__getitem__` in extension classes are very fast already, as fast as Cython `cdef` functions.\n\n3. When called from Python (not Cython), a special method is much faster than a method.\n\n4. It is called in only one place (namely `__getitem__`), so even if it would be faster, its usage is dubious.\n\nSince this is a private underscored method, we can just remove it without deprecation.\n\nFurthermore, the implementation of `__getitem__` can be improved by only computing `self.base_ring().zero()` if needed.\n\nFinally, in the category `ModulesWithBasis`, I am also removing `ElementMethods.__getitem__` because it doesn't seem to be used anywhere (to be checked by the patchbot).\n\nCC:  @tscrim\n\nBranch/Commit: e4e1434f5682b10248c914d10a697f668694df77\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27097\n\n",
    "closed_at": "2019-01-26T15:53:40Z",
    "created_at": "2019-01-23T14:27:55Z",
    "labels": [
        "component: performance"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Remove IndexedFreeModuleElement._coefficient_fast",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27097",
    "user": "https://github.com/jdemeyer"
}
```
The method `IndexedFreeModuleElement._coefficient_fast` serves no purpose at all:

1. It actually makes `__getitem__` slower because of the extra indirection.

2. Special methods like `__getitem__` in extension classes are very fast already, as fast as Cython `cdef` functions.

3. When called from Python (not Cython), a special method is much faster than a method.

4. It is called in only one place (namely `__getitem__`), so even if it would be faster, its usage is dubious.

Since this is a private underscored method, we can just remove it without deprecation.

Furthermore, the implementation of `__getitem__` can be improved by only computing `self.base_ring().zero()` if needed.

Finally, in the category `ModulesWithBasis`, I am also removing `ElementMethods.__getitem__` because it doesn't seem to be used anywhere (to be checked by the patchbot).

CC:  @tscrim

Branch/Commit: e4e1434f5682b10248c914d10a697f668694df77

Reviewer: Travis Scrimshaw

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27097





---

archive/issue_comments_402345.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,8 @@\n \n 3. When called from Python (not Cython), a special method is much faster than a method.\n \n+Since this is a private underscored method, we can just remove it without deprecation.\n+\n Author: Jeroen Demeyer\n \n Comment: 1\n``````\n",
    "created_at": "2019-01-23T14:28:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27097#issuecomment-402345",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,8 @@
 
 3. When called from Python (not Cython), a special method is much faster than a method.
 
+Since this is a private underscored method, we can just remove it without deprecation.
+
 Author: Jeroen Demeyer
 
 Comment: 1
``````




---

archive/issue_comments_402346.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,14 @@\n+The method `_coefficient_fast` serves no purpose at all:\n \n+1. It actually makes `__getitem__` slower because of the extra indirection.\n+\n+2. Special methods in extension classes are very fast already, as fast as a Cython `cdef` function.\n+\n+3. When called from Python (not Cython), a special method is much faster than a method.\n+\n+4. It is called in only one place (namely `__getitem__`), so even if it would be faster, its usage is dubious.\n+\n+Since this is a private underscored method, we can just remove it without deprecation.\n \n Author: Jeroen Demeyer\n \n``````\n",
    "created_at": "2019-01-23T14:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27097#issuecomment-402346",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,14 @@
+The method `_coefficient_fast` serves no purpose at all:
 
+1. It actually makes `__getitem__` slower because of the extra indirection.
+
+2. Special methods in extension classes are very fast already, as fast as a Cython `cdef` function.
+
+3. When called from Python (not Cython), a special method is much faster than a method.
+
+4. It is called in only one place (namely `__getitem__`), so even if it would be faster, its usage is dubious.
+
+Since this is a private underscored method, we can just remove it without deprecation.
 
 Author: Jeroen Demeyer
 
``````




---

archive/issue_comments_402347.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2019-01-23T14:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27097#issuecomment-402347",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_402348.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-01-23T14:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27097#issuecomment-402348",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_402349.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,16 @@\n+The method `IndexedFreeModuleElement._coefficient_fast` serves no purpose at all:\n \n+1. It actually makes `__getitem__` slower because of the extra indirection.\n+\n+2. Special methods like `__getitem__` in extension classes are very fast already, as fast as a Cython `cdef` functions.\n+\n+3. When called from Python (not Cython), a special method is much faster than a method.\n+\n+4. It is called in only one place (namely `__getitem__`), so even if it would be faster, its usage is dubious.\n+\n+Since this is a private underscored method, we can just remove it without deprecation.\n+\n+In the category `ModulesWithBasis`, I am also removing `ElementMethods.__getitem__` because it doesn't seem to be used anywhere (to be checked by the patchbot).\n \n Author: Jeroen Demeyer\n \n``````\n",
    "created_at": "2019-01-23T14:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27097#issuecomment-402349",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,16 @@
+The method `IndexedFreeModuleElement._coefficient_fast` serves no purpose at all:
 
+1. It actually makes `__getitem__` slower because of the extra indirection.
+
+2. Special methods like `__getitem__` in extension classes are very fast already, as fast as a Cython `cdef` functions.
+
+3. When called from Python (not Cython), a special method is much faster than a method.
+
+4. It is called in only one place (namely `__getitem__`), so even if it would be faster, its usage is dubious.
+
+Since this is a private underscored method, we can just remove it without deprecation.
+
+In the category `ModulesWithBasis`, I am also removing `ElementMethods.__getitem__` because it doesn't seem to be used anywhere (to be checked by the patchbot).
 
 Author: Jeroen Demeyer
 
``````




---

archive/issue_comments_402350.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,18 @@\n+The method `IndexedFreeModuleElement._coefficient_fast` serves no purpose at all:\n \n+1. It actually makes `__getitem__` slower because of the extra indirection.\n+\n+2. Special methods like `__getitem__` in extension classes are very fast already, as fast as Cython `cdef` functions.\n+\n+3. When called from Python (not Cython), a special method is much faster than a method.\n+\n+4. It is called in only one place (namely `__getitem__`), so even if it would be faster, its usage is dubious.\n+\n+Since this is a private underscored method, we can just remove it without deprecation.\n+\n+Furthermore, the implementation of `__getitem__` can be improved by only computing `self.base_ring().zero()` if needed.\n+\n+Finally, in the category `ModulesWithBasis`, I am also removing `ElementMethods.__getitem__` because it doesn't seem to be used anywhere (to be checked by the patchbot).\n \n Author: Jeroen Demeyer\n \n``````\n",
    "created_at": "2019-01-23T15:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27097#issuecomment-402350",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,18 @@
+The method `IndexedFreeModuleElement._coefficient_fast` serves no purpose at all:
 
+1. It actually makes `__getitem__` slower because of the extra indirection.
+
+2. Special methods like `__getitem__` in extension classes are very fast already, as fast as Cython `cdef` functions.
+
+3. When called from Python (not Cython), a special method is much faster than a method.
+
+4. It is called in only one place (namely `__getitem__`), so even if it would be faster, its usage is dubious.
+
+Since this is a private underscored method, we can just remove it without deprecation.
+
+Furthermore, the implementation of `__getitem__` can be improved by only computing `self.base_ring().zero()` if needed.
+
+Finally, in the category `ModulesWithBasis`, I am also removing `ElementMethods.__getitem__` because it doesn't seem to be used anywhere (to be checked by the patchbot).
 
 Author: Jeroen Demeyer
 
``````




---

archive/issue_comments_402351.json:
```json
{
    "body": "<a id='comment:6'></a>Everything is fine with me except for removing the `__getitem__` from `ModulesWithBasis`. It is used by the elements of `DifferentialWeylAlgebra` (although it is not practically so useful because of the index set of the basis). Moreover, it is something that could be used in the wild by something in `ModulesWithBasis` that is not a subclass of `IndexedFreeModuleElement`. So -1 on removing it.",
    "created_at": "2019-01-23T17:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27097#issuecomment-402351",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>Everything is fine with me except for removing the `__getitem__` from `ModulesWithBasis`. It is used by the elements of `DifferentialWeylAlgebra` (although it is not practically so useful because of the index set of the basis). Moreover, it is something that could be used in the wild by something in `ModulesWithBasis` that is not a subclass of `IndexedFreeModuleElement`. So -1 on removing it.



---

archive/issue_comments_402352.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 tscrim]:\n> Everything is fine with me except for removing the `__getitem__` from `ModulesWithBasis`. It is used by the elements of `DifferentialWeylAlgebra`\n\n\nRemoving it doesn't cause any doctest failures (see patchbot). If we keep it, there should at least be one doctest that relies on it (i.e. that would break if we remove this). Could you come up with such a test?",
    "created_at": "2019-01-23T20:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27097#issuecomment-402352",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Replying to [comment:6 tscrim]:
> Everything is fine with me except for removing the `__getitem__` from `ModulesWithBasis`. It is used by the elements of `DifferentialWeylAlgebra`


Removing it doesn't cause any doctest failures (see patchbot). If we keep it, there should at least be one doctest that relies on it (i.e. that would break if we remove this). Could you come up with such a test?



---

archive/issue_comments_402353.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 jdemeyer]:\n> Replying to [comment:6 tscrim]:\n> > Everything is fine with me except for removing the `__getitem__` from `ModulesWithBasis`. It is used by the elements of `DifferentialWeylAlgebra`\n\n> \n> Removing it doesn't cause any doctest failures (see patchbot). If we keep it, there should at least be one doctest that relies on it (i.e. that would break if we remove this). Could you come up with such a test?\n\n\nThis should do it:\n\n```\nsage: W.<x,y,z> = DifferentialWeylAlgebra(QQ)\nsage: x[((1,0,0),(0,0,0))]\n1\n```",
    "created_at": "2019-01-23T20:10:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27097#issuecomment-402353",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>Replying to [comment:7 jdemeyer]:
> Replying to [comment:6 tscrim]:
> > Everything is fine with me except for removing the `__getitem__` from `ModulesWithBasis`. It is used by the elements of `DifferentialWeylAlgebra`

> 
> Removing it doesn't cause any doctest failures (see patchbot). If we keep it, there should at least be one doctest that relies on it (i.e. that would break if we remove this). Could you come up with such a test?


This should do it:

```
sage: W.<x,y,z> = DifferentialWeylAlgebra(QQ)
sage: x[((1,0,0),(0,0,0))]
1
```



---

archive/issue_comments_402354.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-23T20:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27097#issuecomment-402354",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_402355.json:
```json
{
    "body": "<a id='comment:10'></a>Done, needs review again.",
    "created_at": "2019-01-23T20:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27097#issuecomment-402355",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>Done, needs review again.



---

archive/issue_comments_402356.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-23T21:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27097#issuecomment-402356",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_402357.json:
```json
{
    "body": "<a id='comment:11'></a>Thank you. LGTM.",
    "created_at": "2019-01-23T21:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27097#issuecomment-402357",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>Thank you. LGTM.



---

archive/issue_events_067328.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-26T15:53:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27097",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27097#event-67328"
}
```



---

archive/issue_comments_402358.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-01-26T15:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27097#issuecomment-402358",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
