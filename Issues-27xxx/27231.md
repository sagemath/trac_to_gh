# Issue 27231: Interface nauty's directg command with sage

archive/issues_026994.json:
```json
{
    "body": "Allow to call nauty's directg command from sage.\\\\\n\nThis is implemented as a `DiGraph` generator (file: `digraph_generators.py`).\n\nNote to reviewers: Any idea for useful examples in documentation is welcome.\n\nCC:  @dcoudert @videlec\n\nKeywords: thursdaysbdx\n\nReviewer: David Coudert\n\nAuthor: Vincent Klein\n\nBranch: ccc2cd321eb0f774276d22d0de4434249732a0b6\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27231\n\n",
    "closed_at": "2019-02-13T20:56:28Z",
    "created_at": "2019-02-07T10:14:33Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Interface nauty's directg command with sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27231",
    "user": "https://github.com/vinklein"
}
```
Allow to call nauty's directg command from sage.\\

This is implemented as a `DiGraph` generator (file: `digraph_generators.py`).

Note to reviewers: Any idea for useful examples in documentation is welcome.

CC:  @dcoudert @videlec

Keywords: thursdaysbdx

Reviewer: David Coudert

Author: Vincent Klein

Branch: ccc2cd321eb0f774276d22d0de4434249732a0b6

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27231





---

archive/issue_comments_524301.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vklein/27231\"",
    "created_at": "2019-02-07T10:22:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524301",
    "user": "https://github.com/vinklein"
}
```

Changing branch from "" to "u/vklein/27231"



---

archive/issue_comments_524302.json:
```json
{
    "body": "Changing commit from \"\" to \"a538ebcfa229bd2f2a689e3b58add3002905d190\"",
    "created_at": "2019-02-07T10:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524302",
    "user": "https://github.com/vinklein"
}
```

Changing commit from "" to "a538ebcfa229bd2f2a689e3b58add3002905d190"



---

archive/issue_comments_524303.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n Allow to call nauty's directg command from sage.\\\\\n \n-This is implemented as a `DiGraph` generator (file: `digraph_generators.py`)\n+This is implemented as a `DiGraph` generator (file: `digraph_generators.py`).\n+\n+Note to reviewers: Any idea for useful examples in documentation is welcome.\n``````\n",
    "created_at": "2019-02-07T10:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524303",
    "user": "https://github.com/vinklein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 Allow to call nauty's directg command from sage.\\
 
-This is implemented as a `DiGraph` generator (file: `digraph_generators.py`)
+This is implemented as a `DiGraph` generator (file: `digraph_generators.py`).
+
+Note to reviewers: Any idea for useful examples in documentation is welcome.
``````




---

archive/issue_comments_524304.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2019-02-07T10:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524304",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_524305.json:
```json
{
    "body": "Changing commit from \"a538ebcfa229bd2f2a689e3b58add3002905d190\" to \"90b6be75191f286a326f9e49ecc60f5acf6c9c75\"",
    "created_at": "2019-02-07T10:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524305",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a538ebcfa229bd2f2a689e3b58add3002905d190" to "90b6be75191f286a326f9e49ecc60f5acf6c9c75"



---

archive/issue_comments_524306.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-07T10:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524306",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_524307.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-02-07T11:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524307",
    "user": "https://github.com/vinklein"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_524308.json:
```json
{
    "body": "<a id='comment:5'></a>This is a nice addition. Thank you. Below are some comments.\n\n\n* You are not returning a list but an iterator.\n\n```diff\n-        Returns a list which creates digraphs from nauty's directg program.\n+        Return an iterator yielding digraphs using nauty's ``directg`` program.\n```\n\n\n* Could you document the role of parameter `graphs`. It is not completely obvious.\n\n* \n\n```diff\n-        - ``graphs`` (iterable) -- A :class:`Graph` or an iterable containing\n-          :class:`Graph`.\n+        - ``graphs`` -- a :class:`Graph` or an iterable containing :class:`Graph`\n```\n* Also, add an empty line between parameters.\n\n* As for `graphs.nauty_geng`, you could add parameter `debug`. \n\n* I don't know which is best between the loop `for l in out.split('\\n'):` and the `while` loop of  `graphs.nauty_geng`. Are the programs different ?\n\n\n* \n\n```diff\n-            if l != '' and l[0] == '&':\n+            if l and l[0] == '&':\n```\n\n\n* Have you tried `watercluster2` ? according to the documentation of nauty http://pallini.di.uniroma1.it/nug26.pdf, it is a faster alternative to `directg`.\n\n\n* `directg` and `watercluster2` generate all possible orientations of the input graphs, include both directions. Currently, we have a tools for iterating over all possible orientations of a graph:\n  - `orientations` return an iterator over orientations\n  - `strong_orientations_iterator` return an iterator over all strong orientations of a graph `G`\n  You can add a test to show that 1) `directg/watercluster2` generates more graphs than what we get with `orientations`,  and 2) that each digraph obtained with `orientations` is in the set of digraphs obtained with `directg`.",
    "created_at": "2019-02-07T14:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524308",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:5'></a>This is a nice addition. Thank you. Below are some comments.


* You are not returning a list but an iterator.

```diff
-        Returns a list which creates digraphs from nauty's directg program.
+        Return an iterator yielding digraphs using nauty's ``directg`` program.
```


* Could you document the role of parameter `graphs`. It is not completely obvious.

* 

```diff
-        - ``graphs`` (iterable) -- A :class:`Graph` or an iterable containing
-          :class:`Graph`.
+        - ``graphs`` -- a :class:`Graph` or an iterable containing :class:`Graph`
```
* Also, add an empty line between parameters.

* As for `graphs.nauty_geng`, you could add parameter `debug`. 

* I don't know which is best between the loop `for l in out.split('\n'):` and the `while` loop of  `graphs.nauty_geng`. Are the programs different ?


* 

```diff
-            if l != '' and l[0] == '&':
+            if l and l[0] == '&':
```


* Have you tried `watercluster2` ? according to the documentation of nauty http://pallini.di.uniroma1.it/nug26.pdf, it is a faster alternative to `directg`.


* `directg` and `watercluster2` generate all possible orientations of the input graphs, include both directions. Currently, we have a tools for iterating over all possible orientations of a graph:
  - `orientations` return an iterator over orientations
  - `strong_orientations_iterator` return an iterator over all strong orientations of a graph `G`
  You can add a test to show that 1) `directg/watercluster2` generates more graphs than what we get with `orientations`,  and 2) that each digraph obtained with `orientations` is in the set of digraphs obtained with `directg`.



---

archive/issue_comments_524309.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 dcoudert]:\n> This is a nice addition. Thank you. Below are some comments.\n> \n> \n> * You are not returning a list but an iterator.\n> \n> ```diff\n> -        Returns a list which creates digraphs from nauty's directg program.\n> +        Return an iterator yielding digraphs using nauty's ``directg`` program.\n> ```\n\n\\\\\n\nYes my mistake ! It's a generator to be accurate. My first version used to return a list. \\\\\nThanks for noticing that.\n\n> \n> * I don't know which is best between the loop `for l in out.split('\\n'):` and the `while` loop of  `graphs.nauty_geng`. Are the programs different ?\n> \\\\\n\n\n\nThe impacting difference between `geng` and `directg` is that `directg` need an input file and `geng` work with command parameter only. \\\\\n\nThat's why i use `Popen.communicate` as it allow to give an input \"file\" to `directg`\n\nThe drawback is, if i am right, that with communicate reading stdout is in one go where we can read line by line for `geng`. I will try a line by line read with the communicate output, just in case i am wrong.\\\\\n\n> \n> * Have you tried `watercluster2` ? according to the documentation of nauty http://pallini.di.uniroma1.it/nug26.pdf, it is a faster alternative to `directg`.\\\\\n\n\nNo i was unaware of that. \nI implemented this ticket for a sage user needing `directg`. I will look at `watercluster2` and modify my ticket with it if it works well.\\\\\n\nThanks for your comments.",
    "created_at": "2019-02-07T14:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524309",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:6'></a>Replying to [comment:5 dcoudert]:
> This is a nice addition. Thank you. Below are some comments.
> 
> 
> * You are not returning a list but an iterator.
> 
> ```diff
> -        Returns a list which creates digraphs from nauty's directg program.
> +        Return an iterator yielding digraphs using nauty's ``directg`` program.
> ```

\\

Yes my mistake ! It's a generator to be accurate. My first version used to return a list. \\
Thanks for noticing that.

> 
> * I don't know which is best between the loop `for l in out.split('\n'):` and the `while` loop of  `graphs.nauty_geng`. Are the programs different ?
> \\



The impacting difference between `geng` and `directg` is that `directg` need an input file and `geng` work with command parameter only. \\

That's why i use `Popen.communicate` as it allow to give an input "file" to `directg`

The drawback is, if i am right, that with communicate reading stdout is in one go where we can read line by line for `geng`. I will try a line by line read with the communicate output, just in case i am wrong.\\

> 
> * Have you tried `watercluster2` ? according to the documentation of nauty http://pallini.di.uniroma1.it/nug26.pdf, it is a faster alternative to `directg`.\\


No i was unaware of that. 
I implemented this ticket for a sage user needing `directg`. I will look at `watercluster2` and modify my ticket with it if it works well.\\

Thanks for your comments.



---

archive/issue_comments_524310.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-02-07T14:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524310",
    "user": "https://github.com/vinklein"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_524311.json:
```json
{
    "body": "<a id='comment:8'></a>**Comparison `watercluster2` and `directg`**\n\n1 - For generating/counting digraph without generating output watercluster2 is way faster.\n\n```\n(sage-sh) vklein@tuono:sage$ time geng -c 7 | directg -o -u\n>A geng -cd1D6 n=7 e=6-21\n>Z 853 graphs generated in 0.00 sec\n>A directg -ou\n>Z 853 graphs read from stdin; 2120098 digraphs generated; 1.71 sec\n\nreal    0m1.734s\nuser    0m1.716s\nsys 0m0.000s\n(sage-sh) vklein@tuono:sage$ time geng -c 7 | watercluster2 S\n>A geng -cd1D6 n=7 e=6-21\n>Z 853 graphs generated in 0.00 sec\nNumber of directed graphs: 2120098 \n\nreal    0m0.233s\nuser    0m0.234s\nsys 0m0.000s\n```\n\nIf you take the time to generate output into account the result is less clear.\\\\\n`watercluster2` has two output format T-code (option T) or a custom binary format (option B).\\\\\nFor the tests below the two functions used just read the command output.\n\n```\nsage: time out = digraphs.nauty_watercluster2(graphs.nauty_geng(\"-c 9 9:12\"), op\n....: tions=\"B S\")\nCPU times: user 2.42 s, sys: 571 ms, total: 2.99 s\nWall time: 7.12 s\nsage: time out = digraphs.nauty_watercluster2(graphs.nauty_geng(\"-c 9 9:12\"), op\n....: tions=\"T S\")\nCPU times: user 5.65 s, sys: 1.9 s, total: 7.55 s\nWall time: 33.9 s\nsage: time out = digraphs.nauty_directg(graphs.nauty_geng(\"-c 9 9:12\"), options=\n....: \"-o\")\nCPU times: user 2.02 s, sys: 591 ms, total: 2.61 s\nWall time: 10.3 s\n```\n\n`watercluster2` is slower than `directg` with T-code output and slightly faster with binary output.\\\\\nMy current problem with the binary output is that what i get is not consistent with the specifications (Which are in watercluster2 source code) and therefore i don't know how to build DiGraph with that.\n\n2 - Command options.\n\n`directg` and `watercluster2` have options with no equivalent :\n\n`directg`'s options:\n\n```\n   -e# | -e#:#  specify a value or range of the total number of arcs\n   -f#  Use only the subgroup that fixes the first # vertices setwise\n    -s#/#  Make only a fraction of the orientations: The first integer is\n            the part number (first is 0) and the second is the number of\n            parts. Splitting is done per input graph independently.\n```\n\n`watercluster2`'s options:\n\n```\nThe option ix restricts the maximum indegree to x.\nThe option oy restricts the maximum outdegree to y.\n```\n\nI don't know what is the most useful set of options between these two.\n\nI guess we should stick with `directg` for now.",
    "created_at": "2019-02-08T10:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524311",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:8'></a>**Comparison `watercluster2` and `directg`**

1 - For generating/counting digraph without generating output watercluster2 is way faster.

```
(sage-sh) vklein@tuono:sage$ time geng -c 7 | directg -o -u
>A geng -cd1D6 n=7 e=6-21
>Z 853 graphs generated in 0.00 sec
>A directg -ou
>Z 853 graphs read from stdin; 2120098 digraphs generated; 1.71 sec

real    0m1.734s
user    0m1.716s
sys 0m0.000s
(sage-sh) vklein@tuono:sage$ time geng -c 7 | watercluster2 S
>A geng -cd1D6 n=7 e=6-21
>Z 853 graphs generated in 0.00 sec
Number of directed graphs: 2120098 

real    0m0.233s
user    0m0.234s
sys 0m0.000s
```

If you take the time to generate output into account the result is less clear.\\
`watercluster2` has two output format T-code (option T) or a custom binary format (option B).\\
For the tests below the two functions used just read the command output.

```
sage: time out = digraphs.nauty_watercluster2(graphs.nauty_geng("-c 9 9:12"), op
....: tions="B S")
CPU times: user 2.42 s, sys: 571 ms, total: 2.99 s
Wall time: 7.12 s
sage: time out = digraphs.nauty_watercluster2(graphs.nauty_geng("-c 9 9:12"), op
....: tions="T S")
CPU times: user 5.65 s, sys: 1.9 s, total: 7.55 s
Wall time: 33.9 s
sage: time out = digraphs.nauty_directg(graphs.nauty_geng("-c 9 9:12"), options=
....: "-o")
CPU times: user 2.02 s, sys: 591 ms, total: 2.61 s
Wall time: 10.3 s
```

`watercluster2` is slower than `directg` with T-code output and slightly faster with binary output.\\
My current problem with the binary output is that what i get is not consistent with the specifications (Which are in watercluster2 source code) and therefore i don't know how to build DiGraph with that.

2 - Command options.

`directg` and `watercluster2` have options with no equivalent :

`directg`'s options:

```
   -e# | -e#:#  specify a value or range of the total number of arcs
   -f#  Use only the subgroup that fixes the first # vertices setwise
    -s#/#  Make only a fraction of the orientations: The first integer is
            the part number (first is 0) and the second is the number of
            parts. Splitting is done per input graph independently.
```

`watercluster2`'s options:

```
The option ix restricts the maximum indegree to x.
The option oy restricts the maximum outdegree to y.
```

I don't know what is the most useful set of options between these two.

I guess we should stick with `directg` for now.



---

archive/issue_comments_524312.json:
```json
{
    "body": "<a id='comment:9'></a>Thanks for the benchmark.\n\nI agree to stay with `directg`. You can add a `.. TODO::`` block explaining that a future task is to interface `watercluster2`.\n\n\nAlso, can you do\n\n```diff\n-                yield DiGraph(l[1:])\n+                yield DiGraph(l[1:], format='dig6')\n```\n\nand add tests like `if not graphs: ...`, `if not input: ...`, `if not g: ...` to avoid computations when the input graph/list of graphs is empty.",
    "created_at": "2019-02-08T12:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524312",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:9'></a>Thanks for the benchmark.

I agree to stay with `directg`. You can add a `.. TODO::`` block explaining that a future task is to interface `watercluster2`.


Also, can you do

```diff
-                yield DiGraph(l[1:])
+                yield DiGraph(l[1:], format='dig6')
```

and add tests like `if not graphs: ...`, `if not input: ...`, `if not g: ...` to avoid computations when the input graph/list of graphs is empty.



---

archive/issue_comments_524313.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:5 dcoudert]:\n>  You can add a test to show that 1) `directg/watercluster2` generates more graphs than what we get with `orientations`,  and 2) that each digraph obtained with `orientations` is in the set of digraphs obtained with `directg`.\n\n> \n> \n\n\nWell my results are :\n\n```\nsage: len(list(digraphs.nauty_directg(graphs.PetersenGraph())))\n121545\nsage: len(list(graphs.PetersenGraph().orientations()))\n32768\nsage: K5 = graphs.CompleteGraph(5)\nsage: len(list(digraphs.nauty_directg(K5)))\n582\nsage: len(list(K5.orientations()))\n1024\n```\n\nFor K5 `directg` give me less digraphs than `orientations`. Is it an inconsistency ?",
    "created_at": "2019-02-08T14:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524313",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:10'></a>Replying to [comment:5 dcoudert]:
>  You can add a test to show that 1) `directg/watercluster2` generates more graphs than what we get with `orientations`,  and 2) that each digraph obtained with `orientations` is in the set of digraphs obtained with `directg`.

> 
> 


Well my results are :

```
sage: len(list(digraphs.nauty_directg(graphs.PetersenGraph())))
121545
sage: len(list(graphs.PetersenGraph().orientations()))
32768
sage: K5 = graphs.CompleteGraph(5)
sage: len(list(digraphs.nauty_directg(K5)))
582
sage: len(list(K5.orientations()))
1024
```

For K5 `directg` give me less digraphs than `orientations`. Is it an inconsistency ?



---

archive/issue_comments_524314.json:
```json
{
    "body": "Changing commit from \"90b6be75191f286a326f9e49ecc60f5acf6c9c75\" to \"8080a064240470aee7fc4cc69a286e8e688e0c64\"",
    "created_at": "2019-02-08T14:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524314",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "90b6be75191f286a326f9e49ecc60f5acf6c9c75" to "8080a064240470aee7fc4cc69a286e8e688e0c64"



---

archive/issue_comments_524315.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-08T14:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524315",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_524316.json:
```json
{
    "body": "<a id='comment:12'></a>Reviewer's comments implemented apart from comparison with `orientations`'s set (see comment:10).",
    "created_at": "2019-02-08T14:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524316",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:12'></a>Reviewer's comments implemented apart from comparison with `orientations`'s set (see comment:10).



---

archive/issue_comments_524317.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-02-08T14:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524317",
    "user": "https://github.com/vinklein"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_524318.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-08T15:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524318",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_524319.json:
```json
{
    "body": "Changing commit from \"8080a064240470aee7fc4cc69a286e8e688e0c64\" to \"ada4dcb6220968759d81d12ea86965e56ebc91e0\"",
    "created_at": "2019-02-08T15:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524319",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8080a064240470aee7fc4cc69a286e8e688e0c64" to "ada4dcb6220968759d81d12ea86965e56ebc91e0"



---

archive/issue_comments_524320.json:
```json
{
    "body": "<a id='comment:15'></a>* Missing empty line\n\n```diff\n-        Return an iterator yielding digraphs using nauty's ``directg`` program.\n-        Description from directg --help:\n+        Return an iterator yielding digraphs using nauty's ``directg`` program.\n+\n+        Description from directg --help:\n```\n\n* One small details for the test `if not graphs:`. If `graphs = Graph()`, then the test will be true and nothing is returned. If it is what you expect, this is fine. But if you expect that the method return `DiGraph()`, then an extra test like `if isinstance(graphs, Graph):...` is needed. I let you decide which is best.\n\n* Concerning the test with `orientations, I plotted graphs generated with a smaller example\n\n```\nsage: sum(1 for _ in digraphs.nauty_directg(graphs.CompleteGraph(3)))\n7\nsage: sum(1 for _ in graphs.CompleteGraph(3).orientations())\n8\nsage: for d in digraphs.nauty_directg(graphs.CompleteGraph(3)):\n....:     d.show()\nsage: for d in graphs.CompleteGraph(3).orientations():\n....:     d.show()\n```\n It appears that the digraphs generated with `directg` are non-isomorphic orientations of the graph, while `orientations` generates isomorphic digraphs. For instance `[(0, 1), (0, 2), (1, 2)]` and `[(1, 0), (2, 0), (2, 1)]` are different digraphs obtained with `orientations` but are isomorphic, so only the first one is produced by `directg`.\n So the test I proposed is not relevant.\n\n However, you could add a `.. SEEALSO:` block with pointers to `orientations` and `strong_orientations`.\n\n* I have successfully tested this ticket with Python3 ;)",
    "created_at": "2019-02-08T15:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524320",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:15'></a>* Missing empty line

```diff
-        Return an iterator yielding digraphs using nauty's ``directg`` program.
-        Description from directg --help:
+        Return an iterator yielding digraphs using nauty's ``directg`` program.
+
+        Description from directg --help:
```

* One small details for the test `if not graphs:`. If `graphs = Graph()`, then the test will be true and nothing is returned. If it is what you expect, this is fine. But if you expect that the method return `DiGraph()`, then an extra test like `if isinstance(graphs, Graph):...` is needed. I let you decide which is best.

* Concerning the test with `orientations, I plotted graphs generated with a smaller example

```
sage: sum(1 for _ in digraphs.nauty_directg(graphs.CompleteGraph(3)))
7
sage: sum(1 for _ in graphs.CompleteGraph(3).orientations())
8
sage: for d in digraphs.nauty_directg(graphs.CompleteGraph(3)):
....:     d.show()
sage: for d in graphs.CompleteGraph(3).orientations():
....:     d.show()
```
 It appears that the digraphs generated with `directg` are non-isomorphic orientations of the graph, while `orientations` generates isomorphic digraphs. For instance `[(0, 1), (0, 2), (1, 2)]` and `[(1, 0), (2, 0), (2, 1)]` are different digraphs obtained with `orientations` but are isomorphic, so only the first one is produced by `directg`.
 So the test I proposed is not relevant.

 However, you could add a `.. SEEALSO:` block with pointers to `orientations` and `strong_orientations`.

* I have successfully tested this ticket with Python3 ;)



---

archive/issue_comments_524321.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-08T16:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_524322.json:
```json
{
    "body": "Changing commit from \"ada4dcb6220968759d81d12ea86965e56ebc91e0\" to \"48465906e832ba5febee91c19268e88ee6fc9429\"",
    "created_at": "2019-02-08T16:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524322",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ada4dcb6220968759d81d12ea86965e56ebc91e0" to "48465906e832ba5febee91c19268e88ee6fc9429"



---

archive/issue_comments_524323.json:
```json
{
    "body": "<a id='comment:17'></a>All comments implemented.\\\\\nThe case with `graphs == Graph()` was really a bug because `directg` manage the input of empty graphs (graph6 string `?`) and return an empty digraph.\\\\\nNote that to stick with this generator description i prefer to let `directg` do this job rather than doing a `yield DiGraph()` manually.\n\nThank you for your comments.",
    "created_at": "2019-02-08T16:40:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524323",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:17'></a>All comments implemented.\\
The case with `graphs == Graph()` was really a bug because `directg` manage the input of empty graphs (graph6 string `?`) and return an empty digraph.\\
Note that to stick with this generator description i prefer to let `directg` do this job rather than doing a `yield DiGraph()` manually.

Thank you for your comments.



---

archive/issue_comments_524324.json:
```json
{
    "body": "Changing commit from \"48465906e832ba5febee91c19268e88ee6fc9429\" to \"9289f5f547a45b611b60027936803b548089d283\"",
    "created_at": "2019-02-08T16:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524324",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "48465906e832ba5febee91c19268e88ee6fc9429" to "9289f5f547a45b611b60027936803b548089d283"



---

archive/issue_comments_524325.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-08T16:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524325",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_524326.json:
```json
{
    "body": "<a id='comment:19'></a>Some more comments (should be the last one)\n\n* To be consistent, you must change in the top table:\n\n```diff\n-    :meth:`~DiGraphGenerators.nauty_directg`       | Returns a digraph generator using Nauty's directg command.\n+    :meth:`~DiGraphGenerators.nauty_directg`       | Return an iterator yielding digraphs using nauty's ``directg`` program.\n```\n\n* In the tests, I don't understand why the error is raised only after `next(g)` and not directly during the call to `digraphs.nauty_directg`. Is it normal ?\n\n* may be you should do the test on `not graphs` after the tests on input parameters ? Otherwise, a call to `digraphs.nauty_directg([], options=\"-o -G\")` will not raise an error.\n\n* 80 column mode for comments\n\n```\n-            # digraph6 specifications: http://users.cecs.anu.edu.au/~bdm/data/formats.txt\n+            # digraph6 specifications: \n+            # http://users.cecs.anu.edu.au/~bdm/data/formats.txt\n```",
    "created_at": "2019-02-08T16:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524326",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:19'></a>Some more comments (should be the last one)

* To be consistent, you must change in the top table:

```diff
-    :meth:`~DiGraphGenerators.nauty_directg`       | Returns a digraph generator using Nauty's directg command.
+    :meth:`~DiGraphGenerators.nauty_directg`       | Return an iterator yielding digraphs using nauty's ``directg`` program.
```

* In the tests, I don't understand why the error is raised only after `next(g)` and not directly during the call to `digraphs.nauty_directg`. Is it normal ?

* may be you should do the test on `not graphs` after the tests on input parameters ? Otherwise, a call to `digraphs.nauty_directg([], options="-o -G")` will not raise an error.

* 80 column mode for comments

```
-            # digraph6 specifications: http://users.cecs.anu.edu.au/~bdm/data/formats.txt
+            # digraph6 specifications: 
+            # http://users.cecs.anu.edu.au/~bdm/data/formats.txt
```



---

archive/issue_comments_524327.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 dcoudert]:\n> Some more comments (should be the last one)\n> * In the tests, I don't understand why the error is raised only after `next(g)` and not directly during the call to `digraphs.nauty_directg`. Is it normal ?\n> \\\\\n\n\nYes that's how python's generators works. Calling the generator's function create the generator object but don't begin to execute the code inside the function:\n\n```\n>>> def generator():\n\tprint('hey')\n\tyield 1\n\n\t\n>>> g = generator()\n>>> g\n<generator object generator at 0x00000198B7D22CF0>\n>>> next(g)\nhey\n1\n```",
    "created_at": "2019-02-08T22:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524327",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:20'></a>Replying to [comment:19 dcoudert]:
> Some more comments (should be the last one)
> * In the tests, I don't understand why the error is raised only after `next(g)` and not directly during the call to `digraphs.nauty_directg`. Is it normal ?
> \\


Yes that's how python's generators works. Calling the generator's function create the generator object but don't begin to execute the code inside the function:

```
>>> def generator():
	print('hey')
	yield 1

	
>>> g = generator()
>>> g
<generator object generator at 0x00000198B7D22CF0>
>>> next(g)
hey
1
```



---

archive/issue_comments_524328.json:
```json
{
    "body": "Changing reviewer from \"\" to \"David Coudert\"",
    "created_at": "2019-02-10T18:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524328",
    "user": "https://github.com/dcoudert"
}
```

Changing reviewer from "" to "David Coudert"



---

archive/issue_comments_524329.json:
```json
{
    "body": "<a id='comment:21'></a>I didn't know that. Thanks.\n\nSo you just have to include my last comments.",
    "created_at": "2019-02-10T18:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524329",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:21'></a>I didn't know that. Thanks.

So you just have to include my last comments.



---

archive/issue_comments_524330.json:
```json
{
    "body": "Changing commit from \"9289f5f547a45b611b60027936803b548089d283\" to \"ccc2cd321eb0f774276d22d0de4434249732a0b6\"",
    "created_at": "2019-02-11T15:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524330",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9289f5f547a45b611b60027936803b548089d283" to "ccc2cd321eb0f774276d22d0de4434249732a0b6"



---

archive/issue_comments_524331.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-11T15:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524331",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_524332.json:
```json
{
    "body": "<a id='comment:23'></a>Rebase on sage8.7.beta3 and implement last reviewer's comments.",
    "created_at": "2019-02-11T15:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524332",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:23'></a>Rebase on sage8.7.beta3 and implement last reviewer's comments.



---

archive/issue_comments_524333.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-11T15:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524333",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_524334.json:
```json
{
    "body": "<a id='comment:24'></a>LGTM. Tested on py2 and py3.",
    "created_at": "2019-02-11T15:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524334",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:24'></a>LGTM. Tested on py2 and py3.



---

archive/issue_events_067599.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-13T20:56:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27231#event-67599"
}
```



---

archive/issue_comments_524335.json:
```json
{
    "body": "Changing branch from \"u/vklein/27231\" to \"ccc2cd321eb0f774276d22d0de4434249732a0b6\"",
    "created_at": "2019-02-13T20:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524335",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/vklein/27231" to "ccc2cd321eb0f774276d22d0de4434249732a0b6"



---

archive/issue_comments_524336.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-13T20:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524336",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_524337.json:
```json
{
    "body": "<a id='comment:26'></a>Thanks. There is user demand for this, see\n\n- [Ask Sage question 46220](https://ask.sagemath.org/question/46220).\n\nFollow-up ticket at #27686 for a documentation issue raised in that Ask Sage question.",
    "created_at": "2019-04-18T18:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524337",
    "user": "https://github.com/slel"
}
```

<a id='comment:26'></a>Thanks. There is user demand for this, see

- [Ask Sage question 46220](https://ask.sagemath.org/question/46220).

Follow-up ticket at #27686 for a documentation issue raised in that Ask Sage question.



---

archive/issue_comments_524338.json:
```json
{
    "body": "Changing commit from \"ccc2cd321eb0f774276d22d0de4434249732a0b6\" to \"\"",
    "created_at": "2019-04-18T18:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27231#issuecomment-524338",
    "user": "https://github.com/slel"
}
```

Changing commit from "ccc2cd321eb0f774276d22d0de4434249732a0b6" to ""
