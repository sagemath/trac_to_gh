# Issue 27726: some cleanup in quadratic forms

archive/issues_027489.json:
```json
{
    "assignees": [],
    "body": "some pyflakes, pep, and code cleanup in just a few files there\n\nCC:  @tscrim @simonbrandhorst\n\nComponent: **quadratic forms**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nBranch/Commit: **[`c0fc402`](https://github.com/sagemath/sagetrac-mirror/commit/c0fc402903a411247d25056d5f67688aedf8f36d)**\n\nReviewer: **Travis Scrimshaw**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27726_\n\n",
    "closed_at": "2019-04-29T11:50:46Z",
    "created_at": "2019-04-25T12:41:36Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20quadratic%20forms",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "some cleanup in quadratic forms",
    "type": "issue",
    "updated_at": "2019-04-29T11:50:46Z",
    "url": "https://github.com/sagemath/sage/issues/27726",
    "user": "https://github.com/fchapoton"
}
```
some pyflakes, pep, and code cleanup in just a few files there

CC:  @tscrim @simonbrandhorst

Component: **quadratic forms**

Author: **Frédéric Chapoton**

Branch/Commit: **[`c0fc402`](https://github.com/sagemath/sagetrac-mirror/commit/c0fc402903a411247d25056d5f67688aedf8f36d)**

Reviewer: **Travis Scrimshaw**

_Issue created by migration from https://trac.sagemath.org/ticket/27726_





---

archive/issue_events_377420.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-04-25T12:41:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27726#event-377420"
}
```



---

archive/issue_events_377421.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-04-25T12:41:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20quadratic%20forms",
    "label_color": "0000ff",
    "label_name": "c: quadratic forms",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27726#event-377421"
}
```



---

archive/issue_events_377422.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-04-25T12:41:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27726#event-377422"
}
```



---

archive/issue_events_377423.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-04-25T12:41:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27726#event-377423"
}
```



---

archive/issue_events_377424.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-04-25T12:45:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27726#event-377424"
}
```



---

archive/issue_comments_429728.json:
```json
{
    "body": "Branch: **[u/chapoton/27726](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27726)**",
    "created_at": "2019-04-25T12:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27726#issuecomment-429728",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/27726](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27726)**



---

archive/issue_comments_429729.json:
```json
{
    "body": "Commit: **[`63f4059`](https://github.com/sagemath/sagetrac-mirror/commit/63f4059d51a6b5997df69961db00d17d9e58d828)**",
    "created_at": "2019-04-25T12:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27726#issuecomment-429729",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`63f4059`](https://github.com/sagemath/sagetrac-mirror/commit/63f4059d51a6b5997df69961db00d17d9e58d828)**



---

archive/issue_comments_429730.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/63f4059d51a6b5997df69961db00d17d9e58d828\"><code>63f4059</code></a></td><td><code>some cleanup in quadratic forms</code></td></tr></table>\n",
    "created_at": "2019-04-25T12:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27726#issuecomment-429730",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/63f4059d51a6b5997df69961db00d17d9e58d828"><code>63f4059</code></a></td><td><code>some cleanup in quadratic forms</code></td></tr></table>




---

archive/issue_comments_429731.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\ngreen bot, please review",
    "created_at": "2019-04-25T16:49:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27726#issuecomment-429731",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:2" align="right">comment:2</div>

green bot, please review



---

archive/issue_comments_429732.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2019-04-25T22:52:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27726#issuecomment-429732",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_429733.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI am not quite in favor of these changes:\n\n```diff\n-#from sage.quadratic_forms.quadratic_form import QuadraticForm    ## This creates a circular import! =(\n \n \n-####################################################################################\n-## Routines used for understanding p-neighbors, and computing classes in a genus. ##\n-####################################################################################\n+# ######################################################################\n+# Routines used for understanding p-neighbors and computing classes in a genus.\n+# ######################################################################\n```\nThe first one deserves to be there as a warning for future code. For the latter, the first looks better visually IMO. However, that one is clearly bikeshedding, so I won't push it.\n\n```diff\n-    ## Find a (dual) vector w with B(v,w) != 0 (mod p)\n-    v_dual = B2 * vector(v)     ## We want the dot product with this to not be divisible by 2*p.\n+    # Find a (dual) vector w with B(v,w) != 0 (mod p)\n+    v_dual = B2 * vector(v)\n+    # We want the dot product with this to not be divisible by 2*p.\n```\nFor this change, I feel the comment is better served before the `v_dual` line if you do not want it on the same line.\n\n```diff\n     if hasattr(self, \"__split_local_cover\"):\n         if is_QuadraticForm(self.__split_local_cover):  ## Here the computation has been done.\n             return self.__split_local_cover\n-        elif isinstance(self.__split_local_cover, Integer):    ## Here it indexes the values already tried!\n+        elif self.__split_local_cover in ZZ:    ## Here it indexes the values already tried!\n             current_length = self.__split_local_cover + 1\n             Length_Max = current_length + 5\n     else:\n```\nI am slightly worried about this change as `ZZ` and `QQ` elements are slightly different and this can matter. I don't think so, but I am cc-ing Simon to see if he agrees that this change is completely safe (and to look over the other changes in case he has some other comments).",
    "created_at": "2019-04-25T22:52:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27726#issuecomment-429733",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:3" align="right">comment:3</div>

I am not quite in favor of these changes:

```diff
-#from sage.quadratic_forms.quadratic_form import QuadraticForm    ## This creates a circular import! =(
 
 
-####################################################################################
-## Routines used for understanding p-neighbors, and computing classes in a genus. ##
-####################################################################################
+# ######################################################################
+# Routines used for understanding p-neighbors and computing classes in a genus.
+# ######################################################################
```
The first one deserves to be there as a warning for future code. For the latter, the first looks better visually IMO. However, that one is clearly bikeshedding, so I won't push it.

```diff
-    ## Find a (dual) vector w with B(v,w) != 0 (mod p)
-    v_dual = B2 * vector(v)     ## We want the dot product with this to not be divisible by 2*p.
+    # Find a (dual) vector w with B(v,w) != 0 (mod p)
+    v_dual = B2 * vector(v)
+    # We want the dot product with this to not be divisible by 2*p.
```
For this change, I feel the comment is better served before the `v_dual` line if you do not want it on the same line.

```diff
     if hasattr(self, "__split_local_cover"):
         if is_QuadraticForm(self.__split_local_cover):  ## Here the computation has been done.
             return self.__split_local_cover
-        elif isinstance(self.__split_local_cover, Integer):    ## Here it indexes the values already tried!
+        elif self.__split_local_cover in ZZ:    ## Here it indexes the values already tried!
             current_length = self.__split_local_cover + 1
             Length_Max = current_length + 5
     else:
```
I am slightly worried about this change as `ZZ` and `QQ` elements are slightly different and this can matter. I don't think so, but I am cc-ing Simon to see if he agrees that this change is completely safe (and to look over the other changes in case he has some other comments).



---

archive/issue_comments_429734.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\ngrepping `__split_local_cover`\nshows that is is either a quadratic form \nor an Integer. The change mentioned should be safe.\n\nThanks for the cleanup.\nNote that there is still a lot of broken/incomplete code around \nin the quadratic forms folder.",
    "created_at": "2019-04-26T06:54:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27726#issuecomment-429734",
    "user": "https://github.com/simonbrandhorst"
}
```

<div id="comment:4" align="right">comment:4</div>

grepping `__split_local_cover`
shows that is is either a quadratic form 
or an Integer. The change mentioned should be safe.

Thanks for the cleanup.
Note that there is still a lot of broken/incomplete code around 
in the quadratic forms folder.



---

archive/issue_comments_429735.json:
```json
{
    "body": "Changed commit from **[`63f4059`](https://github.com/sagemath/sagetrac-mirror/commit/63f4059d51a6b5997df69961db00d17d9e58d828)** to **[`c0fc402`](https://github.com/sagemath/sagetrac-mirror/commit/c0fc402903a411247d25056d5f67688aedf8f36d)**",
    "created_at": "2019-04-26T07:00:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27726#issuecomment-429735",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`63f4059`](https://github.com/sagemath/sagetrac-mirror/commit/63f4059d51a6b5997df69961db00d17d9e58d828)** to **[`c0fc402`](https://github.com/sagemath/sagetrac-mirror/commit/c0fc402903a411247d25056d5f67688aedf8f36d)**



---

archive/issue_comments_429736.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c0fc402903a411247d25056d5f67688aedf8f36d\"><code>c0fc402</code></a></td><td><code>trac 27726 some details</code></td></tr></table>\n",
    "created_at": "2019-04-26T07:00:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27726#issuecomment-429736",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c0fc402903a411247d25056d5f67688aedf8f36d"><code>c0fc402</code></a></td><td><code>trac 27726 some details</code></td></tr></table>




---

archive/issue_comments_429737.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nsome fixes as suggested",
    "created_at": "2019-04-26T07:00:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27726#issuecomment-429737",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">comment:6</div>

some fixes as suggested



---

archive/issue_events_377425.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-04-26T14:38:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27726#event-377425"
}
```



---

archive/issue_events_377426.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-04-26T14:38:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27726#event-377426"
}
```



---

archive/issue_comments_429738.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThanks. LGTM.",
    "created_at": "2019-04-26T14:38:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27726#issuecomment-429738",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

Thanks. LGTM.



---

archive/issue_events_377427.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-29T11:50:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27726#event-377427"
}
```



---

archive/issue_events_377428.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e1d752014a0158f3a5a00f23b3d2679dc986cdb6",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-04-29T11:50:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27726#event-377428"
}
```



---

archive/issue_comments_429739.json:
```json
{
    "body": "Changed branch from **[u/chapoton/27726](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27726)** to **[`c0fc402`](https://github.com/sagemath/sagetrac-mirror/commit/c0fc402903a411247d25056d5f67688aedf8f36d)**",
    "created_at": "2019-04-29T11:50:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27726#issuecomment-429739",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/27726](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/27726)** to **[`c0fc402`](https://github.com/sagemath/sagetrac-mirror/commit/c0fc402903a411247d25056d5f67688aedf8f36d)**
