# Issue 27870: spkg-configure.m4 for  $(BLAS) (i.e. atlas and openblas)

archive/issues_027633.json:
```json
{
    "body": "one needs to understand the existing design first.\n\n* (as far as I can see) currently Sage generates *.pc files for pkg-config, for blas, cblas, and lapack. This is done for Atlas (and for external blas/lapack fed in by `SAGE_ATLAS_LIB` ?). For openblas these *.pc files are basically all point to the same library.\n\n* how are they used?  Are they all used?\n\n* is the description of `SAGE_ATLAS_LIB` outdated? I cannot imagine any need for f77 libraries in 2019...\n\nDepends on #28883\n\n**CC:**  @embray @vbraun tmonteil @mezzarobba @orlitzky @EmmanuelCharpentier @kiwifb @isuruf @mkoeppe\n\n**Keywords:** spkg-configure\n\n**Branch:** [81bf522a5a417e236f9b9ee4f05256126b5b47cb](https://github.com/sagemath/sagetrac-mirror/commit/81bf522a5a417e236f9b9ee4f05256126b5b47cb)\n\n**Reviewer:** Isuru Fernando\n\n**Author:** Dima Pasechnik\n\nIssue created by migration from https://trac.sagemath.org/ticket/27870\n\n",
    "closed_at": "2020-01-09T23:44:36Z",
    "created_at": "2019-05-25T10:22:58Z",
    "labels": [
        "component: build: configure",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "title": "spkg-configure.m4 for  $(BLAS) (i.e. atlas and openblas)",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/27870",
    "user": "https://github.com/dimpase"
}
```
one needs to understand the existing design first.

* (as far as I can see) currently Sage generates *.pc files for pkg-config, for blas, cblas, and lapack. This is done for Atlas (and for external blas/lapack fed in by `SAGE_ATLAS_LIB` ?). For openblas these *.pc files are basically all point to the same library.

* how are they used?  Are they all used?

* is the description of `SAGE_ATLAS_LIB` outdated? I cannot imagine any need for f77 libraries in 2019...

Depends on #28883

**CC:**  @embray @vbraun tmonteil @mezzarobba @orlitzky @EmmanuelCharpentier @kiwifb @isuruf @mkoeppe

**Keywords:** spkg-configure

**Branch:** [81bf522a5a417e236f9b9ee4f05256126b5b47cb](https://github.com/sagemath/sagetrac-mirror/commit/81bf522a5a417e236f9b9ee4f05256126b5b47cb)

**Reviewer:** Isuru Fernando

**Author:** Dima Pasechnik

Issue created by migration from https://trac.sagemath.org/ticket/27870





---

archive/issue_comments_435552.json:
```json
{
    "body": "<a id='comment:1'></a>\nYes, we should probably get rid of some of the ATLAS-specific stuff (or re-appropriate it).  The thing about a lot of the ATLAS stuff is that it doesn't actually care that much about having ATLAS BLAS; the way much of it is written it will work if it can find some BLAS anywhere.  That's why on Cygwin it works when you install the lapack package, because it comes with a built-in netlib BLAS.  It has nothing to do with ATLAS.\n\nIt would make sense to have an option to look for openblas if it exists, or else fall back on a generic BLAS if one can be found via various sources (pkg-config, some autoconf tests, etc.).",
    "created_at": "2019-05-31T15:54:27Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435552",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>
Yes, we should probably get rid of some of the ATLAS-specific stuff (or re-appropriate it).  The thing about a lot of the ATLAS stuff is that it doesn't actually care that much about having ATLAS BLAS; the way much of it is written it will work if it can find some BLAS anywhere.  That's why on Cygwin it works when you install the lapack package, because it comes with a built-in netlib BLAS.  It has nothing to do with ATLAS.

It would make sense to have an option to look for openblas if it exists, or else fall back on a generic BLAS if one can be found via various sources (pkg-config, some autoconf tests, etc.).



---

archive/issue_events_245904.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:55:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245904"
}
```



---

archive/issue_comments_435553.json:
```json
{
    "body": "<a id='comment:2'></a>\nAs the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435553",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'></a>
As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_comments_435554.json:
```json
{
    "body": "**Commit:** [b446427fbb1792029a12d3a53cdcddf7e92e81d9](https://github.com/sagemath/sagetrac-mirror/commit/b446427fbb1792029a12d3a53cdcddf7e92e81d9)",
    "created_at": "2019-12-10T00:05:53Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435554",
    "user": "https://github.com/dimpase"
}
```

**Commit:** [b446427fbb1792029a12d3a53cdcddf7e92e81d9](https://github.com/sagemath/sagetrac-mirror/commit/b446427fbb1792029a12d3a53cdcddf7e92e81d9)



---

archive/issue_comments_435555.json:
```json
{
    "body": "<a id='comment:5'></a>\nDebian has all the needed .pc files, so there it appears to work.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b446427fbb1792029a12d3a53cdcddf7e92e81d9\">b446427</a></td><td><code>a bare minumim openblas config</code></td></tr></table>\n",
    "created_at": "2019-12-10T00:05:53Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435555",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
Debian has all the needed .pc files, so there it appears to work.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b446427fbb1792029a12d3a53cdcddf7e92e81d9">b446427</a></td><td><code>a bare minumim openblas config</code></td></tr></table>




---

archive/issue_comments_435556.json:
```json
{
    "body": "**Branch:** [u/dimpase/packages/openblas/openblasconf](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblas/openblasconf)",
    "created_at": "2019-12-10T00:05:53Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435556",
    "user": "https://github.com/dimpase"
}
```

**Branch:** [u/dimpase/packages/openblas/openblasconf](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblas/openblasconf)



---

archive/issue_events_245905.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-10T00:08:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245905"
}
```



---

archive/issue_comments_435557.json:
```json
{
    "body": "<a id='comment:7'></a>\nThat's certainly better than nothing.  There should probably also be a check in `REQUIRED-CHECK` (the third argument to `SAGE_SPKG_CONFIGURE`) to set `sage_require_openblas=no` if `$with_blas != openblas`).   This way it won't check for openblas if someone configured Sage with `--with-blas=atlas`.",
    "created_at": "2019-12-12T13:02:16Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435557",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
That's certainly better than nothing.  There should probably also be a check in `REQUIRED-CHECK` (the third argument to `SAGE_SPKG_CONFIGURE`) to set `sage_require_openblas=no` if `$with_blas != openblas`).   This way it won't check for openblas if someone configured Sage with `--with-blas=atlas`.



---

archive/issue_comments_435558.json:
```json
{
    "body": "<a id='comment:8'></a>\nOne can only check for `openblas` with `pkg-config` and make `blas.pc` and `lapack.pc` just as copies of `openblas.pc`.\n\nBut I don't know how to look for `openblas.pc` to  copy, other than doing Unix `find /usr/` - something that is neither robust nor fast.",
    "created_at": "2019-12-12T13:20:38Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435558",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
One can only check for `openblas` with `pkg-config` and make `blas.pc` and `lapack.pc` just as copies of `openblas.pc`.

But I don't know how to look for `openblas.pc` to  copy, other than doing Unix `find /usr/` - something that is neither robust nor fast.



---

archive/issue_comments_435559.json:
```json
{
    "body": "<a id='comment:9'></a>\nOne can fill in templates for `blas.pc` by calling `pkg-config` on `openblas`, but this looks like an ugly hack...",
    "created_at": "2019-12-12T13:22:27Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435559",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
One can fill in templates for `blas.pc` by calling `pkg-config` on `openblas`, but this looks like an ugly hack...



---

archive/issue_comments_435560.json:
```json
{
    "body": "<a id='comment:10'></a>\nOK, in fact one get the location of `openblas.pc` file:\n\n```\npkg-config --variable=pcfiledir openblas\n```\n(this works), and the corresponding autoconf macro (not tested yet): \n\n```\n PKG_CHECK_VAR([OPENBLASPCDIR], [openblas], [pcfiledir],\n               [ACTION-IF-FOUND], [ACTION-IF-NOT-FOUND])\n```",
    "created_at": "2019-12-12T23:00:54Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435560",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
OK, in fact one get the location of `openblas.pc` file:

```
pkg-config --variable=pcfiledir openblas
```
(this works), and the corresponding autoconf macro (not tested yet): 

```
 PKG_CHECK_VAR([OPENBLASPCDIR], [openblas], [pcfiledir],
               [ACTION-IF-FOUND], [ACTION-IF-NOT-FOUND])
```



---

archive/issue_comments_435561.json:
```json
{
    "body": "**Changing commit** from \"[b446427fbb1792029a12d3a53cdcddf7e92e81d9](https://github.com/sagemath/sagetrac-mirror/commit/b446427fbb1792029a12d3a53cdcddf7e92e81d9)\" to \"[cb725d388640d1791778cb5788cdc2ee9482581e](https://github.com/sagemath/sagetrac-mirror/commit/cb725d388640d1791778cb5788cdc2ee9482581e)\".",
    "created_at": "2019-12-13T13:53:41Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435561",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b446427fbb1792029a12d3a53cdcddf7e92e81d9](https://github.com/sagemath/sagetrac-mirror/commit/b446427fbb1792029a12d3a53cdcddf7e92e81d9)" to "[cb725d388640d1791778cb5788cdc2ee9482581e](https://github.com/sagemath/sagetrac-mirror/commit/cb725d388640d1791778cb5788cdc2ee9482581e)".



---

archive/issue_comments_435562.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/22300f60d3f637238dfe952de05a44601c4a3ce6\">22300f6</a></td><td><code>use openblas.pc for blas and lapack, don't require atlas is to be used</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb725d388640d1791778cb5788cdc2ee9482581e\">cb725d3</a></td><td><code>move blas handling to build/pkgs/</code></td></tr></table>\n",
    "created_at": "2019-12-13T13:53:41Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435562",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/22300f60d3f637238dfe952de05a44601c4a3ce6">22300f6</a></td><td><code>use openblas.pc for blas and lapack, don't require atlas is to be used</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb725d388640d1791778cb5788cdc2ee9482581e">cb725d3</a></td><td><code>move blas handling to build/pkgs/</code></td></tr></table>




---

archive/issue_events_245906.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-13T13:56:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245906"
}
```



---

archive/issue_comments_435563.json:
```json
{
    "body": "<a id='comment:12'></a>\nthis is a minimal fix for the use of system's openblas, identifiable from pkg-config.\n\nI have not touched Atlas installation procedure.",
    "created_at": "2019-12-13T13:56:20Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435563",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>
this is a minimal fix for the use of system's openblas, identifiable from pkg-config.

I have not touched Atlas installation procedure.



---

archive/issue_comments_435564.json:
```json
{
    "body": "**Author:** Dima Pasechnik",
    "created_at": "2019-12-13T13:56:20Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435564",
    "user": "https://github.com/dimpase"
}
```

**Author:** Dima Pasechnik



---

archive/issue_comments_435565.json:
```json
{
    "body": "<a id='comment:13'></a>\nWell... I did `git trac checkout 27870`, then `make`, and `make` went directly to checking the documentation.\n\nI guess that testing your patch involves either `make clean` or `make distclean`. Which one ?",
    "created_at": "2019-12-13T18:45:53Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435565",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:13'></a>
Well... I did `git trac checkout 27870`, then `make`, and `make` went directly to checking the documentation.

I guess that testing your patch involves either `make clean` or `make distclean`. Which one ?



---

archive/issue_comments_435566.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [charpent](#comment%3A13):\n> Well... I did `git trac checkout 27870`, then `make`, and `make` went directly to checking the documentation.\n> \n> I guess that testing your patch involves either `make clean` or `make distclean`. Which one ?\n\n\nNot only this :-)\n\n```\nmake openblas-clean # uninstall package\n./bootstrap # update ./configure\n./configure # here the output should show that openblas is not being installed\nmake build\n```\non OSX for some reason I also needed to `./sage -f numpy` before `make build`\n\n`make distclean` before `bootstrap` is more robust. I'm not sure in which cases one should re-install all the packages that depend upon blas, too, this might be\nplatform-dependent.\n\n---\n\nOne naturally is interested in testing against system's openblas: e.g. on debian and derived systems one needs `apt install pkg-config libopenblas-dev`\n\nOn OSX's Homebrew one would need `brew install openblas` and then export certain\nenvironment variable (as Homebrew will tell you), as for some reason it's not installed into a default location.",
    "created_at": "2019-12-13T19:23:48Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435566",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>
Replying to [charpent](#comment%3A13):
> Well... I did `git trac checkout 27870`, then `make`, and `make` went directly to checking the documentation.
> 
> I guess that testing your patch involves either `make clean` or `make distclean`. Which one ?


Not only this :-)

```
make openblas-clean # uninstall package
./bootstrap # update ./configure
./configure # here the output should show that openblas is not being installed
make build
```
on OSX for some reason I also needed to `./sage -f numpy` before `make build`

`make distclean` before `bootstrap` is more robust. I'm not sure in which cases one should re-install all the packages that depend upon blas, too, this might be
platform-dependent.

---

One naturally is interested in testing against system's openblas: e.g. on debian and derived systems one needs `apt install pkg-config libopenblas-dev`

On OSX's Homebrew one would need `brew install openblas` and then export certain
environment variable (as Homebrew will tell you), as for some reason it's not installed into a default location.



---

archive/issue_comments_435567.json:
```json
{
    "body": "<a id='comment:15'></a>\nThere is a larger mess to deal with here, but TBH I'm fine with solving it one piece at a time. It looks like a few packages (R, numpy,... ?) do use pkg-config to discover information about the blas/lapack being used. And our pkg-config is hacked (build/pkgs/pkgconf/patches/pkg-config.in) to look in a custom directory for .pc files if they aren't found on the system. So I think the idea was that if pkg-config couldn't find e.g. lapack.pc, that it would then look in SAGE_LOCAL to find it.\n\nThis only raises more questions. If openblas is installed on the system, can we count on the system pkg-config to know that the system blas/lapack are just the system openblas? If so, then we shouldn't need to create \"fallback\" symlinks. If not, would linking to some other blas/lapack cause problems? Why don't those packages check for openblas or atlas directly instead of \"blas\" and \"lapack\", in that case? And so on. Your approach looks better the deeper I go.",
    "created_at": "2019-12-13T20:12:11Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435567",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:15'></a>
There is a larger mess to deal with here, but TBH I'm fine with solving it one piece at a time. It looks like a few packages (R, numpy,... ?) do use pkg-config to discover information about the blas/lapack being used. And our pkg-config is hacked (build/pkgs/pkgconf/patches/pkg-config.in) to look in a custom directory for .pc files if they aren't found on the system. So I think the idea was that if pkg-config couldn't find e.g. lapack.pc, that it would then look in SAGE_LOCAL to find it.

This only raises more questions. If openblas is installed on the system, can we count on the system pkg-config to know that the system blas/lapack are just the system openblas? If so, then we shouldn't need to create "fallback" symlinks. If not, would linking to some other blas/lapack cause problems? Why don't those packages check for openblas or atlas directly instead of "blas" and "lapack", in that case? And so on. Your approach looks better the deeper I go.



---

archive/issue_comments_435568.json:
```json
{
    "body": "<a id='comment:16'></a>\nI more or less copy the logic of openblas/dpkg-install - which does install openblas.pc under 3 different names - openblas, blas, and lapack.",
    "created_at": "2019-12-13T20:52:15Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435568",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>
I more or less copy the logic of openblas/dpkg-install - which does install openblas.pc under 3 different names - openblas, blas, and lapack.



---

archive/issue_comments_435569.json:
```json
{
    "body": "<a id='comment:17'></a>\nI tried this (meaning `make distclean; ./bootstrap; make`) with an Ubuntu virtual machine. `config.log` says\n\n```\nconfigure:20206: result:     atlas-3.10.2.p3 will not be installed (configure check)\n...\nconfigure:20206: result:     openblas-0.3.6.p0 will not be installed (configure check)\n```\nbut `scipy` installation fails with\n\n```\nnumpy.distutils.system_info.NotFoundError: No lapack/blas resources found.\n```\nThere are also various warnings in the `numpy` installation log about not finding atlas or blas.",
    "created_at": "2019-12-13T20:55:12Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435569",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'></a>
I tried this (meaning `make distclean; ./bootstrap; make`) with an Ubuntu virtual machine. `config.log` says

```
configure:20206: result:     atlas-3.10.2.p3 will not be installed (configure check)
...
configure:20206: result:     openblas-0.3.6.p0 will not be installed (configure check)
```
but `scipy` installation fails with

```
numpy.distutils.system_info.NotFoundError: No lapack/blas resources found.
```
There are also various warnings in the `numpy` installation log about not finding atlas or blas.



---

archive/issue_comments_435570.json:
```json
{
    "body": "<a id='comment:18'></a>\nscipy depends on numpy to supply blas interface, so something goes wrong with numpy installation (it is weird that it foes not fail).\n\nit works for me on Debian 10. numpy has its own extermely convoluted configure routine, which emits a lot of noise about not finding this or that.\n\nCould you try building numpy with SAGE_CHECK ?",
    "created_at": "2019-12-13T21:02:58Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435570",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
scipy depends on numpy to supply blas interface, so something goes wrong with numpy installation (it is weird that it foes not fail).

it works for me on Debian 10. numpy has its own extermely convoluted configure routine, which emits a lot of noise about not finding this or that.

Could you try building numpy with SAGE_CHECK ?



---

archive/issue_comments_435571.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [dimpase](#comment%3A16):\n> I more or less copy the logic of openblas/dpkg-install - which does install openblas.pc under 3 different names - openblas, blas, and lapack.\n\n\nYeah I agree with that. Maybe two years from now, no one is using atlas any more and this is easy to clean up by dropping support for it and by having those other packages call `pkg-config openblas...` instead of `pkg-config lapack` and `pkg-config blas`. No need to worry about it now.",
    "created_at": "2019-12-13T21:04:01Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435571",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:19'></a>
Replying to [dimpase](#comment%3A16):
> I more or less copy the logic of openblas/dpkg-install - which does install openblas.pc under 3 different names - openblas, blas, and lapack.


Yeah I agree with that. Maybe two years from now, no one is using atlas any more and this is easy to clean up by dropping support for it and by having those other packages call `pkg-config openblas...` instead of `pkg-config lapack` and `pkg-config blas`. No need to worry about it now.



---

archive/issue_comments_435572.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [jhpalmieri](#comment%3A17):\n>\n> There are also various warnings in the `numpy` installation log about not finding atlas or blas.\n\n\nFWIW numpy is one of those packages that uses pkg-config to find these libraries; see build/pkgs/numpy/lapack_conf.py.",
    "created_at": "2019-12-13T21:07:07Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435572",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:20'></a>
Replying to [jhpalmieri](#comment%3A17):
>
> There are also various warnings in the `numpy` installation log about not finding atlas or blas.


FWIW numpy is one of those packages that uses pkg-config to find these libraries; see build/pkgs/numpy/lapack_conf.py.



---

archive/issue_comments_435573.json:
```json
{
    "body": "<a id='comment:21'></a>\nApart from Atlas and openblas there are other perfectly ok implementations of blas and lapack, which may be used.",
    "created_at": "2019-12-13T21:07:23Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435573",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>
Apart from Atlas and openblas there are other perfectly ok implementations of blas and lapack, which may be used.



---

archive/issue_comments_435574.json:
```json
{
    "body": "<a id='comment:22'></a>\ne.g. there are highly optimised by hardware vendors blas and lapacks (e.g. MKL)",
    "created_at": "2019-12-13T21:08:59Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435574",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>
e.g. there are highly optimised by hardware vendors blas and lapacks (e.g. MKL)



---

archive/issue_comments_435575.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [dimpase](#comment%3A18):\n> Could you try building numpy with SAGE_CHECK ?\n\n\n`numpy` has no `spkg-check` file, so this acts the same as what I did before.",
    "created_at": "2019-12-13T21:17:33Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435575",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:23'></a>
Replying to [dimpase](#comment%3A18):
> Could you try building numpy with SAGE_CHECK ?


`numpy` has no `spkg-check` file, so this acts the same as what I did before.



---

archive/issue_comments_435576.json:
```json
{
    "body": "<a id='comment:24'></a>\nI'm not suggesting that we don't support other blas/lapack implementations, but trying to account for multiple system implementations AND multiple sage implementations is making life harder than it has to be. Somewhere down the road, we should be (a) checking for system blas/lapack, and using what we find; then (b) as a fallback, installing openblas and using openblas.\n\nThis is all speculation right now, regardless =)",
    "created_at": "2019-12-13T21:19:10Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435576",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:24'></a>
I'm not suggesting that we don't support other blas/lapack implementations, but trying to account for multiple system implementations AND multiple sage implementations is making life harder than it has to be. Somewhere down the road, we should be (a) checking for system blas/lapack, and using what we find; then (b) as a fallback, installing openblas and using openblas.

This is all speculation right now, regardless =)



---

archive/issue_comments_435577.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [mjo](#comment%3A24):\n> I'm not suggesting that we don't support other blas/lapack implementations, but trying to account for multiple system implementations AND multiple sage implementations is making life harder than it has to be. Somewhere down the road, we should be (a) checking for system blas/lapack, and using what we find; then (b) as a fallback, installing openblas and using openblas.\n> \n> This is all speculation right now, regardless =)\n\n\nDo you mean \"not ready for prime time\" ?",
    "created_at": "2019-12-13T21:27:19Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435577",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:25'></a>
Replying to [mjo](#comment%3A24):
> I'm not suggesting that we don't support other blas/lapack implementations, but trying to account for multiple system implementations AND multiple sage implementations is making life harder than it has to be. Somewhere down the road, we should be (a) checking for system blas/lapack, and using what we find; then (b) as a fallback, installing openblas and using openblas.
> 
> This is all speculation right now, regardless =)


Do you mean "not ready for prime time" ?



---

archive/issue_events_245907.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2019-12-13T22:05:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245907"
}
```



---

archive/issue_events_245908.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2019-12-13T22:05:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245908"
}
```



---

archive/issue_comments_435578.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [dimpase](#comment%3A14):\n> Replying to [charpent](#comment%3A13):\n> > Well... I did `git trac checkout 27870`, then `make`, and `make` went directly to checking the documentation.\n> > \n> > I guess that testing your patch involves either `make clean` or `make distclean`. Which one ?\n\n> \n> Not only this :-)\n> \n> ```\n> make openblas-clean # uninstall package\n> ./bootstrap # update ./configure\n> ./configure # here the output should show that openblas is not being installed\n> ```\n\nNo such bllody luck. From config.log:\n\n```\nconfigure:11316: === checking whether to install the openblas SPKG ===\nconfigure:11334: checking BLAS library\nconfigure:11353: result: openblas\nconfigure:11395: checking for OPENBLAS\nconfigure:11402: $PKG_CONFIG --exists --print-errors \"openblas >= 0.3.5\"\nPackage openblas was not found in the pkg-config search path.\nPerhaps you should add the directory containing `openblas.pc'\nto the PKG_CONFIG_PATH environment variable\nNo package 'openblas' found\nconfigure:11405: $? = 1\nconfigure:11419: $PKG_CONFIG --exists --print-errors \"openblas >= 0.3.5\"\nPackage openblas was not found in the pkg-config search path.\nPerhaps you should add the directory containing `openblas.pc'\nto the PKG_CONFIG_PATH environment variable\nNo package 'openblas' found\nconfigure:11422: $? = 1\nconfigure:11436: result: no\nNo package 'openblas' found\n```\n\nBut the relevant packages **are** installed systemwide (Debian testing) :\n\n```\ncharpent@zen-book-flip:~$ dpkg -l \"*openblas*\"\nSouhait=inconnU/Install\u00e9/suppRim\u00e9/Purg\u00e9/H=\u00e0 garder\n| \u00c9tat=Non/Install\u00e9/fichier-Config/d\u00e9paqUet\u00e9/\u00e9chec-conFig/H=semi-install\u00e9/W=att>\n|/ Err?=(aucune)/besoin R\u00e9installation (\u00c9tat,Err: majuscule=mauvais)\n||/ Nom                           Version      Architecture Description\n+++-=============================-============-============-===================>\nii  libopenblas-base:amd64        0.3.7+ds-5   amd64        Optimized BLAS (lin>\nii  libopenblas-dev:amd64         0.3.7+ds-5   amd64        Optimized BLAS (lin>\nun  libopenblas-openmp-dev        <aucune>     <aucune>     (aucune description>\nii  libopenblas-pthread-dev:amd64 0.3.7+ds-5   amd64        Optimized BLAS (lin>\nun  libopenblas-serial-dev        <aucune>     <aucune>     (aucune description>\nii  libopenblas0:amd64            0.3.7+ds-5   amd64        Optimized BLAS (lin>\nun  libopenblas0-openmp           <aucune>     <aucune>     (aucune description>\nii  libopenblas0-pthread:amd64    0.3.7+ds-5   amd64        Optimized BLAS (lin>\nun  libopenblas0-serial           <aucune>     <aucune>     (aucune description\n```\n\n==> `needs_work`.\n\nSorry.",
    "created_at": "2019-12-13T22:05:24Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435578",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:27'></a>
Replying to [dimpase](#comment%3A14):
> Replying to [charpent](#comment%3A13):
> > Well... I did `git trac checkout 27870`, then `make`, and `make` went directly to checking the documentation.
> > 
> > I guess that testing your patch involves either `make clean` or `make distclean`. Which one ?

> 
> Not only this :-)
> 
> ```
> make openblas-clean # uninstall package
> ./bootstrap # update ./configure
> ./configure # here the output should show that openblas is not being installed
> ```

No such bllody luck. From config.log:

```
configure:11316: === checking whether to install the openblas SPKG ===
configure:11334: checking BLAS library
configure:11353: result: openblas
configure:11395: checking for OPENBLAS
configure:11402: $PKG_CONFIG --exists --print-errors "openblas >= 0.3.5"
Package openblas was not found in the pkg-config search path.
Perhaps you should add the directory containing `openblas.pc'
to the PKG_CONFIG_PATH environment variable
No package 'openblas' found
configure:11405: $? = 1
configure:11419: $PKG_CONFIG --exists --print-errors "openblas >= 0.3.5"
Package openblas was not found in the pkg-config search path.
Perhaps you should add the directory containing `openblas.pc'
to the PKG_CONFIG_PATH environment variable
No package 'openblas' found
configure:11422: $? = 1
configure:11436: result: no
No package 'openblas' found
```

But the relevant packages **are** installed systemwide (Debian testing) :

```
charpent@zen-book-flip:~$ dpkg -l "*openblas*"
Souhait=inconnU/Installé/suppRimé/Purgé/H=à garder
| État=Non/Installé/fichier-Config/dépaqUeté/échec-conFig/H=semi-installé/W=att>
|/ Err?=(aucune)/besoin Réinstallation (État,Err: majuscule=mauvais)
||/ Nom                           Version      Architecture Description
+++-=============================-============-============-===================>
ii  libopenblas-base:amd64        0.3.7+ds-5   amd64        Optimized BLAS (lin>
ii  libopenblas-dev:amd64         0.3.7+ds-5   amd64        Optimized BLAS (lin>
un  libopenblas-openmp-dev        <aucune>     <aucune>     (aucune description>
ii  libopenblas-pthread-dev:amd64 0.3.7+ds-5   amd64        Optimized BLAS (lin>
un  libopenblas-serial-dev        <aucune>     <aucune>     (aucune description>
ii  libopenblas0:amd64            0.3.7+ds-5   amd64        Optimized BLAS (lin>
un  libopenblas0-openmp           <aucune>     <aucune>     (aucune description>
ii  libopenblas0-pthread:amd64    0.3.7+ds-5   amd64        Optimized BLAS (lin>
un  libopenblas0-serial           <aucune>     <aucune>     (aucune description
```

==> `needs_work`.

Sorry.



---

archive/issue_comments_435579.json:
```json
{
    "body": "<a id='comment:28'></a>\ndo you have `pkg-config` installed?",
    "created_at": "2019-12-13T22:13:55Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435579",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'></a>
do you have `pkg-config` installed?



---

archive/issue_comments_435580.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [dimpase](#comment%3A28):\n> do you have `pkg-config` installed? \n\n\n\nYes :\n\n```\ncharpent@zen-book-flip:~$ dpkg -l \"*pkg-config*\"\nSouhait=inconnU/Install\u00e9/suppRim\u00e9/Purg\u00e9/H=\u00e0 garder\n| \u00c9tat=Non/Install\u00e9/fichier-Config/d\u00e9paqUet\u00e9/\u00e9chec-conFig/H=semi-install\u00e9/W=att>\n|/ Err?=(aucune)/besoin R\u00e9installation (\u00c9tat,Err: majuscule=mauvais)\n||/ Nom            Version      Architecture Description\n+++-==============-============-============-==================================>\nii  pkg-config     0.29-6       amd64        manage compile and link flags for >\nun  pkg-config-bin <aucune>     <aucune>     (aucune description n'est disponib>\n```\n\nI was unaware (until 30 seconds ago) of `pkg-config-bin`. It seems to be a virtual package (i. e. in Debianese, a placeholder for a functionality fullfillable by more than one package).",
    "created_at": "2019-12-13T22:25:47Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435580",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:29'></a>
Replying to [dimpase](#comment%3A28):
> do you have `pkg-config` installed? 



Yes :

```
charpent@zen-book-flip:~$ dpkg -l "*pkg-config*"
Souhait=inconnU/Installé/suppRimé/Purgé/H=à garder
| État=Non/Installé/fichier-Config/dépaqUeté/échec-conFig/H=semi-installé/W=att>
|/ Err?=(aucune)/besoin Réinstallation (État,Err: majuscule=mauvais)
||/ Nom            Version      Architecture Description
+++-==============-============-============-==================================>
ii  pkg-config     0.29-6       amd64        manage compile and link flags for >
un  pkg-config-bin <aucune>     <aucune>     (aucune description n'est disponib>
```

I was unaware (until 30 seconds ago) of `pkg-config-bin`. It seems to be a virtual package (i. e. in Debianese, a placeholder for a functionality fullfillable by more than one package).



---

archive/issue_comments_435581.json:
```json
{
    "body": "<a id='comment:30'></a>\nwhat does \n\n```\npkg-config --list-all | grep blas\n```\nshow?",
    "created_at": "2019-12-13T22:31:28Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435581",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>
what does 

```
pkg-config --list-all | grep blas
```
show?



---

archive/issue_comments_435582.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [dimpase](#comment%3A30):\n> what does \n> \n> ```\n> pkg-config --list-all | grep blas\n> ```\n> show? \n\n\n\n```\ncharpent@zen-book-flip:~$ pkg-config --list-all | grep blas\nlapack-openblas                openblas-lapack - Optimized BLAS (linear algebra) library, LAPACK\nblas                           openblas-blas - Optimized BLAS (linear algebra) library based on GotoBLAS2\nblas-openblas                  openblas-blas - Optimized BLAS (linear algebra) library based on GotoBLAS2\nlapack                         openblas-lapack - Optimized BLAS (linear algebra) library, LAPACK\nblas-netlib                    BLAS - FORTRAN reference implementation of BLAS Basic Linear Algebra Subprograms\n```",
    "created_at": "2019-12-13T22:34:29Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435582",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:31'></a>
Replying to [dimpase](#comment%3A30):
> what does 
> 
> ```
> pkg-config --list-all | grep blas
> ```
> show? 



```
charpent@zen-book-flip:~$ pkg-config --list-all | grep blas
lapack-openblas                openblas-lapack - Optimized BLAS (linear algebra) library, LAPACK
blas                           openblas-blas - Optimized BLAS (linear algebra) library based on GotoBLAS2
blas-openblas                  openblas-blas - Optimized BLAS (linear algebra) library based on GotoBLAS2
lapack                         openblas-lapack - Optimized BLAS (linear algebra) library, LAPACK
blas-netlib                    BLAS - FORTRAN reference implementation of BLAS Basic Linear Algebra Subprograms
```



---

archive/issue_comments_435583.json:
```json
{
    "body": "<a id='comment:32'></a>\nI think my numpy/scipy problem is from each package's `spkg-install` script:\n\n```\n export {ATLAS,PTATLAS,OPENBLAS,MKL,MKLROOT}=None\n```\nSetting `OPENBLAS` to `None` seems to cause the package not to find the system's openblas installation. Removing `OPENBLAS` from the list of environment variables fixes things for me. What is the purpose of this line?",
    "created_at": "2019-12-13T22:53:44Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435583",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:32'></a>
I think my numpy/scipy problem is from each package's `spkg-install` script:

```
 export {ATLAS,PTATLAS,OPENBLAS,MKL,MKLROOT}=None
```
Setting `OPENBLAS` to `None` seems to cause the package not to find the system's openblas installation. Removing `OPENBLAS` from the list of environment variables fixes things for me. What is the purpose of this line?



---

archive/issue_comments_435584.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [charpent](#comment%3A25):\n> \n> Do you mean \"not ready for prime time\" ?\n> \n\n\nI probably should not have said anything at all. Modulo whatever bugs are being worked out, Dima's approach looks good to me.\n\nLater on, there may be *additional* improvements to make sage support the system blas/lapack, but this patch is a step in the right direction.",
    "created_at": "2019-12-13T22:58:09Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435584",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:33'></a>
Replying to [charpent](#comment%3A25):
> 
> Do you mean "not ready for prime time" ?
> 


I probably should not have said anything at all. Modulo whatever bugs are being worked out, Dima's approach looks good to me.

Later on, there may be *additional* improvements to make sage support the system blas/lapack, but this patch is a step in the right direction.



---

archive/issue_comments_435585.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [jhpalmieri](#comment%3A32):\n> I think my numpy/scipy problem is from each package's `spkg-install` script:\n> \n> ```\n>  export {ATLAS,PTATLAS,OPENBLAS,MKL,MKLROOT}=None\n> ```\n> Setting `OPENBLAS` to `None` seems to cause the package not to find the system's openblas installation. Removing `OPENBLAS` from the list of environment variables fixes things for me. What is the purpose of this line?\n\n\nI can reproduce your problem - and it seems to go away if I just not call that\npython script, i.e.\n\n```diff\n--- a/build/pkgs/numpy/spkg-install\n+++ b/build/pkgs/numpy/spkg-install\n@@ -11,7 +11,7 @@ else\n     export LDFLAGS=\"${LDFLAGS} -shared\"\n fi\n \n-sage-python23 ../lapack_conf.py\n+# sage-python23 ../lapack_conf.py\n \n # Make sure that the fortran objects are compiled with -fPIC\n export FFLAGS=\"$FFLAGS -fPIC\"\n```\n\nI'm not saying it can be just removed unconditionally, but it needs an adjustment.\n\nHopefully Francois, its author, knows what's going wrong.",
    "created_at": "2019-12-13T23:01:54Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435585",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>
Replying to [jhpalmieri](#comment%3A32):
> I think my numpy/scipy problem is from each package's `spkg-install` script:
> 
> ```
>  export {ATLAS,PTATLAS,OPENBLAS,MKL,MKLROOT}=None
> ```
> Setting `OPENBLAS` to `None` seems to cause the package not to find the system's openblas installation. Removing `OPENBLAS` from the list of environment variables fixes things for me. What is the purpose of this line?


I can reproduce your problem - and it seems to go away if I just not call that
python script, i.e.

```diff
--- a/build/pkgs/numpy/spkg-install
+++ b/build/pkgs/numpy/spkg-install
@@ -11,7 +11,7 @@ else
     export LDFLAGS="${LDFLAGS} -shared"
 fi
 
-sage-python23 ../lapack_conf.py
+# sage-python23 ../lapack_conf.py
 
 # Make sure that the fortran objects are compiled with -fPIC
 export FFLAGS="$FFLAGS -fPIC"
```

I'm not saying it can be just removed unconditionally, but it needs an adjustment.

Hopefully Francois, its author, knows what's going wrong.



---

archive/issue_comments_435586.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [charpent](#comment%3A31):\n> Replying to [dimpase](#comment%3A30):\n> > what does \n> > \n> > ```\n> > pkg-config --list-all | grep blas\n> > ```\n> > show? \n\n> \n> \n> ```\n> charpent@zen-book-flip:~$ pkg-config --list-all | grep blas\n> lapack-openblas                openblas-lapack - Optimized BLAS (linear algebra) library, LAPACK\n> blas                           openblas-blas - Optimized BLAS (linear algebra) library based on GotoBLAS2\n> blas-openblas                  openblas-blas - Optimized BLAS (linear algebra) library based on GotoBLAS2\n> lapack                         openblas-lapack - Optimized BLAS (linear algebra) library, LAPACK\n> blas-netlib                    BLAS - FORTRAN reference implementation of BLAS Basic Linear Algebra Subprograms\n> ```\n\n\nSo in their infinite wisdom they removed `openblas.pc` all together.\nNot sure it's a Debian bug (note that upstream openblas does create such a file, so it's really an incompatible Debian invention here).",
    "created_at": "2019-12-13T23:05:14Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435586",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:35'></a>
Replying to [charpent](#comment%3A31):
> Replying to [dimpase](#comment%3A30):
> > what does 
> > 
> > ```
> > pkg-config --list-all | grep blas
> > ```
> > show? 

> 
> 
> ```
> charpent@zen-book-flip:~$ pkg-config --list-all | grep blas
> lapack-openblas                openblas-lapack - Optimized BLAS (linear algebra) library, LAPACK
> blas                           openblas-blas - Optimized BLAS (linear algebra) library based on GotoBLAS2
> blas-openblas                  openblas-blas - Optimized BLAS (linear algebra) library based on GotoBLAS2
> lapack                         openblas-lapack - Optimized BLAS (linear algebra) library, LAPACK
> blas-netlib                    BLAS - FORTRAN reference implementation of BLAS Basic Linear Algebra Subprograms
> ```


So in their infinite wisdom they removed `openblas.pc` all together.
Not sure it's a Debian bug (note that upstream openblas does create such a file, so it's really an incompatible Debian invention here).



---

archive/issue_comments_435587.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [dimpase](#comment%3A35):\n> Replying to [charpent](#comment%3A31):\n> > Replying to [dimpase](#comment%3A30):\n> > > what does \n> > > \n> > > ```\n> > > pkg-config --list-all | grep blas\n> > > ```\n> > > show? \n\n> > \n> > \n> > ```\n> > charpent@zen-book-flip:~$ pkg-config --list-all | grep blas\n> > lapack-openblas                openblas-lapack - Optimized BLAS (linear algebra) library, LAPACK\n> > blas                           openblas-blas - Optimized BLAS (linear algebra) library based on GotoBLAS2\n> > blas-openblas                  openblas-blas - Optimized BLAS (linear algebra) library based on GotoBLAS2\n> > lapack                         openblas-lapack - Optimized BLAS (linear algebra) library, LAPACK\n> > blas-netlib                    BLAS - FORTRAN reference implementation of BLAS Basic Linear Algebra Subprograms\n> > ```\n\n> \n> So in their infinite wisdom they removed `openblas.pc` all together.\n> Not sure it's a Debian bug (note that upstream openblas does create such a file, so it's really an incompatible Debian invention here).\n\n\nNope:\n\n```\ncharpent@zen-book-flip:~$ ls -l /usr/lib/x86_64-linux-gnu/openblas-pthread/pkgconfig/openblas.pc \n-rw-r--r-- 1 root root 570 d\u00e9c.   2 06:33 /usr/lib/x86_64-linux-gnu/openblas-pthread/pkgconfig/openblas.pc\ncharpent@zen-book-flip:~$ cat /usr/lib/x86_64-linux-gnu/openblas-pthread/pkgconfig/openblas.pc \nlibdir=/usr/lib/x86_64-linux-gnu/openblas-pthread/\nincludedir=/usr/include/x86_64-linux-gnu/openblas-pthread/\nopenblas_config= USE_64BITINT= DYNAMIC_ARCH=1 DYNAMIC_OLDER=1 NO_CBLAS= NO_LAPACK= NO_LAPACKE=1 NO_AFFINITY=1 USE_OPENMP=0 generic MAX_THREADS=64\nversion=0.3.7\nextralib=-lm -lpthread -lgfortran -lm -lpthread -lgfortran\nName: openblas\nDescription: OpenBLAS is an optimized BLAS library based on GotoBLAS2 1.13 BSD version\nVersion: ${version}\nURL: https://github.com/xianyi/OpenBLAS\nLibs: -L${libdir} -lopenblas\nLibs.private: ${extralib}\nCflags: -I${includedir}\n```\n\nThe problem is elsewhere...",
    "created_at": "2019-12-13T23:18:54Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435587",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:36'></a>
Replying to [dimpase](#comment%3A35):
> Replying to [charpent](#comment%3A31):
> > Replying to [dimpase](#comment%3A30):
> > > what does 
> > > 
> > > ```
> > > pkg-config --list-all | grep blas
> > > ```
> > > show? 

> > 
> > 
> > ```
> > charpent@zen-book-flip:~$ pkg-config --list-all | grep blas
> > lapack-openblas                openblas-lapack - Optimized BLAS (linear algebra) library, LAPACK
> > blas                           openblas-blas - Optimized BLAS (linear algebra) library based on GotoBLAS2
> > blas-openblas                  openblas-blas - Optimized BLAS (linear algebra) library based on GotoBLAS2
> > lapack                         openblas-lapack - Optimized BLAS (linear algebra) library, LAPACK
> > blas-netlib                    BLAS - FORTRAN reference implementation of BLAS Basic Linear Algebra Subprograms
> > ```

> 
> So in their infinite wisdom they removed `openblas.pc` all together.
> Not sure it's a Debian bug (note that upstream openblas does create such a file, so it's really an incompatible Debian invention here).


Nope:

```
charpent@zen-book-flip:~$ ls -l /usr/lib/x86_64-linux-gnu/openblas-pthread/pkgconfig/openblas.pc 
-rw-r--r-- 1 root root 570 déc.   2 06:33 /usr/lib/x86_64-linux-gnu/openblas-pthread/pkgconfig/openblas.pc
charpent@zen-book-flip:~$ cat /usr/lib/x86_64-linux-gnu/openblas-pthread/pkgconfig/openblas.pc 
libdir=/usr/lib/x86_64-linux-gnu/openblas-pthread/
includedir=/usr/include/x86_64-linux-gnu/openblas-pthread/
openblas_config= USE_64BITINT= DYNAMIC_ARCH=1 DYNAMIC_OLDER=1 NO_CBLAS= NO_LAPACK= NO_LAPACKE=1 NO_AFFINITY=1 USE_OPENMP=0 generic MAX_THREADS=64
version=0.3.7
extralib=-lm -lpthread -lgfortran -lm -lpthread -lgfortran
Name: openblas
Description: OpenBLAS is an optimized BLAS library based on GotoBLAS2 1.13 BSD version
Version: ${version}
URL: https://github.com/xianyi/OpenBLAS
Libs: -L${libdir} -lopenblas
Libs.private: ${extralib}
Cflags: -I${includedir}
```

The problem is elsewhere...



---

archive/issue_comments_435588.json:
```json
{
    "body": "<a id='comment:37'></a>\nNote, however,that my `locate` finds the `openblas.pc` created in my various Sage trees, but **not** the systewide one.\n\nI don't recall having ever fiddled with its configuration.\n\nReplying to [charpent](#comment%3A36):\n> Replying to [dimpase](#comment%3A35):\n> > Replying to [charpent](#comment%3A31):\n> > > Replying to [dimpase](#comment%3A30):\n> > > > what does \n> > > > \n> > > > ```\n> > > > pkg-config --list-all | grep blas\n> > > > ```\n> > > > show? \n\n> > > \n> > > \n> > > ```\n> > > charpent@zen-book-flip:~$ pkg-config --list-all | grep blas\n> > > lapack-openblas                openblas-lapack - Optimized BLAS (linear algebra) library, LAPACK\n> > > blas                           openblas-blas - Optimized BLAS (linear algebra) library based on GotoBLAS2\n> > > blas-openblas                  openblas-blas - Optimized BLAS (linear algebra) library based on GotoBLAS2\n> > > lapack                         openblas-lapack - Optimized BLAS (linear algebra) library, LAPACK\n> > > blas-netlib                    BLAS - FORTRAN reference implementation of BLAS Basic Linear Algebra Subprograms\n> > > ```\n\n> > \n> > So in their infinite wisdom they removed `openblas.pc` all together.\n> > Not sure it's a Debian bug (note that upstream openblas does create such a file, so it's really an incompatible Debian invention here).\n\n> \n> Nope:\n> \n> ```\n> charpent@zen-book-flip:~$ ls -l /usr/lib/x86_64-linux-gnu/openblas-pthread/pkgconfig/openblas.pc \n> -rw-r--r-- 1 root root 570 d\u00e9c.   2 06:33 /usr/lib/x86_64-linux-gnu/openblas-pthread/pkgconfig/openblas.pc\n> charpent@zen-book-flip:~$ cat /usr/lib/x86_64-linux-gnu/openblas-pthread/pkgconfig/openblas.pc \n> libdir=/usr/lib/x86_64-linux-gnu/openblas-pthread/\n> includedir=/usr/include/x86_64-linux-gnu/openblas-pthread/\n> openblas_config= USE_64BITINT= DYNAMIC_ARCH=1 DYNAMIC_OLDER=1 NO_CBLAS= NO_LAPACK= NO_LAPACKE=1 NO_AFFINITY=1 USE_OPENMP=0 generic MAX_THREADS=64\n> version=0.3.7\n> extralib=-lm -lpthread -lgfortran -lm -lpthread -lgfortran\n> Name: openblas\n> Description: OpenBLAS is an optimized BLAS library based on GotoBLAS2 1.13 BSD version\n> Version: ${version}\n> URL: https://github.com/xianyi/OpenBLAS\n> Libs: -L${libdir} -lopenblas\n> Libs.private: ${extralib}\n> Cflags: -I${includedir}\n> ```\n> \n> The problem is elsewhere...\n\n>",
    "created_at": "2019-12-13T23:23:50Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435588",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:37'></a>
Note, however,that my `locate` finds the `openblas.pc` created in my various Sage trees, but **not** the systewide one.

I don't recall having ever fiddled with its configuration.

Replying to [charpent](#comment%3A36):
> Replying to [dimpase](#comment%3A35):
> > Replying to [charpent](#comment%3A31):
> > > Replying to [dimpase](#comment%3A30):
> > > > what does 
> > > > 
> > > > ```
> > > > pkg-config --list-all | grep blas
> > > > ```
> > > > show? 

> > > 
> > > 
> > > ```
> > > charpent@zen-book-flip:~$ pkg-config --list-all | grep blas
> > > lapack-openblas                openblas-lapack - Optimized BLAS (linear algebra) library, LAPACK
> > > blas                           openblas-blas - Optimized BLAS (linear algebra) library based on GotoBLAS2
> > > blas-openblas                  openblas-blas - Optimized BLAS (linear algebra) library based on GotoBLAS2
> > > lapack                         openblas-lapack - Optimized BLAS (linear algebra) library, LAPACK
> > > blas-netlib                    BLAS - FORTRAN reference implementation of BLAS Basic Linear Algebra Subprograms
> > > ```

> > 
> > So in their infinite wisdom they removed `openblas.pc` all together.
> > Not sure it's a Debian bug (note that upstream openblas does create such a file, so it's really an incompatible Debian invention here).

> 
> Nope:
> 
> ```
> charpent@zen-book-flip:~$ ls -l /usr/lib/x86_64-linux-gnu/openblas-pthread/pkgconfig/openblas.pc 
> -rw-r--r-- 1 root root 570 déc.   2 06:33 /usr/lib/x86_64-linux-gnu/openblas-pthread/pkgconfig/openblas.pc
> charpent@zen-book-flip:~$ cat /usr/lib/x86_64-linux-gnu/openblas-pthread/pkgconfig/openblas.pc 
> libdir=/usr/lib/x86_64-linux-gnu/openblas-pthread/
> includedir=/usr/include/x86_64-linux-gnu/openblas-pthread/
> openblas_config= USE_64BITINT= DYNAMIC_ARCH=1 DYNAMIC_OLDER=1 NO_CBLAS= NO_LAPACK= NO_LAPACKE=1 NO_AFFINITY=1 USE_OPENMP=0 generic MAX_THREADS=64
> version=0.3.7
> extralib=-lm -lpthread -lgfortran -lm -lpthread -lgfortran
> Name: openblas
> Description: OpenBLAS is an optimized BLAS library based on GotoBLAS2 1.13 BSD version
> Version: ${version}
> URL: https://github.com/xianyi/OpenBLAS
> Libs: -L${libdir} -lopenblas
> Libs.private: ${extralib}
> Cflags: -I${includedir}
> ```
> 
> The problem is elsewhere...

>



---

archive/issue_comments_435589.json:
```json
{
    "body": "<a id='comment:38'></a>\nWell, this pretty much looks like a Debian bug. The point of installing `openblas.pc` into a hidden from `pkg-config` directory only makes sense if they plan to install \"competing\" versions of this file in different locations...",
    "created_at": "2019-12-13T23:30:05Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435589",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:38'></a>
Well, this pretty much looks like a Debian bug. The point of installing `openblas.pc` into a hidden from `pkg-config` directory only makes sense if they plan to install "competing" versions of this file in different locations...



---

archive/issue_comments_435590.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [dimpase](#comment%3A38):\n> Well, this pretty much looks like a Debian bug. The point of installing `openblas.pc` into a hidden from `pkg-config` directory only makes sense if they plan to install \"competing\" versions of this file in different locations...\n\n\nThis is now [Debian bug 946698 ](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=946698). For what it's worth...",
    "created_at": "2019-12-14T00:05:56Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435590",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:39'></a>
Replying to [dimpase](#comment%3A38):
> Well, this pretty much looks like a Debian bug. The point of installing `openblas.pc` into a hidden from `pkg-config` directory only makes sense if they plan to install "competing" versions of this file in different locations...


This is now [Debian bug 946698 ](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=946698). For what it's worth...



---

archive/issue_comments_435591.json:
```json
{
    "body": "<a id='comment:40'></a>\nFor me, this fixes the problem.\n\n```diff\ndiff --git a/build/pkgs/numpy/lapack_conf.py b/build/pkgs/numpy/lapack_conf.py\nindex d127d08def..f1bc559cfa 100644\n--- a/build/pkgs/numpy/lapack_conf.py\n+++ b/build/pkgs/numpy/lapack_conf.py\n@@ -8,7 +8,7 @@ conf_file.write('[ALL]\\n')\n conf_file.write('library_dirs = '+ os.environ['SAGE_LOCAL']+ '/lib\\n')\n conf_file.write('include_dirs = '+ os.environ['SAGE_LOCAL']+ '/include\\n')\n \n-pc_blas   = pkgconfig.parse('cblas blas')\n+pc_blas   = pkgconfig.parse('blas')\n pc_lapack = pkgconfig.parse('lapack')\n \n if not (os.environ['UNAME'] == 'Darwin'):\n```\nIf I run `./sage --python`:\n\n```pycon\n>>> import pkgconfig\n>>> pkgconfig.parse('blas')\ndefaultdict(<class 'list'>, {'include_dirs': ['/usr/include/x86_64-linux-gnu'], 'libraries': ['openblas'], 'define_macros': []})\n>>> pkgconfig.parse('cblas blas')\ndefaultdict(<class 'list'>, {'define_macros': []})\n```\nI don't know why the space-separated list doesn't work. It is supposed to, according to the documentation. As far as I can tell, it doesn't find a cblas package, and maybe that confuses it. (it = `pkgconfig.parse`)",
    "created_at": "2019-12-14T00:23:51Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435591",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:40'></a>
For me, this fixes the problem.

```diff
diff --git a/build/pkgs/numpy/lapack_conf.py b/build/pkgs/numpy/lapack_conf.py
index d127d08def..f1bc559cfa 100644
--- a/build/pkgs/numpy/lapack_conf.py
+++ b/build/pkgs/numpy/lapack_conf.py
@@ -8,7 +8,7 @@ conf_file.write('[ALL]\n')
 conf_file.write('library_dirs = '+ os.environ['SAGE_LOCAL']+ '/lib\n')
 conf_file.write('include_dirs = '+ os.environ['SAGE_LOCAL']+ '/include\n')
 
-pc_blas   = pkgconfig.parse('cblas blas')
+pc_blas   = pkgconfig.parse('blas')
 pc_lapack = pkgconfig.parse('lapack')
 
 if not (os.environ['UNAME'] == 'Darwin'):
```
If I run `./sage --python`:

```pycon
>>> import pkgconfig
>>> pkgconfig.parse('blas')
defaultdict(<class 'list'>, {'include_dirs': ['/usr/include/x86_64-linux-gnu'], 'libraries': ['openblas'], 'define_macros': []})
>>> pkgconfig.parse('cblas blas')
defaultdict(<class 'list'>, {'define_macros': []})
```
I don't know why the space-separated list doesn't work. It is supposed to, according to the documentation. As far as I can tell, it doesn't find a cblas package, and maybe that confuses it. (it = `pkgconfig.parse`)



---

archive/issue_comments_435592.json:
```json
{
    "body": "<a id='comment:41'></a>\nI originally followed the model of the gentoo ebuild for figuring out the needed blas/cblas bits. Of course if you standardise on openblas this is not so needed.\n\nDebian and now gentoo have this model where you have just `libblas.so`, `libcblas.so` and `liblapack.so` and what is underneath can be changed at runtime. So you don't need to know the implementation. On the other hand numpy has this detection model trying to figure what implementation you may have to figure the correct libraries. It used to be that something different would be built depending on implementation but not anymore. Honestly trying to figure which blas/lapack you are using leads to madness :( which is why we steered towards having standard named .pc files. And historically we shaved some bits from numpy's detection machinery.\n\nOn my TODO list is to switch my sage-on-gentoo from openblas to mkl. The runtime switch means that it should be quick and easy.\n\nThe stuff about `pkgconfig.parse` should be reported as a bug. Although we should check we have currently the latest version first.",
    "created_at": "2019-12-14T00:39:11Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435592",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:41'></a>
I originally followed the model of the gentoo ebuild for figuring out the needed blas/cblas bits. Of course if you standardise on openblas this is not so needed.

Debian and now gentoo have this model where you have just `libblas.so`, `libcblas.so` and `liblapack.so` and what is underneath can be changed at runtime. So you don't need to know the implementation. On the other hand numpy has this detection model trying to figure what implementation you may have to figure the correct libraries. It used to be that something different would be built depending on implementation but not anymore. Honestly trying to figure which blas/lapack you are using leads to madness :( which is why we steered towards having standard named .pc files. And historically we shaved some bits from numpy's detection machinery.

On my TODO list is to switch my sage-on-gentoo from openblas to mkl. The runtime switch means that it should be quick and easy.

The stuff about `pkgconfig.parse` should be reported as a bug. Although we should check we have currently the latest version first.



---

archive/issue_comments_435593.json:
```json
{
    "body": "<a id='comment:42'></a>\nwith up-to-date pkgconfig (version 1.5.1)\nI get \n\n```\n$ ./sage --python\nPython 3.7.3 (default, Dec 13 2019, 17:59:09) \n[GCC 8.3.0] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import pkgconfig\n>>> pkgconfig.parse('blas')\ndefaultdict(<class 'list'>, {'include_dirs': ['/usr/include/x86_64-linux-gnu'], 'libraries': ['openblas']})\n>>> pkgconfig.parse('cblas blas')\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/home/dimpase/sage/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py\", line 248, in parse\n    _raise_if_not_exists(package)\n  File \"/home/dimpase/sage/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py\", line 103, in _raise_if_not_exists\n    raise PackageNotFoundError(package)\npkgconfig.pkgconfig.PackageNotFoundError: cblas not found\n>>> \n```\nThat is, after the update the script might just error out (`cblas` need not be present)",
    "created_at": "2019-12-14T01:51:01Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435593",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:42'></a>
with up-to-date pkgconfig (version 1.5.1)
I get 

```
$ ./sage --python
Python 3.7.3 (default, Dec 13 2019, 17:59:09) 
[GCC 8.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import pkgconfig
>>> pkgconfig.parse('blas')
defaultdict(<class 'list'>, {'include_dirs': ['/usr/include/x86_64-linux-gnu'], 'libraries': ['openblas']})
>>> pkgconfig.parse('cblas blas')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/home/dimpase/sage/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py", line 248, in parse
    _raise_if_not_exists(package)
  File "/home/dimpase/sage/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py", line 103, in _raise_if_not_exists
    raise PackageNotFoundError(package)
pkgconfig.pkgconfig.PackageNotFoundError: cblas not found
>>> 
```
That is, after the update the script might just error out (`cblas` need not be present)



---

archive/issue_comments_435594.json:
```json
{
    "body": "<a id='comment:43'></a>\nReplying to [dimpase](#comment%3A42):\n> with up-to-date pkgconfig (version 1.5.1)\n> I get \n> \n> ```\n> $ ./sage --python\n> Python 3.7.3 (default, Dec 13 2019, 17:59:09) \n> [GCC 8.3.0] on linux\n> Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n> >>> import pkgconfig\n> >>> pkgconfig.parse('blas')\n> defaultdict(<class 'list'>, {'include_dirs': ['/usr/include/x86_64-linux-gnu'], 'libraries': ['openblas']})\n> >>> pkgconfig.parse('cblas blas')\n> Traceback (most recent call last):\n>   File \"<stdin>\", line 1, in <module>\n>   File \"/home/dimpase/sage/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py\", line 248, in parse\n>     _raise_if_not_exists(package)\n>   File \"/home/dimpase/sage/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py\", line 103, in _raise_if_not_exists\n>     raise PackageNotFoundError(package)\n> pkgconfig.pkgconfig.PackageNotFoundError: cblas not found\n> >>> \n> ```\n> That is, after the update the script might just error out (`cblas` need not be present) \n\n\nYes. So I think for that part\n1. upgrade `pkgconfig`\n2. put a `try`-`expect` block in the script\nfirst we try with both, if the right exception is raised we try only `blas` and if that errors too, something is wrong and we should bail out.",
    "created_at": "2019-12-14T02:07:35Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435594",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:43'></a>
Replying to [dimpase](#comment%3A42):
> with up-to-date pkgconfig (version 1.5.1)
> I get 
> 
> ```
> $ ./sage --python
> Python 3.7.3 (default, Dec 13 2019, 17:59:09) 
> [GCC 8.3.0] on linux
> Type "help", "copyright", "credits" or "license" for more information.
> >>> import pkgconfig
> >>> pkgconfig.parse('blas')
> defaultdict(<class 'list'>, {'include_dirs': ['/usr/include/x86_64-linux-gnu'], 'libraries': ['openblas']})
> >>> pkgconfig.parse('cblas blas')
> Traceback (most recent call last):
>   File "<stdin>", line 1, in <module>
>   File "/home/dimpase/sage/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py", line 248, in parse
>     _raise_if_not_exists(package)
>   File "/home/dimpase/sage/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py", line 103, in _raise_if_not_exists
>     raise PackageNotFoundError(package)
> pkgconfig.pkgconfig.PackageNotFoundError: cblas not found
> >>> 
> ```
> That is, after the update the script might just error out (`cblas` need not be present) 


Yes. So I think for that part
1. upgrade `pkgconfig`
2. put a `try`-`expect` block in the script
first we try with both, if the right exception is raised we try only `blas` and if that errors too, something is wrong and we should bail out.



---

archive/issue_comments_435595.json:
```json
{
    "body": "<a id='comment:44'></a>\nI've opened #28883 for pkgconfig upgrade. \n\nI should also add cblas to the list of link the branch here is installing.",
    "created_at": "2019-12-14T02:27:50Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435595",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:44'></a>
I've opened #28883 for pkgconfig upgrade. 

I should also add cblas to the list of link the branch here is installing.



---

archive/issue_comments_435596.json:
```json
{
    "body": "**Dependencies:** #28883",
    "created_at": "2019-12-14T02:27:50Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435596",
    "user": "https://github.com/dimpase"
}
```

**Dependencies:** #28883



---

archive/issue_comments_435597.json:
```json
{
    "body": "<a id='comment:45'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5c91dbb4d313d43f05cf3d33fc1758ac089613d\">e5c91db</a></td><td><code>update pkgconfig to v1.5.1. See trac #28883</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1720b38cdca1aa6c436a4b579545c227d3a313fc\">1720b38</a></td><td><code>a bare minumim openblas config</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/925266bfb2e8446e4fadd09eea86d7c04534eed6\">925266b</a></td><td><code>use openblas.pc for blas and lapack, don't require atlas is to be used</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b89df80e245766884e59d78accfe809e240ad2ba\">b89df80</a></td><td><code>move blas handling to build/pkgs/</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/634157628ac3f7292e7065eae462bb6b80db7aed\">6341576</a></td><td><code>create cblas.pc link, too, not only blas and lapack</code></td></tr></table>\n",
    "created_at": "2019-12-14T10:00:43Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435597",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5c91dbb4d313d43f05cf3d33fc1758ac089613d">e5c91db</a></td><td><code>update pkgconfig to v1.5.1. See trac #28883</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1720b38cdca1aa6c436a4b579545c227d3a313fc">1720b38</a></td><td><code>a bare minumim openblas config</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/925266bfb2e8446e4fadd09eea86d7c04534eed6">925266b</a></td><td><code>use openblas.pc for blas and lapack, don't require atlas is to be used</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b89df80e245766884e59d78accfe809e240ad2ba">b89df80</a></td><td><code>move blas handling to build/pkgs/</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/634157628ac3f7292e7065eae462bb6b80db7aed">6341576</a></td><td><code>create cblas.pc link, too, not only blas and lapack</code></td></tr></table>




---

archive/issue_comments_435598.json:
```json
{
    "body": "**Changing commit** from \"[cb725d388640d1791778cb5788cdc2ee9482581e](https://github.com/sagemath/sagetrac-mirror/commit/cb725d388640d1791778cb5788cdc2ee9482581e)\" to \"[634157628ac3f7292e7065eae462bb6b80db7aed](https://github.com/sagemath/sagetrac-mirror/commit/634157628ac3f7292e7065eae462bb6b80db7aed)\".",
    "created_at": "2019-12-14T10:00:43Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435598",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[cb725d388640d1791778cb5788cdc2ee9482581e](https://github.com/sagemath/sagetrac-mirror/commit/cb725d388640d1791778cb5788cdc2ee9482581e)" to "[634157628ac3f7292e7065eae462bb6b80db7aed](https://github.com/sagemath/sagetrac-mirror/commit/634157628ac3f7292e7065eae462bb6b80db7aed)".



---

archive/issue_events_245909.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-14T11:09:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245909"
}
```



---

archive/issue_events_245910.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-14T11:09:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245910"
}
```



---

archive/issue_comments_435599.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"spkg-configure\".",
    "created_at": "2019-12-14T11:09:57Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435599",
    "user": "https://github.com/dimpase"
}
```

**Changing keywords** from "" to "spkg-configure".



---

archive/issue_comments_435600.json:
```json
{
    "body": "<a id='comment:47'></a>\nPossibly dumb question: why are we looking for `openblas` rather than for `blas` and `lapack` ?\n\nFrom my systemwide Debian pkg-confi (afrter a reboot):\n\n```\ncharpent@zen-book-flip:/usr/local/sage-9$ pkg-config --libs --cflags openblas\nPackage openblas was not found in the pkg-config search path.\nPerhaps you should add the directory containing `openblas.pc'\nto the PKG_CONFIG_PATH environment variable\nNo package 'openblas' found\ncharpent@zen-book-flip:/usr/local/sage-9$ pkg-config --libs --cflags blas\n-I/usr/include/x86_64-linux-gnu -L/usr/lib/x86_64-linux-gnu/openblas -lblas\ncharpent@zen-book-flip:/usr/local/sage-9$ pkg-config --libs --cflags lapack\n-I/usr/include/x86_64-linux-gnu -L/usr/lib/x86_64-linux-gnu/openblas -llapack\n```\n\n[ Snip... ]",
    "created_at": "2019-12-14T16:16:35Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435600",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:47'></a>
Possibly dumb question: why are we looking for `openblas` rather than for `blas` and `lapack` ?

From my systemwide Debian pkg-confi (afrter a reboot):

```
charpent@zen-book-flip:/usr/local/sage-9$ pkg-config --libs --cflags openblas
Package openblas was not found in the pkg-config search path.
Perhaps you should add the directory containing `openblas.pc'
to the PKG_CONFIG_PATH environment variable
No package 'openblas' found
charpent@zen-book-flip:/usr/local/sage-9$ pkg-config --libs --cflags blas
-I/usr/include/x86_64-linux-gnu -L/usr/lib/x86_64-linux-gnu/openblas -lblas
charpent@zen-book-flip:/usr/local/sage-9$ pkg-config --libs --cflags lapack
-I/usr/include/x86_64-linux-gnu -L/usr/lib/x86_64-linux-gnu/openblas -llapack
```

[ Snip... ]



---

archive/issue_comments_435601.json:
```json
{
    "body": "<a id='comment:48'></a>\nit seems to be Debian (testing/unstable) bug.",
    "created_at": "2019-12-14T16:31:18Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435601",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:48'></a>
it seems to be Debian (testing/unstable) bug.



---

archive/issue_comments_435602.json:
```json
{
    "body": "<a id='comment:49'></a>\n\"generic\" blas and lapack may be very different from what Sage needs, it is a tough call to test whether everything needed is there.",
    "created_at": "2019-12-14T16:43:58Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435602",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:49'></a>
"generic" blas and lapack may be very different from what Sage needs, it is a tough call to test whether everything needed is there.



---

archive/issue_comments_435603.json:
```json
{
    "body": "<a id='comment:50'></a>\nWell... Starting from #28883, I created a local branch in which I merged #27870, then `make openblas-clean`, then `./bootstrap`, then `./configure`.\n\nWhen I started make, the first thing it did was to recompile openblas...\n\nAnd, sure enough, my `config.log` contains:\n\n```\nconfigure:11316: === checking whether to install the openblas SPKG ===\nconfigure:11334: checking BLAS library\nconfigure:11353: result: openblas\nconfigure:11395: checking for OPENBLAS\nconfigure:11402: $PKG_CONFIG --exists --print-errors \"openblas >= 0.3.5\"\nPackage openblas was not found in the pkg-config search path.\nPerhaps you should add the directory containing `openblas.pc'\nto the PKG_CONFIG_PATH environment variable\nNo package 'openblas' found\nconfigure:11405: $? = 1\nconfigure:11419: $PKG_CONFIG --exists --print-errors \"openblas >= 0.3.5\"\nPackage openblas was not found in the pkg-config search path.\nPerhaps you should add the directory containing `openblas.pc'\nto the PKG_CONFIG_PATH environment variable\nNo package 'openblas' found\nconfigure:11422: $? = 1\nconfigure:11436: result: no\nNo package 'openblas' found\n```",
    "created_at": "2019-12-14T16:58:26Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435603",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:50'></a>
Well... Starting from #28883, I created a local branch in which I merged #27870, then `make openblas-clean`, then `./bootstrap`, then `./configure`.

When I started make, the first thing it did was to recompile openblas...

And, sure enough, my `config.log` contains:

```
configure:11316: === checking whether to install the openblas SPKG ===
configure:11334: checking BLAS library
configure:11353: result: openblas
configure:11395: checking for OPENBLAS
configure:11402: $PKG_CONFIG --exists --print-errors "openblas >= 0.3.5"
Package openblas was not found in the pkg-config search path.
Perhaps you should add the directory containing `openblas.pc'
to the PKG_CONFIG_PATH environment variable
No package 'openblas' found
configure:11405: $? = 1
configure:11419: $PKG_CONFIG --exists --print-errors "openblas >= 0.3.5"
Package openblas was not found in the pkg-config search path.
Perhaps you should add the directory containing `openblas.pc'
to the PKG_CONFIG_PATH environment variable
No package 'openblas' found
configure:11422: $? = 1
configure:11436: result: no
No package 'openblas' found
```



---

archive/issue_comments_435604.json:
```json
{
    "body": "<a id='comment:51'></a>\n#28883 has nothing to do with testing Debian distro bug that you reported, it is meant for MacOS problem reported by John.\n\nIf you want to try to use the `openblas.pc` you have, you can do\n\n```\nexport PKG_CONFIG_PATH=\"/usr/lib/x86_64-linux-gnu/openblas-pthread/pkgconfig\"\nmake openblas-clean\n./configure # - and check the output - for openblas not being installed\n```\nif this worked you can try building, i.e. `make` or `make build`...",
    "created_at": "2019-12-14T17:40:38Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435604",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:51'></a>
#28883 has nothing to do with testing Debian distro bug that you reported, it is meant for MacOS problem reported by John.

If you want to try to use the `openblas.pc` you have, you can do

```
export PKG_CONFIG_PATH="/usr/lib/x86_64-linux-gnu/openblas-pthread/pkgconfig"
make openblas-clean
./configure # - and check the output - for openblas not being installed
```
if this worked you can try building, i.e. `make` or `make build`...



---

archive/issue_comments_435605.json:
```json
{
    "body": "<a id='comment:52'></a>\nIt's true I usually use MacOS, but for this ticket I've been using an Ubuntu virtual machine, so #28883 is relevant.",
    "created_at": "2019-12-14T17:53:01Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435605",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:52'></a>
It's true I usually use MacOS, but for this ticket I've been using an Ubuntu virtual machine, so #28883 is relevant.



---

archive/issue_comments_435606.json:
```json
{
    "body": "<a id='comment:53'></a>\nReplying to [jhpalmieri](#comment%3A52):\n> It's true I usually use MacOS, but for this ticket I've been using an Ubuntu virtual machine, so #28883 is relevant.\n\n\nright, indeed. Anyway, #28883 is meant to fix a problem with building numpy with already configured external openblas, rather than a configuration problem of newer Debians.",
    "created_at": "2019-12-14T18:11:36Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435606",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:53'></a>
Replying to [jhpalmieri](#comment%3A52):
> It's true I usually use MacOS, but for this ticket I've been using an Ubuntu virtual machine, so #28883 is relevant.


right, indeed. Anyway, #28883 is meant to fix a problem with building numpy with already configured external openblas, rather than a configuration problem of newer Debians.



---

archive/issue_comments_435607.json:
```json
{
    "body": "<a id='comment:54'></a>\nReplying to [dimpase](#comment%3A51):\n> #28883 has nothing to do with testing Debian distro bug that you reported, it is meant for MacOS problem reported by John.\n> \n> If you want to try to use the `openblas.pc` you have, you can do\n> \n> ```\n> export PKG_CONFIG_PATH=\"/usr/lib/x86_64-linux-gnu/openblas-pthread/pkgconfig\"\n> make openblas-clean\n> ./configure # - and check the output - for openblas not being installed\n> ```\n> if this worked you can try building, i.e. `make` or `make build`...\n\n\nThis *seems* to have worked. Now `make`ing. Don't hold your breath...\n\n**EDIT :** `make` went directly to building the docs, which seems fishy : I expected it to recompile openblas-dependent packages (among them R). But these binaries somehow have caught the change :\n\n```\ncharpent@zen-book-flip:/usr/local/sage-9$ ./sage -R\n\nR version 3.6.1 (2019-07-05) -- \"Action of the Toes\"\n\n[ Snip ... ]\n\n> sessionInfo()\nR version 3.6.1 (2019-07-05)\nPlatform: x86_64-pc-linux-gnu (64-bit)\nRunning under: Debian GNU/Linux bullseye/sid\n\nMatrix products: default\nBLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.7.so\n\n[ re-Snip... ]\n\n```\n\nSo it seems to work.\n\nIn your opinion (prbably better than mine), is the need to set PKG_CONFIG_PATH enough to block a `positive review` ?\n\nAnyway, `ptestlong` underway...",
    "created_at": "2019-12-14T18:41:41Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435607",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:54'></a>
Replying to [dimpase](#comment%3A51):
> #28883 has nothing to do with testing Debian distro bug that you reported, it is meant for MacOS problem reported by John.
> 
> If you want to try to use the `openblas.pc` you have, you can do
> 
> ```
> export PKG_CONFIG_PATH="/usr/lib/x86_64-linux-gnu/openblas-pthread/pkgconfig"
> make openblas-clean
> ./configure # - and check the output - for openblas not being installed
> ```
> if this worked you can try building, i.e. `make` or `make build`...


This *seems* to have worked. Now `make`ing. Don't hold your breath...

**EDIT :** `make` went directly to building the docs, which seems fishy : I expected it to recompile openblas-dependent packages (among them R). But these binaries somehow have caught the change :

```
charpent@zen-book-flip:/usr/local/sage-9$ ./sage -R

R version 3.6.1 (2019-07-05) -- "Action of the Toes"

[ Snip ... ]

> sessionInfo()
R version 3.6.1 (2019-07-05)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Debian GNU/Linux bullseye/sid

Matrix products: default
BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.7.so

[ re-Snip... ]

```

So it seems to work.

In your opinion (prbably better than mine), is the need to set PKG_CONFIG_PATH enough to block a `positive review` ?

Anyway, `ptestlong` underway...



---

archive/issue_comments_435608.json:
```json
{
    "body": "<a id='comment:55'></a>\nHow can a bug in Debian, which can be worked around by setting appropriately `PKG_CONFIG_PATH`, be a blocker to this? It cannot work for all the broken systems out there  :-)\n\nE.g. Homebrew (on MacOS) also installs openblas somewhere strange, with a need to set `PKG_CONFIG_PATH` (it tells you this, actually).",
    "created_at": "2019-12-14T18:57:31Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435608",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:55'></a>
How can a bug in Debian, which can be worked around by setting appropriately `PKG_CONFIG_PATH`, be a blocker to this? It cannot work for all the broken systems out there  :-)

E.g. Homebrew (on MacOS) also installs openblas somewhere strange, with a need to set `PKG_CONFIG_PATH` (it tells you this, actually).



---

archive/issue_events_245911.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2019-12-14T20:29:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245911"
}
```



---

archive/issue_events_245912.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2019-12-14T20:29:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245912"
}
```



---

archive/issue_comments_435609.json:
```json
{
    "body": "<a id='comment:56'></a>\nReplying to [dimpase](#comment%3A55):\n> How can a bug in Debian, which can be worked around by setting appropriately `PKG_CONFIG_PATH`, be a blocker to this? It cannot work for all the broken systems out there  :-)\n> \n> E.g. Homebrew (on MacOS) also installs openblas somewhere strange, with a need to set `PKG_CONFIG_PATH` (it tells you this, actually).\n\n\nOkay.\n\nAnyway, `ptestlong` gets two permanent failures (and no transient):\n\n```\ncharpent@zen-book-flip:/usr/local/sage-9$ sage -t --long --warn-long 178.2 src/sage/numerical/backends/glpk_backend.pyx  # 1 doctest failed\nRunning doctests with ID 2019-12-14-21-20-56-a860b5d2.\nGit branch: t/27870/packages/openblas/openblasconf\nUsing --optional=build,dochtml,memlimit,sage\nDoctesting 1 file.\nsage -t --long --warn-long 178.2 src/sage/numerical/backends/glpk_backend.pyx\n**********************************************************************\nFile \"src/sage/numerical/backends/glpk_backend.pyx\", line 2287, in sage.numerical.backends.glpk_backend.GLPKBackend.print_ranges\nFailed example:\n    p.print_ranges()\nExpected:\n    glp_print_ranges: optimal basic solution required\n    1\nGot:\n    1\n**********************************************************************\n1 item had failures:\n   1 of  13 in sage.numerical.backends.glpk_backend.GLPKBackend.print_ranges\n    [554 tests, 1 failure, 3.70 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 178.2 src/sage/numerical/backends/glpk_backend.pyx  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 3.8 seconds\n    cpu time: 3.6 seconds\n    cumulative wall time: 3.7 seconds\n```\n\n```\ncharpent@zen-book-flip:/usr/local/sage-9$ sage -t --long --warn-long 178.2 src/sage/libs/glpk/error.pyx  # 1 doctest failed\nRunning doctests with ID 2019-12-14-21-21-18-8e3dc9e1.\nGit branch: t/27870/packages/openblas/openblasconf\nUsing --optional=build,dochtml,memlimit,sage\nDoctesting 1 file.\nsage -t --long --warn-long 178.2 src/sage/libs/glpk/error.pyxThos failures have already been reported for the same machine \n**********************************************************************\nFile \"src/sage/libs/glpk/error.pyx\", line 100, in sage.libs.glpk.error.setup_glpk_error_handler\nFailed example:\n    res = p.solve()\nExpected:\n          0: obj = ...\nGot:\n    <BLANKLINE>\n**********************************************************************\n1 item had failures:\n   1 of  11 in sage.libs.glpk.error.setup_glpk_error_handler\n    [12 tests, 1 failure, 0.72 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 178.2 src/sage/libs/glpk/error.pyx  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.7 seconds\n    cpu time: 0.4 seconds\n    cumulative wall time: 0.7 seconds\n```\n\nThose failures were already reported (in [sage-release](https://groups.google.com/d/msg/sage-release/p3mnazZ58HQ/0neeoSraBQAJ)) for the same machine and the same version of (Python 3-based) 9.0.beta9. Therefore, they do  do not seem to be related to the current patch.\n\n==> `positive_review`, subject to better-informed advice...",
    "created_at": "2019-12-14T20:29:47Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435609",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:56'></a>
Replying to [dimpase](#comment%3A55):
> How can a bug in Debian, which can be worked around by setting appropriately `PKG_CONFIG_PATH`, be a blocker to this? It cannot work for all the broken systems out there  :-)
> 
> E.g. Homebrew (on MacOS) also installs openblas somewhere strange, with a need to set `PKG_CONFIG_PATH` (it tells you this, actually).


Okay.

Anyway, `ptestlong` gets two permanent failures (and no transient):

```
charpent@zen-book-flip:/usr/local/sage-9$ sage -t --long --warn-long 178.2 src/sage/numerical/backends/glpk_backend.pyx  # 1 doctest failed
Running doctests with ID 2019-12-14-21-20-56-a860b5d2.
Git branch: t/27870/packages/openblas/openblasconf
Using --optional=build,dochtml,memlimit,sage
Doctesting 1 file.
sage -t --long --warn-long 178.2 src/sage/numerical/backends/glpk_backend.pyx
**********************************************************************
File "src/sage/numerical/backends/glpk_backend.pyx", line 2287, in sage.numerical.backends.glpk_backend.GLPKBackend.print_ranges
Failed example:
    p.print_ranges()
Expected:
    glp_print_ranges: optimal basic solution required
    1
Got:
    1
**********************************************************************
1 item had failures:
   1 of  13 in sage.numerical.backends.glpk_backend.GLPKBackend.print_ranges
    [554 tests, 1 failure, 3.70 s]
----------------------------------------------------------------------
sage -t --long --warn-long 178.2 src/sage/numerical/backends/glpk_backend.pyx  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 3.8 seconds
    cpu time: 3.6 seconds
    cumulative wall time: 3.7 seconds
```

```
charpent@zen-book-flip:/usr/local/sage-9$ sage -t --long --warn-long 178.2 src/sage/libs/glpk/error.pyx  # 1 doctest failed
Running doctests with ID 2019-12-14-21-21-18-8e3dc9e1.
Git branch: t/27870/packages/openblas/openblasconf
Using --optional=build,dochtml,memlimit,sage
Doctesting 1 file.
sage -t --long --warn-long 178.2 src/sage/libs/glpk/error.pyxThos failures have already been reported for the same machine 
**********************************************************************
File "src/sage/libs/glpk/error.pyx", line 100, in sage.libs.glpk.error.setup_glpk_error_handler
Failed example:
    res = p.solve()
Expected:
          0: obj = ...
Got:
    <BLANKLINE>
**********************************************************************
1 item had failures:
   1 of  11 in sage.libs.glpk.error.setup_glpk_error_handler
    [12 tests, 1 failure, 0.72 s]
----------------------------------------------------------------------
sage -t --long --warn-long 178.2 src/sage/libs/glpk/error.pyx  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 0.7 seconds
    cpu time: 0.4 seconds
    cumulative wall time: 0.7 seconds
```

Those failures were already reported (in [sage-release](https://groups.google.com/d/msg/sage-release/p3mnazZ58HQ/0neeoSraBQAJ)) for the same machine and the same version of (Python 3-based) 9.0.beta9. Therefore, they do  do not seem to be related to the current patch.

==> `positive_review`, subject to better-informed advice...



---

archive/issue_comments_435610.json:
```json
{
    "body": "<a id='comment:58'></a>\nWorks for me with conda.",
    "created_at": "2019-12-15T01:17:29Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435610",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:58'></a>
Works for me with conda.



---

archive/issue_comments_435611.json:
```json
{
    "body": "**Reviewer:** Isuru Fernando",
    "created_at": "2019-12-15T01:17:29Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435611",
    "user": "https://github.com/isuruf"
}
```

**Reviewer:** Isuru Fernando



---

archive/issue_events_245913.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-15T11:46:11Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245913"
}
```



---

archive/issue_events_245914.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-15T11:46:11Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245914"
}
```



---

archive/issue_comments_435612.json:
```json
{
    "body": "<a id='comment:60'></a>\nReplying to [charpent](#comment%3A39):\n> Replying to [dimpase](#comment%3A38):\n> > Well, this pretty much looks like a Debian bug. The point of installing `openblas.pc` into a hidden from `pkg-config` directory only makes sense if they plan to install \"competing\" versions of this file in different locations...\n\n> \n> This is now [Debian bug 946698 ](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=946698). For what it's worth...\n\n\nFWIW, this Debian bug is [claimed](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=946698).  to have been fixed. In about 45 hours... Pffew !",
    "created_at": "2019-12-16T09:47:39Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435612",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:60'></a>
Replying to [charpent](#comment%3A39):
> Replying to [dimpase](#comment%3A38):
> > Well, this pretty much looks like a Debian bug. The point of installing `openblas.pc` into a hidden from `pkg-config` directory only makes sense if they plan to install "competing" versions of this file in different locations...

> 
> This is now [Debian bug 946698 ](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=946698). For what it's worth...


FWIW, this Debian bug is [claimed](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=946698).  to have been fixed. In about 45 hours... Pffew !



---

archive/issue_comments_435613.json:
```json
{
    "body": "**Changing branch** from \"[u/dimpase/packages/openblas/openblasconf](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblas/openblasconf)\" to \"[634157628ac3f7292e7065eae462bb6b80db7aed](https://github.com/sagemath/sagetrac-mirror/commit/634157628ac3f7292e7065eae462bb6b80db7aed)\".",
    "created_at": "2019-12-20T22:46:06Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435613",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/dimpase/packages/openblas/openblasconf](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblas/openblasconf)" to "[634157628ac3f7292e7065eae462bb6b80db7aed](https://github.com/sagemath/sagetrac-mirror/commit/634157628ac3f7292e7065eae462bb6b80db7aed)".



---

archive/issue_events_245915.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-12-20T22:46:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245915"
}
```



---

archive/issue_events_245916.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-12-20T22:46:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245916"
}
```



---

archive/issue_comments_435614.json:
```json
{
    "body": "<a id='comment:62'></a>\nThis ticket breaks build on OSX:\n\n```\n************************************************************************\nTraceback (most recent call last):\n  File \"setup.py\", line 72, in <module>\n    from module_list import ext_modules, library_order\n  File \"/Users/buildbot-sage/slave/sage_git/build/src/module_list.py\", line 42, in <module>\n    zlib_pc = pkgconfig.parse('zlib')\n  File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py\", line 248, in parse\n    _raise_if_not_exists(package)\n  File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py\", line 103, in _raise_if_not_exists\n    raise PackageNotFoundError(package)\npkgconfig.pkgconfig.PackageNotFoundError: zlib not found\n************************************************************************\nError building the Sage library\n************************************************************************\n```",
    "created_at": "2019-12-22T15:16:26Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435614",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:62'></a>
This ticket breaks build on OSX:

```
************************************************************************
Traceback (most recent call last):
  File "setup.py", line 72, in <module>
    from module_list import ext_modules, library_order
  File "/Users/buildbot-sage/slave/sage_git/build/src/module_list.py", line 42, in <module>
    zlib_pc = pkgconfig.parse('zlib')
  File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py", line 248, in parse
    _raise_if_not_exists(package)
  File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.7/site-packages/pkgconfig/pkgconfig.py", line 103, in _raise_if_not_exists
    raise PackageNotFoundError(package)
pkgconfig.pkgconfig.PackageNotFoundError: zlib not found
************************************************************************
Error building the Sage library
************************************************************************
```



---

archive/issue_comments_435615.json:
```json
{
    "body": "**Changing commit** from \"[634157628ac3f7292e7065eae462bb6b80db7aed](https://github.com/sagemath/sagetrac-mirror/commit/634157628ac3f7292e7065eae462bb6b80db7aed)\" to \"\".",
    "created_at": "2019-12-22T15:16:26Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435615",
    "user": "https://github.com/vbraun"
}
```

**Changing commit** from "[634157628ac3f7292e7065eae462bb6b80db7aed](https://github.com/sagemath/sagetrac-mirror/commit/634157628ac3f7292e7065eae462bb6b80db7aed)" to "".



---

archive/issue_comments_435616.json:
```json
{
    "body": "<a id='comment:63'></a>\none needs details such as whether you build zlib or use zlib from the system, whether Python gets  correctly built zlib module, etc.\n\nWhat does happen if you do\n\n```\n./sage --python\n>>> import zlib\n```",
    "created_at": "2019-12-22T15:23:18Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435616",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:63'></a>
one needs details such as whether you build zlib or use zlib from the system, whether Python gets  correctly built zlib module, etc.

What does happen if you do

```
./sage --python
>>> import zlib
```



---

archive/issue_comments_435617.json:
```json
{
    "body": "<a id='comment:64'></a>\nShould be the fault of the dependency at #28883",
    "created_at": "2019-12-22T15:28:29Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435617",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:64'></a>
Should be the fault of the dependency at #28883



---

archive/issue_events_245917.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-12-22T15:28:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245917"
}
```



---

archive/issue_comments_435618.json:
```json
{
    "body": "<a id='comment:65'></a>\nWell, we do need a newer pkgconfig from #28883 here, and I really have no idea what breaks for you at #28883. Did you try `make distclean` ?",
    "created_at": "2019-12-22T15:35:56Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435618",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:65'></a>
Well, we do need a newer pkgconfig from #28883 here, and I really have no idea what breaks for you at #28883. Did you try `make distclean` ?



---

archive/issue_comments_435619.json:
```json
{
    "body": "<a id='comment:66'></a>\nOn Catalina, there is no zlib in /usr/lib/pkgconfig and we don't build our own zlib with #27870.\n\n```\nbuildbot-sage@osx build % ./sage -sh -c 'pkgconf --cflags zlib'\n\nPackage zlib was not found in the pkg-config search path.\nPerhaps you should add the directory containing `zlib.pc'\nto the PKG_CONFIG_PATH environment variable\nPackage 'zlib', required by 'world', not found\n```\nAll builds from scratch.",
    "created_at": "2019-12-22T15:40:19Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435619",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:66'></a>
On Catalina, there is no zlib in /usr/lib/pkgconfig and we don't build our own zlib with #27870.

```
buildbot-sage@osx build % ./sage -sh -c 'pkgconf --cflags zlib'

Package zlib was not found in the pkg-config search path.
Perhaps you should add the directory containing `zlib.pc'
to the PKG_CONFIG_PATH environment variable
Package 'zlib', required by 'world', not found
```
All builds from scratch.



---

archive/issue_events_245918.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-12-22T16:01:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245918"
}
```



---

archive/issue_events_245919.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-12-22T16:01:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245919"
}
```



---

archive/issue_comments_435620.json:
```json
{
    "body": "<a id='comment:67'></a>\nIs the fault of #28883",
    "created_at": "2019-12-22T16:01:07Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435620",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:67'></a>
Is the fault of #28883



---

archive/issue_comments_435621.json:
```json
{
    "body": "**Changing branch** from \"[634157628ac3f7292e7065eae462bb6b80db7aed](https://github.com/sagemath/sagetrac-mirror/commit/634157628ac3f7292e7065eae462bb6b80db7aed)\" to \"[u/dimpase/packages/openblas/openblasconf](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblas/openblasconf)\".",
    "created_at": "2019-12-22T16:06:43Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435621",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[634157628ac3f7292e7065eae462bb6b80db7aed](https://github.com/sagemath/sagetrac-mirror/commit/634157628ac3f7292e7065eae462bb6b80db7aed)" to "[u/dimpase/packages/openblas/openblasconf](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblas/openblasconf)".



---

archive/issue_comments_435622.json:
```json
{
    "body": "**Commit:** [634157628ac3f7292e7065eae462bb6b80db7aed](https://github.com/sagemath/sagetrac-mirror/commit/634157628ac3f7292e7065eae462bb6b80db7aed)",
    "created_at": "2019-12-22T16:06:43Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435622",
    "user": "https://github.com/vbraun"
}
```

**Commit:** [634157628ac3f7292e7065eae462bb6b80db7aed](https://github.com/sagemath/sagetrac-mirror/commit/634157628ac3f7292e7065eae462bb6b80db7aed)



---

archive/issue_comments_435623.json:
```json
{
    "body": "<a id='comment:68'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5c91dbb4d313d43f05cf3d33fc1758ac089613d\">e5c91db</a></td><td><code>update pkgconfig to v1.5.1. See trac #28883</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1720b38cdca1aa6c436a4b579545c227d3a313fc\">1720b38</a></td><td><code>a bare minumim openblas config</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/925266bfb2e8446e4fadd09eea86d7c04534eed6\">925266b</a></td><td><code>use openblas.pc for blas and lapack, don't require atlas is to be used</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b89df80e245766884e59d78accfe809e240ad2ba\">b89df80</a></td><td><code>move blas handling to build/pkgs/</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/634157628ac3f7292e7065eae462bb6b80db7aed\">6341576</a></td><td><code>create cblas.pc link, too, not only blas and lapack</code></td></tr></table>\n",
    "created_at": "2019-12-22T16:06:43Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435623",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:68'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5c91dbb4d313d43f05cf3d33fc1758ac089613d">e5c91db</a></td><td><code>update pkgconfig to v1.5.1. See trac #28883</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1720b38cdca1aa6c436a4b579545c227d3a313fc">1720b38</a></td><td><code>a bare minumim openblas config</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/925266bfb2e8446e4fadd09eea86d7c04534eed6">925266b</a></td><td><code>use openblas.pc for blas and lapack, don't require atlas is to be used</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b89df80e245766884e59d78accfe809e240ad2ba">b89df80</a></td><td><code>move blas handling to build/pkgs/</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/634157628ac3f7292e7065eae462bb6b80db7aed">6341576</a></td><td><code>create cblas.pc link, too, not only blas and lapack</code></td></tr></table>




---

archive/issue_events_245920.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2019-12-28T07:41:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245920"
}
```



---

archive/issue_events_245921.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2019-12-28T07:41:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245921"
}
```



---

archive/issue_comments_435624.json:
```json
{
    "body": "<a id='comment:69'></a>\n**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** This was a forced push. **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f74f5545d2a931f37247185de292689dd9800d35\">f74f554</a></td><td><code>update pkgconfig to v1.5.1. See trac #28883</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb8f4e51d258ce6cfa8e4b221ff67c94cf80467e\">fb8f4e5</a></td><td><code>allow absent zlib.pc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b3a8891127194583a8a8e9ac145324f877491848\">b3a8891</a></td><td><code>a bare minumim openblas config</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c031c9ea33b2e6210d571b6939c5faf2e0ed4f84\">c031c9e</a></td><td><code>use openblas.pc for blas and lapack, don't require atlas is to be used</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b49f79eca2bde8ce3ce134dbdc7f01172bd9293c\">b49f79e</a></td><td><code>move blas handling to build/pkgs/</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81bf522a5a417e236f9b9ee4f05256126b5b47cb\">81bf522</a></td><td><code>create cblas.pc link, too, not only blas and lapack</code></td></tr></table>\n",
    "created_at": "2019-12-28T07:41:07Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435624",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:69'></a>
**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** This was a forced push. **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f74f5545d2a931f37247185de292689dd9800d35">f74f554</a></td><td><code>update pkgconfig to v1.5.1. See trac #28883</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb8f4e51d258ce6cfa8e4b221ff67c94cf80467e">fb8f4e5</a></td><td><code>allow absent zlib.pc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b3a8891127194583a8a8e9ac145324f877491848">b3a8891</a></td><td><code>a bare minumim openblas config</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c031c9ea33b2e6210d571b6939c5faf2e0ed4f84">c031c9e</a></td><td><code>use openblas.pc for blas and lapack, don't require atlas is to be used</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b49f79eca2bde8ce3ce134dbdc7f01172bd9293c">b49f79e</a></td><td><code>move blas handling to build/pkgs/</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81bf522a5a417e236f9b9ee4f05256126b5b47cb">81bf522</a></td><td><code>create cblas.pc link, too, not only blas and lapack</code></td></tr></table>




---

archive/issue_comments_435625.json:
```json
{
    "body": "**Changing commit** from \"[634157628ac3f7292e7065eae462bb6b80db7aed](https://github.com/sagemath/sagetrac-mirror/commit/634157628ac3f7292e7065eae462bb6b80db7aed)\" to \"[81bf522a5a417e236f9b9ee4f05256126b5b47cb](https://github.com/sagemath/sagetrac-mirror/commit/81bf522a5a417e236f9b9ee4f05256126b5b47cb)\".",
    "created_at": "2019-12-28T07:41:07Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435625",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[634157628ac3f7292e7065eae462bb6b80db7aed](https://github.com/sagemath/sagetrac-mirror/commit/634157628ac3f7292e7065eae462bb6b80db7aed)" to "[81bf522a5a417e236f9b9ee4f05256126b5b47cb](https://github.com/sagemath/sagetrac-mirror/commit/81bf522a5a417e236f9b9ee4f05256126b5b47cb)".



---

archive/issue_comments_435626.json:
```json
{
    "body": "<a id='comment:70'></a>\ntrivial rebase over updated #28883",
    "created_at": "2019-12-28T07:42:22Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435626",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:70'></a>
trivial rebase over updated #28883



---

archive/issue_events_245922.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-28T07:42:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245922"
}
```



---

archive/issue_events_245923.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-12-28T07:42:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245923"
}
```



---

archive/issue_events_245924.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-01T14:36:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245924"
}
```



---

archive/issue_events_245925.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-01-01T14:36:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245925"
}
```



---

archive/issue_comments_435627.json:
```json
{
    "body": "<a id='comment:72'></a>\nCurrently doesn't detect system openblas on Cygwin (which just gets installed as the generic libblas when you install it).  Not sure why yet.  I won't hold up this ticket over it but if I can find a quick fix I might like to do that.",
    "created_at": "2020-01-08T14:38:03Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435627",
    "user": "https://github.com/embray"
}
```

<a id='comment:72'></a>
Currently doesn't detect system openblas on Cygwin (which just gets installed as the generic libblas when you install it).  Not sure why yet.  I won't hold up this ticket over it but if I can find a quick fix I might like to do that.



---

archive/issue_comments_435628.json:
```json
{
    "body": "<a id='comment:73'></a>\nwhat does `pkg-config --modversion openblas` say?",
    "created_at": "2020-01-08T14:51:12Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435628",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:73'></a>
what does `pkg-config --modversion openblas` say?



---

archive/issue_comments_435629.json:
```json
{
    "body": "<a id='comment:74'></a>\nReplying to [embray](#comment%3A72):\n> Currently doesn't detect system openblas on Cygwin (which just gets installed as the generic libblas when you install it).  Not sure why yet.  I won't hold up this ticket over it but if I can find a quick fix I might like to do that.\n\n\nI see; it's simply that Cygwin does not install an openblas.pc.  That's annoying.  I'll see if I can get that fixed upstream.  In the meantime we can just leave this as-is.\n\nI think as a broader improvement to the current situation it's worth recognizing that the spkg-install for \"atlas\" actually does two things:\n\n* If you have the old `SAGE_ATLAS_LIB` environment variable set it will just detect and use any old generic BLAS it can find in th given path; it doesn't care if it's actually ATLAS or not.\n* Otherwise it contains steps for specifically building and installing ATLAS from source.\n\nThese two cases seem to be quite at odds with each-other, and the naming of `SAGE_ATLAS_LIB` is misleading.\n\nI think what we should do is this (in a separate ticket):\n\n* Deprecate use of `SAGE_ATLAS_LIB`; it can still work for now but display a deprecation message if it is set sage is configured with `--with-blas=atlas`.\n\n* Clean up the atlas SPKG a bit so it's only responsible for installing ATLAS if requested.\n\n* Add a generic package called just \"blas\" (we could keep openblas as the default though).  The spkg-configure.m4 for blas would implement the `--with-blas` flag, and also extend it to take an optional argument of a path (e.g. instead of `--with-blas=openblas` or `--with-blas=atlas` one can pass something like `--with-blas=/usr/lib`.  This latter case would have essentially functionality as the current `SAGE_ATLAS_LIB` (maybe a little better): use that path to search for a generic blas library; maybe also check that it contains some known symbols.\n  * This is nice, because if you use the `--with-blas=<path>` option you don't get any SPKGs installed for blas, emphasizing that some generic blas on the system is being used.",
    "created_at": "2020-01-08T15:02:53Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435629",
    "user": "https://github.com/embray"
}
```

<a id='comment:74'></a>
Replying to [embray](#comment%3A72):
> Currently doesn't detect system openblas on Cygwin (which just gets installed as the generic libblas when you install it).  Not sure why yet.  I won't hold up this ticket over it but if I can find a quick fix I might like to do that.


I see; it's simply that Cygwin does not install an openblas.pc.  That's annoying.  I'll see if I can get that fixed upstream.  In the meantime we can just leave this as-is.

I think as a broader improvement to the current situation it's worth recognizing that the spkg-install for "atlas" actually does two things:

* If you have the old `SAGE_ATLAS_LIB` environment variable set it will just detect and use any old generic BLAS it can find in th given path; it doesn't care if it's actually ATLAS or not.
* Otherwise it contains steps for specifically building and installing ATLAS from source.

These two cases seem to be quite at odds with each-other, and the naming of `SAGE_ATLAS_LIB` is misleading.

I think what we should do is this (in a separate ticket):

* Deprecate use of `SAGE_ATLAS_LIB`; it can still work for now but display a deprecation message if it is set sage is configured with `--with-blas=atlas`.

* Clean up the atlas SPKG a bit so it's only responsible for installing ATLAS if requested.

* Add a generic package called just "blas" (we could keep openblas as the default though).  The spkg-configure.m4 for blas would implement the `--with-blas` flag, and also extend it to take an optional argument of a path (e.g. instead of `--with-blas=openblas` or `--with-blas=atlas` one can pass something like `--with-blas=/usr/lib`.  This latter case would have essentially functionality as the current `SAGE_ATLAS_LIB` (maybe a little better): use that path to search for a generic blas library; maybe also check that it contains some known symbols.
  * This is nice, because if you use the `--with-blas=<path>` option you don't get any SPKGs installed for blas, emphasizing that some generic blas on the system is being used.



---

archive/issue_comments_435630.json:
```json
{
    "body": "<a id='comment:75'></a>\niirc, SAGE_ATLAS_LIB is used for two rather different purposes. So there is some cleaning up due.",
    "created_at": "2020-01-08T15:23:09Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435630",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:75'></a>
iirc, SAGE_ATLAS_LIB is used for two rather different purposes. So there is some cleaning up due.



---

archive/issue_comments_435631.json:
```json
{
    "body": "<a id='comment:76'></a>\nReplying to [dimpase](#comment%3A75):\n> iirc, SAGE_ATLAS_LIB is used for two rather different purposes. So there is some cleaning up due.\n\n\nThe only use of it I could find was in `build/pkgs/atlas/spkg-install.py`.  If set, the directory it's set to is searched (in a fairly flimsy manner) for files that look blas-ish, although in one case it does explicitly look for an existing ATLAS install (if any functionality like this is to be kept it should be moved to `atlas/spkg-configure.m4`).  If anything is found it creates some symlinks to the found libraries into `SAGE_LOCAL` (this should go away), and also generates some .pc files (also probably can go away and handled more like you did with zlib...)",
    "created_at": "2020-01-08T16:24:24Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435631",
    "user": "https://github.com/embray"
}
```

<a id='comment:76'></a>
Replying to [dimpase](#comment%3A75):
> iirc, SAGE_ATLAS_LIB is used for two rather different purposes. So there is some cleaning up due.


The only use of it I could find was in `build/pkgs/atlas/spkg-install.py`.  If set, the directory it's set to is searched (in a fairly flimsy manner) for files that look blas-ish, although in one case it does explicitly look for an existing ATLAS install (if any functionality like this is to be kept it should be moved to `atlas/spkg-configure.m4`).  If anything is found it creates some symlinks to the found libraries into `SAGE_LOCAL` (this should go away), and also generates some .pc files (also probably can go away and handled more like you did with zlib...)



---

archive/issue_comments_435632.json:
```json
{
    "body": "**Changing branch** from \"[u/dimpase/packages/openblas/openblasconf](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblas/openblasconf)\" to \"[81bf522a5a417e236f9b9ee4f05256126b5b47cb](https://github.com/sagemath/sagetrac-mirror/commit/81bf522a5a417e236f9b9ee4f05256126b5b47cb)\".",
    "created_at": "2020-01-09T23:44:36Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435632",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/dimpase/packages/openblas/openblasconf](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/openblas/openblasconf)" to "[81bf522a5a417e236f9b9ee4f05256126b5b47cb](https://github.com/sagemath/sagetrac-mirror/commit/81bf522a5a417e236f9b9ee4f05256126b5b47cb)".



---

archive/issue_events_245926.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-09T23:44:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245926"
}
```



---

archive/issue_events_245927.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-09T23:44:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27870#event-245927"
}
```



---

archive/issue_comments_435633.json:
```json
{
    "body": "<a id='comment:78'></a>\nApparently my rather old Ubuntu lacks a `PKG_CONFIG_VAR` macro, so since this ticket I get:\n\n```\n$ ./bootstrap\nrm -rf config configure build/make/Makefile-auto.in\nbootstrap:69: installing 'config/config.rpath'\nconfigure.ac:328: installing 'config/compile'\nconfigure.ac:113: installing 'config/config.guess'\nconfigure.ac:113: installing 'config/config.sub'\nconfigure.ac:68: installing 'config/install-sh'\nconfigure.ac:68: installing 'config/missing'\nconfigure.ac:453: error: possibly undefined macro: AC_CONFIG_COMMANDS\n      If this token and others are legitimate, please use m4_pattern_allow.\n      See the Autoconf documentation.\nconfigure:17006: error: possibly undefined macro: PKG_CHECK_VAR\nconfigure:17007: error: possibly undefined macro: AC_CONFIG_LINKS\nconfigure:17012: error: possibly undefined macro: AC_MSG_WARN\n```\n\n(I don't know why it complains first about `AC_CONFIG_COMMANDS` since that's standard autoconf, but it seems likely the problem is stemming from `PKG_CHECK_VAR` being missing.)\n\nI'm going to look into it.",
    "created_at": "2020-01-13T13:37:01Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435633",
    "user": "https://github.com/embray"
}
```

<a id='comment:78'></a>
Apparently my rather old Ubuntu lacks a `PKG_CONFIG_VAR` macro, so since this ticket I get:

```
$ ./bootstrap
rm -rf config configure build/make/Makefile-auto.in
bootstrap:69: installing 'config/config.rpath'
configure.ac:328: installing 'config/compile'
configure.ac:113: installing 'config/config.guess'
configure.ac:113: installing 'config/config.sub'
configure.ac:68: installing 'config/install-sh'
configure.ac:68: installing 'config/missing'
configure.ac:453: error: possibly undefined macro: AC_CONFIG_COMMANDS
      If this token and others are legitimate, please use m4_pattern_allow.
      See the Autoconf documentation.
configure:17006: error: possibly undefined macro: PKG_CHECK_VAR
configure:17007: error: possibly undefined macro: AC_CONFIG_LINKS
configure:17012: error: possibly undefined macro: AC_MSG_WARN
```

(I don't know why it complains first about `AC_CONFIG_COMMANDS` since that's standard autoconf, but it seems likely the problem is stemming from `PKG_CHECK_VAR` being missing.)

I'm going to look into it.



---

archive/issue_comments_435634.json:
```json
{
    "body": "**Changing commit** from \"[81bf522a5a417e236f9b9ee4f05256126b5b47cb](https://github.com/sagemath/sagetrac-mirror/commit/81bf522a5a417e236f9b9ee4f05256126b5b47cb)\" to \"\".",
    "created_at": "2020-01-13T13:37:01Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435634",
    "user": "https://github.com/embray"
}
```

**Changing commit** from "[81bf522a5a417e236f9b9ee4f05256126b5b47cb](https://github.com/sagemath/sagetrac-mirror/commit/81bf522a5a417e236f9b9ee4f05256126b5b47cb)" to "".



---

archive/issue_comments_435635.json:
```json
{
    "body": "<a id='comment:79'></a>\nyou must have a past-EOL Ubuntu, I gather.",
    "created_at": "2020-01-13T13:48:48Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435635",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:79'></a>
you must have a past-EOL Ubuntu, I gather.



---

archive/issue_comments_435636.json:
```json
{
    "body": "<a id='comment:80'></a>\nReplying to [embray](#comment%3A74):\n> Replying to [embray](#comment%3A72):\n> * Add a generic package called just \"blas\" (we could keep openblas as the default though).  The spkg-configure.m4 for blas would implement the `--with-blas` flag, and also extend it to take an optional argument of a path (e.g. instead of `--with-blas=openblas` or `--with-blas=atlas` one can pass something like `--with-blas=/usr/lib`.  This latter case would have essentially functionality as the current `SAGE_ATLAS_LIB` (maybe a little better): use that path to search for a generic blas library; maybe also check that it contains some known symbols.\n\n\nPerhaps the idea of a \"generic package\" is overcomplicated for now.  Although it's something I've wanted to try to do in the past (#23465) but as a first pass detection of a \"generic blas\" can live in the spkg-configure.m4 for openblas (sort of as we do with gmp/mpir).",
    "created_at": "2020-01-13T14:17:41Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435636",
    "user": "https://github.com/embray"
}
```

<a id='comment:80'></a>
Replying to [embray](#comment%3A74):
> Replying to [embray](#comment%3A72):
> * Add a generic package called just "blas" (we could keep openblas as the default though).  The spkg-configure.m4 for blas would implement the `--with-blas` flag, and also extend it to take an optional argument of a path (e.g. instead of `--with-blas=openblas` or `--with-blas=atlas` one can pass something like `--with-blas=/usr/lib`.  This latter case would have essentially functionality as the current `SAGE_ATLAS_LIB` (maybe a little better): use that path to search for a generic blas library; maybe also check that it contains some known symbols.


Perhaps the idea of a "generic package" is overcomplicated for now.  Although it's something I've wanted to try to do in the past (#23465) but as a first pass detection of a "generic blas" can live in the spkg-configure.m4 for openblas (sort of as we do with gmp/mpir).



---

archive/issue_comments_435637.json:
```json
{
    "body": "<a id='comment:81'></a>\nOn the third-hand, because of the way the Sage build uses .pc files for cblas and lapack, and the fact that both the openblas and atlas SPKGs install these .pc files into SAGE_LOCAL, I understand now that even when we detect a system openblas, this ticket uses `AC_CONFIG_LINKS` to create those .pc files as symlinks directly into `$SAGE_LOCAL`.\n\nI don't really like this, because part of my long-term goals has been to make it so that running `configure` doesn't create and write *anything* to `$SAGE_LOCAL` (this preference is in service to issues like #21532).  I'm okay with it for now as a temporary solution, but it does seem like a step backwards.\n\nI'm going to see if I can come up with an alternative solution to this...",
    "created_at": "2020-01-13T15:06:18Z",
    "issue": "https://github.com/sagemath/sage/issues/27870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27870#issuecomment-435637",
    "user": "https://github.com/embray"
}
```

<a id='comment:81'></a>
On the third-hand, because of the way the Sage build uses .pc files for cblas and lapack, and the fact that both the openblas and atlas SPKGs install these .pc files into SAGE_LOCAL, I understand now that even when we detect a system openblas, this ticket uses `AC_CONFIG_LINKS` to create those .pc files as symlinks directly into `$SAGE_LOCAL`.

I don't really like this, because part of my long-term goals has been to make it so that running `configure` doesn't create and write *anything* to `$SAGE_LOCAL` (this preference is in service to issues like #21532).  I'm okay with it for now as a temporary solution, but it does seem like a step backwards.

I'm going to see if I can come up with an alternative solution to this...
