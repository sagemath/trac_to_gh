# Issue 27765: UserWarning when factoring polys over NumberFields

archive/issues_027528.json:
```json
{
    "body": "For a number field K whose defining polynomial has a non-integral rational coefficient, factoring a polynomial with coefficients in K sometimes results in the following `UserWarning`:\n\n```\nSageMath version 8.8.beta1, Release Date: 2019-04-07\nsage: K.<a> = NumberField(x^2 - 1/2)\nsage: R.<y> = PolynomialRing(K)\nsage: p = 11*a*y + 7\nsage: p.factor()\n/sage/local/lib/python3.7/site-packages/sage/rings/number_field/number_field.py:1682: UserWarning: interpreting PARI polynomial 11 relative to the defining polynomial x^2 - 2 of the PARI number field\n  % (x, self.pari_polynomial()))\n(11*a) * (y + 14/11*a)\n```\nThis is related to #22202 and see [https://groups.google.com/forum/#!topic/sage-devel/-4B4322qI9M](https://groups.google.com/forum/#!topic/sage-devel/-4B4322qI9M) for further discussion.\n\nAssignee: @NathanDunfield\n\nCC:  @videlec @jdemeyer @unhyperbolic @culler\n\nBranch/Commit: 5b89a97874b2af34a34f036073f2d6d3afe611ea\n\nReviewer: Matthias Goerner\n\nAuthor: Nathan Dunfield\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27765\n\n",
    "closed_at": "2019-07-07T12:36:14Z",
    "created_at": "2019-05-04T16:18:57Z",
    "labels": [
        "component: number fields",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "UserWarning when factoring polys over NumberFields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27765",
    "user": "https://github.com/NathanDunfield"
}
```
For a number field K whose defining polynomial has a non-integral rational coefficient, factoring a polynomial with coefficients in K sometimes results in the following `UserWarning`:

```
SageMath version 8.8.beta1, Release Date: 2019-04-07
sage: K.<a> = NumberField(x^2 - 1/2)
sage: R.<y> = PolynomialRing(K)
sage: p = 11*a*y + 7
sage: p.factor()
/sage/local/lib/python3.7/site-packages/sage/rings/number_field/number_field.py:1682: UserWarning: interpreting PARI polynomial 11 relative to the defining polynomial x^2 - 2 of the PARI number field
  % (x, self.pari_polynomial()))
(11*a) * (y + 14/11*a)
```
This is related to #22202 and see [https://groups.google.com/forum/#!topic/sage-devel/-4B4322qI9M](https://groups.google.com/forum/#!topic/sage-devel/-4B4322qI9M) for further discussion.

Assignee: @NathanDunfield

CC:  @videlec @jdemeyer @unhyperbolic @culler

Branch/Commit: 5b89a97874b2af34a34f036073f2d6d3afe611ea

Reviewer: Matthias Goerner

Author: Nathan Dunfield

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27765





---

archive/issue_comments_536708.json:
```json
{
    "body": "<a id='comment:1'></a>I think I have a reasonable solution to this: `_element_constructor_` shouldn't raise the warning if the polynomial it's given is constant since that case is unambiguous.  Writing patch now...",
    "created_at": "2019-05-04T16:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536708",
    "user": "https://github.com/NathanDunfield"
}
```

<a id='comment:1'></a>I think I have a reasonable solution to this: `_element_constructor_` shouldn't raise the warning if the polynomial it's given is constant since that case is unambiguous.  Writing patch now...



---

archive/issue_comments_536709.json:
```json
{
    "body": "Set assignee to @NathanDunfield.",
    "created_at": "2019-05-04T17:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536709",
    "user": "https://github.com/NathanDunfield"
}
```

Set assignee to @NathanDunfield.



---

archive/issue_comments_536710.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2019-05-04T17:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536710",
    "user": "https://github.com/NathanDunfield"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_536711.json:
```json
{
    "body": "Changing commit from \"\" to \"d064855d326e0b63809b6d8c7c4a8415c45f31f3\"",
    "created_at": "2019-05-04T17:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536711",
    "user": "https://github.com/NathanDunfield"
}
```

Changing commit from "" to "d064855d326e0b63809b6d8c7c4a8415c45f31f3"



---

archive/issue_comments_536712.json:
```json
{
    "body": "Changing branch from \"\" to \"u/dunfield/nf_warning\"",
    "created_at": "2019-05-04T17:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536712",
    "user": "https://github.com/NathanDunfield"
}
```

Changing branch from "" to "u/dunfield/nf_warning"



---

archive/issue_comments_536713.json:
```json
{
    "body": "<a id='comment:3'></a>Ok, I think that does it.",
    "created_at": "2019-05-04T17:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536713",
    "user": "https://github.com/NathanDunfield"
}
```

<a id='comment:3'></a>Ok, I think that does it.



---

archive/issue_comments_536714.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-04T17:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536714",
    "user": "https://github.com/NathanDunfield"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_536715.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-13T20:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536715",
    "user": "https://github.com/unhyperbolic"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_536716.json:
```json
{
    "body": "<a id='comment:4'></a>Thanks!",
    "created_at": "2019-06-13T20:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536716",
    "user": "https://github.com/unhyperbolic"
}
```

<a id='comment:4'></a>Thanks!



---

archive/issue_comments_536717.json:
```json
{
    "body": "<a id='comment:5'></a>I am so sorry for re-opening this. But I was just playing around some more with pari and discovered the following:\n\n```\n>>> (pari('y^4')+pari('x^2')-pari('x^2')).poldegree()\n0\n>>> (pari('y^4')+pari('x^2')-pari('x^2'))[0]\ny^4\n```\nI am not sure how much of a corner case this is and that there is actually additional work necessary. But I definitively want to think this over before giving it a positive review.",
    "created_at": "2019-06-14T00:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536717",
    "user": "https://github.com/unhyperbolic"
}
```

<a id='comment:5'></a>I am so sorry for re-opening this. But I was just playing around some more with pari and discovered the following:

```
>>> (pari('y^4')+pari('x^2')-pari('x^2')).poldegree()
0
>>> (pari('y^4')+pari('x^2')-pari('x^2'))[0]
y^4
```
I am not sure how much of a corner case this is and that there is actually additional work necessary. But I definitively want to think this over before giving it a positive review.



---

archive/issue_comments_536718.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-06-14T00:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536718",
    "user": "https://github.com/unhyperbolic"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_events_068878.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27765#event-68878"
}
```



---

archive/issue_comments_536719.json:
```json
{
    "body": "<a id='comment:6'></a>Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536719",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_events_068879.json:
```json
{
    "actor": "https://github.com/NathanDunfield",
    "created_at": "2019-06-23T22:25:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27765#event-68879"
}
```



---

archive/issue_events_068880.json:
```json
{
    "actor": "https://github.com/NathanDunfield",
    "created_at": "2019-06-23T22:25:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27765#event-68880"
}
```



---

archive/issue_comments_536720.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [mgoerner](#comment%3A5):\n> I am so sorry for re-opening this. But I was just playing around some more with pari and discovered the following:\n\n\nHmm, Pari's handling of multivariable polynomials is pretty idiosyncratic:\n\n```\nsage: p = pari('x^2 + y^4')\nsage: q = pari('x^2')\nsage: p.variables(), q.variables()\n([x, y], [x])\nsage: a = p - p + 1\nsage: a, a.poldegree(), a.variables()\n(1, 0, [x])\nsage: b = q - q\nsage: b, b.poldegree(), b.variables()\n(0, -9223372036854775807, [x])\nsage: c = p - q\nsage: c, c.poldegree(), c.variables()\n(y^4, 0, [x, y])\nsage: pari('z - z').variables()\n[z]\nsage: pari('z + x - z - x').variables()\n[x]\n```\nI think the following is a better test for being constant:\n\n```\nsage: def degrees(poly): return [poly.poldegree(v) for v in poly.variables()]\nsage: degrees(a)\n[0]\nsage: degrees(b)\n[-9223372036854775807]\nsage: degrees(c)\n[0, 4]\nsage: def is_const(poly): \n          return all(poly.poldegree(v) <= 0 for v in poly.variables())\nsage: [is_const(x) for x in [a, b, c, p, q]]\n[True, True, False, False, False]\n```\nI will update my branch along these lines.",
    "created_at": "2019-06-23T22:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536720",
    "user": "https://github.com/NathanDunfield"
}
```

<a id='comment:7'></a>Replying to [mgoerner](#comment%3A5):
> I am so sorry for re-opening this. But I was just playing around some more with pari and discovered the following:


Hmm, Pari's handling of multivariable polynomials is pretty idiosyncratic:

```
sage: p = pari('x^2 + y^4')
sage: q = pari('x^2')
sage: p.variables(), q.variables()
([x, y], [x])
sage: a = p - p + 1
sage: a, a.poldegree(), a.variables()
(1, 0, [x])
sage: b = q - q
sage: b, b.poldegree(), b.variables()
(0, -9223372036854775807, [x])
sage: c = p - q
sage: c, c.poldegree(), c.variables()
(y^4, 0, [x, y])
sage: pari('z - z').variables()
[z]
sage: pari('z + x - z - x').variables()
[x]
```
I think the following is a better test for being constant:

```
sage: def degrees(poly): return [poly.poldegree(v) for v in poly.variables()]
sage: degrees(a)
[0]
sage: degrees(b)
[-9223372036854775807]
sage: degrees(c)
[0, 4]
sage: def is_const(poly): 
          return all(poly.poldegree(v) <= 0 for v in poly.variables())
sage: [is_const(x) for x in [a, b, c, p, q]]
[True, True, False, False, False]
```
I will update my branch along these lines.



---

archive/issue_comments_536721.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-24T03:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536721",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_536722.json:
```json
{
    "body": "Changing commit from \"d064855d326e0b63809b6d8c7c4a8415c45f31f3\" to \"5b89a97874b2af34a34f036073f2d6d3afe611ea\"",
    "created_at": "2019-06-24T03:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536722",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d064855d326e0b63809b6d8c7c4a8415c45f31f3" to "5b89a97874b2af34a34f036073f2d6d3afe611ea"



---

archive/issue_comments_536723.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-06-24T03:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536723",
    "user": "https://github.com/NathanDunfield"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_536724.json:
```json
{
    "body": "<a id='comment:10'></a>Thanks!",
    "created_at": "2019-06-25T21:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536724",
    "user": "https://github.com/unhyperbolic"
}
```

<a id='comment:10'></a>Thanks!



---

archive/issue_comments_536725.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-25T21:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536725",
    "user": "https://github.com/unhyperbolic"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_536726.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Goerner\"",
    "created_at": "2019-06-25T22:23:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536726",
    "user": "https://github.com/NathanDunfield"
}
```

Changing reviewer from "" to "Matthias Goerner"



---

archive/issue_events_068881.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-07-01T06:41:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27765#event-68881"
}
```



---

archive/issue_events_068882.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-07-01T06:41:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27765#event-68882"
}
```



---

archive/issue_comments_536727.json:
```json
{
    "body": "Changing branch from \"u/dunfield/nf_warning\" to \"5b89a97874b2af34a34f036073f2d6d3afe611ea\"",
    "created_at": "2019-07-07T12:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536727",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/dunfield/nf_warning" to "5b89a97874b2af34a34f036073f2d6d3afe611ea"



---

archive/issue_events_068883.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-07T12:36:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27765#event-68883"
}
```



---

archive/issue_comments_536728.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-07-07T12:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27765",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27765#issuecomment-536728",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
