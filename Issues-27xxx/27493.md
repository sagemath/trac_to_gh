# Issue 27493: Cygwin: OpenBLAS doesn't read environment variables properly

archive/issues_027256.json:
```json
{
    "body": "In Sage we currently, by default, disable multithreading in OpenBLAS by setting `OPENBLAS_NUM_THREADS=1` in `sage-env`.\n\nWhile this is not ideal, it does reduce the likelihood of multithreading issues coming up in contexts where it wasn't explicitly requested.\n\nWhile investigating #27434, I found that there is a subtle and apparently rare bug in OpenBLAS's multithreading on Windows, which was causing the docbuild to hang, particularly while building the plot3d docs (which happen to exercise this area of the code more than anything else in Sage).\n\nIt occurred to me, however, that the docbuild should not be exhibiting the bug since we set `OPENBLAS_NUM_THREADS=1`.  It turns out this is due to a bug in OpenBLAS on Cygwin, fixed by the attached patch.\n\nI'm setting this to \"critical\" since it would be very good to have this fixed for the buildbot.  I think this bug has been affecting Cygwin for a long time, but I could never nail down why.  Nevertheless since we have lived with this bug thus far I won't consider it a blocker.\n\n**Upstream PR:** https://github.com/xianyi/OpenBLAS/pull/2060\n\n\nBranch/Commit: abe0d276b890bc1005158ad39011443b62d55296\n\nUpstream: Fixed upstream, but not in a stable release.\n\nReviewer: Volker Braun\n\nAuthor: Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27493\n\n",
    "closed_at": "2019-04-05T20:51:31Z",
    "created_at": "2019-03-15T14:37:03Z",
    "labels": [
        "component: porting: cygwin",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Cygwin: OpenBLAS doesn't read environment variables properly",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27493",
    "user": "https://github.com/embray"
}
```
In Sage we currently, by default, disable multithreading in OpenBLAS by setting `OPENBLAS_NUM_THREADS=1` in `sage-env`.

While this is not ideal, it does reduce the likelihood of multithreading issues coming up in contexts where it wasn't explicitly requested.

While investigating #27434, I found that there is a subtle and apparently rare bug in OpenBLAS's multithreading on Windows, which was causing the docbuild to hang, particularly while building the plot3d docs (which happen to exercise this area of the code more than anything else in Sage).

It occurred to me, however, that the docbuild should not be exhibiting the bug since we set `OPENBLAS_NUM_THREADS=1`.  It turns out this is due to a bug in OpenBLAS on Cygwin, fixed by the attached patch.

I'm setting this to "critical" since it would be very good to have this fixed for the buildbot.  I think this bug has been affecting Cygwin for a long time, but I could never nail down why.  Nevertheless since we have lived with this bug thus far I won't consider it a blocker.

**Upstream PR:** https://github.com/xianyi/OpenBLAS/pull/2060


Branch/Commit: abe0d276b890bc1005158ad39011443b62d55296

Upstream: Fixed upstream, but not in a stable release.

Reviewer: Volker Braun

Author: Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27493





---

archive/issue_comments_530321.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2019-03-15T14:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27493#issuecomment-530321",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_530322.json:
```json
{
    "body": "Changing commit from \"\" to \"abe0d276b890bc1005158ad39011443b62d55296\"",
    "created_at": "2019-03-15T14:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27493#issuecomment-530322",
    "user": "https://github.com/embray"
}
```

Changing commit from "" to "abe0d276b890bc1005158ad39011443b62d55296"



---

archive/issue_comments_530323.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-15T14:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27493#issuecomment-530323",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_530324.json:
```json
{
    "body": "Changing branch from \"\" to \"u/embray/ticket-27493\"",
    "created_at": "2019-03-15T14:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27493#issuecomment-530324",
    "user": "https://github.com/embray"
}
```

Changing branch from "" to "u/embray/ticket-27493"



---

archive/issue_comments_530325.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Fixed upstream, but not in a stable release.\"",
    "created_at": "2019-03-18T11:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27493#issuecomment-530325",
    "user": "https://github.com/embray"
}
```

Changing upstream from "N/A" to "Fixed upstream, but not in a stable release."



---

archive/issue_comments_530326.json:
```json
{
    "body": "<a id='comment:3'></a>Moving all blocker/critical issues from 8.7 to 8.8.",
    "created_at": "2019-03-25T10:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27493#issuecomment-530326",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>Moving all blocker/critical issues from 8.7 to 8.8.



---

archive/issue_events_068263.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:41:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27493",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27493#event-68263"
}
```



---

archive/issue_comments_530327.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Volker Braun\"",
    "created_at": "2019-04-04T17:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27493#issuecomment-530327",
    "user": "https://github.com/vbraun"
}
```

Changing reviewer from "" to "Volker Braun"



---

archive/issue_comments_530328.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-04-04T17:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27493#issuecomment-530328",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_530329.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-04-05T20:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27493#issuecomment-530329",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_068264.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-05T20:51:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27493",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27493#event-68264"
}
```



---

archive/issue_comments_530330.json:
```json
{
    "body": "Changing branch from \"u/embray/ticket-27493\" to \"abe0d276b890bc1005158ad39011443b62d55296\"",
    "created_at": "2019-04-05T20:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27493",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27493#issuecomment-530330",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/embray/ticket-27493" to "abe0d276b890bc1005158ad39011443b62d55296"
