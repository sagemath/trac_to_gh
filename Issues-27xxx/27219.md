# Issue 27219: bootstrap should fail gracefully, if there is no pkg-config available

archive/issues_026982.json:
```json
{
    "assignees": [],
    "body": "When #27114 is merged, `./bootstrap` requires `pkgconf` to run properly. It should switch to downloading the configure spkg if the `pkgconf` m4 macros are not installed. Otherwise one gets\n\n```\nchecking whether g++ supports C++11 features with -std=gnu++11... yes\nchecking for gcc option to accept ISO C99... none needed\nchecking if gcc accepts -dumpversion option... yes\nchecking gcc version... 5.4.0\nchecking if g++ accepts -dumpversion option... yes\nchecking g++ version... 5.4.0\nconfigure: === checking whether to install the libffi SPKG ===\n./configure: line 9026: syntax error near unexpected token `LIBFFI,'\n./configure: line 9026: `        PKG_CHECK_MODULES(LIBFFI, libffi, ,'\nIf you would like to try to build Sage anyway (to help porting),\nexport the variable 'SAGE_PORT' to something non-empty.\nMakefile:39: recipe for target 'build/make/Makefile' failed\nmake[1]: Leaving directory '/var/lib/buildbot/slave/sage_git/build'\nmake[1]: *** [build/make/Makefile] Error 1\nMakefile:31: recipe for target 'build-clean' failed\nmake: *** [build-clean] Error 2\nprogram finished with exit code 2\n```\n\nIn order to solve this issue, we check for presence of `PKG_PROG_PKG_CONFIG` at bootstrap/autoconf run. We need renaming of PKG_ -> SPKG_ in `m4/sage_spkg_collect.m4`, which we take from #27114 in order not to cause conflicts. \n\n#27114 probably will need a rebase on top of this branch.\n\nCC:  @embray @vbraun @jdemeyer\n\nBranch/Commit: **[`187de34`](https://github.com/sagemath/sagetrac-mirror/commit/187de3457be410072694ea4a69583ba15edde09a)**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Dima Pasechnik**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27219_\n\n",
    "closed_at": "2019-02-08T23:21:43Z",
    "created_at": "2019-02-04T20:15:58Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "bootstrap should fail gracefully, if there is no pkg-config available",
    "type": "issue",
    "updated_at": "2019-02-08T23:21:43Z",
    "url": "https://github.com/sagemath/sage/issues/27219",
    "user": "https://github.com/dimpase"
}
```
When #27114 is merged, `./bootstrap` requires `pkgconf` to run properly. It should switch to downloading the configure spkg if the `pkgconf` m4 macros are not installed. Otherwise one gets

```
checking whether g++ supports C++11 features with -std=gnu++11... yes
checking for gcc option to accept ISO C99... none needed
checking if gcc accepts -dumpversion option... yes
checking gcc version... 5.4.0
checking if g++ accepts -dumpversion option... yes
checking g++ version... 5.4.0
configure: === checking whether to install the libffi SPKG ===
./configure: line 9026: syntax error near unexpected token `LIBFFI,'
./configure: line 9026: `        PKG_CHECK_MODULES(LIBFFI, libffi, ,'
If you would like to try to build Sage anyway (to help porting),
export the variable 'SAGE_PORT' to something non-empty.
Makefile:39: recipe for target 'build/make/Makefile' failed
make[1]: Leaving directory '/var/lib/buildbot/slave/sage_git/build'
make[1]: *** [build/make/Makefile] Error 1
Makefile:31: recipe for target 'build-clean' failed
make: *** [build-clean] Error 2
program finished with exit code 2
```

In order to solve this issue, we check for presence of `PKG_PROG_PKG_CONFIG` at bootstrap/autoconf run. We need renaming of PKG_ -> SPKG_ in `m4/sage_spkg_collect.m4`, which we take from #27114 in order not to cause conflicts. 

#27114 probably will need a rebase on top of this branch.

CC:  @embray @vbraun @jdemeyer

Branch/Commit: **[`187de34`](https://github.com/sagemath/sagetrac-mirror/commit/187de3457be410072694ea4a69583ba15edde09a)**

Reviewer: **Jeroen Demeyer**

Author: **Dima Pasechnik**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/27219_





---

archive/issue_events_371071.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-04T20:15:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371071"
}
```



---

archive/issue_events_371072.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-04T20:15:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371072"
}
```



---

archive/issue_events_371073.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-04T20:15:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371073"
}
```



---

archive/issue_events_371074.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-04T20:15:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371074"
}
```



---

archive/issue_comments_420305.json:
```json
{
    "body": "Branch: **[u/dimpase/build/bootstrap_check](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/build/bootstrap_check)**",
    "created_at": "2019-02-04T22:31:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420305",
    "user": "https://github.com/dimpase"
}
```

Branch: **[u/dimpase/build/bootstrap_check](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/build/bootstrap_check)**



---

archive/issue_events_371075.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-04T22:31:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371075"
}
```



---

archive/issue_comments_420306.json:
```json
{
    "body": "Commit: **[`af57d5b`](https://github.com/sagemath/sagetrac-mirror/commit/af57d5b8852f43fd1878382d08d0fc43c6bb9c62)**",
    "created_at": "2019-02-04T22:31:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420306",
    "user": "https://github.com/dimpase"
}
```

Commit: **[`af57d5b`](https://github.com/sagemath/sagetrac-mirror/commit/af57d5b8852f43fd1878382d08d0fc43c6bb9c62)**



---

archive/issue_comments_420307.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nOK, Volker, how about this?",
    "created_at": "2019-02-04T22:31:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420307",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:1" align="right">comment:1</div>

OK, Volker, how about this?



---

archive/issue_comments_420308.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nIMHO whether or not there is a pkg-config binary isn't the same as autoconf understanding PKG_CHECK_MODULES.",
    "created_at": "2019-02-06T23:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420308",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:2" align="right">comment:2</div>

IMHO whether or not there is a pkg-config binary isn't the same as autoconf understanding PKG_CHECK_MODULES.



---

archive/issue_comments_420309.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@vbraun](#comment%3A2):\n> IMHO whether or not there is a pkg-config binary isn't the same as autoconf understanding PKG_CHECK_MODULES.\n\nPKG.m4 - macros are a part of pkg-config. (a sufficiently new one - we can add a version check in bootstrap...)\n\nWe can also add a call to `PKG_PROG_PKG_CONFIG` to `configure.ac`.\n\nIt is of course perfectly possible to have a mangled install of pkg-config, without the needed m4 macros.",
    "created_at": "2019-02-07T01:32:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420309",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@vbraun](#comment%3A2):
> IMHO whether or not there is a pkg-config binary isn't the same as autoconf understanding PKG_CHECK_MODULES.

PKG.m4 - macros are a part of pkg-config. (a sufficiently new one - we can add a version check in bootstrap...)

We can also add a call to `PKG_PROG_PKG_CONFIG` to `configure.ac`.

It is of course perfectly possible to have a mangled install of pkg-config, without the needed m4 macros.



---

archive/issue_comments_420310.json:
```json
{
    "body": "Author: **Dima Pasechnik**",
    "created_at": "2019-02-07T01:32:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420310",
    "user": "https://github.com/dimpase"
}
```

Author: **Dima Pasechnik**



---

archive/issue_events_371076.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-02-07T06:04:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371076"
}
```



---

archive/issue_events_371077.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-02-07T06:04:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371077"
}
```



---

archive/issue_comments_420311.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@vbraun](#comment%3A2):\n> IMHO whether or not there is a pkg-config binary isn't the same as autoconf understanding PKG_CHECK_MODULES.\n\nI agree. The right thing to check then is whether the macro `PKG_CHECK_MODULES` is expanded.",
    "created_at": "2019-02-07T06:04:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420311",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@vbraun](#comment%3A2):
> IMHO whether or not there is a pkg-config binary isn't the same as autoconf understanding PKG_CHECK_MODULES.

I agree. The right thing to check then is whether the macro `PKG_CHECK_MODULES` is expanded.



---

archive/issue_comments_420312.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAlso, what goes wrong when `pkg-config` is not installed? The bug report should say that.",
    "created_at": "2019-02-07T06:32:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420312",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

Also, what goes wrong when `pkg-config` is not installed? The bug report should say that.



---

archive/issue_comments_420313.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n`m4_pattern_forbid` may be the correct solution here. See https://www.gnu.org/software/autoconf/manual/autoconf.html#Forbidden-Patterns",
    "created_at": "2019-02-07T06:40:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420313",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

`m4_pattern_forbid` may be the correct solution here. See https://www.gnu.org/software/autoconf/manual/autoconf.html#Forbidden-Patterns



---

archive/issue_comments_420314.json:
```json
{
    "body": "Changed commit from **[`af57d5b`](https://github.com/sagemath/sagetrac-mirror/commit/af57d5b8852f43fd1878382d08d0fc43c6bb9c62)** to **[`6e9f902`](https://github.com/sagemath/sagetrac-mirror/commit/6e9f902941d25c10bc97bd106ecbcd9fe2dc5cd8)**",
    "created_at": "2019-02-07T10:07:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420314",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`af57d5b`](https://github.com/sagemath/sagetrac-mirror/commit/af57d5b8852f43fd1878382d08d0fc43c6bb9c62)** to **[`6e9f902`](https://github.com/sagemath/sagetrac-mirror/commit/6e9f902941d25c10bc97bd106ecbcd9fe2dc5cd8)**



---

archive/issue_comments_420315.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e9f902941d25c10bc97bd106ecbcd9fe2dc5cd8\"><code>6e9f902</code></a></td><td><code>check that pkg-config and its m4 macros are installed</code></td></tr></table>\n",
    "created_at": "2019-02-07T10:07:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420315",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e9f902941d25c10bc97bd106ecbcd9fe2dc5cd8"><code>6e9f902</code></a></td><td><code>check that pkg-config and its m4 macros are installed</code></td></tr></table>




---

archive/issue_events_371078.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-07T10:09:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371078"
}
```



---

archive/issue_events_371079.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-07T10:09:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371079"
}
```



---

archive/issue_comments_420316.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nfrom the latest commit message:\n\n```\n    check that pkg-config and its m4 macros are installed\n    \n    use m4_ifndef() in configure.ac to check that PKG_PROG_PKG_CONFIG\n    is provided.\n    \n    just in case, also check that pkg-config is present\n    \n    calling PKG_PROG_PKG_CONFIG in configure.ac\n    \n    renaming of clashing with PKG_* m4 names in m4/*\n    (otherwise PKG_PROG_PKG_CONFIG cannot be mentioned at all)\n\n```\ntook a while to figure out weird errors caused by m4 vars name clashes.",
    "created_at": "2019-02-07T10:09:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420316",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:8" align="right">comment:8</div>

from the latest commit message:

```
    check that pkg-config and its m4 macros are installed
    
    use m4_ifndef() in configure.ac to check that PKG_PROG_PKG_CONFIG
    is provided.
    
    just in case, also check that pkg-config is present
    
    calling PKG_PROG_PKG_CONFIG in configure.ac
    
    renaming of clashing with PKG_* m4 names in m4/*
    (otherwise PKG_PROG_PKG_CONFIG cannot be mentioned at all)

```
took a while to figure out weird errors caused by m4 vars name clashes.



---

archive/issue_comments_420317.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nNot 100% sure whether we ought to call `PKG_PROG_PKG_CONFIG`. I do this in the current branch,\nI suppose it cannot hurt.",
    "created_at": "2019-02-07T10:11:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420317",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">comment:9</div>

Not 100% sure whether we ought to call `PKG_PROG_PKG_CONFIG`. I do this in the current branch,
I suppose it cannot hurt.



---

archive/issue_comments_420318.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nWhat currently happens is \n\n```\nchecking whether g++ supports C++11 features with -std=gnu++11... yes\nchecking for gcc option to accept ISO C99... none needed\nchecking if gcc accepts -dumpversion option... yes\nchecking gcc version... 5.4.0\nchecking if g++ accepts -dumpversion option... yes\nchecking g++ version... 5.4.0\nconfigure: === checking whether to install the libffi SPKG ===\n./configure: line 9026: syntax error near unexpected token `LIBFFI,'\n./configure: line 9026: `        PKG_CHECK_MODULES(LIBFFI, libffi, ,'\nIf you would like to try to build Sage anyway (to help porting),\nexport the variable 'SAGE_PORT' to something non-empty.\nMakefile:39: recipe for target 'build/make/Makefile' failed\nmake[1]: Leaving directory '/var/lib/buildbot/slave/sage_git/build'\nmake[1]: *** [build/make/Makefile] Error 1\nMakefile:31: recipe for target 'build-clean' failed\nmake: *** [build-clean] Error 2\nprogram finished with exit code 2\n```",
    "created_at": "2019-02-07T11:53:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420318",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:10" align="right">comment:10</div>

What currently happens is 

```
checking whether g++ supports C++11 features with -std=gnu++11... yes
checking for gcc option to accept ISO C99... none needed
checking if gcc accepts -dumpversion option... yes
checking gcc version... 5.4.0
checking if g++ accepts -dumpversion option... yes
checking g++ version... 5.4.0
configure: === checking whether to install the libffi SPKG ===
./configure: line 9026: syntax error near unexpected token `LIBFFI,'
./configure: line 9026: `        PKG_CHECK_MODULES(LIBFFI, libffi, ,'
If you would like to try to build Sage anyway (to help porting),
export the variable 'SAGE_PORT' to something non-empty.
Makefile:39: recipe for target 'build/make/Makefile' failed
make[1]: Leaving directory '/var/lib/buildbot/slave/sage_git/build'
make[1]: *** [build/make/Makefile] Error 1
Makefile:31: recipe for target 'build-clean' failed
make: *** [build-clean] Error 2
program finished with exit code 2
```



---

archive/issue_comments_420319.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-./bootstrap requires pkg-config to run properly. It should switch to downloading configure spkg not only if there are no autotools, but also if there is no pkg-config.\n+When #27114 is merged, `./bootstrap` requires `pkgconf` to run properly. It should switch to downloading the configure spkg if the `pkgconf` m4 macros are not installed.\n``````\n",
    "created_at": "2019-02-07T12:22:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420319",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-./bootstrap requires pkg-config to run properly. It should switch to downloading configure spkg not only if there are no autotools, but also if there is no pkg-config.
+When #27114 is merged, `./bootstrap` requires `pkgconf` to run properly. It should switch to downloading the configure spkg if the `pkgconf` m4 macros are not installed.
``````




---

archive/issue_events_371080.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-02-07T12:22:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371080"
}
```



---

archive/issue_events_371081.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-02-07T12:22:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371081"
}
```



---

archive/issue_comments_420320.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nRight, so all that you need is something like `m4_pattern_forbid([^PKG_])`.\n\nWhat's the point of checking for `pkgconf` in `bootstrap`? Generating the `./configure` script should be orthogonal to whether or not `pkgconf` is installed.",
    "created_at": "2019-02-07T12:22:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420320",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Right, so all that you need is something like `m4_pattern_forbid([^PKG_])`.

What's the point of checking for `pkgconf` in `bootstrap`? Generating the `./configure` script should be orthogonal to whether or not `pkgconf` is installed.



---

archive/issue_comments_420321.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,21 @@\n-When #27114 is merged, `./bootstrap` requires `pkgconf` to run properly. It should switch to downloading the configure spkg if the `pkgconf` m4 macros are not installed.\n+When #27114 is merged, `./bootstrap` requires `pkgconf` to run properly. It should switch to downloading the configure spkg if the `pkgconf` m4 macros are not installed. Otherwise one gets\n+\n+```\n+checking whether g++ supports C++11 features with -std=gnu++11... yes\n+checking for gcc option to accept ISO C99... none needed\n+checking if gcc accepts -dumpversion option... yes\n+checking gcc version... 5.4.0\n+checking if g++ accepts -dumpversion option... yes\n+checking g++ version... 5.4.0\n+configure: === checking whether to install the libffi SPKG ===\n+./configure: line 9026: syntax error near unexpected token `LIBFFI,'\n+./configure: line 9026: `        PKG_CHECK_MODULES(LIBFFI, libffi, ,'\n+If you would like to try to build Sage anyway (to help porting),\n+export the variable 'SAGE_PORT' to something non-empty.\n+Makefile:39: recipe for target 'build/make/Makefile' failed\n+make[1]: Leaving directory '/var/lib/buildbot/slave/sage_git/build'\n+make[1]: *** [build/make/Makefile] Error 1\n+Makefile:31: recipe for target 'build-clean' failed\n+make: *** [build-clean] Error 2\n+program finished with exit code 2\n+```\n``````\n",
    "created_at": "2019-02-07T12:23:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420321",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,21 @@
-When #27114 is merged, `./bootstrap` requires `pkgconf` to run properly. It should switch to downloading the configure spkg if the `pkgconf` m4 macros are not installed.
+When #27114 is merged, `./bootstrap` requires `pkgconf` to run properly. It should switch to downloading the configure spkg if the `pkgconf` m4 macros are not installed. Otherwise one gets
+
+```
+checking whether g++ supports C++11 features with -std=gnu++11... yes
+checking for gcc option to accept ISO C99... none needed
+checking if gcc accepts -dumpversion option... yes
+checking gcc version... 5.4.0
+checking if g++ accepts -dumpversion option... yes
+checking g++ version... 5.4.0
+configure: === checking whether to install the libffi SPKG ===
+./configure: line 9026: syntax error near unexpected token `LIBFFI,'
+./configure: line 9026: `        PKG_CHECK_MODULES(LIBFFI, libffi, ,'
+If you would like to try to build Sage anyway (to help porting),
+export the variable 'SAGE_PORT' to something non-empty.
+Makefile:39: recipe for target 'build/make/Makefile' failed
+make[1]: Leaving directory '/var/lib/buildbot/slave/sage_git/build'
+make[1]: *** [build/make/Makefile] Error 1
+Makefile:31: recipe for target 'build-clean' failed
+make: *** [build-clean] Error 2
+program finished with exit code 2
+```
``````




---

archive/issue_comments_420322.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/371cd8e7561f77789d456ee1f9a344a36c497907\"><code>371cd8e</code></a></td><td><code>use Eriks's m4 fixes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4d9ccb4a31892374bc8eb1b16a7f9b9a2d7cc1d1\"><code>4d9ccb4</code></a></td><td><code>Trac #27109: Use pkg-config if possible to detect libffi</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/761c97892a3c4ff3cd99224312094d41394e410c\"><code>761c978</code></a></td><td><code>AC_CHECK_HEADERS should come before AC_SEARCH_LIBS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3d2eb36cc0ff7bdc9cb5447858aa15413cd07da4\"><code>3d2eb36</code></a></td><td><code>move ffi/ffi.h first since it seems to be more common too</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc372289db0b8cd0753220b65162afdaf24481b9\"><code>cc37228</code></a></td><td><code>Merge remote-tracking branch 'trac/u/embray/build/ticket-27109' into booboo</code></td></tr></table>\n",
    "created_at": "2019-02-07T12:27:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420322",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/371cd8e7561f77789d456ee1f9a344a36c497907"><code>371cd8e</code></a></td><td><code>use Eriks's m4 fixes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4d9ccb4a31892374bc8eb1b16a7f9b9a2d7cc1d1"><code>4d9ccb4</code></a></td><td><code>Trac #27109: Use pkg-config if possible to detect libffi</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/761c97892a3c4ff3cd99224312094d41394e410c"><code>761c978</code></a></td><td><code>AC_CHECK_HEADERS should come before AC_SEARCH_LIBS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3d2eb36cc0ff7bdc9cb5447858aa15413cd07da4"><code>3d2eb36</code></a></td><td><code>move ffi/ffi.h first since it seems to be more common too</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc372289db0b8cd0753220b65162afdaf24481b9"><code>cc37228</code></a></td><td><code>Merge remote-tracking branch 'trac/u/embray/build/ticket-27109' into booboo</code></td></tr></table>




---

archive/issue_comments_420323.json:
```json
{
    "body": "Changed commit from **[`6e9f902`](https://github.com/sagemath/sagetrac-mirror/commit/6e9f902941d25c10bc97bd106ecbcd9fe2dc5cd8)** to **[`cc37228`](https://github.com/sagemath/sagetrac-mirror/commit/cc372289db0b8cd0753220b65162afdaf24481b9)**",
    "created_at": "2019-02-07T12:27:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420323",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6e9f902`](https://github.com/sagemath/sagetrac-mirror/commit/6e9f902941d25c10bc97bd106ecbcd9fe2dc5cd8)** to **[`cc37228`](https://github.com/sagemath/sagetrac-mirror/commit/cc372289db0b8cd0753220b65162afdaf24481b9)**



---

archive/issue_comments_420324.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89a402f1e848652a1845d8baa07b8f16ec063db0\"><code>89a402f</code></a></td><td><code>do not put the libffi/spkg-configure.m4 here</code></td></tr></table>\n",
    "created_at": "2019-02-07T12:31:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420324",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89a402f1e848652a1845d8baa07b8f16ec063db0"><code>89a402f</code></a></td><td><code>do not put the libffi/spkg-configure.m4 here</code></td></tr></table>




---

archive/issue_comments_420325.json:
```json
{
    "body": "Changed commit from **[`cc37228`](https://github.com/sagemath/sagetrac-mirror/commit/cc372289db0b8cd0753220b65162afdaf24481b9)** to **[`89a402f`](https://github.com/sagemath/sagetrac-mirror/commit/89a402f1e848652a1845d8baa07b8f16ec063db0)**",
    "created_at": "2019-02-07T12:31:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420325",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cc37228`](https://github.com/sagemath/sagetrac-mirror/commit/cc372289db0b8cd0753220b65162afdaf24481b9)** to **[`89a402f`](https://github.com/sagemath/sagetrac-mirror/commit/89a402f1e848652a1845d8baa07b8f16ec063db0)**



---

archive/issue_comments_420326.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nOK, so this should be the correct fix, merging cleanly with #27114, too.",
    "created_at": "2019-02-07T12:31:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420326",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">comment:15</div>

OK, so this should be the correct fix, merging cleanly with #27114, too.



---

archive/issue_comments_420327.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@jdemeyer](#comment%3A11):\n> Right, so all that you need is something like `m4_pattern_forbid([^PKG_])`.\n> \n> What's the point of checking for `pkgconf` in `bootstrap`? Generating the `./configure` script should be orthogonal to whether or not `pkgconf` is installed.\n\nGenerating configure needs pkg-config since #27114, which uses PKG_* m4 macros, why not?\nThe resulting ./configure does not need pkg-config, it can do without just fine.",
    "created_at": "2019-02-07T12:37:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420327",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@jdemeyer](#comment%3A11):
> Right, so all that you need is something like `m4_pattern_forbid([^PKG_])`.
> 
> What's the point of checking for `pkgconf` in `bootstrap`? Generating the `./configure` script should be orthogonal to whether or not `pkgconf` is installed.

Generating configure needs pkg-config since #27114, which uses PKG_* m4 macros, why not?
The resulting ./configure does not need pkg-config, it can do without just fine.



---

archive/issue_events_371082.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-07T12:37:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371082"
}
```



---

archive/issue_events_371083.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-07T12:37:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371083"
}
```



---

archive/issue_comments_420328.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\noops, sorry, I should have put in the old version of libffi/spkg-configure.m4...",
    "created_at": "2019-02-07T12:43:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420328",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

oops, sorry, I should have put in the old version of libffi/spkg-configure.m4...



---

archive/issue_comments_420329.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@dimpase](#comment%3A16):\n> Generating configure needs pkg-config since #27219\n\nYou need to distinguish between *generating* `configure` and *running* configure. In this ticket, we are only concerned with the `bootstrap` script which runs `autoconf` to *generate* `configure`.\n\nNow `autoconf` is a macro processor, so it would be surprising that it would run `pkg-config`. Even if it does, what happens if `pkg-config` is not installed? I would assume that it fails gracefully, so I still don't see the point of the extra `pkg-config --version` check.",
    "created_at": "2019-02-07T12:44:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420329",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@dimpase](#comment%3A16):
> Generating configure needs pkg-config since #27219

You need to distinguish between *generating* `configure` and *running* configure. In this ticket, we are only concerned with the `bootstrap` script which runs `autoconf` to *generate* `configure`.

Now `autoconf` is a macro processor, so it would be surprising that it would run `pkg-config`. Even if it does, what happens if `pkg-config` is not installed? I would assume that it fails gracefully, so I still don't see the point of the extra `pkg-config --version` check.



---

archive/issue_events_371084.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-02-07T12:44:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371084"
}
```



---

archive/issue_events_371085.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-02-07T12:44:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371085"
}
```



---

archive/issue_comments_420330.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nBy the way, if you want to use `m4_ifndef`, at least make sure that error message is correct:\n\n```\nm4_ifndef([PKG_PROG_PKG_CONFIG],\n    [m4_fatal([Could not locate the pkg-config autoconf macros.\n    These are usually located in /usr/share/aclocal/pkg.m4. If your\n    macros are in a different location, try setting the environment\n    variable ACLOCAL=\"aclocal -I/other/macro/dir\" before running\n    autoreconf/autogen.sh.])])\n```\nThe script in Sage is called `bootstrap`.",
    "created_at": "2019-02-07T12:48:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420330",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

By the way, if you want to use `m4_ifndef`, at least make sure that error message is correct:

```
m4_ifndef([PKG_PROG_PKG_CONFIG],
    [m4_fatal([Could not locate the pkg-config autoconf macros.
    These are usually located in /usr/share/aclocal/pkg.m4. If your
    macros are in a different location, try setting the environment
    variable ACLOCAL="aclocal -I/other/macro/dir" before running
    autoreconf/autogen.sh.])])
```
The script in Sage is called `bootstrap`.



---

archive/issue_comments_420331.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@dimpase](#comment%3A18):\n> oops, sorry, I should have put in the old version of libffi/spkg-configure.m4...\n\nIn general, your commit history on this ticket is a mess, so I suggest to rebase and squash.",
    "created_at": "2019-02-07T12:51:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420331",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@dimpase](#comment%3A18):
> oops, sorry, I should have put in the old version of libffi/spkg-configure.m4...

In general, your commit history on this ticket is a mess, so I suggest to rebase and squash.



---

archive/issue_comments_420332.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI am certainly distinguishing between generating and running configure. Generating configure only needs m4 macros, this is correct. \n\nWould you like me to take out from bootstrap the test for `pkg-config` presence?",
    "created_at": "2019-02-07T12:57:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420332",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">comment:22</div>

I am certainly distinguishing between generating and running configure. Generating configure only needs m4 macros, this is correct. 

Would you like me to take out from bootstrap the test for `pkg-config` presence?



---

archive/issue_comments_420333.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@jdemeyer](#comment%3A21):\n> Replying to [@dimpase](#comment%3A18):\n> > oops, sorry, I should have put in the old version of libffi/spkg-configure.m4...\n\n> \n> In general, your commit history on this ticket is a mess, so I suggest to rebase and squash.\n\nthe problem is that for this to work, I need changes to `m4/sage_spkg_collect.m4`\nakin to ones done on #27114. (I first did my own, without using #27114, only to find out that merging #27114 gets painful with them; so I decided to use a part of #27114, but haven't done it quite right...).\n\nAfter I'm done here, #27114 will have to be rebased on top of this one.",
    "created_at": "2019-02-07T13:12:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420333",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@jdemeyer](#comment%3A21):
> Replying to [@dimpase](#comment%3A18):
> > oops, sorry, I should have put in the old version of libffi/spkg-configure.m4...

> 
> In general, your commit history on this ticket is a mess, so I suggest to rebase and squash.

the problem is that for this to work, I need changes to `m4/sage_spkg_collect.m4`
akin to ones done on #27114. (I first did my own, without using #27114, only to find out that merging #27114 gets painful with them; so I decided to use a part of #27114, but haven't done it quite right...).

After I'm done here, #27114 will have to be rebased on top of this one.



---

archive/issue_comments_420334.json:
```json
{
    "body": "Changed commit from **[`89a402f`](https://github.com/sagemath/sagetrac-mirror/commit/89a402f1e848652a1845d8baa07b8f16ec063db0)** to **[`87621c7`](https://github.com/sagemath/sagetrac-mirror/commit/87621c7b1d84df427ef10eaada47cb054080f6b6)**",
    "created_at": "2019-02-07T13:32:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420334",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`89a402f`](https://github.com/sagemath/sagetrac-mirror/commit/89a402f1e848652a1845d8baa07b8f16ec063db0)** to **[`87621c7`](https://github.com/sagemath/sagetrac-mirror/commit/87621c7b1d84df427ef10eaada47cb054080f6b6)**



---

archive/issue_comments_420335.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/453033dee1282d9c99c3fba026ff7392c3f14b10\"><code>453033d</code></a></td><td><code>renaming PKG_* -> SPKG_* in m4</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87621c7b1d84df427ef10eaada47cb054080f6b6\"><code>87621c7</code></a></td><td><code>check for pkg-config's m4 macros at bootstrap</code></td></tr></table>\n",
    "created_at": "2019-02-07T13:32:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420335",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/453033dee1282d9c99c3fba026ff7392c3f14b10"><code>453033d</code></a></td><td><code>renaming PKG_* -> SPKG_* in m4</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87621c7b1d84df427ef10eaada47cb054080f6b6"><code>87621c7</code></a></td><td><code>check for pkg-config's m4 macros at bootstrap</code></td></tr></table>




---

archive/issue_comments_420336.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,3 +19,7 @@\n make: *** [build-clean] Error 2\n program finished with exit code 2\n ```\n+\n+In order to solve this issue, we check for presence of `PKG_PROG_PKG_CONFIG` at bootstrap/autoconf run. We need renaming of PKG_ -> SPKG_ in `m4/sage_spkg_collect.m4`, which we take from #27114 in order not to cause conflicts. \n+\n+#27114 probably will need a rebase on top of this branch.\n``````\n",
    "created_at": "2019-02-07T13:39:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420336",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,3 +19,7 @@
 make: *** [build-clean] Error 2
 program finished with exit code 2
 ```
+
+In order to solve this issue, we check for presence of `PKG_PROG_PKG_CONFIG` at bootstrap/autoconf run. We need renaming of PKG_ -> SPKG_ in `m4/sage_spkg_collect.m4`, which we take from #27114 in order not to cause conflicts. 
+
+#27114 probably will need a rebase on top of this branch.
``````




---

archive/issue_comments_420337.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI hope I have addressed all the issues raised, including the messy branches. Sorry, it took a while to get right.",
    "created_at": "2019-02-07T13:39:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420337",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:25" align="right">comment:25</div>

I hope I have addressed all the issues raised, including the messy branches. Sorry, it took a while to get right.



---

archive/issue_events_371086.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-07T13:39:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371086"
}
```



---

archive/issue_events_371087.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-07T13:39:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371087"
}
```



---

archive/issue_comments_420338.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nIndeed, this is more or less what I meant.\n\nFor the record, the message when the `pkg-config` macros are not installed:\n\n```\nconfigure.ac:219: error: Could not locate the pkg-config autoconf macros.\n    These are usually located in /usr/share/aclocal/pkg.m4. If your\n    macros are in a different location, try setting the environment\n    variable ACLOCAL=\"aclocal -I/other/macro/dir\" before running\n    ./bootstrap\nconfigure.ac:219: the top level\nautom4te: /usr/bin/m4 failed with exit status: 1\naclocal-1.15: error: echo failed with exit status: 1\nBootstrap failed. Either install pkg-config m4 macros for autotools or run bootstrap with                                                                               \nthe -d option to download the auto-generated files instead.                                                                                                             \n```\n\nSo it fails correctly.",
    "created_at": "2019-02-07T14:08:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420338",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

Indeed, this is more or less what I meant.

For the record, the message when the `pkg-config` macros are not installed:

```
configure.ac:219: error: Could not locate the pkg-config autoconf macros.
    These are usually located in /usr/share/aclocal/pkg.m4. If your
    macros are in a different location, try setting the environment
    variable ACLOCAL="aclocal -I/other/macro/dir" before running
    ./bootstrap
configure.ac:219: the top level
autom4te: /usr/bin/m4 failed with exit status: 1
aclocal-1.15: error: echo failed with exit status: 1
Bootstrap failed. Either install pkg-config m4 macros for autotools or run bootstrap with                                                                               
the -d option to download the auto-generated files instead.                                                                                                             
```

So it fails correctly.



---

archive/issue_comments_420339.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nOne more detail: it would be better to reserve a specific exit code for that case. I'll prepare a review commit.",
    "created_at": "2019-02-07T14:17:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420339",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

One more detail: it would be better to reserve a specific exit code for that case. I'll prepare a review commit.



---

archive/issue_comments_420340.json:
```json
{
    "body": "Changed branch from **[u/dimpase/build/bootstrap_check](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/build/bootstrap_check)** to **[u/jdemeyer/build/bootstrap_check](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/build/bootstrap_check)**",
    "created_at": "2019-02-07T14:25:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420340",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/dimpase/build/bootstrap_check](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/build/bootstrap_check)** to **[u/jdemeyer/build/bootstrap_check](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/build/bootstrap_check)**



---

archive/issue_comments_420341.json:
```json
{
    "body": "Changed commit from **[`87621c7`](https://github.com/sagemath/sagetrac-mirror/commit/87621c7b1d84df427ef10eaada47cb054080f6b6)** to **[`187de34`](https://github.com/sagemath/sagetrac-mirror/commit/187de3457be410072694ea4a69583ba15edde09a)**",
    "created_at": "2019-02-07T14:28:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420341",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`87621c7`](https://github.com/sagemath/sagetrac-mirror/commit/87621c7b1d84df427ef10eaada47cb054080f6b6)** to **[`187de34`](https://github.com/sagemath/sagetrac-mirror/commit/187de3457be410072694ea4a69583ba15edde09a)**



---

archive/issue_comments_420342.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI'm happy with this now. Feel free to set to positive review if you agree.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dcf2ab60db052401a214b3b2b2b1c857a1c37f78\"><code>dcf2ab6</code></a></td><td><code>renaming PKG_* -> SPKG_* in m4</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13c87f73c553090d0777174f86552b8c54104f46\"><code>13c87f7</code></a></td><td><code>check for pkg-config's m4 macros at bootstrap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/187de3457be410072694ea4a69583ba15edde09a\"><code>187de34</code></a></td><td><code>Use exit status 16 for missing pkg-config macros</code></td></tr></table>\n",
    "created_at": "2019-02-07T14:28:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420342",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

I'm happy with this now. Feel free to set to positive review if you agree.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dcf2ab60db052401a214b3b2b2b1c857a1c37f78"><code>dcf2ab6</code></a></td><td><code>renaming PKG_* -> SPKG_* in m4</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13c87f73c553090d0777174f86552b8c54104f46"><code>13c87f7</code></a></td><td><code>check for pkg-config's m4 macros at bootstrap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/187de3457be410072694ea4a69583ba15edde09a"><code>187de34</code></a></td><td><code>Use exit status 16 for missing pkg-config macros</code></td></tr></table>




---

archive/issue_comments_420343.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2019-02-07T14:28:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420343",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_420344.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nlooks good to me, thanks!",
    "created_at": "2019-02-07T14:40:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420344",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:30" align="right">comment:30</div>

looks good to me, thanks!



---

archive/issue_events_371088.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-07T14:40:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371088"
}
```



---

archive/issue_events_371089.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-07T14:40:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371089"
}
```



---

archive/issue_comments_420345.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI've been AFK, else I would've chimed in sooner.  But this looks good to me now.\n\nIndeed, there's no need to actually have `pkg-config` to build anything, just the `PKG_` macros that are typically installed alongside pkg-config.  I had also just suggested adding a copy of `pkg.m4` to our `m4/` directory but I like this even better (I see no reason a build machine, except maybe on OSX, shouldn't have pkg-config installed anyways).",
    "created_at": "2019-02-07T14:50:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420345",
    "user": "https://github.com/embray"
}
```

<div id="comment:31" align="right">comment:31</div>

I've been AFK, else I would've chimed in sooner.  But this looks good to me now.

Indeed, there's no need to actually have `pkg-config` to build anything, just the `PKG_` macros that are typically installed alongside pkg-config.  I had also just suggested adding a copy of `pkg.m4` to our `m4/` directory but I like this even better (I see no reason a build machine, except maybe on OSX, shouldn't have pkg-config installed anyways).



---

archive/issue_comments_420346.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/build/bootstrap_check](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/build/bootstrap_check)** to **[`187de34`](https://github.com/sagemath/sagetrac-mirror/commit/187de3457be410072694ea4a69583ba15edde09a)**",
    "created_at": "2019-02-08T23:21:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27219#issuecomment-420346",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/build/bootstrap_check](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/build/bootstrap_check)** to **[`187de34`](https://github.com/sagemath/sagetrac-mirror/commit/187de3457be410072694ea4a69583ba15edde09a)**



---

archive/issue_events_371090.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-08T23:21:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371090"
}
```



---

archive/issue_events_371091.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "8a58b7189f0eec35340fcf823de244e74dc85fec",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-02-08T23:21:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27219",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27219#event-371091"
}
```
