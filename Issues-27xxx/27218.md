# Issue 27218: Ensure that GAP's package build toolchain is fully available for building compiled package

archive/issues_026981.json:
```json
{
    "assignees": [],
    "body": "crypting makes use of GAP's compiler (aka `gac`), and other tooling, namely, `libtool`.\n\n`gac` is installed with broken information about various paths and `sysinfo.gap` location, and `libtool` isn't installed at all, it seems.\n\nHere is how gac's entries should be corrected:\n\n```\nabs_top_srcdir=\"${SAGE_LOCAL}/share/gap/src\"\nabs_top_builddir=\"${abs_top_srcdir}\" # obsolete naming...\n```\nand one should source `sysinfo.gap` as\n\n```\n. \"${abs_top_builddir}/../sysinfo.gap\"\n```\n\n`libtool` should be installed along with `gac`.\n\n\nCC:  @zerline @embray @kiwifb\n\nKeywords: **GAP packages**\n\nBranch/Commit: **[ca94bd9](https://github.com/sagemath/sagetrac-mirror/commit/ca94bd97d73ee544c273fbb28cb774b3af12ecb6)**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **Erik Bray**\n\nComponent: **packages: optional**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27218_\n\n",
    "closed_at": "2019-02-23T23:14:52Z",
    "created_at": "2019-02-04T18:53:29Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Ensure that GAP's package build toolchain is fully available for building compiled package",
    "type": "issue",
    "updated_at": "2019-02-23T23:14:52Z",
    "url": "https://github.com/sagemath/sage/issues/27218",
    "user": "https://github.com/dimpase"
}
```
crypting makes use of GAP's compiler (aka `gac`), and other tooling, namely, `libtool`.

`gac` is installed with broken information about various paths and `sysinfo.gap` location, and `libtool` isn't installed at all, it seems.

Here is how gac's entries should be corrected:

```
abs_top_srcdir="${SAGE_LOCAL}/share/gap/src"
abs_top_builddir="${abs_top_srcdir}" # obsolete naming...
```
and one should source `sysinfo.gap` as

```
. "${abs_top_builddir}/../sysinfo.gap"
```

`libtool` should be installed along with `gac`.


CC:  @zerline @embray @kiwifb

Keywords: **GAP packages**

Branch/Commit: **[ca94bd9](https://github.com/sagemath/sagetrac-mirror/commit/ca94bd97d73ee544c273fbb28cb774b3af12ecb6)**

Reviewer: **Dima Pasechnik**

Author: **Erik Bray**

Component: **packages: optional**

_Issue created by migration from https://trac.sagemath.org/ticket/27218_





---

archive/issue_events_373974.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-04T18:53:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373974"
}
```



---

archive/issue_events_373975.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-04T18:53:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "c: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373975"
}
```



---

archive/issue_events_373976.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-04T18:53:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373976"
}
```



---

archive/issue_events_373977.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-04T18:53:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373977"
}
```



---

archive/issue_comments_420376.json:
```json
{
    "body": "Dependencies: **#26930**",
    "created_at": "2019-02-04T19:00:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420376",
    "user": "https://github.com/dimpase"
}
```

Dependencies: **#26930**



---

archive/issue_comments_420377.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThe following patch (to the branch of #26930) installs crypting to the right place, and starts installation\n\n```\n--- a/build/pkgs/gap_packages/spkg-install\n+++ b/build/pkgs/gap_packages/spkg-install\n@@ -17,6 +17,7 @@ sdh_install \\\n     crime-* \\\n     cryst \\\n     crystcat \\\n+    crypting-* \\\n     design \\\n     gbnp \\\n     Hap* \\\n@@ -63,7 +64,7 @@ install_compiled_pkg()\n #\n # These packages have an old ./configure that take the GAP_ROOT as a positional\n # argument\n-for pkg in cohomolo-* grape-* guava-*\n+for pkg in cohomolo-* crypting-* grape-* guava-*\n do\n     echo \"Building GAP package $pkg\"\n     cd \"$PKG_SRC_DIR/$pkg\"\n```\n\nHowever, this still needs work, as building fails with \n\n```\n[gap_packages-4.10.0] Building GAP package crypting-0.9\n[gap_packages-4.10.0] Using config in /home/dimpase/Sage/sagetrac-mirror/local/share/gap/sysinfo.gap\n[gap_packages-4.10.0] Building gap_packages-4.10.0\n[gap_packages-4.10.0] make[2]: Entering directory '/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap_packages-4.10.0/src/pkg/crypting-0.9'\n[gap_packages-4.10.0] /home/dimpase/Sage/sagetrac-mirror/local/share/gap/gac: 73: .: Can't open /home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap-4.10.0/src/sysinfo.gap\n[gap_packages-4.10.0] Makefile:104: recipe for target 'obj/crypting.lo' failed\n```\n\nBasically, `gac` expects `sysinfo.gap` in the build tree, not in place announced in the 2nd line: `Using config in...`.",
    "created_at": "2019-02-04T20:08:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420377",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2" align="right">comment:2</div>

The following patch (to the branch of #26930) installs crypting to the right place, and starts installation

```
--- a/build/pkgs/gap_packages/spkg-install
+++ b/build/pkgs/gap_packages/spkg-install
@@ -17,6 +17,7 @@ sdh_install \
     crime-* \
     cryst \
     crystcat \
+    crypting-* \
     design \
     gbnp \
     Hap* \
@@ -63,7 +64,7 @@ install_compiled_pkg()
 #
 # These packages have an old ./configure that take the GAP_ROOT as a positional
 # argument
-for pkg in cohomolo-* grape-* guava-*
+for pkg in cohomolo-* crypting-* grape-* guava-*
 do
     echo "Building GAP package $pkg"
     cd "$PKG_SRC_DIR/$pkg"
```

However, this still needs work, as building fails with 

```
[gap_packages-4.10.0] Building GAP package crypting-0.9
[gap_packages-4.10.0] Using config in /home/dimpase/Sage/sagetrac-mirror/local/share/gap/sysinfo.gap
[gap_packages-4.10.0] Building gap_packages-4.10.0
[gap_packages-4.10.0] make[2]: Entering directory '/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap_packages-4.10.0/src/pkg/crypting-0.9'
[gap_packages-4.10.0] /home/dimpase/Sage/sagetrac-mirror/local/share/gap/gac: 73: .: Can't open /home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap-4.10.0/src/sysinfo.gap
[gap_packages-4.10.0] Makefile:104: recipe for target 'obj/crypting.lo' failed
```

Basically, `gac` expects `sysinfo.gap` in the build tree, not in place announced in the 2nd line: `Using config in...`.



---

archive/issue_comments_420378.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI didn't look in detail into libtool yet...",
    "created_at": "2019-02-04T23:35:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420378",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>

I didn't look in detail into libtool yet...



---

archive/issue_comments_420379.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,18 @@\n-see the subject (to be edited)\n+cryping makes use of GAP's compiler (aka gac), and other tooling, namely, libtool.\n+\n+gac is installed with broken information about various paths and sysinfo.gap, and libtool isn't installed at all, it seems.\n+\n+Here is how gac's entries should be corrected:\n+\n+```\n+abs_top_srcdir=\"${SAGE_LOCAL}/share/gap/src\"\n+abs_top_builddir=\"${abs_top_srcdir}\" # obsolete naming...\n+```\n+and one should source `sysinfo.gap` as\n+\n+```\n+. \"${abs_top_builddir}/../sysinfo.gap\"\n+```\n+\n+libtool should be installed, as well as gac...\n+\n``````\n",
    "created_at": "2019-02-04T23:35:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420379",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,18 @@
-see the subject (to be edited)
+cryping makes use of GAP's compiler (aka gac), and other tooling, namely, libtool.
+
+gac is installed with broken information about various paths and sysinfo.gap, and libtool isn't installed at all, it seems.
+
+Here is how gac's entries should be corrected:
+
+```
+abs_top_srcdir="${SAGE_LOCAL}/share/gap/src"
+abs_top_builddir="${abs_top_srcdir}" # obsolete naming...
+```
+and one should source `sysinfo.gap` as
+
+```
+. "${abs_top_builddir}/../sysinfo.gap"
+```
+
+libtool should be installed, as well as gac...
+
``````




---

archive/issue_comments_420380.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n-cryping makes use of GAP's compiler (aka gac), and other tooling, namely, libtool.\n+crypting makes use of GAP's compiler (aka `gac`), and other tooling, namely, `libtool`.\n \n-gac is installed with broken information about various paths and sysinfo.gap, and libtool isn't installed at all, it seems.\n+`gac` is installed with broken information about various paths and `sysinfo.gap` location, and `libtool` isn't installed at all, it seems.\n \n Here is how gac's entries should be corrected:\n \n@@ -14,5 +14,5 @@\n . \"${abs_top_builddir}/../sysinfo.gap\"\n ```\n \n-libtool should be installed, as well as gac...\n+`libtool` should be installed along with `gac`.\n \n``````\n",
    "created_at": "2019-02-04T23:37:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420380",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
-cryping makes use of GAP's compiler (aka gac), and other tooling, namely, libtool.
+crypting makes use of GAP's compiler (aka `gac`), and other tooling, namely, `libtool`.
 
-gac is installed with broken information about various paths and sysinfo.gap, and libtool isn't installed at all, it seems.
+`gac` is installed with broken information about various paths and `sysinfo.gap` location, and `libtool` isn't installed at all, it seems.
 
 Here is how gac's entries should be corrected:
 
@@ -14,5 +14,5 @@
 . "${abs_top_builddir}/../sysinfo.gap"
 ```
 
-libtool should be installed, as well as gac...
+`libtool` should be installed along with `gac`.
 
``````




---

archive/issue_comments_420381.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAfter fixing `gac` as above, I get\n\n```\n[gap_packages-4.10.0] Building GAP package crypting-0.9\n[gap_packages-4.10.0] Using config in /home/dimpase/Sage/sagetrac-mirror/local/share/gap/sysinfo.gap\n[gap_packages-4.10.0] Building gap_packages-4.10.0\n[gap_packages-4.10.0] make[2]: Entering directory '/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap_packages-4.10.0/src/pkg/crypting-0.9'\n[gap_packages-4.10.0] /bin/bash /home/dimpase/Sage/sagetrac-mirror/local/share/gap/src/libtool --mode=compile gcc -O2 -g -MQ obj/crypting.lo -MMD -MP -MF obj/.deps/crypting.d -o obj/crypting.lo -I/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap-4.10.0/src/gen -I/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap-4.10.0/src/src -I/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap-4.10.0/src -DHAVE_CONFIG_H -I/home/dimpase/Sage/sagetrac-mirror/local/include -c src/crypting.c\n[gap_packages-4.10.0] /bin/bash: /home/dimpase/Sage/sagetrac-mirror/local/share/gap/src/libtool: No such file or directory\n[gap_packages-4.10.0] Makefile:104: recipe for target 'obj/crypting.lo' failed\n```",
    "created_at": "2019-02-04T23:58:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420381",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

After fixing `gac` as above, I get

```
[gap_packages-4.10.0] Building GAP package crypting-0.9
[gap_packages-4.10.0] Using config in /home/dimpase/Sage/sagetrac-mirror/local/share/gap/sysinfo.gap
[gap_packages-4.10.0] Building gap_packages-4.10.0
[gap_packages-4.10.0] make[2]: Entering directory '/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap_packages-4.10.0/src/pkg/crypting-0.9'
[gap_packages-4.10.0] /bin/bash /home/dimpase/Sage/sagetrac-mirror/local/share/gap/src/libtool --mode=compile gcc -O2 -g -MQ obj/crypting.lo -MMD -MP -MF obj/.deps/crypting.d -o obj/crypting.lo -I/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap-4.10.0/src/gen -I/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap-4.10.0/src/src -I/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap-4.10.0/src -DHAVE_CONFIG_H -I/home/dimpase/Sage/sagetrac-mirror/local/include -c src/crypting.c
[gap_packages-4.10.0] /bin/bash: /home/dimpase/Sage/sagetrac-mirror/local/share/gap/src/libtool: No such file or directory
[gap_packages-4.10.0] Makefile:104: recipe for target 'obj/crypting.lo' failed
```



---

archive/issue_comments_420382.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nWhat an horrible little thing. It relies on gap's libtool to be configured I am guessing. `gac` should just go and die, I haven't changed my opinion since previous version of gap. Using all this stuff to fail to build something from one source file and installing it? Priceless.\n\nAt least `IO` uses real autotools so things are more easily correctable. Here I feel like using\n* a patch (same issue as `IO`)\n* a one liner compilation in spkg-install - libtool makes it easy to have the right extension so may be more line just to have that right\n* manual installation where gap expect it. That involves sourcing `sysinfo.gap` to find `GAParch`.\n\nOne liner: `$CC -shared -fPIC ${CFLAGS} crypting.{SOEXT} src/crypting.c`",
    "created_at": "2019-02-05T01:38:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420382",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:7" align="right">comment:7</div>

What an horrible little thing. It relies on gap's libtool to be configured I am guessing. `gac` should just go and die, I haven't changed my opinion since previous version of gap. Using all this stuff to fail to build something from one source file and installing it? Priceless.

At least `IO` uses real autotools so things are more easily correctable. Here I feel like using
* a patch (same issue as `IO`)
* a one liner compilation in spkg-install - libtool makes it easy to have the right extension so may be more line just to have that right
* manual installation where gap expect it. That involves sourcing `sysinfo.gap` to find `GAParch`.

One liner: `$CC -shared -fPIC ${CFLAGS} crypting.{SOEXT} src/crypting.c`



---

archive/issue_events_373978.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-05T13:39:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373978"
}
```



---

archive/issue_events_373979.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-05T13:39:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373979"
}
```



---

archive/issue_events_373980.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-05T13:39:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373980"
}
```



---

archive/issue_events_373981.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-05T13:39:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373981"
}
```



---

archive/issue_comments_420383.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThe following works:\n\n1) create a symbolic link from SAGE_LOCAL/include/gap to SAGE_LOCAL/include/src\n(this makes the patch for include locations unnecessary, also for GAP's IO\n\n2) install GAP's libtool the same way we install gac.\n(it should be one level below gac, in src/ subdirectory)\n\n3) patch gac as explained\n\nafter this, with the patch in comment 2, crypting gets installed just fine.\n\n\n---\n\nmy plan is now to do everything on #26930, and close this one, because it's too many small interconnecting things.",
    "created_at": "2019-02-05T13:39:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420383",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:8" align="right">comment:8</div>

The following works:

1) create a symbolic link from SAGE_LOCAL/include/gap to SAGE_LOCAL/include/src
(this makes the patch for include locations unnecessary, also for GAP's IO

2) install GAP's libtool the same way we install gac.
(it should be one level below gac, in src/ subdirectory)

3) patch gac as explained

after this, with the patch in comment 2, crypting gets installed just fine.


---

my plan is now to do everything on #26930, and close this one, because it's too many small interconnecting things.



---

archive/issue_events_373982.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-05T13:40:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373982"
}
```



---

archive/issue_events_373983.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-05T13:40:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373983"
}
```



---

archive/issue_comments_420384.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2019-02-05T13:40:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420384",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_420385.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nfurther work on this on #26930",
    "created_at": "2019-02-05T13:40:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420385",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">comment:9</div>

further work on this on #26930



---

archive/issue_comments_420386.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI think you're trying to combine too many different things in #26930.  Let's repurpose this ticket for fixing aspects of the GAP \"installation\" such as `sysinfo.gap` and correct installation of `gac`.\n\nThen you can make #26930 depend on this.",
    "created_at": "2019-02-05T15:37:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420386",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">comment:10</div>

I think you're trying to combine too many different things in #26930.  Let's repurpose this ticket for fixing aspects of the GAP "installation" such as `sysinfo.gap` and correct installation of `gac`.

Then you can make #26930 depend on this.



---

archive/issue_events_373984.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-05T15:37:15Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "title_is": "Fix problems with GAP installation affecting building of compiled GAP packages",
    "title_was": "add GAP package crypting and possibly more.",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373984"
}
```



---

archive/issue_events_373985.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-05T15:37:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373985"
}
```



---

archive/issue_events_373986.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-05T15:37:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373986"
}
```



---

archive/issue_events_373987.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-05T15:37:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373987"
}
```



---

archive/issue_comments_420387.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nSo it appears that for building various compiled packages, their build system assumes you're also running GAP itself out of a source tree, such that various build-related utilities and files used for building GAP itself can be repurposed for building GAP packages.\n\nPart of me is almost tempted to say that GAP packages should be built in a GAP build tree (i.e. re-extracting the main GAP source tarball, running `./configure` in it (though maybe not `make`; unclear) and then building the extension package.\n\nHowever, what is actually needed for this might be narrow enough that we can install it into `share/gap`.  It's also clear that the `sysinfo.gap` file needs to be patched up.  Let me examine exactly what the \"crypting\" package is trying to do before moving forward.",
    "created_at": "2019-02-05T15:41:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420387",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

So it appears that for building various compiled packages, their build system assumes you're also running GAP itself out of a source tree, such that various build-related utilities and files used for building GAP itself can be repurposed for building GAP packages.

Part of me is almost tempted to say that GAP packages should be built in a GAP build tree (i.e. re-extracting the main GAP source tarball, running `./configure` in it (though maybe not `make`; unclear) and then building the extension package.

However, what is actually needed for this might be narrow enough that we can install it into `share/gap`.  It's also clear that the `sysinfo.gap` file needs to be patched up.  Let me examine exactly what the "crypting" package is trying to do before moving forward.



---

archive/issue_events_373988.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-05T15:41:57Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "title_is": "Ensure that GAP's package build toolchain is fully available for building compiled package",
    "title_was": "Fix problems with GAP installation affecting building of compiled GAP packages",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373988"
}
```



---

archive/issue_comments_420388.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI got crypting pkg building out of the build tree, see my comments above.",
    "created_at": "2019-02-05T15:48:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420388",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:13" align="right">comment:13</div>

I got crypting pkg building out of the build tree, see my comments above.



---

archive/issue_comments_420389.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nAlso clearly `gac` needs to be fixed.  It *is* installed (something I recall making sure of), but I didn't realize that it was partially generated, with hard-coded paths in it :(",
    "created_at": "2019-02-05T15:58:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420389",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">comment:14</div>

Also clearly `gac` needs to be fixed.  It *is* installed (something I recall making sure of), but I didn't realize that it was partially generated, with hard-coded paths in it :(



---

archive/issue_comments_420390.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@embray](#comment:14):\n> Also clearly `gac` needs to be fixed.  It *is* installed (something I recall making sure of), but I didn't realize that it was partially generated, with hard-coded paths in it :(\n\nWell, this should have been clear from the ticket description.It suffices to do the changes as indicated there for it to be good enough for the job. And while clearing up sysinfo.gap would be nice, I'd rather leave it to upstream.",
    "created_at": "2019-02-05T16:21:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420390",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@embray](#comment:14):
> Also clearly `gac` needs to be fixed.  It *is* installed (something I recall making sure of), but I didn't realize that it was partially generated, with hard-coded paths in it :(

Well, this should have been clear from the ticket description.It suffices to do the changes as indicated there for it to be good enough for the job. And while clearing up sysinfo.gap would be nice, I'd rather leave it to upstream.



---

archive/issue_comments_420391.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@dimpase](#comment:15):\n> Replying to [@embray](#comment:14):\n> > Also clearly `gac` needs to be fixed.  It *is* installed (something I recall making sure of), but I didn't realize that it was partially generated, with hard-coded paths in it :(\n\n> \n> Well, this should have been clear from the ticket description.It suffices to do the changes as indicated there for it to be good enough for the job. And while clearing up sysinfo.gap would be nice, I'd rather leave it to upstream.\n\nYes, I was just confirming.\n\nI think sysinfo.gap needs to be fixed as well, but that's easy enough.\n\nI would rather leave *all* of this to upstream, though maybe our experiences here will help me help them improve the installation system for GAP.",
    "created_at": "2019-02-05T16:31:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420391",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@dimpase](#comment:15):
> Replying to [@embray](#comment:14):
> > Also clearly `gac` needs to be fixed.  It *is* installed (something I recall making sure of), but I didn't realize that it was partially generated, with hard-coded paths in it :(

> 
> Well, this should have been clear from the ticket description.It suffices to do the changes as indicated there for it to be good enough for the job. And while clearing up sysinfo.gap would be nice, I'd rather leave it to upstream.

Yes, I was just confirming.

I think sysinfo.gap needs to be fixed as well, but that's easy enough.

I would rather leave *all* of this to upstream, though maybe our experiences here will help me help them improve the installation system for GAP.



---

archive/issue_comments_420392.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAre you planning to work on this? If not, should I have a go at it?",
    "created_at": "2019-02-05T16:33:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420392",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

Are you planning to work on this? If not, should I have a go at it?



---

archive/issue_comments_420393.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nWith this fix, which is admittedly a hack (but an appropriate one), I was able to compile the crypting package from just any arbitrary location so long as I ran `configure $SAGE_LOCAL/share/gap` first.\n\nActually *installing* is another question, albeit mostly just a question of copying the source tree for the package into `$SAGE_LOCAL/share/gap/pkg` while making sure to strip out any build artifacts.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fe9f442280f9f3731284579175ee748b428c864b\">fe9f442</a></td><td><code>Trac #27218: Ensure that the same libtool that was used to build GAP is also</code></td></tr></table>\n",
    "created_at": "2019-02-05T16:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420393",
    "user": "https://github.com/embray"
}
```

<div id="comment:18" align="right">comment:18</div>

With this fix, which is admittedly a hack (but an appropriate one), I was able to compile the crypting package from just any arbitrary location so long as I ran `configure $SAGE_LOCAL/share/gap` first.

Actually *installing* is another question, albeit mostly just a question of copying the source tree for the package into `$SAGE_LOCAL/share/gap/pkg` while making sure to strip out any build artifacts.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fe9f442280f9f3731284579175ee748b428c864b">fe9f442</a></td><td><code>Trac #27218: Ensure that the same libtool that was used to build GAP is also</code></td></tr></table>




---

archive/issue_comments_420394.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2019-02-05T16:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420394",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_events_373989.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-05T16:37:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373989"
}
```



---

archive/issue_events_373990.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-05T16:37:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373990"
}
```



---

archive/issue_comments_420395.json:
```json
{
    "body": "Branch: **[u/embray/ticket-27218](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27218)**",
    "created_at": "2019-02-05T16:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420395",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/ticket-27218](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27218)**



---

archive/issue_comments_420396.json:
```json
{
    "body": "Commit: **[fe9f442](https://github.com/sagemath/sagetrac-mirror/commit/fe9f442280f9f3731284579175ee748b428c864b)**",
    "created_at": "2019-02-05T16:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420396",
    "user": "https://github.com/embray"
}
```

Commit: **[fe9f442](https://github.com/sagemath/sagetrac-mirror/commit/fe9f442280f9f3731284579175ee748b428c864b)**



---

archive/issue_comments_420397.json:
```json
{
    "body": "Changed dependencies from **#26930** to none",
    "created_at": "2019-02-05T16:37:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420397",
    "user": "https://github.com/embray"
}
```

Changed dependencies from **#26930** to none



---

archive/issue_comments_420398.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThis also worked for configuring and compiling the IO package without any needless patches.",
    "created_at": "2019-02-05T16:42:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420398",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

This also worked for configuring and compiling the IO package without any needless patches.



---

archive/issue_comments_420399.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\ncould you also add to this branch the installation of crypting and io in gap_packages/spkg-install ? This would be a good test.",
    "created_at": "2019-02-05T16:45:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420399",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">comment:21</div>

could you also add to this branch the installation of crypting and io in gap_packages/spkg-install ? This would be a good test.



---

archive/issue_comments_420400.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThis is important if anyone wants to install compiled GAP packages with Sage's GAP, whether manually, or through an SPKG.",
    "created_at": "2019-02-05T16:46:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420400",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">comment:22</div>

This is important if anyone wants to install compiled GAP packages with Sage's GAP, whether manually, or through an SPKG.



---

archive/issue_comments_420401.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@dimpase](#comment:21):\n> could you also add to this branch the installation of crypting and io in gap_packages/spkg-install ? This would be a good test.\n\nWorking on that now.",
    "created_at": "2019-02-05T16:46:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420401",
    "user": "https://github.com/embray"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@dimpase](#comment:21):
> could you also add to this branch the installation of crypting and io in gap_packages/spkg-install ? This would be a good test.

Working on that now.



---

archive/issue_comments_420402.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nActually, this should also bump the patch-level on the GAP SPKG.",
    "created_at": "2019-02-05T16:47:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420402",
    "user": "https://github.com/embray"
}
```

<div id="comment:24" align="right">comment:24</div>

Actually, this should also bump the patch-level on the GAP SPKG.



---

archive/issue_comments_420403.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5a2aaa89afe10cdefe6d09cde6a04f6ac3aec207\">5a2aaa8</a></td><td><code>Trac #27218: Ensure that the same libtool that was used to build GAP is also</code></td></tr></table>\n",
    "created_at": "2019-02-05T16:47:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420403",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5a2aaa89afe10cdefe6d09cde6a04f6ac3aec207">5a2aaa8</a></td><td><code>Trac #27218: Ensure that the same libtool that was used to build GAP is also</code></td></tr></table>




---

archive/issue_comments_420404.json:
```json
{
    "body": "Changed commit from **[fe9f442](https://github.com/sagemath/sagetrac-mirror/commit/fe9f442280f9f3731284579175ee748b428c864b)** to **[5a2aaa8](https://github.com/sagemath/sagetrac-mirror/commit/5a2aaa89afe10cdefe6d09cde6a04f6ac3aec207)**",
    "created_at": "2019-02-05T16:47:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420404",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[fe9f442](https://github.com/sagemath/sagetrac-mirror/commit/fe9f442280f9f3731284579175ee748b428c864b)** to **[5a2aaa8](https://github.com/sagemath/sagetrac-mirror/commit/5a2aaa89afe10cdefe6d09cde6a04f6ac3aec207)**



---

archive/issue_comments_420405.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nFor the record I don't intend to install gap's libtool in sage-on-gentoo. Yes gap has ugly bits just like sage had 10 years ago. `gac` could be an interesting tool once fixed and `sysinfo.gap` similarly needs to be more conform to an installation rather than an in tree thing. \n\nIn the few packages where it was important so far, only `GAParch` was really needed for an install for me. The rest was superfluous. It would be useful if `sysinfo.gap` had the proper include path so the problem of `#include \"src/...\"` versus `#include \"gap/...\"` would go away. Sounds like a job for pkg-config.",
    "created_at": "2019-02-05T19:30:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420405",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:26" align="right">comment:26</div>

For the record I don't intend to install gap's libtool in sage-on-gentoo. Yes gap has ugly bits just like sage had 10 years ago. `gac` could be an interesting tool once fixed and `sysinfo.gap` similarly needs to be more conform to an installation rather than an in tree thing. 

In the few packages where it was important so far, only `GAParch` was really needed for an install for me. The rest was superfluous. It would be useful if `sysinfo.gap` had the proper include path so the problem of `#include "src/..."` versus `#include "gap/..."` would go away. Sounds like a job for pkg-config.



---

archive/issue_comments_420406.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@kiwifb](#comment:26):\n> For the record I don't intend to install gap's libtool in sage-on-gentoo.\n\nTypically, `libtool` is not installed. It is shipped as part of the package installer and only used as build tool, analogous to `configure` for example.",
    "created_at": "2019-02-06T09:57:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420406",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@kiwifb](#comment:26):
> For the record I don't intend to install gap's libtool in sage-on-gentoo.

Typically, `libtool` is not installed. It is shipped as part of the package installer and only used as build tool, analogous to `configure` for example.



---

archive/issue_comments_420407.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nGiven that we use the same tarball for gap and for gap_packages, couldn't we just run `libtool` from the source tarball, the way how it's usually done?",
    "created_at": "2019-02-06T10:01:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420407",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

Given that we use the same tarball for gap and for gap_packages, couldn't we just run `libtool` from the source tarball, the way how it's usually done?



---

archive/issue_comments_420408.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@jdemeyer](#comment:28):\n> Given that we use the same tarball for gap and for gap_packages, couldn't we just run `libtool` from the source tarball, the way how it's usually done?\n\nnot all GAP packages live in this tarball. Not installing the necessary components to build GAP packages will lead to a half-broken GAP installation. I don't think it's a good idea.",
    "created_at": "2019-02-06T10:07:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420408",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@jdemeyer](#comment:28):
> Given that we use the same tarball for gap and for gap_packages, couldn't we just run `libtool` from the source tarball, the way how it's usually done?

not all GAP packages live in this tarball. Not installing the necessary components to build GAP packages will lead to a half-broken GAP installation. I don't think it's a good idea.



---

archive/issue_events_373991.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-06T11:24:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373991"
}
```



---

archive/issue_events_373992.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-06T11:24:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373992"
}
```



---

archive/issue_comments_420409.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nRegarding this branch:\n\n```\n[gap_packages-4.10.0.p0] Building GAP package crypting-0.9\n[gap_packages-4.10.0.p0] Using config in /mnt/opt/Sage/sage-dev/local/share/gap/sysinfo.gap\n[gap_packages-4.10.0.p0] Building gap_packages-4.10.0.p0\n[gap_packages-4.10.0.p0] make[2]: Entering directory '/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap_packages-4.10.0.p0/src/pkg/crypting-0.9'\n[gap_packages-4.10.0.p0] /usr/bin/bash /mnt/opt/Sage/sage-dev/local/share/gap/libtool --mode=compile gcc -O2 -g -MQ obj/crypting.lo -MMD -MP -MF obj/.deps/crypting.d -o obj/crypting.lo -I/mnt/opt/Sage/sage-dev/local/share/gap/gen -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src/src -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src -DHAVE_CONFIG_H -I/mnt/opt/Sage/sage-dev/local/include -c src/crypting.c\n[gap_packages-4.10.0.p0] libtool: compile:  gcc -O2 -g -MQ obj/crypting.lo -MMD -MP -MF obj/.deps/crypting.d -I/mnt/opt/Sage/sage-dev/local/share/gap/gen -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src/src -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src -DHAVE_CONFIG_H -I/mnt/opt/Sage/sage-dev/local/include -c src/crypting.c  -fPIC -DPIC -o obj/.libs/crypting.o\n[gap_packages-4.10.0.p0] src/crypting.c:5:10: fatal error: src/compiled.h: No such file or directory\n[gap_packages-4.10.0.p0]  #include \"src/compiled.h\"          /* GAP headers */\n[gap_packages-4.10.0.p0]           ^~~~~~~~~~~~~~~~\n```\n\nThat is, one still needs to take care of header location.\nE.g.\n\n```\nln -s $SAGE_LOCAL/include/gap $SAGE_LOCAL/include/src\n```\nallows crypting to be installed using the patch in comment 2.\nWould you like this header issue to be solved here, or done on #26930?",
    "created_at": "2019-02-06T11:24:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420409",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:30" align="right">comment:30</div>

Regarding this branch:

```
[gap_packages-4.10.0.p0] Building GAP package crypting-0.9
[gap_packages-4.10.0.p0] Using config in /mnt/opt/Sage/sage-dev/local/share/gap/sysinfo.gap
[gap_packages-4.10.0.p0] Building gap_packages-4.10.0.p0
[gap_packages-4.10.0.p0] make[2]: Entering directory '/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap_packages-4.10.0.p0/src/pkg/crypting-0.9'
[gap_packages-4.10.0.p0] /usr/bin/bash /mnt/opt/Sage/sage-dev/local/share/gap/libtool --mode=compile gcc -O2 -g -MQ obj/crypting.lo -MMD -MP -MF obj/.deps/crypting.d -o obj/crypting.lo -I/mnt/opt/Sage/sage-dev/local/share/gap/gen -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src/src -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src -DHAVE_CONFIG_H -I/mnt/opt/Sage/sage-dev/local/include -c src/crypting.c
[gap_packages-4.10.0.p0] libtool: compile:  gcc -O2 -g -MQ obj/crypting.lo -MMD -MP -MF obj/.deps/crypting.d -I/mnt/opt/Sage/sage-dev/local/share/gap/gen -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src/src -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src -DHAVE_CONFIG_H -I/mnt/opt/Sage/sage-dev/local/include -c src/crypting.c  -fPIC -DPIC -o obj/.libs/crypting.o
[gap_packages-4.10.0.p0] src/crypting.c:5:10: fatal error: src/compiled.h: No such file or directory
[gap_packages-4.10.0.p0]  #include "src/compiled.h"          /* GAP headers */
[gap_packages-4.10.0.p0]           ^~~~~~~~~~~~~~~~
```

That is, one still needs to take care of header location.
E.g.

```
ln -s $SAGE_LOCAL/include/gap $SAGE_LOCAL/include/src
```
allows crypting to be installed using the patch in comment 2.
Would you like this header issue to be solved here, or done on #26930?



---

archive/issue_comments_420410.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@kiwifb](#comment:26):\n> For the record I don't intend to install gap's libtool in sage-on-gentoo. Yes gap has ugly bits just like sage had 10 years ago.\n\nYou mean just like sage has now? ;)",
    "created_at": "2019-02-06T12:19:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420410",
    "user": "https://github.com/embray"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@kiwifb](#comment:26):
> For the record I don't intend to install gap's libtool in sage-on-gentoo. Yes gap has ugly bits just like sage had 10 years ago.

You mean just like sage has now? ;)



---

archive/issue_comments_420411.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nSomething about this still isn't working right then, because this\n\n```\n-I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src/src\n```\n\nshould not be in the compile flags.  I thought I made sure there would be no more references to the build directory, but I was tired last night when I was working on this so I must have missed something.\n\nAlso I agree with Jeroen of course that normally a libtool script should not be installed, though in this case it might be reasonable to do.",
    "created_at": "2019-02-06T12:27:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420411",
    "user": "https://github.com/embray"
}
```

<div id="comment:32" align="right">comment:32</div>

Something about this still isn't working right then, because this

```
-I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src/src
```

should not be in the compile flags.  I thought I made sure there would be no more references to the build directory, but I was tired last night when I was working on this so I must have missed something.

Also I agree with Jeroen of course that normally a libtool script should not be installed, though in this case it might be reasonable to do.



---

archive/issue_events_373993.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-06T12:27:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373993"
}
```



---

archive/issue_events_373994.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-06T12:27:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373994"
}
```



---

archive/issue_comments_420412.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nOops, duh, I left a `g` off the sed replacement pattern.  That's why you correctly have `-I/mnt/opt/Sage/sage-dev/local/share/gap/gen`, but then the rest of the `-I` flags still have the wrong path \ud83e\udd26\ud83c\udffc\u200d\u2640\ufe0f",
    "created_at": "2019-02-06T12:35:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420412",
    "user": "https://github.com/embray"
}
```

<div id="comment:34" align="right">comment:34</div>

Oops, duh, I left a `g` off the sed replacement pattern.  That's why you correctly have `-I/mnt/opt/Sage/sage-dev/local/share/gap/gen`, but then the rest of the `-I` flags still have the wrong path 🤦🏼‍♀️



---

archive/issue_comments_420413.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nBy the way, you should use `$SED`, not `sed`, right?",
    "created_at": "2019-02-06T12:42:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420413",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:35" align="right">comment:35</div>

By the way, you should use `$SED`, not `sed`, right?



---

archive/issue_comments_420414.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI can confirm that after adding that `|g` to `sed` pattern, everything is fine, great!\nPlease fix this in your branch, and you can flip it to positive review then.",
    "created_at": "2019-02-06T12:56:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420414",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:36" align="right">comment:36</div>

I can confirm that after adding that `|g` to `sed` pattern, everything is fine, great!
Please fix this in your branch, and you can flip it to positive review then.



---

archive/issue_comments_420415.json:
```json
{
    "body": "Changed commit from **[5a2aaa8](https://github.com/sagemath/sagetrac-mirror/commit/5a2aaa89afe10cdefe6d09cde6a04f6ac3aec207)** to **[631a541](https://github.com/sagemath/sagetrac-mirror/commit/631a5415da905628b25144212ee08be7ab50c2f4)**",
    "created_at": "2019-02-06T13:59:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420415",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5a2aaa8](https://github.com/sagemath/sagetrac-mirror/commit/5a2aaa89afe10cdefe6d09cde6a04f6ac3aec207)** to **[631a541](https://github.com/sagemath/sagetrac-mirror/commit/631a5415da905628b25144212ee08be7ab50c2f4)**



---

archive/issue_comments_420416.json:
```json
{
    "body": "<div id=\"comment:37\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/631a5415da905628b25144212ee08be7ab50c2f4\">631a541</a></td><td><code>Trac #27218: Ensure that the same libtool that was used to build GAP is also</code></td></tr></table>\n",
    "created_at": "2019-02-06T13:59:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420416",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/631a5415da905628b25144212ee08be7ab50c2f4">631a541</a></td><td><code>Trac #27218: Ensure that the same libtool that was used to build GAP is also</code></td></tr></table>




---

archive/issue_comments_420417.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nShould also fix up `bin/gap.sh` (although we don't use it in Sage, it should still contain the correct paths, maybe just in case some pkg uses it during a build) and also `doc/make_doc` contains references to the GAP builddir.",
    "created_at": "2019-02-06T14:14:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420417",
    "user": "https://github.com/embray"
}
```

<div id="comment:38" align="right">comment:38</div>

Should also fix up `bin/gap.sh` (although we don't use it in Sage, it should still contain the correct paths, maybe just in case some pkg uses it during a build) and also `doc/make_doc` contains references to the GAP builddir.



---

archive/issue_comments_420418.json:
```json
{
    "body": "Changed commit from **[631a541](https://github.com/sagemath/sagetrac-mirror/commit/631a5415da905628b25144212ee08be7ab50c2f4)** to **[3827170](https://github.com/sagemath/sagetrac-mirror/commit/38271700f9323038b8268edcf4d7bb817dc7bf74)**",
    "created_at": "2019-02-06T14:19:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420418",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[631a541](https://github.com/sagemath/sagetrac-mirror/commit/631a5415da905628b25144212ee08be7ab50c2f4)** to **[3827170](https://github.com/sagemath/sagetrac-mirror/commit/38271700f9323038b8268edcf4d7bb817dc7bf74)**



---

archive/issue_comments_420419.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/38271700f9323038b8268edcf4d7bb817dc7bf74\">3827170</a></td><td><code>make similar replacements in a couple more files that reference the GAP build directory</code></td></tr></table>\n",
    "created_at": "2019-02-06T14:19:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420419",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/38271700f9323038b8268edcf4d7bb817dc7bf74">3827170</a></td><td><code>make similar replacements in a couple more files that reference the GAP build directory</code></td></tr></table>




---

archive/issue_comments_420420.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@dimpase](#comment:35):\n> By the way, you should use `$SED`, not `sed`, right?\n\nThat's generally just in an autoconf macro, where if you have done `AC_PROG_SED`.  It's not necessarily bad practice to use a `$SED` variable either, in case it needs to be overridden for some reason, but in that case you'd still have to set a default somewhere, and we aren't doing that in any other `spkg-install` script.",
    "created_at": "2019-02-06T14:22:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420420",
    "user": "https://github.com/embray"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@dimpase](#comment:35):
> By the way, you should use `$SED`, not `sed`, right?

That's generally just in an autoconf macro, where if you have done `AC_PROG_SED`.  It's not necessarily bad practice to use a `$SED` variable either, in case it needs to be overridden for some reason, but in that case you'd still have to set a default somewhere, and we aren't doing that in any other `spkg-install` script.



---

archive/issue_events_373995.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-06T14:22:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373995"
}
```



---

archive/issue_events_373996.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-06T14:22:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373996"
}
```



---

archive/issue_events_373997.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-06T15:23:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373997"
}
```



---

archive/issue_events_373998.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-06T15:23:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373998"
}
```



---

archive/issue_comments_420421.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nOK, thanks!",
    "created_at": "2019-02-06T15:23:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420421",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:42" align="right">comment:42</div>

OK, thanks!



---

archive/issue_comments_420422.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@embray](#comment:31):\n> Replying to [@kiwifb](#comment:26):\n> > For the record I don't intend to install gap's libtool in sage-on-gentoo. Yes gap has ugly bits just like sage had 10 years ago.\n\n> \n> You mean just like sage has now? ;)\n\nYes :) but 10 years ago it was way worse. Where do you want me to start ;) Enough off topic from me.",
    "created_at": "2019-02-06T17:59:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420422",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@embray](#comment:31):
> Replying to [@kiwifb](#comment:26):
> > For the record I don't intend to install gap's libtool in sage-on-gentoo. Yes gap has ugly bits just like sage had 10 years ago.

> 
> You mean just like sage has now? ;)

Yes :) but 10 years ago it was way worse. Where do you want me to start ;) Enough off topic from me.



---

archive/issue_comments_420423.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nOn OSX:\n\n```\nsed: 1: \"/Users/buildslave-sage/ ...\": undefined label 'uildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/gap-4.10.0.p0/inst/Users/buildslave-sage/slave/sage_git/build/local/bin/gac'\n```",
    "created_at": "2019-02-08T12:35:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420423",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:44" align="right">comment:44</div>

On OSX:

```
sed: 1: "/Users/buildslave-sage/ ...": undefined label 'uildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/gap-4.10.0.p0/inst/Users/buildslave-sage/slave/sage_git/build/local/bin/gac'
```



---

archive/issue_events_373999.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-08T12:35:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-373999"
}
```



---

archive/issue_events_374000.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-08T12:35:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-374000"
}
```



---

archive/issue_comments_420424.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nIt appears on OSX you need `sed -i -e <pattern>` or else it will treat `<pattern>` as the optional parameter to `-i`.  I really hate this platform.",
    "created_at": "2019-02-08T12:53:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420424",
    "user": "https://github.com/embray"
}
```

<div id="comment:45" align="right">comment:45</div>

It appears on OSX you need `sed -i -e <pattern>` or else it will treat `<pattern>` as the optional parameter to `-i`.  I really hate this platform.



---

archive/issue_comments_420425.json:
```json
{
    "body": "<div id=\"comment:46\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca94bd97d73ee544c273fbb28cb774b3af12ecb6\">ca94bd9</a></td><td><code>Trac #27218: Ensure that the same libtool that was used to build GAP is also</code></td></tr></table>\n",
    "created_at": "2019-02-08T13:03:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420425",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:46"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca94bd97d73ee544c273fbb28cb774b3af12ecb6">ca94bd9</a></td><td><code>Trac #27218: Ensure that the same libtool that was used to build GAP is also</code></td></tr></table>




---

archive/issue_comments_420426.json:
```json
{
    "body": "Changed commit from **[3827170](https://github.com/sagemath/sagetrac-mirror/commit/38271700f9323038b8268edcf4d7bb817dc7bf74)** to **[ca94bd9](https://github.com/sagemath/sagetrac-mirror/commit/ca94bd97d73ee544c273fbb28cb774b3af12ecb6)**",
    "created_at": "2019-02-08T13:03:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420426",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3827170](https://github.com/sagemath/sagetrac-mirror/commit/38271700f9323038b8268edcf4d7bb817dc7bf74)** to **[ca94bd9](https://github.com/sagemath/sagetrac-mirror/commit/ca94bd97d73ee544c273fbb28cb774b3af12ecb6)**



---

archive/issue_comments_420427.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@embray](#comment:45):\n> It appears on OSX you need `sed -i -e <pattern>` or else it will treat `<pattern>` as the optional parameter to `-i`.  I really hate this platform.\n\nYes, this hit us already at #25321 (\"sed -i is not portable\").",
    "created_at": "2019-02-09T00:37:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420427",
    "user": "https://github.com/slel"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@embray](#comment:45):
> It appears on OSX you need `sed -i -e <pattern>` or else it will treat `<pattern>` as the optional parameter to `-i`.  I really hate this platform.

Yes, this hit us already at #25321 ("sed -i is not portable").



---

archive/issue_comments_420428.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nThis particular bug is fixed, but I still cannot reinstall GAP spkg on OSX without first manually removing all of `SAGE_LOCAL/share/gap`. Some file permissions are wrong (on OSX)...",
    "created_at": "2019-02-09T08:27:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420428",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:48" align="right">comment:48</div>

This particular bug is fixed, but I still cannot reinstall GAP spkg on OSX without first manually removing all of `SAGE_LOCAL/share/gap`. Some file permissions are wrong (on OSX)...



---

archive/issue_comments_420429.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nAlso, on OSX paths to binary files of GAP packages are not correct. E.g. `local/lib/gap/pkg/io-4.5.4/x86_64-apple-darwin17.7.0-default64/` instead of `local/lib/gap/pkg/io-4.5.4/bin/x86_64-apple-darwin17.7.0-default64/`, and IO package does not load.\nIf I do \n\n```\n$ mkdir local/lib/gap/pkg/io-4.5.4/bin\n$ mv local/lib/gap/pkg/io-4.5.4/x86_64-apple-darwin17.7.0-default64 local/lib/gap/pkg/io-4.5.4\n```\nthen it works.",
    "created_at": "2019-02-09T10:50:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420429",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:49" align="right">comment:49</div>

Also, on OSX paths to binary files of GAP packages are not correct. E.g. `local/lib/gap/pkg/io-4.5.4/x86_64-apple-darwin17.7.0-default64/` instead of `local/lib/gap/pkg/io-4.5.4/bin/x86_64-apple-darwin17.7.0-default64/`, and IO package does not load.
If I do 

```
$ mkdir local/lib/gap/pkg/io-4.5.4/bin
$ mv local/lib/gap/pkg/io-4.5.4/x86_64-apple-darwin17.7.0-default64 local/lib/gap/pkg/io-4.5.4
```
then it works.



---

archive/issue_comments_420430.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nperhaps one should switch from doing `cp` etc. to doing `install`, as suggested on https://github.com/gap-system/gap-distribution/issues/72",
    "created_at": "2019-02-09T13:29:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420430",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:50" align="right">comment:50</div>

perhaps one should switch from doing `cp` etc. to doing `install`, as suggested on https://github.com/gap-system/gap-distribution/issues/72



---

archive/issue_events_374001.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-22T14:08:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-374001"
}
```



---

archive/issue_events_374002.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-22T14:08:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-374002"
}
```



---

archive/issue_comments_420431.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nForgot to set this back to needs review after fixing the sed call.  Other problems about uninstalling packages on OSX are separate and unrelated to this ticket (see e.g. #27124).",
    "created_at": "2019-02-22T14:08:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420431",
    "user": "https://github.com/embray"
}
```

<div id="comment:51" align="right">comment:51</div>

Forgot to set this back to needs review after fixing the sed call.  Other problems about uninstalling packages on OSX are separate and unrelated to this ticket (see e.g. #27124).



---

archive/issue_comments_420432.json:
```json
{
    "body": "Changed branch from **[u/embray/ticket-27218](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27218)** to **[ca94bd9](https://github.com/sagemath/sagetrac-mirror/commit/ca94bd97d73ee544c273fbb28cb774b3af12ecb6)**",
    "created_at": "2019-02-23T23:14:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27218#issuecomment-420432",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/ticket-27218](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27218)** to **[ca94bd9](https://github.com/sagemath/sagetrac-mirror/commit/ca94bd97d73ee544c273fbb28cb774b3af12ecb6)**



---

archive/issue_events_374003.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-23T23:14:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-374003"
}
```



---

archive/issue_events_374004.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "a0743513726f9b7960367d97bdfa6ea8060e51df",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-02-23T23:14:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27218",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27218#event-374004"
}
```
