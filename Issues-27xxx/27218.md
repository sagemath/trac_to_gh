# Issue 27218: Ensure that GAP's package build toolchain is fully available for building compiled package

archive/issues_026981.json:
```json
{
    "body": "crypting makes use of GAP's compiler (aka `gac`), and other tooling, namely, `libtool`.\n\n`gac` is installed with broken information about various paths and `sysinfo.gap` location, and `libtool` isn't installed at all, it seems.\n\nHere is how gac's entries should be corrected:\n\n```\nabs_top_srcdir=\"${SAGE_LOCAL}/share/gap/src\"\nabs_top_builddir=\"${abs_top_srcdir}\" # obsolete naming...\n```\nand one should source `sysinfo.gap` as\n\n```\n. \"${abs_top_builddir}/../sysinfo.gap\"\n```\n\n`libtool` should be installed along with `gac`.\n\n\nCC:  zerline @embray @kiwifb\n\nKeywords: GAP packages\n\nBranch/Commit: ca94bd97d73ee544c273fbb28cb774b3af12ecb6\n\nReviewer: Dima Pasechnik\n\nAuthor: Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27218\n\n",
    "closed_at": "2019-02-23T23:14:52Z",
    "created_at": "2019-02-04T18:53:29Z",
    "labels": [
        "component: packages: optional",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Ensure that GAP's package build toolchain is fully available for building compiled package",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27218",
    "user": "https://github.com/dimpase"
}
```
crypting makes use of GAP's compiler (aka `gac`), and other tooling, namely, `libtool`.

`gac` is installed with broken information about various paths and `sysinfo.gap` location, and `libtool` isn't installed at all, it seems.

Here is how gac's entries should be corrected:

```
abs_top_srcdir="${SAGE_LOCAL}/share/gap/src"
abs_top_builddir="${abs_top_srcdir}" # obsolete naming...
```
and one should source `sysinfo.gap` as

```
. "${abs_top_builddir}/../sysinfo.gap"
```

`libtool` should be installed along with `gac`.


CC:  zerline @embray @kiwifb

Keywords: GAP packages

Branch/Commit: ca94bd97d73ee544c273fbb28cb774b3af12ecb6

Reviewer: Dima Pasechnik

Author: Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27218





---

archive/issue_comments_404393.json:
```json
{
    "body": "<a id='comment:2'></a>The following patch (to the branch of #26930) installs crypting to the right place, and starts installation\n\n```\n--- a/build/pkgs/gap_packages/spkg-install\n+++ b/build/pkgs/gap_packages/spkg-install\n@@ -17,6 +17,7 @@ sdh_install \\\n     crime-* \\\n     cryst \\\n     crystcat \\\n+    crypting-* \\\n     design \\\n     gbnp \\\n     Hap* \\\n@@ -63,7 +64,7 @@ install_compiled_pkg()\n #\n # These packages have an old ./configure that take the GAP_ROOT as a positional\n # argument\n-for pkg in cohomolo-* grape-* guava-*\n+for pkg in cohomolo-* crypting-* grape-* guava-*\n do\n     echo \"Building GAP package $pkg\"\n     cd \"$PKG_SRC_DIR/$pkg\"\n```\n\nHowever, this still needs work, as building fails with \n\n```\n[gap_packages-4.10.0] Building GAP package crypting-0.9\n[gap_packages-4.10.0] Using config in /home/dimpase/Sage/sagetrac-mirror/local/share/gap/sysinfo.gap\n[gap_packages-4.10.0] Building gap_packages-4.10.0\n[gap_packages-4.10.0] make[2]: Entering directory '/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap_packages-4.10.0/src/pkg/crypting-0.9'\n[gap_packages-4.10.0] /home/dimpase/Sage/sagetrac-mirror/local/share/gap/gac: 73: .: Can't open /home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap-4.10.0/src/sysinfo.gap\n[gap_packages-4.10.0] Makefile:104: recipe for target 'obj/crypting.lo' failed\n```\n\nBasically, `gac` expects `sysinfo.gap` in the build tree, not in place announced in the 2nd line: `Using config in...`.",
    "created_at": "2019-02-04T20:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404393",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>The following patch (to the branch of #26930) installs crypting to the right place, and starts installation

```
--- a/build/pkgs/gap_packages/spkg-install
+++ b/build/pkgs/gap_packages/spkg-install
@@ -17,6 +17,7 @@ sdh_install \
     crime-* \
     cryst \
     crystcat \
+    crypting-* \
     design \
     gbnp \
     Hap* \
@@ -63,7 +64,7 @@ install_compiled_pkg()
 #
 # These packages have an old ./configure that take the GAP_ROOT as a positional
 # argument
-for pkg in cohomolo-* grape-* guava-*
+for pkg in cohomolo-* crypting-* grape-* guava-*
 do
     echo "Building GAP package $pkg"
     cd "$PKG_SRC_DIR/$pkg"
```

However, this still needs work, as building fails with 

```
[gap_packages-4.10.0] Building GAP package crypting-0.9
[gap_packages-4.10.0] Using config in /home/dimpase/Sage/sagetrac-mirror/local/share/gap/sysinfo.gap
[gap_packages-4.10.0] Building gap_packages-4.10.0
[gap_packages-4.10.0] make[2]: Entering directory '/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap_packages-4.10.0/src/pkg/crypting-0.9'
[gap_packages-4.10.0] /home/dimpase/Sage/sagetrac-mirror/local/share/gap/gac: 73: .: Can't open /home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap-4.10.0/src/sysinfo.gap
[gap_packages-4.10.0] Makefile:104: recipe for target 'obj/crypting.lo' failed
```

Basically, `gac` expects `sysinfo.gap` in the build tree, not in place announced in the 2nd line: `Using config in...`.



---

archive/issue_comments_404394.json:
```json
{
    "body": "<a id='comment:4'></a>I didn't look in detail into libtool yet...",
    "created_at": "2019-02-04T23:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404394",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>I didn't look in detail into libtool yet...



---

archive/issue_comments_404395.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,21 @@\n-see the subject (to be edited)\n+cryping makes use of GAP's compiler (aka gac), and other tooling, namely, libtool.\n+\n+gac is installed with broken information about various paths and sysinfo.gap, and libtool isn't installed at all, it seems.\n+\n+Here is how gac's entries should be corrected:\n+\n+```\n+abs_top_srcdir=\"${SAGE_LOCAL}/share/gap/src\"\n+abs_top_builddir=\"${abs_top_srcdir}\" # obsolete naming...\n+```\n+and one should source `sysinfo.gap` as\n+\n+```\n+. \"${abs_top_builddir}/../sysinfo.gap\"\n+```\n+\n+libtool should be installed, as well as gac...\n+\n \n Comment: 1\n \n``````\n",
    "created_at": "2019-02-04T23:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404395",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,21 @@
-see the subject (to be edited)
+cryping makes use of GAP's compiler (aka gac), and other tooling, namely, libtool.
+
+gac is installed with broken information about various paths and sysinfo.gap, and libtool isn't installed at all, it seems.
+
+Here is how gac's entries should be corrected:
+
+```
+abs_top_srcdir="${SAGE_LOCAL}/share/gap/src"
+abs_top_builddir="${abs_top_srcdir}" # obsolete naming...
+```
+and one should source `sysinfo.gap` as
+
+```
+. "${abs_top_builddir}/../sysinfo.gap"
+```
+
+libtool should be installed, as well as gac...
+
 
 Comment: 1
 
``````




---

archive/issue_comments_404396.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,20 @@\n+crypting makes use of GAP's compiler (aka `gac`), and other tooling, namely, `libtool`.\n+\n+`gac` is installed with broken information about various paths and `sysinfo.gap` location, and `libtool` isn't installed at all, it seems.\n+\n+Here is how gac's entries should be corrected:\n+\n+```\n+abs_top_srcdir=\"${SAGE_LOCAL}/share/gap/src\"\n+abs_top_builddir=\"${abs_top_srcdir}\" # obsolete naming...\n+```\n+and one should source `sysinfo.gap` as\n+\n+```\n+. \"${abs_top_builddir}/../sysinfo.gap\"\n+```\n+\n+`libtool` should be installed along with `gac`.\n \n \n Comment: 1\n``````\n",
    "created_at": "2019-02-04T23:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404396",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,20 @@
+crypting makes use of GAP's compiler (aka `gac`), and other tooling, namely, `libtool`.
+
+`gac` is installed with broken information about various paths and `sysinfo.gap` location, and `libtool` isn't installed at all, it seems.
+
+Here is how gac's entries should be corrected:
+
+```
+abs_top_srcdir="${SAGE_LOCAL}/share/gap/src"
+abs_top_builddir="${abs_top_srcdir}" # obsolete naming...
+```
+and one should source `sysinfo.gap` as
+
+```
+. "${abs_top_builddir}/../sysinfo.gap"
+```
+
+`libtool` should be installed along with `gac`.
 
 
 Comment: 1
``````




---

archive/issue_comments_404397.json:
```json
{
    "body": "<a id='comment:6'></a>After fixing `gac` as above, I get\n\n```\n[gap_packages-4.10.0] Building GAP package crypting-0.9\n[gap_packages-4.10.0] Using config in /home/dimpase/Sage/sagetrac-mirror/local/share/gap/sysinfo.gap\n[gap_packages-4.10.0] Building gap_packages-4.10.0\n[gap_packages-4.10.0] make[2]: Entering directory '/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap_packages-4.10.0/src/pkg/crypting-0.9'\n[gap_packages-4.10.0] /bin/bash /home/dimpase/Sage/sagetrac-mirror/local/share/gap/src/libtool --mode=compile gcc -O2 -g -MQ obj/crypting.lo -MMD -MP -MF obj/.deps/crypting.d -o obj/crypting.lo -I/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap-4.10.0/src/gen -I/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap-4.10.0/src/src -I/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap-4.10.0/src -DHAVE_CONFIG_H -I/home/dimpase/Sage/sagetrac-mirror/local/include -c src/crypting.c\n[gap_packages-4.10.0] /bin/bash: /home/dimpase/Sage/sagetrac-mirror/local/share/gap/src/libtool: No such file or directory\n[gap_packages-4.10.0] Makefile:104: recipe for target 'obj/crypting.lo' failed\n```",
    "created_at": "2019-02-04T23:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404397",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>After fixing `gac` as above, I get

```
[gap_packages-4.10.0] Building GAP package crypting-0.9
[gap_packages-4.10.0] Using config in /home/dimpase/Sage/sagetrac-mirror/local/share/gap/sysinfo.gap
[gap_packages-4.10.0] Building gap_packages-4.10.0
[gap_packages-4.10.0] make[2]: Entering directory '/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap_packages-4.10.0/src/pkg/crypting-0.9'
[gap_packages-4.10.0] /bin/bash /home/dimpase/Sage/sagetrac-mirror/local/share/gap/src/libtool --mode=compile gcc -O2 -g -MQ obj/crypting.lo -MMD -MP -MF obj/.deps/crypting.d -o obj/crypting.lo -I/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap-4.10.0/src/gen -I/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap-4.10.0/src/src -I/home/dimpase/Sage/sagetrac-mirror/local/var/tmp/sage/build/gap-4.10.0/src -DHAVE_CONFIG_H -I/home/dimpase/Sage/sagetrac-mirror/local/include -c src/crypting.c
[gap_packages-4.10.0] /bin/bash: /home/dimpase/Sage/sagetrac-mirror/local/share/gap/src/libtool: No such file or directory
[gap_packages-4.10.0] Makefile:104: recipe for target 'obj/crypting.lo' failed
```



---

archive/issue_comments_404398.json:
```json
{
    "body": "<a id='comment:7'></a>What an horrible little thing. It relies on gap's libtool to be configured I am guessing. `gac` should just go and die, I haven't changed my opinion since previous version of gap. Using all this stuff to fail to build something from one source file and installing it? Priceless.\n\nAt least `IO` uses real autotools so things are more easily correctable. Here I feel like using\n* a patch (same issue as `IO`)\n* a one liner compilation in spkg-install - libtool makes it easy to have the right extension so may be more line just to have that right\n* manual installation where gap expect it. That involves sourcing `sysinfo.gap` to find `GAParch`.\n\nOne liner: `$CC -shared -fPIC ${CFLAGS} crypting.{SOEXT} src/crypting.c`",
    "created_at": "2019-02-05T01:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404398",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>What an horrible little thing. It relies on gap's libtool to be configured I am guessing. `gac` should just go and die, I haven't changed my opinion since previous version of gap. Using all this stuff to fail to build something from one source file and installing it? Priceless.

At least `IO` uses real autotools so things are more easily correctable. Here I feel like using
* a patch (same issue as `IO`)
* a one liner compilation in spkg-install - libtool makes it easy to have the right extension so may be more line just to have that right
* manual installation where gap expect it. That involves sourcing `sysinfo.gap` to find `GAParch`.

One liner: `$CC -shared -fPIC ${CFLAGS} crypting.{SOEXT} src/crypting.c`



---

archive/issue_events_067574.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-05T13:39:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27218#event-67574"
}
```



---

archive/issue_comments_404399.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-02-05T13:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404399",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_404400.json:
```json
{
    "body": "<a id='comment:8'></a>The following works:\n\n1) create a symbolic link from SAGE_LOCAL/include/gap to SAGE_LOCAL/include/src\n(this makes the patch for include locations unnecessary, also for GAP's IO\n\n2) install GAP's libtool the same way we install gac.\n(it should be one level below gac, in src/ subdirectory)\n\n3) patch gac as explained\n\nafter this, with the patch in comment 2, crypting gets installed just fine.\n\n\n---\n\nmy plan is now to do everything on #26930, and close this one, because it's too many small interconnecting things.",
    "created_at": "2019-02-05T13:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404400",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>The following works:

1) create a symbolic link from SAGE_LOCAL/include/gap to SAGE_LOCAL/include/src
(this makes the patch for include locations unnecessary, also for GAP's IO

2) install GAP's libtool the same way we install gac.
(it should be one level below gac, in src/ subdirectory)

3) patch gac as explained

after this, with the patch in comment 2, crypting gets installed just fine.


---

my plan is now to do everything on #26930, and close this one, because it's too many small interconnecting things.



---

archive/issue_comments_404401.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-05T13:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404401",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_404402.json:
```json
{
    "body": "<a id='comment:9'></a>further work on this on #26930",
    "created_at": "2019-02-05T13:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404402",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>further work on this on #26930



---

archive/issue_comments_404403.json:
```json
{
    "body": "<a id='comment:10'></a>I think you're trying to combine too many different things in #26930.  Let's repurpose this ticket for fixing aspects of the GAP \"installation\" such as `sysinfo.gap` and correct installation of `gac`.\n\nThen you can make #26930 depend on this.",
    "created_at": "2019-02-05T15:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404403",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>I think you're trying to combine too many different things in #26930.  Let's repurpose this ticket for fixing aspects of the GAP "installation" such as `sysinfo.gap` and correct installation of `gac`.

Then you can make #26930 depend on this.



---

archive/issue_events_067575.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-05T15:37:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27218#event-67575"
}
```



---

archive/issue_events_067576.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-05T15:37:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27218#event-67576"
}
```



---

archive/issue_comments_404404.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-02-05T15:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404404",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_404405.json:
```json
{
    "body": "<a id='comment:11'></a>So it appears that for building various compiled packages, their build system assumes you're also running GAP itself out of a source tree, such that various build-related utilities and files used for building GAP itself can be repurposed for building GAP packages.\n\nPart of me is almost tempted to say that GAP packages should be built in a GAP build tree (i.e. re-extracting the main GAP source tarball, running `./configure` in it (though maybe not `make`; unclear) and then building the extension package.\n\nHowever, what is actually needed for this might be narrow enough that we can install it into `share/gap`.  It's also clear that the `sysinfo.gap` file needs to be patched up.  Let me examine exactly what the \"crypting\" package is trying to do before moving forward.",
    "created_at": "2019-02-05T15:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404405",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>So it appears that for building various compiled packages, their build system assumes you're also running GAP itself out of a source tree, such that various build-related utilities and files used for building GAP itself can be repurposed for building GAP packages.

Part of me is almost tempted to say that GAP packages should be built in a GAP build tree (i.e. re-extracting the main GAP source tarball, running `./configure` in it (though maybe not `make`; unclear) and then building the extension package.

However, what is actually needed for this might be narrow enough that we can install it into `share/gap`.  It's also clear that the `sysinfo.gap` file needs to be patched up.  Let me examine exactly what the "crypting" package is trying to do before moving forward.



---

archive/issue_comments_404406.json:
```json
{
    "body": "<a id='comment:13'></a>I got crypting pkg building out of the build tree, see my comments above.",
    "created_at": "2019-02-05T15:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404406",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>I got crypting pkg building out of the build tree, see my comments above.



---

archive/issue_comments_404407.json:
```json
{
    "body": "<a id='comment:14'></a>Also clearly `gac` needs to be fixed.  It *is* installed (something I recall making sure of), but I didn't realize that it was partially generated, with hard-coded paths in it :(",
    "created_at": "2019-02-05T15:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404407",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>Also clearly `gac` needs to be fixed.  It *is* installed (something I recall making sure of), but I didn't realize that it was partially generated, with hard-coded paths in it :(



---

archive/issue_comments_404408.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 embray]:\n> Also clearly `gac` needs to be fixed.  It *is* installed (something I recall making sure of), but I didn't realize that it was partially generated, with hard-coded paths in it :(\n\n\nWell, this should have been clear from the ticket description.It suffices to do the changes as indicated there for it to be good enough for the job. And while clearing up sysinfo.gap would be nice, I'd rather leave it to upstream.",
    "created_at": "2019-02-05T16:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404408",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>Replying to [comment:14 embray]:
> Also clearly `gac` needs to be fixed.  It *is* installed (something I recall making sure of), but I didn't realize that it was partially generated, with hard-coded paths in it :(


Well, this should have been clear from the ticket description.It suffices to do the changes as indicated there for it to be good enough for the job. And while clearing up sysinfo.gap would be nice, I'd rather leave it to upstream.



---

archive/issue_comments_404409.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 dimpase]:\n> Replying to [comment:14 embray]:\n> > Also clearly `gac` needs to be fixed.  It *is* installed (something I recall making sure of), but I didn't realize that it was partially generated, with hard-coded paths in it :(\n\n> \n> Well, this should have been clear from the ticket description.It suffices to do the changes as indicated there for it to be good enough for the job. And while clearing up sysinfo.gap would be nice, I'd rather leave it to upstream.\n\n\nYes, I was just confirming.\n\nI think sysinfo.gap needs to be fixed as well, but that's easy enough.\n\nI would rather leave *all* of this to upstream, though maybe our experiences here will help me help them improve the installation system for GAP.",
    "created_at": "2019-02-05T16:31:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404409",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>Replying to [comment:15 dimpase]:
> Replying to [comment:14 embray]:
> > Also clearly `gac` needs to be fixed.  It *is* installed (something I recall making sure of), but I didn't realize that it was partially generated, with hard-coded paths in it :(

> 
> Well, this should have been clear from the ticket description.It suffices to do the changes as indicated there for it to be good enough for the job. And while clearing up sysinfo.gap would be nice, I'd rather leave it to upstream.


Yes, I was just confirming.

I think sysinfo.gap needs to be fixed as well, but that's easy enough.

I would rather leave *all* of this to upstream, though maybe our experiences here will help me help them improve the installation system for GAP.



---

archive/issue_comments_404410.json:
```json
{
    "body": "<a id='comment:17'></a>Are you planning to work on this? If not, should I have a go at it?",
    "created_at": "2019-02-05T16:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404410",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>Are you planning to work on this? If not, should I have a go at it?



---

archive/issue_comments_404411.json:
```json
{
    "body": "<a id='comment:18'></a>With this fix, which is admittedly a hack (but an appropriate one), I was able to compile the crypting package from just any arbitrary location so long as I ran `configure $SAGE_LOCAL/share/gap` first.\n\nActually *installing* is another question, albeit mostly just a question of copying the source tree for the package into `$SAGE_LOCAL/share/gap/pkg` while making sure to strip out any build artifacts.\n\n---\nNew commits:",
    "created_at": "2019-02-05T16:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404411",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>With this fix, which is admittedly a hack (but an appropriate one), I was able to compile the crypting package from just any arbitrary location so long as I ran `configure $SAGE_LOCAL/share/gap` first.

Actually *installing* is another question, albeit mostly just a question of copying the source tree for the package into `$SAGE_LOCAL/share/gap/pkg` while making sure to strip out any build artifacts.

---
New commits:



---

archive/issue_comments_404412.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-02-05T16:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404412",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_404413.json:
```json
{
    "body": "<a id='comment:20'></a>This also worked for configuring and compiling the IO package without any needless patches.",
    "created_at": "2019-02-05T16:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404413",
    "user": "https://github.com/embray"
}
```

<a id='comment:20'></a>This also worked for configuring and compiling the IO package without any needless patches.



---

archive/issue_comments_404414.json:
```json
{
    "body": "<a id='comment:21'></a>could you also add to this branch the installation of crypting and io in gap_packages/spkg-install ? This would be a good test.",
    "created_at": "2019-02-05T16:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404414",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>could you also add to this branch the installation of crypting and io in gap_packages/spkg-install ? This would be a good test.



---

archive/issue_comments_404415.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2019-02-05T16:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404415",
    "user": "https://github.com/embray"
}
```

Changing priority from major to critical.



---

archive/issue_comments_404416.json:
```json
{
    "body": "<a id='comment:22'></a>This is important if anyone wants to install compiled GAP packages with Sage's GAP, whether manually, or through an SPKG.",
    "created_at": "2019-02-05T16:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404416",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'></a>This is important if anyone wants to install compiled GAP packages with Sage's GAP, whether manually, or through an SPKG.



---

archive/issue_comments_404417.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:21 dimpase]:\n> could you also add to this branch the installation of crypting and io in gap_packages/spkg-install ? This would be a good test.\n\n\nWorking on that now.",
    "created_at": "2019-02-05T16:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404417",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'></a>Replying to [comment:21 dimpase]:
> could you also add to this branch the installation of crypting and io in gap_packages/spkg-install ? This would be a good test.


Working on that now.



---

archive/issue_comments_404418.json:
```json
{
    "body": "<a id='comment:24'></a>Actually, this should also bump the patch-level on the GAP SPKG.",
    "created_at": "2019-02-05T16:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404418",
    "user": "https://github.com/embray"
}
```

<a id='comment:24'></a>Actually, this should also bump the patch-level on the GAP SPKG.



---

archive/issue_comments_404419.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-05T16:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404419",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_404420.json:
```json
{
    "body": "<a id='comment:26'></a>For the record I don't intend to install gap's libtool in sage-on-gentoo. Yes gap has ugly bits just like sage had 10 years ago. `gac` could be an interesting tool once fixed and `sysinfo.gap` similarly needs to be more conform to an installation rather than an in tree thing. \n\nIn the few packages where it was important so far, only `GAParch` was really needed for an install for me. The rest was superfluous. It would be useful if `sysinfo.gap` had the proper include path so the problem of `#include \"src/...\"` versus `#include \"gap/...\"` would go away. Sounds like a job for pkg-config.",
    "created_at": "2019-02-05T19:30:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404420",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:26'></a>For the record I don't intend to install gap's libtool in sage-on-gentoo. Yes gap has ugly bits just like sage had 10 years ago. `gac` could be an interesting tool once fixed and `sysinfo.gap` similarly needs to be more conform to an installation rather than an in tree thing. 

In the few packages where it was important so far, only `GAParch` was really needed for an install for me. The rest was superfluous. It would be useful if `sysinfo.gap` had the proper include path so the problem of `#include "src/..."` versus `#include "gap/..."` would go away. Sounds like a job for pkg-config.



---

archive/issue_comments_404421.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:26 fbissey]:\n> For the record I don't intend to install gap's libtool in sage-on-gentoo.\n\n\nTypically, `libtool` is not installed. It is shipped as part of the package installer and only used as build tool, analogous to `configure` for example.",
    "created_at": "2019-02-06T09:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404421",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>Replying to [comment:26 fbissey]:
> For the record I don't intend to install gap's libtool in sage-on-gentoo.


Typically, `libtool` is not installed. It is shipped as part of the package installer and only used as build tool, analogous to `configure` for example.



---

archive/issue_comments_404422.json:
```json
{
    "body": "<a id='comment:28'></a>Given that we use the same tarball for gap and for gap_packages, couldn't we just run `libtool` from the source tarball, the way how it's usually done?",
    "created_at": "2019-02-06T10:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404422",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>Given that we use the same tarball for gap and for gap_packages, couldn't we just run `libtool` from the source tarball, the way how it's usually done?



---

archive/issue_comments_404423.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:28 jdemeyer]:\n> Given that we use the same tarball for gap and for gap_packages, couldn't we just run `libtool` from the source tarball, the way how it's usually done?\n\n\nnot all GAP packages live in this tarball. Not installing the necessary components to build GAP packages will lead to a half-broken GAP installation. I don't think it's a good idea.",
    "created_at": "2019-02-06T10:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404423",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'></a>Replying to [comment:28 jdemeyer]:
> Given that we use the same tarball for gap and for gap_packages, couldn't we just run `libtool` from the source tarball, the way how it's usually done?


not all GAP packages live in this tarball. Not installing the necessary components to build GAP packages will lead to a half-broken GAP installation. I don't think it's a good idea.



---

archive/issue_comments_404424.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2019-02-06T11:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404424",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_404425.json:
```json
{
    "body": "<a id='comment:30'></a>Regarding this branch:\n\n```\n[gap_packages-4.10.0.p0] Building GAP package crypting-0.9\n[gap_packages-4.10.0.p0] Using config in /mnt/opt/Sage/sage-dev/local/share/gap/sysinfo.gap\n[gap_packages-4.10.0.p0] Building gap_packages-4.10.0.p0\n[gap_packages-4.10.0.p0] make[2]: Entering directory '/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap_packages-4.10.0.p0/src/pkg/crypting-0.9'\n[gap_packages-4.10.0.p0] /usr/bin/bash /mnt/opt/Sage/sage-dev/local/share/gap/libtool --mode=compile gcc -O2 -g -MQ obj/crypting.lo -MMD -MP -MF obj/.deps/crypting.d -o obj/crypting.lo -I/mnt/opt/Sage/sage-dev/local/share/gap/gen -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src/src -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src -DHAVE_CONFIG_H -I/mnt/opt/Sage/sage-dev/local/include -c src/crypting.c\n[gap_packages-4.10.0.p0] libtool: compile:  gcc -O2 -g -MQ obj/crypting.lo -MMD -MP -MF obj/.deps/crypting.d -I/mnt/opt/Sage/sage-dev/local/share/gap/gen -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src/src -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src -DHAVE_CONFIG_H -I/mnt/opt/Sage/sage-dev/local/include -c src/crypting.c  -fPIC -DPIC -o obj/.libs/crypting.o\n[gap_packages-4.10.0.p0] src/crypting.c:5:10: fatal error: src/compiled.h: No such file or directory\n[gap_packages-4.10.0.p0]  #include \"src/compiled.h\"          /* GAP headers */\n[gap_packages-4.10.0.p0]           ^~~~~~~~~~~~~~~~\n```\n\nThat is, one still needs to take care of header location.\nE.g.\n\n```\nln -s $SAGE_LOCAL/include/gap $SAGE_LOCAL/include/src\n```\nallows crypting to be installed using the patch in comment 2.\nWould you like this header issue to be solved here, or done on #26930?",
    "created_at": "2019-02-06T11:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404425",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>Regarding this branch:

```
[gap_packages-4.10.0.p0] Building GAP package crypting-0.9
[gap_packages-4.10.0.p0] Using config in /mnt/opt/Sage/sage-dev/local/share/gap/sysinfo.gap
[gap_packages-4.10.0.p0] Building gap_packages-4.10.0.p0
[gap_packages-4.10.0.p0] make[2]: Entering directory '/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap_packages-4.10.0.p0/src/pkg/crypting-0.9'
[gap_packages-4.10.0.p0] /usr/bin/bash /mnt/opt/Sage/sage-dev/local/share/gap/libtool --mode=compile gcc -O2 -g -MQ obj/crypting.lo -MMD -MP -MF obj/.deps/crypting.d -o obj/crypting.lo -I/mnt/opt/Sage/sage-dev/local/share/gap/gen -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src/src -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src -DHAVE_CONFIG_H -I/mnt/opt/Sage/sage-dev/local/include -c src/crypting.c
[gap_packages-4.10.0.p0] libtool: compile:  gcc -O2 -g -MQ obj/crypting.lo -MMD -MP -MF obj/.deps/crypting.d -I/mnt/opt/Sage/sage-dev/local/share/gap/gen -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src/src -I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src -DHAVE_CONFIG_H -I/mnt/opt/Sage/sage-dev/local/include -c src/crypting.c  -fPIC -DPIC -o obj/.libs/crypting.o
[gap_packages-4.10.0.p0] src/crypting.c:5:10: fatal error: src/compiled.h: No such file or directory
[gap_packages-4.10.0.p0]  #include "src/compiled.h"          /* GAP headers */
[gap_packages-4.10.0.p0]           ^~~~~~~~~~~~~~~~
```

That is, one still needs to take care of header location.
E.g.

```
ln -s $SAGE_LOCAL/include/gap $SAGE_LOCAL/include/src
```
allows crypting to be installed using the patch in comment 2.
Would you like this header issue to be solved here, or done on #26930?



---

archive/issue_comments_404426.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:26 fbissey]:\n> For the record I don't intend to install gap's libtool in sage-on-gentoo. Yes gap has ugly bits just like sage had 10 years ago.\n\n\nYou mean just like sage has now? ;)",
    "created_at": "2019-02-06T12:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404426",
    "user": "https://github.com/embray"
}
```

<a id='comment:31'></a>Replying to [comment:26 fbissey]:
> For the record I don't intend to install gap's libtool in sage-on-gentoo. Yes gap has ugly bits just like sage had 10 years ago.


You mean just like sage has now? ;)



---

archive/issue_comments_404427.json:
```json
{
    "body": "<a id='comment:32'></a>Something about this still isn't working right then, because this\n\n```\n-I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src/src\n```\n\nshould not be in the compile flags.  I thought I made sure there would be no more references to the build directory, but I was tired last night when I was working on this so I must have missed something.\n\nAlso I agree with Jeroen of course that normally a libtool script should not be installed, though in this case it might be reasonable to do.",
    "created_at": "2019-02-06T12:27:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404427",
    "user": "https://github.com/embray"
}
```

<a id='comment:32'></a>Something about this still isn't working right then, because this

```
-I/mnt/opt/Sage/sage-dev/local/var/tmp/sage/build/gap-4.10.0.p0/src/src
```

should not be in the compile flags.  I thought I made sure there would be no more references to the build directory, but I was tired last night when I was working on this so I must have missed something.

Also I agree with Jeroen of course that normally a libtool script should not be installed, though in this case it might be reasonable to do.



---

archive/issue_comments_404428.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2019-02-06T12:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404428",
    "user": "https://github.com/embray"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_404429.json:
```json
{
    "body": "<a id='comment:34'></a>Oops, duh, I left a `g` off the sed replacement pattern.  That's why you correctly have `-I/mnt/opt/Sage/sage-dev/local/share/gap/gen`, but then the rest of the `-I` flags still have the wrong path \ud83e\udd26\ud83c\udffc\u200d\u2640\ufe0f",
    "created_at": "2019-02-06T12:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404429",
    "user": "https://github.com/embray"
}
```

<a id='comment:34'></a>Oops, duh, I left a `g` off the sed replacement pattern.  That's why you correctly have `-I/mnt/opt/Sage/sage-dev/local/share/gap/gen`, but then the rest of the `-I` flags still have the wrong path 🤦🏼‍♀️



---

archive/issue_comments_404430.json:
```json
{
    "body": "<a id='comment:35'></a>By the way, you should use `$SED`, not `sed`, right?",
    "created_at": "2019-02-06T12:42:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404430",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:35'></a>By the way, you should use `$SED`, not `sed`, right?



---

archive/issue_comments_404431.json:
```json
{
    "body": "<a id='comment:36'></a>I can confirm that after adding that `|g` to `sed` pattern, everything is fine, great!\nPlease fix this in your branch, and you can flip it to positive review then.",
    "created_at": "2019-02-06T12:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404431",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'></a>I can confirm that after adding that `|g` to `sed` pattern, everything is fine, great!
Please fix this in your branch, and you can flip it to positive review then.



---

archive/issue_comments_404432.json:
```json
{
    "body": "<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-06T13:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404432",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_404433.json:
```json
{
    "body": "<a id='comment:38'></a>Should also fix up `bin/gap.sh` (although we don't use it in Sage, it should still contain the correct paths, maybe just in case some pkg uses it during a build) and also `doc/make_doc` contains references to the GAP builddir.",
    "created_at": "2019-02-06T14:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404433",
    "user": "https://github.com/embray"
}
```

<a id='comment:38'></a>Should also fix up `bin/gap.sh` (although we don't use it in Sage, it should still contain the correct paths, maybe just in case some pkg uses it during a build) and also `doc/make_doc` contains references to the GAP builddir.



---

archive/issue_comments_404434.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-06T14:19:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404434",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_404435.json:
```json
{
    "body": "<a id='comment:40'></a>Replying to [comment:35 dimpase]:\n> By the way, you should use `$SED`, not `sed`, right?\n\n\nThat's generally just in an autoconf macro, where if you have done `AC_PROG_SED`.  It's not necessarily bad practice to use a `$SED` variable either, in case it needs to be overridden for some reason, but in that case you'd still have to set a default somewhere, and we aren't doing that in any other `spkg-install` script.",
    "created_at": "2019-02-06T14:22:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404435",
    "user": "https://github.com/embray"
}
```

<a id='comment:40'></a>Replying to [comment:35 dimpase]:
> By the way, you should use `$SED`, not `sed`, right?


That's generally just in an autoconf macro, where if you have done `AC_PROG_SED`.  It's not necessarily bad practice to use a `$SED` variable either, in case it needs to be overridden for some reason, but in that case you'd still have to set a default somewhere, and we aren't doing that in any other `spkg-install` script.



---

archive/issue_comments_404436.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-02-06T14:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404436",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_404437.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-06T15:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404437",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_404438.json:
```json
{
    "body": "<a id='comment:42'></a>OK, thanks!",
    "created_at": "2019-02-06T15:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404438",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:42'></a>OK, thanks!



---

archive/issue_comments_404439.json:
```json
{
    "body": "<a id='comment:43'></a>Replying to [comment:31 embray]:\n> Replying to [comment:26 fbissey]:\n> > For the record I don't intend to install gap's libtool in sage-on-gentoo. Yes gap has ugly bits just like sage had 10 years ago.\n\n> \n> You mean just like sage has now? ;)\n\n\nYes :) but 10 years ago it was way worse. Where do you want me to start ;) Enough off topic from me.",
    "created_at": "2019-02-06T17:59:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404439",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:43'></a>Replying to [comment:31 embray]:
> Replying to [comment:26 fbissey]:
> > For the record I don't intend to install gap's libtool in sage-on-gentoo. Yes gap has ugly bits just like sage had 10 years ago.

> 
> You mean just like sage has now? ;)


Yes :) but 10 years ago it was way worse. Where do you want me to start ;) Enough off topic from me.



---

archive/issue_comments_404440.json:
```json
{
    "body": "<a id='comment:44'></a>On OSX:\n\n```\nsed: 1: \"/Users/buildslave-sage/ ...\": undefined label 'uildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/gap-4.10.0.p0/inst/Users/buildslave-sage/slave/sage_git/build/local/bin/gac'\n```",
    "created_at": "2019-02-08T12:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404440",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:44'></a>On OSX:

```
sed: 1: "/Users/buildslave-sage/ ...": undefined label 'uildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/gap-4.10.0.p0/inst/Users/buildslave-sage/slave/sage_git/build/local/bin/gac'
```



---

archive/issue_comments_404441.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-02-08T12:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404441",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_404442.json:
```json
{
    "body": "<a id='comment:45'></a>It appears on OSX you need `sed -i -e <pattern>` or else it will treat `<pattern>` as the optional parameter to `-i`.  I really hate this platform.",
    "created_at": "2019-02-08T12:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404442",
    "user": "https://github.com/embray"
}
```

<a id='comment:45'></a>It appears on OSX you need `sed -i -e <pattern>` or else it will treat `<pattern>` as the optional parameter to `-i`.  I really hate this platform.



---

archive/issue_comments_404443.json:
```json
{
    "body": "<a id='comment:46'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-08T13:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404443",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_404444.json:
```json
{
    "body": "<a id='comment:47'></a>Replying to [comment:45 embray]:\n> It appears on OSX you need `sed -i -e <pattern>` or else it will treat `<pattern>` as the optional parameter to `-i`.  I really hate this platform.\n\n\nYes, this hit us already at #25321 (\"sed -i is not portable\").",
    "created_at": "2019-02-09T00:37:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404444",
    "user": "https://github.com/slel"
}
```

<a id='comment:47'></a>Replying to [comment:45 embray]:
> It appears on OSX you need `sed -i -e <pattern>` or else it will treat `<pattern>` as the optional parameter to `-i`.  I really hate this platform.


Yes, this hit us already at #25321 ("sed -i is not portable").



---

archive/issue_comments_404445.json:
```json
{
    "body": "<a id='comment:48'></a>This particular bug is fixed, but I still cannot reinstall GAP spkg on OSX without first manually removing all of `SAGE_LOCAL/share/gap`. Some file permissions are wrong (on OSX)...",
    "created_at": "2019-02-09T08:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404445",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:48'></a>This particular bug is fixed, but I still cannot reinstall GAP spkg on OSX without first manually removing all of `SAGE_LOCAL/share/gap`. Some file permissions are wrong (on OSX)...



---

archive/issue_comments_404446.json:
```json
{
    "body": "<a id='comment:49'></a>Also, on OSX paths to binary files of GAP packages are not correct. E.g. `local/lib/gap/pkg/io-4.5.4/x86_64-apple-darwin17.7.0-default64/` instead of `local/lib/gap/pkg/io-4.5.4/bin/x86_64-apple-darwin17.7.0-default64/`, and IO package does not load.\nIf I do \n\n```\n$ mkdir local/lib/gap/pkg/io-4.5.4/bin\n$ mv local/lib/gap/pkg/io-4.5.4/x86_64-apple-darwin17.7.0-default64 local/lib/gap/pkg/io-4.5.4\n```\nthen it works.",
    "created_at": "2019-02-09T10:50:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404446",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:49'></a>Also, on OSX paths to binary files of GAP packages are not correct. E.g. `local/lib/gap/pkg/io-4.5.4/x86_64-apple-darwin17.7.0-default64/` instead of `local/lib/gap/pkg/io-4.5.4/bin/x86_64-apple-darwin17.7.0-default64/`, and IO package does not load.
If I do 

```
$ mkdir local/lib/gap/pkg/io-4.5.4/bin
$ mv local/lib/gap/pkg/io-4.5.4/x86_64-apple-darwin17.7.0-default64 local/lib/gap/pkg/io-4.5.4
```
then it works.



---

archive/issue_comments_404447.json:
```json
{
    "body": "<a id='comment:50'></a>perhaps one should switch from doing `cp` etc. to doing `install`, as suggested on https://github.com/gap-system/gap-distribution/issues/72",
    "created_at": "2019-02-09T13:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404447",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:50'></a>perhaps one should switch from doing `cp` etc. to doing `install`, as suggested on https://github.com/gap-system/gap-distribution/issues/72



---

archive/issue_comments_404448.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2019-02-22T14:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404448",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_404449.json:
```json
{
    "body": "<a id='comment:51'></a>Forgot to set this back to needs review after fixing the sed call.  Other problems about uninstalling packages on OSX are separate and unrelated to this ticket (see e.g. #27124).",
    "created_at": "2019-02-22T14:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404449",
    "user": "https://github.com/embray"
}
```

<a id='comment:51'></a>Forgot to set this back to needs review after fixing the sed call.  Other problems about uninstalling packages on OSX are separate and unrelated to this ticket (see e.g. #27124).



---

archive/issue_events_067577.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-23T23:14:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27218#event-67577"
}
```



---

archive/issue_comments_404450.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-23T23:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27218#issuecomment-404450",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
