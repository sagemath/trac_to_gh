# Issue 27565: Fix segfault / memory corruption in OpenBLAS

archive/issues_027328.json:
```json
{
    "body": "There is a bug in OpenBLAS [already fixed upstream](https://github.com/xianyi/OpenBLAS/pull/1957) which I am encountering on Cygwin, though it could also affect Linux (in fact the original bug report was for Linux).\n\nFor Sage, this bug is causing a segfault on Cygwin when running\n\n```\n./sage -t --long src/sage/manifolds/differentiable/vectorfield.py\n```\n\nbut it could happen arbitrarily anywhere that uses OpenBLAS and that happens to use threads (even without using OpenBLAS threads).\n\nI have already confirmed that the upstream fix resolves the issue for me.\n\nKeywords: openblas\n\nUpstream: Fixed upstream, but not in a stable release.\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: Erik Bray\n\nBranch: 4aa19b03f86d0185ccb2ff4f7e4a002150d022a0\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27565\n\n",
    "closed_at": "2019-04-03T18:41:34Z",
    "created_at": "2019-03-29T07:27:27Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Fix segfault / memory corruption in OpenBLAS",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27565",
    "user": "https://github.com/embray"
}
```
There is a bug in OpenBLAS [already fixed upstream](https://github.com/xianyi/OpenBLAS/pull/1957) which I am encountering on Cygwin, though it could also affect Linux (in fact the original bug report was for Linux).

For Sage, this bug is causing a segfault on Cygwin when running

```
./sage -t --long src/sage/manifolds/differentiable/vectorfield.py
```

but it could happen arbitrarily anywhere that uses OpenBLAS and that happens to use threads (even without using OpenBLAS threads).

I have already confirmed that the upstream fix resolves the issue for me.

Keywords: openblas

Upstream: Fixed upstream, but not in a stable release.

Reviewer: François Bissey

Author: Erik Bray

Branch: 4aa19b03f86d0185ccb2ff4f7e4a002150d022a0

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27565





---

archive/issue_comments_533554.json:
```json
{
    "body": "Changing commit from \"\" to \"9db4320e485ed0aeae56d2c9dfc91fabe14659b1\"",
    "created_at": "2019-03-29T07:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533554",
    "user": "https://github.com/embray"
}
```

Changing commit from "" to "9db4320e485ed0aeae56d2c9dfc91fabe14659b1"



---

archive/issue_comments_533555.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-29T07:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533555",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_533556.json:
```json
{
    "body": "Changing branch from \"\" to \"u/embray/ticket-27565\"",
    "created_at": "2019-03-29T07:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533556",
    "user": "https://github.com/embray"
}
```

Changing branch from "" to "u/embray/ticket-27565"



---

archive/issue_comments_533557.json:
```json
{
    "body": "Changing author from \"\" to \"Erik Bray\"",
    "created_at": "2019-03-29T07:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533557",
    "user": "https://github.com/embray"
}
```

Changing author from "" to "Erik Bray"



---

archive/issue_comments_533558.json:
```json
{
    "body": "<a id='comment:2'></a>\nThere is no changes to openblas on this branch. Did you forget to commit?",
    "created_at": "2019-03-29T21:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533558",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
There is no changes to openblas on this branch. Did you forget to commit?



---

archive/issue_comments_533559.json:
```json
{
    "body": "<a id='comment:3'></a>\nStrange.  It looks like I did.",
    "created_at": "2019-04-01T09:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533559",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>
Strange.  It looks like I did.



---

archive/issue_comments_533560.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|\n|[3d0a86b](https://github.com/sagemath/sagetrac-mirror/commit/3d0a86bebe0233d277c60a315ea82ed5a3a0f24f)|`Trac #27565: Add patch from upstream to fix segfaults.`|",
    "created_at": "2019-04-01T09:37:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533560",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|[3d0a86b](https://github.com/sagemath/sagetrac-mirror/commit/3d0a86bebe0233d277c60a315ea82ed5a3a0f24f)|`Trac #27565: Add patch from upstream to fix segfaults.`|



---

archive/issue_comments_533561.json:
```json
{
    "body": "Changing commit from \"9db4320e485ed0aeae56d2c9dfc91fabe14659b1\" to \"3d0a86bebe0233d277c60a315ea82ed5a3a0f24f\"",
    "created_at": "2019-04-01T09:37:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533561",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9db4320e485ed0aeae56d2c9dfc91fabe14659b1" to "3d0a86bebe0233d277c60a315ea82ed5a3a0f24f"



---

archive/issue_comments_533562.json:
```json
{
    "body": "<a id='comment:5'></a>\nThere it is.  I was working on this on the train last week so who knows what could've interrupted me.",
    "created_at": "2019-04-01T09:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533562",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>
There it is.  I was working on this on the train last week so who knows what could've interrupted me.



---

archive/issue_comments_533563.json:
```json
{
    "body": "<a id='comment:6'></a>\nIncluding a a patch merged upstream. I think it is safe.",
    "created_at": "2019-04-01T09:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533563",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
Including a a patch merged upstream. I think it is safe.



---

archive/issue_comments_533564.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-04-01T09:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533564",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_533565.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fran\u00e7ois Bissey\"",
    "created_at": "2019-04-01T09:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533565",
    "user": "https://github.com/kiwifb"
}
```

Changing reviewer from "" to "François Bissey"



---

archive/issue_comments_533566.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:\n|                                                                                                                                           |                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|\n|[e5873dc](https://github.com/sagemath/sagetrac-mirror/commit/e5873dc1082675f71aa48fb85ad10c8a1ad06991)|`Trac #27565: Add patch from upstream to fix segfaults.`|",
    "created_at": "2019-04-03T09:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533566",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:
|                                                                                                                                           |                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|[e5873dc](https://github.com/sagemath/sagetrac-mirror/commit/e5873dc1082675f71aa48fb85ad10c8a1ad06991)|`Trac #27565: Add patch from upstream to fix segfaults.`|



---

archive/issue_comments_533567.json:
```json
{
    "body": "Changing commit from \"3d0a86bebe0233d277c60a315ea82ed5a3a0f24f\" to \"e5873dc1082675f71aa48fb85ad10c8a1ad06991\"",
    "created_at": "2019-04-03T09:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533567",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3d0a86bebe0233d277c60a315ea82ed5a3a0f24f" to "e5873dc1082675f71aa48fb85ad10c8a1ad06991"



---

archive/issue_comments_533568.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-04-03T09:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533568",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_533569.json:
```json
{
    "body": "<a id='comment:8'></a>\nRebased on 8.8.beta0 (not strictly necessary, but I wanted to anyways so that I could test the rest of 8.8.beta0 on Cygwin).",
    "created_at": "2019-04-03T09:34:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533569",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
Rebased on 8.8.beta0 (not strictly necessary, but I wanted to anyways so that I could test the rest of 8.8.beta0 on Cygwin).



---

archive/issue_comments_533570.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-04-03T09:34:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533570",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_533571.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-04-03T18:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533571",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_077638.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-03T18:41:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27565#event-77638"
}
```



---

archive/issue_comments_533572.json:
```json
{
    "body": "Changing commit from \"e5873dc1082675f71aa48fb85ad10c8a1ad06991\" to \"\"",
    "created_at": "2019-04-18T09:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533572",
    "user": "https://github.com/embray"
}
```

Changing commit from "e5873dc1082675f71aa48fb85ad10c8a1ad06991" to ""



---

archive/issue_comments_533573.json:
```json
{
    "body": "Changing branch from \"u/embray/ticket-27565\" to \"4aa19b03f86d0185ccb2ff4f7e4a002150d022a0\"",
    "created_at": "2019-04-18T09:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533573",
    "user": "https://github.com/embray"
}
```

Changing branch from "u/embray/ticket-27565" to "4aa19b03f86d0185ccb2ff4f7e4a002150d022a0"



---

archive/issue_comments_533574.json:
```json
{
    "body": "<a id='comment:10'></a>\nThe branch on this didn't get updated for some reason.",
    "created_at": "2019-04-18T09:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27565#issuecomment-533574",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>
The branch on this didn't get updated for some reason.
