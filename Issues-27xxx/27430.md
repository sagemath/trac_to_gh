# Issue 27430: more choices of algorithms for Coxeter Smith form of posets

archive/issues_027193.json:
```json
{
    "body": "This allows to compare the speed of all those.\n\nBranch/Commit: aa07710ce924921675135496cf7faa1f8f62992e\n\nReviewer: Travis Scrimshaw, Martin Rubey\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27430\n\n",
    "closed_at": "2019-03-13T18:29:11Z",
    "created_at": "2019-03-06T08:38:27Z",
    "labels": [
        "component: combinatorics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "more choices of algorithms for Coxeter Smith form of posets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27430",
    "user": "https://github.com/fchapoton"
}
```
This allows to compare the speed of all those.

Branch/Commit: aa07710ce924921675135496cf7faa1f8f62992e

Reviewer: Travis Scrimshaw, Martin Rubey

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27430





---

archive/issue_comments_528944.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/27430\"",
    "created_at": "2019-03-06T08:39:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528944",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/27430"



---

archive/issue_comments_528945.json:
```json
{
    "body": "Changing commit from \"\" to \"96b815023ed635532ec72d02e49c99afb76fa42f\"",
    "created_at": "2019-03-06T08:39:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528945",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "96b815023ed635532ec72d02e49c99afb76fa42f"



---

archive/issue_comments_528946.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2019-03-06T08:39:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528946",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_528947.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-06T08:39:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528947",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_528948.json:
```json
{
    "body": "<a id='comment:2'></a>I think it would be better to have the comments about the (anecdotal) relative speed of the algorithms in the docstring rather than the code. That way it is easier for the (common) user to see it. Otherwise LGTM.",
    "created_at": "2019-03-06T11:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528948",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>I think it would be better to have the comments about the (anecdotal) relative speed of the algorithms in the docstring rather than the code. That way it is easier for the (common) user to see it. Otherwise LGTM.



---

archive/issue_comments_528949.json:
```json
{
    "body": "Changing commit from \"96b815023ed635532ec72d02e49c99afb76fa42f\" to \"5dcd3cd304b94e70dc936f3a9cc22e8c2d37ee3a\"",
    "created_at": "2019-03-06T13:52:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528949",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "96b815023ed635532ec72d02e49c99afb76fa42f" to "5dcd3cd304b94e70dc936f3a9cc22e8c2d37ee3a"



---

archive/issue_comments_528950.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-06T13:52:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528950",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_528951.json:
```json
{
    "body": "<a id='comment:4'></a>thx, done",
    "created_at": "2019-03-06T13:52:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528951",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>thx, done



---

archive/issue_comments_528952.json:
```json
{
    "body": "<a id='comment:5'></a>I cannot try the ticket right now, but I'm afraid that the FriCAS code will leak variables.  Could you try\n\n```\nsage: _ = P.coxeter_smith_form(algorithm='fricas')\nsage: fricas.eval(\"Z\")\nsage: fricas.eval(\"x\")\n```\n\nIf it does, I can prepare a non-leaking statement.  Roughly, it will be\n\n```\n(fricas([x]*n).diagonalMatrix() - fricas(c0)).smith().diagonal().sage()\n```",
    "created_at": "2019-03-06T19:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528952",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:5'></a>I cannot try the ticket right now, but I'm afraid that the FriCAS code will leak variables.  Could you try

```
sage: _ = P.coxeter_smith_form(algorithm='fricas')
sage: fricas.eval("Z")
sage: fricas.eval("x")
```

If it does, I can prepare a non-leaking statement.  Roughly, it will be

```
(fricas([x]*n).diagonalMatrix() - fricas(c0)).smith().diagonal().sage()
```



---

archive/issue_comments_528953.json:
```json
{
    "body": "<a id='comment:6'></a>A more fundamental question: why not provide the `algorithm` keyword for matrices in general?\n\nI admit, that I do not know how the matrix design currently works, but possibly `sage.matrix.matrix2.smith_form` is the right place?",
    "created_at": "2019-03-06T19:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528953",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:6'></a>A more fundamental question: why not provide the `algorithm` keyword for matrices in general?

I admit, that I do not know how the matrix design currently works, but possibly `sage.matrix.matrix2.smith_form` is the right place?



---

archive/issue_comments_528954.json:
```json
{
    "body": "<a id='comment:7'></a>Well. Indeed. That would go into \"matrices with entries in QQ[x]' namely \"matrix_polynomial_dense.pyx\". Maybe for another ticket, unless you volunteer to do it ?\n\nNow compiling Fricas to check the leak.",
    "created_at": "2019-03-06T19:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528954",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>Well. Indeed. That would go into "matrices with entries in QQ[x]' namely "matrix_polynomial_dense.pyx". Maybe for another ticket, unless you volunteer to do it ?

Now compiling Fricas to check the leak.



---

archive/issue_comments_528955.json:
```json
{
    "body": "<a id='comment:8'></a>Answer:\n\n```\nsage: p=posets.PentagonPoset()\nsage: sage: _ = p.coxeter_smith_form(algorithm='fricas')\n....: sage: fricas.eval(\"Z\")\n....: sage: fricas.eval(\"x\")\n....: \n'\\n   Integer\\n'\n'\\n   x\\n'\n```\nDoes this mean that there is a leak?",
    "created_at": "2019-03-06T19:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528955",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>Answer:

```
sage: p=posets.PentagonPoset()
sage: sage: _ = p.coxeter_smith_form(algorithm='fricas')
....: sage: fricas.eval("Z")
....: sage: fricas.eval("x")
....: 
'\n   Integer\n'
'\n   x\n'
```
Does this mean that there is a leak?



---

archive/issue_comments_528956.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [chapoton](#comment%3A8):\n> Answer:\n> \n> ```\n> sage: p=posets.PentagonPoset()\n> sage: sage: _ = p.coxeter_smith_form(algorithm='fricas')\n> ....: sage: fricas.eval(\"Z\")\n> ....: sage: fricas.eval(\"x\")\n> ....: \n> '\\n   Integer\\n'\n> '\\n   x\\n'\n> ```\n> Does this mean that there is a leak?\n\nYes, after `p.coxeter_smith_form(algorithm='fricas')`, the name `Z` has value `Integer` in FriCAS.  By contrast, `x` still returns `x`, which is good.\n\nSo, for example, executing after that\n\n```\nsage: var(\"Z\")\nsage: fricas(Z^2+1)\n```\nwill raise a strange error.",
    "created_at": "2019-03-06T20:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528956",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:9'></a>Replying to [chapoton](#comment%3A8):
> Answer:
> 
> ```
> sage: p=posets.PentagonPoset()
> sage: sage: _ = p.coxeter_smith_form(algorithm='fricas')
> ....: sage: fricas.eval("Z")
> ....: sage: fricas.eval("x")
> ....: 
> '\n   Integer\n'
> '\n   x\n'
> ```
> Does this mean that there is a leak?

Yes, after `p.coxeter_smith_form(algorithm='fricas')`, the name `Z` has value `Integer` in FriCAS.  By contrast, `x` still returns `x`, which is good.

So, for example, executing after that

```
sage: var("Z")
sage: fricas(Z^2+1)
```
will raise a strange error.



---

archive/issue_comments_528957.json:
```json
{
    "body": "<a id='comment:10'></a>Ok. Then please try to provide a working better alternative. There is no urgency.",
    "created_at": "2019-03-06T20:41:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528957",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>Ok. Then please try to provide a working better alternative. There is no urgency.



---

archive/issue_comments_528958.json:
```json
{
    "body": "<a id='comment:11'></a>I tried the obvious modification for Fricas, as you suggested, and it failed.",
    "created_at": "2019-03-08T13:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528958",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>I tried the obvious modification for Fricas, as you suggested, and it failed.



---

archive/issue_comments_528959.json:
```json
{
    "body": "<a id='comment:12'></a>Could you post the code?  I can look at it tonight (probably after 19:00)",
    "created_at": "2019-03-08T13:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528959",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:12'></a>Could you post the code?  I can look at it tonight (probably after 19:00)



---

archive/issue_comments_528960.json:
```json
{
    "body": "<a id='comment:13'></a>I have made a branch `public/ticket/27430` with the tentative. I would say that the matrix type is not recognized correctly, so that the method `smith` does not apply.",
    "created_at": "2019-03-08T14:48:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528960",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>I have made a branch `public/ticket/27430` with the tentative. I would say that the matrix type is not recognized correctly, so that the method `smith` does not apply.



---

archive/issue_comments_528961.json:
```json
{
    "body": "Changing branch from \"u/chapoton/27430\" to \"u/mantepse/27430\"",
    "created_at": "2019-03-09T14:15:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528961",
    "user": "https://github.com/mantepse"
}
```

Changing branch from "u/chapoton/27430" to "u/mantepse/27430"



---

archive/issue_comments_528962.json:
```json
{
    "body": "Changing commit from \"5dcd3cd304b94e70dc936f3a9cc22e8c2d37ee3a\" to \"aa07710ce924921675135496cf7faa1f8f62992e\"",
    "created_at": "2019-03-11T19:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528962",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "5dcd3cd304b94e70dc936f3a9cc22e8c2d37ee3a" to "aa07710ce924921675135496cf7faa1f8f62992e"



---

archive/issue_comments_528963.json:
```json
{
    "body": "<a id='comment:15'></a>Is this a working branch or what ?\n\nNota bene: If you do not make a comment, I do not see the change of branch.\n\n---\nNew commits:",
    "created_at": "2019-03-11T19:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528963",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'></a>Is this a working branch or what ?

Nota bene: If you do not make a comment, I do not see the change of branch.

---
New commits:



---

archive/issue_comments_528964.json:
```json
{
    "body": "<a id='comment:16'></a>Dear Frederic !\n\nsorry, I didn't know that you wouldn't see it.  Yes, this should work with FriCAS.",
    "created_at": "2019-03-11T19:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528964",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:16'></a>Dear Frederic !

sorry, I didn't know that you wouldn't see it.  Yes, this should work with FriCAS.



---

archive/issue_comments_528965.json:
```json
{
    "body": "<a id='comment:17'></a>ok, the fricas code works and looks good to me. Travis, do you agree that this is ready to go?",
    "created_at": "2019-03-11T19:36:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528965",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'></a>ok, the fricas code works and looks good to me. Travis, do you agree that this is ready to go?



---

archive/issue_comments_528966.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-11T21:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528966",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_528967.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw, Martin Rubey\"",
    "created_at": "2019-03-11T21:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528967",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw, Martin Rubey"



---

archive/issue_comments_528968.json:
```json
{
    "body": "<a id='comment:18'></a>Yep, LGTM. Thanks.",
    "created_at": "2019-03-11T21:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528968",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>Yep, LGTM. Thanks.



---

archive/issue_comments_528969.json:
```json
{
    "body": "Changing branch from \"u/mantepse/27430\" to \"aa07710ce924921675135496cf7faa1f8f62992e\"",
    "created_at": "2019-03-13T18:29:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528969",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mantepse/27430" to "aa07710ce924921675135496cf7faa1f8f62992e"



---

archive/issue_events_068134.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-13T18:29:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27430#event-68134"
}
```



---

archive/issue_comments_528970.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-03-13T18:29:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27430",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27430#issuecomment-528970",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
