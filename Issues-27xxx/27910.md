# Issue 27910: Three.js: Save screenshot as PNG

archive/issues_027673.json:
```json
{
    "body": "This ticket adds a small downward-pointing arrow to the lower right-hand corner of each generated Three.js scene. When it is clicked a screenshot is saved to the browser-dependent downloads directory. There does not appear to be a way to allow the user to specify where the file will download due to browser security issues.\n\nThis ticket includes a bit of added white space to make the template a bit more legible.\n\nCC:  @egourgoulhon @embray @mkoeppe\n\nKeywords: threejs\n\nBranch/Commit: 84461495593db9af8c3ce13d8ef76bd37f5a4ce5\n\nReviewer: Eric Gourgoulhon\n\nAuthor: Paul Masson\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27910\n\n",
    "closed_at": "2019-06-06T22:26:42Z",
    "created_at": "2019-05-31T20:30:37Z",
    "labels": [
        "component: graphics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Three.js: Save screenshot as PNG",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27910",
    "user": "https://github.com/paulmasson"
}
```
This ticket adds a small downward-pointing arrow to the lower right-hand corner of each generated Three.js scene. When it is clicked a screenshot is saved to the browser-dependent downloads directory. There does not appear to be a way to allow the user to specify where the file will download due to browser security issues.

This ticket includes a bit of added white space to make the template a bit more legible.

CC:  @egourgoulhon @embray @mkoeppe

Keywords: threejs

Branch/Commit: 84461495593db9af8c3ce13d8ef76bd37f5a4ce5

Reviewer: Eric Gourgoulhon

Author: Paul Masson

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27910





---

archive/issue_comments_390258.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-31T20:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27910#issuecomment-390258",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390259.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-31T20:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27910#issuecomment-390259",
    "user": "https://github.com/paulmasson"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_390260.json:
```json
{
    "body": "<a id='comment:4'></a>Waouh! That's very nice!\nI've just checked it and it works perfectly.\n\nCould this be used to get png images from threejs when building the documentation, as in\nhttp://doc.sagemath.org/html/en/reference/plot3d/sage/plot/plot3d/plot3d.html ?\nCurrently, this is achieved via the `sphinx_plot` function. For `sphinx_plot` to work, it suffices that the `save` method of 3d graphics objects produces a `png` file (cf. the definition of `sphinx_plot` starting at line 36 of `src/doc/common/conf.py`, in particular lines 94-105). For the moment, if `g` is a 3d graphics object, both\n\n```\nsage: g.save(\"image.png\")  # use Jmol (the current default)\nsage: g.save(\"image.png\", viewer='tachyon')\n``` \nwork, but setting `viewer='threejs'` does not:\n\n```\nsage: g.save(\"image.png\", viewer='threejs')\n...\nValueError: cannot use viewer=threejs to render image\n```",
    "created_at": "2019-06-01T16:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27910#issuecomment-390260",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:4'></a>Waouh! That's very nice!
I've just checked it and it works perfectly.

Could this be used to get png images from threejs when building the documentation, as in
http://doc.sagemath.org/html/en/reference/plot3d/sage/plot/plot3d/plot3d.html ?
Currently, this is achieved via the `sphinx_plot` function. For `sphinx_plot` to work, it suffices that the `save` method of 3d graphics objects produces a `png` file (cf. the definition of `sphinx_plot` starting at line 36 of `src/doc/common/conf.py`, in particular lines 94-105). For the moment, if `g` is a 3d graphics object, both

```
sage: g.save("image.png")  # use Jmol (the current default)
sage: g.save("image.png", viewer='tachyon')
``` 
work, but setting `viewer='threejs'` does not:

```
sage: g.save("image.png", viewer='threejs')
...
ValueError: cannot use viewer=threejs to render image
```



---

archive/issue_comments_390261.json:
```json
{
    "body": "<a id='comment:6'></a>Glad you like it Eric. I added it because you've requested such a feature several times. Turned out to be easier than expected to implement.\n\nUnfortunately the rendering requires a browser environment to function, so it won't work from the command line. It is possible in principle to perform command-line JavaScript rendering by making Node.js a required package and then using another third-party [library](https://github.com/nulltask/node-three.js) that hasn't been updated in years, but I wouldn't recommend that approach nor would I spend time on it.\n\nSince matplotlib already supports 3D graphics, what I think is a better approach is to implement a `matplotlib` function for `Graphics3d` like the one here for `Graphics`:\n\nhttps://github.com/sagemath/sage/blob/master/src/sage/plot/graphics.py#L2454\n\nI'll add Matthias Koeppe to this ticket in the event he's interested in adding this function.",
    "created_at": "2019-06-01T21:09:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27910#issuecomment-390261",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:6'></a>Glad you like it Eric. I added it because you've requested such a feature several times. Turned out to be easier than expected to implement.

Unfortunately the rendering requires a browser environment to function, so it won't work from the command line. It is possible in principle to perform command-line JavaScript rendering by making Node.js a required package and then using another third-party [library](https://github.com/nulltask/node-three.js) that hasn't been updated in years, but I wouldn't recommend that approach nor would I spend time on it.

Since matplotlib already supports 3D graphics, what I think is a better approach is to implement a `matplotlib` function for `Graphics3d` like the one here for `Graphics`:

https://github.com/sagemath/sage/blob/master/src/sage/plot/graphics.py#L2454

I'll add Matthias Koeppe to this ticket in the event he's interested in adding this function.



---

archive/issue_comments_390262.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 paulmasson]:\n> Glad you like it Eric. I added it because you've requested such a feature several times. Turned out to be easier than expected to implement.\n> \n\n\nThanks!\n\n> Unfortunately the rendering requires a browser environment to function, so it won't work from the command line. It is possible in principle to perform command-line JavaScript rendering by making Node.js a required package and then using another third-party [library](https://github.com/nulltask/node-three.js) that hasn't been updated in years, but I wouldn't recommend that approach nor would I spend time on it.\n> \n> Since matplotlib already supports 3D graphics, what I think is a better approach is to implement a `matplotlib` function for `Graphics3d` like the one here for `Graphics`:\n> \n> https://github.com/sagemath/sage/blob/master/src/sage/plot/graphics.py#L2454\n> \n> I'll add Matthias Koeppe to this ticket in the event he's interested in adding this function.\n\n\nOK. This is clearly for another ticket then. \nRegarding the current one, I've checked that the png export works via `nbviewer` as well (cf. [this example](https://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/test_dodecahedron_threejs.ipynb)), although I guess there was no reason for which it should not work... So this positive review from my side.",
    "created_at": "2019-06-03T08:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27910#issuecomment-390262",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:7'></a>Replying to [comment:6 paulmasson]:
> Glad you like it Eric. I added it because you've requested such a feature several times. Turned out to be easier than expected to implement.
> 


Thanks!

> Unfortunately the rendering requires a browser environment to function, so it won't work from the command line. It is possible in principle to perform command-line JavaScript rendering by making Node.js a required package and then using another third-party [library](https://github.com/nulltask/node-three.js) that hasn't been updated in years, but I wouldn't recommend that approach nor would I spend time on it.
> 
> Since matplotlib already supports 3D graphics, what I think is a better approach is to implement a `matplotlib` function for `Graphics3d` like the one here for `Graphics`:
> 
> https://github.com/sagemath/sage/blob/master/src/sage/plot/graphics.py#L2454
> 
> I'll add Matthias Koeppe to this ticket in the event he's interested in adding this function.


OK. This is clearly for another ticket then. 
Regarding the current one, I've checked that the png export works via `nbviewer` as well (cf. [this example](https://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/test_dodecahedron_threejs.ipynb)), although I guess there was no reason for which it should not work... So this positive review from my side.



---

archive/issue_comments_390263.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-03T08:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27910#issuecomment-390263",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_069183.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-06T22:26:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27910#event-69183"
}
```



---

archive/issue_comments_390264.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-06T22:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27910#issuecomment-390264",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
