# Issue 27910: Three.js: Save screenshot as PNG

archive/issues_027673.json:
```json
{
    "assignees": [],
    "body": "This ticket adds a small downward-pointing arrow to the lower right-hand corner of each generated Three.js scene. When it is clicked a screenshot is saved to the browser-dependent downloads directory. There does not appear to be a way to allow the user to specify where the file will download due to browser security issues.\n\nThis ticket includes a bit of added white space to make the template a bit more legible.\n\nCC:  @egourgoulhon @embray @mkoeppe\n\nComponent: **graphics**\n\nKeywords: **threejs**\n\nAuthor: **Paul Masson**\n\nBranch/Commit: **[`8446149`](https://github.com/sagemath/sagetrac-mirror/commit/84461495593db9af8c3ce13d8ef76bd37f5a4ce5)**\n\nReviewer: **Eric Gourgoulhon**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27910_\n\n",
    "closed_at": "2019-06-06T22:26:42Z",
    "created_at": "2019-05-31T20:30:37Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graphics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Three.js: Save screenshot as PNG",
    "type": "issue",
    "updated_at": "2019-06-06T22:26:42Z",
    "url": "https://github.com/sagemath/sage/issues/27910",
    "user": "https://github.com/paulmasson"
}
```
This ticket adds a small downward-pointing arrow to the lower right-hand corner of each generated Three.js scene. When it is clicked a screenshot is saved to the browser-dependent downloads directory. There does not appear to be a way to allow the user to specify where the file will download due to browser security issues.

This ticket includes a bit of added white space to make the template a bit more legible.

CC:  @egourgoulhon @embray @mkoeppe

Component: **graphics**

Keywords: **threejs**

Author: **Paul Masson**

Branch/Commit: **[`8446149`](https://github.com/sagemath/sagetrac-mirror/commit/84461495593db9af8c3ce13d8ef76bd37f5a4ce5)**

Reviewer: **Eric Gourgoulhon**

_Issue created by migration from https://trac.sagemath.org/ticket/27910_





---

archive/issue_events_379790.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2019-05-31T20:30:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27910",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27910#event-379790"
}
```



---

archive/issue_events_379791.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2019-05-31T20:30:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27910",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graphics",
    "label_color": "0000ff",
    "label_name": "c: graphics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27910#event-379791"
}
```



---

archive/issue_events_379792.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2019-05-31T20:30:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27910",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27910#event-379792"
}
```



---

archive/issue_events_379793.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2019-05-31T20:30:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27910",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27910#event-379793"
}
```



---

archive/issue_comments_433612.json:
```json
{
    "body": "Branch: **[u/paulmasson/download-png](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/download-png)**",
    "created_at": "2019-05-31T20:31:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27910#issuecomment-433612",
    "user": "https://github.com/paulmasson"
}
```

Branch: **[u/paulmasson/download-png](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/download-png)**



---

archive/issue_comments_433613.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84461495593db9af8c3ce13d8ef76bd37f5a4ce5\"><code>8446149</code></a></td><td><code>Download screenshot to PNG</code></td></tr></table>\n",
    "created_at": "2019-05-31T20:32:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27910#issuecomment-433613",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84461495593db9af8c3ce13d8ef76bd37f5a4ce5"><code>8446149</code></a></td><td><code>Download screenshot to PNG</code></td></tr></table>




---

archive/issue_comments_433614.json:
```json
{
    "body": "Commit: **[`8446149`](https://github.com/sagemath/sagetrac-mirror/commit/84461495593db9af8c3ce13d8ef76bd37f5a4ce5)**",
    "created_at": "2019-05-31T20:32:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27910#issuecomment-433614",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`8446149`](https://github.com/sagemath/sagetrac-mirror/commit/84461495593db9af8c3ce13d8ef76bd37f5a4ce5)**



---

archive/issue_events_379794.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2019-05-31T20:33:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27910",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27910#event-379794"
}
```



---

archive/issue_comments_433615.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nWaouh! That's very nice!\nI've just checked it and it works perfectly.\n\nCould this be used to get png images from threejs when building the documentation, as in\nhttp://doc.sagemath.org/html/en/reference/plot3d/sage/plot/plot3d/plot3d.html ?\nCurrently, this is achieved via the `sphinx_plot` function. For `sphinx_plot` to work, it suffices that the `save` method of 3d graphics objects produces a `png` file (cf. the definition of `sphinx_plot` starting at line 36 of `src/doc/common/conf.py`, in particular lines 94-105). For the moment, if `g` is a 3d graphics object, both\n\n```\nsage: g.save(\"image.png\")  # use Jmol (the current default)\nsage: g.save(\"image.png\", viewer='tachyon')\n``` \nwork, but setting `viewer='threejs'` does not:\n\n```\nsage: g.save(\"image.png\", viewer='threejs')\n...\nValueError: cannot use viewer=threejs to render image\n```",
    "created_at": "2019-06-01T16:10:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27910#issuecomment-433615",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:4" align="right">comment:4</div>

Waouh! That's very nice!
I've just checked it and it works perfectly.

Could this be used to get png images from threejs when building the documentation, as in
http://doc.sagemath.org/html/en/reference/plot3d/sage/plot/plot3d/plot3d.html ?
Currently, this is achieved via the `sphinx_plot` function. For `sphinx_plot` to work, it suffices that the `save` method of 3d graphics objects produces a `png` file (cf. the definition of `sphinx_plot` starting at line 36 of `src/doc/common/conf.py`, in particular lines 94-105). For the moment, if `g` is a 3d graphics object, both

```
sage: g.save("image.png")  # use Jmol (the current default)
sage: g.save("image.png", viewer='tachyon')
``` 
work, but setting `viewer='threejs'` does not:

```
sage: g.save("image.png", viewer='threejs')
...
ValueError: cannot use viewer=threejs to render image
```



---

archive/issue_comments_433616.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nGlad you like it Eric. I added it because you've requested such a feature several times. Turned out to be easier than expected to implement.\n\nUnfortunately the rendering requires a browser environment to function, so it won't work from the command line. It is possible in principle to perform command-line JavaScript rendering by making Node.js a required package and then using another third-party [library](https://github.com/nulltask/node-three.js) that hasn't been updated in years, but I wouldn't recommend that approach nor would I spend time on it.\n\nSince matplotlib already supports 3D graphics, what I think is a better approach is to implement a `matplotlib` function for `Graphics3d` like the one here for `Graphics`:\n\nhttps://github.com/sagemath/sage/blob/master/src/sage/plot/graphics.py#L2454\n\nI'll add Matthias Koeppe to this ticket in the event he's interested in adding this function.",
    "created_at": "2019-06-01T21:09:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27910#issuecomment-433616",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:6" align="right">comment:6</div>

Glad you like it Eric. I added it because you've requested such a feature several times. Turned out to be easier than expected to implement.

Unfortunately the rendering requires a browser environment to function, so it won't work from the command line. It is possible in principle to perform command-line JavaScript rendering by making Node.js a required package and then using another third-party [library](https://github.com/nulltask/node-three.js) that hasn't been updated in years, but I wouldn't recommend that approach nor would I spend time on it.

Since matplotlib already supports 3D graphics, what I think is a better approach is to implement a `matplotlib` function for `Graphics3d` like the one here for `Graphics`:

https://github.com/sagemath/sage/blob/master/src/sage/plot/graphics.py#L2454

I'll add Matthias Koeppe to this ticket in the event he's interested in adding this function.



---

archive/issue_comments_433617.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@paulmasson](#comment%3A6):\n> Glad you like it Eric. I added it because you've requested such a feature several times. Turned out to be easier than expected to implement.\n> \n\nThanks!\n\n> Unfortunately the rendering requires a browser environment to function, so it won't work from the command line. It is possible in principle to perform command-line JavaScript rendering by making Node.js a required package and then using another third-party [library](https://github.com/nulltask/node-three.js) that hasn't been updated in years, but I wouldn't recommend that approach nor would I spend time on it.\n> \n> Since matplotlib already supports 3D graphics, what I think is a better approach is to implement a `matplotlib` function for `Graphics3d` like the one here for `Graphics`:\n> \n> https://github.com/sagemath/sage/blob/master/src/sage/plot/graphics.py#L2454\n> \n> I'll add Matthias Koeppe to this ticket in the event he's interested in adding this function.\n\nOK. This is clearly for another ticket then. \nRegarding the current one, I've checked that the png export works via `nbviewer` as well (cf. [this example](https://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/test_dodecahedron_threejs.ipynb)), although I guess there was no reason for which it should not work... So this positive review from my side.",
    "created_at": "2019-06-03T08:56:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27910#issuecomment-433617",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@paulmasson](#comment%3A6):
> Glad you like it Eric. I added it because you've requested such a feature several times. Turned out to be easier than expected to implement.
> 

Thanks!

> Unfortunately the rendering requires a browser environment to function, so it won't work from the command line. It is possible in principle to perform command-line JavaScript rendering by making Node.js a required package and then using another third-party [library](https://github.com/nulltask/node-three.js) that hasn't been updated in years, but I wouldn't recommend that approach nor would I spend time on it.
> 
> Since matplotlib already supports 3D graphics, what I think is a better approach is to implement a `matplotlib` function for `Graphics3d` like the one here for `Graphics`:
> 
> https://github.com/sagemath/sage/blob/master/src/sage/plot/graphics.py#L2454
> 
> I'll add Matthias Koeppe to this ticket in the event he's interested in adding this function.

OK. This is clearly for another ticket then. 
Regarding the current one, I've checked that the png export works via `nbviewer` as well (cf. [this example](https://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/test_dodecahedron_threejs.ipynb)), although I guess there was no reason for which it should not work... So this positive review from my side.



---

archive/issue_events_379795.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-06-03T08:56:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27910",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27910#event-379795"
}
```



---

archive/issue_events_379796.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-06-03T08:56:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27910",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27910#event-379796"
}
```



---

archive/issue_comments_433618.json:
```json
{
    "body": "Reviewer: **Eric Gourgoulhon**",
    "created_at": "2019-06-03T17:36:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27910#issuecomment-433618",
    "user": "https://github.com/paulmasson"
}
```

Reviewer: **Eric Gourgoulhon**



---

archive/issue_comments_433619.json:
```json
{
    "body": "Changed branch from **[u/paulmasson/download-png](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/download-png)** to **[`8446149`](https://github.com/sagemath/sagetrac-mirror/commit/84461495593db9af8c3ce13d8ef76bd37f5a4ce5)**",
    "created_at": "2019-06-06T22:26:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27910#issuecomment-433619",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/paulmasson/download-png](https://github.com/sagemath/sagetrac-mirror/tree/u/paulmasson/download-png)** to **[`8446149`](https://github.com/sagemath/sagetrac-mirror/commit/84461495593db9af8c3ce13d8ef76bd37f5a4ce5)**



---

archive/issue_events_379797.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-06T22:26:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27910",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27910#event-379797"
}
```



---

archive/issue_events_379798.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "275dfbfdc0c6d565526f847e5226d34613c2ecdf",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-06-06T22:26:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27910",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27910#event-379798"
}
```
