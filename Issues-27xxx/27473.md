# Issue 27473: Matrix inversion fails over a Laurent series ring

archive/issues_027236.json:
```json
{
    "assignees": [],
    "body": "As of 8.7beta6, this works fine (note change from `adjoint` to `adjugate` as per #10501):\n\n```\nsage: R.<t> = LaurentSeriesRing(QQ)\nsage: M = t*identity_matrix(2)\nsage: M.adjugate() * ~M.det()\n[t^-1    0]\n[   0 t^-1]\n```\nbut this fails:\n\n```\nsage: ~M ## Shorthand for M.inverse(), which behaves the same way\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-53-6c551a35e6a8> in <module>()\n----> 1 ~M\n\n/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix0.pyx in sage.matrix.matrix0.Matrix.__invert__ (build/cythonized/sage/matrix/matrix0.c:36096)()\n   5380 \n   5381         A = self.augment(self.parent().identity_matrix())\n-> 5382         A.echelonize()\n   5383 \n   5384         # Now we want to make sure that B is of the form [I|X], in\n\n/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix2.pyx in sage.matrix.matrix2.Matrix.echelonize (build/cythonized/sage/matrix/matrix2.c:48296)()\n   6725             if self.base_ring().is_field():\n   6726                 if algorithm in ['classical', 'partial_pivoting', 'scaled_partial_pivoting']:\n-> 6727                     self._echelon_in_place(algorithm)\n   6728                 elif algorithm == 'strassen':\n   6729                     self._echelon_strassen(cutoff)\n\n/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix2.pyx in sage.matrix.matrix2.Matrix._echelon_in_place (build/cythonized/sage/matrix/matrix2.c:50128)()\n   7004                     scale_factor = 0\n   7005                     for c in range(nc):\n-> 7006                         abs_val = A.get_unsafe(r, c).abs()\n   7007                         if abs_val > scale_factor:\n   7008                             scale_factor = abs_val\n\n/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/structure/element.pyx in sage.structure.element.RingElement.abs (build/cythonized/sage/structure/element.c:18824)()\n   2718             ArithmeticError: absolute valued not defined on integers modulo n.\n   2719         \"\"\"\n-> 2720         return abs(self)\n   2721 \n   2722     def is_prime(self):\n\nTypeError: bad operand type for abs(): 'sage.rings.laurent_series_ring_element.LaurentSeries'\n```\nThis worked back in 8.2, so it must be a recent change that broke it.\n\n\nCC:  @roed314\n\nKeywords: **matrix inversion, Laurent series**\n\nBranch/Commit: **[5fd44ec](https://github.com/sagemath/sagetrac-mirror/commit/5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton**\n\nAuthor: **Kiran Kedlaya**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27473_\n\n",
    "closed_at": "2019-09-02T21:41:21Z",
    "created_at": "2019-03-12T17:28:52Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20padics",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Matrix inversion fails over a Laurent series ring",
    "type": "issue",
    "updated_at": "2019-09-02T21:41:21Z",
    "url": "https://github.com/sagemath/sage/issues/27473",
    "user": "https://github.com/kedlaya"
}
```
As of 8.7beta6, this works fine (note change from `adjoint` to `adjugate` as per #10501):

```
sage: R.<t> = LaurentSeriesRing(QQ)
sage: M = t*identity_matrix(2)
sage: M.adjugate() * ~M.det()
[t^-1    0]
[   0 t^-1]
```
but this fails:

```
sage: ~M ## Shorthand for M.inverse(), which behaves the same way
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-53-6c551a35e6a8> in <module>()
----> 1 ~M

/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix0.pyx in sage.matrix.matrix0.Matrix.__invert__ (build/cythonized/sage/matrix/matrix0.c:36096)()
   5380 
   5381         A = self.augment(self.parent().identity_matrix())
-> 5382         A.echelonize()
   5383 
   5384         # Now we want to make sure that B is of the form [I|X], in

/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix2.pyx in sage.matrix.matrix2.Matrix.echelonize (build/cythonized/sage/matrix/matrix2.c:48296)()
   6725             if self.base_ring().is_field():
   6726                 if algorithm in ['classical', 'partial_pivoting', 'scaled_partial_pivoting']:
-> 6727                     self._echelon_in_place(algorithm)
   6728                 elif algorithm == 'strassen':
   6729                     self._echelon_strassen(cutoff)

/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix2.pyx in sage.matrix.matrix2.Matrix._echelon_in_place (build/cythonized/sage/matrix/matrix2.c:50128)()
   7004                     scale_factor = 0
   7005                     for c in range(nc):
-> 7006                         abs_val = A.get_unsafe(r, c).abs()
   7007                         if abs_val > scale_factor:
   7008                             scale_factor = abs_val

/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/structure/element.pyx in sage.structure.element.RingElement.abs (build/cythonized/sage/structure/element.c:18824)()
   2718             ArithmeticError: absolute valued not defined on integers modulo n.
   2719         """
-> 2720         return abs(self)
   2721 
   2722     def is_prime(self):

TypeError: bad operand type for abs(): 'sage.rings.laurent_series_ring_element.LaurentSeries'
```
This worked back in 8.2, so it must be a recent change that broke it.


CC:  @roed314

Keywords: **matrix inversion, Laurent series**

Branch/Commit: **[5fd44ec](https://github.com/sagemath/sagetrac-mirror/commit/5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44)**

Reviewer: **Frédéric Chapoton**

Author: **Kiran Kedlaya**

_Issue created by migration from https://trac.sagemath.org/ticket/27473_





---

archive/issue_events_359091.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2019-03-12T17:28:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359091"
}
```



---

archive/issue_events_359092.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2019-03-12T17:28:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20padics",
    "label_color": "0000ff",
    "label_name": "component: padics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359092"
}
```



---

archive/issue_events_359093.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2019-03-12T17:28:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359093"
}
```



---

archive/issue_events_359094.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2019-03-12T17:28:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359094"
}
```



---

archive/issue_comments_428032.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nThe error comes from:\n\n```\nM.echelonize('scaled_partial_pivoting')\n```\nIt seems to be assumed that rings in `DiscreteValuationFields` have an `abs` method.",
    "created_at": "2019-03-12T19:14:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428032",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'>Comment 1:</a>
The error comes from:

```
M.echelonize('scaled_partial_pivoting')
```
It seems to be assumed that rings in `DiscreteValuationFields` have an `abs` method.



---

archive/issue_comments_428033.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\n... which of course they can have, but it's probably better to program the partial pivoting using the valuation directly. The definition of `abs` would be `lambda self: (self.is_zero()) select 0 else 2**(-self.valuation())` or something similar, and is a very inefficient way of representing the valuation. So we probably need a  `scaled_partial_pivoting_absvalue` and a `scaled_partial_pivoting_valuation`.",
    "created_at": "2019-03-13T06:00:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428033",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:2'>Comment 2:</a>
... which of course they can have, but it's probably better to program the partial pivoting using the valuation directly. The definition of `abs` would be `lambda self: (self.is_zero()) select 0 else 2**(-self.valuation())` or something similar, and is a very inefficient way of representing the valuation. So we probably need a  `scaled_partial_pivoting_absvalue` and a `scaled_partial_pivoting_valuation`.



---

archive/issue_events_359095.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359095"
}
```



---

archive/issue_events_359096.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359096"
}
```



---

archive/issue_comments_428034.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nTicket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428034",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'>Comment 3:</a>
Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_428035.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nAs the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428035",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'>Comment 4:</a>
As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_events_359097.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:55:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359097"
}
```



---

archive/issue_comments_428036.json:
```json
{
    "body": "Branch: **[u/kedlaya/matrix_inversion_fails_over_a_laurent_series_ring](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/matrix_inversion_fails_over_a_laurent_series_ring)**",
    "created_at": "2019-08-16T01:57:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428036",
    "user": "https://github.com/kedlaya"
}
```

Branch: **[u/kedlaya/matrix_inversion_fails_over_a_laurent_series_ring](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/matrix_inversion_fails_over_a_laurent_series_ring)**



---

archive/issue_events_359098.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2019-08-16T02:02:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359098"
}
```



---

archive/issue_comments_428037.json:
```json
{
    "body": "Author: **Kiran Kedlaya**",
    "created_at": "2019-08-16T02:02:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428037",
    "user": "https://github.com/kedlaya"
}
```

Author: **Kiran Kedlaya**



---

archive/issue_comments_428038.json:
```json
{
    "body": "Commit: **[603f041](https://github.com/sagemath/sagetrac-mirror/commit/603f04141e3929e207bbaf603e8d10063762f671)**",
    "created_at": "2019-08-16T02:02:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428038",
    "user": "https://github.com/kedlaya"
}
```

Commit: **[603f041](https://github.com/sagemath/sagetrac-mirror/commit/603f04141e3929e207bbaf603e8d10063762f671)**



---

archive/issue_comments_428039.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nI followed nbruin's suggestion and added an algorithm `scaled_partial_pivoting_valuation`. This shouldn't cause any side effects, but one should be careful when messing with core linear algebra.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/603f04141e3929e207bbaf603e8d10063762f671\">603f041</a></td><td><code>Add algorithm scaled_partial_pivoting_valuation</code></td></tr></table>\n",
    "created_at": "2019-08-16T02:02:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428039",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:6'>Comment 6:</a>
I followed nbruin's suggestion and added an algorithm `scaled_partial_pivoting_valuation`. This shouldn't cause any side effects, but one should be careful when messing with core linear algebra.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/603f04141e3929e207bbaf603e8d10063762f671">603f041</a></td><td><code>Add algorithm scaled_partial_pivoting_valuation</code></td></tr></table>




---

archive/issue_comments_428040.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nI see some failing doctests, so let me pull this until I have a chance to check these out.",
    "created_at": "2019-08-16T02:56:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428040",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:7'>Comment 7:</a>
I see some failing doctests, so let me pull this until I have a chance to check these out.



---

archive/issue_events_359099.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2019-08-16T02:56:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359099"
}
```



---

archive/issue_events_359100.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2019-08-16T02:56:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359100"
}
```



---

archive/issue_comments_428041.json:
```json
{
    "body": "Changed commit from **[603f041](https://github.com/sagemath/sagetrac-mirror/commit/603f04141e3929e207bbaf603e8d10063762f671)** to **[3a381db](https://github.com/sagemath/sagetrac-mirror/commit/3a381dbbe5c6b806ba72d7b29ad3f8fe57f4d68d)**",
    "created_at": "2019-08-16T03:12:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428041",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[603f041](https://github.com/sagemath/sagetrac-mirror/commit/603f04141e3929e207bbaf603e8d10063762f671)** to **[3a381db](https://github.com/sagemath/sagetrac-mirror/commit/3a381dbbe5c6b806ba72d7b29ad3f8fe57f4d68d)**



---

archive/issue_comments_428042.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a381dbbe5c6b806ba72d7b29ad3f8fe57f4d68d\">3a381db</a></td><td><code>Make echelon use abs for discretely valued fields when possible</code></td></tr></table>\n",
    "created_at": "2019-08-16T03:12:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428042",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>Comment 8:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a381dbbe5c6b806ba72d7b29ad3f8fe57f4d68d">3a381db</a></td><td><code>Make echelon use abs for discretely valued fields when possible</code></td></tr></table>




---

archive/issue_comments_428043.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nThe first commit broke a bunch of doctests involving matrices over p-adic fields. In principle it should be possible to fix this, but it is far easier to simply short-circuit the echelon code so that it uses `abs` even for discretely valued field unless the field does not support it, in which case we switch to valuation. The latest commit implements this, but I want to rerun all doctests before changing status again.",
    "created_at": "2019-08-16T03:15:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428043",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:9'>Comment 9:</a>
The first commit broke a bunch of doctests involving matrices over p-adic fields. In principle it should be possible to fix this, but it is far easier to simply short-circuit the echelon code so that it uses `abs` even for discretely valued field unless the field does not support it, in which case we switch to valuation. The latest commit implements this, but I want to rerun all doctests before changing status again.



---

archive/issue_comments_428044.json:
```json
{
    "body": "Changed keywords from **** to **matrix inversion, Laurent series**",
    "created_at": "2019-08-16T06:23:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428044",
    "user": "https://github.com/kedlaya"
}
```

Changed keywords from **** to **matrix inversion, Laurent series**



---

archive/issue_comments_428045.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nI completed a run of doctests, so let's put this back up for review.",
    "created_at": "2019-08-16T06:23:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428045",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:10'>Comment 10:</a>
I completed a run of doctests, so let's put this back up for review.



---

archive/issue_events_359101.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2019-08-16T06:23:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359101"
}
```



---

archive/issue_events_359102.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2019-08-16T06:23:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359102"
}
```



---

archive/issue_comments_428046.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nI would try \"ring.one().abs\" instead of \"abs(ring.one())\" and then catch `AttributeError`.\n\nWrong doc here:\n\n```\n+          - ``'scaled_partial_pivoting_valuation'``: Gauss elimination, using scaled\n+            partial pivoting (if base ring has absolute value)\n```\n\nOtherwise, looks good.",
    "created_at": "2019-08-20T18:07:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428046",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'>Comment 11:</a>
I would try "ring.one().abs" instead of "abs(ring.one())" and then catch `AttributeError`.

Wrong doc here:

```
+          - ``'scaled_partial_pivoting_valuation'``: Gauss elimination, using scaled
+            partial pivoting (if base ring has absolute value)
```

Otherwise, looks good.



---

archive/issue_comments_428047.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/22d9208e2f53300946e56c24d1391dcbe6a56291\">22d9208</a></td><td><code>Edits based on trac feedback</code></td></tr></table>\n",
    "created_at": "2019-08-20T23:26:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428047",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'>Comment 12:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/22d9208e2f53300946e56c24d1391dcbe6a56291">22d9208</a></td><td><code>Edits based on trac feedback</code></td></tr></table>




---

archive/issue_comments_428048.json:
```json
{
    "body": "Changed commit from **[3a381db](https://github.com/sagemath/sagetrac-mirror/commit/3a381dbbe5c6b806ba72d7b29ad3f8fe57f4d68d)** to **[22d9208](https://github.com/sagemath/sagetrac-mirror/commit/22d9208e2f53300946e56c24d1391dcbe6a56291)**",
    "created_at": "2019-08-20T23:26:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428048",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3a381db](https://github.com/sagemath/sagetrac-mirror/commit/3a381dbbe5c6b806ba72d7b29ad3f8fe57f4d68d)** to **[22d9208](https://github.com/sagemath/sagetrac-mirror/commit/22d9208e2f53300946e56c24d1391dcbe6a56291)**



---

archive/issue_comments_428049.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nLatest commit makes the change regarding `abs`. Regarding the doc, I fixed the line overrun; but was there also another issue?",
    "created_at": "2019-08-20T23:28:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428049",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:13'>Comment 13:</a>
Latest commit makes the change regarding `abs`. Regarding the doc, I fixed the line overrun; but was there also another issue?



---

archive/issue_comments_428050.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nYou did not fix the correct doc lines. The one I talk about is a little bit below, and contains the word \"absolute value\", instead of the correct \"valuation\".",
    "created_at": "2019-08-21T06:42:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428050",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'>Comment 14:</a>
You did not fix the correct doc lines. The one I talk about is a little bit below, and contains the word "absolute value", instead of the correct "valuation".



---

archive/issue_comments_428051.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11ce5cf12c834e87d0911c30db7bda13ed78cd27\">11ce5cf</a></td><td><code>Correct line of docstring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea7557191a8a0d32a4c385b93a2a91872ee06822\">ea75571</a></td><td><code>Remove extra space</code></td></tr></table>\n",
    "created_at": "2019-08-21T14:33:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428051",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:15'>Comment 15:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11ce5cf12c834e87d0911c30db7bda13ed78cd27">11ce5cf</a></td><td><code>Correct line of docstring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea7557191a8a0d32a4c385b93a2a91872ee06822">ea75571</a></td><td><code>Remove extra space</code></td></tr></table>




---

archive/issue_comments_428052.json:
```json
{
    "body": "Changed commit from **[22d9208](https://github.com/sagemath/sagetrac-mirror/commit/22d9208e2f53300946e56c24d1391dcbe6a56291)** to **[ea75571](https://github.com/sagemath/sagetrac-mirror/commit/ea7557191a8a0d32a4c385b93a2a91872ee06822)**",
    "created_at": "2019-08-21T14:33:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428052",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[22d9208](https://github.com/sagemath/sagetrac-mirror/commit/22d9208e2f53300946e56c24d1391dcbe6a56291)** to **[ea75571](https://github.com/sagemath/sagetrac-mirror/commit/ea7557191a8a0d32a4c385b93a2a91872ee06822)**



---

archive/issue_comments_428053.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nThere is a failure in src/sage/matrix/matrix2.pyx : you need to catch `TypeError` in the check for abs.",
    "created_at": "2019-08-24T11:31:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428053",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'>Comment 16:</a>
There is a failure in src/sage/matrix/matrix2.pyx : you need to catch `TypeError` in the check for abs.



---

archive/issue_comments_428054.json:
```json
{
    "body": "Changed commit from **[ea75571](https://github.com/sagemath/sagetrac-mirror/commit/ea7557191a8a0d32a4c385b93a2a91872ee06822)** to **[e4ab573](https://github.com/sagemath/sagetrac-mirror/commit/e4ab5738cadb95d2fa9cb912fa420c74d6deecba)**",
    "created_at": "2019-08-24T18:25:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428054",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ea75571](https://github.com/sagemath/sagetrac-mirror/commit/ea7557191a8a0d32a4c385b93a2a91872ee06822)** to **[e4ab573](https://github.com/sagemath/sagetrac-mirror/commit/e4ab5738cadb95d2fa9cb912fa420c74d6deecba)**



---

archive/issue_comments_428055.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e4ab5738cadb95d2fa9cb912fa420c74d6deecba\">e4ab573</a></td><td><code>Catch correct exception raised by abs</code></td></tr></table>\n",
    "created_at": "2019-08-24T18:25:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428055",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:17'>Comment 17:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e4ab5738cadb95d2fa9cb912fa420c74d6deecba">e4ab573</a></td><td><code>Catch correct exception raised by abs</code></td></tr></table>




---

archive/issue_comments_428056.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nok, let it be. Thanks",
    "created_at": "2019-08-25T05:55:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428056",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'>Comment 18:</a>
ok, let it be. Thanks



---

archive/issue_events_359103.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-08-25T05:55:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359103"
}
```



---

archive/issue_events_359104.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-08-25T05:55:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359104"
}
```



---

archive/issue_comments_428057.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2019-08-25T05:55:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428057",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: **Frédéric Chapoton**



---

archive/issue_events_359105.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-08-25T19:51:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359105"
}
```



---

archive/issue_comments_428058.json:
```json
{
    "body": "Changed branch from **[u/kedlaya/matrix_inversion_fails_over_a_laurent_series_ring](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/matrix_inversion_fails_over_a_laurent_series_ring)** to **[e4ab573](https://github.com/sagemath/sagetrac-mirror/commit/e4ab5738cadb95d2fa9cb912fa420c74d6deecba)**",
    "created_at": "2019-08-26T22:15:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428058",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/kedlaya/matrix_inversion_fails_over_a_laurent_series_ring](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/matrix_inversion_fails_over_a_laurent_series_ring)** to **[e4ab573](https://github.com/sagemath/sagetrac-mirror/commit/e4ab5738cadb95d2fa9cb912fa420c74d6deecba)**



---

archive/issue_events_359106.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-26T22:15:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359106"
}
```



---

archive/issue_events_359107.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-26T22:15:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359107"
}
```



---

archive/issue_comments_428059.json:
```json
{
    "body": "Changed commit from **[e4ab573](https://github.com/sagemath/sagetrac-mirror/commit/e4ab5738cadb95d2fa9cb912fa420c74d6deecba)** to none",
    "created_at": "2019-08-28T20:09:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428059",
    "user": "https://github.com/vbraun"
}
```

Changed commit from **[e4ab573](https://github.com/sagemath/sagetrac-mirror/commit/e4ab5738cadb95d2fa9cb912fa420c74d6deecba)** to none



---

archive/issue_comments_428060.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nStill getting\n\n```\nFile \"src/sage/matrix/matrix2.pyx\", line 8922, in sage.matrix.matrix2.Matrix.diagonal.inverse\nFailed example:\n    ~M\nException raised:\n    Traceback (most recent call last):\n      File \"/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1105, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.matrix.matrix2.Matrix.diagonal.inverse[11]>\", line 1, in <module>\n        ~M\n      File \"sage/matrix/matrix0.pyx\", line 5382, in sage.matrix.matrix0.Matrix.__invert__ (build/cythonized/sage/matrix/matrix0.c:36130)\n        A.echelonize()\n      File \"sage/matrix/matrix2.pyx\", line 6756, in sage.matrix.matrix2.Matrix.echelonize (build/cythonized/sage/matrix/matrix2.c:48757)\n        self._echelon_in_place(algorithm)\n      File \"sage/matrix/matrix2.pyx\", line 7076, in sage.matrix.matrix2.Matrix._echelon_in_place (build/cythonized/sage/matrix/matrix2.c:51166)\n        if abs_val > max_abs_val:\n    TypeError: '>' not supported between instances of 'int' and 'NoneType'\n```\nwith e4ab5738ca",
    "created_at": "2019-08-28T20:09:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428060",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:21'>Comment 21:</a>
Still getting

```
File "src/sage/matrix/matrix2.pyx", line 8922, in sage.matrix.matrix2.Matrix.diagonal.inverse
Failed example:
    ~M
Exception raised:
    Traceback (most recent call last):
      File "/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.matrix.matrix2.Matrix.diagonal.inverse[11]>", line 1, in <module>
        ~M
      File "sage/matrix/matrix0.pyx", line 5382, in sage.matrix.matrix0.Matrix.__invert__ (build/cythonized/sage/matrix/matrix0.c:36130)
        A.echelonize()
      File "sage/matrix/matrix2.pyx", line 6756, in sage.matrix.matrix2.Matrix.echelonize (build/cythonized/sage/matrix/matrix2.c:48757)
        self._echelon_in_place(algorithm)
      File "sage/matrix/matrix2.pyx", line 7076, in sage.matrix.matrix2.Matrix._echelon_in_place (build/cythonized/sage/matrix/matrix2.c:51166)
        if abs_val > max_abs_val:
    TypeError: '>' not supported between instances of 'int' and 'NoneType'
```
with e4ab5738ca



---

archive/issue_comments_428061.json:
```json
{
    "body": "Changed branch from **[e4ab573](https://github.com/sagemath/sagetrac-mirror/commit/e4ab5738cadb95d2fa9cb912fa420c74d6deecba)** to **[u/kedlaya/e4ab5738cadb95d2fa9cb912fa420c74d6deecba](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/e4ab5738cadb95d2fa9cb912fa420c74d6deecba)**",
    "created_at": "2019-08-28T22:08:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428061",
    "user": "https://github.com/kedlaya"
}
```

Changed branch from **[e4ab573](https://github.com/sagemath/sagetrac-mirror/commit/e4ab5738cadb95d2fa9cb912fa420c74d6deecba)** to **[u/kedlaya/e4ab5738cadb95d2fa9cb912fa420c74d6deecba](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/e4ab5738cadb95d2fa9cb912fa420c74d6deecba)**



---

archive/issue_events_359108.json:
```json
{
    "actor": "https://github.com/kedlaya",
    "created_at": "2019-08-28T22:11:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359108"
}
```



---

archive/issue_comments_428062.json:
```json
{
    "body": "Commit: **[d97e89e](https://github.com/sagemath/sagetrac-mirror/commit/d97e89ec2f56bf98d8d50ac5e748d39228dea245)**",
    "created_at": "2019-08-28T22:11:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428062",
    "user": "https://github.com/kedlaya"
}
```

Commit: **[d97e89e](https://github.com/sagemath/sagetrac-mirror/commit/d97e89ec2f56bf98d8d50ac5e748d39228dea245)**



---

archive/issue_comments_428063.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nThat looks like a Py3 issue. Let's see if patchbot likes this better.",
    "created_at": "2019-08-28T22:11:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428063",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:24'>Comment 24:</a>
That looks like a Py3 issue. Let's see if patchbot likes this better.



---

archive/issue_comments_428064.json:
```json
{
    "body": "Changed branch from **[u/kedlaya/e4ab5738cadb95d2fa9cb912fa420c74d6deecba](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/e4ab5738cadb95d2fa9cb912fa420c74d6deecba)** to **[public/ticket/27473](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/27473)**",
    "created_at": "2019-08-29T07:48:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428064",
    "user": "https://github.com/fchapoton"
}
```

Changed branch from **[u/kedlaya/e4ab5738cadb95d2fa9cb912fa420c74d6deecba](https://github.com/sagemath/sagetrac-mirror/tree/u/kedlaya/e4ab5738cadb95d2fa9cb912fa420c74d6deecba)** to **[public/ticket/27473](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/27473)**



---

archive/issue_comments_428065.json:
```json
{
    "body": "Changed commit from **[d97e89e](https://github.com/sagemath/sagetrac-mirror/commit/d97e89ec2f56bf98d8d50ac5e748d39228dea245)** to **[5fd44ec](https://github.com/sagemath/sagetrac-mirror/commit/5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44)**",
    "created_at": "2019-08-29T07:48:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428065",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[d97e89e](https://github.com/sagemath/sagetrac-mirror/commit/d97e89ec2f56bf98d8d50ac5e748d39228dea245)** to **[5fd44ec](https://github.com/sagemath/sagetrac-mirror/commit/5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44)**



---

archive/issue_comments_428066.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nYou did something strange with your branch. I pushed a clean (and squashed) one instead, with the same fix for py3.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/268d9dbe8d6557964cadcc4810f0965bf3b8191a\">268d9db</a></td><td><code>Add algorithm scaled_partial_pivoting_valuation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44\">5fd44ec</a></td><td><code>Make echelon use abs for discretely valued fields when possible</code></td></tr></table>\n",
    "created_at": "2019-08-29T07:48:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428066",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:25'>Comment 25:</a>
You did something strange with your branch. I pushed a clean (and squashed) one instead, with the same fix for py3.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/268d9dbe8d6557964cadcc4810f0965bf3b8191a">268d9db</a></td><td><code>Add algorithm scaled_partial_pivoting_valuation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44">5fd44ec</a></td><td><code>Make echelon use abs for discretely valued fields when possible</code></td></tr></table>




---

archive/issue_events_359109.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-08-29T09:58:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359109"
}
```



---

archive/issue_events_359110.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-08-29T09:58:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359110"
}
```



---

archive/issue_comments_428067.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nthe py2 bot is green, and all tests pass on py3. I am setting this back to positive",
    "created_at": "2019-08-29T09:58:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428067",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:26'>Comment 26:</a>
the py2 bot is green, and all tests pass on py3. I am setting this back to positive



---

archive/issue_events_359111.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-09-02T21:41:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359111"
}
```



---

archive/issue_events_359112.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0719be21c23fe0e7b2ef3cc89eac348bb4036501",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-09-02T21:41:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27473#event-359112"
}
```



---

archive/issue_comments_428068.json:
```json
{
    "body": "Changed branch from **[public/ticket/27473](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/27473)** to **[5fd44ec](https://github.com/sagemath/sagetrac-mirror/commit/5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44)**",
    "created_at": "2019-09-02T21:41:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27473#issuecomment-428068",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/ticket/27473](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/27473)** to **[5fd44ec](https://github.com/sagemath/sagetrac-mirror/commit/5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44)**
