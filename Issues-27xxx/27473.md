# Issue 27473: Matrix inversion fails over a Laurent series ring

archive/issues_027236.json:
```json
{
    "body": "As of 8.7beta6, this works fine (note change from `adjoint` to `adjugate` as per #10501):\n\n```\nsage: R.<t> = LaurentSeriesRing(QQ)\nsage: M = t*identity_matrix(2)\nsage: M.adjugate() * ~M.det()\n[t^-1    0]\n[   0 t^-1]\n```\nbut this fails:\n\n```\nsage: ~M ## Shorthand for M.inverse(), which behaves the same way\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-53-6c551a35e6a8> in <module>()\n----> 1 ~M\n\n/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix0.pyx in sage.matrix.matrix0.Matrix.__invert__ (build/cythonized/sage/matrix/matrix0.c:36096)()\n   5380 \n   5381         A = self.augment(self.parent().identity_matrix())\n-> 5382         A.echelonize()\n   5383 \n   5384         # Now we want to make sure that B is of the form [I|X], in\n\n/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix2.pyx in sage.matrix.matrix2.Matrix.echelonize (build/cythonized/sage/matrix/matrix2.c:48296)()\n   6725             if self.base_ring().is_field():\n   6726                 if algorithm in ['classical', 'partial_pivoting', 'scaled_partial_pivoting']:\n-> 6727                     self._echelon_in_place(algorithm)\n   6728                 elif algorithm == 'strassen':\n   6729                     self._echelon_strassen(cutoff)\n\n/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix2.pyx in sage.matrix.matrix2.Matrix._echelon_in_place (build/cythonized/sage/matrix/matrix2.c:50128)()\n   7004                     scale_factor = 0\n   7005                     for c in range(nc):\n-> 7006                         abs_val = A.get_unsafe(r, c).abs()\n   7007                         if abs_val > scale_factor:\n   7008                             scale_factor = abs_val\n\n/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/structure/element.pyx in sage.structure.element.RingElement.abs (build/cythonized/sage/structure/element.c:18824)()\n   2718             ArithmeticError: absolute valued not defined on integers modulo n.\n   2719         \"\"\"\n-> 2720         return abs(self)\n   2721 \n   2722     def is_prime(self):\n\nTypeError: bad operand type for abs(): 'sage.rings.laurent_series_ring_element.LaurentSeries'\n```\nThis worked back in 8.2, so it must be a recent change that broke it.\n\n\nCC:  @roed314\n\nKeywords: matrix inversion, Laurent series\n\nBranch/Commit: 5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Kiran Kedlaya\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27473\n\n",
    "closed_at": "2019-09-02T21:41:21Z",
    "created_at": "2019-03-12T17:28:52Z",
    "labels": [
        "component: padics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Matrix inversion fails over a Laurent series ring",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27473",
    "user": "https://github.com/kedlaya"
}
```
As of 8.7beta6, this works fine (note change from `adjoint` to `adjugate` as per #10501):

```
sage: R.<t> = LaurentSeriesRing(QQ)
sage: M = t*identity_matrix(2)
sage: M.adjugate() * ~M.det()
[t^-1    0]
[   0 t^-1]
```
but this fails:

```
sage: ~M ## Shorthand for M.inverse(), which behaves the same way
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-53-6c551a35e6a8> in <module>()
----> 1 ~M

/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix0.pyx in sage.matrix.matrix0.Matrix.__invert__ (build/cythonized/sage/matrix/matrix0.c:36096)()
   5380 
   5381         A = self.augment(self.parent().identity_matrix())
-> 5382         A.echelonize()
   5383 
   5384         # Now we want to make sure that B is of the form [I|X], in

/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix2.pyx in sage.matrix.matrix2.Matrix.echelonize (build/cythonized/sage/matrix/matrix2.c:48296)()
   6725             if self.base_ring().is_field():
   6726                 if algorithm in ['classical', 'partial_pivoting', 'scaled_partial_pivoting']:
-> 6727                     self._echelon_in_place(algorithm)
   6728                 elif algorithm == 'strassen':
   6729                     self._echelon_strassen(cutoff)

/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix2.pyx in sage.matrix.matrix2.Matrix._echelon_in_place (build/cythonized/sage/matrix/matrix2.c:50128)()
   7004                     scale_factor = 0
   7005                     for c in range(nc):
-> 7006                         abs_val = A.get_unsafe(r, c).abs()
   7007                         if abs_val > scale_factor:
   7008                             scale_factor = abs_val

/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/structure/element.pyx in sage.structure.element.RingElement.abs (build/cythonized/sage/structure/element.c:18824)()
   2718             ArithmeticError: absolute valued not defined on integers modulo n.
   2719         """
-> 2720         return abs(self)
   2721 
   2722     def is_prime(self):

TypeError: bad operand type for abs(): 'sage.rings.laurent_series_ring_element.LaurentSeries'
```
This worked back in 8.2, so it must be a recent change that broke it.


CC:  @roed314

Keywords: matrix inversion, Laurent series

Branch/Commit: 5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44

Reviewer: Frédéric Chapoton

Author: Kiran Kedlaya

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27473





---

archive/issue_comments_529788.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe error comes from:\n\n```\nM.echelonize('scaled_partial_pivoting')\n```\nIt seems to be assumed that rings in `DiscreteValuationFields` have an `abs` method.",
    "created_at": "2019-03-12T19:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529788",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
The error comes from:

```
M.echelonize('scaled_partial_pivoting')
```
It seems to be assumed that rings in `DiscreteValuationFields` have an `abs` method.



---

archive/issue_comments_529789.json:
```json
{
    "body": "<a id='comment:2'></a>\n... which of course they can have, but it's probably better to program the partial pivoting using the valuation directly. The definition of `abs` would be `lambda self: (self.is_zero()) select 0 else 2**(-self.valuation())` or something similar, and is a very inefficient way of representing the valuation. So we probably need a  `scaled_partial_pivoting_absvalue` and a `scaled_partial_pivoting_valuation`.",
    "created_at": "2019-03-13T06:00:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529789",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:2'></a>
... which of course they can have, but it's probably better to program the partial pivoting using the valuation directly. The definition of `abs` would be `lambda self: (self.is_zero()) select 0 else 2**(-self.valuation())` or something similar, and is a very inefficient way of representing the valuation. So we probably need a  `scaled_partial_pivoting_absvalue` and a `scaled_partial_pivoting_valuation`.



---

archive/issue_events_068220.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27473#event-68220"
}
```



---

archive/issue_comments_529790.json:
```json
{
    "body": "<a id='comment:3'></a>\nTicket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529790",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>
Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_529791.json:
```json
{
    "body": "<a id='comment:4'></a>\nAs the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529791",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>
As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_events_068221.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:55:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27473#event-68221"
}
```



---

archive/issue_comments_529792.json:
```json
{
    "body": "Changing branch from \"\" to \"u/kedlaya/matrix_inversion_fails_over_a_laurent_series_ring\"",
    "created_at": "2019-08-16T01:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529792",
    "user": "https://github.com/kedlaya"
}
```

Changing branch from "" to "u/kedlaya/matrix_inversion_fails_over_a_laurent_series_ring"



---

archive/issue_comments_529793.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-08-16T02:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529793",
    "user": "https://github.com/kedlaya"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_529794.json:
```json
{
    "body": "Changing author from \"\" to \"Kiran Kedlaya\"",
    "created_at": "2019-08-16T02:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529794",
    "user": "https://github.com/kedlaya"
}
```

Changing author from "" to "Kiran Kedlaya"



---

archive/issue_comments_529795.json:
```json
{
    "body": "Changing commit from \"\" to \"603f04141e3929e207bbaf603e8d10063762f671\"",
    "created_at": "2019-08-16T02:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529795",
    "user": "https://github.com/kedlaya"
}
```

Changing commit from "" to "603f04141e3929e207bbaf603e8d10063762f671"



---

archive/issue_comments_529796.json:
```json
{
    "body": "<a id='comment:6'></a>\nI followed nbruin's suggestion and added an algorithm `scaled_partial_pivoting_valuation`. This shouldn't cause any side effects, but one should be careful when messing with core linear algebra.\n\n---\nNew commits:\n|                                                                                                                                          |                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|\n|[603f041](https://git.sagemath.org/sage.git/commit?id=603f04141e3929e207bbaf603e8d10063762f671)|`Add algorithm scaled_partial_pivoting_valuation`|",
    "created_at": "2019-08-16T02:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529796",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:6'></a>
I followed nbruin's suggestion and added an algorithm `scaled_partial_pivoting_valuation`. This shouldn't cause any side effects, but one should be careful when messing with core linear algebra.

---
New commits:
|                                                                                                                                          |                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
|[603f041](https://git.sagemath.org/sage.git/commit?id=603f04141e3929e207bbaf603e8d10063762f671)|`Add algorithm scaled_partial_pivoting_valuation`|



---

archive/issue_comments_529797.json:
```json
{
    "body": "<a id='comment:7'></a>\nI see some failing doctests, so let me pull this until I have a chance to check these out.",
    "created_at": "2019-08-16T02:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529797",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:7'></a>
I see some failing doctests, so let me pull this until I have a chance to check these out.



---

archive/issue_comments_529798.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-08-16T02:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529798",
    "user": "https://github.com/kedlaya"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_529799.json:
```json
{
    "body": "Changing commit from \"603f04141e3929e207bbaf603e8d10063762f671\" to \"3a381dbbe5c6b806ba72d7b29ad3f8fe57f4d68d\"",
    "created_at": "2019-08-16T03:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529799",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "603f04141e3929e207bbaf603e8d10063762f671" to "3a381dbbe5c6b806ba72d7b29ad3f8fe57f4d68d"



---

archive/issue_comments_529800.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|\n|[3a381db](https://git.sagemath.org/sage.git/commit/?id=3a381dbbe5c6b806ba72d7b29ad3f8fe57f4d68d)|`Make echelon use abs for discretely valued fields when possible`|",
    "created_at": "2019-08-16T03:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529800",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
|[3a381db](https://git.sagemath.org/sage.git/commit/?id=3a381dbbe5c6b806ba72d7b29ad3f8fe57f4d68d)|`Make echelon use abs for discretely valued fields when possible`|



---

archive/issue_comments_529801.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe first commit broke a bunch of doctests involving matrices over p-adic fields. In principle it should be possible to fix this, but it is far easier to simply short-circuit the echelon code so that it uses `abs` even for discretely valued field unless the field does not support it, in which case we switch to valuation. The latest commit implements this, but I want to rerun all doctests before changing status again.",
    "created_at": "2019-08-16T03:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529801",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:9'></a>
The first commit broke a bunch of doctests involving matrices over p-adic fields. In principle it should be possible to fix this, but it is far easier to simply short-circuit the echelon code so that it uses `abs` even for discretely valued field unless the field does not support it, in which case we switch to valuation. The latest commit implements this, but I want to rerun all doctests before changing status again.



---

archive/issue_comments_529802.json:
```json
{
    "body": "Changing keywords from \"\" to \"matrix inversion, Laurent series\".",
    "created_at": "2019-08-16T06:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529802",
    "user": "https://github.com/kedlaya"
}
```

Changing keywords from "" to "matrix inversion, Laurent series".



---

archive/issue_comments_529803.json:
```json
{
    "body": "<a id='comment:10'></a>\nI completed a run of doctests, so let's put this back up for review.",
    "created_at": "2019-08-16T06:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529803",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:10'></a>
I completed a run of doctests, so let's put this back up for review.



---

archive/issue_comments_529804.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-08-16T06:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529804",
    "user": "https://github.com/kedlaya"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_529805.json:
```json
{
    "body": "<a id='comment:11'></a>\nI would try \"ring.one().abs\" instead of \"abs(ring.one())\" and then catch `AttributeError`.\n\nWrong doc here:\n\n```\n+          - ``'scaled_partial_pivoting_valuation'``: Gauss elimination, using scaled\n+            partial pivoting (if base ring has absolute value)\n```\n\nOtherwise, looks good.",
    "created_at": "2019-08-20T18:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529805",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>
I would try "ring.one().abs" instead of "abs(ring.one())" and then catch `AttributeError`.

Wrong doc here:

```
+          - ``'scaled_partial_pivoting_valuation'``: Gauss elimination, using scaled
+            partial pivoting (if base ring has absolute value)
```

Otherwise, looks good.



---

archive/issue_comments_529806.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|\n|[22d9208](https://git.sagemath.org/sage.git/commit/?id=22d9208e2f53300946e56c24d1391dcbe6a56291)|`Edits based on trac feedback`|",
    "created_at": "2019-08-20T23:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529806",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                              |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|
|[22d9208](https://git.sagemath.org/sage.git/commit/?id=22d9208e2f53300946e56c24d1391dcbe6a56291)|`Edits based on trac feedback`|



---

archive/issue_comments_529807.json:
```json
{
    "body": "Changing commit from \"3a381dbbe5c6b806ba72d7b29ad3f8fe57f4d68d\" to \"22d9208e2f53300946e56c24d1391dcbe6a56291\"",
    "created_at": "2019-08-20T23:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529807",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3a381dbbe5c6b806ba72d7b29ad3f8fe57f4d68d" to "22d9208e2f53300946e56c24d1391dcbe6a56291"



---

archive/issue_comments_529808.json:
```json
{
    "body": "<a id='comment:13'></a>\nLatest commit makes the change regarding `abs`. Regarding the doc, I fixed the line overrun; but was there also another issue?",
    "created_at": "2019-08-20T23:28:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529808",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:13'></a>
Latest commit makes the change regarding `abs`. Regarding the doc, I fixed the line overrun; but was there also another issue?



---

archive/issue_comments_529809.json:
```json
{
    "body": "<a id='comment:14'></a>\nYou did not fix the correct doc lines. The one I talk about is a little bit below, and contains the word \"absolute value\", instead of the correct \"valuation\".",
    "created_at": "2019-08-21T06:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529809",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>
You did not fix the correct doc lines. The one I talk about is a little bit below, and contains the word "absolute value", instead of the correct "valuation".



---

archive/issue_comments_529810.json:
```json
{
    "body": "<a id='comment:15'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|\n|[11ce5cf](https://git.sagemath.org/sage.git/commit/?id=11ce5cf12c834e87d0911c30db7bda13ed78cd27)|`Correct line of docstring`|\n|[ea75571](https://git.sagemath.org/sage.git/commit/?id=ea7557191a8a0d32a4c385b93a2a91872ee06822)|`Remove extra space`|",
    "created_at": "2019-08-21T14:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529810",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
|[11ce5cf](https://git.sagemath.org/sage.git/commit/?id=11ce5cf12c834e87d0911c30db7bda13ed78cd27)|`Correct line of docstring`|
|[ea75571](https://git.sagemath.org/sage.git/commit/?id=ea7557191a8a0d32a4c385b93a2a91872ee06822)|`Remove extra space`|



---

archive/issue_comments_529811.json:
```json
{
    "body": "Changing commit from \"22d9208e2f53300946e56c24d1391dcbe6a56291\" to \"ea7557191a8a0d32a4c385b93a2a91872ee06822\"",
    "created_at": "2019-08-21T14:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529811",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "22d9208e2f53300946e56c24d1391dcbe6a56291" to "ea7557191a8a0d32a4c385b93a2a91872ee06822"



---

archive/issue_comments_529812.json:
```json
{
    "body": "<a id='comment:16'></a>\nThere is a failure in src/sage/matrix/matrix2.pyx : you need to catch `TypeError` in the check for abs.",
    "created_at": "2019-08-24T11:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529812",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>
There is a failure in src/sage/matrix/matrix2.pyx : you need to catch `TypeError` in the check for abs.



---

archive/issue_comments_529813.json:
```json
{
    "body": "Changing commit from \"ea7557191a8a0d32a4c385b93a2a91872ee06822\" to \"e4ab5738cadb95d2fa9cb912fa420c74d6deecba\"",
    "created_at": "2019-08-24T18:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529813",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ea7557191a8a0d32a4c385b93a2a91872ee06822" to "e4ab5738cadb95d2fa9cb912fa420c74d6deecba"



---

archive/issue_comments_529814.json:
```json
{
    "body": "<a id='comment:17'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[e4ab573](https://git.sagemath.org/sage.git/commit/?id=e4ab5738cadb95d2fa9cb912fa420c74d6deecba)|`Catch correct exception raised by abs`|",
    "created_at": "2019-08-24T18:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529814",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
|[e4ab573](https://git.sagemath.org/sage.git/commit/?id=e4ab5738cadb95d2fa9cb912fa420c74d6deecba)|`Catch correct exception raised by abs`|



---

archive/issue_comments_529815.json:
```json
{
    "body": "<a id='comment:18'></a>\nok, let it be. Thanks",
    "created_at": "2019-08-25T05:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529815",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>
ok, let it be. Thanks



---

archive/issue_comments_529816.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-25T05:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529816",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_529817.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2019-08-25T05:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529817",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "" to "Frédéric Chapoton"



---

archive/issue_events_068222.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-08-25T19:51:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27473#event-68222"
}
```



---

archive/issue_comments_529818.json:
```json
{
    "body": "Changing branch from \"u/kedlaya/matrix_inversion_fails_over_a_laurent_series_ring\" to \"e4ab5738cadb95d2fa9cb912fa420c74d6deecba\"",
    "created_at": "2019-08-26T22:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529818",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/kedlaya/matrix_inversion_fails_over_a_laurent_series_ring" to "e4ab5738cadb95d2fa9cb912fa420c74d6deecba"



---

archive/issue_comments_529819.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-08-26T22:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529819",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_068223.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-26T22:15:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27473#event-68223"
}
```



---

archive/issue_comments_529820.json:
```json
{
    "body": "Changing commit from \"e4ab5738cadb95d2fa9cb912fa420c74d6deecba\" to \"\"",
    "created_at": "2019-08-28T20:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529820",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "e4ab5738cadb95d2fa9cb912fa420c74d6deecba" to ""



---

archive/issue_comments_529821.json:
```json
{
    "body": "<a id='comment:21'></a>\nStill getting\n\n```\nFile \"src/sage/matrix/matrix2.pyx\", line 8922, in sage.matrix.matrix2.Matrix.diagonal.inverse\nFailed example:\n    ~M\nException raised:\n    Traceback (most recent call last):\n      File \"/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1105, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.matrix.matrix2.Matrix.diagonal.inverse[11]>\", line 1, in <module>\n        ~M\n      File \"sage/matrix/matrix0.pyx\", line 5382, in sage.matrix.matrix0.Matrix.__invert__ (build/cythonized/sage/matrix/matrix0.c:36130)\n        A.echelonize()\n      File \"sage/matrix/matrix2.pyx\", line 6756, in sage.matrix.matrix2.Matrix.echelonize (build/cythonized/sage/matrix/matrix2.c:48757)\n        self._echelon_in_place(algorithm)\n      File \"sage/matrix/matrix2.pyx\", line 7076, in sage.matrix.matrix2.Matrix._echelon_in_place (build/cythonized/sage/matrix/matrix2.c:51166)\n        if abs_val > max_abs_val:\n    TypeError: '>' not supported between instances of 'int' and 'NoneType'\n```\nwith e4ab5738ca",
    "created_at": "2019-08-28T20:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529821",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:21'></a>
Still getting

```
File "src/sage/matrix/matrix2.pyx", line 8922, in sage.matrix.matrix2.Matrix.diagonal.inverse
Failed example:
    ~M
Exception raised:
    Traceback (most recent call last):
      File "/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.matrix.matrix2.Matrix.diagonal.inverse[11]>", line 1, in <module>
        ~M
      File "sage/matrix/matrix0.pyx", line 5382, in sage.matrix.matrix0.Matrix.__invert__ (build/cythonized/sage/matrix/matrix0.c:36130)
        A.echelonize()
      File "sage/matrix/matrix2.pyx", line 6756, in sage.matrix.matrix2.Matrix.echelonize (build/cythonized/sage/matrix/matrix2.c:48757)
        self._echelon_in_place(algorithm)
      File "sage/matrix/matrix2.pyx", line 7076, in sage.matrix.matrix2.Matrix._echelon_in_place (build/cythonized/sage/matrix/matrix2.c:51166)
        if abs_val > max_abs_val:
    TypeError: '>' not supported between instances of 'int' and 'NoneType'
```
with e4ab5738ca



---

archive/issue_comments_529822.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2019-08-28T20:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529822",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_events_068224.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-28T20:09:28Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27473#event-68224"
}
```



---

archive/issue_comments_529823.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2019-08-28T20:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529823",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_529824.json:
```json
{
    "body": "Changing branch from \"e4ab5738cadb95d2fa9cb912fa420c74d6deecba\" to \"u/kedlaya/e4ab5738cadb95d2fa9cb912fa420c74d6deecba\"",
    "created_at": "2019-08-28T22:08:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529824",
    "user": "https://github.com/kedlaya"
}
```

Changing branch from "e4ab5738cadb95d2fa9cb912fa420c74d6deecba" to "u/kedlaya/e4ab5738cadb95d2fa9cb912fa420c74d6deecba"



---

archive/issue_comments_529825.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-08-28T22:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529825",
    "user": "https://github.com/kedlaya"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_529826.json:
```json
{
    "body": "Changing commit from \"\" to \"d97e89ec2f56bf98d8d50ac5e748d39228dea245\"",
    "created_at": "2019-08-28T22:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529826",
    "user": "https://github.com/kedlaya"
}
```

Changing commit from "" to "d97e89ec2f56bf98d8d50ac5e748d39228dea245"



---

archive/issue_comments_529827.json:
```json
{
    "body": "<a id='comment:24'></a>\nThat looks like a Py3 issue. Let's see if patchbot likes this better.",
    "created_at": "2019-08-28T22:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529827",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:24'></a>
That looks like a Py3 issue. Let's see if patchbot likes this better.



---

archive/issue_comments_529828.json:
```json
{
    "body": "Changing branch from \"u/kedlaya/e4ab5738cadb95d2fa9cb912fa420c74d6deecba\" to \"public/ticket/27473\"",
    "created_at": "2019-08-29T07:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529828",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "u/kedlaya/e4ab5738cadb95d2fa9cb912fa420c74d6deecba" to "public/ticket/27473"



---

archive/issue_comments_529829.json:
```json
{
    "body": "Changing commit from \"d97e89ec2f56bf98d8d50ac5e748d39228dea245\" to \"5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44\"",
    "created_at": "2019-08-29T07:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529829",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "d97e89ec2f56bf98d8d50ac5e748d39228dea245" to "5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44"



---

archive/issue_comments_529830.json:
```json
{
    "body": "<a id='comment:25'></a>\nYou did something strange with your branch. I pushed a clean (and squashed) one instead, with the same fix for py3.\n\n---\nNew commits:\n|                                                                                                                                          |                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|\n|[268d9db](https://git.sagemath.org/sage.git/commit?id=268d9dbe8d6557964cadcc4810f0965bf3b8191a)|`Add algorithm scaled_partial_pivoting_valuation`|\n|[5fd44ec](https://git.sagemath.org/sage.git/commit?id=5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44)|`Make echelon use abs for discretely valued fields when possible`|",
    "created_at": "2019-08-29T07:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529830",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:25'></a>
You did something strange with your branch. I pushed a clean (and squashed) one instead, with the same fix for py3.

---
New commits:
|                                                                                                                                          |                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
|[268d9db](https://git.sagemath.org/sage.git/commit?id=268d9dbe8d6557964cadcc4810f0965bf3b8191a)|`Add algorithm scaled_partial_pivoting_valuation`|
|[5fd44ec](https://git.sagemath.org/sage.git/commit?id=5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44)|`Make echelon use abs for discretely valued fields when possible`|



---

archive/issue_comments_529831.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-29T09:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529831",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_529832.json:
```json
{
    "body": "<a id='comment:26'></a>\nthe py2 bot is green, and all tests pass on py3. I am setting this back to positive",
    "created_at": "2019-08-29T09:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529832",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:26'></a>
the py2 bot is green, and all tests pass on py3. I am setting this back to positive



---

archive/issue_comments_529833.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-09-02T21:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529833",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_068225.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-09-02T21:41:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27473#event-68225"
}
```



---

archive/issue_comments_529834.json:
```json
{
    "body": "Changing branch from \"public/ticket/27473\" to \"5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44\"",
    "created_at": "2019-09-02T21:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-529834",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/ticket/27473" to "5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44"
