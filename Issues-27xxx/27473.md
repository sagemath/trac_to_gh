# Issue 27473: Matrix inversion fails over a Laurent series ring

archive/issues_027236.json:
```json
{
    "body": "As of 8.7beta6, this works fine (note change from `adjoint` to `adjugate` as per #10501):\n\n```\nsage: R.<t> = LaurentSeriesRing(QQ)\nsage: M = t*identity_matrix(2)\nsage: M.adjugate() * ~M.det()\n[t^-1    0]\n[   0 t^-1]\n```\nbut this fails:\n\n```\nsage: ~M ## Shorthand for M.inverse(), which behaves the same way\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-53-6c551a35e6a8> in <module>()\n----> 1 ~M\n\n/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix0.pyx in sage.matrix.matrix0.Matrix.__invert__ (build/cythonized/sage/matrix/matrix0.c:36096)()\n   5380 \n   5381         A = self.augment(self.parent().identity_matrix())\n-> 5382         A.echelonize()\n   5383 \n   5384         # Now we want to make sure that B is of the form [I|X], in\n\n/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix2.pyx in sage.matrix.matrix2.Matrix.echelonize (build/cythonized/sage/matrix/matrix2.c:48296)()\n   6725             if self.base_ring().is_field():\n   6726                 if algorithm in ['classical', 'partial_pivoting', 'scaled_partial_pivoting']:\n-> 6727                     self._echelon_in_place(algorithm)\n   6728                 elif algorithm == 'strassen':\n   6729                     self._echelon_strassen(cutoff)\n\n/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix2.pyx in sage.matrix.matrix2.Matrix._echelon_in_place (build/cythonized/sage/matrix/matrix2.c:50128)()\n   7004                     scale_factor = 0\n   7005                     for c in range(nc):\n-> 7006                         abs_val = A.get_unsafe(r, c).abs()\n   7007                         if abs_val > scale_factor:\n   7008                             scale_factor = abs_val\n\n/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/structure/element.pyx in sage.structure.element.RingElement.abs (build/cythonized/sage/structure/element.c:18824)()\n   2718             ArithmeticError: absolute valued not defined on integers modulo n.\n   2719         \"\"\"\n-> 2720         return abs(self)\n   2721 \n   2722     def is_prime(self):\n\nTypeError: bad operand type for abs(): 'sage.rings.laurent_series_ring_element.LaurentSeries'\n```\nThis worked back in 8.2, so it must be a recent change that broke it.\n\n\nCC:  @roed314\n\nKeywords: matrix inversion, Laurent series\n\nBranch/Commit: 5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Kiran Kedlaya\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27473\n\n",
    "closed_at": "2019-09-02T21:41:21Z",
    "created_at": "2019-03-12T17:28:52Z",
    "labels": [
        "component: padics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Matrix inversion fails over a Laurent series ring",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27473",
    "user": "https://github.com/kedlaya"
}
```
As of 8.7beta6, this works fine (note change from `adjoint` to `adjugate` as per #10501):

```
sage: R.<t> = LaurentSeriesRing(QQ)
sage: M = t*identity_matrix(2)
sage: M.adjugate() * ~M.det()
[t^-1    0]
[   0 t^-1]
```
but this fails:

```
sage: ~M ## Shorthand for M.inverse(), which behaves the same way
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-53-6c551a35e6a8> in <module>()
----> 1 ~M

/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix0.pyx in sage.matrix.matrix0.Matrix.__invert__ (build/cythonized/sage/matrix/matrix0.c:36096)()
   5380 
   5381         A = self.augment(self.parent().identity_matrix())
-> 5382         A.echelonize()
   5383 
   5384         # Now we want to make sure that B is of the form [I|X], in

/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix2.pyx in sage.matrix.matrix2.Matrix.echelonize (build/cythonized/sage/matrix/matrix2.c:48296)()
   6725             if self.base_ring().is_field():
   6726                 if algorithm in ['classical', 'partial_pivoting', 'scaled_partial_pivoting']:
-> 6727                     self._echelon_in_place(algorithm)
   6728                 elif algorithm == 'strassen':
   6729                     self._echelon_strassen(cutoff)

/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/matrix/matrix2.pyx in sage.matrix.matrix2.Matrix._echelon_in_place (build/cythonized/sage/matrix/matrix2.c:50128)()
   7004                     scale_factor = 0
   7005                     for c in range(nc):
-> 7006                         abs_val = A.get_unsafe(r, c).abs()
   7007                         if abs_val > scale_factor:
   7008                             scale_factor = abs_val

/home/kedlaya/sage/local/lib/python3.6/site-packages/sage/structure/element.pyx in sage.structure.element.RingElement.abs (build/cythonized/sage/structure/element.c:18824)()
   2718             ArithmeticError: absolute valued not defined on integers modulo n.
   2719         """
-> 2720         return abs(self)
   2721 
   2722     def is_prime(self):

TypeError: bad operand type for abs(): 'sage.rings.laurent_series_ring_element.LaurentSeries'
```
This worked back in 8.2, so it must be a recent change that broke it.


CC:  @roed314

Keywords: matrix inversion, Laurent series

Branch/Commit: 5fd44ec1d5a5cfd5b10a8c64e23da28accf9eb44

Reviewer: Frédéric Chapoton

Author: Kiran Kedlaya

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27473





---

archive/issue_comments_408655.json:
```json
{
    "body": "<a id='comment:1'></a>The error comes from:\n\n```\nM.echelonize('scaled_partial_pivoting')\n```\nIt seems to be assumed that rings in `DiscreteValuationFields` have an `abs` method.",
    "created_at": "2019-03-12T19:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408655",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>The error comes from:

```
M.echelonize('scaled_partial_pivoting')
```
It seems to be assumed that rings in `DiscreteValuationFields` have an `abs` method.



---

archive/issue_comments_408656.json:
```json
{
    "body": "<a id='comment:2'></a>... which of course they can have, but it's probably better to program the partial pivoting using the valuation directly. The definition of `abs` would be `lambda self: (self.is_zero()) select 0 else 2**(-self.valuation())` or something similar, and is a very inefficient way of representing the valuation. So we probably need a  `scaled_partial_pivoting_absvalue` and a `scaled_partial_pivoting_valuation`.",
    "created_at": "2019-03-13T06:00:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408656",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:2'></a>... which of course they can have, but it's probably better to program the partial pivoting using the valuation directly. The definition of `abs` would be `lambda self: (self.is_zero()) select 0 else 2**(-self.valuation())` or something similar, and is a very inefficient way of representing the valuation. So we probably need a  `scaled_partial_pivoting_absvalue` and a `scaled_partial_pivoting_valuation`.



---

archive/issue_events_068220.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27473#event-68220"
}
```



---

archive/issue_comments_408657.json:
```json
{
    "body": "<a id='comment:3'></a>Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408657",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_408658.json:
```json
{
    "body": "<a id='comment:4'></a>As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408658",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_events_068221.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:55:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27473#event-68221"
}
```



---

archive/issue_comments_408659.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-08-16T02:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408659",
    "user": "https://github.com/kedlaya"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_408660.json:
```json
{
    "body": "<a id='comment:6'></a>I followed nbruin's suggestion and added an algorithm `scaled_partial_pivoting_valuation`. This shouldn't cause any side effects, but one should be careful when messing with core linear algebra.\n\n---\nNew commits:",
    "created_at": "2019-08-16T02:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408660",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:6'></a>I followed nbruin's suggestion and added an algorithm `scaled_partial_pivoting_valuation`. This shouldn't cause any side effects, but one should be careful when messing with core linear algebra.

---
New commits:



---

archive/issue_comments_408661.json:
```json
{
    "body": "<a id='comment:7'></a>I see some failing doctests, so let me pull this until I have a chance to check these out.",
    "created_at": "2019-08-16T02:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408661",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:7'></a>I see some failing doctests, so let me pull this until I have a chance to check these out.



---

archive/issue_comments_408662.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-08-16T02:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408662",
    "user": "https://github.com/kedlaya"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_408663.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-16T03:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408663",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408664.json:
```json
{
    "body": "<a id='comment:9'></a>The first commit broke a bunch of doctests involving matrices over p-adic fields. In principle it should be possible to fix this, but it is far easier to simply short-circuit the echelon code so that it uses `abs` even for discretely valued field unless the field does not support it, in which case we switch to valuation. The latest commit implements this, but I want to rerun all doctests before changing status again.",
    "created_at": "2019-08-16T03:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408664",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:9'></a>The first commit broke a bunch of doctests involving matrices over p-adic fields. In principle it should be possible to fix this, but it is far easier to simply short-circuit the echelon code so that it uses `abs` even for discretely valued field unless the field does not support it, in which case we switch to valuation. The latest commit implements this, but I want to rerun all doctests before changing status again.



---

archive/issue_comments_408665.json:
```json
{
    "body": "Changing keywords from \"\" to \"matrix inversion, Laurent series\".",
    "created_at": "2019-08-16T06:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408665",
    "user": "https://github.com/kedlaya"
}
```

Changing keywords from "" to "matrix inversion, Laurent series".



---

archive/issue_comments_408666.json:
```json
{
    "body": "<a id='comment:10'></a>I completed a run of doctests, so let's put this back up for review.",
    "created_at": "2019-08-16T06:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408666",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:10'></a>I completed a run of doctests, so let's put this back up for review.



---

archive/issue_comments_408667.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-08-16T06:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408667",
    "user": "https://github.com/kedlaya"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_408668.json:
```json
{
    "body": "<a id='comment:11'></a>I would try \"ring.one().abs\" instead of \"abs(ring.one())\" and then catch `AttributeError`.\n\nWrong doc here:\n\n```\n+          - ``'scaled_partial_pivoting_valuation'``: Gauss elimination, using scaled\n+            partial pivoting (if base ring has absolute value)\n```\n\nOtherwise, looks good.",
    "created_at": "2019-08-20T18:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408668",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>I would try "ring.one().abs" instead of "abs(ring.one())" and then catch `AttributeError`.

Wrong doc here:

```
+          - ``'scaled_partial_pivoting_valuation'``: Gauss elimination, using scaled
+            partial pivoting (if base ring has absolute value)
```

Otherwise, looks good.



---

archive/issue_comments_408669.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-20T23:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408669",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408670.json:
```json
{
    "body": "<a id='comment:13'></a>Latest commit makes the change regarding `abs`. Regarding the doc, I fixed the line overrun; but was there also another issue?",
    "created_at": "2019-08-20T23:28:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408670",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:13'></a>Latest commit makes the change regarding `abs`. Regarding the doc, I fixed the line overrun; but was there also another issue?



---

archive/issue_comments_408671.json:
```json
{
    "body": "<a id='comment:14'></a>You did not fix the correct doc lines. The one I talk about is a little bit below, and contains the word \"absolute value\", instead of the correct \"valuation\".",
    "created_at": "2019-08-21T06:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408671",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>You did not fix the correct doc lines. The one I talk about is a little bit below, and contains the word "absolute value", instead of the correct "valuation".



---

archive/issue_comments_408672.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-21T14:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408672",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408673.json:
```json
{
    "body": "<a id='comment:16'></a>There is a failure in src/sage/matrix/matrix2.pyx : you need to catch `TypeError` in the check for abs.",
    "created_at": "2019-08-24T11:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408673",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>There is a failure in src/sage/matrix/matrix2.pyx : you need to catch `TypeError` in the check for abs.



---

archive/issue_comments_408674.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-24T18:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408674",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408675.json:
```json
{
    "body": "<a id='comment:18'></a>ok, let it be. Thanks",
    "created_at": "2019-08-25T05:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408675",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>ok, let it be. Thanks



---

archive/issue_comments_408676.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-25T05:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408676",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_068222.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-08-25T19:51:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27473#event-68222"
}
```



---

archive/issue_comments_408677.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-08-26T22:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408677",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_068223.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-26T22:15:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27473#event-68223"
}
```



---

archive/issue_comments_408678.json:
```json
{
    "body": "<a id='comment:21'></a>Still getting\n\n```\nFile \"src/sage/matrix/matrix2.pyx\", line 8922, in sage.matrix.matrix2.Matrix.diagonal.inverse\nFailed example:\n    ~M\nException raised:\n    Traceback (most recent call last):\n      File \"/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1105, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.matrix.matrix2.Matrix.diagonal.inverse[11]>\", line 1, in <module>\n        ~M\n      File \"sage/matrix/matrix0.pyx\", line 5382, in sage.matrix.matrix0.Matrix.__invert__ (build/cythonized/sage/matrix/matrix0.c:36130)\n        A.echelonize()\n      File \"sage/matrix/matrix2.pyx\", line 6756, in sage.matrix.matrix2.Matrix.echelonize (build/cythonized/sage/matrix/matrix2.c:48757)\n        self._echelon_in_place(algorithm)\n      File \"sage/matrix/matrix2.pyx\", line 7076, in sage.matrix.matrix2.Matrix._echelon_in_place (build/cythonized/sage/matrix/matrix2.c:51166)\n        if abs_val > max_abs_val:\n    TypeError: '>' not supported between instances of 'int' and 'NoneType'\n```\nwith e4ab5738ca",
    "created_at": "2019-08-28T20:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408678",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:21'></a>Still getting

```
File "src/sage/matrix/matrix2.pyx", line 8922, in sage.matrix.matrix2.Matrix.diagonal.inverse
Failed example:
    ~M
Exception raised:
    Traceback (most recent call last):
      File "/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/var/lib/buildbot/slave/sage3_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.matrix.matrix2.Matrix.diagonal.inverse[11]>", line 1, in <module>
        ~M
      File "sage/matrix/matrix0.pyx", line 5382, in sage.matrix.matrix0.Matrix.__invert__ (build/cythonized/sage/matrix/matrix0.c:36130)
        A.echelonize()
      File "sage/matrix/matrix2.pyx", line 6756, in sage.matrix.matrix2.Matrix.echelonize (build/cythonized/sage/matrix/matrix2.c:48757)
        self._echelon_in_place(algorithm)
      File "sage/matrix/matrix2.pyx", line 7076, in sage.matrix.matrix2.Matrix._echelon_in_place (build/cythonized/sage/matrix/matrix2.c:51166)
        if abs_val > max_abs_val:
    TypeError: '>' not supported between instances of 'int' and 'NoneType'
```
with e4ab5738ca



---

archive/issue_comments_408679.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2019-08-28T20:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408679",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_events_068224.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-28T20:09:28Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27473#event-68224"
}
```



---

archive/issue_comments_408680.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2019-08-28T20:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408680",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_408681.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-08-28T22:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408681",
    "user": "https://github.com/kedlaya"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_408682.json:
```json
{
    "body": "<a id='comment:24'></a>That looks like a Py3 issue. Let's see if patchbot likes this better.",
    "created_at": "2019-08-28T22:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408682",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:24'></a>That looks like a Py3 issue. Let's see if patchbot likes this better.



---

archive/issue_comments_408683.json:
```json
{
    "body": "<a id='comment:25'></a>You did something strange with your branch. I pushed a clean (and squashed) one instead, with the same fix for py3.\n\n---\nNew commits:",
    "created_at": "2019-08-29T07:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408683",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:25'></a>You did something strange with your branch. I pushed a clean (and squashed) one instead, with the same fix for py3.

---
New commits:



---

archive/issue_comments_408684.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-29T09:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408684",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_408685.json:
```json
{
    "body": "<a id='comment:26'></a>the py2 bot is green, and all tests pass on py3. I am setting this back to positive",
    "created_at": "2019-08-29T09:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408685",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:26'></a>the py2 bot is green, and all tests pass on py3. I am setting this back to positive



---

archive/issue_comments_408686.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-09-02T21:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27473#issuecomment-408686",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_068225.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-09-02T21:41:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27473",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27473#event-68225"
}
```
