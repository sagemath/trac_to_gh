# Issue 27476: Add patch to zn_poly for support for Python 2.6

archive/issues_027239.json:
```json
{
    "assignees": [],
    "body": "We change the string `format()` calls in `makemakefile.py` to be the explicit `{0}` instead of `{}` to support Python 2.6.\n\n[Upstream merge request](https://gitlab.com/sagemath/zn_poly/merge_requests/3)\n\nUpstream: **Fixed upstream, but not in a stable release.**\n\nCC:  @jdemeyer @embray\n\nComponent: **packages: standard**\n\nAuthor: **Travis Scrimshaw**\n\nBranch: **[`af21bf9`](https://github.com/sagemath/sagetrac-mirror/commit/af21bf9e00c64bc673b88a6d50a140489a2031d0)**\n\nReviewer: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27476_\n\n",
    "closed_at": "2019-03-15T08:09:34Z",
    "created_at": "2019-03-12T23:12:41Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add patch to zn_poly for support for Python 2.6",
    "type": "issue",
    "updated_at": "2019-08-04T14:39:17Z",
    "url": "https://github.com/sagemath/sage/issues/27476",
    "user": "https://github.com/tscrim"
}
```
We change the string `format()` calls in `makemakefile.py` to be the explicit `{0}` instead of `{}` to support Python 2.6.

[Upstream merge request](https://gitlab.com/sagemath/zn_poly/merge_requests/3)

Upstream: **Fixed upstream, but not in a stable release.**

CC:  @jdemeyer @embray

Component: **packages: standard**

Author: **Travis Scrimshaw**

Branch: **[`af21bf9`](https://github.com/sagemath/sagetrac-mirror/commit/af21bf9e00c64bc673b88a6d50a140489a2031d0)**

Reviewer: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/27476_





---

archive/issue_events_374360.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-12T23:12:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27476#event-374360"
}
```



---

archive/issue_events_374361.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-12T23:12:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27476#event-374361"
}
```



---

archive/issue_events_374362.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-12T23:12:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27476#event-374362"
}
```



---

archive/issue_events_374363.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-12T23:12:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27476#event-374363"
}
```



---

archive/issue_comments_425140.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af21bf9e00c64bc673b88a6d50a140489a2031d0\"><code>af21bf9</code></a></td><td><code>Adding patch to zn_poly for Python 2.6 support.</code></td></tr></table>\n",
    "created_at": "2019-03-12T23:13:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425140",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af21bf9e00c64bc673b88a6d50a140489a2031d0"><code>af21bf9</code></a></td><td><code>Adding patch to zn_poly for Python 2.6 support.</code></td></tr></table>




---

archive/issue_events_374364.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-12T23:13:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27476#event-374364"
}
```



---

archive/issue_comments_425141.json:
```json
{
    "body": "Commit: **[`af21bf9`](https://github.com/sagemath/sagetrac-mirror/commit/af21bf9e00c64bc673b88a6d50a140489a2031d0)**",
    "created_at": "2019-03-12T23:13:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425141",
    "user": "https://github.com/tscrim"
}
```

Commit: **[`af21bf9`](https://github.com/sagemath/sagetrac-mirror/commit/af21bf9e00c64bc673b88a6d50a140489a2031d0)**



---

archive/issue_comments_425142.json:
```json
{
    "body": "Branch: **[public/packaging/zn_poly_python_2_6_support-27476](https://github.com/sagemath/sagetrac-mirror/tree/public/packaging/zn_poly_python_2_6_support-27476)**",
    "created_at": "2019-03-12T23:13:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425142",
    "user": "https://github.com/tscrim"
}
```

Branch: **[public/packaging/zn_poly_python_2_6_support-27476](https://github.com/sagemath/sagetrac-mirror/tree/public/packaging/zn_poly_python_2_6_support-27476)**



---

archive/issue_comments_425143.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n We change the string `format()` calls in `makemakefile.py` to be the explicit `{0}` instead of `{}` to support Python 2.6.\n+\n+[Upstream merge request](https://gitlab.com/sagemath/zn_poly/merge_requests/3)\n``````\n",
    "created_at": "2019-03-12T23:35:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425143",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 We change the string `format()` calls in `makemakefile.py` to be the explicit `{0}` instead of `{}` to support Python 2.6.
+
+[Upstream merge request](https://gitlab.com/sagemath/zn_poly/merge_requests/3)
``````




---

archive/issue_comments_425144.json:
```json
{
    "body": "Upstream: **Fixed upstream, but not in a stable release.**",
    "created_at": "2019-03-12T23:35:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425144",
    "user": "https://github.com/tscrim"
}
```

Upstream: **Fixed upstream, but not in a stable release.**



---

archive/issue_comments_425145.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nTravis, can you please confirm that this actually works with Python 2.6?",
    "created_at": "2019-03-13T06:44:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425145",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

Travis, can you please confirm that this actually works with Python 2.6?



---

archive/issue_comments_425146.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nYes, I rebuilt it on my university's cluster.",
    "created_at": "2019-03-13T07:08:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425146",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:4" align="right">comment:4</div>

Yes, I rebuilt it on my university's cluster.



---

archive/issue_comments_425147.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI also built it on a different machine that also did not have Python 2.7.",
    "created_at": "2019-03-14T02:26:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425147",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

I also built it on a different machine that also did not have Python 2.7.



---

archive/issue_events_374365.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-14T09:00:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27476#event-374365"
}
```



---

archive/issue_events_374366.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-14T09:00:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27476#event-374366"
}
```



---

archive/issue_comments_425148.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2019-03-14T09:00:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425148",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_374367.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-15T08:09:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27476#event-374367"
}
```



---

archive/issue_events_374368.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "56d6b08c80f2b3ab4ae03c62d3911680a1e8346b",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-03-15T08:09:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27476#event-374368"
}
```



---

archive/issue_comments_425149.json:
```json
{
    "body": "Changed branch from **[public/packaging/zn_poly_python_2_6_support-27476](https://github.com/sagemath/sagetrac-mirror/tree/public/packaging/zn_poly_python_2_6_support-27476)** to **[`af21bf9`](https://github.com/sagemath/sagetrac-mirror/commit/af21bf9e00c64bc673b88a6d50a140489a2031d0)**",
    "created_at": "2019-03-15T08:09:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425149",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/packaging/zn_poly_python_2_6_support-27476](https://github.com/sagemath/sagetrac-mirror/tree/public/packaging/zn_poly_python_2_6_support-27476)** to **[`af21bf9`](https://github.com/sagemath/sagetrac-mirror/commit/af21bf9e00c64bc673b88a6d50a140489a2031d0)**



---

archive/issue_comments_425150.json:
```json
{
    "body": "Changed commit from **[`af21bf9`](https://github.com/sagemath/sagetrac-mirror/commit/af21bf9e00c64bc673b88a6d50a140489a2031d0)** to none",
    "created_at": "2019-03-20T08:37:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425150",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`af21bf9`](https://github.com/sagemath/sagetrac-mirror/commit/af21bf9e00c64bc673b88a6d50a140489a2031d0)** to none



---

archive/issue_comments_425151.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThis breaks the build with python3 on my machine, apparently.\n\n```\n[zn_poly-0.9.1.p0] Setting up build directory for zn_poly-0.9.1.p0\n[zn_poly-0.9.1.p0] Finished extraction\n[zn_poly-0.9.1.p0] Applying patches from ../patches...\n[zn_poly-0.9.1.p0] Applying ../patches/python_2_6_format_support.patch\n[zn_poly-0.9.1.p0] patching file makemakefile.py\n[zn_poly-0.9.1.p0] Hunk #1 FAILED at 151.\n[zn_poly-0.9.1.p0] Hunk #2 FAILED at 161.\n[zn_poly-0.9.1.p0] Hunk #3 FAILED at 177.\n[zn_poly-0.9.1.p0] Hunk #4 FAILED at 205.\n[zn_poly-0.9.1.p0] 4 out of 4 hunks FAILED -- saving rejects to file makemakefile.py.rej\n[zn_poly-0.9.1.p0] Error applying '../patches/python_2_6_format_support.patch'\n```\nEDIT: maybe a conflict between patches with `build/pkgs/zn_poly/patches/python3.patch`",
    "created_at": "2019-03-20T08:37:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425151",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:8" align="right">comment:8</div>

This breaks the build with python3 on my machine, apparently.

```
[zn_poly-0.9.1.p0] Setting up build directory for zn_poly-0.9.1.p0
[zn_poly-0.9.1.p0] Finished extraction
[zn_poly-0.9.1.p0] Applying patches from ../patches...
[zn_poly-0.9.1.p0] Applying ../patches/python_2_6_format_support.patch
[zn_poly-0.9.1.p0] patching file makemakefile.py
[zn_poly-0.9.1.p0] Hunk #1 FAILED at 151.
[zn_poly-0.9.1.p0] Hunk #2 FAILED at 161.
[zn_poly-0.9.1.p0] Hunk #3 FAILED at 177.
[zn_poly-0.9.1.p0] Hunk #4 FAILED at 205.
[zn_poly-0.9.1.p0] 4 out of 4 hunks FAILED -- saving rejects to file makemakefile.py.rej
[zn_poly-0.9.1.p0] Error applying '../patches/python_2_6_format_support.patch'
```
EDIT: maybe a conflict between patches with `build/pkgs/zn_poly/patches/python3.patch`



---

archive/issue_comments_425152.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nBuilding with Python 2 or Python 3 wouldn't make any difference in that: The patches are applied the same way to the same sources either way, and Python doesn't enter into it.",
    "created_at": "2019-03-20T08:42:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425152",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

Building with Python 2 or Python 3 wouldn't make any difference in that: The patches are applied the same way to the same sources either way, and Python doesn't enter into it.



---

archive/issue_comments_425153.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nSo any other idea ?",
    "created_at": "2019-03-20T08:43:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425153",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:10" align="right">comment:10</div>

So any other idea ?



---

archive/issue_comments_425154.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThe python3 builds works on another machine..",
    "created_at": "2019-03-20T08:45:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425154",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:11" align="right">comment:11</div>

The python3 builds works on another machine..



---

archive/issue_comments_425155.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@fchapoton](#comment%3A10):\n> So any other idea ? \n\nDo you happen to have patched `zn_poly` yourself? What does `git status` say?",
    "created_at": "2019-03-20T09:11:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425155",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@fchapoton](#comment%3A10):
> So any other idea ? 

Do you happen to have patched `zn_poly` yourself? What does `git status` say?



---

archive/issue_comments_425156.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nLet's see what the release manager says...",
    "created_at": "2019-03-20T09:13:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425156",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Let's see what the release manager says...



---

archive/issue_comments_425157.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@fchapoton](#comment%3A10):\n> So any other idea ? \n\nIt worked fine on my python3 build:\n\n```\n[zn_poly-0.9.1.p0] Found local metadata for zn_poly-0.9.1.p0\n[zn_poly-0.9.1.p0] Using cached file /home/embray/src/sagemath/sage-python3/upstream/zn_poly-0.9.1.tar.gz\n[zn_poly-0.9.1.p0] zn_poly-0.9.1.p0\n[zn_poly-0.9.1.p0] ====================================================\n[zn_poly-0.9.1.p0] Setting up build directory for zn_poly-0.9.1.p0\n[zn_poly-0.9.1.p0] Finished extraction\n[zn_poly-0.9.1.p0] Applying patches from ../patches...\n[zn_poly-0.9.1.p0] Applying ../patches/python3.patch\n[zn_poly-0.9.1.p0] patching file makemakefile.py\n[zn_poly-0.9.1.p0] Applying ../patches/python_2_6_format_support.patch\n[zn_poly-0.9.1.p0] patching file makemakefile.py\n[zn_poly-0.9.1.p0] ****************************************************\n```\n\nIn your log snippet it didn't show `Applying ../patches/python3.patch` first.  Was it present?  I wonder if it's possible t was missing for you somehow, or if the patches were being applied in a different order.",
    "created_at": "2019-03-20T09:19:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425157",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@fchapoton](#comment%3A10):
> So any other idea ? 

It worked fine on my python3 build:

```
[zn_poly-0.9.1.p0] Found local metadata for zn_poly-0.9.1.p0
[zn_poly-0.9.1.p0] Using cached file /home/embray/src/sagemath/sage-python3/upstream/zn_poly-0.9.1.tar.gz
[zn_poly-0.9.1.p0] zn_poly-0.9.1.p0
[zn_poly-0.9.1.p0] ====================================================
[zn_poly-0.9.1.p0] Setting up build directory for zn_poly-0.9.1.p0
[zn_poly-0.9.1.p0] Finished extraction
[zn_poly-0.9.1.p0] Applying patches from ../patches...
[zn_poly-0.9.1.p0] Applying ../patches/python3.patch
[zn_poly-0.9.1.p0] patching file makemakefile.py
[zn_poly-0.9.1.p0] Applying ../patches/python_2_6_format_support.patch
[zn_poly-0.9.1.p0] patching file makemakefile.py
[zn_poly-0.9.1.p0] ****************************************************
```

In your log snippet it didn't show `Applying ../patches/python3.patch` first.  Was it present?  I wonder if it's possible t was missing for you somehow, or if the patches were being applied in a different order.



---

archive/issue_comments_425158.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI have not patched zn_poly myself.\n\nThe python3 patch is not present in my log snippet, indeed. How is the order of patches determined ?\n\nEDIT: the python3 patch is present in the patches subdirectory\n\nEDIT: monkey-skipping the patch-apply failure, the build of zn_poly works..",
    "created_at": "2019-03-20T09:38:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425158",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:15" align="right">comment:15</div>

I have not patched zn_poly myself.

The python3 patch is not present in my log snippet, indeed. How is the order of patches determined ?

EDIT: the python3 patch is present in the patches subdirectory

EDIT: monkey-skipping the patch-apply failure, the build of zn_poly works..



---

archive/issue_comments_425159.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThere *is* something strange going on here I think.  Alphanumerically, python3 should come before python_2_6_format_patch since ascii '3' is less than ascii '_'.  \n\nAnd indeed, when I run `./sage -f zn_poly` any number of times it always applies these patches in the correct order.  But if I manually cd into the build directory and run `sage-apply-patches` it applies them in the wrong order.  Maybe a shell option somewhere?",
    "created_at": "2019-03-20T10:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425159",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">comment:16</div>

There *is* something strange going on here I think.  Alphanumerically, python3 should come before python_2_6_format_patch since ascii '3' is less than ascii '_'.  

And indeed, when I run `./sage -f zn_poly` any number of times it always applies these patches in the correct order.  But if I manually cd into the build directory and run `sage-apply-patches` it applies them in the wrong order.  Maybe a shell option somewhere?



---

archive/issue_comments_425160.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nYou might want to check your `LC_COLLATE` environment variable, or possibly other related LC_ variables.  To be in the safe side it might be best if `sage-apply-patches` explicitly called `sort` over the patches.",
    "created_at": "2019-03-20T10:18:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425160",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">comment:17</div>

You might want to check your `LC_COLLATE` environment variable, or possibly other related LC_ variables.  To be in the safe side it might be best if `sage-apply-patches` explicitly called `sort` over the patches.



---

archive/issue_comments_425161.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@jdemeyer](#comment%3A13):\n> Let's see what the release manager says...\n\nThis is already merged (I missed that) so it passes on the buildbot...",
    "created_at": "2019-03-20T10:41:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425161",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@jdemeyer](#comment%3A13):
> Let's see what the release manager says...

This is already merged (I missed that) so it passes on the buildbot...



---

archive/issue_comments_425162.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nTry this patch and see if it fixes for you.  If so, we'll make a ticket for it\n\n```diff\ndiff --git a/build/bin/sage-apply-patches b/build/bin/sage-apply-patches\nindex 522116e..88d0601 100755\n--- a/build/bin/sage-apply-patches\n+++ b/build/bin/sage-apply-patches\n@@ -57,6 +57,11 @@ while [[ $# > 0 ]]; do\n     shift\n done\n\n+# The locale can have some strange effects on how filename are sorted depending\n+# on the LC_COLLATE variable, so ensure that it's \"C\" (basically ASCII order)\n+# so that patches are applied in a sensible roder\n+export LC_COLLATE=\"C\"\n+\n patchdir=\"${patchdir}/${patch_subdir}\"\n patchdir=\"${patchdir%/}\"\n patches=( \"${patchdir}\"/*.patch )\n```",
    "created_at": "2019-03-20T10:45:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425162",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">comment:19</div>

Try this patch and see if it fixes for you.  If so, we'll make a ticket for it

```diff
diff --git a/build/bin/sage-apply-patches b/build/bin/sage-apply-patches
index 522116e..88d0601 100755
--- a/build/bin/sage-apply-patches
+++ b/build/bin/sage-apply-patches
@@ -57,6 +57,11 @@ while [[ $# > 0 ]]; do
     shift
 done

+# The locale can have some strange effects on how filename are sorted depending
+# on the LC_COLLATE variable, so ensure that it's "C" (basically ASCII order)
+# so that patches are applied in a sensible roder
+export LC_COLLATE="C"
+
 patchdir="${patchdir}/${patch_subdir}"
 patchdir="${patchdir%/}"
 patches=( "${patchdir}"/*.patch )
```



---

archive/issue_comments_425163.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nAnother option might be to combine the two patches into 1 so there is no possibility of conflicts due to ordering.",
    "created_at": "2019-03-20T10:47:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425163",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:20" align="right">comment:20</div>

Another option might be to combine the two patches into 1 so there is no possibility of conflicts due to ordering.



---

archive/issue_comments_425164.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThere is no LC_COLLATE variable in this machine bash configuration. I get very standard\n\n```\n~$ echo $LC_ALL \nen_US.UTF-8\n~$ echo $LANG\nen_US.UTF-8\n```\nand\n\n```\n~$ lsb_release -a \nNo LSB modules are available.\nDistributor ID:\tUbuntu\nDescription:\tUbuntu 16.04.5 LTS\nRelease:\t16.04\nCodename:\txenial\n```",
    "created_at": "2019-03-20T12:40:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425164",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:21" align="right">comment:21</div>

There is no LC_COLLATE variable in this machine bash configuration. I get very standard

```
~$ echo $LC_ALL 
en_US.UTF-8
~$ echo $LANG
en_US.UTF-8
```
and

```
~$ lsb_release -a 
No LSB modules are available.
Distributor ID:	Ubuntu
Description:	Ubuntu 16.04.5 LTS
Release:	16.04
Codename:	xenial
```



---

archive/issue_comments_425165.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nNew ticket, guys",
    "created_at": "2019-03-20T14:40:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425165",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:22" align="right">comment:22</div>

New ticket, guys



---

archive/issue_comments_425166.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI made #28322 for the patch-related problem.",
    "created_at": "2019-08-04T14:39:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27476#issuecomment-425166",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:23" align="right">comment:23</div>

I made #28322 for the patch-related problem.
