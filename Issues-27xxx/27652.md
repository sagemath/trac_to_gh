# Issue 27652: parent of plethysm

archive/issues_027415.json:
```json
{
    "body": "CC:  @zabrocki\n\nKeywords: conversion\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27652\n\n",
    "closed_at": "2022-12-11T11:11:48Z",
    "created_at": "2019-04-12T05:38:52Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "parent of plethysm",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27652",
    "user": "https://github.com/mantepse"
}
```
CC:  @zabrocki

Keywords: conversion



Issue created by migration from https://trac.sagemath.org/ticket/27652





---

archive/issue_comments_386071.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2019-04-12T08:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386071",
    "user": "https://github.com/mantepse"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_386072.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-04-12T08:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386072",
    "user": "https://github.com/mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_386073.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-04-12T08:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386073",
    "user": "https://github.com/mantepse"
}
```

New commits:



---

archive/issue_comments_386074.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2019-04-12T08:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386074",
    "user": "https://github.com/mantepse"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_386075.json:
```json
{
    "body": "Can you explain why you would do this?  It seems wrong to me.\n\n```\nsage: s[2,1](p[1]+1)\ns[1] + s[1, 1] + s[2] + s[2, 1]\nsage: s[2,1](tensor([p[1],p[1]]))\n1/3*p[1, 1, 1] # p[1, 1, 1] - 1/3*p[3] # p[3]\n```",
    "created_at": "2019-04-15T14:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386075",
    "user": "https://github.com/zabrocki"
}
```

Can you explain why you would do this?  It seems wrong to me.

```
sage: s[2,1](p[1]+1)
s[1] + s[1, 1] + s[2] + s[2, 1]
sage: s[2,1](tensor([p[1],p[1]]))
1/3*p[1, 1, 1] # p[1, 1, 1] - 1/3*p[3] # p[3]
```



---

archive/issue_comments_386076.json:
```json
{
    "body": "I have two reasons:\n\n1.) the result of plethysm with a tensor is a tensor.\n\n2.) I have a class that inherits from `CombinatorialFreeModule_Tensor`.  Essentially, it is a parent for tensor products of symmetric functions, with some extra methods.  I want that plethysm with an element from this class works.  It almost does, except that the result is then a tensor product, and not an element from my class.\n\nTo elaborate on 2., here is my code.  (The `tensor_constructor` method works around another thing, which I think is a bug.)\n\n```\n\"\"\"\nsage: S = SymmetricFunctions(QQ)\nsage: S.inject_shorthands()\nsage: t = tensor([s[1,1], h[2]])\nsage: P = TwoPositions(S.s(), S.h())\nsage: x = P(t)\nsage: 2*x\nsage: h[2](x)\n\"\"\"\ndef from_ch_characters(t):\n    P = TwoPositions(*t.parent()._sets)\n    return P(t)\n\nclass TwoPositionsElement(CombinatorialFreeModule_Tensor.Element):\n    pass\n\n\nfrom sage.combinat.free_module import CombinatorialFreeModule_Tensor, CartesianProductWithFlattening\nclass TwoPositions(CombinatorialFreeModule_Tensor):\n    def __init__(self, *modules):\n        cat = HopfAlgebrasWithBasis(QQ).TensorProducts()\n        CombinatorialFreeModule_Tensor.__init__(self,\n                                                modules,\n                                                category = cat)\n\n    @cached_method\n    def tensor_constructor(self, modules):\n        assert(module in ModulesWithBasis(self.base_ring()) for module in modules)\n        # assert(tensor(modules) == self)\n        # a list l such that l[i] is True if modules[i] is readily a tensor product\n        is_tensor = [isinstance(module, CombinatorialFreeModule_Tensor) for module in modules]\n        # the tensor_constructor, on basis elements\n        result = self.monomial * CartesianProductWithFlattening(is_tensor) #.\n        # TODO: make this into an element of Hom( A x B, C ) when those will exist\n        for i in range(0, len(modules)):\n            result = modules[i]._module_morphism(result, position = i, codomain = self)\n        return result\n\n    def __repr__(self):\n        return \"TwoPositions in %s\"%(self._sets,)\n\n    Element = TwoPositionsElement\n```",
    "created_at": "2019-04-15T15:34:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386076",
    "user": "https://github.com/mantepse"
}
```

I have two reasons:

1.) the result of plethysm with a tensor is a tensor.

2.) I have a class that inherits from `CombinatorialFreeModule_Tensor`.  Essentially, it is a parent for tensor products of symmetric functions, with some extra methods.  I want that plethysm with an element from this class works.  It almost does, except that the result is then a tensor product, and not an element from my class.

To elaborate on 2., here is my code.  (The `tensor_constructor` method works around another thing, which I think is a bug.)

```
"""
sage: S = SymmetricFunctions(QQ)
sage: S.inject_shorthands()
sage: t = tensor([s[1,1], h[2]])
sage: P = TwoPositions(S.s(), S.h())
sage: x = P(t)
sage: 2*x
sage: h[2](x)
"""
def from_ch_characters(t):
    P = TwoPositions(*t.parent()._sets)
    return P(t)

class TwoPositionsElement(CombinatorialFreeModule_Tensor.Element):
    pass


from sage.combinat.free_module import CombinatorialFreeModule_Tensor, CartesianProductWithFlattening
class TwoPositions(CombinatorialFreeModule_Tensor):
    def __init__(self, *modules):
        cat = HopfAlgebrasWithBasis(QQ).TensorProducts()
        CombinatorialFreeModule_Tensor.__init__(self,
                                                modules,
                                                category = cat)

    @cached_method
    def tensor_constructor(self, modules):
        assert(module in ModulesWithBasis(self.base_ring()) for module in modules)
        # assert(tensor(modules) == self)
        # a list l such that l[i] is True if modules[i] is readily a tensor product
        is_tensor = [isinstance(module, CombinatorialFreeModule_Tensor) for module in modules]
        # the tensor_constructor, on basis elements
        result = self.monomial * CartesianProductWithFlattening(is_tensor) #.
        # TODO: make this into an element of Hom( A x B, C ) when those will exist
        for i in range(0, len(modules)):
            result = modules[i]._module_morphism(result, position = i, codomain = self)
        return result

    def __repr__(self):
        return "TwoPositions in %s"%(self._sets,)

    Element = TwoPositionsElement
```



---

archive/issue_comments_386077.json:
```json
{
    "body": "A change like this may make yours work but at the expense of breaking other's code.\n\nThis change is not consistent with other uses of plethysm.  I don't think that your \"1.) the result of plethysm with a tensor is a tensor\" is a reason at all because the plethysm of a tensor is already a tensor.  What you are doing is proposing changing the output basis.  The choice of making the basis output of `f(g)` the basis that f is expressed in not arbitrary and should not be changed without fundamental reasons (\"it doesn't work with my code\" is not fundamental, find another way to make your code work, I am sure that there are a dozen ways of doing that without changing the behavoir of plethysm).\n\n> except that the result is then a tensor product, and not an element from my class.\n\nBut then you should cast the output into your class.",
    "created_at": "2019-04-15T15:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386077",
    "user": "https://github.com/zabrocki"
}
```

A change like this may make yours work but at the expense of breaking other's code.

This change is not consistent with other uses of plethysm.  I don't think that your "1.) the result of plethysm with a tensor is a tensor" is a reason at all because the plethysm of a tensor is already a tensor.  What you are doing is proposing changing the output basis.  The choice of making the basis output of `f(g)` the basis that f is expressed in not arbitrary and should not be changed without fundamental reasons ("it doesn't work with my code" is not fundamental, find another way to make your code work, I am sure that there are a dozen ways of doing that without changing the behavoir of plethysm).

> except that the result is then a tensor product, and not an element from my class.

But then you should cast the output into your class.



---

archive/issue_comments_386078.json:
```json
{
    "body": "OK, no problem, although I do not understand your reasons.\n\nPossibly I miscommunicated item 1: what I meant to say is that `f(g)` is more naturally an element of the parent of `g` than of the parent of `f`.  The basis `f` is expressed in cannot possibly be a basis for `g` or `f(g)`, except when `f` and `g` are both symmetric functions (in a single alphabet, so to say).\n\nIn other words, the change of basis `plethysm` currently does is much more drastic than what I am proposing.\n\nI agree that item 2 is not a good reason.  However, I do not know an easy workaround.  In particular, I do not know how to cast the output into my class, because `plethysm` is a method of symmetric functions, not of my class.",
    "created_at": "2019-04-15T16:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386078",
    "user": "https://github.com/mantepse"
}
```

OK, no problem, although I do not understand your reasons.

Possibly I miscommunicated item 1: what I meant to say is that `f(g)` is more naturally an element of the parent of `g` than of the parent of `f`.  The basis `f` is expressed in cannot possibly be a basis for `g` or `f(g)`, except when `f` and `g` are both symmetric functions (in a single alphabet, so to say).

In other words, the change of basis `plethysm` currently does is much more drastic than what I am proposing.

I agree that item 2 is not a good reason.  However, I do not know an easy workaround.  In particular, I do not know how to cast the output into my class, because `plethysm` is a method of symmetric functions, not of my class.



---

archive/issue_comments_386079.json:
```json
{
    "body": "In my example I showed you that the plethysm of a Schur basis element and a power basis element outputs something in the Schur basis.  That is the default behavior.\n\n> what I meant to say is that `f(g)` is more naturally an element of the parent of `g` than of the parent of `f`.\n\nMaybe sometimes, but not in my uses of plethysm.  I might be able to be convinced, but I would examples and even then I would hesitate to make a change like this because that is not what happens for `f(g)` currently and it is likely to break users' code.\n\n> In particular, I do not know how to cast the output into my class, because plethysm is a method of symmetric functions, not of my class.\n\nI think that what you are proposing is a way to `f(g)` when `g` is not a symmetric function or a tensor of symmetric functions, but instead an element of your new class.  That is, you are proposing adding another case into the computation of `f(g)` : if `g` is of new class then do yet a different computation.  I don't think that this requires you to change the default behavior of the computation of `f(g)` when `g` is a tensor of symmetric functions.",
    "created_at": "2019-04-15T17:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386079",
    "user": "https://github.com/zabrocki"
}
```

In my example I showed you that the plethysm of a Schur basis element and a power basis element outputs something in the Schur basis.  That is the default behavior.

> what I meant to say is that `f(g)` is more naturally an element of the parent of `g` than of the parent of `f`.

Maybe sometimes, but not in my uses of plethysm.  I might be able to be convinced, but I would examples and even then I would hesitate to make a change like this because that is not what happens for `f(g)` currently and it is likely to break users' code.

> In particular, I do not know how to cast the output into my class, because plethysm is a method of symmetric functions, not of my class.

I think that what you are proposing is a way to `f(g)` when `g` is not a symmetric function or a tensor of symmetric functions, but instead an element of your new class.  That is, you are proposing adding another case into the computation of `f(g)` : if `g` is of new class then do yet a different computation.  I don't think that this requires you to change the default behavior of the computation of `f(g)` when `g` is a tensor of symmetric functions.



---

archive/issue_comments_386080.json:
```json
{
    "body": "> Maybe sometimes, but not in my uses of plethysm.\n\n\nI agree that other conventions may be more convenient for other uses.  Of course, I know nothing about your uses of plethysm.\n\nIn my computations, it happens frequently that the basis of the tensor product is chosen for a reason, and the basis of `f`  in `f(g)` is rather arbitrary.  But this is very likely only by coincidence.\n\n```\nsage: s[2](tensor([s(h[2]), s(m[2])]))\ns[2, 2] # s[2, 2] - s[2, 2] # s[3, 1] + s[2, 2] # s[4] + s[3, 1] # s[1, 1, 1, 1] - s[3, 1] # s[2, 1, 1] + s[3, 1] # s[2, 2] + s[4] # s[2, 2] - s[4] # s[3, 1] + s[4] # s[4]\nsage: s[2](tensor([(h[2]), (m[2])]))\nh[2, 2] # m[2, 2] + h[2, 2] # m[4] - h[3, 1] # m[4] + h[4] # m[4]\n```\n\nI guess that the only real reason I have to offer is that a basis for the symmetric functions cannot possibly be a basis for a tensor power of symmetric functions.  Since the result is in tensor space, I really have to choose a basis for the tensor space, and taking a power of the basis of `f` seems more arbitrary than taking the basis of `g`.\n\nConcerning the other question: no I do not want to add another case into the computation of `f(g)`, my class for `g` is simply a tensor product of symmetric functions with some more methods.  I guess it might be possible to define an action of symmetric functions on my class, but I don't know how to do that.  I wonder how generic plethysm really is (I think Borger and Wieland studied that).",
    "created_at": "2019-04-15T18:46:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386080",
    "user": "https://github.com/mantepse"
}
```

> Maybe sometimes, but not in my uses of plethysm.


I agree that other conventions may be more convenient for other uses.  Of course, I know nothing about your uses of plethysm.

In my computations, it happens frequently that the basis of the tensor product is chosen for a reason, and the basis of `f`  in `f(g)` is rather arbitrary.  But this is very likely only by coincidence.

```
sage: s[2](tensor([s(h[2]), s(m[2])]))
s[2, 2] # s[2, 2] - s[2, 2] # s[3, 1] + s[2, 2] # s[4] + s[3, 1] # s[1, 1, 1, 1] - s[3, 1] # s[2, 1, 1] + s[3, 1] # s[2, 2] + s[4] # s[2, 2] - s[4] # s[3, 1] + s[4] # s[4]
sage: s[2](tensor([(h[2]), (m[2])]))
h[2, 2] # m[2, 2] + h[2, 2] # m[4] - h[3, 1] # m[4] + h[4] # m[4]
```

I guess that the only real reason I have to offer is that a basis for the symmetric functions cannot possibly be a basis for a tensor power of symmetric functions.  Since the result is in tensor space, I really have to choose a basis for the tensor space, and taking a power of the basis of `f` seems more arbitrary than taking the basis of `g`.

Concerning the other question: no I do not want to add another case into the computation of `f(g)`, my class for `g` is simply a tensor product of symmetric functions with some more methods.  I guess it might be possible to define an action of symmetric functions on my class, but I don't know how to do that.  I wonder how generic plethysm really is (I think Borger and Wieland studied that).



---

archive/issue_events_068611.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:37:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68611"
}
```



---

archive/issue_comments_386081.json:
```json
{
    "body": "Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386081",
    "user": "https://github.com/embray"
}
```

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_comments_386082.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386082",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_events_068612.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68612"
}
```



---

archive/issue_events_068613.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68613"
}
```



---

archive/issue_events_068614.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68614"
}
```



---

archive/issue_events_068615.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68615"
}
```



---

archive/issue_comments_386083.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386083",
    "user": "https://github.com/mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_068616.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68616"
}
```



---

archive/issue_events_068617.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68617"
}
```



---

archive/issue_comments_386084.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386084",
    "user": "https://github.com/mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_068618.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68618"
}
```



---

archive/issue_events_068619.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68619"
}
```



---

archive/issue_comments_386085.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386085",
    "user": "https://github.com/mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_068620.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68620"
}
```



---

archive/issue_events_068621.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68621"
}
```



---

archive/issue_events_068622.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68622"
}
```



---

archive/issue_events_068623.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68623"
}
```



---

archive/issue_comments_386086.json:
```json
{
    "body": "Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386086",
    "user": "https://github.com/mkoeppe"
}
```

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_events_068624.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T17:54:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68624"
}
```



---

archive/issue_events_068625.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T17:54:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68625"
}
```



---

archive/issue_events_068626.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68626"
}
```



---

archive/issue_events_068627.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68627"
}
```



---

archive/issue_comments_386087.json:
```json
{
    "body": "I am coming back to this ticket, because the current behaviour still seems inconsistent to me.\n\n```\nsage: s = SymmetricFunctions(QQ).s()\nsage: p = SymmetricFunctions(QQ).p()\nsage: S = LazySymmetricFunctions(s)\nsage: P = LazySymmetricFunctions(p)\nsage: S(s[2,1])(P(p[1,1]))\n(1/3*p[1,1,1,1,1,1]-1/3*p[3,3])\nsage: s[2,1](p[1,1])\n2*s[2, 1, 1, 1, 1] + 3*s[2, 2, 1, 1] + s[2, 2, 2] + 3*s[3, 1, 1, 1] + 6*s[3, 2, 1] + s[3, 3] + 3*s[4, 1, 1] + 3*s[4, 2] + 2*s[5, 1]\n```",
    "created_at": "2022-09-19T19:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386087",
    "user": "https://github.com/mantepse"
}
```

I am coming back to this ticket, because the current behaviour still seems inconsistent to me.

```
sage: s = SymmetricFunctions(QQ).s()
sage: p = SymmetricFunctions(QQ).p()
sage: S = LazySymmetricFunctions(s)
sage: P = LazySymmetricFunctions(p)
sage: S(s[2,1])(P(p[1,1]))
(1/3*p[1,1,1,1,1,1]-1/3*p[3,3])
sage: s[2,1](p[1,1])
2*s[2, 1, 1, 1, 1] + 3*s[2, 2, 1, 1] + s[2, 2, 2] + 3*s[3, 1, 1, 1] + 6*s[3, 2, 1] + s[3, 3] + 3*s[4, 1, 1] + 3*s[4, 2] + 2*s[5, 1]
```



---

archive/issue_comments_386088.json:
```json
{
    "body": "Changing keywords from \"\" to \"conversion\".",
    "created_at": "2022-09-19T19:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386088",
    "user": "https://github.com/mantepse"
}
```

Changing keywords from "" to "conversion".



---

archive/issue_comments_386089.json:
```json
{
    "body": "Hi Martin, Can you explain your example?  Why would one prefer that the basis of `f(g)` should be expressed in the expression of `g` rather than the basis of `f`?\n\nA typical use for plethysm in symmetric functions would be to represent expressions like $s_\\lambda[X+1]$ or $s_\\lambda[(1-q)X]$ in which case you would want those expressions to be expanded in the Schur basis and not of that where your expression $X+1$ or $(1-q)X$ lies.  For example::\n\n```\nsage: SymmetricFunctions(QQ['q'].fraction_field()).inject_shorthands(verbose=False)\nsage: X = p[1]\nsage: q = s.base_ring().gen()\nsage: s[3,2](X+1)\ns[2] + s[2, 1] + s[2, 2] + s[3] + s[3, 1] + s[3, 2]\nsage: s[2,1]((1-q)*X)\n(q^2-q)*s[1, 1, 1] + (-q^3+2*q^2-2*q+1)*s[2, 1] + (q^2-q)*s[3]\n```\n\nI would agree that a case *could* be made that the parent should be chosen from the inner symmetric function rather than the outer.  The problem is that a lot of code is based on the opposite choice was made from the very beginning.",
    "created_at": "2022-09-20T02:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386089",
    "user": "https://github.com/zabrocki"
}
```

Hi Martin, Can you explain your example?  Why would one prefer that the basis of `f(g)` should be expressed in the expression of `g` rather than the basis of `f`?

A typical use for plethysm in symmetric functions would be to represent expressions like $s_\lambda[X+1]$ or $s_\lambda[(1-q)X]$ in which case you would want those expressions to be expanded in the Schur basis and not of that where your expression $X+1$ or $(1-q)X$ lies.  For example::

```
sage: SymmetricFunctions(QQ['q'].fraction_field()).inject_shorthands(verbose=False)
sage: X = p[1]
sage: q = s.base_ring().gen()
sage: s[3,2](X+1)
s[2] + s[2, 1] + s[2, 2] + s[3] + s[3, 1] + s[3, 2]
sage: s[2,1]((1-q)*X)
(q^2-q)*s[1, 1, 1] + (-q^3+2*q^2-2*q+1)*s[2, 1] + (q^2-q)*s[3]
```

I would agree that a case *could* be made that the parent should be chosen from the inner symmetric function rather than the outer.  The problem is that a lot of code is based on the opposite choice was made from the very beginning.



---

archive/issue_comments_386090.json:
```json
{
    "body": "One reason why I think you should use the inner parent, in addition to the example in comment:9, is that it is inconsistent with how polynomial evaluation is handled. Evaluation `ev_Y: R[X] -> S` is a morphism such that the rings `R <= S` (for fixed `Y <= S`). Likewise, as I understand your notes, plethysm is also a morphism of rings for a fixed set of \"inputs\". I think this is relevant since plethysm is like composition of symmetric functions. This is the motivation for our choice of the lazy symmetric functions.\n\nCan you give some examples where the current choice is necessary (outside of the implementation of `plethysm()`? I feel like this is a bug, as I would expect this to work:\n\n```\nsage: s = SymmetricFunctions(QQ).s()\nsage: q = ZZ['q'].fraction_field().gen()\nsage: p = SymmetricFunctions(q.parent()).p()\nsage: s[2,1]((1-q)*p[1])\nTypeError: cannot convert nonconstant polynomial\n```\nContrast this to what lazy symmetric functions does:\n\n```python\nsage: sq = SymmetricFunctions(q.parent()).s()\nsage: Sq = LazySymmetricFunctions(sq)\nsage: g = (1-q) * P(lambda n: p[1] if n == 1 else p.zero())\nsage: g  # We make it an inexact series to not call the symmetric functions code\n((-q+1)*p[1]) + O^7\nsage: S(s[2,1])(g)\n(((-q^3+3*q^2-3*q+1)/3)*p[1,1,1]+((q^3-1)/3)*p[3]) + O^7\nsage: Sq(S(s[2,1])(g))\n((q^2-q)*s[1,1,1]+(-q^3+2*q^2-2*q+1)*s[2,1]+(q^2-q)*s[3]) + O^7\n```",
    "created_at": "2022-09-20T05:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386090",
    "user": "https://github.com/tscrim"
}
```

One reason why I think you should use the inner parent, in addition to the example in comment:9, is that it is inconsistent with how polynomial evaluation is handled. Evaluation `ev_Y: R[X] -> S` is a morphism such that the rings `R <= S` (for fixed `Y <= S`). Likewise, as I understand your notes, plethysm is also a morphism of rings for a fixed set of "inputs". I think this is relevant since plethysm is like composition of symmetric functions. This is the motivation for our choice of the lazy symmetric functions.

Can you give some examples where the current choice is necessary (outside of the implementation of `plethysm()`? I feel like this is a bug, as I would expect this to work:

```
sage: s = SymmetricFunctions(QQ).s()
sage: q = ZZ['q'].fraction_field().gen()
sage: p = SymmetricFunctions(q.parent()).p()
sage: s[2,1]((1-q)*p[1])
TypeError: cannot convert nonconstant polynomial
```
Contrast this to what lazy symmetric functions does:

```python
sage: sq = SymmetricFunctions(q.parent()).s()
sage: Sq = LazySymmetricFunctions(sq)
sage: g = (1-q) * P(lambda n: p[1] if n == 1 else p.zero())
sage: g  # We make it an inexact series to not call the symmetric functions code
((-q+1)*p[1]) + O^7
sage: S(s[2,1])(g)
(((-q^3+3*q^2-3*q+1)/3)*p[1,1,1]+((q^3-1)/3)*p[3]) + O^7
sage: Sq(S(s[2,1])(g))
((q^2-q)*s[1,1,1]+(-q^3+2*q^2-2*q+1)*s[2,1]+(q^2-q)*s[3]) + O^7
```



---

archive/issue_comments_386091.json:
```json
{
    "body": "Hi Mike!\n\nThank you for your rapid answer!\n\nMy example only shows that plethysm of `SymmetricFunctions` and `LazySymmetricFunctions` behaves differently.\n\nI just realised that this behaviour (using the outer parent) is actually very specific to symmetric functions:\n\n```\nsage: s = SymmetricFunctions(QQ).s()\nsage: Q.<t> = QQ[]\nsage: f = 1 + t + 2*t^2\nsage: f(s[1] + s[2] + s[1,1])\ns[] + s[1] + 3*s[1, 1] + 4*s[1, 1, 1] + 2*s[1, 1, 1, 1] + 3*s[2] + 8*s[2, 1] + 6*s[2, 1, 1] + 4*s[2, 2] + 4*s[3] + 6*s[3, 1] + 2*s[4]\n```\nThus, polynomials of symmetric functions yield symmetric functions.",
    "created_at": "2022-09-20T10:42:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386091",
    "user": "https://github.com/mantepse"
}
```

Hi Mike!

Thank you for your rapid answer!

My example only shows that plethysm of `SymmetricFunctions` and `LazySymmetricFunctions` behaves differently.

I just realised that this behaviour (using the outer parent) is actually very specific to symmetric functions:

```
sage: s = SymmetricFunctions(QQ).s()
sage: Q.<t> = QQ[]
sage: f = 1 + t + 2*t^2
sage: f(s[1] + s[2] + s[1,1])
s[] + s[1] + 3*s[1, 1] + 4*s[1, 1, 1] + 2*s[1, 1, 1, 1] + 3*s[2] + 8*s[2, 1] + 6*s[2, 1, 1] + 4*s[2, 2] + 4*s[3] + 6*s[3, 1] + 2*s[4]
```
Thus, polynomials of symmetric functions yield symmetric functions.



---

archive/issue_comments_386092.json:
```json
{
    "body": "Where you say \"plethysm is also a morphism of rings\" might get at the argument for me.  For instance, one can define the plethysm of a symmetric function and a quasi-symmetric function.  The result is a quasi-symmetric function (e.g. `f(G)` where `f` is symmetric and `G` is quasi-symmetric the result is quasi-symmetric).\n\nYou've convinced me.  Sorry for being a stickler (but this change will break my code in places).  Its just that up to this point the examples seemed like it was based on the choice and I couldn't see an example where that choice wasn't arbitrary.",
    "created_at": "2022-09-21T14:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386092",
    "user": "https://github.com/zabrocki"
}
```

Where you say "plethysm is also a morphism of rings" might get at the argument for me.  For instance, one can define the plethysm of a symmetric function and a quasi-symmetric function.  The result is a quasi-symmetric function (e.g. `f(G)` where `f` is symmetric and `G` is quasi-symmetric the result is quasi-symmetric).

You've convinced me.  Sorry for being a stickler (but this change will break my code in places).  Its just that up to this point the examples seemed like it was based on the choice and I couldn't see an example where that choice wasn't arbitrary.



---

archive/issue_comments_386093.json:
```json
{
    "body": "No problem. It's a fair question as it does seem arbitrary on the face of it, and likewise to request not to break your code. Hopefully to fix it, it is as simple as wrapping the output of the plethysm with the outer basis (which would effectively be a no-op with the current code).\n\nMartin, for the code, do we know that the terms in the sum belong to `parent`? Or have some idea about the parent of the intermediate computations? It should be faster to do `P.linear_combination` and `P.sum` because these use the specific element class and avoid a number of transient elements.",
    "created_at": "2022-09-22T03:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386093",
    "user": "https://github.com/tscrim"
}
```

No problem. It's a fair question as it does seem arbitrary on the face of it, and likewise to request not to break your code. Hopefully to fix it, it is as simple as wrapping the output of the plethysm with the outer basis (which would effectively be a no-op with the current code).

Martin, for the code, do we know that the terms in the sum belong to `parent`? Or have some idea about the parent of the intermediate computations? It should be faster to do `P.linear_combination` and `P.sum` because these use the specific element class and avoid a number of transient elements.



---

archive/issue_comments_386094.json:
```json
{
    "body": "Great!\n\nConcerning the code: wouldn't it be better to do the easy change first, and speedup in another ticket?\n\nHm, I just wanted to show off that the lazy code would be much faster, but it isn't on my branch right now.  What happened?",
    "created_at": "2022-09-22T07:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386094",
    "user": "https://github.com/mantepse"
}
```

Great!

Concerning the code: wouldn't it be better to do the easy change first, and speedup in another ticket?

Hm, I just wanted to show off that the lazy code would be much faster, but it isn't on my branch right now.  What happened?



---

archive/issue_comments_386095.json:
```json
{
    "body": "Replying to [comment:26 Martin Rubey]:\n> Great!\n> \n> Concerning the code: wouldn't it be better to do the easy change first, and speedup in another ticket?\n\n\nYou are already changing the code there anyways. It is simple enough to do if you know which parent you are summing over.\n\n> Hm, I just wanted to show off that the lazy code would be much faster, but it isn't on my branch right now.  What happened?\n\n\nThe current branch here doesn't have the lazy series stuff (it is better that it doesn't IMO). You can create a new branch and merge the two together to test them simultaneously.",
    "created_at": "2022-09-22T07:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386095",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:26 Martin Rubey]:
> Great!
> 
> Concerning the code: wouldn't it be better to do the easy change first, and speedup in another ticket?


You are already changing the code there anyways. It is simple enough to do if you know which parent you are summing over.

> Hm, I just wanted to show off that the lazy code would be much faster, but it isn't on my branch right now.  What happened?


The current branch here doesn't have the lazy series stuff (it is better that it doesn't IMO). You can create a new branch and merge the two together to test them simultaneously.



---

archive/issue_comments_386096.json:
```json
{
    "body": "Travis, I tested it on *my* branch, not on this branch.\n\n```\nsage: N=5; f = sum(s(Partitions(n).random_element()) for n in range(N)); g = sum(s(Partitions(n).random_element()) for n in range(1, N)); f1 = L(f) + L(lambda n: 0) ; g1 = L(g) + L(lambda n: 0)\nsage: %time r = f(g)\nCPU times: user 705 ms, sys: 1 \u00b5s, total: 705 ms\nWall time: 705 ms\nsage: %time r1 = f1(g1).truncate(f.degree()*g.degree()+1)\nCPU times: user 1.09 s, sys: 1 \u00b5s, total: 1.09 s\nWall time: 1.09 s\n```",
    "created_at": "2022-09-22T07:26:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386096",
    "user": "https://github.com/mantepse"
}
```

Travis, I tested it on *my* branch, not on this branch.

```
sage: N=5; f = sum(s(Partitions(n).random_element()) for n in range(N)); g = sum(s(Partitions(n).random_element()) for n in range(1, N)); f1 = L(f) + L(lambda n: 0) ; g1 = L(g) + L(lambda n: 0)
sage: %time r = f(g)
CPU times: user 705 ms, sys: 1 µs, total: 705 ms
Wall time: 705 ms
sage: %time r1 = f1(g1).truncate(f.degree()*g.degree()+1)
CPU times: user 1.09 s, sys: 1 µs, total: 1.09 s
Wall time: 1.09 s
```



---

archive/issue_comments_386097.json:
```json
{
    "body": "The branch in this ticket is also your branch. So I thought that was what you were talking.\n\nHowever, I am not sure what has changed with the lazy plethysm speed. I don't think we changed anything with that...",
    "created_at": "2022-09-22T08:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386097",
    "user": "https://github.com/tscrim"
}
```

The branch in this ticket is also your branch. So I thought that was what you were talking.

However, I am not sure what has changed with the lazy plethysm speed. I don't think we changed anything with that...



---

archive/issue_comments_386098.json:
```json
{
    "body": "Can we be sure that our plethysm was faster?",
    "created_at": "2022-09-22T09:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386098",
    "user": "https://github.com/mantepse"
}
```

Can we be sure that our plethysm was faster?



---

archive/issue_comments_386099.json:
```json
{
    "body": "You had an example of this in ticket:34383#comment5.",
    "created_at": "2022-09-22T10:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386099",
    "user": "https://github.com/tscrim"
}
```

You had an example of this in ticket:34383#comment5.



---

archive/issue_comments_386100.json:
```json
{
    "body": "Wow, great, thank you!\n\nApparently I misremembered, because there we only compute a single degree of the plethysm, not all of them.\n\nHowever, `%prun` shows something very strange, which might give us a hint for what we are doing wrong.\n\n```\nsage: N=5; f = sum(s(Partitions(n).random_element()) for n in range(N)); g = sum(s(Partitions(n).random_element()) for n in range(1, N)); f1 = L(f) + L(lambda n: 0) ; g1 = L(g) + L(lambda n: 0)\n\nsage: %prun r1 = f1(g1).truncate(f.degree()*g.degree()+1)\n         2373194 function calls (2371664 primitive calls) in 1.949 seconds\n\n   Ordered by: internal time\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n     1173    0.656    0.001    1.519    0.001 {sage.libs.symmetrica.symmetrica.t_POWSYM_SCHUR_symmetrica}\n    ...\n      719    0.138    0.000    1.893    0.003 {built-in method sage.data_structures.blas_dict.linear_combination}\n    ...\n     1124    0.002    0.000    0.015    0.000 partition.py:1060(stretch)\n    ...\n\nsage: %prun r = f(g)\n         1413296 function calls (1409790 primitive calls) in 1.182 seconds\n\n   Ordered by: internal time\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n      512    0.309    0.001    0.797    0.002 {sage.libs.symmetrica.symmetrica.t_POWSYM_SCHUR_symmetrica}\n    ...\n     26/4    0.091    0.004    1.182    0.295 {built-in method sage.data_structures.blas_dict.linear_combination}\n    ...\n      220    0.000    0.000    0.003    0.000 partition.py:1060(stretch)\n```\n\nFor some reason, `t_POWSYM_SCHUR_symmetrica` is called more than twice as often for our algorithm than for the one in `sfa.py`.  I don't see why this should be the case.  Same goes for `stretch`.",
    "created_at": "2022-09-22T11:39:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386100",
    "user": "https://github.com/mantepse"
}
```

Wow, great, thank you!

Apparently I misremembered, because there we only compute a single degree of the plethysm, not all of them.

However, `%prun` shows something very strange, which might give us a hint for what we are doing wrong.

```
sage: N=5; f = sum(s(Partitions(n).random_element()) for n in range(N)); g = sum(s(Partitions(n).random_element()) for n in range(1, N)); f1 = L(f) + L(lambda n: 0) ; g1 = L(g) + L(lambda n: 0)

sage: %prun r1 = f1(g1).truncate(f.degree()*g.degree()+1)
         2373194 function calls (2371664 primitive calls) in 1.949 seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
     1173    0.656    0.001    1.519    0.001 {sage.libs.symmetrica.symmetrica.t_POWSYM_SCHUR_symmetrica}
    ...
      719    0.138    0.000    1.893    0.003 {built-in method sage.data_structures.blas_dict.linear_combination}
    ...
     1124    0.002    0.000    0.015    0.000 partition.py:1060(stretch)
    ...

sage: %prun r = f(g)
         1413296 function calls (1409790 primitive calls) in 1.182 seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
      512    0.309    0.001    0.797    0.002 {sage.libs.symmetrica.symmetrica.t_POWSYM_SCHUR_symmetrica}
    ...
     26/4    0.091    0.004    1.182    0.295 {built-in method sage.data_structures.blas_dict.linear_combination}
    ...
      220    0.000    0.000    0.003    0.000 partition.py:1060(stretch)
```

For some reason, `t_POWSYM_SCHUR_symmetrica` is called more than twice as often for our algorithm than for the one in `sfa.py`.  I don't see why this should be the case.  Same goes for `stretch`.



---

archive/issue_comments_386101.json:
```json
{
    "body": "Indeed, that is interesting. I guess it depends on what things we want to actually compute.\n\nPerhaps we can move this to a new ticket, both to keep the scope of this ticket to symmetric functions, and to not spam other cc-ed people. `;)`.\n\nFor this ticket, I rebased it on #34470 (strictly speaking, it should be #34413) as there was a conflict. I made an optimization with how the sums are computed. I also fixed a few things with how scalars are handled, which arose from making the output be in the input parent (or the base ring for scalars; I don't see an easy way to deal with doing pushouts).\n\nUnfortunately I accidentally put my changes into the merge comment. `>_<` So it is hard to see the bulk of them commit-by-commit.\n\nAnyways, if the patchbot comes back again green and you are happy with my changes, then I think we are at a positive review.\n\n---\nLast 10 new commits:",
    "created_at": "2022-09-22T14:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386101",
    "user": "https://github.com/tscrim"
}
```

Indeed, that is interesting. I guess it depends on what things we want to actually compute.

Perhaps we can move this to a new ticket, both to keep the scope of this ticket to symmetric functions, and to not spam other cc-ed people. `;)`.

For this ticket, I rebased it on #34470 (strictly speaking, it should be #34413) as there was a conflict. I made an optimization with how the sums are computed. I also fixed a few things with how scalars are handled, which arose from making the output be in the input parent (or the base ring for scalars; I don't see an easy way to deal with doing pushouts).

Unfortunately I accidentally put my changes into the merge comment. `>_<` So it is hard to see the bulk of them commit-by-commit.

Anyways, if the patchbot comes back again green and you are happy with my changes, then I think we are at a positive review.

---
Last 10 new commits:



---

archive/issue_comments_386102.json:
```json
{
    "body": "I agree to moving the performance discussion to a different ticket.  I feel a bit uneasy with merging the lazy stuff into this ticket, but I guess it makes no difference.",
    "created_at": "2022-09-22T15:02:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386102",
    "user": "https://github.com/mantepse"
}
```

I agree to moving the performance discussion to a different ticket.  I feel a bit uneasy with merging the lazy stuff into this ticket, but I guess it makes no difference.



---

archive/issue_comments_386103.json:
```json
{
    "body": "We have to deal with the conflict somewhere, and better here because #34413 is already positively reviewed.",
    "created_at": "2022-09-22T15:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386103",
    "user": "https://github.com/tscrim"
}
```

We have to deal with the conflict somewhere, and better here because #34413 is already positively reviewed.



---

archive/issue_comments_386104.json:
```json
{
    "body": "Do you understand these warnings?\n\n```\n========== deprecation_number ==========\ngit checkout patchbot/ticket_merged\n+            deprecation(32367, 'the method coefficients now only returns the non-zero coefficients. Use __getitem__ instead.')\n+        deprecation(32367, 'the method exponential is deprecated. Use exp instead.')\n+        deprecation(32367, \"the method compute_coefficients obsolete and has no effect.\")\nWrong deprecation number inserted on 3 non-empty lines\ndeprecation_number -- 0 seconds\n========== end deprecation_number ==========\n```",
    "created_at": "2022-09-23T10:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386104",
    "user": "https://github.com/mantepse"
}
```

Do you understand these warnings?

```
========== deprecation_number ==========
git checkout patchbot/ticket_merged
+            deprecation(32367, 'the method coefficients now only returns the non-zero coefficients. Use __getitem__ instead.')
+        deprecation(32367, 'the method exponential is deprecated. Use exp instead.')
+        deprecation(32367, "the method compute_coefficients obsolete and has no effect.")
Wrong deprecation number inserted on 3 non-empty lines
deprecation_number -- 0 seconds
========== end deprecation_number ==========
```



---

archive/issue_comments_386105.json:
```json
{
    "body": "It comes from the patchbot implementation being simple and not realizing it is coming from a dependency ticket. We can ignore it.",
    "created_at": "2022-09-23T10:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386105",
    "user": "https://github.com/tscrim"
}
```

It comes from the patchbot implementation being simple and not realizing it is coming from a dependency ticket. We can ignore it.



---

archive/issue_comments_386106.json:
```json
{
    "body": "Should there be a doctest (and perhaps even specification) demonstrating that the parent is now the parent of the inner function?\n\nShould there maybe even be a warning?  I am somewhat afraid that some people may have private code like\n\n```\nsage: s = SymmetricFunctions(QQ).s()\nsage: p = SymmetricFunctions(QQ).p()\nsage: n = 5; f = p[2,2,1] + p[5]\nsage: s[2](f)[Partition([2*n])]\n3\n```\nwho might be not amused about not being warned.",
    "created_at": "2022-09-23T10:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386106",
    "user": "https://github.com/mantepse"
}
```

Should there be a doctest (and perhaps even specification) demonstrating that the parent is now the parent of the inner function?

Should there maybe even be a warning?  I am somewhat afraid that some people may have private code like

```
sage: s = SymmetricFunctions(QQ).s()
sage: p = SymmetricFunctions(QQ).p()
sage: n = 5; f = p[2,2,1] + p[5]
sage: s[2](f)[Partition([2*n])]
3
```
who might be not amused about not being warned.



---

archive/issue_comments_386107.json:
```json
{
    "body": "IMO, this is a bug (such as composing with a tensor product), so no warning/deprecation is necessary. I agree with you that we should add a doctest and documentation indicating this behavior.",
    "created_at": "2022-09-23T10:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386107",
    "user": "https://github.com/tscrim"
}
```

IMO, this is a bug (such as composing with a tensor product), so no warning/deprecation is necessary. I agree with you that we should add a doctest and documentation indicating this behavior.



---

archive/issue_comments_386108.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-23T11:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386108",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_386109.json:
```json
{
    "body": "I've added it.",
    "created_at": "2022-09-23T11:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386109",
    "user": "https://github.com/tscrim"
}
```

I've added it.



---

archive/issue_comments_386110.json:
```json
{
    "body": "ping?\n\n---\nNew commits:",
    "created_at": "2022-11-25T08:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386110",
    "user": "https://github.com/mantepse"
}
```

ping?

---
New commits:



---

archive/issue_comments_386111.json:
```json
{
    "body": "I'm happy. If you are with my added tests, then positive review.",
    "created_at": "2022-11-25T09:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386111",
    "user": "https://github.com/tscrim"
}
```

I'm happy. If you are with my added tests, then positive review.



---

archive/issue_comments_386112.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-11-25T10:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386112",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_068628.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-12-11T11:11:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27652#event-68628"
}
```



---

archive/issue_comments_386113.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-12-11T11:11:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27652",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27652#issuecomment-386113",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
