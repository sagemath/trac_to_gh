# Issue 27681: GAP: Apparent problem with workspace initialization

archive/issues_027444.json:
```json
{
    "assignees": [],
    "body": "I don't fully understand the problem yet but there seems to be an issue in 8.8.beta2 (if not earlier) related to GAP workspaces.\n\nThe only way I've been able to reproduce it reliably is by running\n\n```\n$ rm -rf ~/.sage/gap/*\n```\n\nand then\n\n```\n./sage -t --long src/sage/combinat/tableau.py\n```\n\nat some point during this test (possibly others but this is the only where I've reliably reproduced the issue) things start to go horribly wrong:\n\n```\nsage -t --long src/sage/combinat/tableau.py\n**********************************************************************\nFile \"src/sage/combinat/tableau.py\", line 7751, in sage.combinat.tableau.StandardTableaux_size.cardinality\nFailed example:\n    StandardTableaux(50).cardinality()  # long time\nException raised:\n    Traceback (most recent call last):\n      File \"/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1095, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.tableau.StandardTableaux_size.cardinality[4]>\", line 1, in <module>\n        StandardTableaux(Integer(50)).cardinality()  # long time\n      File \"sage/misc/lazy_import.pyx\", line 354, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3691)\n        return self.get_object()(*args, **kwds)\n      File \"sage/misc/classcall_metaclass.pyx\", line 330, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1735)\n        return cls.classcall(cls, *args, **kwds)\n      File \"/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/combinat/tableau.py\", line 7584, in __classcall_private__\n        return StandardTableaux_size(n)\n      File \"sage/misc/classcall_metaclass.pyx\", line 330, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1735)\n        return cls.classcall(cls, *args, **kwds)\n      File \"sage/misc/cachefunc.pyx\", line 1003, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6011)\n        w = self.f(*args, **kwds)\n      File \"/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/structure/unique_representation.py\", line 1027, in __classcall__\n        instance = typecall(cls, *args, **options)\n      File \"sage/misc/classcall_metaclass.pyx\", line 497, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2185)\n        return (<PyTypeObject*>type).tp_call(cls, args, kwds)\n      File \"/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/combinat/tableau.py\", line 7693, in __init__\n        facade=True, keepkey=False)\n      File \"/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/sets/disjoint_union_enumerated_sets.py\", line 288, in __init__\n        self._facade_for = tuple(family)\n      File \"/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/sets/family.py\", line 1078, in __getitem__\n        return self.function(i)\n      File \"sage/misc/classcall_metaclass.pyx\", line 330, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1735)\n        return cls.classcall(cls, *args, **kwds)\n      File \"sage/misc/cachefunc.pyx\", line 1003, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6011)\n        w = self.f(*args, **kwds)\n      File \"sage/structure/parent.pyx\", line 303, in sage.structure.parent.Parent.__init__ (build/cythonized/sage/structure/parent.c:4756)\n        for cls in self.__class__.mro():\n    MemoryError\n**********************************************************************\nFile \"src/sage/combinat/tableau.py\", line 8572, in sage.combinat.tableau.IncreasingTableaux.__init__\nFailed example:\n    TestSuite(S).run()  # long time\nException raised:\n    Traceback (most recent call last):\n      File \"/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1108, in compile_and_execute\n        self.update_digests(example)\n      File \"/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 999, in update_digests\n        digest.update(str_to_bytes(reduce_hex(gen), 'ascii'))\n      File \"/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/parsing.py\", line 442, in reduce_hex\n        from operator import xor\n    MemoryError\nProcess DocTestWorker-1:\nTraceback (most recent call last):\n  File \"/home/embray/src/sagemath/sage/local/lib/python2.7/multiprocessing/process.py\", line 267, in _bootstrap\n    self.run()\n  File \"/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 2139, in run\n    task(self.options, self.outtmpfile, msgpipe, self.result_queue)\n  File \"/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 2498, in __call__\n    result_queue.put(result, False)\n  File \"/home/embray/src/sagemath/sage/local/lib/python2.7/multiprocessing/queues.py\", line 107, in put\n    self._start_thread()\n  File \"/home/embray/src/sagemath/sage/local/lib/python2.7/multiprocessing/queues.py\", line 195, in _start_thread\n    self._thread.start()\n  File \"/home/embray/src/sagemath/sage/local/lib/python2.7/threading.py\", line 736, in start\n    _start_new_thread(self.__bootstrap, ())\nerror: can't start new thread\n    Bad exit: 1\n**********************************************************************\n```\n\nISTM like maybe some memory corruption occurs as a result of trying to load a corrupt or partial GAP workspace.  It's really bad, whatever it is.\n\nI should add, if I subsequently run the test it passes.  But then I can reproduce the problem again by deleting workspaces and re-rerunning the test.\n\nDepends on #27680\n\nCC:  @jdemeyer\n\nComponent: **packages: standard**\n\nKeywords: **gap libgap**\n\nAuthor: **Erik Bray**\n\nBranch: **[`ecacac8`](https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6)**\n\nReviewer: **Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27681_\n\n",
    "closed_at": "2019-07-13T12:09:56Z",
    "created_at": "2019-04-16T17:00:28Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "GAP: Apparent problem with workspace initialization",
    "type": "issue",
    "updated_at": "2019-07-13T12:09:56Z",
    "url": "https://github.com/sagemath/sage/issues/27681",
    "user": "https://github.com/embray"
}
```
I don't fully understand the problem yet but there seems to be an issue in 8.8.beta2 (if not earlier) related to GAP workspaces.

The only way I've been able to reproduce it reliably is by running

```
$ rm -rf ~/.sage/gap/*
```

and then

```
./sage -t --long src/sage/combinat/tableau.py
```

at some point during this test (possibly others but this is the only where I've reliably reproduced the issue) things start to go horribly wrong:

```
sage -t --long src/sage/combinat/tableau.py
**********************************************************************
File "src/sage/combinat/tableau.py", line 7751, in sage.combinat.tableau.StandardTableaux_size.cardinality
Failed example:
    StandardTableaux(50).cardinality()  # long time
Exception raised:
    Traceback (most recent call last):
      File "/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1095, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.tableau.StandardTableaux_size.cardinality[4]>", line 1, in <module>
        StandardTableaux(Integer(50)).cardinality()  # long time
      File "sage/misc/lazy_import.pyx", line 354, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3691)
        return self.get_object()(*args, **kwds)
      File "sage/misc/classcall_metaclass.pyx", line 330, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1735)
        return cls.classcall(cls, *args, **kwds)
      File "/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/combinat/tableau.py", line 7584, in __classcall_private__
        return StandardTableaux_size(n)
      File "sage/misc/classcall_metaclass.pyx", line 330, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1735)
        return cls.classcall(cls, *args, **kwds)
      File "sage/misc/cachefunc.pyx", line 1003, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6011)
        w = self.f(*args, **kwds)
      File "/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/structure/unique_representation.py", line 1027, in __classcall__
        instance = typecall(cls, *args, **options)
      File "sage/misc/classcall_metaclass.pyx", line 497, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2185)
        return (<PyTypeObject*>type).tp_call(cls, args, kwds)
      File "/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/combinat/tableau.py", line 7693, in __init__
        facade=True, keepkey=False)
      File "/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/sets/disjoint_union_enumerated_sets.py", line 288, in __init__
        self._facade_for = tuple(family)
      File "/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/sets/family.py", line 1078, in __getitem__
        return self.function(i)
      File "sage/misc/classcall_metaclass.pyx", line 330, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1735)
        return cls.classcall(cls, *args, **kwds)
      File "sage/misc/cachefunc.pyx", line 1003, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6011)
        w = self.f(*args, **kwds)
      File "sage/structure/parent.pyx", line 303, in sage.structure.parent.Parent.__init__ (build/cythonized/sage/structure/parent.c:4756)
        for cls in self.__class__.mro():
    MemoryError
**********************************************************************
File "src/sage/combinat/tableau.py", line 8572, in sage.combinat.tableau.IncreasingTableaux.__init__
Failed example:
    TestSuite(S).run()  # long time
Exception raised:
    Traceback (most recent call last):
      File "/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1108, in compile_and_execute
        self.update_digests(example)
      File "/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 999, in update_digests
        digest.update(str_to_bytes(reduce_hex(gen), 'ascii'))
      File "/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/parsing.py", line 442, in reduce_hex
        from operator import xor
    MemoryError
Process DocTestWorker-1:
Traceback (most recent call last):
  File "/home/embray/src/sagemath/sage/local/lib/python2.7/multiprocessing/process.py", line 267, in _bootstrap
    self.run()
  File "/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2139, in run
    task(self.options, self.outtmpfile, msgpipe, self.result_queue)
  File "/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2498, in __call__
    result_queue.put(result, False)
  File "/home/embray/src/sagemath/sage/local/lib/python2.7/multiprocessing/queues.py", line 107, in put
    self._start_thread()
  File "/home/embray/src/sagemath/sage/local/lib/python2.7/multiprocessing/queues.py", line 195, in _start_thread
    self._thread.start()
  File "/home/embray/src/sagemath/sage/local/lib/python2.7/threading.py", line 736, in start
    _start_new_thread(self.__bootstrap, ())
error: can't start new thread
    Bad exit: 1
**********************************************************************
```

ISTM like maybe some memory corruption occurs as a result of trying to load a corrupt or partial GAP workspace.  It's really bad, whatever it is.

I should add, if I subsequently run the test it passes.  But then I can reproduce the problem again by deleting workspaces and re-rerunning the test.

Depends on #27680

CC:  @jdemeyer

Component: **packages: standard**

Keywords: **gap libgap**

Author: **Erik Bray**

Branch: **[`ecacac8`](https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6)**

Reviewer: **Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/27681_





---

archive/issue_events_376863.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-16T17:00:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376863"
}
```



---

archive/issue_events_376864.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-16T17:00:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376864"
}
```



---

archive/issue_events_376865.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-16T17:00:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376865"
}
```



---

archive/issue_events_376866.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-16T17:00:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376866"
}
```



---

archive/issue_comments_428888.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -90,3 +90,5 @@\n ```\n \n ISTM like maybe some memory corruption occurs as a result of trying to load a corrupt or partial GAP workspace.  It's really bad, whatever it is.\n+\n+I should add, if I subsequently run the test it passes.  But then I can reproduce the problem again by deleting workspaces and re-rerunning the test.\n``````\n",
    "created_at": "2019-04-16T17:03:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428888",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -90,3 +90,5 @@
 ```
 
 ISTM like maybe some memory corruption occurs as a result of trying to load a corrupt or partial GAP workspace.  It's really bad, whatever it is.
+
+I should add, if I subsequently run the test it passes.  But then I can reproduce the problem again by deleting workspaces and re-rerunning the test.
``````




---

archive/issue_comments_428889.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nSome additional observations:\n\n* I can also reproduce the problem by doing just `rm -rf ~/.sage/gap/gap-workspace-*`; i.e. deleting just the pexpect gap workspace and not the libgap workspace.\n\n* If I instead do `rm -rf ~/.sage/gap/libgap-workspace-*` the test passes every time, but no new libgap workspace is created (as if the test does not use libgap at all; I haven't confirmed this but it seems to be the case).\n\n* However, if I delete *both* workspaces the test fails and both a `gap-workspace-` and a `libgap-workspace-` are created.",
    "created_at": "2019-04-16T17:18:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428889",
    "user": "https://github.com/embray"
}
```

<div id="comment:2" align="right">comment:2</div>

Some additional observations:

* I can also reproduce the problem by doing just `rm -rf ~/.sage/gap/gap-workspace-*`; i.e. deleting just the pexpect gap workspace and not the libgap workspace.

* If I instead do `rm -rf ~/.sage/gap/libgap-workspace-*` the test passes every time, but no new libgap workspace is created (as if the test does not use libgap at all; I haven't confirmed this but it seems to be the case).

* However, if I delete *both* workspaces the test fails and both a `gap-workspace-` and a `libgap-workspace-` are created.



---

archive/issue_comments_428890.json:
```json
{
    "body": "Branch: **[u/embray/ticket-27681](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27681)**",
    "created_at": "2019-04-17T15:58:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428890",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/ticket-27681](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27681)**



---

archive/issue_comments_428891.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThis seems to fit it, with the aid of #27680.\n\nIronically, it was while testing #27680 that I discovered this issue, and at first I thought it was caused somehow by my changes in that ticket.  But I can confirm that it's not related at all.\n\nThe problem stems (for reasons I still do not understand and are disturbing) from the fact that libgap was actually being used in the process of initializing a new workspace by pexpect GAP.  Somehow this was causing problems; perhaps related to package loading.\n\nIt's still disturbing that this could cause such a problem, and I can't seem to reproduce the issue in other examples of using both GAP interfaces simultaneously.  It must come down to some subtle resource contention issue within GAP itself, and we can make some progress toward avoiding it by taking more care not to use both GAPs simultaneously during workspace caching.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de4332b574a1cc31e637122fcf292175c7e7e5f5\"><code>de4332b</code></a></td><td><code>Change libgap initialization to work lazily.  Don't initialize() in Gap.__init__ but only just before libgap actually needs to be initialized.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e687ee6dc0468a40dcf84e41cc60e99d260d662f\"><code>e687ee6</code></a></td><td><code>This test no longer makes sense in light of lazy initialization of libgap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b6d94ee889e35b167b616fc4b9488a29cedc6d1\"><code>0b6d94e</code></a></td><td><code>Trac #27681: Update all_installed_packages to allow passing a specific GAP</code></td></tr></table>\n",
    "created_at": "2019-04-17T15:58:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428891",
    "user": "https://github.com/embray"
}
```

<div id="comment:3" align="right">comment:3</div>

This seems to fit it, with the aid of #27680.

Ironically, it was while testing #27680 that I discovered this issue, and at first I thought it was caused somehow by my changes in that ticket.  But I can confirm that it's not related at all.

The problem stems (for reasons I still do not understand and are disturbing) from the fact that libgap was actually being used in the process of initializing a new workspace by pexpect GAP.  Somehow this was causing problems; perhaps related to package loading.

It's still disturbing that this could cause such a problem, and I can't seem to reproduce the issue in other examples of using both GAP interfaces simultaneously.  It must come down to some subtle resource contention issue within GAP itself, and we can make some progress toward avoiding it by taking more care not to use both GAPs simultaneously during workspace caching.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de4332b574a1cc31e637122fcf292175c7e7e5f5"><code>de4332b</code></a></td><td><code>Change libgap initialization to work lazily.  Don't initialize() in Gap.__init__ but only just before libgap actually needs to be initialized.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e687ee6dc0468a40dcf84e41cc60e99d260d662f"><code>e687ee6</code></a></td><td><code>This test no longer makes sense in light of lazy initialization of libgap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b6d94ee889e35b167b616fc4b9488a29cedc6d1"><code>0b6d94e</code></a></td><td><code>Trac #27681: Update all_installed_packages to allow passing a specific GAP</code></td></tr></table>




---

archive/issue_comments_428892.json:
```json
{
    "body": "Commit: **[`0b6d94e`](https://github.com/sagemath/sagetrac-mirror/commit/0b6d94ee889e35b167b616fc4b9488a29cedc6d1)**",
    "created_at": "2019-04-17T15:58:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428892",
    "user": "https://github.com/embray"
}
```

Commit: **[`0b6d94e`](https://github.com/sagemath/sagetrac-mirror/commit/0b6d94ee889e35b167b616fc4b9488a29cedc6d1)**



---

archive/issue_comments_428893.json:
```json
{
    "body": "Dependencies: **#27680**",
    "created_at": "2019-04-17T15:58:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428893",
    "user": "https://github.com/embray"
}
```

Dependencies: **#27680**



---

archive/issue_comments_428894.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2019-04-17T15:58:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428894",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_events_376867.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-17T15:58:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376867"
}
```



---

archive/issue_comments_428895.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThe attached fix worked around the issue superficially for one use case, but it still seems to be a problem after all as I am still able to reproduce it in other cases even with this fix.",
    "created_at": "2019-04-17T17:39:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428895",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

The attached fix worked around the issue superficially for one use case, but it still seems to be a problem after all as I am still able to reproduce it in other cases even with this fix.



---

archive/issue_events_376868.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-17T17:39:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376868"
}
```



---

archive/issue_events_376869.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-17T17:39:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376869"
}
```



---

archive/issue_comments_428896.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI am not able to reproduce the problem in the ticket description. Is it platform-specific?",
    "created_at": "2019-05-06T11:52:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428896",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">comment:5</div>

I am not able to reproduce the problem in the ticket description. Is it platform-specific?



---

archive/issue_comments_428897.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nOK, I see it on Fedora 26 now (but not on Gentoo or Debian!).\n\nI don't even need to remove the workspaces.\nDuring the run GAP (but not libgap) workspace is changed (well, it's creation time is changed). So this seems to be unrelated to libgap, it's a GAP interface problem.",
    "created_at": "2019-05-06T12:06:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428897",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

OK, I see it on Fedora 26 now (but not on Gentoo or Debian!).

I don't even need to remove the workspaces.
During the run GAP (but not libgap) workspace is changed (well, it's creation time is changed). So this seems to be unrelated to libgap, it's a GAP interface problem.



---

archive/issue_comments_428898.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n`sage/combinat/tableau.py  # Bad exit: 1` is mentioned here\nhttps://groups.google.com/d/msg/sage-devel/UJW7bDFdrhQ/EoC_WdOOFgAJ\n\nalready in 8.7beta - I think I saw this earlier. I'm sure it's a doctest-related race condition - I have no idea why GAP workspace is updated mid-test, this alone is fishy.",
    "created_at": "2019-05-06T13:04:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428898",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">comment:7</div>

`sage/combinat/tableau.py  # Bad exit: 1` is mentioned here
https://groups.google.com/d/msg/sage-devel/UJW7bDFdrhQ/EoC_WdOOFgAJ

already in 8.7beta - I think I saw this earlier. I'm sure it's a doctest-related race condition - I have no idea why GAP workspace is updated mid-test, this alone is fishy.



---

archive/issue_comments_428899.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI'm not sure it has *nothing* to do with libgap.  In [0b6d94ee](https://github.com/sagemath/sagetrac-mirror/commit/0b6d94ee889e35b167b616fc4b9488a29cedc6d1) I fixed a problem where libgap was being used *during* pexpect-gap initialization in the `all_installed_packages` function.\n\nThis seemed to alleviate the problem somewhat, but it seems to be more of a bandaid.\n\nWhat's really weird is that the way the problem manifests itself is in the form of some pretty severe memory corruption affecting just random things in Sage.  And I would think that only the libgap interface would be capable of breaking things that badly.\n\nI haven't looked at the issue in a few weeks though so I don't have any good ideas at the moment.  I need to start looking at it again...",
    "created_at": "2019-05-06T13:20:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428899",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">comment:10</div>

I'm not sure it has *nothing* to do with libgap.  In [0b6d94ee](https://github.com/sagemath/sagetrac-mirror/commit/0b6d94ee889e35b167b616fc4b9488a29cedc6d1) I fixed a problem where libgap was being used *during* pexpect-gap initialization in the `all_installed_packages` function.

This seemed to alleviate the problem somewhat, but it seems to be more of a bandaid.

What's really weird is that the way the problem manifests itself is in the form of some pretty severe memory corruption affecting just random things in Sage.  And I would think that only the libgap interface would be capable of breaking things that badly.

I haven't looked at the issue in a few weeks though so I don't have any good ideas at the moment.  I need to start looking at it again...



---

archive/issue_comments_428900.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nAs usual with race conditions, it's extremely fluid, changes somewhere unrelated might \"fix\" it. First of all, there is no reason for GAP workspace to get updated during this test, yet is updated (not only on systems where these errors are seen, it seems it happens everywhere).",
    "created_at": "2019-05-06T13:40:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428900",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11" align="right">comment:11</div>

As usual with race conditions, it's extremely fluid, changes somewhere unrelated might "fix" it. First of all, there is no reason for GAP workspace to get updated during this test, yet is updated (not only on systems where these errors are seen, it seems it happens everywhere).



---

archive/issue_comments_428901.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAfter rebasing this branch on 8.8.beta4 I can't reproduce the issue anymore, at least not in the same way. I'll keep trying things though.",
    "created_at": "2019-05-06T14:04:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428901",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

After rebasing this branch on 8.8.beta4 I can't reproduce the issue anymore, at least not in the same way. I'll keep trying things though.



---

archive/issue_comments_428902.json:
```json
{
    "body": "Changed commit from **[`0b6d94e`](https://github.com/sagemath/sagetrac-mirror/commit/0b6d94ee889e35b167b616fc4b9488a29cedc6d1)** to **[`ecacac8`](https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6)**",
    "created_at": "2019-05-06T15:20:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428902",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0b6d94e`](https://github.com/sagemath/sagetrac-mirror/commit/0b6d94ee889e35b167b616fc4b9488a29cedc6d1)** to **[`ecacac8`](https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6)**



---

archive/issue_comments_428903.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/19d57336f08d3726ccf5d84dc58c80a853ce697d\"><code>19d5733</code></a></td><td><code>Change libgap initialization to work lazily.  Don't initialize() in Gap.__init__ but only just before libgap actually needs to be initialized.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13120249271b61914386cf8ba62f89154bc18cb2\"><code>1312024</code></a></td><td><code>This test no longer makes sense in light of lazy initialization of libgap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6\"><code>ecacac8</code></a></td><td><code>Trac #27681: Update all_installed_packages to allow passing a specific GAP</code></td></tr></table>\n",
    "created_at": "2019-05-06T15:20:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428903",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/19d57336f08d3726ccf5d84dc58c80a853ce697d"><code>19d5733</code></a></td><td><code>Change libgap initialization to work lazily.  Don't initialize() in Gap.__init__ but only just before libgap actually needs to be initialized.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13120249271b61914386cf8ba62f89154bc18cb2"><code>1312024</code></a></td><td><code>This test no longer makes sense in light of lazy initialization of libgap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6"><code>ecacac8</code></a></td><td><code>Trac #27681: Update all_installed_packages to allow passing a specific GAP</code></td></tr></table>




---

archive/issue_events_376870.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-05-06T15:22:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376870"
}
```



---

archive/issue_events_376871.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-05-06T15:22:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376871"
}
```



---

archive/issue_comments_428904.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nRebased the branch on 8.8.beta4.  Did a full `make ptestlong` and it passed, no problem.  This is on my Ubuntu machine; which IIRC is where I originally noted the problem.\n\nCan you try this updated version of the branch and see if it's fixed on Fedora as well?  Anyways, try as I might and I can't get this to come back, at least not in the way I originally reproduced it.\n\nI'll try again on Cygwin too...",
    "created_at": "2019-05-06T15:22:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428904",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">comment:14</div>

Rebased the branch on 8.8.beta4.  Did a full `make ptestlong` and it passed, no problem.  This is on my Ubuntu machine; which IIRC is where I originally noted the problem.

Can you try this updated version of the branch and see if it's fixed on Fedora as well?  Anyways, try as I might and I can't get this to come back, at least not in the way I originally reproduced it.

I'll try again on Cygwin too...



---

archive/issue_comments_428905.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThe error is still there, slightly different:\n\n```\n$ ./sage -t --long src/sage/combinat/tableau.py\nRunning doctests with ID 2019-05-06-16-43-27-d70e975c.\nGit branch: develop\nUsing --optional=build,dochtml,memlimit,python2,sage\nDoctesting 1 file.\nsage -t --long --warn-long 54.8 src/sage/combinat/tableau.py\nProcess DocTestWorker-1:\nTraceback (most recent call last):\n  File \"/home/scratch2/dimpase/sage/sage/local/lib/python2.7/multiprocessing/process.py\", line 267, in _bootstrap\n    self.run()\n  File \"/home/scratch2/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 2139, in run\n    task(self.options, self.outtmpfile, msgpipe, self.result_queue)\n  File \"/home/scratch2/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 2498, in __call__\n    result_queue.put(result, False)\n  File \"/home/scratch2/dimpase/sage/sage/local/lib/python2.7/multiprocessing/queues.py\", line 107, in put\n    self._start_thread()\n  File \"/home/scratch2/dimpase/sage/sage/local/lib/python2.7/multiprocessing/queues.py\", line 195, in _start_thread\n    self._thread.start()\n  File \"/home/scratch2/dimpase/sage/sage/local/lib/python2.7/threading.py\", line 736, in start\n    _start_new_thread(self.__bootstrap, ())\nerror: can't start new thread\n    Bad exit: 1\n**********************************************************************\nTests run before process (pid=23005) failed:\nsage: t = Tableau([[1,2,3],[4,5]]); t ## line 144 ##\n\n...\nsage: IT = IncreasingTableaux(4, (1,0,1,1)) ## line 9389 ##\nsage: IT[0].parent() is IT ## line 9390 ##\nTrue\nsage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 9392 ##\n0\nsage: IT = IncreasingTableaux(4, (1,0,1,1)) ## line 9402 ##\nsage: all(it in IT for it in IT) ## line 9403 ##\nTrue\nsage: all(it in IT for it in IncreasingTableaux([2,2], (1,0,1,1))) ## line 9405 ##\nTrue\nsage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 9407 ##\n0\n\n**********************************************************************\n----------------------------------------------------------------------\nsage -t --long --warn-long 54.8 src/sage/combinat/tableau.py  # Bad exit: 1\n```\n\nGAP workspace still changes, as before.",
    "created_at": "2019-05-06T15:54:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428905",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">comment:15</div>

The error is still there, slightly different:

```
$ ./sage -t --long src/sage/combinat/tableau.py
Running doctests with ID 2019-05-06-16-43-27-d70e975c.
Git branch: develop
Using --optional=build,dochtml,memlimit,python2,sage
Doctesting 1 file.
sage -t --long --warn-long 54.8 src/sage/combinat/tableau.py
Process DocTestWorker-1:
Traceback (most recent call last):
  File "/home/scratch2/dimpase/sage/sage/local/lib/python2.7/multiprocessing/process.py", line 267, in _bootstrap
    self.run()
  File "/home/scratch2/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2139, in run
    task(self.options, self.outtmpfile, msgpipe, self.result_queue)
  File "/home/scratch2/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2498, in __call__
    result_queue.put(result, False)
  File "/home/scratch2/dimpase/sage/sage/local/lib/python2.7/multiprocessing/queues.py", line 107, in put
    self._start_thread()
  File "/home/scratch2/dimpase/sage/sage/local/lib/python2.7/multiprocessing/queues.py", line 195, in _start_thread
    self._thread.start()
  File "/home/scratch2/dimpase/sage/sage/local/lib/python2.7/threading.py", line 736, in start
    _start_new_thread(self.__bootstrap, ())
error: can't start new thread
    Bad exit: 1
**********************************************************************
Tests run before process (pid=23005) failed:
sage: t = Tableau([[1,2,3],[4,5]]); t ## line 144 ##

...
sage: IT = IncreasingTableaux(4, (1,0,1,1)) ## line 9389 ##
sage: IT[0].parent() is IT ## line 9390 ##
True
sage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 9392 ##
0
sage: IT = IncreasingTableaux(4, (1,0,1,1)) ## line 9402 ##
sage: all(it in IT for it in IT) ## line 9403 ##
True
sage: all(it in IT for it in IncreasingTableaux([2,2], (1,0,1,1))) ## line 9405 ##
True
sage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 9407 ##
0

**********************************************************************
----------------------------------------------------------------------
sage -t --long --warn-long 54.8 src/sage/combinat/tableau.py  # Bad exit: 1
```

GAP workspace still changes, as before.



---

archive/issue_comments_428906.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nNote that if I wipe out ~/.sage/ then after that the 1st run the test passes, but on the 2nd, etc. runs it does not.",
    "created_at": "2019-05-06T16:03:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428906",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:16" align="right">comment:16</div>

Note that if I wipe out ~/.sage/ then after that the 1st run the test passes, but on the 2nd, etc. runs it does not.



---

archive/issue_comments_428907.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nRight, that's the behavior I was getting before too, but now I'm not getting it anymore, even on the exact same system as before :(",
    "created_at": "2019-05-06T16:16:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428907",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">comment:17</div>

Right, that's the behavior I was getting before too, but now I'm not getting it anymore, even on the exact same system as before :(



---

archive/issue_comments_428908.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nHow does one check the caller stack while running tests? I would like to see where `gap_reset_workspace()` is triggered during this test run, but the usual `inspect` thing does not print anything:\n\n```diff\n--- a/src/sage/interfaces/gap.py\n+++ b/src/sage/interfaces/gap.py\n@@ -1575,6 +1575,11 @@ def gap_reset_workspace(max_workspace_size=None, verbose=False):\n         sage: sage.interfaces.gap.WORKSPACE = ORIGINAL_WORKSPACE\n     \"\"\"\n     # Create new workspace with filename WORKSPACE\n+    import inspect\n+    curframe = inspect.currentframe()\n+    calframe = inspect.getouterframes(curframe, 2)\n+    print('caller name:', calframe[1][3])\n+\n     g = Gap(use_workspace_cache=False, max_workspace_size=None)\n     g.eval('SetUserPreference(\"HistoryMaxLines\", 30)')\n     from sage.tests.gap_packages import all_installed_packages\n```\nyes the GAP workspace is changed during the test run!",
    "created_at": "2019-05-07T09:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428908",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

How does one check the caller stack while running tests? I would like to see where `gap_reset_workspace()` is triggered during this test run, but the usual `inspect` thing does not print anything:

```diff
--- a/src/sage/interfaces/gap.py
+++ b/src/sage/interfaces/gap.py
@@ -1575,6 +1575,11 @@ def gap_reset_workspace(max_workspace_size=None, verbose=False):
         sage: sage.interfaces.gap.WORKSPACE = ORIGINAL_WORKSPACE
     """
     # Create new workspace with filename WORKSPACE
+    import inspect
+    curframe = inspect.currentframe()
+    calframe = inspect.getouterframes(curframe, 2)
+    print('caller name:', calframe[1][3])
+
     g = Gap(use_workspace_cache=False, max_workspace_size=None)
     g.eval('SetUserPreference("HistoryMaxLines", 30)')
     from sage.tests.gap_packages import all_installed_packages
```
yes the GAP workspace is changed during the test run!



---

archive/issue_comments_428909.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nmore precisely, the workspace stays the same (seems to, according to md5), but here is what I see\n\n```\n$ stat .sage/gap/gap-workspace-0x2bfc9c9be8a26a98 \n  File: .sage/gap/gap-workspace-0x2bfc9c9be8a26a98\n  Size: 143113403 \tBlocks: 279528     IO Block: 4096   regular file\nDevice: 10304h/66308d\tInode: 3328612     Links: 1\nAccess: (0644/-rw-r--r--)  Uid: ( 1000/    dima)   Gid: ( 1000/    dima)\nAccess: 2019-05-07 11:05:02.276613187 +0100\nModify: 2019-05-07 11:05:02.276613187 +0100\nChange: 2019-05-07 11:05:02.276613187 +0100\n Birth: 2019-05-06 12:50:31.880862790 +0100\n```",
    "created_at": "2019-05-07T10:50:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428909",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">comment:19</div>

more precisely, the workspace stays the same (seems to, according to md5), but here is what I see

```
$ stat .sage/gap/gap-workspace-0x2bfc9c9be8a26a98 
  File: .sage/gap/gap-workspace-0x2bfc9c9be8a26a98
  Size: 143113403 	Blocks: 279528     IO Block: 4096   regular file
Device: 10304h/66308d	Inode: 3328612     Links: 1
Access: (0644/-rw-r--r--)  Uid: ( 1000/    dima)   Gid: ( 1000/    dima)
Access: 2019-05-07 11:05:02.276613187 +0100
Modify: 2019-05-07 11:05:02.276613187 +0100
Change: 2019-05-07 11:05:02.276613187 +0100
 Birth: 2019-05-06 12:50:31.880862790 +0100
```



---

archive/issue_comments_428910.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nOne way would be to run the test with `--serial`.",
    "created_at": "2019-05-07T12:28:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428910",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

One way would be to run the test with `--serial`.



---

archive/issue_comments_428911.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@embray](#comment%3A20):\n> One way would be to run the test with `--serial`.\n\nI don't see how `--serial` matters - unless it can be used to run a script after each test...\n\nBy the way, on the Fedora system I see these errors, running with `--serial` allows the tests to pass. (The GAP workspace is still being changed).",
    "created_at": "2019-05-07T13:26:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428911",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@embray](#comment%3A20):
> One way would be to run the test with `--serial`.

I don't see how `--serial` matters - unless it can be used to run a script after each test...

By the way, on the Fedora system I see these errors, running with `--serial` allows the tests to pass. (The GAP workspace is still being changed).



---

archive/issue_comments_428912.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nYou can put `import pdb; pdb.set_trace()` in a function, and then run the tests with `--serial` and break where the function is first called.  This is how I found that it was originally being called by `all_installed_packages`.",
    "created_at": "2019-05-07T14:57:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428912",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">comment:22</div>

You can put `import pdb; pdb.set_trace()` in a function, and then run the tests with `--serial` and break where the function is first called.  This is how I found that it was originally being called by `all_installed_packages`.



---

archive/issue_comments_428913.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nOK, I was able to find where the workspace is accessed (more precisely, `os.utime()` is called on it, and commented it  out, and still get the same crashes.\n\nSo it is a race condition, as `--serial` allows the tests to pass, but it appears that it has nothing to do with GAP or libgap workspaces.",
    "created_at": "2019-05-07T15:40:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428913",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:23" align="right">comment:23</div>

OK, I was able to find where the workspace is accessed (more precisely, `os.utime()` is called on it, and commented it  out, and still get the same crashes.

So it is a race condition, as `--serial` allows the tests to pass, but it appears that it has nothing to do with GAP or libgap workspaces.



---

archive/issue_comments_428914.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nBut what would be *racing*?  If you run a single test module then there's still only one test running concurrently, so there's nothing for it to race against.",
    "created_at": "2019-05-07T16:09:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428914",
    "user": "https://github.com/embray"
}
```

<div id="comment:24" align="right">comment:24</div>

But what would be *racing*?  If you run a single test module then there's still only one test running concurrently, so there's nothing for it to race against.



---

archive/issue_comments_428915.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nwhatever `--serial` is doing, it removes some parallelism somewhere, I gather.",
    "created_at": "2019-05-07T16:20:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428915",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:25" align="right">comment:25</div>

whatever `--serial` is doing, it removes some parallelism somewhere, I gather.



---

archive/issue_comments_428916.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThat's exactly what it's doing.  Normally the doctests for each module are run in a separate process.  `--serial` makes it run in the same process that started the test runner.\n\nIIRC I was *not* able to reproduce the problem with `--serial` but now I can't remember for sure.  My point is that it's just an easier way to run the test interactively and stop at a breakpoint.",
    "created_at": "2019-05-07T17:36:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428916",
    "user": "https://github.com/embray"
}
```

<div id="comment:26" align="right">comment:26</div>

That's exactly what it's doing.  Normally the doctests for each module are run in a separate process.  `--serial` makes it run in the same process that started the test runner.

IIRC I was *not* able to reproduce the problem with `--serial` but now I can't remember for sure.  My point is that it's just an easier way to run the test interactively and stop at a breakpoint.



---

archive/issue_comments_428917.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nIf there is a problem here, it's with doctest framework. Otherwise, looks good.",
    "created_at": "2019-05-08T07:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428917",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:27" align="right">comment:27</div>

If there is a problem here, it's with doctest framework. Otherwise, looks good.



---

archive/issue_events_376872.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-08T07:03:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376872"
}
```



---

archive/issue_events_376873.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-08T07:03:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376873"
}
```



---

archive/issue_comments_428918.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2019-05-08T07:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428918",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_428919.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@dimpase](#comment%3A27):\n> If there is a problem here, it's with doctest framework. Otherwise, looks good.\n\nI'm not sure how you concluded that, but it is a possibility I suppose.  I'd be more concerned that it's a problem with forking, which *does* happen when running the doctests, but doesn't normally happen when running interactively.  So it can make things difficult to reproduce.  Nevertheless, I can't reliably reproduce the issue anymore either, and the one thing I did fix here seems to help a bit...",
    "created_at": "2019-05-09T15:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428919",
    "user": "https://github.com/embray"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@dimpase](#comment%3A27):
> If there is a problem here, it's with doctest framework. Otherwise, looks good.

I'm not sure how you concluded that, but it is a possibility I suppose.  I'd be more concerned that it's a problem with forking, which *does* happen when running the doctests, but doesn't normally happen when running interactively.  So it can make things difficult to reproduce.  Nevertheless, I can't reliably reproduce the issue anymore either, and the one thing I did fix here seems to help a bit...



---

archive/issue_events_376874.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-05-14T12:37:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376874"
}
```



---

archive/issue_events_376875.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "8f5c3fc4c12cb4eaa1528108947c960e4512f6e2",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-05-14T12:37:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376875"
}
```



---

archive/issue_comments_428920.json:
```json
{
    "body": "Changed branch from **[u/embray/ticket-27681](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27681)** to **[`ecacac8`](https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6)**",
    "created_at": "2019-05-14T12:37:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428920",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/ticket-27681](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27681)** to **[`ecacac8`](https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6)**



---

archive/issue_comments_428921.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI have just noticed this ticket. And it gave me a little bit of fun chasing it (I don't know how Volker merged it, it doesn't show where I expect).\n\nSo I got that interesting failure in sage-on-gentoo\n\n```\nFile \"/usr/lib64/python2.7/site-packages/sage/tests/gap_packages.py\", line 137, in sage.tests.gap_packages.all_installed_packages\nFailed example:\n    all_installed_packages() == all_installed_packages(gap=gap)\nExpected:\n    True\nGot:\n    False\n```\n\nAfter some inspection\n\n```\nsage: from sage.tests.gap_packages import all_installed_packages\nsage: all_installed_packages()\n('AtlasRep',\n 'AutoDoc',\n 'FactInt',\n 'GAPDoc',\n 'Hap',\n 'MapClass',\n 'SmallGrp',\n 'Toric',\n 'aclib',\n 'alnuth',\n 'atlasrep',\n 'autpgrp',\n 'cohomolo',\n 'corelg',\n 'crime',\n 'crisp',\n 'crypting',\n 'cryst',\n 'crystcat',\n 'ctbllib',\n 'design',\n 'digraphs',\n 'fga',\n 'gbnp',\n 'genss',\n 'grape',\n 'guava',\n 'hecke',\n 'io',\n 'irredsol',\n 'laguna',\n 'liealgdb',\n 'liepring',\n 'liering',\n 'loops',\n 'nq',\n 'orb',\n 'polenta',\n 'polycyclic',\n 'primgrp',\n 'qpa',\n 'quagroup',\n 'radiroot',\n 'resclasses',\n 'semigroups',\n 'sla',\n 'sonata',\n 'sophus',\n 'tomlib',\n 'transgrp',\n 'utils')\nsage: all_installed_packages(gap=gap)\n('AutoDoc',\n 'FactInt',\n 'GAPDoc',\n 'Hap',\n 'MapClass',\n 'SmallGrp',\n 'Toric',\n 'aclib',\n 'alnuth',\n 'atlasrep',\n 'autpgrp',\n 'cohomolo',\n 'corelg',\n 'crime',\n 'crisp',\n 'crypting',\n 'cryst',\n 'crystcat',\n 'ctbllib',\n 'design',\n 'digraphs',\n 'fga',\n 'gbnp',\n 'genss',\n 'grape',\n 'guava',\n 'hecke',\n 'io',\n 'irredsol',\n 'laguna',\n 'liealgdb',\n 'liepring',\n 'liering',\n 'loops',\n 'nq',\n 'orb',\n 'polenta',\n 'polycyclic',\n 'primgrp',\n 'qpa',\n 'quagroup',\n 'radiroot',\n 'resclasses',\n 'semigroups',\n 'sla',\n 'sonata',\n 'sophus',\n 'tomlib',\n 'transgrp',\n 'utils')\n```\nThe leading `AtlasRep` is in fact something I had forgotten in my `~/.gap` and that will soon be cleaned. But it points to the fact that the way we start `gap`'s pexpect interface makes it ignore `.gap`. You could say we start `gap` in a mode that also happens to be a \"safe mode\" (all your personal settings ignored) and that really should be a different option upstream.\n\nIn the meantime, should we amend the test so that `ignore_dot_gap=True` in both case in a follow up ticket.",
    "created_at": "2019-05-14T23:53:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428921",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:30" align="right">comment:30</div>

I have just noticed this ticket. And it gave me a little bit of fun chasing it (I don't know how Volker merged it, it doesn't show where I expect).

So I got that interesting failure in sage-on-gentoo

```
File "/usr/lib64/python2.7/site-packages/sage/tests/gap_packages.py", line 137, in sage.tests.gap_packages.all_installed_packages
Failed example:
    all_installed_packages() == all_installed_packages(gap=gap)
Expected:
    True
Got:
    False
```

After some inspection

```
sage: from sage.tests.gap_packages import all_installed_packages
sage: all_installed_packages()
('AtlasRep',
 'AutoDoc',
 'FactInt',
 'GAPDoc',
 'Hap',
 'MapClass',
 'SmallGrp',
 'Toric',
 'aclib',
 'alnuth',
 'atlasrep',
 'autpgrp',
 'cohomolo',
 'corelg',
 'crime',
 'crisp',
 'crypting',
 'cryst',
 'crystcat',
 'ctbllib',
 'design',
 'digraphs',
 'fga',
 'gbnp',
 'genss',
 'grape',
 'guava',
 'hecke',
 'io',
 'irredsol',
 'laguna',
 'liealgdb',
 'liepring',
 'liering',
 'loops',
 'nq',
 'orb',
 'polenta',
 'polycyclic',
 'primgrp',
 'qpa',
 'quagroup',
 'radiroot',
 'resclasses',
 'semigroups',
 'sla',
 'sonata',
 'sophus',
 'tomlib',
 'transgrp',
 'utils')
sage: all_installed_packages(gap=gap)
('AutoDoc',
 'FactInt',
 'GAPDoc',
 'Hap',
 'MapClass',
 'SmallGrp',
 'Toric',
 'aclib',
 'alnuth',
 'atlasrep',
 'autpgrp',
 'cohomolo',
 'corelg',
 'crime',
 'crisp',
 'crypting',
 'cryst',
 'crystcat',
 'ctbllib',
 'design',
 'digraphs',
 'fga',
 'gbnp',
 'genss',
 'grape',
 'guava',
 'hecke',
 'io',
 'irredsol',
 'laguna',
 'liealgdb',
 'liepring',
 'liering',
 'loops',
 'nq',
 'orb',
 'polenta',
 'polycyclic',
 'primgrp',
 'qpa',
 'quagroup',
 'radiroot',
 'resclasses',
 'semigroups',
 'sla',
 'sonata',
 'sophus',
 'tomlib',
 'transgrp',
 'utils')
```
The leading `AtlasRep` is in fact something I had forgotten in my `~/.gap` and that will soon be cleaned. But it points to the fact that the way we start `gap`'s pexpect interface makes it ignore `.gap`. You could say we start `gap` in a mode that also happens to be a "safe mode" (all your personal settings ignored) and that really should be a different option upstream.

In the meantime, should we amend the test so that `ignore_dot_gap=True` in both case in a follow up ticket.



---

archive/issue_comments_428922.json:
```json
{
    "body": "Changed commit from **[`ecacac8`](https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6)** to none",
    "created_at": "2019-05-14T23:53:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428922",
    "user": "https://github.com/kiwifb"
}
```

Changed commit from **[`ecacac8`](https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6)** to none



---

archive/issue_comments_428923.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nJust to document so I can point to it next time. In gap-4.10.1 you have the file `src/system.c` which controls many OS dependent things including how gap starts. Currently line 1297 onwards\n\n```\n#ifdef HAVE_DOTGAPRC\n    /* the users home directory                                            */\n    if ( getenv(\"HOME\") != 0 ) {\n        strxcpy(DotGapPath, getenv(\"HOME\"), sizeof(DotGapPath));\n# if defined(SYS_IS_DARWIN) && SYS_IS_DARWIN\n        /* On Darwin, add .gap to the sys roots, but leave */\n        /* DotGapPath at $HOME/Library/Preferences/GAP     */\n        strxcat(DotGapPath, \"/.gap;\", sizeof(DotGapPath));\n        if (!IgnoreGapRC) {\n          SySetGapRootPath(DotGapPath);\n        }\n\t\t\n        strxcpy(DotGapPath, getenv(\"HOME\"), sizeof(DotGapPath));\n        strxcat(DotGapPath, \"/Library/Preferences/GAP;\", sizeof(DotGapPath));\n# elif defined(__CYGWIN__)\n        strxcat(DotGapPath, \"/_gap;\", sizeof(DotGapPath));\n# else\n        strxcat(DotGapPath, \"/.gap;\", sizeof(DotGapPath));\n# endif\n\n        if (!IgnoreGapRC) {\n          SySetGapRootPath(DotGapPath);\n        }\n```\nSo if `IgnoreGapRC` is \"false\" you get `.gap`. Where is that variable coming from? It is documented in the same file at line 150\n\n```\n/****************************************************************************\n**\n*V  IgnoreGapRC . . . . . . . . . . . . . . . . . . . -r option for kernel\n**\n*/\nInt IgnoreGapRC;\n```\nand finally more interestingly we have this at line 1077\n\n```\n  { 'r', \"\", toggle, &IgnoreGapRC, 0 }, /* kernel */\n```\nand in sage we have in `sage/interfaces/gap.py` at line 205\n\n```\ngap_cmd = \"gap -r\"\n```\nAt this stage I don't know if that option is a remnant of gap-4.8 and lower or if it is really needed.",
    "created_at": "2019-05-15T00:37:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428923",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:31" align="right">comment:31</div>

Just to document so I can point to it next time. In gap-4.10.1 you have the file `src/system.c` which controls many OS dependent things including how gap starts. Currently line 1297 onwards

```
#ifdef HAVE_DOTGAPRC
    /* the users home directory                                            */
    if ( getenv("HOME") != 0 ) {
        strxcpy(DotGapPath, getenv("HOME"), sizeof(DotGapPath));
# if defined(SYS_IS_DARWIN) && SYS_IS_DARWIN
        /* On Darwin, add .gap to the sys roots, but leave */
        /* DotGapPath at $HOME/Library/Preferences/GAP     */
        strxcat(DotGapPath, "/.gap;", sizeof(DotGapPath));
        if (!IgnoreGapRC) {
          SySetGapRootPath(DotGapPath);
        }
		
        strxcpy(DotGapPath, getenv("HOME"), sizeof(DotGapPath));
        strxcat(DotGapPath, "/Library/Preferences/GAP;", sizeof(DotGapPath));
# elif defined(__CYGWIN__)
        strxcat(DotGapPath, "/_gap;", sizeof(DotGapPath));
# else
        strxcat(DotGapPath, "/.gap;", sizeof(DotGapPath));
# endif

        if (!IgnoreGapRC) {
          SySetGapRootPath(DotGapPath);
        }
```
So if `IgnoreGapRC` is "false" you get `.gap`. Where is that variable coming from? It is documented in the same file at line 150

```
/****************************************************************************
**
*V  IgnoreGapRC . . . . . . . . . . . . . . . . . . . -r option for kernel
**
*/
Int IgnoreGapRC;
```
and finally more interestingly we have this at line 1077

```
  { 'r', "", toggle, &IgnoreGapRC, 0 }, /* kernel */
```
and in sage we have in `sage/interfaces/gap.py` at line 205

```
gap_cmd = "gap -r"
```
At this stage I don't know if that option is a remnant of gap-4.8 and lower or if it is really needed.



---

archive/issue_comments_428924.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nFollow up at #27878",
    "created_at": "2019-05-28T00:04:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428924",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:32" align="right">comment:32</div>

Follow up at #27878



---

archive/issue_comments_428925.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nUsing 8.8.rc2 with Python 2, I still consistently get the same error as in [comment:15](#comment%3A15). This is on CentOS Linux release 7.6.1810 (Core). Using `--serial` makes the test pass.",
    "created_at": "2019-06-22T08:46:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428925",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:33" align="right">comment:33</div>

Using 8.8.rc2 with Python 2, I still consistently get the same error as in [comment:15](#comment%3A15). This is on CentOS Linux release 7.6.1810 (Core). Using `--serial` makes the test pass.



---

archive/issue_comments_428926.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI was able to reproduce this again in #18267 specifically.",
    "created_at": "2019-06-25T16:01:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428926",
    "user": "https://github.com/embray"
}
```

<div id="comment:34" align="right">comment:34</div>

I was able to reproduce this again in #18267 specifically.



---

archive/issue_comments_428927.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@mwageringel](#comment%3A33):\n> Using 8.8.rc2 with Python 2, I still consistently get the same error as in [comment:15](#comment%3A15). This is on CentOS Linux release 7.6.1810 (Core). Using `--serial` makes the test pass.\n\nThanks for the info; that's interesting (and strange).  I'm still struggling to find a way to reliably reproduce this, though it's good to know that `--serial` made it pass for you.  It makes me wonder if there is some subtle bug with libgap post-fork.",
    "created_at": "2019-07-03T12:58:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428927",
    "user": "https://github.com/embray"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@mwageringel](#comment%3A33):
> Using 8.8.rc2 with Python 2, I still consistently get the same error as in [comment:15](#comment%3A15). This is on CentOS Linux release 7.6.1810 (Core). Using `--serial` makes the test pass.

Thanks for the info; that's interesting (and strange).  I'm still struggling to find a way to reliably reproduce this, though it's good to know that `--serial` made it pass for you.  It makes me wonder if there is some subtle bug with libgap post-fork.



---

archive/issue_comments_428928.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI've opened #28106 to track this issue further.",
    "created_at": "2019-07-03T15:13:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428928",
    "user": "https://github.com/embray"
}
```

<div id="comment:36" align="right">comment:36</div>

I've opened #28106 to track this issue further.



---

archive/issue_comments_428929.json:
```json
{
    "body": "Changed branch from **[`ecacac8`](https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6)** to **[u/embray/ticket-27681](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27681)**",
    "created_at": "2019-07-13T11:58:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428929",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[`ecacac8`](https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6)** to **[u/embray/ticket-27681](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27681)**



---

archive/issue_comments_428930.json:
```json
{
    "body": "Commit: **[`ecacac8`](https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6)**",
    "created_at": "2019-07-13T11:58:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428930",
    "user": "https://github.com/vbraun"
}
```

Commit: **[`ecacac8`](https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6)**



---

archive/issue_comments_428931.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReopening as it breaks the buildbot",
    "created_at": "2019-07-13T11:58:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428931",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:37" align="right">comment:37</div>

Reopening as it breaks the buildbot



---

archive/issue_events_376876.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-13T11:58:50Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376876"
}
```



---

archive/issue_comments_428932.json:
```json
{
    "body": "Changed dependencies from **#27680** to **#27680, #28106**",
    "created_at": "2019-07-13T11:58:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428932",
    "user": "https://github.com/vbraun"
}
```

Changed dependencies from **#27680** to **#27680, #28106**



---

archive/issue_events_376877.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-13T11:59:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376877"
}
```



---

archive/issue_events_376878.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-13T11:59:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376878"
}
```



---

archive/issue_events_376879.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-13T11:59:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376879"
}
```



---

archive/issue_comments_428933.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nSetting this back to positive review assuming that it'll be fixed in #28106",
    "created_at": "2019-07-13T11:59:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428933",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:39" align="right">comment:39</div>

Setting this back to positive review assuming that it'll be fixed in #28106



---

archive/issue_comments_428934.json:
```json
{
    "body": "Changed dependencies from **#27680, #28106** to **27680, 28106**",
    "created_at": "2019-07-13T12:01:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428934",
    "user": "https://github.com/vbraun"
}
```

Changed dependencies from **#27680, #28106** to **27680, 28106**



---

archive/issue_comments_428935.json:
```json
{
    "body": "Changed branch from **[u/embray/ticket-27681](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27681)** to **[`ecacac8`](https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6)**",
    "created_at": "2019-07-13T12:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428935",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/ticket-27681](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27681)** to **[`ecacac8`](https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6)**



---

archive/issue_comments_428936.json:
```json
{
    "body": "Changed commit from **[`ecacac8`](https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6)** to none",
    "created_at": "2019-07-13T12:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428936",
    "user": "https://github.com/vbraun"
}
```

Changed commit from **[`ecacac8`](https://github.com/sagemath/sagetrac-mirror/commit/ecacac8b9440cb8ac1950a3d0619a50cbb19ede6)** to none



---

archive/issue_events_376880.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-13T12:09:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376880"
}
```



---

archive/issue_events_376881.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-13T12:09:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27681#event-376881"
}
```



---

archive/issue_comments_428937.json:
```json
{
    "body": "Changed dependencies from **27680, 28106** to **#27680**",
    "created_at": "2019-07-13T12:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428937",
    "user": "https://github.com/vbraun"
}
```

Changed dependencies from **27680, 28106** to **#27680**



---

archive/issue_comments_428938.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nWrong ticket, sorry for the noise",
    "created_at": "2019-07-13T12:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27681#issuecomment-428938",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:41" align="right">comment:41</div>

Wrong ticket, sorry for the noise
