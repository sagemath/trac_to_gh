# Issue 27067: py3: Simplicial complexes: fix is_isomorphic

archive/issues_026830.json:
```json
{
    "body": "The method `is_isomorphic` for simplicial complexes doesn't work with Python 3 for several reasons. The method constructs graphs associated to `self` and `other` and then tests whether they are isomorphic, preserving edge labels.\n\n- Some of the edges have labels and some don't, and this is not handled gracefully, so we give all edges labels.\n- The vertices and/or facets in the complexes can't be sorted in Python 3, so we translate them all to Python `int`s, sort those, and then translate back if we need to.\n\nKeywords: python3, simplicial complexes\n\nBranch/Commit: af9e661f6fb9bad1263701f5bedaafa6d7e9f396\n\nReviewer: Darij Grinberg\n\nAuthor: John Palmieri\n\nDependencies: #26966, #27027\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27067\n\n",
    "closed_at": "2019-02-05T16:57:36Z",
    "created_at": "2019-01-15T22:30:35Z",
    "labels": [
        "component: python3",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "py3: Simplicial complexes: fix is_isomorphic",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27067",
    "user": "https://github.com/jhpalmieri"
}
```
The method `is_isomorphic` for simplicial complexes doesn't work with Python 3 for several reasons. The method constructs graphs associated to `self` and `other` and then tests whether they are isomorphic, preserving edge labels.

- Some of the edges have labels and some don't, and this is not handled gracefully, so we give all edges labels.
- The vertices and/or facets in the complexes can't be sorted in Python 3, so we translate them all to Python `int`s, sort those, and then translate back if we need to.

Keywords: python3, simplicial complexes

Branch/Commit: af9e661f6fb9bad1263701f5bedaafa6d7e9f396

Reviewer: Darij Grinberg

Author: John Palmieri

Dependencies: #26966, #27027

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27067





---

archive/issue_comments_520570.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jhpalmieri/simplicial-complex-graphs\"",
    "created_at": "2019-01-15T22:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520570",
    "user": "https://github.com/jhpalmieri"
}
```

Changing branch from "" to "u/jhpalmieri/simplicial-complex-graphs"



---

archive/issue_comments_520571.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|\n|[29ade7e](https://git.sagemath.org/sage.git/commit?id=29ade7e2a0b376e2cf203ef7aa6126b094db5666)|`trac 26966: simplicial complexes: do not publicly sort vertices any more.`|\n|[b325350](https://git.sagemath.org/sage.git/commit?id=b32535053b87455000c3f6b6f227b5d436c295ca)|`trac 26966: Remove vertex_set. Use dict comprehension.`|\n|[e79fd39](https://git.sagemath.org/sage.git/commit?id=e79fd391f07fb49fd5bee4fbace4d1258065a5db)|`trac 26966: always sort vertices using key=str`|\n|[f4a672c](https://git.sagemath.org/sage.git/commit?id=f4a672c94202bae95cb00c07e7318211f50ca9b0)|`trac 26966: do not sort vertices. Allow the user to specify sort_facets,`|\n|[41eeaf5](https://git.sagemath.org/sage.git/commit?id=41eeaf587878efcdec3499b49353bfe1dfeb7993)|`typo`|\n|[95f6026](https://git.sagemath.org/sage.git/commit?id=95f6026404128b5fb82ddc27aa741fd2c20a4978)|`trac 26966: minor code cleanup`|\n|[17cee8c](https://git.sagemath.org/sage.git/commit?id=17cee8c1ef3b7d5d7ba858591f22d9d26458b51f)|`trac 26067: fix the simplicial complex method is_isomorphic to work`|",
    "created_at": "2019-01-15T22:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520571",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|
|[29ade7e](https://git.sagemath.org/sage.git/commit?id=29ade7e2a0b376e2cf203ef7aa6126b094db5666)|`trac 26966: simplicial complexes: do not publicly sort vertices any more.`|
|[b325350](https://git.sagemath.org/sage.git/commit?id=b32535053b87455000c3f6b6f227b5d436c295ca)|`trac 26966: Remove vertex_set. Use dict comprehension.`|
|[e79fd39](https://git.sagemath.org/sage.git/commit?id=e79fd391f07fb49fd5bee4fbace4d1258065a5db)|`trac 26966: always sort vertices using key=str`|
|[f4a672c](https://git.sagemath.org/sage.git/commit?id=f4a672c94202bae95cb00c07e7318211f50ca9b0)|`trac 26966: do not sort vertices. Allow the user to specify sort_facets,`|
|[41eeaf5](https://git.sagemath.org/sage.git/commit?id=41eeaf587878efcdec3499b49353bfe1dfeb7993)|`typo`|
|[95f6026](https://git.sagemath.org/sage.git/commit?id=95f6026404128b5fb82ddc27aa741fd2c20a4978)|`trac 26966: minor code cleanup`|
|[17cee8c](https://git.sagemath.org/sage.git/commit?id=17cee8c1ef3b7d5d7ba858591f22d9d26458b51f)|`trac 26067: fix the simplicial complex method is_isomorphic to work`|



---

archive/issue_comments_520572.json:
```json
{
    "body": "Changing commit from \"\" to \"17cee8c1ef3b7d5d7ba858591f22d9d26458b51f\"",
    "created_at": "2019-01-15T22:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520572",
    "user": "https://github.com/jhpalmieri"
}
```

Changing commit from "" to "17cee8c1ef3b7d5d7ba858591f22d9d26458b51f"



---

archive/issue_comments_520573.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-01-15T22:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520573",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_520574.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|\n|[af9e661](https://git.sagemath.org/sage.git/commit/?id=af9e661f6fb9bad1263701f5bedaafa6d7e9f396)|`trac 27067: fix the simplicial complex method is_isomorphic to work`|",
    "created_at": "2019-01-15T23:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520574",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|
|[af9e661](https://git.sagemath.org/sage.git/commit/?id=af9e661f6fb9bad1263701f5bedaafa6d7e9f396)|`trac 27067: fix the simplicial complex method is_isomorphic to work`|



---

archive/issue_comments_520575.json:
```json
{
    "body": "Changing commit from \"17cee8c1ef3b7d5d7ba858591f22d9d26458b51f\" to \"af9e661f6fb9bad1263701f5bedaafa6d7e9f396\"",
    "created_at": "2019-01-15T23:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520575",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "17cee8c1ef3b7d5d7ba858591f22d9d26458b51f" to "af9e661f6fb9bad1263701f5bedaafa6d7e9f396"



---

archive/issue_comments_520576.json:
```json
{
    "body": "<a id='comment:4'></a>\ntwo failing doctests, see patchbot\n\nMaybe try to make them more robust ?",
    "created_at": "2019-01-16T09:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520576",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
two failing doctests, see patchbot

Maybe try to make them more robust ?



---

archive/issue_comments_520577.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-01-16T09:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520577",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_520578.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-01-16T17:04:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520578",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_520579.json:
```json
{
    "body": "<a id='comment:5'></a>\nThat test is fixed by #27027, one of the dependencies. Let's wait until it's merged and then try this again.",
    "created_at": "2019-01-16T17:04:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520579",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
That test is fixed by #27027, one of the dependencies. Let's wait until it's merged and then try this again.



---

archive/issue_comments_520580.json:
```json
{
    "body": "<a id='comment:6'></a>\n(The branch from #26966 is included here because there would be merge conflicts otherwise. I didn't include the one from #27027. I never know the right way to handle dependencies like this.)",
    "created_at": "2019-01-16T17:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520580",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>
(The branch from #26966 is included here because there would be merge conflicts otherwise. I didn't include the one from #27027. I never know the right way to handle dependencies like this.)



---

archive/issue_comments_520581.json:
```json
{
    "body": "<a id='comment:7'></a>\nOkay, please try this again now (you probably have to rebase onto 8.7.beta2).",
    "created_at": "2019-02-03T22:59:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520581",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
Okay, please try this again now (you probably have to rebase onto 8.7.beta2).



---

archive/issue_comments_520582.json:
```json
{
    "body": "<a id='comment:8'></a>\nThe code LGTM, but please add a doctest showing that the two possible simplicial complexes on a 1-element set (one consisting of just the empty set, and another that is the whole powerset) are not isomorphic -- this is a bit of an edge case for the implementation.",
    "created_at": "2019-02-04T03:16:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520582",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:8'></a>
The code LGTM, but please add a doctest showing that the two possible simplicial complexes on a 1-element set (one consisting of just the empty set, and another that is the whole powerset) are not isomorphic -- this is a bit of an edge case for the implementation.



---

archive/issue_comments_520583.json:
```json
{
    "body": "<a id='comment:9'></a>\nI'm not sure I understand. Every vertex in a simplicial set must be in a facet, or to put it another way, the vertices in a simplicial set are formed by taking the union of the facets. (I'm talking about how things are implemented in Sage.) So if you have a vertex, you can't have the empty simplicial set. I can add this:\n\n```\nsage: S = SimplicialComplex()\nsage: T = SimplicialComplex([0])\nsage: S.is_isomorphic(T)\nFalse\n```\nand/or this:\n\n```\nsage: T.remove_face([0])\nsage: S.is_isomorphic(T)\nTrue\n```",
    "created_at": "2019-02-04T03:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520583",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
I'm not sure I understand. Every vertex in a simplicial set must be in a facet, or to put it another way, the vertices in a simplicial set are formed by taking the union of the facets. (I'm talking about how things are implemented in Sage.) So if you have a vertex, you can't have the empty simplicial set. I can add this:

```
sage: S = SimplicialComplex()
sage: T = SimplicialComplex([0])
sage: S.is_isomorphic(T)
False
```
and/or this:

```
sage: T.remove_face([0])
sage: S.is_isomorphic(T)
True
```



---

archive/issue_comments_520584.json:
```json
{
    "body": "<a id='comment:10'></a>\nDoes Sage really forbid ghost vertices? If so, then it's a non-issue, though it's a bad decision if you ask me.",
    "created_at": "2019-02-04T03:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520584",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:10'></a>
Does Sage really forbid ghost vertices? If so, then it's a non-issue, though it's a bad decision if you ask me.



---

archive/issue_comments_520585.json:
```json
{
    "body": "<a id='comment:11'></a>\nAnd then the doc here:\n\n```\nThis module implements the basic structure of finite simplicial\ncomplexes. Given a set `V` of \"vertices\", a simplicial complex on `V`\nis a collection `K` of subsets of `V` satisfying the condition that if\n`S` is one of the subsets in `K`, then so is every subset of `S`.  The\nsubsets `S` are called the 'simplices' of `K`.\n```\nis wrong, as it says nothing about ghost vertices being forbidden.",
    "created_at": "2019-02-04T03:36:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520585",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:11'></a>
And then the doc here:

```
This module implements the basic structure of finite simplicial
complexes. Given a set `V` of "vertices", a simplicial complex on `V`
is a collection `K` of subsets of `V` satisfying the condition that if
`S` is one of the subsets in `K`, then so is every subset of `S`.  The
subsets `S` are called the 'simplices' of `K`.
```
is wrong, as it says nothing about ghost vertices being forbidden.



---

archive/issue_comments_520586.json:
```json
{
    "body": "<a id='comment:12'></a>\nYou're right that the documentation is out-dated. I'm curious about \"ghost vertices\". For example, why should the empty simplicial complex on vertices {1,2} be considered different from the empty simplicial complex on vertices {4,5,6,7}?",
    "created_at": "2019-02-04T03:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520586",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
You're right that the documentation is out-dated. I'm curious about "ghost vertices". For example, why should the empty simplicial complex on vertices {1,2} be considered different from the empty simplicial complex on vertices {4,5,6,7}?



---

archive/issue_comments_520587.json:
```json
{
    "body": "<a id='comment:13'></a>\nIf you don't keep the ghost vertices around, then the link of a vertex of a simplicial complex may lose vertices. Somehow I doubt this is a good thing. Then again I haven't done much with simplicial complexes, so I don't know what is actually good in practice.",
    "created_at": "2019-02-04T04:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520587",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:13'></a>
If you don't keep the ghost vertices around, then the link of a vertex of a simplicial complex may lose vertices. Somehow I doubt this is a good thing. Then again I haven't done much with simplicial complexes, so I don't know what is actually good in practice.



---

archive/issue_comments_520588.json:
```json
{
    "body": "<a id='comment:14'></a>\nI don't know of any computational reason, in particular any reason within Sage, why it should matter if link(sigma) and the ambient simplicial complex should have the same or different vertex sets.",
    "created_at": "2019-02-04T04:29:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520588",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>
I don't know of any computational reason, in particular any reason within Sage, why it should matter if link(sigma) and the ambient simplicial complex should have the same or different vertex sets.



---

archive/issue_comments_520589.json:
```json
{
    "body": "<a id='comment:15'></a>\nOK, then this should be reflected in the doc.",
    "created_at": "2019-02-04T04:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520589",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:15'></a>
OK, then this should be reflected in the doc.



---

archive/issue_comments_520590.json:
```json
{
    "body": "<a id='comment:16'></a>\nSee #27211 for the documentation change.",
    "created_at": "2019-02-04T04:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520590",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>
See #27211 for the documentation change.



---

archive/issue_comments_520591.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Darij Grinberg\"",
    "created_at": "2019-02-04T18:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520591",
    "user": "https://github.com/darijgr"
}
```

Changing reviewer from "" to "Darij Grinberg"



---

archive/issue_comments_520592.json:
```json
{
    "body": "Changing keywords from \"\" to \"python3, simplicial complexes\".",
    "created_at": "2019-02-04T18:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520592",
    "user": "https://github.com/darijgr"
}
```

Changing keywords from "" to "python3, simplicial complexes".



---

archive/issue_comments_520593.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-04T18:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520593",
    "user": "https://github.com/darijgr"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_520594.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-05T16:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520594",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_067236.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-05T16:57:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27067#event-67236"
}
```



---

archive/issue_comments_520595.json:
```json
{
    "body": "Changing branch from \"u/jhpalmieri/simplicial-complex-graphs\" to \"af9e661f6fb9bad1263701f5bedaafa6d7e9f396\"",
    "created_at": "2019-02-05T16:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27067#issuecomment-520595",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jhpalmieri/simplicial-complex-graphs" to "af9e661f6fb9bad1263701f5bedaafa6d7e9f396"
