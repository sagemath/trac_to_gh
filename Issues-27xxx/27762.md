# Issue 27762: Meta-ticket: Interoperability with the Julia language, use Julia packages

archive/issues_027525.json:
```json
{
    "assignees": [],
    "body": "https://julialang.org/\n\nTickets:\n- #17230: create a pexpect interface to julia\n- #28754: Make sage run in Julia's `python-jl`\n- Use https://github.com/JuliaPackaging/BinaryBuilder.jl\n- #31350: Julia package providing Sage\n\n\nCC:  @sebasguts @isuruf @saraedum @nthiery\n\nKeywords: **julia**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27762_\n\n",
    "created_at": "2019-05-03T09:43:42Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Meta-ticket: Interoperability with the Julia language, use Julia packages",
    "type": "issue",
    "updated_at": "2023-01-07T21:39:40Z",
    "url": "https://github.com/sagemath/sage/issues/27762",
    "user": "https://github.com/mkoeppe"
}
```
https://julialang.org/

Tickets:
- #17230: create a pexpect interface to julia
- #28754: Make sage run in Julia's `python-jl`
- Use https://github.com/JuliaPackaging/BinaryBuilder.jl
- #31350: Julia package providing Sage


CC:  @sebasguts @isuruf @saraedum @nthiery

Keywords: **julia**

_Issue created by migration from https://trac.sagemath.org/ticket/27762_





---

archive/issue_events_362670.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2019-05-03T09:43:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27762#event-362670"
}
```



---

archive/issue_events_362671.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2019-05-03T09:43:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "component: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27762#event-362671"
}
```



---

archive/issue_events_362672.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2019-05-03T09:43:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27762#event-362672"
}
```



---

archive/issue_comments_433652.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nAs the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27762#issuecomment-433652",
    "user": "https://github.com/embray"
}
```

<div id="comment:1" align="right">Comment 1</div>

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_events_362673.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:55:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27762#event-362673"
}
```



---

archive/issue_comments_433653.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,5 @@\n \n Tickets:\n - #17230: create a pexpect interface to julia\n+- #28754: Make sage run in Julia's `python-jl`\n \n``````\n",
    "created_at": "2019-11-17T22:46:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27762#issuecomment-433653",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,5 @@
 
 Tickets:
 - #17230: create a pexpect interface to julia
+- #28754: Make sage run in Julia's `python-jl`
 
``````




---

archive/issue_comments_433654.json:
```json
{
    "body": "Changed keywords from none to **julia**",
    "created_at": "2019-11-17T22:46:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27762#issuecomment-433654",
    "user": "https://github.com/mkoeppe"
}
```

Changed keywords from none to **julia**



---

archive/issue_events_362674.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-17T17:35:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "label": "https://github.com/sagemath/sage/labels/feature",
    "label_color": "008080",
    "label_name": "feature",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27762#event-362674"
}
```



---

archive/issue_events_362675.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-17T17:35:40Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "title_is": "Meta-ticket: Interoperability with the Julia language, use Julia packages",
    "title_was": "Meta-ticket: Julia",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27762#event-362675"
}
```



---

archive/issue_comments_433655.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,4 +3,4 @@\n Tickets:\n - #17230: create a pexpect interface to julia\n - #28754: Make sage run in Julia's `python-jl`\n-\n+- Use https://github.com/JuliaPackaging/BinaryBuilder.jl\n``````\n",
    "created_at": "2020-10-22T16:08:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27762#issuecomment-433655",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,4 +3,4 @@
 Tickets:
 - #17230: create a pexpect interface to julia
 - #28754: Make sage run in Julia's `python-jl`
-
+- Use https://github.com/JuliaPackaging/BinaryBuilder.jl
``````




---

archive/issue_comments_433656.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,3 +4,5 @@\n - #17230: create a pexpect interface to julia\n - #28754: Make sage run in Julia's `python-jl`\n - Use https://github.com/JuliaPackaging/BinaryBuilder.jl\n+- #31350: Julia package providing Sage\n+\n``````\n",
    "created_at": "2021-02-06T18:36:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27762#issuecomment-433656",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,3 +4,5 @@
 - #17230: create a pexpect interface to julia
 - #28754: Make sage run in Julia's `python-jl`
 - Use https://github.com/JuliaPackaging/BinaryBuilder.jl
+- #31350: Julia package providing Sage
+
``````




---

archive/issue_comments_433657.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nI'm at the Sage-OSCAR days this week and am interested in being able to use Oscar (a Julia package) from Sage.  There is PyJulia, but I wasn't able to get Oscar working from that.  There's William's old pexpect interface at #17230.  Has anyone tried something like this?",
    "created_at": "2021-02-15T20:43:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27762#issuecomment-433657",
    "user": "https://github.com/roed314"
}
```

<div id="comment:6" align="right">Comment 6</div>

I'm at the Sage-OSCAR days this week and am interested in being able to use Oscar (a Julia package) from Sage.  There is PyJulia, but I wasn't able to get Oscar working from that.  There's William's old pexpect interface at #17230.  Has anyone tried something like this?



---

archive/issue_comments_433658.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nI would recommend to start with the other direction, running Sage from Julia. I started #31350, see README at https://github.com/mkoeppe/SageMath.jl",
    "created_at": "2021-02-15T20:46:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27762#issuecomment-433658",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">Comment 7</div>

I would recommend to start with the other direction, running Sage from Julia. I started #31350, see README at https://github.com/mkoeppe/SageMath.jl



---

archive/issue_comments_433659.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nThanks!  I tried Variant 2 out using a normal build of Sage rather than a conda one and it worked.  I used\n\n```\njulia> ENV[\"PYTHON\"]=rstrip(read(`sage`, String))\njulia> using Pkg\njulia> Pkg.build(\"PyCall\")\njulia> using PyCall\njulia> sage_all = pyimport(\"sage.all\")\njulia> sage_all.ZZ(\"17\")\nPyObject 17\njulia> sage_all.polytopes.cube()\nPyObject A 3-dimensional polyhedron in ZZ^3 defined as the convex hull of 8 vertices\n```\n\nHave you thought much about going in the other direction?",
    "created_at": "2021-02-15T21:13:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27762#issuecomment-433659",
    "user": "https://github.com/roed314"
}
```

<div id="comment:9" align="right">Comment 9</div>

Thanks!  I tried Variant 2 out using a normal build of Sage rather than a conda one and it worked.  I used

```
julia> ENV["PYTHON"]=rstrip(read(`sage`, String))
julia> using Pkg
julia> Pkg.build("PyCall")
julia> using PyCall
julia> sage_all = pyimport("sage.all")
julia> sage_all.ZZ("17")
PyObject 17
julia> sage_all.polytopes.cube()
PyObject A 3-dimensional polyhedron in ZZ^3 defined as the convex hull of 8 vertices
```

Have you thought much about going in the other direction?



---

archive/issue_comments_433660.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nLast time I tried the other direction, in #28754, there were technical problems with cysignals (I think).\n\nIf you run the testsuite, I think also some errors involving cysignals show up there.\n\nI think it is best to investigate and fix these problems first before attempting the `python-jl` route again.",
    "created_at": "2021-02-15T21:51:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27762#issuecomment-433660",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">Comment 10</div>

Last time I tried the other direction, in #28754, there were technical problems with cysignals (I think).

If you run the testsuite, I think also some errors involving cysignals show up there.

I think it is best to investigate and fix these problems first before attempting the `python-jl` route again.



---

archive/issue_comments_433661.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\npyjulia works for me somewhat (I had to copy a few header files around so the GAP wrapper builds.)\n\n```\n>>> from julia import Oscar;Oscar.PadicField(2, 30)\n<PyCall.jlwrap Field of 2-adic numbers>\n```\n\nOnce I imported `Oscar`, as soon as I press the \"up\" key in the Python REPL, there's a segfault:\n\n```\nsignal (11): Segmentation fault\nin expression starting at none:0\nHDLR_FUNC at /workspace/srcdir/gap/src/calls.h:134 [inlined]\nHDLR_1ARGS at /workspace/srcdir/gap/src/calls.h:245 [inlined]\nCALL_1ARGS at /workspace/srcdir/gap/src/calls.h:320 [inlined]\nCall1ArgsInNewReader at /workspace/srcdir/gap/src/read.c:2893\nGAP_rl_func at /workspace/srcdir/gap/src/sysfiles.c:2087\n_rl_dispatch_subseq at /usr/lib/libreadline.so.8 (unknown line)\nreadline_internal_char at /usr/lib/libreadline.so.8 (unknown line)\nrl_callback_read_char at /usr/lib/libreadline.so.8 (unknown line)\nunknown function (ip: 0x7fede824c513)\nPyOS_Readline at /usr/lib/libpython3.9.so.1.0 (unknown line)\nunknown function (ip: 0x7fede7efa718)\nunknown function (ip: 0x7fede7fd7f40)\nunknown function (ip: 0x7fede7fd60ab)\nunknown function (ip: 0x7fede8072ecc)\nunknown function (ip: 0x7fede8072a0e)\nunknown function (ip: 0x7fede7f1bfc3)\nunknown function (ip: 0x7fede7f8e407)\nPyRun_InteractiveLoopFlags at /usr/lib/libpython3.9.so.1.0 (unknown line)\nPyRun_AnyFileExFlags at /usr/lib/libpython3.9.so.1.0 (unknown line)\nunknown function (ip: 0x7fede7f113a2)\nPy_BytesMain at /usr/lib/libpython3.9.so.1.0 (unknown line)\n__libc_start_main at /usr/lib/libc.so.6 (unknown line)\n_start at python (unknown line)\nAllocations: 56537538 (Pool: 56492870; Big: 44668); GC: 45\n[1]    1202215 segmentation fault (core dumped)  python\n```\n\nIt works much better in IPython:\n\n```\nIn []: from julia import Oscar\n\nIn []: p=5\n\nIn []: Qp = Oscar.PadicField(p, 30)\n\nIn []: a = 2*p + 4*p^2 + 1*p^3 + Oscar.O(Qp, p**4)\nTypeError: unsupported operand type(s) for +: 'int' and 'PyCall.jlwrap'\n\nIn []: from julia import Main\n\nIn []: plus = Main.eval('+')\n\nIn []: from functools import reduce\n\nIn []: a = reduce(plus, [2*p, 4*p**2, 1*p**3, Oscar.O(Qp, p**4)])\n\nIn []: Main.show(a)\n2*5^1 + 4*5^2 + 5^3 + O(5^4)\n```\n\nDisclaimer: I have no idea how this all works\u2026",
    "created_at": "2021-02-15T22:44:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27762#issuecomment-433661",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:11" align="right">Comment 11</div>

pyjulia works for me somewhat (I had to copy a few header files around so the GAP wrapper builds.)

```
>>> from julia import Oscar;Oscar.PadicField(2, 30)
<PyCall.jlwrap Field of 2-adic numbers>
```

Once I imported `Oscar`, as soon as I press the "up" key in the Python REPL, there's a segfault:

```
signal (11): Segmentation fault
in expression starting at none:0
HDLR_FUNC at /workspace/srcdir/gap/src/calls.h:134 [inlined]
HDLR_1ARGS at /workspace/srcdir/gap/src/calls.h:245 [inlined]
CALL_1ARGS at /workspace/srcdir/gap/src/calls.h:320 [inlined]
Call1ArgsInNewReader at /workspace/srcdir/gap/src/read.c:2893
GAP_rl_func at /workspace/srcdir/gap/src/sysfiles.c:2087
_rl_dispatch_subseq at /usr/lib/libreadline.so.8 (unknown line)
readline_internal_char at /usr/lib/libreadline.so.8 (unknown line)
rl_callback_read_char at /usr/lib/libreadline.so.8 (unknown line)
unknown function (ip: 0x7fede824c513)
PyOS_Readline at /usr/lib/libpython3.9.so.1.0 (unknown line)
unknown function (ip: 0x7fede7efa718)
unknown function (ip: 0x7fede7fd7f40)
unknown function (ip: 0x7fede7fd60ab)
unknown function (ip: 0x7fede8072ecc)
unknown function (ip: 0x7fede8072a0e)
unknown function (ip: 0x7fede7f1bfc3)
unknown function (ip: 0x7fede7f8e407)
PyRun_InteractiveLoopFlags at /usr/lib/libpython3.9.so.1.0 (unknown line)
PyRun_AnyFileExFlags at /usr/lib/libpython3.9.so.1.0 (unknown line)
unknown function (ip: 0x7fede7f113a2)
Py_BytesMain at /usr/lib/libpython3.9.so.1.0 (unknown line)
__libc_start_main at /usr/lib/libc.so.6 (unknown line)
_start at python (unknown line)
Allocations: 56537538 (Pool: 56492870; Big: 44668); GC: 45
[1]    1202215 segmentation fault (core dumped)  python
```

It works much better in IPython:

```
In []: from julia import Oscar

In []: p=5

In []: Qp = Oscar.PadicField(p, 30)

In []: a = 2*p + 4*p^2 + 1*p^3 + Oscar.O(Qp, p**4)
TypeError: unsupported operand type(s) for +: 'int' and 'PyCall.jlwrap'

In []: from julia import Main

In []: plus = Main.eval('+')

In []: from functools import reduce

In []: a = reduce(plus, [2*p, 4*p**2, 1*p**3, Oscar.O(Qp, p**4)])

In []: Main.show(a)
2*5^1 + 4*5^2 + 5^3 + O(5^4)
```

Disclaimer: I have no idea how this all works…



---

archive/issue_comments_433662.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nI just came across https://github.com/cjdoris/PythonCall.jl which while similar to PyCall is a bit different https://cjdoris.github.io/PythonCall.jl/stable/pycall/ might be worth a look, it was designed by a mathematician with a lot of Magma experience at least so might have some Sage relevant design decisions.",
    "created_at": "2021-03-28T22:07:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27762#issuecomment-433662",
    "user": "https://github.com/alexjbest"
}
```

<div id="comment:13" align="right">Comment 13</div>

I just came across https://github.com/cjdoris/PythonCall.jl which while similar to PyCall is a bit different https://cjdoris.github.io/PythonCall.jl/stable/pycall/ might be worth a look, it was designed by a mathematician with a lot of Magma experience at least so might have some Sage relevant design decisions.



---

archive/issue_events_362676.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-06T19:55:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27762#event-362676"
}
```



---

archive/issue_events_362677.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-06T19:55:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "label": "https://github.com/sagemath/sage/labels/feature",
    "label_color": "008080",
    "label_name": "feature",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27762#event-362677"
}
```



---

archive/issue_events_362678.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27762#event-362678"
}
```



---

archive/issue_events_362679.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27762",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27762#event-362679"
}
```
