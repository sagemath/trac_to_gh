# Issue 27205: Don't ignore "pkg-config --libs-only-other" when building sagelib; and fix linbox.pc

archive/issues_026968.json:
```json
{
    "body": "When sage uses pkgconfig to determine compile flags, for example in `src/module_list.py` and `src/sage/env.py` it only extracts the \"libraries\" but not the \"libs\" field from pkg-config. In the case of fflas-ffpack this field (as well as cflags) contains `-fopenmp`. So sage builds but does not link with this flag which leads to missing symbols on Ubuntu:\n\n```\nImportError: /<<PKGBUILDDIR>>/debian/build/usr/lib/python2.7/dist-packages/sage/matrix/matrix_modn_sparse.so: undefined symbol: GOMP_loop_ull_runtime_start\n```\n\nThis was mentioned in https://bugs.debian.org/919573 .\n\nTo reproduce:\n\n```\n  tox -e docker-debian-bullseye-standard\n```\nThe resulting sage crashes on startup with the above error.\n\nApplying the Debian patch reveals another Sage bug:\n\n```\n$ pkg-config --libs linbox\n-L/sage/local/lib -llinbox @LINBOXSAGE_LIBS@ -lntl -lmpfr -liml -lflint -fopenmp -lblas -llapack -lgivaro -lgmp -lgmpxx\n```\nThis is linbox upstream issue https://github.com/linbox-team/linbox/pull/170\n\nThis ticket fixes both.\n\n\nCC:  @kiwifb @ClementPernet @antonio-rojas @dimpase @mkoeppe @isuruf @vbraun\n\nReviewer: Dima Pasechnik\n\nAuthor: Tobias Hansen, Matthias Koeppe\n\nBranch: d678f78a41dc5f75c7166678c79e1640b5941b26\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27205\n\n",
    "closed_at": "2020-04-23T22:33:30Z",
    "created_at": "2019-02-02T13:31:29Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Don't ignore \"pkg-config --libs-only-other\" when building sagelib; and fix linbox.pc",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27205",
    "user": "https://github.com/tobihan"
}
```
When sage uses pkgconfig to determine compile flags, for example in `src/module_list.py` and `src/sage/env.py` it only extracts the "libraries" but not the "libs" field from pkg-config. In the case of fflas-ffpack this field (as well as cflags) contains `-fopenmp`. So sage builds but does not link with this flag which leads to missing symbols on Ubuntu:

```
ImportError: /<<PKGBUILDDIR>>/debian/build/usr/lib/python2.7/dist-packages/sage/matrix/matrix_modn_sparse.so: undefined symbol: GOMP_loop_ull_runtime_start
```

This was mentioned in https://bugs.debian.org/919573 .

To reproduce:

```
  tox -e docker-debian-bullseye-standard
```
The resulting sage crashes on startup with the above error.

Applying the Debian patch reveals another Sage bug:

```
$ pkg-config --libs linbox
-L/sage/local/lib -llinbox @LINBOXSAGE_LIBS@ -lntl -lmpfr -liml -lflint -fopenmp -lblas -llapack -lgivaro -lgmp -lgmpxx
```
This is linbox upstream issue https://github.com/linbox-team/linbox/pull/170

This ticket fixes both.


CC:  @kiwifb @ClementPernet @antonio-rojas @dimpase @mkoeppe @isuruf @vbraun

Reviewer: Dima Pasechnik

Author: Tobias Hansen, Matthias Koeppe

Branch: d678f78a41dc5f75c7166678c79e1640b5941b26

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27205





---

archive/issue_comments_525151.json:
```json
{
    "body": "<a id='comment:1'></a>\nI think we are either misusing `pkgconfig` or there is something wrong with `pkgconfig` upstream.",
    "created_at": "2019-02-03T11:46:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525151",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>
I think we are either misusing `pkgconfig` or there is something wrong with `pkgconfig` upstream.



---

archive/issue_comments_525152.json:
```json
{
    "body": "<a id='comment:2'></a>\n`pkg-config --libs` or `pkgconfig.libs(pkg)` in Python gives the LDFLAGS required for the package. According to the manpage of pkg-config this splits into `pkg-config --libs-only-l`, `pkg-config --libs-only-L` and `pkg-config --libs-only-other`. \n\nWhat sage does is to get `pkg-config --libs-only-l`, `pkg-config --libs-only-L` by means of `pkgconfig.parse(pkg)['libraries']` and `pkgconfig.parse(pkg)['library_dirs']`, missing the content of `pkg-config --libs-only-other`.",
    "created_at": "2019-02-03T12:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525152",
    "user": "https://github.com/tobihan"
}
```

<a id='comment:2'></a>
`pkg-config --libs` or `pkgconfig.libs(pkg)` in Python gives the LDFLAGS required for the package. According to the manpage of pkg-config this splits into `pkg-config --libs-only-l`, `pkg-config --libs-only-L` and `pkg-config --libs-only-other`. 

What sage does is to get `pkg-config --libs-only-l`, `pkg-config --libs-only-L` by means of `pkgconfig.parse(pkg)['libraries']` and `pkgconfig.parse(pkg)['library_dirs']`, missing the content of `pkg-config --libs-only-other`.



---

archive/issue_comments_525153.json:
```json
{
    "body": "<a id='comment:3'></a>\nThere is `extra_link_args` to specify the remaining LDFLAGS in distutils extensions.",
    "created_at": "2019-02-05T15:10:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525153",
    "user": "https://github.com/tobihan"
}
```

<a id='comment:3'></a>
There is `extra_link_args` to specify the remaining LDFLAGS in distutils extensions.



---

archive/issue_comments_525154.json:
```json
{
    "body": "<a id='comment:4'></a>\nI created this patch which takes care of the extra flags only for linbox and fflas-ffpack for now:\n\nhttps://salsa.debian.org/science-team/sagemath/blob/master/debian/patches/u1-pkgconfig-extra-link-flags.patch\n\nTo apply it here, should I do the same for all modules that use pkgconfig in env.py and module_list.py?",
    "created_at": "2019-02-06T10:56:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525154",
    "user": "https://github.com/tobihan"
}
```

<a id='comment:4'></a>
I created this patch which takes care of the extra flags only for linbox and fflas-ffpack for now:

https://salsa.debian.org/science-team/sagemath/blob/master/debian/patches/u1-pkgconfig-extra-link-flags.patch

To apply it here, should I do the same for all modules that use pkgconfig in env.py and module_list.py?



---

archive/issue_comments_525155.json:
```json
{
    "body": "<a id='comment:6'></a>\nClearly an oversight on my part when I last updated that pkg-config bit. I didn't know about `--libs-only-other` and thought we would get something like `-fopenmp` from `cflags`. I see `pkgconfig` (the python binding) had a few new releases since I last updated it, but nothing that would help.\n\nI think we should make a feature request for upstream `pkgconfig` so we can simplify the stuff in your patch. Did you make one? \n\nFor the case at hand here in Gentoo I don't have any problems with linking. I am guessing this is because `libgomp` is in the `NEEDED` list of `libfflas`. I am more concerned that `-fopenmp` in not in `CFLAGS` where it could have an impact on section of headers being used. At linking it only bring the openmp runtime (libgomp when using gcc) which feels a little bit too late and is only interesting if you have a direct use of openmp symbol or indirect but unresolved ones (which is not the case for me here).",
    "created_at": "2019-02-06T22:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525155",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
Clearly an oversight on my part when I last updated that pkg-config bit. I didn't know about `--libs-only-other` and thought we would get something like `-fopenmp` from `cflags`. I see `pkgconfig` (the python binding) had a few new releases since I last updated it, but nothing that would help.

I think we should make a feature request for upstream `pkgconfig` so we can simplify the stuff in your patch. Did you make one? 

For the case at hand here in Gentoo I don't have any problems with linking. I am guessing this is because `libgomp` is in the `NEEDED` list of `libfflas`. I am more concerned that `-fopenmp` in not in `CFLAGS` where it could have an impact on section of headers being used. At linking it only bring the openmp runtime (libgomp when using gcc) which feels a little bit too late and is only interesting if you have a direct use of openmp symbol or indirect but unresolved ones (which is not the case for me here).



---

archive/issue_comments_525156.json:
```json
{
    "body": "<a id='comment:7'></a>\nI have opened https://github.com/matze/pkgconfig/issues/38 for upstream pkgconfig to help deal with this issue. Of course in the meantime the debian patch is OK.",
    "created_at": "2019-02-06T22:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525156",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
I have opened https://github.com/matze/pkgconfig/issues/38 for upstream pkgconfig to help deal with this issue. Of course in the meantime the debian patch is OK.



---

archive/issue_comments_525157.json:
```json
{
    "body": "<a id='comment:8'></a>\nThanks. On Debian `-fopenmp` *is* in the cflags of linbox and fflas-ffpack. That's precisely why this was discovered: If you build with this flag you also need to link with it. The build failed on Ubuntu with a missing symbol from libgomp. For some reason that I don't know the build didn't fail on Debian.",
    "created_at": "2019-02-07T00:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525157",
    "user": "https://github.com/tobihan"
}
```

<a id='comment:8'></a>
Thanks. On Debian `-fopenmp` *is* in the cflags of linbox and fflas-ffpack. That's precisely why this was discovered: If you build with this flag you also need to link with it. The build failed on Ubuntu with a missing symbol from libgomp. For some reason that I don't know the build didn't fail on Debian.



---

archive/issue_comments_525158.json:
```json
{
    "body": "<a id='comment:9'></a>\nWell, I have been giving this some thoughts and I have come to the conclusion that you cannot have that problem unless either `libfflas.so` or `libffpack.so` is underlinked relative to `libgomp`. linbox, while it does have a openmp configure option, doesn't link to the openmp runtime as far as I can see. So the trouble come from fflas-ffpack.",
    "created_at": "2019-02-07T00:21:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525158",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
Well, I have been giving this some thoughts and I have come to the conclusion that you cannot have that problem unless either `libfflas.so` or `libffpack.so` is underlinked relative to `libgomp`. linbox, while it does have a openmp configure option, doesn't link to the openmp runtime as far as I can see. So the trouble come from fflas-ffpack.



---

archive/issue_comments_525159.json:
```json
{
    "body": "<a id='comment:10'></a>\nAfter closer inspection it could also happen if you use openblas compiled with openmp and it is underlinked. I guess that's another possibility, and in that case adding fflas-ffpack's flag to fix it, is just accidental.",
    "created_at": "2019-02-07T00:29:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525159",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
After closer inspection it could also happen if you use openblas compiled with openmp and it is underlinked. I guess that's another possibility, and in that case adding fflas-ffpack's flag to fix it, is just accidental.



---

archive/issue_comments_525160.json:
```json
{
    "body": "<a id='comment:12'></a>\nTicket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525160",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>
Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_events_076634.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27205#event-76634"
}
```



---

archive/issue_events_076635.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:54:19Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27205#event-76635"
}
```



---

archive/issue_comments_525161.json:
```json
{
    "body": "<a id='comment:13'></a>\nAs the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525161",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>
As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_comments_525162.json:
```json
{
    "body": "<a id='comment:14'></a>\nI have also been seeing problems like this on Cygwin lately, though I'm not sure where it began.\n\nI've been compiling fflas-ffpack with `FFLAS_FFPACK_CONFIGURE=--disable-openmp`.",
    "created_at": "2019-11-13T13:33:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525162",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>
I have also been seeing problems like this on Cygwin lately, though I'm not sure where it began.

I've been compiling fflas-ffpack with `FFLAS_FFPACK_CONFIGURE=--disable-openmp`.



---

archive/issue_events_076636.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T07:21:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27205#event-76636"
}
```



---

archive/issue_comments_525163.json:
```json
{
    "body": "<a id='comment:16'></a>\nI think this is showing up in https://github.com/mkoeppe/sage/runs/581024689?check_suite_focus=true too",
    "created_at": "2020-04-14T07:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525163",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
I think this is showing up in https://github.com/mkoeppe/sage/runs/581024689?check_suite_focus=true too



---

archive/issue_comments_525164.json:
```json
{
    "body": "<a id='comment:18'></a>\nthis seems to be related to OpenMP:\n\n```\n2020-04-12T20:04:09.1360983Z   [dochtml]   ImportError: /sage/local/lib/python3.7/site-packages/sage/matrix/matrix_modn_sparse.cpython-37m-x86_64-linux-gnu.so: undefined symbol: GOMP_loop_ull_maybe_nonmonotonic_runtime_next\n```",
    "created_at": "2020-04-15T17:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525164",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
this seems to be related to OpenMP:

```
2020-04-12T20:04:09.1360983Z   [dochtml]   ImportError: /sage/local/lib/python3.7/site-packages/sage/matrix/matrix_modn_sparse.cpython-37m-x86_64-linux-gnu.so: undefined symbol: GOMP_loop_ull_maybe_nonmonotonic_runtime_next
```



---

archive/issue_comments_525165.json:
```json
{
    "body": "<a id='comment:20'></a>\nLooks like fflas-ffpack have openmp pragmas on their header files. Sage should detect whether `__FFLASFFPACK_USE_OPENMP` is defined in `spkg-configure.m4` and add `-fopenmp` to `extra_link_args` until the `pkgconfig` issue is fixed",
    "created_at": "2020-04-15T22:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525165",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:20'></a>
Looks like fflas-ffpack have openmp pragmas on their header files. Sage should detect whether `__FFLASFFPACK_USE_OPENMP` is defined in `spkg-configure.m4` and add `-fopenmp` to `extra_link_args` until the `pkgconfig` issue is fixed



---

archive/issue_events_076637.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "rename": {
        "from": "Sage ignores libs from pkgconfig",
        "to": "Sage ignores libs from pkgconfig; also linbox.pc broken by a Sage patch"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27205#event-76637"
}
```



---

archive/issue_comments_525166.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,3 +5,19 @@\n ```\n \n This was mentioned in https://bugs.debian.org/919573 .\n+\n+To reproduce:\n+\n+```\n+  tox -e docker-debian-bullseye-standard\n+```\n+The resulting sage crashes on startup with the above error.\n+\n+Applying the Debian patch reveals another Sage bug:\n+\n+```\n+$ pkg-config --libs linbox\n+-L/sage/local/lib -llinbox @LINBOXSAGE_LIBS@ -lntl -lmpfr -liml -lflint -fopenmp -lblas -llapack -lgivaro -lgmp -lgmpxx\n+```\n+\n+\n``````\n",
    "created_at": "2020-04-17T00:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525166",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,3 +5,19 @@
 ```
 
 This was mentioned in https://bugs.debian.org/919573 .
+
+To reproduce:
+
+```
+  tox -e docker-debian-bullseye-standard
+```
+The resulting sage crashes on startup with the above error.
+
+Applying the Debian patch reveals another Sage bug:
+
+```
+$ pkg-config --libs linbox
+-L/sage/local/lib -llinbox @LINBOXSAGE_LIBS@ -lntl -lmpfr -liml -lflint -fopenmp -lblas -llapack -lgivaro -lgmp -lgmpxx
+```
+
+
``````




---

archive/issue_comments_525167.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,5 +19,5 @@\n $ pkg-config --libs linbox\n -L/sage/local/lib -llinbox @LINBOXSAGE_LIBS@ -lntl -lmpfr -liml -lflint -fopenmp -lblas -llapack -lgivaro -lgmp -lgmpxx\n ```\n+This is linbox upstream issue https://github.com/linbox-team/linbox/pull/170\n \n-\n``````\n",
    "created_at": "2020-04-17T01:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525167",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,5 +19,5 @@
 $ pkg-config --libs linbox
 -L/sage/local/lib -llinbox @LINBOXSAGE_LIBS@ -lntl -lmpfr -liml -lflint -fopenmp -lblas -llapack -lgivaro -lgmp -lgmpxx
 ```
+This is linbox upstream issue https://github.com/linbox-team/linbox/pull/170
 
-
``````




---

archive/issue_comments_525168.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/sage_ignores_libs_from_pkgconfig__also_linbox_pc_broken_by_a_sage_patch\"",
    "created_at": "2020-04-17T01:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525168",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/sage_ignores_libs_from_pkgconfig__also_linbox_pc_broken_by_a_sage_patch"



---

archive/issue_comments_525169.json:
```json
{
    "body": "Changing commit from \"\" to \"257f0572b74fa06f8dc05cfe00db582e785fdd5c\"",
    "created_at": "2020-04-17T01:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525169",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "257f0572b74fa06f8dc05cfe00db582e785fdd5c"



---

archive/issue_events_076638.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "rename": {
        "from": "Sage ignores libs from pkgconfig; also linbox.pc broken by a Sage patch",
        "to": "Pass \"pkg-config --libs-only-other\" and fix linbox.pc"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27205#event-76638"
}
```



---

archive/issue_comments_525170.json:
```json
{
    "body": "<a id='comment:24'></a>\nNew commits:\n|                                                                                                                                          |                                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|\n|[f5ccfc8](https://github.com/sagemath/sagetrac-mirror/commit/f5ccfc84215acfb8d190e247b52b4d5fa5e8ba59)|`Also use LDFLAGS from pkg-config that are not -l or -L`|\n|[257f057](https://github.com/sagemath/sagetrac-mirror/commit/257f0572b74fa06f8dc05cfe00db582e785fdd5c)|`Add linbox patch`|",
    "created_at": "2020-04-17T01:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525170",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>
New commits:
|                                                                                                                                          |                                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|[f5ccfc8](https://github.com/sagemath/sagetrac-mirror/commit/f5ccfc84215acfb8d190e247b52b4d5fa5e8ba59)|`Also use LDFLAGS from pkg-config that are not -l or -L`|
|[257f057](https://github.com/sagemath/sagetrac-mirror/commit/257f0572b74fa06f8dc05cfe00db582e785fdd5c)|`Add linbox patch`|



---

archive/issue_comments_525171.json:
```json
{
    "body": "Changing author from \"\" to \"Tobias Hansen, Matthias Koeppe\"",
    "created_at": "2020-04-17T01:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525171",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Tobias Hansen, Matthias Koeppe"



---

archive/issue_events_076639.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "rename": {
        "from": "Pass \"pkg-config --libs-only-other\" and fix linbox.pc",
        "to": "Don't ignore \"pkg-config --libs-only-other\" when building sagelib; and fix linbox.pc"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27205#event-76639"
}
```



---

archive/issue_comments_525172.json:
```json
{
    "body": "<a id='comment:26'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------|\n|[79a6577](https://github.com/sagemath/sagetrac-mirror/commit/79a6577366bade22b96acddf4d2ec58772dad385)|`backport patch`|",
    "created_at": "2020-04-17T03:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525172",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------|
|[79a6577](https://github.com/sagemath/sagetrac-mirror/commit/79a6577366bade22b96acddf4d2ec58772dad385)|`backport patch`|



---

archive/issue_comments_525173.json:
```json
{
    "body": "Changing commit from \"257f0572b74fa06f8dc05cfe00db582e785fdd5c\" to \"79a6577366bade22b96acddf4d2ec58772dad385\"",
    "created_at": "2020-04-17T03:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525173",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "257f0572b74fa06f8dc05cfe00db582e785fdd5c" to "79a6577366bade22b96acddf4d2ec58772dad385"



---

archive/issue_comments_525174.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -21,3 +21,5 @@\n ```\n This is linbox upstream issue https://github.com/linbox-team/linbox/pull/170\n \n+This ticket fixes both.\n+\n``````\n",
    "created_at": "2020-04-17T04:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525174",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -21,3 +21,5 @@
 ```
 This is linbox upstream issue https://github.com/linbox-team/linbox/pull/170
 
+This ticket fixes both.
+
``````




---

archive/issue_comments_525175.json:
```json
{
    "body": "<a id='comment:27'></a>\nFixes the problem on `debian-bullseye-standard`.",
    "created_at": "2020-04-17T04:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525175",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
Fixes the problem on `debian-bullseye-standard`.



---

archive/issue_comments_525176.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-17T04:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525176",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_525177.json:
```json
{
    "body": "<a id='comment:28'></a>\ngood catch. needs testing.\n\nby the way, is there a ticket to make gh action testing doable from CLI?",
    "created_at": "2020-04-17T08:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525177",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'></a>
good catch. needs testing.

by the way, is there a ticket to make gh action testing doable from CLI?



---

archive/issue_comments_525178.json:
```json
{
    "body": "<a id='comment:29'></a>\nTests running at https://github.com/mkoeppe/sage/actions/runs/80516747",
    "created_at": "2020-04-17T15:59:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525178",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
Tests running at https://github.com/mkoeppe/sage/actions/runs/80516747



---

archive/issue_comments_525179.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [dimpase](#comment%3A28):\n> by the way, is there a ticket to make gh action testing doable from CLI?\n\n\nNo ticket; but from a comment in #29087:\n`gh pr create -f -d` would be a command line interface to trigger the GH actions run. \u200bhttps://cli.github.com/manual/gh_pr_create",
    "created_at": "2020-04-17T16:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525179",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
Replying to [dimpase](#comment%3A28):
> by the way, is there a ticket to make gh action testing doable from CLI?


No ticket; but from a comment in #29087:
`gh pr create -f -d` would be a command line interface to trigger the GH actions run. ​https://cli.github.com/manual/gh_pr_create



---

archive/issue_comments_525180.json:
```json
{
    "body": "<a id='comment:31'></a>\nThe tests are ready; needs review",
    "created_at": "2020-04-18T04:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525180",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
The tests are ready; needs review



---

archive/issue_comments_525181.json:
```json
{
    "body": "<a id='comment:32'></a>\nLet's get this into 9.1 please...",
    "created_at": "2020-04-18T16:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525181",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
Let's get this into 9.1 please...



---

archive/issue_comments_525182.json:
```json
{
    "body": "<a id='comment:33'></a>\nlgtm, thanks.",
    "created_at": "2020-04-18T16:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525182",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:33'></a>
lgtm, thanks.



---

archive/issue_comments_525183.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2020-04-18T16:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525183",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_525184.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-18T16:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525184",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_525185.json:
```json
{
    "body": "<a id='comment:34'></a>\nThanks!",
    "created_at": "2020-04-18T18:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525185",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>
Thanks!



---

archive/issue_comments_525186.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-04-20T22:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525186",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_525187.json:
```json
{
    "body": "<a id='comment:35'></a>\nSee patchbot:\n\n```\n[sagelib-9.1.rc0] g++: error: LINBOXSAGE_LIBS@: No such file or directory\n```",
    "created_at": "2020-04-20T22:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525187",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:35'></a>
See patchbot:

```
[sagelib-9.1.rc0] g++: error: LINBOXSAGE_LIBS@: No such file or directory
```



---

archive/issue_comments_525188.json:
```json
{
    "body": "<a id='comment:36'></a>\nShould have bumped the patch level",
    "created_at": "2020-04-20T22:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525188",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>
Should have bumped the patch level



---

archive/issue_comments_525189.json:
```json
{
    "body": "<a id='comment:37'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                 |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|\n|[d678f78](https://github.com/sagemath/sagetrac-mirror/commit/d678f78a41dc5f75c7166678c79e1640b5941b26)|`build/pkgs/linbox/package-version.txt: Bump up the patchlevel so that incremental builds of sagelib do not fail`|",
    "created_at": "2020-04-20T22:56:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525189",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
|[d678f78](https://github.com/sagemath/sagetrac-mirror/commit/d678f78a41dc5f75c7166678c79e1640b5941b26)|`build/pkgs/linbox/package-version.txt: Bump up the patchlevel so that incremental builds of sagelib do not fail`|



---

archive/issue_comments_525190.json:
```json
{
    "body": "Changing commit from \"79a6577366bade22b96acddf4d2ec58772dad385\" to \"d678f78a41dc5f75c7166678c79e1640b5941b26\"",
    "created_at": "2020-04-20T22:56:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525190",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "79a6577366bade22b96acddf4d2ec58772dad385" to "d678f78a41dc5f75c7166678c79e1640b5941b26"



---

archive/issue_comments_525191.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-04-20T22:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525191",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_076640.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-23T22:33:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27205#event-76640"
}
```



---

archive/issue_comments_525192.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-23T22:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525192",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_525193.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/sage_ignores_libs_from_pkgconfig__also_linbox_pc_broken_by_a_sage_patch\" to \"d678f78a41dc5f75c7166678c79e1640b5941b26\"",
    "created_at": "2020-04-23T22:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525193",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/sage_ignores_libs_from_pkgconfig__also_linbox_pc_broken_by_a_sage_patch" to "d678f78a41dc5f75c7166678c79e1640b5941b26"



---

archive/issue_comments_525194.json:
```json
{
    "body": "<a id='comment:40'></a>\nDoes this ticket fix the following error when building the documentation?\n\n```\n [dochtml] installing. Log file: logs/dochtml.log\n  [dochtml] error installing, exit status 1. End of log file:\n  [dochtml]   Traceback (most recent call last):\n  [dochtml]     File \"/sage/local/lib/python3.7/runpy.py\", line 183, in _run_module_as_main\n  [dochtml]       mod_name, mod_spec, code = _get_module_details(mod_name, _Error)\n  [dochtml]     File \"/sage/local/lib/python3.7/runpy.py\", line 142, in _get_module_details\n  [dochtml]       return _get_module_details(pkg_main_name, error)\n  [dochtml]     File \"/sage/local/lib/python3.7/runpy.py\", line 109, in _get_module_details\n  [dochtml]       __import__(pkg_name)\n  [dochtml]     File \"/sage/local/lib/python3.7/site-packages/sage_setup/docbuild/__init__.py\", line 59, in <module>\n  [dochtml]       import sage.all\n  [dochtml]     File \"/sage/local/lib/python3.7/site-packages/sage/all.py\", line 132, in <module>\n  [dochtml]       from sage.matrix.all     import *\n  [dochtml]     File \"/sage/local/lib/python3.7/site-packages/sage/matrix/__init__.py\", line 2, in <module>\n  [dochtml]       import sage.matrix.args\n  [dochtml]     File \"sage/matrix/args.pyx\", line 23, in init sage.matrix.args (build/cythonized/sage/matrix/args.c:21217)\n  [dochtml]     File \"/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_space.py\", line 46, in <module>\n  [dochtml]       from . import matrix_modn_sparse\n  [dochtml]   ImportError: /sage/local/lib/python3.7/site-packages/sage/matrix/matrix_modn_sparse.cpython-37m-x86_64-linux-gnu.so: undefined symbol: GOMP_loop_ull_maybe_nonmonotonic_runtime_next\n  [dochtml] Full log file: logs/dochtml.log\n```\n\nE.g. on ubuntu-focal or debian bullseye: [https://github.com/mkoeppe/sage/runs/610674634](https://github.com/mkoeppe/sage/runs/610674634)\n\nThis is a new bug that appears to have been introduced in 9.1.rc1.",
    "created_at": "2020-04-24T05:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525194",
    "user": "https://github.com/kliem"
}
```

<a id='comment:40'></a>
Does this ticket fix the following error when building the documentation?

```
 [dochtml] installing. Log file: logs/dochtml.log
  [dochtml] error installing, exit status 1. End of log file:
  [dochtml]   Traceback (most recent call last):
  [dochtml]     File "/sage/local/lib/python3.7/runpy.py", line 183, in _run_module_as_main
  [dochtml]       mod_name, mod_spec, code = _get_module_details(mod_name, _Error)
  [dochtml]     File "/sage/local/lib/python3.7/runpy.py", line 142, in _get_module_details
  [dochtml]       return _get_module_details(pkg_main_name, error)
  [dochtml]     File "/sage/local/lib/python3.7/runpy.py", line 109, in _get_module_details
  [dochtml]       __import__(pkg_name)
  [dochtml]     File "/sage/local/lib/python3.7/site-packages/sage_setup/docbuild/__init__.py", line 59, in <module>
  [dochtml]       import sage.all
  [dochtml]     File "/sage/local/lib/python3.7/site-packages/sage/all.py", line 132, in <module>
  [dochtml]       from sage.matrix.all     import *
  [dochtml]     File "/sage/local/lib/python3.7/site-packages/sage/matrix/__init__.py", line 2, in <module>
  [dochtml]       import sage.matrix.args
  [dochtml]     File "sage/matrix/args.pyx", line 23, in init sage.matrix.args (build/cythonized/sage/matrix/args.c:21217)
  [dochtml]     File "/sage/local/lib/python3.7/site-packages/sage/matrix/matrix_space.py", line 46, in <module>
  [dochtml]       from . import matrix_modn_sparse
  [dochtml]   ImportError: /sage/local/lib/python3.7/site-packages/sage/matrix/matrix_modn_sparse.cpython-37m-x86_64-linux-gnu.so: undefined symbol: GOMP_loop_ull_maybe_nonmonotonic_runtime_next
  [dochtml] Full log file: logs/dochtml.log
```

E.g. on ubuntu-focal or debian bullseye: [https://github.com/mkoeppe/sage/runs/610674634](https://github.com/mkoeppe/sage/runs/610674634)

This is a new bug that appears to have been introduced in 9.1.rc1.



---

archive/issue_comments_525195.json:
```json
{
    "body": "Changing commit from \"d678f78a41dc5f75c7166678c79e1640b5941b26\" to \"\"",
    "created_at": "2020-04-24T05:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525195",
    "user": "https://github.com/kliem"
}
```

Changing commit from "d678f78a41dc5f75c7166678c79e1640b5941b26" to ""



---

archive/issue_comments_525196.json:
```json
{
    "body": "<a id='comment:41'></a>\nYes, this ticket fixes this bug.",
    "created_at": "2020-04-24T14:09:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27205#issuecomment-525196",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>
Yes, this ticket fixes this bug.
