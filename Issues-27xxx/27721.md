# Issue 27721: Add wrappers around flint headers in Sage

archive/issues_027484.json:
```json
{
    "assignees": [],
    "body": "There is a problem in a few of the packages they use (flint is not the only one, but it is one where this specific problem is most pervasive) in that they all use the name `ulong` in some way or other.  flint also has an `slong` but that does not seem to have as many conflicts.\n\nI first reported this in #27714 but this ticket is to propose a specific fix.\n\nI've noted this problem in at least:\n\n* flint/flint.h:\n\n   ```\n   #define ulong mp_limb_t\n   #define slong mp_limb_signed_t\n  ```\n\n* zn_poly/zn_poly.h:\n\n   ```\n   /*\n   I get really sick of typing unsigned long.\n   */\n   typedef unsigned long  ulong;\n  ```\n\n* pari/parigen.h:\n\n  ```\n  #ifdef _WIN64\n  typedef unsigned long long pari_ulong;\n  #define long long long\n  #define labs llabs\n  #else\n  typedef unsigned long pari_ulong;\n  #endif\n  #define ulong pari_ulong\n  ```\n\nAnd for completeness, it's worth noting these definitions from gmp.h:\n\n```\n#ifdef __GMP_SHORT_LIMB\ntypedef unsigned int        mp_limb_t;\ntypedef int         mp_limb_signed_t;\n#else\n#ifdef _LONG_LONG_LIMB\ntypedef unsigned long long int  mp_limb_t;\ntypedef long long int       mp_limb_signed_t;\n#else\ntypedef unsigned long int   mp_limb_t;\ntypedef long int        mp_limb_signed_t;\n#endif\n#endif\ntypedef unsigned long int   mp_bitcnt_t;\n```\n\nThe problem is most evident in modules that happen to combine any two of these headers.  For example in src/sage/rings/polynomial/polynomial_zmod_flint.pyx both flint.h and zn_poly.h are used.  Because of the `#define ulong mp_limb_t` in flint.h, the typedef in zn_poly.h expands to: `typedef unsigned long mp_limb_t`.\n\nBecause this compiles to a C++ file this happens to be just fine most of the time because C++ allows benign re-typedefs and indeed it just happens that this is compatible with the original definition of `mp_limb_t` from gmp.h, at least most of the time.\n\nHowever, as I found in #27714 that doesn't always have to be true.  The GMP system package on Cygwin has GMP configured in such a way that `_LONG_LONG_LIMB` is defined, so it defines `typedef long long int mp_limb_t`, and all this fragile overloading breaks down.\n\nI think in some sense flint is the \"worst\" problem here since it ties its `ulong` and `slong` macros to typedefs in GMP which themselves can, we now know, be platform-dependent. So this introduces a lot of problems.\n\nI'm experimenting with adding a wrapper around all includes of flint headers in Sage in order to work around this problem, but I'd be happy to have other suggestions.\n\nCC:  @jdemeyer wbhart @dimpase @fredrik-johansson\n\nBranch: **[0aa0177](https://github.com/sagemath/sagetrac-mirror/commit/0aa0177220205a67e4981b994f2efecdadb057ac)**\n\nReviewer: **Volker Braun**\n\nAuthor: **Erik Bray**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27721_\n\n",
    "closed_at": "2019-06-27T20:13:59Z",
    "created_at": "2019-04-25T10:06:10Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
        "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add wrappers around flint headers in Sage",
    "type": "issue",
    "updated_at": "2019-07-03T11:58:10Z",
    "url": "https://github.com/sagemath/sage/issues/27721",
    "user": "https://github.com/embray"
}
```
There is a problem in a few of the packages they use (flint is not the only one, but it is one where this specific problem is most pervasive) in that they all use the name `ulong` in some way or other.  flint also has an `slong` but that does not seem to have as many conflicts.

I first reported this in #27714 but this ticket is to propose a specific fix.

I've noted this problem in at least:

* flint/flint.h:

   ```
   #define ulong mp_limb_t
   #define slong mp_limb_signed_t
  ```

* zn_poly/zn_poly.h:

   ```
   /*
   I get really sick of typing unsigned long.
   */
   typedef unsigned long  ulong;
  ```

* pari/parigen.h:

  ```
  #ifdef _WIN64
  typedef unsigned long long pari_ulong;
  #define long long long
  #define labs llabs
  #else
  typedef unsigned long pari_ulong;
  #endif
  #define ulong pari_ulong
  ```

And for completeness, it's worth noting these definitions from gmp.h:

```
#ifdef __GMP_SHORT_LIMB
typedef unsigned int        mp_limb_t;
typedef int         mp_limb_signed_t;
#else
#ifdef _LONG_LONG_LIMB
typedef unsigned long long int  mp_limb_t;
typedef long long int       mp_limb_signed_t;
#else
typedef unsigned long int   mp_limb_t;
typedef long int        mp_limb_signed_t;
#endif
#endif
typedef unsigned long int   mp_bitcnt_t;
```

The problem is most evident in modules that happen to combine any two of these headers.  For example in src/sage/rings/polynomial/polynomial_zmod_flint.pyx both flint.h and zn_poly.h are used.  Because of the `#define ulong mp_limb_t` in flint.h, the typedef in zn_poly.h expands to: `typedef unsigned long mp_limb_t`.

Because this compiles to a C++ file this happens to be just fine most of the time because C++ allows benign re-typedefs and indeed it just happens that this is compatible with the original definition of `mp_limb_t` from gmp.h, at least most of the time.

However, as I found in #27714 that doesn't always have to be true.  The GMP system package on Cygwin has GMP configured in such a way that `_LONG_LONG_LIMB` is defined, so it defines `typedef long long int mp_limb_t`, and all this fragile overloading breaks down.

I think in some sense flint is the "worst" problem here since it ties its `ulong` and `slong` macros to typedefs in GMP which themselves can, we now know, be platform-dependent. So this introduces a lot of problems.

I'm experimenting with adding a wrapper around all includes of flint headers in Sage in order to work around this problem, but I'd be happy to have other suggestions.

CC:  @jdemeyer wbhart @dimpase @fredrik-johansson

Branch: **[0aa0177](https://github.com/sagemath/sagetrac-mirror/commit/0aa0177220205a67e4981b994f2efecdadb057ac)**

Reviewer: **Volker Braun**

Author: **Erik Bray**

_Issue created by migration from https://trac.sagemath.org/ticket/27721_





---

archive/issue_events_362110.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-25T10:06:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27721#event-362110"
}
```



---

archive/issue_events_362111.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-25T10:06:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "component: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27721#event-362111"
}
```



---

archive/issue_events_362112.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-25T10:06:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27721#event-362112"
}
```



---

archive/issue_events_362113.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-25T10:06:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27721#event-362113"
}
```



---

archive/issue_comments_432613.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nlet us do an upstream fix instead. they are quite patch-welcoming.",
    "created_at": "2019-04-25T10:15:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432613",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'>Comment 1:</a>
let us do an upstream fix instead. they are quite patch-welcoming.



---

archive/issue_comments_432614.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nThat might be preferable, but I'm not sure what the best thing would be to do that wouldn't massively break backwards compatibility with other code that uses flint (and hence its ulong and slong macros).",
    "created_at": "2019-04-25T10:21:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432614",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'>Comment 2:</a>
That might be preferable, but I'm not sure what the best thing would be to do that wouldn't massively break backwards compatibility with other code that uses flint (and hence its ulong and slong macros).



---

archive/issue_comments_432615.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nUSE TYPEDEFS, PEOPLE!!!",
    "created_at": "2019-04-25T10:29:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432615",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'>Comment 4:</a>
USE TYPEDEFS, PEOPLE!!!



---

archive/issue_comments_432616.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nI had to solve a similar problem in cypari2: https://github.com/sagemath/cypari2/blob/master/cypari2/cypari.h included from https://github.com/sagemath/cypari2/blob/7bf42118a6df470ae67fae6d403a0f0796c17355/cypari2/types.pxd#L142\n\nThe same idea (`#undef ulong`) could be used for FLINT, provided that they don't expose the name `ulong` in other macros. For example, this macros will break after `#undef ulong`:\n\n```\n#define PTR_TO_COEFF(x) (((ulong) (x) >> 2) | (WORD(1) << (FLINT_BITS - 2)))\n```\nbut Sage doesn't use that.\n\nLet me see if this quick fix works.",
    "created_at": "2019-04-25T10:40:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432616",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'>Comment 5:</a>
I had to solve a similar problem in cypari2: https://github.com/sagemath/cypari2/blob/master/cypari2/cypari.h included from https://github.com/sagemath/cypari2/blob/7bf42118a6df470ae67fae6d403a0f0796c17355/cypari2/types.pxd#L142

The same idea (`#undef ulong`) could be used for FLINT, provided that they don't expose the name `ulong` in other macros. For example, this macros will break after `#undef ulong`:

```
#define PTR_TO_COEFF(x) (((ulong) (x) >> 2) | (WORD(1) << (FLINT_BITS - 2)))
```
but Sage doesn't use that.

Let me see if this quick fix works.



---

archive/issue_comments_432617.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBefore you do anything, I already have a patch in progress (actually mostly done; just testing).\n\nIn addition to `#undef ulong` it also adds two new typedefs `typedef mp_limb_t fulong` (f for flint) and a similar on for `fslong`.  Then code in sage that previously used the fake types `ulong` and `slong` are updated to use these instead.\n\nIt also requires wrapping the arb headers since most of them include flint.h.",
    "created_at": "2019-04-25T12:23:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432617",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'>Comment 6:</a>
Before you do anything, I already have a patch in progress (actually mostly done; just testing).

In addition to `#undef ulong` it also adds two new typedefs `typedef mp_limb_t fulong` (f for flint) and a similar on for `fslong`.  Then code in sage that previously used the fake types `ulong` and `slong` are updated to use these instead.

It also requires wrapping the arb headers since most of them include flint.h.



---

archive/issue_events_362114.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-05-02T16:25:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27721#event-362114"
}
```



---

archive/issue_comments_432618.json:
```json
{
    "body": "Commit: **[a9694f6](https://github.com/sagemath/sagetrac-mirror/commit/a9694f661c15fc27e221148be430c31bec975dbf)**",
    "created_at": "2019-05-02T16:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432618",
    "user": "https://github.com/embray"
}
```

Commit: **[a9694f6](https://github.com/sagemath/sagetrac-mirror/commit/a9694f661c15fc27e221148be430c31bec975dbf)**



---

archive/issue_comments_432619.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nHere is my proposal for wrappers for the flint and arb headers to use when including them in Sage.  Rather than make many wrappers for each individual header, I just include all the flint headers in the flint wrapper, and similarly in the arb wrapper (with `flint/NTL-interface.h` being one special exception).\n\nThis of course results in \"over-including\" in some cases, but I don't think this is a serious problem.\n\nI'm also aware that in newer versions of Cython it's possible to add arbitrary post-include code in a docstring under a `cdef extern` statement, but I felt that this would be more reliable and manageable than dozens of essentially duplicate \"docstrings\".\n\nBetween this, and the small PR to flint from #27714 this resolved all build issues for me.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9694f661c15fc27e221148be430c31bec975dbf\">a9694f6</a></td><td><code>Ticket #27721: Add wrappers for flint and arb headers when used in Sage.</code></td></tr></table>\n",
    "created_at": "2019-05-02T16:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432619",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'>Comment 7:</a>
Here is my proposal for wrappers for the flint and arb headers to use when including them in Sage.  Rather than make many wrappers for each individual header, I just include all the flint headers in the flint wrapper, and similarly in the arb wrapper (with `flint/NTL-interface.h` being one special exception).

This of course results in "over-including" in some cases, but I don't think this is a serious problem.

I'm also aware that in newer versions of Cython it's possible to add arbitrary post-include code in a docstring under a `cdef extern` statement, but I felt that this would be more reliable and manageable than dozens of essentially duplicate "docstrings".

Between this, and the small PR to flint from #27714 this resolved all build issues for me.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9694f661c15fc27e221148be430c31bec975dbf">a9694f6</a></td><td><code>Ticket #27721: Add wrappers for flint and arb headers when used in Sage.</code></td></tr></table>




---

archive/issue_comments_432620.json:
```json
{
    "body": "Branch: **[u/embray/ticket-27721](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27721)**",
    "created_at": "2019-05-02T16:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432620",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/ticket-27721](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27721)**



---

archive/issue_comments_432621.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2019-05-02T16:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432621",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_comments_432622.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nIf there's anything I could have done more simply I'd be happy to hear it, but this was the cleanest approach I could come up with.",
    "created_at": "2019-05-02T16:28:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432622",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'>Comment 8:</a>
If there's anything I could have done more simply I'd be happy to hear it, but this was the cleanest approach I could come up with.



---

archive/issue_comments_432623.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nI like the general idea but there is some room for bikeshedding:\n\n1. I would prefer to keep the name `ulong` in Cython code. There we have namespacing if we need (we can use `sage.libs.flint.ulong` instead of just `ulong`) and it makes it easier to just copy-paste new declarations from the flint/arb headers. So we don't actually need the new names `fulong` and `fslong`, we can just do `ctypedef mp_limb_t ulong` in Cython (*without* `cdef extern`).\n\n2. In flint, I like that you kept the old header names for documentation, but I would remove the commented-out `cdef extern from` (but keep the header name) and I would do the same for arb.\n\nWhat do you think?",
    "created_at": "2019-05-03T07:57:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432623",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'>Comment 9:</a>
I like the general idea but there is some room for bikeshedding:

1. I would prefer to keep the name `ulong` in Cython code. There we have namespacing if we need (we can use `sage.libs.flint.ulong` instead of just `ulong`) and it makes it easier to just copy-paste new declarations from the flint/arb headers. So we don't actually need the new names `fulong` and `fslong`, we can just do `ctypedef mp_limb_t ulong` in Cython (*without* `cdef extern`).

2. In flint, I like that you kept the old header names for documentation, but I would remove the commented-out `cdef extern from` (but keep the header name) and I would do the same for arb.

What do you think?



---

archive/issue_comments_432624.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@jdemeyer](#comment%3A9):\n> I like the general idea but there is some room for bikeshedding:\n> \n> 1. I would prefer to keep the name `ulong` in Cython code. There we have namespacing if we need (we can use `sage.libs.flint.ulong` instead of just `ulong`) and it makes it easier to just copy-paste new declarations from the flint/arb headers. So we don't actually need the new names `fulong` and `fslong`, we can just do `ctypedef mp_limb_t ulong` in Cython (*without* `cdef extern`).\n\nI think I see what you're saying.  But how would this work in cases where we want to use flint and zn_poly together, or flint and pari together?  IIUC `ctypedef mp_limb_t ulong` will put an actual `typedef mp_limb_t ulong` into the C sources, which could conflict with the `ulong` from those other libraries' headers.\n\nOr should we provide wrappers for them too?\n\nMaybe I'm missing something though. I'm willing to try it.\n\n\n> 2. In flint, I like that you kept the old header names for documentation, but I would remove the commented-out `cdef extern from` (but keep the header name) and I would do the same for arb.\n> \n> What do you think?\n\nSo keep the comments but just the original header name, like\n\n```\n# flint/flint.h\n```\n\nor something like that?",
    "created_at": "2019-05-03T13:50:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432624",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@jdemeyer](#comment%3A9):
> I like the general idea but there is some room for bikeshedding:
> 
> 1. I would prefer to keep the name `ulong` in Cython code. There we have namespacing if we need (we can use `sage.libs.flint.ulong` instead of just `ulong`) and it makes it easier to just copy-paste new declarations from the flint/arb headers. So we don't actually need the new names `fulong` and `fslong`, we can just do `ctypedef mp_limb_t ulong` in Cython (*without* `cdef extern`).

I think I see what you're saying.  But how would this work in cases where we want to use flint and zn_poly together, or flint and pari together?  IIUC `ctypedef mp_limb_t ulong` will put an actual `typedef mp_limb_t ulong` into the C sources, which could conflict with the `ulong` from those other libraries' headers.

Or should we provide wrappers for them too?

Maybe I'm missing something though. I'm willing to try it.


> 2. In flint, I like that you kept the old header names for documentation, but I would remove the commented-out `cdef extern from` (but keep the header name) and I would do the same for arb.
> 
> What do you think?

So keep the comments but just the original header name, like

```
# flint/flint.h
```

or something like that?



---

archive/issue_comments_432625.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nReplying to [@embray](#comment%3A10):\n>  `ctypedef mp_limb_t ulong` will put an actual `typedef mp_limb_t ulong` into the C sources\n\nCython mangles names which are not `cdef extern`. You'll get something like\n\n```\ntypedef mp_limb_t __pyx_sage_libs_flint_ulong;\n```\n(not exactly but you get the point)\n\n> So keep the comments but just the original header name, like\n> \n> ```\n> # flint/flint.h\n> ```\n> \n> or something like that?\n\n+1",
    "created_at": "2019-05-03T13:56:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432625",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'>Comment 11:</a>
Replying to [@embray](#comment%3A10):
>  `ctypedef mp_limb_t ulong` will put an actual `typedef mp_limb_t ulong` into the C sources

Cython mangles names which are not `cdef extern`. You'll get something like

```
typedef mp_limb_t __pyx_sage_libs_flint_ulong;
```
(not exactly but you get the point)

> So keep the comments but just the original header name, like
> 
> ```
> # flint/flint.h
> ```
> 
> or something like that?

+1



---

archive/issue_comments_432626.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@jdemeyer](#comment%3A11):\n> Replying to [@embray](#comment%3A10):\n> >  `ctypedef mp_limb_t ulong` will put an actual `typedef mp_limb_t ulong` into the C sources\n\n> \n> Cython mangles names which are not `cdef extern`. You'll get something like\n> \n> ```\n> typedef mp_limb_t __pyx_sage_libs_flint_ulong;\n> ```\n> (not exactly but you get the point)\n\nAh, that's right, that's what I was missing.  When looking at Cython-generated code I'm so used at this point to just ignoring the `__pyx` prefixes that I forget they're there :)  I'll give that a try then.",
    "created_at": "2019-05-03T14:09:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432626",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@jdemeyer](#comment%3A11):
> Replying to [@embray](#comment%3A10):
> >  `ctypedef mp_limb_t ulong` will put an actual `typedef mp_limb_t ulong` into the C sources

> 
> Cython mangles names which are not `cdef extern`. You'll get something like
> 
> ```
> typedef mp_limb_t __pyx_sage_libs_flint_ulong;
> ```
> (not exactly but you get the point)

Ah, that's right, that's what I was missing.  When looking at Cython-generated code I'm so used at this point to just ignoring the `__pyx` prefixes that I forget they're there :)  I'll give that a try then.



---

archive/issue_comments_432627.json:
```json
{
    "body": "Changed commit from **[a9694f6](https://github.com/sagemath/sagetrac-mirror/commit/a9694f661c15fc27e221148be430c31bec975dbf)** to **[38b8e6b](https://github.com/sagemath/sagetrac-mirror/commit/38b8e6b7014064e229e339b50dd5e7065b4ad4ca)**",
    "created_at": "2019-05-06T17:04:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432627",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a9694f6](https://github.com/sagemath/sagetrac-mirror/commit/a9694f661c15fc27e221148be430c31bec975dbf)** to **[38b8e6b](https://github.com/sagemath/sagetrac-mirror/commit/38b8e6b7014064e229e339b50dd5e7065b4ad4ca)**



---

archive/issue_comments_432628.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b19fee50a57f6d49c0b98a2b382a5bb17dcda8b\">6b19fee</a></td><td><code>Ticket #27721: Add wrappers for flint and arb headers when used in Sage.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba313c53b6d7b5829c68ecf9e6f4b8567662ac9d\">ba313c5</a></td><td><code>fix up documentation commentary</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/95911895e1c35d02801199c2ababe40f363fae13\">9591189</a></td><td><code>Revert ulong/slong -> fulong/fslong</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/38b8e6b7014064e229e339b50dd5e7065b4ad4ca\">38b8e6b</a></td><td><code>Rework these wrappers a bit more:</code></td></tr></table>\n",
    "created_at": "2019-05-06T17:04:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432628",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:13'>Comment 13:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b19fee50a57f6d49c0b98a2b382a5bb17dcda8b">6b19fee</a></td><td><code>Ticket #27721: Add wrappers for flint and arb headers when used in Sage.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba313c53b6d7b5829c68ecf9e6f4b8567662ac9d">ba313c5</a></td><td><code>fix up documentation commentary</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/95911895e1c35d02801199c2ababe40f363fae13">9591189</a></td><td><code>Revert ulong/slong -> fulong/fslong</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/38b8e6b7014064e229e339b50dd5e7065b4ad4ca">38b8e6b</a></td><td><code>Rework these wrappers a bit more:</code></td></tr></table>




---

archive/issue_comments_432629.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nRebased and addressed review comments, plus fixed some more build issues I had on Linux.\n\nWould still like to squash before merging since otherwise this makes a mess of git blame on several of these files.",
    "created_at": "2019-05-06T17:05:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432629",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'>Comment 14:</a>
Rebased and addressed review comments, plus fixed some more build issues I had on Linux.

Would still like to squash before merging since otherwise this makes a mess of git blame on several of these files.



---

archive/issue_comments_432630.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nIs there anything holding this up?",
    "created_at": "2019-06-04T12:12:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432630",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'>Comment 15:</a>
Is there anything holding this up?



---

archive/issue_comments_432631.json:
```json
{
    "body": "Reviewer: **Volker Braun**",
    "created_at": "2019-06-14T11:29:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432631",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Volker Braun**



---

archive/issue_comments_432632.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nFeel free to squash the commits...",
    "created_at": "2019-06-14T11:29:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432632",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'>Comment 16:</a>
Feel free to squash the commits...



---

archive/issue_events_362115.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-14T11:29:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27721#event-362115"
}
```



---

archive/issue_events_362116.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-14T11:29:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27721#event-362116"
}
```



---

archive/issue_comments_432633.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nThanks. I'll squash in a few minutes.",
    "created_at": "2019-06-14T11:43:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432633",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'>Comment 17:</a>
Thanks. I'll squash in a few minutes.



---

archive/issue_comments_432634.json:
```json
{
    "body": "Changed commit from **[38b8e6b](https://github.com/sagemath/sagetrac-mirror/commit/38b8e6b7014064e229e339b50dd5e7065b4ad4ca)** to **[0aa0177](https://github.com/sagemath/sagetrac-mirror/commit/0aa0177220205a67e4981b994f2efecdadb057ac)**",
    "created_at": "2019-06-14T12:02:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432634",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[38b8e6b](https://github.com/sagemath/sagetrac-mirror/commit/38b8e6b7014064e229e339b50dd5e7065b4ad4ca)** to **[0aa0177](https://github.com/sagemath/sagetrac-mirror/commit/0aa0177220205a67e4981b994f2efecdadb057ac)**



---

archive/issue_events_362117.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2019-06-14T12:02:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27721#event-362117"
}
```



---

archive/issue_events_362118.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2019-06-14T12:02:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27721#event-362118"
}
```



---

archive/issue_comments_432635.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0aa0177220205a67e4981b994f2efecdadb057ac\">0aa0177</a></td><td><code>Ticket #27721: Add wrappers for flint and arb headers when used in Sage.</code></td></tr></table>\n",
    "created_at": "2019-06-14T12:02:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432635",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:18'>Comment 18:</a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0aa0177220205a67e4981b994f2efecdadb057ac">0aa0177</a></td><td><code>Ticket #27721: Add wrappers for flint and arb headers when used in Sage.</code></td></tr></table>




---

archive/issue_events_362119.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-16T16:49:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27721#event-362119"
}
```



---

archive/issue_events_362120.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-16T16:49:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27721#event-362120"
}
```



---

archive/issue_comments_432636.json:
```json
{
    "body": "Changed branch from **[u/embray/ticket-27721](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27721)** to **[0aa0177](https://github.com/sagemath/sagetrac-mirror/commit/0aa0177220205a67e4981b994f2efecdadb057ac)**",
    "created_at": "2019-06-27T20:13:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432636",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/ticket-27721](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27721)** to **[0aa0177](https://github.com/sagemath/sagetrac-mirror/commit/0aa0177220205a67e4981b994f2efecdadb057ac)**



---

archive/issue_events_362121.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-27T20:13:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27721#event-362121"
}
```



---

archive/issue_events_362122.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "3574dd8c2d43cac39f461e5e3c06a02c1f858bd3",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-06-27T20:13:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27721#event-362122"
}
```



---

archive/issue_events_362123.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:34:48Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27721#event-362123"
}
```



---

archive/issue_events_362124.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:34:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27721#event-362124"
}
```



---

archive/issue_comments_432637.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nNot in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were *actually* included, especially when closing tickets.",
    "created_at": "2019-07-03T11:34:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432637",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'>Comment 21:</a>
Not in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were *actually* included, especially when closing tickets.



---

archive/issue_comments_432638.json:
```json
{
    "body": "Changed commit from **[0aa0177](https://github.com/sagemath/sagetrac-mirror/commit/0aa0177220205a67e4981b994f2efecdadb057ac)** to none",
    "created_at": "2019-07-03T11:49:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432638",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[0aa0177](https://github.com/sagemath/sagetrac-mirror/commit/0aa0177220205a67e4981b994f2efecdadb057ac)** to none



---

archive/issue_comments_432639.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nI get (with python3) this new failure in 8.9.b0:\n\n```\nFile \"src/sage/rings/polynomial/polynomial_rational_flint.pyx\", line 2055, in sage.rings.polynomial.polynomial_rational_flint.Polynomial_rational_flint.galois_group\nFailed example:\n    G = f.galois_group(); G\nExpected:\n    Transitive group number 5 of degree 4\nGot:\n    Exception (FLINT memory_manager). Unable to allocate memory.\n    Transitive group number 5 of degree 4\n```\nCould that be caused by this ticket ?",
    "created_at": "2019-07-03T11:49:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432639",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:22'>Comment 22:</a>
I get (with python3) this new failure in 8.9.b0:

```
File "src/sage/rings/polynomial/polynomial_rational_flint.pyx", line 2055, in sage.rings.polynomial.polynomial_rational_flint.Polynomial_rational_flint.galois_group
Failed example:
    G = f.galois_group(); G
Expected:
    Transitive group number 5 of degree 4
Got:
    Exception (FLINT memory_manager). Unable to allocate memory.
    Transitive group number 5 of degree 4
```
Could that be caused by this ticket ?



---

archive/issue_comments_432640.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\n*Probably* not, though I would never rule anything out entirely at this point.  It's strange that you only get it on Python 3 though.  That's the main reason I'm doubtful.  Please open a separate ticket and I can look into it when I can.",
    "created_at": "2019-07-03T11:55:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432640",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'>Comment 23:</a>
*Probably* not, though I would never rule anything out entirely at this point.  It's strange that you only get it on Python 3 though.  That's the main reason I'm doubtful.  Please open a separate ticket and I can look into it when I can.



---

archive/issue_comments_432641.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nI have made #28103",
    "created_at": "2019-07-03T11:58:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27721#issuecomment-432641",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:24'>Comment 24:</a>
I have made #28103
