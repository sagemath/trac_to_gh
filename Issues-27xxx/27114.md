# Issue 27114: Further libffi fixes

archive/issues_026877.json:
```json
{
    "body": "with #27219 done, all it remains is just to fix spkg-configure.m4\n\nCC:  @embray @strogdon\n\nKeywords: spkg-configure\n\nReviewer: Erik Bray, Dima Pasechnik\n\nAuthor: Erik Bray\n\nBranch: 07e5561184d6520f049334cf1e1619c1428e5433\n\nDependencies: #27109, #27219\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27114\n\n",
    "closed_at": "2019-02-10T12:55:44Z",
    "created_at": "2019-01-25T09:40:55Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Further libffi fixes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27114",
    "user": "https://github.com/jdemeyer"
}
```
with #27219 done, all it remains is just to fix spkg-configure.m4

CC:  @embray @strogdon

Keywords: spkg-configure

Reviewer: Erik Bray, Dima Pasechnik

Author: Erik Bray

Branch: 07e5561184d6520f049334cf1e1619c1428e5433

Dependencies: #27109, #27219

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27114





---

archive/issue_comments_521450.json:
```json
{
    "body": "Changing branch from \"\" to \"u/embray/build/ticket-27109\"",
    "created_at": "2019-01-25T09:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521450",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/embray/build/ticket-27109"



---

archive/issue_comments_521451.json:
```json
{
    "body": "Changing commit from \"\" to \"4d9ccb4a31892374bc8eb1b16a7f9b9a2d7cc1d1\"",
    "created_at": "2019-01-25T09:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521451",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "4d9ccb4a31892374bc8eb1b16a7f9b9a2d7cc1d1"



---

archive/issue_comments_521452.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2019-01-25T09:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521452",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_521453.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#27109\"",
    "created_at": "2019-01-25T09:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521453",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "" to "#27109"



---

archive/issue_comments_521454.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-01-25T09:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521454",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_521455.json:
```json
{
    "body": "<a id='comment:4'></a>Since Steven already said this worked, I'm inclined to go ahead and set this to positive review.  Though I might like to try on OSX since it doesn't have pkg-config and I'm not 100% sure what it will do in this case (I think it will \"fail correctly\" but I'm not certain).",
    "created_at": "2019-01-25T10:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521455",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>Since Steven already said this worked, I'm inclined to go ahead and set this to positive review.  Though I might like to try on OSX since it doesn't have pkg-config and I'm not 100% sure what it will do in this case (I think it will "fail correctly" but I'm not certain).



---

archive/issue_comments_521456.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [embray](#comment%3A4):\n> Since Steven already said this worked, I'm inclined to go ahead and set this to positive review.  Though I might like to try on OSX since it doesn't have pkg-config and I'm not 100% sure what it will do in this case (I think it will \"fail correctly\" but I'm not certain).\n\nI'm fine with this. I too think it should be checked on other distros.",
    "created_at": "2019-01-25T15:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521456",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:5'></a>Replying to [embray](#comment%3A4):
> Since Steven already said this worked, I'm inclined to go ahead and set this to positive review.  Though I might like to try on OSX since it doesn't have pkg-config and I'm not 100% sure what it will do in this case (I think it will "fail correctly" but I'm not certain).

I'm fine with this. I too think it should be checked on other distros.



---

archive/issue_comments_521457.json:
```json
{
    "body": "<a id='comment:6'></a>Perhaps we should try to get this in as soon as possible, else there will be Linuxes with system `libffi` installed where the Sage version will be built and used. A system `libffi` will then not be used until an upgrade or a manual removal of the Sage installed version.",
    "created_at": "2019-01-27T21:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521457",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:6'></a>Perhaps we should try to get this in as soon as possible, else there will be Linuxes with system `libffi` installed where the Sage version will be built and used. A system `libffi` will then not be used until an upgrade or a manual removal of the Sage installed version.



---

archive/issue_comments_521458.json:
```json
{
    "body": "<a id='comment:7'></a>See https://groups.google.com/forum/?pli=1#!topic/sage-devel/PvcY2LHU1fo",
    "created_at": "2019-01-28T05:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521458",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>See https://groups.google.com/forum/?pli=1#!topic/sage-devel/PvcY2LHU1fo



---

archive/issue_comments_521459.json:
```json
{
    "body": "<a id='comment:8'></a>Is there any reason why the patchbot emmits:\n\n```\nconfigure:8323: error: possibly undefined macro: AC_SEARCH_LIBS\nconfigure:8324: error: possibly undefined macro: AC_CHECK_HEADERS\n```\nShouldn't it have `autotools` installed?",
    "created_at": "2019-01-28T20:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521459",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:8'></a>Is there any reason why the patchbot emmits:

```
configure:8323: error: possibly undefined macro: AC_SEARCH_LIBS
configure:8324: error: possibly undefined macro: AC_CHECK_HEADERS
```
Shouldn't it have `autotools` installed?



---

archive/issue_comments_521460.json:
```json
{
    "body": "<a id='comment:9'></a>On OSX this \"works\" okay, or doesn't work as the case may be, in that it (correctly) fails to find `pkg-config`, and thus does not try to *use* `pkg-config`.\n\nI am seeing some other troubling problems failing to detect a system libffi on OSX, but I think whatever that problem is predates this ticket.",
    "created_at": "2019-01-29T17:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521460",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>On OSX this "works" okay, or doesn't work as the case may be, in that it (correctly) fails to find `pkg-config`, and thus does not try to *use* `pkg-config`.

I am seeing some other troubling problems failing to detect a system libffi on OSX, but I think whatever that problem is predates this ticket.



---

archive/issue_comments_521461.json:
```json
{
    "body": "<a id='comment:10'></a>I have no idea about the patchbot.  It is probably missing some dependency for running autoconf.  Maybe this ticket needs a `configure.tar.gz` package, though it really should't...",
    "created_at": "2019-01-29T17:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521461",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>I have no idea about the patchbot.  It is probably missing some dependency for running autoconf.  Maybe this ticket needs a `configure.tar.gz` package, though it really should't...



---

archive/issue_comments_521462.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-29T17:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521462",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_521463.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Erik Bray\"",
    "created_at": "2019-01-29T17:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521463",
    "user": "https://github.com/embray"
}
```

Changing reviewer from "" to "Erik Bray"



---

archive/issue_comments_521464.json:
```json
{
    "body": "<a id='comment:12'></a>Let's just ask Volker and see.",
    "created_at": "2019-01-29T17:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521464",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>Let's just ask Volker and see.



---

archive/issue_comments_521465.json:
```json
{
    "body": "Changing commit from \"4d9ccb4a31892374bc8eb1b16a7f9b9a2d7cc1d1\" to \"3d2eb36cc0ff7bdc9cb5447858aa15413cd07da4\"",
    "created_at": "2019-01-29T17:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521465",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4d9ccb4a31892374bc8eb1b16a7f9b9a2d7cc1d1" to "3d2eb36cc0ff7bdc9cb5447858aa15413cd07da4"



---

archive/issue_comments_521466.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2019-01-29T17:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521466",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_521467.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-01-29T17:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521467",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_521468.json:
```json
{
    "body": "<a id='comment:14'></a>With apologies for being a bit sloppy about it, here are a couple more fixes I found while testing this on OSX.",
    "created_at": "2019-01-29T17:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521468",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>With apologies for being a bit sloppy about it, here are a couple more fixes I found while testing this on OSX.



---

archive/issue_comments_521469.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-29T17:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521469",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_521470.json:
```json
{
    "body": "<a id='comment:16'></a>just to confirm that libffi's spkg-configure.m4 on this branch works with the pretty non-standard settings on Gentoo, cf. #27175.",
    "created_at": "2019-01-31T13:00:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521470",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>just to confirm that libffi's spkg-configure.m4 on this branch works with the pretty non-standard settings on Gentoo, cf. #27175.



---

archive/issue_comments_521471.json:
```json
{
    "body": "<a id='comment:17'></a>However, supporting this properly on Homebrew really needs a call to pkg-config.\n(as there ffi.h really goes to a weird location).",
    "created_at": "2019-01-31T19:44:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521471",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>However, supporting this properly on Homebrew really needs a call to pkg-config.
(as there ffi.h really goes to a weird location).



---

archive/issue_comments_521472.json:
```json
{
    "body": "<a id='comment:18'></a>Fails ./bootstrap on kucalc (autoconf-2.13), maybe the script could be made more backward compatible?\n\n```\nmake[1]: warning: -jN forced in submake: disabling jobserver mode.\nconfigure.ac:308: installing 'config/compile'\nconfigure.ac:105: installing 'config/config.guess'\nconfigure.ac:105: installing 'config/config.sub'\nconfigure.ac:68: installing 'config/install-sh'\nconfigure.ac:68: installing 'config/missing'\nconfigure.ac:13: error: possibly undefined macro: dnl\n      If this token and others are legitimate, please use m4_pattern_allow.\n      See the Autoconf documentation.\nconfigure:9028: error: possibly undefined macro: AC_CHECK_HEADERS\nconfigure:9029: error: possibly undefined macro: AC_SEARCH_LIBS\nMakefile:197: recipe for target 'configure' failed\nmake[1]: Leaving directory '/var/lib/buildbot/slave/sage_git/build'\nmake[1]: *** [configure] Error 1\nMakefile:31: recipe for target 'base-toolchain' failed\nmake: *** [base-toolchain] Error 2\nmake: Target 'start' not remade because of errors.\n```",
    "created_at": "2019-02-03T23:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521472",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>Fails ./bootstrap on kucalc (autoconf-2.13), maybe the script could be made more backward compatible?

```
make[1]: warning: -jN forced in submake: disabling jobserver mode.
configure.ac:308: installing 'config/compile'
configure.ac:105: installing 'config/config.guess'
configure.ac:105: installing 'config/config.sub'
configure.ac:68: installing 'config/install-sh'
configure.ac:68: installing 'config/missing'
configure.ac:13: error: possibly undefined macro: dnl
      If this token and others are legitimate, please use m4_pattern_allow.
      See the Autoconf documentation.
configure:9028: error: possibly undefined macro: AC_CHECK_HEADERS
configure:9029: error: possibly undefined macro: AC_SEARCH_LIBS
Makefile:197: recipe for target 'configure' failed
make[1]: Leaving directory '/var/lib/buildbot/slave/sage_git/build'
make[1]: *** [configure] Error 1
Makefile:31: recipe for target 'base-toolchain' failed
make: *** [base-toolchain] Error 2
make: Target 'start' not remade because of errors.
```



---

archive/issue_comments_521473.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-02-03T23:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521473",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_521474.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2019-02-04T01:08:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521474",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_521475.json:
```json
{
    "body": "<a id='comment:19'></a>`configure.ac:13: error: possibly undefined macro: dnl` indicates that this is waaaay to old for anything useful, really. It is from 1999 ([sic!](https://ftp.gnu.org/gnu/autoconf/))\n\nI think we should move on here, and whoever runs that bot should update...",
    "created_at": "2019-02-04T01:08:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521475",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>`configure.ac:13: error: possibly undefined macro: dnl` indicates that this is waaaay to old for anything useful, really. It is from 1999 ([sic!](https://ftp.gnu.org/gnu/autoconf/))

I think we should move on here, and whoever runs that bot should update...



---

archive/issue_comments_521476.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-02-04T10:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521476",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_521477.json:
```json
{
    "body": "<a id='comment:20'></a>This is Ubuntu 16.04.5 LTS. Sorry I had the wrong autoconf version (multiple are installed)\n\n```\nvbraun@kucalc:~$ autoconf --version\nautoconf (GNU Autoconf) 2.69\n```",
    "created_at": "2019-02-04T10:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521477",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:20'></a>This is Ubuntu 16.04.5 LTS. Sorry I had the wrong autoconf version (multiple are installed)

```
vbraun@kucalc:~$ autoconf --version
autoconf (GNU Autoconf) 2.69
```



---

archive/issue_comments_521478.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [vbraun](#comment%3A20):\n> This is Ubuntu 16.04.5 LTS. Sorry I had the wrong autoconf version (multiple are installed)\n> \n> ```\n> vbraun@kucalc:~$ autoconf --version\n> autoconf (GNU Autoconf) 2.69\n> ```\n\n\nBut the error messages are from a very old autoconf...\nWhat is the problem then, what \"needs_work\"?\n\nAre you saying you want a check that autoconf is new enough, and better error messages?",
    "created_at": "2019-02-04T11:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521478",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>Replying to [vbraun](#comment%3A20):
> This is Ubuntu 16.04.5 LTS. Sorry I had the wrong autoconf version (multiple are installed)
> 
> ```
> vbraun@kucalc:~$ autoconf --version
> autoconf (GNU Autoconf) 2.69
> ```


But the error messages are from a very old autoconf...
What is the problem then, what "needs_work"?

Are you saying you want a check that autoconf is new enough, and better error messages?



---

archive/issue_comments_521479.json:
```json
{
    "body": "<a id='comment:22'></a>Volker, please clarify: Should this just have a new `configure` tarball?  There's no reason for this to fail unless that machine is missing some dependencies to build the configure script, or some of the other tooling is misconfigured.  I cannot reproduce the same issue.",
    "created_at": "2019-02-04T11:02:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521479",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'></a>Volker, please clarify: Should this just have a new `configure` tarball?  There's no reason for this to fail unless that machine is missing some dependencies to build the configure script, or some of the other tooling is misconfigured.  I cannot reproduce the same issue.



---

archive/issue_comments_521480.json:
```json
{
    "body": "<a id='comment:23'></a>Okay, I was able to reproduce in a container.  Probably something is missing but I'm not sure what...",
    "created_at": "2019-02-04T15:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521480",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'></a>Okay, I was able to reproduce in a container.  Probably something is missing but I'm not sure what...



---

archive/issue_comments_521481.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2019-02-04T15:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521481",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_521482.json:
```json
{
    "body": "<a id='comment:24'></a>I see.  These errors indicate that `pkg-config` is not installed, since it is required to have the `PKG_CHECK_MODULES` macro.\n\nI could put in a fallback so that it works when `PKG_CHECK_MODULES` is not defined, but that would still build to a partially-crippled `configure` script.  So can we just require `pkg-config` to be installed to build the `configure` script?\n\nAlternatively, it might work if I include a copy of `pkg.m4` in our `m4/` directory, but I would rather not have to.",
    "created_at": "2019-02-04T15:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521482",
    "user": "https://github.com/embray"
}
```

<a id='comment:24'></a>I see.  These errors indicate that `pkg-config` is not installed, since it is required to have the `PKG_CHECK_MODULES` macro.

I could put in a fallback so that it works when `PKG_CHECK_MODULES` is not defined, but that would still build to a partially-crippled `configure` script.  So can we just require `pkg-config` to be installed to build the `configure` script?

Alternatively, it might work if I include a copy of `pkg.m4` in our `m4/` directory, but I would rather not have to.



---

archive/issue_comments_521483.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [embray](#comment%3A24):\n> Alternatively, it might work if I include a copy of `pkg.m4` in our `m4/` directory, but I would rather not have to.\n\n\nUpdate: this does work, but it's not ideal.  I would rather just have pkg-config installed.",
    "created_at": "2019-02-04T15:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521483",
    "user": "https://github.com/embray"
}
```

<a id='comment:25'></a>Replying to [embray](#comment%3A24):
> Alternatively, it might work if I include a copy of `pkg.m4` in our `m4/` directory, but I would rather not have to.


Update: this does work, but it's not ideal.  I would rather just have pkg-config installed.



---

archive/issue_comments_521484.json:
```json
{
    "body": "<a id='comment:26'></a>If this dependence is really prebuilt- only, then why not, I see no problem in requiring it along with autotools",
    "created_at": "2019-02-04T15:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521484",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'></a>If this dependence is really prebuilt- only, then why not, I see no problem in requiring it along with autotools



---

archive/issue_comments_521485.json:
```json
{
    "body": "<a id='comment:27'></a>I don't mind requiring pkgconfig to actually run autoconf, but having bootstrap error out and not download the confball is not an option ;-)",
    "created_at": "2019-02-04T18:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521485",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:27'></a>I don't mind requiring pkgconfig to actually run autoconf, but having bootstrap error out and not download the confball is not an option ;-)



---

archive/issue_comments_521486.json:
```json
{
    "body": "<a id='comment:28'></a>Please see #27219 to deal with the bootstrap issue.",
    "created_at": "2019-02-04T20:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521486",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'></a>Please see #27219 to deal with the bootstrap issue.



---

archive/issue_comments_521487.json:
```json
{
    "body": "Changing dependencies from \"#27109\" to \"#27109, #27219\"",
    "created_at": "2019-02-04T21:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521487",
    "user": "https://github.com/vbraun"
}
```

Changing dependencies from "#27109" to "#27109, #27219"



---

archive/issue_comments_521488.json:
```json
{
    "body": "Changing reviewer from \"Erik Bray\" to \"Erik Bray, Dima Pasechnik\"",
    "created_at": "2019-02-07T14:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521488",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "Erik Bray" to "Erik Bray, Dima Pasechnik"



---

archive/issue_comments_521489.json:
```json
{
    "body": "<a id='comment:30'></a>Erik, are you fine with this?",
    "created_at": "2019-02-07T14:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521489",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>Erik, are you fine with this?



---

archive/issue_comments_521490.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+with #27219 done, all it remains is just to fix spkg-configure.m4\n``````\n",
    "created_at": "2019-02-07T14:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521490",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+with #27219 done, all it remains is just to fix spkg-configure.m4
``````




---

archive/issue_comments_521491.json:
```json
{
    "body": "Changing branch from \"u/embray/build/ticket-27109\" to \"public/build/better_libffi_config\"",
    "created_at": "2019-02-07T14:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521491",
    "user": "https://github.com/dimpase"
}
```

Changing branch from "u/embray/build/ticket-27109" to "public/build/better_libffi_config"



---

archive/issue_comments_521492.json:
```json
{
    "body": "Changing commit from \"3d2eb36cc0ff7bdc9cb5447858aa15413cd07da4\" to \"07e5561184d6520f049334cf1e1619c1428e5433\"",
    "created_at": "2019-02-07T14:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521492",
    "user": "https://github.com/dimpase"
}
```

Changing commit from "3d2eb36cc0ff7bdc9cb5447858aa15413cd07da4" to "07e5561184d6520f049334cf1e1619c1428e5433"



---

archive/issue_comments_521493.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2019-02-07T14:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521493",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_521494.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-07T18:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521494",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_521495.json:
```json
{
    "body": "<a id='comment:31'></a>Yep, per my comment on the other ticket.  Thanks!",
    "created_at": "2019-02-07T18:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521495",
    "user": "https://github.com/embray"
}
```

<a id='comment:31'></a>Yep, per my comment on the other ticket.  Thanks!



---

archive/issue_comments_521496.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-10T12:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521496",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_067351.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-10T12:55:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27114#event-67351"
}
```



---

archive/issue_comments_521497.json:
```json
{
    "body": "Changing branch from \"public/build/better_libffi_config\" to \"07e5561184d6520f049334cf1e1619c1428e5433\"",
    "created_at": "2019-02-10T12:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521497",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/build/better_libffi_config" to "07e5561184d6520f049334cf1e1619c1428e5433"



---

archive/issue_comments_521498.json:
```json
{
    "body": "Changing keywords from \"\" to \"spkg-configure\".",
    "created_at": "2019-02-12T09:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521498",
    "user": "https://github.com/dimpase"
}
```

Changing keywords from "" to "spkg-configure".



---

archive/issue_comments_521499.json:
```json
{
    "body": "Changing commit from \"07e5561184d6520f049334cf1e1619c1428e5433\" to \"\"",
    "created_at": "2019-02-12T09:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27114",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27114#issuecomment-521499",
    "user": "https://github.com/dimpase"
}
```

Changing commit from "07e5561184d6520f049334cf1e1619c1428e5433" to ""
