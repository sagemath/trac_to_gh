# Issue 27438: Properly re-enable USE_TLS=1 when building OpenBLAS SPKG

archive/issues_027201.json:
```json
{
    "assignees": [],
    "body": "#27256 did not fully fix the issue it was intended to fix.\n\nI missed the fact that the `spkg-install` has two invocations of `make`, the first one being somewhat obscured within an `if` statement.\n\nThe second `make` attempt is only run if the first one failed (e.g. due to the target CPU not being well supported).\n\nCC:  @vbraun\n\nKeywords: **openblas**\n\nBranch/Commit: **[cfc5a11](https://github.com/sagemath/sagetrac-mirror/commit/cfc5a116ba40e3b22c9a8e04383969e856c1139f)**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Erik Bray**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27438_\n\n",
    "closed_at": "2019-03-11T22:42:14Z",
    "created_at": "2019-03-07T14:10:03Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Properly re-enable USE_TLS=1 when building OpenBLAS SPKG",
    "type": "issue",
    "updated_at": "2019-03-11T22:42:14Z",
    "url": "https://github.com/sagemath/sage/issues/27438",
    "user": "https://github.com/embray"
}
```
#27256 did not fully fix the issue it was intended to fix.

I missed the fact that the `spkg-install` has two invocations of `make`, the first one being somewhat obscured within an `if` statement.

The second `make` attempt is only run if the first one failed (e.g. due to the target CPU not being well supported).

CC:  @vbraun

Keywords: **openblas**

Branch/Commit: **[cfc5a11](https://github.com/sagemath/sagetrac-mirror/commit/cfc5a116ba40e3b22c9a8e04383969e856c1139f)**

Reviewer: **Jeroen Demeyer**

Author: **Erik Bray**

_Issue created by migration from https://trac.sagemath.org/ticket/27438_





---

archive/issue_events_345945.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-07T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27438#event-345945"
}
```



---

archive/issue_events_345946.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-07T14:10:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27438#event-345946"
}
```



---

archive/issue_events_345947.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-07T14:10:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27438#event-345947"
}
```



---

archive/issue_events_345948.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-07T14:10:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27438#event-345948"
}
```



---

archive/issue_comments_427467.json:
```json
{
    "body": "Changed keywords from **** to **openblas**",
    "created_at": "2019-03-07T14:10:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27438#issuecomment-427467",
    "user": "https://github.com/embray"
}
```

Changed keywords from **** to **openblas**



---

archive/issue_comments_427468.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2019-03-07T14:14:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27438#issuecomment-427468",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_events_345949.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-07T14:14:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27438#event-345949"
}
```



---

archive/issue_comments_427469.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aebc79cc17b84929d68803c40f2578faaa697985\">aebc79c</a></td><td><code>Trac #27438: Make sure to pass USE_TLS=1 to all make invocations in the script</code></td></tr></table>\n",
    "created_at": "2019-03-07T14:14:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27438#issuecomment-427469",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'>Comment 2:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aebc79cc17b84929d68803c40f2578faaa697985">aebc79c</a></td><td><code>Trac #27438: Make sure to pass USE_TLS=1 to all make invocations in the script</code></td></tr></table>




---

archive/issue_comments_427470.json:
```json
{
    "body": "Branch: **[u/embray/ticket-27438](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27438)**",
    "created_at": "2019-03-07T14:14:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27438#issuecomment-427470",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/ticket-27438](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27438)**



---

archive/issue_comments_427471.json:
```json
{
    "body": "Commit: **[aebc79c](https://github.com/sagemath/sagetrac-mirror/commit/aebc79cc17b84929d68803c40f2578faaa697985)**",
    "created_at": "2019-03-07T14:14:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27438#issuecomment-427471",
    "user": "https://github.com/embray"
}
```

Commit: **[aebc79c](https://github.com/sagemath/sagetrac-mirror/commit/aebc79cc17b84929d68803c40f2578faaa697985)**



---

archive/issue_events_345950.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-08T10:47:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27438#event-345950"
}
```



---

archive/issue_events_345951.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-08T10:47:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27438#event-345951"
}
```



---

archive/issue_comments_427472.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nBefore moving forward with this; I think I might know what's up with #27434, and if I'm right about it would like to incorporate its solution into this ticket.",
    "created_at": "2019-03-08T10:47:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27438#issuecomment-427472",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'>Comment 3:</a>
Before moving forward with this; I think I might know what's up with #27434, and if I'm right about it would like to incorporate its solution into this ticket.



---

archive/issue_comments_427473.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nWhatever the remaining problem is in #27434 it's definitely more subtle than I originally thought, and I think not related in any way to the issue this is fixing, so I'll deal with it independently.",
    "created_at": "2019-03-08T14:18:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27438#issuecomment-427473",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'>Comment 4:</a>
Whatever the remaining problem is in #27434 it's definitely more subtle than I originally thought, and I think not related in any way to the issue this is fixing, so I'll deal with it independently.



---

archive/issue_events_345952.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-08T14:18:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27438#event-345952"
}
```



---

archive/issue_events_345953.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-08T14:18:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27438#event-345953"
}
```



---

archive/issue_comments_427474.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nHow should I test this, how do I know that OpenBLAS is really built with TLS enabled?",
    "created_at": "2019-03-08T14:56:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27438#issuecomment-427474",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'>Comment 5:</a>
How should I test this, how do I know that OpenBLAS is really built with TLS enabled?



---

archive/issue_events_345954.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-08T15:52:06Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "title_is": "Properly re-enable USE_TLS=1 when building OpenBLAS SPKG",
    "title_was": "Followup to #27256",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27438#event-345954"
}
```



---

archive/issue_comments_427475.json:
```json
{
    "body": "Changed branch from **[u/embray/ticket-27438](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27438)** to **[u/jdemeyer/ticket-27438](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket-27438)**",
    "created_at": "2019-03-08T16:00:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27438#issuecomment-427475",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/embray/ticket-27438](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-27438)** to **[u/jdemeyer/ticket-27438](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket-27438)**



---

archive/issue_comments_427476.json:
```json
{
    "body": "Changed commit from **[aebc79c](https://github.com/sagemath/sagetrac-mirror/commit/aebc79cc17b84929d68803c40f2578faaa697985)** to **[cfc5a11](https://github.com/sagemath/sagetrac-mirror/commit/cfc5a116ba40e3b22c9a8e04383969e856c1139f)**",
    "created_at": "2019-03-08T16:01:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27438#issuecomment-427476",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[aebc79c](https://github.com/sagemath/sagetrac-mirror/commit/aebc79cc17b84929d68803c40f2578faaa697985)** to **[cfc5a11](https://github.com/sagemath/sagetrac-mirror/commit/cfc5a116ba40e3b22c9a8e04383969e856c1139f)**



---

archive/issue_comments_427477.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2019-03-08T16:01:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27438#issuecomment-427477",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_345955.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-08T16:01:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27438#event-345955"
}
```



---

archive/issue_events_345956.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-08T16:01:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27438#event-345956"
}
```



---

archive/issue_comments_427478.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nOK, I see `-DUSE_TLS` in the compiler output, so it works.\n\nI do think that we should bump the package version since this is a functional change in the package.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cfc5a116ba40e3b22c9a8e04383969e856c1139f\">cfc5a11</a></td><td><code>Bump OpenBLAS package version</code></td></tr></table>\n",
    "created_at": "2019-03-08T16:01:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27438#issuecomment-427478",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'>Comment 8:</a>
OK, I see `-DUSE_TLS` in the compiler output, so it works.

I do think that we should bump the package version since this is a functional change in the package.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cfc5a116ba40e3b22c9a8e04383969e856c1139f">cfc5a11</a></td><td><code>Bump OpenBLAS package version</code></td></tr></table>




---

archive/issue_comments_427479.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nThank you, and yes I agree with bumping the package version (even though it means having to rebuild quite a bit, alas).\n\nI'm not sure why we don't make `$(BLAS)` a prerequisite-only dependency for more things.  As long as they are dynamically linking to the libopenblas.so it should't be necessary to rebuild most things that depend on it, exception being if there is a non-trivial dependency on anything that might change in the headers due to re-configuration.",
    "created_at": "2019-03-11T08:24:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27438#issuecomment-427479",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'>Comment 9:</a>
Thank you, and yes I agree with bumping the package version (even though it means having to rebuild quite a bit, alas).

I'm not sure why we don't make `$(BLAS)` a prerequisite-only dependency for more things.  As long as they are dynamically linking to the libopenblas.so it should't be necessary to rebuild most things that depend on it, exception being if there is a non-trivial dependency on anything that might change in the headers due to re-configuration.



---

archive/issue_comments_427480.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket-27438](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket-27438)** to **[cfc5a11](https://github.com/sagemath/sagetrac-mirror/commit/cfc5a116ba40e3b22c9a8e04383969e856c1139f)**",
    "created_at": "2019-03-11T22:42:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27438#issuecomment-427480",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket-27438](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket-27438)** to **[cfc5a11](https://github.com/sagemath/sagetrac-mirror/commit/cfc5a116ba40e3b22c9a8e04383969e856c1139f)**



---

archive/issue_events_345957.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-11T22:42:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27438#event-345957"
}
```



---

archive/issue_events_345958.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d982527e6a485d4756c9e10ffee480e9304a2262",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-03-11T22:42:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27438",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27438#event-345958"
}
```
