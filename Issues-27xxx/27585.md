# Issue 27585: py3: fixes in matrices

archive/issues_027348.json:
```json
{
    "body": "This fixes a few doctests for sage.matrices:\n\n- there is some randomness in the ordering in one small part of one verbose test in `compute_J_ideal.py`, so replace it with `...`\n- up to now, `mat[range(3), range(4)]` did not work, so I've tried to modify `__getitem__` and `__setitem__` to allow `range` types as inputs\n- some doctests use random matrices to test other features. The randomness differs on Python 2 vs. Python 3, so get rid of the randomness. The tests still test the relevant methods (which are determinants, for example, not the randomness).\n- there is minor numerical noise in one doctest.\n\n\nCC:  @jdemeyer @fchapoton @tscrim\n\nBranch/Commit: [888612cf517cdb99c075ba3bdde0dfbfbff75942](https://github.com/sagemath/sagetrac-mirror/commit/888612cf517cdb99c075ba3bdde0dfbfbff75942)\n\nReviewer: Vincent Klein\n\nAuthor: John Palmieri\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27585\n\n",
    "closed_at": "2019-04-03T18:38:28Z",
    "created_at": "2019-04-01T00:14:36Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "py3: fixes in matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27585",
    "user": "https://github.com/jhpalmieri"
}
```
This fixes a few doctests for sage.matrices:

- there is some randomness in the ordering in one small part of one verbose test in `compute_J_ideal.py`, so replace it with `...`
- up to now, `mat[range(3), range(4)]` did not work, so I've tried to modify `__getitem__` and `__setitem__` to allow `range` types as inputs
- some doctests use random matrices to test other features. The randomness differs on Python 2 vs. Python 3, so get rid of the randomness. The tests still test the relevant methods (which are determinants, for example, not the randomness).
- there is minor numerical noise in one doctest.


CC:  @jdemeyer @fchapoton @tscrim

Branch/Commit: [888612cf517cdb99c075ba3bdde0dfbfbff75942](https://github.com/sagemath/sagetrac-mirror/commit/888612cf517cdb99c075ba3bdde0dfbfbff75942)

Reviewer: Vincent Klein

Author: John Palmieri

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27585





---

archive/issue_comments_534117.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jhpalmieri/matrix-py3\"",
    "created_at": "2019-04-01T00:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534117",
    "user": "https://github.com/jhpalmieri"
}
```

Changing branch from "" to "u/jhpalmieri/matrix-py3"



---

archive/issue_comments_534118.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-04-01T00:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534118",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_534119.json:
```json
{
    "body": "<a id='comment:2'></a>\nRegarding the random matrix issue: I think what's going on is that the different versions of Python are using different orderings on monomials in `QQ.<x,y>`, for instance, so after coming up with a list of random coefficients, the resulting polynomials are different. (With Python 2, you would see `a*y^2 + b*x*y` while in Python 3 you would see `a*x*y + b*y^2`, same coefficients `a` and `b` in the two cases.)\n\nRegarding the changes to allow `range(...)` as valid input to `__getitem__` and `__setitem__` for matrices: are these changes okay? Is there a better way to do it?\n\n---\nNew commits:\n|                                                                                                                                          |                                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|\n|[888612c](https://github.com/sagemath/sagetrac-mirror/commit/888612cf517cdb99c075ba3bdde0dfbfbff75942)|`trac 27585: work on Python 3 compatibility for sage.matrix`|",
    "created_at": "2019-04-01T00:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534119",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
Regarding the random matrix issue: I think what's going on is that the different versions of Python are using different orderings on monomials in `QQ.<x,y>`, for instance, so after coming up with a list of random coefficients, the resulting polynomials are different. (With Python 2, you would see `a*y^2 + b*x*y` while in Python 3 you would see `a*x*y + b*y^2`, same coefficients `a` and `b` in the two cases.)

Regarding the changes to allow `range(...)` as valid input to `__getitem__` and `__setitem__` for matrices: are these changes okay? Is there a better way to do it?

---
New commits:
|                                                                                                                                          |                                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
|[888612c](https://github.com/sagemath/sagetrac-mirror/commit/888612cf517cdb99c075ba3bdde0dfbfbff75942)|`trac 27585: work on Python 3 compatibility for sage.matrix`|



---

archive/issue_comments_534120.json:
```json
{
    "body": "Changing commit from \"\" to \"888612cf517cdb99c075ba3bdde0dfbfbff75942\"",
    "created_at": "2019-04-01T00:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534120",
    "user": "https://github.com/jhpalmieri"
}
```

Changing commit from "" to "888612cf517cdb99c075ba3bdde0dfbfbff75942"



---

archive/issue_comments_534121.json:
```json
{
    "body": "<a id='comment:3'></a>\nAfter this ticket, there is one remaining doctest failure in `sage.matrix`:\n\n```\nTypeError: type sage.rings.real_double.RealDoubleElement doesn't define __round__ method\n```\nin `matrix_double_dense.pyx`.",
    "created_at": "2019-04-01T00:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534121",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>
After this ticket, there is one remaining doctest failure in `sage.matrix`:

```
TypeError: type sage.rings.real_double.RealDoubleElement doesn't define __round__ method
```
in `matrix_double_dense.pyx`.



---

archive/issue_comments_534122.json:
```json
{
    "body": "<a id='comment:4'></a>\npatchbot errors are unrelated with this ticket.\\\\\nLooks good to me.",
    "created_at": "2019-04-02T08:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534122",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:4'></a>
patchbot errors are unrelated with this ticket.\\
Looks good to me.



---

archive/issue_comments_534123.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-04-02T08:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534123",
    "user": "https://github.com/vinklein"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_534124.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Vincent Klein\"",
    "created_at": "2019-04-02T09:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534124",
    "user": "https://github.com/vinklein"
}
```

Changing reviewer from "" to "Vincent Klein"



---

archive/issue_events_077684.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-03T18:38:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27585#event-77684"
}
```



---

archive/issue_comments_534125.json:
```json
{
    "body": "Changing branch from \"u/jhpalmieri/matrix-py3\" to \"888612cf517cdb99c075ba3bdde0dfbfbff75942\"",
    "created_at": "2019-04-03T18:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534125",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jhpalmieri/matrix-py3" to "888612cf517cdb99c075ba3bdde0dfbfbff75942"



---

archive/issue_comments_534126.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-04-03T18:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534126",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
