# Issue 27585: py3: fixes in matrices

archive/issues_027348.json:
```json
{
    "body": "This fixes a few doctests for sage.matrices:\n\n- there is some randomness in the ordering in one small part of one verbose test in `compute_J_ideal.py`, so replace it with `...`\n- up to now, `mat[range(3), range(4)]` did not work, so I've tried to modify `__getitem__` and `__setitem__` to allow `range` types as inputs\n- some doctests use random matrices to test other features. The randomness differs on Python 2 vs. Python 3, so get rid of the randomness. The tests still test the relevant methods (which are determinants, for example, not the randomness).\n- there is minor numerical noise in one doctest.\n\n\n**CC:**  @jdemeyer @fchapoton @tscrim\n\n**Branch/Commit:** [888612cf517cdb99c075ba3bdde0dfbfbff75942](https://github.com/sagemath/sagetrac-mirror/commit/888612cf517cdb99c075ba3bdde0dfbfbff75942)\n\n**Reviewer:** Vincent Klein\n\n**Author:** John Palmieri\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27585\n\n",
    "closed_at": "2019-04-03T18:38:28Z",
    "created_at": "2019-04-01T00:14:36Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "py3: fixes in matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27585",
    "user": "https://github.com/jhpalmieri"
}
```
This fixes a few doctests for sage.matrices:

- there is some randomness in the ordering in one small part of one verbose test in `compute_J_ideal.py`, so replace it with `...`
- up to now, `mat[range(3), range(4)]` did not work, so I've tried to modify `__getitem__` and `__setitem__` to allow `range` types as inputs
- some doctests use random matrices to test other features. The randomness differs on Python 2 vs. Python 3, so get rid of the randomness. The tests still test the relevant methods (which are determinants, for example, not the randomness).
- there is minor numerical noise in one doctest.


**CC:**  @jdemeyer @fchapoton @tscrim

**Branch/Commit:** [888612cf517cdb99c075ba3bdde0dfbfbff75942](https://github.com/sagemath/sagetrac-mirror/commit/888612cf517cdb99c075ba3bdde0dfbfbff75942)

**Reviewer:** Vincent Klein

**Author:** John Palmieri

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/27585





---

archive/issue_comments_534091.json:
```json
{
    "body": "**Branch:** [u/jhpalmieri/matrix-py3](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/matrix-py3)",
    "created_at": "2019-04-01T00:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534091",
    "user": "https://github.com/jhpalmieri"
}
```

**Branch:** [u/jhpalmieri/matrix-py3](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/matrix-py3)



---

archive/issue_comments_534092.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2019-04-01T00:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534092",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_534093.json:
```json
{
    "body": "<a id='comment:2'></a>\nRegarding the random matrix issue: I think what's going on is that the different versions of Python are using different orderings on monomials in `QQ.<x,y>`, for instance, so after coming up with a list of random coefficients, the resulting polynomials are different. (With Python 2, you would see `a*y^2 + b*x*y` while in Python 3 you would see `a*x*y + b*y^2`, same coefficients `a` and `b` in the two cases.)\n\nRegarding the changes to allow `range(...)` as valid input to `__getitem__` and `__setitem__` for matrices: are these changes okay? Is there a better way to do it?\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/888612cf517cdb99c075ba3bdde0dfbfbff75942\">888612c</a></td><td><code>trac 27585: work on Python 3 compatibility for sage.matrix</code></td></tr></table>\n",
    "created_at": "2019-04-01T00:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534093",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
Regarding the random matrix issue: I think what's going on is that the different versions of Python are using different orderings on monomials in `QQ.<x,y>`, for instance, so after coming up with a list of random coefficients, the resulting polynomials are different. (With Python 2, you would see `a*y^2 + b*x*y` while in Python 3 you would see `a*x*y + b*y^2`, same coefficients `a` and `b` in the two cases.)

Regarding the changes to allow `range(...)` as valid input to `__getitem__` and `__setitem__` for matrices: are these changes okay? Is there a better way to do it?

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/888612cf517cdb99c075ba3bdde0dfbfbff75942">888612c</a></td><td><code>trac 27585: work on Python 3 compatibility for sage.matrix</code></td></tr></table>




---

archive/issue_comments_534094.json:
```json
{
    "body": "**Commit:** [888612cf517cdb99c075ba3bdde0dfbfbff75942](https://github.com/sagemath/sagetrac-mirror/commit/888612cf517cdb99c075ba3bdde0dfbfbff75942)",
    "created_at": "2019-04-01T00:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534094",
    "user": "https://github.com/jhpalmieri"
}
```

**Commit:** [888612cf517cdb99c075ba3bdde0dfbfbff75942](https://github.com/sagemath/sagetrac-mirror/commit/888612cf517cdb99c075ba3bdde0dfbfbff75942)



---

archive/issue_comments_534095.json:
```json
{
    "body": "<a id='comment:3'></a>\nAfter this ticket, there is one remaining doctest failure in `sage.matrix`:\n\n```\nTypeError: type sage.rings.real_double.RealDoubleElement doesn't define __round__ method\n```\nin `matrix_double_dense.pyx`.",
    "created_at": "2019-04-01T00:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534095",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>
After this ticket, there is one remaining doctest failure in `sage.matrix`:

```
TypeError: type sage.rings.real_double.RealDoubleElement doesn't define __round__ method
```
in `matrix_double_dense.pyx`.



---

archive/issue_comments_534096.json:
```json
{
    "body": "<a id='comment:4'></a>\npatchbot errors are unrelated with this ticket.\\\\\nLooks good to me.",
    "created_at": "2019-04-02T08:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534096",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:4'></a>
patchbot errors are unrelated with this ticket.\\
Looks good to me.



---

archive/issue_comments_534097.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2019-04-02T08:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534097",
    "user": "https://github.com/vinklein"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_534098.json:
```json
{
    "body": "**Reviewer:** Vincent Klein",
    "created_at": "2019-04-02T09:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534098",
    "user": "https://github.com/vinklein"
}
```

**Reviewer:** Vincent Klein



---

archive/issue_events_077684.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-03T18:38:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27585#event-77684"
}
```



---

archive/issue_comments_534099.json:
```json
{
    "body": "**Changing branch** from \"[u/jhpalmieri/matrix-py3](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/matrix-py3)\" to \"[888612cf517cdb99c075ba3bdde0dfbfbff75942](https://github.com/sagemath/sagetrac-mirror/commit/888612cf517cdb99c075ba3bdde0dfbfbff75942)\".",
    "created_at": "2019-04-03T18:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534099",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jhpalmieri/matrix-py3](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/matrix-py3)" to "[888612cf517cdb99c075ba3bdde0dfbfbff75942](https://github.com/sagemath/sagetrac-mirror/commit/888612cf517cdb99c075ba3bdde0dfbfbff75942)".



---

archive/issue_comments_534100.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2019-04-03T18:38:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27585#issuecomment-534100",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed
