# Issue 27823: spkg-configure.m4 for iconv

archive/issues_027586.json:
```json
{
    "assignees": [],
    "body": "In general the iconv SPKG is not even required.  It's not installed (or rather, a dummy empty package is installed) for any platforms except Cygwin, HP-UX, and Solaris.\n\nThe requirement for it on Cygwin is probably outdated--iconv is a standard library on almost all Cygwin installations, and is surely more up-to-date than when this SPKG was first added in #8567.  Support for the other two platforms has not been maintained much.\n\nWe can add a configure-time check for it, and treat it as a dummy package in most cases.\n\nCC:  @orlitzky @slel\n\nBranch: **[`2b5ceb1`](https://github.com/sagemath/sagetrac-mirror/commit/2b5ceb1d77c17ef83f2738bf4a1a82c84f124749)**\n\nReviewer: **Erik Bray, Dima Pasechnik**\n\nAuthor: **Dima Pasechnik, Erik Bray**\n\nComponent: **build: configure**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27823_\n\n",
    "closed_at": "2019-07-04T11:09:30Z",
    "created_at": "2019-05-13T15:23:41Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "spkg-configure.m4 for iconv",
    "type": "issue",
    "updated_at": "2021-02-07T22:01:56Z",
    "url": "https://github.com/sagemath/sage/issues/27823",
    "user": "https://github.com/embray"
}
```
In general the iconv SPKG is not even required.  It's not installed (or rather, a dummy empty package is installed) for any platforms except Cygwin, HP-UX, and Solaris.

The requirement for it on Cygwin is probably outdated--iconv is a standard library on almost all Cygwin installations, and is surely more up-to-date than when this SPKG was first added in #8567.  Support for the other two platforms has not been maintained much.

We can add a configure-time check for it, and treat it as a dummy package in most cases.

CC:  @orlitzky @slel

Branch: **[`2b5ceb1`](https://github.com/sagemath/sagetrac-mirror/commit/2b5ceb1d77c17ef83f2738bf4a1a82c84f124749)**

Reviewer: **Erik Bray, Dima Pasechnik**

Author: **Dima Pasechnik, Erik Bray**

Component: **build: configure**

_Issue created by migration from https://trac.sagemath.org/ticket/27823_





---

archive/issue_events_378668.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-05-13T15:23:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378668"
}
```



---

archive/issue_events_378669.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-05-13T15:23:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "0000b0",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378669"
}
```



---

archive/issue_events_378670.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-05-13T15:23:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378670"
}
```



---

archive/issue_events_378671.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-05-13T15:23:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378671"
}
```



---

archive/issue_comments_431613.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nthere is a cryptic \n\n```\n    # Disable NLS on Cygwin to be able to build libiconv without the Cygwin\n    # libiconv package.\n```\nI presume the latter line should be \"NLS package\", no ?\n\nDoes this mean that the Cygwin's \"native\" libiconv does not work?",
    "created_at": "2019-06-10T09:10:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431613",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:1" align="right">comment:1</div>

there is a cryptic 

```
    # Disable NLS on Cygwin to be able to build libiconv without the Cygwin
    # libiconv package.
```
I presume the latter line should be "NLS package", no ?

Does this mean that the Cygwin's "native" libiconv does not work?



---

archive/issue_comments_431614.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAccording to #13912, that `--disable-nls` on Cygwin was dictated by the desire to reduce the number of Cygwin deps.\nI think it can be scrapped.",
    "created_at": "2019-06-10T12:32:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431614",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2" align="right">comment:2</div>

According to #13912, that `--disable-nls` on Cygwin was dictated by the desire to reduce the number of Cygwin deps.
I think it can be scrapped.



---

archive/issue_comments_431615.json:
```json
{
    "body": "Branch: **[public/configure/iconv-config](https://github.com/sagemath/sagetrac-mirror/tree/public/configure/iconv-config)**",
    "created_at": "2019-06-10T19:00:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431615",
    "user": "https://github.com/dimpase"
}
```

Branch: **[public/configure/iconv-config](https://github.com/sagemath/sagetrac-mirror/tree/public/configure/iconv-config)**



---

archive/issue_comments_431616.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nusing AM_ICONV (a bit of a hack).\nNeeds config.rpath from gettext. (I also saw packages just creating an empty config.rpath, so perhaps we can do this too).\n\nDoes this work on Cygwin?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0afc4dc503267f9af5c91b0e8d91456f5fef5342\"><code>0afc4dc</code></a></td><td><code>use AM_ICONV from gettext</code></td></tr></table>\n",
    "created_at": "2019-06-10T19:00:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431616",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">comment:3</div>

using AM_ICONV (a bit of a hack).
Needs config.rpath from gettext. (I also saw packages just creating an empty config.rpath, so perhaps we can do this too).

Does this work on Cygwin?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0afc4dc503267f9af5c91b0e8d91456f5fef5342"><code>0afc4dc</code></a></td><td><code>use AM_ICONV from gettext</code></td></tr></table>




---

archive/issue_comments_431617.json:
```json
{
    "body": "Author: **Dima Pasechnik**",
    "created_at": "2019-06-10T19:00:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431617",
    "user": "https://github.com/dimpase"
}
```

Author: **Dima Pasechnik**



---

archive/issue_comments_431618.json:
```json
{
    "body": "Commit: **[`0afc4dc`](https://github.com/sagemath/sagetrac-mirror/commit/0afc4dc503267f9af5c91b0e8d91456f5fef5342)**",
    "created_at": "2019-06-10T19:00:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431618",
    "user": "https://github.com/dimpase"
}
```

Commit: **[`0afc4dc`](https://github.com/sagemath/sagetrac-mirror/commit/0afc4dc503267f9af5c91b0e8d91456f5fef5342)**



---

archive/issue_events_378672.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-10T19:00:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378672"
}
```



---

archive/issue_comments_431619.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\non OSX this also needs lib-link.m4...",
    "created_at": "2019-06-11T11:42:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431619",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">comment:5</div>

on OSX this also needs lib-link.m4...



---

archive/issue_events_378673.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-11T11:42:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378673"
}
```



---

archive/issue_events_378674.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-11T11:42:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378674"
}
```



---

archive/issue_comments_431620.json:
```json
{
    "body": "Changed commit from **[`0afc4dc`](https://github.com/sagemath/sagetrac-mirror/commit/0afc4dc503267f9af5c91b0e8d91456f5fef5342)** to **[`4ea2241`](https://github.com/sagemath/sagetrac-mirror/commit/4ea22415c12958c5bb367b1693fdaa88c9aaa30b)**",
    "created_at": "2019-06-11T11:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431620",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0afc4dc`](https://github.com/sagemath/sagetrac-mirror/commit/0afc4dc503267f9af5c91b0e8d91456f5fef5342)** to **[`4ea2241`](https://github.com/sagemath/sagetrac-mirror/commit/4ea22415c12958c5bb367b1693fdaa88c9aaa30b)**



---

archive/issue_comments_431621.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4ea22415c12958c5bb367b1693fdaa88c9aaa30b\"><code>4ea2241</code></a></td><td><code>moar autocon stuff added</code></td></tr></table>\n",
    "created_at": "2019-06-11T11:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431621",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4ea22415c12958c5bb367b1693fdaa88c9aaa30b"><code>4ea2241</code></a></td><td><code>moar autocon stuff added</code></td></tr></table>




---

archive/issue_comments_431622.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ff3d5ed15263c25e18fab585a2e7740d78f5f393\"><code>ff3d5ed</code></a></td><td><code>moar autocon stuff added</code></td></tr></table>\n",
    "created_at": "2019-06-11T11:50:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431622",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ff3d5ed15263c25e18fab585a2e7740d78f5f393"><code>ff3d5ed</code></a></td><td><code>moar autocon stuff added</code></td></tr></table>




---

archive/issue_comments_431623.json:
```json
{
    "body": "Changed commit from **[`4ea2241`](https://github.com/sagemath/sagetrac-mirror/commit/4ea22415c12958c5bb367b1693fdaa88c9aaa30b)** to **[`ff3d5ed`](https://github.com/sagemath/sagetrac-mirror/commit/ff3d5ed15263c25e18fab585a2e7740d78f5f393)**",
    "created_at": "2019-06-11T11:50:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431623",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4ea2241`](https://github.com/sagemath/sagetrac-mirror/commit/4ea22415c12958c5bb367b1693fdaa88c9aaa30b)** to **[`ff3d5ed`](https://github.com/sagemath/sagetrac-mirror/commit/ff3d5ed15263c25e18fab585a2e7740d78f5f393)**



---

archive/issue_comments_431624.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29ca93192dde1c7cf4e1a138c7ee81d91ca89e66\"><code>29ca931</code></a></td><td><code>moar autocon stuff added</code></td></tr></table>\n",
    "created_at": "2019-06-11T11:54:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431624",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29ca93192dde1c7cf4e1a138c7ee81d91ca89e66"><code>29ca931</code></a></td><td><code>moar autocon stuff added</code></td></tr></table>




---

archive/issue_comments_431625.json:
```json
{
    "body": "Changed commit from **[`ff3d5ed`](https://github.com/sagemath/sagetrac-mirror/commit/ff3d5ed15263c25e18fab585a2e7740d78f5f393)** to **[`29ca931`](https://github.com/sagemath/sagetrac-mirror/commit/29ca93192dde1c7cf4e1a138c7ee81d91ca89e66)**",
    "created_at": "2019-06-11T11:54:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431625",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ff3d5ed`](https://github.com/sagemath/sagetrac-mirror/commit/ff3d5ed15263c25e18fab585a2e7740d78f5f393)** to **[`29ca931`](https://github.com/sagemath/sagetrac-mirror/commit/29ca93192dde1c7cf4e1a138c7ee81d91ca89e66)**



---

archive/issue_comments_431626.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nOK, this much is needed for OSX...",
    "created_at": "2019-06-11T12:16:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431626",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">comment:9</div>

OK, this much is needed for OSX...



---

archive/issue_events_378675.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-11T12:16:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378675"
}
```



---

archive/issue_events_378676.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-11T12:16:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378676"
}
```



---

archive/issue_comments_431627.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nFor the `config.rpath` stuff, it seems that file is included with gettext, typically under `/usr/share/gettext/config.rpath`.  Normally it is installed by `gettextize`, but I don't think we actually want to run that, since we really just want the file; we don't want to prepare the program for direct use of gettext.\n\nI wonder if there's a reasonably reliable way to just get the path to this file...",
    "created_at": "2019-06-11T12:52:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431627",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">comment:10</div>

For the `config.rpath` stuff, it seems that file is included with gettext, typically under `/usr/share/gettext/config.rpath`.  Normally it is installed by `gettextize`, but I don't think we actually want to run that, since we really just want the file; we don't want to prepare the program for direct use of gettext.

I wonder if there's a reasonably reliable way to just get the path to this file...



---

archive/issue_comments_431628.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nthe problem is that AM_ICONV pulls in a lot of macros from gettext, so config.rpath is just one of many things needed, as I found out on a gettext-less OSX box...",
    "created_at": "2019-06-11T12:55:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431628",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11" align="right">comment:11</div>

the problem is that AM_ICONV pulls in a lot of macros from gettext, so config.rpath is just one of many things needed, as I found out on a gettext-less OSX box...



---

archive/issue_comments_431629.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nIt turns out `gettextize` is just a shell script, and the path to `/usr/share/gettext` is just in some variables in that file that are output when gettext is configured.",
    "created_at": "2019-06-11T12:56:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431629",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

It turns out `gettextize` is just a shell script, and the path to `/usr/share/gettext` is just in some variables in that file that are output when gettext is configured.



---

archive/issue_comments_431630.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\n> the problem is that AM_ICONV pulls in a lot of macros from gettext\n\nAre you saying you're trying to get it so you can run configure without the macros from gettext?  The thing about `config.rpath` is that it's not a macro; it's just a file that needs to be copied into place.  automake and the like don't do this automatically for the most part.",
    "created_at": "2019-06-11T12:58:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431630",
    "user": "https://github.com/embray"
}
```

<div id="comment:13" align="right">comment:13</div>

> the problem is that AM_ICONV pulls in a lot of macros from gettext

Are you saying you're trying to get it so you can run configure without the macros from gettext?  The thing about `config.rpath` is that it's not a macro; it's just a file that needs to be copied into place.  automake and the like don't do this automatically for the most part.



---

archive/issue_comments_431631.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@embray](#comment:13):\n> > the problem is that AM_ICONV pulls in a lot of macros from gettext\n\n> \n> Are you saying you're trying to get it so you can run configure without the macros from gettext?  The thing about `config.rpath` is that it's not a macro; it's just a file that needs to be copied into place.  automake and the like don't do this automatically for the most part.\n\nthat's correct, all of this is just to use AM_ICONV.\nOn OSX iconv is provided by the system, no need for gettext (or iconv) implementation; however AM_ICONV is a part of gettext package, and has several deps there, that need to be installed (and some of these deps need `config.rpath` script installed into the right place).",
    "created_at": "2019-06-11T13:04:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431631",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@embray](#comment:13):
> > the problem is that AM_ICONV pulls in a lot of macros from gettext

> 
> Are you saying you're trying to get it so you can run configure without the macros from gettext?  The thing about `config.rpath` is that it's not a macro; it's just a file that needs to be copied into place.  automake and the like don't do this automatically for the most part.

that's correct, all of this is just to use AM_ICONV.
On OSX iconv is provided by the system, no need for gettext (or iconv) implementation; however AM_ICONV is a part of gettext package, and has several deps there, that need to be installed (and some of these deps need `config.rpath` script installed into the right place).



---

archive/issue_comments_431632.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nApparently it's actually a macro called `AC_LIB_RPATH` that requires the `config.rpath` file, and it happens to be used indirectly by AM_ICONV.  Most of the google results for `AC_LIB_RPATH` relate to this problem.",
    "created_at": "2019-06-11T13:10:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431632",
    "user": "https://github.com/embray"
}
```

<div id="comment:15" align="right">comment:15</div>

Apparently it's actually a macro called `AC_LIB_RPATH` that requires the `config.rpath` file, and it happens to be used indirectly by AM_ICONV.  Most of the google results for `AC_LIB_RPATH` relate to this problem.



---

archive/issue_comments_431633.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nHa! Where is my medal?!\nCf. Paul Eggert saying that only brave people use AM_ICONV directly: https://lists.gnu.org/archive/html/autoconf/2002-09/msg00181.html",
    "created_at": "2019-06-11T13:20:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431633",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:16" align="right">comment:16</div>

Ha! Where is my medal?!
Cf. Paul Eggert saying that only brave people use AM_ICONV directly: https://lists.gnu.org/archive/html/autoconf/2002-09/msg00181.html



---

archive/issue_comments_431634.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI think this mostly just comes down to a misconfiguration on many distributions.\n\nautomake has a \"libdir\" that it searches for these generated files that it copies into your project.  For example on my system my automake libdir is `/usr/share/automake-1.14` in which I have I have:\n\n```\n$ ls -l /usr/share/automake-1.14\ntotal 512\ndrwxr-xr-x 2 root root   4096 May 26  2016 am\n-rwxr-xr-x 1 root root   5826 Jan  2  2014 ar-lib\ndrwxr-xr-x 2 root root   4096 May 26  2016 Automake\n-rwxr-xr-x 1 root root   7333 Jan  2  2014 compile\nlrwxrwxrwx 1 root root     20 Jan  2  2014 config.guess -> ../misc/config.guess\nlrwxrwxrwx 1 root root     18 Jan  2  2014 config.sub -> ../misc/config.sub\n-rw-r--r-- 1 root root  35147 Jan  2  2014 COPYING\n-rwxr-xr-x 1 root root  23566 Jan  2  2014 depcomp\n-rw-r--r-- 1 root root  15752 Jan  2  2014 INSTALL\n-rwxr-xr-x 1 root root  13997 Jan  2  2014 install-sh\n-rwxr-xr-x 1 root root   6047 Jan  2  2014 mdate-sh\n-rwxr-xr-x 1 root root   6872 Jan  2  2014 missing\n-rwxr-xr-x 1 root root   3538 Jan  2  2014 mkinstalldirs\n-rwxr-xr-x 1 root root   4670 Jan  2  2014 py-compile\n-rwxr-xr-x 1 root root  15285 Jan  2  2014 tap-driver.pl\n-rwxr-xr-x 1 root root  19464 Jan  2  2014 tap-driver.sh\n-rwxr-xr-x 1 root root   4287 Jan  2  2014 test-driver\n-rw-r--r-- 1 root root 323102 Jan  2  2014 texinfo.tex\n-rwxr-xr-x 1 root root   6858 Jan  2  2014 ylwrap\n```\n\nAs you can see, the commonly used `config.guess` and `config.sub` are actually symlinks to `/usr/misc`.  It turns out on my system these files are not even provided by automake, but rather a package called `autotools-dev`.\n\nFor this to work properly the distro ought to be creating a symlink `/usr/share/automake-1.14/config.rpath -> ../gettext/config.rpath`.\n\nBut they don't, so it doesn't get installed properly.",
    "created_at": "2019-06-11T13:30:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431634",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">comment:17</div>

I think this mostly just comes down to a misconfiguration on many distributions.

automake has a "libdir" that it searches for these generated files that it copies into your project.  For example on my system my automake libdir is `/usr/share/automake-1.14` in which I have I have:

```
$ ls -l /usr/share/automake-1.14
total 512
drwxr-xr-x 2 root root   4096 May 26  2016 am
-rwxr-xr-x 1 root root   5826 Jan  2  2014 ar-lib
drwxr-xr-x 2 root root   4096 May 26  2016 Automake
-rwxr-xr-x 1 root root   7333 Jan  2  2014 compile
lrwxrwxrwx 1 root root     20 Jan  2  2014 config.guess -> ../misc/config.guess
lrwxrwxrwx 1 root root     18 Jan  2  2014 config.sub -> ../misc/config.sub
-rw-r--r-- 1 root root  35147 Jan  2  2014 COPYING
-rwxr-xr-x 1 root root  23566 Jan  2  2014 depcomp
-rw-r--r-- 1 root root  15752 Jan  2  2014 INSTALL
-rwxr-xr-x 1 root root  13997 Jan  2  2014 install-sh
-rwxr-xr-x 1 root root   6047 Jan  2  2014 mdate-sh
-rwxr-xr-x 1 root root   6872 Jan  2  2014 missing
-rwxr-xr-x 1 root root   3538 Jan  2  2014 mkinstalldirs
-rwxr-xr-x 1 root root   4670 Jan  2  2014 py-compile
-rwxr-xr-x 1 root root  15285 Jan  2  2014 tap-driver.pl
-rwxr-xr-x 1 root root  19464 Jan  2  2014 tap-driver.sh
-rwxr-xr-x 1 root root   4287 Jan  2  2014 test-driver
-rw-r--r-- 1 root root 323102 Jan  2  2014 texinfo.tex
-rwxr-xr-x 1 root root   6858 Jan  2  2014 ylwrap
```

As you can see, the commonly used `config.guess` and `config.sub` are actually symlinks to `/usr/misc`.  It turns out on my system these files are not even provided by automake, but rather a package called `autotools-dev`.

For this to work properly the distro ought to be creating a symlink `/usr/share/automake-1.14/config.rpath -> ../gettext/config.rpath`.

But they don't, so it doesn't get installed properly.



---

archive/issue_comments_431635.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nHere's a snippet of code I wrote to do what automake *should* be doing, but in our `bootstrap` script.  Seems to work nicely but have not tried in the MacOS hinterlands...\n\n```diff\ndiff --git a/bootstrap b/bootstrap\nindex 2505897..eca22b8 100755\n--- a/bootstrap\n+++ b/bootstrap\n@@ -28,6 +28,41 @@ MAKE=\"${MAKE:-make}\"\n CONFVERSION=`cat $PKG/package-version.txt`\n\n\n+install_config_rpath() {\n+    # The file config.rpath which comes from gettext is supposed to be\n+    # installed by automake, but due to a bug in most distros it is not;\n+    # see ticket:27823#comment:17\n+    #\n+    # Here we need to determine where gettext stores its data files and\n+    # copy config.rpath from there to config/\n+    gettextize=\"$(command -v gettextize)\"\n+    if [ -z \"$gettextize\" ]; then\n+        echo >&2 \"gettext and the gettextize program must be installed.\"\n+        exit 1\n+    fi\n+    eval `sed -n '/^prefix=\\(.*\\)$/p' $gettextize`\n+    eval `sed -n '/^datarootdir=\\(.*\\)$/p' $gettextize`\n+    eval `sed -n '/^gettext_dir=\\(.*\\)$/p' $gettextize`\n+\n+    if [ -z \"$gettext_dir\" ]; then\n+        echo >&2 \"Failed to read the gettext_dir directory from $gettextize\"\n+        echo >&2 \"The config.rpath file must manually be copied into config/\"\n+        echo >&2 \"This file is installed with gettext typically in /usr/share/gettext\"\n+        exit 1\n+    fi\n+\n+    config_rpath=\"$gettext_dir/config.rpath\"\n+    if [ ! -f \"$config_rpath\" ]; then\n+        echo >&2 \"Missing $config_rpath file; this indicates a broken gettext install.\"\n+        exit 1\n+    fi\n+\n+    echo \"bootstrap:$LINENO: installing 'config/config.rpath'\"\n+    cp \"$config_rpath\" config/\n+}\n+\n+\n+\n bootstrap () {\n     rm -f m4/sage_spkg_configures.m4\n     spkg_configures=\"\"\n@@ -40,6 +75,7 @@ SAGE_SPKG_CONFIGURE_$(echo ${pkgname} | tr '[a-z]' '[A-Z]')\"\n     echo \"$spkg_configures\" >> m4/sage_spkg_configures.m4\n\n     aclocal -I m4 && \\\n+    install_config_rpath && \\\n     automake --add-missing --copy build/make/Makefile-auto && \\\n     autoconf\n```",
    "created_at": "2019-06-11T13:52:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431635",
    "user": "https://github.com/embray"
}
```

<div id="comment:18" align="right">comment:18</div>

Here's a snippet of code I wrote to do what automake *should* be doing, but in our `bootstrap` script.  Seems to work nicely but have not tried in the MacOS hinterlands...

```diff
diff --git a/bootstrap b/bootstrap
index 2505897..eca22b8 100755
--- a/bootstrap
+++ b/bootstrap
@@ -28,6 +28,41 @@ MAKE="${MAKE:-make}"
 CONFVERSION=`cat $PKG/package-version.txt`


+install_config_rpath() {
+    # The file config.rpath which comes from gettext is supposed to be
+    # installed by automake, but due to a bug in most distros it is not;
+    # see ticket:27823#comment:17
+    #
+    # Here we need to determine where gettext stores its data files and
+    # copy config.rpath from there to config/
+    gettextize="$(command -v gettextize)"
+    if [ -z "$gettextize" ]; then
+        echo >&2 "gettext and the gettextize program must be installed."
+        exit 1
+    fi
+    eval `sed -n '/^prefix=\(.*\)$/p' $gettextize`
+    eval `sed -n '/^datarootdir=\(.*\)$/p' $gettextize`
+    eval `sed -n '/^gettext_dir=\(.*\)$/p' $gettextize`
+
+    if [ -z "$gettext_dir" ]; then
+        echo >&2 "Failed to read the gettext_dir directory from $gettextize"
+        echo >&2 "The config.rpath file must manually be copied into config/"
+        echo >&2 "This file is installed with gettext typically in /usr/share/gettext"
+        exit 1
+    fi
+
+    config_rpath="$gettext_dir/config.rpath"
+    if [ ! -f "$config_rpath" ]; then
+        echo >&2 "Missing $config_rpath file; this indicates a broken gettext install."
+        exit 1
+    fi
+
+    echo "bootstrap:$LINENO: installing 'config/config.rpath'"
+    cp "$config_rpath" config/
+}
+
+
+
 bootstrap () {
     rm -f m4/sage_spkg_configures.m4
     spkg_configures=""
@@ -40,6 +75,7 @@ SAGE_SPKG_CONFIGURE_$(echo ${pkgname} | tr '[a-z]' '[A-Z]')"
     echo "$spkg_configures" >> m4/sage_spkg_configures.m4

     aclocal -I m4 && \
+    install_config_rpath && \
     automake --add-missing --copy build/make/Makefile-auto && \
     autoconf
```



---

archive/issue_comments_431636.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\non my gentoo box I have `/usr/share/gettext/config.rpath`, yet it does not get picked up, i.e. if I remove the copying of `config.rpath` from bootstrap I get\n\n```\n$ ./bootstrap \nrm -rf config configure build/make/Makefile-auto.in\nconfigure.ac:320: installing 'config/compile'\nconfigure.ac:105: installing 'config/config.guess'\nm4/sage_spkg_configures.m4:35: error: required file 'config/config.rpath' not found\nconfigure.ac:105: installing 'config/config.sub'\nconfigure.ac:68: installing 'config/install-sh'\nconfigure.ac:68: installing 'config/missing'\n```\nApparently it has to installed:\n\n```\n$ grep -R \"config.rpath\" /usr/share/aclocal\n/usr/share/aclocal/guile.m4:  dnl the file gnulib/build-aux/config.rpath.\n/usr/share/aclocal/lib-link.m4:  dnl Complain if config.rpath is missing.\n\n/usr/share/aclocal/lib-link.m4:  AC_REQUIRE_AUX_FILE([config.rpath])\n/usr/share/aclocal/lib-link.m4:    ${CONFIG_SHELL-/bin/sh} \"$ac_aux_dir/config.rpath\" \"$host\" > conftest.sh\n```\n\nNaturally, on a box with gettext and autoconf installed none of these *.m4 files in this branch are needed, but `config.path` still is needed.",
    "created_at": "2019-06-11T14:00:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431636",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">comment:19</div>

on my gentoo box I have `/usr/share/gettext/config.rpath`, yet it does not get picked up, i.e. if I remove the copying of `config.rpath` from bootstrap I get

```
$ ./bootstrap 
rm -rf config configure build/make/Makefile-auto.in
configure.ac:320: installing 'config/compile'
configure.ac:105: installing 'config/config.guess'
m4/sage_spkg_configures.m4:35: error: required file 'config/config.rpath' not found
configure.ac:105: installing 'config/config.sub'
configure.ac:68: installing 'config/install-sh'
configure.ac:68: installing 'config/missing'
```
Apparently it has to installed:

```
$ grep -R "config.rpath" /usr/share/aclocal
/usr/share/aclocal/guile.m4:  dnl the file gnulib/build-aux/config.rpath.
/usr/share/aclocal/lib-link.m4:  dnl Complain if config.rpath is missing.

/usr/share/aclocal/lib-link.m4:  AC_REQUIRE_AUX_FILE([config.rpath])
/usr/share/aclocal/lib-link.m4:    ${CONFIG_SHELL-/bin/sh} "$ac_aux_dir/config.rpath" "$host" > conftest.sh
```

Naturally, on a box with gettext and autoconf installed none of these *.m4 files in this branch are needed, but `config.path` still is needed.



---

archive/issue_comments_431637.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nTry my patch above.  The problem is that automake simply doesn't install the file if it's only found in `/usr/share/gettext`.",
    "created_at": "2019-06-11T14:21:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431637",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

Try my patch above.  The problem is that automake simply doesn't install the file if it's only found in `/usr/share/gettext`.



---

archive/issue_comments_431638.json:
```json
{
    "body": "Changed commit from **[`29ca931`](https://github.com/sagemath/sagetrac-mirror/commit/29ca93192dde1c7cf4e1a138c7ee81d91ca89e66)** to **[`be482fd`](https://github.com/sagemath/sagetrac-mirror/commit/be482fdd63928f5442bdf97e809b781512e2d0d0)**",
    "created_at": "2019-06-11T15:34:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431638",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`29ca931`](https://github.com/sagemath/sagetrac-mirror/commit/29ca93192dde1c7cf4e1a138c7ee81d91ca89e66)** to **[`be482fd`](https://github.com/sagemath/sagetrac-mirror/commit/be482fdd63928f5442bdf97e809b781512e2d0d0)**



---

archive/issue_comments_431639.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be482fdd63928f5442bdf97e809b781512e2d0d0\"><code>be482fd</code></a></td><td><code>use AM_ICONV, copy config.rpath from gettext's datadir</code></td></tr></table>\n",
    "created_at": "2019-06-11T15:34:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431639",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be482fdd63928f5442bdf97e809b781512e2d0d0"><code>be482fd</code></a></td><td><code>use AM_ICONV, copy config.rpath from gettext's datadir</code></td></tr></table>




---

archive/issue_comments_431640.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nOK, this works with gettext 0.19 and 0.20 (also on OSX, with some extra effort). I had to change `/^gettext_dir` to `/gettext_datadir` and replace `gettext_dir` with `gettext_datadir` in the rest.\n\nAnyhow, this also needs to be tested on a \"clean\" OSX, without autotoots, with pre-generated configure, too.",
    "created_at": "2019-06-11T16:03:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431640",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">comment:22</div>

OK, this works with gettext 0.19 and 0.20 (also on OSX, with some extra effort). I had to change `/^gettext_dir` to `/gettext_datadir` and replace `gettext_dir` with `gettext_datadir` in the rest.

Anyhow, this also needs to be tested on a "clean" OSX, without autotoots, with pre-generated configure, too.



---

archive/issue_comments_431641.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nExcept this won't work on my gettext where it's spelled \"gettext_dir\".",
    "created_at": "2019-06-12T08:34:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431641",
    "user": "https://github.com/embray"
}
```

<div id="comment:23" align="right">comment:23</div>

Except this won't work on my gettext where it's spelled "gettext_dir".



---

archive/issue_comments_431642.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI guess mine must be quite old: https://github.com/autotools-mirror/gettext/commit/ff18897068486560e2bb421004cfbd42b7cdd0f8\n\nThis will still need to be reworked a bit.  It's maddening that the tool doesn't just have like a `--print-gettext-dir` option.",
    "created_at": "2019-06-12T08:39:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431642",
    "user": "https://github.com/embray"
}
```

<div id="comment:24" align="right">comment:24</div>

I guess mine must be quite old: https://github.com/autotools-mirror/gettext/commit/ff18897068486560e2bb421004cfbd42b7cdd0f8

This will still need to be reworked a bit.  It's maddening that the tool doesn't just have like a `--print-gettext-dir` option.



---

archive/issue_comments_431643.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nThis works in both versions:\n\n```\neval `sed -n '/^prefix=.*$/p' $gettextize`\neval `sed -n '/^datarootdir=.*$/p' $gettextize`\neval `sed -n '/^gettext_dir=.*$/p' $gettextize`\nif [ -z \"$gettext_dir\" ]; then\n    # In newer versions this is spelled gettext_datadir\n    eval `sed -n '/^: \\${gettext_datadir=.*$/p' $gettextize`\n    gettext_dir=\"$gettext_datadir\"\nfi\n```\n\nAlso simplified a bit from my old version where I left in some groupings in the sed regexp that were not actually used.",
    "created_at": "2019-06-12T08:48:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431643",
    "user": "https://github.com/embray"
}
```

<div id="comment:25" align="right">comment:25</div>

This works in both versions:

```
eval `sed -n '/^prefix=.*$/p' $gettextize`
eval `sed -n '/^datarootdir=.*$/p' $gettextize`
eval `sed -n '/^gettext_dir=.*$/p' $gettextize`
if [ -z "$gettext_dir" ]; then
    # In newer versions this is spelled gettext_datadir
    eval `sed -n '/^: \${gettext_datadir=.*$/p' $gettextize`
    gettext_dir="$gettext_datadir"
fi
```

Also simplified a bit from my old version where I left in some groupings in the sed regexp that were not actually used.



---

archive/issue_comments_431644.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@embray](#comment:24):\n> I guess mine must be quite old: https://github.com/autotools-mirror/gettext/commit/ff18897068486560e2bb421004cfbd42b7cdd0f8\n> \n> This will still need to be reworked a bit.  It's maddening that the tool doesn't just have like a `--print-gettext-dir` option.\n\nWell, one can try to ask for it, but then it would need to get approved by Ulrich Drepper, it seems...",
    "created_at": "2019-06-12T08:54:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431644",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@embray](#comment:24):
> I guess mine must be quite old: https://github.com/autotools-mirror/gettext/commit/ff18897068486560e2bb421004cfbd42b7cdd0f8
> 
> This will still need to be reworked a bit.  It's maddening that the tool doesn't just have like a `--print-gettext-dir` option.

Well, one can try to ask for it, but then it would need to get approved by Ulrich Drepper, it seems...



---

archive/issue_comments_431645.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@embray](#comment:25):\n> This works in both versions:\n> \n> ```\n> eval `sed -n '/^prefix=.*$/p' $gettextize`\n> eval `sed -n '/^datarootdir=.*$/p' $gettextize`\n> eval `sed -n '/^gettext_dir=.*$/p' $gettextize`\n> if [ -z \"$gettext_dir\" ]; then\n>     # In newer versions this is spelled gettext_datadir\n>     eval `sed -n '/^: \\${gettext_datadir=.*$/p' $gettextize`\n>     gettext_dir=\"$gettext_datadir\"\n> fi\n> ```\n> \n> Also simplified a bit from my old version where I left in some groupings in the sed regexp that were not actually used.\n\nwell, this is out of sync with the ticket branch - but feel free to do your own version!",
    "created_at": "2019-06-12T09:06:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431645",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@embray](#comment:25):
> This works in both versions:
> 
> ```
> eval `sed -n '/^prefix=.*$/p' $gettextize`
> eval `sed -n '/^datarootdir=.*$/p' $gettextize`
> eval `sed -n '/^gettext_dir=.*$/p' $gettextize`
> if [ -z "$gettext_dir" ]; then
>     # In newer versions this is spelled gettext_datadir
>     eval `sed -n '/^: \${gettext_datadir=.*$/p' $gettextize`
>     gettext_dir="$gettext_datadir"
> fi
> ```
> 
> Also simplified a bit from my old version where I left in some groupings in the sed regexp that were not actually used.

well, this is out of sync with the ticket branch - but feel free to do your own version!



---

archive/issue_comments_431646.json:
```json
{
    "body": "Changed commit from **[`be482fd`](https://github.com/sagemath/sagetrac-mirror/commit/be482fdd63928f5442bdf97e809b781512e2d0d0)** to **[`0bb824e`](https://github.com/sagemath/sagetrac-mirror/commit/0bb824e16e1e84345b536521a875c315530b1d11)**",
    "created_at": "2019-06-13T08:34:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431646",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`be482fd`](https://github.com/sagemath/sagetrac-mirror/commit/be482fdd63928f5442bdf97e809b781512e2d0d0)** to **[`0bb824e`](https://github.com/sagemath/sagetrac-mirror/commit/0bb824e16e1e84345b536521a875c315530b1d11)**



---

archive/issue_comments_431647.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0bb824e16e1e84345b536521a875c315530b1d11\"><code>0bb824e</code></a></td><td><code>Support versions of gettext older than 2014-04-21</code></td></tr></table>\n",
    "created_at": "2019-06-13T08:34:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431647",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0bb824e16e1e84345b536521a875c315530b1d11"><code>0bb824e</code></a></td><td><code>Support versions of gettext older than 2014-04-21</code></td></tr></table>




---

archive/issue_comments_431648.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@dimpase](#comment:27):\n> well, this is out of sync with the ticket branch - but feel free to do your own version!\n\nI went ahead and updated the branch.  Perhaps it's a little unnecessary to support much older versions, but it at least came up on one machine which I'd like to keep working for now.",
    "created_at": "2019-06-13T08:41:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431648",
    "user": "https://github.com/embray"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@dimpase](#comment:27):
> well, this is out of sync with the ticket branch - but feel free to do your own version!

I went ahead and updated the branch.  Perhaps it's a little unnecessary to support much older versions, but it at least came up on one machine which I'd like to keep working for now.



---

archive/issue_comments_431649.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nIt's fine, sure - but did you test this branch on old gettext? It seems to me that you need `else` clause to `if [ -z \"$gettext_dir\" ]; then` doing\n\n```\n   gettext_datadir=\"$gettext_dir\"\n```",
    "created_at": "2019-06-13T09:21:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431649",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:30" align="right">comment:30</div>

It's fine, sure - but did you test this branch on old gettext? It seems to me that you need `else` clause to `if [ -z "$gettext_dir" ]; then` doing

```
   gettext_datadir="$gettext_dir"
```



---

archive/issue_comments_431650.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nOh yeah, you're right.  This is a little messed up now.",
    "created_at": "2019-06-13T10:32:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431650",
    "user": "https://github.com/embray"
}
```

<div id="comment:31" align="right">comment:31</div>

Oh yeah, you're right.  This is a little messed up now.



---

archive/issue_comments_431651.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57efc6f4f5647bed26819d6d9b66021b9fd3ecef\"><code>57efc6f</code></a></td><td><code>Reworked to prefer gettext_datadir (for newer gettexts) and fall back to gettext_dir only for older versions.</code></td></tr></table>\n",
    "created_at": "2019-06-13T10:45:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431651",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57efc6f4f5647bed26819d6d9b66021b9fd3ecef"><code>57efc6f</code></a></td><td><code>Reworked to prefer gettext_datadir (for newer gettexts) and fall back to gettext_dir only for older versions.</code></td></tr></table>




---

archive/issue_comments_431652.json:
```json
{
    "body": "Changed commit from **[`0bb824e`](https://github.com/sagemath/sagetrac-mirror/commit/0bb824e16e1e84345b536521a875c315530b1d11)** to **[`57efc6f`](https://github.com/sagemath/sagetrac-mirror/commit/57efc6f4f5647bed26819d6d9b66021b9fd3ecef)**",
    "created_at": "2019-06-13T10:45:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431652",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0bb824e`](https://github.com/sagemath/sagetrac-mirror/commit/0bb824e16e1e84345b536521a875c315530b1d11)** to **[`57efc6f`](https://github.com/sagemath/sagetrac-mirror/commit/57efc6f4f5647bed26819d6d9b66021b9fd3ecef)**



---

archive/issue_comments_431653.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nI think this is good now.  Tested on both versions.\n\nAlso tested this on Cygwin and confirmed (as expected) that it works well using the system iconv (thank you!)",
    "created_at": "2019-06-13T10:48:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431653",
    "user": "https://github.com/embray"
}
```

<div id="comment:33" align="right">comment:33</div>

I think this is good now.  Tested on both versions.

Also tested this on Cygwin and confirmed (as expected) that it works well using the system iconv (thank you!)



---

archive/issue_events_378677.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-13T11:53:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378677"
}
```



---

archive/issue_events_378678.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-13T11:53:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378678"
}
```



---

archive/issue_comments_431654.json:
```json
{
    "body": "Changed author from **Dima Pasechnik** to **Dima Pasechnik, Erik Bray**",
    "created_at": "2019-06-13T11:53:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431654",
    "user": "https://github.com/dimpase"
}
```

Changed author from **Dima Pasechnik** to **Dima Pasechnik, Erik Bray**



---

archive/issue_comments_431655.json:
```json
{
    "body": "Reviewer: **Erik Bray, Dima Pasechnik**",
    "created_at": "2019-06-13T11:53:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431655",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Erik Bray, Dima Pasechnik**



---

archive/issue_comments_431656.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nIs gettext guaranteed to be installed for some reason? If not, maybe we can punt and add it to the list at\n\nhttp://doc.sagemath.org/html/en/installation/source.html#command-line-tools",
    "created_at": "2019-06-13T14:40:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431656",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:35" align="right">comment:35</div>

Is gettext guaranteed to be installed for some reason? If not, maybe we can punt and add it to the list at

http://doc.sagemath.org/html/en/installation/source.html#command-line-tools



---

archive/issue_comments_431657.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\ngettext, just like autotools, is needed to run ./bootstrap; none of this is documented, though. We should, though...",
    "created_at": "2019-06-13T15:13:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431657",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:36" align="right">comment:36</div>

gettext, just like autotools, is needed to run ./bootstrap; none of this is documented, though. We should, though...



---

archive/issue_events_378679.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-26T21:30:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378679"
}
```



---

archive/issue_events_378680.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-26T21:30:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378680"
}
```



---

archive/issue_comments_431658.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\ninstall_config_rpath calls exit(1) in some code paths, but its supposed to fall back to downloading the confball...",
    "created_at": "2019-06-26T21:30:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431658",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:37" align="right">comment:37</div>

install_config_rpath calls exit(1) in some code paths, but its supposed to fall back to downloading the confball...



---

archive/issue_comments_431659.json:
```json
{
    "body": "Changed commit from **[`57efc6f`](https://github.com/sagemath/sagetrac-mirror/commit/57efc6f4f5647bed26819d6d9b66021b9fd3ecef)** to **[`1604b82`](https://github.com/sagemath/sagetrac-mirror/commit/1604b82c2b609765f56923f893679d002b7ba5d3)**",
    "created_at": "2019-06-27T10:03:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431659",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`57efc6f`](https://github.com/sagemath/sagetrac-mirror/commit/57efc6f4f5647bed26819d6d9b66021b9fd3ecef)** to **[`1604b82`](https://github.com/sagemath/sagetrac-mirror/commit/1604b82c2b609765f56923f893679d002b7ba5d3)**



---

archive/issue_comments_431660.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fdad7d900bcdeb01cfd60f2e2868e25b2970eec9\"><code>fdad7d9</code></a></td><td><code>use AM_ICONV, copy config.rpath from gettext's datadir</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f8d72d781f56b4e8be3a73740b689ea320337e8\"><code>7f8d72d</code></a></td><td><code>Support versions of gettext older than 2014-04-21</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf2479dbe19dac0eea0185096ba59d802b88ff46\"><code>bf2479d</code></a></td><td><code>Reworked to prefer gettext_datadir (for newer gettexts) and fall back to gettext_dir only for older versions.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1604b82c2b609765f56923f893679d002b7ba5d3\"><code>1604b82</code></a></td><td><code>return in install_rpath_config; analyse its result</code></td></tr></table>\n",
    "created_at": "2019-06-27T10:03:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431660",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fdad7d900bcdeb01cfd60f2e2868e25b2970eec9"><code>fdad7d9</code></a></td><td><code>use AM_ICONV, copy config.rpath from gettext's datadir</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f8d72d781f56b4e8be3a73740b689ea320337e8"><code>7f8d72d</code></a></td><td><code>Support versions of gettext older than 2014-04-21</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf2479dbe19dac0eea0185096ba59d802b88ff46"><code>bf2479d</code></a></td><td><code>Reworked to prefer gettext_datadir (for newer gettexts) and fall back to gettext_dir only for older versions.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1604b82c2b609765f56923f893679d002b7ba5d3"><code>1604b82</code></a></td><td><code>return in install_rpath_config; analyse its result</code></td></tr></table>




---

archive/issue_comments_431661.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nrebased, added returns, removed exits",
    "created_at": "2019-06-27T10:04:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431661",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:39" align="right">comment:39</div>

rebased, added returns, removed exits



---

archive/issue_events_378681.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-27T10:04:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378681"
}
```



---

archive/issue_events_378682.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-27T10:04:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378682"
}
```



---

archive/issue_comments_431662.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f79ccf95f3f4b8a626c85f78f1433efb46813c6b\"><code>f79ccf9</code></a></td><td><code>do not run aclocal before we tried gettex, and correct return code</code></td></tr></table>\n",
    "created_at": "2019-06-27T14:00:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431662",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f79ccf95f3f4b8a626c85f78f1433efb46813c6b"><code>f79ccf9</code></a></td><td><code>do not run aclocal before we tried gettex, and correct return code</code></td></tr></table>




---

archive/issue_comments_431663.json:
```json
{
    "body": "Changed commit from **[`1604b82`](https://github.com/sagemath/sagetrac-mirror/commit/1604b82c2b609765f56923f893679d002b7ba5d3)** to **[`f79ccf9`](https://github.com/sagemath/sagetrac-mirror/commit/f79ccf95f3f4b8a626c85f78f1433efb46813c6b)**",
    "created_at": "2019-06-27T14:00:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431663",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1604b82`](https://github.com/sagemath/sagetrac-mirror/commit/1604b82c2b609765f56923f893679d002b7ba5d3)** to **[`f79ccf9`](https://github.com/sagemath/sagetrac-mirror/commit/f79ccf95f3f4b8a626c85f78f1433efb46813c6b)**



---

archive/issue_comments_431664.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nok, so this works without gettext installed (some funny thing with the return code, I return 779 and receive 11)\n\non a broken gettext install, with absent AM_ICONV, bootstrap -d would still fail.\n\nDo we care about the latter?",
    "created_at": "2019-06-27T14:14:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431664",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:41" align="right">comment:41</div>

ok, so this works without gettext installed (some funny thing with the return code, I return 779 and receive 11)

on a broken gettext install, with absent AM_ICONV, bootstrap -d would still fail.

Do we care about the latter?



---

archive/issue_events_378683.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-27T15:22:33Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378683"
}
```



---

archive/issue_events_378684.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-27T15:22:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378684"
}
```



---

archive/issue_events_378685.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-27T15:22:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378685"
}
```



---

archive/issue_events_378686.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-27T15:22:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378686"
}
```



---

archive/issue_comments_431665.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nCorrection: it does work in the latter scenario.",
    "created_at": "2019-06-27T15:22:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431665",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:42" align="right">comment:42</div>

Correction: it does work in the latter scenario.



---

archive/issue_comments_431666.json:
```json
{
    "body": "Changed commit from **[`f79ccf9`](https://github.com/sagemath/sagetrac-mirror/commit/f79ccf95f3f4b8a626c85f78f1433efb46813c6b)** to **[`2b5ceb1`](https://github.com/sagemath/sagetrac-mirror/commit/2b5ceb1d77c17ef83f2738bf4a1a82c84f124749)**",
    "created_at": "2019-06-27T15:26:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431666",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f79ccf9`](https://github.com/sagemath/sagetrac-mirror/commit/f79ccf95f3f4b8a626c85f78f1433efb46813c6b)** to **[`2b5ceb1`](https://github.com/sagemath/sagetrac-mirror/commit/2b5ceb1d77c17ef83f2738bf4a1a82c84f124749)**



---

archive/issue_events_378687.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2019-06-27T15:26:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378687"
}
```



---

archive/issue_events_378688.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2019-06-27T15:26:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378688"
}
```



---

archive/issue_comments_431667.json:
```json
{
    "body": "<div id=\"comment:43\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2b5ceb1d77c17ef83f2738bf4a1a82c84f124749\"><code>2b5ceb1</code></a></td><td><code>return must be between 0 and 255</code></td></tr></table>\n",
    "created_at": "2019-06-27T15:26:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431667",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:43"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2b5ceb1d77c17ef83f2738bf4a1a82c84f124749"><code>2b5ceb1</code></a></td><td><code>return must be between 0 and 255</code></td></tr></table>




---

archive/issue_comments_431668.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nrenumbered the return code to be between 0 and 255.",
    "created_at": "2019-06-27T15:31:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431668",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:44" align="right">comment:44</div>

renumbered the return code to be between 0 and 255.



---

archive/issue_events_378689.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-27T15:31:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378689"
}
```



---

archive/issue_events_378690.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-27T15:31:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378690"
}
```



---

archive/issue_events_378691.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-04T11:09:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378691"
}
```



---

archive/issue_events_378692.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "19c0da64ac206a12b121ba0ef0f3b6674a331990",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-07-04T11:09:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27823#event-378692"
}
```



---

archive/issue_comments_431669.json:
```json
{
    "body": "Changed branch from **[public/configure/iconv-config](https://github.com/sagemath/sagetrac-mirror/tree/public/configure/iconv-config)** to **[`2b5ceb1`](https://github.com/sagemath/sagetrac-mirror/commit/2b5ceb1d77c17ef83f2738bf4a1a82c84f124749)**",
    "created_at": "2019-07-04T11:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431669",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/configure/iconv-config](https://github.com/sagemath/sagetrac-mirror/tree/public/configure/iconv-config)** to **[`2b5ceb1`](https://github.com/sagemath/sagetrac-mirror/commit/2b5ceb1d77c17ef83f2738bf4a1a82c84f124749)**



---

archive/issue_comments_431670.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nIt seems that, at least on Cygwin, `AM_ICONV` will pass, somehow, even if iconv.h is installed, thus making the libicon-devel package on Cygwin a requirement, at least when it comes to building R (which otherwise fails at `#include <iconv.h>`).\n\nFor now I'll just update the Cygwin build instructions to require libiconv-devel as a prerequisite which is preferable anyways.  But maybe this still needs to be checked for somehow...",
    "created_at": "2019-08-14T11:35:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431670",
    "user": "https://github.com/embray"
}
```

<div id="comment:46" align="right">comment:46</div>

It seems that, at least on Cygwin, `AM_ICONV` will pass, somehow, even if iconv.h is installed, thus making the libicon-devel package on Cygwin a requirement, at least when it comes to building R (which otherwise fails at `#include <iconv.h>`).

For now I'll just update the Cygwin build instructions to require libiconv-devel as a prerequisite which is preferable anyways.  But maybe this still needs to be checked for somehow...



---

archive/issue_comments_431671.json:
```json
{
    "body": "Changed commit from **[`2b5ceb1`](https://github.com/sagemath/sagetrac-mirror/commit/2b5ceb1d77c17ef83f2738bf4a1a82c84f124749)** to none",
    "created_at": "2019-08-14T11:35:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431671",
    "user": "https://github.com/embray"
}
```

Changed commit from **[`2b5ceb1`](https://github.com/sagemath/sagetrac-mirror/commit/2b5ceb1d77c17ef83f2738bf4a1a82c84f124749)** to none



---

archive/issue_comments_431672.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nping slelievre for first discovering this.",
    "created_at": "2019-08-14T11:38:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431672",
    "user": "https://github.com/embray"
}
```

<div id="comment:47" align="right">comment:47</div>

ping slelievre for first discovering this.



---

archive/issue_comments_431673.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nmaybe add AC_CHECK_HEADER for iconv.h ?",
    "created_at": "2019-08-14T11:49:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431673",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:48" align="right">comment:48</div>

maybe add AC_CHECK_HEADER for iconv.h ?



---

archive/issue_comments_431674.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nThat's what I'm thinking, though now I need to double-check what `AM_ICONV` is actually doing, since I'm surprised it doesn't seem to need to do that...",
    "created_at": "2019-08-14T12:30:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431674",
    "user": "https://github.com/embray"
}
```

<div id="comment:49" align="right">comment:49</div>

That's what I'm thinking, though now I need to double-check what `AM_ICONV` is actually doing, since I'm surprised it doesn't seem to need to do that...



---

archive/issue_comments_431675.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nto get this working on OSX's home-brew, do\n\n```\nbrew install gettext\nbrew link gettext --force\n```",
    "created_at": "2019-09-19T12:14:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431675",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:50" align="right">comment:50</div>

to get this working on OSX's home-brew, do

```
brew install gettext
brew link gettext --force
```



---

archive/issue_comments_431676.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nFollow up: #29532",
    "created_at": "2020-04-19T15:33:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431676",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:51" align="right">comment:51</div>

Follow up: #29532



---

archive/issue_comments_431677.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nBruno Haible says on [bug-autoconf](https://lists.gnu.org/archive/html/bug-autoconf/2021-01/msg00033.html) that one should use gnulib's iconv module to install `config.rpath` etc. Indeed, \n\n```\ngnulib-tool --import iconv\n```\nwill install `config.rpath` into `config/` (among with other things that probably can be ignored).\nSo this is something to try in order to get rid of the hacky `install_config_rpath()` in [comment:18](#comment:18)",
    "created_at": "2021-01-30T12:57:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431677",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:52" align="right">comment:52</div>

Bruno Haible says on [bug-autoconf](https://lists.gnu.org/archive/html/bug-autoconf/2021-01/msg00033.html) that one should use gnulib's iconv module to install `config.rpath` etc. Indeed, 

```
gnulib-tool --import iconv
```
will install `config.rpath` into `config/` (among with other things that probably can be ignored).
So this is something to try in order to get rid of the hacky `install_config_rpath()` in [comment:18](#comment:18)



---

archive/issue_comments_431678.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nI have added this remark to #29549.",
    "created_at": "2021-02-07T22:01:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27823#issuecomment-431678",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:53" align="right">comment:53</div>

I have added this remark to #29549.
