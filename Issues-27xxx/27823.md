# Issue 27823: spkg-configure.m4 for iconv

archive/issues_027586.json:
```json
{
    "body": "In general the iconv SPKG is not even required.  It's not installed (or rather, a dummy empty package is installed) for any platforms except Cygwin, HP-UX, and Solaris.\n\nThe requirement for it on Cygwin is probably outdated--iconv is a standard library on almost all Cygwin installations, and is surely more up-to-date than when this SPKG was first added in #8567.  Support for the other two platforms has not been maintained much.\n\nWe can add a configure-time check for it, and treat it as a dummy package in most cases.\n\nCC:  @orlitzky @slel\n\nReviewer: Erik Bray, Dima Pasechnik\n\nAuthor: Dima Pasechnik, Erik Bray\n\nBranch: 2b5ceb1d77c17ef83f2738bf4a1a82c84f124749\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27823\n\n",
    "closed_at": "2019-07-04T11:09:30Z",
    "created_at": "2019-05-13T15:23:41Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "spkg-configure.m4 for iconv",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27823",
    "user": "https://github.com/embray"
}
```
In general the iconv SPKG is not even required.  It's not installed (or rather, a dummy empty package is installed) for any platforms except Cygwin, HP-UX, and Solaris.

The requirement for it on Cygwin is probably outdated--iconv is a standard library on almost all Cygwin installations, and is surely more up-to-date than when this SPKG was first added in #8567.  Support for the other two platforms has not been maintained much.

We can add a configure-time check for it, and treat it as a dummy package in most cases.

CC:  @orlitzky @slel

Reviewer: Erik Bray, Dima Pasechnik

Author: Dima Pasechnik, Erik Bray

Branch: 2b5ceb1d77c17ef83f2738bf4a1a82c84f124749

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27823





---

archive/issue_comments_414288.json:
```json
{
    "body": "<a id='comment:1'></a>there is a cryptic \n\n```\n    # Disable NLS on Cygwin to be able to build libiconv without the Cygwin\n    # libiconv package.\n```\nI presume the latter line should be \"NLS package\", no ?\n\nDoes this mean that the Cygwin's \"native\" libiconv does not work?",
    "created_at": "2019-06-10T09:10:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414288",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>there is a cryptic 

```
    # Disable NLS on Cygwin to be able to build libiconv without the Cygwin
    # libiconv package.
```
I presume the latter line should be "NLS package", no ?

Does this mean that the Cygwin's "native" libiconv does not work?



---

archive/issue_comments_414289.json:
```json
{
    "body": "<a id='comment:2'></a>According to #13912, that `--disable-nls` on Cygwin was dictated by the desire to reduce the number of Cygwin deps.\nI think it can be scrapped.",
    "created_at": "2019-06-10T12:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414289",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>According to #13912, that `--disable-nls` on Cygwin was dictated by the desire to reduce the number of Cygwin deps.
I think it can be scrapped.



---

archive/issue_comments_414290.json:
```json
{
    "body": "<a id='comment:3'></a>using AM_ICONV (a bit of a hack).\nNeeds config.rpath from gettext. (I also saw packages just creating an empty config.rpath, so perhaps we can do this too).\n\nDoes this work on Cygwin?\n\n---\nNew commits:",
    "created_at": "2019-06-10T19:00:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414290",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>using AM_ICONV (a bit of a hack).
Needs config.rpath from gettext. (I also saw packages just creating an empty config.rpath, so perhaps we can do this too).

Does this work on Cygwin?

---
New commits:



---

archive/issue_comments_414291.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-10T19:00:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414291",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_414292.json:
```json
{
    "body": "<a id='comment:5'></a>on OSX this also needs lib-link.m4...",
    "created_at": "2019-06-11T11:42:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414292",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>on OSX this also needs lib-link.m4...



---

archive/issue_comments_414293.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-06-11T11:42:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414293",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_414294.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-11T11:47:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414294",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414295.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-06-11T11:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414295",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_414296.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-06-11T11:54:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414296",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_414297.json:
```json
{
    "body": "<a id='comment:9'></a>OK, this much is needed for OSX...",
    "created_at": "2019-06-11T12:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414297",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>OK, this much is needed for OSX...



---

archive/issue_comments_414298.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-06-11T12:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414298",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_414299.json:
```json
{
    "body": "<a id='comment:10'></a>For the `config.rpath` stuff, it seems that file is included with gettext, typically under `/usr/share/gettext/config.rpath`.  Normally it is installed by `gettextize`, but I don't think we actually want to run that, since we really just want the file; we don't want to prepare the program for direct use of gettext.\n\nI wonder if there's a reasonably reliable way to just get the path to this file...",
    "created_at": "2019-06-11T12:52:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414299",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>For the `config.rpath` stuff, it seems that file is included with gettext, typically under `/usr/share/gettext/config.rpath`.  Normally it is installed by `gettextize`, but I don't think we actually want to run that, since we really just want the file; we don't want to prepare the program for direct use of gettext.

I wonder if there's a reasonably reliable way to just get the path to this file...



---

archive/issue_comments_414300.json:
```json
{
    "body": "<a id='comment:11'></a>the problem is that AM_ICONV pulls in a lot of macros from gettext, so config.rpath is just one of many things needed, as I found out on a gettext-less OSX box...",
    "created_at": "2019-06-11T12:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414300",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>the problem is that AM_ICONV pulls in a lot of macros from gettext, so config.rpath is just one of many things needed, as I found out on a gettext-less OSX box...



---

archive/issue_comments_414301.json:
```json
{
    "body": "<a id='comment:12'></a>It turns out `gettextize` is just a shell script, and the path to `/usr/share/gettext` is just in some variables in that file that are output when gettext is configured.",
    "created_at": "2019-06-11T12:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414301",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>It turns out `gettextize` is just a shell script, and the path to `/usr/share/gettext` is just in some variables in that file that are output when gettext is configured.



---

archive/issue_comments_414302.json:
```json
{
    "body": "<a id='comment:13'></a>> the problem is that AM_ICONV pulls in a lot of macros from gettext\n\n\nAre you saying you're trying to get it so you can run configure without the macros from gettext?  The thing about `config.rpath` is that it's not a macro; it's just a file that needs to be copied into place.  automake and the like don't do this automatically for the most part.",
    "created_at": "2019-06-11T12:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414302",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>> the problem is that AM_ICONV pulls in a lot of macros from gettext


Are you saying you're trying to get it so you can run configure without the macros from gettext?  The thing about `config.rpath` is that it's not a macro; it's just a file that needs to be copied into place.  automake and the like don't do this automatically for the most part.



---

archive/issue_comments_414303.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 embray]:\n> > the problem is that AM_ICONV pulls in a lot of macros from gettext\n\n> \n> Are you saying you're trying to get it so you can run configure without the macros from gettext?  The thing about `config.rpath` is that it's not a macro; it's just a file that needs to be copied into place.  automake and the like don't do this automatically for the most part.\n\n\nthat's correct, all of this is just to use AM_ICONV.\nOn OSX iconv is provided by the system, no need for gettext (or iconv) implementation; however AM_ICONV is a part of gettext package, and has several deps there, that need to be installed (and some of these deps need `config.rpath` script installed into the right place).",
    "created_at": "2019-06-11T13:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414303",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>Replying to [comment:13 embray]:
> > the problem is that AM_ICONV pulls in a lot of macros from gettext

> 
> Are you saying you're trying to get it so you can run configure without the macros from gettext?  The thing about `config.rpath` is that it's not a macro; it's just a file that needs to be copied into place.  automake and the like don't do this automatically for the most part.


that's correct, all of this is just to use AM_ICONV.
On OSX iconv is provided by the system, no need for gettext (or iconv) implementation; however AM_ICONV is a part of gettext package, and has several deps there, that need to be installed (and some of these deps need `config.rpath` script installed into the right place).



---

archive/issue_comments_414304.json:
```json
{
    "body": "<a id='comment:15'></a>Apparently it's actually a macro called `AC_LIB_RPATH` that requires the `config.rpath` file, and it happens to be used indirectly by AM_ICONV.  Most of the google results for `AC_LIB_RPATH` relate to this problem.",
    "created_at": "2019-06-11T13:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414304",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>Apparently it's actually a macro called `AC_LIB_RPATH` that requires the `config.rpath` file, and it happens to be used indirectly by AM_ICONV.  Most of the google results for `AC_LIB_RPATH` relate to this problem.



---

archive/issue_comments_414305.json:
```json
{
    "body": "<a id='comment:16'></a>Ha! Where is my medal?!\nCf. Paul Eggert saying that only brave people use AM_ICONV directly: https://lists.gnu.org/archive/html/autoconf/2002-09/msg00181.html",
    "created_at": "2019-06-11T13:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414305",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>Ha! Where is my medal?!
Cf. Paul Eggert saying that only brave people use AM_ICONV directly: https://lists.gnu.org/archive/html/autoconf/2002-09/msg00181.html



---

archive/issue_comments_414306.json:
```json
{
    "body": "<a id='comment:17'></a>I think this mostly just comes down to a misconfiguration on many distributions.\n\nautomake has a \"libdir\" that it searches for these generated files that it copies into your project.  For example on my system my automake libdir is `/usr/share/automake-1.14` in which I have I have:\n\n```\n$ ls -l /usr/share/automake-1.14\ntotal 512\ndrwxr-xr-x 2 root root   4096 May 26  2016 am\n-rwxr-xr-x 1 root root   5826 Jan  2  2014 ar-lib\ndrwxr-xr-x 2 root root   4096 May 26  2016 Automake\n-rwxr-xr-x 1 root root   7333 Jan  2  2014 compile\nlrwxrwxrwx 1 root root     20 Jan  2  2014 config.guess -> ../misc/config.guess\nlrwxrwxrwx 1 root root     18 Jan  2  2014 config.sub -> ../misc/config.sub\n-rw-r--r-- 1 root root  35147 Jan  2  2014 COPYING\n-rwxr-xr-x 1 root root  23566 Jan  2  2014 depcomp\n-rw-r--r-- 1 root root  15752 Jan  2  2014 INSTALL\n-rwxr-xr-x 1 root root  13997 Jan  2  2014 install-sh\n-rwxr-xr-x 1 root root   6047 Jan  2  2014 mdate-sh\n-rwxr-xr-x 1 root root   6872 Jan  2  2014 missing\n-rwxr-xr-x 1 root root   3538 Jan  2  2014 mkinstalldirs\n-rwxr-xr-x 1 root root   4670 Jan  2  2014 py-compile\n-rwxr-xr-x 1 root root  15285 Jan  2  2014 tap-driver.pl\n-rwxr-xr-x 1 root root  19464 Jan  2  2014 tap-driver.sh\n-rwxr-xr-x 1 root root   4287 Jan  2  2014 test-driver\n-rw-r--r-- 1 root root 323102 Jan  2  2014 texinfo.tex\n-rwxr-xr-x 1 root root   6858 Jan  2  2014 ylwrap\n```\n\nAs you can see, the commonly used `config.guess` and `config.sub` are actually symlinks to `/usr/misc`.  It turns out on my system these files are not even provided by automake, but rather a package called `autotools-dev`.\n\nFor this to work properly the distro ought to be creating a symlink `/usr/share/automake-1.14/config.rpath -> ../gettext/config.rpath`.\n\nBut they don't, so it doesn't get installed properly.",
    "created_at": "2019-06-11T13:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414306",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>I think this mostly just comes down to a misconfiguration on many distributions.

automake has a "libdir" that it searches for these generated files that it copies into your project.  For example on my system my automake libdir is `/usr/share/automake-1.14` in which I have I have:

```
$ ls -l /usr/share/automake-1.14
total 512
drwxr-xr-x 2 root root   4096 May 26  2016 am
-rwxr-xr-x 1 root root   5826 Jan  2  2014 ar-lib
drwxr-xr-x 2 root root   4096 May 26  2016 Automake
-rwxr-xr-x 1 root root   7333 Jan  2  2014 compile
lrwxrwxrwx 1 root root     20 Jan  2  2014 config.guess -> ../misc/config.guess
lrwxrwxrwx 1 root root     18 Jan  2  2014 config.sub -> ../misc/config.sub
-rw-r--r-- 1 root root  35147 Jan  2  2014 COPYING
-rwxr-xr-x 1 root root  23566 Jan  2  2014 depcomp
-rw-r--r-- 1 root root  15752 Jan  2  2014 INSTALL
-rwxr-xr-x 1 root root  13997 Jan  2  2014 install-sh
-rwxr-xr-x 1 root root   6047 Jan  2  2014 mdate-sh
-rwxr-xr-x 1 root root   6872 Jan  2  2014 missing
-rwxr-xr-x 1 root root   3538 Jan  2  2014 mkinstalldirs
-rwxr-xr-x 1 root root   4670 Jan  2  2014 py-compile
-rwxr-xr-x 1 root root  15285 Jan  2  2014 tap-driver.pl
-rwxr-xr-x 1 root root  19464 Jan  2  2014 tap-driver.sh
-rwxr-xr-x 1 root root   4287 Jan  2  2014 test-driver
-rw-r--r-- 1 root root 323102 Jan  2  2014 texinfo.tex
-rwxr-xr-x 1 root root   6858 Jan  2  2014 ylwrap
```

As you can see, the commonly used `config.guess` and `config.sub` are actually symlinks to `/usr/misc`.  It turns out on my system these files are not even provided by automake, but rather a package called `autotools-dev`.

For this to work properly the distro ought to be creating a symlink `/usr/share/automake-1.14/config.rpath -> ../gettext/config.rpath`.

But they don't, so it doesn't get installed properly.



---

archive/issue_comments_414307.json:
```json
{
    "body": "<a id='comment:18'></a>Here's a snippet of code I wrote to do what automake *should* be doing, but in our `bootstrap` script.  Seems to work nicely but have not tried in the MacOS hinterlands...\n\n```diff\ndiff --git a/bootstrap b/bootstrap\nindex 2505897..eca22b8 100755\n--- a/bootstrap\n+++ b/bootstrap\n@@ -28,6 +28,41 @@ MAKE=\"${MAKE:-make}\"\n CONFVERSION=`cat $PKG/package-version.txt`\n\n\n+install_config_rpath() {\n+    # The file config.rpath which comes from gettext is supposed to be\n+    # installed by automake, but due to a bug in most distros it is not;\n+    # see https://trac.sagemath.org/ticket/27823#comment:17\n+    #\n+    # Here we need to determine where gettext stores its data files and\n+    # copy config.rpath from there to config/\n+    gettextize=\"$(command -v gettextize)\"\n+    if [ -z \"$gettextize\" ]; then\n+        echo >&2 \"gettext and the gettextize program must be installed.\"\n+        exit 1\n+    fi\n+    eval `sed -n '/^prefix=\\(.*\\)$/p' $gettextize`\n+    eval `sed -n '/^datarootdir=\\(.*\\)$/p' $gettextize`\n+    eval `sed -n '/^gettext_dir=\\(.*\\)$/p' $gettextize`\n+\n+    if [ -z \"$gettext_dir\" ]; then\n+        echo >&2 \"Failed to read the gettext_dir directory from $gettextize\"\n+        echo >&2 \"The config.rpath file must manually be copied into config/\"\n+        echo >&2 \"This file is installed with gettext typically in /usr/share/gettext\"\n+        exit 1\n+    fi\n+\n+    config_rpath=\"$gettext_dir/config.rpath\"\n+    if [ ! -f \"$config_rpath\" ]; then\n+        echo >&2 \"Missing $config_rpath file; this indicates a broken gettext install.\"\n+        exit 1\n+    fi\n+\n+    echo \"bootstrap:$LINENO: installing 'config/config.rpath'\"\n+    cp \"$config_rpath\" config/\n+}\n+\n+\n+\n bootstrap () {\n     rm -f m4/sage_spkg_configures.m4\n     spkg_configures=\"\"\n@@ -40,6 +75,7 @@ SAGE_SPKG_CONFIGURE_$(echo ${pkgname} | tr '[a-z]' '[A-Z]')\"\n     echo \"$spkg_configures\" >> m4/sage_spkg_configures.m4\n\n     aclocal -I m4 && \\\n+    install_config_rpath && \\\n     automake --add-missing --copy build/make/Makefile-auto && \\\n     autoconf\n```",
    "created_at": "2019-06-11T13:52:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414307",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>Here's a snippet of code I wrote to do what automake *should* be doing, but in our `bootstrap` script.  Seems to work nicely but have not tried in the MacOS hinterlands...

```diff
diff --git a/bootstrap b/bootstrap
index 2505897..eca22b8 100755
--- a/bootstrap
+++ b/bootstrap
@@ -28,6 +28,41 @@ MAKE="${MAKE:-make}"
 CONFVERSION=`cat $PKG/package-version.txt`


+install_config_rpath() {
+    # The file config.rpath which comes from gettext is supposed to be
+    # installed by automake, but due to a bug in most distros it is not;
+    # see https://trac.sagemath.org/ticket/27823#comment:17
+    #
+    # Here we need to determine where gettext stores its data files and
+    # copy config.rpath from there to config/
+    gettextize="$(command -v gettextize)"
+    if [ -z "$gettextize" ]; then
+        echo >&2 "gettext and the gettextize program must be installed."
+        exit 1
+    fi
+    eval `sed -n '/^prefix=\(.*\)$/p' $gettextize`
+    eval `sed -n '/^datarootdir=\(.*\)$/p' $gettextize`
+    eval `sed -n '/^gettext_dir=\(.*\)$/p' $gettextize`
+
+    if [ -z "$gettext_dir" ]; then
+        echo >&2 "Failed to read the gettext_dir directory from $gettextize"
+        echo >&2 "The config.rpath file must manually be copied into config/"
+        echo >&2 "This file is installed with gettext typically in /usr/share/gettext"
+        exit 1
+    fi
+
+    config_rpath="$gettext_dir/config.rpath"
+    if [ ! -f "$config_rpath" ]; then
+        echo >&2 "Missing $config_rpath file; this indicates a broken gettext install."
+        exit 1
+    fi
+
+    echo "bootstrap:$LINENO: installing 'config/config.rpath'"
+    cp "$config_rpath" config/
+}
+
+
+
 bootstrap () {
     rm -f m4/sage_spkg_configures.m4
     spkg_configures=""
@@ -40,6 +75,7 @@ SAGE_SPKG_CONFIGURE_$(echo ${pkgname} | tr '[a-z]' '[A-Z]')"
     echo "$spkg_configures" >> m4/sage_spkg_configures.m4

     aclocal -I m4 && \
+    install_config_rpath && \
     automake --add-missing --copy build/make/Makefile-auto && \
     autoconf
```



---

archive/issue_comments_414308.json:
```json
{
    "body": "<a id='comment:19'></a>on my gentoo box I have `/usr/share/gettext/config.rpath`, yet it does not get picked up, i.e. if I remove the copying of `config.rpath` from bootstrap I get\n\n```\n$ ./bootstrap \nrm -rf config configure build/make/Makefile-auto.in\nconfigure.ac:320: installing 'config/compile'\nconfigure.ac:105: installing 'config/config.guess'\nm4/sage_spkg_configures.m4:35: error: required file 'config/config.rpath' not found\nconfigure.ac:105: installing 'config/config.sub'\nconfigure.ac:68: installing 'config/install-sh'\nconfigure.ac:68: installing 'config/missing'\n```\nApparently it has to installed:\n\n```\n$ grep -R \"config.rpath\" /usr/share/aclocal\n/usr/share/aclocal/guile.m4:  dnl the file gnulib/build-aux/config.rpath.\n/usr/share/aclocal/lib-link.m4:  dnl Complain if config.rpath is missing.\n\n/usr/share/aclocal/lib-link.m4:  AC_REQUIRE_AUX_FILE([config.rpath])\n/usr/share/aclocal/lib-link.m4:    ${CONFIG_SHELL-/bin/sh} \"$ac_aux_dir/config.rpath\" \"$host\" > conftest.sh\n```\n\nNaturally, on a box with gettext and autoconf installed none of these *.m4 files in this branch are needed, but `config.path` still is needed.",
    "created_at": "2019-06-11T14:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414308",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>on my gentoo box I have `/usr/share/gettext/config.rpath`, yet it does not get picked up, i.e. if I remove the copying of `config.rpath` from bootstrap I get

```
$ ./bootstrap 
rm -rf config configure build/make/Makefile-auto.in
configure.ac:320: installing 'config/compile'
configure.ac:105: installing 'config/config.guess'
m4/sage_spkg_configures.m4:35: error: required file 'config/config.rpath' not found
configure.ac:105: installing 'config/config.sub'
configure.ac:68: installing 'config/install-sh'
configure.ac:68: installing 'config/missing'
```
Apparently it has to installed:

```
$ grep -R "config.rpath" /usr/share/aclocal
/usr/share/aclocal/guile.m4:  dnl the file gnulib/build-aux/config.rpath.
/usr/share/aclocal/lib-link.m4:  dnl Complain if config.rpath is missing.

/usr/share/aclocal/lib-link.m4:  AC_REQUIRE_AUX_FILE([config.rpath])
/usr/share/aclocal/lib-link.m4:    ${CONFIG_SHELL-/bin/sh} "$ac_aux_dir/config.rpath" "$host" > conftest.sh
```

Naturally, on a box with gettext and autoconf installed none of these *.m4 files in this branch are needed, but `config.path` still is needed.



---

archive/issue_comments_414309.json:
```json
{
    "body": "<a id='comment:20'></a>Try my patch above.  The problem is that automake simply doesn't install the file if it's only found in `/usr/share/gettext`.",
    "created_at": "2019-06-11T14:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414309",
    "user": "https://github.com/embray"
}
```

<a id='comment:20'></a>Try my patch above.  The problem is that automake simply doesn't install the file if it's only found in `/usr/share/gettext`.



---

archive/issue_comments_414310.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-06-11T15:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414310",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_414311.json:
```json
{
    "body": "<a id='comment:22'></a>OK, this works with gettext 0.19 and 0.20 (also on OSX, with some extra effort). I had to change `/^gettext_dir` to `/gettext_datadir` and replace `gettext_dir` with `gettext_datadir` in the rest.\n\nAnyhow, this also needs to be tested on a \"clean\" OSX, without autotoots, with pre-generated configure, too.",
    "created_at": "2019-06-11T16:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414311",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>OK, this works with gettext 0.19 and 0.20 (also on OSX, with some extra effort). I had to change `/^gettext_dir` to `/gettext_datadir` and replace `gettext_dir` with `gettext_datadir` in the rest.

Anyhow, this also needs to be tested on a "clean" OSX, without autotoots, with pre-generated configure, too.



---

archive/issue_comments_414312.json:
```json
{
    "body": "<a id='comment:23'></a>Except this won't work on my gettext where it's spelled \"gettext_dir\".",
    "created_at": "2019-06-12T08:34:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414312",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'></a>Except this won't work on my gettext where it's spelled "gettext_dir".



---

archive/issue_comments_414313.json:
```json
{
    "body": "<a id='comment:24'></a>I guess mine must be quite old: https://github.com/autotools-mirror/gettext/commit/ff18897068486560e2bb421004cfbd42b7cdd0f8\n\nThis will still need to be reworked a bit.  It's maddening that the tool doesn't just have like a `--print-gettext-dir` option.",
    "created_at": "2019-06-12T08:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414313",
    "user": "https://github.com/embray"
}
```

<a id='comment:24'></a>I guess mine must be quite old: https://github.com/autotools-mirror/gettext/commit/ff18897068486560e2bb421004cfbd42b7cdd0f8

This will still need to be reworked a bit.  It's maddening that the tool doesn't just have like a `--print-gettext-dir` option.



---

archive/issue_comments_414314.json:
```json
{
    "body": "<a id='comment:25'></a>This works in both versions:\n\n```\neval `sed -n '/^prefix=.*$/p' $gettextize`\neval `sed -n '/^datarootdir=.*$/p' $gettextize`\neval `sed -n '/^gettext_dir=.*$/p' $gettextize`\nif [ -z \"$gettext_dir\" ]; then\n    # In newer versions this is spelled gettext_datadir\n    eval `sed -n '/^: \\${gettext_datadir=.*$/p' $gettextize`\n    gettext_dir=\"$gettext_datadir\"\nfi\n```\n\nAlso simplified a bit from my old version where I left in some groupings in the sed regexp that were not actually used.",
    "created_at": "2019-06-12T08:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414314",
    "user": "https://github.com/embray"
}
```

<a id='comment:25'></a>This works in both versions:

```
eval `sed -n '/^prefix=.*$/p' $gettextize`
eval `sed -n '/^datarootdir=.*$/p' $gettextize`
eval `sed -n '/^gettext_dir=.*$/p' $gettextize`
if [ -z "$gettext_dir" ]; then
    # In newer versions this is spelled gettext_datadir
    eval `sed -n '/^: \${gettext_datadir=.*$/p' $gettextize`
    gettext_dir="$gettext_datadir"
fi
```

Also simplified a bit from my old version where I left in some groupings in the sed regexp that were not actually used.



---

archive/issue_comments_414315.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:24 embray]:\n> I guess mine must be quite old: https://github.com/autotools-mirror/gettext/commit/ff18897068486560e2bb421004cfbd42b7cdd0f8\n> \n> This will still need to be reworked a bit.  It's maddening that the tool doesn't just have like a `--print-gettext-dir` option.\n\n\nWell, one can try to ask for it, but then it would need to get approved by Ulrich Drepper, it seems...",
    "created_at": "2019-06-12T08:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414315",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'></a>Replying to [comment:24 embray]:
> I guess mine must be quite old: https://github.com/autotools-mirror/gettext/commit/ff18897068486560e2bb421004cfbd42b7cdd0f8
> 
> This will still need to be reworked a bit.  It's maddening that the tool doesn't just have like a `--print-gettext-dir` option.


Well, one can try to ask for it, but then it would need to get approved by Ulrich Drepper, it seems...



---

archive/issue_comments_414316.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:25 embray]:\n> This works in both versions:\n> \n> \n> ```\n> eval `sed -n '/^prefix=.*$/p' $gettextize`\n> eval `sed -n '/^datarootdir=.*$/p' $gettextize`\n> eval `sed -n '/^gettext_dir=.*$/p' $gettextize`\n> if [ -z \"$gettext_dir\" ]; then\n>     # In newer versions this is spelled gettext_datadir\n>     eval `sed -n '/^: \\${gettext_datadir=.*$/p' $gettextize`\n>     gettext_dir=\"$gettext_datadir\"\n> fi\n> ```\n> \n> Also simplified a bit from my old version where I left in some groupings in the sed regexp that were not actually used.\n\n\nwell, this is out of sync with the ticket branch - but feel free to do your own version!",
    "created_at": "2019-06-12T09:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414316",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'></a>Replying to [comment:25 embray]:
> This works in both versions:
> 
> 
> ```
> eval `sed -n '/^prefix=.*$/p' $gettextize`
> eval `sed -n '/^datarootdir=.*$/p' $gettextize`
> eval `sed -n '/^gettext_dir=.*$/p' $gettextize`
> if [ -z "$gettext_dir" ]; then
>     # In newer versions this is spelled gettext_datadir
>     eval `sed -n '/^: \${gettext_datadir=.*$/p' $gettextize`
>     gettext_dir="$gettext_datadir"
> fi
> ```
> 
> Also simplified a bit from my old version where I left in some groupings in the sed regexp that were not actually used.


well, this is out of sync with the ticket branch - but feel free to do your own version!



---

archive/issue_comments_414317.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-13T08:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414317",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414318.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:27 dimpase]:\n> well, this is out of sync with the ticket branch - but feel free to do your own version!\n\n\nI went ahead and updated the branch.  Perhaps it's a little unnecessary to support much older versions, but it at least came up on one machine which I'd like to keep working for now.",
    "created_at": "2019-06-13T08:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414318",
    "user": "https://github.com/embray"
}
```

<a id='comment:29'></a>Replying to [comment:27 dimpase]:
> well, this is out of sync with the ticket branch - but feel free to do your own version!


I went ahead and updated the branch.  Perhaps it's a little unnecessary to support much older versions, but it at least came up on one machine which I'd like to keep working for now.



---

archive/issue_comments_414319.json:
```json
{
    "body": "<a id='comment:30'></a>It's fine, sure - but did you test this branch on old gettext? It seems to me that you need `else` clause to `if [ -z \"$gettext_dir\" ]; then` doing\n\n```\n   gettext_datadir=\"$gettext_dir\"\n```",
    "created_at": "2019-06-13T09:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414319",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>It's fine, sure - but did you test this branch on old gettext? It seems to me that you need `else` clause to `if [ -z "$gettext_dir" ]; then` doing

```
   gettext_datadir="$gettext_dir"
```



---

archive/issue_comments_414320.json:
```json
{
    "body": "<a id='comment:31'></a>Oh yeah, you're right.  This is a little messed up now.",
    "created_at": "2019-06-13T10:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414320",
    "user": "https://github.com/embray"
}
```

<a id='comment:31'></a>Oh yeah, you're right.  This is a little messed up now.



---

archive/issue_comments_414321.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-13T10:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414322.json:
```json
{
    "body": "<a id='comment:33'></a>I think this is good now.  Tested on both versions.\n\nAlso tested this on Cygwin and confirmed (as expected) that it works well using the system iconv (thank you!)",
    "created_at": "2019-06-13T10:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414322",
    "user": "https://github.com/embray"
}
```

<a id='comment:33'></a>I think this is good now.  Tested on both versions.

Also tested this on Cygwin and confirmed (as expected) that it works well using the system iconv (thank you!)



---

archive/issue_comments_414323.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-13T11:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414323",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_414324.json:
```json
{
    "body": "<a id='comment:35'></a>Is gettext guaranteed to be installed for some reason? If not, maybe we can punt and add it to the list at\n\nhttp://doc.sagemath.org/html/en/installation/source.html#command-line-tools",
    "created_at": "2019-06-13T14:40:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414324",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:35'></a>Is gettext guaranteed to be installed for some reason? If not, maybe we can punt and add it to the list at

http://doc.sagemath.org/html/en/installation/source.html#command-line-tools



---

archive/issue_comments_414325.json:
```json
{
    "body": "<a id='comment:36'></a>gettext, just like autotools, is needed to run ./bootstrap; none of this is documented, though. We should, though...",
    "created_at": "2019-06-13T15:13:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414325",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'></a>gettext, just like autotools, is needed to run ./bootstrap; none of this is documented, though. We should, though...



---

archive/issue_comments_414326.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-06-26T21:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414326",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_414327.json:
```json
{
    "body": "<a id='comment:37'></a>install_config_rpath calls exit(1) in some code paths, but its supposed to fall back to downloading the confball...",
    "created_at": "2019-06-26T21:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414327",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:37'></a>install_config_rpath calls exit(1) in some code paths, but its supposed to fall back to downloading the confball...



---

archive/issue_comments_414328.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-06-27T10:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414328",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_414329.json:
```json
{
    "body": "<a id='comment:39'></a>rebased, added returns, removed exits",
    "created_at": "2019-06-27T10:04:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414329",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:39'></a>rebased, added returns, removed exits



---

archive/issue_comments_414330.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-06-27T10:04:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414330",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_414331.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-27T14:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414331",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414332.json:
```json
{
    "body": "<a id='comment:41'></a>ok, so this works without gettext installed (some funny thing with the return code, I return 779 and receive 11)\n\non a broken gettext install, with absent AM_ICONV, bootstrap -d would still fail.\n\nDo we care about the latter?",
    "created_at": "2019-06-27T14:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414332",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:41'></a>ok, so this works without gettext installed (some funny thing with the return code, I return 779 and receive 11)

on a broken gettext install, with absent AM_ICONV, bootstrap -d would still fail.

Do we care about the latter?



---

archive/issue_events_068971.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-06-27T15:22:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27823#event-68971"
}
```



---

archive/issue_comments_414333.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-27T15:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414333",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_414334.json:
```json
{
    "body": "<a id='comment:42'></a>Correction: it does work in the latter scenario.",
    "created_at": "2019-06-27T15:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414334",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:42'></a>Correction: it does work in the latter scenario.



---

archive/issue_comments_414335.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-06-27T15:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414335",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_414336.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2019-06-27T15:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414336",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_414337.json:
```json
{
    "body": "<a id='comment:44'></a>renumbered the return code to be between 0 and 255.",
    "created_at": "2019-06-27T15:31:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414337",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:44'></a>renumbered the return code to be between 0 and 255.



---

archive/issue_comments_414338.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-27T15:31:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414338",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_068972.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-04T11:09:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27823#event-68972"
}
```



---

archive/issue_comments_414339.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-07-04T11:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414339",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_414340.json:
```json
{
    "body": "<a id='comment:46'></a>It seems that, at least on Cygwin, `AM_ICONV` will pass, somehow, even if iconv.h is installed, thus making the libicon-devel package on Cygwin a requirement, at least when it comes to building R (which otherwise fails at `#include <iconv.h>`).\n\nFor now I'll just update the Cygwin build instructions to require libiconv-devel as a prerequisite which is preferable anyways.  But maybe this still needs to be checked for somehow...",
    "created_at": "2019-08-14T11:35:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414340",
    "user": "https://github.com/embray"
}
```

<a id='comment:46'></a>It seems that, at least on Cygwin, `AM_ICONV` will pass, somehow, even if iconv.h is installed, thus making the libicon-devel package on Cygwin a requirement, at least when it comes to building R (which otherwise fails at `#include <iconv.h>`).

For now I'll just update the Cygwin build instructions to require libiconv-devel as a prerequisite which is preferable anyways.  But maybe this still needs to be checked for somehow...



---

archive/issue_comments_414341.json:
```json
{
    "body": "<a id='comment:47'></a>ping slelievre for first discovering this.",
    "created_at": "2019-08-14T11:38:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414341",
    "user": "https://github.com/embray"
}
```

<a id='comment:47'></a>ping slelievre for first discovering this.



---

archive/issue_comments_414342.json:
```json
{
    "body": "<a id='comment:48'></a>maybe add AC_CHECK_HEADER for iconv.h ?",
    "created_at": "2019-08-14T11:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414342",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:48'></a>maybe add AC_CHECK_HEADER for iconv.h ?



---

archive/issue_comments_414343.json:
```json
{
    "body": "<a id='comment:49'></a>That's what I'm thinking, though now I need to double-check what `AM_ICONV` is actually doing, since I'm surprised it doesn't seem to need to do that...",
    "created_at": "2019-08-14T12:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414343",
    "user": "https://github.com/embray"
}
```

<a id='comment:49'></a>That's what I'm thinking, though now I need to double-check what `AM_ICONV` is actually doing, since I'm surprised it doesn't seem to need to do that...



---

archive/issue_comments_414344.json:
```json
{
    "body": "<a id='comment:50'></a>to get this working on OSX's home-brew, do\n\n```\nbrew install gettext\nbrew link gettext --force\n```",
    "created_at": "2019-09-19T12:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414344",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:50'></a>to get this working on OSX's home-brew, do

```
brew install gettext
brew link gettext --force
```



---

archive/issue_comments_414345.json:
```json
{
    "body": "<a id='comment:51'></a>Follow up: #29532",
    "created_at": "2020-04-19T15:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414345",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'></a>Follow up: #29532



---

archive/issue_comments_414346.json:
```json
{
    "body": "<a id='comment:52'></a>Bruno Haible says on [bug-autoconf](https://lists.gnu.org/archive/html/bug-autoconf/2021-01/msg00033.html) that one should use gnulib's iconv module to install `config.rpath` etc. Indeed, \n\n```\ngnulib-tool --import iconv\n```\nwill install `config.rpath` into `config/` (among with other things that probably can be ignored).\nSo this is something to try in order to get rid of the hacky `install_config_rpath()` in comment:18",
    "created_at": "2021-01-30T12:57:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414346",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:52'></a>Bruno Haible says on [bug-autoconf](https://lists.gnu.org/archive/html/bug-autoconf/2021-01/msg00033.html) that one should use gnulib's iconv module to install `config.rpath` etc. Indeed, 

```
gnulib-tool --import iconv
```
will install `config.rpath` into `config/` (among with other things that probably can be ignored).
So this is something to try in order to get rid of the hacky `install_config_rpath()` in comment:18



---

archive/issue_comments_414347.json:
```json
{
    "body": "<a id='comment:53'></a>I have added this remark to #29549.",
    "created_at": "2021-02-07T22:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-414347",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:53'></a>I have added this remark to #29549.
