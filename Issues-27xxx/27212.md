# Issue 27212: spkg-configure.m4 for gmp and mpir

archive/issues_026975.json:
```json
{
    "assignees": [
        "https://github.com/vbraun"
    ],
    "body": "This should be easy, and it's a potential source of library conflicts, as gmp is often installed...\n\nnote that GMP is pulled in via `./configure --with-mp=gmp`\n(as well as by specifying SAGE_MP_LIBRARY?)\n\n**Configure:** \nhttp://users.ox.ac.uk/~coml0531/sage/configure-316.tar.gz\n\nCC:  @embray\n\nBranch: **[`e735b4b`](https://github.com/sagemath/sagetrac-mirror/commit/e735b4bd95072234d72385ee78634b9000f7e420)**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **Erik Bray, Dima Pasechnik**\n\nComponent: **packages: optional**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27212_\n\n",
    "closed_at": "2019-04-18T22:21:42Z",
    "created_at": "2019-02-04T04:37:00Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "spkg-configure.m4 for gmp and mpir",
    "type": "issue",
    "updated_at": "2019-04-30T13:10:07Z",
    "url": "https://github.com/sagemath/sage/issues/27212",
    "user": "https://github.com/dimpase"
}
```
This should be easy, and it's a potential source of library conflicts, as gmp is often installed...

note that GMP is pulled in via `./configure --with-mp=gmp`
(as well as by specifying SAGE_MP_LIBRARY?)

**Configure:** 
http://users.ox.ac.uk/~coml0531/sage/configure-316.tar.gz

CC:  @embray

Branch: **[`e735b4b`](https://github.com/sagemath/sagetrac-mirror/commit/e735b4bd95072234d72385ee78634b9000f7e420)**

Reviewer: **Dima Pasechnik**

Author: **Erik Bray, Dima Pasechnik**

Component: **packages: optional**

_Issue created by migration from https://trac.sagemath.org/ticket/27212_





---

archive/issue_events_375704.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-04T04:37:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375704"
}
```



---

archive/issue_events_375705.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-04T04:37:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "c: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375705"
}
```



---

archive/issue_events_375706.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-04T04:37:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375706"
}
```



---

archive/issue_events_375707.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-04T04:37:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375707"
}
```



---

archive/issue_comments_420005.json:
```json
{
    "body": "Commit: **[`1ed38e1`](https://github.com/sagemath/sagetrac-mirror/commit/1ed38e19baea5feb0d2f5d79e7989a7e80440a21)**",
    "created_at": "2019-02-04T17:46:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420005",
    "user": "https://github.com/dimpase"
}
```

Commit: **[`1ed38e1`](https://github.com/sagemath/sagetrac-mirror/commit/1ed38e19baea5feb0d2f5d79e7989a7e80440a21)**



---

archive/issue_comments_420006.json:
```json
{
    "body": "Author: **Dima Pasechnik**",
    "created_at": "2019-02-04T17:46:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420006",
    "user": "https://github.com/dimpase"
}
```

Author: **Dima Pasechnik**



---

archive/issue_comments_420007.json:
```json
{
    "body": "Branch: **[u/dimpase/packages/gmp_m4](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/gmp_m4)**",
    "created_at": "2019-02-04T17:46:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420007",
    "user": "https://github.com/dimpase"
}
```

Branch: **[u/dimpase/packages/gmp_m4](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/gmp_m4)**



---

archive/issue_events_375708.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-04T17:46:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375708"
}
```



---

archive/issue_comments_420008.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nhere we check that GMP is new enough, by verifying it has a new function.\nThe rest is just copypaste.\n\nTo actually build with GMP, one needs\n\n```\n./configure --with-mp=gmp\n```\n(configure does the test regardless)\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ed38e19baea5feb0d2f5d79e7989a7e80440a21\"><code>1ed38e1</code></a></td><td><code>spkg-configure for GMP</code></td></tr></table>\n",
    "created_at": "2019-02-04T17:46:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420008",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:1" align="right">comment:1</div>

here we check that GMP is new enough, by verifying it has a new function.
The rest is just copypaste.

To actually build with GMP, one needs

```
./configure --with-mp=gmp
```
(configure does the test regardless)

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ed38e19baea5feb0d2f5d79e7989a7e80440a21"><code>1ed38e1</code></a></td><td><code>spkg-configure for GMP</code></td></tr></table>




---

archive/issue_comments_420009.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI suppose due to a special treatment of GMP/MPIR, despite configure reporting GMP as not being installed, it still gets picked up for installation from source.\n(I tested this on a clean build...)",
    "created_at": "2019-02-05T11:15:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420009",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2" align="right">comment:2</div>

I suppose due to a special treatment of GMP/MPIR, despite configure reporting GMP as not being installed, it still gets picked up for installation from source.
(I tested this on a clean build...)



---

archive/issue_events_375709.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-05T11:15:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375709"
}
```



---

archive/issue_events_375710.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-05T11:15:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375710"
}
```



---

archive/issue_comments_420010.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nYes, I've already put some thought into how to handle this case, though I don't have a solid answer.  The `spkg-configure.m4` seems fine, but we can't just leave it at that.\n\nThe tricky thing is that with MPIR it can be compiled with or without gmp-compatibility mode.  On Sage we use `--with-gmpcompat` so if we link to a gmp we're actually getting the one installed by MPIR.  But some systems might have MPIR built without gmp-compatiblity, and yet no separate libgmp.so.  So in that case we'd actually want to use libmpir (if such a system exists I'm not sure).\n\nSo if we run `./configure` with no `--with-mp=` flag the question is what to do?  Do we just try to detect any \"libgmp\" and use that if found?  Do look for a libmpir, ever?  If the user passes `--with-mp=mpir` or `--with-mp=gmp` should that imply that it should just build the Sage SPKG, or do we explicitly go searching for, say, a libmpir in the former case?",
    "created_at": "2019-02-06T16:49:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420010",
    "user": "https://github.com/embray"
}
```

<div id="comment:3" align="right">comment:3</div>

Yes, I've already put some thought into how to handle this case, though I don't have a solid answer.  The `spkg-configure.m4` seems fine, but we can't just leave it at that.

The tricky thing is that with MPIR it can be compiled with or without gmp-compatibility mode.  On Sage we use `--with-gmpcompat` so if we link to a gmp we're actually getting the one installed by MPIR.  But some systems might have MPIR built without gmp-compatiblity, and yet no separate libgmp.so.  So in that case we'd actually want to use libmpir (if such a system exists I'm not sure).

So if we run `./configure` with no `--with-mp=` flag the question is what to do?  Do we just try to detect any "libgmp" and use that if found?  Do look for a libmpir, ever?  If the user passes `--with-mp=mpir` or `--with-mp=gmp` should that imply that it should just build the Sage SPKG, or do we explicitly go searching for, say, a libmpir in the former case?



---

archive/issue_comments_420011.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nDeciding which BLAS to use from the system raises similar questions.",
    "created_at": "2019-02-06T16:51:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420011",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

Deciding which BLAS to use from the system raises similar questions.



---

archive/issue_comments_420012.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThe more I think about it, the more I'm inclined toward `--with-mp=mpir` should mean that the MP library *must* by MPIR by explicit request of the user, and if not found on the system then we should build the SPKG.\n\nIf `--with-mp=` is not otherwise specified then we can take whatever MP lib was found on the system.\n\nWe should also add an `spkg-configure.m4` for MPIR.  We can impose an ordering (e.g. first check for MPIR, and then for plain GMP) by putting `AC_REQURE(SAGE_SPKG_CONFIGURE_MPIR)` at the beginning of the `spkg-configure.m4` for gmp.  I did something similar for gfortran/gcc and seems to work.",
    "created_at": "2019-02-06T16:56:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420012",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">comment:5</div>

The more I think about it, the more I'm inclined toward `--with-mp=mpir` should mean that the MP library *must* by MPIR by explicit request of the user, and if not found on the system then we should build the SPKG.

If `--with-mp=` is not otherwise specified then we can take whatever MP lib was found on the system.

We should also add an `spkg-configure.m4` for MPIR.  We can impose an ordering (e.g. first check for MPIR, and then for plain GMP) by putting `AC_REQURE(SAGE_SPKG_CONFIGURE_MPIR)` at the beginning of the `spkg-configure.m4` for gmp.  I did something similar for gfortran/gcc and seems to work.



---

archive/issue_comments_420013.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nIt should also be noted that we have also in the past patched other SPKGS (see e.g. #21188) to always link with `-lgmp` and `#include <gmp.h>` (and never use `-lmpir` and `#include <mpir.h>` respectively).\n\nI'm not 100% convinced that that's necessary, though certainly one or the other should be used.  So it's probably best to always ensure that there is at least a working `libgmp` and a `gmp.h`.  The question then is whether or not it's possible to determine if that `libgmp` happened to be provided by MPIR.\n\nUpdate: It seems that a `libgmp.so` provided by MPIR does contain a `__mpir_version` symbol, so that's something we can look for.",
    "created_at": "2019-02-06T17:11:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420013",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

It should also be noted that we have also in the past patched other SPKGS (see e.g. #21188) to always link with `-lgmp` and `#include <gmp.h>` (and never use `-lmpir` and `#include <mpir.h>` respectively).

I'm not 100% convinced that that's necessary, though certainly one or the other should be used.  So it's probably best to always ensure that there is at least a working `libgmp` and a `gmp.h`.  The question then is whether or not it's possible to determine if that `libgmp` happened to be provided by MPIR.

Update: It seems that a `libgmp.so` provided by MPIR does contain a `__mpir_version` symbol, so that's something we can look for.



---

archive/issue_comments_420014.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nIt seems MPIR is not in fact packaged for Debian (not sure about other distros): https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=708391  I had just assumed it would be a question of using either MPIR or GMP (in other words, they conflict with each other, and installing either one or the other is possible, as is the case in Sage).",
    "created_at": "2019-02-06T17:19:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420014",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

It seems MPIR is not in fact packaged for Debian (not sure about other distros): https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=708391  I had just assumed it would be a question of using either MPIR or GMP (in other words, they conflict with each other, and installing either one or the other is possible, as is the case in Sage).



---

archive/issue_comments_420015.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@embray](#comment:3):\n> Yes, I've already put some thought into how to handle this case, though I don't have a solid answer.  The `spkg-configure.m4` seems fine, but we can't just leave it at that.\n> \n> The tricky thing is that with MPIR it can be compiled with or without gmp-compatibility mode.  On Sage we use `--with-gmpcompat` so if we link to a gmp we're actually getting the one installed by MPIR.  But some systems might have MPIR built without gmp-compatiblity, and yet no separate libgmp.so.  So in that case we'd actually want to use libmpir (if such a system exists I'm not sure).\n\nFreeBSD provides GMP and MPIR, not  in GMP-compatibility mode (I looked at the corresponding makefile)\nhttps://www.freshports.org/math/mpir\nhttps://www.freshports.org/math/gmp\n\nboth are in /usr/local/ there. \n\nI would not be worried about a hypothetical situation of many libgmp's on the system\n(in fact, MPFR has a very long configure script dealing with detecting all sorts of info about GMP (or a GMP-compatible thing)",
    "created_at": "2019-02-06T17:45:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420015",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@embray](#comment:3):
> Yes, I've already put some thought into how to handle this case, though I don't have a solid answer.  The `spkg-configure.m4` seems fine, but we can't just leave it at that.
> 
> The tricky thing is that with MPIR it can be compiled with or without gmp-compatibility mode.  On Sage we use `--with-gmpcompat` so if we link to a gmp we're actually getting the one installed by MPIR.  But some systems might have MPIR built without gmp-compatiblity, and yet no separate libgmp.so.  So in that case we'd actually want to use libmpir (if such a system exists I'm not sure).

FreeBSD provides GMP and MPIR, not  in GMP-compatibility mode (I looked at the corresponding makefile)
https://www.freshports.org/math/mpir
https://www.freshports.org/math/gmp

both are in /usr/local/ there. 

I would not be worried about a hypothetical situation of many libgmp's on the system
(in fact, MPFR has a very long configure script dealing with detecting all sorts of info about GMP (or a GMP-compatible thing)



---

archive/issue_comments_420016.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI guess the main question is what to do with the `--with-mp=` flag in Sage's `./configure` script.  I don't think it necessarily needs to continue working exactly the same way, but whatever it does it should be sensible.  The way I see there are a couple possible ways to interpret it:\n\nOne way is that there are really three possible values:\n\n- detect\n- gmp\n- mpir\n\nwhere the default value is \"detect\".  In the \"detect\" case we just try to find the best working libgmp on the system and use it if found.  If not found the next fallback would be to install the mpir SPKG (the current default).  If passed \"mpir\" or \"gmp\" explicitly we don't bother detecting and just install the specifically requested SPKG.\n\nAnother possible interpretation is something more like:\n\n- gmp\n- mpir\n\nwhere now default value \"gmp\" is similar to the first case: just try to detect *any* libgmp on the system to use, and failing that install an SPKG for some libgmp (where we might still use MPIR, but that fact is an implementation detail), whereas \"mpir\" means \"detect MPIR *specifically*\", which is to say find a libgmp that also, at a minimum, contains the `__mpir_version` flag.  Perhaps, for some reason, a user might specifically want to use MPIR e.g. for performance reasons.  If not found then we build the MPIR SPKG and use that.\n\nPerhaps there are some other ways of interpreting/re-interpreting this flag, but those are a couple I have in mind.",
    "created_at": "2019-02-07T16:35:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420016",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

I guess the main question is what to do with the `--with-mp=` flag in Sage's `./configure` script.  I don't think it necessarily needs to continue working exactly the same way, but whatever it does it should be sensible.  The way I see there are a couple possible ways to interpret it:

One way is that there are really three possible values:

- detect
- gmp
- mpir

where the default value is "detect".  In the "detect" case we just try to find the best working libgmp on the system and use it if found.  If not found the next fallback would be to install the mpir SPKG (the current default).  If passed "mpir" or "gmp" explicitly we don't bother detecting and just install the specifically requested SPKG.

Another possible interpretation is something more like:

- gmp
- mpir

where now default value "gmp" is similar to the first case: just try to detect *any* libgmp on the system to use, and failing that install an SPKG for some libgmp (where we might still use MPIR, but that fact is an implementation detail), whereas "mpir" means "detect MPIR *specifically*", which is to say find a libgmp that also, at a minimum, contains the `__mpir_version` flag.  Perhaps, for some reason, a user might specifically want to use MPIR e.g. for performance reasons.  If not found then we build the MPIR SPKG and use that.

Perhaps there are some other ways of interpreting/re-interpreting this flag, but those are a couple I have in mind.



---

archive/issue_comments_420017.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI think I lean more toward the latter case.  Most people who want to build Sage do not care what GMP implementation they use, so I think it's good enough to use the one they have, if any, and if not pick one for them.  Whereas if someone is explicitly passing `--with-mp=mpir` then the *really* want MPIR specifically, and we should not give them something that isn't it.\n\nOTOH I'd also be curious in what cases MPIR gives better performance, and if we're doing users a disservice by not at least strongly recommending that they use it.   I think this is more a question for the mailing list though.  The details of what to do at `configure`-time can be malleable.",
    "created_at": "2019-02-07T16:37:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420017",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">comment:10</div>

I think I lean more toward the latter case.  Most people who want to build Sage do not care what GMP implementation they use, so I think it's good enough to use the one they have, if any, and if not pick one for them.  Whereas if someone is explicitly passing `--with-mp=mpir` then the *really* want MPIR specifically, and we should not give them something that isn't it.

OTOH I'd also be curious in what cases MPIR gives better performance, and if we're doing users a disservice by not at least strongly recommending that they use it.   I think this is more a question for the mailing list though.  The details of what to do at `configure`-time can be malleable.



---

archive/issue_comments_420018.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nPerhaps we could leave the mpir-based toolchain aside for a moment, after all mpir is an optional package, so it is a bug if it is pulled in once GMP is chosen,\nand concentrate on the rest of the surrounding number theory libs: mpc, mpfr, gf2x, ntl, pari.\n\nSo first we have to sort out why GMP is pulled in despite being recognised by configure as not to be installed, no?\n\n---\n\nNote that this spurious GMP installation isn't even triggered before some of spkgs dependent on GMP are installed, e.g. MPFR happily installs long before it's started on GMP.\nI get\n\n```\n$ ldd local/lib/libmpfr.so\n\tlinux-vdso.so.1 (0x00007ffcc02e9000)\n\tlibgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007f9345368000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007f9345199000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007f9345696000)\n```\nbut the beginning of MPFR install log says, wrongly,\n\n```\n  --with-gmp=\"/mnt/opt/Sage/sage-dev/local\"\n```\nThis is of course as expected, as it's hardwired in its spkg-install, as\n`sdh_configure --with-gmp=\"$SAGE_LOCAL\"...`\n\nIt appears to me that instead the main `./configure` should set up something like `SAGE_GMP` to be either `SAGE_LOCAL` or a location computed by GMP's `spkg-configure.m4`, and then this `SAGE_GMP` must be used by MPFR...",
    "created_at": "2019-02-07T19:42:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420018",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11" align="right">comment:11</div>

Perhaps we could leave the mpir-based toolchain aside for a moment, after all mpir is an optional package, so it is a bug if it is pulled in once GMP is chosen,
and concentrate on the rest of the surrounding number theory libs: mpc, mpfr, gf2x, ntl, pari.

So first we have to sort out why GMP is pulled in despite being recognised by configure as not to be installed, no?

---

Note that this spurious GMP installation isn't even triggered before some of spkgs dependent on GMP are installed, e.g. MPFR happily installs long before it's started on GMP.
I get

```
$ ldd local/lib/libmpfr.so
	linux-vdso.so.1 (0x00007ffcc02e9000)
	libgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007f9345368000)
	libc.so.6 => /lib64/libc.so.6 (0x00007f9345199000)
	/lib64/ld-linux-x86-64.so.2 (0x00007f9345696000)
```
but the beginning of MPFR install log says, wrongly,

```
  --with-gmp="/mnt/opt/Sage/sage-dev/local"
```
This is of course as expected, as it's hardwired in its spkg-install, as
`sdh_configure --with-gmp="$SAGE_LOCAL"...`

It appears to me that instead the main `./configure` should set up something like `SAGE_GMP` to be either `SAGE_LOCAL` or a location computed by GMP's `spkg-configure.m4`, and then this `SAGE_GMP` must be used by MPFR...



---

archive/issue_comments_420019.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAnd MPFR's only part of trouble:\n\n```\n$ grep \"gmp=..SAGE_LOCAL.\" */spkg-install  \narb/spkg-install:    --with-gmp=\"$SAGE_LOCAL\" --with-mpfr=\"$SAGE_LOCAL\"\ndeformation/spkg-install:            --with-gmp=\"$SAGE_LOCAL\" --with-mpfr=\"$SAGE_LOCAL\" \\\necm/spkg-install:sdh_configure --with-gmp=\"$SAGE_LOCAL\" $ECM_CONFIGURE\nflint/spkg-install:    --with-gmp=\"$SAGE_LOCAL\" \\\ngap/spkg-install:sdh_configure --with-gmp=\"$SAGE_LOCAL\"\ngcc/spkg-install:    --with-gmp=\"$SAGE_LOCAL\" --with-mpfr=\"$SAGE_LOCAL\" --with-mpc=\"$SAGE_LOCAL\" \\\ngdb/spkg-install:    --with-gmp=\"$SAGE_LOCAL\"\ngfortran/spkg-install:    --with-gmp=\"$SAGE_LOCAL\" --with-mpfr=\"$SAGE_LOCAL\" --with-mpc=\"$SAGE_LOCAL\" \\\ngivaro/spkg-install:sdh_configure --with-gmp=\"$SAGE_LOCAL\" --enable-shared $GIVARO_CONFIGURE\nglpk/spkg-install:#       GMP/MPIR and zlib, so we should just use `--with-gmp=\"$SAGE_LOCAL\"` and\nmpc/spkg-install:sdh_configure --with-gmp=\"$SAGE_LOCAL\" --with-mpfr=\"$SAGE_LOCAL\" $EXTRA\nmpfi/spkg-install:sdh_configure --with-mpfr=\"$SAGE_LOCAL\" --with-gmp=\"$SAGE_LOCAL\"\nmpfrcx/spkg-install:sdh_configure --with-gmp=\"$SAGE_LOCAL\" --with-mpfr=\"$SAGE_LOCAL\" \\\nmpfr/spkg-install:        ./configure --with-gmp=\"$SAGE_LOCAL\" $SAGE_CONF_OPTS $MPFR_CONFIGURE) &>/dev/null;\nmpfr/spkg-install:    sdh_configure --with-gmp=\"$SAGE_LOCAL\" \\\npari/spkg-install:    --with-readline=\"$SAGE_LOCAL\" --with-gmp=\"$SAGE_LOCAL\" \\\npolylib/spkg-install:sdh_configure --with-libgmp=${SAGE_LOCAL}/lib\nsingular/spkg-install:                  --with-gmp=\"$SAGE_LOCAL\" \\\ntopcom/spkg-install:    --with-gmp=\"$SAGE_LOCAL\" \\\n```\nSo passing SAGE_LOCAL left and right for everything is something to work on.",
    "created_at": "2019-02-07T22:20:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420019",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">comment:12</div>

And MPFR's only part of trouble:

```
$ grep "gmp=..SAGE_LOCAL." */spkg-install  
arb/spkg-install:    --with-gmp="$SAGE_LOCAL" --with-mpfr="$SAGE_LOCAL"
deformation/spkg-install:            --with-gmp="$SAGE_LOCAL" --with-mpfr="$SAGE_LOCAL" \
ecm/spkg-install:sdh_configure --with-gmp="$SAGE_LOCAL" $ECM_CONFIGURE
flint/spkg-install:    --with-gmp="$SAGE_LOCAL" \
gap/spkg-install:sdh_configure --with-gmp="$SAGE_LOCAL"
gcc/spkg-install:    --with-gmp="$SAGE_LOCAL" --with-mpfr="$SAGE_LOCAL" --with-mpc="$SAGE_LOCAL" \
gdb/spkg-install:    --with-gmp="$SAGE_LOCAL"
gfortran/spkg-install:    --with-gmp="$SAGE_LOCAL" --with-mpfr="$SAGE_LOCAL" --with-mpc="$SAGE_LOCAL" \
givaro/spkg-install:sdh_configure --with-gmp="$SAGE_LOCAL" --enable-shared $GIVARO_CONFIGURE
glpk/spkg-install:#       GMP/MPIR and zlib, so we should just use `--with-gmp="$SAGE_LOCAL"` and
mpc/spkg-install:sdh_configure --with-gmp="$SAGE_LOCAL" --with-mpfr="$SAGE_LOCAL" $EXTRA
mpfi/spkg-install:sdh_configure --with-mpfr="$SAGE_LOCAL" --with-gmp="$SAGE_LOCAL"
mpfrcx/spkg-install:sdh_configure --with-gmp="$SAGE_LOCAL" --with-mpfr="$SAGE_LOCAL" \
mpfr/spkg-install:        ./configure --with-gmp="$SAGE_LOCAL" $SAGE_CONF_OPTS $MPFR_CONFIGURE) &>/dev/null;
mpfr/spkg-install:    sdh_configure --with-gmp="$SAGE_LOCAL" \
pari/spkg-install:    --with-readline="$SAGE_LOCAL" --with-gmp="$SAGE_LOCAL" \
polylib/spkg-install:sdh_configure --with-libgmp=${SAGE_LOCAL}/lib
singular/spkg-install:                  --with-gmp="$SAGE_LOCAL" \
topcom/spkg-install:    --with-gmp="$SAGE_LOCAL" \
```
So passing SAGE_LOCAL left and right for everything is something to work on.



---

archive/issue_comments_420020.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI don't think I understand how the `.dummy` target for skipping \"dummy\" packages \nin `build/make/Makefile` works, in particular, why it's just a single `$(INST)/.dummy` file for all of them.\n\nOr perhaps it's because `gmp` spkg is known as well as `$(MP_LIBRARY)`, and it's not found on the list of \"dummy\" packages, which duly includes `gmp`...",
    "created_at": "2019-02-07T23:49:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420020",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:13" align="right">comment:13</div>

I don't think I understand how the `.dummy` target for skipping "dummy" packages 
in `build/make/Makefile` works, in particular, why it's just a single `$(INST)/.dummy` file for all of them.

Or perhaps it's because `gmp` spkg is known as well as `$(MP_LIBRARY)`, and it's not found on the list of "dummy" packages, which duly includes `gmp`...



---

archive/issue_comments_420021.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI've added spkg-configures to the whole \"toolchain\" bunch (see attachment) - the one for MPIR is basically just a plug, and will now try running the build to see if GMP install still surfaces...",
    "created_at": "2019-02-08T09:50:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420021",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:14" align="right">comment:14</div>

I've added spkg-configures to the whole "toolchain" bunch (see attachment) - the one for MPIR is basically just a plug, and will now try running the build to see if GMP install still surfaces...



---

archive/issue_comments_420022.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAttachment: **[mp_star.patch.gz](https://github.com/sagemath/sage/files/ticket27212/mp_star.patch.gz)**\n\nno, this does not help - and while I didn't have patience for the build to come to a halt, I still saw GMP getting built. (and none of MP*'s)",
    "created_at": "2019-02-08T10:18:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420022",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">comment:15</div>

Attachment: **[mp_star.patch.gz](https://github.com/sagemath/sage/files/ticket27212/mp_star.patch.gz)**

no, this does not help - and while I didn't have patience for the build to come to a halt, I still saw GMP getting built. (and none of MP*'s)



---

archive/issue_comments_420023.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThe thing to do with all of these is that `configure` needs to output some config file based on its results which contains the correct prefixes for all these libraries (and likely others to come).\n\nFor this it might be useful to use the existing `sage-env-config` file, since I believe it gets sourced when building each package.  It would probably be useful to have there since having the correct paths to libraries may also be useful at runtime (e.g. when running `cython()`, I think).  To this end it would also be nice to have a sort of `sage.env_config` Python module that is also generated, so these values can easily be loaded by the Python library without `sage-env` being sourced, but this is not necessary for the SPKG build process.\n\nThen every `--with-gmp=$SAGE_LOCAL\"` should be replaced with `--with-gmp=$SAGE_GMP_PREFIX\"`, or something like that (the value of which is still ofc `$SAGE_LOCAL` when using a GMP installed from an SPKG).\n\nWhat I'm less sure about is how exactly to determine the value for `$SAGE_GMP_PREFIX`.  Macros like `AC_SEARCH_LIBS` only tests that linking with `-l<libname>` works; it has no clue about how the system searches library paths in that case.  I think the best way to handle this is not unlike the code I wrote in #27230, unfortunately.",
    "created_at": "2019-02-08T11:35:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420023",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">comment:16</div>

The thing to do with all of these is that `configure` needs to output some config file based on its results which contains the correct prefixes for all these libraries (and likely others to come).

For this it might be useful to use the existing `sage-env-config` file, since I believe it gets sourced when building each package.  It would probably be useful to have there since having the correct paths to libraries may also be useful at runtime (e.g. when running `cython()`, I think).  To this end it would also be nice to have a sort of `sage.env_config` Python module that is also generated, so these values can easily be loaded by the Python library without `sage-env` being sourced, but this is not necessary for the SPKG build process.

Then every `--with-gmp=$SAGE_LOCAL"` should be replaced with `--with-gmp=$SAGE_GMP_PREFIX"`, or something like that (the value of which is still ofc `$SAGE_LOCAL` when using a GMP installed from an SPKG).

What I'm less sure about is how exactly to determine the value for `$SAGE_GMP_PREFIX`.  Macros like `AC_SEARCH_LIBS` only tests that linking with `-l<libname>` works; it has no clue about how the system searches library paths in that case.  I think the best way to handle this is not unlike the code I wrote in #27230, unfortunately.



---

archive/issue_comments_420024.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI think the .dummy magic breaks for `$(MP_LIBRARY)`. To prove this, I did\n\n```diff\ndiff --git a/build/make/deps b/build/make/deps\nindex e9008d20e6..c37b6062ee 100644\n--- a/build/make/deps\n+++ b/build/make/deps\n@@ -77,7 +77,7 @@ toolchain: $(foreach pkgname,$(TOOLCHAIN),$(inst_$(pkgname)))\n # See #14168 and #14232.\n #\n # Note: This list consists of only the *runtime* dependencies of the toolchain.\n-TOOLCHAIN_DEPS = zlib $(MP_LIBRARY) mpfr mpc\n+TOOLCHAIN_DEPS = zlib gmp mpfr mpc\n TOOLCHAIN_DEP_INSTS = \\\n        $(foreach pkgname,$(TOOLCHAIN_DEPS),$(inst_$(pkgname)))\n \n@@ -156,7 +156,6 @@ sagelib: \\\n                $(inst_mpc) \\\n                $(inst_mpfi) \\\n                $(inst_mpfr) \\\n-               $(MP_LIBRARY) \\\n                $(inst_ntl) \\\n                $(inst_numpy) \\\n                $(inst_pari) \\\n```\n(probably only the 2nd change, removal from `sagelib:` deps matters, not the 1st change.)\n\nand, viola, no GMP building pops up. Needless to say, \"dummies\" of the form `$(inst_...)` do not get built.",
    "created_at": "2019-02-08T11:37:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420024",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

I think the .dummy magic breaks for `$(MP_LIBRARY)`. To prove this, I did

```diff
diff --git a/build/make/deps b/build/make/deps
index e9008d20e6..c37b6062ee 100644
--- a/build/make/deps
+++ b/build/make/deps
@@ -77,7 +77,7 @@ toolchain: $(foreach pkgname,$(TOOLCHAIN),$(inst_$(pkgname)))
 # See #14168 and #14232.
 #
 # Note: This list consists of only the *runtime* dependencies of the toolchain.
-TOOLCHAIN_DEPS = zlib $(MP_LIBRARY) mpfr mpc
+TOOLCHAIN_DEPS = zlib gmp mpfr mpc
 TOOLCHAIN_DEP_INSTS = \
        $(foreach pkgname,$(TOOLCHAIN_DEPS),$(inst_$(pkgname)))
 
@@ -156,7 +156,6 @@ sagelib: \
                $(inst_mpc) \
                $(inst_mpfi) \
                $(inst_mpfr) \
-               $(MP_LIBRARY) \
                $(inst_ntl) \
                $(inst_numpy) \
                $(inst_pari) \
```
(probably only the 2nd change, removal from `sagelib:` deps matters, not the 1st change.)

and, viola, no GMP building pops up. Needless to say, "dummies" of the form `$(inst_...)` do not get built.



---

archive/issue_comments_420025.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@dimpase](#comment:17):\n> I think the .dummy magic breaks for `$(MP_LIBRARY)`. To prove this, I did\n\nSorry, I didn't realize you were being stymied by this.  Yes, to me there was no mystery here, which is in part why I was focused on how best to handle the existing `--with-mp` flag. I should have been more clear about that.",
    "created_at": "2019-02-08T11:57:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420025",
    "user": "https://github.com/embray"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@dimpase](#comment:17):
> I think the .dummy magic breaks for `$(MP_LIBRARY)`. To prove this, I did

Sorry, I didn't realize you were being stymied by this.  Yes, to me there was no mystery here, which is in part why I was focused on how best to handle the existing `--with-mp` flag. I should have been more clear about that.



---

archive/issue_comments_420026.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@embray](#comment:16): \n> What I'm less sure about is how exactly to determine the value for `$SAGE_GMP_PREFIX`.  Macros like `AC_SEARCH_LIBS` only tests that linking with `-l<libname>` works; it has no clue about how the system searches library paths in that case.  I think the best way to handle this is not unlike the code I wrote in #27230, unfortunately.\n\nAnother possibility of course is to just leave it empty and not pass `--with-gmp` flags at all, in this case they will be forced to just pick up whatever GMP they find on the default paths as well, which *usually* will be the same one.",
    "created_at": "2019-02-08T12:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420026",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@embray](#comment:16): 
> What I'm less sure about is how exactly to determine the value for `$SAGE_GMP_PREFIX`.  Macros like `AC_SEARCH_LIBS` only tests that linking with `-l<libname>` works; it has no clue about how the system searches library paths in that case.  I think the best way to handle this is not unlike the code I wrote in #27230, unfortunately.

Another possibility of course is to just leave it empty and not pass `--with-gmp` flags at all, in this case they will be forced to just pick up whatever GMP they find on the default paths as well, which *usually* will be the same one.



---

archive/issue_comments_420027.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nPragmatically, I'd say that`--with-mp=foo` ought to always install `foo` from Sage's source, unless `foo=detect`. This is your first possibility from comment 9.\n(And leaving it out would result in either picking up system's \"GMP\", be it real GMP or MPIR in compatibility mode.)\n\nThis is reasonably flexible. Experts who need special versions of GMP/MPIR may just update Sage's packages and use them, or install them system-wide.\n\nMost of all, it would not need fiddling with recongising \"hidden\" MPIR in a system's  libgmp, something that would otherwise cater for non-existing systems, i.e. pure over-design for nothing and nobody...",
    "created_at": "2019-02-08T13:51:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420027",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">comment:20</div>

Pragmatically, I'd say that`--with-mp=foo` ought to always install `foo` from Sage's source, unless `foo=detect`. This is your first possibility from comment 9.
(And leaving it out would result in either picking up system's "GMP", be it real GMP or MPIR in compatibility mode.)

This is reasonably flexible. Experts who need special versions of GMP/MPIR may just update Sage's packages and use them, or install them system-wide.

Most of all, it would not need fiddling with recongising "hidden" MPIR in a system's  libgmp, something that would otherwise cater for non-existing systems, i.e. pure over-design for nothing and nobody...



---

archive/issue_comments_420028.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@dimpase](#comment:20):\n> Pragmatically, I'd say that`--with-mp=foo` ought to always install `foo` from Sage's source, unless `foo=detect`. This is your first possibility from comment 9.\n> (And leaving it out would result in either picking up system's \"GMP\", be it real GMP or MPIR in compatibility mode.)\n> \n> This is reasonably flexible. Experts who need special versions of GMP/MPIR may just update Sage's packages and use them, or install them system-wide.\n> \n> Most of all, it would not need fiddling with recongising \"hidden\" MPIR in a system's  libgmp, something that would otherwise cater for non-existing systems, i.e. pure over-design for nothing and nobody...\n\nOkay, let's go with that then, for now.  That would be good because it is also the most \"backwards compatible\" with the current behavior.\n\nAs for the `--with-gmp=` question, I keep thinking about it and I think this is the best thing to do:\n\n* in the gmp/spkg-configure.m4 add support for our own `--with-gmp=` flag.  Most people\n  won't need this, but it does provide some desirable flexibility.  This would just set the\n  GMP prefix explicitly (and be saved to `$SAGE_GMP_PREFIX`) to be passed on to other\n  packages that look for a GMP\n\n* when passed an explicit `--with-gmp` flag that should also imply that we *want* to use\n  the system package, and if it can't be found this should be an error\n\n* if a usable system GMP is detected (with or without `--with-gmp`) just go with it; if\n  `--with-gmp` was not specified then we set `$SAGE_GMP_PREFIX` to blank, and in that\n  case explicitly do *not* pass `--with-gmp=` to other packages: let them just pick up\n  the system GMP (note: I checked, and passing `--with-gmp=` with a blank argument is buggy\n  in at least a few of these packages, so better not to use the flag at all in that case)\n\n* if a usable system GMP is not detected we just build the SPKG as normal, with whatever\n  option was selected by `--with-mp`, with MPIR by default and set `SAGE_GMP_PREFIX=$SAGE_LOCAL`.",
    "created_at": "2019-02-08T14:08:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420028",
    "user": "https://github.com/embray"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@dimpase](#comment:20):
> Pragmatically, I'd say that`--with-mp=foo` ought to always install `foo` from Sage's source, unless `foo=detect`. This is your first possibility from comment 9.
> (And leaving it out would result in either picking up system's "GMP", be it real GMP or MPIR in compatibility mode.)
> 
> This is reasonably flexible. Experts who need special versions of GMP/MPIR may just update Sage's packages and use them, or install them system-wide.
> 
> Most of all, it would not need fiddling with recongising "hidden" MPIR in a system's  libgmp, something that would otherwise cater for non-existing systems, i.e. pure over-design for nothing and nobody...

Okay, let's go with that then, for now.  That would be good because it is also the most "backwards compatible" with the current behavior.

As for the `--with-gmp=` question, I keep thinking about it and I think this is the best thing to do:

* in the gmp/spkg-configure.m4 add support for our own `--with-gmp=` flag.  Most people
  won't need this, but it does provide some desirable flexibility.  This would just set the
  GMP prefix explicitly (and be saved to `$SAGE_GMP_PREFIX`) to be passed on to other
  packages that look for a GMP

* when passed an explicit `--with-gmp` flag that should also imply that we *want* to use
  the system package, and if it can't be found this should be an error

* if a usable system GMP is detected (with or without `--with-gmp`) just go with it; if
  `--with-gmp` was not specified then we set `$SAGE_GMP_PREFIX` to blank, and in that
  case explicitly do *not* pass `--with-gmp=` to other packages: let them just pick up
  the system GMP (note: I checked, and passing `--with-gmp=` with a blank argument is buggy
  in at least a few of these packages, so better not to use the flag at all in that case)

* if a usable system GMP is not detected we just build the SPKG as normal, with whatever
  option was selected by `--with-mp`, with MPIR by default and set `SAGE_GMP_PREFIX=$SAGE_LOCAL`.



---

archive/issue_comments_420029.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI'm working on a prototype for the above scheme.  Which is not to say I'm convinced is the best way, but it seems worth a try.",
    "created_at": "2019-02-08T14:26:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420029",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">comment:22</div>

I'm working on a prototype for the above scheme.  Which is not to say I'm convinced is the best way, but it seems worth a try.



---

archive/issue_comments_420030.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nOK, great. By the way, on Gentoo, with these extra spkg-configures in Attachment (all of them used to actually use system's libraries) , I let `make ptests` run, and all the tests passed.\n\nI actually had one more, for gf2x\n\n```\nSAGE_SPKG_CONFIGURE([gf2x], [\n    AC_CHECK_HEADER(gf2x.h, [], [sage_spkg_install_gf2x=yes])\ndnl gf2x_mul_r appeared in version 1.2 of GF2X \n    AC_SEARCH_LIBS([gf2x_mul_r], [gf2x], [break], [sage_spkg_install_gf2x=yes])\n])\n```\nI guess it should go on another ticket.",
    "created_at": "2019-02-08T15:01:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420030",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:23" align="right">comment:23</div>

OK, great. By the way, on Gentoo, with these extra spkg-configures in Attachment (all of them used to actually use system's libraries) , I let `make ptests` run, and all the tests passed.

I actually had one more, for gf2x

```
SAGE_SPKG_CONFIGURE([gf2x], [
    AC_CHECK_HEADER(gf2x.h, [], [sage_spkg_install_gf2x=yes])
dnl gf2x_mul_r appeared in version 1.2 of GF2X 
    AC_SEARCH_LIBS([gf2x_mul_r], [gf2x], [break], [sage_spkg_install_gf2x=yes])
])
```
I guess it should go on another ticket.



---

archive/issue_comments_420031.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@embray](#comment:21):\n> * in the gmp/spkg-configure.m4 add support for our own `--with-gmp=` flag.  Most people\n>   won't need this, but it does provide some desirable flexibility.  This would just set the\n>   GMP prefix explicitly (and be saved to `$SAGE_GMP_PREFIX`) to be passed on to other\n>   packages that look for a GMP\n> \n> * when passed an explicit `--with-gmp` flag that should also imply that we *want* to use\n>   the system package, and if it can't be found this should be an error\n\nIt turns out doing this right is likely more trouble than it's worth, so I'm going to say \"YAGNI\" to this, until and unless proven otherwise. It turns out even most of the packages that have a `--with-gmp` flag in their own configures don't really implement it well.  As long as Sage is using the system GMP, this flag shouldn't really be needed anyways for compiling other packages against the system GMP.  So better to just leave it off entirely, at least when using the system package.",
    "created_at": "2019-02-11T15:12:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420031",
    "user": "https://github.com/embray"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@embray](#comment:21):
> * in the gmp/spkg-configure.m4 add support for our own `--with-gmp=` flag.  Most people
>   won't need this, but it does provide some desirable flexibility.  This would just set the
>   GMP prefix explicitly (and be saved to `$SAGE_GMP_PREFIX`) to be passed on to other
>   packages that look for a GMP
> 
> * when passed an explicit `--with-gmp` flag that should also imply that we *want* to use
>   the system package, and if it can't be found this should be an error

It turns out doing this right is likely more trouble than it's worth, so I'm going to say "YAGNI" to this, until and unless proven otherwise. It turns out even most of the packages that have a `--with-gmp` flag in their own configures don't really implement it well.  As long as Sage is using the system GMP, this flag shouldn't really be needed anyways for compiling other packages against the system GMP.  So better to just leave it off entirely, at least when using the system package.



---

archive/issue_comments_420032.json:
```json
{
    "body": "Dependencies: **#27254**",
    "created_at": "2019-02-11T15:45:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420032",
    "user": "https://github.com/dimpase"
}
```

Dependencies: **#27254**



---

archive/issue_comments_420033.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI updated a bunch of spkg-installs to not use `--with-gmp` when using the system package.  The `./configure` happily detected my system's GMP 6.1.2 (the most recent).  Doing a full rebuild and `make ptestlong` against that to test.",
    "created_at": "2019-02-11T16:23:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420033",
    "user": "https://github.com/embray"
}
```

<div id="comment:26" align="right">comment:26</div>

I updated a bunch of spkg-installs to not use `--with-gmp` when using the system package.  The `./configure` happily detected my system's GMP 6.1.2 (the most recent).  Doing a full rebuild and `make ptestlong` against that to test.



---

archive/issue_comments_420034.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nGetting weird segfaults and other errors from cypari when building with my system's GMP.  Not sure if there's any relation though, something else could be wrong, at this point, with this build...",
    "created_at": "2019-02-11T20:19:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420034",
    "user": "https://github.com/embray"
}
```

<div id="comment:27" align="right">comment:27</div>

Getting weird segfaults and other errors from cypari when building with my system's GMP.  Not sure if there's any relation though, something else could be wrong, at this point, with this build...



---

archive/issue_comments_420035.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nOkay, I don't know where I got the idea that this system has GMP 6.1.2.  I appear to have gotten mixed up between machines.  This machine has GMP 5.1.3.   Nevertheless that does seem to be a problem because this `spkg-configure.m4` allowed me to use it.  But apparently PARI does not support this old a version.\n\nI get\n\n```\n[pari-2.11.1.p0] linux-x86_64-gmp30818: error while loading shared libraries: libgmp.so.23: cannot open shared object file: No such file or directory\n[pari-2.11.1.p0] ### Your version of GMP is too old for PARI. Please upgrade\n```\n\nI don't know why it's looking for some \"libgmp.so.23\" though.  I don't have anything like that on my system.  So this *could* be a bug in the PARI build system.  I will see if I can convince PARI to use this GMP and if it will work.  Nevertheless it's not encouraging.",
    "created_at": "2019-02-11T20:51:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420035",
    "user": "https://github.com/embray"
}
```

<div id="comment:28" align="right">comment:28</div>

Okay, I don't know where I got the idea that this system has GMP 6.1.2.  I appear to have gotten mixed up between machines.  This machine has GMP 5.1.3.   Nevertheless that does seem to be a problem because this `spkg-configure.m4` allowed me to use it.  But apparently PARI does not support this old a version.

I get

```
[pari-2.11.1.p0] linux-x86_64-gmp30818: error while loading shared libraries: libgmp.so.23: cannot open shared object file: No such file or directory
[pari-2.11.1.p0] ### Your version of GMP is too old for PARI. Please upgrade
```

I don't know why it's looking for some "libgmp.so.23" though.  I don't have anything like that on my system.  So this *could* be a bug in the PARI build system.  I will see if I can convince PARI to use this GMP and if it will work.  Nevertheless it's not encouraging.



---

archive/issue_comments_420036.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nhere is what Singular does: https://github.com/Singular/LELA/blob/master/macros/gmp-check.m4",
    "created_at": "2019-02-11T21:28:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420036",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:29" align="right">comment:29</div>

here is what Singular does: https://github.com/Singular/LELA/blob/master/macros/gmp-check.m4



---

archive/issue_comments_420037.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nOkay, I think pari does not *actually* need this version of GMP (which is not to say some other package might not need it, but I want to see how far I can get).\n\nWhat was messing me up was that I did not prevent mpir from being installed in this build, so it was partially picking up the MPIR in `$SAGE_LOCAL` but in an incomplete and broken manner.  After applying part of my fix to prevent MPIR from being installed, PARI built okay.",
    "created_at": "2019-02-11T22:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420037",
    "user": "https://github.com/embray"
}
```

<div id="comment:30" align="right">comment:30</div>

Okay, I think pari does not *actually* need this version of GMP (which is not to say some other package might not need it, but I want to see how far I can get).

What was messing me up was that I did not prevent mpir from being installed in this build, so it was partially picking up the MPIR in `$SAGE_LOCAL` but in an incomplete and broken manner.  After applying part of my fix to prevent MPIR from being installed, PARI built okay.



---

archive/issue_comments_420038.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nFinal update on this before I really go to sleep: pynac uses `mpq_cmp_z` which is definitely only available as of GMP 6.1.0.  pynac could probably manage to not use it if it's not available, but I don't think it's worth bothering with.  I'm perfectly happy to just require GMP>=6.1.0 in that case, which is still rather old at this point.\n\nThe symbol to check for in this case is `__gmpq_cmp_z`.  I confirmed in does not exist in GMP 6.0.x or below, and has the benefit of being a function that is actually used in one of the dependents of GMP.",
    "created_at": "2019-02-11T23:25:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420038",
    "user": "https://github.com/embray"
}
```

<div id="comment:31" align="right">comment:31</div>

Final update on this before I really go to sleep: pynac uses `mpq_cmp_z` which is definitely only available as of GMP 6.1.0.  pynac could probably manage to not use it if it's not available, but I don't think it's worth bothering with.  I'm perfectly happy to just require GMP>=6.1.0 in that case, which is still rather old at this point.

The symbol to check for in this case is `__gmpq_cmp_z`.  I confirmed in does not exist in GMP 6.0.x or below, and has the benefit of being a function that is actually used in one of the dependents of GMP.



---

archive/issue_events_375711.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-12T09:15:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "000080",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375711"
}
```



---

archive/issue_comments_420039.json:
```json
{
    "body": "Changed commit from **[`1ed38e1`](https://github.com/sagemath/sagetrac-mirror/commit/1ed38e19baea5feb0d2f5d79e7989a7e80440a21)** to none",
    "created_at": "2019-02-12T10:00:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420039",
    "user": "https://github.com/embray"
}
```

Changed commit from **[`1ed38e1`](https://github.com/sagemath/sagetrac-mirror/commit/1ed38e19baea5feb0d2f5d79e7989a7e80440a21)** to none



---

archive/issue_events_375712.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-12T10:00:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375712"
}
```



---

archive/issue_events_375713.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-12T10:00:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375713"
}
```



---

archive/issue_comments_420040.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nHere's my attempt at this:\n\nMoved all the `--with-mp` logic into the `spkg-configure.m4` for MPIR so that it is local to where it is used. \n\nAlso, most of the logic is in mpir/spkg-configure.m4 rather than gmp/spkg-configure.m4 just because MPIR is the implementation we install by default if it can't be used from the sytem.  It could go either way, but this way seemed a bit more logical for that reason.\n\nThen, the gmp/spkg-configure.m4 is mostly just a stub.\n\nFinally, uses the symbol `__gmpq_cmp_z` to check for GMP>=6.1.0 (or whatever the equivalent MPIR is).\n\nSo to summarize, by default `--with-mp=system` and it tries to use the libgmp from the system.  If that check fails it falls back to installing the mpir SPKG.  If `--with-mp=mpir` it just doesn't even check the system and installs the mpir SPKG; similarly for `--with-mp=gmp`.",
    "created_at": "2019-02-12T10:00:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420040",
    "user": "https://github.com/embray"
}
```

<div id="comment:33" align="right">comment:33</div>

Here's my attempt at this:

Moved all the `--with-mp` logic into the `spkg-configure.m4` for MPIR so that it is local to where it is used. 

Also, most of the logic is in mpir/spkg-configure.m4 rather than gmp/spkg-configure.m4 just because MPIR is the implementation we install by default if it can't be used from the sytem.  It could go either way, but this way seemed a bit more logical for that reason.

Then, the gmp/spkg-configure.m4 is mostly just a stub.

Finally, uses the symbol `__gmpq_cmp_z` to check for GMP>=6.1.0 (or whatever the equivalent MPIR is).

So to summarize, by default `--with-mp=system` and it tries to use the libgmp from the system.  If that check fails it falls back to installing the mpir SPKG.  If `--with-mp=mpir` it just doesn't even check the system and installs the mpir SPKG; similarly for `--with-mp=gmp`.



---

archive/issue_comments_420041.json:
```json
{
    "body": "Changed branch from **[u/dimpase/packages/gmp_m4](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/gmp_m4)** to **[u/public/packages/gmp_m4](https://github.com/sagemath/sagetrac-mirror/tree/u/public/packages/gmp_m4)**",
    "created_at": "2019-02-12T10:00:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420041",
    "user": "https://github.com/embray"
}
```

Changed branch from **[u/dimpase/packages/gmp_m4](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/gmp_m4)** to **[u/public/packages/gmp_m4](https://github.com/sagemath/sagetrac-mirror/tree/u/public/packages/gmp_m4)**



---

archive/issue_comments_420042.json:
```json
{
    "body": "Changed branch from **[u/public/packages/gmp_m4](https://github.com/sagemath/sagetrac-mirror/tree/u/public/packages/gmp_m4)** to **[public/packages/gmp_m4](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/gmp_m4)**",
    "created_at": "2019-02-12T10:00:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420042",
    "user": "https://github.com/embray"
}
```

Changed branch from **[u/public/packages/gmp_m4](https://github.com/sagemath/sagetrac-mirror/tree/u/public/packages/gmp_m4)** to **[public/packages/gmp_m4](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/gmp_m4)**



---

archive/issue_comments_420043.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nOops, typo on branch name.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ed38e19baea5feb0d2f5d79e7989a7e80440a21\"><code>1ed38e1</code></a></td><td><code>spkg-configure for GMP</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd39b8453c2eda2d4b9bc83f0bc146a42743c14a\"><code>dd39b84</code></a></td><td><code>Move all the --with-mp logic into the spkg-configure.m4 for MPIR so that it</code></td></tr></table>\n",
    "created_at": "2019-02-12T10:00:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420043",
    "user": "https://github.com/embray"
}
```

<div id="comment:34" align="right">comment:34</div>

Oops, typo on branch name.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ed38e19baea5feb0d2f5d79e7989a7e80440a21"><code>1ed38e1</code></a></td><td><code>spkg-configure for GMP</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd39b8453c2eda2d4b9bc83f0bc146a42743c14a"><code>dd39b84</code></a></td><td><code>Move all the --with-mp logic into the spkg-configure.m4 for MPIR so that it</code></td></tr></table>




---

archive/issue_comments_420044.json:
```json
{
    "body": "Commit: **[`dd39b84`](https://github.com/sagemath/sagetrac-mirror/commit/dd39b8453c2eda2d4b9bc83f0bc146a42743c14a)**",
    "created_at": "2019-02-12T10:00:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420044",
    "user": "https://github.com/embray"
}
```

Commit: **[`dd39b84`](https://github.com/sagemath/sagetrac-mirror/commit/dd39b8453c2eda2d4b9bc83f0bc146a42743c14a)**



---

archive/issue_events_375714.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-12T10:04:16Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "title_is": "spkg-configure.m4 for gmp and mpir",
    "title_was": "spkg-configure.m4 for gmp",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375714"
}
```



---

archive/issue_comments_420045.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI accidentally left off a bunch of changes related to the `--with-gmp` flags in other packages.",
    "created_at": "2019-02-12T10:23:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420045",
    "user": "https://github.com/embray"
}
```

<div id="comment:36" align="right">comment:36</div>

I accidentally left off a bunch of changes related to the `--with-gmp` flags in other packages.



---

archive/issue_events_375715.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-12T10:23:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375715"
}
```



---

archive/issue_events_375716.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-12T10:23:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375716"
}
```



---

archive/issue_comments_420046.json:
```json
{
    "body": "Changed commit from **[`dd39b84`](https://github.com/sagemath/sagetrac-mirror/commit/dd39b8453c2eda2d4b9bc83f0bc146a42743c14a)** to **[`27b4692`](https://github.com/sagemath/sagetrac-mirror/commit/27b469252871005abd57fe3bc9d8bbf4e451a7f1)**",
    "created_at": "2019-02-12T10:28:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420046",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dd39b84`](https://github.com/sagemath/sagetrac-mirror/commit/dd39b8453c2eda2d4b9bc83f0bc146a42743c14a)** to **[`27b4692`](https://github.com/sagemath/sagetrac-mirror/commit/27b469252871005abd57fe3bc9d8bbf4e451a7f1)**



---

archive/issue_comments_420047.json:
```json
{
    "body": "<div id=\"comment:37\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/356621a31567d2d1f5fe5bcf6eacbd31f979ace0\"><code>356621a</code></a></td><td><code>correctly setup sagelib dependencies-trac #27254</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/da291d87ddadbeba84d40d4effc89f60c5374e08\"><code>da291d8</code></a></td><td><code>spkg-configure for GMP</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7698ad35ffbf07db2cc56e7b99ae330adc18c67\"><code>f7698ad</code></a></td><td><code>Move all the --with-mp logic into the spkg-configure.m4 for MPIR so that it</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27b469252871005abd57fe3bc9d8bbf4e451a7f1\"><code>27b4692</code></a></td><td><code>Replace various --with-gmp=$SAGE_LOCAL flags in spkg-installs with a</code></td></tr></table>\n",
    "created_at": "2019-02-12T10:28:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420047",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/356621a31567d2d1f5fe5bcf6eacbd31f979ace0"><code>356621a</code></a></td><td><code>correctly setup sagelib dependencies-trac #27254</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/da291d87ddadbeba84d40d4effc89f60c5374e08"><code>da291d8</code></a></td><td><code>spkg-configure for GMP</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7698ad35ffbf07db2cc56e7b99ae330adc18c67"><code>f7698ad</code></a></td><td><code>Move all the --with-mp logic into the spkg-configure.m4 for MPIR so that it</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27b469252871005abd57fe3bc9d8bbf4e451a7f1"><code>27b4692</code></a></td><td><code>Replace various --with-gmp=$SAGE_LOCAL flags in spkg-installs with a</code></td></tr></table>




---

archive/issue_comments_420048.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nAlso rebased on #27254.",
    "created_at": "2019-02-12T10:29:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420048",
    "user": "https://github.com/embray"
}
```

<div id="comment:38" align="right">comment:38</div>

Also rebased on #27254.



---

archive/issue_events_375717.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-12T10:29:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375717"
}
```



---

archive/issue_events_375718.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-12T10:29:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375718"
}
```



---

archive/issue_events_375719.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-12T11:09:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375719"
}
```



---

archive/issue_events_375720.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-12T11:09:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375720"
}
```



---

archive/issue_comments_420049.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nI just realized there is another problem with this, which didn't appear until I rebased.  Now if `SAGE_MP_LIBRARY=system` things break because there is no target \"system\".",
    "created_at": "2019-02-12T11:09:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420049",
    "user": "https://github.com/embray"
}
```

<div id="comment:39" align="right">comment:39</div>

I just realized there is another problem with this, which didn't appear until I rebased.  Now if `SAGE_MP_LIBRARY=system` things break because there is no target "system".



---

archive/issue_comments_420050.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nthe ECM bit looks fishy:\n\n```\n--- a/build/pkgs/ecm/spkg-install\n+++ b/build/pkgs/ecm/spkg-install\n@@ -210,7 +210,10 @@ else\n fi\n echo \"  --prefix=\\\"$SAGE_LOCAL\\\"\"\n echo \"  --libdir=\\\"$SAGE_LOCAL/lib\\\"\"\n-echo \"  --with-gmp=\\\"$SAGE_LOCAL\\\"\"\n+if [ -n \"$SAGE_GMP_CONFIGURE\" ]; then\n+    echo \"  --with-gmp=\\\"$SAGE_LOCAL\\\"\"\n+fi\n+\n```",
    "created_at": "2019-02-12T11:25:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420050",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:40" align="right">comment:40</div>

the ECM bit looks fishy:

```
--- a/build/pkgs/ecm/spkg-install
+++ b/build/pkgs/ecm/spkg-install
@@ -210,7 +210,10 @@ else
 fi
 echo "  --prefix=\"$SAGE_LOCAL\""
 echo "  --libdir=\"$SAGE_LOCAL/lib\""
-echo "  --with-gmp=\"$SAGE_LOCAL\""
+if [ -n "$SAGE_GMP_CONFIGURE" ]; then
+    echo "  --with-gmp=\"$SAGE_LOCAL\""
+fi
+
```



---

archive/issue_comments_420051.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nIt is a typo.  It should be `$SAGE_CONFIGURE_GMP`.  It's not really important though, I was just retaining the existing behavior in that code.",
    "created_at": "2019-02-12T11:27:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420051",
    "user": "https://github.com/embray"
}
```

<div id="comment:41" align="right">comment:41</div>

It is a typo.  It should be `$SAGE_CONFIGURE_GMP`.  It's not really important though, I was just retaining the existing behavior in that code.



---

archive/issue_comments_420052.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/566bd21f96880e8c9c88fa87eb2858231f30c443\"><code>566bd21</code></a></td><td><code>Reworked this a bit more</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a4ab4688e74f8166fec19643b16eff5f3b844fdb\"><code>a4ab468</code></a></td><td><code>fix typo</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b979d7b8d93ce6da2967317766735de7a7a0c6a4\"><code>b979d7b</code></a></td><td><code>added a bit more explanation</code></td></tr></table>\n",
    "created_at": "2019-02-12T13:50:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420052",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/566bd21f96880e8c9c88fa87eb2858231f30c443"><code>566bd21</code></a></td><td><code>Reworked this a bit more</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a4ab4688e74f8166fec19643b16eff5f3b844fdb"><code>a4ab468</code></a></td><td><code>fix typo</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b979d7b8d93ce6da2967317766735de7a7a0c6a4"><code>b979d7b</code></a></td><td><code>added a bit more explanation</code></td></tr></table>




---

archive/issue_comments_420053.json:
```json
{
    "body": "Changed commit from **[`27b4692`](https://github.com/sagemath/sagetrac-mirror/commit/27b469252871005abd57fe3bc9d8bbf4e451a7f1)** to **[`b979d7b`](https://github.com/sagemath/sagetrac-mirror/commit/b979d7b8d93ce6da2967317766735de7a7a0c6a4)**",
    "created_at": "2019-02-12T13:50:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420053",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`27b4692`](https://github.com/sagemath/sagetrac-mirror/commit/27b469252871005abd57fe3bc9d8bbf4e451a7f1)** to **[`b979d7b`](https://github.com/sagemath/sagetrac-mirror/commit/b979d7b8d93ce6da2967317766735de7a7a0c6a4)**



---

archive/issue_comments_420054.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nI think this is fixed up now, though the commits should be squashed before setting final positive_review.",
    "created_at": "2019-02-12T13:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420054",
    "user": "https://github.com/embray"
}
```

<div id="comment:43" align="right">comment:43</div>

I think this is fixed up now, though the commits should be squashed before setting final positive_review.



---

archive/issue_events_375721.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-12T13:51:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375721"
}
```



---

archive/issue_events_375722.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-12T13:51:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375722"
}
```



---

archive/issue_comments_420055.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nI see no chaining in mpir/mpfr macros - if I intentionally break mpir recognition I still get mpfr not being installed, but picked up from the system...\n---if I just run ./configire without parameters.\n\n(I don't know whether this breaks builds or not, but I guess we would like to see in such a case, if mpfr is not available, mpfr being built as well)",
    "created_at": "2019-02-12T21:13:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420055",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:44" align="right">comment:44</div>

I see no chaining in mpir/mpfr macros - if I intentionally break mpir recognition I still get mpfr not being installed, but picked up from the system...
---if I just run ./configire without parameters.

(I don't know whether this breaks builds or not, but I guess we would like to see in such a case, if mpfr is not available, mpfr being built as well)



---

archive/issue_comments_420056.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nWith this branch, I've run into a problem with IML package, see #27272",
    "created_at": "2019-02-13T14:07:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420056",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:45" align="right">comment:45</div>

With this branch, I've run into a problem with IML package, see #27272



---

archive/issue_comments_420057.json:
```json
{
    "body": "Changed dependencies from **#27254** to **#27254, #27272**",
    "created_at": "2019-02-13T14:07:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420057",
    "user": "https://github.com/dimpase"
}
```

Changed dependencies from **#27254** to **#27254, #27272**



---

archive/issue_comments_420058.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@dimpase](#comment:45):\n> With this branch, I've run into a problem with IML package, see #27272\n\nthis is platform-specific - e.g. on Fedora 26 I don't get this problem.",
    "created_at": "2019-02-13T16:42:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420058",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@dimpase](#comment:45):
> With this branch, I've run into a problem with IML package, see #27272

this is platform-specific - e.g. on Fedora 26 I don't get this problem.



---

archive/issue_comments_420059.json:
```json
{
    "body": "<div id=\"comment:47\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e48b301165b7756b203e5a2935fb91375b1da7b\"><code>1e48b30</code></a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr></table>\n",
    "created_at": "2019-02-14T14:51:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420059",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:47"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e48b301165b7756b203e5a2935fb91375b1da7b"><code>1e48b30</code></a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr></table>




---

archive/issue_comments_420060.json:
```json
{
    "body": "Changed commit from **[`b979d7b`](https://github.com/sagemath/sagetrac-mirror/commit/b979d7b8d93ce6da2967317766735de7a7a0c6a4)** to **[`1e48b30`](https://github.com/sagemath/sagetrac-mirror/commit/1e48b301165b7756b203e5a2935fb91375b1da7b)**",
    "created_at": "2019-02-14T14:51:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420060",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b979d7b`](https://github.com/sagemath/sagetrac-mirror/commit/b979d7b8d93ce6da2967317766735de7a7a0c6a4)** to **[`1e48b30`](https://github.com/sagemath/sagetrac-mirror/commit/1e48b301165b7756b203e5a2935fb91375b1da7b)**



---

archive/issue_comments_420061.json:
```json
{
    "body": "Changed author from **Dima Pasechnik** to **Erik Bray, Dima Pasechnik**",
    "created_at": "2019-02-14T15:41:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420061",
    "user": "https://github.com/dimpase"
}
```

Changed author from **Dima Pasechnik** to **Erik Bray, Dima Pasechnik**



---

archive/issue_events_375723.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-14T15:41:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375723"
}
```



---

archive/issue_events_375724.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-14T15:41:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375724"
}
```



---

archive/issue_comments_420062.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2019-02-14T15:41:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420062",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_420063.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nThere are some sage dependencies using `libgmpxx` and if `gmpxx` was compiled with a different C++ standard library, you'll get link failures. It'll be good check for this here.",
    "created_at": "2019-02-16T09:57:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420063",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:49" align="right">comment:49</div>

There are some sage dependencies using `libgmpxx` and if `gmpxx` was compiled with a different C++ standard library, you'll get link failures. It'll be good check for this here.



---

archive/issue_comments_420064.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nHere's an example file you can use, https://github.com/symengine/symengine/blob/master/cmake/checkgmpxx.cpp. This check fails when gmpxx is compiled using g++ and the dependent library is compiled using clang++ and vice-versa on OSX.",
    "created_at": "2019-02-16T10:01:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420064",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:50" align="right">comment:50</div>

Here's an example file you can use, https://github.com/symengine/symengine/blob/master/cmake/checkgmpxx.cpp. This check fails when gmpxx is compiled using g++ and the dependent library is compiled using clang++ and vice-versa on OSX.



---

archive/issue_comments_420065.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@isuruf](#comment:50):\n> Here's an example file you can use, https://github.com/symengine/symengine/blob/master/cmake/checkgmpxx.cpp. This check fails when gmpxx is compiled using g++ and the dependent library is compiled using clang++ and vice-versa on OSX.\n\nI suppose that there is no compatibility even across different versions of g++, and perhaps not even when the same compiler is used with different `-std=`.",
    "created_at": "2019-02-17T09:04:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420065",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@isuruf](#comment:50):
> Here's an example file you can use, https://github.com/symengine/symengine/blob/master/cmake/checkgmpxx.cpp. This check fails when gmpxx is compiled using g++ and the dependent library is compiled using clang++ and vice-versa on OSX.

I suppose that there is no compatibility even across different versions of g++, and perhaps not even when the same compiler is used with different `-std=`.



---

archive/issue_comments_420066.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nhttps://stackoverflow.com/questions/46746878/is-it-safe-to-link-c17-c14-and-c11-objects should answer your general question. For gmpxx though, I don't think it matters a lot.",
    "created_at": "2019-02-17T21:12:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420066",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:52" align="right">comment:52</div>

https://stackoverflow.com/questions/46746878/is-it-safe-to-link-c17-c14-and-c11-objects should answer your general question. For gmpxx though, I don't think it matters a lot.



---

archive/issue_comments_420067.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nReplying to [@isuruf](#comment:52):\n> https://stackoverflow.com/questions/46746878/is-it-safe-to-link-c17-c14-and-c11-objects should answer your general question. For gmpxx though, I don't think it matters a lot.\n\nThanks. It seems that this link basically says that as far as linking issues are concerned, you might be unable to chase down all the corner cases if one used different versions of g++ (which is unsurprising to me...).",
    "created_at": "2019-02-17T21:34:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420067",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:53" align="right">comment:53</div>

Replying to [@isuruf](#comment:52):
> https://stackoverflow.com/questions/46746878/is-it-safe-to-link-c17-c14-and-c11-objects should answer your general question. For gmpxx though, I don't think it matters a lot.

Thanks. It seems that this link basically says that as far as linking issues are concerned, you might be unable to chase down all the corner cases if one used different versions of g++ (which is unsurprising to me...).



---

archive/issue_comments_420068.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@sagetrac-git](#comment:47):\n> Branch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e48b301165b7756b203e5a2935fb91375b1da7b\"><code>1e48b30</code></a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr></table>\n\nsetting of `SAGE_GMP_PREFIX` does not quite work there, it's always `''`.",
    "created_at": "2019-02-18T08:55:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420068",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@sagetrac-git](#comment:47):
> Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e48b301165b7756b203e5a2935fb91375b1da7b"><code>1e48b30</code></a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr></table>

setting of `SAGE_GMP_PREFIX` does not quite work there, it's always `''`.



---

archive/issue_events_375725.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-18T08:55:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375725"
}
```



---

archive/issue_events_375726.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-18T08:55:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375726"
}
```



---

archive/issue_comments_420069.json:
```json
{
    "body": "Changed commit from **[`1e48b30`](https://github.com/sagemath/sagetrac-mirror/commit/1e48b301165b7756b203e5a2935fb91375b1da7b)** to **[`50c3482`](https://github.com/sagemath/sagetrac-mirror/commit/50c3482dd8700d4b62d229edf8beb3edc6fc7f5e)**",
    "created_at": "2019-02-18T09:27:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420069",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1e48b30`](https://github.com/sagemath/sagetrac-mirror/commit/1e48b301165b7756b203e5a2935fb91375b1da7b)** to **[`50c3482`](https://github.com/sagemath/sagetrac-mirror/commit/50c3482dd8700d4b62d229edf8beb3edc6fc7f5e)**



---

archive/issue_comments_420070.json:
```json
{
    "body": "<div id=\"comment:55\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50c3482dd8700d4b62d229edf8beb3edc6fc7f5e\"><code>50c3482</code></a></td><td><code>remove iffy if, do setting SAGE_GMP_PREFIX in cases</code></td></tr></table>\n",
    "created_at": "2019-02-18T09:27:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420070",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:55"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50c3482dd8700d4b62d229edf8beb3edc6fc7f5e"><code>50c3482</code></a></td><td><code>remove iffy if, do setting SAGE_GMP_PREFIX in cases</code></td></tr></table>




---

archive/issue_comments_420071.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nReplying to [@sagetrac-git](#comment:55):\n> Branch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50c3482dd8700d4b62d229edf8beb3edc6fc7f5e\"><code>50c3482</code></a></td><td><code>remove iffy if, do setting SAGE_GMP_PREFIX in cases</code></td></tr></table>\n\nThis is still wrong because in that `case` statement, in the `system)` case you can still wind up installing the Sage SPKG if any of the checks fail (hence setting `sage_spkg_install_mpir=yes`).  That's why there is a separate `if/then` clause later.\n\nI think the problem here is is with quoting.  You can see it in the configure log when running the previous version (and also fixing the `SAGE_MP_LIBRARY = mpir` line):\n\n```\n./configure: line 8899: test: too many arguments\n```\n\nI believe it's possible for `$sage_spkg_install_gmp` to not be defined here, so we need the `x` quoting.",
    "created_at": "2019-02-18T14:17:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420071",
    "user": "https://github.com/embray"
}
```

<div id="comment:56" align="right">comment:56</div>

Replying to [@sagetrac-git](#comment:55):
> Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50c3482dd8700d4b62d229edf8beb3edc6fc7f5e"><code>50c3482</code></a></td><td><code>remove iffy if, do setting SAGE_GMP_PREFIX in cases</code></td></tr></table>

This is still wrong because in that `case` statement, in the `system)` case you can still wind up installing the Sage SPKG if any of the checks fail (hence setting `sage_spkg_install_mpir=yes`).  That's why there is a separate `if/then` clause later.

I think the problem here is is with quoting.  You can see it in the configure log when running the previous version (and also fixing the `SAGE_MP_LIBRARY = mpir` line):

```
./configure: line 8899: test: too many arguments
```

I believe it's possible for `$sage_spkg_install_gmp` to not be defined here, so we need the `x` quoting.



---

archive/issue_comments_420072.json:
```json
{
    "body": "Changed commit from **[`50c3482`](https://github.com/sagemath/sagetrac-mirror/commit/50c3482dd8700d4b62d229edf8beb3edc6fc7f5e)** to **[`b364988`](https://github.com/sagemath/sagetrac-mirror/commit/b364988a362ba2c4872a002b0477858b9cac073d)**",
    "created_at": "2019-02-18T14:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420072",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`50c3482`](https://github.com/sagemath/sagetrac-mirror/commit/50c3482dd8700d4b62d229edf8beb3edc6fc7f5e)** to **[`b364988`](https://github.com/sagemath/sagetrac-mirror/commit/b364988a362ba2c4872a002b0477858b9cac073d)**



---

archive/issue_comments_420073.json:
```json
{
    "body": "<div id=\"comment:57\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b364988a362ba2c4872a002b0477858b9cac073d\"><code>b364988</code></a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr></table>\n",
    "created_at": "2019-02-18T14:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420073",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:57"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b364988a362ba2c4872a002b0477858b9cac073d"><code>b364988</code></a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr></table>




---

archive/issue_comments_420074.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nThis should fix it I think.  I also fixed the `AC_MSG_RESULT` calls to report the correct result when `--with-mp=system` but the system lib cannot be used (and hence we fall back on installing the MPIR SPKG).\n\nI think what might be continuing to confuse you is that the case for `--with-mp=system` can still result in the MPIR SPKG being selected instead.",
    "created_at": "2019-02-18T14:22:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420074",
    "user": "https://github.com/embray"
}
```

<div id="comment:58" align="right">comment:58</div>

This should fix it I think.  I also fixed the `AC_MSG_RESULT` calls to report the correct result when `--with-mp=system` but the system lib cannot be used (and hence we fall back on installing the MPIR SPKG).

I think what might be continuing to confuse you is that the case for `--with-mp=system` can still result in the MPIR SPKG being selected instead.



---

archive/issue_comments_420075.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nBuilding a fresh build from this branch on Ubuntu 16.04 I also ran into the same problem Dima was telling me about with iml, reported also at #27272.  I just wanted to confirm that that was the case, so now I can also review that ticket with some intelligence.",
    "created_at": "2019-02-18T17:35:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420075",
    "user": "https://github.com/embray"
}
```

<div id="comment:59" align="right">comment:59</div>

Building a fresh build from this branch on Ubuntu 16.04 I also ran into the same problem Dima was telling me about with iml, reported also at #27272.  I just wanted to confirm that that was the case, so now I can also review that ticket with some intelligence.



---

archive/issue_comments_420076.json:
```json
{
    "body": "Changed commit from **[`b364988`](https://github.com/sagemath/sagetrac-mirror/commit/b364988a362ba2c4872a002b0477858b9cac073d)** to **[`cb6f124`](https://github.com/sagemath/sagetrac-mirror/commit/cb6f12448719f9fec4ec56d24b8e1275a168f09f)**",
    "created_at": "2019-02-19T17:09:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420076",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b364988`](https://github.com/sagemath/sagetrac-mirror/commit/b364988a362ba2c4872a002b0477858b9cac073d)** to **[`cb6f124`](https://github.com/sagemath/sagetrac-mirror/commit/cb6f12448719f9fec4ec56d24b8e1275a168f09f)**



---

archive/issue_comments_420077.json:
```json
{
    "body": "<div id=\"comment:60\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb6f12448719f9fec4ec56d24b8e1275a168f09f\"><code>cb6f124</code></a></td><td><code>add the AX_ABSOLUTE_HEADER macro</code></td></tr></table>\n",
    "created_at": "2019-02-19T17:09:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420077",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:60"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb6f12448719f9fec4ec56d24b8e1275a168f09f"><code>cb6f124</code></a></td><td><code>add the AX_ABSOLUTE_HEADER macro</code></td></tr></table>




---

archive/issue_comments_420078.json:
```json
{
    "body": "<div id=\"comment:61\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cf359b1df8fe4bf2009401888ac2e32600ec1ce0\"><code>cf359b1</code></a></td><td><code>iml in particular is very picky about being given an absolute path to the</code></td></tr></table>\n",
    "created_at": "2019-02-20T15:30:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420078",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:61"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cf359b1df8fe4bf2009401888ac2e32600ec1ce0"><code>cf359b1</code></a></td><td><code>iml in particular is very picky about being given an absolute path to the</code></td></tr></table>




---

archive/issue_comments_420079.json:
```json
{
    "body": "Changed commit from **[`cb6f124`](https://github.com/sagemath/sagetrac-mirror/commit/cb6f12448719f9fec4ec56d24b8e1275a168f09f)** to **[`cf359b1`](https://github.com/sagemath/sagetrac-mirror/commit/cf359b1df8fe4bf2009401888ac2e32600ec1ce0)**",
    "created_at": "2019-02-20T15:30:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420079",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cb6f124`](https://github.com/sagemath/sagetrac-mirror/commit/cb6f12448719f9fec4ec56d24b8e1275a168f09f)** to **[`cf359b1`](https://github.com/sagemath/sagetrac-mirror/commit/cf359b1df8fe4bf2009401888ac2e32600ec1ce0)**



---

archive/issue_comments_420080.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nAdded a fix to the `spkg-install` for iml for it to use the system GMP as specified by `SAGE_GMP_INCLUDE`.  \n\nI am a bit iffy on the hack for setting `SAGE_GMP_LIB` and am open to other ideas.  But I did confirm that this works when using the system GMP on Ubuntu 16.04.  With the above two fixes I was able to build Sage just fine and `make ptestlong` passes.",
    "created_at": "2019-02-20T15:31:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420080",
    "user": "https://github.com/embray"
}
```

<div id="comment:62" align="right">comment:62</div>

Added a fix to the `spkg-install` for iml for it to use the system GMP as specified by `SAGE_GMP_INCLUDE`.  

I am a bit iffy on the hack for setting `SAGE_GMP_LIB` and am open to other ideas.  But I did confirm that this works when using the system GMP on Ubuntu 16.04.  With the above two fixes I was able to build Sage just fine and `make ptestlong` passes.



---

archive/issue_events_375727.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-20T16:10:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375727"
}
```



---

archive/issue_events_375728.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-02-20T16:10:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375728"
}
```



---

archive/issue_comments_420081.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nI think it will make more sense to keep this ticket as a dependency of #27272 (or close #27272) since this is now covering both.",
    "created_at": "2019-02-20T16:11:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420081",
    "user": "https://github.com/embray"
}
```

<div id="comment:64" align="right">comment:64</div>

I think it will make more sense to keep this ticket as a dependency of #27272 (or close #27272) since this is now covering both.



---

archive/issue_comments_420082.json:
```json
{
    "body": "Changed dependencies from **#27254, #27272** to **#27254**",
    "created_at": "2019-02-20T16:11:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420082",
    "user": "https://github.com/embray"
}
```

Changed dependencies from **#27254, #27272** to **#27254**



---

archive/issue_comments_420083.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nIt's good to go, I think.",
    "created_at": "2019-02-22T08:02:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420083",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:65" align="right">comment:65</div>

It's good to go, I think.



---

archive/issue_events_375729.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-22T08:02:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375729"
}
```



---

archive/issue_events_375730.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-22T08:02:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375730"
}
```



---

archive/issue_comments_420084.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nProbably this one needs an updated configure package - unless all the bots nowadays run ./bootstrap (I don't recall the current state of this).",
    "created_at": "2019-02-22T08:15:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420084",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:66" align="right">comment:66</div>

Probably this one needs an updated configure package - unless all the bots nowadays run ./bootstrap (I don't recall the current state of this).



---

archive/issue_comments_420085.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nMerge conflict",
    "created_at": "2019-02-22T23:29:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420085",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:67" align="right">comment:67</div>

Merge conflict



---

archive/issue_events_375731.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-22T23:29:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375731"
}
```



---

archive/issue_events_375732.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-22T23:29:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375732"
}
```



---

archive/issue_comments_420086.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nit's gcc and gfortran spkg's that were touched in the latest beta. Erik, could you rebase these, it's certainly your code there...",
    "created_at": "2019-02-24T11:23:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420086",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:68" align="right">comment:68</div>

it's gcc and gfortran spkg's that were touched in the latest beta. Erik, could you rebase these, it's certainly your code there...



---

archive/issue_comments_420087.json:
```json
{
    "body": "Changed commit from **[`cf359b1`](https://github.com/sagemath/sagetrac-mirror/commit/cf359b1df8fe4bf2009401888ac2e32600ec1ce0)** to **[`101537b`](https://github.com/sagemath/sagetrac-mirror/commit/101537b93c3343a3e7a8554d8e82d8da36be5691)**",
    "created_at": "2019-02-25T20:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420087",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cf359b1`](https://github.com/sagemath/sagetrac-mirror/commit/cf359b1df8fe4bf2009401888ac2e32600ec1ce0)** to **[`101537b`](https://github.com/sagemath/sagetrac-mirror/commit/101537b93c3343a3e7a8554d8e82d8da36be5691)**



---

archive/issue_comments_420088.json:
```json
{
    "body": "<div id=\"comment:69\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c4e42e6e7d76431a8d62a6e2133ce31b3ef43df0\"><code>c4e42e6</code></a></td><td><code>spkg-configure for GMP</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b0700885b53fe3f0b862ca3000df069ceb7e2340\"><code>b070088</code></a></td><td><code>Move all the --with-mp logic into the spkg-configure.m4 for MPIR so that it</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b6eebda8df1ae7fbc86f81c0fcf123989504447\"><code>3b6eebd</code></a></td><td><code>Replace various --with-gmp=$SAGE_LOCAL flags in spkg-installs with a</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b80bf726f85843031b461348944c78a39dae453e\"><code>b80bf72</code></a></td><td><code>Reworked this a bit more</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0ca3f5676d759bc658708f7f0986ceec569f3d51\"><code>0ca3f56</code></a></td><td><code>fix typo</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06798ca585f1187bd8511a1ca530581028aab99e\"><code>06798ca</code></a></td><td><code>added a bit more explanation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b592d77c204865c293ef473abb7a70ecbaf9e17b\"><code>b592d77</code></a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5057680b1ff2829d1ed0558ef4042472c03c63ae\"><code>5057680</code></a></td><td><code>add the AX_ABSOLUTE_HEADER macro</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/101537b93c3343a3e7a8554d8e82d8da36be5691\"><code>101537b</code></a></td><td><code>iml in particular is very picky about being given an absolute path to the</code></td></tr></table>\n",
    "created_at": "2019-02-25T20:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420088",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:69"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c4e42e6e7d76431a8d62a6e2133ce31b3ef43df0"><code>c4e42e6</code></a></td><td><code>spkg-configure for GMP</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b0700885b53fe3f0b862ca3000df069ceb7e2340"><code>b070088</code></a></td><td><code>Move all the --with-mp logic into the spkg-configure.m4 for MPIR so that it</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b6eebda8df1ae7fbc86f81c0fcf123989504447"><code>3b6eebd</code></a></td><td><code>Replace various --with-gmp=$SAGE_LOCAL flags in spkg-installs with a</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b80bf726f85843031b461348944c78a39dae453e"><code>b80bf72</code></a></td><td><code>Reworked this a bit more</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0ca3f5676d759bc658708f7f0986ceec569f3d51"><code>0ca3f56</code></a></td><td><code>fix typo</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06798ca585f1187bd8511a1ca530581028aab99e"><code>06798ca</code></a></td><td><code>added a bit more explanation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b592d77c204865c293ef473abb7a70ecbaf9e17b"><code>b592d77</code></a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5057680b1ff2829d1ed0558ef4042472c03c63ae"><code>5057680</code></a></td><td><code>add the AX_ABSOLUTE_HEADER macro</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/101537b93c3343a3e7a8554d8e82d8da36be5691"><code>101537b</code></a></td><td><code>iml in particular is very picky about being given an absolute path to the</code></td></tr></table>




---

archive/issue_comments_420089.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nok, it was trivial to rebase.\nnow testing before setting it to positive again.",
    "created_at": "2019-02-25T20:10:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420089",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:70" align="right">comment:70</div>

ok, it was trivial to rebase.
now testing before setting it to positive again.



---

archive/issue_events_375733.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-26T10:26:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375733"
}
```



---

archive/issue_events_375734.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-02-26T10:26:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375734"
}
```



---

archive/issue_comments_420090.json:
```json
{
    "body": "Changed dependencies from **#27254** to **#27254, 27367**",
    "created_at": "2019-02-26T22:33:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420090",
    "user": "https://github.com/dimpase"
}
```

Changed dependencies from **#27254** to **#27254, 27367**



---

archive/issue_comments_420091.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nThe present mpfrcx does not work with this branch, but it does with the new version. Thus the new dependence.",
    "created_at": "2019-02-26T22:33:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420091",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:72" align="right">comment:72</div>

The present mpfrcx does not work with this branch, but it does with the new version. Thus the new dependence.



---

archive/issue_comments_420092.json:
```json
{
    "body": "Changed dependencies from **#27254, 27367** to **#27254, #27367**",
    "created_at": "2019-02-26T22:41:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420092",
    "user": "https://github.com/dimpase"
}
```

Changed dependencies from **#27254, 27367** to **#27254, #27367**



---

archive/issue_comments_420093.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\n`$SAGE_LOCAL/bin/sage-env-config` must get updated after, say, `sage -i mpir` (or any other dummy package that sets anything in the build environment). Currently this does not happen. This is a bug that leads to `sage -i mpir` breaking stuff. \n\nSee #27373 to deal with this. (Hopefully everything that is on this ticket can stay as it is, so I don't flip it to \"needs work\")",
    "created_at": "2019-02-27T09:51:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420093",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:74" align="right">comment:74</div>

`$SAGE_LOCAL/bin/sage-env-config` must get updated after, say, `sage -i mpir` (or any other dummy package that sets anything in the build environment). Currently this does not happen. This is a bug that leads to `sage -i mpir` breaking stuff. 

See #27373 to deal with this. (Hopefully everything that is on this ticket can stay as it is, so I don't flip it to "needs work")



---

archive/issue_comments_420094.json:
```json
{
    "body": "Changed dependencies from **#27254, #27367** to **#27254, #27367, #27373**",
    "created_at": "2019-02-27T09:51:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420094",
    "user": "https://github.com/dimpase"
}
```

Changed dependencies from **#27254, #27367** to **#27254, #27367, #27373**



---

archive/issue_comments_420095.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nWe need to decide how to move forward here. I'm fine with a no-fix for #27373, i.e.\n\"re-run configure with the parameters you need, do not use `./sage -i` for *un-dummifying* packages\".",
    "created_at": "2019-03-05T11:19:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420095",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:75" align="right">comment:75</div>

We need to decide how to move forward here. I'm fine with a no-fix for #27373, i.e.
"re-run configure with the parameters you need, do not use `./sage -i` for *un-dummifying* packages".



---

archive/issue_comments_420096.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nI guess I don't really see how #27373 is relevant here. Or at least, I don't see that it's an issue particular to this ticket or that should be a dependency of it.",
    "created_at": "2019-03-05T14:59:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420096",
    "user": "https://github.com/embray"
}
```

<div id="comment:76" align="right">comment:76</div>

I guess I don't really see how #27373 is relevant here. Or at least, I don't see that it's an issue particular to this ticket or that should be a dependency of it.



---

archive/issue_comments_420097.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nMerge conflict",
    "created_at": "2019-03-11T12:36:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420097",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:77" align="right">comment:77</div>

Merge conflict



---

archive/issue_events_375735.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-11T12:36:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375735"
}
```



---

archive/issue_events_375736.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-03-11T12:36:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375736"
}
```



---

archive/issue_comments_420098.json:
```json
{
    "body": "<div id=\"comment:78\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/862ca6af87ac256bf726b0bd7ef7439e2d9b0080\"><code>862ca6a</code></a></td><td><code>Merge remote-tracking branch 'trac/develop' into HEAD</code></td></tr></table>\n",
    "created_at": "2019-03-11T15:49:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420098",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:78"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/862ca6af87ac256bf726b0bd7ef7439e2d9b0080"><code>862ca6a</code></a></td><td><code>Merge remote-tracking branch 'trac/develop' into HEAD</code></td></tr></table>




---

archive/issue_comments_420099.json:
```json
{
    "body": "Changed commit from **[`101537b`](https://github.com/sagemath/sagetrac-mirror/commit/101537b93c3343a3e7a8554d8e82d8da36be5691)** to **[`862ca6a`](https://github.com/sagemath/sagetrac-mirror/commit/862ca6af87ac256bf726b0bd7ef7439e2d9b0080)**",
    "created_at": "2019-03-11T15:49:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420099",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`101537b`](https://github.com/sagemath/sagetrac-mirror/commit/101537b93c3343a3e7a8554d8e82d8da36be5691)** to **[`862ca6a`](https://github.com/sagemath/sagetrac-mirror/commit/862ca6af87ac256bf726b0bd7ef7439e2d9b0080)**



---

archive/issue_events_375737.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-11T16:12:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375737"
}
```



---

archive/issue_events_375738.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-11T16:12:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375738"
}
```



---

archive/issue_comments_420100.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nthe only manual part of the merge was here:\n\n```diff\n--- a/build/pkgs/arb/spkg-install\n+++ b/build/pkgs/arb/spkg-install\n@@ -4,8 +4,8 @@ cd src\n # be removed in arb >= 2.8 when it is released\n export EXTRA_SHARED_FLAGS=$LDFLAGS\n \n-./configure --disable-static --prefix=\"$SAGE_LOCAL\" --with-flint=\"$SAGE_LOCAL\" \\\n-    --with-gmp=\"$SAGE_LOCAL\" --with-mpfr=\"$SAGE_LOCAL\" || \\\n+./configure --disable-static --prefix=\"$SAGE_LOCAL\" $SAGE_CONFIGURE_GMP \\\n+            --with-flint=\"$SAGE_LOCAL\" --with-mpfr=\"$SAGE_LOCAL\" || \\\n     sdh_die \"Error configuring arb.\"\n \n sdh_make verbose\n```",
    "created_at": "2019-03-11T16:15:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420100",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:80" align="right">comment:80</div>

the only manual part of the merge was here:

```diff
--- a/build/pkgs/arb/spkg-install
+++ b/build/pkgs/arb/spkg-install
@@ -4,8 +4,8 @@ cd src
 # be removed in arb >= 2.8 when it is released
 export EXTRA_SHARED_FLAGS=$LDFLAGS
 
-./configure --disable-static --prefix="$SAGE_LOCAL" --with-flint="$SAGE_LOCAL" \
-    --with-gmp="$SAGE_LOCAL" --with-mpfr="$SAGE_LOCAL" || \
+./configure --disable-static --prefix="$SAGE_LOCAL" $SAGE_CONFIGURE_GMP \
+            --with-flint="$SAGE_LOCAL" --with-mpfr="$SAGE_LOCAL" || \
     sdh_die "Error configuring arb."
 
 sdh_make verbose
```



---

archive/issue_events_375739.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-11T16:15:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375739"
}
```



---

archive/issue_events_375740.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-11T16:15:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375740"
}
```



---

archive/issue_comments_420101.json:
```json
{
    "body": "Changed dependencies from **#27254, #27367, #27373** to **#27254, #27367, #27373, #27215**",
    "created_at": "2019-03-11T18:12:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420101",
    "user": "https://github.com/dimpase"
}
```

Changed dependencies from **#27254, #27367, #27373** to **#27254, #27367, #27373, #27215**



---

archive/issue_comments_420102.json:
```json
{
    "body": "<div id=\"comment:82\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e2b10087c2e81539644d12c0a70cd1a95ea7866\"><code>7e2b100</code></a></td><td><code>Remove broken SAGE_BUILD_TOOLCHAIN support</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03dc987c6d475279b0008fa8f5ba37a0045bb75e\"><code>03dc987</code></a></td><td><code>Merged trac #27215 in</code></td></tr></table>\n",
    "created_at": "2019-03-13T09:24:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420102",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:82"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e2b10087c2e81539644d12c0a70cd1a95ea7866"><code>7e2b100</code></a></td><td><code>Remove broken SAGE_BUILD_TOOLCHAIN support</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03dc987c6d475279b0008fa8f5ba37a0045bb75e"><code>03dc987</code></a></td><td><code>Merged trac #27215 in</code></td></tr></table>




---

archive/issue_comments_420103.json:
```json
{
    "body": "Changed commit from **[`862ca6a`](https://github.com/sagemath/sagetrac-mirror/commit/862ca6af87ac256bf726b0bd7ef7439e2d9b0080)** to **[`03dc987`](https://github.com/sagemath/sagetrac-mirror/commit/03dc987c6d475279b0008fa8f5ba37a0045bb75e)**",
    "created_at": "2019-03-13T09:24:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420103",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`862ca6a`](https://github.com/sagemath/sagetrac-mirror/commit/862ca6af87ac256bf726b0bd7ef7439e2d9b0080)** to **[`03dc987`](https://github.com/sagemath/sagetrac-mirror/commit/03dc987c6d475279b0008fa8f5ba37a0045bb75e)**



---

archive/issue_events_375741.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2019-03-13T09:24:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375741"
}
```



---

archive/issue_events_375742.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2019-03-13T09:24:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375742"
}
```



---

archive/issue_events_375743.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-20T11:59:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375743"
}
```



---

archive/issue_events_375744.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-20T11:59:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375744"
}
```



---

archive/issue_events_375745.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-20T11:59:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375745"
}
```



---

archive/issue_events_375746.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-03-20T11:59:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375746"
}
```



---

archive/issue_comments_420104.json:
```json
{
    "body": "Changed dependencies from **#27254, #27367, #27373, #27215** to **#27373**",
    "created_at": "2019-03-20T12:01:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420104",
    "user": "https://github.com/dimpase"
}
```

Changed dependencies from **#27254, #27367, #27373, #27215** to **#27373**



---

archive/issue_comments_420105.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nI wonder whether for gcc and gfortran `--with-gmp=\"$SAGE_LOCAL\"` is left there on purpose, or it's simply a typo/omission?\n\nThis might have \"interesting\" interactions with what is to come on #27373.",
    "created_at": "2019-03-20T14:38:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420105",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:85" align="right">comment:85</div>

I wonder whether for gcc and gfortran `--with-gmp="$SAGE_LOCAL"` is left there on purpose, or it's simply a typo/omission?

This might have "interesting" interactions with what is to come on #27373.



---

archive/issue_comments_420106.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nIsn't the nesting of `AC_CHECK_HEADER`'s and `AC_SEARCH_LIBS`  needed here?\nOtherwise we may end up with system's GMP library, but without headers available.",
    "created_at": "2019-03-21T14:29:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420106",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:86" align="right">comment:86</div>

Isn't the nesting of `AC_CHECK_HEADER`'s and `AC_SEARCH_LIBS`  needed here?
Otherwise we may end up with system's GMP library, but without headers available.



---

archive/issue_events_375747.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-10T10:00:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375747"
}
```



---

archive/issue_events_375748.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-10T10:00:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375748"
}
```



---

archive/issue_comments_420107.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nReplying to [@dimpase](#comment:85):\n> I wonder whether for gcc and gfortran `--with-gmp=\"$SAGE_LOCAL\"` is left there on purpose, or it's simply a typo/omission?\n> \n> This might have \"interesting\" interactions with what is to come on #27373.\n\nI was just about to ask you about this.  I'm working on rebasing this on top of current develop (mostly straightforward but not trivial).  In the current upstream version of this branch, which you were the last to touch, gcc/gfortran was omitted in [this commit](https://github.com/sagemath/sagetrac-mirror/commit/3b6eebda8df1ae7fbc86f81c0fcf123989504447).  However, in my local copy of the branch it still includes them.\n\nI was going to ask if that was intentional but now it's sounding like maybe it wasn't.  So I'll put it back in for now.",
    "created_at": "2019-04-10T10:00:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420107",
    "user": "https://github.com/embray"
}
```

<div id="comment:87" align="right">comment:87</div>

Replying to [@dimpase](#comment:85):
> I wonder whether for gcc and gfortran `--with-gmp="$SAGE_LOCAL"` is left there on purpose, or it's simply a typo/omission?
> 
> This might have "interesting" interactions with what is to come on #27373.

I was just about to ask you about this.  I'm working on rebasing this on top of current develop (mostly straightforward but not trivial).  In the current upstream version of this branch, which you were the last to touch, gcc/gfortran was omitted in [this commit](https://github.com/sagemath/sagetrac-mirror/commit/3b6eebda8df1ae7fbc86f81c0fcf123989504447).  However, in my local copy of the branch it still includes them.

I was going to ask if that was intentional but now it's sounding like maybe it wasn't.  So I'll put it back in for now.



---

archive/issue_comments_420108.json:
```json
{
    "body": "Changed commit from **[`03dc987`](https://github.com/sagemath/sagetrac-mirror/commit/03dc987c6d475279b0008fa8f5ba37a0045bb75e)** to **[`eea0685`](https://github.com/sagemath/sagetrac-mirror/commit/eea06854a43e37c893c9fa9e26866d7e4cce1da5)**",
    "created_at": "2019-04-10T10:11:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420108",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`03dc987`](https://github.com/sagemath/sagetrac-mirror/commit/03dc987c6d475279b0008fa8f5ba37a0045bb75e)** to **[`eea0685`](https://github.com/sagemath/sagetrac-mirror/commit/eea06854a43e37c893c9fa9e26866d7e4cce1da5)**



---

archive/issue_comments_420109.json:
```json
{
    "body": "<div id=\"comment:88\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c8285fd7cb6df74d0430e3589581c07bae14d8d\"><code>8c8285f</code></a></td><td><code>spkg-configure for GMP</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/956e3820e2bcc86db75e5a7ab1682d3c9c2cbd3e\"><code>956e382</code></a></td><td><code>Move all the --with-mp logic into the spkg-configure.m4 for MPIR so that it</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/687cdf07061f4410b072a4ccd7d371e3a6fbe315\"><code>687cdf0</code></a></td><td><code>Replace various --with-gmp=$SAGE_LOCAL flags in spkg-installs with a</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6de961d90d9e06756579f0be85a8b74b7ca04360\"><code>6de961d</code></a></td><td><code>Reworked this a bit more</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f76d6d57b3166af20da2f36299f97c2db6ec0907\"><code>f76d6d5</code></a></td><td><code>fix typo</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f90ff72d2ea8f48e893d9b0bfa6fb5d3f1a7fe7\"><code>5f90ff7</code></a></td><td><code>added a bit more explanation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3dee97c228e0a4bf16ecd43877e93fc3e79d5610\"><code>3dee97c</code></a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0308142fc8342c91b83b7744c47c1c3b9ae3d54e\"><code>0308142</code></a></td><td><code>add the AX_ABSOLUTE_HEADER macro</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eea06854a43e37c893c9fa9e26866d7e4cce1da5\"><code>eea0685</code></a></td><td><code>iml in particular is very picky about being given an absolute path to the</code></td></tr></table>\n",
    "created_at": "2019-04-10T10:11:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420109",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:88"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c8285fd7cb6df74d0430e3589581c07bae14d8d"><code>8c8285f</code></a></td><td><code>spkg-configure for GMP</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/956e3820e2bcc86db75e5a7ab1682d3c9c2cbd3e"><code>956e382</code></a></td><td><code>Move all the --with-mp logic into the spkg-configure.m4 for MPIR so that it</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/687cdf07061f4410b072a4ccd7d371e3a6fbe315"><code>687cdf0</code></a></td><td><code>Replace various --with-gmp=$SAGE_LOCAL flags in spkg-installs with a</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6de961d90d9e06756579f0be85a8b74b7ca04360"><code>6de961d</code></a></td><td><code>Reworked this a bit more</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f76d6d57b3166af20da2f36299f97c2db6ec0907"><code>f76d6d5</code></a></td><td><code>fix typo</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f90ff72d2ea8f48e893d9b0bfa6fb5d3f1a7fe7"><code>5f90ff7</code></a></td><td><code>added a bit more explanation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3dee97c228e0a4bf16ecd43877e93fc3e79d5610"><code>3dee97c</code></a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0308142fc8342c91b83b7744c47c1c3b9ae3d54e"><code>0308142</code></a></td><td><code>add the AX_ABSOLUTE_HEADER macro</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eea06854a43e37c893c9fa9e26866d7e4cce1da5"><code>eea0685</code></a></td><td><code>iml in particular is very picky about being given an absolute path to the</code></td></tr></table>




---

archive/issue_comments_420110.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">comment:89</div>\n\nRebased on 8.8.beta0.  Now to test again; this is all toward making progress on #27373...",
    "created_at": "2019-04-10T10:12:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420110",
    "user": "https://github.com/embray"
}
```

<div id="comment:89" align="right">comment:89</div>

Rebased on 8.8.beta0.  Now to test again; this is all toward making progress on #27373...



---

archive/issue_events_375749.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-10T10:12:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375749"
}
```



---

archive/issue_events_375750.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-10T10:12:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375750"
}
```



---

archive/issue_comments_420111.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nOnce again, about nesting. Shouldn't e.g.\n\n```m4\n            AC_CHECK_HEADER(gmp.h, [], [sage_spkg_install_mpir=yes])\n            AC_CHECK_HEADER(gmpxx.h, [], [sage_spkg_install_mpir=yes])\n            dnl mpq_cmp_z appeared in GMP 6.1.0 and is used by pynac\n            AC_SEARCH_LIBS([__gmpq_cmp_z], [gmp], [break],\n                [sage_spkg_install_mpir=yes])\n```\nbe written as\n\n```m4\n            AC_CHECK_HEADER(gmp.h, [\n              AC_CHECK_HEADER(gmpxx.h, [\n                dnl mpq_cmp_z appeared in GMP 6.1.0 and is used by pynac\n                AC_SEARCH_LIBS([__gmpq_cmp_z], [gmp], [break],\n                   [sage_spkg_install_mpir=yes])\n              ], [sage_spkg_install_mpir=yes])\n            ], [sage_spkg_install_mpir=yes])            \n```\n\nAnd, by the way, what's that `break` doing there? I gather it's to interrupt loops, but there is no loop here...",
    "created_at": "2019-04-10T11:00:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420111",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:90" align="right">comment:90</div>

Once again, about nesting. Shouldn't e.g.

```m4
            AC_CHECK_HEADER(gmp.h, [], [sage_spkg_install_mpir=yes])
            AC_CHECK_HEADER(gmpxx.h, [], [sage_spkg_install_mpir=yes])
            dnl mpq_cmp_z appeared in GMP 6.1.0 and is used by pynac
            AC_SEARCH_LIBS([__gmpq_cmp_z], [gmp], [break],
                [sage_spkg_install_mpir=yes])
```
be written as

```m4
            AC_CHECK_HEADER(gmp.h, [
              AC_CHECK_HEADER(gmpxx.h, [
                dnl mpq_cmp_z appeared in GMP 6.1.0 and is used by pynac
                AC_SEARCH_LIBS([__gmpq_cmp_z], [gmp], [break],
                   [sage_spkg_install_mpir=yes])
              ], [sage_spkg_install_mpir=yes])
            ], [sage_spkg_install_mpir=yes])            
```

And, by the way, what's that `break` doing there? I gather it's to interrupt loops, but there is no loop here...



---

archive/issue_comments_420112.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\nI don't think the nesting is necessary.  If finding the headers fails then it will set `sage_spkg_install_mpir=yes`; there's no advantage to then skipping the library check because it will still keep `sage_spkg_install_mpir=yes` reagardless. Nesting it just makes the code harder to read IMO.\n\n> And, by the way, what's that break doing there? I gather it's to interrupt loops, but there is no loop here...\n\nRemember, most of these autoconf macros expand to shell code.  So that's where the loop is, and you can see what a break would do there by looking at the expanded macro in the actual `configure` script.\n\nHowever, I think it's superfluous in this case.  It would break out of the loop if `AC_SEARCH_LIBS` finds that you can link the test program without explicitly passing `-lgmp`, but I don't think that would ever be the case (it is the case sometimes with other libraries, such as libm, which may be linked automatically).  So I can just remove it if it's clearer (it's also harmless though).",
    "created_at": "2019-04-10T12:25:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420112",
    "user": "https://github.com/embray"
}
```

<div id="comment:91" align="right">comment:91</div>

I don't think the nesting is necessary.  If finding the headers fails then it will set `sage_spkg_install_mpir=yes`; there's no advantage to then skipping the library check because it will still keep `sage_spkg_install_mpir=yes` reagardless. Nesting it just makes the code harder to read IMO.

> And, by the way, what's that break doing there? I gather it's to interrupt loops, but there is no loop here...

Remember, most of these autoconf macros expand to shell code.  So that's where the loop is, and you can see what a break would do there by looking at the expanded macro in the actual `configure` script.

However, I think it's superfluous in this case.  It would break out of the loop if `AC_SEARCH_LIBS` finds that you can link the test program without explicitly passing `-lgmp`, but I don't think that would ever be the case (it is the case sometimes with other libraries, such as libm, which may be linked automatically).  So I can just remove it if it's clearer (it's also harmless though).



---

archive/issue_comments_420113.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nOK, it's fine then.",
    "created_at": "2019-04-10T22:21:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420113",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:92" align="right">comment:92</div>

OK, it's fine then.



---

archive/issue_events_375751.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-04-10T22:21:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375751"
}
```



---

archive/issue_events_375752.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-04-10T22:21:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375752"
}
```



---

archive/issue_comments_420114.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nThanks--I still think it would be ok to remove #27373 as a dependency.  Because although it is a known bug, it's not entirely new after all as I explained in [#27373 comment:73](https://github.com/sagemath/sage/issues/27373#comment:73).  In short, there are other cases where we should require re-running `configure` after installing new packages, but don't, resulting in an incorrect configuration.\n\nIt should still be fixed ASAP but I think for now it's good enough to say \"don't do that\".",
    "created_at": "2019-04-11T10:34:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420114",
    "user": "https://github.com/embray"
}
```

<div id="comment:93" align="right">comment:93</div>

Thanks--I still think it would be ok to remove #27373 as a dependency.  Because although it is a known bug, it's not entirely new after all as I explained in [#27373 comment:73](https://github.com/sagemath/sage/issues/27373#comment:73).  In short, there are other cases where we should require re-running `configure` after installing new packages, but don't, resulting in an incorrect configuration.

It should still be fixed ASAP but I think for now it's good enough to say "don't do that".



---

archive/issue_comments_420115.json:
```json
{
    "body": "Changed dependencies from **#27373** to none",
    "created_at": "2019-04-11T11:51:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420115",
    "user": "https://github.com/dimpase"
}
```

Changed dependencies from **#27373** to none



---

archive/issue_comments_420116.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">comment:94</div>\n\nOK, let's get it merged then!",
    "created_at": "2019-04-11T11:51:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420116",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:94" align="right">comment:94</div>

OK, let's get it merged then!



---

archive/issue_events_375753.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-13T21:03:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375753"
}
```



---

archive/issue_events_375754.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-13T21:03:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375754"
}
```



---

archive/issue_comments_420117.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">comment:95</div>\n\nSingular doesn't build for me...",
    "created_at": "2019-04-13T21:03:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420117",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:95" align="right">comment:95</div>

Singular doesn't build for me...



---

archive/issue_comments_420118.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">comment:96</div>\n\nLogs please.\n\nDo you have gmp installed in a weird place?\n\nYou might need to start from `make distclean`, to be on the safe side.",
    "created_at": "2019-04-13T21:08:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420118",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:96" align="right">comment:96</div>

Logs please.

Do you have gmp installed in a weird place?

You might need to start from `make distclean`, to be on the safe side.



---

archive/issue_comments_420119.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nand, needless to say, this needs a run of `./bootstrap`.\n\nwhat we might have forgotten is to bump up versions of gmp and mpir, to force re-building of appropriate packages, our poor man dependency resolution.\nI never understood why spkg-install and spkg-configure.m4 are not listed as package dependencies in automatically generated targets for packages.",
    "created_at": "2019-04-14T07:18:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420119",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:97" align="right">comment:97</div>

and, needless to say, this needs a run of `./bootstrap`.

what we might have forgotten is to bump up versions of gmp and mpir, to force re-building of appropriate packages, our poor man dependency resolution.
I never understood why spkg-install and spkg-configure.m4 are not listed as package dependencies in automatically generated targets for packages.



---

archive/issue_comments_420120.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">comment:98</div>\n\nReplying to [@vbraun](#comment:95):\n> Singular doesn't build for me...\n\nThis that building from scratch, or what?  Note that the configure script should be regenerated or lots of things won'g build properly due to the changes to `sage-env-config.in`.",
    "created_at": "2019-04-15T16:12:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420120",
    "user": "https://github.com/embray"
}
```

<div id="comment:98" align="right">comment:98</div>

Replying to [@vbraun](#comment:95):
> Singular doesn't build for me...

This that building from scratch, or what?  Note that the configure script should be regenerated or lots of things won'g build properly due to the changes to `sage-env-config.in`.



---

archive/issue_events_375755.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-15T16:12:41Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "subject": "https://github.com/embray",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375755"
}
```



---

archive/issue_events_375756.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-15T16:12:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375756"
}
```



---

archive/issue_events_375757.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-15T16:12:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375757"
}
```



---

archive/issue_comments_420121.json:
```json
{
    "body": "<div id=\"comment:0\" align=\"right\">comment:0</div>\n\nIf thats the case then a new confball is needed on the branch...",
    "created_at": "2019-04-16T09:12:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420121",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:0" align="right">comment:0</div>

If thats the case then a new confball is needed on the branch...



---

archive/issue_events_375758.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-16T13:42:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375758"
}
```



---

archive/issue_events_375759.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-04-16T13:42:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375759"
}
```



---

archive/issue_comments_420122.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[configure-314.tar.gz](https://github.com/sagemath/sage/files/ticket27212/configure-314.tar.gz)**\n\nNew configure tarball attached and linked in the description.\n\nNice number on that one =)",
    "created_at": "2019-04-16T13:42:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420122",
    "user": "https://github.com/embray"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[configure-314.tar.gz](https://github.com/sagemath/sage/files/ticket27212/configure-314.tar.gz)**

New configure tarball attached and linked in the description.

Nice number on that one =)



---

archive/issue_comments_420123.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,3 +2,5 @@\n \n note that GMP is pulled in via `./configure --with-mp=gmp`\n (as well as by specifying SAGE_MP_LIBRARY?)\n+\n+**Configure:** https://github.com/sagemath/sage/files/ticket27212/configure-314.tar.gz\n``````\n",
    "created_at": "2019-04-16T13:42:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420123",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,3 +2,5 @@
 
 note that GMP is pulled in via `./configure --with-mp=gmp`
 (as well as by specifying SAGE_MP_LIBRARY?)
+
+**Configure:** https://github.com/sagemath/sage/files/ticket27212/configure-314.tar.gz
``````




---

archive/issue_comments_420124.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThis is a sub-optimal workflow, as ticket authors have little control over the moment the ticket comes up for merging, and thus it's not unlikely that the configure tarball would be out of sync, if there is more than one stream of tickets that touch configure.\n\nAnd we do have quite a few of them on #27330.",
    "created_at": "2019-04-16T19:59:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420124",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2" align="right">comment:2</div>

This is a sub-optimal workflow, as ticket authors have little control over the moment the ticket comes up for merging, and thus it's not unlikely that the configure tarball would be out of sync, if there is more than one stream of tickets that touch configure.

And we do have quite a few of them on #27330.



---

archive/issue_comments_420125.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nIndeed; I've complained about this as well.  A better solution isn't immediately obvious to me other than to make sure that all of the buildbot workers have up-to-date autotools installed and run `./bootstrap` as part of the normal build procedure.  I think that *should* be done but it's not always trivial I guess (e.g. on OSX?).\n\nIn the meantime I'm happy to follow the workflow as it is; it could just be confusing for all the tickets attached to #27330.  Maybe we can do something like bundle multiple of those tickets to be merged together once several of them have been otherwise positively reviewed individually.",
    "created_at": "2019-04-17T13:38:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420125",
    "user": "https://github.com/embray"
}
```

<div id="comment:3" align="right">comment:3</div>

Indeed; I've complained about this as well.  A better solution isn't immediately obvious to me other than to make sure that all of the buildbot workers have up-to-date autotools installed and run `./bootstrap` as part of the normal build procedure.  I think that *should* be done but it's not always trivial I guess (e.g. on OSX?).

In the meantime I'm happy to follow the workflow as it is; it could just be confusing for all the tickets attached to #27330.  Maybe we can do something like bundle multiple of those tickets to be merged together once several of them have been otherwise positively reviewed individually.



---

archive/issue_comments_420126.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nit is trivial to install autotools on OSX using Homebrew.",
    "created_at": "2019-04-17T13:44:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420126",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>

it is trivial to install autotools on OSX using Homebrew.



---

archive/issue_comments_420127.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThe one and only OSX buildbot worker is for testing that Sage installs on a as-vanilla-as-possible OSX install...",
    "created_at": "2019-04-17T17:32:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420127",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:5" align="right">comment:5</div>

The one and only OSX buildbot worker is for testing that Sage installs on a as-vanilla-as-possible OSX install...



---

archive/issue_events_375760.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-17T17:38:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375760"
}
```



---

archive/issue_events_375761.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-17T17:38:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375761"
}
```



---

archive/issue_comments_420128.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nconfigure-314.tar.gz is for 8.8.beta2, as always you are supposed to bump the version if you change the file.",
    "created_at": "2019-04-17T17:38:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420128",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:6" align="right">comment:6</div>

configure-314.tar.gz is for 8.8.beta2, as always you are supposed to bump the version if you change the file.



---

archive/issue_comments_420129.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI have no idea where this 314 can be found. If you update from source then upstream/configure-`xyz`.tar.gz might not correspond to anything at all, may not even exist.\n\nE.g. my different sage builds, all based on 8.8.beta2, have different from 314 `xyz`.\n\nI am tired of doing manually things that must have been automated 10 years ago.\nWhy is that `xyz` there at all?! The build is run by make, which is intelligent enough to know if a file has been updated, you know...",
    "created_at": "2019-04-17T19:13:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420129",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">comment:7</div>

I have no idea where this 314 can be found. If you update from source then upstream/configure-`xyz`.tar.gz might not correspond to anything at all, may not even exist.

E.g. my different sage builds, all based on 8.8.beta2, have different from 314 `xyz`.

I am tired of doing manually things that must have been automated 10 years ago.
Why is that `xyz` there at all?! The build is run by make, which is intelligent enough to know if a file has been updated, you know...



---

archive/issue_comments_420130.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nActually, 8.8.beta2 has already configure-315.tar.gz. The version number is in build/pkgs/configure/package-version.txt, like all tarballs.\n\nTo make a new confball:\n* merge in the latest beta (so you have the most up-to-date  build/pkgs/configure/package-version.txt)\n* run `./bootstrap -s -i`\n* Commit the new version and checksum, and upload the confball",
    "created_at": "2019-04-17T22:25:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420130",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:8" align="right">comment:8</div>

Actually, 8.8.beta2 has already configure-315.tar.gz. The version number is in build/pkgs/configure/package-version.txt, like all tarballs.

To make a new confball:
* merge in the latest beta (so you have the most up-to-date  build/pkgs/configure/package-version.txt)
* run `./bootstrap -s -i`
* Commit the new version and checksum, and upload the confball



---

archive/issue_comments_420131.json:
```json
{
    "body": "Changed commit from **[`eea0685`](https://github.com/sagemath/sagetrac-mirror/commit/eea06854a43e37c893c9fa9e26866d7e4cce1da5)** to **[`e735b4b`](https://github.com/sagemath/sagetrac-mirror/commit/e735b4bd95072234d72385ee78634b9000f7e420)**",
    "created_at": "2019-04-18T07:47:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420131",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`eea0685`](https://github.com/sagemath/sagetrac-mirror/commit/eea06854a43e37c893c9fa9e26866d7e4cce1da5)** to **[`e735b4b`](https://github.com/sagemath/sagetrac-mirror/commit/e735b4bd95072234d72385ee78634b9000f7e420)**



---

archive/issue_comments_420132.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a50fe85bfbe0cdad0f8f3e0c58074f9b252a7838\"><code>a50fe85</code></a></td><td><code>spkg-configure for GMP</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8a16493182c96d6c45213fb0a5465e5c91b2dc8b\"><code>8a16493</code></a></td><td><code>Move all the --with-mp logic into the spkg-configure.m4 for MPIR so that it</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/299e367746ee7fb9927596329ace50661a348b4e\"><code>299e367</code></a></td><td><code>Replace various --with-gmp=$SAGE_LOCAL flags in spkg-installs with a</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/058d5150d33c5fa042c8a0d75be294491d343c3e\"><code>058d515</code></a></td><td><code>Reworked this a bit more</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7beadaa98da47f5f1fad300c1a1e8ba38588422e\"><code>7beadaa</code></a></td><td><code>fix typo</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9308743cb797c73651a30ae15a20292eae16654\"><code>b930874</code></a></td><td><code>added a bit more explanation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d2b496cf7b11ddc51b5f30850fd1af5b4bea579\"><code>6d2b496</code></a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43be5464120b654febec9984711c6846105d3572\"><code>43be546</code></a></td><td><code>add the AX_ABSOLUTE_HEADER macro</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e343418b1bf4fe9dece46e5fd6dcb3804985ad86\"><code>e343418</code></a></td><td><code>iml in particular is very picky about being given an absolute path to the</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e735b4bd95072234d72385ee78634b9000f7e420\"><code>e735b4b</code></a></td><td><code>configure version bump</code></td></tr></table>\n",
    "created_at": "2019-04-18T07:47:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420132",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a50fe85bfbe0cdad0f8f3e0c58074f9b252a7838"><code>a50fe85</code></a></td><td><code>spkg-configure for GMP</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8a16493182c96d6c45213fb0a5465e5c91b2dc8b"><code>8a16493</code></a></td><td><code>Move all the --with-mp logic into the spkg-configure.m4 for MPIR so that it</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/299e367746ee7fb9927596329ace50661a348b4e"><code>299e367</code></a></td><td><code>Replace various --with-gmp=$SAGE_LOCAL flags in spkg-installs with a</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/058d5150d33c5fa042c8a0d75be294491d343c3e"><code>058d515</code></a></td><td><code>Reworked this a bit more</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7beadaa98da47f5f1fad300c1a1e8ba38588422e"><code>7beadaa</code></a></td><td><code>fix typo</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9308743cb797c73651a30ae15a20292eae16654"><code>b930874</code></a></td><td><code>added a bit more explanation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d2b496cf7b11ddc51b5f30850fd1af5b4bea579"><code>6d2b496</code></a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43be5464120b654febec9984711c6846105d3572"><code>43be546</code></a></td><td><code>add the AX_ABSOLUTE_HEADER macro</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e343418b1bf4fe9dece46e5fd6dcb3804985ad86"><code>e343418</code></a></td><td><code>iml in particular is very picky about being given an absolute path to the</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e735b4bd95072234d72385ee78634b9000f7e420"><code>e735b4b</code></a></td><td><code>configure version bump</code></td></tr></table>




---

archive/issue_comments_420133.json:
```json
{
    "body": "<div id=\"comment:0\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a50fe85bfbe0cdad0f8f3e0c58074f9b252a7838\"><code>a50fe85</code></a></td><td><code>spkg-configure for GMP</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8a16493182c96d6c45213fb0a5465e5c91b2dc8b\"><code>8a16493</code></a></td><td><code>Move all the --with-mp logic into the spkg-configure.m4 for MPIR so that it</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/299e367746ee7fb9927596329ace50661a348b4e\"><code>299e367</code></a></td><td><code>Replace various --with-gmp=$SAGE_LOCAL flags in spkg-installs with a</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/058d5150d33c5fa042c8a0d75be294491d343c3e\"><code>058d515</code></a></td><td><code>Reworked this a bit more</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7beadaa98da47f5f1fad300c1a1e8ba38588422e\"><code>7beadaa</code></a></td><td><code>fix typo</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9308743cb797c73651a30ae15a20292eae16654\"><code>b930874</code></a></td><td><code>added a bit more explanation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d2b496cf7b11ddc51b5f30850fd1af5b4bea579\"><code>6d2b496</code></a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43be5464120b654febec9984711c6846105d3572\"><code>43be546</code></a></td><td><code>add the AX_ABSOLUTE_HEADER macro</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e343418b1bf4fe9dece46e5fd6dcb3804985ad86\"><code>e343418</code></a></td><td><code>iml in particular is very picky about being given an absolute path to the</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e735b4bd95072234d72385ee78634b9000f7e420\"><code>e735b4b</code></a></td><td><code>configure version bump</code></td></tr></table>\n",
    "created_at": "2019-04-18T07:49:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420133",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:0"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a50fe85bfbe0cdad0f8f3e0c58074f9b252a7838"><code>a50fe85</code></a></td><td><code>spkg-configure for GMP</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8a16493182c96d6c45213fb0a5465e5c91b2dc8b"><code>8a16493</code></a></td><td><code>Move all the --with-mp logic into the spkg-configure.m4 for MPIR so that it</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/299e367746ee7fb9927596329ace50661a348b4e"><code>299e367</code></a></td><td><code>Replace various --with-gmp=$SAGE_LOCAL flags in spkg-installs with a</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/058d5150d33c5fa042c8a0d75be294491d343c3e"><code>058d515</code></a></td><td><code>Reworked this a bit more</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7beadaa98da47f5f1fad300c1a1e8ba38588422e"><code>7beadaa</code></a></td><td><code>fix typo</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9308743cb797c73651a30ae15a20292eae16654"><code>b930874</code></a></td><td><code>added a bit more explanation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d2b496cf7b11ddc51b5f30850fd1af5b4bea579"><code>6d2b496</code></a></td><td><code>correct logic for SAGE_GMP_PREFIX etc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43be5464120b654febec9984711c6846105d3572"><code>43be546</code></a></td><td><code>add the AX_ABSOLUTE_HEADER macro</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e343418b1bf4fe9dece46e5fd6dcb3804985ad86"><code>e343418</code></a></td><td><code>iml in particular is very picky about being given an absolute path to the</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e735b4bd95072234d72385ee78634b9000f7e420"><code>e735b4b</code></a></td><td><code>configure version bump</code></td></tr></table>




---

archive/issue_comments_420134.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,4 +3,5 @@\n note that GMP is pulled in via `./configure --with-mp=gmp`\n (as well as by specifying SAGE_MP_LIBRARY?)\n \n-**Configure:** https://github.com/sagemath/sage/files/ticket27212/configure-314.tar.gz\n+**Configure:** \n+http://users.ox.ac.uk/~coml0531/sage/configure-316.tar.gz\n``````\n",
    "created_at": "2019-04-18T07:49:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420134",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,4 +3,5 @@
 note that GMP is pulled in via `./configure --with-mp=gmp`
 (as well as by specifying SAGE_MP_LIBRARY?)
 
-**Configure:** https://github.com/sagemath/sage/files/ticket27212/configure-314.tar.gz
+**Configure:** 
+http://users.ox.ac.uk/~coml0531/sage/configure-316.tar.gz
``````




---

archive/issue_events_375762.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-04-18T07:49:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375762"
}
```



---

archive/issue_events_375763.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-04-18T07:49:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375763"
}
```



---

archive/issue_comments_420135.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nrebased over 8.8.beta2, new configure tarball",
    "created_at": "2019-04-18T07:52:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420135",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:1" align="right">comment:1</div>

rebased over 8.8.beta2, new configure tarball



---

archive/issue_events_375764.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-04-18T09:19:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375764"
}
```



---

archive/issue_events_375765.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-04-18T09:19:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375765"
}
```



---

archive/issue_comments_420136.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nand now this fails on OSX 10.14 with external gmp, specifically, flint does not build:\n\n```\n          make build/interfaces/NTL-interface.lo; \\\n          clang++ -std=gnu++11 -fno-common -pedantic -Wall -O2 -funroll-loops -g -mpopcnt   -shared -install_name /Users/administrator/\npy/sage/local/lib/libflint-13.5.2.dylib -compatibility_version 13.5 -current_version 13.5.2 -Wl,-rpath,/usr/local/lib -Wl,-rpath,/Users\n/administrator/py/sage/local/lib build/interfaces/NTL-interface.lo  build/printf.lo  build/fprintf.lo  build/sprintf.lo  build/scanf.lo\n  build/fscanf.lo  build/sscanf.lo  build/clz_tab.lo  build/memory_manager.lo  build/version.lo  build/profiler.lo  build/thread_support.lo  build/ulong_extras.lo  build/long_extras.lo  build/perm.lo  build/fmpz.lo  build/fmpz_vec.lo  build/fmpz_poly.lo  build/fmpq_poly.lo  build/fmpz_mat.lo  build/fmpz_lll.lo  build/mpfr_vec.lo  build/mpfr_mat.lo  build/mpf_vec.lo  build/mpf_mat.lo  build/nmod_vec.lo  build/nmod_poly.lo  build/nmod_poly_factor.lo  build/arith.lo  build/mpn_extras.lo  build/nmod_mat.lo  build/fmpq.lo  build/fmpq_vec.lo  build/fmpq_mat.lo  build/padic.lo  build/fmpz_poly_q.lo  build/fmpz_poly_mat.lo  build/nmod_poly_mat.lo  build/fmpz_mod_poly.lo  build/fmpz_mod_poly_factor.lo  build/fmpz_factor.lo  build/fmpz_poly_factor.lo  build/fft.lo  build/qsieve.lo  build/double_extras.lo  build/d_vec.lo  build/d_mat.lo  build/padic_poly.lo  build/padic_mat.lo  build/qadic.lo  build/fq.lo  build/fq_vec.lo  build/fq_mat.lo  build/fq_poly.lo  build/fq_poly_factor.lo  build/fq_nmod.lo  build/fq_nmod_vec.lo  build/fq_nmod_mat.lo  build/fq_nmod_poly.lo  build/fq_nmod_poly_factor.lo  build/fq_zech.lo  build/fq_zech_vec.lo  build/fq_zech_mat.lo  build/fq_zech_poly.lo  build/fq_zech_poly_factor.lo  -o libflint-13.5.2.dylib -L/Users/administrator/py/sage/local/lib -Wl,-rpath,/Users/administrator/py/sage/local/lib  -L/Users/administrator/py/sage/local/var/tmp/sage/build/flint-2.5.2.p4/src -L/usr/local/lib -L/Users/administrator/py/sage/local/lib -L/Users/administrator/py/sage/local/lib -lmpfr -lgmp -lm -lntl -lpthread ; \\\n        fi\nclang++ -std=gnu++11 -fPIC -fno-common -pedantic -Wall -O2 -funroll-loops -g -mpopcnt  -I/Users/administrator/py/sage/local/var/tmp/sage/build/flint-2.5.2.p4/src -I/usr/local/include -I/Users/administrator/py/sage/local/include -I/Users/administrator/py/sage/local/include -c interfaces/NTL-interface.cpp -o build/interfaces/NTL-interface.lo\nld: illegal thread local variable reference to regular symbol __ZN3NTL8ZZ_pInfoE for architecture x86_64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\nmake[4]: *** [libflint-13.5.2.dylib] Error 1\n```\nnote that mpfr and ntl, its dependencies build just fine with SAGE_CHECK=yes, so that's something in flint C++ interface that is broken...",
    "created_at": "2019-04-18T09:19:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420136",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:2" align="right">comment:2</div>

and now this fails on OSX 10.14 with external gmp, specifically, flint does not build:

```
          make build/interfaces/NTL-interface.lo; \
          clang++ -std=gnu++11 -fno-common -pedantic -Wall -O2 -funroll-loops -g -mpopcnt   -shared -install_name /Users/administrator/
py/sage/local/lib/libflint-13.5.2.dylib -compatibility_version 13.5 -current_version 13.5.2 -Wl,-rpath,/usr/local/lib -Wl,-rpath,/Users
/administrator/py/sage/local/lib build/interfaces/NTL-interface.lo  build/printf.lo  build/fprintf.lo  build/sprintf.lo  build/scanf.lo
  build/fscanf.lo  build/sscanf.lo  build/clz_tab.lo  build/memory_manager.lo  build/version.lo  build/profiler.lo  build/thread_support.lo  build/ulong_extras.lo  build/long_extras.lo  build/perm.lo  build/fmpz.lo  build/fmpz_vec.lo  build/fmpz_poly.lo  build/fmpq_poly.lo  build/fmpz_mat.lo  build/fmpz_lll.lo  build/mpfr_vec.lo  build/mpfr_mat.lo  build/mpf_vec.lo  build/mpf_mat.lo  build/nmod_vec.lo  build/nmod_poly.lo  build/nmod_poly_factor.lo  build/arith.lo  build/mpn_extras.lo  build/nmod_mat.lo  build/fmpq.lo  build/fmpq_vec.lo  build/fmpq_mat.lo  build/padic.lo  build/fmpz_poly_q.lo  build/fmpz_poly_mat.lo  build/nmod_poly_mat.lo  build/fmpz_mod_poly.lo  build/fmpz_mod_poly_factor.lo  build/fmpz_factor.lo  build/fmpz_poly_factor.lo  build/fft.lo  build/qsieve.lo  build/double_extras.lo  build/d_vec.lo  build/d_mat.lo  build/padic_poly.lo  build/padic_mat.lo  build/qadic.lo  build/fq.lo  build/fq_vec.lo  build/fq_mat.lo  build/fq_poly.lo  build/fq_poly_factor.lo  build/fq_nmod.lo  build/fq_nmod_vec.lo  build/fq_nmod_mat.lo  build/fq_nmod_poly.lo  build/fq_nmod_poly_factor.lo  build/fq_zech.lo  build/fq_zech_vec.lo  build/fq_zech_mat.lo  build/fq_zech_poly.lo  build/fq_zech_poly_factor.lo  -o libflint-13.5.2.dylib -L/Users/administrator/py/sage/local/lib -Wl,-rpath,/Users/administrator/py/sage/local/lib  -L/Users/administrator/py/sage/local/var/tmp/sage/build/flint-2.5.2.p4/src -L/usr/local/lib -L/Users/administrator/py/sage/local/lib -L/Users/administrator/py/sage/local/lib -lmpfr -lgmp -lm -lntl -lpthread ; \
        fi
clang++ -std=gnu++11 -fPIC -fno-common -pedantic -Wall -O2 -funroll-loops -g -mpopcnt  -I/Users/administrator/py/sage/local/var/tmp/sage/build/flint-2.5.2.p4/src -I/usr/local/include -I/Users/administrator/py/sage/local/include -I/Users/administrator/py/sage/local/include -c interfaces/NTL-interface.cpp -o build/interfaces/NTL-interface.lo
ld: illegal thread local variable reference to regular symbol __ZN3NTL8ZZ_pInfoE for architecture x86_64
clang: error: linker command failed with exit code 1 (use -v to see invocation)
make[4]: *** [libflint-13.5.2.dylib] Error 1
```
note that mpfr and ntl, its dependencies build just fine with SAGE_CHECK=yes, so that's something in flint C++ interface that is broken...



---

archive/issue_comments_420137.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI suppose this is caused by the very recent (Apr 6) NTL update.",
    "created_at": "2019-04-18T09:28:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420137",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">comment:3</div>

I suppose this is caused by the very recent (Apr 6) NTL update.



---

archive/issue_comments_420138.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nNo, it must be either lack of testing on OSX 10.14 (I tested on 10.13 before), or new clang in Xcode:\n\n```\n$ clang++ -v\nApple LLVM version 10.0.1 (clang-1001.0.46.3)\nTarget: x86_64-apple-darwin18.5.0\nThread model: posix\nInstalledDir: /Library/Developer/CommandLineTools/usr/bin\n```",
    "created_at": "2019-04-18T09:54:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420138",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">comment:4</div>

No, it must be either lack of testing on OSX 10.14 (I tested on 10.13 before), or new clang in Xcode:

```
$ clang++ -v
Apple LLVM version 10.0.1 (clang-1001.0.46.3)
Target: x86_64-apple-darwin18.5.0
Thread model: posix
InstalledDir: /Library/Developer/CommandLineTools/usr/bin
```



---

archive/issue_comments_420139.json:
```json
{
    "body": "<div id=\"comment:115\" align=\"right\">comment:115</div>\n\nReplying to [@vbraun](#comment:105):\n> The one and only OSX buildbot worker is for testing that Sage installs on a as-vanilla-as-possible OSX install... \n\nWell, if you like I can install autotools on your OSX bot just from sources. (I recall doing that on OSX 10.12, it should still be possible on 10.14).\nThis would be vanilla enough then, still...",
    "created_at": "2019-04-18T10:44:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420139",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:115" align="right">comment:115</div>

Replying to [@vbraun](#comment:105):
> The one and only OSX buildbot worker is for testing that Sage installs on a as-vanilla-as-possible OSX install... 

Well, if you like I can install autotools on your OSX bot just from sources. (I recall doing that on OSX 10.12, it should still be possible on 10.14).
This would be vanilla enough then, still...



---

archive/issue_comments_420140.json:
```json
{
    "body": "<div id=\"comment:116\" align=\"right\">comment:116</div>\n\nReplying to [@dimpase](#comment:114):\n> No, it must be either lack of testing on OSX 10.14 (I tested on 10.13 before), or new clang in Xcode:\n> \n> ```\n> $ clang++ -v\n> Apple LLVM version 10.0.1 (clang-1001.0.46.3)\n> Target: x86_64-apple-darwin18.5.0\n> Thread model: posix\n> InstalledDir: /Library/Developer/CommandLineTools/usr/bin\n> ```\n\nThe problem seems to be caused by `-std=gnu++11` option, see [#25532 comment:88](https://github.com/sagemath/sage/issues/25532#comment:88)",
    "created_at": "2019-04-18T11:03:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420140",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:116" align="right">comment:116</div>

Replying to [@dimpase](#comment:114):
> No, it must be either lack of testing on OSX 10.14 (I tested on 10.13 before), or new clang in Xcode:
> 
> ```
> $ clang++ -v
> Apple LLVM version 10.0.1 (clang-1001.0.46.3)
> Target: x86_64-apple-darwin18.5.0
> Thread model: posix
> InstalledDir: /Library/Developer/CommandLineTools/usr/bin
> ```

The problem seems to be caused by `-std=gnu++11` option, see [#25532 comment:88](https://github.com/sagemath/sage/issues/25532#comment:88)



---

archive/issue_comments_420141.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nfacepalm.... That was just a library clash - I did have libntl installed in /usr/local, and this seems to be deadly on OSX...",
    "created_at": "2019-04-18T18:37:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420141",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">comment:7</div>

facepalm.... That was just a library clash - I did have libntl installed in /usr/local, and this seems to be deadly on OSX...



---

archive/issue_events_375766.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-04-18T18:37:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375766"
}
```



---

archive/issue_events_375767.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-04-18T18:37:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375767"
}
```



---

archive/issue_comments_420142.json:
```json
{
    "body": "<div id=\"comment:118\" align=\"right\">comment:118</div>\n\nReplying to [@dimpase](#comment:115):\n> Well, if you like I can install autotools on your OSX bot just from sources. (I recall doing that on OSX 10.12, it should still be possible on 10.14).\n\nAgain, unless we make autotools a prerequisite we need a way to verify that Sage builds on OSX without autotools installed...",
    "created_at": "2019-04-18T20:02:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420142",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:118" align="right">comment:118</div>

Replying to [@dimpase](#comment:115):
> Well, if you like I can install autotools on your OSX bot just from sources. (I recall doing that on OSX 10.12, it should still be possible on 10.14).

Again, unless we make autotools a prerequisite we need a way to verify that Sage builds on OSX without autotools installed...



---

archive/issue_comments_420143.json:
```json
{
    "body": "<div id=\"comment:119\" align=\"right\">comment:119</div>\n\nReplying to [@vbraun](#comment:118):\n> Replying to [@dimpase](#comment:115):\n> > Well, if you like I can install autotools on your OSX bot just from sources. (I recall doing that on OSX 10.12, it should still be possible on 10.14).\n\n> \n> Again, unless we make autotools a prerequisite we need a way to verify that Sage builds on OSX without autotools installed...\n\nDo we have Linux buildbots without autotools installed?\n\nAnyhow, one can have autotools installed in a non-standard location only buildbot knows, so that it can run ./bootstrap, and then it's as if there are not present.\n\nIt's hard for me to understand the problem without knowing how exactly a release is made.\n(if be any chance you are in Berlin, you can show me - I'm here until 21st Apr).",
    "created_at": "2019-04-18T20:17:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420143",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:119" align="right">comment:119</div>

Replying to [@vbraun](#comment:118):
> Replying to [@dimpase](#comment:115):
> > Well, if you like I can install autotools on your OSX bot just from sources. (I recall doing that on OSX 10.12, it should still be possible on 10.14).

> 
> Again, unless we make autotools a prerequisite we need a way to verify that Sage builds on OSX without autotools installed...

Do we have Linux buildbots without autotools installed?

Anyhow, one can have autotools installed in a non-standard location only buildbot knows, so that it can run ./bootstrap, and then it's as if there are not present.

It's hard for me to understand the problem without knowing how exactly a release is made.
(if be any chance you are in Berlin, you can show me - I'm here until 21st Apr).



---

archive/issue_comments_420144.json:
```json
{
    "body": "Changed branch from **[public/packages/gmp_m4](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/gmp_m4)** to **[`e735b4b`](https://github.com/sagemath/sagetrac-mirror/commit/e735b4bd95072234d72385ee78634b9000f7e420)**",
    "created_at": "2019-04-18T22:21:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420144",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/packages/gmp_m4](https://github.com/sagemath/sagetrac-mirror/tree/public/packages/gmp_m4)** to **[`e735b4b`](https://github.com/sagemath/sagetrac-mirror/commit/e735b4bd95072234d72385ee78634b9000f7e420)**



---

archive/issue_events_375768.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-18T22:21:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375768"
}
```



---

archive/issue_events_375769.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "daf1967365907f301d4ecb1745f3be9a7721c8c7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-04-18T22:21:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27212#event-375769"
}
```



---

archive/issue_comments_420145.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nNo matter how you slice it, either the buildbot has access to autotools OR it tests that you can build without autotools. The only safe way to avoid generating a confball by hand is to have some automatic system, e.g. whenever I submit a new buildbot job. That requires some work to avoid version clashes when I back out commits. Truth be told, changes to the configure in Sage are pretty rare so this issue does not come up very often.\n\nI'm in Berlin, hit me up when you have some time. I'm located in the East (Elsenstrasse).",
    "created_at": "2019-04-18T22:33:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420145",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:1" align="right">comment:1</div>

No matter how you slice it, either the buildbot has access to autotools OR it tests that you can build without autotools. The only safe way to avoid generating a confball by hand is to have some automatic system, e.g. whenever I submit a new buildbot job. That requires some work to avoid version clashes when I back out commits. Truth be told, changes to the configure in Sage are pretty rare so this issue does not come up very often.

I'm in Berlin, hit me up when you have some time. I'm located in the East (Elsenstrasse).



---

archive/issue_comments_420146.json:
```json
{
    "body": "Changed commit from **[`e735b4b`](https://github.com/sagemath/sagetrac-mirror/commit/e735b4bd95072234d72385ee78634b9000f7e420)** to none",
    "created_at": "2019-04-18T22:33:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420146",
    "user": "https://github.com/vbraun"
}
```

Changed commit from **[`e735b4b`](https://github.com/sagemath/sagetrac-mirror/commit/e735b4bd95072234d72385ee78634b9000f7e420)** to none



---

archive/issue_comments_420147.json:
```json
{
    "body": "<div id=\"comment:122\" align=\"right\">comment:122</div>\n\nReplying to [@dimpase](#comment:117):\n> facepalm.... That was just a library clash - I did have libntl installed in /usr/local, and this seems to be deadly on OSX...\n\nI have had similar problems--not necessarily with NTL--but with other packages where having a copy of the development package already installed on my system created difficult to avoid clashes when trying to build some Sage SPKGs.  See e.g. #22768.  In that case it's more due to bugginess with Python's module build system, but I can envision similar problems in other build systems that make too many assumptions about your paths in some context.",
    "created_at": "2019-04-19T14:21:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420147",
    "user": "https://github.com/embray"
}
```

<div id="comment:122" align="right">comment:122</div>

Replying to [@dimpase](#comment:117):
> facepalm.... That was just a library clash - I did have libntl installed in /usr/local, and this seems to be deadly on OSX...

I have had similar problems--not necessarily with NTL--but with other packages where having a copy of the development package already installed on my system created difficult to avoid clashes when trying to build some Sage SPKGs.  See e.g. #22768.  In that case it's more due to bugginess with Python's module build system, but I can envision similar problems in other build systems that make too many assumptions about your paths in some context.



---

archive/issue_comments_420148.json:
```json
{
    "body": "<div id=\"comment:123\" align=\"right\">comment:123</div>\n\nReplying to [@vbraun](#comment:121):\n>  Truth be told, changes to the configure in Sage are pretty rare \n\nI have a dozen tickets open that do change configure, see #27330.\nFor the purpose of testing the configure spkg versioning, today I attached\nconfigure tarballs to 3 of them:\n#27258, #27265, #27186. No matter in which order they would be merged, I'd need to re-do these tarballs for all but one, you know. This is not exactly entertaining...",
    "created_at": "2019-04-19T19:26:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420148",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:123" align="right">comment:123</div>

Replying to [@vbraun](#comment:121):
>  Truth be told, changes to the configure in Sage are pretty rare 

I have a dozen tickets open that do change configure, see #27330.
For the purpose of testing the configure spkg versioning, today I attached
configure tarballs to 3 of them:
#27258, #27265, #27186. No matter in which order they would be merged, I'd need to re-do these tarballs for all but one, you know. This is not exactly entertaining...



---

archive/issue_comments_420149.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nBreakage: #27751",
    "created_at": "2019-04-30T13:10:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27212#issuecomment-420149",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Breakage: #27751
