# Issue 27129: py3: fix other doctests in graph.py

archive/issues_026892.json:
```json
{
    "body": "We change some doctests in `cliques_containing_vertex` and `perfect_matchings` to support py3.\n\nKeywords: py3, graph\n\nReviewer: Travis Scrimshaw\n\nAuthor: David Coudert\n\nBranch: 40bcb34762133848f04d3098cef9ae08e1480785\n\nCommit: 40bcb34762133848f04d3098cef9ae08e1480785\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27129\n\n",
    "closed_at": "2019-02-04T23:02:17Z",
    "created_at": "2019-01-25T15:44:08Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "py3: fix other doctests in graph.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27129",
    "user": "https://github.com/dcoudert"
}
```
We change some doctests in `cliques_containing_vertex` and `perfect_matchings` to support py3.

Keywords: py3, graph

Reviewer: Travis Scrimshaw

Author: David Coudert

Branch: 40bcb34762133848f04d3098cef9ae08e1480785

Commit: 40bcb34762133848f04d3098cef9ae08e1480785

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27129





---

archive/issue_comments_377940.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-01-25T15:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27129",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27129#issuecomment-377940",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_377941.json:
```json
{
    "body": "<a id='comment:1'></a>With #27125 and #27127, this should fix all (currently) failing doctests with py3 in file `graph.py`.\n\n---\nNew commits:",
    "created_at": "2019-01-25T15:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27129",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27129#issuecomment-377941",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:1'></a>With #27125 and #27127, this should fix all (currently) failing doctests with py3 in file `graph.py`.

---
New commits:



---

archive/issue_comments_377942.json:
```json
{
    "body": "<a id='comment:2'></a>Can you explain why this change is necessary?\n\n```diff\n-            sage: G = Graph([[1,-1,'a'], [2,-2, 'b'], [1,-2,'x'], [2,-1,'y']])\n+            sage: G = Graph([(0, 1, 'a'), (0, 3, 'b'), (1, 2, 'c'), (2, 3, 'd')])\n             sage: list(G.perfect_matchings(labels=True))\n-            [[(-2, 1, 'x'), (-1, 2, 'y')], [(-2, 2, 'b'), (-1, 1, 'a')]]\n+            [[(0, 1, 'a'), (2, 3, 'd')], [(0, 3, 'b'), (1, 2, 'c')]]\n```",
    "created_at": "2019-01-25T19:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27129",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27129#issuecomment-377942",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>Can you explain why this change is necessary?

```diff
-            sage: G = Graph([[1,-1,'a'], [2,-2, 'b'], [1,-2,'x'], [2,-1,'y']])
+            sage: G = Graph([(0, 1, 'a'), (0, 3, 'b'), (1, 2, 'c'), (2, 3, 'd')])
             sage: list(G.perfect_matchings(labels=True))
-            [[(-2, 1, 'x'), (-1, 2, 'y')], [(-2, 2, 'b'), (-1, 1, 'a')]]
+            [[(0, 1, 'a'), (2, 3, 'd')], [(0, 3, 'b'), (1, 2, 'c')]]
```



---

archive/issue_comments_377943.json:
```json
{
    "body": "<a id='comment:3'></a>Essentially the same motivation as in [https://trac.sagemath.org/ticket/27127#comment:3](https://trac.sagemath.org/ticket/27127#comment:3). The order in which vertices are visited is not always the same in py2 and py3, and so the order in which solutions are discovered may differ.\n\nHere, with py3, we get `[[(-1, 1, 'a'), (-2, 2, 'b')], [(-1, 2, 'y'), (-2, 1, 'x')]]`. So same set of solutions than with py2, but matchings are reported in a different order, and the order of edges of each matching is different.\n\nThe proposed change is more stable with py2 and py3.\n\nAn alternative is to do:\n\n```\nsage: def compare(A, B):\n....:     return Set(map(Set, A)) == Set(map(Set, B))\nsage: G = Graph([[1,-1,'a'], [2,-2, 'b'], [1,-2,'x'], [2,-1,'y']])\nsage: expected = [[(-2, 1, 'x'), (-1, 2, 'y')], [(-2, 2, 'b'), (-1, 1, 'a')]]\nsage: L = list(G.perfect_matchings(labels=True))\nsage: compare(L, expected)\nTrue\n```\nShould I do that ?",
    "created_at": "2019-01-26T09:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27129",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27129#issuecomment-377943",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:3'></a>Essentially the same motivation as in [https://trac.sagemath.org/ticket/27127#comment:3](https://trac.sagemath.org/ticket/27127#comment:3). The order in which vertices are visited is not always the same in py2 and py3, and so the order in which solutions are discovered may differ.

Here, with py3, we get `[[(-1, 1, 'a'), (-2, 2, 'b')], [(-1, 2, 'y'), (-2, 1, 'x')]]`. So same set of solutions than with py2, but matchings are reported in a different order, and the order of edges of each matching is different.

The proposed change is more stable with py2 and py3.

An alternative is to do:

```
sage: def compare(A, B):
....:     return Set(map(Set, A)) == Set(map(Set, B))
sage: G = Graph([[1,-1,'a'], [2,-2, 'b'], [1,-2,'x'], [2,-1,'y']])
sage: expected = [[(-2, 1, 'x'), (-1, 2, 'y')], [(-2, 2, 'b'), (-1, 1, 'a')]]
sage: L = list(G.perfect_matchings(labels=True))
sage: compare(L, expected)
True
```
Should I do that ?



---

archive/issue_comments_377944.json:
```json
{
    "body": "<a id='comment:4'></a>That doesn't explain why this change is necessary. It just seems to replace a brittle test with another brittle test. Why not just run `sorted` on the output (since everything is a `(int, int, str)`, there should be no invalid comparisons)?",
    "created_at": "2019-01-26T20:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27129",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27129#issuecomment-377944",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>That doesn't explain why this change is necessary. It just seems to replace a brittle test with another brittle test. Why not just run `sorted` on the output (since everything is a `(int, int, str)`, there should be no invalid comparisons)?



---

archive/issue_comments_377945.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-27T09:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27129",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27129#issuecomment-377945",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377946.json:
```json
{
    "body": "<a id='comment:6'></a>I agree. I'm now using `sorted` twice. This doctest should be stable now.",
    "created_at": "2019-01-27T10:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27129",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27129#issuecomment-377946",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'></a>I agree. I'm now using `sorted` twice. This doctest should be stable now.



---

archive/issue_comments_377947.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-27T14:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27129",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27129#issuecomment-377947",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_377948.json:
```json
{
    "body": "<a id='comment:7'></a>Thank you.",
    "created_at": "2019-01-27T14:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27129",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27129#issuecomment-377948",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>Thank you.



---

archive/issue_events_067379.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-04T23:02:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27129",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27129#event-67379"
}
```



---

archive/issue_comments_377949.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-04T23:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27129",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27129#issuecomment-377949",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
