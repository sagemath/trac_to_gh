# Issue 27848: Deprecate to_sage() and structure_sheaf() in Macaulay2 interface

archive/issues_027611.json:
```json
{
    "body": "For consistency with other interfaces, the method `to_sage()` for converting `Macaulay2Element`s to Sage should be deprecated and replaced by `sage()`. More precisely, the method `_sage_()` inherited from a super class should be implemented.\n\nSimilarly, the Sage method `structure_sheaf()` should be deprecated in favor of the Macaulay2 function `sheaf()` which provides the same functionality. Since `structure_sheaf()` is implemented for any `Macaulay2Element`, even for elements that do not support it, it unnecessarily pollutes the tab completion menu. In contrast, `sheaf()` only appears in the completion menu if an element supports it.\n\n\nKeywords: macaulay2, deprecation\n\nBranch/Commit: e0ead46643b671d0158424e98c7e77120f9b7ff8\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Markus Wageringel\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27848\n\n",
    "closed_at": "2019-06-27T20:13:33Z",
    "created_at": "2019-05-18T12:12:21Z",
    "labels": [
        "component: interfaces"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Deprecate to_sage() and structure_sheaf() in Macaulay2 interface",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27848",
    "user": "https://github.com/mwageringel"
}
```
For consistency with other interfaces, the method `to_sage()` for converting `Macaulay2Element`s to Sage should be deprecated and replaced by `sage()`. More precisely, the method `_sage_()` inherited from a super class should be implemented.

Similarly, the Sage method `structure_sheaf()` should be deprecated in favor of the Macaulay2 function `sheaf()` which provides the same functionality. Since `structure_sheaf()` is implemented for any `Macaulay2Element`, even for elements that do not support it, it unnecessarily pollutes the tab completion menu. In contrast, `sheaf()` only appears in the completion menu if an element supports it.


Keywords: macaulay2, deprecation

Branch/Commit: e0ead46643b671d0158424e98c7e77120f9b7ff8

Reviewer: Frédéric Chapoton

Author: Markus Wageringel

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27848





---

archive/issue_comments_538389.json:
```json
{
    "body": "<a id='comment:1'></a>\nI have implemented the deprecations and also fixed all the failing doctests involving Macaulay2, which I tested using Macaulay2 1.11 and 1.13 on OS X.\n\nSince the Macaulay2 description of matrices changed in 1.13, I also added code to ensure these matrices have the correct string representation within Sage (see the commit message for details).\n\nTo run the tests on all files that have optional Macaulay2 doctests, you can use:\n\n```\nsage -t --long --optional=sage,macaulay2 $(grep -i \"optional.*macaulay2\" -r src/sage -l | paste -sd \" \" -)\n```\n\n---\nNew commits:\n|                                                                                                                                          |                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[8bd9f5d](https://git.sagemath.org/sage.git/commit?id=8bd9f5d1ef51871de877455f79bf953c7193754c)|`Fixed further Macaulay2-related doctests`|\n|[406beb2](https://git.sagemath.org/sage.git/commit?id=406beb2d05430a3c7f1c13d4e208057571bad9d5)|`fix ascii art for matrices in Macaulay2 1.13+`|\n|[50bc660](https://git.sagemath.org/sage.git/commit?id=50bc66063c02fc0dcd6a9bbe497cd7591b0a5663)|`deprecate Macaulay2Element.to_sage`|\n|[9f0b05c](https://git.sagemath.org/sage.git/commit?id=9f0b05c1dd6f28cc28b6baadad52153b077b565b)|`deprecate Macaulay2Element.structure_sheaf`|",
    "created_at": "2019-05-18T14:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27848#issuecomment-538389",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:1'></a>
I have implemented the deprecations and also fixed all the failing doctests involving Macaulay2, which I tested using Macaulay2 1.11 and 1.13 on OS X.

Since the Macaulay2 description of matrices changed in 1.13, I also added code to ensure these matrices have the correct string representation within Sage (see the commit message for details).

To run the tests on all files that have optional Macaulay2 doctests, you can use:

```
sage -t --long --optional=sage,macaulay2 $(grep -i "optional.*macaulay2" -r src/sage -l | paste -sd " " -)
```

---
New commits:
|                                                                                                                                          |                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[8bd9f5d](https://git.sagemath.org/sage.git/commit?id=8bd9f5d1ef51871de877455f79bf953c7193754c)|`Fixed further Macaulay2-related doctests`|
|[406beb2](https://git.sagemath.org/sage.git/commit?id=406beb2d05430a3c7f1c13d4e208057571bad9d5)|`fix ascii art for matrices in Macaulay2 1.13+`|
|[50bc660](https://git.sagemath.org/sage.git/commit?id=50bc66063c02fc0dcd6a9bbe497cd7591b0a5663)|`deprecate Macaulay2Element.to_sage`|
|[9f0b05c](https://git.sagemath.org/sage.git/commit?id=9f0b05c1dd6f28cc28b6baadad52153b077b565b)|`deprecate Macaulay2Element.structure_sheaf`|



---

archive/issue_comments_538390.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-18T14:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27848#issuecomment-538390",
    "user": "https://github.com/mwageringel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_538391.json:
```json
{
    "body": "Changing author from \"\" to \"Markus Wageringel\"",
    "created_at": "2019-05-18T14:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27848#issuecomment-538391",
    "user": "https://github.com/mwageringel"
}
```

Changing author from "" to "Markus Wageringel"



---

archive/issue_comments_538392.json:
```json
{
    "body": "Changing commit from \"\" to \"9f0b05c1dd6f28cc28b6baadad52153b077b565b\"",
    "created_at": "2019-05-18T14:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27848#issuecomment-538392",
    "user": "https://github.com/mwageringel"
}
```

Changing commit from "" to "9f0b05c1dd6f28cc28b6baadad52153b077b565b"



---

archive/issue_comments_538393.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gh-mwageringel/macaulay2_deprecations\"",
    "created_at": "2019-05-18T14:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27848#issuecomment-538393",
    "user": "https://github.com/mwageringel"
}
```

Changing branch from "" to "u/gh-mwageringel/macaulay2_deprecations"



---

archive/issue_comments_538394.json:
```json
{
    "body": "<a id='comment:2'></a>\nWith python3-sage, and M2 (version 1.14) installed and working, and this ticket's branch, I get\n\n```\nsage -t --long src/sage/matrix/matrix1.pyx  # 2 doctests failed\nsage -t --long src/sage/interfaces/macaulay2.py  # 2 doctests failed\n```\nSome of these failures may be there without the branch here.",
    "created_at": "2019-06-20T09:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27848#issuecomment-538394",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>
With python3-sage, and M2 (version 1.14) installed and working, and this ticket's branch, I get

```
sage -t --long src/sage/matrix/matrix1.pyx  # 2 doctests failed
sage -t --long src/sage/interfaces/macaulay2.py  # 2 doctests failed
```
Some of these failures may be there without the branch here.



---

archive/issue_comments_538395.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe matrix failure should be an easy fix: please replace\n\n```\nentries = map(list, self)\n```\nby \n\n```\nentries = [list(c) for c in self]\n```\nin the macaulay method in the file matrix1.pyx.",
    "created_at": "2019-06-20T10:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27848#issuecomment-538395",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>
The matrix failure should be an easy fix: please replace

```
entries = map(list, self)
```
by 

```
entries = [list(c) for c in self]
```
in the macaulay method in the file matrix1.pyx.



---

archive/issue_comments_538396.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe other failure is a \"bytes versus string\" problem.\n\nEDIT:\n\nThis shoud be fixed by replacing\n\n```\nreturn s\n```\nby\n`return bytes_to_str(s)`\nin the\n`_sage_src_` method of the M2 interface.",
    "created_at": "2019-06-20T10:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27848#issuecomment-538396",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
The other failure is a "bytes versus string" problem.

EDIT:

This shoud be fixed by replacing

```
return s
```
by
`return bytes_to_str(s)`
in the
`_sage_src_` method of the M2 interface.



---

archive/issue_comments_538397.json:
```json
{
    "body": "Changing branch from \"u/gh-mwageringel/macaulay2_deprecations\" to \"public/ticket/27848\"",
    "created_at": "2019-06-20T11:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27848#issuecomment-538397",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "u/gh-mwageringel/macaulay2_deprecations" to "public/ticket/27848"



---

archive/issue_comments_538398.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2019-06-20T11:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27848#issuecomment-538398",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "" to "Frédéric Chapoton"



---

archive/issue_comments_538399.json:
```json
{
    "body": "<a id='comment:5'></a>\nI have made my suggested changes. If you agree with them, you can set this ticket to positive review.\n\n---\nNew commits:\n|                                                                                                                                          |                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[a4036cd](https://git.sagemath.org/sage.git/commit?id=a4036cd90cffae921775694882b8f260d516122a)|`Fixed further Macaulay2-related doctests`|\n|[c0321d3](https://git.sagemath.org/sage.git/commit?id=c0321d36db902e7afe450cc8bcecdde4e94294f5)|`fix ascii art for matrices in Macaulay2 1.13+`|\n|[7fe0483](https://git.sagemath.org/sage.git/commit?id=7fe0483d05774e15dae76ac08647fbd2c845404a)|`deprecate Macaulay2Element.to_sage`|\n|[68b5715](https://git.sagemath.org/sage.git/commit?id=68b5715da0aa18c249860c4a719c060088a5f998)|`deprecate Macaulay2Element.structure_sheaf`|\n|[e0ead46](https://git.sagemath.org/sage.git/commit?id=e0ead46643b671d0158424e98c7e77120f9b7ff8)|`py3 fixes`|",
    "created_at": "2019-06-20T11:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27848#issuecomment-538399",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
I have made my suggested changes. If you agree with them, you can set this ticket to positive review.

---
New commits:
|                                                                                                                                          |                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[a4036cd](https://git.sagemath.org/sage.git/commit?id=a4036cd90cffae921775694882b8f260d516122a)|`Fixed further Macaulay2-related doctests`|
|[c0321d3](https://git.sagemath.org/sage.git/commit?id=c0321d36db902e7afe450cc8bcecdde4e94294f5)|`fix ascii art for matrices in Macaulay2 1.13+`|
|[7fe0483](https://git.sagemath.org/sage.git/commit?id=7fe0483d05774e15dae76ac08647fbd2c845404a)|`deprecate Macaulay2Element.to_sage`|
|[68b5715](https://git.sagemath.org/sage.git/commit?id=68b5715da0aa18c249860c4a719c060088a5f998)|`deprecate Macaulay2Element.structure_sheaf`|
|[e0ead46](https://git.sagemath.org/sage.git/commit?id=e0ead46643b671d0158424e98c7e77120f9b7ff8)|`py3 fixes`|



---

archive/issue_comments_538400.json:
```json
{
    "body": "Changing commit from \"9f0b05c1dd6f28cc28b6baadad52153b077b565b\" to \"e0ead46643b671d0158424e98c7e77120f9b7ff8\"",
    "created_at": "2019-06-20T11:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27848#issuecomment-538400",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "9f0b05c1dd6f28cc28b6baadad52153b077b565b" to "e0ead46643b671d0158424e98c7e77120f9b7ff8"



---

archive/issue_comments_538401.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-20T17:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27848#issuecomment-538401",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_538402.json:
```json
{
    "body": "<a id='comment:6'></a>\nOk, thank you.",
    "created_at": "2019-06-20T17:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27848#issuecomment-538402",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:6'></a>
Ok, thank you.



---

archive/issue_events_069031.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-06-27T20:13:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27848#event-69031"
}
```



---

archive/issue_comments_538403.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-27T20:13:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27848#issuecomment-538403",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_538404.json:
```json
{
    "body": "Changing branch from \"public/ticket/27848\" to \"e0ead46643b671d0158424e98c7e77120f9b7ff8\"",
    "created_at": "2019-06-27T20:13:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27848#issuecomment-538404",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/ticket/27848" to "e0ead46643b671d0158424e98c7e77120f9b7ff8"



---

archive/issue_events_069032.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:34:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27848#event-69032"
}
```



---

archive/issue_comments_538405.json:
```json
{
    "body": "<a id='comment:8'></a>\nNot in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were *actually* included, especially when closing tickets.",
    "created_at": "2019-07-03T11:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27848",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27848#issuecomment-538405",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
Not in Sage 8.8.  Let's please to try keep tickets' milestones related to the release in which we actually intend to include them, and in particular the release in which they were *actually* included, especially when closing tickets.
