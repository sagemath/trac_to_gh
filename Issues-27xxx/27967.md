# Issue 27967: Py3: Fix RecursivelyEnumeratedSet BFS for python3.

archive/issues_027730.json:
```json
{
    "assignees": [],
    "body": "In RecursivelyEnumeratedSet_graded.breadth_first_search_iterator, use list for next_level instead of set in order to iterate over his elements in the same order on each run.\n    \nThis fix python3 errors inthe combinat.root_system.weyl_group and root_lattice_realisations module.\n\nBut this modification causes some new doctests failures in weylgroup :\n\n```\nvklein@tuono:~/odk/sage$ sage -t --long src/sage/combinat/root_system/weyl_group.py \ntoo many failed tests, not using stored timings\nRunning doctests with ID 2019-06-11-11-15-20-edaa5a63.\nGit branch: HEAD\nUsing --optional=build,cmake,dochtml,memlimit,mpir,primecount,python2,sage\nDoctesting 1 file.\nsage -t --long src/sage/combinat/root_system/weyl_group.py\n**********************************************************************\nFile \"src/sage/combinat/root_system/weyl_group.py\", line 1128, in sage.combinat.root_system.weyl_group.WeylGroup_permutation._coerce_map_from_\nFailed example:\n    W.has_coerce_map_from(W5)\nExpected:\n    False\nGot:\n    True\n...\nFile \"src/sage/combinat/root_system/weyl_group.py\", line 1157, in sage.combinat.root_system.weyl_group.WeylGroup_permutation.simple_reflection\nFailed example:\n    **with  W = WeylGroup(['A',4], implementation=\"permutation\")**\n    W.simple_reflections()\nExpected:\n    Finite family {1: (1,11)(2,6)(7,9)(8,10)(12,16)(17,19)(18,20),\n                   2: (1,6)(2,12)(3,7)(5,8)(11,16)(13,17)(15,18),\n                   3: (2,7)(3,13)(4,5)(6,9)(12,17)(14,15)(16,19),\n                   4: (3,5)(4,14)(7,8)(9,10)(13,15)(17,18)(19,20)}\nGot:\n    Finite family {1: (1,11)(2,5)(6,8)(9,10)(12,15)(16,18)(19,20), \n                   2: (1,5)(2,12)(3,6)(7,9)(11,15)(13,16)(17,19),\n                   3: (2,6)(3,13)(4,7)(5,8)(12,16)(14,17)(15,18),\n                   4: (3,7)(4,14)(6,9)(8,10)(13,17)(16,19)(18,20)}\n```\n\nI need help to look if the two results of `W.simple_reflections()` are both correct or not and what's the result of `W.has_coerce_map_from(W5)` is supposed to be.\n\n\n\nCC:  @seblabbe @fchapoton @tscrim @nthiery\n\nBranch: **[`f2c51a8`](https://github.com/sagemath/sagetrac-mirror/commit/f2c51a869c60559a47bb51e3592c9b71bb095068)**\n\nStopgaps: **#28351**\n\nReviewer: **Vincent Klein, Markus Wageringel**\n\nAuthor: **Vincent Klein, John Palmieri, S\u00e9bastien Labb\u00e9**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27967_\n\n",
    "closed_at": "2019-09-05T21:33:27Z",
    "created_at": "2019-06-11T09:22:09Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Py3: Fix RecursivelyEnumeratedSet BFS for python3.",
    "type": "issue",
    "updated_at": "2019-10-29T23:42:50Z",
    "url": "https://github.com/sagemath/sage/issues/27967",
    "user": "https://github.com/vinklein"
}
```
In RecursivelyEnumeratedSet_graded.breadth_first_search_iterator, use list for next_level instead of set in order to iterate over his elements in the same order on each run.
    
This fix python3 errors inthe combinat.root_system.weyl_group and root_lattice_realisations module.

But this modification causes some new doctests failures in weylgroup :

```
vklein@tuono:~/odk/sage$ sage -t --long src/sage/combinat/root_system/weyl_group.py 
too many failed tests, not using stored timings
Running doctests with ID 2019-06-11-11-15-20-edaa5a63.
Git branch: HEAD
Using --optional=build,cmake,dochtml,memlimit,mpir,primecount,python2,sage
Doctesting 1 file.
sage -t --long src/sage/combinat/root_system/weyl_group.py
**********************************************************************
File "src/sage/combinat/root_system/weyl_group.py", line 1128, in sage.combinat.root_system.weyl_group.WeylGroup_permutation._coerce_map_from_
Failed example:
    W.has_coerce_map_from(W5)
Expected:
    False
Got:
    True
...
File "src/sage/combinat/root_system/weyl_group.py", line 1157, in sage.combinat.root_system.weyl_group.WeylGroup_permutation.simple_reflection
Failed example:
    **with  W = WeylGroup(['A',4], implementation="permutation")**
    W.simple_reflections()
Expected:
    Finite family {1: (1,11)(2,6)(7,9)(8,10)(12,16)(17,19)(18,20),
                   2: (1,6)(2,12)(3,7)(5,8)(11,16)(13,17)(15,18),
                   3: (2,7)(3,13)(4,5)(6,9)(12,17)(14,15)(16,19),
                   4: (3,5)(4,14)(7,8)(9,10)(13,15)(17,18)(19,20)}
Got:
    Finite family {1: (1,11)(2,5)(6,8)(9,10)(12,15)(16,18)(19,20), 
                   2: (1,5)(2,12)(3,6)(7,9)(11,15)(13,16)(17,19),
                   3: (2,6)(3,13)(4,7)(5,8)(12,16)(14,17)(15,18),
                   4: (3,7)(4,14)(6,9)(8,10)(13,17)(16,19)(18,20)}
```

I need help to look if the two results of `W.simple_reflections()` are both correct or not and what's the result of `W.has_coerce_map_from(W5)` is supposed to be.



CC:  @seblabbe @fchapoton @tscrim @nthiery

Branch: **[`f2c51a8`](https://github.com/sagemath/sagetrac-mirror/commit/f2c51a869c60559a47bb51e3592c9b71bb095068)**

Stopgaps: **#28351**

Reviewer: **Vincent Klein, Markus Wageringel**

Author: **Vincent Klein, John Palmieri, Sébastien Labbé**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/27967_





---

archive/issue_events_385428.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2019-06-11T09:22:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27967#event-385428"
}
```



---

archive/issue_events_385429.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2019-06-11T09:22:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "000080",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27967#event-385429"
}
```



---

archive/issue_events_385430.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2019-06-11T09:22:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27967#event-385430"
}
```



---

archive/issue_events_385431.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2019-06-11T09:22:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27967#event-385431"
}
```



---

archive/issue_comments_434913.json:
```json
{
    "body": "Branch: **[u/vklein/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/27967)**",
    "created_at": "2019-06-11T09:27:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434913",
    "user": "https://github.com/vinklein"
}
```

Branch: **[u/vklein/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/27967)**



---

archive/issue_comments_434914.json:
```json
{
    "body": "Commit: **[`6743437`](https://github.com/sagemath/sagetrac-mirror/commit/674343732acddd2667dd3b15145fb3f4382b739e)**",
    "created_at": "2019-06-11T09:35:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434914",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`6743437`](https://github.com/sagemath/sagetrac-mirror/commit/674343732acddd2667dd3b15145fb3f4382b739e)**



---

archive/issue_comments_434915.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/674343732acddd2667dd3b15145fb3f4382b739e\"><code>6743437</code></a></td><td><code>Trac #27967: Adapt a root_lattice_realizations ...</code></td></tr></table>\n",
    "created_at": "2019-06-11T09:35:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434915",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/674343732acddd2667dd3b15145fb3f4382b739e"><code>6743437</code></a></td><td><code>Trac #27967: Adapt a root_lattice_realizations ...</code></td></tr></table>




---

archive/issue_events_385432.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2019-06-11T09:56:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27967#event-385432"
}
```



---

archive/issue_comments_434916.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nNot clear to me that you can just replace set by list.. There could be repetitions..",
    "created_at": "2019-06-12T14:19:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434916",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:5" align="right">comment:5</div>

Not clear to me that you can just replace set by list.. There could be repetitions..



---

archive/issue_comments_434917.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI think repetitions are filtered:\n\n```\nif y is None or y in next_level:\n    continue\nnext_level.append(y)\n```",
    "created_at": "2019-06-12T15:53:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434917",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:6" align="right">comment:6</div>

I think repetitions are filtered:

```
if y is None or y in next_level:
    continue
next_level.append(y)
```



---

archive/issue_events_385433.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27967#event-385433"
}
```



---

archive/issue_events_385434.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27967#event-385434"
}
```



---

archive/issue_comments_434918.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nTickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434918",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_comments_434919.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fee09c6844d4590cfd654592028f508b63b2b5b4\"><code>fee09c6</code></a></td><td><code>Trac #27967: In RecursivelyEnumeratedSet_gra...</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8757dd069d9a88daffe6ff523e4f7e56c0f3f022\"><code>8757dd0</code></a></td><td><code>Trac #27967: Adapt a root_lattice_realizations ...</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0697a2334881b4ccb8aa8cb6da1a0c2a8d602be0\"><code>0697a23</code></a></td><td><code>Trac #27967: operator \"x in list\" being O(n) and ...</code></td></tr></table>\n",
    "created_at": "2019-06-17T22:29:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434919",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fee09c6844d4590cfd654592028f508b63b2b5b4"><code>fee09c6</code></a></td><td><code>Trac #27967: In RecursivelyEnumeratedSet_gra...</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8757dd069d9a88daffe6ff523e4f7e56c0f3f022"><code>8757dd0</code></a></td><td><code>Trac #27967: Adapt a root_lattice_realizations ...</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0697a2334881b4ccb8aa8cb6da1a0c2a8d602be0"><code>0697a23</code></a></td><td><code>Trac #27967: operator "x in list" being O(n) and ...</code></td></tr></table>




---

archive/issue_comments_434920.json:
```json
{
    "body": "Changed commit from **[`6743437`](https://github.com/sagemath/sagetrac-mirror/commit/674343732acddd2667dd3b15145fb3f4382b739e)** to **[`0697a23`](https://github.com/sagemath/sagetrac-mirror/commit/0697a2334881b4ccb8aa8cb6da1a0c2a8d602be0)**",
    "created_at": "2019-06-17T22:29:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434920",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6743437`](https://github.com/sagemath/sagetrac-mirror/commit/674343732acddd2667dd3b15145fb3f4382b739e)** to **[`0697a23`](https://github.com/sagemath/sagetrac-mirror/commit/0697a2334881b4ccb8aa8cb6da1a0c2a8d602be0)**



---

archive/issue_comments_434921.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n\n```diff\n-        cdef set next_level\n+        cdef list next_level\n+        cdef set set_next_level\n```\n\nI do not like the idea of having two structures (list + set) to store the same elements. This may make the algorithm use twice as much memory. There must be a way to achieve this using only one.\n\nAlso, why should the enumeration order be certified? This is not claimed in the documentation. I know it would be very nice for the doctests of other codes using it, but I believe it is an error to expect such a thing. I would rather think the code using RES should fix themselves instead.",
    "created_at": "2019-06-21T15:56:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434921",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:10" align="right">comment:10</div>


```diff
-        cdef set next_level
+        cdef list next_level
+        cdef set set_next_level
```

I do not like the idea of having two structures (list + set) to store the same elements. This may make the algorithm use twice as much memory. There must be a way to achieve this using only one.

Also, why should the enumeration order be certified? This is not claimed in the documentation. I know it would be very nice for the doctests of other codes using it, but I believe it is an error to expect such a thing. I would rather think the code using RES should fix themselves instead.



---

archive/issue_comments_434922.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\n> Also, why should the enumeration order be certified? This is not claimed in the documentation. I know it would be very nice for the doctests of other codes using it, but I believe it is an error to expect such a thing. I would rather think the code using RES should fix themselves instead.\n\nThe code using RES can't really fix that by sorting the results because the results are potentially too big and will take too much time to sort and therefore cancel the goal of using a generator.\n\nThe only other way i can think of now is tagging the tests with #py2 #py3 and hope order will remain the same across configuration and future python3 version.",
    "created_at": "2019-06-28T09:45:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434922",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:11" align="right">comment:11</div>

> Also, why should the enumeration order be certified? This is not claimed in the documentation. I know it would be very nice for the doctests of other codes using it, but I believe it is an error to expect such a thing. I would rather think the code using RES should fix themselves instead.

The code using RES can't really fix that by sorting the results because the results are potentially too big and will take too much time to sort and therefore cancel the goal of using a generator.

The only other way i can think of now is tagging the tests with #py2 #py3 and hope order will remain the same across configuration and future python3 version.



---

archive/issue_comments_434923.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nFixes for root_lattice_realizations are now in #28167.",
    "created_at": "2019-07-11T13:23:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434923",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:12" align="right">comment:12</div>

Fixes for root_lattice_realizations are now in #28167.



---

archive/issue_comments_434924.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI was thinking instead of these changes to fix doctest failures in `weyl_group.py`. What do you think?\n\n```diff\ndiff --git a/src/sage/combinat/root_system/weyl_group.py b/src/sage/combinat/root_system/weyl_group.py\nindex 360d9bf320..e34dbe88b0 100644\n--- a/src/sage/combinat/root_system/weyl_group.py\n+++ b/src/sage/combinat/root_system/weyl_group.py\n@@ -355,8 +355,11 @@ class WeylGroup_gens(UniqueRepresentation,\n         EXAMPLES::\n \n             sage: W = WeylGroup(\"B2\", prefix=\"s\")\n-            sage: refdict = W.reflections(); refdict\n+            sage: refdict = W.reflections()\n+            sage: refdict # random\n             Finite family {(1, -1): s1, (0, 1): s2, (1, 1): s2*s1*s2, (1, 0): s1*s2*s1}\n+            sage: [(a, refdict[a]) for a in sorted(dict(refdict))]\n+            [((1, 0), s1*s2*s1), ((1, -1), s1), ((1, 1), s2*s1*s2), ((0, 1), s2)]\n             sage: [r+refdict[r].action(r) for r in refdict.keys()]\n             [(0, 0), (0, 0), (0, 0), (0, 0)]\n \n@@ -1153,13 +1156,18 @@ class WeylGroup_permutation(UniqueRepresentation, PermutationGroup_generic):\n         EXAMPLES::\n \n             sage: W = WeylGroup(['A',4], implementation=\"permutation\")\n-            sage: W.simple_reflection(1)\n+            sage: a = W.simple_reflection(1)\n+            sage: a # random\n             (1,11)(2,6)(7,9)(8,10)(12,16)(17,19)(18,20)\n-            sage: W.simple_reflections()\n+            sage: a.is_reflection()\n+            True\n+            sage: W.simple_reflections() # random\n             Finite family {1: (1,11)(2,6)(7,9)(8,10)(12,16)(17,19)(18,20),\n                            2: (1,6)(2,12)(3,7)(5,8)(11,16)(13,17)(15,18),\n                            3: (2,7)(3,13)(4,5)(6,9)(12,17)(14,15)(16,19),\n                            4: (3,5)(4,14)(7,8)(9,10)(13,15)(17,18)(19,20)}\n+            sage: W == W.subgroup(W.simple_reflections())\n+            True\n         \"\"\"\n         return self.gens()[self._index_set_inverse[i]]\n \n@@ -1229,19 +1237,19 @@ class WeylGroup_permutation(UniqueRepresentation, PermutationGroup_generic):\n         EXAMPLES::\n \n             sage: W = WeylGroup(['G',2], implementation=\"permutation\")\n-            sage: W.roots()\n-            ((1, 0),\n+            sage: sorted(W.roots())\n+            [(-3, -2),\n+             (-3, -1),\n+             (-2, -1),\n+             (-1, -1),\n+             (-1, 0),\n+             (0, -1),\n              (0, 1),\n+             (1, 0),\n              (1, 1),\n-             (3, 1),\n              (2, 1),\n-             (3, 2),\n-             (-1, 0),\n-             (0, -1),\n-             (-1, -1),\n-             (-3, -1),\n-             (-2, -1),\n-             (-3, -2))\n+             (3, 1),\n+             (3, 2)]\n         \"\"\"\n         Q = self._cartan_type.root_system().root_lattice()\n         roots = ([x.to_vector() for x in Q.positive_roots()]\n@@ -1257,7 +1265,7 @@ class WeylGroup_permutation(UniqueRepresentation, PermutationGroup_generic):\n         EXAMPLES::\n \n             sage: W = WeylGroup(['C',3], implementation=\"permutation\")\n-            sage: W.positive_roots()\n+            sage: W.positive_roots() # py2\n             ((1, 0, 0),\n              (0, 1, 0),\n              (0, 0, 1),\n@@ -1267,6 +1275,16 @@ class WeylGroup_permutation(UniqueRepresentation, PermutationGroup_generic):\n              (2, 2, 1),\n              (1, 1, 1),\n              (1, 2, 1))\n+            sage: W.positive_roots() # py3\n+            ((1, 0, 0),\n+             (0, 1, 0),\n+             (0, 0, 1),\n+             (0, 1, 1),\n+             (0, 2, 1),\n+             (1, 1, 0),\n+             (2, 2, 1),\n+             (1, 1, 1),\n+             (1, 2, 1))\n         \"\"\"\n         return self.roots()[:self.number_of_reflections()]\n \n```",
    "created_at": "2019-07-22T00:36:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434924",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:13" align="right">comment:13</div>

I was thinking instead of these changes to fix doctest failures in `weyl_group.py`. What do you think?

```diff
diff --git a/src/sage/combinat/root_system/weyl_group.py b/src/sage/combinat/root_system/weyl_group.py
index 360d9bf320..e34dbe88b0 100644
--- a/src/sage/combinat/root_system/weyl_group.py
+++ b/src/sage/combinat/root_system/weyl_group.py
@@ -355,8 +355,11 @@ class WeylGroup_gens(UniqueRepresentation,
         EXAMPLES::
 
             sage: W = WeylGroup("B2", prefix="s")
-            sage: refdict = W.reflections(); refdict
+            sage: refdict = W.reflections()
+            sage: refdict # random
             Finite family {(1, -1): s1, (0, 1): s2, (1, 1): s2*s1*s2, (1, 0): s1*s2*s1}
+            sage: [(a, refdict[a]) for a in sorted(dict(refdict))]
+            [((1, 0), s1*s2*s1), ((1, -1), s1), ((1, 1), s2*s1*s2), ((0, 1), s2)]
             sage: [r+refdict[r].action(r) for r in refdict.keys()]
             [(0, 0), (0, 0), (0, 0), (0, 0)]
 
@@ -1153,13 +1156,18 @@ class WeylGroup_permutation(UniqueRepresentation, PermutationGroup_generic):
         EXAMPLES::
 
             sage: W = WeylGroup(['A',4], implementation="permutation")
-            sage: W.simple_reflection(1)
+            sage: a = W.simple_reflection(1)
+            sage: a # random
             (1,11)(2,6)(7,9)(8,10)(12,16)(17,19)(18,20)
-            sage: W.simple_reflections()
+            sage: a.is_reflection()
+            True
+            sage: W.simple_reflections() # random
             Finite family {1: (1,11)(2,6)(7,9)(8,10)(12,16)(17,19)(18,20),
                            2: (1,6)(2,12)(3,7)(5,8)(11,16)(13,17)(15,18),
                            3: (2,7)(3,13)(4,5)(6,9)(12,17)(14,15)(16,19),
                            4: (3,5)(4,14)(7,8)(9,10)(13,15)(17,18)(19,20)}
+            sage: W == W.subgroup(W.simple_reflections())
+            True
         """
         return self.gens()[self._index_set_inverse[i]]
 
@@ -1229,19 +1237,19 @@ class WeylGroup_permutation(UniqueRepresentation, PermutationGroup_generic):
         EXAMPLES::
 
             sage: W = WeylGroup(['G',2], implementation="permutation")
-            sage: W.roots()
-            ((1, 0),
+            sage: sorted(W.roots())
+            [(-3, -2),
+             (-3, -1),
+             (-2, -1),
+             (-1, -1),
+             (-1, 0),
+             (0, -1),
              (0, 1),
+             (1, 0),
              (1, 1),
-             (3, 1),
              (2, 1),
-             (3, 2),
-             (-1, 0),
-             (0, -1),
-             (-1, -1),
-             (-3, -1),
-             (-2, -1),
-             (-3, -2))
+             (3, 1),
+             (3, 2)]
         """
         Q = self._cartan_type.root_system().root_lattice()
         roots = ([x.to_vector() for x in Q.positive_roots()]
@@ -1257,7 +1265,7 @@ class WeylGroup_permutation(UniqueRepresentation, PermutationGroup_generic):
         EXAMPLES::
 
             sage: W = WeylGroup(['C',3], implementation="permutation")
-            sage: W.positive_roots()
+            sage: W.positive_roots() # py2
             ((1, 0, 0),
              (0, 1, 0),
              (0, 0, 1),
@@ -1267,6 +1275,16 @@ class WeylGroup_permutation(UniqueRepresentation, PermutationGroup_generic):
              (2, 2, 1),
              (1, 1, 1),
              (1, 2, 1))
+            sage: W.positive_roots() # py3
+            ((1, 0, 0),
+             (0, 1, 0),
+             (0, 0, 1),
+             (0, 1, 1),
+             (0, 2, 1),
+             (1, 1, 0),
+             (2, 2, 1),
+             (1, 1, 1),
+             (1, 2, 1))
         """
         return self.roots()[:self.number_of_reflections()]
 
```



---

archive/issue_comments_434925.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nHowever, I am also getting another doctest failure, which leads me to this, which might be a serious problem.\n\nPython 2:\n\n```\nsage: W = WeylGroup(['A',3], implementation=\"permutation\")\nsage: Permutation('(1,7)(2,5)(4,6)(8,11)(10,12)') in W\nFalse\n```\n\nPython 3:\n\n```\nsage: W = WeylGroup(['A',3], implementation=\"permutation\")\nsage: Permutation('(1,7)(2,5)(4,6)(8,11)(10,12)') in W\nTrue\n```\n\nIs this a serious problem? It seems to me that `W` should be the same group, regardless of the version of Python.",
    "created_at": "2019-07-22T00:38:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434925",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:14" align="right">comment:14</div>

However, I am also getting another doctest failure, which leads me to this, which might be a serious problem.

Python 2:

```
sage: W = WeylGroup(['A',3], implementation="permutation")
sage: Permutation('(1,7)(2,5)(4,6)(8,11)(10,12)') in W
False
```

Python 3:

```
sage: W = WeylGroup(['A',3], implementation="permutation")
sage: Permutation('(1,7)(2,5)(4,6)(8,11)(10,12)') in W
True
```

Is this a serious problem? It seems to me that `W` should be the same group, regardless of the version of Python.



---

archive/issue_comments_434926.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@seblabbe](#comment:10):\n> I do not like the idea of having two structures (list + set) to store the same elements. This may make the algorithm use twice as much memory. There must be a way to achieve this using only one.\n\nThe following change can improve memory usage, at least if the branching factor is large, say 2 or more. The difference here is that elements are generally returned much earlier during the search: by an entire generation earlier. In other words, it is possible to explore one level further before running out of memory.\n\n```diff\n--- a/src/sage/sets/recursively_enumerated_set.pyx\n+++ b/src/sage/sets/recursively_enumerated_set.pyx\n@@ -1166,18 +1166,21 @@ cdef class RecursivelyEnumeratedSet_graded(RecursivelyEnumeratedSet_generic):\n         cdef int depth\n         if max_depth is None:\n             max_depth = self._max_depth\n         current_level = self._seeds\n+        if max_depth >= 0:\n+            for x in current_level:\n+                yield x\n         depth = 0\n-        while current_level and depth <= max_depth:\n+        while current_level and depth < max_depth:\n             next_level = list()\n             set_next_level = set()\n\n             for x in current_level:\n-                yield x\n                 for y in self.successors(x):\n                     if y is None or y in set_next_level:\n                         continue\n+                    yield y\n                     next_level.append(y)\n                     set_next_level.add(y)\n             current_level = next_level\n             depth += 1\n```\n\nIf the branching factor is small, closer to 1, then memory consumption is probably less of a problem. However, also consider that the proposed solution replaces 2 sets by 1 set and 2 lists. Lists have a much smaller memory footprint and iteration is faster.\n\nAside from that, in most cases, the elements iterated over will add much more to the memory consumption than the additional list.\n\nThis solution should also be applied to the generic (non-graded) case. That case does not require an additional list \u2013 replacing a set by a list is enough. As far as I can tell, this would also help with #28227.",
    "created_at": "2019-07-22T19:23:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434926",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@seblabbe](#comment:10):
> I do not like the idea of having two structures (list + set) to store the same elements. This may make the algorithm use twice as much memory. There must be a way to achieve this using only one.

The following change can improve memory usage, at least if the branching factor is large, say 2 or more. The difference here is that elements are generally returned much earlier during the search: by an entire generation earlier. In other words, it is possible to explore one level further before running out of memory.

```diff
--- a/src/sage/sets/recursively_enumerated_set.pyx
+++ b/src/sage/sets/recursively_enumerated_set.pyx
@@ -1166,18 +1166,21 @@ cdef class RecursivelyEnumeratedSet_graded(RecursivelyEnumeratedSet_generic):
         cdef int depth
         if max_depth is None:
             max_depth = self._max_depth
         current_level = self._seeds
+        if max_depth >= 0:
+            for x in current_level:
+                yield x
         depth = 0
-        while current_level and depth <= max_depth:
+        while current_level and depth < max_depth:
             next_level = list()
             set_next_level = set()

             for x in current_level:
-                yield x
                 for y in self.successors(x):
                     if y is None or y in set_next_level:
                         continue
+                    yield y
                     next_level.append(y)
                     set_next_level.add(y)
             current_level = next_level
             depth += 1
```

If the branching factor is small, closer to 1, then memory consumption is probably less of a problem. However, also consider that the proposed solution replaces 2 sets by 1 set and 2 lists. Lists have a much smaller memory footprint and iteration is faster.

Aside from that, in most cases, the elements iterated over will add much more to the memory consumption than the additional list.

This solution should also be applied to the generic (non-graded) case. That case does not require an additional list – replacing a set by a list is enough. As far as I can tell, this would also help with #28227.



---

archive/issue_comments_434927.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nWhat needs to be done to move this ticket along? It is one of the main obstacles to having tests pass with Python 3. (See #28298.)",
    "created_at": "2019-08-03T22:50:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434927",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

What needs to be done to move this ticket along? It is one of the main obstacles to having tests pass with Python 3. (See #28298.)



---

archive/issue_comments_434928.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@jhpalmieri](#comment:14):\n> However, I am also getting another doctest failure, which leads me to this, which might be a serious problem.\n> \n> Python 2:\n> \n> ```\n> sage: W = WeylGroup(['A',3], implementation=\"permutation\")\n> sage: Permutation('(1,7)(2,5)(4,6)(8,11)(10,12)') in W\n> False\n> ```\n> \n> Python 3:\n> \n> ```\n> sage: W = WeylGroup(['A',3], implementation=\"permutation\")\n> sage: Permutation('(1,7)(2,5)(4,6)(8,11)(10,12)') in W\n> True\n> ```\n> \n> Is this a serious problem? It seems to me that `W` should be the same group, regardless of the version of Python.\n\n`W` is a permutation group on the roots `W.roots()`, so the concrete representation in terms of permutations depends on the order of these roots, which differs between Python 2 and 3. Hence, this should not be a serious problem.\n\nIf this appears in the doctests (?), in order to obtain consistent results between Python versions, this could be solved by writing the permutation as a conjugation with the permutation that sorts the roots. That is, unless `RecursivelyEnumeratedSet` itself is changed as suggested in this ticket.",
    "created_at": "2019-08-04T15:11:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434928",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@jhpalmieri](#comment:14):
> However, I am also getting another doctest failure, which leads me to this, which might be a serious problem.
> 
> Python 2:
> 
> ```
> sage: W = WeylGroup(['A',3], implementation="permutation")
> sage: Permutation('(1,7)(2,5)(4,6)(8,11)(10,12)') in W
> False
> ```
> 
> Python 3:
> 
> ```
> sage: W = WeylGroup(['A',3], implementation="permutation")
> sage: Permutation('(1,7)(2,5)(4,6)(8,11)(10,12)') in W
> True
> ```
> 
> Is this a serious problem? It seems to me that `W` should be the same group, regardless of the version of Python.

`W` is a permutation group on the roots `W.roots()`, so the concrete representation in terms of permutations depends on the order of these roots, which differs between Python 2 and 3. Hence, this should not be a serious problem.

If this appears in the doctests (?), in order to obtain consistent results between Python versions, this could be solved by writing the permutation as a conjugation with the permutation that sorts the roots. That is, unless `RecursivelyEnumeratedSet` itself is changed as suggested in this ticket.



---

archive/issue_comments_434929.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@mwageringel](#comment:17):\n> If this appears in the doctests (?), in order to obtain consistent results between Python versions, this could be solved by writing the permutation as a conjugation with the permutation that sorts the roots. That is, unless `RecursivelyEnumeratedSet` itself is changed as suggested in this ticket.\n\nIt doesn't appear in the doctests: I was experimenting with alternate possible doctests that might work with both Python versions.",
    "created_at": "2019-08-05T20:52:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434929",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@mwageringel](#comment:17):
> If this appears in the doctests (?), in order to obtain consistent results between Python versions, this could be solved by writing the permutation as a conjugation with the permutation that sorts the roots. That is, unless `RecursivelyEnumeratedSet` itself is changed as suggested in this ticket.

It doesn't appear in the doctests: I was experimenting with alternate possible doctests that might work with both Python versions.



---

archive/issue_comments_434930.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nHow should we proceed here? I am happy if others take the approach in this ticket, but will that happen soon? If not, I can provide cosmetic doctest patches (as in [comment:13](#comment:13)) so that tests pass on Python 3, on a separate ticket as a stopgap. Any opinions?",
    "created_at": "2019-08-06T19:49:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434930",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:19" align="right">comment:19</div>

How should we proceed here? I am happy if others take the approach in this ticket, but will that happen soon? If not, I can provide cosmetic doctest patches (as in [comment:13](#comment:13)) so that tests pass on Python 3, on a separate ticket as a stopgap. Any opinions?



---

archive/issue_comments_434931.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nRegarding the first new doctest failure from the ticket description (`W.has_coerce_map_from(W5)` returning `True`): with this branch, I get\n\n```\nsage: W = WeylGroup([\"B\",4], implementation=\"permutation\")\nsage: W5 = WeylGroup([\"C\",4], implementation=\"permutation\")\nsage: W.gens() == W5.gens()\nTrue\n```\nI'm guessing that's what's going on: the identity map is a coercion map in this case.\n\nThe documentation is not consistent with the code. The documentation for `_coerce_map_from_` says <code>Return \\`\\`True\\`\\` if \\`\\`P\\`\\` is a Weyl group of the same Cartan type and \\`\\`False\\`\\` otherwise.</code> The code says\n\n```\n        if isinstance(P, WeylGroup_gens) and P.cartan_type() is self.cartan_type():\n            return True\n        return super(WeylGroup_permutation, self)._coerce_map_from_(P)\n```\nSo if `P` has the same Cartan type, return `True`, but otherwise, call something else: don't just automatically return `False` as the documentation says. I'm not sure what to do here.",
    "created_at": "2019-08-13T22:31:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434931",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

Regarding the first new doctest failure from the ticket description (`W.has_coerce_map_from(W5)` returning `True`): with this branch, I get

```
sage: W = WeylGroup(["B",4], implementation="permutation")
sage: W5 = WeylGroup(["C",4], implementation="permutation")
sage: W.gens() == W5.gens()
True
```
I'm guessing that's what's going on: the identity map is a coercion map in this case.

The documentation is not consistent with the code. The documentation for `_coerce_map_from_` says <code>Return \`\`True\`\` if \`\`P\`\` is a Weyl group of the same Cartan type and \`\`False\`\` otherwise.</code> The code says

```
        if isinstance(P, WeylGroup_gens) and P.cartan_type() is self.cartan_type():
            return True
        return super(WeylGroup_permutation, self)._coerce_map_from_(P)
```
So if `P` has the same Cartan type, return `True`, but otherwise, call something else: don't just automatically return `False` as the documentation says. I'm not sure what to do here.



---

archive/issue_comments_434932.json:
```json
{
    "body": "Stopgaps: **#28351**",
    "created_at": "2019-08-13T22:34:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434932",
    "user": "https://github.com/jhpalmieri"
}
```

Stopgaps: **#28351**



---

archive/issue_comments_434933.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI've created #28351 as a stopgap to fix the py3 doctests. If the approach here can be worked out, then it's easy enough to change the doctests again.",
    "created_at": "2019-08-13T22:34:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434933",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:21" align="right">comment:21</div>

I've created #28351 as a stopgap to fix the py3 doctests. If the approach here can be worked out, then it's easy enough to change the doctests again.



---

archive/issue_comments_434934.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nSorry for not commenting on this sooner. So the problem might stem from the fact that these groups are isomorphic as (Coxeter) groups, but not as Weyl groups. For a Weyl group, it also acts on a set of roots (a set of vectors whose hyperplanes define the reflections and the set is closed under these reflections), which between type B and C are dual (there are two different lengths of the roots, and they are interchanged between the two types).\n\nHowever, when doing the permutation implementation, we are effectively forgetting about the roots themselves, but instead (as pointed out in [comment:17](#comment:17)) it just depends on how the roots are permuted around. So when the ordering of the roots changes, the permutation group changes.\n\nNow for the `_coerce_map_from_`, that is a trickier thing to handle. I think we should just return `False` as per the documentation and not let the base class (i.e., the generic permutation group code) handle it precisely because we define this as a Weyl group.",
    "created_at": "2019-08-17T02:40:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434934",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:22" align="right">comment:22</div>

Sorry for not commenting on this sooner. So the problem might stem from the fact that these groups are isomorphic as (Coxeter) groups, but not as Weyl groups. For a Weyl group, it also acts on a set of roots (a set of vectors whose hyperplanes define the reflections and the set is closed under these reflections), which between type B and C are dual (there are two different lengths of the roots, and they are interchanged between the two types).

However, when doing the permutation implementation, we are effectively forgetting about the roots themselves, but instead (as pointed out in [comment:17](#comment:17)) it just depends on how the roots are permuted around. So when the ordering of the roots changes, the permutation group changes.

Now for the `_coerce_map_from_`, that is a trickier thing to handle. I think we should just return `False` as per the documentation and not let the base class (i.e., the generic permutation group code) handle it precisely because we define this as a Weyl group.



---

archive/issue_comments_434935.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nFor `_coerce_map_from`, I like the idea of changing the code so it is consistent with the documentation.\n\nWhat about concerns about memory usage, and the other aspects of [comment:10](#comment:10)? (If we were guaranteed to use Python 3.7 or later, we could use dictionaries, since they are [apparently insertion ordered](https://mail.python.org/pipermail/python-dev/2017-December/151283.html). What's their memory usage like, compared to a list plus a set?)",
    "created_at": "2019-08-19T16:37:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434935",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:23" align="right">comment:23</div>

For `_coerce_map_from`, I like the idea of changing the code so it is consistent with the documentation.

What about concerns about memory usage, and the other aspects of [comment:10](#comment:10)? (If we were guaranteed to use Python 3.7 or later, we could use dictionaries, since they are [apparently insertion ordered](https://mail.python.org/pipermail/python-dev/2017-December/151283.html). What's their memory usage like, compared to a list plus a set?)



---

archive/issue_comments_434936.json:
```json
{
    "body": "Changed branch from **[u/vklein/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/27967)** to **[u/jhpalmieri/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/27967)**",
    "created_at": "2019-08-19T18:38:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434936",
    "user": "https://github.com/jhpalmieri"
}
```

Changed branch from **[u/vklein/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/27967)** to **[u/jhpalmieri/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/27967)**



---

archive/issue_comments_434937.json:
```json
{
    "body": "Changed commit from **[`0697a23`](https://github.com/sagemath/sagetrac-mirror/commit/0697a2334881b4ccb8aa8cb6da1a0c2a8d602be0)** to **[`d790334`](https://github.com/sagemath/sagetrac-mirror/commit/d7903343951f28ce7875400953ce3f545fc9e2f4)**",
    "created_at": "2019-08-19T18:39:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434937",
    "user": "https://github.com/jhpalmieri"
}
```

Changed commit from **[`0697a23`](https://github.com/sagemath/sagetrac-mirror/commit/0697a2334881b4ccb8aa8cb6da1a0c2a8d602be0)** to **[`d790334`](https://github.com/sagemath/sagetrac-mirror/commit/d7903343951f28ce7875400953ce3f545fc9e2f4)**



---

archive/issue_comments_434938.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nThis branch works for me with Python 2 and Python 3, but the issue of memory usage has not been addressed.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a6392b6c267f7071fc737685a6b595df213898a\"><code>4a6392b</code></a></td><td><code>Trac #27967: In RecursivelyEnumeratedSet_gra...</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c5fe69c40b3e067734c3943d1ac0d588b3c3ff4f\"><code>c5fe69c</code></a></td><td><code>Trac #27967: Adapt a root_lattice_realizations ...</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9442b40682255746e8023d14ee66403260d5c1c\"><code>c9442b4</code></a></td><td><code>Trac #27967: operator \"x in list\" being O(n) and ...</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7903343951f28ce7875400953ce3f545fc9e2f4\"><code>d790334</code></a></td><td><code>trac 27967: Make `_coerce_map_from_` consistent with documenation.</code></td></tr></table>\n",
    "created_at": "2019-08-19T18:39:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434938",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:25" align="right">comment:25</div>

This branch works for me with Python 2 and Python 3, but the issue of memory usage has not been addressed.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a6392b6c267f7071fc737685a6b595df213898a"><code>4a6392b</code></a></td><td><code>Trac #27967: In RecursivelyEnumeratedSet_gra...</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c5fe69c40b3e067734c3943d1ac0d588b3c3ff4f"><code>c5fe69c</code></a></td><td><code>Trac #27967: Adapt a root_lattice_realizations ...</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9442b40682255746e8023d14ee66403260d5c1c"><code>c9442b4</code></a></td><td><code>Trac #27967: operator "x in list" being O(n) and ...</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7903343951f28ce7875400953ce3f545fc9e2f4"><code>d790334</code></a></td><td><code>trac 27967: Make `_coerce_map_from_` consistent with documenation.</code></td></tr></table>




---

archive/issue_comments_434939.json:
```json
{
    "body": "Changed commit from **[`d790334`](https://github.com/sagemath/sagetrac-mirror/commit/d7903343951f28ce7875400953ce3f545fc9e2f4)** to **[`a352ddc`](https://github.com/sagemath/sagetrac-mirror/commit/a352ddc539bb80a1d9b4c15b4573daf4de606b8d)**",
    "created_at": "2019-08-19T18:40:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434939",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d790334`](https://github.com/sagemath/sagetrac-mirror/commit/d7903343951f28ce7875400953ce3f545fc9e2f4)** to **[`a352ddc`](https://github.com/sagemath/sagetrac-mirror/commit/a352ddc539bb80a1d9b4c15b4573daf4de606b8d)**



---

archive/issue_comments_434940.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a352ddc539bb80a1d9b4c15b4573daf4de606b8d\"><code>a352ddc</code></a></td><td><code>trac 27967: Make `_coerce_map_from_` consistent with documentation.</code></td></tr></table>\n",
    "created_at": "2019-08-19T18:40:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434940",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a352ddc539bb80a1d9b4c15b4573daf4de606b8d"><code>a352ddc</code></a></td><td><code>trac 27967: Make `_coerce_map_from_` consistent with documentation.</code></td></tr></table>




---

archive/issue_comments_434941.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/27967)** to **[u/vklein/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/27967)**",
    "created_at": "2019-08-23T12:03:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434941",
    "user": "https://github.com/vinklein"
}
```

Changed branch from **[u/jhpalmieri/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/27967)** to **[u/vklein/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/27967)**



---

archive/issue_comments_434942.json:
```json
{
    "body": "Changed commit from **[`a352ddc`](https://github.com/sagemath/sagetrac-mirror/commit/a352ddc539bb80a1d9b4c15b4573daf4de606b8d)** to **[`9c19a38`](https://github.com/sagemath/sagetrac-mirror/commit/9c19a387f6f6b1f1394c4834c77a0074a50dfc18)**",
    "created_at": "2019-08-23T12:35:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434942",
    "user": "https://github.com/seblabbe"
}
```

Changed commit from **[`a352ddc`](https://github.com/sagemath/sagetrac-mirror/commit/a352ddc539bb80a1d9b4c15b4573daf4de606b8d)** to **[`9c19a38`](https://github.com/sagemath/sagetrac-mirror/commit/9c19a387f6f6b1f1394c4834c77a0074a50dfc18)**



---

archive/issue_comments_434943.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/902e26ec4b79c54627a8727d351e43627f9e6be4\"><code>902e26e</code></a></td><td><code>Trac #27967: Fix doctests to be consistent ...</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c19a387f6f6b1f1394c4834c77a0074a50dfc18\"><code>9c19a38</code></a></td><td><code>27967: using OrderedDict to preserve the order of insertion</code></td></tr></table>\n",
    "created_at": "2019-08-23T12:35:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434943",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:28"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/902e26ec4b79c54627a8727d351e43627f9e6be4"><code>902e26e</code></a></td><td><code>Trac #27967: Fix doctests to be consistent ...</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c19a387f6f6b1f1394c4834c77a0074a50dfc18"><code>9c19a38</code></a></td><td><code>27967: using OrderedDict to preserve the order of insertion</code></td></tr></table>




---

archive/issue_events_385435.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2019-08-23T12:35:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27967#event-385435"
}
```



---

archive/issue_events_385436.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2019-08-23T12:35:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27967#event-385436"
}
```



---

archive/issue_comments_434944.json:
```json
{
    "body": "Changed branch from **[u/vklein/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/27967)** to **[u/slabbe/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/27967)**",
    "created_at": "2019-08-23T12:35:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434944",
    "user": "https://github.com/seblabbe"
}
```

Changed branch from **[u/vklein/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/27967)** to **[u/slabbe/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/27967)**



---

archive/issue_comments_434945.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nSince Python 2.7, there is OrderedDict that we may use. It is written in pure Python, but according to the first answer of [this question](https://stackoverflow.com/questions/8176513/ordereddict-performance-compared-to-deque) \"*Starting with Python 3.5, `OrderedDict()` now has a C implementation.*\"\n\nMy commit seems to work on Python 2. I did not check on Python 3.",
    "created_at": "2019-08-23T12:44:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434945",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:29" align="right">comment:29</div>

Since Python 2.7, there is OrderedDict that we may use. It is written in pure Python, but according to the first answer of [this question](https://stackoverflow.com/questions/8176513/ordereddict-performance-compared-to-deque) "*Starting with Python 3.5, `OrderedDict()` now has a C implementation.*"

My commit seems to work on Python 2. I did not check on Python 3.



---

archive/issue_comments_434946.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/22c2c91a0f141c48194fcda5ef92ec08bc3f9e0f\"><code>22c2c91</code></a></td><td><code>27967: remove py2/py3 tags since output is the same</code></td></tr></table>\n",
    "created_at": "2019-08-23T12:48:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434946",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/22c2c91a0f141c48194fcda5ef92ec08bc3f9e0f"><code>22c2c91</code></a></td><td><code>27967: remove py2/py3 tags since output is the same</code></td></tr></table>




---

archive/issue_comments_434947.json:
```json
{
    "body": "Changed commit from **[`9c19a38`](https://github.com/sagemath/sagetrac-mirror/commit/9c19a387f6f6b1f1394c4834c77a0074a50dfc18)** to **[`22c2c91`](https://github.com/sagemath/sagetrac-mirror/commit/22c2c91a0f141c48194fcda5ef92ec08bc3f9e0f)**",
    "created_at": "2019-08-23T12:48:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434947",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9c19a38`](https://github.com/sagemath/sagetrac-mirror/commit/9c19a387f6f6b1f1394c4834c77a0074a50dfc18)** to **[`22c2c91`](https://github.com/sagemath/sagetrac-mirror/commit/22c2c91a0f141c48194fcda5ef92ec08bc3f9e0f)**



---

archive/issue_comments_434948.json:
```json
{
    "body": "Changed author from **Vincent Klein** to **Vincent Klein, John Palmieri, S\u00e9bastien Labb\u00e9**",
    "created_at": "2019-08-23T12:58:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434948",
    "user": "https://github.com/vinklein"
}
```

Changed author from **Vincent Klein** to **Vincent Klein, John Palmieri, Sébastien Labbé**



---

archive/issue_comments_434949.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI give positive review to commits `\u200b22c2c91`, `\u200b9c19a38` and `a352ddc`. Another one should validate my owns commits `4a6392b, \u200bc5fe69c, \u200bc9442b4` and `\u200b902e26e`.\n\nTests passed in py2 and py3 on the whole `sage.combinat.root_system` module and on `recursively_enumerated_set`.",
    "created_at": "2019-08-23T13:08:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434949",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:32" align="right">comment:32</div>

I give positive review to commits `​22c2c91`, `​9c19a38` and `a352ddc`. Another one should validate my owns commits `4a6392b, ​c5fe69c, ​c9442b4` and `​902e26e`.

Tests passed in py2 and py3 on the whole `sage.combinat.root_system` module and on `recursively_enumerated_set`.



---

archive/issue_comments_434950.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nIt seems there are some failing tests on the patchbot. Will take a look next week.",
    "created_at": "2019-08-23T16:16:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434950",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:33" align="right">comment:33</div>

It seems there are some failing tests on the patchbot. Will take a look next week.



---

archive/issue_comments_434951.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI disagree with the recent changes. Using `OrderedDict` does not address the memory concerns that were brought up, as `OrderedDict` will internally store the insertion order in addition to the dictionary. Yet, as explained in [comment:15](#comment:15), storing 1 set and 2 lists should usually be more memory efficient than storing 2 ordered dicts. It is faster than using `OrderedDict` too, especially in Python 2. So I would prefer to go back to the old branch.",
    "created_at": "2019-08-23T17:31:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434951",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:34" align="right">comment:34</div>

I disagree with the recent changes. Using `OrderedDict` does not address the memory concerns that were brought up, as `OrderedDict` will internally store the insertion order in addition to the dictionary. Yet, as explained in [comment:15](#comment:15), storing 1 set and 2 lists should usually be more memory efficient than storing 2 ordered dicts. It is faster than using `OrderedDict` too, especially in Python 2. So I would prefer to go back to the old branch.



---

archive/issue_comments_434952.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@seblabbe](#comment:33):\n> It seems there are some failing tests on the patchbot. Will take a look next week.\n\nThese don't seem like a big deal, at least as far as I can tell. If we have to fix them (that is, if the failures are due to using `OrderedDict` and we decide to keep using it), then please also make this change:\n\n```diff\ndiff --git a/src/sage/categories/coxeter_groups.py b/src/sage/categories/coxeter_groups.py\nindex b7beca409b..c6037f6c42 100644\n--- a/src/sage/categories/coxeter_groups.py\n+++ b/src/sage/categories/coxeter_groups.py\n@@ -1655,7 +1655,6 @@ class CoxeterGroups(Category_singleton):\n                 sage: W = WeylGroup([\"A\", 3])\n                 sage: s = W.simple_reflections()\n                 sage: w0 = s[1]\n-                sage: w1 = s[1]*s[2]*s[3]\n                 sage: w0.absolute_covers()\n                 [\n                 [0 0 1 0]  [0 1 0 0]  [0 0 0 1]  [0 1 0 0]  [0 1 0 0]\n```",
    "created_at": "2019-08-27T18:44:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434952",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@seblabbe](#comment:33):
> It seems there are some failing tests on the patchbot. Will take a look next week.

These don't seem like a big deal, at least as far as I can tell. If we have to fix them (that is, if the failures are due to using `OrderedDict` and we decide to keep using it), then please also make this change:

```diff
diff --git a/src/sage/categories/coxeter_groups.py b/src/sage/categories/coxeter_groups.py
index b7beca409b..c6037f6c42 100644
--- a/src/sage/categories/coxeter_groups.py
+++ b/src/sage/categories/coxeter_groups.py
@@ -1655,7 +1655,6 @@ class CoxeterGroups(Category_singleton):
                 sage: W = WeylGroup(["A", 3])
                 sage: s = W.simple_reflections()
                 sage: w0 = s[1]
-                sage: w1 = s[1]*s[2]*s[3]
                 sage: w0.absolute_covers()
                 [
                 [0 0 1 0]  [0 1 0 0]  [0 0 0 1]  [0 1 0 0]  [0 1 0 0]
```



---

archive/issue_comments_434953.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@mwageringel](#comment:34):\n> I disagree with the recent changes. Using `OrderedDict` does not address the memory concerns that were brought up, as `OrderedDict` will internally store the insertion order in addition to the dictionary. Yet, as explained in [comment:15](#comment:15), storing 1 set and 2 lists should usually be more memory efficient than storing 2 ordered dicts. It is faster than using `OrderedDict` too, especially in Python 2. So I would prefer to go back to the old branch.\n\nI don't have strong feelings either way, but I would very much like to get this resolved. Is the old branch good enough? You proposed some other explicit changes in [comment:15](#comment:15), along with \"This solution should also be applied to the generic (non-graded) case.\"\n\nBy the way, is there a good way to test memory usage, say something analogous to `%timeit`?",
    "created_at": "2019-08-27T18:47:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434953",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@mwageringel](#comment:34):
> I disagree with the recent changes. Using `OrderedDict` does not address the memory concerns that were brought up, as `OrderedDict` will internally store the insertion order in addition to the dictionary. Yet, as explained in [comment:15](#comment:15), storing 1 set and 2 lists should usually be more memory efficient than storing 2 ordered dicts. It is faster than using `OrderedDict` too, especially in Python 2. So I would prefer to go back to the old branch.

I don't have strong feelings either way, but I would very much like to get this resolved. Is the old branch good enough? You proposed some other explicit changes in [comment:15](#comment:15), along with "This solution should also be applied to the generic (non-graded) case."

By the way, is there a good way to test memory usage, say something analogous to `%timeit`?



---

archive/issue_comments_434954.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@jhpalmieri](#comment:36):\n> I don't have strong feelings either way, but I would very much like to get this resolved. Is the old branch good enough?\n\nNo \u2013 to be more precise, my criticism is just about commit `9c19a38` introducing the use of `OrderedDict`. All the other changes on the current branch look good to me and I will review them positively. The remaining doctest failures are not caused by `OrderedDict` specifically, but by the change in iteration order in general, so should still be fixed:\n\n```\nsage/categories/coxeter_groups.py\nsage/categories/finite_complex_reflection_groups.py\n```\n\n> You proposed some other explicit changes in [comment:15](#comment:15), along with \"This solution should also be applied to the generic (non-graded) case.\"\n\nYes, I still think those changes would be useful, but since this ticket is primarily concerned with making the tests pass with Python 3, let us keep those changes for a follow-up ticket. Changing the non-graded case would probably entail new doctest failures.\n\n> By the way, is there a good way to test memory usage, say something analogous to `%timeit`?\n\nNot that I know of. You can use `sys.getsizeof()` to get the (shallow) size in bytes of an object, but it only works for types that implement `__sizeof__` (built-in types do so).",
    "created_at": "2019-08-28T18:30:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434954",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@jhpalmieri](#comment:36):
> I don't have strong feelings either way, but I would very much like to get this resolved. Is the old branch good enough?

No – to be more precise, my criticism is just about commit `9c19a38` introducing the use of `OrderedDict`. All the other changes on the current branch look good to me and I will review them positively. The remaining doctest failures are not caused by `OrderedDict` specifically, but by the change in iteration order in general, so should still be fixed:

```
sage/categories/coxeter_groups.py
sage/categories/finite_complex_reflection_groups.py
```

> You proposed some other explicit changes in [comment:15](#comment:15), along with "This solution should also be applied to the generic (non-graded) case."

Yes, I still think those changes would be useful, but since this ticket is primarily concerned with making the tests pass with Python 3, let us keep those changes for a follow-up ticket. Changing the non-graded case would probably entail new doctest failures.

> By the way, is there a good way to test memory usage, say something analogous to `%timeit`?

Not that I know of. You can use `sys.getsizeof()` to get the (shallow) size in bytes of an object, but it only works for types that implement `__sizeof__` (built-in types do so).



---

archive/issue_comments_434955.json:
```json
{
    "body": "Changed commit from **[`22c2c91`](https://github.com/sagemath/sagetrac-mirror/commit/22c2c91a0f141c48194fcda5ef92ec08bc3f9e0f)** to **[`870441e`](https://github.com/sagemath/sagetrac-mirror/commit/870441e4e0446fd3c76de929ea368bd918026eca)**",
    "created_at": "2019-08-29T08:25:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434955",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`22c2c91`](https://github.com/sagemath/sagetrac-mirror/commit/22c2c91a0f141c48194fcda5ef92ec08bc3f9e0f)** to **[`870441e`](https://github.com/sagemath/sagetrac-mirror/commit/870441e4e0446fd3c76de929ea368bd918026eca)**



---

archive/issue_comments_434956.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/870441e4e0446fd3c76de929ea368bd918026eca\"><code>870441e</code></a></td><td><code>27967: remove py2/py3 tags since output is the same</code></td></tr></table>\n",
    "created_at": "2019-08-29T08:25:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434956",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/870441e4e0446fd3c76de929ea368bd918026eca"><code>870441e</code></a></td><td><code>27967: remove py2/py3 tags since output is the same</code></td></tr></table>




---

archive/issue_comments_434957.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nJust forced push my branch after removing commit \u200b9c19a38 but keeping \u200bcommit 22c2c91 whose hash is now \u200b870441e. Needs review.",
    "created_at": "2019-08-29T08:28:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434957",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:39" align="right">comment:39</div>

Just forced push my branch after removing commit ​9c19a38 but keeping ​commit 22c2c91 whose hash is now ​870441e. Needs review.



---

archive/issue_comments_434958.json:
```json
{
    "body": "Changed branch from **[u/slabbe/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/27967)** to **[u/jhpalmieri/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/27967)**",
    "created_at": "2019-08-29T16:32:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434958",
    "user": "https://github.com/jhpalmieri"
}
```

Changed branch from **[u/slabbe/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/27967)** to **[u/jhpalmieri/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/27967)**



---

archive/issue_comments_434959.json:
```json
{
    "body": "Changed commit from **[`870441e`](https://github.com/sagemath/sagetrac-mirror/commit/870441e4e0446fd3c76de929ea368bd918026eca)** to **[`f2c51a8`](https://github.com/sagemath/sagetrac-mirror/commit/f2c51a869c60559a47bb51e3592c9b71bb095068)**",
    "created_at": "2019-08-29T16:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434959",
    "user": "https://github.com/jhpalmieri"
}
```

Changed commit from **[`870441e`](https://github.com/sagemath/sagetrac-mirror/commit/870441e4e0446fd3c76de929ea368bd918026eca)** to **[`f2c51a8`](https://github.com/sagemath/sagetrac-mirror/commit/f2c51a869c60559a47bb51e3592c9b71bb095068)**



---

archive/issue_comments_434960.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nHere are fixes for the doctests in `categories`.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/90762a42b029f6c58055a1d9728de2925eec75f2\"><code>90762a4</code></a></td><td><code>Trac #27967: In RecursivelyEnumeratedSet_gra...</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f8288d97bcfa1d09d1d905162403cfc5238016c\"><code>7f8288d</code></a></td><td><code>Trac #27967: Adapt a root_lattice_realizations ...</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cc63a99ae6beabfd7ecbc94390eaf87c373a173\"><code>0cc63a9</code></a></td><td><code>Trac #27967: operator \"x in list\" being O(n) and ...</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9959e157fb877b8d6a26bd6e83d9940aafb0fc9e\"><code>9959e15</code></a></td><td><code>trac 27967: Make `_coerce_map_from_` consistent with documentation.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1420f3589990f0e32db247d3df39f1be24fade04\"><code>1420f35</code></a></td><td><code>Trac #27967: Fix doctests to be consistent ...</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/53a81f0971156bb488b270df525beb75911147ed\"><code>53a81f0</code></a></td><td><code>27967: remove py2/py3 tags since output is the same</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2c51a869c60559a47bb51e3592c9b71bb095068\"><code>f2c51a8</code></a></td><td><code>trac 27967: doctest fixes in categories</code></td></tr></table>\n",
    "created_at": "2019-08-29T16:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434960",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:41" align="right">comment:41</div>

Here are fixes for the doctests in `categories`.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/90762a42b029f6c58055a1d9728de2925eec75f2"><code>90762a4</code></a></td><td><code>Trac #27967: In RecursivelyEnumeratedSet_gra...</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f8288d97bcfa1d09d1d905162403cfc5238016c"><code>7f8288d</code></a></td><td><code>Trac #27967: Adapt a root_lattice_realizations ...</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cc63a99ae6beabfd7ecbc94390eaf87c373a173"><code>0cc63a9</code></a></td><td><code>Trac #27967: operator "x in list" being O(n) and ...</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9959e157fb877b8d6a26bd6e83d9940aafb0fc9e"><code>9959e15</code></a></td><td><code>trac 27967: Make `_coerce_map_from_` consistent with documentation.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1420f3589990f0e32db247d3df39f1be24fade04"><code>1420f35</code></a></td><td><code>Trac #27967: Fix doctests to be consistent ...</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/53a81f0971156bb488b270df525beb75911147ed"><code>53a81f0</code></a></td><td><code>27967: remove py2/py3 tags since output is the same</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2c51a869c60559a47bb51e3592c9b71bb095068"><code>f2c51a8</code></a></td><td><code>trac 27967: doctest fixes in categories</code></td></tr></table>




---

archive/issue_comments_434961.json:
```json
{
    "body": "Reviewer: **Vincent Klein, Markus Wageringel**",
    "created_at": "2019-08-29T21:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434961",
    "user": "https://github.com/mwageringel"
}
```

Reviewer: **Vincent Klein, Markus Wageringel**



---

archive/issue_events_385437.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2019-08-29T21:08:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27967#event-385437"
}
```



---

archive/issue_events_385438.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2019-08-29T21:08:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27967#event-385438"
}
```



---

archive/issue_comments_434962.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nThank you all. Everything looks good to me and all the relevant tests pass with both Python 2 and 3 on my end. I am setting this to positive, Vincent, assuming you agree.\n\nI am not sure what the stopgap ticket is about, though, or what needs to be done with it.",
    "created_at": "2019-08-29T21:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434962",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:42" align="right">comment:42</div>

Thank you all. Everything looks good to me and all the relevant tests pass with both Python 2 and 3 on my end. I am setting this to positive, Vincent, assuming you agree.

I am not sure what the stopgap ticket is about, though, or what needs to be done with it.



---

archive/issue_comments_434963.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nThe stopgap can be closed. It was in case this ticket didn't get resolved soon: just fixes to Python 3 doctests with no changes to the code.",
    "created_at": "2019-08-29T21:55:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434963",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:43" align="right">comment:43</div>

The stopgap can be closed. It was in case this ticket didn't get resolved soon: just fixes to Python 3 doctests with no changes to the code.



---

archive/issue_comments_434964.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/27967)** to **[`f2c51a8`](https://github.com/sagemath/sagetrac-mirror/commit/f2c51a869c60559a47bb51e3592c9b71bb095068)**",
    "created_at": "2019-09-05T21:33:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434964",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jhpalmieri/27967](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/27967)** to **[`f2c51a8`](https://github.com/sagemath/sagetrac-mirror/commit/f2c51a869c60559a47bb51e3592c9b71bb095068)**



---

archive/issue_events_385439.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-09-05T21:33:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27967#event-385439"
}
```



---

archive/issue_events_385440.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "680f0c59fe307acfb3d805b264e8bd770c922acf",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-09-05T21:33:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27967#event-385440"
}
```



---

archive/issue_comments_434965.json:
```json
{
    "body": "Changed commit from **[`f2c51a8`](https://github.com/sagemath/sagetrac-mirror/commit/f2c51a869c60559a47bb51e3592c9b71bb095068)** to none",
    "created_at": "2019-10-29T23:42:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434965",
    "user": "https://github.com/mwageringel"
}
```

Changed commit from **[`f2c51a8`](https://github.com/sagemath/sagetrac-mirror/commit/f2c51a869c60559a47bb51e3592c9b71bb095068)** to none



---

archive/issue_comments_434966.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nFollow-up ticket: #28674.",
    "created_at": "2019-10-29T23:42:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27967#issuecomment-434966",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:45" align="right">comment:45</div>

Follow-up ticket: #28674.
