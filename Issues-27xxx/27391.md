# Issue 27391: some additional checks about sws files

archive/issues_027154.json:
```json
{
    "body": "CC:  @embray @jdemeyer @dcoudert @tscrim @dimpase\n\nadding some sanity checks for the extraction of sws files.\n\n**Upstream bug**: https://bugs.python.org/issue21109\n\nIssue created by migration from https://trac.sagemath.org/ticket/27391\n\n",
    "closed_at": "2020-07-08T06:21:16Z",
    "created_at": "2019-03-01T13:27:03Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "some additional checks about sws files",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27391",
    "user": "https://github.com/fchapoton"
}
```
CC:  @embray @jdemeyer @dcoudert @tscrim @dimpase

adding some sanity checks for the extraction of sws files.

**Upstream bug**: https://bugs.python.org/issue21109

Issue created by migration from https://trac.sagemath.org/ticket/27391





---

archive/issue_comments_382101.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-03-01T13:27:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382101",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_382102.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-01T13:27:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382102",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_382103.json:
```json
{
    "body": "Does anybody have a better way to check that no file is extracted outside the directory ?",
    "created_at": "2019-03-01T19:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382103",
    "user": "https://github.com/fchapoton"
}
```

Does anybody have a better way to check that no file is extracted outside the directory ?



---

archive/issue_comments_382104.json:
```json
{
    "body": "You check that paths don't start with `\\\\`. Shouldn't you also check that it's not `/` ?\n\nAn alternative could be to build absolute paths (using `os.path.abspath`) and to check that each absolute path starts with the absolute path of extraction directory.",
    "created_at": "2019-03-02T07:56:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382104",
    "user": "https://github.com/dcoudert"
}
```

You check that paths don't start with `\\`. Shouldn't you also check that it's not `/` ?

An alternative could be to build absolute paths (using `os.path.abspath`) and to check that each absolute path starts with the absolute path of extraction directory.



---

archive/issue_comments_382105.json:
```json
{
    "body": "feel free to take over!",
    "created_at": "2019-03-02T08:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382105",
    "user": "https://github.com/fchapoton"
}
```

feel free to take over!



---

archive/issue_comments_382106.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2019-03-02T20:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382106",
    "user": "https://github.com/fchapoton"
}
```

Changing priority from major to critical.



---

archive/issue_comments_382107.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-03T07:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382107",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_382108.json:
```json
{
    "body": "better like that ?",
    "created_at": "2019-03-03T07:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382108",
    "user": "https://github.com/fchapoton"
}
```

better like that ?



---

archive/issue_comments_382109.json:
```json
{
    "body": "I think so, but I prefer to wait for other opinions. I don't know if one can use other tricks to put files in different directory.",
    "created_at": "2019-03-03T15:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382109",
    "user": "https://github.com/dcoudert"
}
```

I think so, but I prefer to wait for other opinions. I don't know if one can use other tricks to put files in different directory.



---

archive/issue_comments_382110.json:
```json
{
    "body": "Please have a look, Erik and Jeroen",
    "created_at": "2019-03-05T07:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382110",
    "user": "https://github.com/fchapoton"
}
```

Please have a look, Erik and Jeroen



---

archive/issue_comments_382111.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2019-03-05T07:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382111",
    "user": "https://github.com/fchapoton"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_382112.json:
```json
{
    "body": "Which problem is this ticket supposed to fix? There is very little explanation.",
    "created_at": "2019-03-05T11:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382112",
    "user": "https://github.com/jdemeyer"
}
```

Which problem is this ticket supposed to fix? There is very little explanation.



---

archive/issue_comments_382113.json:
```json
{
    "body": "I am going to forward you an email about that.",
    "created_at": "2019-03-05T11:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382113",
    "user": "https://github.com/fchapoton"
}
```

I am going to forward you an email about that.



---

archive/issue_comments_382114.json:
```json
{
    "body": "Changing component from refactoring to packages: standard.",
    "created_at": "2019-03-05T11:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382114",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from refactoring to packages: standard.



---

archive/issue_comments_382115.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-03-05T11:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382115",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_382116.json:
```json
{
    "body": "I think that this issue should be fixed in Python's `tarfile` module. Given that it's known since 2014, there is no way that this is a blocker. After reading the upstream issue, it's clear that there are many more potential problems than just paths starting with `/` or containing `..`. So this patch doesn't really fix the security hole.",
    "created_at": "2019-03-05T11:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382116",
    "user": "https://github.com/jdemeyer"
}
```

I think that this issue should be fixed in Python's `tarfile` module. Given that it's known since 2014, there is no way that this is a blocker. After reading the upstream issue, it's clear that there are many more potential problems than just paths starting with `/` or containing `..`. So this patch doesn't really fix the security hole.



---

archive/issue_comments_382117.json:
```json
{
    "body": "but it would be better than nothing, no ??",
    "created_at": "2019-03-08T13:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382117",
    "user": "https://github.com/fchapoton"
}
```

but it would be better than nothing, no ??



---

archive/issue_events_068023.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27391#event-68023"
}
```



---

archive/issue_comments_382118.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382118",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_382119.json:
```json
{
    "body": "so should we just close that one, or what ???",
    "created_at": "2019-04-05T15:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382119",
    "user": "https://github.com/fchapoton"
}
```

so should we just close that one, or what ???



---

archive/issue_comments_382120.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2019-04-05T15:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382120",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_382121.json:
```json
{
    "body": "I might just leave this open until this is fixed upstream.",
    "created_at": "2019-04-06T08:26:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382121",
    "user": "https://github.com/tscrim"
}
```

I might just leave this open until this is fixed upstream.



---

archive/issue_events_068024.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27391#event-68024"
}
```



---

archive/issue_events_068025.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27391#event-68025"
}
```



---

archive/issue_comments_382122.json:
```json
{
    "body": "Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382122",
    "user": "https://github.com/embray"
}
```

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_comments_382123.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382123",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_events_068026.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27391#event-68026"
}
```



---

archive/issue_events_068027.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27391#event-68027"
}
```



---

archive/issue_comments_382124.json:
```json
{
    "body": "Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.",
    "created_at": "2020-05-01T04:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382124",
    "user": "https://github.com/mkoeppe"
}
```

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.



---

archive/issue_events_068028.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T04:28:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27391#event-68028"
}
```



---

archive/issue_events_068029.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-05-01T04:28:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27391#event-68029"
}
```



---

archive/issue_comments_382125.json:
```json
{
    "body": "sagenb stuff, should be closed",
    "created_at": "2020-07-08T04:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382125",
    "user": "https://github.com/mkoeppe"
}
```

sagenb stuff, should be closed



---

archive/issue_comments_382126.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2020-07-08T04:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382126",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_events_068030.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-08T04:18:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27391#event-68030"
}
```



---

archive/issue_events_068031.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-08T04:18:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27391#event-68031"
}
```



---

archive/issue_events_068032.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-07-08T06:21:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27391#event-68032"
}
```



---

archive/issue_comments_382127.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2020-07-08T06:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27391",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27391#issuecomment-382127",
    "user": "https://github.com/fchapoton"
}
```

Resolution: invalid
