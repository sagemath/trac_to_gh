# Issue 27764: configure threading in flint in sync with NTL

archive/issues_027527.json:
```json
{
    "assignees": [],
    "body": "By default, TLS (aka Thread-Local Storage) is enabled in flint.\nHowever, it contradicts to NTL configured without threads (`NTL_THREADS=off`), and in particular non-GNU linkers might refuse to link flint\n(actually happens on FreeBSD). \n\nAlso happens on macOS -- see for example https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/VkAv7bG6DAAJ\n\n\n\nSee also:\n- #29339 Fix NTL spkg-configure.m4 so it rejects NTLs built with NTL_THREADS\n- #29267 enabling thread safety for NTL\n- #30388 homebrew: Add flint\n\n\nCC:  @embray @kiwifb @mkoeppe @dcoudert\n\nBranch/Commit: **[u/dimpase/packages/flint-no-tls](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/flint-no-tls) @ [2945e30](https://github.com/sagemath/sagetrac-mirror/commit/2945e3041ab2a4d766b3d0bd345087c2f9e6ee03)**\n\nAuthor: **Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/27764_\n\n",
    "created_at": "2019-05-03T16:00:55Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20info"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "configure threading in flint in sync with NTL",
    "type": "issue",
    "updated_at": "2022-09-19T18:58:47Z",
    "url": "https://github.com/sagemath/sage/issues/27764",
    "user": "https://github.com/dimpase"
}
```
By default, TLS (aka Thread-Local Storage) is enabled in flint.
However, it contradicts to NTL configured without threads (`NTL_THREADS=off`), and in particular non-GNU linkers might refuse to link flint
(actually happens on FreeBSD). 

Also happens on macOS -- see for example https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/VkAv7bG6DAAJ



See also:
- #29339 Fix NTL spkg-configure.m4 so it rejects NTLs built with NTL_THREADS
- #29267 enabling thread safety for NTL
- #30388 homebrew: Add flint


CC:  @embray @kiwifb @mkoeppe @dcoudert

Branch/Commit: **[u/dimpase/packages/flint-no-tls](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/flint-no-tls) @ [2945e30](https://github.com/sagemath/sagetrac-mirror/commit/2945e3041ab2a4d766b3d0bd345087c2f9e6ee03)**

Author: **Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/27764_





---

archive/issue_events_362709.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-03T16:00:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362709"
}
```



---

archive/issue_events_362710.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-03T16:00:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362710"
}
```



---

archive/issue_events_362711.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-03T16:00:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362711"
}
```



---

archive/issue_events_362712.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-03T16:00:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362712"
}
```



---

archive/issue_comments_433786.json:
```json
{
    "body": "Branch: **[u/dimpase/packages/flint-no-tls](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/flint-no-tls)**",
    "created_at": "2019-05-03T16:06:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433786",
    "user": "https://github.com/dimpase"
}
```

Branch: **[u/dimpase/packages/flint-no-tls](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/flint-no-tls)**



---

archive/issue_comments_433787.json:
```json
{
    "body": "Author: **Dima Pasechnik**",
    "created_at": "2019-05-03T16:06:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433787",
    "user": "https://github.com/dimpase"
}
```

Author: **Dima Pasechnik**



---

archive/issue_comments_433788.json:
```json
{
    "body": "Commit: **[386dd3f](https://github.com/sagemath/sagetrac-mirror/commit/386dd3fd7899d9b861fa6cc8fbe0b56e62242ce6)**",
    "created_at": "2019-05-03T16:06:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433788",
    "user": "https://github.com/dimpase"
}
```

Commit: **[386dd3f](https://github.com/sagemath/sagetrac-mirror/commit/386dd3fd7899d9b861fa6cc8fbe0b56e62242ce6)**



---

archive/issue_comments_433789.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/386dd3fd7899d9b861fa6cc8fbe0b56e62242ce6\">386dd3f</a></td><td><code>disable TLS in flint</code></td></tr></table>\n",
    "created_at": "2019-05-03T16:06:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433789",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:1" align="right">Comment 1</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/386dd3fd7899d9b861fa6cc8fbe0b56e62242ce6">386dd3f</a></td><td><code>disable TLS in flint</code></td></tr></table>




---

archive/issue_events_362713.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-03T16:28:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362713"
}
```



---

archive/issue_comments_433790.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nBy default the latest `ntl` should use threads - when the compiler is C++11 capable. Is it disabled on some OS/archs?",
    "created_at": "2019-05-03T20:08:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433790",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:3" align="right">Comment 3</div>

By default the latest `ntl` should use threads - when the compiler is C++11 capable. Is it disabled on some OS/archs?



---

archive/issue_comments_433791.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nthis is what Sage does, it disables threads in NTL. \nhttps://github.com/sagemath/sage/blob/5ba5a5a40cd33901c5f4307d59aa68a4359b0430/build/pkgs/ntl/spkg-install#L103",
    "created_at": "2019-05-03T20:27:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433791",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:4" align="right">Comment 4</div>

this is what Sage does, it disables threads in NTL. 
https://github.com/sagemath/sage/blob/5ba5a5a40cd33901c5f4307d59aa68a4359b0430/build/pkgs/ntl/spkg-install#L103



---

archive/issue_comments_433792.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nan intelligent setup would sync this between dependencies automatically, but this seems to be not so easy.",
    "created_at": "2019-05-03T20:34:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433792",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:5" align="right">Comment 5</div>

an intelligent setup would sync this between dependencies automatically, but this seems to be not so easy.



---

archive/issue_comments_433793.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nReplying to [@dimpase](#comment%3A4):\n> this is what Sage does, it disables threads in NTL. \n> https://github.com/sagemath/sage/blob/5ba5a5a40cd33901c5f4307d59aa68a4359b0430/build/pkgs/ntl/spkg-install#L103\n\nWell, we shouldn't anymore. I should have taken care of this during the ntl upgrade and things about C++11 standard. Unless there is a compelling reason to do so, I would recommend removing `NTL_THREADS=off` from ntl's spkg-install.",
    "created_at": "2019-05-03T20:37:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433793",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:6" align="right">Comment 6</div>

Replying to [@dimpase](#comment%3A4):
> this is what Sage does, it disables threads in NTL. 
> https://github.com/sagemath/sage/blob/5ba5a5a40cd33901c5f4307d59aa68a4359b0430/build/pkgs/ntl/spkg-install#L103

Well, we shouldn't anymore. I should have taken care of this during the ntl upgrade and things about C++11 standard. Unless there is a compelling reason to do so, I would recommend removing `NTL_THREADS=off` from ntl's spkg-install.



---

archive/issue_comments_433794.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nOn the other hand, flint's configuration system is un-impressive to me. And flint uses C++ for a grand total of compiling one file for the ntl interface. Which is optional. I have no idea if this is useful for anything.",
    "created_at": "2019-05-03T20:44:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433794",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:7" align="right">Comment 7</div>

On the other hand, flint's configuration system is un-impressive to me. And flint uses C++ for a grand total of compiling one file for the ntl interface. Which is optional. I have no idea if this is useful for anything.



---

archive/issue_events_362714.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2019-05-03T20:54:16Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "title_is": "configure threading in flint in sync with NTL",
    "title_was": "configure flint with --disable-tls",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362714"
}
```



---

archive/issue_comments_433795.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nflint\u2019s interface to NTL is used in sagelib. So it cannot just be switched off.",
    "created_at": "2019-05-03T20:55:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433795",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">Comment 9</div>

flint’s interface to NTL is used in sagelib. So it cannot just be switched off.



---

archive/issue_comments_433796.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nReplying to [@dimpase](#comment%3A9):\n> flint\u2019s interface to NTL is used in sagelib. So it cannot just be switched off.\n\nOK. That make something clearer to me.",
    "created_at": "2019-05-03T20:58:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433796",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:10" align="right">Comment 10</div>

Replying to [@dimpase](#comment%3A9):
> flint’s interface to NTL is used in sagelib. So it cannot just be switched off.

OK. That make something clearer to me.



---

archive/issue_comments_433797.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nMoving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433797",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">Comment 11</div>

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_events_362715.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:37:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362715"
}
```



---

archive/issue_events_362716.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:37:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362716"
}
```



---

archive/issue_comments_433798.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nNeeds rebasing.",
    "created_at": "2019-07-16T23:47:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433798",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:12" align="right">Comment 12</div>

Needs rebasing.



---

archive/issue_comments_433799.json:
```json
{
    "body": "Changed commit from **[386dd3f](https://github.com/sagemath/sagetrac-mirror/commit/386dd3fd7899d9b861fa6cc8fbe0b56e62242ce6)** to **[2945e30](https://github.com/sagemath/sagetrac-mirror/commit/2945e3041ab2a4d766b3d0bd345087c2f9e6ee03)**",
    "created_at": "2019-07-17T09:25:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433799",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[386dd3f](https://github.com/sagemath/sagetrac-mirror/commit/386dd3fd7899d9b861fa6cc8fbe0b56e62242ce6)** to **[2945e30](https://github.com/sagemath/sagetrac-mirror/commit/2945e3041ab2a4d766b3d0bd345087c2f9e6ee03)**



---

archive/issue_comments_433800.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2945e3041ab2a4d766b3d0bd345087c2f9e6ee03\">2945e30</a></td><td><code>disable TLS in flint</code></td></tr></table>\n",
    "created_at": "2019-07-17T09:25:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433800",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13" align="right">Comment 13</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2945e3041ab2a4d766b3d0bd345087c2f9e6ee03">2945e30</a></td><td><code>disable TLS in flint</code></td></tr></table>




---

archive/issue_comments_433801.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nOK, done.",
    "created_at": "2019-07-17T09:25:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433801",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:14" align="right">Comment 14</div>

OK, done.



---

archive/issue_comments_433802.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nOK now that I see again what was done and that I remember the conversation let's move on a bit. There are two options\n\n* enabling threads in NTL and letting flint do the same\n* leaving threads disabled in NTL and applying this ticket\n\nIs there any reason or platforms preventing us from enabling threads in NTL? We historically disabled threads in NTL because it relied on C++11 and we weren't on board with it for all packages and that was causing problems on downstream packages where c++11 wasn't on. This should be solved now. So is there another reason we cannot enable threads in NTL?",
    "created_at": "2019-07-18T02:10:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433802",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:15" align="right">Comment 15</div>

OK now that I see again what was done and that I remember the conversation let's move on a bit. There are two options

* enabling threads in NTL and letting flint do the same
* leaving threads disabled in NTL and applying this ticket

Is there any reason or platforms preventing us from enabling threads in NTL? We historically disabled threads in NTL because it relied on C++11 and we weren't on board with it for all packages and that was causing problems on downstream packages where c++11 wasn't on. This should be solved now. So is there another reason we cannot enable threads in NTL?



---

archive/issue_comments_433803.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nI suppose enabling threads in NTL and flint, and all its dependencies e.g. arb, needs testing on all platforms we claim to support.",
    "created_at": "2019-07-18T08:18:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433803",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:16" align="right">Comment 16</div>

I suppose enabling threads in NTL and flint, and all its dependencies e.g. arb, needs testing on all platforms we claim to support.



---

archive/issue_comments_433804.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nThat's a bot job. Literally. We should make a threading branch and see how the patch bots likes it.",
    "created_at": "2019-07-18T08:21:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433804",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:17" align="right">Comment 17</div>

That's a bot job. Literally. We should make a threading branch and see how the patch bots likes it.



---

archive/issue_events_362717.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362717"
}
```



---

archive/issue_events_362718.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362718"
}
```



---

archive/issue_comments_433805.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433805",
    "user": "https://github.com/embray"
}
```

<div id="comment:18" align="right">Comment 18</div>

Ticket retargeted after milestone closed



---

archive/issue_comments_433806.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nAlso related: build errors with Singular if NTL is threaded (see #29339/#29104).",
    "created_at": "2020-03-15T18:20:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433806",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">Comment 20</div>

Also related: build errors with Singular if NTL is threaded (see #29339/#29104).



---

archive/issue_comments_433807.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nReplying to [@kiwifb](#comment%3A17):\n> We should make a threading branch and see how the patch bots likes it.\n\nI have created ticket #29340 for this purpose. \nIf someone wants to work on this (this requires fixing the problem with SIngular...),\nI'll be happy to test it using the new [GitHub](../wiki/GitHub) CI infrastructure.",
    "created_at": "2020-03-15T18:29:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433807",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">Comment 21</div>

Replying to [@kiwifb](#comment%3A17):
> We should make a threading branch and see how the patch bots likes it.

I have created ticket #29340 for this purpose. 
If someone wants to work on this (this requires fixing the problem with SIngular...),
I'll be happy to test it using the new [GitHub](../wiki/GitHub) CI infrastructure.



---

archive/issue_comments_433808.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nFor the present ticket -- is there any platform other than FreeBSD where this has been observed to be a problem?",
    "created_at": "2020-03-15T18:30:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433808",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">Comment 22</div>

For the present ticket -- is there any platform other than FreeBSD where this has been observed to be a problem?



---

archive/issue_events_362719.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-18T16:46:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362719"
}
```



---

archive/issue_events_362720.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-18T16:46:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362720"
}
```



---

archive/issue_events_362721.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-18T16:46:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362721"
}
```



---

archive/issue_events_362722.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-18T16:46:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362722"
}
```



---

archive/issue_events_362723.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362723"
}
```



---

archive/issue_events_362724.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362724"
}
```



---

archive/issue_comments_433809.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nyes, this happens on macOS 10.15 too, it seems\n\n```\n[sagelib-9.2.beta9] clang++ -bundle -undefined dynamic_lookup -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -L/Users/dima/software/sagetrac-mirror/local/lib -Wl,-rpath,/Users/dima/software/sagetrac-mirror/local/lib build/temp.macosx-10.15-x86_64-3.7/build/cythonized/sage/matrix/matrix_integer_sparse.o -L/usr/local/Cellar/openblas/0.3.10_1/lib -L/Users/dima/software/sagetrac-mirror/local/lib -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -llinbox -lntl -liml -lfflas -lffpack -lgivaro -lflint -lmpfr -lgmp -lgmpxx -lopenblas -o build/lib.macosx-10.15-x86_64-3.7/sage/matrix/matrix_integer_sparse.cpython-37m-darwin.so -lpari\n[sagelib-9.2.beta9] ld: illegal thread local variable reference to regular symbol __ZN3NTL20ZZXFac_InitNumPrimesE for architecture x86_64\n```",
    "created_at": "2020-08-23T09:09:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433809",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:25" align="right">Comment 25</div>

yes, this happens on macOS 10.15 too, it seems

```
[sagelib-9.2.beta9] clang++ -bundle -undefined dynamic_lookup -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -L/Users/dima/software/sagetrac-mirror/local/lib -Wl,-rpath,/Users/dima/software/sagetrac-mirror/local/lib build/temp.macosx-10.15-x86_64-3.7/build/cythonized/sage/matrix/matrix_integer_sparse.o -L/usr/local/Cellar/openblas/0.3.10_1/lib -L/Users/dima/software/sagetrac-mirror/local/lib -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -llinbox -lntl -liml -lfflas -lffpack -lgivaro -lflint -lmpfr -lgmp -lgmpxx -lopenblas -o build/lib.macosx-10.15-x86_64-3.7/sage/matrix/matrix_integer_sparse.cpython-37m-darwin.so -lpari
[sagelib-9.2.beta9] ld: illegal thread local variable reference to regular symbol __ZN3NTL20ZZXFac_InitNumPrimesE for architecture x86_64
```



---

archive/issue_comments_433810.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,13 @@\n By default, TLS (aka Thread-Local Storage) is enabled in flint.\n However, it contradicts to NTL configured without threads (`NTL_THREADS=off`), and in particular non-GNU linkers might refuse to link flint\n (actually happens on FreeBSD). \n+\n+Also happens on macOS -- see for example https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/VkAv7bG6DAAJ\n+\n+\n+\n+See also:\n+- #29339 Fix NTL spkg-configure.m4 so it rejects NTLs built with NTL_THREADS\n+- #29267 enabling thread safety for NTL\n+\n+\n``````\n",
    "created_at": "2020-09-09T01:17:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433810",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,13 @@
 By default, TLS (aka Thread-Local Storage) is enabled in flint.
 However, it contradicts to NTL configured without threads (`NTL_THREADS=off`), and in particular non-GNU linkers might refuse to link flint
 (actually happens on FreeBSD). 
+
+Also happens on macOS -- see for example https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/VkAv7bG6DAAJ
+
+
+
+See also:
+- #29339 Fix NTL spkg-configure.m4 so it rejects NTLs built with NTL_THREADS
+- #29267 enabling thread safety for NTL
+
+
``````




---

archive/issue_events_362725.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-09T01:17:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362725"
}
```



---

archive/issue_events_362726.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-09T01:17:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362726"
}
```



---

archive/issue_events_362727.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-09T01:17:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362727"
}
```



---

archive/issue_events_362728.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-09T01:17:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362728"
}
```



---

archive/issue_comments_433811.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,5 +9,5 @@\n See also:\n - #29339 Fix NTL spkg-configure.m4 so it rejects NTLs built with NTL_THREADS\n - #29267 enabling thread safety for NTL\n+- #30388 homebrew: Add flint\n \n-\n``````\n",
    "created_at": "2020-09-09T01:28:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433811",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,5 +9,5 @@
 See also:
 - #29339 Fix NTL spkg-configure.m4 so it rejects NTLs built with NTL_THREADS
 - #29267 enabling thread safety for NTL
+- #30388 homebrew: Add flint
 
-
``````




---

archive/issue_comments_433812.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nfrom what I recall - I was able to build and test Sage 9.2.beta12 on Homebrew macOS 10.15.6\nusing Homebrew's Flint and NTL, which do come with threads enabled. (Unfortunately the machine is bricked now, so I can't verify).\nMoving this to 9.3.",
    "created_at": "2020-10-07T10:22:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433812",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:28" align="right">Comment 28</div>

from what I recall - I was able to build and test Sage 9.2.beta12 on Homebrew macOS 10.15.6
using Homebrew's Flint and NTL, which do come with threads enabled. (Unfortunately the machine is bricked now, so I can't verify).
Moving this to 9.3.



---

archive/issue_events_362729.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-10-07T10:22:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362729"
}
```



---

archive/issue_events_362730.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-10-07T10:22:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362730"
}
```



---

archive/issue_events_362731.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-28T04:42:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362731"
}
```



---

archive/issue_events_362732.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-28T04:42:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362732"
}
```



---

archive/issue_events_362733.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362733"
}
```



---

archive/issue_events_362734.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362734"
}
```



---

archive/issue_comments_433813.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nSage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433813",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">Comment 30</div>

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_362735.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362735"
}
```



---

archive/issue_events_362736.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362736"
}
```



---

archive/issue_comments_433814.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433814",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:31" align="right">Comment 31</div>

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_433815.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nStalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/27764#issuecomment-433815",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">Comment 32</div>

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_events_362737.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362737"
}
```



---

archive/issue_events_362738.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362738"
}
```



---

archive/issue_events_362739.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362739"
}
```



---

archive/issue_events_362740.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362740"
}
```



---

archive/issue_events_362741.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362741"
}
```



---

archive/issue_events_362742.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/27764",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/27764#event-362742"
}
```
