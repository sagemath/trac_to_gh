# Issue 27764: configure threading in flint in sync with NTL

archive/issues_027527.json:
```json
{
    "body": "By default, TLS (aka Thread-Local Storage) is enabled in flint.\nHowever, it contradicts to NTL configured without threads (`NTL_THREADS=off`), and in particular non-GNU linkers might refuse to link flint\n(actually happens on FreeBSD). \n\nAlso happens on macOS -- see for example https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/VkAv7bG6DAAJ\n\n\n\nSee also:\n- #29339 Fix NTL spkg-configure.m4 so it rejects NTLs built with NTL_THREADS\n- #29267 enabling thread safety for NTL\n- #30388 homebrew: Add flint\n\n\n**CC:**  @embray @kiwifb @mkoeppe @dcoudert\n\n**Branch:** [u/dimpase/packages/flint-no-tls](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/flint-no-tls)\n\n**Commit:** [2945e3041ab2a4d766b3d0bd345087c2f9e6ee03](https://github.com/sagemath/sagetrac-mirror/commit/2945e3041ab2a4d766b3d0bd345087c2f9e6ee03)\n\n**Author:** Dima Pasechnik\n\n**Status:** needs_info\n\nIssue created by migration from https://trac.sagemath.org/ticket/27764\n\n",
    "created_at": "2019-05-03T16:00:55Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "configure threading in flint in sync with NTL",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27764",
    "user": "https://github.com/dimpase"
}
```
By default, TLS (aka Thread-Local Storage) is enabled in flint.
However, it contradicts to NTL configured without threads (`NTL_THREADS=off`), and in particular non-GNU linkers might refuse to link flint
(actually happens on FreeBSD). 

Also happens on macOS -- see for example https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/VkAv7bG6DAAJ



See also:
- #29339 Fix NTL spkg-configure.m4 so it rejects NTLs built with NTL_THREADS
- #29267 enabling thread safety for NTL
- #30388 homebrew: Add flint


**CC:**  @embray @kiwifb @mkoeppe @dcoudert

**Branch:** [u/dimpase/packages/flint-no-tls](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/flint-no-tls)

**Commit:** [2945e3041ab2a4d766b3d0bd345087c2f9e6ee03](https://github.com/sagemath/sagetrac-mirror/commit/2945e3041ab2a4d766b3d0bd345087c2f9e6ee03)

**Author:** Dima Pasechnik

**Status:** needs_info

Issue created by migration from https://trac.sagemath.org/ticket/27764





---

archive/issue_comments_512450.json:
```json
{
    "body": "**Branch:** [u/dimpase/packages/flint-no-tls](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/flint-no-tls)",
    "created_at": "2019-05-03T16:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512450",
    "user": "https://github.com/dimpase"
}
```

**Branch:** [u/dimpase/packages/flint-no-tls](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/packages/flint-no-tls)



---

archive/issue_comments_512451.json:
```json
{
    "body": "**Author:** Dima Pasechnik",
    "created_at": "2019-05-03T16:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512451",
    "user": "https://github.com/dimpase"
}
```

**Author:** Dima Pasechnik



---

archive/issue_comments_512452.json:
```json
{
    "body": "**Commit:** [386dd3fd7899d9b861fa6cc8fbe0b56e62242ce6](https://github.com/sagemath/sagetrac-mirror/commit/386dd3fd7899d9b861fa6cc8fbe0b56e62242ce6)",
    "created_at": "2019-05-03T16:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512452",
    "user": "https://github.com/dimpase"
}
```

**Commit:** [386dd3fd7899d9b861fa6cc8fbe0b56e62242ce6](https://github.com/sagemath/sagetrac-mirror/commit/386dd3fd7899d9b861fa6cc8fbe0b56e62242ce6)



---

archive/issue_comments_512453.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/386dd3fd7899d9b861fa6cc8fbe0b56e62242ce6\">386dd3f</a></td><td><code>disable TLS in flint</code></td></tr></table>\n",
    "created_at": "2019-05-03T16:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512453",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/386dd3fd7899d9b861fa6cc8fbe0b56e62242ce6">386dd3f</a></td><td><code>disable TLS in flint</code></td></tr></table>




---

archive/issue_comments_512454.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2019-05-03T16:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512454",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_512455.json:
```json
{
    "body": "<a id='comment:3'></a>\nBy default the latest `ntl` should use threads - when the compiler is C++11 capable. Is it disabled on some OS/archs?",
    "created_at": "2019-05-03T20:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512455",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
By default the latest `ntl` should use threads - when the compiler is C++11 capable. Is it disabled on some OS/archs?



---

archive/issue_comments_512456.json:
```json
{
    "body": "<a id='comment:4'></a>\nthis is what Sage does, it disables threads in NTL. \nhttps://github.com/sagemath/sage/blob/5ba5a5a40cd33901c5f4307d59aa68a4359b0430/build/pkgs/ntl/spkg-install#L103",
    "created_at": "2019-05-03T20:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512456",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>
this is what Sage does, it disables threads in NTL. 
https://github.com/sagemath/sage/blob/5ba5a5a40cd33901c5f4307d59aa68a4359b0430/build/pkgs/ntl/spkg-install#L103



---

archive/issue_comments_512457.json:
```json
{
    "body": "<a id='comment:5'></a>\nan intelligent setup would sync this between dependencies automatically, but this seems to be not so easy.",
    "created_at": "2019-05-03T20:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512457",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
an intelligent setup would sync this between dependencies automatically, but this seems to be not so easy.



---

archive/issue_comments_512458.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [dimpase](#comment%3A4):\n> this is what Sage does, it disables threads in NTL. \n> https://github.com/sagemath/sage/blob/5ba5a5a40cd33901c5f4307d59aa68a4359b0430/build/pkgs/ntl/spkg-install#L103\n\n\nWell, we shouldn't anymore. I should have taken care of this during the ntl upgrade and things about C++11 standard. Unless there is a compelling reason to do so, I would recommend removing `NTL_THREADS=off` from ntl's spkg-install.",
    "created_at": "2019-05-03T20:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512458",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
Replying to [dimpase](#comment%3A4):
> this is what Sage does, it disables threads in NTL. 
> https://github.com/sagemath/sage/blob/5ba5a5a40cd33901c5f4307d59aa68a4359b0430/build/pkgs/ntl/spkg-install#L103


Well, we shouldn't anymore. I should have taken care of this during the ntl upgrade and things about C++11 standard. Unless there is a compelling reason to do so, I would recommend removing `NTL_THREADS=off` from ntl's spkg-install.



---

archive/issue_comments_512459.json:
```json
{
    "body": "<a id='comment:7'></a>\nOn the other hand, flint's configuration system is un-impressive to me. And flint uses C++ for a grand total of compiling one file for the ntl interface. Which is optional. I have no idea if this is useful for anything.",
    "created_at": "2019-05-03T20:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512459",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
On the other hand, flint's configuration system is un-impressive to me. And flint uses C++ for a grand total of compiling one file for the ntl interface. Which is optional. I have no idea if this is useful for anything.



---

archive/issue_events_078394.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "rename": {
        "from": "configure flint with --disable-tls",
        "to": "configure threading in flint in sync with NTL"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78394"
}
```



---

archive/issue_comments_512460.json:
```json
{
    "body": "<a id='comment:9'></a>\nflint\u2019s interface to NTL is used in sagelib. So it cannot just be switched off.",
    "created_at": "2019-05-03T20:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512460",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
flint’s interface to NTL is used in sagelib. So it cannot just be switched off.



---

archive/issue_comments_512461.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [dimpase](#comment%3A9):\n> flint\u2019s interface to NTL is used in sagelib. So it cannot just be switched off.\n\n\nOK. That make something clearer to me.",
    "created_at": "2019-05-03T20:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512461",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
Replying to [dimpase](#comment%3A9):
> flint’s interface to NTL is used in sagelib. So it cannot just be switched off.


OK. That make something clearer to me.



---

archive/issue_comments_512462.json:
```json
{
    "body": "<a id='comment:11'></a>\nMoving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512462",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>
Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_events_078395.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:37:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78395"
}
```



---

archive/issue_comments_512463.json:
```json
{
    "body": "<a id='comment:12'></a>\nNeeds rebasing.",
    "created_at": "2019-07-16T23:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512463",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>
Needs rebasing.



---

archive/issue_comments_512464.json:
```json
{
    "body": "**Changing commit** from \"[386dd3fd7899d9b861fa6cc8fbe0b56e62242ce6](https://github.com/sagemath/sagetrac-mirror/commit/386dd3fd7899d9b861fa6cc8fbe0b56e62242ce6)\" to \"[2945e3041ab2a4d766b3d0bd345087c2f9e6ee03](https://github.com/sagemath/sagetrac-mirror/commit/2945e3041ab2a4d766b3d0bd345087c2f9e6ee03)\".",
    "created_at": "2019-07-17T09:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512464",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[386dd3fd7899d9b861fa6cc8fbe0b56e62242ce6](https://github.com/sagemath/sagetrac-mirror/commit/386dd3fd7899d9b861fa6cc8fbe0b56e62242ce6)" to "[2945e3041ab2a4d766b3d0bd345087c2f9e6ee03](https://github.com/sagemath/sagetrac-mirror/commit/2945e3041ab2a4d766b3d0bd345087c2f9e6ee03)".



---

archive/issue_comments_512465.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2945e3041ab2a4d766b3d0bd345087c2f9e6ee03\">2945e30</a></td><td><code>disable TLS in flint</code></td></tr></table>\n",
    "created_at": "2019-07-17T09:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512465",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2945e3041ab2a4d766b3d0bd345087c2f9e6ee03">2945e30</a></td><td><code>disable TLS in flint</code></td></tr></table>




---

archive/issue_comments_512466.json:
```json
{
    "body": "<a id='comment:14'></a>\nOK, done.",
    "created_at": "2019-07-17T09:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512466",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>
OK, done.



---

archive/issue_comments_512467.json:
```json
{
    "body": "<a id='comment:15'></a>\nOK now that I see again what was done and that I remember the conversation let's move on a bit. There are two options\n\n* enabling threads in NTL and letting flint do the same\n* leaving threads disabled in NTL and applying this ticket\n\nIs there any reason or platforms preventing us from enabling threads in NTL? We historically disabled threads in NTL because it relied on C++11 and we weren't on board with it for all packages and that was causing problems on downstream packages where c++11 wasn't on. This should be solved now. So is there another reason we cannot enable threads in NTL?",
    "created_at": "2019-07-18T02:10:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512467",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>
OK now that I see again what was done and that I remember the conversation let's move on a bit. There are two options

* enabling threads in NTL and letting flint do the same
* leaving threads disabled in NTL and applying this ticket

Is there any reason or platforms preventing us from enabling threads in NTL? We historically disabled threads in NTL because it relied on C++11 and we weren't on board with it for all packages and that was causing problems on downstream packages where c++11 wasn't on. This should be solved now. So is there another reason we cannot enable threads in NTL?



---

archive/issue_comments_512468.json:
```json
{
    "body": "<a id='comment:16'></a>\nI suppose enabling threads in NTL and flint, and all its dependencies e.g. arb, needs testing on all platforms we claim to support.",
    "created_at": "2019-07-18T08:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512468",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>
I suppose enabling threads in NTL and flint, and all its dependencies e.g. arb, needs testing on all platforms we claim to support.



---

archive/issue_comments_512469.json:
```json
{
    "body": "<a id='comment:17'></a>\nThat's a bot job. Literally. We should make a threading branch and see how the patch bots likes it.",
    "created_at": "2019-07-18T08:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512469",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
That's a bot job. Literally. We should make a threading branch and see how the patch bots likes it.



---

archive/issue_events_078396.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78396"
}
```



---

archive/issue_events_078397.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78397"
}
```



---

archive/issue_comments_512470.json:
```json
{
    "body": "<a id='comment:18'></a>\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512470",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>
Ticket retargeted after milestone closed



---

archive/issue_comments_512471.json:
```json
{
    "body": "<a id='comment:20'></a>\nAlso related: build errors with Singular if NTL is threaded (see #29339/#29104).",
    "created_at": "2020-03-15T18:20:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512471",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>
Also related: build errors with Singular if NTL is threaded (see #29339/#29104).



---

archive/issue_comments_512472.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [fbissey](#comment%3A17):\n> We should make a threading branch and see how the patch bots likes it.\n\n\nI have created ticket #29340 for this purpose. \nIf someone wants to work on this (this requires fixing the problem with SIngular...),\nI'll be happy to test it using the new [GitHub](GitHub) CI infrastructure.",
    "created_at": "2020-03-15T18:29:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512472",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Replying to [fbissey](#comment%3A17):
> We should make a threading branch and see how the patch bots likes it.


I have created ticket #29340 for this purpose. 
If someone wants to work on this (this requires fixing the problem with SIngular...),
I'll be happy to test it using the new [GitHub](GitHub) CI infrastructure.



---

archive/issue_comments_512473.json:
```json
{
    "body": "<a id='comment:22'></a>\nFor the present ticket -- is there any platform other than FreeBSD where this has been observed to be a problem?",
    "created_at": "2020-03-15T18:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512473",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
For the present ticket -- is there any platform other than FreeBSD where this has been observed to be a problem?



---

archive/issue_events_078398.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-18T16:46:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78398"
}
```



---

archive/issue_events_078399.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-18T16:46:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78399"
}
```



---

archive/issue_comments_512474.json:
```json
{
    "body": "**Changing status** from needs_review to needs_info.",
    "created_at": "2020-04-18T16:46:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512474",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to needs_info.



---

archive/issue_events_078400.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78400"
}
```



---

archive/issue_events_078401.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78401"
}
```



---

archive/issue_comments_512475.json:
```json
{
    "body": "<a id='comment:25'></a>\nyes, this happens on macOS 10.15 too, it seems\n\n```\n[sagelib-9.2.beta9] clang++ -bundle -undefined dynamic_lookup -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -L/Users/dima/software/sagetrac-mirror/local/lib -Wl,-rpath,/Users/dima/software/sagetrac-mirror/local/lib build/temp.macosx-10.15-x86_64-3.7/build/cythonized/sage/matrix/matrix_integer_sparse.o -L/usr/local/Cellar/openblas/0.3.10_1/lib -L/Users/dima/software/sagetrac-mirror/local/lib -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -llinbox -lntl -liml -lfflas -lffpack -lgivaro -lflint -lmpfr -lgmp -lgmpxx -lopenblas -o build/lib.macosx-10.15-x86_64-3.7/sage/matrix/matrix_integer_sparse.cpython-37m-darwin.so -lpari\n[sagelib-9.2.beta9] ld: illegal thread local variable reference to regular symbol __ZN3NTL20ZZXFac_InitNumPrimesE for architecture x86_64\n```",
    "created_at": "2020-08-23T09:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512475",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'></a>
yes, this happens on macOS 10.15 too, it seems

```
[sagelib-9.2.beta9] clang++ -bundle -undefined dynamic_lookup -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -L/Users/dima/software/sagetrac-mirror/local/lib -Wl,-rpath,/Users/dima/software/sagetrac-mirror/local/lib build/temp.macosx-10.15-x86_64-3.7/build/cythonized/sage/matrix/matrix_integer_sparse.o -L/usr/local/Cellar/openblas/0.3.10_1/lib -L/Users/dima/software/sagetrac-mirror/local/lib -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -llinbox -lntl -liml -lfflas -lffpack -lgivaro -lflint -lmpfr -lgmp -lgmpxx -lopenblas -o build/lib.macosx-10.15-x86_64-3.7/sage/matrix/matrix_integer_sparse.cpython-37m-darwin.so -lpari
[sagelib-9.2.beta9] ld: illegal thread local variable reference to regular symbol __ZN3NTL20ZZXFac_InitNumPrimesE for architecture x86_64
```



---

archive/issue_comments_512476.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,13 @@\n By default, TLS (aka Thread-Local Storage) is enabled in flint.\n However, it contradicts to NTL configured without threads (`NTL_THREADS=off`), and in particular non-GNU linkers might refuse to link flint\n (actually happens on FreeBSD). \n+\n+Also happens on macOS -- see for example https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/VkAv7bG6DAAJ\n+\n+\n+\n+See also:\n+- #29339 Fix NTL spkg-configure.m4 so it rejects NTLs built with NTL_THREADS\n+- #29267 enabling thread safety for NTL\n+\n+\n``````\n",
    "created_at": "2020-09-09T01:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512476",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,13 @@
 By default, TLS (aka Thread-Local Storage) is enabled in flint.
 However, it contradicts to NTL configured without threads (`NTL_THREADS=off`), and in particular non-GNU linkers might refuse to link flint
 (actually happens on FreeBSD). 
+
+Also happens on macOS -- see for example https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/VkAv7bG6DAAJ
+
+
+
+See also:
+- #29339 Fix NTL spkg-configure.m4 so it rejects NTLs built with NTL_THREADS
+- #29267 enabling thread safety for NTL
+
+
``````




---

archive/issue_events_078402.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78402"
}
```



---

archive/issue_events_078403.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-09T01:17:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78403"
}
```



---

archive/issue_events_078404.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-09T01:17:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78404"
}
```



---

archive/issue_comments_512477.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,5 +9,5 @@\n See also:\n - #29339 Fix NTL spkg-configure.m4 so it rejects NTLs built with NTL_THREADS\n - #29267 enabling thread safety for NTL\n+- #30388 homebrew: Add flint\n \n-\n``````\n",
    "created_at": "2020-09-09T01:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512477",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,5 +9,5 @@
 See also:
 - #29339 Fix NTL spkg-configure.m4 so it rejects NTLs built with NTL_THREADS
 - #29267 enabling thread safety for NTL
+- #30388 homebrew: Add flint
 
-
``````




---

archive/issue_comments_512478.json:
```json
{
    "body": "<a id='comment:28'></a>\nfrom what I recall - I was able to build and test Sage 9.2.beta12 on Homebrew macOS 10.15.6\nusing Homebrew's Flint and NTL, which do come with threads enabled. (Unfortunately the machine is bricked now, so I can't verify).\nMoving this to 9.3.",
    "created_at": "2020-10-07T10:22:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512478",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'></a>
from what I recall - I was able to build and test Sage 9.2.beta12 on Homebrew macOS 10.15.6
using Homebrew's Flint and NTL, which do come with threads enabled. (Unfortunately the machine is bricked now, so I can't verify).
Moving this to 9.3.



---

archive/issue_events_078405.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-10-07T10:22:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78405"
}
```



---

archive/issue_events_078406.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-10-07T10:22:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78406"
}
```



---

archive/issue_events_078407.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78407"
}
```



---

archive/issue_events_078408.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78408"
}
```



---

archive/issue_events_078409.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78409"
}
```



---

archive/issue_comments_512479.json:
```json
{
    "body": "<a id='comment:30'></a>\nSage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512479",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_078410.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78410"
}
```



---

archive/issue_events_078411.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78411"
}
```



---

archive/issue_comments_512480.json:
```json
{
    "body": "<a id='comment:31'></a>\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512480",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_512481.json:
```json
{
    "body": "<a id='comment:32'></a>\nStalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27764#issuecomment-512481",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_events_078412.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78412"
}
```



---

archive/issue_events_078413.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78413"
}
```



---

archive/issue_events_078414.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78414"
}
```



---

archive/issue_events_078415.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-07T00:07:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78415"
}
```



---

archive/issue_events_078416.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78416"
}
```



---

archive/issue_events_078417.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27764",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27764#event-78417"
}
```
