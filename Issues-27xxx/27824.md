# Issue 27824: spkg-configure.m4 for python3

archive/issues_027587.json:
```json
{
    "body": "Do not install python3 if a sufficiently new version is available in `$PATH`. This could be a system python3, or the python3 from within a venv.\n\nAs suggested in #29032, we make $SAGE_LOCAL a venv (https://docs.python.org/3/library/venv.html) over the system python3 -- if a suitable system python3 is found -- by using the `venv.EnvBuilder` API. \n\nThis is done by the new script `build/bin/sage-venv`, which we use both during `configure` (to make sure that we select a system python3 for which venvs work correctly) and during `make`.\n\nThe venv does not include the system site-packages: We continue to install all Python packages into our venv using the existing build infrastructure. We keep the task of using system site-packages for the follow-up ticket #29023.\n\n(Note, we use `venv` (new since Python 3.3), not `virtualenv`. So this change is limited to Python 3 builds of Sage.)\n\n\n\nCC:  @jdemeyer @embray @vbraun @kiwifb @jhpalmieri @videlec\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe, Erik Bray\n\nBranch: 1c845a4169769157787cdc3e2df37c08a6914891\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/27824\n\n",
    "closed_at": "2020-03-29T00:24:15Z",
    "created_at": "2019-05-13T15:52:41Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "spkg-configure.m4 for python3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27824",
    "user": "https://github.com/dimpase"
}
```
Do not install python3 if a sufficiently new version is available in `$PATH`. This could be a system python3, or the python3 from within a venv.

As suggested in #29032, we make $SAGE_LOCAL a venv (https://docs.python.org/3/library/venv.html) over the system python3 -- if a suitable system python3 is found -- by using the `venv.EnvBuilder` API. 

This is done by the new script `build/bin/sage-venv`, which we use both during `configure` (to make sure that we select a system python3 for which venvs work correctly) and during `make`.

The venv does not include the system site-packages: We continue to install all Python packages into our venv using the existing build infrastructure. We keep the task of using system site-packages for the follow-up ticket #29023.

(Note, we use `venv` (new since Python 3.3), not `virtualenv`. So this change is limited to Python 3 builds of Sage.)



CC:  @jdemeyer @embray @vbraun @kiwifb @jhpalmieri @videlec

Reviewer: Dima Pasechnik

Author: Matthias Koeppe, Erik Bray

Branch: 1c845a4169769157787cdc3e2df37c08a6914891

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/27824





---

archive/issue_comments_531111.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,15 @@\n \n At the moment I don't know how feasible it is - one small obstacle might be that we really do not want to mess with two pythons at the same time.\n \n-\n+while it should be possible/desirable to use a system python, any additional Python packages should optionally be installable into a virtualenv instead of the system site-packages, including sagelib itself unless the system *happens* to meet all of sagelib's Python dependencies already.  Listing some relevant Python packages below:\n+* cysignals\n+* cython\n+* ipython\n+* jinja2\n+* jupyter_core\n+* numpy\n+* scipy\n+* sympy\n+* pip\n+* setuptools\n+* six\n``````\n",
    "created_at": "2019-05-13T15:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531111",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,15 @@
 
 At the moment I don't know how feasible it is - one small obstacle might be that we really do not want to mess with two pythons at the same time.
 
-
+while it should be possible/desirable to use a system python, any additional Python packages should optionally be installable into a virtualenv instead of the system site-packages, including sagelib itself unless the system *happens* to meet all of sagelib's Python dependencies already.  Listing some relevant Python packages below:
+* cysignals
+* cython
+* ipython
+* jinja2
+* jupyter_core
+* numpy
+* scipy
+* sympy
+* pip
+* setuptools
+* six
``````




---

archive/issue_comments_531112.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,4 +13,5 @@\n * sympy\n * pip\n * setuptools\n+* pkgconfig\n * six\n``````\n",
    "created_at": "2019-05-13T21:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531112",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,4 +13,5 @@
 * sympy
 * pip
 * setuptools
+* pkgconfig
 * six
``````




---

archive/issue_comments_531113.json:
```json
{
    "body": "<a id='comment:3'></a>\nAs the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531113",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>
As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_comments_531114.json:
```json
{
    "body": "<a id='comment:4'></a>\nFor Python packages when installing using the system Python we definitely need a well thought out approach, likely with different options for handling questions such as where to install additional Python packages.\n\n`$SAGE_LOCAL` *already* acts as a sort-of virtualenv, but we might still consider using virtualenv/venv in `$SAGE_LOCAL` (with the `--system-site-packages` option) as a way of extending `sys.path` while still using as many system Python packages as possible.",
    "created_at": "2019-08-14T11:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531114",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>
For Python packages when installing using the system Python we definitely need a well thought out approach, likely with different options for handling questions such as where to install additional Python packages.

`$SAGE_LOCAL` *already* acts as a sort-of virtualenv, but we might still consider using virtualenv/venv in `$SAGE_LOCAL` (with the `--system-site-packages` option) as a way of extending `sys.path` while still using as many system Python packages as possible.



---

archive/issue_comments_531115.json:
```json
{
    "body": "<a id='comment:5'></a>\nSee #29013 - \"In a python3 build, install all Python packages into a venv\"",
    "created_at": "2020-01-14T22:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531115",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
See #29013 - "In a python3 build, install all Python packages into a venv"



---

archive/issue_comments_531116.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,17 +1,5 @@\n-do not install pythonX if we are in the virtenv of pythonX.\n+Do not install python3 if a sufficiently new version is available in `$PATH`. This could be a system python3, or the python3 from within a venv.\n \n-At the moment I don't know how feasible it is - one small obstacle might be that we really do not want to mess with two pythons at the same time.\n+Via #29013, we install all of our own Python packages into a separate venv that includes the system site-packages.\n \n-while it should be possible/desirable to use a system python, any additional Python packages should optionally be installable into a virtualenv instead of the system site-packages, including sagelib itself unless the system *happens* to meet all of sagelib's Python dependencies already.  Listing some relevant Python packages below:\n-* cysignals\n-* cython\n-* ipython\n-* jinja2\n-* jupyter_core\n-* numpy\n-* scipy\n-* sympy\n-* pip\n-* setuptools\n-* pkgconfig\n-* six\n+\n``````\n",
    "created_at": "2020-01-15T02:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531116",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,17 +1,5 @@
-do not install pythonX if we are in the virtenv of pythonX.
+Do not install python3 if a sufficiently new version is available in `$PATH`. This could be a system python3, or the python3 from within a venv.
 
-At the moment I don't know how feasible it is - one small obstacle might be that we really do not want to mess with two pythons at the same time.
+Via #29013, we install all of our own Python packages into a separate venv that includes the system site-packages.
 
-while it should be possible/desirable to use a system python, any additional Python packages should optionally be installable into a virtualenv instead of the system site-packages, including sagelib itself unless the system *happens* to meet all of sagelib's Python dependencies already.  Listing some relevant Python packages below:
-* cysignals
-* cython
-* ipython
-* jinja2
-* jupyter_core
-* numpy
-* scipy
-* sympy
-* pip
-* setuptools
-* pkgconfig
-* six
+
``````




---

archive/issue_comments_531117.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#29013\"",
    "created_at": "2020-01-15T02:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531117",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#29013"



---

archive/issue_comments_531118.json:
```json
{
    "body": "<a id='comment:6'></a>\nNarrowed the ticket to py3.",
    "created_at": "2020-01-15T02:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531118",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Narrowed the ticket to py3.



---

archive/issue_events_086064.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "rename": {
        "from": "spkg-configure.m4 for pythons",
        "to": "spkg-configure.m4 for python3"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27824#event-86064"
}
```



---

archive/issue_comments_531119.json:
```json
{
    "body": "Changing branch from \"\" to \"public/27824-python3-spkg-configure\"",
    "created_at": "2020-01-15T04:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531119",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "public/27824-python3-spkg-configure"



---

archive/issue_comments_531120.json:
```json
{
    "body": "<a id='comment:8'></a>\nHere's a version that works. The venv is created in `build/make/Makefile` target (in #29013, I created the venv in the `spkg-postinst` script of the `python3` spkg.) \n\n---\nNew commits:\n|                                                                                                                                          |                                                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|\n|[1363425](https://github.com/sagemath/sagetrac-mirror/commit/1363425d85693dcc183e31e4efce99776fa1eb44)|`In a python3 build, install all Python packages into a venv`|\n|[a394268](https://github.com/sagemath/sagetrac-mirror/commit/a3942688c3398af5c7bcc62f3fb3dde191a9b2c9)|`sage-pip-install: Use PYTHON=sage-python23`|\n|[a84815b](https://github.com/sagemath/sagetrac-mirror/commit/a84815b72ab41f6d0d17b733f44e4e8ec05d3410)|`spkg-configure.m4 for python3`|",
    "created_at": "2020-01-15T04:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531120",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Here's a version that works. The venv is created in `build/make/Makefile` target (in #29013, I created the venv in the `spkg-postinst` script of the `python3` spkg.) 

---
New commits:
|                                                                                                                                          |                                                             |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------|
|[1363425](https://github.com/sagemath/sagetrac-mirror/commit/1363425d85693dcc183e31e4efce99776fa1eb44)|`In a python3 build, install all Python packages into a venv`|
|[a394268](https://github.com/sagemath/sagetrac-mirror/commit/a3942688c3398af5c7bcc62f3fb3dde191a9b2c9)|`sage-pip-install: Use PYTHON=sage-python23`|
|[a84815b](https://github.com/sagemath/sagetrac-mirror/commit/a84815b72ab41f6d0d17b733f44e4e8ec05d3410)|`spkg-configure.m4 for python3`|



---

archive/issue_comments_531121.json:
```json
{
    "body": "Changing commit from \"\" to \"a84815b72ab41f6d0d17b733f44e4e8ec05d3410\"",
    "created_at": "2020-01-15T04:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531121",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "a84815b72ab41f6d0d17b733f44e4e8ec05d3410"



---

archive/issue_events_086065.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-01-15T04:48:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27824#event-86065"
}
```



---

archive/issue_comments_531122.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-01-15T04:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531122",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_531123.json:
```json
{
    "body": "<a id='comment:10'></a>\nhow about checking for Py3 deps: `sqlite libpng bzip2 xz libffi` ?\n(I skipped in this list ones that are 2nd order, so no need to check them)",
    "created_at": "2020-01-15T10:32:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531123",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
how about checking for Py3 deps: `sqlite libpng bzip2 xz libffi` ?
(I skipped in this list ones that are 2nd order, so no need to check them)



---

archive/issue_comments_531124.json:
```json
{
    "body": "<a id='comment:11'></a>\nOn Gentoo Python 3 does not have sqlite module by default. I had to do\n`$ pip install pysqlite3 --user`, and still `elliptic_curves` spkg installation errors out.",
    "created_at": "2020-01-15T11:56:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531124",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
On Gentoo Python 3 does not have sqlite module by default. I had to do
`$ pip install pysqlite3 --user`, and still `elliptic_curves` spkg installation errors out.



---

archive/issue_comments_531125.json:
```json
{
    "body": "Changing commit from \"a84815b72ab41f6d0d17b733f44e4e8ec05d3410\" to \"0d0495fd61f789981d3074ae142b89e248ee394f\"",
    "created_at": "2020-01-15T14:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531125",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a84815b72ab41f6d0d17b733f44e4e8ec05d3410" to "0d0495fd61f789981d3074ae142b89e248ee394f"



---

archive/issue_comments_531126.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------|\n|[0d0495f](https://github.com/sagemath/sagetrac-mirror/commit/0d0495fd61f789981d3074ae142b89e248ee394f)|`build/pkgs/python3/spkg-configure.m4: Add SAGE_SPKG_DEPCHECK for sqlite libpng bzip2 xz libffi`|",
    "created_at": "2020-01-15T14:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531126",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------|
|[0d0495f](https://github.com/sagemath/sagetrac-mirror/commit/0d0495fd61f789981d3074ae142b89e248ee394f)|`build/pkgs/python3/spkg-configure.m4: Add SAGE_SPKG_DEPCHECK for sqlite libpng bzip2 xz libffi`|



---

archive/issue_comments_531127.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[98dff9d](https://github.com/sagemath/sagetrac-mirror/commit/98dff9d32325d99c447132a28c4eae6c2d242d9a)|`Remove use of --system-site-packages`|",
    "created_at": "2020-01-15T14:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531127",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[98dff9d](https://github.com/sagemath/sagetrac-mirror/commit/98dff9d32325d99c447132a28c4eae6c2d242d9a)|`Remove use of --system-site-packages`|



---

archive/issue_comments_531128.json:
```json
{
    "body": "Changing commit from \"0d0495fd61f789981d3074ae142b89e248ee394f\" to \"98dff9d32325d99c447132a28c4eae6c2d242d9a\"",
    "created_at": "2020-01-15T14:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531128",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0d0495fd61f789981d3074ae142b89e248ee394f" to "98dff9d32325d99c447132a28c4eae6c2d242d9a"



---

archive/issue_comments_531129.json:
```json
{
    "body": "<a id='comment:14'></a>\nI've reduced the scope of the ticket, excluding the use of system site packages.",
    "created_at": "2020-01-15T14:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531129",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
I've reduced the scope of the ticket, excluding the use of system site packages.



---

archive/issue_comments_531130.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,7 @@\n Do not install python3 if a sufficiently new version is available in `$PATH`. This could be a system python3, or the python3 from within a venv.\n \n-Via #29013, we install all of our own Python packages into a separate venv that includes the system site-packages.\n+Via #29013, we install all of our own Python packages into a separate venv.\n+\n+The venv does not include the system site-packages; we keep that task for a follow-up ticket.\n \n \n``````\n",
    "created_at": "2020-01-15T14:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531130",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,7 @@
 Do not install python3 if a sufficiently new version is available in `$PATH`. This could be a system python3, or the python3 from within a venv.
 
-Via #29013, we install all of our own Python packages into a separate venv that includes the system site-packages.
+Via #29013, we install all of our own Python packages into a separate venv.
+
+The venv does not include the system site-packages; we keep that task for a follow-up ticket.
 
 
``````




---

archive/issue_comments_531131.json:
```json
{
    "body": "Changing commit from \"98dff9d32325d99c447132a28c4eae6c2d242d9a\" to \"61801321f81917550a065462422bb2a209bc1030\"",
    "created_at": "2020-01-15T16:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531131",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "98dff9d32325d99c447132a28c4eae6c2d242d9a" to "61801321f81917550a065462422bb2a209bc1030"



---

archive/issue_comments_531132.json:
```json
{
    "body": "<a id='comment:15'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------|\n|[6180132](https://github.com/sagemath/sagetrac-mirror/commit/61801321f81917550a065462422bb2a209bc1030)|`build/pkgs/python3/spkg-configure.m4: Find `@`PYTHON_FOR_VENV`@` that has sqlite3 module`|",
    "created_at": "2020-01-15T16:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531132",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------|
|[6180132](https://github.com/sagemath/sagetrac-mirror/commit/61801321f81917550a065462422bb2a209bc1030)|`build/pkgs/python3/spkg-configure.m4: Find `@`PYTHON_FOR_VENV`@` that has sqlite3 module`|



---

archive/issue_comments_531133.json:
```json
{
    "body": "<a id='comment:16'></a>\nI tried this on gentoo (after a usual struggle to get sqlite3 module built in Python)\nand it broke at docbuild, with\n\n```\nRuntimeError: libSingular not found--a working Singular install in $SAGE_LOCAL is required for Sage to work\n```\neven though `libSingular` has built just fine (it's some magic with `from sage.env import SINGULAR_SO` that is broken, so `SINGULAR_SO` is `None`)",
    "created_at": "2020-01-15T18:01:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531133",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>
I tried this on gentoo (after a usual struggle to get sqlite3 module built in Python)
and it broke at docbuild, with

```
RuntimeError: libSingular not found--a working Singular install in $SAGE_LOCAL is required for Sage to work
```
even though `libSingular` has built just fine (it's some magic with `from sage.env import SINGULAR_SO` that is broken, so `SINGULAR_SO` is `None`)



---

archive/issue_comments_531134.json:
```json
{
    "body": "<a id='comment:17'></a>\nThanks for testing!",
    "created_at": "2020-01-15T18:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531134",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Thanks for testing!



---

archive/issue_comments_531135.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [mkoeppe](#comment%3A14):\n> I've reduced the scope of the ticket, excluding the use of system site packages.\n\n\ndo you mean pip/etc-installed `site-packages` of system's Python?",
    "created_at": "2020-01-15T18:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531135",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
Replying to [mkoeppe](#comment%3A14):
> I've reduced the scope of the ticket, excluding the use of system site packages.


do you mean pip/etc-installed `site-packages` of system's Python?



---

archive/issue_comments_531136.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [dimpase](#comment%3A18):\n> Replying to [mkoeppe](#comment%3A14):\n> > I've reduced the scope of the ticket, excluding the use of system site packages.\n\n> \n> do you mean pip/etc-installed `site-packages` of system's Python?\n\n\nYes.",
    "created_at": "2020-01-15T18:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531136",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
Replying to [dimpase](#comment%3A18):
> Replying to [mkoeppe](#comment%3A14):
> > I've reduced the scope of the ticket, excluding the use of system site packages.

> 
> do you mean pip/etc-installed `site-packages` of system's Python?


Yes.



---

archive/issue_comments_531137.json:
```json
{
    "body": "Changing dependencies from \"#29013\" to \"#29013, #29019\"",
    "created_at": "2020-01-15T20:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531137",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#29013" to "#29013, #29019"



---

archive/issue_comments_531138.json:
```json
{
    "body": "<a id='comment:21'></a>\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n|                                                                                                                                           |                                                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------|\n|[61d7822](https://github.com/sagemath/sagetrac-mirror/commit/61d78220089040d4c91ee5b52df63d29107e80aa)|`Trac #29002: lower the version bound on the system sqlite check.`|\n|[3ab4515](https://github.com/sagemath/sagetrac-mirror/commit/3ab451549f66743220caa00d43831341690f80e9)|`Merge branch 'u/mjo/ticket/29002' of git://trac.sagemath.org/sage into t/27824/public/27824-python3-spkg-configure`|\n|[c7b9ae4](https://github.com/sagemath/sagetrac-mirror/commit/c7b9ae4393cfe2b8975aafc196cd96bece7de75d)|`Add sqlite depcheck`|\n|[961f850](https://github.com/sagemath/sagetrac-mirror/commit/961f850b915e4d267262d4a67129a031eb0cc48e)|`Trac #29002: lower the version bound on the system sqlite check (again).`|\n|[d321948](https://github.com/sagemath/sagetrac-mirror/commit/d32194842f5f7f83c2d50d020267838176a666f3)|`Trac #29002: drop the readline dependency check for system sqlite.`|\n|[14d15fb](https://github.com/sagemath/sagetrac-mirror/commit/14d15fb744114903df9bb1935c3f100946e6c16e)|`Merge branch 'u/mjo/ticket/29002' of git://trac.sagemath.org/sage into t/27824/public/27824-python3-spkg-configure`|\n|[258d112](https://github.com/sagemath/sagetrac-mirror/commit/258d1124b7b0739c306caaf8a6f9d08bb88eafdc)|`build/pkgs/pillow/patches/setup.py.patch: Don't fail if Py_MACOS_SYSROOT sysconfig variable does not exist`|\n|[43673c0](https://github.com/sagemath/sagetrac-mirror/commit/43673c002a3135c71727a38eadee05fcbb54cd67)|`Merge branch 't/29019/make_patch_to_pillow_more_robust__do_not_depend_on__py_macos_sysroot__' into t/27824/public/27824-python3-spkg-configure`|\n|[56b1618](https://github.com/sagemath/sagetrac-mirror/commit/56b16181df532469e5c680345166ea116a3e6f15)|`build/pkgs/pillow/spkg-install: Help setup.py find zlib.h on macOS; show more build output`|\n|[5930b4e](https://github.com/sagemath/sagetrac-mirror/commit/5930b4e219e3f12fb675ba2caf5c1d7fcb1b15e4)|`Merge branch 't/29019/make_patch_to_pillow_more_robust__do_not_depend_on__py_macos_sysroot__' into t/27824/public/27824-python3-spkg-configure`|",
    "created_at": "2020-01-15T20:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531138",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
|                                                                                                                                           |                                                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------|
|[61d7822](https://github.com/sagemath/sagetrac-mirror/commit/61d78220089040d4c91ee5b52df63d29107e80aa)|`Trac #29002: lower the version bound on the system sqlite check.`|
|[3ab4515](https://github.com/sagemath/sagetrac-mirror/commit/3ab451549f66743220caa00d43831341690f80e9)|`Merge branch 'u/mjo/ticket/29002' of git://trac.sagemath.org/sage into t/27824/public/27824-python3-spkg-configure`|
|[c7b9ae4](https://github.com/sagemath/sagetrac-mirror/commit/c7b9ae4393cfe2b8975aafc196cd96bece7de75d)|`Add sqlite depcheck`|
|[961f850](https://github.com/sagemath/sagetrac-mirror/commit/961f850b915e4d267262d4a67129a031eb0cc48e)|`Trac #29002: lower the version bound on the system sqlite check (again).`|
|[d321948](https://github.com/sagemath/sagetrac-mirror/commit/d32194842f5f7f83c2d50d020267838176a666f3)|`Trac #29002: drop the readline dependency check for system sqlite.`|
|[14d15fb](https://github.com/sagemath/sagetrac-mirror/commit/14d15fb744114903df9bb1935c3f100946e6c16e)|`Merge branch 'u/mjo/ticket/29002' of git://trac.sagemath.org/sage into t/27824/public/27824-python3-spkg-configure`|
|[258d112](https://github.com/sagemath/sagetrac-mirror/commit/258d1124b7b0739c306caaf8a6f9d08bb88eafdc)|`build/pkgs/pillow/patches/setup.py.patch: Don't fail if Py_MACOS_SYSROOT sysconfig variable does not exist`|
|[43673c0](https://github.com/sagemath/sagetrac-mirror/commit/43673c002a3135c71727a38eadee05fcbb54cd67)|`Merge branch 't/29019/make_patch_to_pillow_more_robust__do_not_depend_on__py_macos_sysroot__' into t/27824/public/27824-python3-spkg-configure`|
|[56b1618](https://github.com/sagemath/sagetrac-mirror/commit/56b16181df532469e5c680345166ea116a3e6f15)|`build/pkgs/pillow/spkg-install: Help setup.py find zlib.h on macOS; show more build output`|
|[5930b4e](https://github.com/sagemath/sagetrac-mirror/commit/5930b4e219e3f12fb675ba2caf5c1d7fcb1b15e4)|`Merge branch 't/29019/make_patch_to_pillow_more_robust__do_not_depend_on__py_macos_sysroot__' into t/27824/public/27824-python3-spkg-configure`|



---

archive/issue_comments_531139.json:
```json
{
    "body": "Changing commit from \"61801321f81917550a065462422bb2a209bc1030\" to \"5930b4e219e3f12fb675ba2caf5c1d7fcb1b15e4\"",
    "created_at": "2020-01-15T20:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531139",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "61801321f81917550a065462422bb2a209bc1030" to "5930b4e219e3f12fb675ba2caf5c1d7fcb1b15e4"



---

archive/issue_comments_531140.json:
```json
{
    "body": "<a id='comment:22'></a>\nNow this is giving\n\n```\n[pillow-5.3.0.p0] gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -I/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.sdk/usr/include -I/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.sdk/System/Library/Frameworks/Tk.framework/Versions/8.5/Headers -g -DHAVE_OPENJPEG -DHAVE_LIBZ -DHAVE_LIBTIFF -DPILLOW_VERSION=\"5.3.0\" -I/usr/local/Cellar/openjpeg/2.3.1/include/openjpeg-2.3 -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-venv/local/var/tmp/sage/build/pillow-5.3.0.p0/src/src/libImaging -I/usr/local/Cellar/jpeg/9c/include -I/usr/local/Cellar/libtiff/4.1.0/include -I/usr/local/Cellar/freetype/2.10.1/include/freetype2 -I/usr/local/Cellar/little-cms2/2.9/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-venv/local/include -I/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-venv/local/lib/sage/venv/sage/include -I/usr/local/include -I/usr/local/Cellar/freetype/2.10.1/include -I/usr/local/include -I/usr/local/opt/openssl@1.1/include -I/usr/local/opt/sqlite/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-venv/local/lib/sage/venv/sage/include -I/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/include/python3.7m -c src/_imaging.c -o build/temp.macosx-10.15-x86_64-3.7/src/_imaging.o\n[pillow-5.3.0.p0] error: $MACOSX_DEPLOYMENT_TARGET mismatch: now \"10.9\" but \"10.15\" during configure\n[pillow-5.3.0.p0] ********************************************************************************\n```\nThis is coming from the fake `MACOSX_DEPLOYMENT_TARGET` set in `sage-env`. See #18272, #7095, #18254, #16312.",
    "created_at": "2020-01-15T21:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531140",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Now this is giving

```
[pillow-5.3.0.p0] gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -I/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.sdk/usr/include -I/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.15.sdk/System/Library/Frameworks/Tk.framework/Versions/8.5/Headers -g -DHAVE_OPENJPEG -DHAVE_LIBZ -DHAVE_LIBTIFF -DPILLOW_VERSION="5.3.0" -I/usr/local/Cellar/openjpeg/2.3.1/include/openjpeg-2.3 -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-venv/local/var/tmp/sage/build/pillow-5.3.0.p0/src/src/libImaging -I/usr/local/Cellar/jpeg/9c/include -I/usr/local/Cellar/libtiff/4.1.0/include -I/usr/local/Cellar/freetype/2.10.1/include/freetype2 -I/usr/local/Cellar/little-cms2/2.9/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-venv/local/include -I/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-venv/local/lib/sage/venv/sage/include -I/usr/local/include -I/usr/local/Cellar/freetype/2.10.1/include -I/usr/local/include -I/usr/local/opt/openssl@1.1/include -I/usr/local/opt/sqlite/include -I/Users/mkoeppe/s/sage/sage-rebasing/worktree-venv/local/lib/sage/venv/sage/include -I/usr/local/Cellar/python/3.7.6_1/Frameworks/Python.framework/Versions/3.7/include/python3.7m -c src/_imaging.c -o build/temp.macosx-10.15-x86_64-3.7/src/_imaging.o
[pillow-5.3.0.p0] error: $MACOSX_DEPLOYMENT_TARGET mismatch: now "10.9" but "10.15" during configure
[pillow-5.3.0.p0] ********************************************************************************
```
This is coming from the fake `MACOSX_DEPLOYMENT_TARGET` set in `sage-env`. See #18272, #7095, #18254, #16312.



---

archive/issue_comments_531141.json:
```json
{
    "body": "Changing commit from \"5930b4e219e3f12fb675ba2caf5c1d7fcb1b15e4\" to \"7bd87464eb40adfe7f9110a452cd10b3c78b8f4c\"",
    "created_at": "2020-01-15T22:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531141",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5930b4e219e3f12fb675ba2caf5c1d7fcb1b15e4" to "7bd87464eb40adfe7f9110a452cd10b3c78b8f4c"



---

archive/issue_comments_531142.json:
```json
{
    "body": "<a id='comment:23'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------|\n|[3b34e2e](https://github.com/sagemath/sagetrac-mirror/commit/3b34e2ef8d348478c03d61b9a993034b6eb703e3)|`src/bin/sage-env: Don't set MACOSX_DEPLOYMENT_TARGET if we use system python3`|\n|[7bd8746](https://github.com/sagemath/sagetrac-mirror/commit/7bd87464eb40adfe7f9110a452cd10b3c78b8f4c)|`_get_shared_lib_filename: Do not assume Python sysconfig paths are in SAGE_LOCAL`|",
    "created_at": "2020-01-15T22:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531142",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------|
|[3b34e2e](https://github.com/sagemath/sagetrac-mirror/commit/3b34e2ef8d348478c03d61b9a993034b6eb703e3)|`src/bin/sage-env: Don't set MACOSX_DEPLOYMENT_TARGET if we use system python3`|
|[7bd8746](https://github.com/sagemath/sagetrac-mirror/commit/7bd87464eb40adfe7f9110a452cd10b3c78b8f4c)|`_get_shared_lib_filename: Do not assume Python sysconfig paths are in SAGE_LOCAL`|



---

archive/issue_comments_531143.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [dimpase](#comment%3A16):\n> I tried this on gentoo (after a usual struggle to get sqlite3 module built in Python)\n> and it broke at docbuild, with\n> \n> ```\n> RuntimeError: libSingular not found--a working Singular install in $SAGE_LOCAL is required for Sage to work\n> ```\n> even though `libSingular` has built just fine (it's some magic with `from sage.env import SINGULAR_SO` that is broken, so `SINGULAR_SO` is `None`)\n\nFixed now.",
    "created_at": "2020-01-15T22:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531143",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>
Replying to [dimpase](#comment%3A16):
> I tried this on gentoo (after a usual struggle to get sqlite3 module built in Python)
> and it broke at docbuild, with
> 
> ```
> RuntimeError: libSingular not found--a working Singular install in $SAGE_LOCAL is required for Sage to work
> ```
> even though `libSingular` has built just fine (it's some magic with `from sage.env import SINGULAR_SO` that is broken, so `SINGULAR_SO` is `None`)

Fixed now.



---

archive/issue_comments_531144.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,6 +2,6 @@\n \n Via #29013, we install all of our own Python packages into a separate venv.\n \n-The venv does not include the system site-packages; we keep that task for a follow-up ticket.\n+The venv does not include the system site-packages; we keep that task for the follow-up ticket #29023.\n \n \n``````\n",
    "created_at": "2020-01-15T23:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531144",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,6 +2,6 @@
 
 Via #29013, we install all of our own Python packages into a separate venv.
 
-The venv does not include the system site-packages; we keep that task for a follow-up ticket.
+The venv does not include the system site-packages; we keep that task for the follow-up ticket #29023.
 
 
``````




---

archive/issue_comments_531145.json:
```json
{
    "body": "Changing commit from \"7bd87464eb40adfe7f9110a452cd10b3c78b8f4c\" to \"cd864e89500858a87f0f82faf4a634d200fe2118\"",
    "created_at": "2020-01-16T00:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531145",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7bd87464eb40adfe7f9110a452cd10b3c78b8f4c" to "cd864e89500858a87f0f82faf4a634d200fe2118"



---

archive/issue_comments_531146.json:
```json
{
    "body": "<a id='comment:26'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|\n|[d4fbe40](https://github.com/sagemath/sagetrac-mirror/commit/d4fbe4082890ac0aa09559b87393544678592c94)|`_get_shared_lib_filename: Do not assume Python sysconfig paths are in SAGE_LOCAL`|\n|[bba08ec](https://github.com/sagemath/sagetrac-mirror/commit/bba08ec0c8008f925643eaf56742115d83253e23)|`Create module src/sage/env_config.py from src/sage/env_config.py.in, defining SAGE_LOCAL`|\n|[d1779cc](https://github.com/sagemath/sagetrac-mirror/commit/d1779cc2ff56d8dd5f58ebd1f5322e32499a3970)|`Merge branch 't/29022/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env' into t/29013/public/29013-use-py3-venv`|\n|[cd864e8](https://github.com/sagemath/sagetrac-mirror/commit/cd864e89500858a87f0f82faf4a634d200fe2118)|`Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure`|",
    "created_at": "2020-01-16T00:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531146",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|
|[d4fbe40](https://github.com/sagemath/sagetrac-mirror/commit/d4fbe4082890ac0aa09559b87393544678592c94)|`_get_shared_lib_filename: Do not assume Python sysconfig paths are in SAGE_LOCAL`|
|[bba08ec](https://github.com/sagemath/sagetrac-mirror/commit/bba08ec0c8008f925643eaf56742115d83253e23)|`Create module src/sage/env_config.py from src/sage/env_config.py.in, defining SAGE_LOCAL`|
|[d1779cc](https://github.com/sagemath/sagetrac-mirror/commit/d1779cc2ff56d8dd5f58ebd1f5322e32499a3970)|`Merge branch 't/29022/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env' into t/29013/public/29013-use-py3-venv`|
|[cd864e8](https://github.com/sagemath/sagetrac-mirror/commit/cd864e89500858a87f0f82faf4a634d200fe2118)|`Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure`|



---

archive/issue_comments_531147.json:
```json
{
    "body": "<a id='comment:27'></a>\nCompiles OK on macOS with homebrew. `make ptestlong` mostly good except for\n- GLPK output (spkg-configure should really reject a libglpk that talks too much) - it makes it hard to see actual failures\n- and numerical failures in `src/sage/matrix/matrix2.pyx`, `src/sage/finance/time_series.pyx`, and `src/sage/schemes/affine/affine_homset.py` as reported in #29013\n\n```\nsage -t --long src/sage/matrix/matrix2.pyx  # 2 doctests failed\nsage -t --long src/sage/finance/time_series.pyx  # 5 doctests failed\nsage -t --long src/sage/schemes/affine/affine_homset.py  # 1 doctest failed\n```",
    "created_at": "2020-01-16T02:03:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531147",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
Compiles OK on macOS with homebrew. `make ptestlong` mostly good except for
- GLPK output (spkg-configure should really reject a libglpk that talks too much) - it makes it hard to see actual failures
- and numerical failures in `src/sage/matrix/matrix2.pyx`, `src/sage/finance/time_series.pyx`, and `src/sage/schemes/affine/affine_homset.py` as reported in #29013

```
sage -t --long src/sage/matrix/matrix2.pyx  # 2 doctests failed
sage -t --long src/sage/finance/time_series.pyx  # 5 doctests failed
sage -t --long src/sage/schemes/affine/affine_homset.py  # 1 doctest failed
```



---

archive/issue_comments_531148.json:
```json
{
    "body": "<a id='comment:28'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|\n|[85147f9](https://github.com/sagemath/sagetrac-mirror/commit/85147f9a7bb3741646693b913bbb96fff1e11432)|`build/pkgs/numpy/lapack_conf.py: Add a [DEFAULT] section to site.cfg`|\n|[93bae6f](https://github.com/sagemath/sagetrac-mirror/commit/93bae6f990fa685b12f26a2b2736d45f7c605ce6)|`Merge branch 't/29025/numpy__site_cfg_needs_a__default__section' into t/29013/public/29013-use-py3-venv`|\n|[669b1df](https://github.com/sagemath/sagetrac-mirror/commit/669b1dfa8bfd50c0710f546ed2bdfe43b14bc13d)|`Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure`|",
    "created_at": "2020-01-16T03:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531148",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|
|[85147f9](https://github.com/sagemath/sagetrac-mirror/commit/85147f9a7bb3741646693b913bbb96fff1e11432)|`build/pkgs/numpy/lapack_conf.py: Add a [DEFAULT] section to site.cfg`|
|[93bae6f](https://github.com/sagemath/sagetrac-mirror/commit/93bae6f990fa685b12f26a2b2736d45f7c605ce6)|`Merge branch 't/29025/numpy__site_cfg_needs_a__default__section' into t/29013/public/29013-use-py3-venv`|
|[669b1df](https://github.com/sagemath/sagetrac-mirror/commit/669b1dfa8bfd50c0710f546ed2bdfe43b14bc13d)|`Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure`|



---

archive/issue_comments_531149.json:
```json
{
    "body": "Changing commit from \"cd864e89500858a87f0f82faf4a634d200fe2118\" to \"669b1dfa8bfd50c0710f546ed2bdfe43b14bc13d\"",
    "created_at": "2020-01-16T03:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531149",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cd864e89500858a87f0f82faf4a634d200fe2118" to "669b1dfa8bfd50c0710f546ed2bdfe43b14bc13d"



---

archive/issue_comments_531150.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [mkoeppe](#comment%3A24):\n> Replying to [dimpase](#comment%3A16):\n> > I tried this on gentoo (after a usual struggle to get sqlite3 module built in Python)\n> > and it broke at docbuild, with\n> > \n> > ```\n> > RuntimeError: libSingular not found--a working Singular install in $SAGE_LOCAL is required for Sage to work\n> > ```\n> > even though `libSingular` has built just fine (it's some magic with `from sage.env import SINGULAR_SO` that is broken, so `SINGULAR_SO` is `None`)\n\n> Fixed now.\n\nafter this fix, it builds and passes most tests on Gentoo (some errors related to cryptominisat that I had installed, and it probably got broken in some way)",
    "created_at": "2020-01-16T08:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531150",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'></a>
Replying to [mkoeppe](#comment%3A24):
> Replying to [dimpase](#comment%3A16):
> > I tried this on gentoo (after a usual struggle to get sqlite3 module built in Python)
> > and it broke at docbuild, with
> > 
> > ```
> > RuntimeError: libSingular not found--a working Singular install in $SAGE_LOCAL is required for Sage to work
> > ```
> > even though `libSingular` has built just fine (it's some magic with `from sage.env import SINGULAR_SO` that is broken, so `SINGULAR_SO` is `None`)

> Fixed now.

after this fix, it builds and passes most tests on Gentoo (some errors related to cryptominisat that I had installed, and it probably got broken in some way)



---

archive/issue_comments_531151.json:
```json
{
    "body": "<a id='comment:30'></a>\nI see a problem with cryptominisat spkg on this branch (which otherwise builds and passes most tests (not related to this packages) on Gentoo)\n\n```\nsage -t --warn-long 88.1 src/sage/sat/solvers/cryptominisat.py\n**********************************************************************\nFile \"src/sage/sat/solvers/cryptominisat.py\", line 49, in sage.sat.solvers.cryptominisat.CryptoMiniSat\nFailed example:\n    solver = CryptoMiniSat()                                  # optional - cryptominisat\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/opt/Sage/sage-dev/local/lib/sage/venv/sage/lib/python3.7/site-packages/sage/sat/solvers/cryptominisat.py\", line 69, in __init__\n        from pycryptosat import Solver\n    ModuleNotFoundError: No module named 'pycryptosat'\n```\nI wonder whether it uses a convoluted way to create python extensions, which got broken.",
    "created_at": "2020-01-16T09:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531151",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>
I see a problem with cryptominisat spkg on this branch (which otherwise builds and passes most tests (not related to this packages) on Gentoo)

```
sage -t --warn-long 88.1 src/sage/sat/solvers/cryptominisat.py
**********************************************************************
File "src/sage/sat/solvers/cryptominisat.py", line 49, in sage.sat.solvers.cryptominisat.CryptoMiniSat
Failed example:
    solver = CryptoMiniSat()                                  # optional - cryptominisat
Exception raised:
    Traceback (most recent call last):
      File "/mnt/opt/Sage/sage-dev/local/lib/sage/venv/sage/lib/python3.7/site-packages/sage/sat/solvers/cryptominisat.py", line 69, in __init__
        from pycryptosat import Solver
    ModuleNotFoundError: No module named 'pycryptosat'
```
I wonder whether it uses a convoluted way to create python extensions, which got broken.



---

archive/issue_comments_531152.json:
```json
{
    "body": "<a id='comment:31'></a>\nI see (on a system where cryptominisat package works) that it is one of few packages that get installed without a sub-directory named the same as package in site-packages:\n\n```\nsage: import pycryptosat\nsage: print(pycryptosat.__file__)\n/home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/pycryptosat.cpython-37m-x86_64-linux-gnu.so\nsage: import numpy\nsage: print(numpy.__file__)\n/home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/numpy/__init__.py\n```\n\nNot sure whether this is a bug on the package, or a bug in this branch.\nOn this branch I see (with `local=SAGE_LOCAL`)\n\n```\n$ ls local/lib/python3.7/site-packages/*\nlocal/lib/python3.7/site-packages/pycryptosat-0.2.0-py3.7.egg-info  local/lib/python3.7/site-packages/pycryptosat.cpython-37m-x86_64-linux-gnu.so\n```\nSo it seems that this branch does not pick up anything from that location.",
    "created_at": "2020-01-16T09:56:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531152",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:31'></a>
I see (on a system where cryptominisat package works) that it is one of few packages that get installed without a sub-directory named the same as package in site-packages:

```
sage: import pycryptosat
sage: print(pycryptosat.__file__)
/home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/pycryptosat.cpython-37m-x86_64-linux-gnu.so
sage: import numpy
sage: print(numpy.__file__)
/home/scratch2/dimpase/sage/sage/local/lib/python3.7/site-packages/numpy/__init__.py
```

Not sure whether this is a bug on the package, or a bug in this branch.
On this branch I see (with `local=SAGE_LOCAL`)

```
$ ls local/lib/python3.7/site-packages/*
local/lib/python3.7/site-packages/pycryptosat-0.2.0-py3.7.egg-info  local/lib/python3.7/site-packages/pycryptosat.cpython-37m-x86_64-linux-gnu.so
```
So it seems that this branch does not pick up anything from that location.



---

archive/issue_comments_531153.json:
```json
{
    "body": "Changing commit from \"669b1dfa8bfd50c0710f546ed2bdfe43b14bc13d\" to \"61a9e3733989f265bda6cea7e6bccf7bf88c9749\"",
    "created_at": "2020-01-16T14:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531153",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "669b1dfa8bfd50c0710f546ed2bdfe43b14bc13d" to "61a9e3733989f265bda6cea7e6bccf7bf88c9749"



---

archive/issue_comments_531154.json:
```json
{
    "body": "<a id='comment:32'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[2ed5d07](https://github.com/sagemath/sagetrac-mirror/commit/2ed5d071cf9825df2a2dbf6d54b3a6f09153be3a)|`Add cryptominisat patch for virtual envs`|\n|[61a9e37](https://github.com/sagemath/sagetrac-mirror/commit/61a9e3733989f265bda6cea7e6bccf7bf88c9749)|`Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure`|",
    "created_at": "2020-01-16T14:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531154",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[2ed5d07](https://github.com/sagemath/sagetrac-mirror/commit/2ed5d071cf9825df2a2dbf6d54b3a6f09153be3a)|`Add cryptominisat patch for virtual envs`|
|[61a9e37](https://github.com/sagemath/sagetrac-mirror/commit/61a9e3733989f265bda6cea7e6bccf7bf88c9749)|`Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure`|



---

archive/issue_comments_531155.json:
```json
{
    "body": "<a id='comment:33'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|\n|[27d945a](https://github.com/sagemath/sagetrac-mirror/commit/27d945a8d41354234c123f02e2e1d41d287a7541)|`moved patch to the right place`|\n|[8c546cf](https://github.com/sagemath/sagetrac-mirror/commit/8c546cfd4a35c82c911e3620538c2188e7e350f2)|`Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure`|",
    "created_at": "2020-01-16T16:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531155",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
|[27d945a](https://github.com/sagemath/sagetrac-mirror/commit/27d945a8d41354234c123f02e2e1d41d287a7541)|`moved patch to the right place`|
|[8c546cf](https://github.com/sagemath/sagetrac-mirror/commit/8c546cfd4a35c82c911e3620538c2188e7e350f2)|`Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure`|



---

archive/issue_comments_531156.json:
```json
{
    "body": "Changing commit from \"61a9e3733989f265bda6cea7e6bccf7bf88c9749\" to \"8c546cfd4a35c82c911e3620538c2188e7e350f2\"",
    "created_at": "2020-01-16T16:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531156",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "61a9e3733989f265bda6cea7e6bccf7bf88c9749" to "8c546cfd4a35c82c911e3620538c2188e7e350f2"



---

archive/issue_comments_531157.json:
```json
{
    "body": "<a id='comment:34'></a>\nWhat's the deal with `config_venv`?  Why is any of that necessary?  I looked at the commit that added it but it wasn't clear.  It seems to me another reason to avoid all the venv stuff...",
    "created_at": "2020-01-16T18:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531157",
    "user": "https://github.com/embray"
}
```

<a id='comment:34'></a>
What's the deal with `config_venv`?  Why is any of that necessary?  I looked at the commit that added it but it wasn't clear.  It seems to me another reason to avoid all the venv stuff...



---

archive/issue_comments_531158.json:
```json
{
    "body": "<a id='comment:35'></a>\nSo, all that `$VIRTUAL_ENV/bin/activate` does, essentially, is to set 3 environment variables: `PATH` (to which it inserts `$VIRTUAL_ENV/bin` in the front), `PS1` (which Sage also already sets when activating the sage environment), and the `$VIRTUAL_ENV` environment variable itself.\n\nOther than that, the only thing that really makes a directory a virtualenv (with Python 3 + venv, I'm not counting the old virtualenv) is the presence of `pyvenv.cfg` in the install prefix.  The format of this file is more-or-less documented (albeit not very clearly) in https://docs.python.org/3/library/venv.html.  So all we really need to do to turn `$SAGE_LOCAL` into a virtualenv of a system Python 3 is to write the appropriate `pyvenv.cfg` into `$SAGE_LOCAL`, and not mess around with the full `venv` command at all.  That, and make `$SAGE_LOCAL/bin/python3` a symlink to the real python3.\n\nAlthough not strictly necessary, it is also possibly helpful to third-party tools to set the `$VIRTUAL_ENV` environment variable.",
    "created_at": "2020-01-16T18:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531158",
    "user": "https://github.com/embray"
}
```

<a id='comment:35'></a>
So, all that `$VIRTUAL_ENV/bin/activate` does, essentially, is to set 3 environment variables: `PATH` (to which it inserts `$VIRTUAL_ENV/bin` in the front), `PS1` (which Sage also already sets when activating the sage environment), and the `$VIRTUAL_ENV` environment variable itself.

Other than that, the only thing that really makes a directory a virtualenv (with Python 3 + venv, I'm not counting the old virtualenv) is the presence of `pyvenv.cfg` in the install prefix.  The format of this file is more-or-less documented (albeit not very clearly) in https://docs.python.org/3/library/venv.html.  So all we really need to do to turn `$SAGE_LOCAL` into a virtualenv of a system Python 3 is to write the appropriate `pyvenv.cfg` into `$SAGE_LOCAL`, and not mess around with the full `venv` command at all.  That, and make `$SAGE_LOCAL/bin/python3` a symlink to the real python3.

Although not strictly necessary, it is also possibly helpful to third-party tools to set the `$VIRTUAL_ENV` environment variable.



---

archive/issue_comments_531159.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [embray](#comment%3A34):\n> What's the deal with `config_venv`?  Why is any of that necessary?  I looked at the commit that added it but it wasn't clear. \n\n\nIt is used in a configure test, `build/pkgs/python3/spkg-configure.m4` to make sure that the system python has all optional modules that we need.",
    "created_at": "2020-01-16T18:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531159",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>
Replying to [embray](#comment%3A34):
> What's the deal with `config_venv`?  Why is any of that necessary?  I looked at the commit that added it but it wasn't clear. 


It is used in a configure test, `build/pkgs/python3/spkg-configure.m4` to make sure that the system python has all optional modules that we need.



---

archive/issue_comments_531160.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [embray](#comment%3A35):\n> So all we really need to do to turn `$SAGE_LOCAL` into a virtualenv of a system Python 3 is to write the appropriate `pyvenv.cfg` into `$SAGE_LOCAL`, and not mess around with the full `venv` command at all.  \n\n\nThis amounts to trying to upgrade python3's `venv` to something like a conda environment. This is what I avoid in #29013 on purpose - the `venv` is only used in a clean, documented way, using the documented tools.",
    "created_at": "2020-01-16T18:52:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531160",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>
Replying to [embray](#comment%3A35):
> So all we really need to do to turn `$SAGE_LOCAL` into a virtualenv of a system Python 3 is to write the appropriate `pyvenv.cfg` into `$SAGE_LOCAL`, and not mess around with the full `venv` command at all.  


This amounts to trying to upgrade python3's `venv` to something like a conda environment. This is what I avoid in #29013 on purpose - the `venv` is only used in a clean, documented way, using the documented tools.



---

archive/issue_comments_531161.json:
```json
{
    "body": "<a id='comment:38'></a>\nwriting `pyvenv.cfg` by hand is bound to be broken at some point, as it's an implementation detail of venv.\nThe correct interface to `venv` is to use `venv`, I think.\n\n(By the way, the idea of using venv/virtualenv is probably mine, IIRC I put it in the original version of this ticket :-))",
    "created_at": "2020-01-16T18:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531161",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:38'></a>
writing `pyvenv.cfg` by hand is bound to be broken at some point, as it's an implementation detail of venv.
The correct interface to `venv` is to use `venv`, I think.

(By the way, the idea of using venv/virtualenv is probably mine, IIRC I put it in the original version of this ticket :-))



---

archive/issue_comments_531162.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [dimpase](#comment%3A38):\n> (By the way, the idea of using venv/virtualenv is probably mine, IIRC I put it in the original version of this ticket :-))\n\nGlad we have this on record now for the software historians/archaeologists to discover :)",
    "created_at": "2020-01-16T18:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531162",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'></a>
Replying to [dimpase](#comment%3A38):
> (By the way, the idea of using venv/virtualenv is probably mine, IIRC I put it in the original version of this ticket :-))

Glad we have this on record now for the software historians/archaeologists to discover :)



---

archive/issue_comments_531163.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [dimpase](#comment%3A38):\n> writing `pyvenv.cfg` by hand is bound to be broken at some point, as it's an implementation detail of venv.\n> The correct interface to `venv` is to use `venv`, I think.\n\n\nThat's not true.  It's documented both in the documentation for the `venv` module and the `site` module.  If you really want to avoid writing it by hand the `venv` module includes code for that as well.  This (with the *system* Python 3) is effectively the same (albeit more opaque).  From within SAGE_ROOT, but without the sage environment activated:\n\n```\n$ python3 -c 'import venv; b = venv.EnvBuilder(); c = b.ensure_directories(\"local\"); b.create_configuration(c)'\n$ cat local/pyvenv.cfg\nhome = /usr/bin\ninclude-system-site-packages = false\nversion = 3.6.8\n```\n\nbut I think even that's overkill for now.",
    "created_at": "2020-01-16T19:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531163",
    "user": "https://github.com/embray"
}
```

<a id='comment:40'></a>
Replying to [dimpase](#comment%3A38):
> writing `pyvenv.cfg` by hand is bound to be broken at some point, as it's an implementation detail of venv.
> The correct interface to `venv` is to use `venv`, I think.


That's not true.  It's documented both in the documentation for the `venv` module and the `site` module.  If you really want to avoid writing it by hand the `venv` module includes code for that as well.  This (with the *system* Python 3) is effectively the same (albeit more opaque).  From within SAGE_ROOT, but without the sage environment activated:

```
$ python3 -c 'import venv; b = venv.EnvBuilder(); c = b.ensure_directories("local"); b.create_configuration(c)'
$ cat local/pyvenv.cfg
home = /usr/bin
include-system-site-packages = false
version = 3.6.8
```

but I think even that's overkill for now.



---

archive/issue_comments_531164.json:
```json
{
    "body": "<a id='comment:41'></a>\nReplying to [mkoeppe](#comment%3A36):\n> Replying to [embray](#comment%3A34):\n> > What's the deal with `config_venv`?  Why is any of that necessary?  I looked at the commit that added it but it wasn't clear. \n\n> \n> It is used in a configure test, `build/pkgs/python3/spkg-configure.m4` to make sure that the system python has all optional modules that we need.\n\n\nBut why do you need to make a virtualenv for that?  Why not run the system python directly?",
    "created_at": "2020-01-16T19:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531164",
    "user": "https://github.com/embray"
}
```

<a id='comment:41'></a>
Replying to [mkoeppe](#comment%3A36):
> Replying to [embray](#comment%3A34):
> > What's the deal with `config_venv`?  Why is any of that necessary?  I looked at the commit that added it but it wasn't clear. 

> 
> It is used in a configure test, `build/pkgs/python3/spkg-configure.m4` to make sure that the system python has all optional modules that we need.


But why do you need to make a virtualenv for that?  Why not run the system python directly?



---

archive/issue_comments_531165.json:
```json
{
    "body": "<a id='comment:42'></a>\nReplying to [embray](#comment%3A41):\n> But why do you need to make a virtualenv for that?  Why not run the system python directly?\n\nOn this ticket, the system python is not used directly but rather in a venv without site-packages.\nTherefore the correct test is to test whether the module will be available in a venv.",
    "created_at": "2020-01-16T19:13:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531165",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>
Replying to [embray](#comment%3A41):
> But why do you need to make a virtualenv for that?  Why not run the system python directly?

On this ticket, the system python is not used directly but rather in a venv without site-packages.
Therefore the correct test is to test whether the module will be available in a venv.



---

archive/issue_comments_531166.json:
```json
{
    "body": "<a id='comment:43'></a>\nI'll add this documentation to the branch.",
    "created_at": "2020-01-16T19:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531166",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>
I'll add this documentation to the branch.



---

archive/issue_comments_531167.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [mkoeppe](#comment%3A39):\n> Replying to [dimpase](#comment%3A38):\n> > (By the way, the idea of using venv/virtualenv is probably mine, IIRC I put it in the original version of this ticket :-))\n\n> Glad we have this on record now for the software historians/archaeologists to discover :)\nit's here:\nhttps://trac.sagemath.org/ticket/27824?version=0",
    "created_at": "2020-01-16T19:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531167",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:44'></a>
Replying to [mkoeppe](#comment%3A39):
> Replying to [dimpase](#comment%3A38):
> > (By the way, the idea of using venv/virtualenv is probably mine, IIRC I put it in the original version of this ticket :-))

> Glad we have this on record now for the software historians/archaeologists to discover :)
it's here:
https://trac.sagemath.org/ticket/27824?version=0



---

archive/issue_comments_531168.json:
```json
{
    "body": "Changing commit from \"8c546cfd4a35c82c911e3620538c2188e7e350f2\" to \"348cf2243ce7c8696504a5d85eee849c24cef2a9\"",
    "created_at": "2020-01-16T19:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531168",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8c546cfd4a35c82c911e3620538c2188e7e350f2" to "348cf2243ce7c8696504a5d85eee849c24cef2a9"



---

archive/issue_comments_531169.json:
```json
{
    "body": "<a id='comment:45'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|\n|[348cf22](https://github.com/sagemath/sagetrac-mirror/commit/348cf2243ce7c8696504a5d85eee849c24cef2a9)|`build/pkgs/python3/spkg-configure.m4: Add comments`|",
    "created_at": "2020-01-16T19:18:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531169",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|
|[348cf22](https://github.com/sagemath/sagetrac-mirror/commit/348cf2243ce7c8696504a5d85eee849c24cef2a9)|`build/pkgs/python3/spkg-configure.m4: Add comments`|



---

archive/issue_comments_531170.json:
```json
{
    "body": "<a id='comment:46'></a>\nBy the way, should I be checking for the ssl module too?",
    "created_at": "2020-01-16T19:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531170",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>
By the way, should I be checking for the ssl module too?



---

archive/issue_comments_531171.json:
```json
{
    "body": "<a id='comment:47'></a>\nReplying to [mkoeppe](#comment%3A42):\n> Replying to [embray](#comment%3A41):\n> > But why do you need to make a virtualenv for that?  Why not run the system python directly?\n\n> On this ticket, the system python is not used directly but rather in a venv without site-packages.\n> Therefore the correct test is to test whether the module will be available in a venv.\n\n\nBut why?",
    "created_at": "2020-01-16T19:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531171",
    "user": "https://github.com/embray"
}
```

<a id='comment:47'></a>
Replying to [mkoeppe](#comment%3A42):
> Replying to [embray](#comment%3A41):
> > But why do you need to make a virtualenv for that?  Why not run the system python directly?

> On this ticket, the system python is not used directly but rather in a venv without site-packages.
> Therefore the correct test is to test whether the module will be available in a venv.


But why?



---

archive/issue_comments_531172.json:
```json
{
    "body": "<a id='comment:48'></a>\nReplying to [embray](#comment%3A47):\n> Replying to [mkoeppe](#comment%3A42):\n> > Replying to [embray](#comment%3A41):\n> > > But why do you need to make a virtualenv for that?  Why not run the system python directly?\n\n> > On this ticket, the system python is not used directly but rather in a venv without site-packages.\n> > Therefore the correct test is to test whether the module will be available in a venv.\n\n> \n> But why?\n\n\nWait, I misunderstood what you wrote at first.  I know why it uses a virtualenv.  What I don't get is why you need to make a venv to test features of the system python when you can just call the system python directly here?",
    "created_at": "2020-01-16T19:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531172",
    "user": "https://github.com/embray"
}
```

<a id='comment:48'></a>
Replying to [embray](#comment%3A47):
> Replying to [mkoeppe](#comment%3A42):
> > Replying to [embray](#comment%3A41):
> > > But why do you need to make a virtualenv for that?  Why not run the system python directly?

> > On this ticket, the system python is not used directly but rather in a venv without site-packages.
> > Therefore the correct test is to test whether the module will be available in a venv.

> 
> But why?


Wait, I misunderstood what you wrote at first.  I know why it uses a virtualenv.  What I don't get is why you need to make a venv to test features of the system python when you can just call the system python directly here?



---

archive/issue_comments_531173.json:
```json
{
    "body": "<a id='comment:49'></a>\nReplying to [embray](#comment%3A48):\n> What I don't get is why you need to make a venv to test features of the system python when you can just call the system python directly here?\n\nBecause system python could have a module named `sqlite3` in its `site-packages`; but then when we try to use it in a venv, it won't be there.",
    "created_at": "2020-01-16T19:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531173",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:49'></a>
Replying to [embray](#comment%3A48):
> What I don't get is why you need to make a venv to test features of the system python when you can just call the system python directly here?

Because system python could have a module named `sqlite3` in its `site-packages`; but then when we try to use it in a venv, it won't be there.



---

archive/issue_comments_531174.json:
```json
{
    "body": "<a id='comment:50'></a>\nReplying to [mkoeppe](#comment%3A46):\n> By the way, should I be checking for the ssl module too?\n\nI think I'll check for all modules mentioned in #27705.",
    "created_at": "2020-01-16T20:02:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531174",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>
Replying to [mkoeppe](#comment%3A46):
> By the way, should I be checking for the ssl module too?

I think I'll check for all modules mentioned in #27705.



---

archive/issue_comments_531175.json:
```json
{
    "body": "<a id='comment:51'></a>\nReplying to [mkoeppe](#comment%3A49):\n> Replying to [embray](#comment%3A48):\n> > What I don't get is why you need to make a venv to test features of the system python when you can just call the system python directly here?\n\n> Because system python could have a module named `sqlite3` in its `site-packages`; but then when we try to use it in a venv, it won't be there.\n\nSo use `python3 -S` if you really want to be sure.  That disables site-packages.",
    "created_at": "2020-01-16T20:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531175",
    "user": "https://github.com/embray"
}
```

<a id='comment:51'></a>
Replying to [mkoeppe](#comment%3A49):
> Replying to [embray](#comment%3A48):
> > What I don't get is why you need to make a venv to test features of the system python when you can just call the system python directly here?

> Because system python could have a module named `sqlite3` in its `site-packages`; but then when we try to use it in a venv, it won't be there.

So use `python3 -S` if you really want to be sure.  That disables site-packages.



---

archive/issue_comments_531176.json:
```json
{
    "body": "<a id='comment:52'></a>\nAn interesting discovery while playing around with this:  By default Ubuntu's Python does not have distutils.  You have to explicitly `apt-get install python3-distutils`.  So this is something we also need to check for at configure time or else it wont be possible to install Python packages.",
    "created_at": "2020-01-16T20:21:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531176",
    "user": "https://github.com/embray"
}
```

<a id='comment:52'></a>
An interesting discovery while playing around with this:  By default Ubuntu's Python does not have distutils.  You have to explicitly `apt-get install python3-distutils`.  So this is something we also need to check for at configure time or else it wont be possible to install Python packages.



---

archive/issue_comments_531177.json:
```json
{
    "body": "<a id='comment:53'></a>\nFWIW I'm experimenting with an alternative solution based on my comments here (albeit with significant pieces taken from this ticket!)  I'll update when I have something that I think works...",
    "created_at": "2020-01-16T20:24:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531177",
    "user": "https://github.com/embray"
}
```

<a id='comment:53'></a>
FWIW I'm experimenting with an alternative solution based on my comments here (albeit with significant pieces taken from this ticket!)  I'll update when I have something that I think works...



---

archive/issue_comments_531178.json:
```json
{
    "body": "<a id='comment:54'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|\n|[cb399a1](https://github.com/sagemath/sagetrac-mirror/commit/cb399a1fcfd4d8a74c90bad95d1e5d7e521f19a1)|`Set PYTHON_FOR_VENV correctly, use it in build/make/deps`|",
    "created_at": "2020-01-16T21:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531178",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:54'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
|[cb399a1](https://github.com/sagemath/sagetrac-mirror/commit/cb399a1fcfd4d8a74c90bad95d1e5d7e521f19a1)|`Set PYTHON_FOR_VENV correctly, use it in build/make/deps`|



---

archive/issue_comments_531179.json:
```json
{
    "body": "Changing commit from \"348cf2243ce7c8696504a5d85eee849c24cef2a9\" to \"cb399a1fcfd4d8a74c90bad95d1e5d7e521f19a1\"",
    "created_at": "2020-01-16T21:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531179",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "348cf2243ce7c8696504a5d85eee849c24cef2a9" to "cb399a1fcfd4d8a74c90bad95d1e5d7e521f19a1"



---

archive/issue_comments_531180.json:
```json
{
    "body": "<a id='comment:55'></a>\nReplying to [embray](#comment%3A52):\n>  By default Ubuntu's Python does not have distutils.  You have to explicitly `apt-get install python3-distutils`.  So this is something we also need to check for at configure time or else it wont be possible to install Python packages.\n\nThanks! I'll add this test.",
    "created_at": "2020-01-16T22:10:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531180",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:55'></a>
Replying to [embray](#comment%3A52):
>  By default Ubuntu's Python does not have distutils.  You have to explicitly `apt-get install python3-distutils`.  So this is something we also need to check for at configure time or else it wont be possible to install Python packages.

Thanks! I'll add this test.



---

archive/issue_comments_531181.json:
```json
{
    "body": "Changing commit from \"cb399a1fcfd4d8a74c90bad95d1e5d7e521f19a1\" to \"71cc4919119784d243d65f853f336771e93e4478\"",
    "created_at": "2020-01-16T22:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531181",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cb399a1fcfd4d8a74c90bad95d1e5d7e521f19a1" to "71cc4919119784d243d65f853f336771e93e4478"



---

archive/issue_comments_531182.json:
```json
{
    "body": "<a id='comment:56'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------|\n|[71cc491](https://github.com/sagemath/sagetrac-mirror/commit/71cc4919119784d243d65f853f336771e93e4478)|`build/pkgs/python3/spkg-configure.m4: Check for more modules, including distutils.core`|",
    "created_at": "2020-01-16T22:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531182",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:56'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------|
|[71cc491](https://github.com/sagemath/sagetrac-mirror/commit/71cc4919119784d243d65f853f336771e93e4478)|`build/pkgs/python3/spkg-configure.m4: Check for more modules, including distutils.core`|



---

archive/issue_comments_531183.json:
```json
{
    "body": "<a id='comment:57'></a>\nAlso, of course, one needs the Python headers, on Ubuntu from `libpython3.7-dev`.",
    "created_at": "2020-01-16T22:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531183",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:57'></a>
Also, of course, one needs the Python headers, on Ubuntu from `libpython3.7-dev`.



---

archive/issue_comments_531184.json:
```json
{
    "body": "<a id='comment:58'></a>\nSo I'll add a check that the distutils can actually build an extension.",
    "created_at": "2020-01-16T23:13:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531184",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>
So I'll add a check that the distutils can actually build an extension.



---

archive/issue_comments_531185.json:
```json
{
    "body": "Changing commit from \"71cc4919119784d243d65f853f336771e93e4478\" to \"c7c16711c2f3ab262c8d76f6b565727bfc01edff\"",
    "created_at": "2020-01-17T01:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531185",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "71cc4919119784d243d65f853f336771e93e4478" to "c7c16711c2f3ab262c8d76f6b565727bfc01edff"



---

archive/issue_comments_531186.json:
```json
{
    "body": "<a id='comment:59'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|\n|[c7c1671](https://github.com/sagemath/sagetrac-mirror/commit/c7c16711c2f3ab262c8d76f6b565727bfc01edff)|`build/pkgs/python3/spkg-configure.m4: Check that distutils can build an extension`|",
    "created_at": "2020-01-17T01:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531186",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:59'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------|
|[c7c1671](https://github.com/sagemath/sagetrac-mirror/commit/c7c16711c2f3ab262c8d76f6b565727bfc01edff)|`build/pkgs/python3/spkg-configure.m4: Check that distutils can build an extension`|



---

archive/issue_comments_531187.json:
```json
{
    "body": "Attachment [Dockerfile-ubuntu-minimal](tarball://root/attachments/some-uuid/ticket27824/Dockerfile-ubuntu-minimal) by @mkoeppe created at 2020-01-17 03:57:53",
    "created_at": "2020-01-17T03:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531187",
    "user": "https://github.com/mkoeppe"
}
```

Attachment [Dockerfile-ubuntu-minimal](tarball://root/attachments/some-uuid/ticket27824/Dockerfile-ubuntu-minimal) by @mkoeppe created at 2020-01-17 03:57:53



---

archive/issue_comments_531188.json:
```json
{
    "body": "<a id='comment:60'></a>\nTesting with the attached Dockerfile on ubuntu bionic.\n\nmodule and distutils checking seems to work correctly.\n\nGot stuck at `scipy` install. \n\n```\n[scipy-1.2.0]     numpy.distutils.system_info.NotFoundError: No lapack/blas resources found.\n```\n\nLooks like `scipy` would need a sitecfg as well so that it finds BLAS. It's strange that we build numpy with providing `site.cfg` (which we just had to correct in #29025), but `scipy` without `site.cfg`.",
    "created_at": "2020-01-17T04:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531188",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'></a>
Testing with the attached Dockerfile on ubuntu bionic.

module and distutils checking seems to work correctly.

Got stuck at `scipy` install. 

```
[scipy-1.2.0]     numpy.distutils.system_info.NotFoundError: No lapack/blas resources found.
```

Looks like `scipy` would need a sitecfg as well so that it finds BLAS. It's strange that we build numpy with providing `site.cfg` (which we just had to correct in #29025), but `scipy` without `site.cfg`.



---

archive/issue_comments_531189.json:
```json
{
    "body": "<a id='comment:61'></a>\nReplying to [mkoeppe](#comment%3A60):\n> Testing with the attached Dockerfile on ubuntu bionic.\n> \n> module and distutils checking seems to work correctly.\n> \n> Got stuck at `scipy` install. \n> \n> ```\n> [scipy-1.2.0]     numpy.distutils.system_info.NotFoundError: No lapack/blas resources found.\n> ```\n> \n> Looks like `scipy` would need a sitecfg as well so that it finds BLAS. It's strange that we build numpy with providing `site.cfg` (which we just had to correct in #29025), but `scipy` without `site.cfg`.\n\n\n`@`fbissey, based on your work on scipy configuration in #20157, would you be able to help with this?",
    "created_at": "2020-01-17T04:26:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531189",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:61'></a>
Replying to [mkoeppe](#comment%3A60):
> Testing with the attached Dockerfile on ubuntu bionic.
> 
> module and distutils checking seems to work correctly.
> 
> Got stuck at `scipy` install. 
> 
> ```
> [scipy-1.2.0]     numpy.distutils.system_info.NotFoundError: No lapack/blas resources found.
> ```
> 
> Looks like `scipy` would need a sitecfg as well so that it finds BLAS. It's strange that we build numpy with providing `site.cfg` (which we just had to correct in #29025), but `scipy` without `site.cfg`.


`@`fbissey, based on your work on scipy configuration in #20157, would you be able to help with this?



---

archive/issue_comments_531190.json:
```json
{
    "body": "<a id='comment:62'></a>\nYou could provide an identical `site.cfg` for scipy. The reason you shouldn't technically have to do it, is that the one from numpy is actually shipped. You should have a file `numpy/distutils/site.cfg` in your numpy install and it should be the one you used to configure numpy. If it is missing you'll run into the trouble above I am sure.",
    "created_at": "2020-01-17T04:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531190",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:62'></a>
You could provide an identical `site.cfg` for scipy. The reason you shouldn't technically have to do it, is that the one from numpy is actually shipped. You should have a file `numpy/distutils/site.cfg` in your numpy install and it should be the one you used to configure numpy. If it is missing you'll run into the trouble above I am sure.



---

archive/issue_comments_531191.json:
```json
{
    "body": "<a id='comment:63'></a>\nReplying to [mkoeppe](#comment%3A49):\n> Replying to [embray](#comment%3A48):\n> > What I don't get is why you need to make a venv to test features of the system python when you can just call the system python directly here?\n\n> Because system python could have a module named `sqlite3` in its `site-packages`; but then when we try to use it in a venv, it won't be there.\n\nI wonder about rationale for disabling system's `site-packages`.\nIs this the only way to install custom versions of packages in venv (which can conflict with ones is system's `site-packages`)?",
    "created_at": "2020-01-17T10:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531191",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:63'></a>
Replying to [mkoeppe](#comment%3A49):
> Replying to [embray](#comment%3A48):
> > What I don't get is why you need to make a venv to test features of the system python when you can just call the system python directly here?

> Because system python could have a module named `sqlite3` in its `site-packages`; but then when we try to use it in a venv, it won't be there.

I wonder about rationale for disabling system's `site-packages`.
Is this the only way to install custom versions of packages in venv (which can conflict with ones is system's `site-packages`)?



---

archive/issue_comments_531192.json:
```json
{
    "body": "<a id='comment:64'></a>\n> I wonder about rationale for disabling system's `site-packages`.\n> Is this the only way to install custom versions of packages in venv (which can conflict with ones is system's `site-packages`)?\n\n\nIt\u2019s strictly for making this ticket easier because I don\u2019t have to worry about getting the correct versions of all Python packages.\nSee #29023 for the next step - let\u2019s discuss any issues regarding use of system site packages there.",
    "created_at": "2020-01-17T12:16:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531192",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:64'></a>
> I wonder about rationale for disabling system's `site-packages`.
> Is this the only way to install custom versions of packages in venv (which can conflict with ones is system's `site-packages`)?


It’s strictly for making this ticket easier because I don’t have to worry about getting the correct versions of all Python packages.
See #29023 for the next step - let’s discuss any issues regarding use of system site packages there.



---

archive/issue_comments_531193.json:
```json
{
    "body": "<a id='comment:65'></a>\nReplying to [mkoeppe](#comment%3A64):\n> \n> > I wonder about rationale for disabling system's `site-packages`.\n> > Is this the only way to install custom versions of packages in venv (which can conflict with ones is system's `site-packages`)?\n\n> \n> It\u2019s strictly for making this ticket easier because I don\u2019t have to worry about getting the correct versions of all Python packages.\n> See #29023 for the next step - let\u2019s discuss any issues regarding use of system site packages there.\n\n\nI agree here, it's much simpler for now to focus on using a \"bare\" Python as much as possible.  I think detecting and using system Python packages *is* where we want to go, but it can get a bit hairier...",
    "created_at": "2020-01-17T12:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531193",
    "user": "https://github.com/embray"
}
```

<a id='comment:65'></a>
Replying to [mkoeppe](#comment%3A64):
> 
> > I wonder about rationale for disabling system's `site-packages`.
> > Is this the only way to install custom versions of packages in venv (which can conflict with ones is system's `site-packages`)?

> 
> It’s strictly for making this ticket easier because I don’t have to worry about getting the correct versions of all Python packages.
> See #29023 for the next step - let’s discuss any issues regarding use of system site packages there.


I agree here, it's much simpler for now to focus on using a "bare" Python as much as possible.  I think detecting and using system Python packages *is* where we want to go, but it can get a bit hairier...



---

archive/issue_comments_531194.json:
```json
{
    "body": "<a id='comment:66'></a>\nFor the heck of it, I'm seeing how far I can get with a system Python 3.6.  I think anything less than 3.6 is almost definitely too old, but I have a feeling 3.6 might still be usable as a minimum.  The only major hassle I've had so far is ensuring that it uses UTF-8 encoding by default.",
    "created_at": "2020-01-17T14:08:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531194",
    "user": "https://github.com/embray"
}
```

<a id='comment:66'></a>
For the heck of it, I'm seeing how far I can get with a system Python 3.6.  I think anything less than 3.6 is almost definitely too old, but I have a feeling 3.6 might still be usable as a minimum.  The only major hassle I've had so far is ensuring that it uses UTF-8 encoding by default.



---

archive/issue_comments_531195.json:
```json
{
    "body": "Changing dependencies from \"#29013, #29019\" to \"#29002, #29013, #29019\"",
    "created_at": "2020-01-17T14:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531195",
    "user": "https://github.com/embray"
}
```

Changing dependencies from "#29013, #29019" to "#29002, #29013, #29019"



---

archive/issue_comments_531196.json:
```json
{
    "body": "<a id='comment:68'></a>\nReplying to [fbissey](#comment%3A62):\n> You could provide an identical `site.cfg` for scipy. The reason you shouldn't technically have to do it, is that the one from numpy is actually shipped. You should have a file `numpy/distutils/site.cfg` in your numpy install and it should be the one you used to configure numpy. If it is missing you'll run into the trouble above I am sure.\n\nThank you! The file is installed. I'll investigate why it is not enough.",
    "created_at": "2020-01-17T15:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531196",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:68'></a>
Replying to [fbissey](#comment%3A62):
> You could provide an identical `site.cfg` for scipy. The reason you shouldn't technically have to do it, is that the one from numpy is actually shipped. You should have a file `numpy/distutils/site.cfg` in your numpy install and it should be the one you used to configure numpy. If it is missing you'll run into the trouble above I am sure.

Thank you! The file is installed. I'll investigate why it is not enough.



---

archive/issue_comments_531197.json:
```json
{
    "body": "<a id='comment:69'></a>\nReplying to [embray](#comment%3A53):\n> FWIW I'm experimenting with an alternative solution based on my comments here (albeit with significant pieces taken from this ticket!)  I'll update when I have something that I think works...\n\n\nHere's a prototype of my alternative approach: #29032\n\nI admit it does not yet address as many issues as this ticket does, like all the site.cfg fixes with Numpy.  Personally I didn't need it, but if those fixes are necessary they can easily be applied to my ticket as well.",
    "created_at": "2020-01-17T17:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531197",
    "user": "https://github.com/embray"
}
```

<a id='comment:69'></a>
Replying to [embray](#comment%3A53):
> FWIW I'm experimenting with an alternative solution based on my comments here (albeit with significant pieces taken from this ticket!)  I'll update when I have something that I think works...


Here's a prototype of my alternative approach: #29032

I admit it does not yet address as many issues as this ticket does, like all the site.cfg fixes with Numpy.  Personally I didn't need it, but if those fixes are necessary they can easily be applied to my ticket as well.



---

archive/issue_comments_531198.json:
```json
{
    "body": "Changing commit from \"c7c16711c2f3ab262c8d76f6b565727bfc01edff\" to \"356b6d78d66202a17ebcace6178baea91373deb3\"",
    "created_at": "2020-01-17T18:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531198",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c7c16711c2f3ab262c8d76f6b565727bfc01edff" to "356b6d78d66202a17ebcace6178baea91373deb3"



---

archive/issue_comments_531199.json:
```json
{
    "body": "<a id='comment:70'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                                                                                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n|[356b6d7](https://github.com/sagemath/sagetrac-mirror/commit/356b6d78d66202a17ebcace6178baea91373deb3)|`build/pkgs/python3/spkg-configure.m4: Rename config_setup.py and config_build to conftest.py and conftest.dir respectively since autoconf will automatically clean up files and directories beginning with \"conftest\"`|",
    "created_at": "2020-01-17T18:03:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531199",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:70'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                                                                                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|[356b6d7](https://github.com/sagemath/sagetrac-mirror/commit/356b6d78d66202a17ebcace6178baea91373deb3)|`build/pkgs/python3/spkg-configure.m4: Rename config_setup.py and config_build to conftest.py and conftest.dir respectively since autoconf will automatically clean up files and directories beginning with "conftest"`|



---

archive/issue_comments_531200.json:
```json
{
    "body": "<a id='comment:71'></a>\n(extracted from Erik's commit at #29032.)",
    "created_at": "2020-01-17T18:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531200",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:71'></a>
(extracted from Erik's commit at #29032.)



---

archive/issue_comments_531201.json:
```json
{
    "body": "Changing commit from \"356b6d78d66202a17ebcace6178baea91373deb3\" to \"92953ceda3f7ba7d6b0246fa5828372bf352dc84\"",
    "created_at": "2020-01-17T18:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531201",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "356b6d78d66202a17ebcace6178baea91373deb3" to "92953ceda3f7ba7d6b0246fa5828372bf352dc84"



---

archive/issue_comments_531202.json:
```json
{
    "body": "<a id='comment:72'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                                                                                                                                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n|[92953ce](https://github.com/sagemath/sagetrac-mirror/commit/92953ceda3f7ba7d6b0246fa5828372bf352dc84)|`build/pkgs/python3/spkg-configure.m4: Rename config_setup.py and config_build to conftest.py and conftest.dir respectively since autoconf will automatically clean up files and directories beginning with \"conftest\"`|",
    "created_at": "2020-01-17T18:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531202",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:72'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                                                                                                                                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|[92953ce](https://github.com/sagemath/sagetrac-mirror/commit/92953ceda3f7ba7d6b0246fa5828372bf352dc84)|`build/pkgs/python3/spkg-configure.m4: Rename config_setup.py and config_build to conftest.py and conftest.dir respectively since autoconf will automatically clean up files and directories beginning with "conftest"`|



---

archive/issue_comments_531203.json:
```json
{
    "body": "Changing author from \"Matthias Koeppe\" to \"Matthias Koeppe, Erik Bray\"",
    "created_at": "2020-01-17T18:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531203",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Matthias Koeppe" to "Matthias Koeppe, Erik Bray"



---

archive/issue_comments_531204.json:
```json
{
    "body": "<a id='comment:74'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|\n|[08ec551](https://github.com/sagemath/sagetrac-mirror/commit/08ec5516a2f5aa0b7e59b2a20ef0316bdc3784b7)|`build/make/deps: Make python3_venv a .PHONY target`|\n|[b2ab6f3](https://github.com/sagemath/sagetrac-mirror/commit/b2ab6f3b383e25656b520fd70b05908d24376c83)|`src/bin/sage-env: Simplify the venv path to $SAGE_LOCAL/lib/sage/venv`|\n|[7a43544](https://github.com/sagemath/sagetrac-mirror/commit/7a435448517b4cae9825943447d2eaf77757a4a6)|`src/sage/env.py, envconfig.py.in: Add MAXIMA; src/sage/interfaces/maxima.py: Use it`|\n|[f2af478](https://github.com/sagemath/sagetrac-mirror/commit/f2af47873732f2142fc4b6b3bf6b4aed94a2503a)|`Merge branch 't/29022/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env' into t/29013/public/29013-use-py3-venv`|\n|[8959c19](https://github.com/sagemath/sagetrac-mirror/commit/8959c19aed99055839e47a5025d5a69411fd7734)|`Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure`|\n|[4c78bdf](https://github.com/sagemath/sagetrac-mirror/commit/4c78bdfccf72183181ee666909dbe365f50b7143)|`src/bin/sage-env: Make inst_python3_venv = $(SAGE_VENV)/pyvenv.cfg. Adapted from #29032`|",
    "created_at": "2020-01-17T21:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531204",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:74'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|
|[08ec551](https://github.com/sagemath/sagetrac-mirror/commit/08ec5516a2f5aa0b7e59b2a20ef0316bdc3784b7)|`build/make/deps: Make python3_venv a .PHONY target`|
|[b2ab6f3](https://github.com/sagemath/sagetrac-mirror/commit/b2ab6f3b383e25656b520fd70b05908d24376c83)|`src/bin/sage-env: Simplify the venv path to $SAGE_LOCAL/lib/sage/venv`|
|[7a43544](https://github.com/sagemath/sagetrac-mirror/commit/7a435448517b4cae9825943447d2eaf77757a4a6)|`src/sage/env.py, envconfig.py.in: Add MAXIMA; src/sage/interfaces/maxima.py: Use it`|
|[f2af478](https://github.com/sagemath/sagetrac-mirror/commit/f2af47873732f2142fc4b6b3bf6b4aed94a2503a)|`Merge branch 't/29022/create_module_src_sage_env_config_py_from_src_sage_env_config_py_in__defining_variables_for_use_in_sage_env' into t/29013/public/29013-use-py3-venv`|
|[8959c19](https://github.com/sagemath/sagetrac-mirror/commit/8959c19aed99055839e47a5025d5a69411fd7734)|`Merge branch 't/29013/public/29013-use-py3-venv' into t/27824/public/27824-python3-spkg-configure`|
|[4c78bdf](https://github.com/sagemath/sagetrac-mirror/commit/4c78bdfccf72183181ee666909dbe365f50b7143)|`src/bin/sage-env: Make inst_python3_venv = $(SAGE_VENV)/pyvenv.cfg. Adapted from #29032`|



---

archive/issue_comments_531205.json:
```json
{
    "body": "Changing commit from \"92953ceda3f7ba7d6b0246fa5828372bf352dc84\" to \"4c78bdfccf72183181ee666909dbe365f50b7143\"",
    "created_at": "2020-01-17T21:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531205",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "92953ceda3f7ba7d6b0246fa5828372bf352dc84" to "4c78bdfccf72183181ee666909dbe365f50b7143"



---

archive/issue_comments_531206.json:
```json
{
    "body": "<a id='comment:75'></a>\nReplying to [mkoeppe](#comment%3A68):\n> Replying to [fbissey](#comment%3A62):\n> > You could provide an identical `site.cfg` for scipy. The reason you shouldn't technically have to do it, is that the one from numpy is actually shipped. You should have a file `numpy/distutils/site.cfg` in your numpy install and it should be the one you used to configure numpy. If it is missing you'll run into the trouble above I am sure.\n\n> Thank you! The file is installed. I'll investigate why it is not enough.\n\nI've created ticket #29051 for this (Paths configured in installed numpy `site.cfg [DEFAULT/ALL]` do not affect scipy)",
    "created_at": "2020-01-20T14:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531206",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:75'></a>
Replying to [mkoeppe](#comment%3A68):
> Replying to [fbissey](#comment%3A62):
> > You could provide an identical `site.cfg` for scipy. The reason you shouldn't technically have to do it, is that the one from numpy is actually shipped. You should have a file `numpy/distutils/site.cfg` in your numpy install and it should be the one you used to configure numpy. If it is missing you'll run into the trouble above I am sure.

> Thank you! The file is installed. I'll investigate why it is not enough.

I've created ticket #29051 for this (Paths configured in installed numpy `site.cfg [DEFAULT/ALL]` do not affect scipy)



---

archive/issue_comments_531207.json:
```json
{
    "body": "<a id='comment:76'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n|                                                                                                                                           |                                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------|\n|[56e3daa](https://github.com/sagemath/sagetrac-mirror/commit/56e3daa3cc5b12f495f4f307b3450124466f5ac5)|`src/bin/sage-env: Simplify the venv path to $SAGE_LOCAL/lib/sage/venv`|\n|[208c7e6](https://github.com/sagemath/sagetrac-mirror/commit/208c7e68c24c1fe896a5e6573c6aae5399056431)|`src/sage/env.py: Rework _get_shared_lib_filename, fix for Cygwin: it would privilege system DLLs over DLLs in SAGE_LOCAL`|\n|[1bd8aef](https://github.com/sagemath/sagetrac-mirror/commit/1bd8aef383130227fdc466712dccfcd981851b69)|`spkg-configure.m4 for python3`|\n|[7237aa4](https://github.com/sagemath/sagetrac-mirror/commit/7237aa4d7d3121a0dbb8bd34b270925e38bedbf6)|`build/pkgs/python3/spkg-configure.m4: Add SAGE_SPKG_DEPCHECK for sqlite libpng bzip2 xz libffi`|\n|[d044744](https://github.com/sagemath/sagetrac-mirror/commit/d044744bbdfaac333cf50aa7c8a0db1b911f63d6)|`build/pkgs/python3/spkg-configure.m4: Find `@`PYTHON_FOR_VENV`@` that has sqlite3 module`|\n|[c6fec13](https://github.com/sagemath/sagetrac-mirror/commit/c6fec131e6fd2e95ee72b7c611ec58bc5d02c99b)|`src/bin/sage-env: Don't set MACOSX_DEPLOYMENT_TARGET if we use system python3`|\n|[b69ac5b](https://github.com/sagemath/sagetrac-mirror/commit/b69ac5bbe12aafb66fb54f052d3e62c020e99c28)|`Set PYTHON_FOR_VENV correctly, use it in build/make/deps`|\n|[c143043](https://github.com/sagemath/sagetrac-mirror/commit/c1430438d70f52a369bca79881a9a0e0ddef06ba)|`build/pkgs/python3/spkg-configure.m4: Check for more modules, including distutils.core`|\n|[973c36f](https://github.com/sagemath/sagetrac-mirror/commit/973c36f09dd8407aeceb0b4cf586a10e95937ffb)|`build/pkgs/python3/spkg-configure.m4: Rename config_setup.py and config_build to conftest.py and conftest.dir respectively since autoconf will automatically clean up files and directories beginning with \"conftest\"`|\n|[3d90535](https://github.com/sagemath/sagetrac-mirror/commit/3d90535b3301e49433e98146e2179c6daa549bf2)|`src/bin/sage-env: Make inst_python3_venv = $(SAGE_VENV)/pyvenv.cfg. Adapted from #29032`|",
    "created_at": "2020-03-18T00:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531207",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:76'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
|                                                                                                                                           |                                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------|
|[56e3daa](https://github.com/sagemath/sagetrac-mirror/commit/56e3daa3cc5b12f495f4f307b3450124466f5ac5)|`src/bin/sage-env: Simplify the venv path to $SAGE_LOCAL/lib/sage/venv`|
|[208c7e6](https://github.com/sagemath/sagetrac-mirror/commit/208c7e68c24c1fe896a5e6573c6aae5399056431)|`src/sage/env.py: Rework _get_shared_lib_filename, fix for Cygwin: it would privilege system DLLs over DLLs in SAGE_LOCAL`|
|[1bd8aef](https://github.com/sagemath/sagetrac-mirror/commit/1bd8aef383130227fdc466712dccfcd981851b69)|`spkg-configure.m4 for python3`|
|[7237aa4](https://github.com/sagemath/sagetrac-mirror/commit/7237aa4d7d3121a0dbb8bd34b270925e38bedbf6)|`build/pkgs/python3/spkg-configure.m4: Add SAGE_SPKG_DEPCHECK for sqlite libpng bzip2 xz libffi`|
|[d044744](https://github.com/sagemath/sagetrac-mirror/commit/d044744bbdfaac333cf50aa7c8a0db1b911f63d6)|`build/pkgs/python3/spkg-configure.m4: Find `@`PYTHON_FOR_VENV`@` that has sqlite3 module`|
|[c6fec13](https://github.com/sagemath/sagetrac-mirror/commit/c6fec131e6fd2e95ee72b7c611ec58bc5d02c99b)|`src/bin/sage-env: Don't set MACOSX_DEPLOYMENT_TARGET if we use system python3`|
|[b69ac5b](https://github.com/sagemath/sagetrac-mirror/commit/b69ac5bbe12aafb66fb54f052d3e62c020e99c28)|`Set PYTHON_FOR_VENV correctly, use it in build/make/deps`|
|[c143043](https://github.com/sagemath/sagetrac-mirror/commit/c1430438d70f52a369bca79881a9a0e0ddef06ba)|`build/pkgs/python3/spkg-configure.m4: Check for more modules, including distutils.core`|
|[973c36f](https://github.com/sagemath/sagetrac-mirror/commit/973c36f09dd8407aeceb0b4cf586a10e95937ffb)|`build/pkgs/python3/spkg-configure.m4: Rename config_setup.py and config_build to conftest.py and conftest.dir respectively since autoconf will automatically clean up files and directories beginning with "conftest"`|
|[3d90535](https://github.com/sagemath/sagetrac-mirror/commit/3d90535b3301e49433e98146e2179c6daa549bf2)|`src/bin/sage-env: Make inst_python3_venv = $(SAGE_VENV)/pyvenv.cfg. Adapted from #29032`|



---

archive/issue_comments_531208.json:
```json
{
    "body": "Changing commit from \"4c78bdfccf72183181ee666909dbe365f50b7143\" to \"3d90535b3301e49433e98146e2179c6daa549bf2\"",
    "created_at": "2020-03-18T00:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531208",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4c78bdfccf72183181ee666909dbe365f50b7143" to "3d90535b3301e49433e98146e2179c6daa549bf2"



---

archive/issue_comments_531209.json:
```json
{
    "body": "Changing dependencies from \"#29002, #29013, #29019\" to \"#29013\"",
    "created_at": "2020-03-18T00:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531209",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#29002, #29013, #29019" to "#29013"



---

archive/issue_comments_531210.json:
```json
{
    "body": "<a id='comment:78'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n|[73e730c](https://github.com/sagemath/sagetrac-mirror/commit/73e730cc464b3409b146f5a6820450b8c260087a)|`build/bin/sage-system-python: Prefer python3, check a larger list of executable names, check for urllib; exit with a proper error message if no suitable Python is found`|\n|[b7c5335](https://github.com/sagemath/sagetrac-mirror/commit/b7c5335886a174712d11b3d24a7b485e4d30a820)|`configure.ac: Stop early if no suitable Python is found`|",
    "created_at": "2020-03-18T01:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531210",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:78'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|[73e730c](https://github.com/sagemath/sagetrac-mirror/commit/73e730cc464b3409b146f5a6820450b8c260087a)|`build/bin/sage-system-python: Prefer python3, check a larger list of executable names, check for urllib; exit with a proper error message if no suitable Python is found`|
|[b7c5335](https://github.com/sagemath/sagetrac-mirror/commit/b7c5335886a174712d11b3d24a7b485e4d30a820)|`configure.ac: Stop early if no suitable Python is found`|



---

archive/issue_comments_531211.json:
```json
{
    "body": "Changing commit from \"3d90535b3301e49433e98146e2179c6daa549bf2\" to \"b7c5335886a174712d11b3d24a7b485e4d30a820\"",
    "created_at": "2020-03-18T01:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531211",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3d90535b3301e49433e98146e2179c6daa549bf2" to "b7c5335886a174712d11b3d24a7b485e4d30a820"



---

archive/issue_comments_531212.json:
```json
{
    "body": "Changing commit from \"b7c5335886a174712d11b3d24a7b485e4d30a820\" to \"3aa209ef8ca3605b78dbdd7fa59b3a337593ac6e\"",
    "created_at": "2020-03-18T01:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531212",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b7c5335886a174712d11b3d24a7b485e4d30a820" to "3aa209ef8ca3605b78dbdd7fa59b3a337593ac6e"



---

archive/issue_comments_531213.json:
```json
{
    "body": "<a id='comment:79'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|\n|[3aa209e](https://github.com/sagemath/sagetrac-mirror/commit/3aa209ef8ca3605b78dbdd7fa59b3a337593ac6e)|`src/bin/sage-location: Use sage-python instead of sage-system-python`|",
    "created_at": "2020-03-18T01:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531213",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:79'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|
|[3aa209e](https://github.com/sagemath/sagetrac-mirror/commit/3aa209ef8ca3605b78dbdd7fa59b3a337593ac6e)|`src/bin/sage-location: Use sage-python instead of sage-system-python`|



---

archive/issue_comments_531214.json:
```json
{
    "body": "<a id='comment:80'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-03-18T01:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531214",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:80'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_531215.json:
```json
{
    "body": "Changing commit from \"3aa209ef8ca3605b78dbdd7fa59b3a337593ac6e\" to \"3d90535b3301e49433e98146e2179c6daa549bf2\"",
    "created_at": "2020-03-18T01:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531215",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3aa209ef8ca3605b78dbdd7fa59b3a337593ac6e" to "3d90535b3301e49433e98146e2179c6daa549bf2"



---

archive/issue_comments_531216.json:
```json
{
    "body": "<a id='comment:81'></a>\n(pushed to wrong ticket, corrected)",
    "created_at": "2020-03-18T01:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531216",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:81'></a>
(pushed to wrong ticket, corrected)



---

archive/issue_comments_531217.json:
```json
{
    "body": "Changing commit from \"3d90535b3301e49433e98146e2179c6daa549bf2\" to \"dfa28169a5a2c20846df1f2f134e513a66091ede\"",
    "created_at": "2020-03-18T23:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531217",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3d90535b3301e49433e98146e2179c6daa549bf2" to "dfa28169a5a2c20846df1f2f134e513a66091ede"



---

archive/issue_comments_531218.json:
```json
{
    "body": "<a id='comment:82'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|\n|[a7cfbab](https://github.com/sagemath/sagetrac-mirror/commit/a7cfbab409beb241820de5f003e8678fd573463f)|`build/pkgs/python3/spkg-configure.m4: Rename config_venv -> conftest_venv`|\n|[dfa2816](https://github.com/sagemath/sagetrac-mirror/commit/dfa28169a5a2c20846df1f2f134e513a66091ede)|`Makefile [misc-clean): No need to remove config_venv`|",
    "created_at": "2020-03-18T23:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531218",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:82'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|
|[a7cfbab](https://github.com/sagemath/sagetrac-mirror/commit/a7cfbab409beb241820de5f003e8678fd573463f)|`build/pkgs/python3/spkg-configure.m4: Rename config_venv -> conftest_venv`|
|[dfa2816](https://github.com/sagemath/sagetrac-mirror/commit/dfa28169a5a2c20846df1f2f134e513a66091ede)|`Makefile [misc-clean): No need to remove config_venv`|



---

archive/issue_comments_531219.json:
```json
{
    "body": "<a id='comment:83'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|\n|[8f44123](https://github.com/sagemath/sagetrac-mirror/commit/8f441234e408c4a45e3ebe329d8e96c12e0da78e)|`src/bin/sage-env, src/bin/sage-env-config.in: export/use environment variable PYTHON_FOR_VENV`|",
    "created_at": "2020-03-18T23:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531219",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:83'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|
|[8f44123](https://github.com/sagemath/sagetrac-mirror/commit/8f441234e408c4a45e3ebe329d8e96c12e0da78e)|`src/bin/sage-env, src/bin/sage-env-config.in: export/use environment variable PYTHON_FOR_VENV`|



---

archive/issue_comments_531220.json:
```json
{
    "body": "Changing commit from \"dfa28169a5a2c20846df1f2f134e513a66091ede\" to \"8f441234e408c4a45e3ebe329d8e96c12e0da78e\"",
    "created_at": "2020-03-18T23:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531220",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "dfa28169a5a2c20846df1f2f134e513a66091ede" to "8f441234e408c4a45e3ebe329d8e96c12e0da78e"



---

archive/issue_comments_531221.json:
```json
{
    "body": "<a id='comment:84'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n|                                                                                                                                           |                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|\n|[c0a99e5](https://github.com/sagemath/sagetrac-mirror/commit/c0a99e5c3df860de9c5cd68de2bfddc8f2e49059)|`Set PYTHON_FOR_VENV correctly, use it in build/make/deps`|\n|[6fcd7cd](https://github.com/sagemath/sagetrac-mirror/commit/6fcd7cd6a05e8a6fe7869ecd8b4d55f96f877649)|`build/pkgs/python3/spkg-configure.m4: Check for more modules, including distutils.core`|\n|[15eceae](https://github.com/sagemath/sagetrac-mirror/commit/15eceae1cd0b97122d3fbd28a5648ec8803c606a)|`build/pkgs/python3/spkg-configure.m4: Rename config_setup.py and config_build to conftest.py and conftest.dir respectively since autoconf will automatically clean up files and directories beginning with \"conftest\"`|\n|[fde251b](https://github.com/sagemath/sagetrac-mirror/commit/fde251bf1935122fbcc31419cb616635725a494a)|`src/bin/sage-env: Make inst_python3_venv = $(SAGE_VENV)/pyvenv.cfg. Adapted from #29032`|\n|[e73a428](https://github.com/sagemath/sagetrac-mirror/commit/e73a42814ad20ce55bf079f6930f7d3e20eccd7b)|`build/pkgs/python3/spkg-configure.m4: Rename config_venv -> conftest_venv`|\n|[b1518b7](https://github.com/sagemath/sagetrac-mirror/commit/b1518b783776e769a399a1dd3520ef44f72a4734)|`Makefile [misc-clean): No need to remove config_venv`|\n|[179d2e5](https://github.com/sagemath/sagetrac-mirror/commit/179d2e5d83e3de1c9f2cdffe5df4830f6dbce7a5)|`src/bin/sage-env, src/bin/sage-env-config.in: export/use environment variable PYTHON_FOR_VENV`|\n|[176ce61](https://github.com/sagemath/sagetrac-mirror/commit/176ce61ddeca2f26d9d5bd530e5c1e59d2ea9ca2)|`build/make/Makefile.in, build/make/deps: Create venv in $SAGE_LOCAL using venv.EnvBuilder, instead of in $SAGE_LOCAL/lib/sage/venv using venv command line`|\n|[e29087a](https://github.com/sagemath/sagetrac-mirror/commit/e29087a99358ac13cd777b1f741cab0ab1fc1ac2)|`build/pkgs/python3/spkg-configure.m4: Only set PYTHON_FOR_VENV if we use the system python`|\n|[f7924eb](https://github.com/sagemath/sagetrac-mirror/commit/f7924eb3b6140a725a5181c71936fb9ed65ec5db)|`build/bin/sage-venv: New, use it in build/pkgs/python3/spkg-configure.m4 and build/make/deps`|",
    "created_at": "2020-03-19T15:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531221",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:84'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
|                                                                                                                                           |                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
|[c0a99e5](https://github.com/sagemath/sagetrac-mirror/commit/c0a99e5c3df860de9c5cd68de2bfddc8f2e49059)|`Set PYTHON_FOR_VENV correctly, use it in build/make/deps`|
|[6fcd7cd](https://github.com/sagemath/sagetrac-mirror/commit/6fcd7cd6a05e8a6fe7869ecd8b4d55f96f877649)|`build/pkgs/python3/spkg-configure.m4: Check for more modules, including distutils.core`|
|[15eceae](https://github.com/sagemath/sagetrac-mirror/commit/15eceae1cd0b97122d3fbd28a5648ec8803c606a)|`build/pkgs/python3/spkg-configure.m4: Rename config_setup.py and config_build to conftest.py and conftest.dir respectively since autoconf will automatically clean up files and directories beginning with "conftest"`|
|[fde251b](https://github.com/sagemath/sagetrac-mirror/commit/fde251bf1935122fbcc31419cb616635725a494a)|`src/bin/sage-env: Make inst_python3_venv = $(SAGE_VENV)/pyvenv.cfg. Adapted from #29032`|
|[e73a428](https://github.com/sagemath/sagetrac-mirror/commit/e73a42814ad20ce55bf079f6930f7d3e20eccd7b)|`build/pkgs/python3/spkg-configure.m4: Rename config_venv -> conftest_venv`|
|[b1518b7](https://github.com/sagemath/sagetrac-mirror/commit/b1518b783776e769a399a1dd3520ef44f72a4734)|`Makefile [misc-clean): No need to remove config_venv`|
|[179d2e5](https://github.com/sagemath/sagetrac-mirror/commit/179d2e5d83e3de1c9f2cdffe5df4830f6dbce7a5)|`src/bin/sage-env, src/bin/sage-env-config.in: export/use environment variable PYTHON_FOR_VENV`|
|[176ce61](https://github.com/sagemath/sagetrac-mirror/commit/176ce61ddeca2f26d9d5bd530e5c1e59d2ea9ca2)|`build/make/Makefile.in, build/make/deps: Create venv in $SAGE_LOCAL using venv.EnvBuilder, instead of in $SAGE_LOCAL/lib/sage/venv using venv command line`|
|[e29087a](https://github.com/sagemath/sagetrac-mirror/commit/e29087a99358ac13cd777b1f741cab0ab1fc1ac2)|`build/pkgs/python3/spkg-configure.m4: Only set PYTHON_FOR_VENV if we use the system python`|
|[f7924eb](https://github.com/sagemath/sagetrac-mirror/commit/f7924eb3b6140a725a5181c71936fb9ed65ec5db)|`build/bin/sage-venv: New, use it in build/pkgs/python3/spkg-configure.m4 and build/make/deps`|



---

archive/issue_comments_531222.json:
```json
{
    "body": "Changing commit from \"8f441234e408c4a45e3ebe329d8e96c12e0da78e\" to \"f7924eb3b6140a725a5181c71936fb9ed65ec5db\"",
    "created_at": "2020-03-19T15:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531222",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8f441234e408c4a45e3ebe329d8e96c12e0da78e" to "f7924eb3b6140a725a5181c71936fb9ed65ec5db"



---

archive/issue_comments_531223.json:
```json
{
    "body": "Changing dependencies from \"#29013\" to \"\"",
    "created_at": "2020-03-19T15:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531223",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#29013" to ""



---

archive/issue_events_086066.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-19T15:56:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27824#event-86066"
}
```



---

archive/issue_events_086067.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-19T15:56:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27824#event-86067"
}
```



---

archive/issue_comments_531224.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,9 @@\n Do not install python3 if a sufficiently new version is available in `$PATH`. This could be a system python3, or the python3 from within a venv.\n \n-Via #29013, we install all of our own Python packages into a separate venv.\n+As suggested in #29032, we make $SAGE_LOCAL a venv (https://docs.python.org/3/library/venv.html) over the system python3 -- if a suitable system python3 is found -- by using the `venv.EnvBuilder` API. \n \n-The venv does not include the system site-packages; we keep that task for the follow-up ticket #29023.\n+This is done by the new script `build/bin/sage-venv`, which we use both during `configure` (to make sure that we select a system python3 for which venvs work correctly) and during `make`.\n+\n+The venv does not include the system site-packages: We continue to install all Python packages into our venv using the existing build infrastructure. We keep the task of using system site-packages for the follow-up ticket #29023.\n \n \n``````\n",
    "created_at": "2020-03-19T15:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531224",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,9 @@
 Do not install python3 if a sufficiently new version is available in `$PATH`. This could be a system python3, or the python3 from within a venv.
 
-Via #29013, we install all of our own Python packages into a separate venv.
+As suggested in #29032, we make $SAGE_LOCAL a venv (https://docs.python.org/3/library/venv.html) over the system python3 -- if a suitable system python3 is found -- by using the `venv.EnvBuilder` API. 
 
-The venv does not include the system site-packages; we keep that task for the follow-up ticket #29023.
+This is done by the new script `build/bin/sage-venv`, which we use both during `configure` (to make sure that we select a system python3 for which venvs work correctly) and during `make`.
+
+The venv does not include the system site-packages: We continue to install all Python packages into our venv using the existing build infrastructure. We keep the task of using system site-packages for the follow-up ticket #29023.
 
 
``````




---

archive/issue_comments_531225.json:
```json
{
    "body": "<a id='comment:85'></a>\nThis ticket is no longer on top of #29013.",
    "created_at": "2020-03-19T15:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531225",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:85'></a>
This ticket is no longer on top of #29013.



---

archive/issue_comments_531226.json:
```json
{
    "body": "<a id='comment:86'></a>\nTests run at https://github.com/mkoeppe/sage/actions/runs/58992626 and \nhttps://github.com/mkoeppe/sage/actions/runs/58992623",
    "created_at": "2020-03-19T16:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531226",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:86'></a>
Tests run at https://github.com/mkoeppe/sage/actions/runs/58992626 and 
https://github.com/mkoeppe/sage/actions/runs/58992623



---

archive/issue_comments_531227.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-19T16:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531227",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_531228.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,4 +6,6 @@\n \n The venv does not include the system site-packages: We continue to install all Python packages into our venv using the existing build infrastructure. We keep the task of using system site-packages for the follow-up ticket #29023.\n \n+(Note, we use `venv` (new since Python 3.3), not `virtualenv`. So this change is limited to Python 3 builds of Sage.)\n \n+\n``````\n",
    "created_at": "2020-03-19T16:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531228",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,4 +6,6 @@
 
 The venv does not include the system site-packages: We continue to install all Python packages into our venv using the existing build infrastructure. We keep the task of using system site-packages for the follow-up ticket #29023.
 
+(Note, we use `venv` (new since Python 3.3), not `virtualenv`. So this change is limited to Python 3 builds of Sage.)
 
+
``````




---

archive/issue_comments_531229.json:
```json
{
    "body": "Changing commit from \"f7924eb3b6140a725a5181c71936fb9ed65ec5db\" to \"c570d6b8b62ff5e040501854329f431309cad6a3\"",
    "created_at": "2020-03-19T20:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531229",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f7924eb3b6140a725a5181c71936fb9ed65ec5db" to "c570d6b8b62ff5e040501854329f431309cad6a3"



---

archive/issue_comments_531230.json:
```json
{
    "body": "<a id='comment:88'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|\n|[c570d6b](https://github.com/sagemath/sagetrac-mirror/commit/c570d6b8b62ff5e040501854329f431309cad6a3)|`build/bin/sage-venv: Fixup`|",
    "created_at": "2020-03-19T20:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531230",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:88'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|
|[c570d6b](https://github.com/sagemath/sagetrac-mirror/commit/c570d6b8b62ff5e040501854329f431309cad6a3)|`build/bin/sage-venv: Fixup`|



---

archive/issue_comments_531231.json:
```json
{
    "body": "<a id='comment:89'></a>\nA successful test at: https://github.com/mkoeppe/sage/runs/520449412",
    "created_at": "2020-03-20T01:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531231",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:89'></a>
A successful test at: https://github.com/mkoeppe/sage/runs/520449412



---

archive/issue_comments_531232.json:
```json
{
    "body": "<a id='comment:92'></a>\nTests run at https://github.com/mkoeppe/sage/actions/runs/60588138",
    "created_at": "2020-03-22T03:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531232",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:92'></a>
Tests run at https://github.com/mkoeppe/sage/actions/runs/60588138



---

archive/issue_comments_531233.json:
```json
{
    "body": "<a id='comment:93'></a>\nBreaks python 2 builds",
    "created_at": "2020-03-22T09:23:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531233",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:93'></a>
Breaks python 2 builds



---

archive/issue_comments_531234.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-03-22T09:23:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531234",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_531235.json:
```json
{
    "body": "<a id='comment:94'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|\n|[65a9f02](https://github.com/sagemath/sagetrac-mirror/commit/65a9f028c2179ff3757f200aae62c8746be6d45c)|`build/make/deps: Do not set PYTHON = python3_venv in a python2 build`|",
    "created_at": "2020-03-22T16:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531235",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:94'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|
|[65a9f02](https://github.com/sagemath/sagetrac-mirror/commit/65a9f028c2179ff3757f200aae62c8746be6d45c)|`build/make/deps: Do not set PYTHON = python3_venv in a python2 build`|



---

archive/issue_comments_531236.json:
```json
{
    "body": "Changing commit from \"c570d6b8b62ff5e040501854329f431309cad6a3\" to \"65a9f028c2179ff3757f200aae62c8746be6d45c\"",
    "created_at": "2020-03-22T16:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531236",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c570d6b8b62ff5e040501854329f431309cad6a3" to "65a9f028c2179ff3757f200aae62c8746be6d45c"



---

archive/issue_comments_531237.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-03-22T16:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531237",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_531238.json:
```json
{
    "body": "<a id='comment:96'></a>\nReady for review",
    "created_at": "2020-03-22T17:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531238",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:96'></a>
Ready for review



---

archive/issue_comments_531239.json:
```json
{
    "body": "<a id='comment:97'></a>\nNew tests at https://github.com/mkoeppe/sage/actions/runs/60877259; see also #29367",
    "created_at": "2020-03-22T19:48:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531239",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:97'></a>
New tests at https://github.com/mkoeppe/sage/actions/runs/60877259; see also #29367



---

archive/issue_comments_531240.json:
```json
{
    "body": "Changing commit from \"65a9f028c2179ff3757f200aae62c8746be6d45c\" to \"1c845a4169769157787cdc3e2df37c08a6914891\"",
    "created_at": "2020-03-23T00:47:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531240",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "65a9f028c2179ff3757f200aae62c8746be6d45c" to "1c845a4169769157787cdc3e2df37c08a6914891"



---

archive/issue_comments_531241.json:
```json
{
    "body": "<a id='comment:98'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|\n|[1c845a4](https://github.com/sagemath/sagetrac-mirror/commit/1c845a4169769157787cdc3e2df37c08a6914891)|`build/pkgs/python3/spkg-configure.m4: Do not use venv for python3 if we do a python2 build`|",
    "created_at": "2020-03-23T00:47:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531241",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:98'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|
|[1c845a4](https://github.com/sagemath/sagetrac-mirror/commit/1c845a4169769157787cdc3e2df37c08a6914891)|`build/pkgs/python3/spkg-configure.m4: Do not use venv for python3 if we do a python2 build`|



---

archive/issue_comments_531242.json:
```json
{
    "body": "<a id='comment:99'></a>\nTests at https://github.com/mkoeppe/sage/actions/runs/61077298",
    "created_at": "2020-03-23T00:48:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531242",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:99'></a>
Tests at https://github.com/mkoeppe/sage/actions/runs/61077298



---

archive/issue_comments_531243.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-23T14:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531243",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_531244.json:
```json
{
    "body": "<a id='comment:0'></a>\nLet's move this, looks good to me.",
    "created_at": "2020-03-23T14:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531244",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>
Let's move this, looks good to me.



---

archive/issue_comments_531245.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2020-03-23T14:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531245",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_531246.json:
```json
{
    "body": "<a id='comment:1'></a>\nThanks!",
    "created_at": "2020-03-23T16:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531246",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>
Thanks!



---

archive/issue_comments_531247.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-29T00:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531247",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_531248.json:
```json
{
    "body": "Changing branch from \"public/27824-python3-spkg-configure\" to \"1c845a4169769157787cdc3e2df37c08a6914891\"",
    "created_at": "2020-03-29T00:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531248",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/27824-python3-spkg-configure" to "1c845a4169769157787cdc3e2df37c08a6914891"



---

archive/issue_events_086068.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-29T00:24:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27824#event-86068"
}
```



---

archive/issue_comments_531249.json:
```json
{
    "body": "Changing commit from \"1c845a4169769157787cdc3e2df37c08a6914891\" to \"\"",
    "created_at": "2020-05-18T14:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531249",
    "user": "https://github.com/mezzarobba"
}
```

Changing commit from "1c845a4169769157787cdc3e2df37c08a6914891" to ""



---

archive/issue_comments_531250.json:
```json
{
    "body": "<a id='comment:3'></a>\nHello everyone,\n\nWhen trying to upgrade to 9.1.rc5, I'm seeing an issue that I suspect could be a side effect of this ticket.\n\nFor some reason my `sage/local/bin/python3.7` was a symlink to the system python binary. Sage decided it wanted to install its own python-3.7.3.p1, but that failed with a permission error on the symlink. After deleting the symlink, python builds and installs correctly. (I let the logs be overwritten, so I won't be able to provide much details \u2014 sorry.)\n\nThe overall Sage build still fails with an error about six not being found while building setuptools that I haven't yet investigated.",
    "created_at": "2020-05-18T14:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531250",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:3'></a>
Hello everyone,

When trying to upgrade to 9.1.rc5, I'm seeing an issue that I suspect could be a side effect of this ticket.

For some reason my `sage/local/bin/python3.7` was a symlink to the system python binary. Sage decided it wanted to install its own python-3.7.3.p1, but that failed with a permission error on the symlink. After deleting the symlink, python builds and installs correctly. (I let the logs be overwritten, so I won't be able to provide much details — sorry.)

The overall Sage build still fails with an error about six not being found while building setuptools that I haven't yet investigated.



---

archive/issue_comments_531251.json:
```json
{
    "body": "<a id='comment:4'></a>\nif you switch to py3 from py2, you probably need to run `./configure --with-python=3`\n\nit is not clear what version you were on, but the changes to the build system were very substantial, so ymmv.",
    "created_at": "2020-05-18T17:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531251",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>
if you switch to py3 from py2, you probably need to run `./configure --with-python=3`

it is not clear what version you were on, but the changes to the build system were very substantial, so ymmv.



---

archive/issue_comments_531252.json:
```json
{
    "body": "<a id='comment:105'></a>\nYes, this is a known limitation. I have created #29708 (Fix switching between --with-system-python3 and --without-system-python3) for it. We shall fix it in 9.2.",
    "created_at": "2020-05-18T17:36:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27824#issuecomment-531252",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:105'></a>
Yes, this is a known limitation. I have created #29708 (Fix switching between --with-system-python3 and --without-system-python3) for it. We shall fix it in 9.2.
